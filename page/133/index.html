
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 133 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-mysql--mysql性能的检查和调优方法-sudonecom服务器系统架构分析日志/">mysql性能的检查和调优方法 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:33.000Z"> <a href="/2014/02/02/2014-02-02-DB-mysql--mysql性能的检查和调优方法-sudonecom服务器系统架构分析日志/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="mysql-sudone-com-">mysql性能的检查和调优方法 - sudone.com服务器系统架构分析日志</h1>
<h1 id="-sudone-com-http-www-sudone-com-"><a href="http://www.sudone.com/" target="_blank">sudone.com</a> 服务器系统架构分析日志</h1>
<h1 id="mysql-">mysql性能的检查和调优方法</h1>
<p>[2012-08-02 15:22:04]</p>
<p>我一直是使用mysql这个数据库软件，它工作比较稳定，效率也很高。在遇到严重性能问题时，一般都有这么几种可能：
1、索引没有建好；
2、sql写法过于复杂；
3、配置错误；
4、机器实在负荷不了；
1、索引没有建好
如果看到mysql消耗的cpu很大，可以用mysql的client工具来检查。
在linux下执行
/usr/local/mysql/bin/mysql -hlocalhost -uroot -p
输入密码，如果没有密码，则不用-p参数就可以进到客户端界面中。
看看当前的运行情况
show full processlist
可以多运行几次
这个命令可以看到当前正在执行的sql语句，它会告知执行的sql、数据库名、执行的状态、来自的客户端ip、所使用的帐号、运行时间等信息
在我的cache后端，这里面大部分时间是看不到显示任何sql语句的，我认为这样才算比较正常。如果看到有很多sql语句，那么这台mysql就一定会有性能问题
如果出现了性能问题，则可以进行分析：
1、是不是有sql语句卡住了？
这是出现比较多的情况，如果数据库是采用myisam，那么有可能有一个写入的线程会把数据表给锁定了，如果这条语句不结束，则其它语句也无法运行。
查看processlist里的time这一项，看看有没有执行时间很长的语句，要留意这些语句。
2、大量相同的sql语句正在执行
如果出现这种情况，则有可能是该sql语句执行的效率低下，同样要留意这些语句。
然后把你所怀疑的语句统统集合一下，用desc（explain）来检查这些语句。
首先看看一个正常的desc输出：
mysql&gt; desc select /<em> from imgs where imgid=1651768337;
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+
| id | select_type | table | type  | possible_keys | key     | key_len | ref   | rows | Extra |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+
|  1 | SIMPLE      | imgs  | const | PRIMARY       | PRIMARY | 8       | const |    1 |       |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+
1 row in set (0.00 sec)
注意key、rows和Extra这三项，这条语句返回的结果说明了该sql会使用PRIMARY主键索引来查询，结果集数量为1条，Extra没有显示，证明没有用到排序或其他操作。由此结果可以推断，mysql会从索引中查询imgid=1651768337这条记录，然后再到真实表中取出所有字段，是很简单的操作。
key是指明当前sql会使用的索引，mysql执行一条简单语句时只能使用到一条索引，注意这个限制；rows是返回的结果集大小，结果集就是使用该索引进行一次搜索的所有匹配结果；Extra一般会显示查询和排序的方式，。
如果没有使用到key，或者rows很大而用到了filesort排序，一般都会影响到效率，例如：
mysql&gt; desc select /</em> from imgs where userid=&quot;7mini&quot; order by clicks desc limit 10;
+----+-------------+-------+------+---------------+------+---------+------+-------+-----------------------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows  | Extra                       |
+----+-------------+-------+------+---------------+------+---------+------+-------+-----------------------------+
|  1 | SIMPLE      | imgs  | ALL  | NULL          | NULL | NULL    | NULL | 12506 | Using where; Using filesort |
+----+-------------+-------+------+---------------+------+---------+------+-------+-----------------------------+
1 row in set (0.00 sec)
这条sql结果集会有12506条，用到了filesort，所以执行起来会非常消耗效率的。这时mysql执行时会把整个表扫描一遍，一条一条去找到匹配userid=&quot;7mini&quot;的记录，然后还要对这些记录的clicks进行一次排序，效率可想而知。真实执行时如果发现还比较快的话，那是因为服务器内存还足够将12506条比较短小的记录全部读入内存，所以还比较快，但是并发多起来或者表大起来的话，效率问题就严重了。
这时我把userid加入索引：
create index userid on imgs (userid);
然后再检查：
mysql&gt; desc select /<em> from imgs where userid=&quot;7mini&quot; order by clicks desc limit 10;
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
| id | select_type | table | type | possible_keys | key    | key_len | ref   | rows | Extra                       |
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
|  1 | SIMPLE      | imgs  | ref  | userid        | userid | 51      | const |    8 | Using where; Using filesort |
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
1 row in set (0.00 sec)
嗯，这时可以看到mysql使用了userid这个索引搜索了，用userid索引一次搜索后，结果集有8条。然后虽然使用了filesort一条一条排序，但是因为结果集只有区区8条，效率问题得以缓解。
但是，如果我用别的userid查询，结果又会有所不同：
mysql&gt; desc select /</em> from imgs where userid=&quot;admin&quot; order by clicks desc limit 10;
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
| id | select_type | table | type | possible_keys | key    | key_len | ref   | rows | Extra                       |
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
|  1 | SIMPLE      | imgs  | ref  | userid        | userid | 51      | const | 2944 | Using where; Using filesort |
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
1 row in set (0.00 sec)
这个结果和userid=&quot;7mini&quot;的结果基本相同，但是mysql用userid索引一次搜索后结果集的大小达到2944条，这2944条记录都会加入内存进行filesort，效率比起7mini那次来说就差很多了。这时可以有两种办法可以解决，第一种办法是再加一个索引和判断条件，因为我只需要根据点击量取最大的10条数据，所以有很多数据我根本不需要加进来排序，比如点击量小于10的，这些数据可能占了很大部分。
我对clicks加一个索引，然后加入一个where条件再查询：
create index clicks on imgs(clicks);
mysql&gt; desc select /<em> from imgs where userid=&quot;admin&quot; order by clicks desc limit 10;
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
| id | select_type | table | type | possible_keys | key    | key_len | ref   | rows | Extra                       |
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
|  1 | SIMPLE      | imgs  | ref  | userid,clicks | userid | 51      | const | 2944 | Using where; Using filesort |
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
1 row in set (0.00 sec)
这时可以看到possible_keys变成了userid,clicks，possible_keys是可以匹配的所有索引，mysql会从possible_keys中自己判断并取用其中一个索引来执行语句，值得注意的是，mysql取用的这个索引未必是最优化的。这次查询mysql还是使用userid这个索引来查询的，并没有按照我的意愿，所以结果还是没有什么变化。改一下sql加上use index强制mysql使用clicks索引：
mysql&gt; desc select /</em> from imgs use index (clicks) where userid=&#39;admin&#39; and clicks&gt;10 order by clicks desc limit 10
+----+-------------+-------+-------+---------------+--------+---------+------+------+-------------+
| id | select_type | table | type  | possible_keys | key    | key_len | ref  | rows | Extra       |
+----+-------------+-------+-------+---------------+--------+---------+------+------+-------------+
|  1 | SIMPLE      | imgs  | range | clicks        | clicks | 4       | NULL | 5455 | Using where |
+----+-------------+-------+-------+---------------+--------+---------+------+------+-------------+
1 row in set (0.00 sec)
这时mysql用到了clicks索引进行查询，但是结果集比userid还要大！看来还要再进行限制：
mysql&gt; desc select /<em> from imgs use index (clicks) where userid=&#39;admin&#39; and clicks&gt;1000 order by clicks desc limit 10
+----+-------------+-------+-------+---------------+--------+---------+------+------+-------------+
| id | select_type | table | type  | possible_keys | key    | key_len | ref  | rows | Extra       |
+----+-------------+-------+-------+---------------+--------+---------+------+------+-------------+
|  1 | SIMPLE      | imgs  | range | clicks        | clicks | 4       | NULL |  312 | Using where |
+----+-------------+-------+-------+---------------+--------+---------+------+------+-------------+
1 row in set (0.00 sec)
加到1000的时候结果集变成了312条，排序效率应该是可以接受。
不过，采用换索引这种优化方式需要取一个采样点，比如这个例子中的1000这个数字，这样，对userid的每个数值，都要去找一个采样点，这样对程序来说是很难办的。如果按1000取样的话，那么userid=&#39;7mini&#39;这个例子中，取到的结果将不会是8条，而是2条，给用户造成了困惑。
当然还有另一种办法，加入双索引：
create index userid_clicks on imgs (userid, clicks)
mysql&gt; desc select /</em> from imgs where userid=&quot;admin&quot; order by clicks desc limit 10;
+----+-------------+-------+------+----------------------+---------------+---------+-------+------+-------------+
| id | select_type | table | type | possible_keys        | key           | key_len | ref   | rows | Extra       |
+----+-------------+-------+------+----------------------+---------------+---------+-------+------+-------------+
|  1 | SIMPLE      | imgs  | ref  | userid,userid_clicks | userid_clicks | 51      | const | 2944 | Using where |
+----+-------------+-------+------+----------------------+---------------+---------+-------+------+-------------+
1 row in set (0.00 sec)
这时可以看到，结果集还是2944条，但是Extra中的filesort不见了。这时mysql使用userid_clicks这个索引去查询，这不但能快速查询到userid=&quot;admin&quot;的所有记录，并且结果是根据clicks排好序的！所以不用再把这个结果集读入内存一条一条排序了，效率上会高很多。
但是用多字段索引这种方式有个问题，如果查询的sql种类很多的话，就得好好规划一下了，否则索引会建得非常多，不但会影响到数据insert和update的效率，而且数据表也容易损坏。
以上是对索引优化的办法，因为原因可能会比较复杂，所以写得比较的长，一般好好优化了索引之后，mysql的效率会提升n个档次，从而也不需要考虑增加机器来解决问题了。
但是，mysql甚至所有数据库，可能都不好解决limit的问题。在mysql中，limit 0,10只要索引合适，是没有问题的，但是limit 100000,10就会很慢了，因为mysql会扫描排好序的结果，然后找到100000这个点，取出10条返回。要找到100000这个点，就要扫描100000条记录，这个循环是比较耗时的。不知道会不会有什么好的算法可以优化这个扫描引擎，我冥思苦想也想不出有什么好办法。对于limit，目前直至比较久远的将来，我想只能通过业务、程序和数据表的规划来优化，我想到的这些优化办法也都还没有一个是万全之策，往后再讨论。
2、sql写法过于复杂
sql写法假如用到一些特殊的功能，比如groupby、或者多表联合查询的话，mysql用到什么方式来查询也可以用desc来分析，我这边用复杂sql的情况还不算多，所以不常分析，暂时就没有好的建议。
3、配置错误
配置里主要参数是key_buffer、sort_buffer_size/myisam_sort_buffer_size，这两个参数意思是：
key_buffer=128M：全部表的索引都会尽可能放在这块内存区域内，索引比较大的话就开稍大点都可以，我一般设为128M，有个好的建议是把很少用到并且比较大的表想办法移到别的地方去，这样可以显著减少mysql的内存占用。
sort_buffer_size=1M：单个线程使用的用于排序的内存，查询结果集都会放进这内存里，如果比较小，mysql会多放几次，所以稍微开大一点就可以了，重要是优化好索引和查询语句，让他们不要生成太大的结果集。
另外一些配置：
thread_concurrency=8：这个配置标配=cpu数量x2
interactive_timeout=30
wait_timeout=30：这两个配置使用10-30秒就可以了，这样会尽快地释放内存资源，注意：一直在使用的连接是不会断掉的，这个配置只是断掉了长时间不动的连接。
query_cache：这个功能不要使用，现在很多人看到cache这几个字母就像看到了宝贝，这是不唯物主义的。mysql的query_cache在每次表数据有变化的时候都会重新清理连至该表的所有缓存，如果更新比较频繁，query_cache不但帮不上忙，而且还会对效率影响很大。这个参数只适合只读型的数据库，如果非要用，也只能用query_cache_type=2自行用SQL_CACHE指定一些sql进行缓存。
max_connections：默认为100，一般情况下是足够用的，但是一般要开大一点，开到400-600就可以了，能超过600的话一般就有效率问题，得另找对策，光靠增加这个数字不是办法。
其它配置可以按默认就可以了，个人觉得问题还不是那么的大，提醒一下：1、配置虽然很重要，但是在绝大部分情况下都不是效率问题的罪魁祸首。2、mysql是一个数据库，对于数据库最重要考究的不应是效率，而是稳定性和数据准确性。
4、机器实在负荷不了
如果做了以上调整，服务器还是不能承受，那就只能通过架构级调整来优化了。
1、mysql同步。
通过mysql同步功能将数据同步到数台从数据库，由主数据库写入，从数据库提供读取。
我个人不是那么乐意使用mysql同步，因为这个办法会增加程序的复杂性，并常常会引起数据方面的错误。在高负荷的服务中，死机了还可以快速重启，但数据错误的话要恢复就比较麻烦。
2、加入缓存
加入缓存之后，就可以解决并发的问题，效果很明显。如果是实时系统，可以考虑用刷新缓存方式使缓存保持最新。
在前端加入squid的架构比较提倡使用，在命中率比较高的应用中，基本上可以解决问题。
如果是在程序逻辑层里面进行缓存，会增加很多复杂性，问题会比较多而且难解决，不建议在这一层面进行调整。
3、程序架构调整，支持同时连接多个数据库
如果web加入缓存后问题还是比较严重，只能通过程序架构调整，把应用拆散，用多台的机器同时提供服务。
如果拆散的话，对业务是有少许影响，如果业务当中有部分功能必须使用所有的数据，可以用一个完整库+n个分散库这样的架构，每次修改都在完整库和分散库各操作一次，或定期整理完整库。
当然，还有一种最笨的，把数据库整个完完整整的做拷贝，然后程序每次都把完整的sql在这些库执行一遍，访问时轮询访问，我认为这样要比mysql同步的方式安全。
4、使用 mysql proxy 代理
mysql proxy 可以通过代理把数据库中的各个表分散到数台服务器，但是它的问题是没有能解决热门表的问题，如果热门内容散在多个表中，用这个办法是比较轻松就能解决问题。
我没有用过这个软件也没有认真查过，不过我对它的功能有一点点怀疑，就是它怎么实现多个表之间的联合查询？如果能实现，那么效率如何呢？
5、使用memcachedb
数据库换用支持mysql的memcachedb，是可以一试的想法，从memcachedb的实现方式和层面来看对数据没有什么影响，不会对用户有什么困扰。
为我现在因为数据库方面问题不多，没有试验过这个玩意。不过，只要它支持mysql的大部分主要的语法，而且本身稳定，可用性是无需置疑的。
  站名：<a href="http://www.sudone.com/" target="_blank">sudone.com</a>; 站长：<a href="http://www.sudone.com/ayou.html" target="_blank">Ayou</a>; 服务器：ubuntu+nginx+squid+php</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/mysql/">mysql</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/mysql/" class="label label-success">mysql</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:33"datetime="2014-03-07 09:54:33"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-mysql--mysql性能的检查和调优方法-sudonecom服务器系统架构分析日志/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-mysql--mysql性能的检查和调优方法-sudonecom服务器系统架构分析日志" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-mysql--MySQL运维笔记（一）——终止高负载SQL/">MySQL 运维笔记（一）—— 终止高负载SQL</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:33.000Z"> <a href="/2014/02/02/2014-02-02-DB-mysql--MySQL运维笔记（一）——终止高负载SQL/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="mysql-sql">MySQL 运维笔记（一）—— 终止高负载SQL</h1>
<p>数据库表体积大了，负载高了，难免一个sql出去耗时延长。半个月前，一个凌晨定时任务跑了8小时，突然手足无措。最后找DBA协助，直接干掉了这个sql进程。
其实，这并不复杂。
首先，找出占用CPU时间过长的SQL
Sql代码 <a href="&quot;复制代码&quot;"><img src="" alt="复制代码"></a> <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>show processlist;  </li>
</ol>
<p>show processlist;</p>
<p><img src="" alt="">
 假定最后一条sql处于Query状态，且Time时间过长，就锁定它的ID，直接干掉即可。</p>
<p>然后，杀死进程：</p>
<p>Sql代码 <a href="&quot;复制代码&quot;"><img src="" alt="复制代码"></a> <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>kill QUERY  4487855;  </li>
</ol>
<p>kill QUERY  4487855;</p>
<p> 这就大功告成了！</p>
<p> 参考</p>
<p>KILL [CONNECTION | QUERY] thread_id</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/mysql/">mysql</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/mysql/" class="label label-success">mysql</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:33"datetime="2014-03-07 09:54:33"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-mysql--MySQL运维笔记（一）——终止高负载SQL/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-mysql--MySQL运维笔记（一）——终止高负载SQL" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-PowerDesinger逆向数据库物理模型及关系图/">PowerDesinger逆向数据库物理模型及关系图 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:32.000Z"> <a href="/2014/02/02/2014-02-02-PowerDesinger逆向数据库物理模型及关系图/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="powerdesinger-">PowerDesinger逆向数据库物理模型及关系图</h1>
<h1 id="-http-zz563143188-iteye-com-"><a href="http://zz563143188.iteye.com/" target="_blank">既然来了就要多看几篇博客， 因为每一篇都适合你。如果收藏重复看，你一定能感受到我的正能量。</a></h1>
<p> 利用PowerDesinger生成的数据库物理模型及关系图</p>
<p><strong>下载地址：</strong> <a href="http://pan.baidu.com/share/link?shareid=372668&amp;uk=4076915866" target="_blank"><a href="http://pan.baidu.com/share/link?shareid=372668&amp;uk=4076915866">http://pan.baidu.com/share/link?shareid=372668&amp;uk=4076915866</a></a>    </p>
<p>在<a href="http://baike.baidu.com/view/280978.htm" target="_blank">数据库建模</a>的过程中，需要运用PowerDesigner进行<a href="http://baike.baidu.com/view/8268.htm" target="_blank">数据库设计</a>，这个不但让人直观的理解模型，而且可以充分的利用数据库技术，优化数据库的设计。第一次用PowerDesigner并不感到很陌生，里面与SQLServer建立<a href="http://baike.baidu.com/view/1088.htm" target="_blank">数据库</a>差不多。</p>
<p>[2]<a href=""></a>其次就是<a href="http://baike.baidu.com/view/1622963.htm">ER图</a>，在<a href="http://baike.baidu.com/view/1051126.htm" target="_blank">数据库系统概论</a>中有涉及到，这个实体关系图中，一个实体对于一个表，实体、属性与联系是进行<a href="http://baike.baidu.com/view/170106.htm" target="_blank">系统设计</a>时要考虑的三个<a href="http://baike.baidu.com/view/290205.htm" target="_blank">要素</a>，也是一个好的<a href="http://baike.baidu.com/view/8268.htm" target="_blank">数据库设计</a>的核心。
正文：</p>
<p>利用PowerDesinger逆向数据物理模型及关系图，第一步是建立ODBC数据源，然后再利用powerdesinger连接ODBC数据源管理数据。
步骤：</p>
<ol>
<li>首先建立odbc数据源，开始-&gt;控制面板-&gt;管理工具-&gt;数据源(odbc)-&gt;系统DSN-&gt;添加数 据库驱动(本人是用的oracle。所以就使用 oracle in oraDb10g_home驱动), 建立好数据源测试成功即可。
<img src="&quot;点击查看原始大小图片&quot;" alt=""></li>
</ol>
<p>2.添加myo数据源,添加数据源以后测试连接是否成功。
<img src="" alt=""></p>
<p><img src="" alt="">
3.通过powerdesinger逆向工程-&gt;数据库得到数据库物理模型。</p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt="">
4.选择数据库类型，建立ＯＤＢＣ连接</p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt="">
5.配置数据源，可能已经存在的数据源，也可以新建数据源</p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt="">
6.如果已存在ｍｙｏ数据源则不需要新建，如果没有则需要新建数据源。配置后测试数据库连接后，即可逆向数据库模型。</p>
<p><img src="" alt="">
7.powerdesinger显示逆向的所有表，并即将生成物理模型和关系实体图。</p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt="">
8.显示出表的结构信息，并可以重新编译生成。</p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt="">
9.powerdesinger为我们建立好数据库关系图，看上去是不是很专业。</p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt=""></p>
<ul>
<li><a href="http://dl2.iteye.com/upload/attachment/0081/6042/5b5c8c72-6caf-3cd8-84cc-e43955abca9c.jpg" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></li>
<li><p>大小: 127 KB</p>
</li>
<li><p><a href="http://dl2.iteye.com/upload/attachment/0081/6044/cd7270ad-6376-30e7-a051-90028d7c9bf6.jpg" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 84.4 KB</p>
</li>
<li><p><a href="http://dl2.iteye.com/upload/attachment/0081/6046/284695e5-2e12-3212-8ba5-d8fb24a9e436.jpg" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 77.7 KB</p>
</li>
<li><p><a href="http://dl2.iteye.com/upload/attachment/0081/6048/118eb2ef-2a81-3449-baec-bf3950972574.jpg" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 129.9 KB</p>
</li>
<li><p><a href="http://dl2.iteye.com/upload/attachment/0081/6050/d0f2cbd9-fd23-3bcf-8ccb-ff032c31f3c7.jpg" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 84.7 KB</p>
</li>
<li><p><a href="http://dl2.iteye.com/upload/attachment/0081/6052/513c14f3-7257-35ef-9fee-7fc6465be432.jpg" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 137.2 KB</p>
</li>
<li><p><a href="http://dl2.iteye.com/upload/attachment/0081/6054/dc6a4056-e2a7-361f-9c2e-d5600869f21f.jpg" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 94.7 KB</p>
</li>
<li><p><a href="http://dl2.iteye.com/upload/attachment/0081/6056/9b27e97c-15be-3f13-adf6-b16ca1c05440.jpg" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 105.1 KB</p>
</li>
<li><p><a href="http://dl2.iteye.com/upload/attachment/0081/6058/a3409e43-62cf-33fb-9aad-fc215e99813a.jpg" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 259.4 KB</p>
</li>
<li><p><a href="http://dl2.iteye.com/upload/attachment/0081/6060/a2065747-f46f-3aeb-8e21-5ceceb9bde3a.jpg" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 269 KB</p>
</li>
<li><p><a href="http://zz563143188.iteye.com/blog/1829068#" target="_blank">查看图片附件</a></p>
</li>
</ul>
<p><strong>3</strong>
顶</p>
<p><strong>1</strong>
踩</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/网上资料url集/">网上资料url集</a></li></span></span> | <span class="tags">Tagged <a href="/tags/网上资料url集/" class="label label-primary">网上资料url集</a></span> | <span class="time">recent updated:<time title="2014-03-26 21:02:43"datetime="2014-03-26 21:02:43"> mar. 26 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-PowerDesinger逆向数据库物理模型及关系图/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-PowerDesinger逆向数据库物理模型及关系图" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-Nosql--8种Nosql数据库系统对比/">8种Nosql数据库系统对比</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:32.000Z"> <a href="/2014/02/02/2014-02-02-Nosql--8种Nosql数据库系统对比/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="8-nosql-">8种Nosql数据库系统对比</h1>
<p>导读：Kristóf Kovács 是一位软件架构师和咨询顾问，他最近发布了一片对比各种类型<a href="http://blog.jobbole.com/1344/" title="8种Nosql数据库系统对比" target="_blank">nosql数据库</a>的文章。</p>
<p>虽然SQL数据库是非常有用的工具，但经历了15年的一支独秀之后垄断即将被打破。这只是时间问题：被迫使用关系数据库，但最终发现不能适应需求的情况不胜枚举。</p>
<p>但是<a href="http://blog.jobbole.com/1344/" title="8种Nosql数据库系统对比" target="_blank">NoSQL</a>数据库之间的不同，远超过两 SQL数据库之间的差别。这意味着软件架构师更应该在项目开始时就选择好一个适合的 NoSQL数据库。针对这种情况，这里对<a href="http://cassandra.apache.org/" target="_blank">Cassandra</a>、<a href="http://www.mongodb.org/" target="_blank">Mongodb</a>、<a href="http://couchdb.apache.org/" target="_blank">CouchDB</a>、<a href="http://redis.io/" target="_blank">Redis</a>、 <a href="http://www.basho.com/Riak.html" target="_blank">Riak</a>、<a href="http://www.couchbase.org/membase" target="_blank">Membase</a>、<a href="http://neo4j.org/" target="_blank">Neo4j</a> 和 <a href="http://hbase.apache.org/" target="_blank">HBase</a> 进行了比较：</p>
<p>（编注1：NoSQL：是一项全新的数据库革命性运动，NoSQL的拥护者们提倡运用非关系型的数据存储。现今的计算机体系结构在数据存储方面要求具 备庞大的水平扩 展性，而NoSQL致力于改变这一现状。目前Google的 BigTable 和Amazon 的Dynamo使用的就是NoSQL型数据库。 参见<a href="http://zh.wikipedia.org/zh/NoSQL" target="_blank">NoSQL词条</a>。）</p>
<p><strong>1. CouchDB</strong></p>
<ul>
<li>所用语言： Erlang</li>
<li>特点：DB一致性，易于使用</li>
<li>使用许可： Apache</li>
<li>协议： HTTP/REST</li>
<li>双向数据复制，</li>
<li>持续进行或临时处理，</li>
<li>处理时带冲突检查，</li>
<li>因此，采用的是master-master复制（见编注2）</li>
<li>MVCC – 写操作不阻塞读操作</li>
<li>可保存文件之前的版本</li>
<li>Crash-only（可靠的）设计</li>
<li>需要不时地进行数据压缩</li>
<li>视图：嵌入式 映射/减少</li>
<li>格式化视图：列表显示</li>
<li>支持进行服务器端文档验证</li>
<li>支持认证</li>
<li>根据变化实时更新</li>
<li>支持附件处理</li>
<li>因此， CouchApps（独立的 js应用程序）</li>
<li>需要 jQuery程序库</li>
</ul>
<p><strong>最佳应用场景：</strong>适用于数据变化较少，执行预定义查询，进行数据统计的应用程序。适用于需要提供数据版本支持的应用程序。</p>
<p><strong>例如：</strong> CRM、CMS系统。 master-master复制对于多站点部署是非常有用的。</p>
<p>（编注2：master-master复制：是一种数据库同步方法，允许数据在一组计算机之间共享数据，并且可以通过小组中任意成员在组内进行数据更新。）</p>
<p><strong>2. Redis</strong></p>
<ul>
<li>所用语言：C/C++</li>
<li>特点：运行异常快</li>
<li>使用许可： BSD</li>
<li>协议：类 Telnet</li>
<li>有硬盘存储支持的内存数据库，</li>
<li>但自2.0版本以后可以将数据交换到硬盘（注意， 2.4以后版本不支持该特性！）</li>
<li>Master-slave复制（见编注3）</li>
<li>虽然采用简单数据或以键值索引的哈希表，但也支持复杂操作，例如 ZREVRANGEBYSCORE。</li>
<li>INCR &amp; co （适合计算极限值或统计数据）</li>
<li>支持 sets（同时也支持 union/diff/inter）</li>
<li>支持列表（同时也支持队列；阻塞式 pop操作）</li>
<li>支持哈希表（带有多个域的对象）</li>
<li>支持排序 sets（高得分表，适用于范围查询）</li>
<li>Redis支持事务</li>
<li>支持将数据设置成过期数据（类似快速缓冲区设计）</li>
<li>Pub/Sub允许用户实现消息机制</li>
</ul>
<p><strong>最佳应用场景：</strong>适用于数据变化快且数据库大小可遇见（适合内存容量）的应用程序。</p>
<p><strong>例如：</strong>股票价格、数据分析、实时数据搜集、实时通讯。</p>
<p>（编注3：Master-slave复制：如果同一时刻只有一台服务器处理所有的复制请求，这被称为 Master-slave复制，通常应用在需要提供高可用性的服务器集群。）</p>
<p><strong>3. MongoDB</strong></p>
<ul>
<li>所用语言：C++</li>
<li>特点：保留了SQL一些友好的特性（查询，索引）。</li>
<li>使用许可： AGPL（发起者： Apache）</li>
<li>协议： Custom, binary（ BSON）</li>
<li>Master/slave复制（支持自动错误恢复，使用 sets 复制）</li>
<li>内建分片机制</li>
<li>支持 javascript表达式查询</li>
<li>可在服务器端执行任意的 javascript函数</li>
<li>update-in-place支持比CouchDB更好</li>
<li>在数据存储时采用内存到文件映射</li>
<li>对性能的关注超过对功能的要求</li>
<li>建议最好打开日志功能（参数 –journal）</li>
<li>在32位操作系统上，数据库大小限制在约2.5Gb</li>
<li>空数据库大约占 192Mb</li>
<li>采用 GridFS存储大数据或元数据（不是真正的文件系统）</li>
</ul>
<p><strong>最佳应用场景：</strong>适用于需要动态查询支持；需要使用索引而不是 map/reduce功能；需要对大数据库有性能要求；需要使用 CouchDB但因为数据改变太频繁而占满内存的应用程序。</p>
<p><strong>例如：</strong>你本打算采用 MySQL或 PostgreSQL，但因为它们本身自带的预定义栏让你望而却步。</p>
<p><strong>4. Riak</strong></p>
<ul>
<li>所用语言：Erlang和C，以及一些Javascript</li>
<li>特点：具备容错能力</li>
<li>使用许可： Apache</li>
<li>协议： HTTP/REST或者 custom binary</li>
<li>可调节的分发及复制(N, R, W)</li>
<li>用 JavaScript or Erlang在操作前或操作后进行验证和安全支持。</li>
<li>使用JavaScript或Erlang进行 Map/reduce</li>
<li>连接及连接遍历：可作为图形数据库使用</li>
<li>索引：输入元数据进行搜索（1.0版本即将支持）</li>
<li>大数据对象支持（ Luwak）</li>
<li>提供“开源”和“企业”两个版本</li>
<li>全文本搜索，索引，通过 Riak搜索服务器查询（ beta版）</li>
<li>支持Masterless多站点复制及商业许可的 SNMP监控</li>
</ul>
<p><strong>最佳应用场景：</strong>适用于想使用类似 Cassandra（类似Dynamo）数据库但无法处理 bloat及复杂性的情况。适用于你打算做多站点复制，但又需要对单个站点的扩展性，可用性及出错处理有要求的情况。</p>
<p>例如：销售数据搜集，工厂控制系统；对宕机时间有严格要求；可以作为易于更新的 web服务器使用。</p>
<p><strong>5. Membase</strong></p>
<ul>
<li>所用语言： Erlang和C</li>
<li>特点：兼容 Memcache，但同时兼具持久化和支持集群</li>
<li>使用许可： Apache 2.0</li>
<li>协议：分布式缓存及扩展</li>
<li>非常快速（200k+/秒），通过键值索引数据</li>
<li>可持久化存储到硬盘</li>
<li>所有节点都是唯一的（ master-master复制）</li>
<li>在内存中同样支持类似分布式缓存的缓存单元</li>
<li>写数据时通过去除重复数据来减少 IO</li>
<li>提供非常好的集群管理 web界面</li>
<li>更新软件时软无需停止数据库服务</li>
<li>支持连接池和多路复用的连接代理</li>
</ul>
<p><strong>最佳应用场景：</strong>适用于需要低延迟数据访问，高并发支持以及高可用性的应用程序</p>
<p>例如：低延迟数据访问比如以广告为目标的应用，高并发的 web 应用比如网络游戏（例如 Zynga）</p>
<p><strong>6. Neo4j</strong></p>
<ul>
<li>所用语言： Java</li>
<li>特点：基于关系的图形数据库</li>
<li>使用许可： GPL，其中一些特性使用 AGPL/商业许可</li>
<li>协议： HTTP/REST（或嵌入在 Java中）</li>
<li>可独立使用或嵌入到 Java应用程序</li>
<li>图形的节点和边都可以带有元数据</li>
<li>很好的自带web管理功能</li>
<li>使用多种算法支持路径搜索</li>
<li>使用键值和关系进行索引</li>
<li>为读操作进行优化</li>
<li>支持事务（用 Java api）</li>
<li>使用 Gremlin图形遍历语言</li>
<li>支持 Groovy脚本</li>
<li>支持在线备份，高级监控及高可靠性支持使用 AGPL/商业许可</li>
</ul>
<p><strong>最佳应用场景：</strong>适用于图形一类数据。这是 Neo4j与其他nosql数据库的最显著区别</p>
<p>例如：社会关系，公共交通网络，地图及网络拓谱</p>
<p><strong>7. Cassandra</strong></p>
<ul>
<li>所用语言： Java</li>
<li>特点：对大型表格和 Dynamo支持得最好</li>
<li>使用许可： Apache</li>
<li>协议： Custom, binary (节约型)</li>
<li>可调节的分发及复制(N, R, W)</li>
<li>支持以某个范围的键值通过列查询</li>
<li>类似大表格的功能：列，某个特性的列集合</li>
<li>写操作比读操作更快</li>
<li>基于 Apache分布式平台尽可能地 Map/reduce</li>
<li>我承认对 Cassandra有偏见，一部分是因为它本身的臃肿和复杂性，也因为 Java的问题（配置，出现异常，等等）</li>
</ul>
<p><strong>最佳应用场景：</strong>当使用写操作多过读操作（记录日志）如果每个系统组建都必须用 Java编写（没有人因为选用 Apache的软件被解雇）</p>
<p>例如：银行业，金融业（虽然对于金融交易不是必须的，但这些产业对数据库的要求会比它们更大）写比读更快，所以一个自然的特性就是实时数据分析</p>
<p><strong>8. HBase</strong></p>
<p>（配合 ghshephard使用）</p>
<ul>
<li>所用语言： Java</li>
<li>特点：支持数十亿行X上百万列</li>
<li>使用许可： Apache</li>
<li>协议：HTTP/REST （支持 <a href="http://www.jobbole.com/entry.php/73" target="_blank">Thrift</a>，见编注4）</li>
<li>在 BigTable之后建模</li>
<li>采用分布式架构 Map/reduce</li>
<li>对实时查询进行优化</li>
<li>高性能 Thrift网关</li>
<li>通过在server端扫描及过滤实现对查询操作预判</li>
<li>支持 XML, Protobuf, 和binary的HTTP</li>
<li>Cascading, hive, and pig source and sink modules</li>
<li>基于 Jruby（ JIRB）的shell</li>
<li>对配置改变和较小的升级都会重新回滚</li>
<li>不会出现单点故障</li>
<li>堪比MySQL的随机访问性能</li>
</ul>
<p><strong>最佳应用场景：</strong>适用于偏好BigTable:)并且需要对大数据进行随机、实时访问的场合。</p>
<p>例如： Facebook消息数据库（更多通用的用例即将出现）</p>
<p>编注4：Thrift 是一种接口定义语言，为多种其他语言提供定义和创建服务，<a href="http://blog.jobbole.com/73/" target="_blank">由Facebook开发并开源</a>。</p>
<p>当然，所有的系统都不只具有上面列出的这些特性。这里我仅仅根据自己的观点列出一些我认为的重要特性。与此同时，技术进步是飞速的，所以上述的内容肯定需要不断更新。我会尽我所能地更新这个列表。
来源： <a href="[http://blog.jobbole.com/1344/](http://blog.jobbole.com/1344/)">[http://blog.jobbole.com/1344/](http://blog.jobbole.com/1344/)</a> </p>
<h1 id="-cassandra-vs-mongodb-vs-couchdb-vs-redis-vs-riak-vs-hbase-vs-couchbase-vs-neo4j-vs-hypertable-vs-elasticsearch-vs-accumulo-vs-voltdb-vs-scalaris-comparison"><strong>Cassandra</strong> vs <strong>MongoDB</strong> vs <strong>CouchDB</strong> vs <strong>Redis</strong> vs <strong>Riak</strong> vs<strong>HBase</strong> vs <strong>Couchbase</strong> vs <strong>Neo4j</strong> vs <strong>Hypertable</strong> vs<strong>ElasticSearch</strong> vs <strong>Accumulo</strong> vs <strong>VoltDB</strong> vs <strong>Scalaris</strong>comparison</h1>
<p>(Yes it&#39;s a long title, since people kept asking me to write about this and that too :) I do when it has a point.)</p>
<p>While SQL databases are insanely useful tools, their monopoly in the last decades is coming to an end. And it&#39;s just time: I can&#39;t even count the things that were forced into relational databases, but never really fitted them. (That being said, relational databases will always be the best for the stuff that has relations.)</p>
<p>But, the differences between NoSQL databases are much bigger than ever was between one SQL database and another. This means that it is a bigger responsibility on <a href="http://kkovacs.eu/resume" target="_blank">software architects</a> to choose the appropriate one for a project right at the beginning.</p>
<p>In this light, here is a comparison of <a href="http://cassandra.apache.org/" target="_blank">Cassandra</a>, <a href="http://www.mongodb.org/" target="_blank">Mongodb</a>, <a href="http://couchdb.apache.org/" target="_blank">CouchDB</a>, <a href="http://redis.io/" target="_blank">Redis</a>, <a href="http://basho.com/riak/" target="_blank">Riak</a>, <a href="http://www.couchbase.org/membase" target="_blank">Couchbase (ex-Membase)</a>, <a href="http://hypertable.org/" target="_blank">Hypertable</a>, <a href="http://www.elasticsearch.org/" target="_blank">ElasticSearch</a>, <a href="http://accumulo.apache.org/" target="_blank">Accumulo</a>, <a href="http://voltdb.com/" target="_blank">VoltDB</a>, <a href="http://fallabs.com/kyototycoon/" target="_blank">Kyoto Tycoon</a>, <a href="https://code.google.com/p/scalaris/" target="_blank">Scalaris</a>, <a href="http://neo4j.org/" target="_blank">Neo4j</a> and <a href="http://hbase.apache.org/" target="_blank">HBase</a>:</p>
<h3 id="the-most-popular-ones">The most popular ones</h3>
<h2 id="mongodb-2-2-">MongoDB (2.2)</h2>
<ul>
<li><strong>Written in:</strong> C++</li>
<li><strong>Main point:</strong> Retains some friendly properties of SQL. (Query, index)</li>
<li><strong>License:</strong> AGPL (Drivers: Apache)</li>
<li><strong>Protocol:</strong> Custom, binary (BSON)</li>
<li>Master/slave replication (auto failover with replica sets)</li>
<li>Sharding built-in</li>
<li>Queries are javascript expressions</li>
<li>Run arbitrary javascript functions server-side</li>
<li>Better update-in-place than CouchDB</li>
<li>Uses memory mapped files for data storage</li>
<li>Performance over features</li>
<li>Journaling (with --journal) is best turned on</li>
<li>On 32bit systems, limited to ~2.5Gb</li>
<li>An empty database takes up 192Mb</li>
<li>GridFS to store big data + metadata (not actually an FS)</li>
<li>Has geospatial indexing</li>
<li>Data center aware</li>
</ul>
<p><strong>Best used:</strong> If you need dynamic queries. If you prefer to define indexes, not map/reduce functions. If you need good performance on a big DB. If you wanted CouchDB, but your data changes too much, filling up disks.</p>
<p><strong>For example:</strong> For most things that you would do with MySQL or PostgreSQL, but having predefined columns really holds you back.</p>
<h2 id="riak-v1-2-">Riak (V1.2)</h2>
<ul>
<li><strong>Written in:</strong> Erlang &amp; C, some JavaScript</li>
<li><strong>Main point:</strong> Fault tolerance</li>
<li><strong>License:</strong> Apache</li>
<li><strong>Protocol:</strong> HTTP/REST or custom binary</li>
<li>Stores blobs</li>
<li>Tunable trade-offs for distribution and replication</li>
<li>Pre- and post-commit hooks in JavaScript or Erlang, for validation and security.</li>
<li>Map/reduce in JavaScript or Erlang</li>
<li>Links &amp; link walking: use it as a graph database</li>
<li>Secondary indices: but only one at once</li>
<li>Large object support (Luwak)</li>
<li>Comes in &quot;open source&quot; and &quot;enterprise&quot; editions</li>
<li>Full-text search, indexing, querying with Riak Search</li>
<li>In the process of migrating the storing backend from &quot;Bitcask&quot; to Google&#39;s &quot;LevelDB&quot;</li>
<li>Masterless multi-site replication replication and SNMP monitoring are commercially licensed</li>
</ul>
<p><strong>Best used:</strong> If you want something Dynamo-like data storage, but no way you&#39;re gonna deal with the bloat and complexity. If you need very good single-site scalability, availability and fault-tolerance, but you&#39;re ready to pay for multi-site replication.</p>
<p><strong>For example:</strong> Point-of-sales data collection. Factory control systems. Places where even seconds of downtime hurt. Could be used as a well-update-able web server.</p>
<h2 id="couchdb-v1-2-">CouchDB (V1.2)</h2>
<ul>
<li><strong>Written in:</strong> Erlang</li>
<li><strong>Main point:</strong> DB consistency, ease of use</li>
<li><strong>License:</strong> Apache</li>
<li><strong>Protocol:</strong> HTTP/REST</li>
<li>Bi-directional (!) replication,</li>
<li>continuous or ad-hoc,</li>
<li>with conflict detection,</li>
<li>thus, master-master replication. (!)</li>
<li>MVCC - write operations do not block reads</li>
<li>Previous versions of documents are available</li>
<li>Crash-only (reliable) design</li>
<li>Needs compacting from time to time</li>
<li>Views: embedded map/reduce</li>
<li>Formatting views: lists &amp; shows</li>
<li>Server-side document validation possible</li>
<li>Authentication possible</li>
<li>Real-time updates via &#39;_changes&#39; (!)</li>
<li>Attachment handling</li>
<li>thus, <a href="http://couchapp.org/" target="_blank">CouchApps</a> (standalone js apps)</li>
</ul>
<p><strong>Best used:</strong> For accumulating, occasionally changing data, on which pre-defined queries are to be run. Places where versioning is important.</p>
<p><strong>For example:</strong> CRM, CMS systems. Master-master replication is an especially interesting feature, allowing easy multi-site deployments.</p>
<h2 id="redis-v2-4-">Redis (V2.4)</h2>
<ul>
<li><strong>Written in:</strong> C/C++</li>
<li><strong>Main point:</strong> Blazing fast</li>
<li><strong>License:</strong> BSD</li>
<li><strong>Protocol:</strong> Telnet-like</li>
<li>Disk-backed in-memory database,</li>
<li>Currently without disk-swap (VM and Diskstore were abandoned)</li>
<li>Master-slave replication</li>
<li>Simple values or hash tables by keys,</li>
<li>but <a href="http://redis.io/commands" target="_blank">complex operations</a> like ZREVRANGEBYSCORE.</li>
<li>INCR &amp; co (good for rate limiting or statistics)</li>
<li>Has sets (also union/diff/inter)</li>
<li>Has lists (also a queue; blocking pop)</li>
<li>Has hashes (objects of multiple fields)</li>
<li>Sorted sets (high score table, good for range queries)</li>
<li>Redis has transactions (!)</li>
<li>Values can be set to expire (as in a cache)</li>
<li>Pub/Sub lets one implement messaging (!)</li>
</ul>
<p><strong>Best used:</strong> For rapidly changing data with a foreseeable database size (should fit mostly in memory).</p>
<p><strong>For example:</strong> Stock prices. Analytics. Real-time data collection. Real-time communication. And wherever you used memcached before.</p>
<h3 id="clones-of-google-s-bigtable">Clones of Google&#39;s Bigtable</h3>
<h2 id="hbase-v0-92-0-">HBase (V0.92.0)</h2>
<ul>
<li><strong>Written in:</strong> Java</li>
<li><strong>Main point:</strong> Billions of rows X millions of columns</li>
<li><strong>License:</strong> Apache</li>
<li><strong>Protocol:</strong> HTTP/REST (also Thrift)</li>
<li>Modeled after Google&#39;s BigTable</li>
<li>Uses Hadoop&#39;s HDFS as storage</li>
<li>Map/reduce with Hadoop</li>
<li>Query predicate push down via server side scan and get filters</li>
<li>Optimizations for real time queries</li>
<li>A high performance Thrift gateway</li>
<li>HTTP supports XML, Protobuf, and binary</li>
<li>Jruby-based (JIRB) shell</li>
<li>Rolling restart for configuration changes and minor upgrades</li>
<li>Random access performance is like MySQL</li>
<li>A cluster consists of several different types of nodes</li>
</ul>
<p><strong>Best used:</strong> Hadoop is probably still the best way to run Map/Reduce jobs on huge datasets. Best if you use the Hadoop/HDFS stack already.</p>
<p><strong>For example:</strong> Search engines. Analysing log data. Any place where scanning huge, two-dimensional join-less tables are a requirement.</p>
<h2 id="cassandra-1-2-">Cassandra (1.2)</h2>
<ul>
<li><strong>Written in:</strong> Java</li>
<li><strong>Main point:</strong> Best of BigTable and Dynamo</li>
<li><strong>License:</strong> Apache</li>
<li><strong>Protocol:</strong> Thrift &amp; custom binary CQL3</li>
<li>Tunable trade-offs for distribution and replication (N, R, W)</li>
<li>Querying by column, range of keys (Requires indices on anything that you want to search on)</li>
<li>BigTable-like features: columns, column families</li>
<li>Can be used as a distributed hash-table, with an &quot;SQL-like&quot; language, CQL (but no JOIN!)</li>
<li>Data can have expiration (set on INSERT)</li>
<li>Writes can be much faster than reads (when reads are disk-bound)</li>
<li>Map/reduce possible with Apache Hadoop</li>
<li>All nodes are similar, as opposed to Hadoop/HBase</li>
<li>Cross-datacenter replication</li>
</ul>
<p><strong>Best used:</strong> When you write more than you read (logging). If every component of the system must be in Java. (&quot;No one gets fired for choosing Apache&#39;s stuff.&quot;)</p>
<p><strong>For example:</strong> Banking, financial industry (though not necessarily for financial transactions, but these industries are much bigger than that.) Writes are faster than reads, so one natural niche is data analysis.</p>
<h2 id="hypertable-0-9-6-5-">Hypertable (0.9.6.5)</h2>
<ul>
<li><strong>Written in:</strong> C++</li>
<li><strong>Main point:</strong> A faster, smaller HBase</li>
<li><strong>License:</strong> GPL 2.0</li>
<li><strong>Protocol:</strong> Thrift, C++ library, or HQL shell</li>
<li>Implements Google&#39;s BigTable design</li>
<li>Run on Hadoop&#39;s HDFS</li>
<li>Uses its own, &quot;SQL-like&quot; language, HQL</li>
<li>Can search by key, by cell, or for values in column families.</li>
<li>Search can be limited to key/column ranges.</li>
<li>Sponsored by Baidu</li>
<li>Retains the last N historical values</li>
<li>Tables are in namespaces</li>
<li>Map/reduce with Hadoop</li>
</ul>
<p><strong>Best used:</strong> If you need a better HBase.</p>
<p><strong>For example:</strong> Same as HBase, since it&#39;s basically a replacement: Search engines. Analysing log data. Any place where scanning huge, two-dimensional join-less tables are a requirement.</p>
<h2 id="accumulo-1-4-">Accumulo (1.4)</h2>
<ul>
<li><strong>Written in:</strong> Java and C++</li>
<li><strong>Main point:</strong> A BigTable with Cell-level security</li>
<li><strong>License:</strong> Apache</li>
<li><strong>Protocol:</strong> Thrift</li>
<li>Another BigTable clone, also runs of top of Hadoop</li>
<li>Cell-level security</li>
<li>Bigger rows than memory are allowed</li>
<li>Keeps a memory map outside Java, in C++ STL</li>
<li>Map/reduce using Hadoop&#39;s facitlities (ZooKeeper &amp; co)</li>
<li>Some server-side programming</li>
</ul>
<p><strong>Best used:</strong> If you need a different HBase.</p>
<p><strong>For example:</strong> Same as HBase, since it&#39;s basically a replacement: Search engines. Analysing log data. Any place where scanning huge, two-dimensional join-less tables are a requirement.</p>
<h3 id="special-purpose">Special-purpose</h3>
<h2 id="neo4j-v1-5m02-">Neo4j (V1.5M02)</h2>
<ul>
<li><strong>Written in:</strong> Java</li>
<li><strong>Main point:</strong> Graph database - connected data</li>
<li><strong>License:</strong> GPL, some features AGPL/commercial</li>
<li><strong>Protocol:</strong> HTTP/REST (or embedding in Java)</li>
<li>Standalone, or embeddable into Java applications</li>
<li>Full ACID conformity (including durable data)</li>
<li>Both nodes and relationships can have metadata</li>
<li>Integrated pattern-matching-based query language (&quot;Cypher&quot;)</li>
<li>Also the &quot;Gremlin&quot; graph traversal language can be used</li>
<li>Indexing of nodes and relationships</li>
<li>Nice self-contained web admin</li>
<li>Advanced path-finding with multiple algorithms</li>
<li>Indexing of keys and relationships</li>
<li>Optimized for reads</li>
<li>Has transactions (in the Java API)</li>
<li>Scriptable in Groovy</li>
<li>Online backup, advanced monitoring and High Availability is AGPL/commercial licensed</li>
</ul>
<p><strong>Best used:</strong> For graph-style, rich or complex, interconnected data. Neo4j is quite different from the others in this sense.</p>
<p><strong>For example:</strong> For searching routes in social relations, public transport links, road maps, or network topologies.</p>
<h2 id="elasticsearch-0-20-1-">ElasticSearch (0.20.1)</h2>
<ul>
<li><strong>Written in:</strong> Java</li>
<li><strong>Main point:</strong> Advanced Search</li>
<li><strong>License:</strong> Apache</li>
<li><strong>Protocol:</strong> JSON over HTTP (Plugins: Thrift, memcached)</li>
<li>Stores JSON documents</li>
<li>Has versioning</li>
<li>Parent and children documents</li>
<li>Documents can time out</li>
<li>Very versatile and sophisticated querying, scriptable</li>
<li>Write consistency: one, quorum or all</li>
<li>Sorting by score (!)</li>
<li>Geo distance sorting</li>
<li>Fuzzy searches (approximate date, etc) (!)</li>
<li>Asynchronous replication</li>
<li>Atomic, scripted updates (good for counters, etc)</li>
<li>Can maintain automatic &quot;stats groups&quot; (good for debugging)</li>
<li>Still depends very much on only one developer (kimchy).</li>
</ul>
<p><strong>Best used:</strong> When you have objects with (flexible) fields, and you need &quot;advanced search&quot; functionality.</p>
<p><strong>For example:</strong> A dating service that handles age difference, geographic location, tastes and dislikes, etc. Or a leaderboard system that depends on many variables.</p>
<h3 id="the-long-tail-">The &quot;long tail&quot;</h3>
<p>(Not widely known, but definitely worthy ones)</p>
<h2 id="couchbase-ex-membase-2-0-">Couchbase (ex-Membase) (2.0)</h2>
<ul>
<li><strong>Written in:</strong> Erlang &amp; C</li>
<li><strong>Main point:</strong> Memcache compatible, but with persistence and clustering</li>
<li><strong>License:</strong> Apache</li>
<li><strong>Protocol:</strong> memcached + extensions</li>
<li>Very fast (200k+/sec) access of data by key</li>
<li>Persistence to disk</li>
<li>All nodes are identical (master-master replication)</li>
<li>Provides memcached-style in-memory caching buckets, too</li>
<li>Write de-duplication to reduce IO</li>
<li>Friendly cluster-management web GUI</li>
<li>Connection proxy for connection pooling and multiplexing (Moxi)</li>
<li>Incremental map/reduce</li>
<li>Cross-datacenter replication</li>
</ul>
<p><strong>Best used:</strong> Any application where low-latency data access, high concurrency support and high availability is a requirement.</p>
<p><strong>For example:</strong> Low-latency use-cases like ad targeting or highly-concurrent web apps like online gaming (e.g. Zynga).</p>
<h2 id="scalaris-0-5-">Scalaris (0.5)</h2>
<ul>
<li><strong>Written in:</strong> Erlang</li>
<li><strong>Main point:</strong> Distributed P2P key-value store</li>
<li><strong>License:</strong> Apache</li>
<li><strong>Protocol:</strong> Proprietary &amp; JSON-RPC</li>
<li>In-memory (disk when using Tokyo Cabinet as a backend)</li>
<li>Uses YAWS as a web server</li>
<li>Has transactions (an adapted Paxos commit)</li>
<li>Consistent, distributed write operations</li>
<li>From CAP, values Consistency over Availability (in case of network partitioning, only the bigger partition works)</li>
</ul>
<p><strong>Best used:</strong> If you like Erlang and wanted to use Mnesia or DETS or ETS, but you need something that is accessible from more languages (and scales much better than ETS or DETS).</p>
<p><strong>For example:</strong> In an Erlang-based system when you want to give access to the DB to Python, Ruby or Java programmers.</p>
<h2 id="voltdb-2-8-4-1-">VoltDB (2.8.4.1)</h2>
<ul>
<li><strong>Written in:</strong> Java</li>
<li><strong>Main point:</strong> Fast transactions and repidly changing data</li>
<li><strong>License:</strong> GPL 3</li>
<li><strong>Protocol:</strong> Proprietary</li>
<li>In-memory <strong>relational</strong> database.</li>
<li>Can export data into Hadoop</li>
<li>Supports ANSI SQL</li>
<li>Stored procedures in Java</li>
<li>Cross-datacenter replication</li>
</ul>
<p><strong>Best used:</strong> Where you need to act fast on massive amounts of incoming data.</p>
<p><strong>For example:</strong> Point-of-sales data analysis. Factory control systems.</p>
<h2 id="kyoto-tycoon-0-9-56-">Kyoto Tycoon (0.9.56)</h2>
<ul>
<li><strong>Written in:</strong> C++</li>
<li><strong>Main point:</strong> A lightweight network DBM</li>
<li><strong>License:</strong> GPL</li>
<li><strong>Protocol:</strong> HTTP (TSV-RPC or REST)</li>
<li>Based on Kyoto Cabinet, Tokyo Cabinet&#39;s successor</li>
<li>Multitudes of storage backends: Hash, Tree, Dir, etc (everything from Kyoto Cabinet)</li>
<li>Kyoto Cabinet can do 1M+ insert/select operations per sec (but Tycoon does less because of overhead)</li>
<li>Lua on the server side</li>
<li>Language bindings for C, Java, Python, Ruby, Perl, Lua, etc</li>
<li>Uses the &quot;visitor&quot; pattern</li>
<li>Hot backup, asynchronous replication</li>
<li>background snapshot of in-memory databases</li>
<li>Auto expiration (can be used as a cache server)</li>
</ul>
<p><strong>Best used:</strong> When you want to choose the backend storage algorithm engine very precisely. When speed is of the essence.</p>
<p><strong>For example:</strong> Caching server. Stock prices. Analytics. Real-time data collection. Real-time communication. And wherever you used memcached before.</p>
<p>Of course, all these systems have much more features than what&#39;s listed here. I only wanted to list the key points that I base my decisions on. Also, development of all are very fast, so things are bound to change.
来源： <a href="[http://kkovacs.eu/cassandra-vs-mongodb-vs-couchdb-vs-redis](http://kkovacs.eu/cassandra-vs-mongodb-vs-couchdb-vs-redis)">[http://kkovacs.eu/cassandra-vs-mongodb-vs-couchdb-vs-redis](http://kkovacs.eu/cassandra-vs-mongodb-vs-couchdb-vs-redis)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Nosql/">Nosql</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Nosql/" class="label label-primary">Nosql</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:32"datetime="2014-03-07 09:54:32"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-Nosql--8种Nosql数据库系统对比/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-Nosql--8种Nosql数据库系统对比" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-百万级访问网站前期的技术准备/">百万级访问网站前期的技术准备 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:32.000Z"> <a href="/2014/02/02/2014-02-02-百万级访问网站前期的技术准备/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h3 id="-"><a href="">百万级访问网站前期的技术准备</a> **</h3>
<p><strong>博客分类：</strong></p>
<ul>
<li><a href="http://zz563143188.iteye.com/category/269712" target="_blank">web</a>
<a href="http://www.iteye.com/blogs/tag/%E7%99%BE%E4%B8%87%E7%BA%A7%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99%E5%89%8D%E6%9C%9F%E7%9A%84%E6%8A%80%E6%9C%AF%E5%87%86%E5%A4%87" target="_blank">百万级访问网站前期的技术准备</a></li>
</ul>
<p>开了自己域名的博客，第一篇就得来个重磅一点的才对得起这4美金的域名。作为一个技术从业者十年，逛了十年发现有些知识东一榔头西一棒槌的得满世界 看个遍才整理出个头绪，那咱就系统点的从头一步一步的说，一个从日几千访问的小小网站，到日访问一两百万的小网站，怎么才能让它平滑的度过这个阶段，别在 技术上出现先天不足，写给一些技术人员，也写给不懂技术的创业者。
对互联网有了解的人都有自己的想法，有人就把想法付诸实现，做个网站然后开始运营。其实从纯网站技术上来说，因为开源模式的发展，现在建一个小网站 已经很简单也很便宜。当访问量到达一定数量级的时候成本就开始飙升了，问题也开始显现了。因为带宽的增加、硬件的扩展、人员的扩张所带来的成本提高是显而 易见的，而还有相当大的一部分成本是因为代码重构、架构重构，甚至底层开发语言更换引起的，最惨的就是数据丢失，辛辛苦苦好几年，一夜回到创业前。
减少成本就是增加利润。很多事情，我们在一开始就可以避免，先打好基础，往后可以省很多精力，少操很多心。
假设你是一个参与创业的技术人员，当前一穷二白，什么都要自己做，自己出钱，初期几十万的资金，做一个应用不是特别复杂的网站，那么就要注意以下几点：
一、开发语言
一般来说，技术人员（程序员）创业都是根据自己技术背景选择自己最熟悉的语言，不过考虑到不可能永远是您一个人写程序，这点还得仔细想想。无论用什么语言，最终代码质量是看管理，所以我们还是从纯语言层面来说实际一点。现在流行的java、php、.net、python、ruby都 有自己的优劣，python和ruby，现在人员还是相对难招一些，性能优化也会费些力气，.net平台买不起windows server。java、php用的还是最多。对于初期，应用几乎都是靠前端支撑的网站来说，php的优势稍大一些，入门简单、设计模式简单、写起来快、 性能足够等，不过不注重设计模式也是它的劣势，容易变得松散，隐藏bug稍多、难以维护。java的优势在于整套管理流程已经有很多成熟工具来辅助，强类 型也能避免一些弱智BUG，大多数JAVA程序员比较注重设计模式，别管实不实际，代码格式看起来还是不错的。这也是个劣势，初学者可能太注重模式而很难 解决实际需求。
前端不只是html、css这类。整个负责跟用户交互的部分都是前端，包括处理程序。这类程序还是建议用php，主要原因就是开发迅速、从业人员广泛。至于后端例如行为分析、银行接口、异步消息处理等，随便用什么程序，那个只能是根据不同业务需求来选择不同语言了。
二、代码版本管理
如果开发人员之间的网络速度差不多，就SVN；比较分散例如跨国，就hg。大多数人还是svn的.
假设选了svn，那么有几点考虑。一是采用什么树结构。初期可能只有一条主干，往后就需要建立分支，例如一条开发分支，一条上线分支，再往后，可能 要每个小组一个分支。建议一开始人少时选择两条分支，开发和线上，每个功能本地测试无误后提交到开发分支，最后统一测试，可以上线时合并到上线分支。如果 喜欢把svn当做移动硬盘用，写一点就commit一次也无所谓，就是合并的时候头大一些，这些人可以自己建个分支甚至建立个本地代码仓库，随便往自己的 分支提交，测试完毕后再提交到开发分支上。
部署，可以手工部署也可以自动部署。手工部署相对简单，一般是直接在服务器上svn update，或者找个新目录svn checkout，再把web root给ln -s过去。应用越复杂，部署越复杂，没有什么统一标准，只要别再用ftp上传那种形式就好，一是上传时文件引用不一致错误率增加，二是很容易出现开发人员 的版本跟线上版本不一致，导致本来想改个错字结果变成回滚的杯具。如果有多台服务器还是建议自动部署，更换代码的机器从当前服务池中临时撤出，更新完毕后 再重新加入。
不管项目多小，养成使用版本管理的好习惯，最起码还可以当做你的备份，我的 <a href="http://zhiyi.us" target="_blank">http://zhiyi.us</a> 虽然就是一个wordpress，可还是svn了，只改动一两句css那也是劳动成果。
三、服务器硬件
别羡慕大客户和有钱人，看看机房散户区，一台服务器孤独的支撑的网站数不清。如果资金稍微充足，建议至少三台的标准配置，分别用作web处理、数据 库、备份。web服务器至少要8G内存，双sata raid1，如果经济稍微宽松，或静态文件或图片多，则15k sas raid1+0。数据库至少16G内存，15k sas raid 1+0。备份服务器最好跟数据库服务器同等配置。硬件可以自己买品牌的底板，也就是机箱配主板和硬盘盒，CPU内存硬盘都自己配，也可以上整套品牌，也可 以兼容机。三台机器，市场行情6、7万也就配齐了。
web服务器可以既跑程序又当内存缓存，数据库服务器则只跑主数据库（假如是MySQL的话），备份服务器干的活就相对多一些，web配置、缓存配置、数据库配置都要跟前两台一致，这样WEB和数据库任意一台出问题，把备份服务器换个ip就切换上去了。备份策略，可以drbd，可以rsync，或者其他的很多很多的开源备份方案可选择。rsync最简单，放cron里自己跑就行。备份和切换，建议多做测试，选最安全最适合业务的，并且尽可能异地备份。
四、机房
三种机房尽量不要选：联通访问特别慢的电信机房、电信访问特别慢的联通机房、电信联通访问特别慢的移动或铁通机房。那网通机房呢？亲，网通联通N久 以前合并改叫联通了。多多寻找，实地参观，多多测试，多方打探，北京、上海、广州等各个主节点城市，还是有很多优质机房的，找个网络质量好，管理严格的机 房，特别是管理要严格，千万别网站无法访问了，打个电话过去才知道别人维护时把你网线碰掉了，这比DOS都头疼。自己扯了几根光纤就称为机房的，看您抗风 险程度和心理素质了。机房可以说是非常重要，直接关系到网站访问速度，网站访问速度直接关系到用户体验，我可以F墙看风景，但买个网游vpn才能打开你这 个还不怎么知名的网站就有难度了。或许您网站的ajax很出色，可是document怎么也不ready，一些代码永远绝缘于用户。
五、架构
初期架构一般比较简单，web负载均衡+数据库主从+缓存+分布式存储+队列。大方向上也确实就这几样东西，细节上也无数文章都重复过了，按照将来 会有N多WEB，N多主从关系，N多缓存，N多xxx设计就行，基本方案都是现成的，只是您比其他人厉害之处就在于设计上考虑到缓存失效时的雪崩效应、主 从同步的数据一致性和时间差、队列的稳定性和失败后的重试策略、文件存储的效率和备份方式等等意外情况。缓存总有一天会失效，数据库复制总有一天会断掉， 队列总有一天会写不进去，电源总有一天会烧坏。根据墨菲定律，如果不考虑这些，网站早晚会成为茶几。
六、服务器软件
Linux、nginx、php、mysql，几乎是标配，我们除了看名字，还得选版本。Linux发行版众多，只要没特殊要求，就选个用的人最多的，社区最活跃的，配置最方便的，软件包最全最新的，例如debian、ubuntu。 至于RHEL之类的嘛，你用只能在RHEL上才能运行的软件么？剩下的nginx、php、mysql、activemq、其他的等等，除非你改过这些软 件或你的程序真的不兼容新版本，否则尽量版本越新越好，版本新，意味着新特性增多、BUG减少、性能增加。总有些道听途说的人跟你说老的版本稳定。所谓稳 定，是相对于特殊业务来说的，而就一个php写的网站，大多数人都没改过任何服务器软件源代码，绝大多数情况是能平稳的升级到新版本的。类似于jdk5到 jdk6，python2到python3这类变动比较大的升级还是比较少见的。看看ChangeLog，看看升级说明，结合自己情况评估一下，越早升级 越好，别人家都用php6写程序了这边还php4的逛游呢。优秀的开源程序升级还是很负责任的，看好文档，别怕。
以上这六点准备完毕，现在我们有了运行环境，有了基本架构骨架，有了备份和切换方案，应该开始着手设计开发方面的事情了。开发方面的事情无数，下一篇会先说一些重点。
原文地址
七、数据库
几乎所有操作最后都要落到数据库身上，它又最难扩展（存储也挺难）。对于mysql，什么样的表用myisam，什么样的表用innodb，在开发 之前要确定。复制策略、分片策略，也要确定。表引擎方面，一般，更新不多、不需要事务的表可以用myisam，需要行锁定、事务支持的，用innodb。 myisam的锁表不一定是性能低下的根源，innodb也不一定全是行锁，具体细节要多看相关的文档，熟悉了引擎特性才能用的更好。现代WEB应用越来 越复杂了，我们设计表结构时常常设计很多冗余，虽然不符合传统范式，但为了速度考虑还是值得的，要求高的情况下甚至要杜绝联合查询。编程时得多注意数据一 致性。
复制策略方面，多主多从结构也最好一开始就设计好，代码直接按照多主多从来编写，用一些小技巧来避免复制延时问题，并且还要解决多数据库数据是否一致，可以自己写或者找现成的运维工具。
分片策略。总会有那么几个表数据量超大，这时分片必不可免。分片有很多策略，从简单的分区到根据热度自动调整，依照具体业务选择一个适合自己的。避免自增ID作为主键，不利于分片。
用存储过程是比较难扩展的，这种情形多发生于传统C/S，特别是OA系统转换过来的开发人员。低成本网站不是一两台小型机跑一个数据库处理所有业务的模式，是机海作战。方便水平扩展比那点预分析时间和网络传输流量要重要的多的多。
NoSQL。这只是一个概念。实际应用中，网站有着越来越多的密集写操作、上亿的简单关系数据读取、热备等，这都不是传统关系数据库所擅长的，于是 就产生了很多非关系型数据库，比如Redis/TC&amp;TT/MongoDB/Memcachedb等，在测试中，这些几乎都达到了每秒至少一万次 的写操作，内存型的甚至5万以上。例如MongoDB，几句配置就可以组建一个复制+自动分片+failover的环境，文档化的存储也简化了传统设计库 结构再开发的模式。很多业务是可以用这类数据库来替代mysql的。
八、缓存。
数据库很脆弱，一定要有缓存在前面挡着，其实我们优化速度，几乎就是优化缓存，能用缓存的地方，就不要再跑到后端数据库那折腾。缓存有持久化缓存、 内存缓存，生成静态页面是最容易理解的持久化缓存了，还有很多比如varnish的分块缓存、前面提到的memcachedb等，内存缓 存，memcached首当其冲。缓存更新可用被动更新和主动更新。被动更新的好处是设计简单，缓存空了就自动去数据库取数据再把缓存填上，但容易引发雪 崩效应，一旦缓存大面积失效，数据库的压力直线上升很可能挂掉。主动缓存可避免这点但是可能引发程序取不到数据的问题。这两者之间如何配合，程序设计要多 动脑筋。
九、队列。
用户一个操作很可能引发一系列资源和功能的调动，这些调动如果同时发生，压力无法控制，用户体验也不好，可以把这样一些操作放入队列，由另几个模块 去异步执行，例如发送邮件，发送手机短信。开源队列服务器很多，性能要求不高用数据库当做队列也可以，只要保证程序读写队列的接口不变，底层队列服务可随 时更换就可以，类似Zend Framework里的Zend_Queue类，java.util.Queue接口等。
十、文件存储。
除了结构化数据，我们经常要存放其他的数据，像图片之类的。这类数据数量繁多、访问量大。典型的就是图片，从用户头像到用户上传的照片，还要生成不 同的缩略图尺寸。存储的分布几乎跟数据库扩展一样艰难。不使用专业存储的情况下，基本都是靠自己的NAS。这就涉及到结构。拿图片存储举例，图片是非常容 易产生热点的，有些图片上传后就不再有人看，有些可能每天被访问数十万次，而且大量小文件的异步备份也很耗费时间。
为了将来图片走cdn做准备，一开始最好就将图片的域名分开，且不用主域名。很多网站都将cookie设置到了.domain.ltd，如果图片也在这个域名下，很可能因为cookie而造成缓存失效，并且占多余流量，还可能因为浏览器并发线程限制造成访问缓慢。
如果用普通的文件系统存储图片，有一个简单的方法。计算文件的hash值，比如md5，以结果第一位作为第一级目录，这样第一级有16个目录。从0 到F，可以把这个字母作为域名，0.yourimg.com到f.yourimg.com（客户端dns压力会增大），还可以扩展到最多16个NAS集群 上。第二级可用年月例如，201011，第三级用日，第四级可选，根据上传量，比如am/pm，甚至小时。最终的目录结构可能会是 e/201008/25/am/e43ae391c839d82801920cf.jpg。rsync备份时可以用脚本只同步某年某日某时的文件，避免计 算大量文件带来的开销。当然最好是能用专门的分布式文件系统或更专业点的存储解决方案。
下面，我们要谈谈代码了。
这一系列的最后一篇写给普通编程人员，如果不感兴趣可直接看本文最后几段。开始设计代码结构之前，先回顾一下之前准备过的事情：我们有负载均衡的 WEB服务器，有主从DB服务器并可能分片，有缓存，有可扩展的存储。在组织代码的各个方面，跟这些准备息息相关，我一二三的列出来分别说，并且每一条都 以“前面讲到”这个经典句式开头，为了方便对照。
别着急看经典句式，我思维跳跃了，插一段。实际开发中，我们总会在性能和代码优雅性上作折中。对于当今的计算机和语言解释器，多几层少几层对象调 用、声明变量为Map还是HashMap这种问题是最后才需要考虑的问题，永远要考虑系统最慢的部分，从最慢的部分解决。例如看看你用的ORM是不是做了 很多你用不到的事情，是不是有重复的数据调用。我们做的是web应用开发，不是底层框架API，代码易读易懂是保证质量很重要的一方面，你的程序是为了什 么而设计，有不同的方法……算了，这个话题另起一篇文章来说，扯远了，想交流可关注我的微博 <a href="http://t.sina.com.cn/liuzhiyi，咱继续……" target="_blank">http://t.sina.com.cn/liuzhiyi，咱继续……</a>
前面讲到，WEB 服务器是要做负载均衡的，图片服务器是要分开的。对于这点，代码在处理客户端状态时，不要把状态放到单机上，举例，不要用文件session，嗯，常识。 如果有可能，最好在一开始就做好用户单点认证的统一接口，包括跨域如何判断状态、静态页面如何判断状态，需要登录时的跳转和返回参数定义，底层给好接口， 应用层直接就用（可参考GAE的 user服务）。登录方面的设计要考虑移动设备的特性，比如电脑可以用浮动层窗口，但NOKIA自带的浏览器或UCWEB就无法处理这种表现形式，程序一 定既能处理AJAX请求又能直接通过URL来处理请求。图片服务器分开，资源文件最好也布局到图片服务器，也就是WEB服务器只服务动态程序。虽然开发测 试时稍微复杂（因为需要绝对URI才能访问），但将来页面前端优化上会轻松许多，并且你的WEB服务器IO优化也轻松许多。程序引用资源文件时，要有一个 统一的处理方法，在方法内部可以自动完成很多事情，例如将css/js根据组合，拼成一个文件，或者自动在生成的URI后面加上QUERYSTRING， 如果将来前端用了缓存服务，那生成QUERYSTRING是最简单的刷新服务端缓存和客户端缓存的办法。
前面讲到， 数据库会有复制，可能会多主多从，可能会分片。我们程序在处理数据的过程中，最好能抽象出来单独放做一层。拿现在流行的MVC模式来说，就是在M层下方再 放一个数据层，这个数据层不是通常所说的JDBC/PDO/ActiveRecord等，而是你自己的存取数据层，仅对外暴露方法，隐藏数据存取细节。这 个数据层内部不要怕写的难看，但一定要提供所有的数据存储功能，其他任何层次不要看到跟数据库打交道的字眼。之所以这样做，是因为在单关系数据库的情况 下，可能会SELECT…JOIN…或直接INSERT…INTO…，可你可能会将一些表放到key-value数据库里存储，或者分片，这么做之后原来 的语句和方式要全部改变，如果过于分散，则移植时会耗费很大精力，或得到一个很大的Model。在数据层面的设计上，尽量避免JOIN查询，我们可以多做 冗余，多做缓存，每种数据尽量只需要一次查询，然后在你的程序里面进行组合。对于比较复杂的数据组合，在实时性要求不高的情况下，可采用异步处理，用户访 问时只取处理后的结果。在对于主键的处理上，避免使用自增ID，可以用一定规则生成的唯一值当做主键，这种主键是最简单的分片分布策略。即使用自增ID， 也最好用一个自增ID发生器，否则从数据库不小心被写了一下，那主键很容易冲突。
前面讲到，咱数据库前面还有某些缓存挡着。别把 mysql的query cache当缓存，应用稍复杂的时候QUERY CACHE反而会成为累赘。缓存跟数据库和业务结合的很紧密，正因为跟业务关系紧密，所以这点没有放之四海而皆准的方法。但我们还是有一些规则可参照。规 则一：越接近前端，缓存的颗粒度越大。例如在WEB最前端缓存整个页面，再往后一层缓存部分页面区域，再往后缓存区域内的单条记录。因为越靠近后端，我们 的可操作性越灵活，并且变化最多的前端代码也比较方便编写。在实践中，因为产品需求变化速度非常快，迭代周期越来越短，有时很难将Controller和 Model分的那么清楚，Controller层面处理部分缓存必不可免，但要保证如果出现这种情况，Controller所操作的缓存一定不要影响其他 数据需求方，也就是要保证这个缓存数据只有这一个Controller在用。规则二：没有缓存时程序不能出错。在不考虑缓存失效引发的雪崩效应时，你的程 序要有缓存跟没缓存一个样，不能像新浪微博一样，缓存一失效，粉丝微博全空，整个应用都乱套了。在缓存必不可少的情况下，给用户出错信息都比给一个让人误 解的信息强。规则三，缓存更新要保证原子性或称作线程安全，特别是采用被动缓存的方式时，很可能两个用户访问时导致同一个缓存被更新，通常情况这不是大问 题，可缓存失效后重建时很可能是引发连锁反应的原因之一。规则四：缓存也是有成本的。不只是技术成本，还有人工时间成本。如果一个功能使用缓存和不使用， 在可预见的访问量情况下区别微小，但使用缓存会使复杂度增加，那就不用，我们可以加个TODO标注，在下次迭代的时候加上缓存处理。
前 面讲到，文件存储是独立的，那么所有的文件操作就都是远程调用。可以在文件服务器上提供一个很简单的RESTful接口，也可以提供xmlrpc 或json serveice，WEB服务器端所生成和处理的文件，全部通过接口通知文件服务器去处理，WEB服务器本身不要提供任何文件存储。你会发现很多大网站的 上传图片跟保存文章是分两步完成的，就是基于这个原因。
以上几条“前面讲到”，其实无数人都讲过，我也只是结合前几篇文章用自己的话重 复了一遍，真正分析起来精髓很简单——除了良好的功能逻辑分层，我们 还要为数据库存储、缓存、队列、文件服务等程序外层资源调用单独设计接口，你可以把你的程序想象成是运行在 Amazon EC2 上并用他的所有web service服务，你的数据库就是它的SimpleDB，你的队列就是他的SQS，你的存储就是他的S3，唯一不同是amazon的接口是远程调用，你的是内部调用。
将支撑服务接口化，意味着将MySQL更换到PostgreSQL不需要更改业务处理程序，移植团队甚至不需要跟业务开发团队过多沟通；意味着业务开发团队是对接口编程而不是对数据库编程；意味着不会因为某个业务开发人员的失误而拖垮性能。
对程序扫盲不感兴趣的直接看这里——
产 品设计完了，程序框架搭完了，可能有矛盾在这个节骨眼儿产生了。不断有产品设计抱怨说他的创意没实现到预期效果，有程序员抱怨说产品设计不切实 际。这种抱怨多缘于产品人员不懂技术，技术人员不理解产品。从广义上来讲，产品包含市场策略、营销手段、功能设计，产品和技术在争论时往往把焦点放在功能 上，而实际重点是，实现这个功能所消耗的成本跟能这个功能带来的利益能否换算，能否取其轻重。若可以，争议解决。若不能，则抛硬币看运气。因为一个功能的 加强而引发指标井喷，或因项目拖延而导致贻误战机的例子比比皆是。激进的决策者注重利益，保守的决策者注重损失，聪明的决策者会考虑这个问题是否真的那么 严重。
关系到未来的事情谁都说不准，要不怎么说创业一半靠运气呢。不过总有能说的准的事情，那就得靠数据说话。
没有100%也有99.9%的网站安装了访问统计代码，连我的 <a href="http://zhiyi.us" target="_blank">http://zhiyi.us</a> 也不例外，新闻联播也总说科学决策科学发展的。有了统计，能确定的事情就很多了。例如，可以根据来源-目标转化率来分析哪类渠道的人均获取成本低，根据来 源-内容访问猜测用户跳出率原因，根据用户点击行为判断链接位置是否合理等。将数据以不同方式组合起来，找到内在联系，分析内因外因，制定对应策略，减少 拍脑门决策。靠数据支撑运营是个非常专业的事情，虽然不懂深奥的数学模型不会复杂的公式计算，渐渐学会因为A所以B，因为A和B所以C还是相对简单的。
全系列完毕。老话，大半夜连抽烟带码字的挺伤身，转载请注明出处
文章来源： </p>
<hr>
<p><strong>企业级项目实战(带源码)地址**</strong>：**<a href="http://zz563143188.iteye.com/blog/1825168" target="_blank"><a href="http://zz563143188.iteye.com/blog/1825168">http://zz563143188.iteye.com/blog/1825168</a></a></p>
<p><strong>收集五年的开发资料下载地址：  <a href="http://pan.baidu.com/share/link?shareid=372668&amp;uk=4076915866#dir/path=%2F%E5%AD%A6%E4%B9%A0%E6%96%87%E4%BB%B6" title="http://pan.baidu.com/share/link?shareid=372668&amp;uk=4076915866" target="_blank"><a href="http://pan.baidu.com/share/link?shareid=372668&amp;uk=4076915866/#dir/path=%2F%E5%AD%A6%E4%B9%A0%E6%96%87%E4%BB%B6">http://pan.baidu.com/share/link?shareid=372668&amp;uk=4076915866/#dir/path=%2F%E5%AD%A6%E4%B9%A0%E6%96%87%E4%BB%B6</a></a></strong>
<a href="http://zhiyi.us/internet/thinking-twice-before-building-your-site-one.html" target="_blank">http://zhiyi.us/internet/thinking-twice-before-building-your-site-one.html</a>
<a href="http://zhiyi.us/internet/thinking-twice-before-building-your-site-two.html" target="_blank">http://zhiyi.us/internet/thinking-twice-before-building-your-site-two.html</a>
<a href="http://zhiyi.us/internet/thinking-twice-before-building-your-site-final.html" target="_blank">http://zhiyi.us/internet/thinking-twice-before-building-your-site-final.html</a></p>
<p>分享到： <a href="&quot;分享到新浪微博&quot;"><img src="" alt=""></a> <a href="&quot;分享到腾讯微博&quot;"><img src="" alt=""></a></p>
<p><a href="http://zz563143188.iteye.com/blog/1842141" title="主流服务器apache、IIS、tomcat、jboss、resin、weblogic、websphere的区别" target="_blank">主流服务器apache、IIS、tomcat、jboss、 ...</a> | <a href="http://zz563143188.iteye.com/blog/1842129" title="高性能网站性能优化与系统架构" target="_blank">高性能网站性能优化与系统架构</a></p>
<ul>
<li>2013-04-05 00:16</li>
<li>浏览 2751</li>
<li><a href="http://zz563143188.iteye.com/blog/1842135#comments" target="_blank">评论(14)</a></li>
<li>分类:<a href="http://www.iteye.com/blogs/category/web" target="_blank">Web前端</a></li>
<li><a href="http://www.iteye.com/wiki/blog/1842135" target="_blank">相关推荐</a></li>
</ul>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<p>14 楼 <a href="http://shenfuli.iteye.com/" title="shenfuli" target="_blank">shenfuli</a> 3 小时前  </p>
<p>NB,需要加大学习。
13 楼 <a href="http://xyz5201314.iteye.com/" title="xyz5201314" target="_blank">xyz5201314</a> 2013-05-27  </p>
<p>好人一个。d一下。</p>
<p>12 楼 <a href="http://zz563143188.iteye.com/" title="zz563143188" target="_blank">zz563143188</a> 2013-04-28  </p>
<p>桃花源记 写道</p>
<p>这得多牛，才能总结出这么多知识啊！
有些只需要知道
11 楼 <a href="http://lxz2672282.iteye.com/" title="桃花源记" target="_blank">桃花源记</a> 2013-04-28  </p>
<p>这得多牛，才能总结出这么多知识啊！</p>
<p>10 楼 <a href="http://zz563143188.iteye.com/" title="zz563143188" target="_blank">zz563143188</a> 2013-04-18  </p>
<p>thrillerzw 写道</p>
<p>有些词不懂，看来我还得努力。<img src="" alt="">
厚积薄发，先把基础知识搞扎实。
9 楼 <a href="http://thrillerzw.iteye.com/" title="thrillerzw" target="_blank">thrillerzw</a> 2013-04-18  </p>
<p>有些词不懂，看来我还得努力。<img src="" alt=""></p>
<p>8 楼 <a href="http://zz563143188.iteye.com/" title="zz563143188" target="_blank">zz563143188</a> 2013-04-16  </p>
<p>tss0823 写道</p>
<p>看完了，我是一个字节看下去的，真心觉得不错，有些东西感同身受，当时无法用语言来描述，现在看了楼主的文章，才觉得那些东西我貌似也经历过。总之，谢谢。
可能实际中运用不到这么多知识，但这样可以让我们的知识全面。
7 楼 <a href="http://tss0823.iteye.com/" title="tss0823" target="_blank">tss0823</a> 2013-04-16  </p>
<p>看完了，我是一个字节看下去的，真心觉得不错，有些东西感同身受，当时无法用语言来描述，现在看了楼主的文章，才觉得那些东西我貌似也经历过。总之，谢谢。</p>
<p>6 楼 <a href="http://zz563143188.iteye.com/" title="zz563143188" target="_blank">zz563143188</a> 2013-04-13  </p>
<p>chenhjzn 写道</p>
<p><img src="" alt=""> 非常不错
多学习了解
5 楼 <a href="http://chenhjzn.iteye.com/" title="chenhjzn" target="_blank">chenhjzn</a> 2013-04-13  </p>
<p><img src="" alt=""> 非常不错</p>
<p>4 楼 <a href="http://zz563143188.iteye.com/" title="zz563143188" target="_blank">zz563143188</a> 2013-04-09  </p>
<p>jayluns 写道</p>
<p>非常不错，赞。<img src="" alt="">
只供学习参考
3 楼 <a href="http://jayluns.iteye.com/" title="jayluns" target="_blank">jayluns</a> 2013-04-08  </p>
<p>非常不错，赞。<img src="" alt=""></p>
<p>2 楼 <a href="http://zz563143188.iteye.com/" title="zz563143188" target="_blank">zz563143188</a> 2013-04-07  </p>
<p>shichuanliujie 写道</p>
<p><img src="" alt=""> 不错
只供参考引用，扩展眼界
1 楼 <a href="http://shichuanliujie.iteye.com/" title="shichuanliujie" target="_blank">shichuanliujie</a> 2013-04-07  </p>
<p><img src="" alt=""> 不错</p>
<h3 id="-">发表评论</h3>
<p><a href="http://zz563143188.iteye.com/login" target="_blank"><img src="" alt=""></a><a href="http://zz563143188.iteye.com/login" target="_blank">您还没有登录,请您登录后再发表评论</a></p>
<p><a href="http://zz563143188.iteye.com/" target="_blank"><img src="&quot;zz563143188的博客: 既然来了就要多看几篇博客， 因为每一篇都适合你。如果收藏重复看，你一定能感受到我的正能量。&quot;" alt="zz563143188的博客"></a></p>
<p>zz563143188</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/网上资料url集/">网上资料url集</a></li></span></span> | <span class="tags">Tagged <a href="/tags/网上资料url集/" class="label label-primary">网上资料url集</a></span> | <span class="time">recent updated:<time title="2014-03-26 20:47:04"datetime="2014-03-26 20:47:04"> mar. 26 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-百万级访问网站前期的技术准备/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-百万级访问网站前期的技术准备" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/132/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/130/">130</a></li><li><a class="page-number" href="/page/131/">131</a></li><li><a class="page-number" href="/page/132/">132</a></li><li class="active"><li><span class="page-number current">133</span></li><li><a class="page-number" href="/page/134/">134</a></li><li><a class="page-number" href="/page/135/">135</a></li><li><a class="page-number" href="/page/136/">136</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/134/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 19:05:47</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
