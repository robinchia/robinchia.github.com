
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 145 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--对ibatis分页功能的改进-newpeter-ITeye技术网站/">对ibatis分页功能的改进 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--对ibatis分页功能的改进-newpeter-ITeye技术网站/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-ibatis-newpeter-iteye-">对ibatis分页功能的改进 - newpeter - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">资讯</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://newpeter.iteye.com/blog/323135#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://newpeter.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/all" target="_blank">我的应用</a> <a href="http://newpeter.iteye.com/login" target="_blank">登录</a> <a href="http://newpeter.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-newpeter-http-newpeter-iteye-com-"><a href="http://newpeter.iteye.com/" target="_blank">newpeter</a></h1>
<p>永久域名 <a href="http://newpeter.iteye.com/" target="_blank"><a href="http://newpeter.iteye.com/">http://newpeter.iteye.com/</a></a></p>
<p><a href="http://newpeter.iteye.com/blog/323137" title="当前比较全的Linux各种版本简介" target="_blank">当前比较全的Linux各种版本简介</a> | <a href="http://newpeter.iteye.com/blog/323130" title="常用正则表达式" target="_blank">常用正则表达式</a></p>
<p>2009-02-04</p>
<h3 id="-ibatis-http-newpeter-iteye-com-blog-323135-"><a href="http://newpeter.iteye.com/blog/323135" target="_blank">对ibatis分页功能的改进</a> **</h3>
<p><a href="http://www.iteye.com/blogs/tag/iBATIS" target="_blank">iBATIS</a><a href="http://www.iteye.com/blogs/tag/SQL" target="_blank">SQL</a><a href="http://www.iteye.com/blogs/tag/Hibernate" target="_blank">Hibernate</a><a href="http://www.iteye.com/blogs/tag/DAO" target="_blank">DAO</a><a href="http://www.iteye.com/blogs/tag/EXT" target="_blank">EXT</a></p>
<p>今天无意间看到了一篇关于这方面的文章，觉得是网上改进ibatis分页方面比较好的文章，这里转摘一下，希望能让更多的人用的到，也希望别人能把更好的解决方案贡献出来！
使ibatis支持hibernate式的物理分页</p>
<p>一直以来ibatis的分页都是通过滚动ResultSet实现的，应该算是逻辑分页吧。逻辑分页虽然能很干净地独立于特定数据库，但效率在多数情 况下不及特定数据库支持的物理分页，而hibernate的分页则是直接组装sql，充分利用了特定数据库的分页机制，效率相对较高。本文讲述的就是如何 在不重新编译ibatis源码的前提下，为ibatis引入hibernate式的物理分页机制。</p>
<p>基本思路就是找到ibatis执行sql的地方，截获sql并重新组装sql。通过分析ibatis源码知道，最终负责执行sql的类是 com.ibatis.sqlmap.engine.execution.SqlExecutor，此类没有实现任何接口，这多少有点遗憾，因为接口是相 对稳定契约，非大的版本更新，接口一般是不会变的，而类就相对易变一些，所以这里的代码只能保证对当前版本（2.1.7）的ibatis有效。下面是 SqlExecutor执行查询的方法：</p>
<p>//<em>/</em> /<em> Long form of the method to execute a query /</em> /<em> @param request - the request scope /</em> @param conn - the database connection /<em> @param sql - the SQL statement to execute /</em> @param parameters - the parameters for the statement /<em> @param skipResults - the number of results to skip /</em> @param maxResults - the maximum number of results to return /<em> @param callback - the row handler for the query /</em> /<em> @throws SQLException - if the query fails /</em>/ public void executeQuery(RequestScope request, Connection conn, String sql, Object[] parameters, int skipResults, int maxResults, RowHandlerCallback callback) throws SQLException { ErrorContext errorContext = request.getErrorContext(); errorContext.setActivity(&quot;executing query&quot;); errorContext.setObjectId(sql); PreparedStatement ps = null; ResultSet rs = null; try { errorContext.setMoreInfo(&quot;Check the SQL Statement (preparation failed).&quot;); Integer rsType = request.getStatement().getResultSetType(); if (rsType != null) { ps = conn.prepareStatement(sql, rsType.intValue(), ResultSet.CONCUR_READ_ONLY); } else { ps = conn.prepareStatement(sql); } Integer fetchSize = request.getStatement().getFetchSize(); if (fetchSize != null) { ps.setFetchSize(fetchSize.intValue()); } errorContext.setMoreInfo(&quot;Check the parameters (set parameters failed).&quot;); request.getParameterMap().setParameters(request, ps, parameters); errorContext.setMoreInfo(&quot;Check the statement (query failed).&quot;); ps.execute(); rs = getFirstResultSet(ps); if (rs != null) { errorContext.setMoreInfo(&quot;Check the results (failed to retrieve results).&quot;); handleResults(request, rs, skipResults, maxResults, callback); } // clear out remaining results while (ps.getMoreResults()); } finally { try { closeResultSet(rs); } finally { closeStatement(ps); } } }</p>
<p> 其中handleResults(request, rs, skipResults, maxResults, callback)一句用于处理分页，其实此时查询已经执行完毕，可以不必关心handleResults方法，但为清楚起见，下面来看看 handleResults的实现：</p>
<p>private void handleResults(RequestScope request, ResultSet rs, int skipResults, int maxResults, RowHandlerCallback callback) throws SQLException { try { request.setResultSet(rs); ResultMap resultMap = request.getResultMap(); if (resultMap != null) { // Skip Results if (rs.getType() != ResultSet.TYPE_FORWARD_ONLY) { if (skipResults &gt; 0) { rs.absolute(skipResults); } } else { for (int i = 0; i &lt; skipResults; i++) { if (!rs.next()) { break; } } } // Get Results int resultsFetched = 0; while ((maxResults == SqlExecutor.NO_MAXIMUM_RESULTS || resultsFetched &lt; maxResults) &amp;&amp; rs.next()) { Object[] columnValues = resultMap.resolveSubMap(request, rs).getResults(request, rs); callback.handleResultObject(request, columnValues, rs); resultsFetched++; } } } finally { request.setResultSet(null); } }</p>
<p> 此处优先使用的是ResultSet的absolute方法定位记录，是否支持absolute取决于具体数据库驱动，但一般当前版本的数据库都支 持该方法，如果不支持则逐条跳过前面的记录。由此可以看出如果数据库支持absolute，则ibatis内置的分页策略与特定数据库的物理分页效率差距 就在于物理分页查询与不分页查询在数据库中的执行效率的差距了。因为查询执行后读取数据前数据库并未把结果全部返回到内存，所以本身在存储占用上应该差距 不大，如果都使用索引，估计执行速度也差不太多。</p>
<p>继续我们的话题。其实只要在executeQuery执行前组装sql，然后将其传给executeQuery，并告诉handleResults 我们不需要逻辑分页即可。拦截executeQuery可以采用aop动态实现，也可直接继承SqlExecutor覆盖executeQuery来静态 地实现，相比之下后者要简单许多，而且由于SqlExecutor没有实现任何接口，比较易变，动态拦截反到增加了维护的工作量，所以我们下面来覆盖 executeQuery：</p>
<p>package com.aladdin.dao.ibatis.ext; import java.sql.Connection; import java.sql.SQLException; import org.apache.commons.logging.Log; import org.apache.commons.logging.LogFactory; import com.aladdin.dao.dialect.Dialect; import com.ibatis.sqlmap.engine.execution.SqlExecutor; import com.ibatis.sqlmap.engine.mapping.statement.RowHandlerCallback; import com.ibatis.sqlmap.engine.scope.RequestScope; public class LimitSqlExecutor extends SqlExecutor { private static final Log logger = LogFactory.getLog(LimitSqlExecutor.class); private Dialect dialect; private boolean enableLimit = true; public Dialect getDialect() { return dialect; } public void setDialect(Dialect dialect) { this.dialect = dialect; } public boolean isEnableLimit() { return enableLimit; } public void setEnableLimit(boolean enableLimit) { this.enableLimit = enableLimit; } @Override public void executeQuery(RequestScope request, Connection conn, String sql, Object[] parameters, int skipResults, int maxResults, RowHandlerCallback callback) throws SQLException { if ((skipResults != NO_SKIPPED_RESULTS || maxResults != NO_MAXIMUM_RESULTS) &amp;&amp; supportsLimit()) { sql = dialect.getLimitString(sql, skipResults, maxResults); if(logger.isDebugEnabled()){ logger.debug(sql); } skipResults = NO_SKIPPED_RESULTS; maxResults = NO_MAXIMUM_RESULTS; } super.executeQuery(request, conn, sql, parameters, skipResults, maxResults, callback); } public boolean supportsLimit() { if (enableLimit &amp;&amp; dialect != null) { return dialect.supportsLimit(); } return false; } }</p>
<p> 其中：</p>
<p>skipResults = NO_SKIPPED_RESULTS; maxResults = NO_MAXIMUM_RESULTS;</p>
<p> 告诉handleResults不分页（我们组装的sql已经使查询结果是分页后的结果了），此处引入了类似hibenate中的数据库方言接口Dialect，其代码如下：</p>
<p>package com.aladdin.dao.dialect; public interface Dialect { public boolean supportsLimit(); public String getLimitString(String sql, boolean hasOffset); public String getLimitString(String sql, int offset, int limit); }</p>
<p> 下面为Dialect接口的MySQL实现：package com.aladdin.dao.ibatis;</p>
<p>import java.io.Serializable; import java.util.List; import org.springframework.orm.ObjectRetrievalFailureException; import org.springframework.orm.ibatis.support.SqlMapClientDaoSupport; import com.aladdin.dao.ibatis.ext.LimitSqlExecutor; import com.aladdin.domain.BaseObject; import com.aladdin.util.ReflectUtil; import com.ibatis.sqlmap.client.SqlMapClient; import com.ibatis.sqlmap.engine.execution.SqlExecutor; import com.ibatis.sqlmap.engine.impl.ExtendedSqlMapClient; public abstract class BaseDaoiBatis extends SqlMapClientDaoSupport { private SqlExecutor sqlExecutor; public SqlExecutor getSqlExecutor() { return sqlExecutor; } public void setSqlExecutor(SqlExecutor sqlExecutor) { this.sqlExecutor = sqlExecutor; } public void setEnableLimit(boolean enableLimit) { if (sqlExecutor instanceof LimitSqlExecutor) { ((LimitSqlExecutor) sqlExecutor).setEnableLimit(enableLimit); } } public void initialize() throws Exception { if (sqlExecutor != null) { SqlMapClient sqlMapClient = getSqlMapClientTemplate() .getSqlMapClient(); if (sqlMapClient instanceof ExtendedSqlMapClient) { ReflectUtil.setFieldValue(((ExtendedSqlMapClient) sqlMapClient) .getDelegate(), &quot;sqlExecutor&quot;, SqlExecutor.class, sqlExecutor); } } } ... }</p>
<p>分享到： <a href="&quot;分享到新浪微博&quot;"><img src="" alt=""></a> <a href="&quot;分享到腾讯微博&quot;"><img src="" alt=""></a>
<a href="http://newpeter.iteye.com/blog/323137" title="当前比较全的Linux各种版本简介" target="_blank">当前比较全的Linux各种版本简介</a> | <a href="http://newpeter.iteye.com/blog/323130" title="常用正则表达式" target="_blank">常用正则表达式</a></p>
<ul>
<li>23:31</li>
<li><a href="http://newpeter.iteye.com/blog/323135#comments" target="_blank">评论</a> / 浏览 (1 / 2852)</li>
<li><a href="http://www.iteye.com/wiki/blog/323135" target="_blank">相关推荐</a><h3 id="-">评论</h3>
</li>
</ul>
<p><a href=""></a></p>
<p>1 楼 <a href="http://vasuer.iteye.com/" target="_blank">vasuer</a> 2010-08-29   <a href="http://newpeter.iteye.com/blog/323135#" target="_blank">引用</a></p>
<p>te<img src="" alt=""></p>
<h3 id="-">发表评论</h3>
<p>您还没有登录，请<a href="http://newpeter.iteye.com/login" target="_blank">登录</a>后发表评论(快捷键 Alt+S / Ctrl+Enter)</p>
<p><a href="http://newpeter.iteye.com/" target="_blank"><img src="&quot;newpeter的博客: newpeter&quot;" alt="newpeter的博客"></a></p>
<p>newpeter</p>
<ul>
<li>浏览: 16997 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 深圳</li>
<li><img src="" alt=""></li>
<li><a href="http://newpeter.iteye.com/blog/profile" target="_blank">详细资料</a> <a href="http://newpeter.iteye.com/blog/guest_book" target="_blank">留言簿</a></li>
</ul>
<h3 id="-">搜索本博客</h3>
<h3 id="-http-newpeter-iteye-com-blog-user_visits-">最近访客 <a href="http://newpeter.iteye.com/blog/user_visits" target="_blank">&gt;&gt;更多访客</a></h3>
<p><a href="http://ankonlcy.iteye.com/" target="_blank"><img src="&quot;ankonlcy的博客: &quot;" alt="ankonlcy的博客"></a></p>
<p><a href="http://ankonlcy.iteye.com/" target="_blank">ankonlcy</a></p>
<p><a href="http://amazingstar.iteye.com/" target="_blank"><img src="&quot;amazingstar的博客: &quot;" alt="amazingstar的博客"></a></p>
<p><a href="http://amazingstar.iteye.com/" target="_blank">amazingstar</a>
<a href="http://woozyangel.iteye.com/" target="_blank"><img src="&quot;woozyangel的博客: &quot;" alt="woozyangel的博客"></a></p>
<p><a href="http://woozyangel.iteye.com/" target="_blank">woozyangel</a></p>
<p><a href="http://jdtangyin.iteye.com/" target="_blank"><img src="&quot;jdTangYin的博客: &quot;" alt="jdTangYin的博客"></a></p>
<p><a href="http://jdtangyin.iteye.com/" target="_blank">jdTangYin</a></p>
<h3 id="-">博客分类</h3>
<ul>
<li><a href="http://newpeter.iteye.com/" target="_blank">全部博客 (16)</a><h3 id="-http-newpeter-iteye-com-blog-guest_book-">我的留言簿 <a href="http://newpeter.iteye.com/blog/guest_book" target="_blank">&gt;&gt;更多留言</a></h3>
</li>
</ul>
<h3 id="-">其他分类</h3>
<ul>
<li><a href="http://newpeter.iteye.com/blog/favorite" target="_blank">我的收藏</a> (6)</li>
<li><a href="http://newpeter.iteye.com/blog/code_favorite" target="_blank">我的代码</a> (0)</li>
<li><a href="http://newpeter.iteye.com/blog/topic" target="_blank">我的论坛主题帖</a> (2)</li>
<li><a href="http://newpeter.iteye.com/blog/post" target="_blank">我的所有论坛帖</a> (5)</li>
<li><a href="http://newpeter.iteye.com/blog/article" target="_blank">我的精华良好帖</a> (0)<h3 id="-">最近加入群组</h3>
</li>
</ul>
<h3 id="-">存档</h3>
<ul>
<li><a href="http://newpeter.iteye.com/blog/monthblog/2009-02" target="_blank">2009-02</a> (13)</li>
<li><a href="http://newpeter.iteye.com/blog/monthblog/2009-01" target="_blank">2009-01</a> (1)</li>
<li><a href="http://newpeter.iteye.com/blog/monthblog/2007-05" target="_blank">2007-05</a> (2)</li>
<li><a href="http://newpeter.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></li>
<li><a href="http://newpeter.iteye.com/rss" target="_blank"><img src="" alt="Rss"></a></li>
<li><a href="http://fusion.google.com/add?feedurl=http://newpeter.iteye.com/rss" target="_blank"><img src="" alt="Rss_google"></a>
声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2011 ITeye.com. All rights reserved. [ 京ICP证110151号 ]</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/框架汇总/">框架汇总</a></li></span><span class="breadcrumb"><li><a href="/categories/框架汇总/">框架汇总</a></li><li><a href="/categories/框架汇总/ORM/">ORM</a></li><li><a href="/categories/框架汇总/ORM/ibatis/">ibatis</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ORM/" class="label label-primary">ORM</a><a href="/tags/ibatis/" class="label label-success">ibatis</a><a href="/tags/框架汇总/" class="label label-info">框架汇总</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--对ibatis分页功能的改进-newpeter-ITeye技术网站/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-框架汇总-ORM-ibatis--对ibatis分页功能的改进-newpeter-ITeye技术网站" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--使用ibatis操作数据库的封装/">使用ibatis操作数据库的封装</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--使用ibatis操作数据库的封装/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-ibatis-">使用ibatis操作数据库的封装</h1>
<p><strong><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="[置顶]使用ibatis操作数据库的封装" target="_blank">使用ibatis操作数据库的封装</a><em>**</em></strong></p>
<p>近期刚进入公司，也是本人的第一份正式工作，公司使用的ORM框架是ibatis，下面代码是对batis dao的一个封装，主要继承自spring的SqlMapClientDaoSupport，负责为单个Entity 提供CRUD操作的IBatis DAO基类，使用该基类，可以减少不少代码量。</p>
<p><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="copy to clipboard" target="_blank">copy to clipboard</a><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="print" target="_blank">print</a><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="?" target="_blank">?</a></p>
<ol>
<li><p>package com.nfschina.utils.dao.ibatis  </p>
</li>
<li></li>
<li><p>import java.io.Serializable;  </p>
</li>
<li><p>import java.sql.Connection;  </p>
</li>
<li><p>import java.sql.ResultSet;  </p>
</li>
<li><p>import java.sql.SQLException;  </p>
</li>
<li><p>import java.util.HashMap;  </p>
</li>
<li><p>import java.util.List;  </p>
</li>
<li><p>import java.util.Map;  </p>
</li>
<li></li>
<li><p>import org.apache.commons.beanutils.PropertyUtils;  </p>
</li>
<li><p>import org.apache.commons.lang.StringUtils;  </p>
</li>
<li><p>import org.springframework.util.Assert;  </p>
</li>
<li></li>
<li><p>import com.ibatis.sqlmap.engine.impl.SqlMapClientImpl;  </p>
</li>
<li><p>import com.ibatis.sqlmap.engine.mapping.sql.stat.StaticSql;  </p>
</li>
<li><p>import com.ibatis.sqlmap.engine.mapping.statement.MappedStatement;  </p>
</li>
<li></li>
<li><p>importcom.nfschina.utils.BaseException;  </p>
</li>
<li><p>import com.nfschina.utils.DataPage;  </p>
</li>
<li></li>
<li><p>import org.springframework.orm.ibatis.support.SqlMapClientDaoSupport  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* IBatis Dao的泛型基类. </p>
</li>
<li><p>/* 继承于Spring的SqlMapClientDaoSupport,提供分页函数和若干便捷查询方法，并对返回值作了泛型类型转换. </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>@SuppressWarnings(&quot;unchecked&quot;)  </p>
</li>
<li><p>public class IBatisGenericDao extends SqlMapClientDaoSupport {  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_INSERT = &quot;.insert&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_UPDATE = &quot;.update&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_DELETE = &quot;.delete&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_DELETE_PRIAMARYKEY = &quot;.deleteByPrimaryKey&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_SELECT = &quot;.select&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_SELECTMAP = &quot;.selectByMap&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_SELECTSQL = &quot;.selectBySql&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_COUNT = &quot;.count&quot;;  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据ID获取对象 </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @throws BaseException </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> T get(Class<T> entityClass, Serializable id) throws BaseException, SQLException {  </p>
</li>
<li></li>
<li><p>T o = (T) getSqlMapClient().queryForObject(entityClass.getName() + POSTFIX_SELECT, id);  </p>
</li>
<li><p>if (o == null)  </p>
</li>
<li><p>throw new BaseException(BaseException.DATA_NOTFOUND, &quot;未找到实体: &quot; + id);  </p>
</li>
<li><p>return o;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 获取全部对象 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> List<T> getAll(Class<T> entityClass) throws SQLException {  </p>
</li>
<li><p>return getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECT, null);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 新增对象 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public void insert(Object o) throws SQLException {  </p>
</li>
<li><p>getSqlMapClient().insert(o.getClass().getName() + POSTFIX_INSERT, o);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 保存对象 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public int update(Object o) throws SQLException {  </p>
</li>
<li><p>return getSqlMapClient().update(o.getClass().getName() + POSTFIX_UPDATE, o);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 删除对象 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public int remove(Object o) throws SQLException {  </p>
</li>
<li><p>return getSqlMapClient().delete(o.getClass().getName() + POSTFIX_DELETE, o);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据ID删除对象 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> int removeById(Class<T> entityClass, Serializable id) throws SQLException {  </p>
</li>
<li><p>return getSqlMapClient().delete(entityClass.getName() + POSTFIX_DELETE_PRIAMARYKEY, id);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* map查询. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @param map </p>
</li>
<li><p>/*            包含各种属性的查询 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> List<T> find(Class<T> entityClass, Map<String, Object> map) throws SQLException {  </p>
</li>
<li><p>if (map == null)  </p>
</li>
<li><p>return this.getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECT, null);  </p>
</li>
<li><p>else {  </p>
</li>
<li><p>map.put(&quot;findBy&quot;, &quot;True&quot;);  </p>
</li>
<li><p>return this.getSqlMapClient()  </p>
</li>
<li><p>.queryForList(entityClass.getName() + POSTFIX_SELECTMAP, map);  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* sql 查询. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @param sql </p>
</li>
<li><p>/*            直接sql的语句(需要防止注入式攻击) </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> List<T> find(Class<T> entityClass, String sql) throws SQLException {  </p>
</li>
<li><p>Assert.hasText(sql);  </p>
</li>
<li><p>if (StringUtils.isEmpty(sql))  </p>
</li>
<li><p>return this.getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECT, null);  </p>
</li>
<li><p>else  </p>
</li>
<li><p>return this.getSqlMapClient()  </p>
</li>
<li><p>.queryForList(entityClass.getName() + POSTFIX_SELECTSQL, sql);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性名和属性值查询对象. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @return 符合条件的对象列表 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> List<T> findBy(Class<T> entityClass, String name, Object value) throws SQLException {  </p>
</li>
<li><p>Assert.hasText(name);  </p>
</li>
<li><p>Map<String, Object> map = new HashMap<String, Object>();  </p>
</li>
<li><p>map.put(name, value);  </p>
</li>
<li><p>return find(entityClass, map);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性名和属性值查询对象. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @return 符合条件的唯一对象 </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> T findUniqueBy(Class<T> entityClass, String name, Object value) {  </p>
</li>
<li><p>Assert.hasText(name);  </p>
</li>
<li><p>Map<String, Object> map = new HashMap<String, Object>();  </p>
</li>
<li><p>try {  </p>
</li>
<li><p>PropertyUtils.getProperty(entityClass.newInstance(), name);  </p>
</li>
<li><p>map.put(name, value);  </p>
</li>
<li><p>map.put(&quot;findUniqueBy&quot;, &quot;True&quot;);  </p>
</li>
<li><p>return (T) getSqlMapClient().queryForObject(entityClass.getName() + POSTFIX_SELECTMAP,  </p>
</li>
<li><p>map);  </p>
</li>
<li><p>} catch (Exception e) {  </p>
</li>
<li><p>logger.error(&quot;Error when propertie on entity,&quot; + e.getMessage(), e.getCause());  </p>
</li>
<li><p>return null;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性名和属性值以Like AnyWhere方式查询对象. </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> List<T> findByLike(Class<T> entityClass, String name, String value) throws SQLException {  </p>
</li>
<li><p>Assert.hasText(name);  </p>
</li>
<li><p>Map<String, Object> map = new HashMap<String, Object>();  </p>
</li>
<li><p>map.put(name, value);  </p>
</li>
<li><p>map.put(&quot;findLikeBy&quot;, &quot;True&quot;);  </p>
</li>
<li><p>return getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECTMAP, map);  </p>
</li>
<li></li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 判断对象某些属性的值在数据库中不存在重复 </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @param tableName </p>
</li>
<li><p>/*            数据表名字 </p>
</li>
<li><p>/* @param names </p>
</li>
<li><p>/*            在POJO里不能重复的属性列表,以逗号分割 如&quot;name,loginid,password&quot; <br> </p>
</li>
<li><p>/*            FIXME how about in different schema? </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public boolean isNotUnique(Object entity, String tableName, String names) {  </p>
</li>
<li><p>try {  </p>
</li>
<li><p>String primarykey;  </p>
</li>
<li><p>Connection con = getSqlMapClient().getCurrentConnection();  </p>
</li>
<li><p>ResultSet dbMetaData = con.getMetaData().getPrimaryKeys(con.getCatalog(), null, tableName);  </p>
</li>
<li><p>dbMetaData.next();  </p>
</li>
<li><p>if (dbMetaData.getRow() &gt; 0) {  </p>
</li>
<li><p>primarykey = dbMetaData.getString(4);  </p>
</li>
<li><p>if (names.indexOf(primarykey) &gt; -1)  </p>
</li>
<li><p>return false;  </p>
</li>
<li><p>} else {  </p>
</li>
<li><p>return true;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>} catch (SQLException e) {  </p>
</li>
<li><p>logger.error(e.getMessage(), e);  </p>
</li>
<li><p>return false;  </p>
</li>
<li><p>}  </p>
</li>
<li><p>return false;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 分页查询函数，使用PaginatedList. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @param pageNo </p>
</li>
<li><p>/*            页号,从0开始. </p>
</li>
<li><p>/* @throws SQLException </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>@SuppressWarnings(&quot;rawtypes&quot;)  </p>
</li>
<li><p>public DataPage pagedQuery(String sqlName, HashMap<String, Object> hashMap, Integer pageNo, Integer pageSize)  </p>
</li>
<li><p>throws SQLException {  </p>
</li>
<li></li>
<li><p>if (pageNo == null || pageSize == null) {  </p>
</li>
<li><p>List list = getSqlMapClient().queryForList(sqlName, hashMap);  </p>
</li>
<li><p>if (list == null || list.size() == 0) {  </p>
</li>
<li><p>return new DataPage();  </p>
</li>
<li><p>} else {  </p>
</li>
<li><p>return new DataPage(0, list.size(), list.size(), list);  </p>
</li>
<li><p>}  </p>
</li>
<li><p>} else {  </p>
</li>
<li><p>Assert.hasText(sqlName);  </p>
</li>
<li><p>Assert.isTrue(pageNo &gt;= 1, &quot;pageNo should start from 1&quot;);  </p>
</li>
<li><p>// Count查询   </p>
</li>
<li><p>Integer totalCount = (Integer) getSqlMapClient().queryForObject(sqlName + &quot;.Count&quot;, hashMap);  </p>
</li>
<li></li>
<li><p>if (totalCount &lt; 1) {  </p>
</li>
<li><p>return new DataPage();  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>// 实际查询返回分页对象   </p>
</li>
<li><p>int startIndex = DataPage.getStartOfPage(pageNo, pageSize);  </p>
</li>
<li><p>hashMap.put(&quot;startIndex&quot;, startIndex);  </p>
</li>
<li><p>hashMap.put(&quot;pageSize&quot;, pageSize);  </p>
</li>
<li><p>List list = getSqlMapClient().queryForList(sqlName, hashMap);  </p>
</li>
<li></li>
<li><p>return new DataPage(startIndex, totalCount, pageSize, list);  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>public String getMappedSQL(String sqlName) {  </p>
</li>
<li><p>String sql = null;  </p>
</li>
<li></li>
<li><p>SqlMapClientImpl sqlmap = (SqlMapClientImpl) getSqlMapClient();  </p>
</li>
<li></li>
<li><p>MappedStatement stmt = sqlmap.getMappedStatement(sqlName);  </p>
</li>
<li><p>StaticSql staticSql = (StaticSql) stmt.getSql();  </p>
</li>
<li><p>sql = staticSql.getSql(null, null);  </p>
</li>
<li><p>return sql;  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}  </p>
</li>
</ol>
<p>package com.nfschina.utils.dao.ibatis import java.io.Serializable; import java.sql.Connection; import java.sql.ResultSet; import java.sql.SQLException; import java.util.HashMap; import java.util.List; import java.util.Map; import org.apache.commons.beanutils.PropertyUtils; import org.apache.commons.lang.StringUtils; import org.springframework.util.Assert; import com.ibatis.sqlmap.engine.impl.SqlMapClientImpl; import com.ibatis.sqlmap.engine.mapping.sql.stat.StaticSql; import com.ibatis.sqlmap.engine.mapping.statement.MappedStatement; importcom.nfschina.utils.BaseException; import com.nfschina.utils.DataPage; import org.springframework.orm.ibatis.support.SqlMapClientDaoSupport //<em>/</em> /<em> IBatis Dao的泛型基类. /</em> 继承于Spring的SqlMapClientDaoSupport,提供分页函数和若干便捷查询方法，并对返回值作了泛型类型转换. /<em>/ @SuppressWarnings(&quot;unchecked&quot;) public class IBatisGenericDao extends SqlMapClientDaoSupport { public static final String POSTFIX_INSERT = &quot;.insert&quot;; public static final String POSTFIX_UPDATE = &quot;.update&quot;; public static final String POSTFIX_DELETE = &quot;.delete&quot;; public static final String POSTFIX_DELETE_PRIAMARYKEY = &quot;.deleteByPrimaryKey&quot;; public static final String POSTFIX_SELECT = &quot;.select&quot;; public static final String POSTFIX_SELECTMAP = &quot;.selectByMap&quot;; public static final String POSTFIX_SELECTSQL = &quot;.selectBySql&quot;; public static final String POSTFIX_COUNT = &quot;.count&quot;; //</em>/<em> /</em> 根据ID获取对象 /<em> /</em> @throws BaseException /<em> @throws SQLException /</em>/ public <T> T get(Class<T> entityClass, Serializable id) throws BaseException, SQLException { T o = (T) getSqlMapClient().queryForObject(entityClass.getName() + POSTFIX_SELECT, id); if (o == null) throw new BaseException(BaseException.DATA_NOTFOUND, &quot;未找到实体: &quot; + id); return o; } //<em>/</em> /<em> 获取全部对象 /</em> @throws SQLException /<em>/ public <T> List<T> getAll(Class<T> entityClass) throws SQLException { return getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECT, null); } //</em>/<em> /</em> 新增对象 /<em> @throws SQLException /</em>/ public void insert(Object o) throws SQLException { getSqlMapClient().insert(o.getClass().getName() + POSTFIX_INSERT, o); } //<em>/</em> /<em> 保存对象 /</em> @throws SQLException /<em>/ public int update(Object o) throws SQLException { return getSqlMapClient().update(o.getClass().getName() + POSTFIX_UPDATE, o); } //</em>/<em> /</em> 删除对象 /<em> @throws SQLException /</em>/ public int remove(Object o) throws SQLException { return getSqlMapClient().delete(o.getClass().getName() + POSTFIX_DELETE, o); } //<em>/</em> /<em> 根据ID删除对象 /</em> @throws SQLException /<em>/ public <T> int removeById(Class<T> entityClass, Serializable id) throws SQLException { return getSqlMapClient().delete(entityClass.getName() + POSTFIX_DELETE_PRIAMARYKEY, id); } //</em>/<em> /</em> map查询. /<em> /</em> @param map /<em> 包含各种属性的查询 /</em> @throws SQLException /<em>/ public <T> List<T> find(Class<T> entityClass, Map<String, Object> map) throws SQLException { if (map == null) return this.getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECT, null); else { map.put(&quot;findBy&quot;, &quot;True&quot;); return this.getSqlMapClient() .queryForList(entityClass.getName() + POSTFIX_SELECTMAP, map); } } //</em>/<em> /</em> sql 查询. /<em> /</em> @param sql /<em> 直接sql的语句(需要防止注入式攻击) /</em> @throws SQLException /<em>/ public <T> List<T> find(Class<T> entityClass, String sql) throws SQLException { Assert.hasText(sql); if (StringUtils.isEmpty(sql)) return this.getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECT, null); else return this.getSqlMapClient() .queryForList(entityClass.getName() + POSTFIX_SELECTSQL, sql); } //</em>/<em> /</em> 根据属性名和属性值查询对象. /<em> /</em> @return 符合条件的对象列表 /<em> @throws SQLException /</em>/ public <T> List<T> findBy(Class<T> entityClass, String name, Object value) throws SQLException { Assert.hasText(name); Map<String, Object> map = new HashMap<String, Object>(); map.put(name, value); return find(entityClass, map); } //<em>/</em> /<em> 根据属性名和属性值查询对象. /</em> /<em> @return 符合条件的唯一对象 /</em>/ public <T> T findUniqueBy(Class<T> entityClass, String name, Object value) { Assert.hasText(name); Map<String, Object> map = new HashMap<String, Object>(); try { PropertyUtils.getProperty(entityClass.newInstance(), name); map.put(name, value); map.put(&quot;findUniqueBy&quot;, &quot;True&quot;); return (T) getSqlMapClient().queryForObject(entityClass.getName() + POSTFIX_SELECTMAP, map); } catch (Exception e) { logger.error(&quot;Error when propertie on entity,&quot; + e.getMessage(), e.getCause()); return null; } } //<em>/</em> /<em> 根据属性名和属性值以Like AnyWhere方式查询对象. /</em> @throws SQLException /<em>/ public <T> List<T> findByLike(Class<T> entityClass, String name, String value) throws SQLException { Assert.hasText(name); Map<String, Object> map = new HashMap<String, Object>(); map.put(name, value); map.put(&quot;findLikeBy&quot;, &quot;True&quot;); return getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECTMAP, map); } //</em>/<em> /</em> 判断对象某些属性的值在数据库中不存在重复 /<em> /</em> @param tableName /<em> 数据表名字 /</em> @param names /<em> 在POJO里不能重复的属性列表,以逗号分割 如&quot;name,loginid,password&quot; <br> /</em> FIXME how about in different schema? /<em>/ public boolean isNotUnique(Object entity, String tableName, String names) { try { String primarykey; Connection con = getSqlMapClient().getCurrentConnection(); ResultSet dbMetaData = con.getMetaData().getPrimaryKeys(con.getCatalog(), null, tableName); dbMetaData.next(); if (dbMetaData.getRow() &gt; 0) { primarykey = dbMetaData.getString(4); if (names.indexOf(primarykey) &gt; -1) return false; } else { return true; } } catch (SQLException e) { logger.error(e.getMessage(), e); return false; } return false; } //</em>/<em> /</em> 分页查询函数，使用PaginatedList. /<em> /</em> @param pageNo /<em> 页号,从0开始. /</em> @throws SQLException /*/ @SuppressWarnings(&quot;rawtypes&quot;) public DataPage pagedQuery(String sqlName, HashMap<String, Object> hashMap, Integer pageNo, Integer pageSize) throws SQLException { if (pageNo == null || pageSize == null) { List list = getSqlMapClient().queryForList(sqlName, hashMap); if (list == null || list.size() == 0) { return new DataPage(); } else { return new DataPage(0, list.size(), list.size(), list); } } else { Assert.hasText(sqlName); Assert.isTrue(pageNo &gt;= 1, &quot;pageNo should start from 1&quot;); // Count查询 Integer totalCount = (Integer) getSqlMapClient().queryForObject(sqlName + &quot;.Count&quot;, hashMap); if (totalCount &lt; 1) { return new DataPage(); } // 实际查询返回分页对象 int startIndex = DataPage.getStartOfPage(pageNo, pageSize); hashMap.put(&quot;startIndex&quot;, startIndex); hashMap.put(&quot;pageSize&quot;, pageSize); List list = getSqlMapClient().queryForList(sqlName, hashMap); return new DataPage(startIndex, totalCount, pageSize, list); } } public String getMappedSQL(String sqlName) { String sql = null; SqlMapClientImpl sqlmap = (SqlMapClientImpl) getSqlMapClient(); MappedStatement stmt = sqlmap.getMappedStatement(sqlName); StaticSql staticSql = (StaticSql) stmt.getSql(); sql = staticSql.getSql(null, null); return sql; } }</p>
<p><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="copy to clipboard" target="_blank">copy to clipboard</a><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="print" target="_blank">print</a><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="?" target="_blank">?</a></p>
<ol>
<li><p>package com.nfschina.utils.dao.ibatis;  </p>
</li>
<li></li>
<li><p>import java.io.Serializable;  </p>
</li>
<li><p>import java.lang.reflect.InvocationTargetException;  </p>
</li>
<li><p>import java.sql.SQLException;  </p>
</li>
<li><p>import java.util.List;  </p>
</li>
<li><p>import java.util.Map;  </p>
</li>
<li></li>
<li><p>import org.apache.commons.beanutils.PropertyUtils;  </p>
</li>
<li><p>import org.apache.commons.lang.StringUtils;  </p>
</li>
<li><p>import org.springframework.orm.ObjectRetrievalFailureException;  </p>
</li>
<li></li>
<li><p>import com.nfschina.utils.BaseException;  </p>
</li>
<li><p>import com.nfschina.utils.GenericsUtils;  </p>
</li>
<li></li>
<li><p>import   </p>
</li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 负责为单个Entity 提供CRUD操作的IBatis DAO基类. </p>
</li>
<li><p>/* <p/> </p>
</li>
<li><p>/* 子类只要在类定义时指定所管理Entity的Class, 即拥有对单个Entity对象的CRUD操作. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* <pre> </p>
</li>
<li><p>/* public class UserManagerIbatis extends IBatisEntityDao<User> { </p>
</li>
<li><p>/* } </p>
</li>
<li><p>/* </pre> </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public class IBatisEntityDao<T> extends IBatisGenericDao {  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* DAO所管理的Entity类型. </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>protected Class<T> entityClass;  </p>
</li>
<li></li>
<li><p>protected String primaryKeyName;  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 在构造函数中将泛型T.class赋给entityClass. </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>@SuppressWarnings(&quot;unchecked&quot;)  </p>
</li>
<li><p>public IBatisEntityDao() {  </p>
</li>
<li><p>entityClass = (Class<T>) GenericsUtils.getSuperClassGenricType(getClass());  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性名和属性值查询对象. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @return 符合条件的对象列表 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public List<T> findBy(String name, Object value) throws SQLException {  </p>
</li>
<li><p>return findBy(getEntityClass(), name, value);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性的名值对查询对象 </p>
</li>
<li><p>/* @param map </p>
</li>
<li><p>/* @return </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public List<T> find(Map<String, Object> map) throws SQLException{  </p>
</li>
<li><p>return find(getEntityClass(), map);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性的名值对查询唯一对象 </p>
</li>
<li><p>/* @param map </p>
</li>
<li><p>/* @return </p>
</li>
<li><p>/* @throws SQLException </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public T findUniqueByMap(Map<String, Object> map) throws SQLException{  </p>
</li>
<li><p>List<T> list = find(getEntityClass(), map);  </p>
</li>
<li><p>if(list == null || list.size() &lt;= 0){  </p>
</li>
<li><p>return null;  </p>
</li>
<li><p>}   </p>
</li>
<li><p>return list.get(0);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性名和属性值以Like AnyWhere方式查询对象. </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public List<T> findByLike(String name, String value) throws SQLException {  </p>
</li>
<li><p>return findByLike(getEntityClass(), name, value);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性名和属性值查询单个对象. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @return 符合条件的唯一对象 </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public T findUniqueBy(String name, Object value) {  </p>
</li>
<li><p>return findUniqueBy(getEntityClass(), name, value);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据ID获取对象. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @throws BaseException </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public T get(Serializable id) throws BaseException, SQLException {  </p>
</li>
<li><p>return get(getEntityClass(), id);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 获取全部对象. </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public List<T> getAll() throws SQLException {  </p>
</li>
<li><p>return getAll(getEntityClass());  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 取得entityClass. </p>
</li>
<li><p>/* <p/> </p>
</li>
<li><p>/* JDK1.4不支持泛型的子类可以抛开Class<T> entityClass,重载此函数达到相同效果。 </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>protected Class<T> getEntityClass() {  </p>
</li>
<li><p>return entityClass;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>public String getPrimaryKeyName() {  </p>
</li>
<li><p>if (StringUtils.isEmpty(primaryKeyName))  </p>
</li>
<li><p>primaryKeyName = &quot;id&quot;;  </p>
</li>
<li><p>return primaryKeyName;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>protected Object getPrimaryKeyValue(Object o) throws NoSuchMethodException, IllegalAccessException,  </p>
</li>
<li><p>InvocationTargetException, InstantiationException {  </p>
</li>
<li><p>return PropertyUtils.getProperty(entityClass.newInstance(), getPrimaryKeyName());  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据ID移除对象. </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public int removeById(Serializable id) throws SQLException {  </p>
</li>
<li><p>return removeById(getEntityClass(), id);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 保存对象. 为了实现IEntityDao 我在内部使用了insert和upate 2个方法. </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public void saveOrUpdate(Object o) throws SQLException {  </p>
</li>
<li><p>Object primaryKey;  </p>
</li>
<li><p>try {  </p>
</li>
<li><p>primaryKey = getPrimaryKeyValue(o);  </p>
</li>
<li><p>} catch (Exception e) {  </p>
</li>
<li><p>throw new ObjectRetrievalFailureException(entityClass, e);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>if (primaryKey == null)  </p>
</li>
<li><p>insert(o);  </p>
</li>
<li><p>else  </p>
</li>
<li><p>update(o);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>public void setPrimaryKeyName(String primaryKeyName) {  </p>
</li>
<li><p>this.primaryKeyName = primaryKeyName;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>public String getIdName(Class&lt;?&gt; clazz) {  </p>
</li>
<li><p>return &quot;id&quot;;  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}  </p>
</li>
</ol>
<p>package com.nfschina.utils.dao.ibatis; import java.io.Serializable; import java.lang.reflect.InvocationTargetException; import java.sql.SQLException; import java.util.List; import java.util.Map; import org.apache.commons.beanutils.PropertyUtils; import org.apache.commons.lang.StringUtils; import org.springframework.orm.ObjectRetrievalFailureException; import com.nfschina.utils.BaseException; import com.nfschina.utils.GenericsUtils; import //<em>/</em> /<em> 负责为单个Entity 提供CRUD操作的IBatis DAO基类. /</em> <p/> /<em> 子类只要在类定义时指定所管理Entity的Class, 即拥有对单个Entity对象的CRUD操作. /</em> /<em> <pre> /</em> public class UserManagerIbatis extends IBatisEntityDao<User> { /<em> } /</em> </pre> /<em>/ public class IBatisEntityDao<T> extends IBatisGenericDao { //</em>/<em> /</em> DAO所管理的Entity类型. /<em>/ protected Class<T> entityClass; protected String primaryKeyName; //</em>/<em> /</em> 在构造函数中将泛型T.class赋给entityClass. /<em>/ @SuppressWarnings(&quot;unchecked&quot;) public IBatisEntityDao() { entityClass = (Class<T>) GenericsUtils.getSuperClassGenricType(getClass()); } //</em>/<em> /</em> 根据属性名和属性值查询对象. /<em> /</em> @return 符合条件的对象列表 /<em> @throws SQLException /</em>/ public List<T> findBy(String name, Object value) throws SQLException { return findBy(getEntityClass(), name, value); } //<em>/</em> /<em> 根据属性的名值对查询对象 /</em> @param map /<em> @return /</em> @throws SQLException /<em>/ public List<T> find(Map<String, Object> map) throws SQLException{ return find(getEntityClass(), map); } //</em>/<em> /</em> 根据属性的名值对查询唯一对象 /<em> @param map /</em> @return /<em> @throws SQLException /</em>/ public T findUniqueByMap(Map<String, Object> map) throws SQLException{ List<T> list = find(getEntityClass(), map); if(list == null || list.size() &lt;= 0){ return null; } return list.get(0); } //<em>/</em> /<em> 根据属性名和属性值以Like AnyWhere方式查询对象. /</em> @throws SQLException /<em>/ public List<T> findByLike(String name, String value) throws SQLException { return findByLike(getEntityClass(), name, value); } //</em>/<em> /</em> 根据属性名和属性值查询单个对象. /<em> /</em> @return 符合条件的唯一对象 /<em>/ public T findUniqueBy(String name, Object value) { return findUniqueBy(getEntityClass(), name, value); } //</em>/<em> /</em> 根据ID获取对象. /<em> /</em> @throws BaseException /<em> @throws SQLException /</em>/ public T get(Serializable id) throws BaseException, SQLException { return get(getEntityClass(), id); } //<em>/</em> /<em> 获取全部对象. /</em> @throws SQLException /<em>/ public List<T> getAll() throws SQLException { return getAll(getEntityClass()); } //</em>/<em> /</em> 取得entityClass. /<em> <p/> /</em> JDK1.4不支持泛型的子类可以抛开Class<T> entityClass,重载此函数达到相同效果。 /<em>/ protected Class<T> getEntityClass() { return entityClass; } public String getPrimaryKeyName() { if (StringUtils.isEmpty(primaryKeyName)) primaryKeyName = &quot;id&quot;; return primaryKeyName; } protected Object getPrimaryKeyValue(Object o) throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException { return PropertyUtils.getProperty(entityClass.newInstance(), getPrimaryKeyName()); } //</em>/<em> /</em> 根据ID移除对象. /<em> @throws SQLException /</em>/ public int removeById(Serializable id) throws SQLException { return removeById(getEntityClass(), id); } //<em>/</em> /<em> 保存对象. 为了实现IEntityDao 我在内部使用了insert和upate 2个方法. /</em> @throws SQLException /*/ public void saveOrUpdate(Object o) throws SQLException { Object primaryKey; try { primaryKey = getPrimaryKeyValue(o); } catch (Exception e) { throw new ObjectRetrievalFailureException(entityClass, e); } if (primaryKey == null) insert(o); else update(o); } public void setPrimaryKeyName(String primaryKeyName) { this.primaryKeyName = primaryKeyName; } public String getIdName(Class&lt;?&gt; clazz) { return &quot;id&quot;; } }</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/框架汇总/">框架汇总</a></li></span><span class="breadcrumb"><li><a href="/categories/框架汇总/">框架汇总</a></li><li><a href="/categories/框架汇总/ORM/">ORM</a></li><li><a href="/categories/框架汇总/ORM/ibatis/">ibatis</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ORM/" class="label label-primary">ORM</a><a href="/tags/ibatis/" class="label label-success">ibatis</a><a href="/tags/框架汇总/" class="label label-info">框架汇总</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--使用ibatis操作数据库的封装/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-框架汇总-ORM-ibatis--使用ibatis操作数据库的封装" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--对ibatis分页功能的改进/">对ibatis分页功能的改进</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--对ibatis分页功能的改进/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-ibatis-">对ibatis分页功能的改进</h1>
<p><strong>对ibatis**</strong>分页功能的改进**</p>
<p>2008-05-26 14:45
今天无意间看到了一篇关于这方面的文章，觉得是网上改进ibatis分页方面比较好的文章，这里转摘一下，希望能让更多的人用的到，也希望别人能把更好的解决方案贡献出来！</p>
<p>使ibatis支持hibernate式的物理分页</p>
<p>一直以来ibatis的分页都是通过滚动ResultSet实现的，应该算是逻辑分页吧。逻辑分页虽然能很干净地独立于特定数据库，但效率在多数情 况下不及特定数据库支持的物理分页，而hibernate的分页则是直接组装sql，充分利用了特定数据库的分页机制，效率相对较高。本文讲述的就是如何 在不重新编译ibatis源码的前提下，为ibatis引入hibernate式的物理分页机制。</p>
<p>基本思路就是找到ibatis执行sql的地方，截获sql并重新组装sql。通过分析ibatis源码知道，最终负责执行sql的类是 com.ibatis.sqlmap.engine.execution.SqlExecutor，此类没有实现任何接口，这多少有点遗憾，因为接口是相 对稳定契约，非大的版本更新，接口一般是不会变的，而类就相对易变一些，所以这里的代码只能保证对当前版本（2.1.7）的ibatis有效。下面是 SqlExecutor执行查询的方法：</p>
<p>  //<em>/</em>
    /<em> Long form of the method to execute a query
    /</em>
    /<em> @param request - the request scope
    /</em> @param conn - the database connection
    /<em> @param sql - the SQL statement to execute
    /</em> @param parameters - the parameters for the statement
    /<em> @param skipResults - the number of results to skip
    /</em> @param maxResults - the maximum number of results to return
    /<em> @param callback - the row handler for the query
    /</em>
    /<em> @throws SQLException - if the query fails
   /</em>/
  public void executeQuery(RequestScope request, Connection conn, String sql, Object[] parameters,
                           int skipResults, int maxResults, RowHandlerCallback callback)
      throws SQLException {
     ErrorContext errorContext = request.getErrorContext();
     errorContext.setActivity(&quot;executing query&quot;);
     errorContext.setObjectId(sql);
     PreparedStatement ps = null;
     ResultSet rs = null;
    try {
       errorContext.setMoreInfo(&quot;Check the SQL Statement (preparation failed).&quot;);
       Integer rsType = request.getStatement().getResultSetType();
      if (rsType != null) {
         ps = conn.prepareStatement(sql, rsType.intValue(), ResultSet.CONCUR_READ_ONLY);
       } else {
         ps = conn.prepareStatement(sql);
       }
       Integer fetchSize = request.getStatement().getFetchSize();
      if (fetchSize != null) {
         ps.setFetchSize(fetchSize.intValue());
       }
       errorContext.setMoreInfo(&quot;Check the parameters (set parameters failed).&quot;);
       request.getParameterMap().setParameters(request, ps, parameters);
       errorContext.setMoreInfo(&quot;Check the statement (query failed).&quot;);
       ps.execute();
       rs = getFirstResultSet(ps);
      if (rs != null) {
         errorContext.setMoreInfo(&quot;Check the results (failed to retrieve results).&quot;);
         handleResults(request, rs, skipResults, maxResults, callback);
       }
      // clear out remaining results
      while (ps.getMoreResults());
     } finally {
      try {
         closeResultSet(rs);
       } finally {
         closeStatement(ps);
       }
     }
   }</p>
<p>其中handleResults(request, rs, skipResults, maxResults, callback)一句用于处理分页，其实此时查询已经执行完毕，可以不必关心handleResults方法，但为清楚起见，下面来看看 handleResults的实现：</p>
<p>private void handleResults(RequestScope request, ResultSet rs, int skipResults, int maxResults, RowHandlerCallback callback) throws SQLException {
    try {
       request.setResultSet(rs);
       ResultMap resultMap = request.getResultMap();
      if (resultMap != null) {
        // Skip Results
        if (rs.getType() != ResultSet.TYPE_FORWARD_ONLY) {
          if (skipResults &gt; 0) {
             rs.absolute(skipResults);
           }
         } else {
          for (int i = 0; i &lt; skipResults; i++) {
            if (!rs.next()) {
              break;
             }
           }
         }
        // Get Results
        int resultsFetched = 0;
        while ((maxResults == SqlExecutor.NO_MAXIMUM_RESULTS || resultsFetched &lt; maxResults) &amp;&amp; rs.next()) {
           Object[] columnValues = resultMap.resolveSubMap(request, rs).getResults(request, rs);
           callback.handleResultObject(request, columnValues, rs);
           resultsFetched++;
         }
       }
     } finally {
       request.setResultSet(null);
     }
   }</p>
<p>此处优先使用的是ResultSet的absolute方法定位记录，是否支持absolute取决于具体数据库驱动，但一般当前版本的数据库都支 持该方法，如果不支持则逐条跳过前面的记录。由此可以看出如果数据库支持absolute，则ibatis内置的分页策略与特定数据库的物理分页效率差距 就在于物理分页查询与不分页查询在数据库中的执行效率的差距了。因为查询执行后读取数据前数据库并未把结果全部返回到内存，所以本身在存储占用上应该差距 不大，如果都使用索引，估计执行速度也差不太多。</p>
<p>继续我们的话题。其实只要在executeQuery执行前组装sql，然后将其传给executeQuery，并告诉handleResults 我们不需要逻辑分页即可。拦截executeQuery可以采用aop动态实现，也可直接继承SqlExecutor覆盖executeQuery来静态 地实现，相比之下后者要简单许多，而且由于SqlExecutor没有实现任何接口，比较易变，动态拦截反到增加了维护的工作量，所以我们下面来覆盖 executeQuery：</p>
<p>package com.aladdin.dao.ibatis.ext;
import java.sql.Connection;
import java.sql.SQLException;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import com.aladdin.dao.dialect.Dialect;
import com.ibatis.sqlmap.engine.execution.SqlExecutor;
import com.ibatis.sqlmap.engine.mapping.statement.RowHandlerCallback;
import com.ibatis.sqlmap.engine.scope.RequestScope;
public class LimitSqlExecutor extends SqlExecutor {
    private static final Log logger = LogFactory.getLog(LimitSqlExecutor.class);</p>
<pre><code>private Dialect dialect;
private boolean enableLimit = true;
public Dialect getDialect() {
    return dialect;
 }
public void setDialect(Dialect dialect) {
    this.dialect = dialect;
 }
public boolean isEnableLimit() {
    return enableLimit;
 }
public void setEnableLimit(boolean enableLimit) {
    this.enableLimit = enableLimit;
 }
 @Override
public void executeQuery(RequestScope request, Connection conn, String sql,
         Object[] parameters, int skipResults, int maxResults,
         RowHandlerCallback callback) throws SQLException {
    if ((skipResults != NO_SKIPPED_RESULTS || maxResults != NO_MAXIMUM_RESULTS)
            &amp;&amp; supportsLimit()) {
         sql = dialect.getLimitString(sql, skipResults, maxResults);
        if(logger.isDebugEnabled()){
             logger.debug(sql);
         }
         skipResults = NO_SKIPPED_RESULTS;
         maxResults = NO_MAXIMUM_RESULTS;            
     }
    super.executeQuery(request, conn, sql, parameters, skipResults,
             maxResults, callback);
 }
public boolean supportsLimit() {
    if (enableLimit &amp;&amp; dialect != null) {
        return dialect.supportsLimit();
     }
    return false;
 }
</code></pre><p>}</p>
<p>其中：</p>
<p>skipResults = NO_SKIPPED_RESULTS;
maxResults = NO_MAXIMUM_RESULTS;</p>
<p>告诉handleResults不分页（我们组装的sql已经使查询结果是分页后的结果了），此处引入了类似hibenate中的数据库方言接口Dialect，其代码如下：</p>
<p>package com.aladdin.dao.dialect;
public interface Dialect {</p>
<pre><code>public boolean supportsLimit();
public String getLimitString(String sql, boolean hasOffset);
public String getLimitString(String sql, int offset, int limit);
</code></pre><p>}</p>
<p>下面为Dialect接口的MySQL实现：</p>
<p>package com.aladdin.dao.dialect;
public class MySQLDialect implements Dialect {
    protected static final String SQL_END_DELIMITER = &quot;;&quot;;
    public String getLimitString(String sql, boolean hasOffset) {
        return new StringBuffer(sql.length() + 20).append(trim(sql)).append(
                 hasOffset ? &quot; limit ?,?&quot; : &quot; limit ?&quot;)
                 .append(SQL_END_DELIMITER).toString();
     }
    public String getLimitString(String sql, int offset, int limit) {
         sql = trim(sql);
         StringBuffer sb = new StringBuffer(sql.length() + 20);
         sb.append(sql);
        if (offset &gt; 0) {
             sb.append(&quot; limit &quot;).append(offset).append(&#39;,&#39;).append(limit)
                     .append(SQL_END_DELIMITER);
         } else {
             sb.append(&quot; limit &quot;).append(limit).append(SQL_END_DELIMITER);
         }
        return sb.toString();
     }
    public boolean supportsLimit() {
        return true;
     }
    private String trim(String sql) {
         sql = sql.trim();
        if (sql.endsWith(SQL_END_DELIMITER)) {
             sql = sql.substring(0, sql.length() - 1</p>
<pre><code>                - SQL_END_DELIMITER.length());
     }
    return sql;
 }
</code></pre><p>}</p>
<p>接下来的工作就是把LimitSqlExecutor注入ibatis中。我们是通过spring来使用ibatis的，所以在我们的dao基类中执行注入，代码如下：</p>
<p>package com.aladdin.dao.ibatis;
import java.io.Serializable;
import java.util.List;
import org.springframework.orm.ObjectRetrievalFailureException;
import org.springframework.orm.ibatis.support.SqlMapClientDaoSupport;
import com.aladdin.dao.ibatis.ext.LimitSqlExecutor;
import com.aladdin.domain.BaseObject;
import com.aladdin.util.ReflectUtil;
import com.ibatis.sqlmap.client.SqlMapClient;
import com.ibatis.sqlmap.engine.execution.SqlExecutor;
import com.ibatis.sqlmap.engine.impl.ExtendedSqlMapClient;
public abstract class BaseDaoiBatis extends SqlMapClientDaoSupport {
    private SqlExecutor sqlExecutor;
    public SqlExecutor getSqlExecutor() {
        return sqlExecutor;
     }
    public void setSqlExecutor(SqlExecutor sqlExecutor) {
        this.sqlExecutor = sqlExecutor;
     }
    public void setEnableLimit(boolean enableLimit) {
        if (sqlExecutor instanceof LimitSqlExecutor) {
             ((LimitSqlExecutor) sqlExecutor).setEnableLimit(enableLimit);
         }
     }
    public void initialize() throws Exception {
        if (sqlExecutor != null) {
             SqlMapClient sqlMapClient = getSqlMapClientTemplate()
                     .getSqlMapClient();
            if (sqlMapClient instanceof ExtendedSqlMapClient) {
                 ReflectUtil.setFieldValue(((ExtendedSqlMapClient) sqlMapClient)
                         .getDelegate(), &quot;sqlExecutor&quot;, SqlExecutor.class,
                         sqlExecutor);
             }
         }
     }
     ...
}</p>
<hr>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/框架汇总/">框架汇总</a></li></span><span class="breadcrumb"><li><a href="/categories/框架汇总/">框架汇总</a></li><li><a href="/categories/框架汇总/ORM/">ORM</a></li><li><a href="/categories/框架汇总/ORM/ibatis/">ibatis</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ORM/" class="label label-primary">ORM</a><a href="/tags/ibatis/" class="label label-success">ibatis</a><a href="/tags/框架汇总/" class="label label-info">框架汇总</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--对ibatis分页功能的改进/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-框架汇总-ORM-ibatis--对ibatis分页功能的改进" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-架构师--五年经验跳槽历程-Eric77的专栏/">五年经验跳槽历程 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-架构师--五年经验跳槽历程-Eric77的专栏/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-eric77-">五年经验跳槽历程 - Eric77的专栏</h1>
<h1 id="-eric77-http-blog-csdn-net-eric77-"><a href="http://blog.csdn.net/Eric77" target="_blank">Eric77的专栏</a></h1>
<h2 id="-">上士闻道,勤而行之;中士闻道,若存若亡;下士闻道,大笑之,不笑不足以为道. 后悔过去不如奋斗将来!</h2>
<ul>
<li><a href="http://hi.csdn.net/space-notice.html" target="_blank">条新通知</a></li>
<li><a href="http://passport.csdn.net/UserLogin.aspx" target="_blank">登录</a></li>
<li><a href="http://passport.csdn.net/CSDNUserRegister.aspx" target="_blank">注册</a></li>
<li><a href="http://hi.csdn.net/" target="_blank">欢迎</a></li>
<li><a href="http://writeblog.csdn.net/Signout.aspx" target="_blank">退出</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">我的博客</a></li>
<li><a href="http://writeblog.csdn.net/configure.aspx" target="_blank">配置</a></li>
<li><a href="http://writeblog.csdn.net/PostEdit.aspx" target="_blank">写文章</a></li>
<li><a href="http://writeblog.csdn.net/PostList.aspx" target="_blank">文章管理</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">博客首页</a></li>
</ul>
<p>*</p>
<ul>
<li><p>全站 当前博客
*</p>
</li>
<li><p><a href="http://hi.csdn.net/Eric77" target="_blank">空间</a></p>
</li>
<li><a href="http://blog.csdn.net/Eric77" target="_blank">博客</a></li>
<li><a href="http://hi.csdn.net/!s/friend/list/Eric77" target="_blank">好友</a></li>
<li><a href="http://hi.csdn.net/!s/album/list/Eric77" target="_blank">相册</a></li>
<li><a href="http://hi.csdn.net/!s/wall/to/Eric77" target="_blank">留言</a></li>
</ul>
<p>用户操作<a href="http://hi.csdn.net/!s/wall/to/Eric77" target="_blank">[留言]</a>  <a href="http://hi.csdn.net/!s/msg/to/Eric77" target="_blank">[发消息]</a>  <a href="http://hi.csdn.net/!s/friend/add/Eric77" target="_blank">[加为好友]</a> 订阅我的博客<a href="http://feeds.feedsky.com/csdn.net/Eric77" target="_blank"><img src="" alt="XML聚合"></a>   <a href="http://feeds.feedsky.com/csdn.net/Eric77" target="_blank"><img src="" alt="FeedSky"></a><a href="http://www.xianguo.com/subscribe.php?url=http://feeds.feedsky.com/csdn.net/Eric77" target="_blank"><img src="" alt="订阅到鲜果"></a><a href="http://fusion.google.com/add?feedurl=http://feeds.feedsky.com/csdn.net/Eric77" target="_blank"><img src="" alt="订阅到Google"></a><a href="http://www.zhuaxia.com/add_channel.php?url=http://feeds.feedsky.com/csdn.net/Eric77" target="_blank"><img src="" alt="订阅到抓虾"></a><a href="http://writeblog.csdn.net/configure.aspx" target="_blank">[编辑]</a>Eric77的公告<a href="http://writeblog.csdn.net/EditCategories.aspx?catID=1" target="_blank">[编辑]</a>文章分类* <a href="http://blog.csdn.net/Eric77/category/503384.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/Eric77/category/503384.aspx" title="&lt;塞梅普雷斯 如是说&gt; 第一部  系列" target="_blank">&lt;塞梅普雷斯 如是说&gt; 第一部</a></p>
<ul>
<li><a href="http://blog.csdn.net/Eric77/category/503385.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/Eric77/category/503385.aspx" title="我带你去哪里 系列" target="_blank">&lt;我带你去哪里&gt;</a></li>
<li><a href="http://blog.csdn.net/Eric77/category/635207.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/Eric77/category/635207.aspx" title="五花八门的经验总结" target="_blank">经验总结</a></li>
<li><a href="http://blog.csdn.net/Eric77/category/513046.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/Eric77/category/513046.aspx" title="一些复杂的思考" target="_blank">科学/神秘主义</a><a href="http://writeblog.csdn.net/EditLinks.aspx" target="_blank">[编辑]</a>What I think<a href="http://douban.com/people/eric77/" target="_blank">我的豆瓣</a><a href="http://writeblog.csdn.net/EditLinks.aspx" target="_blank">[编辑]</a>朋友们的<a href="http://hi.baidu.com/moliny" target="_blank">一花一世界</a><a href="http://yashuawu.blog.sohu.com/" target="_blank">五四青年</a><a href="http://blog.sina.com.cn/bubble521" target="_blank">小女子的大世界</a><a href="http://blog.sina.com.cn/5sui" target="_blank">小朋友的小花园</a><a href="http://yimei1013.blog.sohu.com/" target="_blank">左掌的春暖花开</a><a href="http://harry-zhy.blog.sohu.com/" target="_blank">异次元-十三少</a><a href="http://www.lixin.name/" target="_blank">绿洲家后院儿</a><a href="http://jseafly.blog.sohu.com/" target="_blank">飘来的海</a><a href="http://writeblog.csdn.net/EditLinks.aspx" target="_blank">[编辑]</a>在别人的BLOG<a href="http://www.blogcn.com/user13/lonestone/index.html" target="_blank">一个人的狂欢</a><a href="http://blog.tianya.cn/blogger/view_blog.asp?BlogName=wanran" target="_blank">宛然流轉</a>存档* <a href="http://blog.csdn.net/Eric77/archive/2010/08.aspx" target="_blank">2010年08月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2010/07.aspx" target="_blank">2010年07月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2010/06.aspx" target="_blank">2010年06月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2010/05.aspx" target="_blank">2010年05月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2010/03.aspx" target="_blank">2010年03月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/12.aspx" target="_blank">2009年12月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/11.aspx" target="_blank">2009年11月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/09.aspx" target="_blank">2009年09月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/08.aspx" target="_blank">2009年08月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/06.aspx" target="_blank">2009年06月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/04.aspx" target="_blank">2009年04月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/03.aspx" target="_blank">2009年03月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/02.aspx" target="_blank">2009年02月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/12.aspx" target="_blank">2008年12月(4)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/10.aspx" target="_blank">2008年10月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/08.aspx" target="_blank">2008年08月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/07.aspx" target="_blank">2008年07月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/06.aspx" target="_blank">2008年06月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/05.aspx" target="_blank">2008年05月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/04.aspx" target="_blank">2008年04月(4)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/02.aspx" target="_blank">2008年02月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/01.aspx" target="_blank">2008年01月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/12.aspx" target="_blank">2007年12月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/11.aspx" target="_blank">2007年11月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/10.aspx" target="_blank">2007年10月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/08.aspx" target="_blank">2007年08月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/07.aspx" target="_blank">2007年07月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/06.aspx" target="_blank">2007年06月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/05.aspx" target="_blank">2007年05月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/04.aspx" target="_blank">2007年04月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/03.aspx" target="_blank">2007年03月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/02.aspx" target="_blank">2007年02月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/01.aspx" target="_blank">2007年01月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/12.aspx" target="_blank">2006年12月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/11.aspx" target="_blank">2006年11月(9)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/09.aspx" target="_blank">2006年09月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/08.aspx" target="_blank">2006年08月(4)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/06.aspx" target="_blank">2006年06月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/05.aspx" target="_blank">2006年05月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/01.aspx" target="_blank">2006年01月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2005/09.aspx" target="_blank">2005年09月(14)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2005/08.aspx" target="_blank">2005年08月(4)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2005/07.aspx" target="_blank">2005年07月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2005/02.aspx" target="_blank">2005年02月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2005/01.aspx" target="_blank">2005年01月(9)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/12.aspx" target="_blank">2004年12月(17)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/11.aspx" target="_blank">2004年11月(10)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/10.aspx" target="_blank">2004年10月(23)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/09.aspx" target="_blank">2004年09月(14)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/08.aspx" target="_blank">2004年08月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/07.aspx" target="_blank">2004年07月(5)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/06.aspx" target="_blank">2004年06月(6)</a><h3 id="-http-forum-csdn-net-slist-blogsupport-http-blog-csdn-net-blogdevteam-">公告： <a href="http://forum.csdn.net/SList/blogSupport" target="_blank">[意见反馈]</a><a href="http://blog.csdn.net/blogdevteam" target="_blank">[官方博客]</a></h3>
</li>
</ul>
<h1 id="-"><img src="" alt="原创">  五年经验跳槽历程 <a href="&quot;收藏到我的网摘中，并分享给我的朋友&quot;">收藏</a>  <img src="" alt=""></h1>
<p>此文于2010-07-27被推荐到CSDN首页
<a href="http://blog.csdn.net/blogdevteam/archive/2009/08/25/4481848.aspx" target="_blank">如何被推荐？</a></p>
<p>//2010-07-23 21:29</p>
<p>经过两个月的折腾,终于在这个周三得到了IBM的offer,从5月18日到现在,两个多月过去了.</p>
<p>睡觉前,我要简要记录一下这次跳槽的故事,下周一就要去报到了,害怕以后没时间写出来,或者淡忘了.</p>
<p>这次跳槽,首先我的目标很明确:1.要离家近的(30分钟以内,南山区) 2.大公司(成规模的,有良好管理和发展的公司) 3.适合我自己职业发展的公司 4.待遇还不错的公司</p>
<p>一开始的首选计划是: 招商研发中心,IBM,腾讯. 招商没有投简历,因为听他的人资说之前招了一大堆人,又由于没有淘汰机制,现在已经人满为患了. IBM让5号(一朋友的昵称)帮我投了简历,自己也瞎去投了投. 腾讯也投了.</p>
<p>开始在网上更新简历后,第一个和我联系的就是外包公司,第二天一早就和我联系了,可惜我对外包公司不太感兴趣,主要是因为在外包公司完全没有归属感.外包公司大约有6家,我都一一拒绝了. 还有一个是morningstar股票评级机构在深圳的公司,挺不错,可惜在福田那边,有点远,就没有联系.还有一个叫中青宝,做游戏的上市公司,他的人资说他们领导看到我的简历,相约我找个时间聊聊,我查了下这个公司,也不错,可惜后来也没有和他们联系. 还有一个是A8音乐网,这个公司在香港上市,应该也不错,他们的人资挺负责,跟我联系了两次,还让我多了解一下他们公司,本来也想有机会去一下的,可惜还是没有和他们联系.</p>
<p>有一天,接到了一个中兴的电话,开始也想推掉,但是打电话的人态度很好,还说过来瞧一瞧嘛.后来我就请了一天假,因为中兴的班车起点站就在我家楼下,很方便,而且我家对门也是中兴的.我就和她一起坐班车去了西丽的中兴园区. 见到人,很和善,领我上了楼,办公地点很宽广,他发给了我一张试卷,说30分钟简单做一下吧.试题很简单,大部分都是多线程和java传值传引用的试题.我对我的答案很有信心. 不一会儿答完了检查了一遍就给了那个人. 他边领我去会议室边看了看我的答案,应该很满意,和我聊了聊,由于我以前在华为干过,所以很多东西一说大家都知道,方便许多.他说想招个人做Swing,我明确说我对做Swing不感兴趣,我的强项是做后台,多线程和设计之类.他说没关系,反正这是公司的名额,不招就浪费了,来了做服务器端也可以,不会让你做界面的. 我一听能让我做我擅长的方面,很高兴. 接着他就问我想开多少工资,我说12000,他没说啥,跟我讲了他们这里有年终奖,绩效奖,项目奖之类的. 然后说能不能少点,我说最少10000吧.他苦笑了下,说还是有点多,不过你真想来,我就找我老大过来跟你聊聊,我说好吧.然后他就找了一个笑眯眯的中年人(45岁左右)过来了,我给他说我考过了软件设计师证书,他很高兴,简单的问了我两句,就谈到工资,我说12000,他也说给不了那么多,我就说10000,他就问我现在多少钱,我说8000,他说给你8500,你看行不行,这个价格在我们这里已经很高了.我一想,虽然比现在高一点,但是离家近,工作轻松,还有房补和奖金什么的,而且这是第一个面试,先留条后路,就答应了.(后来我辞职那几天,我公司的另外一个同事辞职,正好碰见,他也说他去了中兴面试,最高也只能给8500,后来他去了UT,UT能给到万). 这里的唯一不好就是,我怕我来到这里就变成养老了,中兴基本是个国企类型的,混好别惹事,就会安然无恙.可是对我的职业发展真的是不太好,因为之前做的J2EE开发来这里八成都用不着,而且考试题都是JDK1.4的,5.0以上的语法和特性之类都没有见到. 总之,这个工作,优点不少,缺点也比较严重.</p>
<p>然后就是腾讯面试,第一次笔试,过了,第二个星期约了我去二面,两个人面我,据一个跳到那里的同事说,这各部门是做QQ的那个部门,好牛好核心.问了我不少关于大容量并发处理,数据库调优,性能方面的东西,可惜,我之前的工作对这方面接触实在是太少.挂掉了.又过了几个星期,听说他们周六周日开专场招聘会,我印了3分简历,10点多过去投了两份.结果直接让我上去进行面试了. 其中一个部门又是运营支撑组的,好像叫这个名,还有一个是3G部门. 运营支撑组先让我答了一套题,应该答的也不错,然后是一个女的面试我,面的都比较基本,也不错. 她还说,我们这边招来,主要是做QQ内部监控和一些内部系统,但是如果外部项目来了,也要开始做外部系统,我们每个人的工作都安排到两年后了.然后我们这里的人要会Java,Struts,Spring,Hibernate,Javascript,Flex等若干门技术,而且可能要经常加班,哎,我说我怎么看腾讯这帮人脸色都发黑呢,真的,从我第一次面试到这一次,看到接待我的男人,基本脸上都有一层黑气,脸色很暗而且眼圈也是黑的.我一直都很纳闷,听她这么一说,我也大致清楚了一些,倒吸了一口凉气.她面完了我,说不错,通过了,下一面就是他们老大,叫happy(音译),这位老大看起来很严很狠,但是说起话来轻声轻气,让人得侧着耳朵仔细听才能听清楚.他问了我半天,关于怎么分1000个苹果到10个箱子,还有一些智力算法的题,我都一一给了答复,这时已经到下午3点左右了,他又让我把我设计的超过long范围的大数加法思路说了一遍,我说完后,他说,问了这么久,你还没有写过什么呢,这样吧,你把两个你设计的大数乘法算法写出来,我一听晕了,饿阿,那就写吧.在这层面试期间,3G部门的面试官上午11点就给我打电话要我去9楼面试,我说等一等,一下就等到了下午,他又打了几次电话,说再不来他就要走了,我慌忙写完乘法,给了happy看,他看了看,说写的太对阿,因为期间用了加法的算法,我没有写实现,他又让我把加法的实现也写一遍,我跑到屋里,把加法的算法刚写了个初稿,3G部门的那位面试管又给我打电话了,说再不来他就走了.我问了一下他那里面试要多久,他说很快,聊两句吧.我就跑去happy那里,说,我先下去一下,等下上来在把算法抄清楚了.其实那时,我有点不耐烦了,听到那么恐怖的工作要求和加班,而且对这个老大有点不喜欢,就有些不想面试的想法.后来到了3G部门,和那个人聊了几句,我以前一个小组的人就跳到了这个部门,一说,还都认识,之前的同事也提到过我,聊了一会,他们是做手机方面的,也要求对Javascript很高.然后我又回到了之前的部门,把最后的加法部分整齐的抄到了纸上,那时大约快下午5点了.而且当时听到其中一个人和happy说:哎,这一天又没招到一个人,我们招人,一定要从开始假设他什么也不会,他要从头去证明给我们看.我听了以后,觉得这个部门的人心理状态有点变态.交了卷,和happy说一下就走了. 可能是我和腾讯没有缘分吧. 以后再也不来这里面试了.</p>
<p>然后,有一天,又接到了一个猎头的电话,还是让我去杭州的阿里巴巴,说了很多诱人的话,我想了想,也许可以去试试,然后就答应了她,说先面试一下吧.之后,有一天是中午1点左右,阿里集团的人给我打了电话,聊了40分钟,很不错,考察的很仔细,很全面,沟通也很好,根本不像腾讯那样就捡你不会的问.后来他说,他这一面过了,又问了问我的情况,是否愿意来杭州之类的.然后和我说,让我等2面.过了几天,晚上6点50的时候,又有电话打来,又问了不少问题,这次更深入,把我当成架构师的等级来问的,像分布式Hadoop的细节,你熟悉哪几类通讯协议,有哪些优点和缺点,和很多的方方面面.问题还都算实在.我答的也不错.只有几个真不太专业,比如数据库分表 和 调优,我对mysql这些方面还真没怎么搞过, 但这些方面在大容量系统里真的很重要,以后要主要学习研究下. 最后他也问了一下我来杭州工作没意见吧之类的问题. 第二天,我看了那本叫做&lt;幸运的人更幸运&gt;的书,我问了我自己,这个工作是否真的是我想要的,我有没有欺骗自己,我是否愿意把老婆一个人丢在这里生了小孩我也不在身边,干几年如果不在那边呆了我还要回来重新到新公司积累,或者到那边发展,这边的户口房子和七七八八乱七八糟的事情的处理. 我反复的想了想,我发现我十分不愿背井离乡去杭州做这份工作后,第一时间就联系了我那个猎头,说明了这边也有我想要的工作,抱歉,可能不会去杭州了之类的话. 猎头表示理解,并希望以后再联系之类的.</p>
<p>其实,在接到阿里第二个面试之前,我已经完成了IBM的一面和二面了. 一面是在一个星期六的中午,上海IBM那边提前一天给我打了电话进行预约时间,让我做好准备. 对方在上海有一个IBM招聘会,由于我在深圳,所以只能电话联系,我答的很好,主要是面试了这么久,有了很多经验,并且问的问题实在是很基本,真的很实在. 后来他很高兴的和我说,恭喜你通过了,等下周人资会安排你下一次面试的具体细节. 我去网上查了下,一般IBM就两面,再后来,果然又要电话远程给我二面,我提出要求,能否找个人来当面面一下,聊两句,见不到人发挥不了我的长处. 那位人资一开始和我约了电话面试时间,不一会儿又打来,说,周六去长城大厦那边专门找了个人给我面试. 我说好吧. 周六面试也不错,沟通很好. 再后来,我等了一个星期,怎么没有动静,我快离职之前发了邮件问当时的人资还有没有戏,她很快回过电话来说当然有了. 您还愿意来吗? 我晕,难道最后这一次你要主动联系他们? 我说当然愿意来啦.然后就谈到工资,我要13000.她当时把我夸了一通,说我的技术above average,英语很好,还有管理经验,可以给你订到band7,工资呢,可惜给不了这么多,11000怎么样? 我当时也没多想,11000也行,现在想起来应该跟她谈一下12000了,让她觉得我比较好对付.后来她又让我把现在的工资单发给她.还承诺说跟我谈的这个工资没有任何关系,也不会少.只是证明你再现在的公司干过.后来我发给她(工资单加奖金数目是7500+),下午的时候,她打电话过来说,哎呀,11000没批过,老大说你工作年限太短了(我5年经验还短!!!),10000行不行? 我十分不愿意,可是怎么办? 我问她我有选择没,她笑了. 后悔啊后悔啊. 她接着又说,我看了你的简历,你的经验和水平不错,现在就差像我们这样的跨国公司的经历了,有了这样的经历,你以后出去再找工作也不难. 没办法,我抱着先打入IBM内部的思想,就咬着牙同意了,然后叮嘱她说,不要等下打电话和我说又没批过变9000了阿.她说不会,10000都批完了. 哎呀呀.</p>
<p>总之吧,前途和发展方向才是最重要的,对吧.</p>
<p>最后的时刻,没想到还真能进入IBM,我都准备收拾东西去中兴上班养老了呢.</p>
<p>今天去华强北买了G2000的白衬衣和西裤(便宜又实惠),然后去外贸市场买了条范思哲的皮带,还是真皮的呢,厉害. 以后上班要穿正装了,还真有点不习惯,希望能在IBM有好的发展吧.</p>
<p>发现,机会真的是给有准备的人,我这么多年来,一直坚持每周都看N部欧美电影,玩XO的正版游戏,玩MassEffect和DragonAge的全英文对话游戏,对我的英语保持和发展还真有不少作用呢.平时的积累很重要,还有要抓住机会,你是否还应得到更好的?</p>
<p>海阔凭鱼跃,天高任鸟飞. Good Luck.</p>
<p>//23:47</p>
<p>发表于 @ 2010年07月23日　23:54:00 | <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#FeedBack" title="评论" target="_blank">评论( loading...  )</a>| <a href="http://writeblog.csdn.net/PostEdit.aspx?entryId=5759042" title="编辑" target="_blank">编辑</a>| <a href="mailto:webmaster@csdn.net?subject=Article Report!!!&amp;body=Author:Eric77URL:http://blog.csdn.net/ArticleContent.aspx?UserName=Eric77&amp;Entryid=5759042">举报</a>| <a href="&quot;收藏到我的网摘中，并分享给我的朋友&quot;">收藏</a></p>
<h3 id="-http-blog-csdn-net-eric77-archive-2010-06-30-5704612-aspx-http-blog-csdn-net-eric77-archive-2010-08-01-5781573-aspx-"><a href="http://blog.csdn.net/Eric77/archive/2010/06/30/5704612.aspx" target="_blank">旧一篇:幸运的人更幸运 - 节选</a> | <a href="http://blog.csdn.net/Eric77/archive/2010/08/01/5781573.aspx" target="_blank">新一篇:软件开发的一些感想(五年工作总结版)</a></h3>
<p><a href="http://blog.csdn.net/" target="_blank">查看最新精华文章 请访问博客首页</a>相关文章<a href=""></a></p>
<ul>
<li><p>发表评论</p>
</li>
<li><p>表 情：</p>
</li>
<li><p><a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;顶&quot;" alt="顶"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;砸&quot;" alt="砸"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;棒&quot;" alt="棒"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;大笑&quot;" alt="大笑"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;愤怒&quot;" alt="愤怒"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;大哭&quot;" alt="大哭"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;疑问&quot;" alt="疑问"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;汗&quot;" alt="汗"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;呕吐&quot;" alt="呕吐"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;送花&quot;" alt="送花"></a></p>
</li>
<li><p>评论内容：
*</p>
</li>
<li>用 户 名：</li>
<li><p><a href="">登录</a> <a href="http://passport.csdn.net/CSDNUserRegister.aspx" target="_blank">注册</a> 匿名评论</p>
</li>
<li><p>验 证 码：</p>
</li>
<li><a href=""><img src="" alt="验证码"></a> <a href="">重新获得验证码</a></li>
</ul>
<p><em>
</em></p>
<h3 id="-">热门招聘职位<img src="" alt=""></h3>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/架构师/">架构师</a></li></span></span> | <span class="tags">Tagged <a href="/tags/架构师/" class="label label-primary">架构师</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-架构师--五年经验跳槽历程-Eric77的专栏/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-架构师--五年经验跳槽历程-Eric77的专栏" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-框架汇总-ORM-hibernate--Hibernate知识总结/">Hibernate知识总结</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-框架汇总-ORM-hibernate--Hibernate知识总结/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="hibernate-">Hibernate知识总结</h1>
<p><a href=""></a></p>
<h1 id="-li-boy-http-libooy-diandian-com-"><a href="http://libooy.diandian.com/" target="_blank">Li-boy 奋斗的蜗牛</a></h1>
<ul>
<li><a href="http://libooy.diandian.com/submit" target="_blank">投稿</a></li>
<li><a href="http://libooy.diandian.com/inbox" target="_blank">私信</a></li>
<li><a href="http://libooy.diandian.com/archive" target="_blank">存档</a></li>
<li><a href="http://libooy.diandian.com/random" target="_blank">随机文章</a></li>
<li><a href="">关于</a>
<img src="" alt="Li-boy 奋斗的蜗牛"></li>
</ul>
<h3 id="-">关于我</h3>
<p>一天进步一点点！！！</p>
<p>26 Mar</p>
<h1 id="hibernate-">Hibernate知识总结</h1>
<p><img src="" alt=""></p>
<hr>
<p><strong>1.Hibernate持久化对象的生命周期 (状态)  </strong></p>
<p>(1) 瞬态（自由态） (2) 持久态 (3) 托管（游离态）</p>
<p><strong>1.1自由态</strong></p>
<p>   持久化对象的自由态，指的是对象在内存中存在，但是在数据库中并</p>
<p>没有数据与其关联。比如Student student = new Student()，这里</p>
<p>的student对象就是一个自由态的持久化对象。</p>
<p><strong>1.2持久态</strong></p>
<p>   持久态指的是持久化对象处于由Hibernate管理的状态，这种状态下</p>
<p>持久化对象的变化将会被同步到数据库中。</p>
<p>session.beginTransaction();</p>
<p>User user = new User();</p>
<p>user.setUserName(&quot;James&quot;);</p>
<p>user.setUserPwd(&quot;123&quot;);</p>
<p>session.save(user);</p>
<p>session.getTransaction().commit();</p>
<p><strong>1.3游离态</strong></p>
<p>处于持久态的对象，在其对应的Session实例关闭后，此时对象迚入</p>
<p>游离态。也就是说Session实例是持久态对象的宿主环境，一旦宿主</p>
<p>环境失效，那么持久态对象迚入游离状态。</p>
<p>session.beginTransaction();</p>
<p>User user = new User();</p>
<p>user.setUserName(&quot;James&quot;);</p>
<p>user.setUserPwd(&quot;123&quot;);</p>
<p>Integer id = (Integer) session.save(user);</p>
<p>user.setUserPwd(&quot;456&quot;);</p>
<p>session.getTransaction().commit();</p>
<p>user.setUserPwd(&quot;789&quot;);</p>
<p><strong>游离态和自由态的区别</strong></p>
<p>区别就在于游离态对象可以再次与Session迚行关联而成为持久态对</p>
<p>象。</p>
<p>session.beginTransaction();</p>
<p>User user = new User();</p>
<p>user.setUserName(&quot;James&quot;);</p>
<p>user.setUserPwd(&quot;123&quot;);</p>
<p>Integer id = (Integer) session.save(user);</p>
<p>user.setUserPwd(&quot;456&quot;);</p>
<p>session.getTransaction().commit();</p>
<p>Session session2 = HibernateUtil.getSessionFactory().getCurrentS</p>
<p>session2.beginTransaction();</p>
<p>user.setUserPwd(&quot;789&quot;);</p>
<p>session2.update(user);</p>
<p>session2.getTransaction().commit();</p>
<p>自由态对象在数据库中没有数据与其对应，但是游离态对象在数据库</p>
<p>中有数据与其对应，只不过当前对象不在Session环境中而已。从对</p>
<p>象的是否有主键值可以做简单的判断。</p>
<p>session.beginTransaction();</p>
<p>User user = new User();</p>
<p>user.setUserName(&quot;James&quot;);</p>
<p>user.setUserPwd(&quot;123&quot;);</p>
<p>System.out.println(user.getId());</p>
<p>Integer id = (Integer) session.save(user);</p>
<p>session.getTransaction().commit();</p>
<p>System.out.println(user.getId());</p>
<p>如果我自己创建一个对象，并且给主键属性赋值，该值还在数据库中</p>
<p>存在，当前对象的状态不也是游离态了？</p>
<p>/* 在Hibernate中根据主键判断对象是自由态还是游离态只是判断的</p>
<p>一个参考点，在Hibernate中还有更复杂的机制来判断一个对象的</p>
<p>状态，比如对象的version等等。</p>
<p>回到自由态</p>
<p>session.beginTransaction();</p>
<p>User user = (User) session.load(User.class, 120);</p>
<p>session.delete(user);</p>
<p>session.getTransaction().commit();</p>
<p>三种状态的转换 :</p>
<p><img src="" alt=""></p>
<p><strong>load和get方法</strong></p>
<p>相同点：</p>
<p>   get和load方法都是利用对象的主键值获取相应的对象，并可以使对</p>
<p>象处于持久状态。</p>
<p>不同点：</p>
<p>   load方法获取对象时不会立即执行查询操作，而是在第一次使用对象</p>
<p>是再去执行查询操作。如果查询的对象在数据库中不存在，load方法</p>
<p>返回值不会为null，在第一次使用时抛出</p>
<p>org.hibernate.ObjectNotFoundException异常。</p>
<p>   使用get方法获取对象时会立即执行查询操作，并且对象在数据库中</p>
<p>不存在时返回null值。</p>
<p><strong>save和persist方法</strong></p>
<p>相同点：</p>
<p>save和persist方法都是将持久化对象保存到数据库中</p>
<p>区别：</p>
<p>sava方法成功执行后，返回持久化对象的ID</p>
<p>persist方法成功执行后，不会返回持久化对象的ID，persist方法是</p>
<p>JPA中推荐使用的方法  </p>
<p><strong>save和update方法</strong></p>
<p>save方法是将自由态的对象迚行保存。</p>
<p>update方法是将游离态的对象迚行保存。</p>
<p>update和saveOrUpdate方法</p>
<p>   如果一个对象是游离态戒持久态，对其执行update方法后会将对象</p>
<p>的修改同步到数据库中，如果该对象是自由态，则执行update方法</p>
<p>是没有作用的。</p>
<p>   在执行saveOrUpdate方法时该方法会自动判断对象的状态，如果为</p>
<p>自由态则执行save操作，如果为游离态戒持久态则执行update操作。</p>
<p><strong>update和merge方法</strong></p>
<p>   如果持久化对象在数据库中存在，使用merge操作时迚行同步操作。</p>
<p>如果对象在数据库不存在，merge对象则迚行保存操作。</p>
<p>   如果对象是游离状态，经过update操作后，对象转换为持久态。但</p>
<p>是经过merge操作后，对象状态依然是游离态。</p>
<p><strong>saveOrUpdate和merge方法</strong></p>
<p>saveOrUpdate方法和merge方法的区别在于如果session中存在两</p>
<p>个主键值相同的对象，迚行saveOrUpdate操作时会有异常抛出。这</p>
<p>时必须使用merge迚行操作。</p>
<p>session.beginTransaction();</p>
<p>User user = new User();</p>
<p>user.setId(3);</p>
<p>user.setUserName(&quot;aaaaaaaa&quot;);</p>
<p>user.setUserPwd(&quot;123123&quot;);</p>
<p>User user2 = (User) session.get(User.class, 3);</p>
<p>session.saveOrUpdate(user);//ERROR</p>
<p>session.getTransaction().commit();</p>
<p>clear方法和flush方法</p>
<p>clear方法是将Session中对象全部清除，当前在Session中的对象由</p>
<p>持久态转换为游离态。flush方法则是将持久态对象的更改同步到数据</p>
<p>库中。</p>
<p>session.beginTransaction();</p>
<p>User user = (User) session.get(User.class, 3);</p>
<p>user.setPassword(&quot;111&quot;);</p>
<p>session.flush();  </p>
<p>session.getTransaction().commit();</p>
<p><strong>2.Hibernate查询</strong></p>
<p><strong>2.1 HQL</strong></p>
<p>   HQL（Hibernate Query Language）提供了丰富灵活的查询方式，</p>
<p>使用HQL进行查询也是Hibernate官方推荐使用的查询方式。</p>
<p>   HQL在语法结构上和SQL语句十分的相同，所以可以很快的上手进行</p>
<p>使用。使用HQL需要用到Hibernate中的Query对象，该对象丏门执</p>
<p>行HQL方式的操作。</p>
<p><strong>1.查询所有</strong></p>
<p>session.beginTransaction();</p>
<p>String hql = &quot;from User&quot;;</p>
<p>Query query = session.createQuery(hql);</p>
<p>List<User> userList = query.list();</p>
<p>for(User user:userList){</p>
<p> System.out.println(user.getUserName());</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>2.where</strong></p>
<p>session.beginTransaction();</p>
<p>String hql = &quot;from User where userName = &#39;James&#39;&quot;;</p>
<p>Query query = session.createQuery(hql);</p>
<p>List<User> userList = query.list();</p>
<p>for(User user:userList){</p>
<p> System.out.println(user.getUserName());</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p>在HQL中where语句中使用的是持久化对象的属性名，比如上面示例</p>
<p>中的userName。当然在HQL中也可以使用别名：</p>
<p>String hql = &quot;from User as u where u.userName = &#39;James&#39;&quot;;</p>
<p><strong>3.过滤条件</strong></p>
<p>在where语句中还可以使用各种过滤条件，如：=、&lt;&gt;、&lt;、&gt;、&gt;=</p>
<p>、&lt;=、between、not between、in、not in、is、like、and、or</p>
<p>等。</p>
<p>– from Student where age &gt; 20;</p>
<p>– from Student where age between 20 and 30;</p>
<p>– from Student where name is null;</p>
<p>– from Student where name like ‘小%’;</p>
<p>– from Student where name like ‘小%’ and age &lt; 30</p>
<p><strong>4.获取一个不完整对象</strong></p>
<p><strong>一列：</strong></p>
<p>session.beginTransaction();</p>
<p>String hql = &quot;select userName from User&quot;</p>
<p>Query query = session.createQuery(hql);</p>
<p>List nameList = query.list();</p>
<p>for(Object obj:nameList){</p>
<p> System.out.println(obj);</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>5.两列或多列：</strong></p>
<p>session.beginTransaction();</p>
<p>String hql = &quot;select userName,userPwd from User&quot;;</p>
<p>Query query = session.createQuery(hql);</p>
<p>List nameList = query.list();</p>
<p>for(Object obj:nameList){</p>
<p>Object[] array = (Object[]) obj;</p>
<p>System.out.println(&quot;name:&quot; + array[0]);</p>
<p>System.out.println(&quot;pwd:&quot; + array[1]);</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>6.统计和分组查询</strong></p>
<p>session.beginTransaction();</p>
<p>String hql = &quot;select count(/*),max(id) from User&quot;;</p>
<p>Query query = session.createQuery(hql);</p>
<p>List nameList = query.list();</p>
<p>for(Object obj:nameList){</p>
<p>Object[] array = (Object[]) obj;</p>
<p>System.out.println(&quot;count:&quot; + array[0]);</p>
<p>System.out.println(&quot;max:&quot; + array[1]);</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>7.更多写法…</strong></p>
<p>消除重复： select distinct name from Student;</p>
<p>最大： select max(age) from Student;</p>
<p>行数： select count(age),age from Student group by age;</p>
<p>排序： from Student order by age;</p>
<p><strong>HQL占位符</strong></p>
<p>session.beginTransaction();</p>
<p>String hql = &quot;from User where userName = ?&quot;;</p>
<p>Query query = session.createQuery(hql);</p>
<p>query.setString(0, &quot;James&quot;);</p>
<p>List<User> userList = query.list();</p>
<p>for(User user:userList){</p>
<p> System.out.println(user.getUserName());</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>HQL引用占位符</strong></p>
<p>session.beginTransaction();</p>
<p>String hql = &quot;from User where userName = :name&quot;;</p>
<p>Query query = session.createQuery(hql);</p>
<p>query.setParameter(&quot;name&quot;, &quot;James&quot;);</p>
<p>List<User> userList = query.list();</p>
<p>for(User user:userList){</p>
<p> System.out.println(user.getUserName());</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>HQL分页</strong></p>
<p>session.beginTransaction();</p>
<p>String hql = &quot;from User&quot;;</p>
<p>Query query = session.createQuery(hql);</p>
<p><strong>query.setFirstResult(0);</strong></p>
<p><strong>query.setMaxResults(2);</strong></p>
<p>List<User> userList = query.list();</p>
<p>for(User user:userList){</p>
<p> System.out.println(user.getUserName());</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>3.Criteria查询</strong></p>
<p>   Criteria对象提供了一种面向对象的方式查询数据库。Criteria对象需</p>
<p>要使用Session对象来获得。</p>
<p>一个Criteria对象表示对一个持久化类的查询。</p>
<p><strong>1.查询所有</strong></p>
<p>session.beginTransaction();</p>
<p>Criteria c = session.createCriteria(User.class);</p>
<p>List<User> userList = c.list();</p>
<p>for(User user:userList){</p>
<p> System.out.println(user.getUserName());</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>2.Where</strong></p>
<p>session.beginTransaction();</p>
<p>Criteria c = session.createCriteria(User.class);</p>
<p>c.add(Restrictions.eq(&quot;userName&quot;, &quot;James&quot;));</p>
<p>List<User> userList = c.list();</p>
<p>for(User user:userList){</p>
<p> System.out.println(user.getUserName());</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>3.Restrictions对象</strong></p>
<p><img src="" alt=""></p>
<p><strong>where...and .... 语句</strong></p>
<p>session.beginTransaction();</p>
<p><strong>Criteria c = session.createCriteria(User.class)</strong></p>
<p><strong>c.add(Restrictions.like(&quot;userName&quot;, &quot;J&quot;));</strong></p>
<p><strong>c.add(Restrictions.eq(&quot;id&quot;, 120));</strong></p>
<p>List<User> userList = c.list();</p>
<p>for(User user:userList){</p>
<p> System.out.println(user.getUserName());</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>where...or .... 语句</strong></p>
<p>session.beginTransaction();</p>
<p>Criteria c = session.createCriteria(User.class);</p>
<p><strong>c.add(Restrictions.or(Restrictions.eq(&quot;userName&quot;, &quot;James&quot;),</strong></p>
<p><strong> Restrictions.eq(&quot;userName&quot;, &quot;Alex&quot;)));</strong></p>
<p>List<User> userList = c.list();</p>
<p>for(User user:userList){</p>
<p>System.out.println(user.getUserName());</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>获取唯一的记录</strong></p>
<p>session.beginTransaction();</p>
<p>Criteria c = session.createCriteria(User.class);</p>
<p>c.add(Restrictions.eq(&quot;id&quot;, 120));</p>
<p>User user = (User) c.uniqueResult();</p>
<p>System.out.println(user.getUserName());</p>
<p>session.getTransaction().commit();</p>
<p><strong>分页</strong></p>
<p>session.beginTransaction();</p>
<p>Criteria c = session.createCriteria(User.class);</p>
<p>c.setFirstResult(0);</p>
<p>c.setMaxResults(5);</p>
<p>List<User> userList = c.list();</p>
<p>for(User user:userList){</p>
<p> System.out.println(user.getUserName());</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>分组与统计</strong></p>
<p>session.beginTransaction();</p>
<p>Criteria c = session.createCriteria(User.class);</p>
<p>c.setProjection(Projections.sum(&quot;id&quot;));</p>
<p>Object obj = c.uniqueResult();</p>
<p>System.out.println(obj);</p>
<p>session.getTransaction().commit();</p>
<p>Projections对象</p>
<p><img src="" alt=""></p>
<p><strong>多个统计与分组</strong></p>
<p>session.beginTransaction();</p>
<p>Criteria c = session.createCriteria(User.class);</p>
<p><strong>ProjectionList projectionList = Projections.projectionList();</strong></p>
<p><strong>projectionList.add(Projections.sum(&quot;id&quot;));</strong></p>
<p><strong>projectionList.add(Projections.min(&quot;id&quot;));</strong></p>
<p><strong>c.setProjection(projectionList);</strong></p>
<p>Object[] obj = (Object[]) c.uniqueResult();</p>
<p>System.out.println(&quot;sum:&quot; + obj[0]);</p>
<p>System.out.println(&quot;min:&quot; + obj[1]);</p>
<p>session.getTransaction().commit();</p>
<p><strong>排序</strong></p>
<p>session.beginTransaction();</p>
<p>Criteria c = session.createCriteria(User.class);</p>
<p><strong>c.addOrder(Order.desc(&quot;id&quot;));</strong></p>
<p>List<User> list = c.list();</p>
<p>for(User user : list){</p>
<p> System.out.println(user.getUserName());</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>4.使用原生SQL查询</strong></p>
<p><strong>1.查询出后必须封装才可以用：</strong></p>
<p>session.beginTransaction();</p>
<p>String sql = &quot;select id,username,userpwd from t_user&quot;;</p>
<p>List list = session.createSQLQuery(sql).list();</p>
<p>for(Object item : list){</p>
<p>Object[] rows = (Object[]) item;</p>
<p>System.out.println(&quot;id:&quot; + rows[0] + &quot;username:&quot;  </p>
<ul>
<li>rows[1] + &quot;userpwd:&quot; + rows[2]);</li>
</ul>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>2.查询出一个集合可以直接用对象操作：</strong></p>
<p>session.beginTransaction();</p>
<p>String sql = &quot;select id,username,userpwd from t_user&quot;;</p>
<p>SQLQuery query = session.createSQLQuery(sql).addEntity(User.class);</p>
<p>List<User> list = query.list();</p>
<p>for(User user : list){</p>
<p> System.out.println(user.getUserName());</p>
<p>}</p>
<p>session.getTransaction().commit();</p>
<p><strong>3.查询出一个对象可以直接用对象操作</strong>：</p>
<p>session.beginTransaction();</p>
<p>String sql = &quot;select id,username,userpwd from t_user where id = 2&quot;;</p>
<p>SQLQuery query = session.createSQLQuery(sql).addEntity(User.class);</p>
<p>User user = (User) query.uniqueResult();</p>
<p>System.out.println(user.getUserName());</p>
<p>session.getTransaction().commit();</p>
<p><a href="http://libooy.diandian.com/?tag=hibernate" title="hibernate" target="_blank">hibernate</a>
<a href="">喜欢</a> <a href="">热度 (4)</a></p>
<p><a href="">分享</a></p>
<p><a href=""></a>
<a href="http://libooy.diandian.com/" target="_blank">返回首页</a></p>
<p><a href=""></a>
<a href="http://libooy.diandian.com/post/2012-03-28/14606048" target="_blank">上一篇</a></p>
<p><a href="http://libooy.diandian.com/post/2012-03-26/18813130" target="_blank">下一篇</a></p>
<h3 id="-"><a href="&quot;关于&quot;">关于</a></h3>
<p>一天进步一点点！！！</p>
<h3 id="-">导航</h3>
<ul>
<li><a href="http://libooy.diandian.com/rss" target="_blank">RSS订阅</a></li>
<li><a href="http://libooy.diandian.com/random" target="_blank">随机文章</a></li>
<li><a href="http://libooy.diandian.com/archive" target="_blank">存档</a></li>
<li><a href="http://libooy.diandian.com/inbox" title="私信" target="_blank">私信</a></li>
<li><p><a href="http://libooy.diandian.com/submit" title="投稿" target="_blank">投稿</a></p>
<h3 id="-">页面</h3>
</li>
<li><p><a href="http://libooy.diandian.com/" target="_blank">首页</a></p>
</li>
<li><p>© <a href="http://libooy.diandian.com/" title="Li-boy 奋斗的蜗牛" target="_blank">Li-boy 奋斗的蜗牛</a></p>
</li>
<li>Powered by <a href="http://www.diandian.com/" title="点点网" target="_blank">点点</a></li>
<li>Themed by <a href="http://www.yiyifly.com/" title="舟遥遥以轻飏,风飘飘而吹衣" target="_blank">吹衣轻飏</a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/框架汇总/">框架汇总</a></li></span><span class="breadcrumb"><li><a href="/categories/框架汇总/">框架汇总</a></li><li><a href="/categories/框架汇总/ORM/">ORM</a></li><li><a href="/categories/框架汇总/ORM/hibernate/">hibernate</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ORM/" class="label label-primary">ORM</a><a href="/tags/hibernate/" class="label label-success">hibernate</a><a href="/tags/框架汇总/" class="label label-info">框架汇总</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-框架汇总-ORM-hibernate--Hibernate知识总结/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-框架汇总-ORM-hibernate--Hibernate知识总结" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/144/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/142/">142</a></li><li><a class="page-number" href="/page/143/">143</a></li><li><a class="page-number" href="/page/144/">144</a></li><li class="active"><li><span class="page-number current">145</span></li><li><a class="page-number" href="/page/146/">146</a></li><li><a class="page-number" href="/page/147/">147</a></li><li><a class="page-number" href="/page/148/">148</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/146/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 19:25:40</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
