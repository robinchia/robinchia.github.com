
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 96 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-zhiya--答复面试遇到“怪题”你如何应付？-透明之眼/">答复 面试遇到 “怪题”你如何应付？ </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-zhiya--答复面试遇到“怪题”你如何应付？-透明之眼/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">答复 面试遇到 “怪题”你如何应付？ - 透明之眼</h1>
<p><a href="http://www.javaeye.com/" target="_blank">首页</a> <a href="http://www.javaeye.com/news" target="_blank">新闻</a> <a href="http://www.javaeye.com/forums" target="_blank">论坛</a> <a href="http://www.javaeye.com/ask" target="_blank">问答</a> <a href="http://www.javaeye.com/blogs" target="_blank">博客</a> <a href="http://www.javaeye.com/job" target="_blank">招聘</a> <a href="http://gigix.javaeye.com/blog/249545#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.javaeye.com/wiki" target="_blank">专栏</a> <a href="http://www.javaeye.com/groups" target="_blank">圈子</a> <a href="http://www.javaeye.com/search" target="_blank">搜索</a></p>
<p><a href="http://gigix.javaeye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.javaeye.com/all" target="_blank">我的应用</a> <a href="http://gigix.javaeye.com/login" target="_blank">登录</a> <a href="http://gigix.javaeye.com/signup" target="_blank">注册</a></p>
<h1 id="-http-gigix-javaeye-com-"><a href="http://gigix.javaeye.com/" target="_blank">透明之眼</a></h1>
<p>永久域名 <a href="http://gigix.javaeye.com/" target="_blank"><a href="http://gigix.javaeye.com/">http://gigix.javaeye.com/</a></a></p>
<p><a href="http://gigix.javaeye.com/blog/262372" title="期待Programming Erlang" target="_blank">期待Programming Erlang</a> | <a href="http://gigix.javaeye.com/blog/239956" title="明年的NCAA还看啥呢？" target="_blank">明年的NCAA还看啥呢？</a></p>
<p>2008-10-06</p>
<h3 id="-http-gigix-javaeye-com-blog-249545-"><a href="http://gigix.javaeye.com/blog/249545" target="_blank">答复: 面试遇到 “怪题”你如何应付？</a></h3>
<p>给所有找工作的年轻人们一个忠告：如果面试你的考官问到任何你不会对早晨的图书馆里刚认识的陌生人谈论的个人问题，告诉他这是你的隐私，你不想回答。如果他超过两次问你这类个人问题，或者问到任何与性有关的问题，请务必在面试结束后向该公司的HR主管投诉此人。如果得不到来自HR主管的支持和相关处理结果，那么就不要接受来自这家公司的任何后续联系（包括offer）。对初次见面的人都不懂得尊重的人（以及公司），我可以保证，你去那里做菜鸟会比你参加这次面试难受一百倍。</p>
<p><a href="http://gigix.javaeye.com/blog/262372" title="期待Programming Erlang" target="_blank">期待Programming Erlang</a> | <a href="http://gigix.javaeye.com/blog/239956" title="明年的NCAA还看啥呢？" target="_blank">明年的NCAA还看啥呢？</a></p>
<ul>
<li>19:49</li>
<li>浏览 (1704)</li>
<li><a href="http://gigix.javaeye.com/blog/249545#comments" target="_blank">评论</a> (2)</li>
<li>分类: <a href="http://gigix.javaeye.com/category/1139" target="_blank">随笔</a></li>
<li><a href="http://www.javaeye.com/wiki/topic/249545" target="_blank">相关推荐</a></li>
</ul>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<p>2 楼 <a href="http://8vip.javaeye.com/" target="_blank">8vip</a> 2009-07-16   <a href="http://gigix.javaeye.com/blog/249545#" target="_blank">引用</a></p>
<p>有这样子的?没见过呢.
1 楼 <a href="http://yulimin.javaeye.com/" target="_blank">YuLimin</a> 2008-10-11   <a href="http://gigix.javaeye.com/blog/249545#" target="_blank">引用</a></p>
<p>1、如果面试时只有一位考官，那可能会出现这种劣根性的货色，直接暴扁之，走人。哈。。。
2、有大于一位考官的话，可能性不太多，如果出现，那。。。不知道怎么说了。
我记得在网上看到过有个人写的性XX的文章，不知道是枪手，还是真实的，反正需要小心。</p>
<h3 id="-">发表评论</h3>
<p>您还没有登录，请<a href="http://gigix.javaeye.com/login" target="_blank">登录</a>后发表评论(快捷键 Alt+S / Ctrl+Enter)</p>
<p><a href="http://gigix.javaeye.com/" target="_blank"><img src="&quot;gigix的博客: 透明之眼&quot;" alt="gigix的博客"></a></p>
<p>gigix</p>
<ul>
<li>浏览: 257394 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 北京</li>
<li><img src="" alt=""></li>
<li><a href="http://gigix.javaeye.com/blog/profile" target="_blank">详细资料</a> <a href="http://gigix.javaeye.com/blog/guest_book" target="_blank">留言簿</a></li>
</ul>
<h3 id="-">搜索本博客</h3>
<h3 id="-http-gigix-javaeye-com-blog-user_visits-">最近访客 <a href="http://gigix.javaeye.com/blog/user_visits" target="_blank">&gt;&gt;更多访客</a></h3>
<p><a href="http://wangjinquan.javaeye.com/" target="_blank"><img src="&quot;wangjinquan的博客: &quot;" alt="wangjinquan的博客"></a></p>
<p><a href="http://wangjinquan.javaeye.com/" target="_blank">wangjinquan</a></p>
<p><a href="http://yeowin.javaeye.com/" target="_blank"><img src="&quot;yeowin的博客: 欢须到过这里...&quot;" alt="yeowin的博客"></a></p>
<p><a href="http://yeowin.javaeye.com/" target="_blank">yeowin</a>
<a href="http://de3light.javaeye.com/" target="_blank"><img src="&quot;de3light的博客: de3light&quot;" alt="de3light的博客"></a></p>
<p><a href="http://de3light.javaeye.com/" target="_blank">de3light</a></p>
<p><a href="http://peterbo.javaeye.com/" target="_blank"><img src="&quot;peterbo的博客: &quot;" alt="peterbo的博客"></a></p>
<p><a href="http://peterbo.javaeye.com/" target="_blank">peterbo</a></p>
<h3 id="-">博客分类</h3>
<ul>
<li><a href="http://gigix.javaeye.com/" target="_blank">全部博客 (71)</a></li>
<li><a href="http://gigix.javaeye.com/category/1136" target="_blank">企业应用建筑师 (18)</a></li>
<li><a href="http://gigix.javaeye.com/category/1137" target="_blank">软件工匠 (18)</a></li>
<li><a href="http://gigix.javaeye.com/category/1138" target="_blank">媒介与传播 (8)</a></li>
<li><p><a href="http://gigix.javaeye.com/category/1139" target="_blank">随笔 (16)</a></p>
<h3 id="-http-gigix-javaeye-com-blog-guest_book-">我的留言簿 <a href="http://gigix.javaeye.com/blog/guest_book" target="_blank">&gt;&gt;更多留言</a></h3>
</li>
<li><p>膜拜大侠一次,佩服您思考问题的深度和丰富的人生阅历，希望自己有一天能达到您的水平
-- by <a href="http://gigix.javaeye.com/blog/guest_book#19944" target="_blank">yangyi</a></p>
</li>
<li><a href="http://www.rubyidea.com" target="_blank">http://www.rubyidea.com</a> 关注Ruby在中国的发展！
-- by <a href="http://gigix.javaeye.com/blog/guest_book#7571" target="_blank">rubystudy</a></li>
<li>评的实在,不过刚到北京的人是需要费一番周折的
-- by <a href="http://gigix.javaeye.com/blog/guest_book#2823" target="_blank">zhouzhichu</a></li>
</ul>
<h3 id="-">其他分类</h3>
<ul>
<li><a href="http://gigix.javaeye.com/blog/favorite" target="_blank">我的收藏</a> (4)</li>
<li><a href="http://gigix.javaeye.com/blog/topic" target="_blank">我的论坛主题贴</a> (94)</li>
<li><a href="http://gigix.javaeye.com/blog/post" target="_blank">我的所有论坛贴</a> (4810)</li>
<li><a href="http://gigix.javaeye.com/blog/article" target="_blank">我的精华良好贴</a> (6)</li>
<li><a href="http://gigix.javaeye.com/blog/solution" target="_blank">我解决的问题</a> (2)<h3 id="-">最近加入圈子</h3>
</li>
</ul>
<h3 id="-">存档</h3>
<ul>
<li><a href="http://gigix.javaeye.com/blog/monthblog/2008-11" target="_blank">2008-11</a> (1)</li>
<li><a href="http://gigix.javaeye.com/blog/monthblog/2008-10" target="_blank">2008-10</a> (1)</li>
<li><a href="http://gigix.javaeye.com/blog/monthblog/2008-09" target="_blank">2008-09</a> (1)</li>
<li><p><a href="http://gigix.javaeye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://gigix.javaeye.com/rss" target="_blank"><img src="" alt="Rss"></a></p>
</li>
<li><a href="http://fusion.google.com/add?feedurl=http://gigix.javaeye.com/rss" target="_blank"><img src="" alt="Rss_google"></a></li>
<li><a href="http://www.xianguo.com/subscribe.php?url=http://gigix.javaeye.com/rss" target="_blank"><img src="" alt="Rss_xianguo"></a></li>
<li><a href="http://www.google.com/search?hl=zh-CN&amp;q=RSS" target="_blank">[什么是RSS?]</a>
声明：JavaEye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2010 JavaEye.com. All rights reserved. 上海炯耐计算机软件有限公司 [ 沪ICP备05023328号 ]</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/zhiya/">zhiya</a></li></span><span class="breadcrumb"><li><a href="/categories/职涯/">职涯</a></li></span></span> | <span class="tags">Tagged <a href="/tags/zhiya/" class="label label-primary">zhiya</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-zhiya--答复面试遇到“怪题”你如何应付？-透明之眼/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-zhiya--答复面试遇到“怪题”你如何应付？-透明之眼" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-虚拟化_Citrix--SmartAuditorEventAPIOverview-1/">SmartAuditor Event API Overview</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-虚拟化_Citrix--SmartAuditorEventAPIOverview-1/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="smartauditor-event-api-overview-1">SmartAuditor Event API Overview-1</h1>
<p>SmartAuditor Event API
Overview
SmartAuditor provides the ability to record ICA sessions. The purpose of the SmartAuditor Event API is to allow third parties to augment session recordings with application specific event data. Arbitrary data can be added to the SmartAuditor recording stream in real-time during recording, and the same data can be retrieved in real-time during playback.
Basic Concept
The SmartAuditor Agent provides a simple COM interface that third party applications can use to add application specific event data into the recorded session. Session Recording
SmartAuditor Event Data during recording
Citrix Presentation Server
Third Party Published Application SmartAuditor Agent
LogData
IUserAPI
Published Application being recorded SmartAuditor Event API
Event Data
Recorded Stream Storage
The above diagram shows a published application running on Presentation Server with SmartAuditor session recording enabled. During the lifetime of the recorded session, the published application can add application specific event data into the recorded stream using the LogData function provided by the IUserApi interface. Application specific event data are time stamped as they are added into the recorded stream. The same event data will be available during playback of the recorded session, synchronized with the playback stream in real-time.
Session Playback
The above diagram shows how application event data are consumed during session playback. Event data are displayed in the Events and Bookmarks panel of the SmartAuditor Player. The Player can also deliver the event data as recorded to a third party consumer application built using the Player SDK. The delivery of event data is synchronized with the playback in real-time.
SmartAuditor Event API COM Server
The SmartAuditor Event API is provided as a COM Server hosted by the SmartAuditor Agent, installed on each computer running Presentation Server with SmartAuditor enabled. The SmartAuditor Event API can be enabled or disabled on a per-server basis. The default setting for each SmartAuditor Agent installation is for the COM interface to be disabled. Any attempts to connect to the interface will fail until it is enabled by the Presentation Server administrator. Please refer to the SmartAuditor Administrator’s Guide for more information on configuring the SmartAuditor Agent. When the SmartAuditor Event API is enabled, a COM interface called IUserApi is made available for third party applications to add event data to the recorded stream. The IUserApi interface contains only one function called LogData.
Event Data Storage
Event data is stored in the data stream within the session recording. If the searchable flag is set when the data is added to the recording stream, a database entry will be created and indexed against the fully qualified type associated with the data. As there is some overhead in storing each searchable event, this flag should only be set if there is an intention to search on the event text. See CTX114748 - Citrix SmartAuditor Database Schema for more information on the database storage.
<img src="" alt=""> SmartAuditor Event Data Playback
Event data added to SmartAuditor recording files are automatically available during playback. Event data are organized in a similar manner as bookmarks, and are listed in the Events and Bookmarks panel of the SmartAuditor Player. The following screenshot shows the event data as seen in the Events and Bookmarks panel (lower left corner) of the SmartAuditor Player:
Event items are labelled with a yellow dot, both in the Events and Bookmarks panel and on the player window timeline bar. Note that only the event text is displayed in the SmartAuditor Player; event binary data can only be retrieved through custom applications built on the SmartAuditor Player SDK (see the next section for more details.) Recordings containing event data originally recorded with the searchable flag set can be found using the SmartAuditor Player’s advanced search form as shown below. This allows searching by both event text and event type name.
<img src="" alt=""><br>SmartAuditor Player SDK
As indicated in the previous section, text associated with event data are automatically made available during playback within the SmartAuditor Player. Event data can also be accessed during playback via a set of library functions provided by the SmartAuditor Player SDK. The use of the Player SDK is optional. Its primary use is the rendering binary data associated with each event during playback. The Player SDK is based on an event notification or callback interface, where a third party application registers an event handler where event data can be delivered in real-time during session playback. The following C++ code fragment illustrates a typical lifecycle of an application making use of the SmartAuditor Player SDK:
// initialize Player SDK CtxPlay_Initialize(); // register event handler for all event type CtxPlay_RegisterEventHandler(MyEventHandler, L &quot;/<em>&quot;); // wait for event processing is completed (ie. via the CtxPlay_Abort() call) CtxPlay_WaitForCompletion(); // clean up CtxPlay_Dispose();
Note that the code fragment assumes that a callback function MyEventHandler is defined elsewhere. MyEventHandler is responsible for receiving event data and perform any processing as appropriate, for example, rendering event data in a human readable form.
SmartAuditor Event API COM Server
The SmartAuditor Event API is provided as a COM Server hosted by the SmartAuditor Agent, installed on each computer running Presentation Server with SmartAuditor enabled. When the SmartAuditor Event API is enabled, a COM interface called IUserApi is made available for third party applications to add event data to the recorded stream. The IUserApi interface contains only one function called LogData. ProgID The ProgID for the SmartAuditor Agent COM server is Citrix.SmartAuditor.Agent.UserApi. The ProgID is used to locate and instantiate the COM objects within the third party application.
LogData The LogData function will record provided event data into the recorded session file associated with the Presentation Server / Terminal Services session ID specified. All parameters are validated for length and format before data is recorded. If the supplied session ID is not a current Terminal Services session, or the supplied session is not being recorded by the SmartAuditor Agent, then the function call will be ignored and no error will be returned to the caller. This is to prevent the Event API being used as a means for detecting whether a particular session is actually being recorded. The fully qualified type name associated with the event data is of the form typePart1.typePart2.typePart3. The type parts can be any string, but general good naming practise is CompanyName.Subsystem.Type. For example, AcmeInc.TradingApp.Transaction.
interface IUserApi : IDispatch { HRESULT LogData( [in] int sessionId, [in] BSTR typePart1, [in] BSTR typePart2, [in] BSTR typePart3, [in] BSTR text, [in] SAFEARRAY(byte)/</em> data, [in] byte searchable); };
Parameters sessionId ID of Presentation Server / Terminal Services session to log event data for. The session ID must be greater than or equal to 0. Logging data for unknown session IDs will simply be ignored (that is, no exception will be thrown). typePart1 Event type first part of the fully qualified type name. Length of each part must be between 1 and 32 characters and must not contain any “.” (dot) characters. typePart2 Event type second part of the fully qualified type name. Length of each part must be between 1 and 32 characters and must not contain any “.” (dot) characters. typePart3 Event type third (and final) part of the fully qualified type name. Length of each part must be between 1 and 32 characters and must not contain any “.” (dot) characters.
text Event text data. Length of string must be between 1 and 128 characters. data Event binary data. Length must be between 0 and 4096 bytes. searchable Flag indicating whether the text value is database searchable. If this flag is non-zero, a database entry indexed against the fully qualified type and text fields will be created in the SmartAuditor database for the event item. Return Values ERROR_SUCCESS (HRESULT value 0x00000000) if successful. If an invalid parameter value is detected, E_INVALIDARG (HRESULT value 0x8007057) is returned or if called from .NET managed code, a System.ArgumentException is thrown. Requirements Library Interface DLL
Interop.UserApi.idl Requires Interop.UserApi.dll</p>
<p>SmartAuditor Player SDK
CtxPlay_Initialize CtxPlay_Initialize is the initialization function which is called once to initialize the Player SDK.
BOOL <strong>stdcall CtxPlay_Initialize()
Parameters None Return Values The BOOL return value indicates whether the Player SDK initialization was successful. Requirements Header Library DLL See Also CtxPlay_UnregisterEventHandler
Declared in CtxPlaySDK.h Link to CtxPlaySDK.lib Requires CtxPlaySDK.dll
  CTXPLAY_EVENT_CALLBACK CTXPLAY_EVENT_CALLBACK is the prototype of the callback function used in CtxPlay_RegisterEventHandler.
typedef void (</strong>stdcall /<em> CTXPLAY_EVENT_CALLBACK) ( IN CONST WCHAR/</em> eventType, IN CONST WCHAR/<em> label, IN CONST BYTE/</em> data, IN DWORD dataLength, IN SYSTEMTIME frameTimeUtc, IN SYSTEMTIME frameTime );
Parameters eventType [in] Type of event this data was registered against. label [in] Unicode text identifying this event. data [in] Event data. dataLength [in] Count of bytes of the data parameter. frameTimeUtc [in] Time in UTC when this event occurred. frameTime [in] Time in the server local time when this event occurred. Requirements Header Library DLL See Also CtxPlay_RegisterEventHandler
Declared in CtxPlaySDK.h Link to CtxPlaySDK.lib Requires CtxPlaySDK.dll
  CtxPlay_RegisterEventHandler The CtxPlay_RegisterEventHandler function is used for registering a callback handler with the Player SDK. The callback handler receives events during the course of playback.
BOOL <strong>stdcall CtxPlay_RegisterEventHandler ( CTXPLAY_EVENT_CALLBACK handler, CONST WCHAR/<em> eventTypeFilter );
Parameters Handler The function that will be called upon an event being received from the SmartAuditor Player. eventTypeFilter A string identifying the type of events to receive notifications for. If a handler is registered as L&quot;/</em>&quot; then the handler will receive all events. Return Values The BOOL return value indicates whether the registration of the handler was successful. Requirements Header Library DLL See Also CtxPlay_UnregisterEventHandler
Declared in CtxPlaySDK.h Link to CtxPlaySDK.lib Requires CtxPlaySDK.dll
  CtxPlay_WaitForCompletion The CtxPlay_WaitForCompletion function waits for the completion of the event data processing or until CtxPlay_Abort is called. While event processing remains active, this routine will block.
void </strong>stdcall CtxPlay_WaitForCompletion()
Parameters None Return Values None Requirements Header Library DLL See Also CtxPlay_Abort
Declared in CtxPlaySDK.h Link to CtxPlaySDK.lib Requires CtxPlaySDK.dll
  CtxPlay_UnregisterAllEventHandlers The CtxPlay_UnregisterAllEventHandlers function un-registers all event handlers previously registered with CtxPlay_RegisterEventHandler.
void <strong>stdcall CtxPlay_UnregisterAllEventHandlers()
Parameters None Return Values None Requirements Header Library DLL See Also CtxPlay_RegisterEventHandler
Declared in CtxPlaySDK.h Link to CtxPlaySDK.lib Requires CtxPlaySDK.dll
  CtxPlay_Dispose The CtxPlay_Dispose function releases any resources that the Player SDK may have consumed.
void </strong>stdcall CtxPlay_Dispose()
Parameters None Return Values None Requirements Header Library DLL See Also CtxPlay_Initialize
Declared in CtxPlaySDK.h Link to CtxPlaySDK.lib Requires CtxPlaySDK.dll
  CtxPlay_Abort The CtxPlay_Abort function aborts the processing of events.
void __stdcall CtxPlay_Abort()
Parameters None Return Values None Requirements Header Library DLL
Declared in CtxPlaySDK.h Link to CtxPlaySDK.lib Requires CtxPlaySDK.dll
See Also CtxPlay_Initialize, CtxPlay_WaitForCompletion
Code Samples
Listed below are some code samples for logging and retrieving event data. Since the SmartAuditor Event API is implemented as a COM server, many programming languages are capable of being used as clients for logging event data. The code samples require the SmartAuditor Event API and Player SDK, which is available for download from the Citrix Developer Network <a href="http://support.citrix.com/" target="_blank">http://support.citrix.com/</a>.
Adding Event Data to Recorded Session
C/# In order to make use of the SmartAuditor Event API COM interface, you will need a .NET callable wrapper called Interop.UserApi.dll. You can find this DLL in the SmartAuditor Agent installation directory. The following code sample assumes that SmartAuditor Interop.UserApi.dll has been added as a reference in the C/# project.
using System; using System.Diagnostics; using System.Runtime.InteropServices; using Interop.UserApi; // Interop derived from IUserApi.idl
namespace UserApiSample { /// <summary> /// Class for logging SmartAuditor Event Data /// </summary> public class EventDataLogger { /// <summary> /// ProgID for SmartAuditor Event API /// </summary> private const string EventApiProgID = &quot;Citrix.SmartAuditor.Agent.UserApi&quot;; /// <summary> /// COM interface for calling the SmartAuditor Event API /// </summary> private IUserApi m_EventApi = null; /// <summary> /// Log event data for specified Terminal Services session /// </summary> /// <param name="sessionId">Terminal Services session ID</param> /// <param name="dataType1">part 1 of event data type</param> /// <param name="dataType2">part 2 of event data type</param> /// <param name="dataType3">part 3 of event data type</param> /// <param name="textData">event text data</param> /// <param name="binaryData">event binary data</param> /// <param name="searchable">indicate whether text data is searchable</param> public void LogData( int sessionId, string dataType1, string dataType2, string dataType3, string textData, byte[] binaryData, bool searchable) { try { if (null == m_EventApi) { // create instance of Event API COM object Type type = Type.GetTypeFromProgID(EventApiProgID, true); if (null != type) { object obj = Activator.CreateInstance(type); m_EventApi = (IUserApi)obj; } }
if (null != m_EventApi) { m_EventApi.LogData( sessionId, dataType1, dataType2, dataType3, textData, ref binaryData, Convert.ToByte(searchable) ); } else { Debug.WriteLine(&quot;Uninitialized Event API object&quot;); throw new InvalidComObjectException(&quot;Uninitialized Event API object&quot;); } } catch (System.Exception ex) { Debug.WriteLine(ex.Message); throw ex; } } } }
The following code fragment illustrates how to obtain the Terminal Session ID for the current application. Please refer to Microsoft Platform SDK documentation for more information on Terminal Services related functions.
/// <summary> /// Enum for TS session information /// </summary> public enum WTS_INFO_CLASS { WTSInitialProgram, WTSApplicationName, WTSWorkingDirectory, WTSOEMId, WTSSessionId, WTSUserName, WTSWinStationName, WTSDomainName, WTSConnectState, WTSClientBuildNumber, WTSClientName, WTSClientDirectory, WTSClientProductId, WTSClientHardwareId, WTSClientAddress, WTSClientDisplay, WTSClientProtocolType } /// <summary> /// ID for querying current TS session /// </summary> public const int WTS_CURRENT_SESSION = -1; /// <summary> /// pinvoke for WTSQuerySessionInformation /// </summary> [DllImport(&quot;Wtsapi32.dll&quot;)] public static extern bool WTSQuerySessionInformation( System.IntPtr hServer, int sessionId, WTS_INFO_CLASS wtsInfoClass, out System.IntPtr ppBuffer, out uint pBytesReturned);
/// <summary> /// Get the current TS session ID /// </summary> public int GetCurrentSessionID() { int sessionID = -1; uint bytesReturned = 0; System.IntPtr buffer = IntPtr.Zero; bool retCode = WTSQuerySessionInformation( System.IntPtr.Zero, WTS_CURRENT_SESSION, WTS_INFO_CLASS.WTSSessionId, out buffer, out bytesReturned); if (retCode) { sessionID = Marshal.ReadInt32(buffer); } return sessionID; }
The following code fragment illustrates how event data is added to the session recording. The application is assumed to be running as a published application, and the ICA session is currently being recorded. Note that no error will be generated if the ICA session is not being recorded; this is a security feature of the EventAPI to prevent users from determining if session recording is in effect.
try { // get the current Terminal Services session ID int sessionID = GetCurrentSessionID(); // create EventDataLogger instance EventDataLogger eventLogger = new EventDataLogger(); // log some event data eventLogger.LogData( sessionID, &quot;AcmeInc&quot;, &quot;TransactApp&quot;, &quot;Transaction&quot;, &quot;Order /#123 completed&quot;, new byte[0], true); } catch (System.Exception ex) { Debug.WriteLine(ex.Message); throw ex; }</p>
<p>Adding Event Data to Recorded Session
VB.Net In order to make use of the SmartAuditor Event API COM interface, you will need a .NET callable wrapper called Interop.UserApi.dll. You can find this DLL in the SmartAuditor Agent installation directory. The following code fragment assumes that SmartAuditor Interop.UserApi.dll has been added as a reference in the VB.Net project.
Imports System.Runtime.InteropServices &#39; Sub routine for logging event data Sub LogData( <em> ByVal sessionId As Int32, </em> ByVal text As String, <em> ByVal bytes As Byte(), </em> ByVal searchable As Byte) Dim eventApi As IUserApi = <em> CType(CreateObject(&quot;Citrix.SmartAuditor.Agent.UserApi&quot;), IUserApi) eventApi.LogData( </em> sessionId, <em> &quot;AcmeInc&quot;, </em> &quot;TransactApp&quot;, <em> &quot;Transaction&quot;, </em> textLabel.Text, <em> bytes, </em> searchable) End Sub</p>
<p>Retrieving Event Data during Session Playback
C++ The following code fragment illustrates a typical use of the SmartAuditor Player SDK to receive event data during session playback. Note that the /#include statement assumes that the SmartAuditor Player SDK is installed and available. This code uses the .NET extension to C++.
Using namespace System; /#include &quot;CtxPlaySDK.h&quot; //<em>/</em> /<em> Handle binary event data /</em>/ void HandleBinaryData(const BYTE/<em> data, int dataLength) { // handle binary data as appropriate... } //</em>/<em> /</em> Event data handler /<em>/ void __stdcall MyEventHandler( IN CONST WCHAR/</em> eventType, // type of event IN CONST WCHAR/<em> label, // event text data IN CONST BYTE/</em> data, // event binary data IN DWORD dataLength, // length of binary data IN SYSTEMTIME frameTimeUtc, // event time in UTC IN SYSTEMTIME frameTime) // event time in server local time { // display event information Console::WriteLine(L&quot;Event Received:&quot;); String^ typeString = gcnew String(eventType); Console::WriteLine(L&quot; Type: {0}&quot;, typeString); String^ labelString = gcnew String(label); Console::WriteLine(L&quot; Label: {0}&quot;, labelString); // display event time Console::WriteLine(L&quot; Time (UTC): {0}/{1}/{2} {3}:{4:d2}:{5:d2}&quot;, frameTimeUtc.wDay, frameTimeUtc.wMonth, frameTimeUtc.wYear, frameTimeUtc.wHour, frameTimeUtc.wMinute, frameTimeUtc.wSecond); Console::WriteLine(L&quot; Time (Local): {0}/{1}/{2} {3}:{4:d2}:{5:d2}&quot;, frameTime.wDay, frameTime.wMonth, frameTime.wYear, frameTime.wHour, frameTime.wMinute, frameTime.wSecond); // display binary data information Console::WriteLine(L&quot; Data ({0} bytes):&quot;, dataLength); // handle binary data HandleBinaryData(data, dataLength); Console::WriteLine(L&quot;---------------------------------------------------\n&quot;); } //<em>/</em> /<em> sample main /</em>/ int main(array<String^> ^args) { const wchar_t/<em> eventTypeFilter = L&quot;/</em>&quot;; // initialize and register an event handler for the event type filter specified CtxPlay_Initialize(); CtxPlay_RegisterEventHandler(MyEventHandler, eventTypeFilter); // wait for event data processing to complete or CtxPlay_Abort() CtxPlay_WaitForCompletion(); // clean up
CtxPlay_Dispose(); Console::WriteLine(L&quot;\nEvent data processing completed.&quot;); return 0; }</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/虚拟化_Citrix/">虚拟化_Citrix</a></li></span></span> | <span class="tags">Tagged <a href="/tags/虚拟化_Citrix/" class="label label-primary">虚拟化_Citrix</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-虚拟化_Citrix--SmartAuditorEventAPIOverview-1/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-虚拟化_Citrix--SmartAuditorEventAPIOverview-1" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-虚拟化_Citrix--Resource_Manager_Updates/">Resource_Manager_Updates</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-虚拟化_Citrix--Resource_Manager_Updates/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="resource_manager_updates">Resource_Manager_Updates</h1>
<p><img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> Understanding Resource Manager Summary Database Updates
1) Resource Manager Summary logs are parsed line by line during the update process and inserted in the summary database during the configured update time.
XP Server
IMA RM Log
XP Server
IMA RM Log
DCS Data Connection Server
XP Server
IMA RM Log
RM Farm Summary DB
Before a file is recorded into the summary database, Resource Manager verifies the version of the log file is compatible version of the summary database. Resource Manager compares the value next to the HEADER descriptor against the schemaversion table version field. It must be equal to or greater than the log file’s value Log File Header Example
HEADER27,&quot;TSFTL1&quot;,&quot;WORKGROUP&quot;,&quot;MR Farm&quot;
2) The Resource Manager Data Connection server executes ADD/* procedures on each line of the summary log located under %SystemRoot%\Program Files\Citrix\Citrix Resource Manager\Summary Files to record the Resource Manager farm data.
<img src="" alt=""> 3) Error and status of summary updates are located under %SystemRoot%:\Program Files\Citrix\Citrix Resource Manager\ServerLogs. 4) Further information is available in the Feature Release 3 Resource Manager Administrator’s Guide including the document schema (pg 93)
Procedure Information
AddSession procedure updates SDBSESSION table and its related Look up tables (LU<em>) on sessions connected to the Citrix Farm. Parameters @sUserName - User Name @sNetDomain - Domain @sServerName - Server Name @sFarmName - Farm Name @sClientName – Citrix ICA Client Name @iClientAddressFamily - protocol type @sClientAddress – Client Network Address (IP) @sAppName - Application Name @iAppType - Application type: 0 = MetaFrame published application, 1 Resource Manager application @sWinStation – Winstation Name (Example @iProtocol - Protocol ID @dSessionStart - Session Start time @dSessionEND - Session End time @fDuration f - Duration of connection @iServerUTCBias - Used to calculate Server’s UTC time @iSessionUTCBias - Used to calculate Session Bias @iSessionID - Numeric ID of winstation @sUserDomain - User Logon Domain
<img src="" alt=""> Example
AddSession N&#39;rene&#39;, N&#39;MyDomain&#39;, N&#39;Myserver&#39;, N&#39;MR Farm&#39;, N&#39;FTLNRENEAIBMPAD&#39;, 2, N&#39;10.3.4.102&#39;, N&#39; &#39;, &lt;- Initial App connected or “” if desktop 0, N&#39;ICA-tcp/#4&#39;, 1, &#39;Mar 10 2005 2:42:47:000PM&#39;, NULL, Session has not ended when Resource Manager recorded information in summary database NULL, Session has not ended when Resource Manager recorded information in summary database 300, 300, 4, N&#39;MyServer&#39;
AddProcess procedure updates SDB_PROCESS table and its related Look up tables (LU</em>) on processes executed on the Citrix MetaFrame Server. Parameters @sUserName User Name @sNetDomain Domain @sServerName Server @sFarmName Server Name @sClientName Client Name @iClientAddressFamily Protocol type @sClientAddress Client Network Address @sAppName Initial Application @iAppType - Application type: 0 = MetaFrame published application, 1 Resource Manager application @sPathName Path of executable @sProcessName Process Name @sVersion Version @dProductDate Build Date of executable @iType Process Type @iPID Process ID @iExitCode Exit code when application terminated @iAffinity A mask indicating which processor(s) the process can use to execute itself @dStartTime Process creation time @dEndTime Process termination time @fTotalTime Total excitation time @fActiveTime A summation of all monitored periods of a process where the CPU time was greater than 1% @fKernelUse The percentage of kernel CPU time the process has used during its lifetime @fUserUseThe percentage of user CPU time the process has used during its lifetime @fUserActive The percentage of user CPU that was being used during the ACTIVETIME @fKernelActive The percentage of kernel CPU that was being used during the ACTIVETIME @fMemory Sum of the average number of megabytes per minute used by the process during its lifetime @fMemoryActive The number of megabytes per minute used by the process during the ACTIVETIME @iWorkSet The peak recorded working set of the processes at any point during its lifetime @iPageFile The peak page file allocated to process in bytes at any point in its lifetime @iPageFaults The number of page faults that occurred @iPagedPool The peak paged pool usage in bytes at any point in its
lifetime @iNonPagedPool The peak non-paged pool usage in bytes at any point in its Lifetime @iSessID Numeric ID of winstation @iServerUTCBias - Used to calculate Server’s UTC time @sUserDomain – Login domain @dSessionStart - Session Start time
Example
&#39;rene&#39;, &#39;WORKGROUP&#39;, &#39;TSFTL1&#39;, &#39;Citrix Farm&#39;, &#39;FTL-WIN2K3&#39;, 2, &#39;65.2.223.75&#39;, &#39; &#39;, 0, &#39;c:\program files\intuit\quickbooks pro\components\qbagent\&#39;, &#39;qbmsgmgr.exe&#39;, &#39;10.0.0.1&#39;, &#39;Dec 2 2004 5:30:56:000PM&#39;, 0, 4536, 0, 1, &#39;Mar 19 2005 3:16:57:000AM&#39;, &#39;Mar 19 2005 3:17:03:000AM&#39;, 6.172000000000000e+003, 6.155000000000000e+003, 1.263000011444092e+000, 7.450000047683716e-001, 5.030000209808350e-001, 1.023000001907349e+000, 1.602994743734598e-003, 1.602994743734598e-003, 2785280, 753664, 892, 19092, 4188, 12, 300, &#39;TSFTL1&#39;, &#39;Mar 18 2005 9:50:26:000PM&#39;
<img src="" alt=""> AddMetric procedure updates SDB<em>METRICS table and its related Look up tables (LU</em>) on configured Resource Manager server metrics. Parameters @sServerName – Server Name @sNetDomain - Domain Name @sFarmName - Farm Name @sObject - Object Name @sMetricCounter – Counter Name @sInstance – Instance name @dMetricUpdateTime @iServerUTCBias - Used to calculate Server’s UTC time @iMetricSamplePeriod - Sample period of summary record in seconds @iMetricDataCount - Number of data points used to summarize this row @fMinMetricValue - Minimum metric value @fMaxMetricValue - Maximum metric value @fMeanMetricValue - Mean metric value @fStdDevMetricValue - Standard deviation of metric values @sFolder – Folder location of server @sZone – Zone location of server
Example
&#39;CitrixServer&#39;, &#39;WORKGROUP&#39;, &#39;MR Farm&#39;, &#39;Citrix MetaFrame XP&#39;,
<img src="" alt=""> <img src="" alt=""> &#39;Data Store Connection Failure&#39;, &#39; &#39;, &#39;Mar 19 2005 6:23:49:000AM&#39;, 300, 3633, 80, 0.000000000000000e+000, 0.000000000000000e+000, 0.000000000000000e+000, 0.000000000000000e+000, &#39;Servers/&#39;, &#39;192.168.1.0
Purging Procedures
The following procedures execute based upon the retention period of data configured in the summary database. PurgeEvents Purges the SDB_EVENTLOG table of old records. This table stores generic IMA Service up and IMA Service down events that occur on a server farm. Parameters @farmName - Farm Name @sCutoffDate - All data prior to this date will be removed PurgeMetrics Purges the SDB_Metrics table and related tables. This table stores all metrics imported from each Resource Manager server in the server farm. Parameters @farmName - Farm Name @sCutoffDate - All data prior to this date will be removed PurgeBilledSessProc Purges the SDB_Session table and its related tables once the session has been billed. This table stores session data per user. Parameters @farmName - Farm Name @sCutoffDate - All data prior to this date will be removed except for NULL Session End entries. PurgeUnbilledSessProc Purges the SDB_Session table and its related tables. This table stores session data per user. Parameters @farmName - Farm Name @sCutoffDate - All session data prior to this date will be removed except for NULL Session end entries.</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/虚拟化_Citrix/">虚拟化_Citrix</a></li></span></span> | <span class="tags">Tagged <a href="/tags/虚拟化_Citrix/" class="label label-primary">虚拟化_Citrix</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-虚拟化_Citrix--Resource_Manager_Updates/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-虚拟化_Citrix--Resource_Manager_Updates" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-虚拟化_Citrix--SmartAuditor/">SmartAuditor</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-虚拟化_Citrix--SmartAuditor/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="smartauditor">SmartAuditor</h1>
<p><img src="" alt=""> <img src="" alt=""> Citrix Presentation Server SmartAuditor
Joël Stöcker Senior Systems Engineer EMEA, AVG
1 | © 2007 Citrix Systems, Inc.—All rights reserved.
Session Agenda
• What is SmartAuditor? • Technical Overview • Demo
2 | © 2007 Citrix Systems, Inc.—All rights reserved.
What is SmartAuditor?
An exclusive feature of Platinum Edition that uses flexible policies to trigger recordings of Presentation Server sessions automatically for later playback
• SmartAuditor leverages Presentation Server to provide:
• • • •
Policy-based recording of an ICA session &amp; associated session information Managed recording &amp; logging of ICA sessions to persistent storage Ability to search a catalog of recorded ICA sessions Playback of recorded ICA sessions for detailed analysis
• Analogy: SmartAuditor is like a Digital Video Recorder
3 | © 2007 Citrix Systems, Inc.—All rights reserved.
SmartAuditor
For improved compliance and risk management
• Enhanced auditing for regulatory compliance
• Monitor activity involving sensitive data • Record administrators screen to a video log for change management of critical systems
• Powerful application session recording for risk mitigation and eDiscovery support
• Capture screen updates, including mouse-clicks and keystrokes, to a video file • Configure monitoring of a specific user, application or server • Trusted digitally signed recording
• Accelerated problem resolution
• Replay actual screen activity at exact moment of application failure for fast troubleshooting
Advanced
Enterprise
Platinum
4 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> SmartAuditor – How It Works
Configure Capture Audit
Configure
Administrator selects which users, applications and servers to monitor Efficiently stores on-screen activity to video file in a central location and digitally signs each recording Administrative, helpdesk, and auditing teams can search the archive and review captured activity using an easy-to-use player
Capture
Audit
Select triggers for automatic capture
5 | © 2007 Citrix Systems, Inc.—All rights reserved.
System auto-captures and archives activity
Review captured activity
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> Advantages of SmartAuditor technology
Capture screen updates to video Quickly prepare video evidence for litigation Digitally signed account of application usage
File
Record application failure for faster analysis
Monitor suspicious activity
6 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> SmartAuditor Architectural Overview
7 | © 2007 Citrix Systems, Inc.—All rights reserved.
Architecture Overview
Unsecure Network
SmartAuditor Agent
Secure Datacenter
SmartAuditor Server SmartAuditor Player
0 Configure policies 1 Connection 2 Policy 2 Data
Establish ICA
1
2
2
PS Farm
Verify recording
DB
4
Send Session
0
3
5
Log Session Data 3 and Write to Storage
3rd Party Archive Solution
Storage SmartAuditor Policy Console
4 Data
Retrieve Session
Presentation Server Clients
5 Archive files
8 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> SmartAuditor recording and logging</p>
<ol>
<li>User accesses server-side virtualized
application running on Presentation Server
2 3
SmartAuditor Server</li>
<li>SmartAuditor agent begins recording
the session while it checks with SmartAuditor server whether session should be recorded</li>
<li>Agent continues recording session 4. SmartAuditor server stores metadata
and session recording
1
Presentation Server Client Presentation Server with SmartAuditor Agent Metadata and recording stream
4
9 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> Playback</li>
<li><ol>
<li><ol>
<li><ol>
<li><ol>
<li><ol>
<li>Authorized personnel accesses the player Initiate a search of the metadata records Search results are returned Selects recording of interest Retrieves log file from persistent storage Plays log file within playback window
2 3 5 6 4 1
SmartAuditor Server
10 | © 2007 Citrix Systems, Inc.—All rights reserved.
SmartAuditor Player
Security Auditor
<img src="" alt=""> <img src="" alt=""> SmartAuditor Technical Overview
11 | © 2007 Citrix Systems, Inc.—All rights reserved.
Content
• Components in detail • Design Considerations and Scalability • Security • POC Best Practices • Installation • Configuration • Let&#39;s take a look…
12 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> Components in Detail
13 | © 2007 Citrix Systems, Inc.—All rights reserved.
Architecture Overview
Unsecure Network
SmartAuditor Agent
Secure Datacenter
SmartAuditor Server SmartAuditor Player
1 Connection 2 Policy
Establish ICA
Verify recording
1
2
2
Presentation Server Farm
DB
4
2 Data
Send Session
3
5
Log Session Data 3 and Write to Storage
3rd Party Archive Solution
Storage SmartAuditor Policy Console
4 Data
Retrieve Session
Presentation Server Clients
5 Archive files
14 | © 2007 Citrix Systems, Inc.—All rights reserved.
Administration - SmartAuditor Policy Console
• The SmartAuditor Policy Console provides the ability to manage policies related to recording of ICA sessions • The SmartAuditor Policy Console is implemented as an MMC Console Snap-in • Installation pre-requisites (verified before installation):
• Windows XP, Vista or Windows Server 2003 (this can be a Presentation Server) • Microsoft .NET Framework 2.0
15 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> SmartAuditor Agent
• The SmartAuditor Agent is the component which will be installed on the Presentation Server(s) • Responsible for recording session data • The SmartAuditor Driver is installed as part of the agent and is responsible for gathering session recording data
• This component will only be exposed in the Admin guide and other troubleshooting docs
• Presentation Server Platinum License is required • Installation pre-requisites
• • • • Presentation Server 4.5 with Hotfix Rollup Pack 1 Windows Server 2003 Microsoft .NET Framework 2.0 Microsoft Message Queuing (MSMQ)
Capture
16 | © 2007 Citrix Systems, Inc.—All rights reserved.
SmartAuditor Agent - Overview
3
Get session metadata from MFCOM and various Win32 functions To SmartAuditor Broker
4
MFCOM Win32 API VDs VDs VDs WDICA WDICA WDICA PD TD PD /TD PD / /TD SA Driver SA Agent
To SmartAuditor Storage Manager (MSMQ)
5
6
IOCTLs to WDICA
Recording data and session information
2
To client
Recording data and TS/CPS session ID
1
17 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> Administration - SmartAuditor Server
• SmartAuditor Broker
• Installed as an IIS 6.0 (or later)/ASP.NET 2.0 hosted web application • Responsible for communicating with the SmartAuditor Database to enforce policy query decisions and communicating with the SmartAuditor Player to manage access to session recordings
• SmartAuditor Storage Manager
• Installed as a Windows service • Tasks include:
• • • • Writing Session Recording data to disk Writes metadata to database Generates digital signatures Records performance data (use perfmon)
Configure
• Installation pre-requisites (verified before installation):
• Windows Server 2003 • Microsoft .NET Framework 2.0 • Microsoft Message Queuing (MSMQ)
18 | © 2007 Citrix Systems, Inc.—All rights reserved.
Administration - SmartAuditor Server
Temporary Restore Directory
To SmartAuditor Agent
IIS 6.0/ASP.NET 2.0 SmartAuditor Broker
4
1 3
Master File Master File Master Storage File Storage Storage SmartAuditor Database
SmartAuditor Storage Manager
2
From SmartAuditor Agent (MSMQ)
19 | © 2007 Citrix Systems, Inc.—All rights reserved.
Administration - SmartAuditor Database
• The Storage Manager writes session recording file metadata and policies in the SmartAuditor Database
• Can co-exist on SQL Server with other databases • Database schema installer will create appropriate login and user security settings • SQL Server can be clustered • Availability features such as replication and mirroring are supported
• Installation pre-requisites for Database:
• Windows 2000 or 2003 Server • Runs on any edition of SQL Server 2005, including SQL Server 2005 Express Edition SP1 • SP2 has not been tested, so is not supported at this time • Microsoft .NET Framework 2.0
20 | © 2007 Citrix Systems, Inc.—All rights reserved.
Administration - SmartAuditor Database
• Holds session metadata, policies and custom event metadata • Session metadata is approximately 1KB per recording • Custom event metadata is also approximately 1KB per recording • All string data stored as UTF-16 • Indexes optimized for player searches
SmartAuditor Database SmartAuditor Storage Manager
21 | © 2007 Citrix Systems, Inc.—All rights reserved.
SmartAuditor Data storage
• Session recording data is stored on a central file store in flat files
• Multiple directories can be defined • Storage Manager will distribute files over directories
• Directories are created by year, month and day
• E.g. E:\Recordings\2007\10\30
• SmartAuditor leverages Citrix ICA protocol to enable session recordings file sizes to be much smaller than other video protocols • Files sizes are dependent upon the graphical content of the application
22 | © 2007 Citrix Systems, Inc.—All rights reserved.
SmartAuditor Player
• The application used to replay Presentation Server session recordings captured by the SmartAuditor software • Only interacts with SmartAuditor Broker component
• Annotation and Bookmarks can be set and are stored locally on the machine
• Search option for metadata
• E.g. date/time, user, application, server, etc
Audit
• Installation pre-requisites
• Windows XP, Vista or Windows Server 2003 • Microsoft .NET Framework 2.0
23 | © 2007 Citrix Systems, Inc.—All rights reserved.
Other Components and Utilities
• SmartAuditor Authorization Console
• A utility that enables SmartAuditor Server administrators to add users to pre-determined user roles
• SmartAuditor Custom Event API
• API for the SmartAuditor software which enables ISVs to inject custom data through a thirdparty application into a session recording
• SmartAuditor Player SDK
• An SDK for use by ISVs to write third-party SmartAuditor Player extensions which can display custom event data injected into the recorded session using the SmartAuditor Custom Event API
• icldb
• A command line utility that enables you to run queries and perform maintenance of the SmartAuditor Database
• iclstat
• A command line utility for the SmartAuditor Server that enables you to view metadata information about a session recording file
24 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> Design Considerations and Scalability
25 | © 2007 Citrix Systems, Inc.—All rights reserved.
Single-Server Scenario
Presentation Server 4.5 Platinum Edition Security Auditor Workstation
SmartAuditor Agent SmartAuditor Server SmartAuditor Database SmartAuditor Policy Console
SmartAuditor Player
26 | © 2007 Citrix Systems, Inc.—All rights reserved.
Two-Server Scenario
Presentation Server 4.5 Platinum Edition SmartAuditor Server Security Auditor Workstation
SmartAuditor Agent
SmartAuditor Server SmartAuditor Database SmartAuditor Policy Console
SmartAuditor Player
27 | © 2007 Citrix Systems, Inc.—All rights reserved.
Multiple-Server Scenario
Presentation Server 4.5 Platinum Edition SmartAuditor Server Database Server
SmartAuditor Agent Management Workstation
SmartAuditor Server Security Auditor Workstation
SmartAuditor Database
Storage (e.g. SAN, NAS)
SmartAuditor Policy Console
28 | © 2007 Citrix Systems, Inc.—All rights reserved.
SmartAuditor Player
Single Server Scalabilty
• Current SSS testing show about a 1-5% overhead for SmartAuditor
PS 4.5 FP 1 SmartAuditor
29 | © 2007 Citrix Systems, Inc.—All rights reserved.
SmartAuditor Storage
Estimated Recording Size Storage Needs
&lt; 200GB for 10,000 users
/<em> Estimated file size for 8 hour recording. Typical interaction = e.g. Microsoft Outlook Non-Stop interaction = e.g. Microsoft Excel
/</em> Assumes 50% typical and 50% non-stop interaction sessions with a duration of 8 hours. All calculations use estimated recording sizes.
30 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> Security
31 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> SmartAuditor Security
• SmartAuditor is designed to have the most secure configuration out-of-the-box
32 | © 2007 Citrix Systems, Inc.—All rights reserved.
Security
• SmartAuditor Agent
• Non-administrator users have no means of disabling recording or accessing recorded data • All Presentation Server configuration settings for SmartAuditor are in the registry with strong ACL security; nonadministrators cannot even view settings
• SmartAuditor Server
• Recordings can be digitally signed with a certificate • The SmartAuditor Storage Manager service is required to run as “Local System” but has all unused privileges removed • The SmartAuditor Broker runs as “Network Service” (i.e., less privileged than “Local System”) and has all unused privileges removed
33 | © 2007 Citrix Systems, Inc.—All rights reserved.
Security (cont’d)
• Communications
• SSL communication option is recommended for both the control channel (i.e., to the SmartAuditor Broker) and data channel (i.e., MSMQ) • Client authentication to server is Windows Authentication only
• SmartAuditor Player
• Only authorized users are able to search or download recorded session files • Playback Protection: encrypts recorded session files before downloading to the player • Download of files using the “Live Playback” feature is less secure than viewing a completed recording as the live downloaded data is not signed nor encrypted using playback protection
34 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> SmartAuditor POC Best Practices
35 | © 2007 Citrix Systems, Inc.—All rights reserved.
Things to know for Proof Of Concept setup
• If no certificate used, disable HTTPS in multiple places (see Admin Guide Page 68) • If database instance not designated correctly during installation, must uninstall and reinstall • Cannot use autorun to install from a network share • SQL Server Express 2005 works fine for database • Does not integrate with Desktop Server
36 | © 2007 Citrix Systems, Inc.—All rights reserved.
Things to know for POC setup (cont’d)
• Hotfix PSE450R01W2K3011 required • Default policy is do not record • Workgroup works for single server; not supported for multiple servers • When auditing based on application, only first application is used for decision
• May need to silo app or disable session sharing
• A 10.15 ICA recording cannot be played with the Player built on 10.1 client
37 | © 2007 Citrix Systems, Inc.—All rights reserved.
Keep in Mind . . .
• Disable SmartAuditor on servers where recording is not required
• Initially starts to record until policy dictates otherwise
• Initial popup can be customized, including language • Can configure multiple farms to use a single SmartAuditor server; SmartAuditor Agent can only point to one server at a time • Large files are rolled over based on configured file size or duration (whichever occurs first) • Not recommended to publish the Player as a CPS application because of high memory requirements
38 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> Installation
39 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> Installation
40 | © 2007 Citrix Systems, Inc.—All rights reserved.
Installation Order</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>CPS • HRP1, Platinum license, and set to Platinum edition • Hotfix PSE450R01W2K3011 2. SmartAuditor Server • Install SQL Server 2005 (full or Express) • Install and configure SmartAuditor Administration
• Database • Server • Policy Console</li>
<li>SmartAuditor Agent • Install and configure SmartAuditor Agent 4. Workstation • Install and configure SmartAuditor Player
41 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> Configuration
42 | © 2007 Citrix Systems, Inc.—All rights reserved.
Basic Configuration SmartAuditor Server
• SmartAuditor Server Properties:
• Set file storage location (if different from default) • Optional configuration:
• • • • Set signing certificate Modify roll-over thresholds Modify playback settings Modify notification settings
• SmartAuditor Authorization Console:
• Assign correct users to the Player, PolicyQuery and Policy Administrator roles
• SmartAuditor Policy Console:
• Create recording policy (if required) • Set active recording policy
43 | © 2007 Citrix Systems, Inc.—All rights reserved.
Basic Configuration SmartAuditor Agent
• SmartAuditor Agent Properties: • Enable session recording (default) • Optional configuration:
• Custom event recording • Connection settings: • SmartAuditor Server • MSMQ Protocol/port • MSMQ message life • SmartAuditor Broker Protocol/port
44 | © 2007 Citrix Systems, Inc.—All rights reserved.
Basic Configuration SmartAuditor Player
• SmartAuditor Player options: • Add Server • Optional configuration:
• Seek response time • Player search settings • Player Cache settings
45 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> Let’s take a look...
46 | © 2007 Citrix Systems, Inc.—All rights reserved.
<img src="" alt=""> <img src="" alt=""> Reference Documentation
• This slide deck • SmartAuditor Administrator’s Guide
• CTX113599
<a href="http://support.citrix.com/article/CTX113599" target="_blank">http://support.citrix.com/article/CTX113599</a>
• Built-in SmartAuditor player help • Knowledge Base articles
• Building a Highly Scalable SmartAuditor Server [CTX114799] • Citrix SmartAuditor Database Maintenance How to Archive and Restore Session Recordings [CTX114818] • Troubleshooting Recording Issues in Citrix SmartAuditor [CTX114819]
47 | © 2007 Citrix Systems, Inc.—All rights reserved.
48 | © 2007 Citrix Systems, Inc.—All rights reserved.
49 | © 2007 Citrix Systems, Inc.—All rights reserved.</li>
</ol>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/虚拟化_Citrix/">虚拟化_Citrix</a></li></span></span> | <span class="tags">Tagged <a href="/tags/虚拟化_Citrix/" class="label label-primary">虚拟化_Citrix</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-虚拟化_Citrix--SmartAuditor/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-虚拟化_Citrix--SmartAuditor" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-虚拟化_Citrix--ConnectingThroughWindowsFirewallWindows/">Connecting Through Windows Firewall (Windows)</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-虚拟化_Citrix--ConnectingThroughWindowsFirewallWindows/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="connecting-through-windows-firewall-windows-">Connecting Through Windows Firewall (Windows)</h1>
<p><a href="http://msdn.microsoft.com/en-us/" title="Home" target="_blank">Home</a> <a href="http://msdn.microsoft.com/en-us/library" title="Library" target="_blank">Library</a> <a href="http://msdn.microsoft.com/en-us/bb188199.aspx" title="Learn" target="_blank">Learn</a> <a href="http://msdn.microsoft.com/en-us/aa570309.aspx" title="Downloads" target="_blank">Downloads</a> <a href="http://msdn.microsoft.com/en-us/aa570318.aspx" title="Support" target="_blank">Support</a> <a href="http://msdn.microsoft.com/en-us/aa497440.aspx" title="Community" target="_blank">Community</a> <a href="https://login.live.com/login.srf?wa=wsignin1.0&amp;rpsnv=11&amp;ct=1295403418&amp;rver=6.0.5276.0&amp;wp=MCLBI&amp;wlcxt=msdn%24msdn%24msdn&amp;wreply=http:%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Faa389286.aspx&amp;lc=1033&amp;cb=&amp;id=254354" title="Sign in" target="_blank">Sign in</a>| <a href="http://msdn.microsoft.com/en-us/library/preferences/locale/?returnurl=%252fen-us%252flibrary%252faa389286.aspx" title="中国（简体中文）" target="_blank">中国（简体中文）</a>| <a href="http://msdn.microsoft.com/en-us/library/preferences/experience/?returnurl=%252fen-us%252flibrary%252faa389286.aspx" title="Preferences" target="_blank">Preferences</a></p>
<p><a href="http://msdn.microsoft.com/en-us/library/aa389286.aspx#" target="_blank"><img src="&quot;Search&quot;" alt="Search"></a></p>
<p><img src="" alt=""></p>
<p><a href="http://msdn.microsoft.com/en-us/library/ms123401.aspx" title="MSDN Library" target="_blank">MSDN Library</a>
<img src="" alt=""></p>
<p><a href="http://msdn.microsoft.com/en-us/library/ee663300(v=VS.85" target="_blank">Windows Development</a>.aspx &quot;Windows Development&quot;)
<img src="" alt=""></p>
<p><a href="http://msdn.microsoft.com/en-us/library/ee663258(v=VS.85" target="_blank">Administration and Management</a>.aspx &quot;Administration and Management&quot;)
<img src="" alt=""></p>
<p><a href="http://msdn.microsoft.com/en-us/library/aa394582(v=VS.85" target="_blank">Windows Management Instrumentation</a>.aspx &quot;Windows Management Instrumentation&quot;)
<img src="" alt=""></p>
<p><a href="http://msdn.microsoft.com/en-us/library/aa393964(v=VS.85" target="_blank">Using WMI</a>.aspx &quot;Using WMI&quot;)
<img src="" alt=""></p>
<p><a href="http://msdn.microsoft.com/en-us/library/cc512236(v=VS.85" target="_blank">Creating WMI Clients</a>.aspx &quot;Creating WMI Clients&quot;)
<img src="" alt=""></p>
<p><a href="http://msdn.microsoft.com/en-us/library/aa389290(v=VS.85" target="_blank">Connecting to WMI on a Remote Computer</a>.aspx &quot;Connecting to WMI on a Remote Computer&quot;)</p>
<p><img src="" alt="">
<a href="http://msdn.microsoft.com/en-us/library/aa389286(v=VS.85" target="_blank">Connecting Through Windows Firewall</a>.aspx &quot;Connecting Through Windows Firewall&quot;) <img src="" alt="Separator"></p>
<p>Community Content</p>
<p><a href="http://msdn.microsoft.com/en-us/library/aa389286.aspx#CommunityContent" title="User" target="_blank"><img src="" alt="Avatar"></a></p>
<ul>
<li>Add code samples and tips to enhance this topic.
<a href="http://msdn.microsoft.com/en-us/library/aa389286.aspx#CommunityContent" title="More..." target="_blank">More...</a>
<a href="http://msdn.microsoft.com/en-us/library/aa389286.aspx#" target="_blank"><img src="&quot;Expand&quot;" alt="Expand"> <img src="&quot;Minimize&quot;" alt="Minimize"></a></li>
</ul>
<p><a href="http://msdn.microsoft.com/en-us/library/default.aspx" target="_blank"><img src="&quot;MSDN&quot;" alt="MSDN"></a><img src="" alt=""></p>
<h1 id="connecting-through-windows-firewall">Connecting Through Windows Firewall</h1>
<p>The <a href="http://msdn.microsoft.com/en-us/library/aa364727.aspx" target="_blank">Windows Firewall</a> (formerly known as Internet Connection Firewall) service and Distributed Component Object Model (DCOM) can cause access denied errors (such as an &quot;RPC Server Unavailable&quot; error - 0x800706ba) when your remote computers and accounts, used for remote connections, are not properly configured.</p>
<p><strong>Note</strong>  Content in this topic applies to Windows XP with Service Pack 2 (SP2) and Windows Server 2003 with Service Pack 1 (SP1). For information that applies to Windows Vista, see <a href="http://msdn.microsoft.com/en-us/library/aa822854.aspx" target="_blank">Connecting to WMI Remotely Starting with Vista</a>.
<strong>Windows Server 2003 with SP1:  </strong>The Windows Firewall is not enabled by default. <strong>Windows XP with SP2:  </strong>The Windows Firewall is enabled by default.</p>
<p>Resetting the firewall settings will enable the firewall—regardless of the platform.</p>
<p><strong>Windows Server 2003 and Windows XP:  </strong>Windows Firewall is not available. Use Internet Connection Firewall.</p>
<p>When obtaining data from a remote computer, WMI must establish a DCOM connection from Computer A (the local computer) to Computer B (the remote computer)—this is shown in the diagram as Connection 1. To establish this connection, both Windows Firewall and DCOM on Computer B must be configured appropriately. The configuration must be done locally on Computer B either by changing the Group Policy settings, by executing NETSH commands, or by executing a script locally. Windows Firewall does not support any remote configuration. The following sections describe how to configure Connection 1 and Connection 2 using NETSH commands and the Group Policy editor. For more information about configuring the connections with a script, see <a href="http://go.microsoft.com/FWLink/?LinkId=84425" target="_blank"><strong><a href="http://www.microsoft.com/technet/community/columns/scripts/sg1104.mspx/#EJAA">http://www.microsoft.com/technet/community/columns/scripts/sg1104.mspx/#EJAA</a></strong></a>.</p>
<p>The following diagram shows the relationship of WMI, the Windows Firewall, and DCOM when a script or another WMI client makes an asynchronous call to obtain data from WMI. Synchronous and semisynchronous calls only make Connection 1. Connection 2 occurs only with asynchronous calls. If the script or application made an <a href="http://msdn.microsoft.com/en-us/library/aa390790.aspx#wmi.gloss_asynchronous_method" target="_blank"><em>asynchronous</em></a> call, Connection 2 from Computer B to Computer A delivers the results. This delivery is the callback to the <a href="http://msdn.microsoft.com/en-us/library/aa390836.aspx#wmi.gloss_sink" target="_blank"><em>sink</em></a>. When possible, semisynchronous calls should be made instead of asynchronous calls. The performance of semisynchronous calls is almost as good as asynchronous calls and semisynchronous calls are more secure.</p>
<p><img src="&quot;WMI client making an asynchronous call to obtain data from WMI&quot;" alt="WMI client making an asynchronous call to obtain data from WMI"></p>
<p><strong>WMI client making an asynchronous call to obtain data from WMI</strong></p>
<p>To successfully connect from Computer A to Computer B when the Windows Firewall is enabled on Computer B, some configuration of firewall settings is necessary. The following procedure helps you configure Connection 1.</p>
<p><img src="&quot;Aa389286.wedge(en-us,VS.85" alt="Aa389286.wedge(en-us,VS.85).gif">.gif&quot;)<strong>To configure Connection 1</strong></p>
<ol>
<li>Ensure that the user account that is on Computer A is a local administrator on Computer B.</li>
</ol>
<p>If the user account that is on Computer A is not an administrator on Computer B, but the user account has Remote Enable permission on Computer B, then the user must also be given DCOM Remote Launch and Remote Activation privileges on Computer B by running <strong>Dcomcnfg.exe</strong> at the command prompt. For more information, see the remote launch and activation permissions procedure in <a href="http://msdn.microsoft.com/en-us/library/aa393266.aspx" target="_blank">Securing a Remote WMI Connection</a>. The 0x80070005 error occurs when this privilege is not set. For more information, see <a href="http://msdn.microsoft.com/en-us/library/aa822575.aspx" target="_blank">Access to WMI Namespaces</a>.</p>
<ol>
<li>Allow for remote administration on Computer B.</li>
</ol>
<p>You can use either the Group Policy editor (Gpedit.msc) or a script to enable the Windows Firewall: Allow remote administration exception, or use a netsh firewall command at the command prompt to allow for remote administration on Computer B. The following command enables this feature.</p>
<p><strong>netsh firewall set service**</strong>RemoteAdmin<strong>**enable</strong></p>
<p>If you would rather use the Group Policy editor than the NETSH commands above, use the following steps in the Group Policy editor (Gpedit.msc) to enable &quot;Allow Remote Administration&quot; on Computer B.</p>
<ol>
<li>Under the <strong>Local Computer Policy</strong> heading, double-click <strong>Computer Configuration</strong>.</li>
<li>Double-click <strong>Administrative Templates</strong>, <strong>Network</strong>, <strong>Network Connections</strong>, and then <strong>Windows Firewall</strong>.</li>
<li>If the computer is in the domain, then double-click <strong>Domain Profile</strong>; otherwise, double-click <strong>Standard Profile</strong>.</li>
<li>Click <strong>Windows Firewall: Allow remote administration exception</strong>.</li>
<li>On the <strong>Action</strong> menu, select <strong>Properties</strong>.</li>
<li>Click <strong>Enable</strong>, and then click <strong>OK</strong>.</li>
</ol>
<p>The connection from Computer B to Computer A (Connection 2 in the diagram above) is only required when the client script or application makes an asynchronous call to the remote computer. When possible, semisynchronous calls should be made instead of asynchronous calls. The call performance of semisynchronous calls is almost as good as asynchronous calls and semisynchronous calls are more secure. For more information, see <a href="http://msdn.microsoft.com/en-us/library/aa384832.aspx" target="_blank">Calling a Method</a> or <a href="http://msdn.microsoft.com/en-us/library/aa392903.aspx" target="_blank">Querying WMI</a>. The following procedure helps you configure Connection 2.</p>
<p><img src="&quot;Aa389286.wedge(en-us,VS.85" alt="Aa389286.wedge(en-us,VS.85).gif">.gif&quot;)<strong>To configure Connection 2</strong></p>
<ol>
<li>If the Windows Firewall is enabled on Computer A, enable the &quot;Allow Remote Administration&quot; exception (step 2 in the procedure above) and open the DCOM port TCP 135 on Computer A. If this port is not open, the error 0x800706ba will occur. You can open port 135 using the following command.</li>
</ol>
<p><strong>netsh firewall add portopening**</strong>protocol=<strong><strong>tcp</strong></strong>port=<strong><strong>135</strong></strong>name=<em>**DCOM_TCP135</em></p>
<ol>
<li>Add the client application or script, which contains the sink for callback to the Windows Firewall Exceptions List on Computer A. If the client is a script or a MMC snap-in, the sink is often Unsecapp.exe. For these connections, add %windir%\system32\wbem\unsecapp.exe to the Windows Firewall application exceptions list. You can add Unsecapp.exe with the following command.</li>
</ol>
<p><strong>netsh firewall add allowedprogram**</strong>program=<strong><strong>%windir%\system32\wbem\unsecapp.exe</strong></strong>name=<strong>**UNSECAPP</strong></p>
<p>Generally a C++ application has a sink written for the application. In that case, the application sink should be added to the firewall exceptions.</p>
<ol>
<li>If Computer B is either a member of WORKGROUP or is in a different domain that is untrusted by Computer A, then Connection 2 is created as an Anonymous connection. An anonymous connection fails with either the 0x80070005 error or the 0x8007000e error unless Anonymous connections are given the DCOM Remote Access permission on Computer A. The steps to grant DCOM remote access permissions are listed in <a href="http://msdn.microsoft.com/en-us/library/aa393266.aspx" target="_blank">Securing a Remote WMI Connection</a>.</li>
</ol>
<h3 id="-related-topics"><a href=""></a>Related Topics</h3>
<p><a href="http://msdn.microsoft.com/en-us/library/aa389290.aspx" target="_blank">Connecting to WMI on a Remote Computer</a><a href="http://msdn.microsoft.com/en-us/library/aa389284.aspx" target="_blank">Connecting Between Different Operating Systems</a><a href="http://msdn.microsoft.com/en-us/library/aa393266.aspx" target="_blank">Securing a Remote WMI Connection</a><a href="http://msdn.microsoft.com/en-us/library/aa389769.aspx" target="_blank">Creating Processes Remotely</a><a href="http://msdn.microsoft.com/en-us/library/aa393614.aspx" target="_blank">Setting Security on an Asynchronous Call</a><a href="http://msdn.microsoft.com/en-us/library/aa393615.aspx" target="_blank">Setting Security on an Asynchronous Call in VBScript</a></p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation feedback [wmisdk\wmi]:  Connecting Through Windows Firewall  RELEASE: (1/6/2011">Send comments about this topic to Microsoft</a>&amp;body=PRIVACY STATEMENTThe SDK team uses the feedback submitted to improve the SDK documentation. We do not use your email address for any other purpose. We will remove your email address from our system after the issue you are reporting has been resolved. While we are working to resolve this issue, we may send you an email message to request more information about your feedback. After the issues have been addressed, we may send you an email message to let you know that your feedback has been addressed.For more information about Microsoft&#39;s privacy policy, see <a href="http://privacy.microsoft.com/en-us/default.aspx" target="_blank">http://privacy.microsoft.com/en-us/default.aspx</a>. &quot;Send comments about this topic to Microsoft&quot;)</p>
<p>Build date: 1/6/2011
Community Content <a href="http://msdn.microsoft.com/en-us/library/community/add/aa389286.aspx" title="Add" target="_blank">Add</a></p>
<p><a href="http://msdn.microsoft.com/en-us/library/community-edits.rss?topic=aa389286|en-us|VS.85" title="Annotations" target="_blank"><img src="" alt="Annotations"></a> <a href="http://msdn.microsoft.com/en-us/library/community-msdnwikifaq.aspx" title="FAQ" target="_blank">FAQ</a>
© 2011 Microsoft Corporation. All rights reserved. <a href="http://msdn.microsoft.com/cc300389.aspx" target="_blank">Terms of Use</a> | <a href="http://www.microsoft.com/library/toolbar/3.0/trademarks/en-us.mspx" target="_blank">Trademarks</a> | <a href="http://www.microsoft.com/info/privacy.mspx" target="_blank">Privacy Statement</a> | <a href="http://msdn.microsoft.com/en-us/library/aa389286.aspx#footerLink" title="Feedback" target="_blank">Feedback <img src="" alt="Feedback"></a></p>
<p>Feedback</p>
<p><a href="">x</a></p>
<p>Tell us about your experience...</p>
<p>Did the page load quickly?
Yes  No</p>
<p>Do you like the page design?
Yes  No</p>
<p>How useful is this topic?
<img src="" alt=""></p>
<p>Tell us more
Enter description here.</p>
<p><img src="" alt="DCSIMG"></p>
<p><a href="http://www.omniture.com/" title="Web Analytics" target="_blank"><img src="" alt=""></a>
<img src="" alt="Page view tracker"></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/虚拟化_Citrix/">虚拟化_Citrix</a></li></span></span> | <span class="tags">Tagged <a href="/tags/虚拟化_Citrix/" class="label label-primary">虚拟化_Citrix</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-虚拟化_Citrix--ConnectingThroughWindowsFirewallWindows/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-虚拟化_Citrix--ConnectingThroughWindowsFirewallWindows" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/95/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/93/">93</a></li><li><a class="page-number" href="/page/94/">94</a></li><li><a class="page-number" href="/page/95/">95</a></li><li class="active"><li><span class="page-number current">96</span></li><li><a class="page-number" href="/page/97/">97</a></li><li><a class="page-number" href="/page/98/">98</a></li><li><a class="page-number" href="/page/99/">99</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/97/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 17:28:50</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
