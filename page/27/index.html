
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 27 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--JosephusProblem/">JosephusProblem</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--JosephusProblem/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="josephusproblem">JosephusProblem</h1>
<h1 id="-algorithm-gossip-josephus-problem-"><a href="">Algorithm Gossip: 约瑟夫问题（Josephus Problem）</a></h1>
<h2 id="-">说明</h2>
<p>据说著名犹太历史学家 Josephus有过以下的故事：在罗马人占领乔塔帕特后，39 个犹太人与Josephus及他的朋友躲到一个洞中，39个犹太人决定宁愿死也不要被敌人到，于是决定了一个自杀方式，41个人排成一个圆圈，由第1个人 开始报数，每报数到第3人该人就必须自杀，然后再由下一个重新报数，直到所有人都自杀身亡为止。
然而Josephus 和他的朋友并不想遵从，Josephus要他的朋友先假装遵从，他将朋友与自己安排在第16个与第31个位置，于是逃过了这场死亡游戏。</p>
<h2 id="-">解法</h2>
<p>约瑟夫问题可用代数分析来求解，将这个问题扩大好了，假设现在您与m个朋友不幸参与了这个游戏，您要如何保护您与您的朋友？只要画两个圆圈就可以让自己与朋友免于死亡游戏，这两个圆圈内圈是排列顺序，而外圈是自杀顺序，如下图所示：
<img src="&quot;约瑟夫问题&quot;" alt="约瑟夫问题"> 使用程式来求解的话，只要将阵列当作环状来处理就可以了，在阵列中由计数1开始，每找到三个无资料区就填入一个计数，直而计数达41为止，然后将阵列由索引1开始列出，就可以得知每个位置的自杀顺序，这就是约瑟夫排列，41个人而报数3的约琴夫排列如下所示：
14 36 1 38 15 2 24 30 3 16 34 4 25 17 5 40 31 6 18 26 7 37 19 8 35 27 9 20 32 10 41 21 11 28 39 12 22 33 13 29 23
由上可知，最后一个自杀的是在第31个位置，而倒数第二个自杀的要排在第16个位置，之前的人都死光了，所以他们也就不知道约琴夫与他的朋友并没有遵守游戏规则了。</p>
<h2 id="-">实作</h2>
<ul>
<li><p>C
/#include <stdio.h>
/#include <stdlib.h>
/#define N 41
/#define M 3
int main(void) {
int man[N] = {0};
int count = 1;
int i = 0, pos = -1;
int alive = 0;
while(count &lt;= N) {
do {
pos = (pos+1) % N; // 环状处理
if(man[pos] == 0)
i++;
if(i == M) { // 报数为3了
i = 0;
break;
}
} while(1);
man[pos] = count;
count++;
}
printf(&quot;\n约琴夫排列：&quot;);
for(i = 0; i &lt; N; i++)
printf(&quot;%d &quot;, man[i]);
printf(&quot;\n\n您想要救多少人？&quot;);
scanf(&quot;%d&quot;, &amp;alive);
printf(&quot;\nL表示这%d人要放的位置：\n&quot;, alive);
for(i = 0; i &lt; N; i++) {
if(man[i] &gt; alive)
printf(&quot;D&quot;);
else
printf(&quot;L&quot;);
if((i+1) % 5 == 0)
printf(&quot; &quot;);
}
printf(&quot;\n&quot;);
return 0;
}</p>
</li>
<li><p>Java
public class Josephus {
public static int[] arrayOfJosephus(
int number, int per) {
int[] man = new int[number];
for(int count = 1, i = 0, pos = -1;
count &lt;= number; count++) {
do {
pos = (pos+1) % number; // 环状处理
if(man[pos] == 0)
i++;
if(i == per) { // 报数为3了
i = 0;
break;
}
} while(true);
man[pos] = count;
}
return man;
}
public static void main(String[] args) {
int[] man = Josephus.arrayOfJosephus(41, 3);
int alive = 3;
System.out.println(&quot;约琴夫排列：&quot;);
for(int i = 0; i &lt; 41; i++)
System.out.print(man[i] + &quot; &quot;);
System.out.println(&quot;\nL表示3个存活的人要放的位置：&quot;);
for(int i = 0; i &lt; 41; i++) {
if(man[i] &gt; alive)
System.out.print(&quot;D&quot;);
else
System.out.print(&quot;L&quot;);
if((i+1) % 5 == 0)
System.out.print(&quot; &quot;);
}
System.out.println();
}
}</p>
</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/AlgorithmGossip/">AlgorithmGossip</a></li></span></span> | <span class="tags">Tagged <a href="/tags/AlgorithmGossip/" class="label label-primary">AlgorithmGossip</a></span> | <span class="time">recent updated:<time title="2014-03-07 10:37:19"datetime="2014-03-07 10:37:19"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--JosephusProblem/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-AlgorithmGossip-AlgorithmGossip--JosephusProblem" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-xml-xstream--XStream-FrequentlyAskedQuestions/">XStream </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-xml-xstream--XStream-FrequentlyAskedQuestions/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="xstream-frequently-asked-questions">XStream - Frequently Asked Questions</h1>
<p><a href="http://xstream.codehaus.org/index.html" target="_blank"><img src="" alt="XStream"></a></p>
<h1 id="frequently-asked-questions">Frequently Asked Questions</h1>
<ol>
<li><a href="http://xstream.codehaus.org/faq.html#Compatibility" target="_blank">Compatibility</a></li>
<li><a href="http://xstream.codehaus.org/faq.html#Serialization" target="_blank">Serialization</a></li>
<li><a href="http://xstream.codehaus.org/faq.html#XML" target="_blank">XML specifics</a></li>
<li><a href="http://xstream.codehaus.org/faq.html#JSON" target="_blank">JSON specifics</a></li>
<li><a href="http://xstream.codehaus.org/faq.html#Other_Products" target="_blank">Comparison to other products</a></li>
<li><a href="http://xstream.codehaus.org/faq.html#Scalability" target="_blank">Scalability</a></li>
<li><a href="http://xstream.codehaus.org/faq.html#Uses" target="_blank">Uses of XStream</a></li>
</ol>
<h1 id="compatibility">Compatibility</h1>
<h2 id="which-jdk-is-required-to-use-xstream-">Which JDK is required to use XStream?</h2>
<p>1.3 or later.</p>
<h2 id="does-xstream-behave-differently-across-different-jvms-">Does XStream behave differently across different JVMs?</h2>
<p>XStream has two modes of operation: <strong>Pure Java</strong> and <strong>Enhanced</strong>. In pure Java mode, XStream behaves in the same way across different JVMs, however its features are limited to what reflection allows, meaning it cannot serialize certain classes or fields. In <strong>enhanced</strong> mode, XStream does not have these limitations, however this mode of operation is not available to all JVMs.</p>
<h2 id="which-jvms-allow-xstream-to-operate-in-enhanced-mode-">Which JVMs allow XStream to operate in enhanced mode?</h2>
<p>Currently on the Sun, Apple, HP, IBM and Blackdown 1.4 JVMs and onwards. Also for Hitachi, SAP and Diablo from 1.5 and onwards. Support for BEA JRockit starting with R25.1.0. For all other JVMs, XStream should be used in pure Java mode.</p>
<h2 id="what-are-the-advantages-of-using-enhanced-mode-over-pure-java-mode-">What are the advantages of using enhanced mode over pure Java mode?</h2>
<p>Feature Pure Java Enhanced Mode Public classes Yes Yes Non public classes No Yes Static inner classes Yes Yes Non-static inner classes No Yes Anonymous inner classes No Yes With default constructor Yes Yes Without default constructor No Yes Private fields Yes Yes Final fields Yes &gt;= JDK 1.5 Yes</p>
<h2 id="can-i-use-xstream-in-an-android-application-">Can I use XStream in an Android application?</h2>
<p>XStream does work in Android 1.0, but has limited capabilities. XStream does not support enhanced mode for Android. Additionally Android reports itself as implementation of JDK specification 0.9, so it is not possible to write into final fields. Android also does not include the java.beans package. Therefore you cannot use the JavaBeanConverter.</p>
<h2 id="why-does-xstream-fail-on-harmony-">Why does XStream fail on Harmony?</h2>
<p>Since JDK 5 it is possible according the Java specification to write into final fields using reflection. This is not yet supported by Harmony and therefore the PureJavaReflectionProvider fails. We have also already investigated into enhanced mode in Harmony, but the Harmony JVM currently crashes running the unit tests. It is simply not yet ready.</p>
<h2 id="are-there-plans-to-provide-enhanced-mode-support-to-other-jvms-">Are there plans to provide enhanced mode support to other JVMs?</h2>
<p>Yes. <a href="http://xstream.codehaus.org/list-user.html" target="_blank">Let us know</a> which JVM you would like supported.</p>
<h2 id="when-should-i-use-xstream-not-in-enhanced-mode-">When should I use XStream not in enhanced mode?</h2>
<p>Running XStream in a secured environment can prevent XStream from running in enhanced mode. This is especially true when running XStream in an applet. You may also try to use the JavaBeanConverter as alternative to the ReflectionConverter running in enhanced or pure Java mode.</p>
<h2 id="which-permissions-does-xstream-need-when-running-with-an-active-securitymanager-">Which permissions does XStream need when running with an active SecurityManager?</h2>
<p>This depends on the mode XStream is running in. Refer to the <a href="http://svn.xstream.codehaus.org/browse/xstream/trunk/xstream/src/test/com/thoughtworks/acceptance/SecurityManagerTest.java" target="_blank">SecurityManagerTest</a> for details.</p>
<h2 id="why-does-xstream-1-2-no-longer-read-xml-generated-with-xstream-1-1-x-">Why does XStream 1.2 no longer read XML generated with XStream 1.1.x?</h2>
<p>The architecture in XStream has slightly changed. Starting with XStream 1.2 the <a href="http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/io/HierarchicalStreamDriver.html" target="_blank">HierarchicalStreamDriver</a> implementation is responsible to ensure that XML tags and attributes are valid names in XML, in XStream 1.1.x this responsibility was part of the ClassMapper implementations. Under some rare circumstances this will result in an unreadable XML due to the different processing order in the workflow of such problematic tag names.</p>
<p>You can run XStream in 1.1 compatibility mode though:
XStream xstream = new XStream(new XppDriver(new XStream11XmlFriendlyReplacer())) { protected boolean useXStream11XmlFriendlyMapper() { return true; } };</p>
<h2 id="xstream-1-3-ignores-suddenly-annotated-converters-xstreamconverter-and-xstreamconverters-">XStream 1.3 ignores suddenly annotated converters (@XStreamConverter and @XStreamConverters)?</h2>
<p>XStream treats now all annotations the same and therefore it no longer auto-detects any annotation by default. You can configure XStream to run in auto-detection mode, but be aware if the <a href="http://xstream.codehaus.org/annotations-tutorial.html#AutoDetect" target="_blank">implications</a>. As alternative you might register the deprecated AnnotationReflectionConverter, that was used for XStream pre 1.3.x, but as drawback the functionality to register a local converter with XStream.registerLocalConverter will no longer work.</p>
<h2 id="xstream-1-3-suddenly-has-a-different-field-order-">XStream 1.3 suddenly has a different field order?</h2>
<p>Yes. This was announced with the last 1.2.x release and was done to support the type inheritance of XML schemas. However, XStream is delivered with the <a href="http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/io/HierarchicalStreamDriver.html" target="_blank">XStream12FieldKeySorter</a> that can be used to <a href="http://xstream.codehaus.org/faq.html#Serialization_sort_fields" target="_blank">sort the fields</a> according XStream 1.2.2.</p>
<h1 id="serialization">Serialization</h1>
<h2 id="which-class-types-can-be-serialized-by-xstream-">Which class types can be serialized by XStream?</h2>
<p>In contrast to the JDK XStream is not tied to a marker interface to serialize a class. XStream ships with some specialized <a href="http://xstream.codehaus.org/converters.html" target="_blank">converters</a>, but will use reflection by default for &quot;unknown&quot; classes to examine, read and write the class&#39; data. Therefore XStream can handle quite any class, especially the ones referred as POJO (Plain Old Java Object).</p>
<p>However, some types of classes exist with typical characteristics, that cannot be handled - at least not out of the box:</p>
<ol>
<li>Objects that are based on threads or thread local data: Thread, Timer, ThreadLocal and so on. These classes keep different data for different threads and there&#39;s no possibility to recreate a thread in a generic way nor recreating thread specific data. There might be special use cases, but this will always involve a custom converter where threads can be recreated in a specific way tied to that use case.</li>
<li>Class types that are based on generated classes. Such types have often names that are unique to the current process and will have no meaning in a different process. A custom converter might help to write the appropriate data into the serializing stream to be able to recreate a equivalent class at deserialization time.</li>
<li>Types that keep and use system resources like file handles, sockets, pipes and so on. ClassLoader, FileInputStream, FileOutputStream, Socket and so on. To deserialize such a class the converter must be able to claim the appropriate resource from the system again. With the help of a custom converter this might be possible, but with the reflection converter the deserialized class might refer a system resource that is no longer valid or belongs to somebody else. Behavior is undefined then.</li>
<li>A very special case of such allocated system resources are those classes that keep handles to system memory directly, because they are partly implemented native. It is known to be true for the Linux version of Sun&#39;s JDK that the BufferedImage references some system specific types of the JDK that themselves have member fields with such memory handles. While it is possible at first sight to serialize and deserialize a BufferedImage, the reflection converter will also duplicate the memory handle. As a result the JVM might crash easily because of freeing unallocated memory or freeing the same memory twice. It might be possible to create a custom converter, but the data structure is really complex in this area and nobody has been investigating so far to such an extent. However, <strong>do not use the reflection converter for these types! You have been warned!</strong></li>
</ol>
<h2 id="how-do-i-specify-that-a-field-should-not-be-serialized-">How do I specify that a field should not be serialized?</h2>
<p>Make it</p>
<p>transient
, specify it with</p>
<p>XStream.omitField()
or annotate it with @XStreamOmitField</p>
<h2 id="how-do-i-initialize-a-transient-field-at-deserialization-">How do I initialize a transient field at deserialization?</h2>
<p>XStream uses the same mechanism as the JDK serialization. Example:
class ThreadAwareComponent { private transient ThreadLocal component; // ... private Object readResolve() { component = new ThreadLocal(); return this; } }</p>
<h2 id="xstream-is-not-calling-the-default-constructor-during-deserialization-">XStream is not calling the default constructor during deserialization.</h2>
<p>This is, in fact, the same case as above. XStream uses the same mechanism as the JDK serialization. When using the enhanced mode with the optimized reflection API, it does not invoke the default constructor. The solution is to implement the readResolve method as above:
class MyExecutor { private Object readResolve() { // do what you need to do here System.out.println(&quot;After instantiating MyExecutor&quot;); // at the end returns itself return this; } }</p>
<h2 id="what-do-serialized-collections-look-like-">What do serialized collections look like?</h2>
<p>See example for the <a href="http://xstream.codehaus.org/converters.html#java.util" target="_blank">CollectionConverter</a>.</p>
<p>Note, that it is possible to configure XStream to omit the container element toys using implicit collections.</p>
<h2 id="do-my-classes-have-to-implement-serializable-if-xstream-is-to-serialize-them-">Do my classes have to implement Serializable if XStream is to serialize them?</h2>
<p>No.</p>
<h2 id="can-dynamic-proxies-be-serialized-">Can dynamic proxies be serialized?</h2>
<p>Yes.</p>
<h2 id="can-cglib-proxies-be-serialized-">Can CGLIB proxies be serialized?</h2>
<p>Only limitedly. A proxy generated with the CGLIB Enhancer is supported, if the proxy uses either a factory or only one callback. Then it is possible to recreate the proxy instance at unmarshalling time. Starting with XStream 1.3.1 CGLIB support is no longer automatically installed because of possible classloader problems and side-effects, because of incompatible ASM versions. You can enable CGLIB support with:
XStream xstream = new XStream() { protected MapperWrapper wrapMapper(MapperWrapper next) { return new CGLIBMapper(next); } }; xstream.registerConverter(new CGLIBEnhancedConverter(xstream.getMapper(), xstream.getReflectionProvider()));</p>
<h2 id="cglibenhancedconverter-fails-at-initialization-with-exceptionininitializererror">CGLIBEnhancedConverter fails at initialization with ExceptionInInitializerError</h2>
<p>This is not a problem of XStream. You have incompatible ASM versions in your classpath. CGLIB 2.1.x and below is based on ASM 1.5.x which is incompatible to newer versions that are used by common packages like Hibernate, Groovy or Guice. Check your dependencies and ensure that you are using either using cglib-nodep-2.x.jar instead of cglib-2.x.jar or update to cglib-2.2.x that depends on ASM 3.1. However, the <em>nodep</em> version contains a copy of the ASM classes with private packages and will therefore not raise class incompatibilities at all.</p>
<h2 id="serialization-fails-with-nosuchmethoderror-net-sf-cglib-proxy-enhancer-isenhanced-ljava-lang-class-z">Serialization fails with NoSuchMethodError: net.sf.cglib.proxy.Enhancer.isEnhanced(Ljava/lang/Class;)Z</h2>
<p>XStream uses this method to detect a CGLIB-enhanced proxy. Unfortunately the method is not available in the cglib-2.0 version. Since this version is many years old and the method is available starting with cglib-2.0.1, please consider an upgrade of the dependency, it works usually smoothly.</p>
<h2 id="my-attributes-are-interpreted-by-xstream-itself-and-cause-unexpected-behavior">My attributes are interpreted by XStream itself and cause unexpected behavior</h2>
<p>XStream&#39;s generic converters and the marshalling strategies use a number of attributes on their own. Especially the attributes named <em>id</em>, <em>class</em> and <em>reference</em> are likely to cause such collisions. Main reason is XStream&#39;s history, because originally user defined attributes were not supported and all attribute were system generated. Starting with XStream 1.3.1 you can redefine those attributes to allow the names to be used for your own ones. The following snippet defines XStream to use different system attributes for <em>id</em> and <em>class</em> while the field <em>id</em> of YourClass is written into the attribute <em>class</em>:
XStream xstream = new XStream() { xstream.useAttributeFor(YourClass.class, &quot;id&quot;); xstream.aliasAttribute(&quot;class&quot;, &quot;id&quot;); xstream.aliasSystemAttribute(&quot;type&quot;, &quot;class&quot;); xstream.aliasSystemAttribute(&quot;refid&quot;, &quot;id&quot;);</p>
<h2 id="can-i-select-the-field-order-in-which-xstream-serializes-objects-">Can I select the field order in which XStream serializes objects?</h2>
<p>Yes. XStream&#39;s ReflectionConverter uses the defined field order by default. You can override it by using an specific FieldKeySorter:
SortableFieldKeySorter sorter = new SortableFieldKeySorter(); sorter.registerFieldOrder(MyType.class, new String[] { &quot;firstToSerialize&quot;, &quot;secondToSerialize&quot;, &quot;thirdToSerialize&quot; }); xstream = new XStream(new Sun14ReflectionProvider(new FieldDictionary(sorter)));</p>
<h2 id="how-does-xstream-deal-with-newer-versions-of-classes-">How does XStream deal with newer versions of classes?</h2>
<ul>
<li>If a new field is added to the class, deserializing an old version will leave the field uninitialized.</li>
<li>If a field is removed from the class, deserializing an old version that contains the field will cause an exception. Leaving the field in place but declaring it as transient will avoid the exception, but XStream will not try to deserialize it.</li>
<li>If a class is renamed, aliases can be used to create an abstraction between the name used in XML and the real class name.</li>
<li>If a field is renamed, this should be treated as adding a field and removing a field.</li>
</ul>
<p>For more advanced class migrations, you may</p>
<ul>
<li>have to do custom pre-processing of the XML before sending it to XStream (for example, with XSLT or DOM manipulations)</li>
<li>declare new fields as transient</li>
<li>implement your own converter, that can handle the situation</li>
<li>add a readResolve() method to your class, that initializes the object accordingly</li>
<li>implement a custom mapper to ignore unknown fields automatically (see acceptance test CustomMapperTest.testCanBeUsedToOmitUnexpectedElements())</li>
</ul>
<p>Future versions of XStream will include features to make these type of migrations easier.</p>
<h2 id="how-does-xstream-cope-with-isolated-class-loaders-">How does XStream cope with isolated class loaders?</h2>
<p>Serializing an object graph is never a problem, even if the classes of those objects have been loaded by a different class loader. The situation changes completely at deserialization time. In this case you must set the class loader to use with:
xstream.setClassLoader(yourClassLoader);</p>
<p>Although XStream caches a lot of type related information to gain speed, it keeps those information in tables with weak references that should be cleaned by the garbage collector when the class loader is freed.</p>
<p>Note, that this call should be made quite immediately after creating the XStream and before any other configuration is done. Otherwise configuration based on special types might refer classes loaded with the wrong classloader.</p>
<h1 id="xml-specifics">XML specifics</h1>
<h2 id="why-does-xstream-not-respect-the-encoding-in-the-xml-declaration-">Why does XStream not respect the encoding in the XML declaration?</h2>
<p>XStream architecture is based on IO Readers and Writers, while the XML declaration is the responsibility of XML parsers. XStream all <a href="http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/io/HierarchicalStreamDriver.html" target="_blank">HierarchicalStreamDriver</a> implementation respect the encoding since version 1.3, but only if you provide an <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/io/InputStream.html" target="_blank">InputStream</a>. If XStream consumes a <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/io/Reader.html" target="_blank">Reader</a> you have to initialize the reader with the appropriate encoding yourself, since it is now the reader&#39;s task to perform the encoding and no XML parser can change the encoding of a Reader and any encoding definition in the XML header will be ignored.</p>
<h2 id="why-does-xstream-not-write-an-xml-declaration-">Why does XStream not write an XML declaration?</h2>
<p>XStream is designed to write XML snippets, so you can embed its output into an existing stream or string. You can write the XML declaration yourself into the Writer before using it to call XStream.toXML(writer).</p>
<h2 id="why-does-xstream-not-write-xml-in-utf-8-">Why does XStream not write XML in UTF-8?</h2>
<p>XStream does no character encoding by itself, it relies on the configuration of the underlying XML writer. By default it uses its own PrettyPrintWriter which writes into the default encoding of the current locale. To write UTF-8 you have to provide a <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/io/Writer.html" target="_blank">Writer</a> with the appropriate encoding yourself.</p>
<h2 id="why-do-field-names-suddenly-have-double-underscores-in-the-generated-xml-">Why do field names suddenly have double underscores in the generated XML?</h2>
<p>XStream maps Java class names and field names to XML tags or attributes. Unfortunately this mapping cannot be 1:1, since some identifiers of Java contain a dollar sign which is invalid in XML names. Therefore XStream uses an <a href="http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/io/xml/XmlFriendlyReplacer.html" target="_blank">XmlFriendlyReplacer</a> to replace this character with a replacement. By default this replacement uses an underscore and therefore the replacer must escape the underscore itself also. You may provide a different configured instance of the XmlFriendlyReplacer or a complete own implementation, but you must ensure, that the resulting names are valid for XML.</p>
<h2 id="xstream-fails-to-unmarshal-my-given-xml-and-i-do-not-know-why-">XStream fails to unmarshal my given XML and I do not know why?</h2>
<p>By default XStream is written for persistence i.e. it will read the XML it can write. If you have to transform a given XML into an object graph, you should go the other way round. Use XStream to transfer your objects into XML. If the written XML matches your schema, XStream is also able to read it. This way is much easier, since you can spot the differences in the XML much more easy than to interpret the exceptions XStream will throw if it cannot match the XML into your objects.</p>
<h2 id="my-parser-claims-the-x0-character-to-be-invalid-but-it-was-written-with-xstream-">My parser claims the &amp;/#x0; character to be invalid, but it was written with XStream!</h2>
<p>Your parser is basically right! A character of value 0 is not valid as part of XML according the XML specification (see version <a href="http://www.w3.org/TR/2006/REC-xml-20060816/#charsets" target="_blank">1.0</a> or <a href="http://www.w3.org/TR/2006/REC-xml11-20060816/#charsets" target="_blank">1.1</a>), neither directly nor as character entity nor within CDATA. But not every parser respects this part of the specification (e.g. Xpp3 will ignore it and read character entities). If you expect such characters in your strings and you do not use the Xpp3 parser, you should consider to use a converter that writes the string as byte array in Base64 code. As alternative you may force the <a href="http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/io/xml/PrettyPrintWriter.html" target="_blank">PrettyPrintWriter</a> or derived writers to be XML 1.0 or 1.1. compliant, i.e. in this mode a StreamException is thrown.</p>
<h2 id="my-parser-claims-a-control-character-to-be-invalid-but-it-was-written-with-xstream-">My parser claims a control character to be invalid, but it was written with XStream!</h2>
<p>Your parser is probably right! Control characters are only valid as part of XML 1.1. You should add an XML header declaring this version or use a parser that does not care about this part of the specification (e.g. Xpp3 parser).</p>
<h2 id="why-is-my-element-not-written-as-xml-attribute-although-i-have-configured-it-">Why is my element not written as XML attribute although I have configured it?</h2>
<p>You can only write types as attributes that are represented as a single String value and are handled therefore by SingleValueConverter implementations. If your type is handled by a Converter implementation, the configuration of XStream to write an attribute (using XStream.useAttributeFor() or @XStreamAsAttribute) is simply ignored.</p>
<h2 id="why-are-whitespace-characters-missing-in-my-attribute-values-after-deserialization-">Why are whitespace characters missing in my attribute values after deserialization?</h2>
<p>This is part of the XML specification and a required functionality for any XML parser called <a href="http://www.w3.org/TR/2006/REC-xml-20060816/#AVNormalize" target="_blank">attribute value normalization</a>. It cannot be influenced by XStream. Do not use attributes if your values contain leading or trailing whitespaces, other whitespaces than blanks, or sequences of whitespaces.</p>
<h2 id="why-does-xstream-not-have-any-namespace-support-">Why does XStream not have any namespace support?</h2>
<p>Not every XML parser supports namespaces and not every XML parser that supports namespaces can be configured within XStream to use those. Basically namespaces must be supported individually for the different XML parsers and the only support for namespaces that has currently been implemented in XStream is for the StAX paser. Therefore use and configure the StaxDriver of XStream to use namespaces.</p>
<h1 id="json-specifics">JSON specifics</h1>
<h2 id="why-are-there-two-json-driver-implementations-">Why are there two JSON driver implementations?</h2>
<p>As always, first for historical reasons! Main difference is that the <a href="http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/io/json/JettisonMappedXmlDriver.html" target="_blank">JettisonMappedXmlDriver</a> is a thin wrapper around <a href="http://jettison.codehaus.org/" target="_blank">Jettison</a> in combination with the <a href="http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/io/xml/StaxDriver.html" target="_blank">StaxDriver</a>, while the <a href="http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/io/json/JsonHierarchicalStreamDriver.html" target="_blank">JsonHierarchicalStreamDriver</a> uses an own more flexible implementation, but can only be used to generate JSON, deserialization is not implemented.</p>
<h2 id="why-is-it-not-possible-to-deserialize-a-json-string-starting-with-an-array-">Why is it not possible to deserialize a JSON string starting with an array?</h2>
<p>XStream&#39;s implementation to deserialize JSON is based on Jettison and StAX. Jettison implements a XMLStreamReader of StaX and transforms the processed JSON virtually into XML first. However, if the JSON string starts with an array it is not possible for Jettison to create a valid root element, since it has no name.</p>
<h2 id="xstream-fails-to-unmarshal-my-json-string-and-i-do-not-know-why-">XStream fails to unmarshal my JSON string and I do not know why?</h2>
<p>Deserialization of JSON is currently done by Jettison, that transforms the JSON string into a StAX stream. XStream itself does nothing know about the JSON format here. If your JSON string reaches some kind of complexity and you do not know how to design your Java objects and configure XStream to match those, you should have a look at the intermediate XML that is processed by XStream in the end. This might help to identify the problematic spots. Also consider then <a href="http://xstream.codehaus.org/faq.html#XML_unmarshalling_fails" target="_blank">marshalling your Java objects into XML first</a>. You can use following code to generate the XML:
String json = &quot;{\&quot;string\&quot;: \&quot;foo\&quot;}&quot;; HierarchicalStreamDriver driver = new JettisonMappedXmlDriver(); StringReader reader = new StringReader(json); HierarchicalStreamReader hsr = driver.createReader(reader); StringWriter writer = new StringWriter(); new HierarchicalStreamCopier().copy(hsr, new PrettyPrintWriter(writer)); writer.close(); System.out.println(writer.toString());</p>
<h2 id="what-limitations-has-xstream-s-json-support-">What limitations has XStream&#39;s JSON support?</h2>
<p>JSON represents a very simple data model for easy data transfer. Especially it has no equivalent for XML attributes. Those are written with a leading &quot;@&quot; character, but this is not always possible without violating the syntax (e.g. for array types). Those may silently dropped (and makes it therefore difficult to implement deserialization). References are another issue in the serialized object graph, since JSON has no possibility to express such a construct. You should therefore always set the NO_REFERENCES mode of XStream.</p>
<h2 id="why-are-there-invalid-characters-in-my-json-representation-">Why are there invalid characters in my JSON representation?</h2>
<p>The JSON spec requires any JSON string to be in UTF-8 encoding. However, XStream ensures this only if you provide an InputStream or an OutputStream. If you provide a Reader or Writer you have to ensure this requirement on your own.</p>
<h2 id="the-generated-json-is-invalid-it-contains-a-dash-in-the-label-">The generated JSON is invalid, it contains a dash in the label!</h2>
<p>Well, no, the JSON is valid! Please check yourself with the <a href="http://www.jslint.com/" target="_blank">JSON syntax checker</a>. However, some JavaScript libraries silently assume that the JSON labels are valid JavaScript identifiers, because JavaScript supports a convenient way to address an element, <strong>if</strong> the label is a valid JavaScript identifier:
var json = {&quot;label&quot;: &quot;foo&quot;, &quot;label-with-dash&quot;: &quot;bar&quot;}; var fooVar = json.label; // works for labels that are JavaScript identifiers var barVar = json[&quot;label-with-dash&quot;]; // using an array index works always</p>
<p>As alternative you may wrap the JsonWriter and replace any dash with an underscore:</p>
<p>HierarchicalStreamDriver driver = new JsonHierarchicalStreamDriver() { public HierarchicalStreamWriter createWriter(Writer out) { return new WriterWrapper(super.createWriter(out)) { public void startNode(String name) { startNode(name, null); } public void startNode(String name, Class clazz) { wrapped.startNode(name.replace(&#39;-&#39;, &#39;_&#39;), clazz); } } } }; XStream xstream = new XStream(driver);</p>
<h1 id="comparison-to-other-products">Comparison to other products</h1>
<h2 id="how-does-xstream-compare-to-java-beans-xmlencoder-">How does XStream compare to java.beans.XMLEncoder?</h2>
<p>XStream is designed for serializing objects using internal fields, whereas <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/beans/XMLEncoder.html" target="_blank">XMLEncoder</a> is designed for serializing JavaBeans using public API methods (typically in the form of</p>
<p>getXXX()
,</p>
<p>setXXX()
,</p>
<p>addXXX()
and</p>
<p>removeXXX()
methods.</p>
<h2 id="how-does-xstream-compare-to-jaxb-java-api-for-xml-binding-">How does XStream compare to JAXB (Java API for XML Binding)?</h2>
<p>JAXB is a Java binding tool. It generates Java code from a schema and you are able to transform from those classes into XML matching the processed schema and back. Note, that you cannot use your own objects, you have to use what is generated.</p>
<h1 id="scalability">Scalability</h1>
<h2 id="is-xstream-thread-safe-">Is XStream thread safe?</h2>
<p>Yes. Once the XStream instance has been created and configured, it may be shared across multiple threads allowing objects to be serialized/deserialized concurrently (unless you enable the auto.detection and processing of annotations). Actually the creation and initialization of XStream is quite expensive, therefore it is recommended to keep the XStream instance itself.</p>
<h2 id="how-much-memory-does-xstream-consume-">How much memory does XStream consume?</h2>
<p>This cannot be answered in general, but following topics have impact on the memory:</p>
<ol>
<li>XML parser technology in use: You should use a streaming parser like Xpp3 or StAX. DOM-based parsers process the complete XML and create their document model in memory before the first converter of XStream is called.</li>
<li>Your object model: Is it necessary to keep the complete object graph in memory at once. As alternative you might use <a href="http://xstream.codehaus.org/objectstream.html" target="_blank">object streams</a> or write custom converters that can load and save objects of your object model on the fly without adding them to the object graph physically. As example see the implementation of the <a href="http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/persistence/XmlArrayList.html" target="_blank">XmlArrayList</a> in combination with the <a href="http://xstream.codehaus.org/javadoc/com/thoughtworks/xstream/persistence/FileStreamStrategy.html" target="_blank">FileStreamStrategy</a> to keep parts of the object graph separate.</li>
<li>References: By default XStream supports references to the same object in an object graph. This implies that XStream keeps track of all serialized and deserialized objects internally. These references are kept with WeakReferences, so that the memory can be freed as soon as nobody references these objects anymore.</li>
<li>XML values: Any tag and attribute value that is converted into a Java String in the object graph will use the same String instance.</li>
<li>XStream caches: To increase performance XStream caches quite a lot like classes, converters to use, aliasing, tag names. All those caches make usage of WeakReferences or will exist only while marshalling one object graph resp. unmarshalling one input stream.</li>
</ol>
<h2 id="can-the-performance-of-xstream-be-increased-">Can the performance of XStream be increased?</h2>
<p>XStream is a generalizing library, it inspects and handles your types on the fly. Therefore it will normally be slower than a piece of optimized Java code generated out of a schema. However, it is possible to increase the performance anyway:</p>
<ul>
<li>Write custom converters for those of your types that occur very often in your XML.</li>
<li>Keep a configured XStream instance for multiple usage. Creation and initialization is quite expensive compared to the overhead of XStream when calling marshall or unmarshal.</li>
<li>Use Xpp3 or StAX parsers.</li>
</ul>
<p>Note, you should never try to optimize code for performance simply because you <strong>believe</strong> that you have detected a bottle neck. Always use proper tools like a profiler to verify where your hotspots are and whether your optimization was really successful or not.</p>
<h1 id="uses-of-xstream">Uses of XStream</h1>
<h2 id="is-xstream-a-data-binding-tool-">Is XStream a data binding tool?</h2>
<p>No. It is a serialization tool.</p>
<h2 id="can-xstream-generate-classes-from-xsd-">Can XStream generate classes from XSD?</h2>
<p>No. For this kind of work a data binding tool such as <a href="http://xmlbeans.apache.org/" target="_blank">XMLBeans</a> is appropriate.</p>
<h2 id="why-is-there-no-saxreader-">Why is there no SaxReader?</h2>
<p>XStream works on a stream-based parser model, while SAX is event-based. The stream based model implies, that the caller consumes the individual tokens from the XML parser on demand, while in an event-based model the parser controls the application flow on its own and will use callbacks to support client processing. The different architecture makes it therefore impossible for XStream to use an event-driven XML parser.</p>
<h1 id="software">Software</h1>
<ul>
<li><a href="http://xstream.codehaus.org/index.html" target="_blank">About XStream</a></li>
<li><a href="http://xstream.codehaus.org/news.html" target="_blank">News</a></li>
<li><a href="http://xstream.codehaus.org/changes.html" target="_blank">Change History</a></li>
<li><a href="http://xstream.codehaus.org/versioning.html" target="_blank">About Versioning</a></li>
</ul>
<h1 id="evaluating-xstream">Evaluating XStream</h1>
<ul>
<li><a href="http://xstream.codehaus.org/tutorial.html" target="_blank">Two Minute Tutorial</a></li>
<li><a href="http://xstream.codehaus.org/graphs.html" target="_blank">Object references</a></li>
<li><a href="http://xstream.codehaus.org/manual-tweaking-output.html" target="_blank">Tweaking the Output</a></li>
<li><a href="http://xstream.codehaus.org/license.html" target="_blank">License</a></li>
<li><a href="http://xstream.codehaus.org/download.html" target="_blank">Download</a></li>
<li><a href="http://xstream.codehaus.org/references.html" target="_blank">References</a></li>
<li><p><a href="http://www.ohloh.net/projects/3459" target="_blank">Statistics</a></p>
<h1 id="using-xstream">Using XStream</h1>
</li>
<li><p><a href="http://xstream.codehaus.org/architecture.html" target="_blank">Architecture Overview</a></p>
</li>
<li><a href="http://xstream.codehaus.org/converters.html" target="_blank">Converters</a></li>
<li>Frequently Asked Questions</li>
<li><a href="http://xstream.codehaus.org/list-user.html" target="_blank">Users&#39; Mailing List</a></li>
<li><a href="http://xstream.codehaus.org/javadoc/index.html" target="_blank">JavaDoc Core</a></li>
<li><a href="http://xstream.codehaus.org/benchmark-javadoc/index.html" target="_blank">JavaDoc Benchmark</a></li>
<li><a href="http://xstream.codehaus.org/issues.html" target="_blank">Reporting Issues</a></li>
</ul>
<h1 id="tutorials">Tutorials</h1>
<ul>
<li><a href="http://xstream.codehaus.org/tutorial.html" target="_blank">Two Minute Tutorial</a></li>
<li><a href="http://xstream.codehaus.org/alias-tutorial.html" target="_blank">Alias Tutorial</a></li>
<li><a href="http://xstream.codehaus.org/annotations-tutorial.html" target="_blank">Annotations Tutorial</a></li>
<li><a href="http://xstream.codehaus.org/converter-tutorial.html" target="_blank">Converter Tutorial</a></li>
<li><a href="http://xstream.codehaus.org/objectstream.html" target="_blank">Object Streams Tutorial</a></li>
<li><a href="http://xstream.codehaus.org/persistence-tutorial.html" target="_blank">Persistence API Tutorial</a></li>
<li><p><a href="http://xstream.codehaus.org/json-tutorial.html" target="_blank">JSON Tutorial</a></p>
<h1 id="developing-xstream">Developing XStream</h1>
</li>
<li><p><a href="http://xstream.codehaus.org/how-to-contribute.html" target="_blank">How to Contribute</a></p>
</li>
<li><a href="http://xstream.codehaus.org/list-dev.html" target="_blank">Developers&#39; Mailing List</a></li>
<li><a href="http://xstream.codehaus.org/team.html" target="_blank">Development Team</a></li>
<li><a href="http://xstream.codehaus.org/repository.html" target="_blank">Source Repository</a></li>
<li><a href="http://bamboo.ci.codehaus.org/browse/XSTREAM" target="_blank">Continuous Integration</a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/xml/">xml</a></li></span><span class="breadcrumb"><li><a href="/categories/xml/">xml</a></li><li><a href="/categories/xml/xstream/">xstream</a></li></span></span> | <span class="tags">Tagged <a href="/tags/xml/" class="label label-primary">xml</a><a href="/tags/xstream/" class="label label-success">xstream</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-xml-xstream--XStream-FrequentlyAskedQuestions/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-xml-xstream--XStream-FrequentlyAskedQuestions" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-xml-xstream--XStream-AnnotationsTutorial/">XStream </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-xml-xstream--XStream-AnnotationsTutorial/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="xstream-annotations-tutorial">XStream - Annotations Tutorial</h1>
<p><a href="http://xstream.codehaus.org/index.html" target="_blank"><img src="" alt="XStream"></a></p>
<h1 id="annotations-tutorial">Annotations Tutorial</h1>
<h2 id="motivation">Motivation</h2>
<p>Sometimes it can get tedious to call all those XStream aliases/register converter methods or you might simply like the new trend on configuring POJOs: Java annotations.</p>
<p>This tutorial will show you how to use some of the annotations provided by XStream in order to make configuration easier. Let&#39;s start with a custom Message class:
package com.thoughtworks.xstream; package com.thoughtworks.xstream; public class RendezvousMessage { private int messageType; public RendezvousMessage(int messageType) { this.messageType = messageType; } }</p>
<p>Let&#39;s code the XStream calls which generate the XML file:</p>
<p>package com.thoughtworks.xstream; public class Tutorial { public static void main(String[] args) { XStream stream = new XStream(); RendezvousMessage msg = new RendezvousMessage(15); System.out.println(stream.toXML(msg)); } }</p>
<p>Results in the following XML:</p>
<p><com.thoughtworks.xstream.RendezvousMessage> <messageType>15</messageType> </com.thoughtworks.xstream.RendezvousMessage></p>
<h2 id="aliasing-annotation">Aliasing Annotation</h2>
<p>The most basic annotation is the one responsible for type and field aliasing: @XStreamAlias. Let&#39;s annotate both our type and field and run the tutorial method again:
@XStreamAlias(&quot;message&quot;) class RendezvousMessage { @XStreamAlias(&quot;type&quot;) private int messageType; public RendezvousMessage(int messageType) { this.messageType = messageType; } }</p>
<p>In some strange way, the result is the same. What happened here? XStream does not read this annotation by default as it would be impossible to deserialize the XML code. Therefore we need to tell XStream to read the annotations from this type:</p>
<p>public static void main(String[] args) { XStream stream = new XStream(); xstream.processAnnotations(RendezvousMessage.class); RendezvousMessage msg = new RendezvousMessage(15); System.out.println(stream.toXML(msg)); }</p>
<p>Note that we have called the processAnnotations method of XStream. This method registers all aliases annotations in the XStream instance passed as first argument. You may also use the overloaded version of this method taking an array of types. The resulting XML is now what we have expected:</p>
<message> <type>15</type> </message>

<p>If you let XStream process the annotations of a type, it will also process all annotations of the related types i.e. all super types, implemented interfaces, the class types of the members and all their generic types.</p>
<h2 id="implicit-collections">Implicit Collections</h2>
<p>Let&#39;s add a List of content to our RendezvousMessage. We desire the same functionality obtained with implicit collections:
@XStreamAlias(&quot;message&quot;) class RendezvousMessage { @XStreamAlias(&quot;type&quot;) private int messageType; private List<String> content; public RendezvousMessage(int messageType, String ... content) { this.messageType = messageType; this.content = Arrays.asList(content); } }</p>
<p>public static void main(String[] args) { XStream stream = new XStream(); xstream.processAnnotations(RendezvousMessage.class); RendezvousMessage msg = new RendezvousMessage(15, &quot;firstPart&quot;,&quot;secondPart&quot;); System.out.println(stream.toXML(msg)); }</p>
<p>The resulting XML shows the collection name before its elements:</p>
<message> <type>15</type> <content class="java.util.Arrays$ArrayList"> <a class="string-array"> <string>firstPart</string> <string>secondPart</string> </a> </content> </message>

<p>This is not what we desire therefore we will annotate the content list to be recognized as an implicit collection:</p>
<p>@XStreamAlias(&quot;message&quot;) class RendezvousMessage { @XStreamAlias(&quot;type&quot;) private int messageType; @XStreamImplicit private List<String> content; public RendezvousMessage(int messageType, String... content) { this.messageType = messageType; this.content = Arrays.asList(content); } }</p>
<p>Resulting in an XML which ignores the field name (content) of the list:</p>
<message> <type>15</type> <a class="string-array"> <string>firstPart</string> <string>secondPart</string> </a> </message>

<p>We are almost there... we still want to remove the &#39;a&#39; tag, and define each content part with the tag &#39;part&#39;. In order to do so, let&#39;s add another attribute to our implicit collection annotation. The attribute field defines the name of the tag used for data contained inside this collection:</p>
<p>@XStreamAlias(&quot;message&quot;) class RendezvousMessage { @XStreamAlias(&quot;type&quot;) private int messageType; @XStreamImplicit(itemFieldName=&quot;part&quot;) private List<String> content; public RendezvousMessage(int messageType, String... content) { this.messageType = messageType; this.content = Arrays.asList(content); } }</p>
<p>Resulting in a cleaner XML:</p>
<message> <type>15</type> <part>firstPart</part> <part>secondPart</part> </message>

<h2 id="local-converters">Local Converters</h2>
<p>Let&#39;s create another attribute which defines the timestamp when the message was created:
@XStreamAlias(&quot;message&quot;) class RendezvousMessage { @XStreamAlias(&quot;type&quot;) private int messageType; @XStreamImplicit(itemFieldName=&quot;part&quot;) private List<String> content; private Calendar created = new GregorianCalendar(); public RendezvousMessage(int messageType, String... content) { this.messageType = messageType; this.content = Arrays.asList(content); } }</p>
<p>Resulting in the following xml:</p>
<message> <type>15</type> <part>firstPart</part> <part>secondPart</part> <created> <time>1154097812245</time> <timezone>America/Sao_Paulo</timezone> </created> </message>

<p>Now we face the following problem: We want to use a custom converter locally for this Calendar, but only for this Calendar, this exact field in this exact type. Easy... let&#39;s annotate it with the custom converter annotation:</p>
<p>@XStreamAlias(&quot;message&quot;) class RendezvousMessage { @XStreamAlias(&quot;type&quot;) private int messageType; @XStreamImplicit(itemFieldName=&quot;part&quot;) private List<String> content; @XStreamConverter(SingleValueCalendarConverter.class) private Calendar created = new GregorianCalendar(); public RendezvousMessage(int messageType, String... content) { this.messageType = messageType; this.content = Arrays.asList(content); } }</p>
<p>Let&#39;s create the custom converter:</p>
<p>public class SingleValueCalendarConverter implements Converter { public void marshal(Object source, HierarchicalStreamWriter writer, MarshallingContext context) { Calendar calendar = (Calendar) source; writer.setValue(String.valueOf(calendar.getTime().getTime())); } public Object unmarshal(HierarchicalStreamReader reader, UnmarshallingContext context) { GregorianCalendar calendar = new GregorianCalendar(); calendar.setTime(new Date(Long.parseLong(reader.getValue()))); return calendar; } public boolean canConvert(Class type) { return type.equals(GregorianCalendar.class); } }</p>
<p>And we end up with the converter being used and generating the following XML:</p>
<message> <type>15</type> <part>firstPart</part> <part>secondPart</part> <created>1154097812245</created> </message>

<h2 id="attributes">Attributes</h2>
<p>The client may asks for the type tag to be an attribute inside the message tag, as follows:</p>
<message type="15"> <part>firstPart</part> <part>secondPart</part> <created>1154097812245</created> </message>

<p>All you need to do is add the @XStreamAsAttribute annotation:</p>
<p>@XStreamAlias(&quot;message&quot;) class RendezvousMessage { @XStreamAlias(&quot;type&quot;) @XStreamAsAttribute private int messageType; @XStreamImplicit(itemFieldName=&quot;part&quot;) private List<String> content; @XStreamConverter(SingleValueCalendarConverter.class) private Calendar created = new GregorianCalendar(); public RendezvousMessage(int messageType, String... content) { this.messageType = messageType; this.content = Arrays.asList(content); } }</p>
<h2 id="omitting-fields">Omitting Fields</h2>
<p>Sometimes a class may contain elements that should not be part of the resulting XML. In our case we may now drop the &#39;messageType&#39;, since we are only interested at the content. This is easy using the @XStreamOmitField annotation:
@XStreamAlias(&quot;message&quot;) class RendezvousMessage { @XStreamOmitField private int messageType; @XStreamImplicit(itemFieldName=&quot;part&quot;) private List<String> content; @XStreamConverter(SingleValueCalendarConverter.class) private Calendar created = new GregorianCalendar(); public RendezvousMessage(int messageType, String... content) { this.messageType = messageType; this.content = Arrays.asList(content); } }</p>
<p>The resulting XML does not contain the type of the message anymore:</p>
<message> <part>firstPart</part> <part>secondPart</part> <created>1154097812245</created> </message>

<h2 id="auto-detect-annotations">Auto-detect Annotations</h2>
<p>Until now we have always told you, that you have to call processAnnotation to configure the XStream instance with the present annotations in the different classes. However, this is only half the truth. You can run XStream also in a lazy mode, where it auto-detects the annotations while processing the object graph and configure the XStream instance on-the-fly:
package com.thoughtworks.xstream; public class Tutorial { public static void main(String[] args) { XStream stream = new XStream(); xstream.autodetectAnnotations(true); RendezvousMessage msg = new RendezvousMessage(15); System.out.println(stream.toXML(msg)); } }</p>
<p>The resulting XML will look as expected! Nevertheless you have to understand the implications, therefore some words of warning:</p>
<ol>
<li><strong>Chicken-and-egg problem</strong></li>
</ol>
<p>An XStream instance caches all class types processed for annotations. Every time XStream converts an object it will in auto-detection mode first process the object&#39;s type and all the types related (as explained <a href="http://xstream.codehaus.org/annotations-tutorial.html#Aliasing" target="_blank">above</a>). Therefore it is no problem to serialize an object graph into XML, since XStream will know of all types in advance. This is no longer true at deserialization time. XStream has to know the alias to turn it into the proper type, but it can find the annotation for the alias only if it has processed the type in advance. Therefore deserialization will fail if the type has not already been processed either by having called XStream&#39;s processAnnotations method or by already having serialized this type. However, @XStreamAlias is the only annotation that may fail in this case.</p>
<ol>
<li><strong>Concurrency</strong></li>
</ol>
<p>XStream is not thread-safe while it is configured, thread-safety is only guaranteed during marshalling and unmarshalling. However an annotation is defining a change in configuration that is now applied while object marshalling is processed. Therefore will the auto-detection mode turn XStream&#39;s marshalling process in a thread-unsafe operation any you may run under certain circumstances into concurrency problems.</p>
<ol>
<li><strong>Exceptions</strong></li>
</ol>
<p>XStream uses a well-defined exception hierarchy. Normally an InitializationException is only thrown while XStream is configured. If annotations are processed on the fly they can be thrown obviously also in a marshalling process.</p>
<ol>
<li><strong>Performance</strong></li>
</ol>
<p>In auto-detection mode XStream will have to examine any unknown class type for annotations. This will slow down the marshalling process until all processed types have been examined once.</p>
<p>Please note, that any call to XStream.processAnnotations will turn off the auto-detection mode.</p>
<h2 id="summing-up">Summing up</h2>
<p>The XStream annotations support might help you configuring your class mappings in some ways, as the custom configuration will appear in your types, but might not be the solution for other problems, i.e. when you need to map the same type to two different XML &#39;standards&#39;. Others might claim that the configuration should be clearly stated in a Java class and not mixed with your model, its up to you to pick the best approach in your case: Annotations or direct method calls to the XStream instance. Annotations do not provide more functionality, but may improve convenience.</p>
<h1 id="software">Software</h1>
<ul>
<li><a href="http://xstream.codehaus.org/index.html" target="_blank">About XStream</a></li>
<li><a href="http://xstream.codehaus.org/news.html" target="_blank">News</a></li>
<li><a href="http://xstream.codehaus.org/changes.html" target="_blank">Change History</a></li>
<li><a href="http://xstream.codehaus.org/versioning.html" target="_blank">About Versioning</a></li>
</ul>
<h1 id="evaluating-xstream">Evaluating XStream</h1>
<ul>
<li><a href="http://xstream.codehaus.org/tutorial.html" target="_blank">Two Minute Tutorial</a></li>
<li><a href="http://xstream.codehaus.org/graphs.html" target="_blank">Object references</a></li>
<li><a href="http://xstream.codehaus.org/manual-tweaking-output.html" target="_blank">Tweaking the Output</a></li>
<li><a href="http://xstream.codehaus.org/license.html" target="_blank">License</a></li>
<li><a href="http://xstream.codehaus.org/download.html" target="_blank">Download</a></li>
<li><a href="http://xstream.codehaus.org/references.html" target="_blank">References</a></li>
<li><p><a href="http://www.ohloh.net/projects/3459" target="_blank">Statistics</a></p>
<h1 id="using-xstream">Using XStream</h1>
</li>
<li><p><a href="http://xstream.codehaus.org/architecture.html" target="_blank">Architecture Overview</a></p>
</li>
<li><a href="http://xstream.codehaus.org/converters.html" target="_blank">Converters</a></li>
<li><a href="http://xstream.codehaus.org/faq.html" target="_blank">Frequently Asked Questions</a></li>
<li><a href="http://xstream.codehaus.org/list-user.html" target="_blank">Users&#39; Mailing List</a></li>
<li><a href="http://xstream.codehaus.org/javadoc/index.html" target="_blank">JavaDoc Core</a></li>
<li><a href="http://xstream.codehaus.org/benchmark-javadoc/index.html" target="_blank">JavaDoc Benchmark</a></li>
<li><a href="http://xstream.codehaus.org/issues.html" target="_blank">Reporting Issues</a></li>
</ul>
<h1 id="tutorials">Tutorials</h1>
<ul>
<li><a href="http://xstream.codehaus.org/tutorial.html" target="_blank">Two Minute Tutorial</a></li>
<li><a href="http://xstream.codehaus.org/alias-tutorial.html" target="_blank">Alias Tutorial</a></li>
<li>Annotations Tutorial</li>
<li><a href="http://xstream.codehaus.org/converter-tutorial.html" target="_blank">Converter Tutorial</a></li>
<li><a href="http://xstream.codehaus.org/objectstream.html" target="_blank">Object Streams Tutorial</a></li>
<li><a href="http://xstream.codehaus.org/persistence-tutorial.html" target="_blank">Persistence API Tutorial</a></li>
<li><p><a href="http://xstream.codehaus.org/json-tutorial.html" target="_blank">JSON Tutorial</a></p>
<h1 id="developing-xstream">Developing XStream</h1>
</li>
<li><p><a href="http://xstream.codehaus.org/how-to-contribute.html" target="_blank">How to Contribute</a></p>
</li>
<li><a href="http://xstream.codehaus.org/list-dev.html" target="_blank">Developers&#39; Mailing List</a></li>
<li><a href="http://xstream.codehaus.org/team.html" target="_blank">Development Team</a></li>
<li><a href="http://xstream.codehaus.org/repository.html" target="_blank">Source Repository</a></li>
<li><a href="http://bamboo.ci.codehaus.org/browse/XSTREAM" target="_blank">Continuous Integration</a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/xml/">xml</a></li></span><span class="breadcrumb"><li><a href="/categories/xml/">xml</a></li><li><a href="/categories/xml/xstream/">xstream</a></li></span></span> | <span class="tags">Tagged <a href="/tags/xml/" class="label label-primary">xml</a><a href="/tags/xstream/" class="label label-success">xstream</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-xml-xstream--XStream-AnnotationsTutorial/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-xml-xstream--XStream-AnnotationsTutorial" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--GrayCode/">GrayCode</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--GrayCode/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="graycode">GrayCode</h1>
<h1 id="-algorithm-gossip-gray-code-"><a href="">Algorithm Gossip: 格雷码（Gray Code）</a></h1>
<h2 id="-">说明</h2>
<p>Gray Code是一个数列集合，每个数使用二进位来表示，假设使用n位元来表示每个数好了，任两个数之间只有一个位元值不同，例如以下为3位元的Gray Code：
000 001 011 010 110 111 101 100
由定义可以知道，Gray Code的顺序并不是唯一的，例如将上面的数列反过来写，也是一组Gray Code：
100 101 111 110 010 011 001 000
Gray Code是由贝尔实验室的Frank Gray在1940年代提出的，用来在使用PCM（Pusle Code Modulation）方法传送讯号时避免出错，并于1953年三月十七日取得美国专利。</p>
<h2 id="-">解法</h2>
<p>由于Gray Code相邻两数之间只改变一个位元，所以可观 察Gray Code从1变0或从0变1时的位置，假设有4位元的Gray Code如下：
0000 0001 0011 0010 0110 0111 0101 0100
1100 1101 1111 1110 1010 1011 1001 1000
观察奇数项的变化时，我们发现无论它是第几个Gray Code，永远只改变最右边的位元，如果是1就改为0，如果是0就改为1。
观察偶数项的变化时，我们发现所改变的位元，是由右边算来第一个1的左边位元。
以上两个变化规则是固定的，无论位元数为何；所以只要判断位元的位置是奇数还是偶数，就可以决定要改变哪一个位元的值，为了程式撰写方便，将阵列索引 0当作最右边的值，而在列印结果时，是由索引数字大的开始反向列印。
将2位元的Gray Code当作平面座标来看，可以构成一个四边形，您可以发现从任一顶点出发，绕四边形周长绕一圈，所经过的顶点座标就是一组Gray Code，所以您可以得到四组Gray Code。
同样的将3位元的Gray Code当作平面座标来看的话，可以构成一个正立方体，如果您可以从任一顶点出发，将所有的边长走过，并不重复经过顶点的话，所经过的顶点座标顺序之组合也就是一组Gray Code。</p>
<h2 id="-">实作</h2>
<ul>
<li><p>C
/#include <stdio.h>
/#include <stdlib.h>
/#define MAXBIT 20
/#define TRUE 1
/#define CHANGE_BIT(x) x = ((x) == &#39;0&#39; ? &#39;1&#39; : &#39;0&#39;)
/#define NEXT(x) x = (1 - (x))
int main(void) {
char digit[MAXBIT];
int i, bits, odd;
printf(&quot;输入位元数：&quot;);
scanf(&quot;%d&quot;, &amp;bits);
for(i = 0; i &lt; bits; i++) {
digit[i] = &#39;0&#39;;
printf(&quot;0&quot;);
}
printf(&quot;\n&quot;);
odd = TRUE;
while(1) {
if(odd)
CHANGE_BIT(digit[0]);
else {
// 计算第一个1的位置
for(i = 0; i &lt; bits &amp;&amp; digit[i] == &#39;0&#39;; i++) ;
if(i == bits - 1) // 最后一个Gray Code
break;
CHANGE_BIT(digit[i+1]);
}
for(i = bits - 1; i &gt;= 0; i--)
printf(&quot;%c&quot;, digit[i]);
printf(&quot;\n&quot;);
NEXT(odd);
}
return 0;
}</p>
</li>
<li><p>Java
public class GrayCode {
private char[] digit;
private boolean first;
private boolean odd;
private int count;
public GrayCode(int length) {
digit = new char[length];
for(int i = 0; i &lt; length; i++) {
digit[i] = &#39;0&#39;;
}
first = true;
odd = true;
}
public boolean hasNext() {
// 计算第一个1的位置
for(count = 0;
(count &lt; digit.length) &amp;&amp; (digit[count] == &#39;0&#39;);
count++) ;
return count != digit.length - 1;
}
public char[] next() {
if(first) {
first = false;
return digit;
}
if(odd)
chargeBit(digit, 0);
else {
// 最后一个Gray Code 吗
if(hasNext())
chargeBit(digit, count+1);
}
odd = ((odd == true) ? false : true);
return digit;
}
private void chargeBit(char[] digit, int i) {
digit[i] = ((digit[i] == &#39;0&#39;) ? &#39;1&#39; : &#39;0&#39;);
}
public static void main(String[] args) {
GrayCode code = new GrayCode(4);
while(code.hasNext()) {
char[] digit = code.next();
for(int i = digit.length - 1; i &gt;= 0; i--)
System.out.print(digit[i]);
System.out.println();
}
}
}</p>
</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/AlgorithmGossip/">AlgorithmGossip</a></li></span></span> | <span class="tags">Tagged <a href="/tags/AlgorithmGossip/" class="label label-primary">AlgorithmGossip</a></span> | <span class="time">recent updated:<time title="2014-03-07 10:37:44"datetime="2014-03-07 10:37:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--GrayCode/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-AlgorithmGossip-AlgorithmGossip--GrayCode" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-TCPIP--浅析——SCTP协议/">浅析——SCTP协议</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-TCPIP--浅析——SCTP协议/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-sctp-">浅析——SCTP协议</h1>
<h2 id="-sctp-http-www-cnblogs-com-qlee-archive-2011-07-13-2105717-html-"><a href="http://www.cnblogs.com/qlee/archive/2011/07/13/2105717.html" target="_blank">浅析——SCTP协议</a></h2>
<p>Posted on 2011-07-13 21:26 <a href="http://www.cnblogs.com/qlee/" target="_blank">李大嘴</a> 阅读(2621) 评论(0) <a href="http://www.cnblogs.com/qlee/admin/EditPosts.aspx?postid=2105717" target="_blank">编辑</a> <a href="">收藏</a></p>
<p>SCTP处于SCTP用户应用层与IP网络层之间，它运用“关联”（association）这个术语定义交换信息的两个对等SCTP用户间的协议状态 。SCTP也是面向连接的，但在概念上，SCTP“关联”比TCP连接更为广泛：TCP的连接只有一个源地址和一个目的地址，SCTP提供一种方式使得每 个SCTP端点能为另一个对等端点提供一组传输地址，即传输地址= 一组IP地址+端口号。
在继承TCP特点的基础上，SCTP提供了一些额外的功能：</p>
<ol>
<li>在多个“流”（stream）中实现用户数据的有序发送
“流” 在TCP中指一系列的字节，而在SCTP中是指发送到上层协议的一定系列的用户消息，这些消息的顺序与流内其他消息相关。SCTP用户在建立关联时，可以 规定关联支持的流的数目。这个数目是与源端商定的，用户消息与流数目关联。在链路中，SCTP为每个送到对等端的消息分配一个流序号。在接收端，SCTP 确保在给定流中消息按顺序发送。同时，当一个流正在等待下一个非顺序的用户消息时，其他流的发送会继续。</li>
<li>根据已发现的路径MTU（最大传输单元）大小进行用户数据分片
为了确保发送到下层的SCTP数据包与路径MTU一致，SCTP对用户消息分片。在接收端，分片被重组后传给上层SCTP用户。</li>
<li>选择性确认（SACK）和拥塞控制
选择性确认用于数据包丢失发现，TCP中确认序号返回的是发送方已成功收到数据字节序号（不包含确认序号所指的字节），而SCTP反馈给发送端的是丢失的并且要求重传的消息序号。
SCTP运用了TCP中的拥塞控制技术，包括慢启动，拥塞避免和快速重传。因此，当和TCP应用共存时，SCTP应用可接收属于SCTP的网络资源部分。</li>
<li>块（chunk）绑定
即多个用户消息可选择地绑定到一个SCTP包上，通过将消息放到一个或多个SCTP数据结构——“块”中，SCTP保留了应用程序的消息框架边界。不同类型的块可绑定到一个SCTP包中，但是控制块必须放在任何一个数据块之前。</li>
<li>路径管理
SCTP 路径管理功能主要负责从远端提供的一组传输地址中选择目的传输地址，它根据两个方面来选择目的地址：SCTP用户指示和当前可达的合格目的地。当其他流控 制不能提供可达性信息时，路径管理功能定时地扫描链路的可达性，并向SCTP报告远端传输地址所发生的变化。SCTP 路径管理功能模块同时还负责在建立链路时，向远端报告可用的本地地址，并把远端返回的传输地址告诉SCTP用户。</li>
<li>支持多宿
当SCTP传送数据包给目的IP地址时，如果此IP地址是不可达的，SCTP可以将消息重路由给一个交替的IP地址。这样，在关联的一端甚至两端，可容忍网络级错误。</li>
<li>防范拒绝服务（DoS）攻击
DoS 的攻击方式有很多种，最基本的DoS攻击就是利用合理的服务请求来占用过多的服务资源，从而使合法用户无法得到服务的响应。SYN Flooding攻击是DoS攻击的一种实例，是目前效果最好的一种黑客攻击方式。为了抵抗SYN Flooding对目标主机攻击，SCTP在关联初始化阶段实施了一种安全的“Cookie”机制。</li>
<li>支持多种传输模式
严格有序传输（像TCP），部分有序传输（像per-stream）和无序传输（像UDP）。
2 SCTP包结构
SCTP 包的结构，一个数据包首部可跟一个或多个可变长的块。块采用“类型—长度—值”（TLV）的格式。源端口、目的端口、校验码的意义同TCP中的意义相似。 确认标签保存着在SCTP握手中第一次交换的初始标签的值。在关联中，任何SCTP数据包若不包含这样一个标签，当到达时会被接收端丢弃。
在每个块中，TLV包括块类型、传输处理标记、块长度。不同的块类型可用来传输控制信息或数据。
传输序列号（TSN）和流序列号（SSN）是两种不同的序列号，TSN保证整个关联的可靠性，而SSN保证整个流的有序性，这样，在传输中，将数据的可靠性与有序性独立分开。
3 SCTP数据传输
4.1 SCTP四路握手及抵抗SYN Flooding攻击的原理
一个SCTP关联定义为：[主机A的一组IP地址]+[主机A的端口]+ [主机B的一组IP地址]+[主机B的端口]。 因此，每一端对应组中的任何一个IP地址都可作为相应的源/目的地址来标示本次关联，通过四路握手，两端SCTP主机交换通信状态。
SYN Flooding利用了TCP/IP的固有漏洞，面向连接的TCP三次握手是SYN Flooding存在的基础。SYN Flooding攻击的原理是：恶意的攻击者大量向服务器发送SYN报文，服务器在发出SYN+ACK应答报文后无法收到客户端的ACK报文（第三次握手 无法完成），服务器端将为维护一个非常大的半连接列表而消耗非常多的CPU时间和内存资源，还要不断对这个列表中的IP进行SYN+ACK的重试。服务器 端将忙于处理攻击者伪造的TCP连接请求而无暇理睬客户的正常请求，此时从正常客户的角度看来，服务器失去响应。
而在一次SCTP四路 握手中，INIT消息的接收端不必保存任何状态信息或者分配任何资源，这样就可防范SYN Flooding等DoS攻击。它在发送INIT-ACK消息时，采用了一种机制——“状态Cookie”，该Cookie具有发送端要建立自己状态所需 的全部信息。
SCTP产生一个状态Cookie的过程如下：</li>
<li>使用收到的INIT和发出的INIT- ACK块中的信息创建一个关联的TCB（传输控制块）。</li>
<li>在TCB中，将当前日期设为创建日期，将协议参数“有效Cookie时间”设为生存期间。</li>
<li>根据TCB，收集重建TCB所需的最小信息子集，将该子集和密钥产生一个MAC（信息认证编码）。</li>
<li>结合上述最小信息子集和MAC产生状态Cookie。</li>
<li>在发送完INIT ACK（包含状态Cookie参数）后，发送方必须删除TCB以及任何与新关联有关的本地资源。
INIT 和INIT-ACK都必须包含建立初始状态所需的参数：一组IP地址，保证可靠传输的初始TSN，每个被接收的SCTP包中必须含有的初始标签，每一端请 求发出的流数目和每一端能支持接收的流数目。交换完这些消息之后，INIT的发送端以COOKIE-ECHO消息的方式发送回状态Cookie。接收端根 据所接收到的COOKIE-ECHO中的状态Cookie，完整地重建自己的状态，并回送COOKIE- ACK来确认关联已建立。COOKIE-ECHO和COOKIE-ACK都可将用户数据消息绑定到各自的包中。
由此可见，采用以上这种 方式，即使接收再多的INIT消息, 接收端也没有任何资源的消耗：它既不分配任何系统资源，也不保存此次新关联的状态，它只是把相应重建状态所用的状态Cookie作为参数，包含在每一个回 送的INIT-ACK消息中，最后该状态Cookie会被COOKIE-ECHO消息发送回来。
2.2 SCTP数据交换
在两个SCTP主机间的正常数据交换。SCTP主机发送SACK块，用来确认每一个收到的SCTP包。因为SACK能完整地描述接收端的状态，因此,依据SACK,发送端能做出重传判决。SCTP支持类似于TCP中的快速重传和time-out重传算法。
对于数据包丢失发现，SCTP和TCP采用截然不同的机制：当TCP发现接收序号有缺口时，会等到该缺口被填上后，才发送序列号高于丢失数据包的数据。然而，SCTP即使发现接收序号有缺口或顺序错乱，仍会发送后面的数据。
3.3 SCTP关闭关联
作 为面向连接的传输协议，SCTP也运用三路握手来关闭一个关联，但与TCP有一点不同：一个TCP终端在“关联关闭”的过程中能够保持连接开启，并从对端 接收新的数据，而SCTP不支持TCP的这种“半关闭”状态。 1. 主机A发出“关闭”（SHUTDOWN）块来终止与主机B的关联，主机A进入“SHUTDOWN- PENDING”状态，对应的动作是：不再接受上层应用的数据，只发送队列中剩余的数据，进入“SHUTDOWN-SENT”状态。</li>
<li>主机B一旦接收到“关闭”块，就进入“SHUTDOWN-RECEIVED”状态，同主机A一样，不再接受上层应用的数据，只发送队列中剩余的数据。</li>
<li>主机A再次发送“关闭”块，通知主机 B所发送的剩余数据已到达，并且重申了关联正在关闭。</li>
<li>当第二次收到“关闭”块时，主机B发送“确认关闭”块。</li>
<li>主机A随后发送“关闭结束”块，完成本次关联的关闭。
4 结束语
SCTP 是为传输信令业务流而开发的，但它所具有的一些优于TCP的先进协议机制，如选择性确认、快速重传、无序递交等，使它又满足高性能传输的需求，这会给它带 来更为宽广的应用需求。目前，已有各种操作系统支持SCTP, 如Linux、AIX、Solaris、Windows、FressBSD。在不同协议实现间的互操作性测试的成功，揭示着SCTP正走向商业产品之路。
IEFT正在致力于SCTP进一步的修改，使其更能满足下一代应用的需求，例如支持IPv6地址，解决对端对于IPv6的site-local、link-local地址无连通性的问题，以及在已存在的关联中动态地增加或删除IP地址而无需重启该关联。
此外，在第三代移动通信中，SCTP可作为信令承载层的备选方案之一，它的应用及其性能评估也有待研究。</li>
</ol>
<p>分类: <a href="http://www.cnblogs.com/qlee/category/309427.html" target="_blank">Network Programming</a></p>
<p>绿色通道： <a href="">好文要顶</a> <a href="">关注我</a> <a href="">收藏该文</a><a href="http://space.cnblogs.com/msg/send/%e6%9d%8e%e5%a4%a7%e5%98%b4" target="_blank">与我联系</a> <a href="&quot;分享至新浪微博&quot;"><img src="" alt=""></a>
<a href="http://home.cnblogs.com/u/qlee/" target="_blank"><img src="" alt=""></a></p>
<p><a href="http://home.cnblogs.com/u/qlee/" target="_blank">李大嘴</a>
<a href="http://home.cnblogs.com/u/qlee/followees" target="_blank">关注 - 7</a>
<a href="http://home.cnblogs.com/u/qlee/followers" target="_blank">粉丝 - 27</a></p>
<p><a href="">+加关注</a></p>
<p>0</p>
<p>0
(请您对文章做出评价)</p>
<p><a href="http://www.cnblogs.com/qlee/archive/2011/07/12/2104089.html" target="_blank">«</a> 上一篇：<a href="http://www.cnblogs.com/qlee/archive/2011/07/12/2104089.html" title="发布于2011-07-12 11:47" target="_blank">TCP状态转换图</a>
<a href="http://www.cnblogs.com/qlee/archive/2011/07/13/2105720.html" target="_blank">»</a> 下一篇：<a href="http://www.cnblogs.com/qlee/archive/2011/07/13/2105720.html" title="发布于2011-07-13 21:28" target="_blank">MTU &amp; MSS 详解记录</a></p>
<p>SCTP处于SCTP用户应用层与IP网络层之间，它运用“关联”（association）这个术语定义交换信息的两个对等SCTP用户间的协议状态 。SCTP也是面向连接的，但在概念上，SCTP“关联”比TCP连接更为广泛：TCP的连接只有一个源地址和一个目的地址，SCTP提供一种方式使得每 个SCTP端点能为另一个对等端点提供一组传输地址，即传输地址= 一组IP地址+端口号。
在继承TCP特点的基础上，SCTP提供了一些额外的功能：</p>
<ol>
<li>在多个“流”（stream）中实现用户数据的有序发送
“流” 在TCP中指一系列的字节，而在SCTP中是指发送到上层协议的一定系列的用户消息，这些消息的顺序与流内其他消息相关。SCTP用户在建立关联时，可以 规定关联支持的流的数目。这个数目是与源端商定的，用户消息与流数目关联。在链路中，SCTP为每个送到对等端的消息分配一个流序号。在接收端，SCTP 确保在给定流中消息按顺序发送。同时，当一个流正在等待下一个非顺序的用户消息时，其他流的发送会继续。</li>
<li>根据已发现的路径MTU（最大传输单元）大小进行用户数据分片
为了确保发送到下层的SCTP数据包与路径MTU一致，SCTP对用户消息分片。在接收端，分片被重组后传给上层SCTP用户。</li>
<li>选择性确认（SACK）和拥塞控制
选择性确认用于数据包丢失发现，TCP中确认序号返回的是发送方已成功收到数据字节序号（不包含确认序号所指的字节），而SCTP反馈给发送端的是丢失的并且要求重传的消息序号。
SCTP运用了TCP中的拥塞控制技术，包括慢启动，拥塞避免和快速重传。因此，当和TCP应用共存时，SCTP应用可接收属于SCTP的网络资源部分。</li>
<li>块（chunk）绑定
即多个用户消息可选择地绑定到一个SCTP包上，通过将消息放到一个或多个SCTP数据结构——“块”中，SCTP保留了应用程序的消息框架边界。不同类型的块可绑定到一个SCTP包中，但是控制块必须放在任何一个数据块之前。</li>
<li>路径管理
SCTP 路径管理功能主要负责从远端提供的一组传输地址中选择目的传输地址，它根据两个方面来选择目的地址：SCTP用户指示和当前可达的合格目的地。当其他流控 制不能提供可达性信息时，路径管理功能定时地扫描链路的可达性，并向SCTP报告远端传输地址所发生的变化。SCTP 路径管理功能模块同时还负责在建立链路时，向远端报告可用的本地地址，并把远端返回的传输地址告诉SCTP用户。</li>
<li>支持多宿
当SCTP传送数据包给目的IP地址时，如果此IP地址是不可达的，SCTP可以将消息重路由给一个交替的IP地址。这样，在关联的一端甚至两端，可容忍网络级错误。</li>
<li>防范拒绝服务（DoS）攻击
DoS 的攻击方式有很多种，最基本的DoS攻击就是利用合理的服务请求来占用过多的服务资源，从而使合法用户无法得到服务的响应。SYN Flooding攻击是DoS攻击的一种实例，是目前效果最好的一种黑客攻击方式。为了抵抗SYN Flooding对目标主机攻击，SCTP在关联初始化阶段实施了一种安全的“Cookie”机制。</li>
<li>支持多种传输模式
严格有序传输（像TCP），部分有序传输（像per-stream）和无序传输（像UDP）。
2 SCTP包结构
SCTP 包的结构，一个数据包首部可跟一个或多个可变长的块。块采用“类型—长度—值”（TLV）的格式。源端口、目的端口、校验码的意义同TCP中的意义相似。 确认标签保存着在SCTP握手中第一次交换的初始标签的值。在关联中，任何SCTP数据包若不包含这样一个标签，当到达时会被接收端丢弃。
在每个块中，TLV包括块类型、传输处理标记、块长度。不同的块类型可用来传输控制信息或数据。
传输序列号（TSN）和流序列号（SSN）是两种不同的序列号，TSN保证整个关联的可靠性，而SSN保证整个流的有序性，这样，在传输中，将数据的可靠性与有序性独立分开。
3 SCTP数据传输
4.1 SCTP四路握手及抵抗SYN Flooding攻击的原理
一个SCTP关联定义为：[主机A的一组IP地址]+[主机A的端口]+ [主机B的一组IP地址]+[主机B的端口]。 因此，每一端对应组中的任何一个IP地址都可作为相应的源/目的地址来标示本次关联，通过四路握手，两端SCTP主机交换通信状态。
SYN Flooding利用了TCP/IP的固有漏洞，面向连接的TCP三次握手是SYN Flooding存在的基础。SYN Flooding攻击的原理是：恶意的攻击者大量向服务器发送SYN报文，服务器在发出SYN+ACK应答报文后无法收到客户端的ACK报文（第三次握手 无法完成），服务器端将为维护一个非常大的半连接列表而消耗非常多的CPU时间和内存资源，还要不断对这个列表中的IP进行SYN+ACK的重试。服务器 端将忙于处理攻击者伪造的TCP连接请求而无暇理睬客户的正常请求，此时从正常客户的角度看来，服务器失去响应。
而在一次SCTP四路 握手中，INIT消息的接收端不必保存任何状态信息或者分配任何资源，这样就可防范SYN Flooding等DoS攻击。它在发送INIT-ACK消息时，采用了一种机制——“状态Cookie”，该Cookie具有发送端要建立自己状态所需 的全部信息。
SCTP产生一个状态Cookie的过程如下：</li>
<li>使用收到的INIT和发出的INIT- ACK块中的信息创建一个关联的TCB（传输控制块）。</li>
<li>在TCB中，将当前日期设为创建日期，将协议参数“有效Cookie时间”设为生存期间。</li>
<li>根据TCB，收集重建TCB所需的最小信息子集，将该子集和密钥产生一个MAC（信息认证编码）。</li>
<li>结合上述最小信息子集和MAC产生状态Cookie。</li>
<li>在发送完INIT ACK（包含状态Cookie参数）后，发送方必须删除TCB以及任何与新关联有关的本地资源。
INIT 和INIT-ACK都必须包含建立初始状态所需的参数：一组IP地址，保证可靠传输的初始TSN，每个被接收的SCTP包中必须含有的初始标签，每一端请 求发出的流数目和每一端能支持接收的流数目。交换完这些消息之后，INIT的发送端以COOKIE-ECHO消息的方式发送回状态Cookie。接收端根 据所接收到的COOKIE-ECHO中的状态Cookie，完整地重建自己的状态，并回送COOKIE- ACK来确认关联已建立。COOKIE-ECHO和COOKIE-ACK都可将用户数据消息绑定到各自的包中。
由此可见，采用以上这种 方式，即使接收再多的INIT消息, 接收端也没有任何资源的消耗：它既不分配任何系统资源，也不保存此次新关联的状态，它只是把相应重建状态所用的状态Cookie作为参数，包含在每一个回 送的INIT-ACK消息中，最后该状态Cookie会被COOKIE-ECHO消息发送回来。
2.2 SCTP数据交换
在两个SCTP主机间的正常数据交换。SCTP主机发送SACK块，用来确认每一个收到的SCTP包。因为SACK能完整地描述接收端的状态，因此,依据SACK,发送端能做出重传判决。SCTP支持类似于TCP中的快速重传和time-out重传算法。
对于数据包丢失发现，SCTP和TCP采用截然不同的机制：当TCP发现接收序号有缺口时，会等到该缺口被填上后，才发送序列号高于丢失数据包的数据。然而，SCTP即使发现接收序号有缺口或顺序错乱，仍会发送后面的数据。
3.3 SCTP关闭关联
作 为面向连接的传输协议，SCTP也运用三路握手来关闭一个关联，但与TCP有一点不同：一个TCP终端在“关联关闭”的过程中能够保持连接开启，并从对端 接收新的数据，而SCTP不支持TCP的这种“半关闭”状态。 1. 主机A发出“关闭”（SHUTDOWN）块来终止与主机B的关联，主机A进入“SHUTDOWN- PENDING”状态，对应的动作是：不再接受上层应用的数据，只发送队列中剩余的数据，进入“SHUTDOWN-SENT”状态。</li>
<li>主机B一旦接收到“关闭”块，就进入“SHUTDOWN-RECEIVED”状态，同主机A一样，不再接受上层应用的数据，只发送队列中剩余的数据。</li>
<li>主机A再次发送“关闭”块，通知主机 B所发送的剩余数据已到达，并且重申了关联正在关闭。</li>
<li>当第二次收到“关闭”块时，主机B发送“确认关闭”块。</li>
<li>主机A随后发送“关闭结束”块，完成本次关联的关闭。
4 结束语
SCTP 是为传输信令业务流而开发的，但它所具有的一些优于TCP的先进协议机制，如选择性确认、快速重传、无序递交等，使它又满足高性能传输的需求，这会给它带 来更为宽广的应用需求。目前，已有各种操作系统支持SCTP, 如Linux、AIX、Solaris、Windows、FressBSD。在不同协议实现间的互操作性测试的成功，揭示着SCTP正走向商业产品之路。
IEFT正在致力于SCTP进一步的修改，使其更能满足下一代应用的需求，例如支持IPv6地址，解决对端对于IPv6的site-local、link-local地址无连通性的问题，以及在已存在的关联中动态地增加或删除IP地址而无需重启该关联。
此外，在第三代移动通信中，SCTP可作为信令承载层的备选方案之一，它的应用及其性能评估也有待研究。</li>
</ol>
<p>分类: <a href="http://www.cnblogs.com/qlee/category/309427.html" target="_blank">Network Programming</a></p>
<p>绿色通道： <a href="">好文要顶</a> <a href="">关注我</a> <a href="">收藏该文</a><a href="http://space.cnblogs.com/msg/send/%e6%9d%8e%e5%a4%a7%e5%98%b4" target="_blank">与我联系</a> <a href="&quot;分享至新浪微博&quot;"><img src="" alt=""></a>
<a href="http://home.cnblogs.com/u/qlee/" target="_blank"><img src="" alt=""></a></p>
<p><a href="http://home.cnblogs.com/u/qlee/" target="_blank">李大嘴</a>
<a href="http://home.cnblogs.com/u/qlee/followees" target="_blank">关注 - 7</a>
<a href="http://home.cnblogs.com/u/qlee/followers" target="_blank">粉丝 - 27</a></p>
<p><a href="">+加关注</a></p>
<p>0</p>
<p>0
(请您对文章做出评价)</p>
<p><a href="http://www.cnblogs.com/qlee/archive/2011/07/12/2104089.html" target="_blank">«</a> 上一篇：<a href="http://www.cnblogs.com/qlee/archive/2011/07/12/2104089.html" title="发布于2011-07-12 11:47" target="_blank">TCP状态转换图</a>
<a href="http://www.cnblogs.com/qlee/archive/2011/07/13/2105720.html" target="_blank">»</a> 下一篇：<a href="http://www.cnblogs.com/qlee/archive/2011/07/13/2105720.html" title="发布于2011-07-13 21:28" target="_blank">MTU &amp; MSS 详解记录</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/TCPIP/">TCPIP</a></li></span></span> | <span class="tags">Tagged <a href="/tags/TCPIP/" class="label label-primary">TCPIP</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-TCPIP--浅析——SCTP协议/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-TCPIP--浅析——SCTP协议" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/26/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/24/">24</a></li><li><a class="page-number" href="/page/25/">25</a></li><li><a class="page-number" href="/page/26/">26</a></li><li class="active"><li><span class="page-number current">27</span></li><li><a class="page-number" href="/page/28/">28</a></li><li><a class="page-number" href="/page/29/">29</a></li><li><a class="page-number" href="/page/30/">30</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/28/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 17:28:49</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
