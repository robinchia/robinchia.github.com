
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 90 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-加解密--加密算法你了解多少/">加密算法你了解多少</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-加解密--加密算法你了解多少/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">加密算法你了解多少</h1>
<p>（转自：<a href="http://www.hackhp.com/post-730.html" target="_blank"><a href="http://www.hackhp.com/post-730.html">http://www.hackhp.com/post-730.html</a></a> hackhp）</p>
<p>加密算法：
当不同的远程网络通过Internet连接时，网络之间直接通过私有地址进行互访只是需求之一，除此之外，还有个非常重要的需求，那就是数据安全。
所以在穿越Internet的远程之间只实现隧道传输还不够，还必须让数据包加密传输，以保证数据在Internet传输时的安全性。
基于上述原因，在远程网络之间布置VPN除了实现隧道功能之外，还必须在隧道中实现对数据的加密，隧道与加密是VPN不得不同时实现的功能，两者缺一不可，否则就不算是完整的VPN。</p>
<p>目前，加密算法多种多样，加密算法分加密和解密两个过程。
加密是指将明文(直接可以看的懂的)数据换算成密文(无法直接看懂的)数据。
加密算法非常多，曾经最古老，最常用，也是最让人理解的就是替换法</p>
<p>例如：
发送一串文字ABCDEF，要将这些文字变为密文，就将A替换为C，将B替换为D，将C替换为E，将D替换为F，将E替换为G，将F替换为H，最后ABCDEF就使用CDEFGH，而ABCDEF才是明文，是真正的内容，而CDEFGH就是加密后的密文，并不是真正的内容，从加密过程可以看出，明文“ABCDEF”通过将每个字母替换成后面第二个字母的方法被加密城了“CDEFGH”，在这里，将每个字母替换成后面第二个字母的方法可以称为加密方法，也成为加密算法，当内容被加密之后，接收者还必须先将密文解密，才能看懂内容，这里就将密文“CDEFGH”的每个字母替换成前面第二个字母，便得到明文“ABCDEF”。</p>
<p>从上面加密与解密的整个过程中可以发现，对数据进行加密需要使用加密算法，上例中使用的加密算法就是字母替换发，即将每个字母替换成其他字母的方法，知道数据使用什么算法去解密并没关系，</p>
<p>一个人知道数据的加密算法，并不能将密文转变为明文，要对密文进行解密，不仅要知道加密算法，同时还必须知道加密的密钥，也就是密码，在上例中，将每个字谜替换成后面第二个字母就是密钥(密码)，如果别人只是知道我们使用的加密算法是字母替换发，但他不知道每个字母具体被替换成了哪个字母，是没办法将密文还原的，所以对数据加密的算法可以被公开，但是机密的密钥一定要保密不能被窃取，否则密文也就变得不安全了，因此，如何保证密钥的安全是相当重要的。</p>
<p>在对称加密算法中，因为解密时使用的密钥与加密时使用是同一个密钥，所以对密钥的保护必须格外的小心，只要密钥在交换或协商时被人窃取，数据就会被破解，显然双方必须使用绝对的方法来交换密钥。</p>
<p>而在非对称加密算法中，因为解密时使用的密钥和加密时使用的密钥不同，任何拥有弓腰的人，都可以对数据进行加密，但只有拥有私钥的人，才能对密文解密，所以公钥可以被公开，可以被任何人知道，只知道公钥只能加密，却不能解密，所以只要保证私钥掌握在自己手中不传递不外泄，就不会有问题；双方在需要加密传输时，各自都把公钥发出去，让对方通过该公钥将数据加密后发给自己，这样就能使任何人都能向自己发送加密数据，但只有自己才能对数据解密。</p>
<p><strong>对称加密算法(私钥算法)</strong></p>
<p><strong>DES(Data Encryption Standard)</strong>
DES加密共有三种形式，分为DWS(40-bit长度加密)，DES(56-bit长度加密)以及3DES(3倍的56-bit长度加密，即168-bit长度加密)；由于3DES加密长度够长，安全性够高，所以推荐使用3DES。</p>
<p><strong>AES(Advanced Encryption Standard)</strong>
AES加密共有三种形式，分为AES 128 (128-bit长度加密)，AES 192 (192-bit长度加密)以及AES 256 (256-bit长度加密)；由于AES 256加密长度够长，安全性够高，所以推荐使用AES 256。</p>
<p><strong>非对称加密算法(公钥算法)</strong></p>
<p><strong>RSA</strong>
RSA公钥加密算法的名字是发明者的人名：Rivest,Shamir and Adleman，该算法的长度位数不定，由人手工定义。</p>
<p>在硬件方面，当采用公钥加密算法时，速度明显慢于私钥加密算法，虽然使用公钥加密算法似乎更安全，但通常都使用私钥加密算法，而使用私钥加密算法的终点就是要保证密钥的安全传递与交换，所以该工作就由公钥加密算法来完成，最后的过程就是先使用公钥加密算法安全的交换私钥算法的密钥后，然后再使用私钥算法对数据进行加密，这样即保证了私钥算法的密钥安全，同时又获得了数据加密的速度，两者兼得。</p>
<p><strong>HMAC(Hashed Message Authentication Code)</strong>
当数据在传输过程，如果被劫持后修改了数据，通常数据接受者很难发现数据是否在途中被篡改；在正常的数据传输中大家应该知道，每个数据包都会在后面写上一个数据计算后的校验和(Checksum)，当数据计算出校验和之后，接受者在收到数据后也需要对数据进行校验和计算，如果发现自己计算的校验和与数据包附带的校验和不同，便认为数据发生了偏移和错误，因此将数据包丢弃和要求重传，在需要保证数据安全中途被篡改时，也引用了校验和的思想，数据在发送之前先计算出相应的Hash值，当接收者收到数据后也要对数据计算Hash值，如果发现自己计算的Hash值与数据附带的值不匹配，便认为数据在传输过程中遭到了篡改，从而拒绝不正确的数据包。</p>
<p>在这里，Hash算法和校验和算法基本上是相同的，Hash算法的特征在于任何大小的数据计算出的Hash值的长度都是一样的，任何数据通过Hash计算后，得到的Hash值都是固定长度的，哪怕几个字的数据，或者是几GByte的数据，计算出的Hash值的长度都是相同的，所以如果仅仅是根据Hash值，是无法推算出数据内容的，只靠Hash值无法想数据内容还原。基于以上Hash的特征，所以Hash多用于认证，认证对等双方相互认证时，只需要交换密码的Hash值即可，而无须交换密码，从而防止了密码被窃取，但仅仅是窃取Hash值，也无法推算出密码是多少。</p>
<p><strong>MD5(Message Digest 5)</strong>
将任何数据通过计算后输出128-bit长度的Hash值。</p>
<p><strong>SHA-1(Secure Hash Algorithm 1)</strong>
<strong>160-bit digest</strong>
将任何数据通过计算后输出160-bit长度的Hash值。
来源： <a href="[http://www.hackhp.com/post-730.html](http://www.hackhp.com/post-730.html)">[http://www.hackhp.com/post-730.html](http://www.hackhp.com/post-730.html)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/加解密/">加解密</a></li></span></span> | <span class="tags">Tagged <a href="/tags/加解密/" class="label label-primary">加解密</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-加解密--加密算法你了解多少/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-加解密--加密算法你了解多少" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--cas配置全攻略-哈哈-吼吼-这是个好地方-BlogJava/">cas配置全攻略 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--cas配置全攻略-哈哈-吼吼-这是个好地方-BlogJava/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas-blogjava">cas配置全攻略 - 哈哈,吼吼,这是个好地方 - BlogJava</h1>
<p><a href="http://www.blogjava.net/tufanshu/" target="_blank">哈哈,吼吼,这是个好地方</a>
没有风雨躲的过， 没有坎坷不必走……</p>
<p><a href="http://www.blogjava.net/" target="_blank">BlogJava</a>    <a href="http://www.blogjava.net/tufanshu/" target="_blank">首页</a>    <a href="http://www.blogjava.net/tufanshu/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a>    <a href="http://www.blogjava.net/tufanshu/contact.aspx?id=1" target="_blank">联系</a>    <a href="http://www.blogjava.net/tufanshu/rss" target="_blank">聚合</a><a href="http://www.blogjava.net/tufanshu/rss" target="_blank"><img src="" alt=""></a>    <a href="http://www.blogjava.net/tufanshu/admin/EditPosts.aspx" target="_blank">管理</a></p>
<p>posts - 37,  comments - 50,  trackbacks - 0</p>
<p><a href="">cas配置全攻略</a></p>
<p>经过将近两天的测试，参考众多网友的贡献，终于完成了对cas的主要配置和测试，现记录如下</p>
<p>基本需求：</p>
<p>1.cas server-3.4.5,casclient-3.2（官方版本），均可在cas官方网站下载，<a href="http://www.jasig.org/" target="_blank"><a href="http://www.jasig.org">http://www.jasig.org</a></a></p>
<p>2.使用低成本的http协议进行传输，俺买不起ssl证书</p>
<p>3.通过jdbc进行用户验证</p>
<p>4.需要通过casserver提供除登录用户名以外的附加信息</p>
<p>参考资料：</p>
<p>1.cas官方网站的用户帮助手册和wiki</p>
<p>2.网友“城市猎人”的blog，<a href="http://yuzhwe.javaeye.com/blog/830143" target="_blank"><a href="http://yuzhwe.javaeye.com/blog/830143">http://yuzhwe.javaeye.com/blog/830143</a></a></p>
<p>3.网友“悟空悟道”的blog，<a href="http://llhdf.javaeye.com/blog/764385" target="_blank"><a href="http://llhdf.javaeye.com/blog/764385">http://llhdf.javaeye.com/blog/764385</a></a></p>
<p>4.其他网友贡献的相关的blog，都是通过google出来，就不一一列出了，一并致谢！！！</p>
<p>好了，下面进入正题，如果您不想测试中出现异常情况，或是获取不到相关数据，请关注文中的红色字体部分。</p>
<p>（1）使用http协议的设置，如果您也像我一样，买不起ssl数字证书，对安全的要求也不是特别的搞，下面的配置就可以帮助解决这个问题：</p>
<p>在cas-server-webapp中的/WEB-INF/spring-configuration/ticketGrantingTicketCookieGenerator.xml文件中有如下配置</p>
<bean id="ticketGrantingTicketCookieGenerator" class="org.jasig.cas.web.support.CookieRetrievingCookieGenerator"
  p:cookieSecure="true"     //默认为true，使用https,如果只需要http，修改为false即可
  p:cookieMaxAge="-1"
  p:cookieName="CASTGC"
  p:cookiePath="/cas" />

 （2）使用jdbc数据源进行用户认证，需要修改cas的authenticationHandlers方式，在文件/WEB-INF/deployerConfigContext.xml有如下配置：

<property name="authenticationHandlers">
   <list>
    <!--
     | This is the authentication handler that authenticates services by means of callback via SSL, thereby validating
     | a server side SSL certificate.
     +-->
    <bean class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler"
     p:httpClient-ref="httpClient" />
    <!--
     | This is the authentication handler declaration that every CAS deployer will need to change before deploying CAS
     | into production.  The default SimpleTestUsernamePasswordAuthenticationHandler authenticates UsernamePasswordCredentials
     | where the username equals the password.  You will need to replace this with an AuthenticationHandler that implements your
     | local authentication strategy.  You might accomplish this by coding a new such handler and declaring
     | edu.someschool.its.cas.MySpecialHandler here, or you might use one of the handlers provided in the adaptors modules.
     +-->
    <!--<bean class="org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler" />-->
     <bean  class="org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler">
         <property name="dataSource" ref="dataSource" />
        <property name="sql" value="select password from userInfo where username=? and enabled=true" />
         //用户密码编码方式
         <property name="passwordEncoder"
           ref="passwordEncoderBean"/>
         </bean><br>   </list>
  </property>

该属性中的list只要用一个认证通过即可，建议将红色部分放在第一位，如果确认只用jdbc一种方式，其他认证方式均可删除。另外需要在在文件中添加datasoure和passordEncoder两个bean，如下

<!-- Data source definition -->
 <bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
  <property name="driverClassName">
    <value>com.mysql.jdbc.Driver</value>
  </property>
  <property name="url">
    <value>jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8</value>    //如果使用mysql数据库，应该加上后面的编码参数，否则可能导致客户端对TGT票据无法识别的问题
  </property>
  <property name="username"><value>root</value></property>
  <property name="password"><value>password</value></property>
 </bean>
 <bean id="passwordEncoderBean" class="org.jasig.cas.authentication.handler.DefaultPasswordEncoder">
        <constructor-arg value="SHA1" />  //cas
server默认支持MD5和SHA1两种编码方式，如果需要其他的编码方式例如SHA256,512等，可自行实现org.jasig.cas.authentication.handler.PasswordEncoder接口
    </bean>

<p>附加备注：如果您是使用cas server的源码自行编译的话，需要在cas-server-web模块的pom.xml中添加如下模块的依赖：</p>
<dependency>
       <groupId>${project.groupId}</groupId>
       <artifactId>cas-server-support-jdbc</artifactId>
       <version>${project.version}</version>
  </dependency>  

<p>并添加对应数据库的jdbc的jar包。</p>
<p>（3）让cas server提供更多的用户数据共客户端使用</p>
<p>通过测试，由于cas的代码更新过程中的变化较大，所以包兼容的问题好像一直存在，在测试中我就碰到过，花费时间比较多，建议同学们在使用过程中使用官方的最新的发布版本。在我使用的这个版本中，请参考前面的关于server和client端的版本说明，应该没有包冲突的问题，测试通过。下面进行配置，配置文件：/WEB-INF/deployerConfigContext.xml</p>
<p><property name="credentialsToPrincipalResolvers">
   <list>
       <!--<bean class="org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver" />-->
    <!-- modify on 2011-01-18,add user info -->
    <bean class="org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver" >
      <property name="attributeRepository" >   //为认证过的用户的Principal添加属性
      <ref local="attributeRepository"/>
     </property> 
    </bean>
      <bean
     class="org.jasig.cas.authentication.principal.HttpBasedServiceCredentialsToPrincipalResolver" />
   </list>
  </property>
 修改该文件中默认的 attributeRepositorybean配置
<!-- 在这里配置获取更多用户的信息 -->
 <bean id="attributeRepository" class="org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao">
  <constructor-arg index="0" ref="dataSource" />
  <constructor-arg index="1" value="select id as UId, password_hint as ph from userInfo where username=? and enabled=true" />
  <property name="queryAttributeMapping">
   <map>
   <entry key="username" value="uid"/><!-- 这里必须这么写，系统会自己匹配，貌似和where语句后面的用户名字段的拼写没有什么关系 -->
   </map>
  </property>
   <!-- 要获取的属性在这里配置 -->
  <property name="resultAttributeMapping">
   <map>
   <entry key="UId" value="userId" /> //key为对应的数据库字段名称，value为提供给客户端获取的属性名字，系统会自动填充值
   <entry key="ph" value="passwordHint" /><br>   </map>
  </property>
</bean> 
备注：网上有很多的关于这个的配置，但是如果您使用的是我提供的版本或是高于这个版本，就应该象上面这样配置，无用质疑，网上大部分的配置都是基于
person-directory-impl,person-directory-api
1.1左右的版本，而最新的cas使用的是1.5的版本，经过查看源代码和api docs确定最新版本的属性参数如上配置。</p>
<p>修改该xml文件中最后一个默认的serviceRegistryDao bean中的属性全部注释掉，或者删除，
这个bean中的RegisteredServiceImpl的ignoreAttributes属性将决定是否添加attributes属性内容，默认为false:不添加，只有去掉这个配置，
cas server才会将获取的用户的附加属性添加到认证用的Principal的attributes中去，我在这里犯过这样的错误，最后还是通过跟踪源码才发现的。</p>
<bean
  id="serviceRegistryDao"
        class="org.jasig.cas.services.InMemoryServiceRegistryDaoImpl">
        &lt;!--
            <property name="registeredServices">
                <list>
                    <bean class="org.jasig.cas.services.RegisteredServiceImpl">
                        <property name="id" value="0" />
                        <property name="name" value="HTTP" />
                        <property name="description" value="Only Allows HTTP Urls" />
                        <property name="serviceId" value="http:///*/*" />
                    </bean>

<pre><code>                &lt;bean class=&quot;org.jasig.cas.services.RegisteredServiceImpl&quot;&gt;
                    &lt;property name=&quot;id&quot; value=&quot;1&quot; /&gt;
                    &lt;property name=&quot;name&quot; value=&quot;HTTPS&quot; /&gt;
                    &lt;property name=&quot;description&quot; value=&quot;Only Allows HTTPS Urls&quot; /&gt;
                    &lt;property name=&quot;serviceId&quot; value=&quot;https:///*/*&quot; /&gt;
                &lt;/bean&gt;

                &lt;bean class=&quot;org.jasig.cas.services.RegisteredServiceImpl&quot;&gt;
                    &lt;property name=&quot;id&quot; value=&quot;2&quot; /&gt;
                    &lt;property name=&quot;name&quot; value=&quot;IMAPS&quot; /&gt;
                    &lt;property name=&quot;description&quot; value=&quot;Only Allows HTTPS Urls&quot; /&gt;
                    &lt;property name=&quot;serviceId&quot; value=&quot;imaps:///*/*&quot; /&gt;
                &lt;/bean&gt;

                &lt;bean class=&quot;org.jasig.cas.services.RegisteredServiceImpl&quot;&gt;
                    &lt;property name=&quot;id&quot; value=&quot;3&quot; /&gt;
                    &lt;property name=&quot;name&quot; value=&quot;IMAP&quot; /&gt;
                    &lt;property name=&quot;description&quot; value=&quot;Only Allows IMAP Urls&quot; /&gt;
                    &lt;property name=&quot;serviceId&quot; value=&quot;imap:///*/*&quot; /&gt;
                &lt;/bean&gt;
            &lt;/list&gt;
        &lt;/property&gt;--&gt;
       &lt;/bean&gt;
</code></pre><p> 修改WEB-INF\view\jsp\protocol\2.0\casServiceValidationSuccess.jsp文件，如下：</p>
<p>&lt;%@ page session=&quot;false&quot;%&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;<a href="http://java.sun.com/jsp/jstl/core%22%" target="_blank"><a href="http://java.sun.com/jsp/jstl/core&quot;%">http://java.sun.com/jsp/jstl/core&quot;%</a></a>&gt;
&lt;%@ taglib uri=&quot;<a href="http://java.sun.com/jsp/jstl/functions" target="_blank"><a href="http://java.sun.com/jsp/jstl/functions">http://java.sun.com/jsp/jstl/functions</a></a>&quot; prefix=&quot;fn&quot;%&gt;</p>
<p><cas:serviceResponse xmlns:cas='http://www.yale.edu/tp/cas'>
 <cas:authenticationSuccess>
  <cas:user>${fn:escapeXml(assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.id)}</cas:user>
  <c:if test="${not empty pgtIou}">
   <cas:proxyGrantingTicket>${pgtIou}</cas:proxyGrantingTicket>
  </c:if>
  <c:if test="${fn:length(assertion.chainedAuthentications) > 1}">
   <cas:proxies>
    <c:forEach var="proxy" items="${assertion.chainedAuthentications}"
     varStatus="loopStatus" begin="0"
     end="${fn:length(assertion.chainedAuthentications)-2}" step="1">
     <cas:proxy>${fn:escapeXml(proxy.principal.id)}</cas:proxy>
    </c:forEach>
   </cas:proxies>
  </c:if>
   <c:if
   test="${fn:length(assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.attributes)
>
0}">
   <cas:attributes>
    <c:forEach
var="attr"
     items="${assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.attributes}"
     varStatus="loopStatus"
begin="0"
     end="${fn:length(assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.attributes)-1}"
     step="1">
     <cas:${fn:escapeXml(attr.key)}>${fn:escapeXml(attr.value)}</cas:${fn:escapeXml(attr.key)}>
    </c:forEach>
   </cas:attributes>
  </c:if>
 </cas:authenticationSuccess>
</cas:serviceResponse>
客户端配置:
1.过滤器CAS Validation Filter：</p>
<p><filter>
  <filter-name>CAS Validation Filter</filter-name>
  <filter-class> org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter</filter-class>
  <init-param>
    <param-name>casServerUrlPrefix</param-name>
    <param-value><a href="http://domainserver:8081/cas" target="_blank">http://domainserver:8081/cas</a></param-value>
  </init-param>
</filter>
在客户端获取信息
AttributePrincipal principal = (AttributePrincipal) request.getUserPrincipal();
String loginName = principal.getName();//获取用户名
Map<String, Object> attributes = principal.getAttributes();
if(attributes != null) {
 System.out.println(attributes.get(&quot;userId&quot;));
 System.out.println(attributes.get(&quot;passwordHint&quot;));
}</p>
<p>posted on 2011-01-21 10:06 <a href="http://www.blogjava.net/tufanshu/" target="_blank">雪地孤鸿</a> 阅读(3704) <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#Post" target="_blank">评论(7)</a>  <a href="http://www.blogjava.net/tufanshu/admin/EditPosts.aspx?postid=343290" target="_blank">编辑</a>  <a href="http://www.blogjava.net/tufanshu/AddToFavorite.aspx?id=343290" target="_blank">收藏</a> 所属分类: <a href="http://www.blogjava.net/tufanshu/category/4974.html" target="_blank">java</a> <img src="" alt=""></p>
<p><a href=""></a>
<strong>FeedBack:</strong></p>
<p><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#343395" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-01-23 13:13 | <a href="">来如风</a>
非常好，我上周也配置成功
只是最后过滤器有疑问</p>
<p><init-param></p>
<p><param-name>casServerUrlPrefix</param-name></p>
<p><param-value><a href="http://domainserver:8081/cas%3C/param-value%3E" target="_blank"><a href="http://domainserver:8081/cas">http://domainserver:8081/cas</a></param-value></a>
</init-param>
我是集成了spring security 的配置，貌似这些不在过滤其中配置，在bean文件中有  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=%e6%9d%a5%e5%a6%82%e9%a3%8e" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#343442" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-01-24 16:29 | <a href="">coolszy</a>
你好，按照你的配置，但是
Map<String, Object> attributes = principal.getAttributes();
还是得到空值，不知道什么原因  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=coolszy" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a></p>
<p><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#343924" title="permalink: re: cas配置全攻略[未登录]" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略[未登录]</p>
<p>2011-02-07 11:02 | <a href="">mcikeay</a></p>
<p><entry key="username" value="uid"/><!-- 这里必须这么写，系统会自己匹配，貌似和where语句后面的用户名字段的拼写没有什么关系 -->
cas 会自己组装<map>节点中的key-value, 节点间默认是 and 连接  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=mcikeay" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#344268" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-02-14 15:15 | <a href="http://040922/" target="_blank">tufanshu</a>
@coolszy
请检查cas client的版本是否正确  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=tufanshu" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a></p>
<p><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#347172" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-03-29 10:45 | <a href="">wuximin</a>
通过ldap验证，改怎样修改呢  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=wuximin" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#351783" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-06-05 18:19 | <a href="http://xn--rgv/" target="_blank">artd</a>
按您的要求，为何还是不行呀，不知道那里出问题了。
不过我用的server是3.3.5.1
用3.4.5也不行，有空交流一下哟。
以下是log信息
2011-06-05 18:09:19,515 DEBUG [org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver] - Attempting to resolve a principal...
2011-06-05 18:09:19,515 DEBUG [org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver] - Creating SimplePrincipal for [test]
2011-06-05 18:09:20,421 DEBUG [org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao] - Created seed map=&#39;{username=[test]}&#39; for uid=&#39;test&#39;
2011-06-05 18:09:20,421 DEBUG [org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao] - Adding attribute &#39;username&#39; with value &#39;[test]&#39; to query builder &#39;null&#39;
2011-06-05 18:09:20,421 DEBUG [org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao] - Generated query builder &#39;sql=[username = ?] args=[test]&#39; from query Map {username=[test]}.
2011-06-05 18:09:20,546 DEBUG [org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao] - Executed &#39;select id,username,password,email,score from user where username = ?&#39; with arguments [test] and got results [{id=20428, username=test, password=1a16128849444873, email=et@163.com, score=6}]
2011-06-05 18:09:20,562 INFO [org.jasig.cas.CentralAuthenticationServiceImpl] - Granted service ticket [ST-1-cp3cb14yiqbqnYfg7C1f-cas] for service [<a href="http://d7.abc.com/simple.php" target="_blank"><a href="http://d7.abc.com/simple.php">http://d7.abc.com/simple.php</a></a>] for user [test]
2011-06-05 18:09:20,640 DEBUG [org.springframework.web.servlet.view.RedirectView] - Rendering view with name &#39;null&#39; with model null and static attributes {}
2011-06-05 18:09:20,703 DEBUG [org.springframework.web.servlet.view.ResourceBundleViewResolver] - Cached view [casServiceSuccessView_zh_CN]
2011-06-05 18:09:20,703 DEBUG [org.springframework.web.servlet.view.JstlView] - Rendering view with name &#39;casServiceSuccessView&#39; with model {assertion=[principals={[[Principal=test, attributes={authenticationMethod=com.jute.framework.jdbc.QueryDatabaseAuthenticationHandler}]]} for service=<a href="http://d7.abc.com/simple.php" target="_blank"><a href="http://d7.abc.com/simple.php">http://d7.abc.com/simple.php</a></a>]} and static attributes {}
2011-06-05 18:09:20,750 DEBUG [org.springframework.web.servlet.view.JstlView] - Added model object &#39;assertion&#39; of type [org.jasig.cas.validation.ImmutableAssertionImpl] to request in view with name &#39;casServiceSuccessView&#39;
2011-06-05 18:09:20,750 DEBUG [org.springframework.web.servlet.view.JstlView] - Forwarding to resource [/WEB-INF/view/jsp/protocol/2.0/casServiceValidationSuccess.jsp] in InternalResourceView &#39;casServiceSuccessView&#39;
  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=artd" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a></p>
<p><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#361580" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略<a href=""></a></p>
<p>2011-10-19 15:24 | <a href="">fanfree</a>
同样遇到 Map是空的，没有附加属性  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=fanfree" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.blogjava.net/RequireRegister.aspx" target="_blank">新用户注册</a>  <a href="">刷新评论列表</a>  </p>
<p><a href=""></a> <a href="http://q.cnblogs.com/">博问 - 解决您的IT难题</a>   <a href="http://www.cnblogs.com/" target="_blank">博客园</a>  <a href="http://q.cnblogs.com/" target="_blank">博问</a>  <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>  <a href="http://job.cnblogs.com/cate-java_programmer/" target="_blank">Java程序员招聘</a> 标题  请输入标题 姓名  请输入你的姓名 主页 请输入验证码 验证码 /*  <img src="" alt=""> 内容(请不要发表任何与政治相关的内容) 请输入评论内容 Remember Me?   <a href="http://www.blogjava.net/login.aspx?ReturnURL=http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html&amp;SourceURL=/tufanshu/archive/2011/01/21/343290.html" target="_blank">登录</a>       [使用Ctrl+Enter键可以直接提交]    IT新闻：
· <a href="http://news.cnblogs.com/n/149115/" target="_blank">苹果在移动支付领域之慢，是福是祸？</a>
· <a href="http://news.cnblogs.com/n/149114/" target="_blank">黑莓应用商店应用下载量突破30亿次，应用数量达9万款</a>
· <a href="http://news.cnblogs.com/n/149113/" target="_blank">微软将推出Bing天使基金孵化器</a>
· <a href="http://news.cnblogs.com/n/149112/" target="_blank">苹果在华测试iPad mini：微胖 具备通话功能</a>
· <a href="http://news.cnblogs.com/n/149111/" target="_blank">抱上微软粗腿不怕！诺基亚豪言明年定走出困境</a></p>
<p>博客园首页随笔：
· <a href="http://www.cnblogs.com/lzrabbit/archive/2012/07/09/2574491.html" target="_blank">MVC3使用Unity实现依赖注入接口与于实现类自动注册</a>
· <a href="http://www.cnblogs.com/stoic/archive/2012/07/09/2582212.html" target="_blank">k-means clustering K平均算法</a>
· <a href="http://www.cnblogs.com/izumu/archive/2012/07/09/2582200.html" target="_blank">【hdu - 1061 Rightmost Digit】</a>
· <a href="http://www.cnblogs.com/refactor/archive/2012/07/09/2575995.html" target="_blank">SqlServer 对 数据类型 text 的操作</a>
· <a href="http://www.cnblogs.com/stephen-liu74/archive/2012/07/09/2423565.html" target="_blank">Step By Step(Lua弱引用table)</a>
知识库：
· <a href="http://kb.cnblogs.com/page/143279/" target="_blank">页面前端的水有多深？再议页面开发</a>
· <a href="http://kb.cnblogs.com/page/130367/" target="_blank">Fiddler 教程</a>
· <a href="http://kb.cnblogs.com/page/148772/" target="_blank">关于编程学习的七点思索</a>
· <a href="http://kb.cnblogs.com/page/115175/" target="_blank">一地鸡毛 — 软件项目中的人际困局</a>
· <a href="http://kb.cnblogs.com/page/148841/" target="_blank">互联网——降级论</a>  网站导航:</p>
<p><a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园</a>   <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>   <a href="http://kb.cnblogs.com/" target="_blank">知识库</a>   <a href="http://www.cppblog.com/" target="_blank">C++博客</a>   <a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a>   <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html?opt=admin" target="_blank">管理</a> 相关文章:</p>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/02/09/343972.html" target="_blank">cas server 3.4.5 部署在weblogic问题记录</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/01/26/343543.html" target="_blank">cas server使用mysql数据库和oralce数据库的差异</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343318.html" target="_blank">cas server logout的问题</a></li>
<li><a href="">cas配置全攻略</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/06/26/210852.html" target="_blank">JForum 的 SSO集成的问题解决</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2007/12/24/170126.html" target="_blank">apache2.2.6+tomcat5.5.17配置说明</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/12/04/85371.html" target="_blank">找不到C.TLD的问题</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/11/01/78479.html" target="_blank">roller2.3源代码部署笔录</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/07/31/60981.html" target="_blank">tomcat 服务器抛出socket异常“文件打开太多”的问题</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/12/26/25499.html" target="_blank">hsql的使用</a><br>Copyright ©2012 雪地孤鸿 Powered By: <a href="http://www.cnblogs.com/" target="_blank">博客园</a> 模板提供：<a href="http://blog.hjenglish.com/" target="_blank">沪江博客</a>
<a href="&quot;Go to the previous month&quot;">&lt;</a>2011年1月<a href="&quot;Go to the next month&quot;">&gt;</a>日一二三四五六2627282930311234567891011121314151617181920<a href="http://www.blogjava.net/tufanshu/archive/2011/01/21.html" target="_blank">21</a>22232425<a href="http://www.blogjava.net/tufanshu/archive/2011/01/26.html" target="_blank">26</a>272829303112345</li>
</ul>
<h3 id="-">常用链接</h3>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/MyPosts.html" target="_blank">我的随笔</a></li>
<li><a href="http://www.blogjava.net/tufanshu/MyComments.html" target="_blank">我的评论</a></li>
<li><a href="http://www.blogjava.net/tufanshu/OtherPosts.html" target="_blank">我的参与</a></li>
<li><a href="http://www.blogjava.net/tufanshu/RecentComments.html" target="_blank">最新评论</a></li>
</ul>
<h3 id="-13-">留言簿(13)</h3>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/Contact.aspx?id=1" target="_blank">给我留言</a></li>
<li><a href="http://www.blogjava.net/tufanshu/default.aspx?opt=msg" target="_blank">查看公开留言</a></li>
<li><a href="http://www.blogjava.net/tufanshu/admin/MyMessages.aspx" target="_blank">查看私人留言</a></li>
</ul>
<h1 id="-">随笔分类</h1>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/category/9675.html" target="_blank">appfuse(1)</a><a href="http://www.blogjava.net/tufanshu/category/9675.html/rss" title="Subscribe to appfuse(1)" target="_blank"><img src="&quot;Subscribe to appfuse(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/33305.html" target="_blank">CRM&amp;ERP(1)</a><a href="http://www.blogjava.net/tufanshu/category/33305.html/rss" title="Subscribe to CRM&amp;ERP(1)" target="_blank"><img src="&quot;Subscribe to CRM&amp;ERP(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/44350.html" target="_blank">Grails(3)</a><a href="http://www.blogjava.net/tufanshu/category/44350.html/rss" title="Subscribe to Grails(3)" target="_blank"><img src="&quot;Subscribe to Grails(3" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/4974.html" target="_blank">java(11)</a><a href="http://www.blogjava.net/tufanshu/category/4974.html/rss" title="Subscribe to java(11)" target="_blank"><img src="&quot;Subscribe to java(11" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/41549.html" target="_blank">ofbiz学习(1)</a><a href="http://www.blogjava.net/tufanshu/category/41549.html/rss" title="Subscribe to ofbiz学习(1)" target="_blank"><img src="&quot;Subscribe to ofbiz学习(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/30111.html" target="_blank">seam2.0学习笔记(1)</a><a href="http://www.blogjava.net/tufanshu/category/30111.html/rss" title="Subscribe to seam2.0学习笔记(1)" target="_blank"><img src="&quot;Subscribe to seam2.0学习笔记(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/4243.html" target="_blank">SPRING</a><a href="http://www.blogjava.net/tufanshu/category/4243.html/rss" title="Subscribe to SPRING" target="_blank"><img src="&quot;Subscribe to SPRING&quot;" alt=""></a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/30359.html" target="_blank">sso(3)</a><a href="http://www.blogjava.net/tufanshu/category/30359.html/rss" title="Subscribe to sso(3)" target="_blank"><img src="&quot;Subscribe to sso(3" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/4244.html" target="_blank">STRUTS(1)</a><a href="http://www.blogjava.net/tufanshu/category/4244.html/rss" title="Subscribe to STRUTS(1)" target="_blank"><img src="&quot;Subscribe to STRUTS(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/3522.html" target="_blank">Sync4j(1)</a><a href="http://www.blogjava.net/tufanshu/category/3522.html/rss" title="Subscribe to Sync4j(1)" target="_blank"><img src="&quot;Subscribe to Sync4j(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/3293.html" target="_blank">SyncML(2)</a><a href="http://www.blogjava.net/tufanshu/category/3293.html/rss" title="Subscribe to SyncML(2)" target="_blank"><img src="&quot;Subscribe to SyncML(2" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/36144.html" target="_blank">大战SOA &amp; MULE</a><a href="http://www.blogjava.net/tufanshu/category/36144.html/rss" title="Subscribe to 大战SOA &amp; MULE" target="_blank"><img src="&quot;Subscribe to 大战SOA &amp; MULE&quot;" alt=""></a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/15210.html" target="_blank">工作日志(2)</a><a href="http://www.blogjava.net/tufanshu/category/15210.html/rss" title="Subscribe to 工作日志(2)" target="_blank"><img src="&quot;Subscribe to 工作日志(2" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/4242.html" target="_blank">开发工具(3)</a><a href="http://www.blogjava.net/tufanshu/category/4242.html/rss" title="Subscribe to 开发工具(3)" target="_blank"><img src="&quot;Subscribe to 开发工具(3" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/22461.html" target="_blank">生活感悟(1)</a><a href="http://www.blogjava.net/tufanshu/category/22461.html/rss" title="Subscribe to 生活感悟(1)" target="_blank"><img src="&quot;Subscribe to 生活感悟(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/40597.html" target="_blank">系统维护(3)</a><a href="http://www.blogjava.net/tufanshu/category/40597.html/rss" title="Subscribe to 系统维护(3)" target="_blank"><img src="&quot;Subscribe to 系统维护(3" alt="">&quot;)</a></li>
</ul>
<h1 id="-">随笔档案</h1>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/02.html" target="_blank">2011年2月 (2)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/01.html" target="_blank">2011年1月 (3)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2010/12.html" target="_blank">2010年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2010/05.html" target="_blank">2010年5月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2010/03.html" target="_blank">2010年3月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/12.html" target="_blank">2009年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/09.html" target="_blank">2009年9月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/08.html" target="_blank">2009年8月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/07.html" target="_blank">2009年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/05.html" target="_blank">2009年5月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/04.html" target="_blank">2009年4月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/02.html" target="_blank">2009年2月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/07.html" target="_blank">2008年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/06.html" target="_blank">2008年6月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/03.html" target="_blank">2008年3月 (3)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2007/12.html" target="_blank">2007年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2007/08.html" target="_blank">2007年8月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2007/07.html" target="_blank">2007年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/12.html" target="_blank">2006年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/11.html" target="_blank">2006年11月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/10.html" target="_blank">2006年10月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/09.html" target="_blank">2006年9月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/07.html" target="_blank">2006年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/04.html" target="_blank">2006年4月 (2)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/12.html" target="_blank">2005年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/11.html" target="_blank">2005年11月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/10.html" target="_blank">2005年10月 (4)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/09.html" target="_blank">2005年9月 (1)</a></li>
</ul>
<h1 id="-">文章档案</h1>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archives/2005/09.html" target="_blank">2005年9月 (1)</a></li>
</ul>
<h1 id="blog">blog</h1>
<ul>
<li><a href="http://www.blogjava.net/eamoi/" target="_blank">eamoi之Coder日志</a></li>
<li>ajax</li>
<li><a href="http://www.blogjava.net/eamoi" target="_blank">liferayPortal</a></li>
<li><a href="http://steeven.cnblogs.com/" target="_blank">steeven</a></li>
<li><a href="http://www.cnblogs.com/zhengyun_ustc/" target="_blank">sync4j</a></li>
<li><a href="http://www.u2o.net/blog/default.asp" target="_blank">sync4j1</a></li>
<li><a href="http://www.blogjava.net/sean" target="_blank">大胃</a></li>
<li><a href="http://www.blogjava.net/zyb9114/" target="_blank">月亮的太阳</a></li>
<li><a href="http://www.blogjava.net/SteelHand" target="_blank">铁手剑谱</a></li>
<li>铁手</li>
</ul>
<h3 id="-">搜索</h3>
<p>*</p>
<ul>
<li></li>
</ul>
<h3 id="-http-www-blogjava-net-tufanshu-commentsrss-aspx-">最新评论 <a href="http://www.blogjava.net/tufanshu/CommentsRSS.aspx" target="_blank"><img src="" alt=""></a></h3>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/11/02/343972.html#362546" target="_blank">1. re: cas server 3.4.5 部署在weblogic问题记录[未登录]</a></li>
<li>评论内容较长,点击标题查看</li>
<li>--大雄</li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/10/19/343290.html#361580" target="_blank">2. re: cas配置全攻略</a></li>
<li>同样遇到 Map是空的，没有附加属性</li>
<li>--fanfree</li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/06/19/343318.html#352630" target="_blank">3. re: cas server logout的问题</a></li>
<li>加了这个还是停在原来的退出页面，</li>
<li>--artd</li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/06/05/343290.html#351783" target="_blank">4. re: cas配置全攻略</a></li>
<li>评论内容较长,点击标题查看</li>
<li>--artd</li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/03/29/343290.html#347172" target="_blank">5. re: cas配置全攻略</a></li>
<li>通过ldap验证，改怎样修改呢</li>
<li>--wuximin</li>
</ul>
<h3 id="-">阅读排行榜</h3>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/10/20/76389.html" target="_blank">1. linux+php5.1.6+mysql5.0.2+apache2.0.55安装配置说明：(12245)</a></li>
<li><a href="">2. cas配置全攻略(3704)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/09/14/69691.html" target="_blank">3. 在tomcat下发布使用eclipse中的ant打包后的war文件(3490)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/03/25/188552.html" target="_blank">4. cas配置之初体验(3313)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/07/26/217681.html" target="_blank">5. opencrx安装手记(2914)</a></li>
</ul>
<h3 id="-">评论排行榜</h3>
<ul>
<li><a href="">1. cas配置全攻略(7)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/10/20/76389.html" target="_blank">2. linux+php5.1.6+mysql5.0.2+apache2.0.55安装配置说明：(4)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/10/15/15574.html" target="_blank">3. SyncML Intensive 继续(4)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/11/17/20309.html" target="_blank">4. jdk1.4升级到JDK1.5的问题(3)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/09/03/293787.html" target="_blank">5. ofbiz9 + oracle 11g(3)</a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--cas配置全攻略-哈哈-吼吼-这是个好地方-BlogJava/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--cas配置全攻略-哈哈-吼吼-这是个好地方-BlogJava" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/">cas改造随笔 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas-horus-">cas改造随笔 - horus - 博客园</h1>
<p><a href=""></a></p>
<p><a href="http://www.cnblogs.com/hellowood/" target="_blank">hello wood</a>
<a href="http://www.cnblogs.com/" target="_blank">博客园</a>   <a href="http://www.cnblogs.com/hellowood/" target="_blank">首页</a>   <a href="http://space.cnblogs.com/" target="_blank">社区</a>   <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a>   <a href="http://space.cnblogs.com/msg/send/horus" target="_blank">联系</a>   <a href="http://www.cnblogs.com/hellowood/rss" target="_blank">订阅</a><a href="http://www.cnblogs.com/hellowood/rss" target="_blank"><img src="" alt="订阅"></a>   <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx" target="_blank">管理</a></p>
<p>随笔-9  评论-5  文章-1  trackbacks-0</p>
<h1 id="-cas-http-www-cnblogs-com-hellowood-archive-2010-08-05-1793364-html-"><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html" target="_blank">cas改造随笔</a></h1>
<p>Sso doc</p>
<p>关键字：</p>
<p>sso域名：cas.server.com</p>
<p>登陆地址（spring web flow）：<a href="https://cas.800jit.com/cas/login" target="_blank"><a href="https://cas.800jit.com/cas/login">https://cas.800jit.com/cas/login</a></a></p>
<p>登陆地址（直接）：<a href="https://cas.800jit.com/cas/directLogin" target="_blank"><a href="https://cas.800jit.com/cas/directLogin">https://cas.800jit.com/cas/directLogin</a></a></p>
<p>退出地址：<a href="https://cas.800jit.com/cas/logout" target="_blank"><a href="https://cas.800jit.com/cas/logout">https://cas.800jit.com/cas/logout</a></a></p>
<p>语言参数：locale=zh_CN，locale=en</p>
<h1 id="-">环境篇</h1>
<p> <img src="" alt=""></p>
<h2 id="-">一、所需软件</h2>
<p>Jdk：jdk1.6.0_13</p>
<p>Apache：httpd-2.2.15-win32-x86-openssl-0.9.8m-r2</p>
<p>Tomcat：apache-tomcat-6.0.10</p>
<p>jks2pfx：证书导出工具<a href="http://www.myssl.cn/download/jks2pfx.zip" target="_blank"><a href="http://www.myssl.cn/download/jks2pfx.zip">http://www.myssl.cn/download/jks2pfx.zip</a></a></p>
<p>memcache：memcached-1.2.1-win32（需要memcache集群环境）</p>
<h2 id="-">二、安全证书生成</h2>
<p>1、<strong>keytool</strong></p>
<p>Apache、tomcat、jdk需要使用安全证书，进windows command窗口生成证书，命令如下：</p>
<p>--生成证书库</p>
<p>keytool -genkey -alias 800jit -keyalg RSA -keystore d:/cert/800jitkey</p>
<p>--从证书库中到处证书</p>
<p>keytool -export -file d:/cert/800jit.crt -alias 800jit -keystore d:/cert/800jitkey</p>
<p>--把证书导入jdk的证书库</p>
<p>keytool -import -keystore d: /jdk1.6.0_13/jre/lib/security/cacerts -file d:/cert/800jit.crt -alias 800jit</p>
<p>--生成Apache服务器的SSL连接需要配置私钥文件和证书文件</p>
<p>D:\casex\jks2pfx&gt;JKS2PFX.bat .keystore 800jitkey tomcat server_dev00</p>
<p>生成的server_dev00.crt，server_dev00.key放到D:/work/Apache2.2/conf/</p>
<p><strong>2**</strong>、openssl**</p>
<p>openssl req -config ..\conf\openssl.cnf -new -out olymtech.csr</p>
<p>openssl rsa -in privkey.pem -out olymtech.key</p>
<p>openssl x509 -in olymtech.csr -out olymtech.cert -req -signkey olymtech.key -days 3650</p>
<p>openssl x509 -in olymtech.cert -out olymtech.der.crt -outform DER</p>
<p>keytool -import -keystore d:/work/jdk1.6.0_13/jre/lib/security/cacerts -file d:/casex/ssl/olymtech.crt -alias olymtech</p>
<p>keytool -import -keystore D:/casex/800jitkey -file D:/casex/cas-doc/ssl/olymtech.crt -alias olymtech</p>
<h2 id="-apache-">三、Apache配置</h2>
<p>Apache+ssl+虚拟机</p>
<p>--修改http.conf文件</p>
<p>取消注释 LoadModule ssl_module modules/mod_ssl.so</p>
<p>取消注释 Include conf/extra/httpd-ssl.conf</p>
<p>取消注释 Include conf/extra/httpd-vhosts.conf</p>
<p>ProxyPass /cas  balancer://cas lbmethod=bytraffic stickysession=jsessionid</p>
<proxy balancer://cas/>

    BalancerMember ajp://192.168.1.190:10009/cas  loadfactor=1 route=jvm1

    BalancerMember ajp://192.168.1.190:8009/cas  loadfactor=1 route=jvm2

</proxy>



<p>--修改httpd-ssl.conf</p>
<p>在<VirtualHost _default_:443>下增加</p>
<p>ProxyPass /cas  balancer://cas/ lbmethod=bytraffic stickysession=jsessionid</p>
<p>ProxyPassReverse /cas balancer://cas/</p>
<p>SSLProxyEngine On</p>
<p>修改</p>
<p>SSLCertificateFile &quot;D:/work/Apache2.2/conf/server_dev00.crt&quot;</p>
<p>SSLCertificateKeyFile &quot;D:/work/Apache2.2/conf/server_dev00.key&quot;</p>
<p>--修改httpd-vhosts.conf</p>
<p>在<VirtualHost /*:80>下增加</p>
<p>ProxyPass /cas  balancer://cas/ lbmethod=bytraffic stickysession=jsessionid</p>
<p>ProxyPassReverse /cas balancer://cas/</p>
<h2 id="-tomcat-">四、Tomcat配置</h2>
<p>修改server.xml</p>
<p>--配置ssl</p>
<Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"

               maxThreads="150" scheme="https" secure="true"

               clientAuth="false" sslProtocol="TLS"

                        keystoreFile="d:/work/apache-tomcat-6.0.10/conf/800jitkey"

                        keystorePass="111111" />



<h2 id="-session-tomcat-">五、session共享（Tomcat）</h2>
<h2 id="-memcache-">六、memcache集群</h2>
<h1 id="cas-server-">CAS SERVER篇</h1>
<h2 id="-cas-">一、CAS 原理介绍</h2>
<p> <img src="" alt=""></p>
<p>访问流程图</p>
<p><strong>主要原理：</strong>用户第一次访问一个CAS 服务的客户web 应用时（访问URL ：<a href="http://192.168.1.90:8081/web1" target="_blank"><a href="http://192.168.1.90:8081/web1">http://192.168.1.90:8081/web1</a></a> ），部署在客户web 应用的cas AuthenticationFilter ，会截获此请求，生成service 参数，然后redirect 到CAS 服务的login 接口，url为<a href="https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F" target="_blank"><a href="https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F">https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F</a></a> ，认证成功后，CAS 服务器会生成认证cookie ，写入浏览器，同时将cookie 缓存到服务器本地，CAS 服务器还会根据service 参数生成ticket,ticket 会保存到服务器，也会加在url 后面，然后将请求redirect 回客户web 应用，url 为<a href="http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20" target="_blank"><a href="http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20">http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20</a></a> 。这时客户端的AuthenticationFilter 看到ticket 参数后，会跳过，由其后面的TicketValidationFilter 处理，TicketValidationFilter 会利用httpclient 工具访问cas 服务的/serviceValidate 接口, 将ticket 、service 都传到此接口，由此接口验证ticket 的有效性，TicketValidationFilter 如果得到验证成功的消息，就会把用户信息写入web 应用的session里。至此为止，SSO 会话就建立起来了，以后用户在同一浏览器里访问此web 应用时，AuthenticationFilter 会在session 里读取到用户信息，所以就不会去CAS 认证，如果在此浏览器里访问别的web 应用时，AuthenticationFilter 在session 里读取不到用户信息，会去CAS 的login 接口认证，但这时CAS 会读取到浏览器传来的cookie ，所以CAS 不会要求用户去登录页面登录，只是会根据service 参数生成一个ticket ，然后再和web 应用做一个验证ticket 的交互。</p>
<h2 id="-cas-">二、CAS 服务端的处理逻辑</h2>
<p>CAS 服务端总共对外定义了9 个接口，客户端通过访问这9 个接口与服务端交互，这9个接口为：
接口</p>
<p>说明</p>
<p>备注 /login</p>
<p>认证接口</p>
<p>  /logout</p>
<p>退出接口，负责销毁认证cookie</p>
<p>  /validate</p>
<p>验证ticket 用的接口，CAS1.0 定义</p>
<p>  /serviceValidate</p>
<p>验证ticket 用的接口，CAS2.0 定义，返回xml 格式的数据</p>
<p>  /proxy</p>
<p>支持代理认证功能的接口</p>
<p>  /proxyValidate</p>
<p>支持代理认证功能的接口</p>
<p>  /CentralAuthenticationService</p>
<p>用于和远程的web services 交互</p>
<p>  /remoteLogin（新增）</p>
<p>认证接口</p>
<p>  /directLogin（新增）</p>
<p>认证接口</p>
<p>详细说明：</p>
<p> <strong>/login:</strong></p>
<p>登录流程这部分要考虑到不同种类用户凭证的获取方案，以及客户应用传来的service 、gateway 、renew 参数的不同取值组合，CAS 为了实现流程的高度可配置性，采用了Spring Web Flow 技术。通过CAS 发布包里的login-webflow.xml 、cas-servlet.xml 、applicationContext.xml 这3 个文件，找出 了登录有关的所有组件，画出处理流程图。</p>
<p> <img src="" alt=""></p>
<p>CAS 默认的登录处理流程</p>
<p> <img src="" alt=""></p>
<p>第一次访问Web 应用的流程走向</p>
<p> <img src="" alt=""></p>
<p>已经登录web1 后，访问web1 的资源（web1 没有启动session ），或访问web2 的资源</p>
<p>注：</p>
<p>1 ： InitialFlowSetupAction: 是流程的入口。用 request.getContextPath() 的值来设置 cookie 的 Path 值， Cookie 的 path 值是在配置文件里定义的，但这个 Action 负责将 request.getContextPath() 的值设置为 Cookie 的 path 值，这是在 cas 部署环境改变的情况下，灵活地设置 cookie path 的方式；把 cookie 的值以及 service 参数的值放入 requestContext 的 flowscope 里。</p>
<p>2 ： GenerateServiceTicketAction 此 Action 负责根据 service 、 GTC cookie 值生成 ServiceTicket 对象， ServiceTicket 的 ID 就是返回给客户应用的 ticket 参数，如果成功创建 ServiceTicket ，则转发到 WarnAction ，如果创建失败，且 gateway 参数为 true ，则直接redirect 到客户应用， 否则则需要重新认证。</p>
<p>3 ： viewLoginForm 这是登录页面， CAS 在此收集用户凭证。 CAS 提供的默认实现是 /WEB-INF/view/jsp/simple/ui/casLoginView.jsp 。</p>
<p>4 ： bindAndValidate 对应 AuthenticationViaFormAction 的 doBind 方法，该方法负责搜集登录页面上用户录入的凭证信息（用户名、密码等），然后把这些信息封装到 CAS 内部的 Credentials 对象中。用户在 casLoginView.jsp 页面上点击提交后，会触发此方法。</p>
<p>5:submit   对应 AuthenticationViaFormAction 的 submit 方法 , 如果 doBind 方法成功执行完， 则触发 submit 方法，此方法负责调用centralAuthenticationService 的      grantServiceTicket 方法，完成认证工作，如果认证成功，则生成 TicketGrantingTicket 对象，放在缓存里， TicketGrantingTicket 的 ID 就是 TGC Cookie 的 value 值。</p>
<p>6 ： warn  CAS 提供了一个功能：用户在一个 web 应用中跳到另一个 web 应用时， CAS 可以跳转到一个提示页面，该页面提示用户要离开一个应用进入另一个应用，可以让用户自己选择。用户在登录页面 viewLoginForm 上选中了 id=”warn” 的复选框，才能开启这个功能。</p>
<p>WarnAction 就检查用户有没有开启这个功能，如果开启了，则转发到showWarnView, 如果没开启，则直接redirect 到客户应用。</p>
<p>7 ：SendTicketGrantingTicketAction 此Action 负责为response 生成TGC Cookie ，cookie 的值就是 AuthenticationViaFormAction 的submit 方法生成的 TicketGrantingTicket 对象的 ID 。</p>
<p>8 ： viewGenerateLoginSuccess 这是 CAS 的认证成功页面。</p>
<p><strong>/logout:</strong> （ 对应实现类 org.jasig.cas.web.LogoutController ）</p>
<p>处理逻辑：   </p>
<pre><code>    1) removeCookie

   2) 在服务端删除TicketGrantingTicket 对象（此对象封装了cookie 的value 值）

   3 ）redirect 到退出页面，有2 种选择：

      if(LogoutController 的followServiceRedirects 属性为true 值，且url 里的service 参数非空){

            redirect 到 sevice 参数标识的url

         }

      else{

         redirect 到内置的casLogoutView （cas/WEB-INF/view/jsp/default/ui/casLogoutView.jsp ），如果url 里有url 参数，则此url 参数标识的链接会显示在casLogoutView 页面上。

       }
</code></pre><p><strong>/serviceValidate: </strong>（对应实现类 org.jasig.cas.web.ServiceValidateController ）</p>
<p> 处理逻辑：  </p>
<p>  如果service 参数为空或ticket 参数为空，则转发到failureView （/WEB-INF/view/jsp/default/protocol/2.0/casServiceValidationFailure.jsp ）</p>
<pre><code>验证ticket 。以ticket 为参数，去缓存里找ServiceTicketImpl 对象，如果能找到，且没有过期，且ServiceTicketImpl 对象对应的service 属性和service 参数对应，则验证通过，验证通过后，请求转发至casServiceSuccessView （cas/WEB-INF/view/jsp/default/protocol/2.0/casServiceValidationSuccess.jsp ），验证不通过，则转发到failureView 。
</code></pre><h2 id="-">三、认证相关的概念及流程</h2>
<p>概念</p>
<ul>
<li><strong>Credentials**</strong> **用户提供的用于登录用的凭据信息，如用户名/ 密码、证书、IP 地址、Cookie 值等。比如 UsernamePasswordCredentials ，封装的是用户名和密码。CAS 进行认证的第一步，就是把从UI 或request 对象里取到的用户凭据封装成Credentials 对象，然后交给认证管理器去认证。</li>
<li><strong>AuthenticationHandler**</strong> **认证Handler, 每种AuthenticationHandler 只能处理一种Credentials ，如AbstractUsernamePasswordAuthenticationHandler 只负责处理 U sernamePasswordCredentials 。</li>
<li><strong>Principal</strong> 封装用户标识，比如 SimplePrincipal, 只是封装了用户名。认证成功后， credentialsToPrincipalResolvers 负责由Credentials 生成 Principal 对象。</li>
<li><strong>CredentialsToPrincipalResolvers**</strong> **负责由 Credentials 生成 Principal 对象，每种 CredentialsToPrincipalResolvers 只处理 一种Credentials ，比如 UsernamePasswordCredentialsToPrincipalResolver 负责从 U sernamePasswordCredentials 中取出用户名，然后将其赋给生成的 SimplePrincipal 的 ID 属性。</li>
<li><strong>AuthenticationMetaDataPopulators</strong> 负责将 Credentials 的一些属性赋值给 Authentication 的 attributes 属性。</li>
<li><strong>Authentication</strong>   Authentication是认证管理器的最终处理结果， Authentication 封装了 Principal ，认证时间，及其他一些属性（可能来自 Credentials ）。</li>
<li><strong>AuthenticationManager</strong> 认证管理器得到 Credentials 对象后，负责调度AuthenticationHandler 去完成认证工作，最后返回的结果是 Authentication 对象。</li>
<li><strong>CentralAuthenticationService**</strong> <strong> CAS 的服务类，对 Web 层提供了一些方法。该类还负责调用 AuthenticationManager 完成认证逻辑</strong>。**</li>
</ul>
<p>序列图</p>
<p> <img src="" alt=""></p>
<p>类图</p>
<p> <img src="" alt=""></p>
<h2 id="-ticket-http-zhenkm0507-javaeye-com-blog-546805-">四、<a href="http://zhenkm0507.javaeye.com/blog/546805" target="_blank">Ticket介绍</a></h2>
<p>CAS的核心就是其Ticket，及其在Ticket之上的一系列处理操作。CAS的主要票据有TGT、ST、PGT、PGTIOU、PT，其中TGT、ST是CAS1.0协议中就有的票据，PGT、PGTIOU、PT是CAS2.0协议中有的票据。</p>
<h3 id="-">一 名词解释</h3>
<ul>
<li>TGT（Ticket Grangting Ticket）</li>
</ul>
<p>TGT是CAS为用户签发的登录票据，拥有了TGT，用户就可以证明自己在CAS成功登录过。TGT封装了Cookie值以及此Cookie值对应的用户信息。用户在CAS认证成功后，CAS生成cookie，写入浏览器，同时生成一个TGT对象，放入自己的缓存，TGT对象的ID就是cookie的值。当HTTP再次请求到来时，如果传过来的有CAS生成的cookie，则CAS以此cookie值为key查询缓存中有无TGT ，如果有的话，则说明用户之前登录过，如果没有，则用户需要重新登录。</p>
<ul>
<li>ST（Service Ticket）</li>
</ul>
<p>ST是CAS为用户签发的访问某一service的票据。用户访问service时，service发现用户没有ST，则要求用户去CAS获取ST。用户向CAS发出获取ST的请求，如果用户的请求中包含cookie，则CAS会以此cookie值为key查询缓存中有无TGT，如果存在TGT，则用此TGT签发一个ST，返回给用户。用户凭借ST去访问service，service拿ST去CAS验证，验证通过后，允许用户访问资源。</p>
<ul>
<li>PGT（Proxy Granting Ticket）</li>
</ul>
<p>Proxy Service的代理凭据。用户通过CAS成功登录某一Proxy Service后，CAS生成一个PGT对象，缓存在CAS本地，同时将PGT的值（一个UUID字符串）回传给Proxy Service，并保存在Proxy Service里。Proxy Service拿到PGT后，就可以为Target Service（back-end service）做代理，为其申请PT。</p>
<ul>
<li>PGTIOU（Proxy Granting Ticket IOU）</li>
</ul>
<p>PGTIOU是CAS协议中定义的一种附加票据，它增强了传输、获取PGT的安全性。
PGT的传输与获取的过程：Proxy Service调用CAS的serviceValidate接口验证ST成功后，CAS首先会访问pgtUrl指向的https url，将生成的 PGT及PGTIOU传输给proxy service，proxy service会以PGTIOU为key，PGT为value，将其存储在Map中；然后CAS会生成验证ST成功的xml消息，返回给Proxy Service，xml消息中含有PGTIOU，proxy service收到Xml消息后，会从中解析出PGTIOU的值，然后以其为key，在map中找出PGT的值，赋值给代表用户信息的Assertion对象的pgtId，同时在map中将其删除。</p>
<ul>
<li>PT（Proxy Ticket）</li>
</ul>
<p>PT是用户访问Target Service（back-end service）的票据。如果用户访问的是一个Web应用，则Web应用会要求浏览器提供ST，浏览器就会用cookie去CAS获取一个ST，然后就可以访问这个Web应用了。如果用户访问的不是一个Web应用，而是一个C/S结构的应用，因为C/S结构的应用得不到cookie，所以用户不能自己去CAS获取ST，而是通过访问proxy service的接口，凭借proxy service的PGT去获取一个PT，然后才能访问到此应用。</p>
<h3 id="-">二 代码解析</h3>
<p> <img src="" alt=""></p>
<p>CAS Ticket类图</p>
<ul>
<li>TicketGrantingTicket 的 grantServiceTicket方法</li>
</ul>
<p>方法声明：public synchronized ServiceTicket grantServiceTicket(final String id,final Service service, final ExpirationPolicy expirationPolicy, final boolean credentialsProvided)</p>
<p>方法描述:</p>
<p> 1：生成SerivceTicketImpl</p>
<p> 2：更新属性：</p>
<p>this.previousLastTimeUsed = this.lastTimeUsed;</p>
<p>   this.lastTimeUsed = System.currentTimeMillis();</p>
<p>   this.countOfUses++;</p>
<p> 3：给service对象的principal属性赋值</p>
<p> 4：将service对象放入map services</p>
<ul>
<li>ServiceTicket 的 grantTicketGrantingTicket方法</li>
</ul>
<p>方法声明：</p>
<p>public TicketGrantingTicket grantTicketGrantingTicket(final String id, final Authentication authentication,final ExpirationPolicy expirationPolicy)</p>
<p>方法描述：在CAS3.3对CAS2.0协议的实现中，PGT是由ST签发的，调用的就是ServiceTicket的grantTicketGrantingTicket方法。方法返回的TicketGrantingTicket对象，表征的是一个PGT对象，其中的ticketGrantingTicket属性的值是签发ST的TGT对象。</p>
<ul>
<li>TicketGrantingTicket 的 expire方法</li>
</ul>
<p>方法声明：void expire()</p>
<p>方法描述：</p>
<p>在CAS的logout接口实现中，要调用TGT对象的expire方法，然后会在缓存中清除此TGT对象。</p>
<p>expire方法的内容：循环遍历 services 中的Service对象，调用其logoutOfService方法。具体Service实现类中的logoutOfService方法的实现，要通知具体的应用，客户要退出。</p>
<h3 id="-tgt-st-pgt-pt-">三、TGT、ST、PGT、PT关系</h3>
<p>1：ST是TGT签发的。用户在CAS上认证成功后，CAS生成TGT，用TGT签发一个ST，ST的ticketGrantingTicket属性值是TGT对象，然后把ST的值redirect到客户应用。</p>
<p>2：PGT是ST签发的。用户凭借ST去访问Proxy service，Proxy service去CAS验证ST（同时传递PgtUrl参数给CAS），如果ST验证成功，则CAS用ST签发一个PGT，PGT对象里的ticketGrantingTicket是签发ST的TGT对象。</p>
<p>3：PT是PGT签发的。Proxy service代理back-end service去CAS获取PT的时候，CAS根据传来的pgt参数，获取到PGT对象，然后调用其grantServiceTicket方法，生成一个PT对象。</p>
<p> <img src="" alt=""></p>
<p>TGT、ST、PGT、PT之间的关联关系</p>
<h1 id="cas-client-">CAS CLIENT篇</h1>
<h2 id="casfilter-">CASFilter 参数说明：</h2>
<p>参数</p>
<p>是否必须</p>
<p>说明 com.olymtech.cas.client.filter.loginUrl</p>
<p>是</p>
<p>指定 CAS 提供登录页面的 URL com.olymtech.cas.client.filter.validateUrl</p>
<p>是</p>
<p>指定 CAS 提供 service ticket 或 proxy ticket 验证服务的 URL com.olymtech.cas.client.filter.serverName</p>
<p>是</p>
<p>指定客户端的域名和端口，是指客户端应用所在机器而不是 CAS Server 所在机器，该参数或 serviceUrl 至少有一个必须指定 com.olymtech.cas.client.filter.serviceUrl</p>
<p>否</p>
<p>该参数指定过后将覆盖 serverName 参数，成为登录成功过后重定向的目的地址 com.olymtech.cas.client.filter.wrapRequest</p>
<p>否</p>
<p>如果指定为 true，那么 CASFilter 将重新包装 HttpRequest,并且使 getRemoteUser() 方法返回当前登录用户的用户名 com.olymtech.cas.client.filter.noFilter</p>
<p>否</p>
<p>设置不过滤的路径，语法如下：/name1/,/name2, com.olymtech.cas.client.filter.proxyCallbackUrl</p>
<p>否</p>
<p>用于当前应用需要作为其他服务的代理(proxy)时获取 Proxy Granting Ticket 的地址 com.olymtech.cas.client.filter.authorizedProxy</p>
<p>否</p>
<p>用于允许当前应用从代理处获取 proxy tickets，该参数接受以空格分隔开的多个 proxy URLs，但实际使用只需要一个成功即可。当指定该参数过后，需要修改 validateUrl 到 proxyValidate，而不再是 serviceValidate com.olymtech.cas.client.filter.renew</p>
<p>否</p>
<p>如果指定为 true，那么受保护的资源每次被访问时均要求用户重新进行验证，而不管之前是否已经通过 com.olymtech.cas.client.filter.gateway</p>
<p>否</p>
<p>指定 gateway 属性</p>
<h1 id="-">应用整合篇</h1>
<h2 id="-java-">一、JAVA程序整合</h2>
<p><strong>1、**</strong>应用配置说明（结合cas client<strong>**）</strong></p>
<p>导入key到本地jdk（tomcat使用的jdk必须）</p>
<p>keytool -import -keystore d:/work/jdk1.6.0_13/jre/lib/security/cacerts -file d:/casex/800jit.crt -alias 800jit</p>
<p>在ie中导入证书800jit.crt</p>
<p>修改web程序的web.xml添加</p>
<pre><code>&lt;!-- 用于单点退出 --&gt;

&lt;listener&gt;

    &lt;listener-class&gt;org.jasig.cas.client.session.SingleSignOutHttpSessionListener&lt;/listener-class&gt;

&lt;/listener&gt;



&lt;filter&gt;

&lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;

&lt;filter-class&gt;org.jasig.cas.client.session.SingleSignOutFilter&lt;/filter-class&gt;

&lt;/filter&gt;



&lt;!-- 用于单点登录 --&gt;



&lt;filter&gt;

   &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;

   &lt;filter-class&gt;com.olymtech.cas.client.filter.CASFilter&lt;/filter-class&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.loginUrl&lt;/param-name&gt;

       &lt;param-value&gt;https://cas.server.com/cas/login&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.validateUrl&lt;/param-name&gt;

       &lt;param-value&gt;https://cas.server.com/cas/serviceValidate&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.serverName&lt;/param-name&gt;

       &lt;param-value&gt;saas.server.com&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.wrapRequest&lt;/param-name&gt;

       &lt;param-value&gt;true&lt;/param-value&gt;

   &lt;/init-param&gt;

&lt;/filter&gt;



&lt;filter-mapping&gt;

   &lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;

   &lt;url-pattern&gt;//*&lt;/url-pattern&gt;

&lt;/filter-mapping&gt;



&lt;filter-mapping&gt;

   &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;

   &lt;url-pattern&gt;//*&lt;/url-pattern&gt;

&lt;/filter-mapping&gt;
</code></pre><p>在jsp/servlet中得到登陆数据：</p>
<p>&lt;%@ page language=&quot;java&quot; import=&quot;com.olymtech.cas.client.filter.CASFilterRequestWrapper&quot;%&gt;</p>
<p>&lt;%</p>
<p>CASFilterRequestWrapper  reqWrapper=<strong>new</strong> CASFilterRequestWrapper(request);</p>
<p>String username = reqWrapper.getRemoteUser();</p>
<p>%&gt;</p>
<h2 id="-net-">二、.NET程序整合</h2>
<h1 id="-">附件</h1>
<p>ssl.rar（证书）</p>
<p>http.conf（apache配置文件）</p>
<p>httpd-ssl.conf（apache配置文件）</p>
<p>httpd-vhosts.conf（apache配置文件）</p>
<p>server.xml（tomcat配置文件）</p>
<p>AppSsoDemo-java.rar（java整合例子，包含所需jar包）</p>
<p>posted on 2010-08-05 17:23 <a href="http://www.cnblogs.com/hellowood/" target="_blank">horus</a> 阅读(2394) 评论(2) <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx?postid=1793364" target="_blank">编辑</a> <a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#" target="_blank">收藏</a>
<img src="" alt=""></p>
<p><a href="">刷新评论</a><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#" target="_blank">刷新页面</a><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#top" target="_blank">返回顶部</a></p>
<p><a href="http://q.cnblogs.com/" target="_blank">程序员问答社区，解决您的技术难题</a>
<a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园首页</a><a href="http://q.cnblogs.com/" title="程序员问答社区" target="_blank">博问</a><a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a>
Powered by: <a href="http://www.cnblogs.com/" target="_blank">博客园</a> 模板提供：<a href="http://blog.hjenglish.com/" target="_blank">沪江博客</a> Copyright ©2012 horus</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--cas改造随笔-horus-博客园" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全--黑客经典之恶意SSH登录企图分析/">黑客经典之恶意SSH登录企图分析</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全--黑客经典之恶意SSH登录企图分析/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-ssh-">黑客经典之恶意SSH登录企图分析</h1>
<p>黑客经典之恶意SSH登录企图分析</p>
<p>原文链接：<a href="http://www.securitycn.net/html/research/service/1395.html" target="_blank">http://www.securitycn.net/html/research/service/1395.html</a></p>
<p>恶意SSH登录企图出现在一些管理者的日志中已经有几年的时间了。本文回顾了使用&quot;蜜罐&quot;（honeypot）对恶意SSH登录企图进行分析的方法，并提出了我们可以从这一活动中学到的东西。接着本文给出了关于如何使自己的系统安全面对这些攻击的建议。</p>
<p>使用honeypots进行研究</p>
<p>新西兰Honeynet（蜜罐网络）联盟是Honeynet联盟的一个成员研究机构，它致力于通过使用蜜罐技术研究黑帽子黑客（black hat hackers，指那些恶意入侵计算机或计算机网络并尽其所能进行破坏的黑客）的行为、策略和工具来提升计算机系统和网络安全。蜜罐的价值在于它们是可以公开接受攻击并被攻入的开放计算机系统，这使得研究者可以分析该系统上的恶意行为。</p>
<p>我们已经在惠灵顿的维多利亚大学建立起这样的系统来研究发生于新西兰大学网络上的恶意行为。该系统是一个高度互联的蜜罐，一个攻击者可以像在网络的任何其他系统上一样与之联系。在攻击者可知的范围内，蜜罐与其他计算机系统应该没有可分辨的差别。然而，所有流入和流出蜜罐的网络流量都通过Honeynet联盟的Roo honeywall严密监控。此外，系统事件也被蜜罐自身通过其日志功能进行记录。</p>
<p>蜜罐上运行的是标准RedHad 9服务器配置版本，带有可以通过公共互联网访问的安全外壳（Secure Shell，简称SSH）服务器。SSH是可以使得一个用户在网上通过加密通道登录到另一台电脑的程序。在过去的配置下遭遇到恶意SSH登录企图后，我们重新编配了我们的蜜罐以使其可以收集更多的数据。我们对SSH服务器打了补丁以同时记录在登录企图中使用的帐户名和密码。该蜜罐在2006年7月11日上线，在22天后的2006年8月1日下线。在这期间，该蜜罐受到了无数次的SSH登录企图攻击。我们进一步观察这些数据以确定攻击者的策略并提出提高 SSH安全水平的建议。</p>
<p>在该蜜罐在6月28日到7月4日运行的另一个配置上，我们增加了可以在系统被攻入后记录攻击者键盘操作的Sebek模块。我们设置了若干具有常用密码的用户帐户。几天后，一个攻击者成功进入了这一系统。在本文中给出了对这一攻击及后续攻击的分析，并提供了对恶意SSH登录企图如何被用于攻入系统的进一步分析。</p>
<p>对SSH登录企图的分析</p>
<p>这一部分分析了7月11日到8月1日我们的蜜罐捕获的数据。该分析完全基于蜜罐的系统日志文件，尤其是&quot;messages&quot;日志。&quot;messages&quot;日志记录了对SSH服务器的验证请求。它记录了日期、时间、登录企图发生的IP地址、请求的结果（失败或成功）以及验证使用的帐户名和密码。下面是两个&quot;messages&quot;的日志示例条目：</p>
<p>Jul 13 09:37:59 basta sshd[22308]: PW-ATTEMPT: fritz</p>
<p>Jul 13 09:37:59 basta sshd[22308]: Failed password for root from 10.0.160.14</p>
<p> port 39529 ssh2</p>
<p>Jul 13 09:38:02 basta sshd[22310]: Illegal user fatacunike from 10.0.160.14</p>
<p>Jul 13 09:38:02 basta sshd[22310]: PW-ATTEMPT: fatacunike</p>
<p>Jul 13 09:38:02 basta sshd[22310]: Failed password for illegal user fatacunike</p>
<p> from 10.0.160.14 port 40444 ssh2</p>
<p>首先，我们分析了用于登录企图的用户名。在取样时间内，系统日志总共记录到2741 个不同的帐户名，包括从常见的姓氏、系统帐户名和常用帐户名到短的字符串。在这些帐户名中，15个使用频率最高的帐户名被列于表1。该表格显示有一个系统上通常存在的帐户（root，mysql）、可能存在的帐户（guest、test）以及常见的姓氏（paul）。随后图1给出了所使用过的有效与无效帐户名的分布。</p>
<p>所使用的无效帐户名远多于有效帐户名并不奇怪，但是我们注意到在蜜罐上存在的所有默认帐户名中96.30%都被攻击利用。</p>
<p><img src="" alt=""></p>
<p>表1 2741次攻击中出现最多的15个帐户名</p>
<p><img src="" alt=""></p>
<p>（Number of Account Names Used in Attack：攻击中使用的帐户名数量；</p>
<p>Number of Account Names on System：系统中的帐户名数量</p>
<p>Existing Account：有效帐户</p>
<p>Invalid Account：无效帐户）</p>
<p>图1 有效与无效帐户名数量</p>
<p>&quot;成功&quot;的恶意SSH登录企图</p>
<p>在上面的部分中，我们分析了对于没有成功的恶意SSH登录企图数据的记录。这些数据可以使我们进一步理解这些攻击者如何操作，但是还有很多问题没有解决，其中之一是这些攻击中是否使用了工具软件。</p>
<p>7月2日，有一名攻击者通过猜测出一个SSH上的有效帐户名/密码成功地侵入了蜜罐。在这一事件中捕获的数据揭示了这些问题的答案。</p>
<p>首先我们观察了该黑客成功入侵蜜罐后进行的操作。确定了有效的帐户名/密码后，该黑客通过SSH登入蜜罐并继而下载了一个SSH扫描工具。在下面一节将更详细地介绍该工具，这里我们先将其总结为一个可以允许其使用者通过猜测密码的尝试识别并入侵其它SSH服务器的工具。这一工具安装后立刻被用来从我们的蜜罐中扫描B类网络。由于Roo honeywall对于向网络外部的连接施加的限制，该SSH扫描工具并未发现任何SSH服务器。</p>
<p>在最初的扫描后，攻击者继续下载并安装一个IRC僵尸（IRC Bot）。IRC僵尸是可以在远程通过IRC聊天通道控制一个被入侵的系统的工具，其中被入侵的系统被设定为可以通过该通道被监听。使用IRC来控制一个被入侵的系统比直接使用SSH要隐蔽得多，因为此时攻击者不再需要直接登入系统。此外，它还使得攻击者可以同时控制多个这样的系统（它们被称为 Zombies，还魂尸)。</p>
<p>IRC通道中的会话表明，Zombies被用于使用类似于被下载到我们的蜜罐上那样的SSH扫描工具扫描B类网络。在几个小时的时间里，有4个B类网络被来自不同IRC僵尸的SSH扫描工具扫描。一次扫描大约需要700秒的时间完成。此外，我们还目睹了一个帐户名/密码列表与160,324个不同的帐户名/密码组合之间的信息交换。这些帐户名与密码的结构与对我们的蜜罐系统进行攻击时使用的那些非常相似，但比它们范围更广。</p>
<p>分析总结</p>
<p>从这些被我们的蜜罐记录的数据中我们可以得到什么？SSH是一种可以通过安全、加密的方式在网络中访问一台电脑的方法，已经被广泛接受。然而，尽管其在安全方面名誉很好，在一台电脑上操作SSH仍然会面临威胁。如我们在本文中所示的那样，密码猜测显然是威胁之一。仅SSH服务器正在运行并可经互联网连接这一事实就吸引了23次来自独立IP的攻击，在22天内我们的蜜罐共受到6,899 次登录企图。这相当于大约平均每天1次攻击、约300次登录尝试。一些攻击者的攻击非常执着，在每次攻击中执行了上百次登录尝试。</p>
<p>扫描工具的数据记录显示有非常强有力的工具被使用。它们十分灵活并且可以使用用户定制的帐户名/密码列表进行攻击。如果一个攻击者想攻击一个特定的域，他们或许可以通过社会工程获取帐户名，然而将这些帐户名于将在攻击中使用的标准密码组合。通过观察一个IRC僵尸通道，我们发现攻击者们将扫描工具与IRC僵尸计数结合来通过Zombies（攻击者通过远程通道控制的被入侵的系统）进行扫描。</p>
<p>与一系列IRC僵尸结合后，一个攻击者只需要525个Zombies就可以在1天内扫描当今公共互联网的整个IP4。如果你有一个可以被公开访问的SSH服务器，你很可能就会成为这些攻击的目标。</p>
<p>安全建议</p>
<p>有很多简单的方法可以防范这些攻击。最显而易见的方式就是关闭在很多系统中被默认安装的daemon服务。如果一个计算机系统被作为桌面电脑，很可能没有必要用通过SSH的远程访问登入该电脑。如果该方式对你不适用，还有很多其他的选择：</p>
<p>·使用大多数Unix和Linux系统中的/etc/hosts.allow和/etc/hosts.deny文件限制对特定主机的daemon访问。</p>
<p>·安装一个防火墙以限制只允许指定的电脑与网络访问SSH服务器。这在来自内部网络一台电脑的管理员必须对该电脑远程操作时尤其适用。</p>
<p>·限制SSH服务器只允许经过验证的特定用户和组登录。</p>
<p>·将SSH服务器监听端口从22调整到其他未被使用的端口。尽管这样做不会阻止攻击者连接到服务器并开始猜测密码，但它会显著降低发现你的SSH daemon的可能性，因为黑客使用的是标准SSH客户端而且假定SSH服务器的攻击工具是运行于标准的22端口上的。</p>
<p>·除了简单的密码外使用其他验证方法。下面有关于这点的更多介绍。如果你无法选择这一方法，确保正在使用的密码或验证短语安全程度高而且是比较复杂的。</p>
<p>SSH提供了另一种可以成功地减少密码猜测攻击的验证方法。这一验证方法是基于密钥的，或者说是所谓的私钥与公钥。公钥被置于服务器端作为访问你的帐户的用户锁。该锁只能被对应的私钥开启。一旦你提供了该私钥，你就可以获得访问权限。由于攻击者无法猜测或生成这一私钥，密码猜测攻击将失败。所有流行的SSH服务器默认状态下都被设置为支持这一验证方法。然而，它们通常在提供的私钥错误时重新回到基于密码的验证过程，这再次为密码猜测攻击提供了方便。为使这一降低风险的策略成功，这些服务器需要被重新设定为只接受基于密钥的验证。</p>
<p>建立使用密钥的SSH十分简单，只需要几分钟的时间。先前Brian Hatch的文章已经谈及了关于个人用户和SSH服务器间安全访问的SSH用户身份。SSH主机密钥保护一文中提供了关于每台服务器所生成的主机密钥的更多信息。如果使用SSH密钥，读者可能希望获得更多SSH于ssh-agent的例子以便更快更容易地通过SSH登录。</p>
<p>在一些例子中，对一个SSH服务器基于密码的验证或访问无法被禁用。在这种情况下，需要采用其他措施。我们已经看到攻击者猜测帐户名并且对现有系统的帐户以及在通常的计算机系统中的帐户了如指掌。如果该攻击者可以猜到系统中存在的一个帐户名——对于我们的蜜罐，在Redhat蜜罐系统中96.30%的默认帐户名被猜到——则该攻击者已经在该电脑的门口踏入了一步。因此，我们建议不要使用很容易被猜到的帐户名，例如那些常见的姓氏。不要使用&quot;Peter&quot;、&quot;Ian&quot;、或&quot;Mark&quot;，而是建立包括有姓和名的组合的帐户名，例如 &quot;seifer_chr&quot;。这可以通过控制帐户名分配的管理员做到。</p>
<p>此外，我们已经看到&quot;root&quot;帐户是在攻击中使用最多的帐户名，因为它通常都存在于计算机系统中。我们建议禁用该帐户的远程访问权限，取而代之的是管理员应该先通过一般用户帐户再使用&quot;su&quot;（超级用户指令）获得该root帐户的权限。</p>
<p>攻击者经常试图猜测在大多数系统上默认存在的长湖，例如ftp和mysql。如果 shell外壳与这些帐户关联，那么只有通过这些帐户才能访问外壳。对于ftp或mysql这样其存在只为运行电脑上某服务的帐户，外壳是不需要的并且应该被禁用，这可以有效地阻止通过SSH使用这些帐户远程登录。</p>
<p>除了使用无法被猜到的帐户名外，使用安全性强的用户密码也是很重要的。我们已经看到在攻击中使用的密码通常与帐户名相同或者是帐户名加上一些数列。我们推测攻击者们选择这些密码因为它们在恶意登录企图中是最&quot;成功&quot;的。这表明至少有些用户将他们的密码设置为这些很容易被猜到的字符串。系统管理员阻止用户选用这样的密码的唯一方法是通过安装各种工具软件（例如passwd+）强制用户使用安全性高的密码。</p>
<p>攻击者们正在使用工具进行密码猜测和登录尝试，例如被记录的扫描工具、QT和 55hb。然而，尽管有这些工具存在，由于SSH服务器端内置的对于失败登录企图的故意延迟以及各种网络延迟，登录尝试的最短平均时间也需要约2秒。尽管这提供了对于暴力攻击的防范，对于安全性差的帐户名和密码只需要少数几次尝试与猜测就可以侵入系统。以上所描述的安全措施应该被安装以保证安全工作的广泛与深入。</p>
<p>未来的工作</p>
<p>我们的分析是基于我们的蜜罐捕获的数据进行的。我们无法确定这些攻击对于网络上可以找到的系统成功的概率有多大。为了确定成功率，我们需要将这些攻击中使用的帐户名/密码组合与在真实系统中存在的帐户名/密码组合进行比较。此外，我们提出了将SSH服务器监听端口改到其他未占用的端口。我们需要建立这样配置的系统以评估其有效性。</p>
<p>关于作者</p>
<p>Christian Seifert是新西兰Honeynet联盟的成员。</p>
<p>致谢</p>
<p>感谢Jamie Riden提供降低密码猜测风险的策略以及对实际SSH密码猜测工具的参考。</p>
<p>本篇文章来源于 中国安全网-安全您的网络 原文链接：<a href="http://www.securitycn.net/html/research/service/1395.html" target="_blank">http://www.securitycn.net/html/research/service/1395.html</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span></span> | <span class="tags">Tagged <a href="/tags/安全/" class="label label-primary">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全--黑客经典之恶意SSH登录企图分析/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全--黑客经典之恶意SSH登录企图分析" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--casclient使用指南-老老-ITeye技术网站/">cas client使用指南 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--casclient使用指南-老老-ITeye技术网站/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas-client-iteye-">cas client使用指南 - 老老 - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">资讯</a> <a href="http://www.iteye.com/magazines" target="_blank">精华</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a> <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://lvyanglin.iteye.com/blog/618081#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://lvyanglin.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://lvyanglin.iteye.com/login" target="_blank">登录</a> <a href="http://lvyanglin.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-http-lvyanglin-iteye-com-"><a href="http://lvyanglin.iteye.com/" target="_blank">老老</a></h1>
<ul>
<li><a href="http://lvyanglin.iteye.com/" target="_blank"><strong>博客</strong></a></li>
<li><a href="http://lvyanglin.iteye.com/weibo" target="_blank">微博</a></li>
<li><a href="http://lvyanglin.iteye.com/album" target="_blank">相册</a></li>
<li><a href="http://lvyanglin.iteye.com/link" target="_blank">收藏</a></li>
<li><a href="http://lvyanglin.iteye.com/blog/guest_book" target="_blank">留言</a></li>
<li><a href="http://lvyanglin.iteye.com/blog/profile" target="_blank">关于我</a></li>
</ul>
<h3 id="-cas-client-"><a href="">cas client使用指南</a> **</h3>
<p><strong>博客分类：</strong></p>
<ul>
<li><a href="http://lvyanglin.iteye.com/category/67638" target="_blank">java</a>
<a href="http://www.iteye.com/blogs/tag/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8" target="_blank">企业应用</a><a href="http://www.iteye.com/blogs/tag/SSO" target="_blank">SSO</a><a href="http://www.iteye.com/blogs/tag/SQL%20Server" target="_blank">SQL Server</a><a href="http://www.iteye.com/blogs/tag/%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank">应用服务器</a><a href="http://www.iteye.com/blogs/tag/Spring" target="_blank">Spring</a> </li>
</ul>
<p>2008-02-27
JA-SIG（CAS）学习笔记3
关键字: cas sso 统一身份认证 java ja-sig
技术背景知识：
  JA-SIG CAS服务环境搭建，请参考 ：JA-SIG（CAS）学习笔记1 
  JA-SIG CAS业务架构介绍，请参考 ：JA-SIG（CAS）学习笔记2
  HTTPS所涉及的Java安全证书知识，请参考 ：Java  keytool 安全证书学习笔记
CAS技术框架
  CAS  Server
    目前，我们使用的CAS Server 3.1.1的是基于Spring Framework编写的，因此在CAS服务器端的配置管理中，绝大多数是Spring式的Java Bean XML配置。CAS 的服务器提供了一套易于定制的用户认证器接口，用户可以根据自身企业的在线系统的认证方式，来定制自己的认证逻辑。不论是传统的用户名/密码方式，还是基于安全证书的方式；是基于关系数据库的存储，还是采用LDAP服务器，CAS  Server给我们提供了这些常用的验证器模板代码，只要稍作修改，便可灵活使用了。
    对于广大的中国企业用户而言，另一个需要定制的功能莫过于全中文、企业特色的用户身份认证页面了。CAS Server提供了两套系统界面，一套是默认的CAS英文标准页面，另一套则是专门提供给用户来定制修改的。（PS：老外们做事情就是人性化啊~~）那么对CAS Server端的后续学习，我们将围绕着身份认证模块定制和界面定制这两方面展开。
  CAS  Client
    客户端我们使用的是CAS Client 2.1.1。虽然在官方网站上已出现了3.1.0版本的下载，但该版本地代码已经完全重写，使用的package和类名同2.1.1大相径庭了，最关键的是，该版本暂时没有对应的API说明文档。虽然咖啡我对程序版本怀有极大的“喜新厌旧”的心态，但安全起见，还是先2.1.1吧，相信3.1.0的文档耶鲁大学的大牛们已经在整理了，期待中……
CAS Client2.1.1.jar中的代码是相当精炼的，有兴趣的朋友建议阅读一下源码。Jar包中的代码分成三个大部分</p>
<ol>
<li>edu.yale.its.tp.cas.util 包，其中只有一个工具类 SecureURL.java 用来访问HTTPS URL</li>
<li>edu.yale.its.tp.cas.proxy包，用来处理Proxy Authentication代理认证的3个类，其中ProxyTicketReceptor.java是 接收PGT回调的servlet，在下文中我们会提及。</li>
<li>edu.yale.its.tp.cas.client包，其中包含了CAS Filter ，Tag Library等主要的认证客户端工具类，我们在后面会进行重点介绍。
针对CAS Client的学习，我们的重点将放在CAS Filter 和ProxyTicketReceptor 的配置以及在Java SE环境下，直接使用 ServiceTicketValidator进行Ticket认证实现上。
CAS服务器端应用
定制适合你的身份认证程序
通过前面的学习，我们了解了CAS具有一个良好而强大的SSO功能框架。接下来，我们要学习如何将实际企业应用中的身份认证同CAS进行整合。
简单的说，要将现有企业应用中的认证集成到CAS Server中，只要实现一个名为AuthenticationHandler的一个认证处理Java接口就行。以下是该接口的源代码：
Java代码
public interface AuthenticationHandler {<br>//<em>/</em> 
/<em> 该方法决定一个受支持的credentials是否是可用的， 
/</em> 如果可用，该方法返回true，则说明身份认证通过 
/<em>/ 
boolean  authenticate(Credentials credentials)  throws  AuthenticationException;<br>//</em>/<em> 
/</em> 该方法决定一个credentials是否是当前的handle所支持的 
/<em>/ 
boolean  supports(Credentials credentials);<br>} 
public interface AuthenticationHandler {
//</em>/<em>
/</em> 该方法决定一个受支持的credentials是否是可用的，
/<em> 如果可用，该方法返回true，则说明身份认证通过
/</em>/
boolean  authenticate(Credentials credentials)  throws  AuthenticationException;
//<em>/</em>
/<em> 该方法决定一个credentials是否是当前的handle所支持的
/</em>/
boolean  supports(Credentials credentials);
}
这里我们要说明一下Credentials这个CAS的概念。所谓Credentials是由外界提供给CAS来证明自身身份的信息，简单的如一个用户名/密码对就是一个Credentials，或者一个经过某种加密算法生成的密文证书也可以是一个Credentials。在程序的实现上，Credentials被声明为一个可序列化的接口，仅仅起着标识作用，源代码如下：
Java代码
public interface Credentials extends Serializable {<br>// marker interface contains no methods<br>} 
public interface Credentials extends Serializable {
// marker interface contains no methods
}
CAS的API中，已经为我们提供了一个最常用的实现UsernamePasswordCredentials  用户名/密码凭证，代码如下：
Java代码
public class UsernamePasswordCredentials implements Credentials {<br>//<em>/</em> Unique ID for serialization. /<em>/ 
private static final long serialVersionUID = -8343864967200862794L;<br>//</em>/<em> The username. /</em>/ 
private String username;<br>//<em>/</em> The password. /*/ 
private String password;<br>public final String getPassword() {<br>   return this.password;<br>}<br>public final void setPassword(final String password) {<br>   this.password = password;<br>}<br>public final String getUsername() {<br>   return this.username;<br>}<br>public final void setUsername(final String userName) {<br>   this.username = userName;<br>}<br>public String toString() {<br>   return this.username;<br>}<br>public boolean equals(final Object obj) {<br>   if (obj == null || !obj.getClass().equals(this.getClass())) {  <pre><code>   return false;  
</code></pre>   }<br>   final UsernamePasswordCredentials c = (UsernamePasswordCredentials) obj;<br>   return this.username.equals(c.getUsername())  <pre><code>   &amp;&amp; this.password.equals(c.getPassword());  
</code></pre>}<br>public int hashCode() {<br>   return this.username.hashCode() ^ this.password.hashCode();<br>}<br>} 
public class UsernamePasswordCredentials implements Credentials {
//<em>/</em> Unique ID for serialization. /<em>/
private static final long serialVersionUID = -8343864967200862794L;
//</em>/<em> The username. /</em>/
private String username;
//<em>/</em> The password. /*/
private String password;
public final String getPassword() {
   return this.password;
}
public final void setPassword(final String password) {
   this.password = password;
}
public final String getUsername() {
   return this.username;
}
public final void setUsername(final String userName) {
   this.username = userName;
}
public String toString() {
   return this.username;
}
public boolean equals(final Object obj) {
   if (obj == null || !obj.getClass().equals(this.getClass())) {<pre><code>   return false;
</code></pre>   }
   final UsernamePasswordCredentials c = (UsernamePasswordCredentials) obj;
   return this.username.equals(c.getUsername())<pre><code>   &amp;&amp; this.password.equals(c.getPassword());
</code></pre>}
public int hashCode() {
   return this.username.hashCode() ^ this.password.hashCode();
}
}
很简单不是吗？就是存储一个用户名和密码的java bean而已。
 接下来，我们将一个Credentials传给一个AuthenticationHandler进行认证，首先调用boolean  supports(Credentials credentials)方法察看当前传入的Credentials实例，AuthenticationHandler实例现是否支持它？如果支持，再调用boolean  authenticate(Credentials credentials)方法进行认证。由于用户名/密码方式是最常用的认证方法，因此CAS为我们提供了一个现成的基于该方式的抽象认证处理类AbstractUsernamePasswordAuthenticationHandler。通常我们只需要继承该类，并实现其中的    authenticateUsernamePasswordInternal方法即可。下面我们给出一个Demo的实现类，它的校验逻辑很简单——仅校验用户名的字符长度是否与密码的相等（这里密码是一个表示长度的整数），如果相等则认为认证通过，请看代码：
Java代码
public class UsernameLengthAuthnHandler  <pre><code>              extends AbstractUsernamePasswordAuthenticationHandler {  
</code></pre>protected boolean authenticateUsernamePasswordInternal( UsernamePasswordCredentials credentials)  throws AuthenticationException {<br>//<em><br>/</em> 这里我们完全可以用自己的认证逻辑代替，比如将用户名/密码传入一个SQL语句<br>/<em> 向数据库验证是否有对应的用户账号，这不是我们最经常干的事么？<br>/</em> 只需要将下面的程序替换掉就OK了！！So  easy，so  simple！<br>/<br>String username = credentials.getUsername();<br>String password = credentials.getPassword();<br>String correctPassword = Integer.toString(username.length());<br>return correctPassword.equals(password);<br>}<br>} 
public class UsernameLengthAuthnHandler<pre><code>              extends AbstractUsernamePasswordAuthenticationHandler {
</code></pre>protected boolean authenticateUsernamePasswordInternal( UsernamePasswordCredentials credentials)  throws AuthenticationException {
//<em>
/</em> 这里我们完全可以用自己的认证逻辑代替，比如将用户名/密码传入一个SQL语句
/<em> 向数据库验证是否有对应的用户账号，这不是我们最经常干的事么？
/</em> 只需要将下面的程序替换掉就OK了！！So  easy，so  simple！
/
String username = credentials.getUsername();
String password = credentials.getPassword();
String correctPassword = Integer.toString(username.length());
return correctPassword.equals(password);
}
}
介绍到这里，大家应该清楚如何定制自己的AuthenticationHandler类了吧！这里要附带说明的是，在CAS Server的扩展API中已经提供了大量常用认证形式的实现类，它们同CAS Server的war包一同分发：
cas-server-support-generic-3.1.1.jar ——使用Map记录用户认证信息的实现
cas-server-support-jdbc-3.1.1.jar —— 基于Spring JDBC的数据库实现（我们常用的）
cas-server-support-ldap-3.1.1.jar —— 基于LDAP的用户认证实现
更多其他形式的实现各位看官有兴趣的，可以一一阅读源码。
配置你的身份认证程序
完成了定制认证类的代码编写，接下来就是要让CAS Server来调用它了。在CAS的框架中，对程序的配置都是使用Spring Framework的xml文件，这对于熟悉Spring的程序员而言算驾轻就熟了。
配置文件位于应用部署目录的WEB-INF子目录下——deployerConfigContext.xml。在bean id=authenticationManager 的 authenticationHandlers属性中配置我们的AuthenticationHandlers：
引用
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:p="http://www.springframework.org/schema/p"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
<bean id="authenticationManager"
class="org.jasig.cas.authentication.AuthenticationManagerImpl">
   。。。
   。。。
<property name="authenticationHandlers">
<list>
<bean class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler" p:httpClient-ref="httpClient" />
   &lt;!—下面就是系统默认的验证器配置，你可以替换它，或者增加一个新的handler --&gt;
<bean     class="org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler" />
</list>
</property>
</bean>
。。。
。。。
</beans>
我们发现authenticationHandlers属性是一个list，在这个list中可以配置多个AuthenticationHandlers。这些AuthenticationHandlers形成了一个验证器链，所有提交给CAS的Credentials信息将通过这个验证器链的链式过滤，只要这链中有一个验证器通过了对Credentials的验证，就认为这个Credentials是合法的。这样的设计使得我们可以很轻松的整合不同验证体系的已有应用到同一个CAS上，比如：A验证器负责校验alpha系统提交的Credentials，它是基于LDAP服务器的；B验证器负责校验beta系统提交的Credentials，它是一个传统的RDB用户表认证；C验证器负责校验gamma系统提交的基于RSA证书加密的Credentials。3种完全不同的用户身份认证通过配置就可以统一在同一个CAS服务内，很好很强大，不是吗！！
定制身份验证登录界面
 CAS Server在显示界面层view使用了“主题Theme”的概念。在{project.home}/webapp/WEB-INF/view/jsp/目录下，系统默认提供了两套得UI —— default和simple 。default方案使用了CSS等相对复杂得界面元素，而simple方案提供了最简化的界面表示方式。在整个的CAS Server服务器端，有四个界面是我们必须要实现的：
casConfirmView.jsp —— 确认信息（警告信息）页面
casGenericSuccess.jsp —— 登陆成功提示页面
casLoginView.jsp —— 登录输入页面
casLogoutView.jsp —— SSO登出提示页面
这些都是标准的jsp页面，如何实现他们，完全由您说了算，除了名字不能改。
CAS为view的展示提供了3个级别的定制方式，让我们从最直观简单的开始吧。
1． 采用文件覆盖方式：直接修改default中的页面或者将新写好的四个jsp文件覆盖到default目录中。这种方式最直观和简单，但咖啡建议各位在使用这种方式前将原有目录中的文件备份一下，以备不时之需。
2． 修改UI配置文件，定位UI目录：在CAS Server端/webapp/WEB-INF/classes/ 目录下，有一个名为default_views.properties的属性配置文件，你可以通过修改配置文件中的各个页面文件位置，指向你新UI文件，来达到修改页面展示的目的。
3． 修改配置文件的配置文件，这话看起来有点别扭，其实一点不难理解。在方法2中的default_views.properties文件是一整套的UI页面配置。如果我想保存多套的UI页面配置就可以写多个的properties文件来保存这些配置。在CAS Server端/webapp/WEB-INF/目录下有cas-servlet.xml和cas.properties两个文件，cas-servlet.xml使用了cas.properties文件中的cas.viewResolver.basename属性来定义view属性文件的名字，因此你可以选者直接修改cas-servlet.xml中的viewResolver 下的basenames属性，或者修改cas.properties中的cas.viewResolver.basename属性，指定新的properties文件名，这样可以轻松的替换全套UI。
CAS客户端配置及API应用
CASFilter的配置
对于大部分web应用而言，使用CAS集成统一认证是相对简单的事，只要为需要认证的URL配置edu.yale.its.tp.cas.client.filter.CASFilter认证过滤器。下面我们就针对过滤器的配置进行说明。首先参看一下Filter的基本配置：
引用
<web-app>
...
<filter>
<filter-name>CAS Filter</filter-name>
<filter-class>edu.yale.its.tp.cas.client.filter.CASFilter</filter-class>
<init-param>
  <param-name>edu.yale.its.tp.cas.client.filter.loginUrl</param-name>
  <param-value><a href="https://secure.its.yale.edu/cas/login" target="_blank">https://secure.its.yale.edu/cas/login</a>&lt;;/param-value&gt;
</init-param>
<init-param>
  <param-name>edu.yale.its.tp.cas.client.filter.validateUrl</param-name>
  <param-value><a href="https://secure.its.yale.edu/cas/serviceValidate" target="_blank">https://secure.its.yale.edu/cas/serviceValidate</a>&lt;;/param-value&gt;
</init-param>
<init-param>
  <param-name>edu.yale.its.tp.cas.client.filter.serverName</param-name>
  <param-value>your server name and port (e.g., www.yale.edu:8080)</param-value>
</init-param>
</filter>
<filter-mapping>
<filter-name>CAS Filter</filter-name>
<url-pattern>/requires-cas-authetication//<em></url-pattern>
</filter-mapping>
...
</web-app>
上述配置中的init-param是filter的3个必备的属性，下面这张表则是filter全部属性的详细说明：
ProxyTicketReceptor的配置
大家还记得在前面我们说过的Proxy Authentication中的call back URL吗？ProxyTicketReceptor是部署在client端的一个servlet，提供server端回传PGT和PGTIOU的。它的xml部署如下：
引用
<web-app>
...
<servlet>
<servlet-name>ProxyTicketReceptor</servlet-name>
<servlet-class>edu.yale.its.tp.cas.proxy.ProxyTicketReceptor</servlet-class>
<init-param>
  <param-name>edu.yale.its.tp.cas.proxyUrl</param-name>
  <param-value><a href="https://secure.its.yale.edu/cas/proxy" target="_blank">https://secure.its.yale.edu/cas/proxy</a>&lt;;/param-value&gt;
</init-param>
</servlet>
<servlet-mapping>
<servlet-name>ProxyTicketReceptor</servlet-name>
<url-pattern>/CasProxyServlet</url-pattern>
</servlet-mapping>
...
</webapp>
这里要说明的是它的参数edu.yale.its.tp.cas.proxyUrl。在服务端通过ProxyTicketReceptor将PGT和PGTIOU传给客户端后，ProxyTicketReceptor在进行Proxy Authentication的过程中需要向服务端请求一个ProxyTicket（PT），这个proxyUrl就是服务端的请求入口了。（关于Proxy Authentication的运作原理，参见JA-SIG（CAS）学习笔记2 ）
CAS Client端的API应用1．用户可以通过以下两种方式的任意一种，从JSP或servlet中获取通过认证的用户名：
引用
String username = (String)session.getAttribute(CASFilter.CAS_FILTER_USER);
或者
String username = (String)session.getAttribute(&quot;edu.yale.its.tp.cas.client.filter.user&quot;);
2．获得更完整的受认证用户信息对象CASReceipt Java Bean，可以使用以下语句的任一:
引用
CASReceipt  receipt = (CASReceipt )session.getAttribute(CASFilter.CAS_FILTER_RECEIPT);
或者
CASReceipt  receipt = (CASReceipt )session.getAttribute(&quot;edu.yale.its.tp.cas.client.filter.receipt&quot;);
3．手工编码使用CAS Java Object进行用户验证，使用ServiceTicketValidator或者 ProxyTicketValidator（代理认证模式下），在servlet中对用户身份进行验证。
3-1．ServiceTicketValidator
Java代码
import edu.yale.its.tp.cas.client./</em>;<br>...<br>String user = null;<br>String errorCode = null;<br>String errorMessage = null;<br>String xmlResponse = null;  </li>
</ol>
<p>//<em> instantiate a new ServiceTicketValidator /</em>/ 
ServiceTicketValidator sv = new ServiceTicketValidator();  </p>
<p>//<em> set its parameters /</em>/ 
sv.setCasValidateUrl(&quot;<a href="https://secure.its.yale.edu/cas/serviceValidate" target="_blank">https://secure.its.yale.edu/cas/serviceValidate</a>&quot;);<br>sv.setService(urlOfThisService);<br>sv.setServiceTicket(request.getParameter(&quot;ticket&quot;));   </p>
<p>String urlOfProxyCallbackServlet = &quot;<a href="https://portal.yale.edu/CasProxyServlet" target="_blank">https://portal.yale.edu/CasProxyServlet</a>&quot;;<br>sv.setProxyCallbackUrl(urlOfProxyCallbackServlet);  </p>
<p>//<em> contact CAS and validate /</em>/ 
sv.validate();  </p>
<p>//<em> if we want to look at the raw response, we can use getResponse() /</em>/ 
xmlResponse = sv.getResponse();  </p>
<p>if(sv.isAuthenticationSuccesful()) {<br>  user = sv.getUser();<br>} else {<br>  errorCode = sv.getErrorCode();<br>  errorMessage = sv.getErrorMessage();<br>}<br>  //<em> The user is now authenticated. /</em>/ 
  //<em> If we did set the proxy callback url, we can get proxy tickets with: /</em>/ 
  String urlOfTargetService = &quot;<a href="http://hkg2.its.yale.edu/someApp/portalFeed" target="_blank">http://hkg2.its.yale.edu/someApp/portalFeed</a>&quot;;<br>  String proxyTicket = ProxyTicketReceptor.getProxyTicket( sv.getPgtIou() , urlOfTargetService); 
import edu.yale.its.tp.cas.client./<em>;
...
String user = null;
String errorCode = null;
String errorMessage = null;
String xmlResponse = null;
//</em> instantiate a new ServiceTicketValidator /<em>/
ServiceTicketValidator sv = new ServiceTicketValidator();
//</em> set its parameters /<em>/
sv.setCasValidateUrl(&quot;<a href="https://secure.its.yale.edu/cas/serviceValidate" target="_blank">https://secure.its.yale.edu/cas/serviceValidate</a>&quot;);
sv.setService(urlOfThisService);
sv.setServiceTicket(request.getParameter(&quot;ticket&quot;));
String urlOfProxyCallbackServlet = &quot;<a href="https://portal.yale.edu/CasProxyServlet" target="_blank">https://portal.yale.edu/CasProxyServlet</a>&quot;;
sv.setProxyCallbackUrl(urlOfProxyCallbackServlet);
//</em> contact CAS and validate /<em>/
sv.validate();
//</em> if we want to look at the raw response, we can use getResponse() /<em>/
xmlResponse = sv.getResponse();
if(sv.isAuthenticationSuccesful()) {
  user = sv.getUser();
} else {
  errorCode = sv.getErrorCode();
  errorMessage = sv.getErrorMessage();
}
  //</em> The user is now authenticated. /<em>/
  //</em> If we did set the proxy callback url, we can get proxy tickets with: /<em>/
  String urlOfTargetService = &quot;<a href="http://hkg2.its.yale.edu/someApp/portalFeed" target="_blank">http://hkg2.its.yale.edu/someApp/portalFeed</a>&quot;;
  String proxyTicket = ProxyTicketReceptor.getProxyTicket( sv.getPgtIou() , urlOfTargetService);
3-2．ProxyTicketValidator
Java代码
import edu.yale.its.tp.cas.client./</em>;<br>...<br>String user = null;<br>String errorCode = null;<br>String errorMessage = null;<br>String xmlResponse = null;<br>List proxyList = null;  </p>
<p>//<em> instantiate a new ProxyTicketValidator /</em>/ 
ProxyTicketValidator pv = new ProxyTicketValidator();   </p>
<p>//<em> set its parameters /</em>/ 
pv.setCasValidateUrl(&quot;<a href="https://secure.its.yale.edu/cas/proxyValidate" target="_blank">https://secure.its.yale.edu/cas/proxyValidate</a>&quot;);<br>pv.setService(urlOfThisService);<br>pv.setServiceTicket(request.getParameter(&quot;ticket&quot;));   </p>
<p>String urlOfProxyCallbackServlet = &quot;<a href="https://portal.yale.edu/CasProxyServlet" target="_blank">https://portal.yale.edu/CasProxyServlet</a>&quot;;<br>pv.setProxyCallbackUrl(urlOfProxyCallbackServlet);   </p>
<p>//<em> contact CAS and validate /</em>/ 
pv.validate();  </p>
<p>//<em> if we want to look at the raw response, we can use getResponse() /</em>/ 
xmlResponse = pv.getResponse();   </p>
<p>//<em> read the response /</em>/ 
if(pv.isAuthenticationSuccesful()) {<br>  user = pv.getUser();<br>  proxyList = pv.getProxyList();<br>} else {<br>  errorCode = pv.getErrorCode();<br>  errorMessage = pv.getErrorMessage();<br>  //<em> handle the error /</em>/ 
}<br>//<em> The user is now authenticated. /</em>/<br>//<em> If we did set the proxy callback url, we can get proxy tickets with this method call: /</em>/<br>String urlOfTargetService = &quot;<a href="http://hkg2.its.yale.edu/someApp/portalFeed" target="_blank">http://hkg2.its.yale.edu/someApp/portalFeed</a>&quot;;<br>String proxyTicket = ProxyTicketReceptor.getProxyTicket( pv.getPgtIou() , urlOfTargetService); 
import edu.yale.its.tp.cas.client./<em>;
...
String user = null;
String errorCode = null;
String errorMessage = null;
String xmlResponse = null;
List proxyList = null;
//</em> instantiate a new ProxyTicketValidator /<em>/
ProxyTicketValidator pv = new ProxyTicketValidator();
//</em> set its parameters /<em>/
pv.setCasValidateUrl(&quot;<a href="https://secure.its.yale.edu/cas/proxyValidate" target="_blank">https://secure.its.yale.edu/cas/proxyValidate</a>&quot;);
pv.setService(urlOfThisService);
pv.setServiceTicket(request.getParameter(&quot;ticket&quot;));
String urlOfProxyCallbackServlet = &quot;<a href="https://portal.yale.edu/CasProxyServlet" target="_blank">https://portal.yale.edu/CasProxyServlet</a>&quot;;
pv.setProxyCallbackUrl(urlOfProxyCallbackServlet);
//</em> contact CAS and validate /<em>/
pv.validate();
//</em> if we want to look at the raw response, we can use getResponse() /<em>/
xmlResponse = pv.getResponse();
//</em> read the response /<em>/
if(pv.isAuthenticationSuccesful()) {
  user = pv.getUser();
  proxyList = pv.getProxyList();
} else {
  errorCode = pv.getErrorCode();
  errorMessage = pv.getErrorMessage();
  //</em> handle the error /<em>/
}
//</em> The user is now authenticated. /<em>/
//</em> If we did set the proxy callback url, we can get proxy tickets with this method call: /*/
String urlOfTargetService = &quot;<a href="http://hkg2.its.yale.edu/someApp/portalFeed" target="_blank">http://hkg2.its.yale.edu/someApp/portalFeed</a>&quot;;
String proxyTicket = ProxyTicketReceptor.getProxyTicket( pv.getPgtIou() , urlOfTargetService);
在这里，我们假设上下文环境中的用户已经通过了CAS登录认证，被重定向到当前的servlet下，我们在servlet中获取ticket凭证，servlet的URL对用户身份进行确认。如果上下文参数中无法获取ticket凭证，我们就认为用户尚未登录，那么，该servlet必须负责将用户重定向到CAS的登录页面去。
初战告捷
      到今天为止，我们已经通过JA-SIG学习笔记的1-3部分，对CAS这个开源SSO的框架有了个大体的了解和初步的掌握，希望这些知识能为各位步入CAS殿堂打开一扇的大门。咖啡希望在今后的工作应用中，能同大家一块共同探讨，进一步深入了解CAS。
学无止境。。。。。。
分享到： <a href="&quot;分享到新浪微博&quot;"><img src="" alt=""></a> <a href="&quot;分享到腾讯微博&quot;"><img src="" alt=""></a></p>
<p><a href="http://lvyanglin.iteye.com/blog/622656" title="cas-server-3.3.2  使用举例" target="_blank">cas-server-3.3.2 使用举例</a> | <a href="http://lvyanglin.iteye.com/blog/615166" title="cas 服务器端的配置" target="_blank">cas 服务器端的配置</a></p>
<ul>
<li>2010-03-17 14:56</li>
<li>浏览 770</li>
<li><a href="http://lvyanglin.iteye.com/blog/618081#comments" target="_blank">评论(0)</a></li>
<li>分类:<a href="http://www.iteye.com/blogs/category/language" target="_blank">编程语言</a></li>
<li><a href="http://www.iteye.com/wiki/blog/618081" target="_blank">相关推荐</a></li>
</ul>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<h3 id="-">发表评论</h3>
<p><a href="http://lvyanglin.iteye.com/login" target="_blank"><img src="" alt=""></a><a href="http://lvyanglin.iteye.com/login" target="_blank">您还没有登录,请您登录后再发表评论</a></p>
<p><a href="http://lvyanglin.iteye.com/" target="_blank"><img src="&quot;lvyanglin的博客: 老老&quot;" alt="lvyanglin的博客"></a></p>
<p>lvyanglin</p>
<ul>
<li>浏览: 11625 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 广州</li>
<li><img src="" alt=""><h3 id="-http-lvyanglin-iteye-com-blog-user_visits-">最近访客 <a href="http://lvyanglin.iteye.com/blog/user_visits" target="_blank">更多访客&gt;&gt;</a></h3>
</li>
</ul>
<p><a href="http://shangyue1110.iteye.com/" target="_blank"><img src="&quot;shangyue1110的博客: &quot;" alt="shangyue1110的博客"></a></p>
<p><a href="http://shangyue1110.iteye.com/" title="shangyue1110" target="_blank">shangyue1110</a></p>
<p><a href="http://dylinshi126.iteye.com/" target="_blank"><img src="&quot;dylinshi126的博客: &quot;" alt="dylinshi126的博客"></a></p>
<p><a href="http://dylinshi126.iteye.com/" title="dylinshi126" target="_blank">dylinshi126</a>
<a href="http://dada7020.iteye.com/" target="_blank"><img src="&quot;dada7020的博客: &quot;" alt="dada7020的博客"></a></p>
<p><a href="http://dada7020.iteye.com/" title="dada7020" target="_blank">dada7020</a></p>
<p><a href="http://k175981998.iteye.com/" target="_blank"><img src="&quot;k175981998的博客: &quot;" alt="k175981998的博客"></a></p>
<p><a href="http://k175981998.iteye.com/" title="k175981998" target="_blank">k175981998</a></p>
<h3 id="-">文章分类</h3>
<ul>
<li><a href="http://lvyanglin.iteye.com/" target="_blank">全部博客 (35)</a></li>
<li><a href="http://lvyanglin.iteye.com/category/67638" target="_blank">java (20)</a></li>
<li><a href="http://lvyanglin.iteye.com/category/67639" target="_blank">数据库 (5)</a></li>
<li><a href="http://lvyanglin.iteye.com/category/67640" target="_blank">其他 (5)</a></li>
<li><a href="http://lvyanglin.iteye.com/category/187499" target="_blank">在centsos上安装chrome (1)</a></li>
<li><a href="http://lvyanglin.iteye.com/category/194903" target="_blank">centos 安装 (1)</a></li>
<li><p><a href="http://lvyanglin.iteye.com/category/220785" target="_blank">学习linux (0)</a></p>
<h3 id="-">社区版块</h3>
</li>
<li><p><a href="http://lvyanglin.iteye.com/blog/news" target="_blank">我的资讯</a> (0)</p>
</li>
<li><a href="http://lvyanglin.iteye.com/blog/post" target="_blank">我的论坛</a> (0)</li>
<li><a href="http://lvyanglin.iteye.com/blog/answered_problems" target="_blank">我的问答</a> (1)</li>
</ul>
<h3 id="-">存档分类</h3>
<ul>
<li><a href="http://lvyanglin.iteye.com/blog/monthblog/2011-12" target="_blank">2011-12</a> (2)</li>
<li><a href="http://lvyanglin.iteye.com/blog/monthblog/2011-11" target="_blank">2011-11</a> (1)</li>
<li><a href="http://lvyanglin.iteye.com/blog/monthblog/2011-05" target="_blank">2011-05</a> (2)</li>
<li><p><a href="http://lvyanglin.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">最新评论</h3>
</li>
<li><p><a href="http://403577706.iteye.com/" title="403577706" target="_blank">403577706</a>： sudo apt-get build-dep /#(packag ...
<a href="http://lvyanglin.iteye.com/blog/800337#bc2250038" target="_blank">sudo apt-get -f install</a>
声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2011 ITeye.com. All rights reserved. [ 京ICP证110151号 京公网安备110105010620 ]
<img src="" alt=""></p>
</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--casclient使用指南-老老-ITeye技术网站/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--casclient使用指南-老老-ITeye技术网站" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/89/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/87/">87</a></li><li><a class="page-number" href="/page/88/">88</a></li><li><a class="page-number" href="/page/89/">89</a></li><li class="active"><li><span class="page-number current">90</span></li><li><a class="page-number" href="/page/91/">91</a></li><li><a class="page-number" href="/page/92/">92</a></li><li><a class="page-number" href="/page/93/">93</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/91/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 17:28:50</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
