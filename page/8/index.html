
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 8 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-ftp--ValidateXMLusingaXSD/">Validate XML using a XSD</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-ftp--ValidateXMLusingaXSD/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="validate-xml-using-a-xsd">Validate XML using a XSD</h1>
<p>1、xsd文件源;</p>
<p>SchemaFactory: newSchema(Source schema)</p>
<p>//<em>    Parser object is: com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl@c9ba38    Start document:     Start element: local name: PHONEBOOK qname: PHONEBOOK uri:     Characters:       Start element: local name: PERSON qname: PERSON uri:     Characters:        Start element: local name: NAME qname: NAME uri:     Attributes:      Name : firstName      Type : CDATA      Value: Joe      Name : lastName      Type : CDATA      Value: Yin    Characters: Joe    Characters:  Yin    End element: local name: NAME qname: NAME uri:     Characters:        Start element: local name: EMAIL qname: EMAIL uri:     Characters: joe@yourserver.com    End element: local name: EMAIL qname: EMAIL uri:     Characters:        Start element: local name: TELEPHONE qname: TELEPHONE uri:     Characters: 202-999-9999    End element: local name: TELEPHONE qname: TELEPHONE uri:     Characters:        Start element: local name: WEB qname: WEB uri:     Characters: www.java2s.com    End element: local name: WEB qname: WEB uri:     Characters:       End element: local name: PERSON qname: PERSON uri:     Characters:       End element: local name: PHONEBOOK qname: PHONEBOOK uri:     End document:      /</em>/    <strong>import </strong>java.io.StringReader;    <strong>import </strong>javax.xml.XMLConstants;    <strong>import </strong>javax.xml.parsers.ParserConfigurationException;    <strong>import </strong>javax.xml.parsers.SAXParser;    <strong>import </strong>javax.xml.parsers.SAXParserFactory;    <strong>import </strong>javax.xml.transform.sax.SAXSource;    <strong>import </strong>javax.xml.validation.SchemaFactory;    <strong>import </strong>org.xml.sax.Attributes;    <strong>import </strong>org.xml.sax.InputSource;    <strong>import </strong>org.xml.sax.SAXException;    <strong>import </strong>org.xml.sax.SAXParseException;    <strong>import </strong>org.xml.sax.helpers.DefaultHandler;    <strong>public class </strong>MainClass {      <strong>public static **</strong>void <strong>main(String args[])</strong>throws <strong>Exception {        SAXParserFactory spf = SAXParserFactory.newInstance();        SAXParser parser = </strong>null<strong>;        spf.setNamespaceAware(</strong>true<strong>);        </strong>try <strong>{         SchemaFactory sf =                         SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);          spf.setSchema(sf.newSchema(</strong>new <strong>SAXSource(</strong>new <strong>InputSource(</strong>new <strong>StringReader(schemaString)))));         parser = spf.newSAXParser();        }        </strong>catch<strong>(SAXException e) {          e.printStackTrace(System.err);          System.exit(1);            }         </strong>catch<strong>(ParserConfigurationException e) {          e.printStackTrace(System.err);          System.exit(1);            }        MySAXHandler handler = </strong>new <strong>MySAXHandler();         System.out.println(schemaString);        parser.parse(</strong>new <strong>InputSource(</strong>new <strong>StringReader(xmlString)), handler);      }      </strong>static <strong>String xmlString = &quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;&quot; +          &quot;<note>&quot; +          &quot;<to>rtoName</to>&quot; +          &quot;<from>FromName</from>&quot; +          &quot;<heading>Info</heading>&quot; +          &quot;<body>Message Body</body>&quot; +          &quot;</note>&quot;;            </strong>static <strong>String schemaString =&quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;&quot; +          &quot;<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"" +          " targetNamespace=\"http://www.java2s.com\"" +          " xmlns=\"http://www.java2s.com\"" +          " elementFormDefault=\"qualified\">&quot; +          &quot;<xs:element name=\"note\">&quot; +          &quot;<xs:complexType>&quot; +          &quot;<xs:sequence>&quot; +          &quot;<xs:element name=\"to\" type=\"xs:string\"/>&quot; +          &quot;<xs:element name=\"from\" type=\"xs:string\"/>&quot; +          &quot;<xs:element name=\"heading\" type=\"xs:string\"/>&quot; +          &quot;<xs:element name=\"body\" type=\"xs:string\"/>&quot; +          &quot;</xs:sequence>&quot; +                          &quot;</xs:complexType>&quot; +                          &quot;</xs:element>&quot; +                          &quot;</xs:schema>&quot;;    }    </strong>class <strong>MySAXHandler </strong>extends <strong>DefaultHandler {      </strong>public <strong>**void </strong>startDocument() {        System.out.println(&quot;Start document: &quot;);      }            <strong>public **</strong>void <strong>endDocument()  {        System.out.println(&quot;End document: &quot;);      }            </strong>public <strong>**void </strong>startElement(String uri, String localName, String qname,                                                                    Attributes attr)      {        System.out.println(&quot;Start element: local name: &quot; + localName + &quot; qname: &quot;                                                             + qname + &quot; uri: &quot;+uri);        <strong>int </strong>attrCount = attr.getLength();        <strong>if</strong>(attrCount&gt;0) {          System.out.println(&quot;Attributes:&quot;);           <strong>for</strong>(<strong>int </strong>i = 0 ; i&lt;attrCount ; i++) {            System.out.println(&quot;  Name : &quot; + attr.getQName(i));             System.out.println(&quot;  Type : &quot; + attr.getType(i));             System.out.println(&quot;  Value: &quot; + attr.getValue(i));           }        }       }            <strong>public **</strong>void <strong>endElement(String uri, String localName, String qname) {        System.out.println(&quot;End element: local name: &quot; + localName + &quot; qname: &quot;                                                             + qname + &quot; uri: &quot;+uri);      }            </strong>public <strong>**void </strong>characters(<strong>char</strong>[] ch, <strong>int </strong>start, <strong>int </strong>length) {        System.out.println(&quot;Characters: &quot; + <strong>new </strong>String(ch, start, length));      }      <strong>public **</strong>void <strong>ignorableWhitespace(</strong>char<strong>[] ch, </strong>int <strong>start, </strong>int <strong>length) {        System.out.println(&quot;Ignorable whitespace: &quot; + </strong>new <strong>String(ch, start, length));      }      </strong>public <strong>**void </strong>startPrefixMapping(String prefix, String uri) {        System.out.println(&quot;Start \&quot;&quot; + prefix + &quot;\&quot; namespace scope. URI: &quot; + uri);       }      <strong>public **</strong>void <strong>endPrefixMapping(String prefix) {        System.out.println(&quot;End \&quot;&quot; + prefix + &quot;\&quot; namespace scope.&quot;);       }      </strong>public <strong>**void </strong>warning(SAXParseException spe) {        System.out.println(&quot;Warning at line &quot;+spe.getLineNumber());        System.out.println(spe.getMessage());      }      <strong>public **</strong>void <strong>fatalError(SAXParseException spe) </strong>throws <strong>SAXException {        System.out.println(&quot;Fatal error at line &quot;+spe.getLineNumber());        System.out.println(spe.getMessage());        </strong>throw **spe;      }    }</p>
<p><a href="http://www.java2s.com/Code/JavaAPI/javax.xml.validation/SchemaFactorynewSchemaSourceschema.htm" target="_blank">http://www.java2s.com/Code/JavaAPI/javax.xml.validation/SchemaFactorynewSchemaSourceschema.htm</a></p>
<p>另外，可参考：</p>
<p>import java.io.IOException; // SAX import javax.xml.parsers.SAXParser; import javax.xml.parsers.SAXParserFactory; import org.xml.sax.XMLReader; //SAX and external XSD import javax.xml.transform.Source; import javax.xml.transform.stream.StreamSource; import javax.xml.validation.SchemaFactory; import javax.xml.parsers.ParserConfigurationException; import org.xml.sax.ErrorHandler; import org.xml.sax.SAXException; import org.xml.sax.SAXParseException; import org.xml.sax.InputSource; public class XMLUtils {   private XMLUtils() {}      // validate SAX and external XSD    public static boolean validateWithExtXSDUsingSAX(String xml, String xsd)    throws ParserConfigurationException, IOException    {     try {       SAXParserFactory factory = SAXParserFactory.newInstance();      factory.setValidating(false);        factory.setNamespaceAware(true);       SchemaFactory schemaFactory = SchemaFactory.newInstance(&quot;<a href="http://www.w3.org/2001/XMLSchema" target="_blank">http://www.w3.org/2001/XMLSchema</a>&quot;);       SAXParser parser = null;       try {          factory.setSchema(schemaFactory.newSchema(new Source[] {new StreamSource( xsd )}));          parser = factory.newSAXParser();       }       catch (SAXException se) {         System.out.println(&quot;SCHEMA : &quot; + se.getMessage());  // problem in the XSD itself         return false;       }              XMLReader reader = parser.getXMLReader();       reader.setErrorHandler(           new ErrorHandler() {             public void warning(SAXParseException e) throws SAXException {               System.out.println(&quot;WARNING: &quot; + e.getMessage()); // do nothing             }             public void error(SAXParseException e) throws SAXException {               System.out.println(&quot;ERROR : &quot; + e.getMessage());               throw e;             }             public void fatalError(SAXParseException e) throws SAXException {               System.out.println(&quot;FATAL : &quot; + e.getMessage());               throw e;             }           }           );       reader.parse(new InputSource(xml));       return true;     }         catch (ParserConfigurationException pce) {       throw pce;     }      catch (IOException io) {       throw io;     }     catch (SAXException se){       return false;   } } public static void main (String args[]) throws Exception{      System.out.println         (XMLUtils.validateWithExtXSDUsingSAX             (&quot;c:/temp/howto.xml&quot;, &quot;c:/temp/howto.xsd&quot;));     //<em>       output :                true     /</em>/              } }</p>
<p><a href="http://www.rgagnon.com/javadetails/java-0669.html" target="_blank"><a href="http://www.rgagnon.com/javadetails/java-0669.html">http://www.rgagnon.com/javadetails/java-0669.html</a></a></p>
<p>IBM教程上有这个，但是我测试失败：</p>
<p><a href="http://www.ibm.com/developerworks/cn/xml/tips/x-tipvalschm/#ibm-pcon"></a></p>
<h2 id="sax-">SAX 示例</h2>
<p><a href="http://www.ibm.com/developerworks/cn/xml/tips/x-tipvalschm/#code2" target="_blank">清单 2</a>演示了如何使用 JAXP 1.2 中的新特性，通过 SAX 解析器来验证文档。要使用 SAX 解析器来验证文档，请执行以下操作：</p>
<ol>
<li>创建一个          </li>
</ol>
<p>SAXParserFactory
对象。</p>
<ol>
<li>将 namespace-aware 和 validating 特性设置为 true。</li>
<li>获取          </li>
</ol>
<p>SAXParser
对象。</p>
<ol>
<li>设置模式语言和模式源的特性（这是 JAXP 1.2 和模式中新出现的）。</li>
<li>解析文档。解析器必须有权访问          </li>
</ol>
<p>ErrorHandler
对象。</p>
<h3 id="-2-validatesax-java-jaxp-1-2">清单 2. ValidateSAX.java 演示了 JAXP 1.2</h3>
<p>package org.ananas.tips; import java.io./<em>; import org.xml.sax./</em>; import javax.xml.parsers./*; public class ValidateSAX {    public static String SCHEMA_LANGUAGE =       &quot;<a href="http://java.sun.com/xml/jaxp/properties/schemaLanguage" target="_blank">http://java.sun.com/xml/jaxp/properties/schemaLanguage</a>&quot;,                         XML_SCHEMA =       &quot;<a href="http://www.w3.org/2001/XMLSchema" target="_blank">http://www.w3.org/2001/XMLSchema</a>&quot;,                         SCHEMA_SOURCE =       &quot;<a href="http://java.sun.com/xml/jaxp/properties/schemaSource" target="_blank">http://java.sun.com/xml/jaxp/properties/schemaSource</a>&quot;;    public final static void main(String[] args)       throws IOException, SAXException, ParserConfigurationException    {       if(args.length &lt; 2)       {          System.err.println(&quot;usage is:&quot;);          System.err.println(&quot;   java -jar tips.jar -validatesax &quot;                             + &quot;input.xml schema.xsd&quot;);          return;       }       File input = new File(args[0]),            schema = new File(args[1]);       SAXParserFactory factory = SAXParserFactory.newInstance();       factory.setNamespaceAware(true);       factory.setValidating(true);       SAXParser parser = factory.newSAXParser();       try       {          parser.setProperty(SCHEMA_LANGUAGE,XML_SCHEMA);          parser.setProperty(SCHEMA_SOURCE,schema);       }       catch(SAXNotRecognizedException x)       {          System.err.println(&quot;Your SAX parser is not JAXP 1.2 compliant.&quot;);       }       parser.parse(input,new ErrorPrinter());    } }</p>
<p><a href="http://www.ibm.com/developerworks/cn/xml/tips/x-tipvalschm/" target="_blank"><a href="http://www.ibm.com/developerworks/cn/xml/tips/x-tipvalschm/">http://www.ibm.com/developerworks/cn/xml/tips/x-tipvalschm/</a></a></p>
<p>有时间到话，可以在测试。</p>
<p>列下jaxp 1.2教程：</p>
<p>This release includes XML data and example programs showing how to use JAXP  to process XML. Additional examples can be found on the <a href="http://xml.apache.org" target="_blank"><a href="http://xml.apache.org">http://xml.apache.org</a></a> site.</p>
<ul>
<li><a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/docs/samples.html#files" target="_blank">Sample XML Files</a></li>
<li><a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/docs/samples.html#DOMEcho" target="_blank">Printing a DOM Tree</a></li>
<li><a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/docs/samples.html#SAXTagCount" target="_blank">SAX Program to Count Tags</a></li>
<li><a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/docs/samples.html#Schema" target="_blank">Schema Examples</a></li>
</ul>
<p>The example programs include a cross-platform <a href="http://jakarta.apache.org/ant/index.html" target="_blank">ant</a> build file that can be used to build and run the example. Ant is a build tool similar to</p>
<p>make
on Unix and</p>
<p>nmake
on WindowsNT that is also an XML application. To use <a href="http://jakarta.apache.org/ant/index.html" target="_blank">ant</a>, download it from the<a href="http://jakarta.apache.org/site/binindex.html" target="_blank">website</a> and read the install docs. Alternatively, you can also view the ant</p>
<p>build.xml
file to see what needs to be done to manually compile and run an example program on your platform.
<strong>Note:</strong>
 The ant utility uses the value of the</p>
<p>JAVA_HOME
environment  variable to determine which Java platform it uses to compile and run the  sample scripts. Make sure that variable points to the version you intend to  use. If using version 1.4, make sure that the JAXP jar files are installed,  as described in the <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/docs/ReleaseNotes.html" target="_blank">Release Notes.</a></p>
<p><a href=""></a></p>
<h3 id="sample-xml-files">Sample XML Files</h3>
<p>A handful of sample XML files have been provided in the &quot;samples&quot; subdirectory.  Note that the links may not work depending on your browser environment. Please  look in ../samples/data if the links do not display in your browser.</p>
<ul>
<li>A simple <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/book-order.xml" target="_blank">Purchase Order</a>    (</li>
</ul>
<p>book-order.xml
) suggesting how an on-line business might    send and receive data.</p>
<ul>
<li>The original <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/REC-xml-19980210.xml" target="_blank">XML    specification</a> (</li>
</ul>
<p>REC-xml-19980210.xml
) was written in XML.    With a prepublication version of <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/spec.dtd" target="_blank">its    Document Type Definition (DTD) file</a> (</p>
<p>spec.dtd
), it&#39;s    included here as a rather sophisticated example of how DTDs are used.</p>
<ul>
<li>Courtesy of Fuji Xerox, a short XML file in Japanese, using Japanese    tags. This is a <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/weekly-euc-jp.xml" target="_blank">weekly    report</a> (</li>
</ul>
<p>weekly-euc-jp.xml
) with <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/weekly-euc-jp.dtd" target="_blank">its DTD</a>    (</p>
<p>weekly-euc-jp.dtd
), which can be validated.</p>
<ul>
<li>From a large collection of XML sample documents at the <a href="ftp://sunsite.unc.edu/pub/sun-info/standards/xml/eg/">sunsite.unc.edu</a>    FTP server, <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/two_gent.xml" target="_blank">The Two Gentlemen of    Verona</a> (</li>
</ul>
<p>two_gent.xml
) and <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/rich_iii.xml" target="_blank">The Tragedy of Richard the Third</a>    (</p>
<p>rich_iii.xml
). These include <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/play.dtd" target="_blank">their DTD</a>  (</p>
<p>play.dtd
).</p>
<ul>
<li>A simple example showing the use of <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/namespace.xml" target="_blank">XML namespaces</a>    (</li>
</ul>
<p>namespace.xml
).</p>
<ul>
<li>A <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/personal-schema.xml" target="_blank">personal-schema.xml</a>    file containing some data that can be validated using its schema    definition, <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/personal.xsd" target="_blank">personal.xsd</a>.</li>
</ul>
<p><a href=""></a></p>
<h3 id="printing-a-dom-tree">Printing a DOM Tree</h3>
<p>One of the first things many programmers want to know is how to read an XML file and generate a DOM Document object from it. Use the <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/DOMEcho/DOMEcho.java" target="_blank">DOMEcho example</a> to learn how to do this in three steps. The important lines are:
    // Step 1: create a DocumentBuilderFactory and setNamespaceAware     DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();     dbf.setNamespaceAware(true);     // Step 2: create a DocumentBuilder     DocumentBuilder db = dbf.newDocumentBuilder();     // Step 3: parse the input file to get a Document object     Document doc = db.parse(new File(filename));</p>
<p>The program also gives an example of using an error handler and of setting optional configuration options, such as validation. Finally, this program helps you understand how DOM works by showing you the structure and contents of a DOM tree.</p>
<p><a href=""></a></p>
<h3 id="sax-program-to-count-tags">SAX Program to Count Tags</h3>
<p>The <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/SAXLocalNameCount/SAXLocalNameCount.java" target="_blank">SAXLocalNameCount</a>program counts the number of unique element local names in an XML document, ignoring the namespace name for simplicity. This example also shows one way to turn on DTD or XSD validation and how to use a SAX ErrorHandler.</p>
<p>There are several ways to parse a document using SAX and JAXP. We show one approach here. The first step is to bootstrap a parser. There are two ways: one is to use only the SAX API, the other is to use the JAXP utility classes in the javax.xml.parsers package. We use the second approach here because at the time of this writing it probably is the most portable solution for a JAXP compatible parser. After bootstrapping a parser/XMLReader, there are several ways to begin a parse. In this example, we use the SAX API.</p>
<h3 id="-schema-examples"><a href=""></a>Schema Examples</h3>
<p>Both of the sample programs include an option (-xsd) that lets you  validate the incoming document using XML Schema, instead of the document&#39;s DTD.  In addition, they include an -xsdss option that lets you specify the  &quot;schema source&quot; (the file that defines the schema for the document).</p>
<p>Both programs define the following constants:
    static final String JAXP_SCHEMA_LANGUAGE =         &quot;<a href="http://java.sun.com/xml/jaxp/properties/schemaLanguage" target="_blank">http://java.sun.com/xml/jaxp/properties/schemaLanguage</a>&quot;;     static final String W3C_XML_SCHEMA =         &quot;<a href="http://www.w3.org/2001/XMLSchema" target="_blank">http://www.w3.org/2001/XMLSchema</a>&quot;;     static final String JAXP_SCHEMA_SOURCE =         &quot;<a href="http://java.sun.com/xml/jaxp/properties/schemaSource" target="_blank">http://java.sun.com/xml/jaxp/properties/schemaSource</a>&quot;;</p>
<p>The schema language property defines the language the schema is written in.  The W3C XML Schema language is specified in these examples. The schema source  property directs the parser to a schema to use, regardless of any schema pointer  that the XML instance document may contain.</p>
<p>This code is abstracted from the SAX example:
    SAXParserFactory spf = SAXParserFactory.newInstance();     // Set namespaceAware to true to get a parser that corresponds to     // the default SAX2 namespace feature setting.  This is necessary     // because the default value from JAXP 1.0 was defined to be false.     spf.setNamespaceAware(true);     spf.setValidating(true);     SAXParser saxParser = spf.newSAXParser();     // Set the schema language if necessary     try {        saxParser.setProperty(JAXP_SCHEMA_LANGUAGE, W3C_XML_SCHEMA);     } catch (SAXNotRecognizedException x) {         // This can happen if the parser does not support JAXP 1.2         ...     }     ...    saxParser.setProperty(JAXP_SCHEMA_SOURCE, new File(schemaSource));</p>
<p>And here is the code abstracted from the DOM example:</p>
<pre><code>DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();     // Set namespaceAware to true to get a DOM Level 2 tree with nodes     // containing namesapce information.  This is necessary because the     // default value from JAXP 1.0 was defined to be false.     dbf.setNamespaceAware(true);     dbf.setValidating(true);     try {        dbf.setAttribute(JAXP_SCHEMA_LANGUAGE, W3C_XML_SCHEMA);     } catch (IllegalArgumentException x) {         // This can happen if the parser does not support JAXP 1.2         ...     }     // Specify other factory configuration settings    dbf.setAttribute(JAXP_SCHEMA_SOURCE, new File(schemaSource));     ...     DocumentBuilder db = dbf.newDocumentBuilder();
</code></pre><p>Note that the values are used to modify the SAX <em>parser,</em> using</p>
<p>setProperty(),
but they are used to modify the DOM parser<em>factory</em>, using</p>
<p>setAttribute()
.</p>
<p><a href="http://people.apache.org/~edwingo/jaxp-ri-1.2.0-fcs/docs/samples.html" target="_blank"><a href="http://people.apache.org/~edwingo/jaxp-ri-1.2.0-fcs/docs/samples.html">http://people.apache.org/~edwingo/jaxp-ri-1.2.0-fcs/docs/samples.html</a></a></p>
<p>另外一种，用 Validating Parser </p>
<p> Using the Validating Parser</p>
<p>By now, you have done a lot of experimenting with the nonvalidating parser. It&#39;s time to have a look at the validating parser to find out what happens when you use it to parse the sample presentation.</p>
<p>You need to understand about two things about the validating parser at the outset:</p>
<p>*</p>
<ul>
<li><p>A schema or document type definition (DTD) is required.</p>
</li>
<li><p>Because the schema or DTD is present, the</p>
</li>
</ul>
<p>ignorableWhitespace
method is invoked whenever possible.</p>
<h3 id="configuring-the-factory">Configuring the Factory</h3>
<p>The first step is to modify the Echo program so that it uses the validating parser instead of the nonvalidating parser.</p>
<p>Note: The code in this section is contained in</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10.java" target="_blank">Echo10.java</a>
.</p>
<p>To use the validating parser, make the following highlighted changes:
public static void main(String argv[]) {   if (argv.length != 1) {     ...   }   // Use the default (non-validating) parser  // Use the validating parser  SAXParserFactory factory = SAXParserFactory.newInstance();   factory.setValidating(true);  try {     ...</p>
<p>Here, you configure the factory so that it will produce a validating parser when</p>
<p>newSAXParser
is invoked. To configure it to return a namespace-aware parser, you can also use</p>
<p>setNamespaceAware(true)
. Sun&#39;s implementation supports any combination of configuration options. (If a combination is not supported by a particular implementation, it is required to generate a factory configuration error.)</p>
<h3 id="validating-with-xml-schema">Validating with XML Schema</h3>
<p>Although a full treatment of XML Schema is beyond the scope of this tutorial, this section shows you the steps you take to validate an XML document using an existing schema written in the XML Schema language. (To learn more about XML Schema, you can review the online tutorial, XML Schema Part 0: Primer, at</p>
<p><a href="http://www.w3.org/TR/xmlschema-0/" target="_blank"><a href="http://www.w3.org/TR/xmlschema-0/">http://www.w3.org/TR/xmlschema-0/</a></a>
. You can also examine the sample programs that are part of the JAXP download. They use a simple XML Schema definition to validate personnel data stored in an XML file.)</p>
<p>Note: There are multiple schema-definition languages, including RELAX NG, Schematron, and the W3C &quot;XML Schema&quot; standard. (Even a DTD qualifies as a &quot;schema,&quot; although it is the only one that does not use XML syntax to describe schema constraints.) However, &quot;XML Schema&quot; presents us with a terminology challenge. Although the phrase &quot;XML Schema schema&quot; would be precise, we&#39;ll use the phrase &quot;XML Schema definition&quot; to avoid the appearance of redundancy.</p>
<p>To be notified of validation errors in an XML document, the parser factory must be configured to create a validating parser, as shown in the preceding section. In addition, the following must be true:</p>
<p>*</p>
<ul>
<li>The appropriate properties must be set on the SAX parser.</li>
<li>The appropriate error handler must be set.</li>
<li>The document must be associated with a schema.</li>
</ul>
<h3 id="setting-the-sax-parser-properties">Setting the SAX Parser Properties</h3>
<p>It&#39;s helpful to start by defining the constants you&#39;ll use when setting the properties:
static final String JAXP_SCHEMA_LANGUAGE =     &quot;<a href="http://java.sun.com/xml/jaxp/properties/schemaLanguage" target="_blank">http://java.sun.com/xml/jaxp/properties/schemaLanguage</a>&quot;; static final String W3C_XML_SCHEMA =     &quot;<a href="http://www.w3.org/2001/XMLSchema" target="_blank">http://www.w3.org/2001/XMLSchema</a>&quot;;</p>
<p>Next, you configure the parser factory to generate a parser that is namespace-aware as well as validating:
...   SAXParserFactory factory = SAXParserFactory.newInstance();   factory.setNamespaceAware(true);  factory.setValidating(true);</p>
<p>You&#39;ll learn more about namespaces in <a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/JAXPDOM8.html#wp76446" target="_blank">Validating with XML Schema</a>. For now, understand that schema validation is a namespace-oriented process. Because JAXP-compliant parsers are not namespace-aware by default, it is necessary to set the property for schema validation to work.</p>
<p>The last step is to configure the parser to tell it which schema language to use. Here, you use the constants you defined earlier to specify the W3C&#39;s XML Schema language:
saxParser.setProperty(JAXP_SCHEMA_LANGUAGE, W3C_XML_SCHEMA);</p>
<p>In the process, however, there is an extra error to handle. You&#39;ll take a look at that error next.</p>
<h3 id="setting-up-the-appropriate-error-handling">Setting Up the Appropriate Error Handling</h3>
<p>In addition to the error handling you&#39;ve already learned about, there is one error that can occur when you are configuring the parser for schema-based validation. If the parser is not 1.2-compliant and therefore does not support XML Schema, it can throw a</p>
<p>SAXNotRecognizedException
.</p>
<p>To handle that case, you wrap the</p>
<p>setProperty()
statement in a</p>
<p>try
/</p>
<p>catch
block, as shown in the code highlighted here:
... SAXParser saxParser = factory.newSAXParser();try {  saxParser.setProperty(JAXP_SCHEMA_LANGUAGE, W3C_XML_SCHEMA); }  catch (SAXNotRecognizedException x) {  // Happens if the parser does not support JAXP 1.2   ...}...</p>
<h3 id="associating-a-document-with-a-schema">Associating a Document with a Schema</h3>
<p>Now that the program is ready to validate the data using an XML Schema definition, it is only necessary to ensure that the XML document is associated with one. There are two ways to do that:</p>
<p>*</p>
<ul>
<li><p>By including a schema declaration in the XML document</p>
</li>
<li><p>By specifying the schema to use in the application</p>
</li>
</ul>
<p>Note: When the application specifies the schema to use, it overrides any schema declaration in the document.</p>
<p>To specify the schema definition in the document, you create XML such as this:</p>
<p><documentRoot  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  xsi:noNamespaceSchemaLocation='YourSchemaDefinition.xsd' >   ...</p>
<p>The first attribute defines the XML namespace (</p>
<p>xmlns
) prefix,</p>
<p>xsi
, which stands for XML Schema instance. The second line specifies the schema to use for elements in the document that do not have a namespace prefix--that is, for the elements you typically define in any simple, uncomplicated XML document.</p>
<p>Note: You&#39;ll learn about namespaces in <a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/JAXPDOM8.html#wp76446" target="_blank">Validating with XML Schema</a>. For now, think of these attributes as the &quot;magic incantation&quot; you use to validate a simple XML file that doesn&#39;t use them. After you&#39;ve learned more about namespaces, you&#39;ll see how to use XML Schema to validate complex documents that use them. Those ideas are discussed in <a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/JAXPDOM8.html#wp63997" target="_blank">Validating with Multiple Namespaces</a>.</p>
<p>You can also specify the schema file in the application:
static final String JAXP_SCHEMA_SOURCE =     &quot;<a href="http://java.sun.com/xml/jaxp/properties/schemaSource" target="_blank">http://java.sun.com/xml/jaxp/properties/schemaSource</a>&quot;; ... SAXParser saxParser = spf.newSAXParser(); ...saxParser.setProperty(JAXP_SCHEMA_SOURCE,     new File(schemaSource));</p>
<p>Now that you know how to use an XML Schema definition, we&#39;ll turn to the kinds of errors you can see when the application is validating its incoming data. To do that, you&#39;ll use a document type definition (DTD) as you experiment with validation.</p>
<h3 id="experimenting-with-validation-errors">Experimenting with Validation Errors</h3>
<p>To see what happens when the XML document does not specify a DTD, remove the</p>
<p>DOCTYPE
statement from the XML file and run the Echo program on it.</p>
<p>Note: The output shown here is contained in</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10-01.txt" target="_blank">Echo10-01.txt</a>
. (The browsable version is</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10-01.html" target="_blank">Echo10-01.html</a>
.)</p>
<p>The result you see looks like this:
&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt; /<em>/</em> Parsing error, line 9, uri .../slideSample01.xml   Document root element &quot;slideshow&quot;, must match DOCTYPE root  &quot;null&quot;</p>
<p>Note: This message was generated by the JAXP 1.2 libraries. If you are using a different parser, the error message is likely to be somewhat different.</p>
<p>This message says that the root element of the document must match the element specified in the</p>
<p>DOCTYPE
declaration. That declaration specifies the document&#39;s DTD. Because you don&#39;t yet have one, it&#39;s value is null. In other words, the message is saying that you are trying to validate the document, but no DTD has been declared, because no</p>
<p>DOCTYPE
declaration is present.</p>
<p>So now you know that a DTD is a requirement for a valid document. That makes sense. What happens when you run the parser on your current version of the slide presentation, with the DTD specified?</p>
<p>Note: The output shown here is produced using</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/xml/samples/slideSample07.xml" target="_blank">slideSample07.xml</a>
, as described in <a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/IntroXML3.html#wp68336" target="_blank">Referencing Binary Entities</a>. The output is contained in</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10-07.txt" target="_blank">Echo10-07.txt</a>
. (The browsable version is</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10-07.html" target="_blank">Echo10-07.html</a>
.)</p>
<p>This time, the parser gives a different error message:
  /<em>/</em> Parsing error, line 29, uri file:...   The content of element type &quot;slide&quot; must match  &quot;(image?,title,item/*)</p>
<p>This message says that the element found at line 29 (</p>
<p><item>
) does not match the definition of the</p>
<p><slide>
element in the DTD. The error occurs because the definition says that the</p>
<p>slide
element requires a</p>
<p>title
. That element is not optional, and the copyright slide does not have one. To fix the problem, add a question mark to make</p>
<p>title
an optional element:
&lt;!ELEMENT slide (image?, title?, item/*)&gt;</p>
<p>Now what happens when you run the program?</p>
<p>Note: You could also remove the copyright slide, producing the same result shown next, as reflected in</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10-06.txt" target="_blank">Echo10-06.txt</a>
. (The browsable version is</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10-06.html" target="_blank">Echo10-06.html</a>
.)</p>
<p>The answer is that everything runs fine until the parser runs into the</p>
<p><em>
tag contained in the overview slide. Because that tag is not defined in the DTD, the attempt to validate the document fails. The output looks like this:
  ...   ELEMENT: <title>   CHARS:   Overview   END_ELM: </title>   ELEMENT: <item>   CHARS:   Why /<em>/</em> Parsing error, line 28, uri: ...Element &quot;em&quot; must be declared.org.xml.sax.SAXParseException: ... ...</p>
<p>The error message identifies the part of the DTD that caused validation to fail. In this case it is the line that defines an</p>
<p>item
element as</p>
<p>(/#PCDATA | item)
.</p>
<p>As an exercise, make a copy of the file and remove all occurrences of</p>
<p><em>
from it. Can the file be validated now? (In the next section, you&#39;ll learn how to define parameter entries so that we can use XHTML in the elements we are defining as part of the slide presentation.)</p>
<h3 id="error-handling-in-the-validating-parser">Error Handling in the Validating Parser</h3>
<p>It is important to recognize that the only reason an exception is thrown when the file fails validation is as a result of the error-handling code you entered in the early stages of this tutorial. That code is reproduced here:
public void error(SAXParseException e) throws SAXParseException {   throw e;}</p>
<p>If that exception is not thrown, the validation errors are simply ignored. Try commenting out the line that throws the exception. What happens when you run the parser now?</p>
<p>In general, a SAX parsing error is a validation error, although you have seen that it can also be generated if the file specifies a version of XML that the parser is not prepared to handle. Remember that your application will not generate a validation exception unless you supply an error handler such as the one here. </p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/JAXPSAX9.html" target="_blank"><a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/JAXPSAX9.html">http://docs.oracle.com/javaee/1.4/tutorial/doc/JAXPSAX9.html</a></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/ftp/">ftp</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ftp/" class="label label-primary">ftp</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-ftp--ValidateXMLusingaXSD/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-ftp--ValidateXMLusingaXSD" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-ftp--被动模式下FTP的详细工作过程-大浪淘沙-51CTO技术博客/">被动模式下FTP的详细工作过程 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-ftp--被动模式下FTP的详细工作过程-大浪淘沙-51CTO技术博客/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-ftp-51cto-">被动模式下FTP的详细工作过程 - 大浪淘沙 - 51CTO技术博客</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度云收藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<p><a href="http://blog.51cto.com/" target="_blank"><img src="" alt=""></a><a href="http://www.51cto.com/" target="_blank">51CTO首页</a><img src="" alt=""><a href="http://blog.51cto.com/" target="_blank">51CTO博客</a><img src="" alt=""><a href="http://home.51cto.com/?reback=http://yuanbin.blog.51cto.com/363003/108009" target="_blank">我的博客</a><img src="" alt=""> <a href="http://blog.51cto.com/search.php" target="_blank">搜索</a> <a href="">每日博报</a></p>
<p><img src="" alt="">社区：<a href="http://edu.51cto.com/" target="_blank">学院</a><a href="http://bbs.51cto.com/" target="_blank">论坛</a><a href="http://blog.51cto.com/" target="_blank">博客</a><a href="http://down.51cto.com/" target="_blank">下载</a><a href="">更多<img src="" alt=""></a></p>
<p><a href="http://home.51cto.com/index.php?s=/Home/index" target="_blank"><img src="&quot;今天领无忧币了吗？&quot;" alt=""></a><a href="http://home.51cto.com/?reback=http://yuanbin.blog.51cto.com/363003/108009" target="_blank">登录</a><a href="http://ucenter.51cto.com/reg_01.php?reback=http://yuanbin.blog.51cto.com/363003/108009" target="_blank">注册</a></p>
<ul>
<li><a href="http://home.51cto.com/" target="_blank">家园</a></li>
<li><a href="http://edu.51cto.com/" target="_blank">学院</a></li>
<li><a href="http://blog.51cto.com/" target="_blank">博客</a></li>
<li><a href="http://bbs.51cto.com/" target="_blank">论坛</a></li>
<li><a href="http://down.51cto.com/" target="_blank">下载</a></li>
<li><a href="http://selftest.51cto.com/" target="_blank">自测</a></li>
<li><a href="http://doctor.51cto.com/" target="_blank">门诊</a></li>
<li><a href="http://blog.51cto.com/newsletter/" target="_blank">周刊</a></li>
<li><a href="http://book.51cto.com/" target="_blank">读书</a></li>
<li><a href="http://g.51cto.com/" target="_blank">技术圈</a></li>
</ul>
<p><a href="http://blog.51cto.com/blogcommend" target="_blank"><img src="" alt=""></a></p>
<p>[</p>
<h1 id="-">大浪淘沙</h1>
<p>](<a href="http://yuanbin.blog.51cto.com" target="_blank">http://yuanbin.blog.51cto.com</a>)</p>
<p><a href="http://yuanbin.blog.51cto.com" target="_blank"><a href="http://yuanbin.blog.51cto.com">http://yuanbin.blog.51cto.com</a></a>  <a href="">【复制】</a> <a href="http://yuanbin.blog.51cto.com/rss.php?uid=363003" target="_blank"></a><a href="http://yuanbin.blog.51cto.com/rss.php?uid=363003">【订阅】</a></p>
<p><a href="http://yuanbin.blog.51cto.com/363003/o" title="察看yuanbin0710所有原创文章" target="_blank">原创</a>:29<a href="http://yuanbin.blog.51cto.com/363003/t" title="察看yuanbin0710所有翻译文章" target="_blank">翻译</a>:0<a href="http://yuanbin.blog.51cto.com/363003/c" title="察看yuanbin0710所有转载文章" target="_blank">转载</a>:8</p>
<p><a href="">博 客</a>|<a href="http://home.51cto.com/apps/photo/index.php?s=/Index/photos/uid/363003" target="_blank">图库</a>|<a href="http://yuanbin.blog.51cto.com/addblog.php" target="_blank">写博文</a>|<a href="http://51ctoblog.blog.51cto.com/all/26414/4" target="_blank">帮 助</a></p>
<ul>
<li><a href="">首页</a>|</li>
<li><a href="http://yuanbin.blog.51cto.com/363003/d-1" target="_blank">Linux System</a>|</li>
<li><a href="http://yuanbin.blog.51cto.com/363003/d-2" target="_blank">Linux Server</a>|</li>
<li><a href="http://yuanbin.blog.51cto.com/363003/d-3" target="_blank">Windows System</a>|</li>
<li><a href="http://yuanbin.blog.51cto.com/363003/d-4" target="_blank">Windows Server</a>|</li>
<li><a href="http://yuanbin.blog.51cto.com/363003/d-5" target="_blank">网络技术</a>|</li>
<li><a href="http://yuanbin.blog.51cto.com/363003/d-6" target="_blank">生活</a></li>
</ul>
<h2 id="-yuanbin0710-blog"><strong>yuanbin0710</strong> 的BLOG</h2>
<p><img src="" alt=""></p>
<p><a href="http://home.51cto.com/index.php?s=/space/363003#message" target="_blank">写留言</a><a href="http://g.51cto.com/addgroup.php?uid=" target="_blank">邀请进圈子</a><a href="http://home.51cto.com/index.php?s=/Notify/write/uid/363003" target="_blank">发消息</a> <a href="">加友情链接</a><a href="http://home.51cto.com/index.php?s=/space/363003" target="_blank">进家园 加好友</a>
2012年度IT博客大赛
<a href="http://blog.51cto.com/contest2012/#top10000" target="_blank">十大杰出IT博客诞生</a></p>
<p><a href="http://blog.51cto.com/contest2012/" target="_blank"><img src="" alt=""></a></p>
<h2 id="-">博客统计信息</h2>
<p><a href="http://blog.51cto.com/blogcommend" target="_blank"><strong>51CTO推荐博客</strong></a>
用户名：yuanbin0710
文章数：37
评论数：166
访问量：279930
<a href="http://home.51cto.com/index.php?s=/Account/credit" target="_blank">无忧币</a>：20
<a href="http://51ctoblog.blog.51cto.com/26414/5591" target="_blank">博客积分</a>：1338
<a href="http://51ctoblog.blog.51cto.com/26414/5591" target="_blank">博客等级</a>：4
注册日期：2008-04-17</p>
<h2 id="-">热门专题</h2>
<p><a href="http://blog.51cto.com/zt" target="_blank">更多&gt;&gt;</a></p>
<p><a href="http://blog.51cto.com/zt/546" target="_blank"><img src="" alt=""></a> <a href="http://blog.51cto.com/zt/546" title="RHEL6从零基础到熟练使用" target="_blank">RHEL6从零基础到熟练使用</a> 阅读量：8542</p>
<p><a href="http://blog.51cto.com/zt/549" target="_blank"><img src="" alt=""></a> <a href="http://blog.51cto.com/zt/549" title="VMware5.5从零开始学起" target="_blank">VMware5.5从零开始学起</a> 阅读量：3326
<a href="http://blog.51cto.com/zt/547" target="_blank"><img src="" alt=""></a> <a href="http://blog.51cto.com/zt/547" title=" Hyper-V 3.0功能部署" target="_blank">Hyper-V 3.0功能部署</a> 阅读量：2014</p>
<p><a href="http://blog.51cto.com/zt/550" target="_blank"><img src="" alt=""></a> <a href="http://blog.51cto.com/zt/550" title="Windows Server入门教程" target="_blank">Windows Server入门教程</a> 阅读量：4726</p>
<h2 id="-">热门文章</h2>
<ul>
<li><a href="http://yuanbin.blog.51cto.com/363003/110825" target="_blank">DDNS配置实例（DHCP+DNS=..</a></li>
<li><a href="http://yuanbin.blog.51cto.com/363003/108572" target="_blank">BIND配置文件详解（一）</a></li>
<li><a href="http://yuanbin.blog.51cto.com/363003/117105" target="_blank">SWAT—Samba WEB管..</a></li>
<li><a href="http://yuanbin.blog.51cto.com/363003/108578" target="_blank">BIND配置文件详解（二）</a></li>
<li><a href="http://yuanbin.blog.51cto.com/363003/129071" target="_blank">两种方式建立Vsftpd虚拟用户</a></li>
<li><a href="http://yuanbin.blog.51cto.com/363003/115761" target="_blank">Samba配置文件常用参数详解</a></li>
<li><a href="http://yuanbin.blog.51cto.com/363003/112029" target="_blank">子网划分的两个例子</a></li>
<li><a href="http://yuanbin.blog.51cto.com/363003/129030" target="_blank">CentOS5启用Telnet服务详解</a><h2 id="-blog-">搜索BLOG文章</h2>
</li>
</ul>
<h2 id="-2-http-yuanbin-blog-51cto-com-mygroup-php-">我的技术圈(<a href="http://yuanbin.blog.51cto.com/mygroup.php" target="_blank"><strong>2</strong></a>)</h2>
<p><a href="http://home.51cto.com/apps/group/index.php?s=/Index/index/" target="_blank">更多&gt;&gt;</a></p>
<ul>
<li><a href="http://g.51cto.com/htbenet" target="_blank">北大青鸟benet网络工程师</a>  </li>
<li><p><a href="http://g.51cto.com/pro" target="_blank">IT pro</a>  </p>
<h2 id="-">最近访客</h2>
</li>
<li><p><a href="http://6601738.blog.51cto.com/" target="_blank"><img src="" alt=""></a></p>
</li>
</ul>
<p><a href="http://6601738.blog.51cto.com/" target="_blank">nj_ka..</a></p>
<ul>
<li><a href="http://huan108.blog.51cto.com/" target="_blank"><img src="" alt=""></a></li>
</ul>
<p><a href="http://huan108.blog.51cto.com/" target="_blank">huan108</a></p>
<ul>
<li><a href="http://902339.blog.51cto.com/" target="_blank"><img src="" alt=""></a></li>
</ul>
<p><a href="http://902339.blog.51cto.com/" target="_blank">doget</a></p>
<ul>
<li><a href="http://176650.blog.51cto.com/" target="_blank"><img src="" alt=""></a></li>
</ul>
<p><a href="http://176650.blog.51cto.com/" target="_blank">gaoti..</a></p>
<ul>
<li><a href="http://1433850.blog.51cto.com/" target="_blank"><img src="" alt=""></a></li>
</ul>
<p><a href="http://1433850.blog.51cto.com/" target="_blank">lonrn</a></p>
<ul>
<li><a href="http://3023685.blog.51cto.com/" target="_blank"><img src="" alt=""></a></li>
</ul>
<p><a href="http://3023685.blog.51cto.com/" target="_blank">wei13..</a></p>
<ul>
<li><a href="http://1055631.blog.51cto.com/" target="_blank"><img src="" alt=""></a></li>
</ul>
<p><a href="http://1055631.blog.51cto.com/" target="_blank">deeps..</a></p>
<ul>
<li><a href="http://championxie.blog.51cto.com/" target="_blank"><img src="" alt=""></a></li>
</ul>
<p><a href="http://championxie.blog.51cto.com/" target="_blank">champ..</a></p>
<ul>
<li><a href="http://1838662.blog.51cto.com/" target="_blank"><img src="" alt=""></a></li>
</ul>
<p><a href="http://1838662.blog.51cto.com/" target="_blank">flyer..</a></p>
<ul>
<li><a href="http://shitao123.blog.51cto.com/" target="_blank"><img src="" alt=""></a></li>
</ul>
<p><a href="http://shitao123.blog.51cto.com/" target="_blank">sht19..</a></p>
<ul>
<li><a href="http://7122578.blog.51cto.com/" target="_blank"><img src="" alt=""></a></li>
</ul>
<p><a href="http://7122578.blog.51cto.com/" target="_blank">浩临天下</a></p>
<ul>
<li><a href="http://489730.blog.51cto.com/" target="_blank"><img src="" alt=""></a></li>
</ul>
<p><a href="http://489730.blog.51cto.com/" target="_blank">登徒浪子</a></p>
<h2 id="-">最新评论</h2>
<ul>
<li><a href="http://8309257.blog.51cto.com/" target="_blank"><strong>eologo</strong></a>：<a href="http://yuanbin.blog.51cto.com/363003/110825" target="_blank">我没成功，请远程赐教，不胜感谢，..</a></li>
<li><a href="http://6718737.blog.51cto.com/" target="_blank"><strong>452165649</strong></a>：<a href="http://yuanbin.blog.51cto.com/363003/110825" target="_blank">我是在rh5.4上做的，为什么它不出现..</a></li>
<li><a href="http://jxcia.blog.51cto.com/" target="_blank"><strong>zhuyingkang</strong></a>：<a href="http://yuanbin.blog.51cto.com/363003/108359" target="_blank">博主还在么？能否看到我的留言？方..</a></li>
<li>[匿名]51cto游客：<a href="http://yuanbin.blog.51cto.com/363003/108359" target="_blank">我最近也在研究VSFTP，在根据楼主这..</a></li>
<li><a href="http://886201.blog.51cto.com/" target="_blank"><strong>happy2501</strong></a>：<a href="http://yuanbin.blog.51cto.com/363003/114207" target="_blank">您好，我按照您的做法做下来，测试..</a><h2 id="51cto-">51CTO推荐博文</h2>
</li>
</ul>
<p><a href="http://blog.51cto.com/artcommend" target="_blank">更多&gt;&gt;</a></p>
<ul>
<li><a href="http://mingwang.blog.51cto.com/1997299/1338756" title="用Windows Server 2012 R2 搭建二层证书服务结构 Part 1" target="_blank">用Windows Server 2012 R2 搭建二..</a></li>
<li><a href="http://ksyiwen.blog.51cto.com/2754337/1338850" title="TMG学习（六），发布内网多个Web站点" target="_blank">TMG学习（六），发布内网多个Web站点</a></li>
<li><a href="http://chenguang.blog.51cto.com/350944/1338882" title="实用防火墙（Iptables）脚本分析" target="_blank">实用防火墙（Iptables）脚本分析</a></li>
<li><a href="http://gtstorageworld.blog.51cto.com/908359/1339080" title="Hadoop迈入2.0时代 更适合企业应用" target="_blank">Hadoop迈入2.0时代 更适合企业应用</a></li>
<li><a href="http://itmydream.blog.51cto.com/961933/1339095" title="服务器（AD，DHCP，DNS，File）迁移案例" target="_blank">服务器（AD，DHCP，DNS，File）迁..</a></li>
<li><a href="http://rfyiamcool.blog.51cto.com/1030776/1339114" title="对于复杂流程确认的运维自动化方案的理解与探讨" target="_blank">对于复杂流程确认的运维自动化方..</a></li>
<li><a href="http://systema.blog.51cto.com/4037770/1338873" title="Office 365_邮件迁移之_直接转换迁移（CEM）" target="_blank">Office 365<em>邮件迁移之</em>直接转换..</a></li>
<li><a href="http://yaocoder.blog.51cto.com/2668309/1338567" title="网络编程释疑之：TCP的TIME_WAIT状态在服务器开发中的影响？" target="_blank">网络编程释疑之：TCP的TIME_WAIT..</a></li>
<li><a href="http://hucwuhen.blog.51cto.com/6253667/1338638" title="浅谈服务器被黑后的检查工作流程" target="_blank">浅谈服务器被黑后的检查工作流程</a></li>
<li><a href="http://magic3.blog.51cto.com/1146917/1337977" title="Backup Exec 2012  备份和还原活动目录(非授权还原)" target="_blank">Backup Exec 2012 备份和还原活..</a></li>
<li><a href="http://lixiaosong.blog.51cto.com/705126/1338148" title="AD 重置密码完整脚本" target="_blank">AD 重置密码完整脚本</a></li>
</ul>
<h2 id="-">友情链接</h2>
<ul>
<li><a href="http://lovesu.blog.51cto.com/" title="Bnsen" target="_blank">Bnsen</a></li>
<li><a href="http://jary3000.blog.51cto.com/" title="千山岛主之微软技术空间站" target="_blank">千山岛主之微软技..</a></li>
<li><a href="http://liuyu.blog.51cto.com/" title="seven" target="_blank">seven</a></li>
<li><a href="http://llk726.blog.51cto.com/" title="键盘人生" target="_blank">键盘人生</a></li>
<li><a href="http://kongming.blog.51cto.com/" title="祝孔明" target="_blank">祝孔明</a></li>
<li><a href="http://chenguang.blog.51cto.com/" title="李晨光" target="_blank">李晨光</a> <img src="" alt="三日内更新"></li>
<li><a href="http://baidu.blog.51cto.com/" title="秋日惜枫" target="_blank">秋日惜枫</a></li>
<li><a href="http://ming228.blog.51cto.com/" title="yangming.com" target="_blank">yangming.com</a></li>
<li><a href="http://redking.blog.51cto.com/" title="王乾De技术Blog" target="_blank">王乾De技术Blog</a></li>
<li><a href="http://idefeng.blog.51cto.com/" title="define_myself" target="_blank">define_myself</a></li>
<li><a href="http://xiaofw.blog.51cto.com/" title="社区大管家小废物" target="_blank">社区大管家小废物</a></li>
<li><a href="http://struggle.blog.51cto.com/" title="激情因梦想而存在" target="_blank">激情因梦想而存在</a></li>
<li><a href="http://yuelei.blog.51cto.com/" title="岳雷的微软网络课堂" target="_blank">岳雷的微软网络课堂</a></li>
<li><a href="http://huxiaoqiu.blog.51cto.com/" title="胡晓秋工作室" target="_blank">胡晓秋工作室</a></li>
<li><a href="http://51ctoblog.blog.51cto.com/" title="51CTO博客开发" target="_blank">51CTO博客开发</a></li>
</ul>
<p><a href="http://blog.51cto.com/contest2013/index.php?mod=userlist_third" target="_blank"><img src="" alt=""></a></p>
<p><a href="http://leonarding.blog.51cto.com/6045525/1335805" target="_blank">·【征文】聊IT运维标准化与安全，奖50元京东购物卡</a><a href="http://edu.51cto.com/lesson/id-58.html" target="_blank">·iOS企业级开发初级课程-UIView与控件(共20集 )</a><a href=""></a></p>
<p><a href="http://yuanbin.blog.51cto.com/all/363003" target="_blank">博主的更多文章&gt;&gt;</a></p>
<p><img src="" alt=""> 被动模式下FTP的详细工作过程 2008-10-25 20:03:53</p>
<p>标签：<a href="http://blog.51cto.com/tag-FTP.html" target="_blank">FTP</a> <a href="http://blog.51cto.com/tag-休闲.html" target="_blank">休闲</a> <a href="http://blog.51cto.com/tag-被动模式.html" target="_blank">被动模式</a> <a href="http://blog.51cto.com/tag-职场.html" target="_blank">职场</a> <a href="http://blog.51cto.com/tag-工作过程.html" target="_blank">工作过程</a>
原创作品，允许转载，转载时请务必以超链接形式标明文章 <a href="">原始出处</a> 、作者信息和本声明。否则将追究法律责任。<a href=""><a href="http://yuanbin.blog.51cto.com/363003/108009">http://yuanbin.blog.51cto.com/363003/108009</a></a></p>
<p><strong>文中有不对或者有不清楚的地方，请大家告诉我，谢谢！</strong></p>
<hr>
<p><strong>被动模式下FTP的详细工作过程</strong></p>
<p>PASV FTP在工作的第一步，与PORT FTP一样，会首先使用21端口建立控制连接；但在第二步，由FTP客户端主动发起建立数据传输连接请求，服务器的数据传输端口为随机端口，因此，每次建立的数据传输连接通道，服务器所使用的端口都不相同。</p>
<p>本示例客户端IP是192.168.120.168，服务器IP是192.168.120.240，因为客户端的MS-DOS不支持PASV模式，所以使用FlashFXP软件来连接服务器。通过抓包工具来查看用户从连接FTP服务器到退出FTP服务器经过的所有过程。
使用FlashFXP所做的操作：1.输入FTP服务器的IP，要登入的用户名和密码。2.进入用户家目录，查看.bashrc和.bash_profile两个文件。3.退出FTP。</p>
<p><strong>PASV FTP**</strong>的详细工作过程：**</p>
<p><strong>1.</strong> 因为FTP使用的是TCP协议，所以客户端FlashFXP在连接服务器192.168.120.240时，首先会经历TCP的三次握手来建立控制通道。客户端使用任意的端口N（&gt;1024）来连接FTP服务器默认的21端口。这和PORT模式一样。
<strong>2.</strong> 在TCP三次握手结束后，服务器端正式响应客户端的控制连接请求，控制通道建立。</p>
<p><strong>3.</strong> 客户端向服务器发送含有ACK的数据段来确认控制连接建立并发送用户名。
<strong>4.</strong> 服务器向客户端发送含有ACK的数据段来确认用户名。</p>
<p><strong>5.</strong> 服务器向客户端询问密码。
<strong>6.</strong> 客户端向服务器发送含有ACK的数据段来确认并发送密码，密码为明文。</p>
<p><strong>7.</strong> 服务器向客户端发送含有ACK的数据段来确认密码收到。
<strong>8.</strong> 服务器向客户端发送登陆成功的信息。</p>
<p><strong>9.</strong> 客户端向服务器发送含有ACK的数据段来确认并发送查询系统类型的指令（见图一）。
<strong>10.</strong> 服务器向客户端发送含有ACK的数据段来确认收到指令。</p>
<p><strong>11.</strong> 服务器向客户端回应系统的类型为UNIX（见图二）。
<strong>12.</strong> 客户端向服务器发送列出服务器的所有扩展命令和扩展功能的指令（见图三）。</p>
<p><strong>13.</strong> 服务器响应客户端的FEAT请求（见图四）。
<strong>14.</strong> 服务器响应客户端有EPSV（扩展PASV，支持非IPV4）的扩展功能（见图五）。</p>
<p><strong>15.</strong> 客户端向服务器发送含有ACK的数据段来确认收到信息。
<strong>16.</strong> 服务器响应客户端自己的其他特性（见图六）。MDTM：保留下载文件的日期/时间；REST STREAM：重设文件传输方式为stream形式。</p>
<p><strong>17.</strong> 客户端确认收到服务器的信息。
<strong>18.</strong> 服务器响应客户端进入到用户的家目录（见图七）。</p>
<p><strong>19.</strong> 客户端确认收到服务器的信息。
<strong>20.</strong> 客户端向服务器发送文件传输使用何种模式（Binary、ASCII）的指令（见图八）。</p>
<p><strong>21.</strong> 服务器回应客户端使用Binary模式（见图九）。
<strong>22.</strong> 客户端向服务器询问.bashrc文件的大小（见图十）。</p>
<p><strong>23.</strong> 服务器回应客户端.bashrc文件的大小为124字节（见图十一）。
<strong>24.</strong> 客户端向服务器发出PASV的指令（用来进行数据传输）（见图十二）。</p>
<p><strong>25.</strong> 服务器回应客户端使用PASV模式，并且商量数据传输端口用232x256+151=59543（见图十三）。
<strong>26.</strong> 客户端主动使用N+1端口来连接服务器的59543端口，并且向服务器发送含有SYN的数据段来开始进行数据传输连接的第1次握手（见图十四）。</p>
<p><strong>27.</strong> 服务器向客户端发送含有SYN和ACK的数据段来进行第2次握手（见图十五）。
<strong>28.</strong> 客户端向服务器发送含有ACK的数据段来进行第3次握手（见图十六）。</p>
<p><strong>29.</strong> 3次握手过程完成，客户端向服务器发送查看.bashrc文件的指令（见图十七）。
<strong>30.</strong> 服务器回应客户端使用Binary数据传输模式连接.bashrc文件（见图十八）。</p>
<p><strong>31.</strong> 服务器开始进行数据传输。
<strong>32.</strong> 服务器确定数据传输完毕，然后向客户端发送含有FIN和ACK的数据段来请求断开本次数据连接，第1次断开（见图十九）。</p>
<p><strong>33.</strong> 客户端向服务器发送含有ACK的数据段答应服务器的断接请求，第2次断开（见图二十）。
<strong>34.</strong> 服务器响应客户端文件发送完成的信息（见图二十一）。</p>
<p><strong>35.</strong> 客户端向服务器发送含有ACK的数据段来确认收到信息。
<strong>36.</strong> 客户端向服务器发送含有FIN和ACK的数据段来请求断开客户端到服务器之间的数据连接，第3次断开（见图二十二）。</p>
<p><strong>37.</strong> 服务器向客户端发送含有ACK的数据段确认断开连接，第4次断开（见图二十三）
<strong>38.</strong> 接下来是查看.bash_profile文件的过程。其过程和查看.bashrc文件的过程一样（在此不详述了），只是服务器和客户端的数据传输端口变了。服务器的数据传输端口是随机的；客户端的数据传输端口是N+2。</p>
<p><strong>39.</strong> 客户端在查看完.bash_profile文件并彻底完成该次数据连接的4次断开后，向服务器发送退出的指令（见图二十四）。
<strong>40.</strong> 服务器响应客户端的退出请求（见图二十五）。</p>
<p><strong>41.</strong> 服务器向客户端发送含有FIN和ACK的数据段，请求断开控制连接（见图二十六）。这是第一次断开控制连接。
<strong>42.</strong> 客户端向服务器发送含有ACK的数据段来应答服务器的断接请求（见图二十七）。这是第二次断开控制连接。</p>
<p><strong>43.</strong> 客户端向服务器发送含有FIN和ACK的数据段，请求断开到服务器之间的控制连接（见图二十八）。这是第三次断开控制连接。
<strong>44.</strong> 服务器向客户端发送含有ACK的数据段，来确认客户端的断接请求（见图二十九）。这样本次FTP控制连接完全断开。</p>
<p><strong>通过查看本次示例（被动FTP）的详细过程，我们可以得到以下几点结果：</strong></p>
<p><strong>1.</strong> 服务器的控制连接端口为21，数据传输端口随机（&gt;1024）并且每次的数据传输端口都不一样。
<strong>2.</strong> 客户端的控制连接端口为N（&gt;1024），数据传输端口在第一次进行数据传输时为N+1,在第二次数据传输时为N+2，依次类推。</p>
<p><strong>3.</strong> 服务器主动告诉客户端自己的数据传输端口。
<strong>4.</strong> 客户端主动用数据传输端口N+x去连接服务器的随机数据传输端口。</p>
<p><strong>5.</strong> 在一次FTP连接的过程中，只有一次控制连接，却可以有多次数据传输连接。
<strong>6.</strong> 不管是控制连接还是数据传输连接，在每次从建立到完成都需要经过3次连接和4次断开的过程。（这符合TCP协议的要求）</p>
<p><strong>本文档使用的图例：</strong></p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224935974PU0j.gif" target="_blank"><img src="" alt="11"></a> 
图一：客户端发送查询系统类型的指令</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224935976j9JR.jpg" target="_blank"></a><a href="http://img1.51cto.com/attachment/200810/25/363003_1224935977k2F8.gif"><img src="" alt="13"></a></p>
<p>图二：服务器响应客户端系统类型为UNIX</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224935978q1o9.gif" target="_blank"><img src="" alt="14"></a>
图三：客户端请求服务器列出它的所有扩展命令和扩展功能</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224935983sdRz.gif" target="_blank"><img src="" alt="15"></a></p>
<p>图四：服务器响应客户端的FEAT请求</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936006Aznp.gif" target="_blank"><img src="" alt="16"></a>
图五：服务器响应客户端有EPSV（扩展PASV，支持非IPV4）的扩展功能</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_12249360074yJ5.gif" target="_blank"><img src="" alt="18"></a></p>
<p>图六：服务器响应客户端自己支持的其他特性</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936015iZgn.gif" target="_blank"><img src="" alt="20"></a>
图七：服务器响应客户端进入到用户家目录</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936017ZmNc.gif" target="_blank"><img src="" alt="22"></a></p>
<p>图八：客户端向服务器询问文件传输的模式</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936018IMjR.gif" target="_blank"><img src="" alt="23"></a>
图九：服务器响应客户端使用Binary模式</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936020hNul.gif" target="_blank"><img src="" alt="24"></a></p>
<p>图十：客户端向服务器询问.bashrc文件的大小</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936022sj6P.gif" target="_blank"><img src="" alt="25"></a>
图十一：服务器回应客户端.bashrc文件的大小为124字节</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_12249360237iAu.gif" target="_blank"><img src="" alt="26"></a></p>
<p>图十二：客户端向服务器发送PASV指令</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_12249361801LGh.gif" target="_blank"><img src="" alt="27"></a>
图十三：服务器响应客户端使用PASV模式，并且商量数据传输端口用59543</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936181n4nW.gif" target="_blank"><img src="" alt="28"></a></p>
<p>图十四：第一次数据传输连接之第一次握手</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_122493618223uT.gif" target="_blank"><img src="" alt="29"></a>
图十五：第一次数据传输连接之第二次握手</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936183BjjV.gif" target="_blank"><img src="" alt="30"></a></p>
<p>图十六：第一次数据传输连接之第三次握手</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936185srsz.gif" target="_blank"><img src="" alt="31"></a>
图十七：客户端向服务器发送查看.bashrc文件的指令</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936186ZS1w.gif" target="_blank"><img src="" alt="32"></a></p>
<p>图十八：服务器响应客户端使用Binary数据传输模式来连接.bashrc文件</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936188Q6dX.gif" target="_blank"><img src="" alt="34"></a>
图十九：服务器发送FIN和ACK请求断开本次数据连接（第1次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936210T20g.gif" target="_blank"><img src="" alt="35"></a></p>
<p>图二十：客户端发送ACK答应服务器的请求（第2次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936213ulWM.gif" target="_blank"><img src="" alt="36"></a>
图二十一：服务器响应客户端文件发送完毕的信息</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936217J6aY.gif" target="_blank"><img src="" alt="38"></a></p>
<p>图二十二：客户端向服务器发送含有FIN和ACK的数据段请求断开数据连接（第3次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936218Leca.gif" target="_blank"><img src="" alt="39"></a>
图二十三：服务器向客户端发送含有ACK的数据段确认断开连接（第4次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936220HQq5.gif" target="_blank"><img src="" alt="56"></a></p>
<p>图二十四：客户端向服务器发出退出的指令</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936221ejql.gif" target="_blank"><img src="" alt="57"></a>
图二十五：服务器响应客户端的退出请求</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936223xMjK.gif" target="_blank"><img src="" alt="58"></a></p>
<p>图二十六：服务器向客户端发送FIN和ACK请求断开控制连接（第1次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_12249362249BCE.gif" target="_blank"><img src="" alt="59"></a>
图二十七：客户端向服务器发送ACK答应服务器请求（第2次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936225gvOK.gif" target="_blank"><img src="" alt="60"></a></p>
<p>图二十八：客户端向服务器发送FIN和ACK请求断开控制连接（第3次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936226MLVx.gif" target="_blank"><img src="" alt="61"></a>
图二十九：服务器向客户端发送ACK答应断开控制连接（第4次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936227MSuY.gif" target="_blank"><img src="" alt="62"></a></p>
<p>图三十：本次示例全部过程</p>
<p>本文档完整的图例，请见附件。</p>
<p>本文出自 “<a href="http://yuanbin.blog.51cto.com" target="_blank">大浪淘沙</a>” 博客，请务必保留此出处<a href="http://yuanbin.blog.51cto.com/363003/108009" target="_blank"><a href="http://yuanbin.blog.51cto.com/363003/108009">http://yuanbin.blog.51cto.com/363003/108009</a></a>
<img src="" alt="分享至"> <a href="&quot;分享到新浪微博&quot;"></a> <a href="&quot;分享到QQ空间&quot;"></a> <a href="&quot;分享到腾讯微博&quot;"></a> <a href="&quot;分享到百度搜藏&quot;"></a> <a href="&quot;分享到人人网&quot;"></a> <a href="&quot;分享到QQ收藏&quot;"></a> <a href="&quot;分享到豆瓣网&quot;"></a> <a href="&quot;分享到百度空间&quot;"></a> <a href="&quot;分享到MSN&quot;"></a> ** 更多 <a href="&quot;累计分享0次&quot;">0</a> <a href="&quot;一键收藏，随时查看，分享好友！&quot;"><img src="" alt="一键收藏，随时查看，分享好友！"></a></p>
<p><img src="" alt=""> <a href="">cccc0912</a> 1人 了这篇文章
<strong>附件下载：</strong>
<a href=""><img src="" alt="">FTP被动模式详细工作过程（图例）</a></p>
<p>类别：<a href="http://yuanbin.blog.51cto.com/363003/d-2" target="_blank">Linux Server</a>┆<a href="">技术圈</a>(0)┆阅读(2046)┆评论(2) ┆ <a href="">推送到技术圈</a>┆<a href="">返回首页</a>
上一篇 <a href="http://yuanbin.blog.51cto.com/363003/107672" title="主动模式下FTP的详细工作过程" target="_blank">主动模式下FTP的详细工作过程</a> 下一篇 <a href="http://yuanbin.blog.51cto.com/363003/108014" title="FTP总结" target="_blank">FTP总结</a>
<a href="http://blog.51cto.com/contest2013/index.php?mod=userlist_top50" target="_blank"><img src="" alt=""></a></p>
<h2 id="-">相关文章</h2>
<ul>
<li><a href="http://nickzp.blog.51cto.com/12728/39642" title="FTP主动模式及被动模式" target="_blank">FTP主动模式及被动模式</a></li>
<li><a href="http://yuanbin.blog.51cto.com/363003/107672" title="主动模式下FTP的详细工作过程" target="_blank">主动模式下FTP的详细工作过程</a></li>
<li><a href="http://xwnet.blog.51cto.com/233677/95182" title="FTP上传文件经常中断或超时的解决方案" target="_blank">FTP上传文件经常中断或超时的解决方案</a></li>
<li><a href="http://heyiyi.blog.51cto.com/205455/104282" title="RedHat AS 4 下架设FTP服务器" target="_blank">RedHat AS 4 下架设FTP服务器</a></li>
<li><a href="http://zhouhaipeng.blog.51cto.com/447669/91890" title="ftp命令大全" target="_blank">ftp命令大全</a></li>
<li><a href="http://userli.blog.51cto.com/45840/68768" title="『第9天』从FTP入侵到SQL" target="_blank">『第9天』从FTP入侵到SQL</a></li>
<li><a href="http://tempcom.blog.51cto.com/475758/106600" title="Ubuntu实用简单的FTP架设" target="_blank">Ubuntu实用简单的FTP架设</a></li>
<li><a href="http://22494.blog.51cto.com/12494/19269" title="Serv-U FTP之PASV和PORT模式" target="_blank">Serv-U FTP之PASV和PORT模式</a></li>
<li><a href="http://recordtrip.blog.51cto.com/346611/100469" title="2003server 搭建FTP服务器 不能下载文件问题" target="_blank">2003server 搭建FTP服务器 不能下载文件问题</a></li>
<li><a href="http://chuan.blog.51cto.com/130796/58481" title="FTP组隔离用户" target="_blank">FTP组隔离用户</a>
<a href=""></a></li>
</ul>
<h2 id="-">文章评论</h2>
<p> <a href=""></a></p>
<p>[1楼]    <img src="" alt="">  [匿名]yangming1052 <a href="">回复</a></p>
<p>2008-10-27 11:17:13
不错 学习了。。
<a href=""></a></p>
<p>[2楼]    <img src="" alt="">  <a href="http://xiaofang1213.blog.51cto.com/" target="_blank"><strong>小芳1213</strong></a> <a href="">回复</a></p>
<p>2010-09-21 08:25:03
很不错噢。</p>
<p> <a href=""></a></p>
<p><a href=""></a></p>
<h2 id="-">发表评论</h2>
<p><a href="http://blog.51cto.com/newsletter/230/" target="_blank">周刊：IT行业盲目涨工资比房产泡沫更危险？</a>
昵  称： <a href="http://home.51cto.com/index.php?reback=http://yuanbin.blog.51cto.com/363003/108009" target="_blank">登录</a>  <a href="http://ucenter.51cto.com/reg_01.php?reback=http://blog.51cto.com" target="_blank">快速注册</a> 验证码： <img src="" alt=""></p>
<p>点击图片可刷新验证码请点击后输入验证码<a href="http://51ctoblog.blog.51cto.com/26414/5591" target="_blank">博客过2级，无需填写验证码</a> 内  容：</p>
<p>同时赞一个
返回顶部</p>
<p>Copyright By 51CTO.COM 版权所有
<a href="http://blog.51cto.com/" target="_blank"><img src="" alt=""></a>
<a href="http://www.cnzz.com/stat/website.php?web_id=4274540" title="站长统计" target="_blank"><img src="" alt=""></a></p>
<p>附件下载<a href="">close</a></p>
<p>请输入验证码：
<img src="&quot;单击更换验证码！&quot;" alt="">
确认</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/ftp/">ftp</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ftp/" class="label label-primary">ftp</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-ftp--被动模式下FTP的详细工作过程-大浪淘沙-51CTO技术博客/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-ftp--被动模式下FTP的详细工作过程-大浪淘沙-51CTO技术博客" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-ftp--被动模式下FTP的详细工作过程/">被动模式下FTP的详细工作过程</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-ftp--被动模式下FTP的详细工作过程/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-ftp-">被动模式下FTP的详细工作过程</h1>
<p><strong>被动模式下FTP的详细工作过程</strong></p>
<p>PASV FTP在工作的第一步，与PORT FTP一样，会首先使用21端口建立控制连接；但在第二步，由FTP客户端主动发起建立数据传输连接请求，服务器的数据传输端口为随机端口，因此，每次建立的数据传输连接通道，服务器所使用的端口都不相同。</p>
<p>本示例客户端IP是192.168.120.168，服务器IP是192.168.120.240，因为客户端的MS-DOS不支持PASV模式，所以使用FlashFXP软件来连接服务器。通过抓包工具来查看用户从连接FTP服务器到退出FTP服务器经过的所有过程。
使用FlashFXP所做的操作：1.输入FTP服务器的IP，要登入的用户名和密码。2.进入用户家目录，查看.bashrc和.bash_profile两个文件。3.退出FTP。</p>
<p><strong>PASV FTP**</strong>的详细工作过程：**</p>
<p><strong>1.</strong> 因为FTP使用的是TCP协议，所以客户端FlashFXP在连接服务器192.168.120.240时，首先会经历TCP的三次握手来建立控制通道。客户端使用任意的端口N（&gt;1024）来连接FTP服务器默认的21端口。这和PORT模式一样。
<strong>2.</strong> 在TCP三次握手结束后，服务器端正式响应客户端的控制连接请求，控制通道建立。</p>
<p><strong>3.</strong> 客户端向服务器发送含有ACK的数据段来确认控制连接建立并发送用户名。
<strong>4.</strong> 服务器向客户端发送含有ACK的数据段来确认用户名。</p>
<p><strong>5.</strong> 服务器向客户端询问密码。
<strong>6.</strong> 客户端向服务器发送含有ACK的数据段来确认并发送密码，密码为明文。</p>
<p><strong>7.</strong> 服务器向客户端发送含有ACK的数据段来确认密码收到。
<strong>8.</strong> 服务器向客户端发送登陆成功的信息。</p>
<p><strong>9.</strong> 客户端向服务器发送含有ACK的数据段来确认并发送查询系统类型的指令（见图一）。
<strong>10.</strong> 服务器向客户端发送含有ACK的数据段来确认收到指令。</p>
<p><strong>11.</strong> 服务器向客户端回应系统的类型为UNIX（见图二）。
<strong>12.</strong> 客户端向服务器发送列出服务器的所有扩展命令和扩展功能的指令（见图三）。</p>
<p><strong>13.</strong> 服务器响应客户端的FEAT请求（见图四）。
<strong>14.</strong> 服务器响应客户端有EPSV（扩展PASV，支持非IPV4）的扩展功能（见图五）。</p>
<p><strong>15.</strong> 客户端向服务器发送含有ACK的数据段来确认收到信息。
<strong>16.</strong> 服务器响应客户端自己的其他特性（见图六）。MDTM：保留下载文件的日期/时间；REST STREAM：重设文件传输方式为stream形式。</p>
<p><strong>17.</strong> 客户端确认收到服务器的信息。
<strong>18.</strong> 服务器响应客户端进入到用户的家目录（见图七）。</p>
<p><strong>19.</strong> 客户端确认收到服务器的信息。
<strong>20.</strong> 客户端向服务器发送文件传输使用何种模式（Binary、ASCII）的指令（见图八）。</p>
<p><strong>21.</strong> 服务器回应客户端使用Binary模式（见图九）。
<strong>22.</strong> 客户端向服务器询问.bashrc文件的大小（见图十）。</p>
<p><strong>23.</strong> 服务器回应客户端.bashrc文件的大小为124字节（见图十一）。
<strong>24.</strong> 客户端向服务器发出PASV的指令（用来进行数据传输）（见图十二）。</p>
<p><strong>25.</strong> 服务器回应客户端使用PASV模式，并且商量数据传输端口用232x256+151=59543（见图十三）。
<strong>26.</strong> 客户端主动使用N+1端口来连接服务器的59543端口，并且向服务器发送含有SYN的数据段来开始进行数据传输连接的第1次握手（见图十四）。</p>
<p><strong>27.</strong> 服务器向客户端发送含有SYN和ACK的数据段来进行第2次握手（见图十五）。
<strong>28.</strong> 客户端向服务器发送含有ACK的数据段来进行第3次握手（见图十六）。</p>
<p><strong>29.</strong> 3次握手过程完成，客户端向服务器发送查看.bashrc文件的指令（见图十七）。
<strong>30.</strong> 服务器回应客户端使用Binary数据传输模式连接.bashrc文件（见图十八）。</p>
<p><strong>31.</strong> 服务器开始进行数据传输。
<strong>32.</strong> 服务器确定数据传输完毕，然后向客户端发送含有FIN和ACK的数据段来请求断开本次数据连接，第1次断开（见图十九）。</p>
<p><strong>33.</strong> 客户端向服务器发送含有ACK的数据段答应服务器的断接请求，第2次断开（见图二十）。
<strong>34.</strong> 服务器响应客户端文件发送完成的信息（见图二十一）。</p>
<p><strong>35.</strong> 客户端向服务器发送含有ACK的数据段来确认收到信息。
<strong>36.</strong> 客户端向服务器发送含有FIN和ACK的数据段来请求断开客户端到服务器之间的数据连接，第3次断开（见图二十二）。</p>
<p><strong>37.</strong> 服务器向客户端发送含有ACK的数据段确认断开连接，第4次断开（见图二十三）
<strong>38.</strong> 接下来是查看.bash_profile文件的过程。其过程和查看.bashrc文件的过程一样（在此不详述了），只是服务器和客户端的数据传输端口变了。服务器的数据传输端口是随机的；客户端的数据传输端口是N+2。</p>
<p><strong>39.</strong> 客户端在查看完.bash_profile文件并彻底完成该次数据连接的4次断开后，向服务器发送退出的指令（见图二十四）。
<strong>40.</strong> 服务器响应客户端的退出请求（见图二十五）。</p>
<p><strong>41.</strong> 服务器向客户端发送含有FIN和ACK的数据段，请求断开控制连接（见图二十六）。这是第一次断开控制连接。
<strong>42.</strong> 客户端向服务器发送含有ACK的数据段来应答服务器的断接请求（见图二十七）。这是第二次断开控制连接。</p>
<p><strong>43.</strong> 客户端向服务器发送含有FIN和ACK的数据段，请求断开到服务器之间的控制连接（见图二十八）。这是第三次断开控制连接。
<strong>44.</strong> 服务器向客户端发送含有ACK的数据段，来确认客户端的断接请求（见图二十九）。这样本次FTP控制连接完全断开。</p>
<p><strong>通过查看本次示例（被动FTP）的详细过程，我们可以得到以下几点结果：</strong></p>
<p><strong>1.</strong> 服务器的控制连接端口为21，数据传输端口随机（&gt;1024）并且每次的数据传输端口都不一样。
<strong>2.</strong> 客户端的控制连接端口为N（&gt;1024），数据传输端口在第一次进行数据传输时为N+1,在第二次数据传输时为N+2，依次类推。</p>
<p><strong>3.</strong> 服务器主动告诉客户端自己的数据传输端口。
<strong>4.</strong> 客户端主动用数据传输端口N+x去连接服务器的随机数据传输端口。</p>
<p><strong>5.</strong> 在一次FTP连接的过程中，只有一次控制连接，却可以有多次数据传输连接。
<strong>6.</strong> 不管是控制连接还是数据传输连接，在每次从建立到完成都需要经过3次连接和4次断开的过程。（这符合TCP协议的要求）</p>
<p><strong>本文档使用的图例：</strong></p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224935974PU0j.gif" target="_blank"><img src="" alt="11"></a> 
图一：客户端发送查询系统类型的指令</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224935976j9JR.jpg" target="_blank"></a><a href="http://img1.51cto.com/attachment/200810/25/363003_1224935977k2F8.gif"><img src="" alt="13"></a></p>
<p>图二：服务器响应客户端系统类型为UNIX</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224935978q1o9.gif" target="_blank"><img src="" alt="14"></a>
图三：客户端请求服务器列出它的所有扩展命令和扩展功能</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224935983sdRz.gif" target="_blank"><img src="" alt="15"></a></p>
<p>图四：服务器响应客户端的FEAT请求</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936006Aznp.gif" target="_blank"><img src="" alt="16"></a>
图五：服务器响应客户端有EPSV（扩展PASV，支持非IPV4）的扩展功能</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_12249360074yJ5.gif" target="_blank"><img src="" alt="18"></a></p>
<p>图六：服务器响应客户端自己支持的其他特性</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936015iZgn.gif" target="_blank"><img src="" alt="20"></a>
图七：服务器响应客户端进入到用户家目录</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936017ZmNc.gif" target="_blank"><img src="" alt="22"></a></p>
<p>图八：客户端向服务器询问文件传输的模式</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936018IMjR.gif" target="_blank"><img src="" alt="23"></a>
图九：服务器响应客户端使用Binary模式</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936020hNul.gif" target="_blank"><img src="" alt="24"></a></p>
<p>图十：客户端向服务器询问.bashrc文件的大小</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936022sj6P.gif" target="_blank"><img src="" alt="25"></a>
图十一：服务器回应客户端.bashrc文件的大小为124字节</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_12249360237iAu.gif" target="_blank"><img src="" alt="26"></a></p>
<p>图十二：客户端向服务器发送PASV指令</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_12249361801LGh.gif" target="_blank"><img src="" alt="27"></a>
图十三：服务器响应客户端使用PASV模式，并且商量数据传输端口用59543</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936181n4nW.gif" target="_blank"><img src="" alt="28"></a></p>
<p>图十四：第一次数据传输连接之第一次握手</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_122493618223uT.gif" target="_blank"><img src="" alt="29"></a>
图十五：第一次数据传输连接之第二次握手</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936183BjjV.gif" target="_blank"><img src="" alt="30"></a></p>
<p>图十六：第一次数据传输连接之第三次握手</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936185srsz.gif" target="_blank"><img src="" alt="31"></a>
图十七：客户端向服务器发送查看.bashrc文件的指令</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936186ZS1w.gif" target="_blank"><img src="" alt="32"></a></p>
<p>图十八：服务器响应客户端使用Binary数据传输模式来连接.bashrc文件</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936188Q6dX.gif" target="_blank"><img src="" alt="34"></a>
图十九：服务器发送FIN和ACK请求断开本次数据连接（第1次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936210T20g.gif" target="_blank"><img src="" alt="35"></a></p>
<p>图二十：客户端发送ACK答应服务器的请求（第2次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936213ulWM.gif" target="_blank"><img src="" alt="36"></a>
图二十一：服务器响应客户端文件发送完毕的信息</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936217J6aY.gif" target="_blank"><img src="" alt="38"></a></p>
<p>图二十二：客户端向服务器发送含有FIN和ACK的数据段请求断开数据连接（第3次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936218Leca.gif" target="_blank"><img src="" alt="39"></a>
图二十三：服务器向客户端发送含有ACK的数据段确认断开连接（第4次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936220HQq5.gif" target="_blank"><img src="" alt="56"></a></p>
<p>图二十四：客户端向服务器发出退出的指令</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936221ejql.gif" target="_blank"><img src="" alt="57"></a>
图二十五：服务器响应客户端的退出请求</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936223xMjK.gif" target="_blank"><img src="" alt="58"></a></p>
<p>图二十六：服务器向客户端发送FIN和ACK请求断开控制连接（第1次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_12249362249BCE.gif" target="_blank"><img src="" alt="59"></a>
图二十七：客户端向服务器发送ACK答应服务器请求（第2次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936225gvOK.gif" target="_blank"><img src="" alt="60"></a></p>
<p>图二十八：客户端向服务器发送FIN和ACK请求断开控制连接（第3次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936226MLVx.gif" target="_blank"><img src="" alt="61"></a>
图二十九：服务器向客户端发送ACK答应断开控制连接（第4次断开）</p>
<p><a href="http://img1.51cto.com/attachment/200810/25/363003_1224936227MSuY.gif" target="_blank"><img src="" alt="62"></a></p>
<p>图三十：本次示例全部过程</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/ftp/">ftp</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ftp/" class="label label-primary">ftp</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-ftp--被动模式下FTP的详细工作过程/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-ftp--被动模式下FTP的详细工作过程" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-webservice--Java开发的WebService获取客户端IP地址/">Java开发的WebService获取客户端IP地址_数据库 开发_比特网</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-webservice--Java开发的WebService获取客户端IP地址/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-webservice-ip-">Java开发WebService获取客户端IP地址</h1>
<p>1.基于jax-ws开发的webservice获取客户端ip的方法【在代理类XXXDelegate添加如下代码】：</p>
<p>import javax.annotation.Resource;</p>
<p>import javax.servlet.http.HttpServletRequest;</p>
<p>import javax.xml.ws.WebServiceContext;</p>
<p>import javax.xml.ws.handler.MessageContext;</p>
<p>@Resource</p>
<p>private WebServiceContext wsContext;</p>
<p>private String getClientInfo(){</p>
<p>MessageContext mc = wsContext.getMessageContext();</p>
<p>HttpServletRequest request = (HttpServletRequest)(mc.get(MessageContext.SERVLET_REQUEST));</p>
<p>String remortAddress = request.getRemoteAddr();</p>
<p>return (remortAddress);</p>
<p>}</p>
<p>2.基于axis发布的webservice获取客户端ip的方法</p>
<p>//<em>/</em></p>
<p>/* 获取客户端IP地址，如调用方的IP，以便检查权限。</p>
<p>/* 适用于axis发布的webservice</p>
<p>/* @return</p>
<p>/*/</p>
<p>public String getClientIpAxis() {</p>
<p>MessageContext mc = null;</p>
<p>HttpServletRequest request = null;</p>
<p>try {</p>
<p>mc = MessageContext.getCurrentMessageContext();</p>
<p>if (mc == null)</p>
<p>throw new Exception(“无法获取到MessageContext”);</p>
<p>request = (HttpServletRequest) mc</p>
<p>.getProperty(HTTPConstants.MC_HTTP_SERVLETREQUEST);</p>
<p>System.out.println(“remote ip: ” + request.getRemoteAddr());</p>
<p>} catch (Exception e) {</p>
<p>System.out.println(e.getMessage());</p>
<p>e.printStackTrace();</p>
<p>}</p>
<p>return request.getRemoteAddr();</p>
<p>}</p>
<p>3.基于xfire发布的webservice获取客户端ip的方法</p>
<p>//<em>/</em></p>
<p>/* 获取客户端IP地址</p>
<p>/* 适用于xfire发布的webservice</p>
<p>/* @return</p>
<p>/*/</p>
<p>public String getClientIpXfire() {</p>
<p>String ip = “”;</p>
<p>try {</p>
<p>HttpServletRequest request = XFireServletController.getRequest();</p>
<p>ip = request.getRemoteAddr();</p>
<p>} catch (Exception e) {</p>
<p>System.out.println(“无法获取HttpServletRequest.”);</p>
<p>e.printStackTrace();</p>
<p>}</p>
<p>return ip;</p>
<p>}
关键字：Java</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/webservice/">webservice</a></li></span></span> | <span class="tags">Tagged <a href="/tags/webservice/" class="label label-primary">webservice</a></span> | <span class="time">recent updated:<time title="2014-03-07 10:39:04"datetime="2014-03-07 10:39:04"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-webservice--Java开发的WebService获取客户端IP地址/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-webservice--Java开发的WebService获取客户端IP地址" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-webservice--Webservicesoapwsdl区别之个人见解/">Webservice soap wsdl区别之个人见解</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-webservice--Webservicesoapwsdl区别之个人见解/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="webservice-soap-wsdl-">Webservice soap wsdl区别之个人见解</h1>
<p><img src="" alt=""><img src="" alt=""> <img src="" alt=""> <a href="http://www.wudongqi.com/blogedit.asp?id=652" title="编辑该日志" target="_blank"><img src="" alt=""></a> <a href="http://www.wudongqi.com/blogedit.asp?action=del&amp;id=652" target="_blank"><img src="" alt=""></a>
    ● Web Service实现业务诉求：Web Service是真正“办事”的那个，提供一种办事接口的统称。
    ● WSDL提供“能办的事的文档说明”：对要提供的服务的一种描述格式。我想帮你的忙，但是我要告诉你我都能干什么，以及干这些事情需要的参数类型。
    ● SOAP提供“请求”的规范：向服务接口传递请求的格式，包括方法和参数等。你想让人家办事，总得告诉人家你想干什么吧，SOAP就是定义这个“请求”的格式的，按照SOAP定义的“请求”格式“书写”请求就可以保证Web Service能够正确的解读你想让它干什么以及你为它提供了什么参数。在这个请求中，你需要描述的主要问题有：向哪个Web Service发送请求，请求的参数类型、参数值、返回值类型。这些都“填写”完毕，也就完成了符合SOAP规范的SOAP消息。
    wsdl和soap虽然是web service的两大标准，但是两者并没有必然的联系，都可以独立使用。
    wsdl提供了一个统一的接口，目前已经成为一个国际上公认的标准，通过wsdl提供的接口可以访问不同类型的资源（如java、c/#、C、C、C++等），因为wsdl是基于xml，与语言平台无关的。另外wsdl提供了binding和service元素，用以绑定接口到具体的服务，实现了接口与实现的分离。
    soap（简单对象访问协议）是一种基于http的传输协议，用来访问远程服务
    wsdl与soap的关系在于：wsdl绑定服务的时候可以设定使用的协议，协议可以是soap、http、smtp、ftp等任何一种传输协议，除此以外wsdl还可以绑定jms、ejb及local java等等，不过都是需要对binding和service元素做扩展的，而且需要扩展服务器的功能以支持这种扩展
    soap协议是一种请求和应答协议规范，而http是web传输协议，soap的传输是可以基于http的，但也可以基于其他的传输协议，如ftp、smtp等。
    简单对象访问协议（SOAP）是W3C组织的一个Note, 它描述了一种在分散的或分布式的环境中如何交换信息的轻量级协议。SOAP是一个基于XML的协议，它包括三个部分：SOAP封装(Envelop)，封装定义了一个描述消息中的内容是什么，是谁发送的，谁应当接受并处理它以及如何处理它们的框架；SOAP编码规则（Encoding Rules），用于表示应用程序需要使用的数据类型的实例；SOAP RPC表示(RPC Representation)，表示远程过程调用和应答的协定；SOAP可以和多种传输协议绑定（Binding），使用底层协议交换信息。在这个文档中，目前只定义了SOAP如何和HTTP以及HTTP扩展进行绑定的框架。
    SOAP是个通信协议， SOAP在HTTP协议的基础上，把编写成XML的REQUEST参数, 放在HTTP BODY上提交个WEB SERVICE服务器(SERVLET，ASP什么的) 处理完成后，结果也写成XML作为RESPONSE送回用户端， 为了使用户端和WEB SERVICE可以相互对应，可以使用WSDL作为这种通信方式的描述文件，利用WSDL工具可以自动生成WS和用户端的框架文件，SOAP具备把复杂对象序列化捆绑到XML里去的能力。
    SOAP的前身是RPC, 就是远程呼叫处理的协议，这个协议安全性不是很好，多数防火墙都会阻挡RPC的通信包，而SOAP则使用HTTP协议作为基本的协议，使用端口80使得SOAP可以透过防火墙，完成RPC的功能。
    SOAP协议和HTTP协议一样，都是底层的通信协议，只是请求包的格式不同而已，SOAP包是XML格式的，现在我们编写WEB SERVICE不需要深入理解SOAP也没关系。如果SERVICE和CLIENT在同样的环境下使用SOAP，由于一般情况下都有自动生成SOAP程序框架的工具，因此不知道细节也没关系. 可是, 如果CLIENT和SERVICE的环境不同，比如说JAVA的Client和.NET的SERVICE进行通信，或者是VB CLIENT和TOMCAT下的JAVA SERVICE通信，还是要知道一点细节为好. 特别是, WSDL或者UDDI都不是标准，如果不让用就只好手工配制SOAP MESSAGE啦。</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/webservice/">webservice</a></li></span></span> | <span class="tags">Tagged <a href="/tags/webservice/" class="label label-primary">webservice</a></span> | <span class="time">recent updated:<time title="2014-03-07 10:27:47"datetime="2014-03-07 10:27:47"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-webservice--Webservicesoapwsdl区别之个人见解/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-webservice--Webservicesoapwsdl区别之个人见解" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/7/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/5/">5</a></li><li><a class="page-number" href="/page/6/">6</a></li><li><a class="page-number" href="/page/7/">7</a></li><li class="active"><li><span class="page-number current">8</span></li><li><a class="page-number" href="/page/9/">9</a></li><li><a class="page-number" href="/page/10/">10</a></li><li><a class="page-number" href="/page/11/">11</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/9/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 17:47:11</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
