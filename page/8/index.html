
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 8 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-ftp--ValidateXMLusingaXSD/">Validate XML using a XSD</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-ftp--ValidateXMLusingaXSD/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="validate-xml-using-a-xsd">Validate XML using a XSD</h1>
<p>1、xsd文件源;</p>
<p>SchemaFactory: newSchema(Source schema)</p>
<p>//<em>    Parser object is: com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl@c9ba38    Start document:     Start element: local name: PHONEBOOK qname: PHONEBOOK uri:     Characters:       Start element: local name: PERSON qname: PERSON uri:     Characters:        Start element: local name: NAME qname: NAME uri:     Attributes:      Name : firstName      Type : CDATA      Value: Joe      Name : lastName      Type : CDATA      Value: Yin    Characters: Joe    Characters:  Yin    End element: local name: NAME qname: NAME uri:     Characters:        Start element: local name: EMAIL qname: EMAIL uri:     Characters: joe@yourserver.com    End element: local name: EMAIL qname: EMAIL uri:     Characters:        Start element: local name: TELEPHONE qname: TELEPHONE uri:     Characters: 202-999-9999    End element: local name: TELEPHONE qname: TELEPHONE uri:     Characters:        Start element: local name: WEB qname: WEB uri:     Characters: www.java2s.com    End element: local name: WEB qname: WEB uri:     Characters:       End element: local name: PERSON qname: PERSON uri:     Characters:       End element: local name: PHONEBOOK qname: PHONEBOOK uri:     End document:      /</em>/    <strong>import </strong>java.io.StringReader;    <strong>import </strong>javax.xml.XMLConstants;    <strong>import </strong>javax.xml.parsers.ParserConfigurationException;    <strong>import </strong>javax.xml.parsers.SAXParser;    <strong>import </strong>javax.xml.parsers.SAXParserFactory;    <strong>import </strong>javax.xml.transform.sax.SAXSource;    <strong>import </strong>javax.xml.validation.SchemaFactory;    <strong>import </strong>org.xml.sax.Attributes;    <strong>import </strong>org.xml.sax.InputSource;    <strong>import </strong>org.xml.sax.SAXException;    <strong>import </strong>org.xml.sax.SAXParseException;    <strong>import </strong>org.xml.sax.helpers.DefaultHandler;    <strong>public class </strong>MainClass {      <strong>public static **</strong>void <strong>main(String args[])</strong>throws <strong>Exception {        SAXParserFactory spf = SAXParserFactory.newInstance();        SAXParser parser = </strong>null<strong>;        spf.setNamespaceAware(</strong>true<strong>);        </strong>try <strong>{         SchemaFactory sf =                         SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);          spf.setSchema(sf.newSchema(</strong>new <strong>SAXSource(</strong>new <strong>InputSource(</strong>new <strong>StringReader(schemaString)))));         parser = spf.newSAXParser();        }        </strong>catch<strong>(SAXException e) {          e.printStackTrace(System.err);          System.exit(1);            }         </strong>catch<strong>(ParserConfigurationException e) {          e.printStackTrace(System.err);          System.exit(1);            }        MySAXHandler handler = </strong>new <strong>MySAXHandler();         System.out.println(schemaString);        parser.parse(</strong>new <strong>InputSource(</strong>new <strong>StringReader(xmlString)), handler);      }      </strong>static <strong>String xmlString = &quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;&quot; +          &quot;<note>&quot; +          &quot;<to>rtoName</to>&quot; +          &quot;<from>FromName</from>&quot; +          &quot;<heading>Info</heading>&quot; +          &quot;<body>Message Body</body>&quot; +          &quot;</note>&quot;;            </strong>static <strong>String schemaString =&quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;&quot; +          &quot;<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"" +          " targetNamespace=\"http://www.java2s.com\"" +          " xmlns=\"http://www.java2s.com\"" +          " elementFormDefault=\"qualified\">&quot; +          &quot;<xs:element name=\"note\">&quot; +          &quot;<xs:complexType>&quot; +          &quot;<xs:sequence>&quot; +          &quot;<xs:element name=\"to\" type=\"xs:string\"/>&quot; +          &quot;<xs:element name=\"from\" type=\"xs:string\"/>&quot; +          &quot;<xs:element name=\"heading\" type=\"xs:string\"/>&quot; +          &quot;<xs:element name=\"body\" type=\"xs:string\"/>&quot; +          &quot;</xs:sequence>&quot; +                          &quot;</xs:complexType>&quot; +                          &quot;</xs:element>&quot; +                          &quot;</xs:schema>&quot;;    }    </strong>class <strong>MySAXHandler </strong>extends <strong>DefaultHandler {      </strong>public <strong>**void </strong>startDocument() {        System.out.println(&quot;Start document: &quot;);      }            <strong>public **</strong>void <strong>endDocument()  {        System.out.println(&quot;End document: &quot;);      }            </strong>public <strong>**void </strong>startElement(String uri, String localName, String qname,                                                                    Attributes attr)      {        System.out.println(&quot;Start element: local name: &quot; + localName + &quot; qname: &quot;                                                             + qname + &quot; uri: &quot;+uri);        <strong>int </strong>attrCount = attr.getLength();        <strong>if</strong>(attrCount&gt;0) {          System.out.println(&quot;Attributes:&quot;);           <strong>for</strong>(<strong>int </strong>i = 0 ; i&lt;attrCount ; i++) {            System.out.println(&quot;  Name : &quot; + attr.getQName(i));             System.out.println(&quot;  Type : &quot; + attr.getType(i));             System.out.println(&quot;  Value: &quot; + attr.getValue(i));           }        }       }            <strong>public **</strong>void <strong>endElement(String uri, String localName, String qname) {        System.out.println(&quot;End element: local name: &quot; + localName + &quot; qname: &quot;                                                             + qname + &quot; uri: &quot;+uri);      }            </strong>public <strong>**void </strong>characters(<strong>char</strong>[] ch, <strong>int </strong>start, <strong>int </strong>length) {        System.out.println(&quot;Characters: &quot; + <strong>new </strong>String(ch, start, length));      }      <strong>public **</strong>void <strong>ignorableWhitespace(</strong>char<strong>[] ch, </strong>int <strong>start, </strong>int <strong>length) {        System.out.println(&quot;Ignorable whitespace: &quot; + </strong>new <strong>String(ch, start, length));      }      </strong>public <strong>**void </strong>startPrefixMapping(String prefix, String uri) {        System.out.println(&quot;Start \&quot;&quot; + prefix + &quot;\&quot; namespace scope. URI: &quot; + uri);       }      <strong>public **</strong>void <strong>endPrefixMapping(String prefix) {        System.out.println(&quot;End \&quot;&quot; + prefix + &quot;\&quot; namespace scope.&quot;);       }      </strong>public <strong>**void </strong>warning(SAXParseException spe) {        System.out.println(&quot;Warning at line &quot;+spe.getLineNumber());        System.out.println(spe.getMessage());      }      <strong>public **</strong>void <strong>fatalError(SAXParseException spe) </strong>throws <strong>SAXException {        System.out.println(&quot;Fatal error at line &quot;+spe.getLineNumber());        System.out.println(spe.getMessage());        </strong>throw **spe;      }    }</p>
<p><a href="http://www.java2s.com/Code/JavaAPI/javax.xml.validation/SchemaFactorynewSchemaSourceschema.htm" target="_blank">http://www.java2s.com/Code/JavaAPI/javax.xml.validation/SchemaFactorynewSchemaSourceschema.htm</a></p>
<p>另外，可参考：</p>
<p>import java.io.IOException; // SAX import javax.xml.parsers.SAXParser; import javax.xml.parsers.SAXParserFactory; import org.xml.sax.XMLReader; //SAX and external XSD import javax.xml.transform.Source; import javax.xml.transform.stream.StreamSource; import javax.xml.validation.SchemaFactory; import javax.xml.parsers.ParserConfigurationException; import org.xml.sax.ErrorHandler; import org.xml.sax.SAXException; import org.xml.sax.SAXParseException; import org.xml.sax.InputSource; public class XMLUtils {   private XMLUtils() {}      // validate SAX and external XSD    public static boolean validateWithExtXSDUsingSAX(String xml, String xsd)    throws ParserConfigurationException, IOException    {     try {       SAXParserFactory factory = SAXParserFactory.newInstance();      factory.setValidating(false);        factory.setNamespaceAware(true);       SchemaFactory schemaFactory = SchemaFactory.newInstance(&quot;<a href="http://www.w3.org/2001/XMLSchema" target="_blank">http://www.w3.org/2001/XMLSchema</a>&quot;);       SAXParser parser = null;       try {          factory.setSchema(schemaFactory.newSchema(new Source[] {new StreamSource( xsd )}));          parser = factory.newSAXParser();       }       catch (SAXException se) {         System.out.println(&quot;SCHEMA : &quot; + se.getMessage());  // problem in the XSD itself         return false;       }              XMLReader reader = parser.getXMLReader();       reader.setErrorHandler(           new ErrorHandler() {             public void warning(SAXParseException e) throws SAXException {               System.out.println(&quot;WARNING: &quot; + e.getMessage()); // do nothing             }             public void error(SAXParseException e) throws SAXException {               System.out.println(&quot;ERROR : &quot; + e.getMessage());               throw e;             }             public void fatalError(SAXParseException e) throws SAXException {               System.out.println(&quot;FATAL : &quot; + e.getMessage());               throw e;             }           }           );       reader.parse(new InputSource(xml));       return true;     }         catch (ParserConfigurationException pce) {       throw pce;     }      catch (IOException io) {       throw io;     }     catch (SAXException se){       return false;   } } public static void main (String args[]) throws Exception{      System.out.println         (XMLUtils.validateWithExtXSDUsingSAX             (&quot;c:/temp/howto.xml&quot;, &quot;c:/temp/howto.xsd&quot;));     //<em>       output :                true     /</em>/              } }</p>
<p><a href="http://www.rgagnon.com/javadetails/java-0669.html" target="_blank"><a href="http://www.rgagnon.com/javadetails/java-0669.html">http://www.rgagnon.com/javadetails/java-0669.html</a></a></p>
<p>IBM教程上有这个，但是我测试失败：</p>
<p><a href="http://www.ibm.com/developerworks/cn/xml/tips/x-tipvalschm/#ibm-pcon"></a></p>
<h2 id="sax-">SAX 示例</h2>
<p><a href="http://www.ibm.com/developerworks/cn/xml/tips/x-tipvalschm/#code2" target="_blank">清单 2</a>演示了如何使用 JAXP 1.2 中的新特性，通过 SAX 解析器来验证文档。要使用 SAX 解析器来验证文档，请执行以下操作：</p>
<ol>
<li>创建一个          </li>
</ol>
<p>SAXParserFactory
对象。</p>
<ol>
<li>将 namespace-aware 和 validating 特性设置为 true。</li>
<li>获取          </li>
</ol>
<p>SAXParser
对象。</p>
<ol>
<li>设置模式语言和模式源的特性（这是 JAXP 1.2 和模式中新出现的）。</li>
<li>解析文档。解析器必须有权访问          </li>
</ol>
<p>ErrorHandler
对象。</p>
<h3 id="-2-validatesax-java-jaxp-1-2">清单 2. ValidateSAX.java 演示了 JAXP 1.2</h3>
<p>package org.ananas.tips; import java.io./<em>; import org.xml.sax./</em>; import javax.xml.parsers./*; public class ValidateSAX {    public static String SCHEMA_LANGUAGE =       &quot;<a href="http://java.sun.com/xml/jaxp/properties/schemaLanguage" target="_blank">http://java.sun.com/xml/jaxp/properties/schemaLanguage</a>&quot;,                         XML_SCHEMA =       &quot;<a href="http://www.w3.org/2001/XMLSchema" target="_blank">http://www.w3.org/2001/XMLSchema</a>&quot;,                         SCHEMA_SOURCE =       &quot;<a href="http://java.sun.com/xml/jaxp/properties/schemaSource" target="_blank">http://java.sun.com/xml/jaxp/properties/schemaSource</a>&quot;;    public final static void main(String[] args)       throws IOException, SAXException, ParserConfigurationException    {       if(args.length &lt; 2)       {          System.err.println(&quot;usage is:&quot;);          System.err.println(&quot;   java -jar tips.jar -validatesax &quot;                             + &quot;input.xml schema.xsd&quot;);          return;       }       File input = new File(args[0]),            schema = new File(args[1]);       SAXParserFactory factory = SAXParserFactory.newInstance();       factory.setNamespaceAware(true);       factory.setValidating(true);       SAXParser parser = factory.newSAXParser();       try       {          parser.setProperty(SCHEMA_LANGUAGE,XML_SCHEMA);          parser.setProperty(SCHEMA_SOURCE,schema);       }       catch(SAXNotRecognizedException x)       {          System.err.println(&quot;Your SAX parser is not JAXP 1.2 compliant.&quot;);       }       parser.parse(input,new ErrorPrinter());    } }</p>
<p><a href="http://www.ibm.com/developerworks/cn/xml/tips/x-tipvalschm/" target="_blank"><a href="http://www.ibm.com/developerworks/cn/xml/tips/x-tipvalschm/">http://www.ibm.com/developerworks/cn/xml/tips/x-tipvalschm/</a></a></p>
<p>有时间到话，可以在测试。</p>
<p>列下jaxp 1.2教程：</p>
<p>This release includes XML data and example programs showing how to use JAXP  to process XML. Additional examples can be found on the <a href="http://xml.apache.org" target="_blank"><a href="http://xml.apache.org">http://xml.apache.org</a></a> site.</p>
<ul>
<li><a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/docs/samples.html#files" target="_blank">Sample XML Files</a></li>
<li><a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/docs/samples.html#DOMEcho" target="_blank">Printing a DOM Tree</a></li>
<li><a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/docs/samples.html#SAXTagCount" target="_blank">SAX Program to Count Tags</a></li>
<li><a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/docs/samples.html#Schema" target="_blank">Schema Examples</a></li>
</ul>
<p>The example programs include a cross-platform <a href="http://jakarta.apache.org/ant/index.html" target="_blank">ant</a> build file that can be used to build and run the example. Ant is a build tool similar to</p>
<p>make
on Unix and</p>
<p>nmake
on WindowsNT that is also an XML application. To use <a href="http://jakarta.apache.org/ant/index.html" target="_blank">ant</a>, download it from the<a href="http://jakarta.apache.org/site/binindex.html" target="_blank">website</a> and read the install docs. Alternatively, you can also view the ant</p>
<p>build.xml
file to see what needs to be done to manually compile and run an example program on your platform.
<strong>Note:</strong>
 The ant utility uses the value of the</p>
<p>JAVA_HOME
environment  variable to determine which Java platform it uses to compile and run the  sample scripts. Make sure that variable points to the version you intend to  use. If using version 1.4, make sure that the JAXP jar files are installed,  as described in the <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/docs/ReleaseNotes.html" target="_blank">Release Notes.</a></p>
<p><a href=""></a></p>
<h3 id="sample-xml-files">Sample XML Files</h3>
<p>A handful of sample XML files have been provided in the &quot;samples&quot; subdirectory.  Note that the links may not work depending on your browser environment. Please  look in ../samples/data if the links do not display in your browser.</p>
<ul>
<li>A simple <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/book-order.xml" target="_blank">Purchase Order</a>    (</li>
</ul>
<p>book-order.xml
) suggesting how an on-line business might    send and receive data.</p>
<ul>
<li>The original <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/REC-xml-19980210.xml" target="_blank">XML    specification</a> (</li>
</ul>
<p>REC-xml-19980210.xml
) was written in XML.    With a prepublication version of <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/spec.dtd" target="_blank">its    Document Type Definition (DTD) file</a> (</p>
<p>spec.dtd
), it&#39;s    included here as a rather sophisticated example of how DTDs are used.</p>
<ul>
<li>Courtesy of Fuji Xerox, a short XML file in Japanese, using Japanese    tags. This is a <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/weekly-euc-jp.xml" target="_blank">weekly    report</a> (</li>
</ul>
<p>weekly-euc-jp.xml
) with <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/weekly-euc-jp.dtd" target="_blank">its DTD</a>    (</p>
<p>weekly-euc-jp.dtd
), which can be validated.</p>
<ul>
<li>From a large collection of XML sample documents at the <a href="ftp://sunsite.unc.edu/pub/sun-info/standards/xml/eg/">sunsite.unc.edu</a>    FTP server, <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/two_gent.xml" target="_blank">The Two Gentlemen of    Verona</a> (</li>
</ul>
<p>two_gent.xml
) and <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/rich_iii.xml" target="_blank">The Tragedy of Richard the Third</a>    (</p>
<p>rich_iii.xml
). These include <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/play.dtd" target="_blank">their DTD</a>  (</p>
<p>play.dtd
).</p>
<ul>
<li>A simple example showing the use of <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/namespace.xml" target="_blank">XML namespaces</a>    (</li>
</ul>
<p>namespace.xml
).</p>
<ul>
<li>A <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/personal-schema.xml" target="_blank">personal-schema.xml</a>    file containing some data that can be validated using its schema    definition, <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/data/personal.xsd" target="_blank">personal.xsd</a>.</li>
</ul>
<p><a href=""></a></p>
<h3 id="printing-a-dom-tree">Printing a DOM Tree</h3>
<p>One of the first things many programmers want to know is how to read an XML file and generate a DOM Document object from it. Use the <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/DOMEcho/DOMEcho.java" target="_blank">DOMEcho example</a> to learn how to do this in three steps. The important lines are:
    // Step 1: create a DocumentBuilderFactory and setNamespaceAware     DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();     dbf.setNamespaceAware(true);     // Step 2: create a DocumentBuilder     DocumentBuilder db = dbf.newDocumentBuilder();     // Step 3: parse the input file to get a Document object     Document doc = db.parse(new File(filename));</p>
<p>The program also gives an example of using an error handler and of setting optional configuration options, such as validation. Finally, this program helps you understand how DOM works by showing you the structure and contents of a DOM tree.</p>
<p><a href=""></a></p>
<h3 id="sax-program-to-count-tags">SAX Program to Count Tags</h3>
<p>The <a href="http://people.apache.org/%7Eedwingo/jaxp-ri-1.2.0-fcs/samples/SAXLocalNameCount/SAXLocalNameCount.java" target="_blank">SAXLocalNameCount</a>program counts the number of unique element local names in an XML document, ignoring the namespace name for simplicity. This example also shows one way to turn on DTD or XSD validation and how to use a SAX ErrorHandler.</p>
<p>There are several ways to parse a document using SAX and JAXP. We show one approach here. The first step is to bootstrap a parser. There are two ways: one is to use only the SAX API, the other is to use the JAXP utility classes in the javax.xml.parsers package. We use the second approach here because at the time of this writing it probably is the most portable solution for a JAXP compatible parser. After bootstrapping a parser/XMLReader, there are several ways to begin a parse. In this example, we use the SAX API.</p>
<h3 id="-schema-examples"><a href=""></a>Schema Examples</h3>
<p>Both of the sample programs include an option (-xsd) that lets you  validate the incoming document using XML Schema, instead of the document&#39;s DTD.  In addition, they include an -xsdss option that lets you specify the  &quot;schema source&quot; (the file that defines the schema for the document).</p>
<p>Both programs define the following constants:
    static final String JAXP_SCHEMA_LANGUAGE =         &quot;<a href="http://java.sun.com/xml/jaxp/properties/schemaLanguage" target="_blank">http://java.sun.com/xml/jaxp/properties/schemaLanguage</a>&quot;;     static final String W3C_XML_SCHEMA =         &quot;<a href="http://www.w3.org/2001/XMLSchema" target="_blank">http://www.w3.org/2001/XMLSchema</a>&quot;;     static final String JAXP_SCHEMA_SOURCE =         &quot;<a href="http://java.sun.com/xml/jaxp/properties/schemaSource" target="_blank">http://java.sun.com/xml/jaxp/properties/schemaSource</a>&quot;;</p>
<p>The schema language property defines the language the schema is written in.  The W3C XML Schema language is specified in these examples. The schema source  property directs the parser to a schema to use, regardless of any schema pointer  that the XML instance document may contain.</p>
<p>This code is abstracted from the SAX example:
    SAXParserFactory spf = SAXParserFactory.newInstance();     // Set namespaceAware to true to get a parser that corresponds to     // the default SAX2 namespace feature setting.  This is necessary     // because the default value from JAXP 1.0 was defined to be false.     spf.setNamespaceAware(true);     spf.setValidating(true);     SAXParser saxParser = spf.newSAXParser();     // Set the schema language if necessary     try {        saxParser.setProperty(JAXP_SCHEMA_LANGUAGE, W3C_XML_SCHEMA);     } catch (SAXNotRecognizedException x) {         // This can happen if the parser does not support JAXP 1.2         ...     }     ...    saxParser.setProperty(JAXP_SCHEMA_SOURCE, new File(schemaSource));</p>
<p>And here is the code abstracted from the DOM example:</p>
<pre><code>DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();     // Set namespaceAware to true to get a DOM Level 2 tree with nodes     // containing namesapce information.  This is necessary because the     // default value from JAXP 1.0 was defined to be false.     dbf.setNamespaceAware(true);     dbf.setValidating(true);     try {        dbf.setAttribute(JAXP_SCHEMA_LANGUAGE, W3C_XML_SCHEMA);     } catch (IllegalArgumentException x) {         // This can happen if the parser does not support JAXP 1.2         ...     }     // Specify other factory configuration settings    dbf.setAttribute(JAXP_SCHEMA_SOURCE, new File(schemaSource));     ...     DocumentBuilder db = dbf.newDocumentBuilder();
</code></pre><p>Note that the values are used to modify the SAX <em>parser,</em> using</p>
<p>setProperty(),
but they are used to modify the DOM parser<em>factory</em>, using</p>
<p>setAttribute()
.</p>
<p><a href="http://people.apache.org/~edwingo/jaxp-ri-1.2.0-fcs/docs/samples.html" target="_blank"><a href="http://people.apache.org/~edwingo/jaxp-ri-1.2.0-fcs/docs/samples.html">http://people.apache.org/~edwingo/jaxp-ri-1.2.0-fcs/docs/samples.html</a></a></p>
<p>另外一种，用 Validating Parser </p>
<p> Using the Validating Parser</p>
<p>By now, you have done a lot of experimenting with the nonvalidating parser. It&#39;s time to have a look at the validating parser to find out what happens when you use it to parse the sample presentation.</p>
<p>You need to understand about two things about the validating parser at the outset:</p>
<p>*</p>
<ul>
<li><p>A schema or document type definition (DTD) is required.</p>
</li>
<li><p>Because the schema or DTD is present, the</p>
</li>
</ul>
<p>ignorableWhitespace
method is invoked whenever possible.</p>
<h3 id="configuring-the-factory">Configuring the Factory</h3>
<p>The first step is to modify the Echo program so that it uses the validating parser instead of the nonvalidating parser.</p>
<p>Note: The code in this section is contained in</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10.java" target="_blank">Echo10.java</a>
.</p>
<p>To use the validating parser, make the following highlighted changes:
public static void main(String argv[]) {   if (argv.length != 1) {     ...   }   // Use the default (non-validating) parser  // Use the validating parser  SAXParserFactory factory = SAXParserFactory.newInstance();   factory.setValidating(true);  try {     ...</p>
<p>Here, you configure the factory so that it will produce a validating parser when</p>
<p>newSAXParser
is invoked. To configure it to return a namespace-aware parser, you can also use</p>
<p>setNamespaceAware(true)
. Sun&#39;s implementation supports any combination of configuration options. (If a combination is not supported by a particular implementation, it is required to generate a factory configuration error.)</p>
<h3 id="validating-with-xml-schema">Validating with XML Schema</h3>
<p>Although a full treatment of XML Schema is beyond the scope of this tutorial, this section shows you the steps you take to validate an XML document using an existing schema written in the XML Schema language. (To learn more about XML Schema, you can review the online tutorial, XML Schema Part 0: Primer, at</p>
<p><a href="http://www.w3.org/TR/xmlschema-0/" target="_blank"><a href="http://www.w3.org/TR/xmlschema-0/">http://www.w3.org/TR/xmlschema-0/</a></a>
. You can also examine the sample programs that are part of the JAXP download. They use a simple XML Schema definition to validate personnel data stored in an XML file.)</p>
<p>Note: There are multiple schema-definition languages, including RELAX NG, Schematron, and the W3C &quot;XML Schema&quot; standard. (Even a DTD qualifies as a &quot;schema,&quot; although it is the only one that does not use XML syntax to describe schema constraints.) However, &quot;XML Schema&quot; presents us with a terminology challenge. Although the phrase &quot;XML Schema schema&quot; would be precise, we&#39;ll use the phrase &quot;XML Schema definition&quot; to avoid the appearance of redundancy.</p>
<p>To be notified of validation errors in an XML document, the parser factory must be configured to create a validating parser, as shown in the preceding section. In addition, the following must be true:</p>
<p>*</p>
<ul>
<li>The appropriate properties must be set on the SAX parser.</li>
<li>The appropriate error handler must be set.</li>
<li>The document must be associated with a schema.</li>
</ul>
<h3 id="setting-the-sax-parser-properties">Setting the SAX Parser Properties</h3>
<p>It&#39;s helpful to start by defining the constants you&#39;ll use when setting the properties:
static final String JAXP_SCHEMA_LANGUAGE =     &quot;<a href="http://java.sun.com/xml/jaxp/properties/schemaLanguage" target="_blank">http://java.sun.com/xml/jaxp/properties/schemaLanguage</a>&quot;; static final String W3C_XML_SCHEMA =     &quot;<a href="http://www.w3.org/2001/XMLSchema" target="_blank">http://www.w3.org/2001/XMLSchema</a>&quot;;</p>
<p>Next, you configure the parser factory to generate a parser that is namespace-aware as well as validating:
...   SAXParserFactory factory = SAXParserFactory.newInstance();   factory.setNamespaceAware(true);  factory.setValidating(true);</p>
<p>You&#39;ll learn more about namespaces in <a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/JAXPDOM8.html#wp76446" target="_blank">Validating with XML Schema</a>. For now, understand that schema validation is a namespace-oriented process. Because JAXP-compliant parsers are not namespace-aware by default, it is necessary to set the property for schema validation to work.</p>
<p>The last step is to configure the parser to tell it which schema language to use. Here, you use the constants you defined earlier to specify the W3C&#39;s XML Schema language:
saxParser.setProperty(JAXP_SCHEMA_LANGUAGE, W3C_XML_SCHEMA);</p>
<p>In the process, however, there is an extra error to handle. You&#39;ll take a look at that error next.</p>
<h3 id="setting-up-the-appropriate-error-handling">Setting Up the Appropriate Error Handling</h3>
<p>In addition to the error handling you&#39;ve already learned about, there is one error that can occur when you are configuring the parser for schema-based validation. If the parser is not 1.2-compliant and therefore does not support XML Schema, it can throw a</p>
<p>SAXNotRecognizedException
.</p>
<p>To handle that case, you wrap the</p>
<p>setProperty()
statement in a</p>
<p>try
/</p>
<p>catch
block, as shown in the code highlighted here:
... SAXParser saxParser = factory.newSAXParser();try {  saxParser.setProperty(JAXP_SCHEMA_LANGUAGE, W3C_XML_SCHEMA); }  catch (SAXNotRecognizedException x) {  // Happens if the parser does not support JAXP 1.2   ...}...</p>
<h3 id="associating-a-document-with-a-schema">Associating a Document with a Schema</h3>
<p>Now that the program is ready to validate the data using an XML Schema definition, it is only necessary to ensure that the XML document is associated with one. There are two ways to do that:</p>
<p>*</p>
<ul>
<li><p>By including a schema declaration in the XML document</p>
</li>
<li><p>By specifying the schema to use in the application</p>
</li>
</ul>
<p>Note: When the application specifies the schema to use, it overrides any schema declaration in the document.</p>
<p>To specify the schema definition in the document, you create XML such as this:</p>
<p><documentRoot  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  xsi:noNamespaceSchemaLocation='YourSchemaDefinition.xsd' >   ...</p>
<p>The first attribute defines the XML namespace (</p>
<p>xmlns
) prefix,</p>
<p>xsi
, which stands for XML Schema instance. The second line specifies the schema to use for elements in the document that do not have a namespace prefix--that is, for the elements you typically define in any simple, uncomplicated XML document.</p>
<p>Note: You&#39;ll learn about namespaces in <a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/JAXPDOM8.html#wp76446" target="_blank">Validating with XML Schema</a>. For now, think of these attributes as the &quot;magic incantation&quot; you use to validate a simple XML file that doesn&#39;t use them. After you&#39;ve learned more about namespaces, you&#39;ll see how to use XML Schema to validate complex documents that use them. Those ideas are discussed in <a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/JAXPDOM8.html#wp63997" target="_blank">Validating with Multiple Namespaces</a>.</p>
<p>You can also specify the schema file in the application:
static final String JAXP_SCHEMA_SOURCE =     &quot;<a href="http://java.sun.com/xml/jaxp/properties/schemaSource" target="_blank">http://java.sun.com/xml/jaxp/properties/schemaSource</a>&quot;; ... SAXParser saxParser = spf.newSAXParser(); ...saxParser.setProperty(JAXP_SCHEMA_SOURCE,     new File(schemaSource));</p>
<p>Now that you know how to use an XML Schema definition, we&#39;ll turn to the kinds of errors you can see when the application is validating its incoming data. To do that, you&#39;ll use a document type definition (DTD) as you experiment with validation.</p>
<h3 id="experimenting-with-validation-errors">Experimenting with Validation Errors</h3>
<p>To see what happens when the XML document does not specify a DTD, remove the</p>
<p>DOCTYPE
statement from the XML file and run the Echo program on it.</p>
<p>Note: The output shown here is contained in</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10-01.txt" target="_blank">Echo10-01.txt</a>
. (The browsable version is</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10-01.html" target="_blank">Echo10-01.html</a>
.)</p>
<p>The result you see looks like this:
&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt; /<em>/</em> Parsing error, line 9, uri .../slideSample01.xml   Document root element &quot;slideshow&quot;, must match DOCTYPE root  &quot;null&quot;</p>
<p>Note: This message was generated by the JAXP 1.2 libraries. If you are using a different parser, the error message is likely to be somewhat different.</p>
<p>This message says that the root element of the document must match the element specified in the</p>
<p>DOCTYPE
declaration. That declaration specifies the document&#39;s DTD. Because you don&#39;t yet have one, it&#39;s value is null. In other words, the message is saying that you are trying to validate the document, but no DTD has been declared, because no</p>
<p>DOCTYPE
declaration is present.</p>
<p>So now you know that a DTD is a requirement for a valid document. That makes sense. What happens when you run the parser on your current version of the slide presentation, with the DTD specified?</p>
<p>Note: The output shown here is produced using</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/xml/samples/slideSample07.xml" target="_blank">slideSample07.xml</a>
, as described in <a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/IntroXML3.html#wp68336" target="_blank">Referencing Binary Entities</a>. The output is contained in</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10-07.txt" target="_blank">Echo10-07.txt</a>
. (The browsable version is</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10-07.html" target="_blank">Echo10-07.html</a>
.)</p>
<p>This time, the parser gives a different error message:
  /<em>/</em> Parsing error, line 29, uri file:...   The content of element type &quot;slide&quot; must match  &quot;(image?,title,item/*)</p>
<p>This message says that the element found at line 29 (</p>
<p><item>
) does not match the definition of the</p>
<p><slide>
element in the DTD. The error occurs because the definition says that the</p>
<p>slide
element requires a</p>
<p>title
. That element is not optional, and the copyright slide does not have one. To fix the problem, add a question mark to make</p>
<p>title
an optional element:
&lt;!ELEMENT slide (image?, title?, item/*)&gt;</p>
<p>Now what happens when you run the program?</p>
<p>Note: You could also remove the copyright slide, producing the same result shown next, as reflected in</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10-06.txt" target="_blank">Echo10-06.txt</a>
. (The browsable version is</p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/examples/jaxp/sax/samples/Echo10-06.html" target="_blank">Echo10-06.html</a>
.)</p>
<p>The answer is that everything runs fine until the parser runs into the</p>
<p><em>
tag contained in the overview slide. Because that tag is not defined in the DTD, the attempt to validate the document fails. The output looks like this:
  ...   ELEMENT: <title>   CHARS:   Overview   END_ELM: </title>   ELEMENT: <item>   CHARS:   Why /<em>/</em> Parsing error, line 28, uri: ...Element &quot;em&quot; must be declared.org.xml.sax.SAXParseException: ... ...</p>
<p>The error message identifies the part of the DTD that caused validation to fail. In this case it is the line that defines an</p>
<p>item
element as</p>
<p>(/#PCDATA | item)
.</p>
<p>As an exercise, make a copy of the file and remove all occurrences of</p>
<p><em>
from it. Can the file be validated now? (In the next section, you&#39;ll learn how to define parameter entries so that we can use XHTML in the elements we are defining as part of the slide presentation.)</p>
<h3 id="error-handling-in-the-validating-parser">Error Handling in the Validating Parser</h3>
<p>It is important to recognize that the only reason an exception is thrown when the file fails validation is as a result of the error-handling code you entered in the early stages of this tutorial. That code is reproduced here:
public void error(SAXParseException e) throws SAXParseException {   throw e;}</p>
<p>If that exception is not thrown, the validation errors are simply ignored. Try commenting out the line that throws the exception. What happens when you run the parser now?</p>
<p>In general, a SAX parsing error is a validation error, although you have seen that it can also be generated if the file specifies a version of XML that the parser is not prepared to handle. Remember that your application will not generate a validation exception unless you supply an error handler such as the one here. </p>
<p><a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/JAXPSAX9.html" target="_blank"><a href="http://docs.oracle.com/javaee/1.4/tutorial/doc/JAXPSAX9.html">http://docs.oracle.com/javaee/1.4/tutorial/doc/JAXPSAX9.html</a></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/ftp/">ftp</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ftp/" class="label label-primary">ftp</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-ftp--ValidateXMLusingaXSD/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-ftp--ValidateXMLusingaXSD" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-ftp--JSch-Java实现的SFTP（文件上传详解篇）/">JSch </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-ftp--JSch-Java实现的SFTP（文件上传详解篇）/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="jsch-java-sftp-">JSch - Java实现的SFTP（文件上传详解篇）</h1>
<p> JSch是Java Secure Channel的缩写。JSch是一个SSH2的纯Java实现。它允许你连接到一个SSH服务器，并且可以使用端口转发，X11转发，文件传输等，当然你也可以集成它的功能到你自己的应用程序。</p>
<p>  本文只介绍如何使用JSch实现的SFTP功能。
  SFTP 是Secure File Transfer Protocol的缩写，安全文件传送协议。可以为传输文件提供一种安全的加密方法。SFTP 为 SSH的一部份，是一种传输文件到服务器的安全方式。SFTP是使用加密传输认证信息和传输的数据，所以，使用SFTP是非常安全的。但是，由于这种传输 方式使用了加密/解密技术，所以传输效率比普通的FTP要低得多，如果您对网络安全性要求更高时，可以使用SFTP代替FTP。（来自百度的解释） </p>
<p>  要使用JSch，需要下载它的jar包，请从官网下载它：<a href="http://www.jcraft.com/jsch/" target="_blank"><a href="http://www.jcraft.com/jsch/">http://www.jcraft.com/jsch/</a></a></p>
<p>ChannelSftp类是JSch实现SFTP核心类，它包含了所有SFTP的方法，如：
put()：      文件上传</p>
<p>get()：      文件下载
cd()：       进入指定目录</p>
<p>ls()：       得到指定目录下的文件列表
rename()：   重命名指定文件或目录</p>
<p>rm()：       删除指定文件
mkdir()：    创建目录</p>
<p>rmdir()：    删除目录
等等（这里省略了方法的参数，put和get都有多个重载方法，具体请看源代码，这里不一一列出。）</p>
<p>JSch支持三种文件传输模式：</p>
<p><strong>OVERWRITE</strong> 完全覆盖模式，这是JSch的默认文件传输模式，即如果目标文件已经存在，传输的文件将完全覆盖目标文件，产生新的文件。 <strong>RESUME</strong> 
恢复模式，如果文件已经传输一部分，这时由于网络或其他任何原因导致文件传输中断，如果下一次传输相同的文件，</p>
<p>则会从上一次中断的地方续传。 <strong>APPEND</strong> 追加模式，如果目标文件已存在，传输的文件将在目标文件后追加。</p>
<p><strong>创建ChannelSftp对象</strong></p>
<p>编写一个工具类，根据ip，用户名及密码得到一个SFTP channel对象，即ChannelSftp的实例对象，在应用程序中就可以使用该对象来调用SFTP的各种操作方法。</p>
<p>SFTPChannel.java
<img src="" alt="">SFTPChannel.java</p>
<p>SFTPConstants是一个静态成员变量类：</p>
<p>SFTPConstans.java
<img src="" alt="">SFTPConstants.java</p>
<p><strong>文件上传</strong></p>
<p>实现文件上传可以调用ChannelSftp对象的put方法。ChannelSftp中有12个put方法的重载方法：</p>
<p><strong>public void put(String src, String dst)</strong> 
将本地文件名为src的文件上传到目标服务器，目标文件名为dst，若dst为目录，则目标文件名将与src文件名相同。</p>
<p>采用默认的传输模式：OVERWRITE <strong>public void put(String src, String dst, int mode)</strong> 
将本地文件名为src的文件上传到目标服务器，目标文件名为dst，若dst为目录，则目标文件名将与src文件名相同。</p>
<p>指定文件传输模式为mode（mode可选值为：ChannelSftp.OVERWRITE，ChannelSftp.RESUME，</p>
<p>ChannelSftp.APPEND）  </p>
<p><strong>public void put(String src, String dst, SftpProgressMonitor monitor)</strong></p>
<p>将本地文件名为src的文件上传到目标服务器，目标文件名为dst，若dst为目录，则目标文件名将与src文件名相同。</p>
<p>采用默认的传输模式：OVERWRITE</p>
<p>并使用实现了SftpProgressMonitor接口的monitor对象来监控文件传输的进度。 <strong>public void put(String src, String dst,</strong>
<strong>SftpProgressMonitor monitor, int mode)</strong></p>
<p>将本地文件名为src的文件上传到目标服务器，目标文件名为dst，若dst为目录，则目标文件名将与src文件名相同。</p>
<p>指定传输模式为mode</p>
<p>并使用实现了SftpProgressMonitor接口的monitor对象来监控文件传输的进度。 <strong>public void put(InputStream src, String dst)</strong> 
将本地的input stream对象src上传到目标服务器，目标文件名为dst，dst不能为目录。</p>
<p>采用默认的传输模式：OVERWRITE <strong>public void put(InputStream src, String dst, int mode)</strong> 
将本地的input stream对象src上传到目标服务器，目标文件名为dst，dst不能为目录。</p>
<p>指定文件传输模式为mode <strong>public void put(InputStream src, String dst, SftpProgressMonitor monitor)</strong></p>
<p>将本地的input stream对象src上传到目标服务器，目标文件名为dst，dst不能为目录。</p>
<p>采用默认的传输模式：OVERWRITE</p>
<p>并使用实现了SftpProgressMonitor接口的monitor对象来监控传输的进度。 <strong>public void put(InputStream src, String dst,</strong>
<strong>SftpProgressMonitor monitor, int mode)</strong></p>
<p>将本地的input stream对象src上传到目标服务器，目标文件名为dst，dst不能为目录。</p>
<p>指定文件传输模式为mode</p>
<p>并使用实现了SftpProgressMonitor接口的monitor对象来监控传输的进度。 <strong>public OutputStream put(String dst)</strong> 
该方法返回一个输出流，可以向该输出流中写入数据，最终将数据传输到目标服务器，目标文件名为dst，dst不能为目录。</p>
<p>采用默认的传输模式：OVERWRITE <strong>public OutputStream put(String dst, final int mode)</strong> 
该方法返回一个输出流，可以向该输出流中写入数据，最终将数据传输到目标服务器，目标文件名为dst，dst不能为目录。</p>
<p>指定文件传输模式为mode <strong>public OutputStream put(String dst, final SftpProgressMonitor monitor, final int mode) </strong> 
该方法返回一个输出流，可以向该输出流中写入数据，最终将数据传输到目标服务器，目标文件名为dst，dst不能为目录。</p>
<p>指定文件传输模式为mode</p>
<p>并使用实现了SftpProgressMonitor接口的monitor对象来监控传输的进度。 <strong>public OutputStream put(String dst, final SftpProgressMonitor monitor, final int mode, long offset)</strong> 
该方法返回一个输出流，可以向该输出流中写入数据，最终将数据传输到目标服务器，目标文件名为dst，dst不能为目录。</p>
<p>指定文件传输模式为mode</p>
<p>并使用实现了SftpProgressMonitor接口的monitor对象来监控传输的进度。</p>
<p>offset指定了一个偏移量，从输出流偏移offset开始写入数据。</p>
<p><strong>应用实例：</strong></p>
<p>SFTPTest.java
<img src="" alt="">SFTPTest.java</p>
<p><strong>注</strong>：请分别将代码段1，代码段2，代码段3取消注释，运行程序来进行测试。这三段代码分别演示了如何使用JSch的不同的put方法来进行文件上传。</p>
<p><strong>代码段1</strong>：采用向put方法返回的输出流中写入数据的方式来传输文件。 需要由程序来决定写入什么样的数据，这里是将本地文件的输入流写入输出流。采用这种方式的好处是，可以自行设定每次写入输出流的数据块大小，如本示例中的语句：
byte[] buff = new byte[1024 /* 256]; // 设定每次传输的数据块大小为256KB</p>
<p><strong>代码段2</strong>：直接将本地文件名为src的文件上传到目标服务器，目标文件名为dst。（注：使用这个方法时，dst可以是目录，当dst是目录时，上传后的目标文件名将与src文件名相同）</p>
<p><strong>代码段3</strong>：将本地文件名为src的文件输入流上传到目标服务器，目标文件名为dst。</p>
<p>这三段代码实现的功能是一样的，都是将本地的文件src上传到了服务器的dst文件。使用时可根据具体情况选择使用哪种实现方式。</p>
<p><strong>监控传输进度</strong></p>
<p>从前面的介绍中知道，JSch支持在文件传输时对传输进度的监控。可以实现JSch提供的SftpProgressMonitor接口来完成这个功能。</p>
<p>SftpProgressMonitor接口类的定义为：
<img src="" alt="">SftpProgressMonitor.java</p>
<p><strong>init():    </strong>当文件开始传输时，调用init方法。</p>
<p><strong>count():  </strong> 当每次传输了一个数据块后，调用count方法，count方法的参数为这一次传输的数据块大小。</p>
<p><strong>end():     </strong>当传输结束时，调用end方法。</p>
<p>下面是一个简单的实现：</p>
<p>MyProgressMonitor.java
<img src="" alt="">MyProgressMonitor.java</p>
<p>此时如果改变SFTPTest main方法里调用的put方法，即可实现监控传输进度：</p>
<p>SFTPTest.java
<img src="" alt="">SFTPTest.java</p>
<p>注意修改的内容仅仅是put方法，在put方法中增加了SftpProgressMonitor的实现类对象monitor作为参数，即添加了对进度监控的支持。</p>
<p>运行，输出结果如下：
<img src="" alt="">logs</p>
<p>当然这个SftpProgressMonitor的实现实在太简单。JSch每次传输一个数据块，就会调用count方法来实现主动进度通知。</p>
<p>现在我们希望每间隔一定的时间才获取一下文件传输的进度。。。看看下面的SftpProgressMonitor实现：
<img src="" alt=""></p>
<p><a href="&quot;复制代码&quot;"><img src="" alt="复制代码"></a></p>
<p>package</p>
<p>com.longyg.sftp;
 import java.text.DecimalFormat;import java.util.Timer;import</p>
<p>java.util.TimerTask;
 import</p>
<p>com.jcraft.jsch.SftpProgressMonitor;
 public class FileProgressMonitor extends TimerTask implements</p>
<p>SftpProgressMonitor {</p>
<p>private long progressInterval = 5 /* 1000; // 默认间隔时间为5秒</p>
<p>private boolean isEnd = false; // 记录传输是否结束</p>
<p>private long transfered; // 记录已传输的数据总大小</p>
<p>private long fileSize; // 记录文件总大小</p>
<p>private Timer timer; // 定时器对象</p>
<p>private boolean isScheduled = false; // 记录是否已启动timer记时器</p>
<p>public FileProgressMonitor(long</p>
<p>fileSize) {
 this.fileSize =</p>
<p>fileSize;
    }</p>
<pre><code>@Override
</code></pre><p>public void</p>
<p>run() {
 if (!isEnd()) { // 判断传输是否已结束</p>
<pre><code>        System.out.println(&quot;Transfering is in progress.&quot;
</code></pre><p>);
 long transfered =</p>
<p>getTransfered();
 if (transfered != fileSize) { // 判断当前已传输数据大小是否等于文件总大小</p>
<pre><code>            System.out.println(&quot;Current transfered: &quot; + transfered + &quot; bytes&quot;
</code></pre><p>);
                sendProgressMessage(transfered);</p>
<pre><code>        }
</code></pre><p>else</p>
<p>{
                System.out.println(&quot;File transfering is done.&quot;</p>
<p>);
                setEnd(true); // 如果当前已传输数据大小等于文件总大小，说明已完成，设置end</p>
<pre><code>        }
    }else
</code></pre><p>{
            System.out.println(&quot;Transfering done. Cancel timer.&quot;</p>
<p>);
            stop();// 如果传输结束，停止timer记时器</p>
<p> return</p>
<p>;
        }</p>
<pre><code>}
</code></pre><p>public void</p>
<p>stop() {
        System.out.println(&quot;Try to stop progress monitor.&quot;</p>
<p>);
 if (timer != null</p>
<p>) {
            timer.cancel();</p>
<pre><code>        timer.purge();
        timer= null
</code></pre><p>;
            isScheduled= false</p>
<p>;
        }</p>
<pre><code>    System.out.println(
</code></pre><p>&quot;Progress monitor stoped.&quot;</p>
<p>);
    }</p>
<p> public void</p>
<p>start() {
        System.out.println(&quot;Try to start progress monitor.&quot;</p>
<p>);
 if (timer == null</p>
<p>) {
            timer= new</p>
<p>Timer();
        }</p>
<pre><code>    timer.schedule(
</code></pre><p>this, 1000</p>
<p>, progressInterval);
        isScheduled= true</p>
<p>;
        System.out.println(&quot;Progress monitor started.&quot;</p>
<p>);
    }</p>
<p> //<em>/</em></p>
<pre><code> /* 打印progress信息

 /*
</code></pre><p>@param</p>
<p>transfered
 /*/</p>
<p> private void sendProgressMessage(long</p>
<p>transfered) {
 if (fileSize != 0</p>
<p>) {
 double d = ((double)transfered /* 100)/(double</p>
<p>)fileSize;
            DecimalFormat df= new DecimalFormat( &quot;/#./#/#&quot;</p>
<p>);
            System.out.println(&quot;Sending progress message: &quot; + df.format(d) + &quot;%&quot;</p>
<p>);
        }else</p>
<p>{
            System.out.println(&quot;Sending progress message: &quot; +</p>
<p>transfered);
        }</p>
<pre><code>}
</code></pre><p>//<em>/</em></p>
<pre><code> /* 实现了SftpProgressMonitor接口的count方法
</code></pre><p>/*/</p>
<p> public boolean count(long</p>
<p>count) {
 if (isEnd()) return false</p>
<p>;
 if (!</p>
<p>isScheduled) {
            start();</p>
<pre><code>    }
    add(count);
</code></pre><p>return true</p>
<p>;
    }</p>
<p> //<em>/</em></p>
<pre><code> /* 实现了SftpProgressMonitor接口的end方法
</code></pre><p>/*/</p>
<p> public void</p>
<p>end() {
        setEnd(true</p>
<p>);
        System.out.println(&quot;transfering end.&quot;</p>
<p>);
    }</p>
<p> private synchronized void add(long</p>
<p>count) {
        transfered= transfered +</p>
<p>count;
    }</p>
<p> private synchronized long</p>
<p>getTransfered() {
 return</p>
<p>transfered;
    }</p>
<p> public synchronized void setTransfered(long</p>
<p>transfered) {
 this.transfered =</p>
<p>transfered;
    }</p>
<p> private synchronized void setEnd(boolean</p>
<p>isEnd) {
 this.isEnd =</p>
<p>isEnd;
    }</p>
<p> private synchronized boolean</p>
<p>isEnd() {
 return</p>
<p>isEnd;
    }</p>
<p> public void init(int op, String src, String dest, long</p>
<p>max) {
 // Not used for putting InputStream</p>
<pre><code>}
</code></pre><p>}
<a href="&quot;复制代码&quot;"><img src="" alt="复制代码"></a></p>
<p>再次修改SFTPTest main方法里的put方法，改为使用新的SftpProgressMonitor的实现类对象monitor作为参数，注意新的monitor对象的构造函数需要传入文件大小作为参数：
<img src="" alt=""></p>
<p><a href="&quot;复制代码&quot;"><img src="" alt="复制代码"></a></p>
<p>package</p>
<p>com.longyg.sftp;
 import java.io.File;import java.util.HashMap;import</p>
<p>java.util.Map;
 import</p>
<p>com.jcraft.jsch.ChannelSftp;
 public class</p>
<p>SFTPTest {</p>
<p>public</p>
<p>SFTPChannel getSFTPChannel() {
 return new</p>
<p>SFTPChannel();
    }</p>
<p> //<em>/</em></p>
<pre><code> /*@param
</code></pre><p>args
     /*@throws</p>
<p>Exception
 /*/</p>
<p> public static void main(String[] args) throws</p>
<p>Exception {
        SFTPTest test= new</p>
<p>SFTPTest();</p>
<pre><code>    Map
</code></pre><p><String, String> sftpDetails = new HashMap<String, String></p>
<p>();
 // 设置主机ip，端口，用户名，密码</p>
<pre><code>    sftpDetails.put(SFTPConstants.SFTP_REQ_HOST, &quot;10.9.167.55&quot;
</code></pre><p>);
        sftpDetails.put(SFTPConstants.SFTP_REQ_USERNAME,&quot;root&quot;</p>
<p>);
        sftpDetails.put(SFTPConstants.SFTP_REQ_PASSWORD,&quot;arthur&quot;</p>
<p>);
        sftpDetails.put(SFTPConstants.SFTP_REQ_PORT,&quot;22&quot;</p>
<p>);</p>
<pre><code>    String src
</code></pre><p>= &quot;D:\DevSoft\HB-SnagIt1001.rar&quot;; // 本地文件名</p>
<pre><code>    String dst = &quot;/home/omc/ylong/sftp/HB-SnagIt1001.rar&quot;;// 目标文件名


    SFTPChannel channel=
</code></pre><p>test.getSFTPChannel();
        ChannelSftp chSftp= channel.getChannel(sftpDetails, 60000</p>
<p>);</p>
<pre><code>    File file
</code></pre><p>= new</p>
<p>File(src);
 long fileSize =</p>
<p>file.length();</p>
<p>//<em>/</em></p>
<pre><code>     /* 代码段1

    OutputStream out = chSftp.put(dst, new FileProgressMonitor(fileSize), ChannelSftp.OVERWRITE); // 使用OVERWRITE模式
    byte[] buff = new byte[1024 /* 256]; // 设定每次传输的数据块大小为256KB

    int read;
    if (out != null) {

        System.out.println(&quot;Start to read input stream&quot;);
        InputStream is = new FileInputStream(src);

        do {
            read = is.read(buff, 0, buff.length);

            if (read &gt; 0) {
                out.write(buff, 0, read);

            }
            out.flush();

        } while (read &gt;= 0);
        System.out.println(&quot;input stream read done.&quot;);

    }
    /*/*/




    chSftp.put(src, dst,
</code></pre><p>new FileProgressMonitor(fileSize), ChannelSftp.OVERWRITE); //</p>
<p>代码段2</p>
<p>// chSftp.put(new FileInputStream(src), dst, new FileProgressMonitor(fileSize), ChannelSftp.OVERWRITE); // 代码段3</p>
<pre><code>    chSftp.quit();

    channel.closeChannel();
}
</code></pre><p>}
<a href="&quot;复制代码&quot;"><img src="" alt="复制代码"></a></p>
<p>再次运行，结果输出为： 
<img src="" alt=""></p>
<p><a href="&quot;复制代码&quot;"><img src="" alt="复制代码"></a></p>
<p>Try to start progress monitor.</p>
<p>Progress monitor started.
Transfering is in progress.</p>
<p>Current transfered: 98019 bytes
Sending progress message: 2.55%</p>
<p>Transfering is in progress.
Current transfered: 751479 bytes</p>
<p>Sending progress message: 19.53%
Transfering is in progress.</p>
<p>Current transfered: 1078209 bytes
Sending progress message: 28.02%</p>
<p>......
Transfering is in progress.</p>
<p>Current transfered: 3430665 bytes
Sending progress message: 89.15%</p>
<p>transfering end.
Transfering done. Cancel timer.</p>
<p>Try to stop progress monitor.
Progress monitor stoped.
<a href="&quot;复制代码&quot;"><img src="" alt="复制代码"></a></p>
<p>现在，程序每隔5秒钟才会打印一下进度信息。可以修改FileProgressMonitor类里的progressInterval变量的值，来修改默认的间隔时间。</p>
<p>来源： <a href="[http://www.cnblogs.com/longyg/archive/2012/06/25/2556576.html](http://www.cnblogs.com/longyg/archive/2012/06/25/2556576.html)">[http://www.cnblogs.com/longyg/archive/2012/06/25/2556576.html](http://www.cnblogs.com/longyg/archive/2012/06/25/2556576.html)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/ftp/">ftp</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ftp/" class="label label-primary">ftp</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-ftp--JSch-Java实现的SFTP（文件上传详解篇）/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-ftp--JSch-Java实现的SFTP（文件上传详解篇）" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-ftp--FTP的主动模式/">FTP的主动模式</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-ftp--FTP的主动模式/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="ftp-">FTP的主动模式</h1>
<p>FTP的主动模式(active mode)和被动模式(passive mode)：(转)</p>
<p>FTP的主动模式(active mode)和被动模式(passive mode)：(转)</p>
<p>2010-03-01 23:57
大多数的TCP服务是使用单个的连接，一般是客户向服务器的一个周知端口发起连接，然后使用这个连接进行通讯。但是，FTP协议却有所不同，它使用双向的多个连接 ，而且使用的端口很难预计。一般，FTP连接包括：
一个控制连接 (control connection)
这个连接用于传递客户端的命令和服务器端对命令的响应。它使用服务器的21端口，生存期是整个FTP会话时间。
几个数据连接 (data connection)
这些连接用于传输文件和其它数据，例如：目录列表等。这种连接在需要数据传输时建立，而一旦数据传输完毕就关闭，每次使用的端口也不一定相同。而且，数据 连接既可能是客户端发起的，也可能是服务器端发起的。
在FTP协议中，控制连接使用周知端口21 ，因此使用ISA的IP PACKET FILTER就可以这种连接进行很好的安全保护。相反，数据传输连接的目的端口通常实现无法知道，因此处理这样的端口转发非常困难。F</p>
<p>TP协议使用一个标准的端口21作为ftp-data端口，但是这个端口只用于连接的源地址是服务器端的情况，在这个端口上根本就没有监听进程。</p>
<p>FTP的数据连接和控制连接的方向一般是相反的，也就是说，是服务器向客户端发起一个用于数据传输的连接。连接的端口是由服务器端和客户端协商确定的。FTP协议 的这个特征对ISA 转发以及防火墙和NAT的配置增加了很多困难。
除此之外，还有另外一种FTP模式，叫做被动模式 (passive mod)。在这种模式下，数据连接是由客户程序发起的，和刚才讨论过的模式(我们可以叫做主动模式 )相反。</p>
<p>是否采取被动模式取决于客户程序，在ftp命令行中使用passive命令就可以关闭/打开被动模式。</p>
<p><strong>iptables**</strong>中配置vsftp**</p>
<p>问题：配置iptables后， vsftpd不能用。常见现象是能够登录到服务器，LIST列目录失败(超时)。</p>
<p>分析：</p>
<p>主动模式 下，客户连接 TCP/21，服务器通过 TCP/20 连接客户的随机端口 </p>
<p>————这种情况下，通过状态防火墙可以解决 iptables -A INPUT -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT
被动模式 下，客户连接 TCP/21，客户再通过其他端口连接服务器的随机端口</p>
<p>卡住的原因，是因为服务器在被动模式下没有打开临时端口让 client 连过来，因此需要几个条件</p>
<p>1、client 没有防火墙时，用主动模式连接即可
2、server 没有防火墙时，用被动模式即可
3、双方都有防火墙时，vsftpd 设置被动模式高端口范围，server 打开那段范围，client 用被动模式连接即可
4、加载 ip_conntrack_ftp 模块，使 server 支持 connection tracking，支持临时打洞，client 用被动模式即可
5、server 使用 ip_conntrack_ftp、client 使用 ip_conntrack_ftp 和 ip_nat_ftp，支持临时打洞和临时 NAT 穿越打洞，双方使用主动或被动模式均可</p>
<ul>
<li>“打洞”的配置说明：</li>
<li>优点：不影响ftp配置；缺点： 客户会感觉到连接有些延迟。原因参见ip_conntract的实现原理</li>
</ul>
<p>在/etc/modprobe.conf中添加
alias ip_conntrack ip_conntract_ftp ip_nat_ftp</p>
<p>在/etc/rc.local中添加</p>
<p>/sbin/modprobe ip_conntract
/sbin/modprobe  ip_conntrack_ftp
/sbin/modprobe  ip_nat_ftp</p>
<p>这个作用就是完成上面所说的“临时打洞”的方法。</p>
<ul>
<li>限制被动模式连接端口的配置说明</li>
<li>优点：对连接速度没有影响。缺点： 限制了被动模式下，客户端并发连接的数量。</li>
</ul>
<p>在/etc/vsftpd/vsftpd.conf中添加
pasv_min_port=2222
pasv_max_port=2225</p>
<p>iptables中开放这段端口</p>
<p>-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 21 -j ACCEPT
-A INPUT -p tcp --dport 2222:2225 -j ACCEPT</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/ftp/">ftp</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ftp/" class="label label-primary">ftp</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-ftp--FTP的主动模式/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-ftp--FTP的主动模式" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-ftp--ApacheFTP实用代码/">Apache FTP 实用代码</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-ftp--ApacheFTP实用代码/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="apache-ftp-">Apache FTP 实用代码</h1>
<h2 id="-apache-commons-net-ftputil-">结合网上两个使用apache commons-net包的两个优秀的代码，结合实际，写出了如下的FtpUtil，供参考！</h2>
<p>参考网址：<a href="http://www.iteye.com/topic/173786" target="_blank"><a href="http://www.iteye.com/topic/173786">http://www.iteye.com/topic/173786</a></a>，<a href="http://hi.baidu.com/victorlin23/blog/item/edc62a35dbae8a1a91ef3947.html" target="_blank"><a href="http://hi.baidu.com/victorlin23/blog/item/edc62a35dbae8a1a91ef3947.html">http://hi.baidu.com/victorlin23/blog/item/edc62a35dbae8a1a91ef3947.html</a></a></p>
<h2 id="-"> </h2>
<p>package com.pccw.portlet.publictools;</p>
<p>import java.io.File;</p>
<p>import java.io.FileOutputStream;</p>
<p>import java.io.IOException;</p>
<p>import java.io.InputStream;</p>
<p>import java.io.OutputStream;</p>
<p>import java.io.RandomAccessFile;</p>
<p>import java.net.SocketException;</p>
<p>import java.util.ArrayList;</p>
<p>import java.util.List;</p>
<p>import org.apache.commons.logging.Log;</p>
<p>import org.apache.commons.logging.LogFactory;</p>
<p>import org.apache.commons.net.ftp.FTP;</p>
<p>import org.apache.commons.net.ftp.FTPClient;</p>
<p>import org.apache.commons.net.ftp.FTPFile;</p>
<p>import org.apache.commons.net.ftp.FTPReply;</p>
<p>//<em>/</em></p>
<p> /* FTP工具类</p>
<p> /*</p>
<p> /* @author WangXianfeng 1:16:50 PM Jul 16, 2011</p>
<p> /*/</p>
<p>public class FtpUtil {</p>
<pre><code>   private FTPClient ftpClient;

   private static Log log = LogFactory.getLog(FtpUtil.class);



   //*/*

    /* 根路径为&quot;/&quot;,如果需要链接服务器之后跳转到路径，则在path中定义

    /* @param ftpConfig

    /* @throws SocketException

    /* @throws IOException

    /*/

   public boolean connectServer(FtpConfig ftpConfig) throws SocketException,

                 IOException {

          String server = ftpConfig.getServer();

          int port = ftpConfig.getPort();

          String user = ftpConfig.getUsername();

          String password = ftpConfig.getPassword();

          String path = ftpConfig.getPath();

          return connectServer(server, port, user, password, path);

   }

   //*/*

    /* 连接ftp服务器

    /* @param server 服务器ip

    /* @param port 端口，通常为21

    /* @param user 用户名

    /* @param password 密码

    /* @param path 进入服务器之后的默认路径

    /* @return 连接成功返回true，否则返回false

    /* @throws SocketException

    /* @throws IOException

    /*/

   public boolean connectServer(String server, int port, String user,

                 String password, String path) throws SocketException, IOException {

          ftpClient = new FTPClient();

          ftpClient.connect(server, port);

          ftpClient.setControlEncoding(&quot;GBK&quot;);

          log.info(&quot;Connected to &quot; + server + &quot;.&quot;);

          log.info(&quot;FTP server reply code:&quot; + ftpClient.getReplyCode());

          if (FTPReply.isPositiveCompletion(ftpClient.getReplyCode())) {

                 if (ftpClient.login(user, password)) {

                        // Path is the sub-path of the FTP path

                        if (path.length() != 0) {

                               ftpClient.changeWorkingDirectory(path);

                        }

                        return true;

                 }

          }

          disconnect();

          return false;

   }

   //*/*

    /* 断开与远程服务器的连接

    /* @throws IOException

    /*/

   public void disconnect() throws IOException {

          if (ftpClient.isConnected()) {

                 ftpClient.disconnect();

          }

   }



   //*/*

    /* 从FTP服务器上下载文件,支持断点续传，下载百分比汇报

    /* @param remote 远程文件路径及名称

    /* @param local 本地文件完整绝对路径

    /* @return 下载的状态

    /* @throws IOException

    /*/

   public DownloadStatus download(String remote, String local)

                 throws IOException {

          // 设置被动模式

          ftpClient.enterLocalPassiveMode();

          // 设置以二进制方式传输

          ftpClient.setFileType(FTP.BINARY_FILE_TYPE);

          DownloadStatus result;



          // 检查远程文件是否存在

          FTPFile[] files = ftpClient.listFiles(new String(

                        remote.getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;));

          if (files.length != 1) {

                 log.info(&quot;远程文件不存在&quot;);

                 return DownloadStatus.RemoteFileNotExist;

          }



          long lRemoteSize = files[0].getSize();

          File f = new File(local);

          // 本地存在文件，进行断点下载

          if (f.exists()) {

                 long localSize = f.length();

                 // 判断本地文件大小是否大于远程文件大小

                 if (localSize &gt;= lRemoteSize) {

                        log.info(&quot;本地文件大于远程文件，下载中止&quot;);

                        return DownloadStatus.LocalFileBiggerThanRemoteFile;

                 }



                 // 进行断点续传，并记录状态

                 FileOutputStream out = new FileOutputStream(f, true);

                 ftpClient.setRestartOffset(localSize);

                 InputStream in = ftpClient.retrieveFileStream(new String(remote

                               .getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;));

                 byte[] bytes = new byte[1024];

                 long step = lRemoteSize / 100;

                 step = step==0?1:step;//文件过小，step可能为0

                 long process = localSize / step;

                 int c;

                 while ((c = in.read(bytes)) != -1) {

                        out.write(bytes, 0, c);

                        localSize += c;

                        long nowProcess = localSize / step;

                        if (nowProcess &gt; process) {

                               process = nowProcess;

                               if (process % 10 == 0){

                                      log.info(&quot;下载进度：&quot; + process);

                               }

                        }

                 }

                 in.close();

                 out.close();

                 boolean isDo = ftpClient.completePendingCommand();

                 if (isDo) {

                        result = DownloadStatus.DownloadFromBreakSuccess;

                 } else {

                        result = DownloadStatus.DownloadFromBreakFailed;

                 }

          } else {

                 OutputStream out = new FileOutputStream(f);

                 InputStream in = ftpClient.retrieveFileStream(new String(remote

                               .getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;));

                 byte[] bytes = new byte[1024];

                 long step = lRemoteSize / 100;

                 step = step==0?1:step;//文件过小，step可能为0

                 long process = 0;

                 long localSize = 0L;

                 int c;

                 while ((c = in.read(bytes)) != -1) {

                        out.write(bytes, 0, c);

                        localSize += c;

                        long nowProcess = localSize / step;

                        if (nowProcess &gt; process) {

                               process = nowProcess;

                               if (process % 10 == 0){

                                      log.info(&quot;下载进度：&quot; + process);

                               }

                        }

                 }

                 in.close();

                 out.close();

                 boolean upNewStatus = ftpClient.completePendingCommand();

                 if (upNewStatus) {

                        result = DownloadStatus.DownloadNewSuccess;

                 } else {

                        result = DownloadStatus.DownloadNewFailed;

                 }

          }

          return result;

   }



   public boolean changeDirectory(String path) throws IOException {

          return ftpClient.changeWorkingDirectory(path);

   }



   public boolean createDirectory(String pathName) throws IOException {

          return ftpClient.makeDirectory(pathName);

   }



   public boolean removeDirectory(String path) throws IOException {

          return ftpClient.removeDirectory(path);

   }



   public boolean removeDirectory(String path, boolean isAll)

                 throws IOException {



          if (!isAll) {

                 return removeDirectory(path);

          }



          FTPFile[] ftpFileArr = ftpClient.listFiles(path);

          if (ftpFileArr == null || ftpFileArr.length == 0) {

                 return removeDirectory(path);

          }

          //  

          for (FTPFile ftpFile : ftpFileArr) {

                 String name = ftpFile.getName();

                 if (ftpFile.isDirectory()) {

                        log.info(&quot;/* [sD]Delete subPath [&quot; + path + &quot;/&quot; + name + &quot;]&quot;);

                        if (!ftpFile.getName().equals(&quot;.&quot;)

                                      &amp;&amp; (!ftpFile.getName().equals(&quot;..&quot;))) {

                               removeDirectory(path + &quot;/&quot; + name, true);

                        }

                 } else if (ftpFile.isFile()) {

                        log.info(&quot;/* [sF]Delete file [&quot; + path + &quot;/&quot; + name + &quot;]&quot;);

                        deleteFile(path + &quot;/&quot; + name);

                 } else if (ftpFile.isSymbolicLink()) {



                 } else if (ftpFile.isUnknown()) {



                 }

          }

          return ftpClient.removeDirectory(path);

   }



   //*/*

    /* 查看目录是否存在

    /* @param path

    /* @return

    /* @throws IOException

    /*/

   public boolean isDirectoryExists(String path) throws IOException {

          boolean flag = false;

          FTPFile[] ftpFileArr = ftpClient.listFiles(path);

          for (FTPFile ftpFile : ftpFileArr) {

                 if (ftpFile.isDirectory()

                               &amp;&amp; ftpFile.getName().equalsIgnoreCase(path)) {

                        flag = true;

                        break;

                 }

          }

          return flag;

   }



   //*/*

    /* 得到某个目录下的文件名列表

    /* @param path

    /* @return

    /* @throws IOException

    /*/

   public List&lt;String&gt; getFileList(String path) throws IOException {

          // listFiles return contains directory and file, it&#39;s FTPFile instance

          // listNames() contains directory, so using following to filer

          // directory.

          // String[] fileNameArr = ftpClient.listNames(path);

          FTPFile[] ftpFiles = ftpClient.listFiles(path);



          List&lt;String&gt; retList = new ArrayList&lt;String&gt;();

          if (ftpFiles == null || ftpFiles.length == 0) {

                 return retList;

          }

          for (FTPFile ftpFile : ftpFiles) {

                 if (ftpFile.isFile()) {

                        retList.add(ftpFile.getName());

                 }

          }

          return retList;

   }



   public boolean deleteFile(String pathName) throws IOException {

          return ftpClient.deleteFile(pathName);

   }



   //*/*

    /* 上传文件到FTP服务器，支持断点续传

    /* @param local 本地文件名称，绝对路径

    /* @param remote 远程文件路径，按照Linux上的路径指定方式，支持多级目录嵌套，支持递归创建不存在的目录结构

    /* @return 上传结果

    /* @throws IOException

    /*/

   public UploadStatus upload(String local, String remote) throws IOException {

          // 设置PassiveMode传输

          ftpClient.enterLocalPassiveMode();

          // 设置以二进制流的方式传输

          ftpClient.setFileType(FTP.BINARY_FILE_TYPE);

          ftpClient.setControlEncoding(&quot;GBK&quot;);

          UploadStatus result;

          // 对远程目录的处理

          String remoteFileName = remote;

          if (remote.contains(&quot;/&quot;)) {

                 remoteFileName = remote.substring(remote.lastIndexOf(&quot;/&quot;) + 1);

                 // 创建服务器远程目录结构，创建失败直接返回

                 if (createDirecroty(remote, ftpClient) == UploadStatus.CreateDirectoryFail) {

                        return UploadStatus.CreateDirectoryFail;

                 }

          }



          // 检查远程是否存在文件

          FTPFile[] files = ftpClient.listFiles(new String(remoteFileName

                        .getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;));

          if (files.length == 1) {

                 long remoteSize = files[0].getSize();

                 File f = new File(local);

                 long localSize = f.length();

                 if (remoteSize == localSize) { // 文件存在

                        return UploadStatus.FileExits;

                 } else if (remoteSize &gt; localSize) {

                        return UploadStatus.RemoteFileBiggerThanLocalFile;

                 }



                 // 尝试移动文件内读取指针,实现断点续传

                 result = uploadFile(remoteFileName, f, ftpClient, remoteSize);



                 // 如果断点续传没有成功，则删除服务器上文件，重新上传

                 if (result == UploadStatus.UploadFromBreakFailed) {

                        if (!ftpClient.deleteFile(remoteFileName)) {

                               return UploadStatus.DeleteRemoteFaild;

                        }

                        result = uploadFile(remoteFileName, f, ftpClient, 0);

                 }

          } else {

                 result = uploadFile(remoteFileName, new File(local), ftpClient, 0);

          }

          return result;

   }



   //*/*

    /* 递归创建远程服务器目录

    /* @param remote 远程服务器文件绝对路径

    /* @param ftpClient FTPClient对象

    /* @return 目录创建是否成功

    /* @throws IOException

    /*/

   public UploadStatus createDirecroty(String remote, FTPClient ftpClient)

                 throws IOException {

          UploadStatus status = UploadStatus.CreateDirectorySuccess;

          String directory = remote.substring(0, remote.lastIndexOf(&quot;/&quot;) + 1);

          if (!directory.equalsIgnoreCase(&quot;/&quot;)

                        &amp;&amp; !ftpClient.changeWorkingDirectory(new String(directory

                                      .getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;))) {

                 // 如果远程目录不存在，则递归创建远程服务器目录

                 int start = 0;

                 int end = 0;

                 if (directory.startsWith(&quot;/&quot;)) {

                        start = 1;

                 } else {

                        start = 0;

                 }

                 end = directory.indexOf(&quot;/&quot;, start);

                 while (true) {

                        String subDirectory = new String(remote.substring(start, end)

                                      .getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;);

                        if (!ftpClient.changeWorkingDirectory(subDirectory)) {

                               if (ftpClient.makeDirectory(subDirectory)) {

                                      ftpClient.changeWorkingDirectory(subDirectory);

                               } else {

                                      log.info(&quot;创建目录失败&quot;);

                                      return UploadStatus.CreateDirectoryFail;

                               }

                        }

                        start = end + 1;

                        end = directory.indexOf(&quot;/&quot;, start);

                        // 检查所有目录是否创建完毕

                        if (end &lt;= start) {

                               break;

                        }

                 }

          }

          return status;

   }



   //*/*

    /* 上传文件到服务器,新上传和断点续传

    /* @param remoteFile 远程文件名，在上传之前已经将服务器工作目录做了改变

    /* @param localFile 本地文件File句柄，绝对路径

    /* @param processStep 需要显示的处理进度步进值

    /* @param ftpClient FTPClient引用

    /* @return

    /* @throws IOException

    /*/

   public UploadStatus uploadFile(String remoteFile, File localFile,

                 FTPClient ftpClient, long remoteSize) throws IOException {

          UploadStatus status;

          // 显示进度的上传

          System.out.println(&quot;localFile.length():&quot;+localFile.length());

          long step = localFile.length() / 100;

          step = step==0?1:step;//文件过小，step可能为0

          long process = 0;

          long localreadbytes = 0L;

          RandomAccessFile raf = new RandomAccessFile(localFile, &quot;r&quot;);

          OutputStream out = ftpClient.appendFileStream(new String(remoteFile

                        .getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;));

          // 断点续传

          if (remoteSize &gt; 0) {

                 ftpClient.setRestartOffset(remoteSize);

                 process = remoteSize / step;

                 raf.seek(remoteSize);

                 localreadbytes = remoteSize;

          }

          byte[] bytes = new byte[1024];

          int c;

          while ((c = raf.read(bytes)) != -1) {

                 out.write(bytes, 0, c);

                 localreadbytes += c;

                 if (localreadbytes / step != process) {

                        process = localreadbytes / step;

                        if (process % 10 == 0){

                               log.info(&quot;上传进度：&quot; + process);

                        }

                 }

          }

          out.flush();

          raf.close();

          out.close();

          boolean result = ftpClient.completePendingCommand();

          if (remoteSize &gt; 0) {

                 status = result ? UploadStatus.UploadFromBreakSuccess

                               : UploadStatus.UploadFromBreakFailed;

          } else {

                 status = result ? UploadStatus.UploadNewFileSuccess

                               : UploadStatus.UploadNewFileFailed;

          }

          return status;

   }



   public InputStream downFile(String sourceFileName) throws IOException {

          return ftpClient.retrieveFileStream(sourceFileName);

   }



   public enum UploadStatus {

          CreateDirectoryFail, // 远程服务器相应目录创建失败

          CreateDirectorySuccess, // 远程服务器闯将目录成功

          UploadNewFileSuccess, // 上传新文件成功

          UploadNewFileFailed, // 上传新文件失败

          FileExits, // 文件已经存在

          RemoteFileBiggerThanLocalFile, // 远程文件大于本地文件

          UploadFromBreakSuccess, // 断点续传成功

          UploadFromBreakFailed, // 断点续传失败

          DeleteRemoteFaild; // 删除远程文件失败

   }



   public enum DownloadStatus {

          RemoteFileNotExist, // 远程文件不存在

          DownloadNewSuccess, // 下载文件成功

          DownloadNewFailed, // 下载文件失败

          LocalFileBiggerThanRemoteFile, // 本地文件大于远程文件

          DownloadFromBreakSuccess, // 断点续传成功

          DownloadFromBreakFailed; // 断点续传失败

   }
</code></pre><p>}
FtpConfig类：
//<em>/</em>
 /<em> 
 /</em>/
package com.pccw.portlet.publictools;
//<em>/</em>
 /<em> FTP配置类
 /</em> @author WangXianfeng 1:18:45 PM Jul 16, 2011
 /<em>/
public class FtpConfig {
    private String server;
    private int port;
    private String username;
    private String password;
    private String path;
    gets  。。sets。。
}
测试类：
import java.util.List;
import com.pccw.portlet.publictools.FtpConfig;
import com.pccw.portlet.publictools.FtpUtil;
//</em>/<em>
 /</em> 
 /<em> @author WangXianfeng 1:20:45 PM Jul 16, 2011
 /</em>/
public class HelloWorld {
    //<em>/</em>
     /<em> @param args
     /</em>/
    public static void main(String[] args) throws Exception {
        FtpConfig config = new FtpConfig();
        config.setServer(&quot;192.168.0.199&quot;);
        config.setPort(21);
        config.setUsername(&quot;wxf&quot;);
        config.setPassword(&quot;wxf&quot;);
        config.setPath(&quot;bankafile&quot;);
        FtpUtil ftp = new FtpUtil();
        ftp.connectServer(config);
        String localFile = &quot;c:\Seagull.rar&quot;;
        ftp.upload(localFile, &quot;sea.rar&quot;);
        List<String> files = ftp.getFileList(&quot;&quot;);
        //ftp.changeDirectory(&quot;bankafile&quot;);</p>
<pre><code>    for(String file:files){
        System.out.println(file);
        String local = &quot;D:\\ct\\199\\temp\\&quot; + file;
        ftp.download(file, local);
    }
}
</code></pre><p>}</p>
<p>来源： <a href="[http://xianfengmc.blog.163.com/blog/static/82690025201161731615607/](http://xianfengmc.blog.163.com/blog/static/82690025201161731615607/)">[http://xianfengmc.blog.163.com/blog/static/82690025201161731615607/](http://xianfengmc.blog.163.com/blog/static/82690025201161731615607/)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/ftp/">ftp</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ftp/" class="label label-primary">ftp</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-ftp--ApacheFTP实用代码/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-ftp--ApacheFTP实用代码" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-webservice-CXF--CXF获取客户端IP解决WebServiceContext为null问题/">CXF获取客户端IP(解决WebServiceContext为null问题)</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-webservice-CXF--CXF获取客户端IP解决WebServiceContext为null问题/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cxf-ip-webservicecontext-null-">CXF获取客户端IP(解决WebServiceContext为null问题)</h1>
<p>网络上很多文章都是这样配的：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
 @Resource</p>
<p>private</p>
<p>WebServiceContext wscontext;</p>
<p>public</p>
<p>String getIP(){</p>
<p>MessageContext ctx = wscontext.getMessageContext();</p>
<p>HttpServletRequest request = (HttpServletRequest)ctx.ge(AbstractHTTPDestination.HTTP_REQUEST);</p>
<p>return</p>
<p>request.getRemoteAddr();</p>
<p>}</p>
<p>但是在我测试的过程中，发现如果把这段代码写在aop切点中，wscontext就是null，如果写在普通的实现类，就可以正常获取。其实很多帖子也说到null的问题，但最后都没解决。</p>
<p>现在在<a href="http://www.javatips.net/blog/2012/03/getting-ip-address-using-cxf" target="_blank">这里</a>发现另一种方法，经测试完全有效:
1</p>
<p>2
3 Message message = PhaseInterceptorChain.getCurrentMessage();</p>
<p>HttpServletRequest httprequest = (HttpServletRequest)message.get(AbstractHTTPDestination.HTTP_REQUEST);
return</p>
<p>httprequest.getRemoteAddr();
来源： <a href="[https://linchunyu.info/81/cxf_fetch_request_ip.html](https://linchunyu.info/81/cxf_fetch_request_ip.html)">[https://linchunyu.info/81/cxf_fetch_request_ip.html](https://linchunyu.info/81/cxf_fetch_request_ip.html)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/webservice/">webservice</a></li></span><span class="breadcrumb"><li><a href="/categories/webservice/">webservice</a></li><li><a href="/categories/webservice/CXF/">CXF</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CXF/" class="label label-primary">CXF</a><a href="/tags/webservice/" class="label label-success">webservice</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-webservice-CXF--CXF获取客户端IP解决WebServiceContext为null问题/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-webservice-CXF--CXF获取客户端IP解决WebServiceContext为null问题" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/7/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/5/">5</a></li><li><a class="page-number" href="/page/6/">6</a></li><li><a class="page-number" href="/page/7/">7</a></li><li class="active"><li><span class="page-number current">8</span></li><li><a class="page-number" href="/page/9/">9</a></li><li><a class="page-number" href="/page/10/">10</a></li><li><a class="page-number" href="/page/11/">11</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/9/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 16:43:39</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
