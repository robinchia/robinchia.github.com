
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 8 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-wrapper--使用JavaServiceWrapper把Java程序作为Windows系统服务--IT/">使用Java Service Wrapper 把Java程序作为Windows系统服务 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-wrapper--使用JavaServiceWrapper把Java程序作为Windows系统服务--IT/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-java-service-wrapper-java-windows-iteye-">使用Java Service Wrapper 把Java程序作为Windows系统服务 - - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">资讯</a> <a href="http://www.iteye.com/magazines" target="_blank">精华</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a> <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://lbyzx123.iteye.com/blog/248210#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://lbyzx123.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://lbyzx123.iteye.com/login" target="_blank">登录</a> <a href="http://lbyzx123.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-lbyzx123-http-lbyzx123-iteye-com-"><a href="http://lbyzx123.iteye.com/" target="_blank">lbyzx123</a></h1>
<ul>
<li><a href="http://lbyzx123.iteye.com/" target="_blank"><strong>博客</strong></a></li>
<li><a href="http://lbyzx123.iteye.com/weibo" target="_blank">微博</a></li>
<li><a href="http://lbyzx123.iteye.com/album" target="_blank">相册</a></li>
<li><a href="http://lbyzx123.iteye.com/link" target="_blank">收藏</a></li>
<li><a href="http://lbyzx123.iteye.com/blog/guest_book" target="_blank">留言</a></li>
<li><a href="http://lbyzx123.iteye.com/blog/profile" target="_blank">关于我</a></li>
</ul>
<h3 id="-java-service-wrapper-java-windows-"><a href="">使用Java Service Wrapper 把Java程序作为Windows系统服务</a> **</h3>
<p><a href="http://www.iteye.com/blogs/tag/Java" target="_blank">Java</a><a href="http://www.iteye.com/blogs/tag/Windows" target="_blank">Windows</a><a href="http://www.iteye.com/blogs/tag/Tomcat" target="_blank">Tomcat</a><a href="http://www.iteye.com/blogs/tag/%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86" target="_blank">配置管理</a><a href="http://www.iteye.com/blogs/tag/C%23" target="_blank">C/#</a></p>
<p>Java程序很多情况下是作为服务程序运行的，在Un/<em>x平台下可以利用在命令后加“&amp;”把程序作为后台服务运行，但在Windows下看作那个Console窗口在桌面上，你是否一直担心别的同时把你的Console窗口关闭？是否怀念用VC写的Win32服务程序？
翻开JBOSS、Tomcat的发布包，发现他们都使用了一个Open source——Java Service Wrapper。用Java Service Wrapper可以轻松解决我们的需求，让我们的服务程序成为 Win32系统服务。
当然，在Un/</em>x下也可以使用Java Service Wrapper，可以避免加“&amp;”的粗暴方式，导致每天收到一堆mail，通过Java Service Wrapper提供的日志方式查看运行信息。
Java Service Wrapper功能很强大，同时支持Windows及Un/*x平台，提供三种方式把你的Java程序包装成系统服务，这里只介绍最简单的一种方式，因这种方式无需对已有的服务程序作任何改变，仅仅增加几个script、配置文件就可以把你的Java服务程序改造成系统服务程序了。
当然在使用之前需要到<a href="http://sourceforge.net/project/showfiles.php?group_id=39428下载Java" target="_blank">http://sourceforge.net/project/showfiles.php?group_id=39428下载Java</a> Service Wrapper的发布包。
下面简单介绍一下具体的使用步骤：</p>
<ol>
<li>将下载的Java Service Wrapper包解压到本地，目录为{WRAPPER_HOME}；</li>
<li>服务应用程序名为MyServApp，在目录d:\MyServApp下建立bin、conf、logs、lib目录；并把你的已有应用程序如NioBlockingServer.class拷贝到该目录下；</li>
<li>将{WRAPPER_HOME}\src\bin\下的遗以下文件拷贝到MyServApp目录下，并重命名。
{WRAPPER_HOME}\bin\Wrapper.exe  C:\ MyServApp \bin\Wrapper.exe
{WRAPPER_HOME}\src\bin\App.bat.in  C:\ MyServApp\bin\MyApp.bat
{WRAPPER_HOME}\src\bin\InstallApp-NT.bat.in  C:\ MyServApp\bin\InstallMyApp-NT.bat
{WRAPPER_HOME}\src\bin\UninstallApp-NT.bat.in  C:\ MyServApp\bin\UninstallMyApp-NT.bat</li>
<li>将{WRAPPER_HOME}\lib下的以下文件拷贝到C:\ MyServApp \lib目录下
{WRAPPER_HOME}\lib\Wrapper.DLL
{WRAPPER_HOME}\lib\wrapper.jar</li>
<li>将{WRAPPER_HOME}\src\conf\wrapper.conf.in拷贝到C:\ MyServApp \conf目录下并命名为wrapper.conf；并修改wrapper.conf文件，在其中配置您的应用服务。
主要修改以下几项即可：
/#你的JVM位置：
wrapper.java.command=D:\Sun\j2sdk1.4.0_03\bin\java
/#运行参数：如：
wrapper.java.additional.1=-Dprogram.name=run.bat
/#classpath：
wrapper.java.classpath.1=../lib/wrapper.jar
wrapper.java.classpath.2=../bin/.
/# Java Library Path (location of Wrapper.DLL or libwrapper.so)
wrapper.java.library.path.1=../lib
/#MAIN CLASS 此处决定了使用Java Service Wrapper的方式
wrapper.java.mainclass=org.tanukisoftware.wrapper.WrapperSimpleApp
/#你的Java应用类
wrapper.app.parameter.1= NonBlockingServer
/# 服务名
wrapper.ntservice.name=NB
/# Display name of the service
wrapper.ntservice.displayname=Nio Nonblocking Server
/# 服务描述
wrapper.ntservice.description=Nio Nonblocking Server
其他的配置根据你的需要改变即可</li>
<li>对以上配置的MyApp.bat进行测试，运行MyApp.bat，就像在Console窗口下运行Tomcat一样；</li>
<li>对以上配置的服务进行测试，运行C:\ MyServApp\bin\InstallMyApp-NT.bat将把你的应用（此处为NioBlockingServer）安装到Win32系统服务中了。</li>
<li>打开控制面板－管理程序－服务，看到Nio Nonblocking Server已经在系统服务中了，其他用法就与我们熟悉的Windows服务一样了。
Tomcat使用的是Java Service Wrapper模式二，这种方式需要对已有的程序进行小的改动，但可以通过Socket端口的方式控制服务程序核心的启动，更加灵活。Java Service Wrapper提供的模式三比较复杂，需要作出更多的编码，我没有研究。
采用模式一，即可简单有效的把我们的服务程序包装成为系统服务程序，并增强了日志功能，我们可以把MyServApp的几个文件做成模板，每次修改文件名，配置文件就可以了，有精力的朋友更可以做成Eclipse的plugin，鼠标点点就把应用配成服务了。
附件是一个模板，可以直接修改文件名和配置文件就可以把服务改造了。
希望本文能对大家有所帮助，当然也申请加分了，我的2分实在不够混的了。 <h1 id="-files-cai9911-ntservicewrappertemplate-rar-http-files-cnblogs-com-cai9911-ntservicewrappertemplate-rar-"><a href="http://files.cnblogs.com/cai9911/NTServiceWrapperTemplate.rar" target="_blank">/Files/cai9911/NTServiceWrapperTemplate.rar</a></h1>
自己做的一个例子,可以直接拿来修改:
(写下来备忘)
主要修改config/wrapper.conf 一个地方:
wrapper.app.parameter.1= HelloWorld  &lt;要启动的类&gt;
其他的可以修改应用程序的服务名称等.
<a href="http://files.cnblogs.com/cai9911/JavaService.rar" target="_blank">/Files/cai9911/JavaService.rar</a>
分享到： <a href="&quot;分享到新浪微博&quot;"><img src="" alt=""></a> <a href="&quot;分享到腾讯微博&quot;"><img src="" alt=""></a></li>
</ol>
<p><a href="http://lbyzx123.iteye.com/blog/258505" title="javascript中如何给二维数组赋值？" target="_blank">javascript中如何给二维数组赋值？</a> | <a href="http://lbyzx123.iteye.com/blog/248209" title="an error has occurred.See error log for more deta." target="_blank">an error has occurred.See error log for ...</a></p>
<ul>
<li>2008-09-30 13:40:07</li>
<li>浏览 4068</li>
<li><a href="http://lbyzx123.iteye.com/blog/248210#comments" target="_blank">评论(0)</a></li>
<li><a href="http://www.iteye.com/wiki/blog/248210" target="_blank">相关推荐</a></li>
</ul>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<h3 id="-">发表评论</h3>
<p><a href="http://lbyzx123.iteye.com/login" target="_blank"><img src="" alt=""></a><a href="http://lbyzx123.iteye.com/login" target="_blank">您还没有登录,请您登录后再发表评论</a></p>
<p><a href="http://lbyzx123.iteye.com/" target="_blank"><img src="&quot;lbyzx123的博客: &quot;" alt="lbyzx123的博客"></a></p>
<p>lbyzx123</p>
<ul>
<li>浏览: 51258 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 杭州</li>
<li><img src="" alt=""><h3 id="-http-lbyzx123-iteye-com-blog-user_visits-">最近访客 <a href="http://lbyzx123.iteye.com/blog/user_visits" target="_blank">更多访客&gt;&gt;</a></h3>
</li>
</ul>
<p><a href="http://zhaoyijun.iteye.com/" target="_blank"><img src="&quot;zhaoyijun的博客: &quot;" alt="zhaoyijun的博客"></a></p>
<p><a href="http://zhaoyijun.iteye.com/" target="_blank">zhaoyijun</a></p>
<p><a href="http://yang8580330.iteye.com/" target="_blank"><img src="&quot;yang8580330的博客: &quot;" alt="yang8580330的博客"></a></p>
<p><a href="http://yang8580330.iteye.com/" target="_blank">yang8580330</a>
<a href="http://bgvhuy38.iteye.com/" target="_blank"><img src="&quot;bgvhuy38的博客: &quot;" alt="bgvhuy38的博客"></a></p>
<p><a href="http://bgvhuy38.iteye.com/" target="_blank">bgvhuy38</a></p>
<p><a href="http://taibin.iteye.com/" target="_blank"><img src="&quot;taibin的博客: &quot;" alt="taibin的博客"></a></p>
<p><a href="http://taibin.iteye.com/" target="_blank">taibin</a></p>
<h3 id="-">文章分类</h3>
<ul>
<li><a href="http://lbyzx123.iteye.com/" target="_blank">全部博客 (93)</a></li>
<li><a href="http://lbyzx123.iteye.com/category/42284" target="_blank">AJAX (0)</a></li>
<li><a href="http://lbyzx123.iteye.com/category/42285" target="_blank">J2EE (11)</a></li>
<li><a href="http://lbyzx123.iteye.com/category/42283" target="_blank">数据库 (14)</a></li>
<li><a href="http://lbyzx123.iteye.com/category/42286" target="_blank">JAVASCRIPT (16)</a></li>
<li><a href="http://lbyzx123.iteye.com/category/42287" target="_blank">哲理 (6)</a></li>
<li><a href="http://lbyzx123.iteye.com/category/42315" target="_blank">开发工具问题 (12)</a></li>
<li><a href="http://lbyzx123.iteye.com/category/42316" target="_blank">设计模式 (0)</a></li>
<li><a href="http://lbyzx123.iteye.com/category/44335" target="_blank">ExtJS (10)</a></li>
<li><a href="http://lbyzx123.iteye.com/category/122708" target="_blank">java (9)</a></li>
<li><a href="http://lbyzx123.iteye.com/category/137565" target="_blank">测试 (2)</a></li>
<li><p><a href="http://lbyzx123.iteye.com/category/191171" target="_blank">c++ (1)</a></p>
<h3 id="-">社区版块</h3>
</li>
<li><p><a href="http://lbyzx123.iteye.com/blog/news" target="_blank">我的资讯</a> (0)</p>
</li>
<li><a href="http://lbyzx123.iteye.com/blog/post" target="_blank">我的论坛</a> (1)</li>
<li><a href="http://lbyzx123.iteye.com/blog/solution" target="_blank">我解决的问题</a> (0)</li>
</ul>
<h3 id="-">存档分类</h3>
<ul>
<li><a href="http://lbyzx123.iteye.com/blog/monthblog/2012-01" target="_blank">2012-01</a> (1)</li>
<li><a href="http://lbyzx123.iteye.com/blog/monthblog/2011-12" target="_blank">2011-12</a> (4)</li>
<li><a href="http://lbyzx123.iteye.com/blog/monthblog/2011-11" target="_blank">2011-11</a> (3)</li>
<li><p><a href="http://lbyzx123.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://lbyzx123.iteye.com/blog/1139428" title="extjs4 异步树的写法" target="_blank">extjs4 异步树的写法</a></p>
</li>
<li><a href="http://lbyzx123.iteye.com/blog/1073789" title="请问一下mysql是不是限制了单个表的容量，能改吗" target="_blank">请问一下mysql是不是限制了单个表的容量， ...</a></li>
<li><a href="http://lbyzx123.iteye.com/blog/1172418" title="三个故事说穿许多人" target="_blank">三个故事说穿许多人</a></li>
</ul>
<h3 id="-">最新评论</h3>
<ul>
<li><a href="http://paradigm.iteye.com/" target="_blank">paradigm</a>： 谢谢
<a href="http://lbyzx123.iteye.com/blog/764985#bc2227490" target="_blank">WebSphere7.0数据源配置与应用程序发布之创建数据源</a></li>
<li><a href="http://gooderlee.iteye.com/" target="_blank">maozilee</a>： windows下面就用NTFS，没事儿！
<a href="http://lbyzx123.iteye.com/blog/1073789#bc2218928" target="_blank">请问一下mysql是不是限制了单个表的容量，能改吗</a></li>
<li><a href="http://lljjssljseye.iteye.com/" target="_blank">lljjssljseye</a>： ...
<a href="http://lbyzx123.iteye.com/blog/1172418#bc2216979" target="_blank">三个故事说穿许多人</a></li>
<li><a href="http://lbyzx123.iteye.com/" target="_blank">lbyzx123</a>： hable 写道看不明白啊,能不能加点注释 很简单呀，既然是异 ...
<a href="http://lbyzx123.iteye.com/blog/1139428#bc2213672" target="_blank">extjs4 异步树的写法</a></li>
<li><a href="http://hable.iteye.com/" target="_blank">hable</a>： 看不明白啊,能不能加点注释
<a href="http://lbyzx123.iteye.com/blog/1139428#bc2213623" target="_blank">extjs4 异步树的写法</a>
声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2011 ITeye.com. All rights reserved. [ 京ICP证110151号 京公网安备110105010620 ]
<img src="" alt=""></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/wrapper/">wrapper</a></li></span></span> | <span class="tags">Tagged <a href="/tags/wrapper/" class="label label-primary">wrapper</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-wrapper--使用JavaServiceWrapper把Java程序作为Windows系统服务--IT/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-wrapper--使用JavaServiceWrapper把Java程序作为Windows系统服务--IT" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-wrapper--JavaServiceWrapper-LoggingConfigurationPrope/">Java Service Wrapper </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-wrapper--JavaServiceWrapper-LoggingConfigurationPrope/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-service-wrapper-logging-configuration-properties">Java Service Wrapper - Logging Configuration Properties</h1>
<p><img src="" alt="World Map">EnglishJapanese (Nihongo)German (Deutsch)</p>
<p><strong>Please  or</strong></p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/" target="_blank"><img src="" alt="Java Service Wrapper Logo"></a></li>
<li><a href="http://www.tanukisoftware.com/" target="_blank"><img src="" alt="Tanuki Software Ltd Logo"></a></li>
</ul>
<p>Java Service Wrapper is the easiest way to make your product more reliable.</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/requestTrial.jsp" target="_blank"><img src="" alt="Free Trial"></a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/accountLicenses.jsp" target="_blank"><img src="" alt="Buy Now"></a></li>
<li><a href="http://www.tanukisoftware.com/" target="_blank">Tanuki Software</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/" target="_blank">Java Service Wrapper</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/download.jsp" target="_blank">Home</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/product-overview.html" target="_blank">Product</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/product-overview.html" target="_blank">Overview</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/product-features.html" target="_blank">Features</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/licenseOverview.html" target="_blank">License</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/faq.html" target="_blank">FAQ</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/download.jsp" target="_blank">Download</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/download.jsp#stable" target="_blank">Stable Release</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/release-notes.html" target="_blank">Release Notes</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/versions.jsp" target="_blank">Past Releases</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/accountLicenses.jsp#purchase" target="_blank">Order</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/accountLicenses.jsp#purchase" target="_blank">Buy now</a></p>
</li>
<li><a href="http://www.tanukisoftware.com/en/distributors.php" target="_blank">Distributors</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/licenseOverview.html" target="_blank">License Overview</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/licenseOverview.html#examples" target="_blank">License FAQ</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/introduction.html" target="_blank">Documentation</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/introduction.html" target="_blank">Introduction</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/integrate.html" target="_blank">Integration Methods</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/launch.html" target="_blank">Launching your Application</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/properties.html" target="_blank">Configuration Properties</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/javadocs.html" target="_blank">Java API</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/i18n.html" target="_blank">Localization / i18n</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/security-model.html" target="_blank">Security Model</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/jmx.html" target="_blank">JMX Control</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/example.html" target="_blank">TestWrapper Application</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/support.jsp" target="_blank">Support</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/debugging.html" target="_blank">Debugging</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/troubleshooting.html" target="_blank">Troubleshooting</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/howto.html" target="_blank">HOWTO</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/qna.html" target="_blank">Questions &amp; Answers</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/faq.html" target="_blank">FAQ</a></li>
<li><a href="http://sourceforge.net/tracker/?group_id=39428" target="_blank">Issue Tracking</a></li>
<li><a href="http://sourceforge.net/mail/?group_id=39428" target="_blank">Maling List</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/support.jsp" target="_blank">Get Support</a></li>
<li><p><a href="http://sourceforge.net/projects/wrapper/" target="_blank">Community</a></p>
</li>
<li><p><a href="http://sourceforge.net/projects/wrapper/" target="_blank">SourceForge Project</a></p>
</li>
<li><a href="http://sourceforge.net/svn/?group_id=39428" target="_blank">Source Repository</a></li>
<li><p><a href="http://www.tanukisoftware.com/en/" target="_blank">About us</a></p>
</li>
<li><p><a href="http://www.tanukisoftware.com/en/company.php" target="_blank">Company Profile</a></p>
</li>
<li><a href="http://www.tanukisoftware.com/en/distributors.php" target="_blank">Distributors</a></li>
<li><a href="http://www.tanukisoftware.com/en/customers.php" target="_blank">Customers</a></li>
<li><a href="http://www.tanukisoftware.com/en/contact.php" target="_blank">Contact us</a></li>
<li><h2 id="properties">Properties</h2>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/properties.html" target="_blank">Configuration Overview</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/properties.html#category" target="_blank">List by Category</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/properties.html#name" target="_blank">List by Name</a></p>
</li>
<li><h2 id="currently-logged-on-">Currently logged on:</h2>
</li>
<li><p>1 users, 100 guests</p>
</li>
<li><h2 id="customers">Customers</h2>
</li>
</ul>
<p>Logging Configuration Properties <a href=""></a> # Logging Configuration Properties Logging properties are used to configure how where the Java Service Wrapper logs internal output as well as JVM output which would normally show up in the console used to launch a Java application. Wrapper Logging properties do not in any way control nor replace Logging tools within the Java application.</p>
<p>[General/Common]</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-adviser.html" target="_blank">wrapper.adviser</a> (3.1.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-debug.html" target="_blank">wrapper.debug</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-filter-x-n.html#action" target="_blank">wrapper.filter.action.<n></a> (3.0.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-filter-x-n.html#allow-wildcards" target="_blank">wrapper.filter.allow_wildcards.<n></a> (3.5.5)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-filter-x-n.html#message" target="_blank">wrapper.filter.message.<n></a> (3.5.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-filter-x-n.html#trigger" target="_blank">wrapper.filter.trigger.<n></a> (3.0.0)</li>
</ul>
<p>[Console]</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-console-flush.html" target="_blank">wrapper.console.flush</a> (3.2.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-console-format.html" target="_blank">wrapper.console.format</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/prop-console-loglevel.html" target="_blank">wrapper.console.loglevel</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/prop-console-x-to-stderr.html" target="_blank">wrapper.console.error_to_stderr</a> (3.5.3)</p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-console-x-to-stderr.html" target="_blank">wrapper.console.fatal_to_stderr</a> (3.5.3)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-console-x-to-stderr.html" target="_blank">wrapper.console.warn_to_stderr</a> (3.5.3)</li>
</ul>
<p>[Command]</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-java-command-loglevel.html" target="_blank">wrapper.java.command.loglevel</a> (3.1.2)</li>
</ul>
<p>[Log File]</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile.html" target="_blank">wrapper.logfile</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-format.html" target="_blank">wrapper.logfile.format</a> (2.2.5)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-inactivity-timeout.html" target="_blank">wrapper.logfile.inactivity.timeout</a> (3.2.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-loglevel.html" target="_blank">wrapper.logfile.loglevel</a> (2.2.5)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-maxfiles.html" target="_blank">wrapper.logfile.maxfiles</a> (2.2.5)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-maxsize.html" target="_blank">wrapper.logfile.maxsize</a> (2.2.5)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-purge-pattern.html" target="_blank">wrapper.logfile.purge.pattern</a> (3.3.8)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-purge-sort.html" target="_blank">wrapper.logfile.purge.sort</a> (3.3.8)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-rollmode.html" target="_blank">wrapper.logfile.rollmode</a> (3.2.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-umask.html#x-umask" target="_blank">wrapper.logfile.umask</a> (3.2.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-log-lf-delay-threshold.html" target="_blank">wrapper.log.lf_delay.threshold</a> (3.5.10)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-log-warning-threshold.html" target="_blank">wrapper.log.warning.threshold</a> (3.5.8)</li>
</ul>
<p>[Log-Dialog]</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logdialog-enable.html" target="_blank">wrapper.logdialog.enable</a> (3.3.1)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logdialog-format.html" target="_blank">wrapper.logdialog.format</a> (3.3.1)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logdialog-lines.html" target="_blank">wrapper.logdialog.lines</a> (3.3.1)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logdialog-loglevel.html" target="_blank">wrapper.logdialog.loglevel</a> (3.3.1)</li>
</ul>
<p>[Syslog]</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-syslog-facility.html" target="_blank">wrapper.syslog.facility</a> (3.2.1)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-syslog-ident.html" target="_blank">wrapper.syslog.ident</a> (3.2.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-syslog-local-host.html" target="_blank">wrapper.syslog.local.host</a> (3.5.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-syslog-loglevel.html" target="_blank">wrapper.syslog.loglevel</a> (2.2.5)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-syslog-remote-host.html" target="_blank">wrapper.syslog.remote.host</a> (3.5.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-syslog-remote-port.html" target="_blank">wrapper.syslog.remote.port</a> (3.5.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/" target="_blank"><img src="" alt=""></a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/product-overview.html" target="_blank">Product</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/product-overview.html" target="_blank">Overview</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/product-features.html" target="_blank">Features</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/download.jsp#stable" target="_blank">Download</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/accountLicenses.jsp#purchase" target="_blank">Buy Now</a></li>
<li><a href="http://www.tanukisoftware.com/en/distributors.php" target="_blank">Distribuitors</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/introduction.html" target="_blank">Documentation</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/introduction.html" target="_blank">Introduction</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/integrate.html" target="_blank">Integration Methods</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/properties.html" target="_blank">Configuration Properties</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/javadocs.html" target="_blank">Java API</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/support.jsp" target="_blank">Support</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/debugging.html" target="_blank">Debugging</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/troubleshooting.html" target="_blank">Troubleshooting</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/qna.html" target="_blank">Questions &amp; Answers</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/faq.html" target="_blank">FAQ</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/support.jsp" target="_blank">Get Support</a></li>
<li><p><a href="http://sourceforge.net/projects/wrapper/" target="_blank">Community</a></p>
</li>
<li><p><a href="http://sourceforge.net/projects/wrapper/" target="_blank"><img src="" alt="SourceForge Project"></a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/" target="_blank">English</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/japanese/" target="_blank">日本語</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/german/" target="_blank">Deutsch</a>
Copyright (c) 2004-2011, Tanuki Software, Ltd. All Rights Reserved.</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/wrapper/">wrapper</a></li></span></span> | <span class="tags">Tagged <a href="/tags/wrapper/" class="label label-primary">wrapper</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-wrapper--JavaServiceWrapper-LoggingConfigurationPrope/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-wrapper--JavaServiceWrapper-LoggingConfigurationPrope" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-webservice--Java开发的WebService获取客户端IP地址/">Java开发的WebService获取客户端IP地址_数据库 开发_比特网</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-webservice--Java开发的WebService获取客户端IP地址/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-webservice-ip-">Java开发WebService获取客户端IP地址</h1>
<p>1.基于jax-ws开发的webservice获取客户端ip的方法【在代理类XXXDelegate添加如下代码】：</p>
<p>import javax.annotation.Resource;</p>
<p>import javax.servlet.http.HttpServletRequest;</p>
<p>import javax.xml.ws.WebServiceContext;</p>
<p>import javax.xml.ws.handler.MessageContext;</p>
<p>@Resource</p>
<p>private WebServiceContext wsContext;</p>
<p>private String getClientInfo(){</p>
<p>MessageContext mc = wsContext.getMessageContext();</p>
<p>HttpServletRequest request = (HttpServletRequest)(mc.get(MessageContext.SERVLET_REQUEST));</p>
<p>String remortAddress = request.getRemoteAddr();</p>
<p>return (remortAddress);</p>
<p>}</p>
<p>2.基于axis发布的webservice获取客户端ip的方法</p>
<p>//<em>/</em></p>
<p>/* 获取客户端IP地址，如调用方的IP，以便检查权限。</p>
<p>/* 适用于axis发布的webservice</p>
<p>/* @return</p>
<p>/*/</p>
<p>public String getClientIpAxis() {</p>
<p>MessageContext mc = null;</p>
<p>HttpServletRequest request = null;</p>
<p>try {</p>
<p>mc = MessageContext.getCurrentMessageContext();</p>
<p>if (mc == null)</p>
<p>throw new Exception(“无法获取到MessageContext”);</p>
<p>request = (HttpServletRequest) mc</p>
<p>.getProperty(HTTPConstants.MC_HTTP_SERVLETREQUEST);</p>
<p>System.out.println(“remote ip: ” + request.getRemoteAddr());</p>
<p>} catch (Exception e) {</p>
<p>System.out.println(e.getMessage());</p>
<p>e.printStackTrace();</p>
<p>}</p>
<p>return request.getRemoteAddr();</p>
<p>}</p>
<p>3.基于xfire发布的webservice获取客户端ip的方法</p>
<p>//<em>/</em></p>
<p>/* 获取客户端IP地址</p>
<p>/* 适用于xfire发布的webservice</p>
<p>/* @return</p>
<p>/*/</p>
<p>public String getClientIpXfire() {</p>
<p>String ip = “”;</p>
<p>try {</p>
<p>HttpServletRequest request = XFireServletController.getRequest();</p>
<p>ip = request.getRemoteAddr();</p>
<p>} catch (Exception e) {</p>
<p>System.out.println(“无法获取HttpServletRequest.”);</p>
<p>e.printStackTrace();</p>
<p>}</p>
<p>return ip;</p>
<p>}
关键字：Java</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/webservice/">webservice</a></li></span></span> | <span class="tags">Tagged <a href="/tags/webservice/" class="label label-primary">webservice</a></span> | <span class="time">recent updated:<time title="2014-03-07 10:39:04"datetime="2014-03-07 10:39:04"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-webservice--Java开发的WebService获取客户端IP地址/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-webservice--Java开发的WebService获取客户端IP地址" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-webservice-CXF--CXF获取客户端IP解决WebServiceContext为null问题/">CXF获取客户端IP(解决WebServiceContext为null问题)</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-webservice-CXF--CXF获取客户端IP解决WebServiceContext为null问题/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cxf-ip-webservicecontext-null-">CXF获取客户端IP(解决WebServiceContext为null问题)</h1>
<p>网络上很多文章都是这样配的：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
 @Resource</p>
<p>private</p>
<p>WebServiceContext wscontext;</p>
<p>public</p>
<p>String getIP(){</p>
<p>MessageContext ctx = wscontext.getMessageContext();</p>
<p>HttpServletRequest request = (HttpServletRequest)ctx.ge(AbstractHTTPDestination.HTTP_REQUEST);</p>
<p>return</p>
<p>request.getRemoteAddr();</p>
<p>}</p>
<p>但是在我测试的过程中，发现如果把这段代码写在aop切点中，wscontext就是null，如果写在普通的实现类，就可以正常获取。其实很多帖子也说到null的问题，但最后都没解决。</p>
<p>现在在<a href="http://www.javatips.net/blog/2012/03/getting-ip-address-using-cxf" target="_blank">这里</a>发现另一种方法，经测试完全有效:
1</p>
<p>2
3 Message message = PhaseInterceptorChain.getCurrentMessage();</p>
<p>HttpServletRequest httprequest = (HttpServletRequest)message.get(AbstractHTTPDestination.HTTP_REQUEST);
return</p>
<p>httprequest.getRemoteAddr();
来源： <a href="[https://linchunyu.info/81/cxf_fetch_request_ip.html](https://linchunyu.info/81/cxf_fetch_request_ip.html)">[https://linchunyu.info/81/cxf_fetch_request_ip.html](https://linchunyu.info/81/cxf_fetch_request_ip.html)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/webservice/">webservice</a></li></span><span class="breadcrumb"><li><a href="/categories/webservice/">webservice</a></li><li><a href="/categories/webservice/CXF/">CXF</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CXF/" class="label label-primary">CXF</a><a href="/tags/webservice/" class="label label-success">webservice</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-webservice-CXF--CXF获取客户端IP解决WebServiceContext为null问题/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-webservice-CXF--CXF获取客户端IP解决WebServiceContext为null问题" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-ftp--FTP的主动模式/">FTP的主动模式</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-ftp--FTP的主动模式/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="ftp-">FTP的主动模式</h1>
<p>FTP的主动模式(active mode)和被动模式(passive mode)：(转)</p>
<p>FTP的主动模式(active mode)和被动模式(passive mode)：(转)</p>
<p>2010-03-01 23:57
大多数的TCP服务是使用单个的连接，一般是客户向服务器的一个周知端口发起连接，然后使用这个连接进行通讯。但是，FTP协议却有所不同，它使用双向的多个连接 ，而且使用的端口很难预计。一般，FTP连接包括：
一个控制连接 (control connection)
这个连接用于传递客户端的命令和服务器端对命令的响应。它使用服务器的21端口，生存期是整个FTP会话时间。
几个数据连接 (data connection)
这些连接用于传输文件和其它数据，例如：目录列表等。这种连接在需要数据传输时建立，而一旦数据传输完毕就关闭，每次使用的端口也不一定相同。而且，数据 连接既可能是客户端发起的，也可能是服务器端发起的。
在FTP协议中，控制连接使用周知端口21 ，因此使用ISA的IP PACKET FILTER就可以这种连接进行很好的安全保护。相反，数据传输连接的目的端口通常实现无法知道，因此处理这样的端口转发非常困难。F</p>
<p>TP协议使用一个标准的端口21作为ftp-data端口，但是这个端口只用于连接的源地址是服务器端的情况，在这个端口上根本就没有监听进程。</p>
<p>FTP的数据连接和控制连接的方向一般是相反的，也就是说，是服务器向客户端发起一个用于数据传输的连接。连接的端口是由服务器端和客户端协商确定的。FTP协议 的这个特征对ISA 转发以及防火墙和NAT的配置增加了很多困难。
除此之外，还有另外一种FTP模式，叫做被动模式 (passive mod)。在这种模式下，数据连接是由客户程序发起的，和刚才讨论过的模式(我们可以叫做主动模式 )相反。</p>
<p>是否采取被动模式取决于客户程序，在ftp命令行中使用passive命令就可以关闭/打开被动模式。</p>
<p><strong>iptables**</strong>中配置vsftp**</p>
<p>问题：配置iptables后， vsftpd不能用。常见现象是能够登录到服务器，LIST列目录失败(超时)。</p>
<p>分析：</p>
<p>主动模式 下，客户连接 TCP/21，服务器通过 TCP/20 连接客户的随机端口 </p>
<p>————这种情况下，通过状态防火墙可以解决 iptables -A INPUT -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT
被动模式 下，客户连接 TCP/21，客户再通过其他端口连接服务器的随机端口</p>
<p>卡住的原因，是因为服务器在被动模式下没有打开临时端口让 client 连过来，因此需要几个条件</p>
<p>1、client 没有防火墙时，用主动模式连接即可
2、server 没有防火墙时，用被动模式即可
3、双方都有防火墙时，vsftpd 设置被动模式高端口范围，server 打开那段范围，client 用被动模式连接即可
4、加载 ip_conntrack_ftp 模块，使 server 支持 connection tracking，支持临时打洞，client 用被动模式即可
5、server 使用 ip_conntrack_ftp、client 使用 ip_conntrack_ftp 和 ip_nat_ftp，支持临时打洞和临时 NAT 穿越打洞，双方使用主动或被动模式均可</p>
<ul>
<li>“打洞”的配置说明：</li>
<li>优点：不影响ftp配置；缺点： 客户会感觉到连接有些延迟。原因参见ip_conntract的实现原理</li>
</ul>
<p>在/etc/modprobe.conf中添加
alias ip_conntrack ip_conntract_ftp ip_nat_ftp</p>
<p>在/etc/rc.local中添加</p>
<p>/sbin/modprobe ip_conntract
/sbin/modprobe  ip_conntrack_ftp
/sbin/modprobe  ip_nat_ftp</p>
<p>这个作用就是完成上面所说的“临时打洞”的方法。</p>
<ul>
<li>限制被动模式连接端口的配置说明</li>
<li>优点：对连接速度没有影响。缺点： 限制了被动模式下，客户端并发连接的数量。</li>
</ul>
<p>在/etc/vsftpd/vsftpd.conf中添加
pasv_min_port=2222
pasv_max_port=2225</p>
<p>iptables中开放这段端口</p>
<p>-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 21 -j ACCEPT
-A INPUT -p tcp --dport 2222:2225 -j ACCEPT</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/ftp/">ftp</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ftp/" class="label label-primary">ftp</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-ftp--FTP的主动模式/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-ftp--FTP的主动模式" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/7/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/5/">5</a></li><li><a class="page-number" href="/page/6/">6</a></li><li><a class="page-number" href="/page/7/">7</a></li><li class="active"><li><span class="page-number current">8</span></li><li><a class="page-number" href="/page/9/">9</a></li><li><a class="page-number" href="/page/10/">10</a></li><li><a class="page-number" href="/page/11/">11</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/9/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 13:06:28</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
