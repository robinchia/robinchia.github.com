
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 75 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-域--终端服务网关没有足够的信息不能验证该证书/">终端服务网关没有足够的信息不能验证该证书</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:40.000Z"> <a href="/2014/02/02/2014-02-02-域--终端服务网关没有足够的信息不能验证该证书/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">终端服务网关没有足够的信息不能验证该证书</h1>
<p><a href="http://gnaw0725.blogbus.com/" target="_blank"><img src="" alt="活动目录SEO博客"></a>
<a href="http://gnaw0725.blogbus.com/" target="_blank">活动目录SEO博客 &gt;</a><a href="http://gnaw0725.blogbus.com/c1404551/" target="_blank">系统网络管理</a> &gt;终端服务网关:没有足够的信息不能验证该证书
<a href="http://gnaw0725.blogbus.com/tag/tsgateway/" target="_blank">tsgateway</a> <a href="http://gnaw0725.blogbus.com/tag/不能验证该证书/" target="_blank">不能验证该证书</a> <a href="http://gnaw0725.blogbus.com/tag/终端服务网关/" target="_blank">终端服务网关</a> <a href="http://gnaw0725.blogbus.com/tag/windows2008TSGW/" target="_blank">windows2008TSGW</a> <a href="http://gnaw0725.blogbus.com/tag/win2k8tsgw/" target="_blank">win2k8tsgw</a></p>
<ul>
<li><a href="http://gnaw0725.blogbus.com/c1404552/" target="_blank">Active Directory域活动目录[789]</a></li>
<li><a href="http://gnaw0725.blogbus.com/c1404553/" target="_blank">Windows 7vista[160]</a></li>
<li><a href="http://gnaw0725.blogbus.com/c1404551/" target="_blank">系统网络管理[1048]</a></li>
<li><a href="http://gnaw0725.blogbus.com/c1451429/" target="_blank">Office 2010/2007[97]</a></li>
<li><a href="http://gnaw0725.blogbus.com/c1507212/" target="_blank">SEOSEM[64]</a></li>
<li><a href="http://gnaw0725.blogbus.com/c1404554/" target="_blank">系统管理脚本[72]</a></li>
<li><a href="http://gnaw0725.blogbus.com/c1404555/" target="_blank">微软视频教程[8]</a></li>
<li><a href="http://gnaw0725.blogbus.com/c1404556/" target="_blank">软件应用|合作[161]</a></li>
</ul>
<h3 id="-http-gnaw0725-blogbus-com-logs-31005239-html-"><a href="http://gnaw0725.blogbus.com/logs/31005239.html" target="_blank">终端服务网关:没有足够的信息不能验证该证书</a></h3>
<p><a href="http://gnaw0725.blogbus.com/logs/27525245.html" target="_blank">终端服务网关</a>:没有足够的信息不能验证该证书。我在测试<a href="http://gnaw0725.blogbus.com/logs/30260910.html" target="_blank">windows 2008 TS GW</a>时碰到问题如下:
介绍:我有两台<a href="http://gnaw0725.blogbus.com/logs/16715844.html" target="_blank">windows 2008</a>,其中一台:安装<a href="http://gnaw0725.blogbus.com/logs/18971316.html" target="_blank"></a><a href="http://gnaw0725.blogbus.com/logs/18971316.html">域控</a>制器,证书颁发机构,<a href="http://gnaw0725.blogbus.com/logs/11692848.html" target="_blank">终端服务器</a>,终端服务REMOTEAPP服务器,终端服务WEB访问(主机名:godwin2008.svrapp.com)
另外一台:安装终端服务网关(主机名:godwin2008gw.svrapp.com)，这台安装完毕后,进入此机器申请证书,双击查看如附件1,并应用到TS GW上!
然后找到一台XP机器,其不在域中,安装证书提示证书问题!我在XP上面查看证书,提示&quot;没有足够的信息，不能验证该证书&quot;为什么会这样!导出来也正常</p>
<p>回答：根据您的描述，我对这个问题的理解是:　在测试Windows Server 2008 TS GW的时候，遇到证书问题，提示：“没有足够的信息，不能验证该证书”您看到的文章来自<a href="http://gnaw0725.blogbus.com/" target="_blank">活动目录</a><a href="http://gnaw0725.blogbus.com/c1507212/" target="_blank">seo</a> <a href="http://gnaw0725.blogbus.com/c1404551/" target="_blank"><a href="http://gnaw0725.blogbus.com/c1404551/">http://gnaw0725.blogbus.com/c1404551/</a></a>
自己或者CA签名的证书可以被TS Gateway使用。通常来说，由于根CA证书将被自动保存到客户端，在域环境中，我们建议使用企业CA签名认证过的证书(信任的证书)。
对于一台工作组机器来说，我们可能需要手动导入根CA证书(信任的证书)到这个客户端。根CA证书通常可以在CA服务器的systemroot\System32\CertSrv\CertEnroll目录下找到。</p>
<h1 id="-">同时我还引述一些附加的信息给您：</h1>
<p>Install the certificate of the enterprise root CA as a trusted root CA certificate (英文)
<a href="http://technet.microsoft.com/en-us/library/cc758128.aspx" target="_blank"><a href="http://technet.microsoft.com/en-us/library/cc758128.aspx">http://technet.microsoft.com/en-us/library/cc758128.aspx</a></a>
您尝试连接到终端服务器使用了 Single Sign 基于 Windows Server 2008-计算机的功能启用时错误消息：&quot;的登录尝试失败&quot;
<a href="http://support.microsoft.com/kb/954397/zh-cn?spid=12925&amp;sid=496" target="_blank"><a href="http://support.microsoft.com/kb/954397/zh-cn?spid=12925&amp;sid=496">http://support.microsoft.com/kb/954397/zh-cn?spid=12925&amp;sid=496</a></a>
您使用智能卡身份验证从客户端计算机在运行 Windows Vista 或 Windows Server 2008 登录到基于 Windows Server 2008-终端服务器时出现错误信息：&quot;0xC000040C&quot;您看到的文章来自活动目录seo <a href="http://gnaw0725.blogbus.com/c1404551/" target="_blank"><a href="http://gnaw0725.blogbus.com/c1404551/">http://gnaw0725.blogbus.com/c1404551/</a></a>
<a href="http://support.microsoft.com/kb/954910/zh-cn?spid=12925&amp;sid=496" target="_blank"><a href="http://support.microsoft.com/kb/954910/zh-cn?spid=12925&amp;sid=496">http://support.microsoft.com/kb/954910/zh-cn?spid=12925&amp;sid=496</a></a></p>
<p>我很高兴您已经找到了原因，因为AD与终端服务器装在一台机器上了，需要修改一个组<a href="http://gnaw0725.blogbus.com/logs/18223191.html" target="_blank">策略</a>。另外您想得到TS会话broker相关配置实现资料。</p>
<h1 id="-ts-broker-">关于TS会话broker相关配置实现资料，我已经提供在下面了。同时您能否告诉我，我们需要修改哪一个组策略，这样的话，更多的人可以从我们的帖子中受益。谢谢您。</h1>
<p>TS Session Broker Load Balancing Step-by-Step Guide
<a href="http://technet.microsoft.com/en-us/library/cc772418.aspx" target="_blank"><a href="http://technet.microsoft.com/en-us/library/cc772418.aspx">http://technet.microsoft.com/en-us/library/cc772418.aspx</a></a></p>
<p>我了解到你想知道TS Session broker和TS GW是否可以共存在一台计算机上，后者安装在后端的终端服务器上。
根据官方文档，TS Session broker和TS GW的安装并未做这样的限制。我认为应该可以共存在一台计算机上的。
同时我们安装TS网关和TS Session Broker时需要满足以下条件。您看到的文章来自活动目录seo <a href="http://gnaw0725.blogbus.com/c1404551/" target="_blank"><a href="http://gnaw0725.blogbus.com/c1404551/">http://gnaw0725.blogbus.com/c1404551/</a></a></p>
<h1 id="-ts-">若要正常使用 TS 网关，必须满足下列先决条件：</h1>
<p>1) 须拥有安装了 Windows Server 2008 的服务器
2) 必须是要配置为 TS 网关 服务器的计算机上 Administrators 组的成员
3) 必须为 TS 网关 服务器获取安全套接字层 (SSL) 证书（如果还没有该证书）。默认情况下，在 TS 网关 服务器上，RPC/HTTP 负载平衡服务和 Internet 信息服务 (IIS) 服务使用传输层安全 (TLS) 1.0 对通过 Internet 在客户端与 TS 网关 服务器之间进行的通信加密。若要正常使用 TLS，必须在 TS 网关 服务器上安装 SSL 证书
4) 如果配置的 TS 网关 授权策略要求客户端计算机上的用户是 Active Directory 安全组的成员，才能连接到 TS 网关 服务器，或如果要部署负载平衡的 TS 网关 服务器场，则 TS 网关 服务器必须也是 Active Directory 域服务域的成员</p>
<h1 id="-ts-session-broker-seo-http-gnaw0725-blogbus-com-c1404551-http-gnaw0725-blogbus-com-c1404551-">若要参与 TS Session Broker，服务器必须符合下列条件：您看到的文章来自活动目录seo <a href="http://gnaw0725.blogbus.com/c1404551/" target="_blank"><a href="http://gnaw0725.blogbus.com/c1404551/">http://gnaw0725.blogbus.com/c1404551/</a></a></h1>
<p>1) 服务器必须安装了“终端服务器”角色服务。
2) 服务器必须是 Active Directory 域的成员。
3) 服务器必须是负载平衡终端服务器场的成员。
4) 服务器必须是 TS Session Broker 服务器上的 Session Directory Computers 本地组的成员。
5) 服务器必须加入 TS Session Broker 中的场。</p>
<h1 id="-">我们可以查看以下中文技术文章:</h1>
<p>TS Session Broker 概述
<a href="http://technet2.microsoft.com/windowsserver2008/zh-CHS/library/eac0b3d4-c74c-465c-a2c7-536964fdd8842052.mspx?mfr=true" target="_blank"><a href="http://technet2.microsoft.com/windowsserver2008/zh-CHS/library/eac0b3d4-c74c-465c-a2c7-536964fdd8842052.mspx?mfr=true">http://technet2.microsoft.com/windowsserver2008/zh-CHS/library/eac0b3d4-c74c-465c-a2c7-536964fdd8842052.mspx?mfr=true</a></a>
安装 TS 网关的先决条件
<a href="http://technet2.microsoft.com/windowsserver2008/zh-CHS/library/eac0b3d4-c74c-465c-a2c7-536964fdd8842052.mspx?mfr=true" target="_blank"><a href="http://technet2.microsoft.com/windowsserver2008/zh-CHS/library/eac0b3d4-c74c-465c-a2c7-536964fdd8842052.mspx?mfr=true">http://technet2.microsoft.com/windowsserver2008/zh-CHS/library/eac0b3d4-c74c-465c-a2c7-536964fdd8842052.mspx?mfr=true</a></a>
徐颖彧 微软全球技术支持中心</p>
<p>终端服务网关windows 2008 TS Gateway的相关文章请参考
<a href="http://gnaw0725.blogbus.com/logs/30260910.html" target="_blank">windows 2008<em>终端服务网关</em>TSGateway 活动目录SEO</a>
<a href="http://gnaw0725.blogbus.com/logs/27525245.html" target="_blank">Windows 2008<em>终端</em>服务器<em>网关</em>web访问活动目录SEO</a>
<a href="http://www.googlesyndicatedsearch.com/u/blogbus?hl=zh-CN&amp;inlang=zh-CN&amp;newwindow=1&amp;ie=GB2312&amp;q=site%3Agnaw0725.blogbus.com+%D6%D5%B6%CB%B7%FE%CE%F1%CD%F8%B9%D8" target="_blank"><a href="http://www.googlesyndicatedsearch.com/u/blogbus?hl=zh-CN&amp;inlang=zh-CN&amp;newwindow=1&amp;ie=GB2312&amp;q=site%3Agnaw0725.blogbus.com+%D6%D5%B6%CB%B7%FE%CE%F1%CD%F8%B9%D8">http://www.googlesyndicatedsearch.com/u/blogbus?hl=zh-CN&amp;inlang=zh-CN&amp;newwindow=1&amp;ie=GB2312&amp;q=site%3Agnaw0725.blogbus.com+%D6%D5%B6%CB%B7%FE%CE%F1%CD%F8%B9%D8</a></a></p>
<p>终端服务器的更多文章请参考 <a href="http://gnaw0725.blogbus.com/logs/11692848.html" target="_blank">终端服务器专题</a></p>
<p>企业CA证书的相关文章请参考
<a href="http://gnaw0725.blogbus.com/logs/12646896.html" target="_blank"><em>企业CA证书</em>服务器|两个不同角色的CA能否在AD中同时存在活动目录SEO</a>
<a href="http://gnaw0725.blogbus.com/logs/13485981.html" target="_blank">证书迁移|迁移<em>企业CA证书</em>服务器活动目录SEO</a>
<a href="http://gnaw0725.blogbus.com/logs/12582315.html" target="_blank">迁移<em>证书</em>服务器|替换重新部署2003<em>企业</em>根<em>CA</em> 活动目录SEO</a>
<a href="http://gnaw0725.blogbus.com/logs/23481135.html" target="_blank">怎样删除子网<em>CA证书</em>活动目录SEO</a>
<a href="http://gnaw0725.blogbus.com/logs/26926272.html" target="_blank"><em>企业</em>根<em>CA</em>会自动颁发EFS<em>证书</em>活动目录SEO</a>
<a href="http://gnaw0725.blogbus.com/logs/30454120.html" target="_blank">域控制器申请<em>证书</em>活动目录SEO</a>
<a href="http://gnaw0725.blogbus.com/logs/28160582.html" target="_blank"><em>证书</em>吊销失效活动目录SEO</a>
<a href="http://gnaw0725.blogbus.com/logs/19092867.html" target="_blank">数字<em>证书</em>过期不能更新<em>证书</em>活动目录SEO</a>
<a href="http://www.googlesyndicatedsearch.com/u/blogbus?hl=zh-CN&amp;inlang=zh-CN&amp;newwindow=1&amp;ie=GB2312&amp;q=site%3Agnaw0725.blogbus.com+%C6%F3%D2%B5CA%D6%A4%CA%E9" target="_blank"><a href="http://www.googlesyndicatedsearch.com/u/blogbus?hl=zh-CN&amp;inlang=zh-CN&amp;newwindow=1&amp;ie=GB2312&amp;q=site%3Agnaw0725.blogbus.com+%C6%F3%D2%B5CA%D6%A4%CA%E9">http://www.googlesyndicatedsearch.com/u/blogbus?hl=zh-CN&amp;inlang=zh-CN&amp;newwindow=1&amp;ie=GB2312&amp;q=site%3Agnaw0725.blogbus.com+%C6%F3%D2%B5CA%D6%A4%CA%E9</a></a>
－－－gnaw0725
<strong>喜欢这篇文章吗？那就点击<a href="http://feed.feedsky.com/activedirectory" title="活动目录SEO RSS" target="_blank"><img src="" alt=""></a>订阅吧</strong></p>
<p><a href="http://gnaw0725.blogbus.com/" target="_blank">首页</a>| <a href="http://gnaw0725.blogbus.com/logs/31005239.html#cmt" target="_blank">评论 0</a> | <a href="http://gnaw0725.blogbus.com/logs/t31005239.html" target="_blank">引用 3</a> | <a href="http://www.blogbus.com/user/?mm=Post&amp;aa=Edit&amp;blogid=1370980&amp;id=31005239" target="_blank">编辑</a> <strong>按下键盘Ctrl+D会有惊喜发生</strong>
导航：[<a href="http://gnaw0725.blogbus.com/" target="_blank">活动目录SEO博客</a>]&gt;[<a href="http://gnaw0725.blogbus.com/c1404551/" target="_blank">系统网络管理</a>]&gt;[终端服务网关:没有足够的信息不能验证该证书]
原创： <a href="http://gnaw0725.blogbus.com/" target="_blank">活动目录SEO博客</a>版权所有。转载时必须注明本声明，本文作者和链接。
作者：<a href="http://home.blogbus.com/profile/gnaw0725" target="_blank">gnaw0725</a>
链接：<a href="http://gnaw0725.blogbus.com/logs/31005239.html" target="_blank"><a href="http://gnaw0725.blogbus.com/logs/31005239.html">http://gnaw0725.blogbus.com/logs/31005239.html</a></a>
时间：2008-11-05 09:10
<strong>收藏到：</strong> <a href=""><img src="" alt="百度收藏"></a><a href=""><img src="" alt="Google书签"></a> <a href=""><img src="" alt="QQ书签"></a> <a href=""><img src="" alt="天极网摘"></a> <a href=""><img src="" alt="新浪ViVi"></a> <a href=""><img src="" alt="和讯网摘"></a> <a href=""><img src="" alt="Windows Live"></a></p>
<p><strong>上</strong>一篇日志：<a href="http://gnaw0725.blogbus.com/logs/30971238.html" target="_blank">&lt;&lt;  win2008终端服务器配置</a>
<strong>下</strong>一篇日志：<a href="http://gnaw0725.blogbus.com/logs/31005633.html" target="_blank">微软虚拟化软件  &gt;&gt;</a>
『终端服务网关:没有足够的信息不能验证该证书 我想说：』<a href=""></a>   姓名：   网址：    <a href="http://feed.feedsky.com/activedirectory" title="活动目录SEO"><img src="" alt=""></a>
<strong>没找到？尝试站内搜索吧！</strong>
<img src="" alt="">
<strong>2010年2月最热文章</strong></p>
<p><a href="http://gnaw0725.blogbus.com/logs/57683055.html" target="_blank">2010年春节联欢晚会主持人串词台词1</a>
<a href="http://gnaw0725.blogbus.com/logs/16796652.html" target="_blank">Windows AD域</a>
<a href="http://gnaw0725.blogbus.com/logs/17762337.html" target="_blank">active directory教程入门</a>
<a href="http://gnaw0725.blogbus.com/logs/44271338.html" target="_blank">Windows 7没有声音</a>
<a href="http://gnaw0725.blogbus.com/logs/18971316.html" target="_blank">域控制器域服务器AD服务器</a></p>
<p><a href="http://gnaw0725.blogbus.com/logs/50846175.html" target="_blank">Windows Server 2008 SP2与R2有什么区别</a>
<a href="http://gnaw0725.blogbus.com/logs/8297325.html" target="_blank">一分钟加入google站内搜索代码|只有7行最精简</a>
<a href="http://gnaw0725.blogbus.com/logs/8359552.html" target="_blank">office2007无法卸载安装如何怎么强制卸载</a>
<a href="http://gnaw0725.blogbus.com/logs/18223191.html" target="_blank">组策略group policy专题</a>
<a href="http://gnaw0725.blogbus.com/logs/16093605.html" target="_blank">如何减小pagefile系统文件太大小</a></p>
<h3 id="-">终端服务网关:没有足够的信息不能验证该证书文章评论：</h3>
<h3 id="-">终端服务网关:没有足够的信息不能验证该证书文章归档：</h3>
<ul>
<li><a href="http://gnaw0725.blogbus.com/archives/1125190.html" target="_blank">2004/03/08 - 2004/12/31</a></li>
<li><a href="http://gnaw0725.blogbus.com/archives/1125191.html" target="_blank">2005/01/01 - 2005/12/31</a></li>
<li><a href="http://gnaw0725.blogbus.com/archives/1125192.html" target="_blank">2006/01/01 - 2006/12/31</a></li>
<li><a href="http://gnaw0725.blogbus.com/archives/1125193.html" target="_blank">2007/01/01 - 2007/12/31</a></li>
<li><a href="http://gnaw0725.blogbus.com/archives/1128984.html" target="_blank">2008/01/01 - 2008/12/31</a></li>
<li><a href="http://gnaw0725.blogbus.com/archives/1139880.html" target="_blank">2009/01/01 - 2009/08/31</a></li>
</ul>
<p>本页精品文章：终端服务网关:没有足够的信息不能验证该证书
<strong>活动目录SEO博客公告</strong>
<strong>月流量突破 10 万</strong>，总流量突破210万，如果您对<strong>活动目录域</strong>及<strong>网络管理</strong>也有心得，并且希望以此扩大自己影响力，只需要<strong><a href="http://gnaw0725.blogbus.com/logs/5612684.html" target="_blank">添加本站链接</a></strong>，然后将文章标题和链接<strong><a href="http://gnaw0725.cbox.ws/" target="_blank">在线留言给活动目录博客</a></strong>，活动目录博客将收录您的文章，并注明您的站点及链接。</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/域/">域</a></li></span></span> | <span class="tags">Tagged <a href="/tags/域/" class="label label-primary">域</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:40"datetime="2014-03-07 09:54:40"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-域--终端服务网关没有足够的信息不能验证该证书/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-域--终端服务网关没有足够的信息不能验证该证书" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-域--配置AD、CA、SSL，绑定keystore/">配置AD、CA、SSL，绑定keystore</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:40.000Z"> <a href="/2014/02/02/2014-02-02-域--配置AD、CA、SSL，绑定keystore/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-ad-ca-ssl-keystore">配置AD、CA、SSL，绑定keystore</h1>
<h1 id="-http-blog-csdn-net-freewind88-"><a href="http://blog.csdn.net/freewind88" target="_blank">风林火山</a></h1>
<h2 id="-">其疾如风，其徐如林，侵掠如火，不动如山，难知如阴，动如雷震 ——《孙子兵法》</h2>
<ul>
<li><a href="http://hi.csdn.net/space-notice.html" target="_blank">条新通知</a></li>
<li><a href="http://passport.csdn.net/UserLogin.aspx" target="_blank">登录</a></li>
<li><a href="http://passport.csdn.net/CSDNUserRegister.aspx" target="_blank">注册</a></li>
<li><a href="http://hi.csdn.net/" target="_blank">欢迎</a></li>
<li><a href="http://writeblog.csdn.net/Signout.aspx" target="_blank">退出</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">我的博客</a></li>
<li><a href="http://writeblog.csdn.net/configure.aspx" target="_blank">配置</a></li>
<li><a href="http://writeblog.csdn.net/PostEdit.aspx" target="_blank">写文章</a></li>
<li><a href="http://writeblog.csdn.net/PostList.aspx" target="_blank">文章管理</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">博客首页</a></li>
</ul>
<p>*</p>
<ul>
<li><p>全站 当前博客
*</p>
</li>
<li><p><a href="http://hi.csdn.net/freewind88" target="_blank">空间</a></p>
</li>
<li><a href="http://blog.csdn.net/freewind88" target="_blank">博客</a></li>
<li><a href="http://hi.csdn.net/!s/friend/list/freewind88" target="_blank">好友</a></li>
<li><a href="http://hi.csdn.net/!s/album/list/freewind88" target="_blank">相册</a></li>
<li><a href="http://hi.csdn.net/!s/wall/to/freewind88" target="_blank">留言</a></li>
</ul>
<p>用户操作<a href="http://hi.csdn.net/!s/wall/to/freewind88" target="_blank">[留言]</a>  <a href="http://hi.csdn.net/!s/msg/to/freewind88" target="_blank">[发消息]</a>  <a href="http://hi.csdn.net/!s/friend/add/freewind88" target="_blank">[加为好友]</a> 订阅我的博客<a href="http://feeds.feedsky.com/csdn.net/freewind88" target="_blank"><img src="" alt="XML聚合"></a>   <a href="http://feeds.feedsky.com/csdn.net/freewind88" target="_blank"><img src="" alt="FeedSky"></a><a href="http://www.xianguo.com/subscribe.php?url=http://feeds.feedsky.com/csdn.net/freewind88" target="_blank"><img src="" alt="订阅到鲜果"></a><a href="http://fusion.google.com/add?feedurl=http://feeds.feedsky.com/csdn.net/freewind88" target="_blank"><img src="" alt="订阅到Google"></a><a href="http://www.zhuaxia.com/add_channel.php?url=http://feeds.feedsky.com/csdn.net/freewind88" target="_blank"><img src="" alt="订阅到抓虾"></a><a href="http://writeblog.csdn.net/configure.aspx" target="_blank">[编辑]</a>freewind88的公告自己在Computer Science方面的所学，与大家一起交流<a href="http://writeblog.csdn.net/EditCategories.aspx?catID=1" target="_blank">[编辑]</a>文章分类* <a href="http://blog.csdn.net/freewind88/category/237967.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/freewind88/category/237967.aspx" target="_blank">C/C++</a></p>
<ul>
<li><a href="http://blog.csdn.net/freewind88/category/221073.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/freewind88/category/221073.aspx" target="_blank">Delphi</a></li>
<li><a href="http://blog.csdn.net/freewind88/category/328710.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/freewind88/category/328710.aspx" target="_blank">Domino</a></li>
<li><a href="http://blog.csdn.net/freewind88/category/12650.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/freewind88/category/12650.aspx" target="_blank">Java</a></li>
<li><a href="http://blog.csdn.net/freewind88/category/221072.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/freewind88/category/221072.aspx" target="_blank">Linux</a></li>
<li><a href="http://blog.csdn.net/freewind88/category/441413.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/freewind88/category/441413.aspx" target="_blank">Portlet</a></li>
<li><a href="http://blog.csdn.net/freewind88/category/238231.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/freewind88/category/238231.aspx" target="_blank">WebSphere</a></li>
<li><a href="http://blog.csdn.net/freewind88/category/328722.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/freewind88/category/328722.aspx" target="_blank">Windows</a></li>
<li><a href="http://blog.csdn.net/freewind88/category/12651.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/freewind88/category/12651.aspx" target="_blank">软件工程</a></li>
<li><a href="http://blog.csdn.net/freewind88/category/237966.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/freewind88/category/237966.aspx" target="_blank">数据库</a></li>
<li><a href="http://blog.csdn.net/freewind88/category/214719.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/freewind88/category/214719.aspx" target="_blank">网格计算</a></li>
<li><a href="http://blog.csdn.net/freewind88/category/272363.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/freewind88/category/272363.aspx" target="_blank">移动开发</a>存档* <a href="http://blog.csdn.net/freewind88/archive/2008/08.aspx" target="_blank">2008年08月(1)</a></li>
<li><a href="http://blog.csdn.net/freewind88/archive/2008/07.aspx" target="_blank">2008年07月(2)</a></li>
<li><a href="http://blog.csdn.net/freewind88/archive/2007/10.aspx" target="_blank">2007年10月(1)</a></li>
<li><a href="http://blog.csdn.net/freewind88/archive/2007/09.aspx" target="_blank">2007年09月(4)</a></li>
<li><a href="http://blog.csdn.net/freewind88/archive/2007/08.aspx" target="_blank">2007年08月(3)</a></li>
<li><a href="http://blog.csdn.net/freewind88/archive/2007/01.aspx" target="_blank">2007年01月(5)</a></li>
<li><a href="http://blog.csdn.net/freewind88/archive/2006/11.aspx" target="_blank">2006年11月(2)</a></li>
<li><a href="http://blog.csdn.net/freewind88/archive/2006/10.aspx" target="_blank">2006年10月(1)</a></li>
<li><a href="http://blog.csdn.net/freewind88/archive/2006/09.aspx" target="_blank">2006年09月(3)</a></li>
<li><a href="http://blog.csdn.net/freewind88/archive/2006/08.aspx" target="_blank">2006年08月(1)</a></li>
<li><a href="http://blog.csdn.net/freewind88/archive/2006/07.aspx" target="_blank">2006年07月(1)</a></li>
<li><a href="http://blog.csdn.net/freewind88/archive/2006/06.aspx" target="_blank">2006年06月(2)</a></li>
<li><a href="http://blog.csdn.net/freewind88/archive/2004/05.aspx" target="_blank">2004年05月(5)</a><h1 id="-ad-ca-ssl-keystore-"><img src="" alt="原创">  配置AD、CA、SSL，绑定keystore <a href="&quot;收藏到我的网摘中，并分享给我的朋友&quot;">收藏</a></h1>
</li>
</ul>
<p>在这就简单的介绍一下配置过程，未提到的设置基本就都采用默认即可。
1）安装AD:
开始 -&gt; 运行 -&gt; dcpromote
域名: testad.com.cn
NT域名: ldap
即 Fully Qualified Domain Name (FQDN) 为 ldap.testad.com.cn
注意，一定要先安装 IIS , 再安装 CA.
2）安装 IIS:
开始-&gt; 程序 -&gt; 管理工具 -&gt; 配置您的服务器向导 -&gt; 应用服务器 (IIS, ASP.NET)
进入 http:// ldap.testad.com.cn /iisstart.htm 表示安装成功.
3）安装CA:
开始-&gt; 设置 -&gt; 控制面板-&gt; 添加或删除程序 -&gt;添加/删除Windows组件 -&gt; 证书服务
选择 企业根CA
共用名称 CA: testca
进入 http:// ldap.testad.com.cn /CertSrv 表示安装成功.
4）生成证书请求:
开始-&gt;程序-&gt;管理工具-&gt; Internet 信息服务 (IIS) 管理器 -&gt; Internet信息服务-&gt; (本地计算机) -&gt; 网站
-&gt;  右键点选 默认网站 -&gt; 属性 -&gt;选择 &quot;目录安全性&quot; -&gt; 服务器证书
-&gt;新建证书 -&gt; 准备证书，但稍后发送
公共名称最好设置为 ldap.testad.com.cn, 这是给使用者连ssl 的 站点.
最后产生证书请求文件 , 默认为c:\certreq.txt
5）在CA上请求证书:
进入 http:// ldap.testad.com.cn /CertSrv
按 申请一个证书 -&gt; 高级证书申请
-&gt; 使用 base64 编码的 CMC 或 PKCS /#10 文件提交一个证书申请，或使用 base64 编码的 PKCS /#7 文件续订证书申请。
使用 记事本 打开 c:\certreq.txt , copy c:\certreq.txt 内容贴至 保存的申请:
证书模板 选择 Web 服务器, 按 提交
然后点选 下载证书 , 将 certnew.cer 储存至 c:\certnew.cer
6）安装证书:
开始-&gt;程序-&gt;管理工具-&gt; Internet 信息服务 (IIS) 管理器 -&gt; Internet信息服务-&gt; (本地计算机) -&gt; 网站
-&gt;  右键点选默认网站-&gt;属性 -&gt; 选择 &quot;目录安全性&quot; -&gt;服务器证书
-&gt;处理挂起的请求，安装证书 -&gt; 路径和文件名: c:\certnew.cer
网站SSL 端口: 443
7）将 CA 证书 加入至keystore 里:
进入 http:// ldap.testad.com.cn /CertSrv
点选 下载一个 CA 证书，证书链或 CRL
点选 下载 CA 证书, 然后下载并改名为 c:\ca_cert.cer
安装CA后LDAP服务器C盘根目录会生成一文件ldap.testad.com.cn_testca.crt
然后执行 命令:
keytool -import -keystore &quot;c:/testca.keystore&quot; -file &quot;ldap.testad.com.cn_testca.crt&quot; -storepass &quot;changeit&quot;
keytool -import -keystore &quot;c:/testca.keystore&quot; -alias mkey -file &quot;c:/ca_cert.cer&quot; -storepass &quot;changeit&quot;
出现 Trusted this certificate? 按 &quot;y&quot; 即新增成功.
但经过个人的测试，其实只需使用ldap.testad.com.cn_testca.crt这个证书就可以连接上SSL AD 636。</p>
<p>发表于 @ 2007年08月17日　14:29:00 | <a href="http://blog.csdn.net/freewind88/archive/2007/08/17/1748225.aspx#FeedBack" title="评论" target="_blank">评论( loading...  )</a>| <a href="http://writeblog.csdn.net/PostEdit.aspx?entryId=1748225" title="编辑" target="_blank">编辑</a>| <a href="mailto:webmaster@csdn.net?subject=Article Report!!!&amp;body=Author:freewind88URL:http://blog.csdn.net/ArticleContent.aspx?UserName=freewind88&amp;Entryid=1748225">举报</a>| <a href="&quot;收藏到我的网摘中，并分享给我的朋友&quot;">收藏</a></p>
<h3 id="-java-ms-ad-http-blog-csdn-net-freewind88-archive-2007-08-16-1746349-aspx-domino-ad-http-blog-csdn-net-freewind88-archive-2007-08-18-1749624-aspx-"><a href="http://blog.csdn.net/freewind88/archive/2007/08/16/1746349.aspx" target="_blank">旧一篇:Java添加、修改MS AD用户密码</a> | <a href="http://blog.csdn.net/freewind88/archive/2007/08/18/1749624.aspx" target="_blank">新一篇:在Domino中修改AD密码</a></h3>
<p><a href="http://blog.csdn.net/" target="_blank">查看最新精华文章 请访问博客首页</a>相关文章<a href=""></a></p>
<ul>
<li><p>发表评论</p>
</li>
<li><p>表 情：</p>
</li>
<li><p><a href="http://blog.csdn.net/freewind88/archive/2007/08/17/1748225.aspx#" target="_blank"><img src="&quot;顶&quot;" alt="顶"></a> <a href="http://blog.csdn.net/freewind88/archive/2007/08/17/1748225.aspx#" target="_blank"><img src="&quot;砸&quot;" alt="砸"></a> <a href="http://blog.csdn.net/freewind88/archive/2007/08/17/1748225.aspx#" target="_blank"><img src="&quot;棒&quot;" alt="棒"></a> <a href="http://blog.csdn.net/freewind88/archive/2007/08/17/1748225.aspx#" target="_blank"><img src="&quot;大笑&quot;" alt="大笑"></a> <a href="http://blog.csdn.net/freewind88/archive/2007/08/17/1748225.aspx#" target="_blank"><img src="&quot;愤怒&quot;" alt="愤怒"></a> <a href="http://blog.csdn.net/freewind88/archive/2007/08/17/1748225.aspx#" target="_blank"><img src="&quot;大哭&quot;" alt="大哭"></a> <a href="http://blog.csdn.net/freewind88/archive/2007/08/17/1748225.aspx#" target="_blank"><img src="&quot;疑问&quot;" alt="疑问"></a> <a href="http://blog.csdn.net/freewind88/archive/2007/08/17/1748225.aspx#" target="_blank"><img src="&quot;汗&quot;" alt="汗"></a> <a href="http://blog.csdn.net/freewind88/archive/2007/08/17/1748225.aspx#" target="_blank"><img src="&quot;呕吐&quot;" alt="呕吐"></a> <a href="http://blog.csdn.net/freewind88/archive/2007/08/17/1748225.aspx#" target="_blank"><img src="&quot;送花&quot;" alt="送花"></a></p>
</li>
<li><p>评论内容：
*</p>
</li>
<li>用 户 名：</li>
<li><p><a href="">登录</a> <a href="http://passport.csdn.net/CSDNUserRegister.aspx" target="_blank">注册</a> 匿名评论</p>
</li>
<li><p>验 证 码：</p>
</li>
<li><a href=""><img src="" alt="验证码"></a> <a href="">重新获得验证码</a></li>
</ul>
<p><em>
</em><img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/域/">域</a></li></span></span> | <span class="tags">Tagged <a href="/tags/域/" class="label label-primary">域</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:40"datetime="2014-03-07 09:54:40"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-域--配置AD、CA、SSL，绑定keystore/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-域--配置AD、CA、SSL，绑定keystore" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-域-win2008CA证书安装--如何在OperationsManager2007中使用WindowsServer200/">如何在 Operations Manager 2007 中使用 Windows Server 200</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:40.000Z"> <a href="/2014/02/02/2014-02-02-域-win2008CA证书安装--如何在OperationsManager2007中使用WindowsServer200/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-operations-manager-2007-windows-server-2008-ca-">如何在 Operations Manager 2007 中使用 Windows Server 2008 企业 CA 来获取证书</h1>
<ul>
<li><a href="http://technet.microsoft.com/" title="面向 IT 专业人员的资源" target="_blank">TechNet</a></li>
<li><a href="">产品</a></li>
<li><a href="">资源</a></li>
<li><a href="">下载</a></li>
<li><p><a href="">支持</a></p>
<h3 id="-">产品</h3>
</li>
<li><p><a href="http://technet.microsoft.com/windows" target="_blank"><img src="" alt=""></a> <a href="http://technet.microsoft.com/windows" target="_blank">Windows</a></p>
</li>
<li><a href="http://technet.microsoft.com/windowsserver" target="_blank"><img src="" alt=""></a> <a href="http://technet.microsoft.com/windowsserver">Windows
Server</a></li>
<li><a href="http://technet.microsoft.com/systemcenter" target="_blank"><img src="" alt=""></a> <a href="http://technet.microsoft.com/systemcenter">System
Center</a></li>
<li><a href="http://technet.microsoft.com/ie" target="_blank"><img src="" alt=""></a> <a href="http://technet.microsoft.com/ie">Internet
Explorer</a></li>
</ul>
<h3 id="-"> </h3>
<ul>
<li><a href="http://technet.microsoft.com/office" target="_blank"><img src="" alt=""></a> <a href="http://technet.microsoft.com/office" target="_blank">Office</a></li>
<li><a href="http://technet.microsoft.com/office365" target="_blank"><img src="" alt=""></a> <a href="http://technet.microsoft.com/office365" target="_blank">Office 365</a></li>
<li><p><a href="http://technet.microsoft.com/exchange" target="_blank"><img src="" alt=""></a> <a href="http://technet.microsoft.com/exchange">Exchange
Server</a></p>
<h3 id="-"> </h3>
</li>
<li><p><a href="http://technet.microsoft.com/sql" target="_blank"><img src="" alt=""></a> <a href="http://technet.microsoft.com/sql" target="_blank">SQL Server</a></p>
</li>
<li><a href="http://technet.microsoft.com/sharepoint" target="_blank"><img src="" alt=""></a> <a href="http://technet.microsoft.com/sharepoint">SharePoint
产品</a></li>
<li><a href="http://technet.microsoft.com/lync" target="_blank"><img src="" alt=""></a> <a href="http://technet.microsoft.com/lync" target="_blank">Lync</a></li>
<li><a href="http://technet.microsoft.com/bb421517.aspx?wt.svl=more_centers_link" target="_blank">查看所有产品 »</a></li>
</ul>
<h3 id="-">资源</h3>
<ul>
<li><a href="http://technet.microsoft.com/scriptcenter" target="_blank">脚本中心</a></li>
<li><a href="http://technet.microsoft.com/solutionaccelerators" target="_blank">解决方案加速器</a></li>
<li><a href="http://technet.microsoft.com/sysinternals" target="_blank">Windows Sysinternals</a></li>
<li><a href="http://technet.microsoft.com/evalcenter" target="_blank">评估中心</a></li>
<li><a href="http://answers.microsoft.com/" target="_blank">Microsoft Answers</a></li>
<li><a href="http://technet.microsoft.com/edge" target="_blank">TechNet Edge</a></li>
</ul>
<h3 id="-"> </h3>
<ul>
<li><a href="http://technet.microsoft.com/cc543196" target="_blank">TechNet 中文速递邮件</a></li>
<li><a href="http://technet.microsoft.com/magazine" target="_blank">TechNet 杂志</a></li>
<li><a href="http://technet.microsoft.com/subscriptions" target="_blank">TechNet 订阅</a></li>
<li><a href="http://technet.microsoft.com/virtuallabs" target="_blank">虚拟实验室</a></li>
<li><p><a href="http://technet.microsoft.com/zh-cn/ff871877" target="_blank">关于 TechNet</a></p>
<h3 id="-">解决方案</h3>
</li>
<li><p><a href="http://technet.microsoft.com/bi" target="_blank">商业智能</a></p>
</li>
<li><a href="http://technet.microsoft.com/network" target="_blank">网络</a></li>
<li><a href="http://technet.microsoft.com/private-cloud" target="_blank">私有云</a></li>
<li><a href="http://technet.microsoft.com/security" target="_blank">安全性</a></li>
<li><p><a href="http://technet.microsoft.com/virtualization" target="_blank">虚拟化</a></p>
<h3 id="-">下载</h3>
</li>
<li><p><a href="http://technet.microsoft.com/windows/gg635126" target="_blank">适用于 Windows Server 2008 R2 和 Windows 7 的 SP1 RTM</a></p>
</li>
<li><a href="http://windows.microsoft.com/zh-cn/internet-explorer/downloads/ie-9/worldwide-languages" target="_blank">Internet Explorer 9</a></li>
<li><a href="http://www.microsoft.com/sqlserver/en/us/get-sql-server/try-it.aspx" target="_blank">SQL Server 2012</a></li>
<li><a href="http://technet.microsoft.com/bb403698" target="_blank">查看所有下载 »</a></li>
</ul>
<h3 id="-">评估</h3>
<ul>
<li><a href="http://technet.microsoft.com/evalcenter/hh670538" target="_blank">Windows Server &quot;8&quot; Beta 试用版</a></li>
<li><a href="http://technet.microsoft.com/evalcenter/ee390818" target="_blank">Office Professional Plus 2010</a></li>
<li><a href="http://technet.microsoft.com/evalcenter/cc442495" target="_blank">Windows 7 企业版试用版</a></li>
<li><a href="http://technet.microsoft.com/evalcenter/ee404758" target="_blank">Project Professional 2010</a></li>
<li><a href="http://technet.microsoft.com/evalcenter/dd459137.aspx" target="_blank">Windows Server 2008 R2 SP1</a></li>
<li><p><a href="http://technet.microsoft.com/evalcenter/bb291020" target="_blank">查看所有评估 »</a></p>
<h3 id="tools">Tools</h3>
</li>
<li><p><a href="http://support.microsoft.com/default.aspx?id=fh;zh-cn;sp&amp;fr=0&amp;sd=gn&amp;ln=zh-cn&amp;ct=sd&amp;se=nona" target="_blank">Service Pack</a></p>
</li>
<li><a href="http://gallery.technet.microsoft.com/scriptcenter" target="_blank">TechNet 脚本中心</a></li>
<li><a href="http://technet.microsoft.com/security/cc297183" target="_blank">安全工具</a></li>
<li><a href="http://www.microsoft.com/downloads/search.aspx" target="_blank">Microsoft 下载中心</a></li>
</ul>
<h3 id="technet-">TechNet 支持</h3>
<ul>
<li><a href="http://technet.microsoft.com/exchange/ff396001.aspx" target="_blank">Exchange Server 2010</a></li>
<li><a href="http://technet.microsoft.com/forefront/ff404202" target="_blank">Forefront 产品</a></li>
<li><a href="http://support.microsoft.com/ph/807#tab0" target="_blank">Internet Explorer 9</a></li>
<li><a href="http://technet.microsoft.com/office/ee263916" target="_blank">Office 2010</a></li>
<li><a href="http://technet.microsoft.com/sharepoint/ee410533" target="_blank">SharePoint Server 2010</a></li>
<li><a href="http://technet.microsoft.com/sqlserver/ff472320" target="_blank">SQL Server 2008 R2</a></li>
</ul>
<h3 id="-"> </h3>
<ul>
<li><a href="http://technet.microsoft.com/windows/bb187457" target="_blank">Windows 7</a></li>
<li><a href="http://technet.microsoft.com/systemcenter/cc511006" target="_blank">System Center</a></li>
<li><a href="http://technet.microsoft.com/windowsserver/bb512923" target="_blank">Windows Server 2008 R2</a></li>
<li><p><a href="http://social.technet.microsoft.com/Forums/categories" target="_blank">在 TechNet 论坛中询问问题</a></p>
<h3 id="microsoft-">Microsoft 支持</h3>
</li>
<li><p><a href="http://support.microsoft.com/" target="_blank">Microsoft 支持</a></p>
</li>
<li><a href="http://support.microsoft.com/fixit/" target="_blank">Microsoft Fix It</a></li>
<li><a href="http://www.microsoft.com/services/microsoftservices/busi.mspx" target="_blank">Microsoft 高级和基本支持选项</a></li>
</ul>
<p><a href="http://technet.microsoft.com/zh-cn/systemcenter/bb980621" title="System Center" target="_blank"><img src="" alt="System Center"></a></p>
<p><a href=""></a>
<a href="http://technet.microsoft.com/zh-cn/library/preferences/locale/?returnurl=%252fzh-cn%252flibrary%252fdd362553.aspx" title="中国（简体中文）" target="_blank">中国（简体中文）</a> <a href="https://login.live.com/login.srf?wa=wsignin1.0&amp;rpsnv=11&amp;ct=1335521190&amp;rver=6.0.5276.0&amp;wp=MCLBI&amp;wlcxt=technet%24technet%24technet&amp;wreply=http%3a%2f%2ftechnet.microsoft.com%2flibrary%2fdd362553.aspx&amp;lc=2052&amp;id=254354&amp;mkt=zh-CN" title=" 登录  " target="_blank">登录</a></p>
<p><a href="http://technet.microsoft.com/zh-cn/systemcenter/bb980621" title="主页" target="_blank">主页</a></p>
<p><a href="http://technet.microsoft.com/library/cc507089" title="库" target="_blank">库</a>
<a href="http://technet.microsoft.com/zh-cn/systemcenter/cc511005" title="学习" target="_blank">学习</a></p>
<p><a href="http://technet.microsoft.com/zh-cn/systemcenter/cc137824" title="下载" target="_blank">下载</a>
<a href="http://technet.microsoft.com/zh-cn/systemcenter/cc511006" title="支持" target="_blank">支持</a></p>
<p><a href="http://technet.microsoft.com/zh-cn/library/preferences/experience/?returnurl=%252fzh-cn%252flibrary%252fdd362553.aspx" title="首选项" target="_blank"></a> <a href="http://technet.microsoft.com/zh-cn/library/dd362553(d=printer"></a>.aspx &quot;打印/导出&quot;)</p>
<p><a href="http://technet.microsoft.com/zh-cn/library/dd362553(d=printer" target="_blank">打印此主题</a>.aspx) <a href="http://technet.microsoft.com/zh-cn/library/export/help/?returnurl=%2fzh-cn%2flibrary%2fdd362553.aspx" target="_blank">打印多个主题</a></p>
<p><a href="http://technet.microsoft.com/zh-cn/library/dd362553(d=printer" target="_blank">打印此主题</a>.aspx &quot;打印此主题&quot;)
<a href="http://technet.microsoft.com/zh-cn/library/export/help/?returnurl=%2fzh-cn%2flibrary%2fdd362553.aspx" title="打印多个主题" target="_blank">打印多个主题</a>
<a href="http://technet.microsoft.com/library/dd362553.aspx#" target="_blank"></a><a href="http://technet.microsoft.com/zh-cn/library/aa991542.aspx" title="TechNet 库">TechNet 库</a></p>
<p><a href="http://technet.microsoft.com/library/dd362553.aspx#" target="_blank"></a><a href="http://technet.microsoft.com/zh-cn/library/cc440498.aspx" title="Systems Management">Systems Management</a>
<a href="http://technet.microsoft.com/library/dd362553.aspx#" target="_blank"></a><a href="http://technet.microsoft.com/zh-cn/library/bb310604.aspx" title="System Center Operations Manager 2007">System Center Operations Manager 2007</a></p>
<p><a href="http://technet.microsoft.com/library/dd362553.aspx#" target="_blank"></a><a href="http://technet.microsoft.com/zh-cn/library/bb821997.aspx" title="配置 Operations Manager 2007 R2 的安全">配置 Operations Manager 2007 R2 的安全</a>
<a href="http://technet.microsoft.com/library/dd362553.aspx#" target="_blank"></a><a href="http://technet.microsoft.com/zh-cn/library/bb735408.aspx" title="Windows 计算机的身份验证和数据加密">Windows 计算机的身份验证和数据加密</a></p>
<p><a href="http://technet.microsoft.com/zh-cn/library/bb735414.aspx" title="如何将操作控制台配置为在连接到报表服务器时使用 SSL" target="_blank">如何将操作控制台配置为在连接到报表服务器时使用 SSL</a>
<a href="http://technet.microsoft.com/zh-cn/library/bb735413.aspx" title="如何使用 Windows Server 2003 企业 CA 来获取证书" target="_blank">如何使用 Windows Server 2003 企业 CA 来获取证书</a></p>
<p><a href="http://technet.microsoft.com/zh-cn/library/bb735417.aspx" title="如何使用 Windows Server 2003 独立 CA 来获取证书" target="_blank">如何使用 Windows Server 2003 独立 CA 来获取证书</a>
<a href="http://technet.microsoft.com/zh-cn/library/dd362553.aspx" title="如何使用 Windows Server 2008 企业 CA 来获取证书" target="_blank">如何使用 Windows Server 2008 企业 CA 来获取证书</a></p>
<p><a href="http://technet.microsoft.com/zh-cn/library/dd362655.aspx" title="如何使用 Windows Server 2008 独立 CA 来获取证书" target="_blank">如何使用 Windows Server 2008 独立 CA 来获取证书</a>
<a href="http://technet.microsoft.com/zh-cn/library/bb735418.aspx" title="如何删除使用 MOMCertImport 导入的证书" target="_blank">如何删除使用 MOMCertImport 导入的证书</a></p>
<p><a href="http://technet.microsoft.com/zh-cn/library/bb735407.aspx" title="如何更改与运行方式配置文件相关联的运行方式帐户" target="_blank">如何更改与运行方式配置文件相关联的运行方式帐户</a>
<a href="http://technet.microsoft.com/zh-cn/library/dd441789.aspx" title="如何为 Windows Server 2008 CA 配置 HTTPS 绑定" target="_blank">如何为 Windows Server 2008 CA 配置 HTTPS 绑定</a></p>
<p>社区内容</p>
<p><a href="http://technet.microsoft.com/library/dd362553.aspx#CommunityContent" title="用户" target="_blank"><img src="" alt="头像"></a></p>
<ul>
<li>添加代码示例和提示以增强此主题。
<a href="http://technet.microsoft.com/library/dd362553.aspx#CommunityContent" title="更多..." target="_blank">更多...</a></li>
</ul>
<p><a href=""><img src="&quot;展开&quot;" alt="展开"> <img src="&quot;最小化&quot;" alt="最小化"></a></p>
<h1 id="-operations-manager-2007-windows-server-2008-ca-">如何在 Operations Manager 2007 中使用 Windows Server 2008 企业 CA 来获取证书</h1>
<p>此主题尚未评级 <a href="http://technet.microsoft.com/library/dd362553.aspx#feedback" title="评价此主题" target="_blank">- 评价此主题</a></p>
<p>更新时间: 2009年5月</p>
<p>应用到: Operations Manager 2007 R2, Operations Manager 2007 SP1
使用本主题中的过程从主持企业根 Active Directory 证书服务 (AD CS) 的 Windows Server 2008 计算机获取证书。您将使用 CertReq 命令行实用程序来申请和接受证书，并使用 Web 界面来提交和检索证书。</p>
<p>假定您已安装 AD CS，HTTPS 绑定已完成创建，其关联的证书已完成安装。主题<a href="http://technet.microsoft.com/zh-cn/library/dd441789.aspx" target="_blank">如何为 Windows Server 2008 CA 配置 HTTPS 绑定</a>中提供有关创建 HTTPS 绑定的信息。
<img src="&quot;Important&quot;" alt="Important">重要 本主题的内容基于 Windows Server 2008 AD CS 的默认设置；例如，将密钥长度设置为 2048，选择 Microsoft 软件密钥存储提供程序作为 CSP，并使用安全哈希算法 1 (SHA1)。根据您公司的安全策略的要求来评估这些选择。</p>
<p>从企业证书颁发机构 (CA) 获取证书的高级别过程如下：</p>
<ol>
<li>下载受信任的根 (CA) 证书。</li>
<li>导入受信任的根 (CA) 证书。</li>
<li>创建证书模板。</li>
<li>将模板添加到“证书模板”文件夹。</li>
<li>创建安装信息文件以与 CertReq 命令行实用程序一起使用。</li>
<li>创建申请文件。</li>
<li>向 CA 提交申请。</li>
<li>将证书导入证书存储。</li>
<li>使用 MOMCertImport 将证书导入 Operations Manager。</li>
</ol>
<h2 id="-ca-">下载受信任的根 (CA) 证书</h2>
<ol>
<li>登录安装了证书的计算机；如网关服务器或管理服务器。</li>
<li>启动 Internet Explorer，然后连接到宿主证书服务的计算机，例如 https://&lt;服务器名称&gt;/certsrv。</li>
<li>在<strong>“欢迎”</strong>页上，单击<strong>“下载 CA 证书、证书链或 CRL”</strong>。</li>
<li>在<strong>“下载 CA 证书、证书链或 CRL”</strong>页上，依次单击<strong>“编码方法”</strong>、<strong>&quot;Base 64&quot;</strong> 和<strong>“下载 CA 证书链”</strong>。</li>
<li>在<strong>“文件下载”</strong>对话框中，单击<strong>“保存”</strong>以保存证书；例如 <strong>&quot;Trustedca.p7b&quot;</strong>。</li>
<li>下载完成后，关闭 Internet Explorer。</li>
</ol>
<h2 id="-ca-">导入受信任的根 (CA) 证书</h2>
<ol>
<li>在 Windows 桌面上，单击<strong>“开始”</strong>，然后单击<strong>“运行”</strong>。</li>
<li>在<strong>“运行”</strong>对话框中，键入 <strong>&quot;mmc&quot;</strong>，然后单击<strong>“确定”</strong>。</li>
<li>在<strong>“控制台 1”</strong>窗口中，单击<strong>“文件”</strong>，然后单击<strong>“添加/删除管理单元”</strong>。</li>
<li>在<strong>“添加/删除管理单元”</strong>对话框中，单击<strong>“添加”</strong>。</li>
<li>在<strong>“添加独立管理单元”</strong>对话框中，单击<strong>“证书”</strong>，然后单击<strong>“添加”</strong>。</li>
<li>在<strong>“证书管理单元”</strong>对话框中，选择<strong>“计算机帐户”</strong>，然后单击<strong>“下一步”</strong>。</li>
<li>在<strong>“选择计算机”</strong>对话框中，确保已选择<strong>“本地计算机：（此控制台在其上运行的计算机）”</strong>，然后单击<strong>“完成”</strong>。</li>
<li>在<strong>“添加独立管理单元”</strong>对话框中，单击<strong>“关闭”</strong>。</li>
<li>在<strong>“添加/删除管理单元”</strong>对话框中，单击<strong>“确定”</strong>。</li>
<li>在<strong>“控制台 1”</strong>窗口中，依次展开<strong>“证书（本地计算机）”</strong>、<strong>“受信任的根证书颁发机构”</strong>，然后单击<strong>“证书”</strong>。</li>
<li>右键单击<strong>“证书”</strong>，选择<strong>“所有任务”</strong>，然后单击<strong>“导入”</strong>。</li>
<li>在证书导入向导中，单击<strong>“下一步”</strong>。</li>
<li>在<strong>“要导入的文件”</strong>页上，单击<strong>“浏览”</strong>，然后选择下载 CA 证书文件的位置，例如 TrustedCA.p7b，选择文件，然后单击<strong>“打开”</strong>。</li>
<li>在<strong>“要导入的文件”</strong>页上，选择<strong>“将所有的证书放入下列存储”</strong>，确保<strong>“受信任的根证书颁发机构”</strong>显示在<strong>“证书存储”</strong>框中，然后单击<strong>“下一步”</strong>。</li>
<li>在<strong>“正在完成证书导入向导”</strong>页上，单击<strong>“完成”</strong>。</li>
</ol>
<h2 id="-">创建证书模板</h2>
<ol>
<li>在宿主企业 CA 的计算机的 Windows 桌面上，单击<strong>“开始”</strong>，依次指向<strong>“程序”</strong>、<strong>“管理”</strong> <strong>“工具”</strong>，然后单击<strong>“证书颁发机构”</strong>。</li>
<li>在“导航”窗格中，展开 CA 名称，右键单击<strong>“证书</strong> <strong>模板”</strong>，然后单击<strong>“管理”</strong>。</li>
<li>在<strong>“证书模板”</strong>控制台的结果窗格中，右键单击<strong>“IPSec（脱机申请）”</strong>，然后单击<strong>“复制模板”</strong>。</li>
<li>在<strong>“复制模板”</strong>对话框中，选择 <strong>&quot;Windows Server 2003 Enterprise Edition&quot;</strong>，然后单击<strong>“确定”</strong>。
<img src="&quot;note&quot;" alt="note">注意 此时不支持 Windows Server 2008 Enterprise Edition 的选项。</li>
<li>在<strong>“新模板的属性”</strong>对话框中，在<strong>“常规”</strong>选项卡上的<strong>“模板显示名称”</strong>文本框中，键入此模板的新名称，例如 <strong>&quot;OperationsManagerCert&quot;</strong>。</li>
<li>在<strong>“请求处理”</strong>选项卡上，选择<strong>“允许导出私钥”</strong>。</li>
<li>单击<strong>“扩展”</strong>选项卡，在<strong>“这个模板中包括的扩展”</strong>中单击<strong>“应用程序策略”</strong>，然后单击<strong>“编辑”</strong>。</li>
<li>在<strong>“编辑应用程序策略扩展”</strong>对话框中，单击<strong>“IP 安全 IKE 中级”</strong>，然后单击<strong>“删除”</strong>。</li>
<li>单击<strong>“添加”</strong>，在<strong>“应用程序策略列表”</strong>中，按住 Ctrl 从列表中选择多个项目，单击<strong>“客户端身份验证”</strong>和<strong>“服务器身份验证”</strong>，然后单击<strong>“确定”</strong>。</li>
<li>在<strong>“编辑应用程序策略扩展”</strong>对话框中，单击<strong>“确定”</strong>。</li>
<li>单击<strong>“安全”</strong>选项卡，确保<strong>“经过身份验证的用户”</strong>组具有<strong>“读取”</strong>和<strong>“注册”</strong>权限，然后单击<strong>“确定”</strong>。</li>
<li>关闭证书模板控制台。</li>
</ol>
<h2 id="-">将模板添加到“证书模板”文件夹</h2>
<ol>
<li>在宿主企业 CA 的计算机的“证书颁发机构”管理单元中，右键单击<strong>“证书模板”</strong>文件夹，指向<strong>“新建”</strong>，然后单击<strong>“要颁发的证书模板”</strong>。</li>
<li>在<strong>“启用模板证书”</strong>框中，选择已经创建的证书模板；例如，单击 <strong>&quot;OperationsManagerCert&quot;</strong>，然后单击<strong>“确定”</strong>。</li>
</ol>
<h2 id="-inf-">创建安装信息 (.inf) 文件</h2>
<ol>
<li>在主持申请其证书的 Operations Manager 组件的计算机上，单击<strong>“开始”</strong>，然后单击<strong>“运行”</strong>。</li>
<li>在<strong>“运行”</strong>对话框中，键入 <strong>&quot;Notepad&quot;</strong>，然后单击<strong>“确定”</strong>。</li>
<li>创建包含以下内容的文本文件：</li>
</ol>
<p><strong>[NewRequest]</strong></p>
<p><strong>Subject=&quot;CN=&lt;您正在创建证书的计算机的完全限定域名 FQDN，例如，网关服务器或管理服务器。&gt;&quot;</strong></p>
<p><strong>Exportable=TRUE</strong></p>
<p><strong>KeyLength=2048</strong></p>
<p><strong>KeySpec=1</strong></p>
<p><strong>KeyUsage=0xf0</strong></p>
<p><strong>MachineKeySet=TRUE</strong></p>
<p><strong>[EnhancedKeyUsageExtension]</strong></p>
<p><strong>OID=1.3.6.1.5.5.7.3.1</strong></p>
<p><strong>OID=1.3.6.1.5.5.7.3.2</strong></p>
<ol>
<li>保存带有 .inf 文件扩展名的文件；例如，RequestConfig.inf。</li>
<li>关闭记事本。</li>
</ol>
<h2 id="-ca-">创建申请文件以与企业 CA 一起使用</h2>
<ol>
<li>在主持申请其证书的 Operations Manager 组件的计算机上，单击<strong>“开始”</strong>，然后单击<strong>“运行”</strong>。</li>
<li>在<strong>“运行”</strong>对话框中，键入 <strong>&quot;cmd&quot;</strong>，然后单击<strong>“确定”</strong>。</li>
<li>在命令窗口中，键入<strong>CertReq –New –f RequestConfig.inf CertRequest.req</strong>，然后按 Enter。</li>
<li>使用记事本，打开转换后的文件（例如，CertRequest.req），并将此文件的内容复制到剪贴板。</li>
</ol>
<h2 id="-ca-">向企业 CA 提交申请</h2>
<ol>
<li>在主持申请其证书的 Operations Manager 组件的计算机上，启动 Internet Explorer，然后连接到主持证书服务器的计算机；例如，https://&lt;服务器名称&gt;/certsrv。
<img src="&quot;note&quot;" alt="note">注意 如果尚未在证书服务网站上配置 HTTPS 绑定，浏览器将无法连接。请参阅本指南中的<a href="http://technet.microsoft.com/zh-cn/library/dd441789.aspx" target="_blank">如何为 Windows Server 2008 CA 配置 HTTPS 绑定</a>主题。</li>
<li>在<strong>“Microsoft Active Directory 证书服务欢迎”</strong>屏幕上，单击<strong>“申请一个证书”</strong>。</li>
<li>在<strong>“申请一个证书”</strong>页上，单击<strong>“高级证书申请”</strong>。</li>
<li>在<strong>“高级证书申请”</strong>页上，单击<strong>“使用 Base64 编码的 CMC 或 PKCS /#10 文件提交证书申请，或使用 Base64 编码的 PKCS /#7 文件提交续订申请”</strong>。</li>
<li>在<strong>“提交证书申请或续订申请”</strong>页上的<strong>“保存的申请”</strong>文本框中，粘贴您在上一过程的步骤 4 中复制的 CertRequest.req 文件的内容。</li>
<li>在<strong>“证书模板”</strong>中选择已经创建的证书模板，例如，OperationsManagerCert，然后单击<strong>“提交”</strong>。</li>
<li>在<strong>“证书已颁发”</strong>页上，选择<strong>“Base 64 编码”</strong>，然后单击<strong>“下载证书”</strong>。</li>
<li>在<strong>“文件下载 － 安全警告”</strong>对话框中，单击<strong>“保存”</strong>以保存证书；例如，另存为 NewCertificate.cer。</li>
<li>关闭 Internet Explorer。</li>
</ol>
<h2 id="-">将证书导入证书存储</h2>
<ol>
<li>在主持正在配置其证书的 Operations Manager 组件的计算机上，单击<strong>“开始”</strong>，然后单击<strong>“运行”</strong>。</li>
<li>在<strong>“运行”</strong>对话框中，键入 <strong>&quot;cmd&quot;</strong>，然后单击<strong>“确定”</strong>。</li>
<li>在命令窗口中，键入<strong>CertReq –Accept NewCertifiate.cer</strong>，然后按 Enter。</li>
</ol>
<h2 id="-momcertimport-operations-manager">使用 MOMCertImport 将证书导入 Operations Manager</h2>
<ol>
<li>使用本身是管理员组成员的帐户登录安装了证书的计算机。</li>
<li>在 Windows 桌面上，单击<strong>“开始”</strong>，然后单击<strong>“运行”</strong>。</li>
<li>在<strong>“运行”</strong>对话框中，键入 <strong>&quot;cmd&quot;</strong>，然后单击<strong>“确定”</strong>。</li>
<li>在命令提示符处，键入<strong>“&lt;*</strong>驱动器号<strong>*&gt;：”</strong>（其中 &lt;<em>驱动器号</em>&gt; 是 Operations Manager 2007 安装媒体所在的驱动器），然后按 Enter。</li>
<li>键入 <strong>&quot;cd\SupportTools\i386&quot;</strong>，然后按 Enter。
<img src="&quot;note&quot;" alt="note">注意 在 64 位计算机上，键入 <strong>&quot;cd\SupportTools\amd64&quot;</strong></li>
<li>键入以下内容：</li>
</ol>
<p><strong>MOMCertImport /SubjectName &lt;证书使用者名称&gt;</strong></p>
<ol>
<li>按 Enter。</li>
</ol>
<h2 id="-">另请参阅</h2>
<h3 id="-">任务</h3>
<p><a href="http://technet.microsoft.com/zh-cn/library/bb735414.aspx" target="_blank">如何在 Operations Manager 2007 中将操作控制台配置为在连接到报表服务器时使用 SSL</a>
<a href="http://technet.microsoft.com/zh-cn/library/bb735413.aspx" target="_blank">如何在 Operations Manager 2007 中使用 Windows Server 2003 企业 CA 来获取证书</a>
<a href="http://technet.microsoft.com/zh-cn/library/bb735417.aspx" target="_blank">如何在 Operations Manager 2007 中使用 Windows Server 2003 独立 CA 来获取证书</a>
<a href="http://technet.microsoft.com/zh-cn/library/dd362655.aspx" target="_blank">如何在 Operations Manager 2007 中使用 Windows Server 2008 独立 CA 来获取证书</a>
<a href="http://technet.microsoft.com/zh-cn/library/bb735418.aspx" target="_blank">如何在 Operations Manager 2007 中删除使用 MOMCertImport 导入的证书</a></p>
<p><a href=""></a> 本文是否对您有所帮助？ 是 否</p>
<p>不准确</p>
<p>深度不够
需要更多代码示例</p>
<p>翻译需要改进</p>
<p>请告诉我们更多意见...
(1500 个剩余字符)</p>
<p>社区内容 <a href="http://technet.microsoft.com/zh-cn/library/community/add/dd362553.aspx" title="添加" target="_blank">添加</a></p>
<p><a href="http://technet.microsoft.com/zh-cn/library/community-edits.rss?topic=dd362553|zh-cn|TechNet.10" title="批注" target="_blank"><img src="" alt="批注"></a> <a href="http://technet.microsoft.com/zh-cn/library/community-msdnwikifaq.aspx" title="常见问题" target="_blank">常见问题</a></p>
<p>© 2012 Microsoft. 版权所有。  <a href="http://technet.microsoft.com/zh-cn/cc300389" target="_blank">保留所有权利</a> |  <a href="http://www.microsoft.com/library/toolbar/3.0/trademarks/zh-cn.mspx" target="_blank">商标</a> |  <a href="http://www.microsoft.com/info/cn/privacy.mspx" target="_blank">隐私权声明</a> |  <a href="http://go.microsoft.com/?linkid=8786243&amp;lcid=2052" target="_blank">个人信息中心</a> |  <a href="http://www.microsoft.com/china/technet/feedback/" target="_blank">联系我们</a> |  <a href="http://www.microsoft.com/china/technet/newsletter/" target="_blank">中文速递邮件</a> |  网站反馈 <a href="&quot;网站反馈&quot;">网站反馈  <img src="" alt="网站反馈"></a></p>
<p>网站反馈</p>
<p><a href="">x</a></p>
<p>请与我们分享您的经历…</p>
<p>页面加载速度够快吗？
是   否</p>
<p>您喜欢网页的设计吗？
是   否</p>
<p>请告诉我们更多意见
Enter description here.</p>
<div><img alt="DCSIMG" id="Img1" width="1" height="1" src="http://m.webtrends.com/dcsjwb9vb00000c932fd0rjc7_5p3t/njs.gif?dcsuri=/nojavascript&amp;WT.js=No" /></div>

<p><a href="http://www.omniture.com" title="Web Analytics" target="_blank"> <img src="//msstonojstechnet.112.2o7.net/b/ss/msstonojstechnet/1/H.20.2--NS/0" height="1" width="1" border="0" alt="" /></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/域/">域</a></li></span><span class="breadcrumb"><li><a href="/categories/域/">域</a></li><li><a href="/categories/域/win2008CA证书安装/">win2008CA证书安装</a></li></span></span> | <span class="tags">Tagged <a href="/tags/win2008CA证书安装/" class="label label-primary">win2008CA证书安装</a><a href="/tags/域/" class="label label-success">域</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:40"datetime="2014-03-07 09:54:40"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-域-win2008CA证书安装--如何在OperationsManager2007中使用WindowsServer200/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-域-win2008CA证书安装--如何在OperationsManager2007中使用WindowsServer200" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-域-win2008CA证书安装--Windows-Server-2008安装证书服务_庭媊椛落椛落_新浪博客/">Windows Server 2008安装证书服务_庭媊椛落椛落_新浪博客</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:40.000Z"> <a href="/2014/02/02/2014-02-02-域-win2008CA证书安装--Windows-Server-2008安装证书服务_庭媊椛落椛落_新浪博客/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="windows-server-2008-_-_-">Windows Server 2008安装证书服务<em>庭媊椛落椛落</em>新浪博客</h1>
<p><a href="http://blog.sina.com.cn/" target="_blank"><img src="" alt="新浪博客"></a></p>
<p><a href="http://blog.sina.com.cn/" target="_blank">博客首页</a></p>
<p><a href="http://blog.sina.com.cn/s/blog_67288bc90100jbwh.html#" target="_blank">登录</a><a href="http://login.sina.com.cn/signup/signupmail.php?entry=blog&amp;srcuid=1730710473&amp;src=blogicp" target="_blank">注册</a>
<a href="http://sina.allyes.com/main/adfclick?db=sina&amp;bid=204720,451397,456695&amp;cid=0,0,0&amp;sid=454907&amp;advid=358&amp;camid=37389&amp;show=ignore&amp;url=http://qing.weibo.com/tag/%E9%A9%AC%E6%9D%A5%E8%A5%BF%E4%BA%9A" target="_blank">发博文，赢免费沙巴游</a>
<a href="http://control.blog.sina.com.cn/admin/article/article_add.php" target="_blank"><img src="&quot;博文&quot;" alt=""> 发博文</a></p>
<p>博文</p>
<h1 id="-de-http-blog-sina-com-cn-zhaojian5-"><a href="http://blog.sina.com.cn/zhaojian5" target="_blank">庭媊椛落椛落de博客</a></h1>
<p><a href="http://blog.sina.com.cn/zhaojian5" target="_blank"><a href="http://blog.sina.com.cn/zhaojian5">http://blog.sina.com.cn/zhaojian5</a></a> <a href="http://blog.sina.com.cn/s/blog_67288bc90100jbwh.html#" target="_blank">[订阅]</a><a href="">[手机订阅]</a></p>
<p><a href="http://blog.sina.com.cn/zhaojian5" target="_blank">首页</a> <a href="http://blog.sina.com.cn/s/articlelist_1730710473_0_1.html" target="_blank">博文目录</a> <a href="http://photo.blog.sina.com.cn/zhaojian5" target="_blank">图片</a> <a href="http://blog.sina.com.cn/s/profile_1730710473.html" target="_blank">关于我</a>
<a href="http://blog.sina.com.cn/s/blog_67288bc90100jbwh.html#"></a></p>
<p>个人资料</p>
<p><img src="&quot;庭媊椛落椛落&quot;" alt="庭媊椛落椛落"></p>
<p><img src="" alt=""> <strong>庭媊椛落椛落</strong></p>
<p><a href="http://qing.weibo.com/1730710473" target="_blank"><img src="" alt="">Qing</a> <a href="http://weibo.com/u/1730710473?source=blog" target="_blank"><img src="" alt="">微博</a>
<a href="">加好友</a> <a href="">发纸条</a></p>
<p><a href="http://blog.sina.com.cn/s/profile_1730710473.html#write" target="_blank">写留言</a> <a href="http://blog.sina.com.cn/s/blog_67288bc90100jbwh.html#" target="_blank">加关注</a></p>
<ul>
<li>博客等级：<img src="" alt=""><img src="" alt=""></li>
<li><p>博客积分：<strong>257</strong></p>
</li>
<li><p>博客访问：<strong>8,188</strong></p>
</li>
<li>关注人气：<strong>4</strong></li>
</ul>
<p>相关博文</p>
<ul>
<li><a href="http://sina.allyes.com/main/adfclick?db=sina&amp;bid=204720,451364,456662&amp;cid=0,0,0&amp;sid=454873&amp;advid=358&amp;camid=37389&amp;show=ignore&amp;url=http://qing.weibo.com/tag/%E4%BA%AC%E5%9F%8E" title="五一里的京城你应该去的地方" target="_blank">五一里的京城你应该去的地方</a></li>
</ul>
<p><a href="http://sina.allyes.com/main/adfclick?db=sina&amp;bid=204720,451364,456662&amp;cid=0,0,0&amp;sid=454873&amp;advid=358&amp;camid=37389&amp;show=ignore&amp;url=http://qing.weibo.com/tag/%E4%BA%AC%E5%9F%8E" target="_blank">新浪Qing</a></p>
<ul>
<li><a href="http://sina.allyes.com/main/adfclick?db=sina&amp;bid=204720,451376,456674&amp;cid=0,0,0&amp;sid=454883&amp;advid=358&amp;camid=37389&amp;show=ignore&amp;url=http://qing.weibo.com/tag/%E9%9F%B3%E4%B9%90%E8%8A%82" title="这个夏天，惊世骇俗的音乐节" target="_blank">这个夏天，惊世骇俗的音乐节</a></li>
</ul>
<p><a href="http://sina.allyes.com/main/adfclick?db=sina&amp;bid=204720,451376,456674&amp;cid=0,0,0&amp;sid=454883&amp;advid=358&amp;camid=37389&amp;show=ignore&amp;url=http://qing.weibo.com/tag/%E9%9F%B3%E4%B9%90%E8%8A%82" target="_blank">新浪Qing</a></p>
<ul>
<li><a href="http://blog.baby.sina.com.cn/s/blog_5957e0cd0102e0c6.html" title="【美国】加利福尼亚州的花卉农" target="_blank">【美国】加利福尼亚州的花卉农</a></li>
</ul>
<p><a href="http://blog.baby.sina.com.cn/u/1498931405" target="_blank">【陈孙成对】</a>
<a href="http://search.sina.com.cn/?c=blog&amp;q=%D4%D3%CC%B8%2C%D0%DD%CF%D0&amp;by=tag" target="_blank">更多&gt;&gt;</a>
推荐博文</p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_80831fbe01011pjt.html?tj=1" title="送给家长和教委的一封信《拒绝青少年网瘾之殇》" target="_blank">送给家长和教委的一封信《拒绝</a></li>
</ul>
<p><a href="http://blog.sina.com.cn/u/2156076990" target="_blank">前任</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_4d726f690102dsni.html?tj=1" title="在艰难的拼搏奋斗中取得的成果才会令人陶醉" target="_blank">在艰难的拼搏奋斗中取得的成果</a></li>
</ul>
<p><a href="http://blog.sina.com.cn/u/1299345257" target="_blank">蔡笑晚</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_4a10118b0102dy9k.html?tj=1" title="中考数学复习三大要领" target="_blank">中考数学复习三大要领</a></li>
</ul>
<p><a href="http://blog.sina.com.cn/u/1242567051" target="_blank">闫立秀</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_4eac9c6b0102dyqn.html?tj=1" title="农民工高校“蹭课”充电 求知心同大学生平等" target="_blank">农民工高校“蹭课”充电 求知心</a></li>
</ul>
<p><a href="http://blog.sina.com.cn/u/1319935083" target="_blank">丛贵</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_69229a310102e535.html?tj=1" title="美国高考 SAT 一日一题 （4-24-2012）" target="_blank">美国高考 SAT 一日一题 （4-24</a></li>
</ul>
<p><a href="http://blog.sina.com.cn/u/1763875377" target="_blank">智陈博士</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_65c775640102e22w.html?tj=1" title="给孩子一小时" target="_blank">给孩子一小时</a></li>
</ul>
<p><a href="http://blog.sina.com.cn/u/1707570532" target="_blank">囊萤映雪</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_72c6b6fb0102dygm.html?tj=1" title="求职面试技巧：如何在面试中运用幽默 猎头公司" target="_blank">求职面试技巧：如何在面试中运</a></li>
</ul>
<p><a href="http://blog.sina.com.cn/u/1925625595" target="_blank">猎头顾问哲瀚</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_808326ee01014svf.html?tj=1" title="家庭教育家长应避免的十大误区" target="_blank">家庭教育家长应避免的十大误区</a></li>
</ul>
<p><a href="http://blog.sina.com.cn/u/2156078830" target="_blank">康德教育</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_608ba6b10102dz45.html?tj=1" title="孔子管理教育的核心" target="_blank">孔子管理教育的核心</a></li>
</ul>
<p><a href="http://blog.sina.com.cn/u/1619764913" target="_blank">孔健</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_6aaf4dd40102dya9.html?tj=1" title="【人生感悟】让铁证绽放属于段琪桂的清白" target="_blank">【人生感悟】让铁证绽放属于段</a></li>
</ul>
<p><a href="http://blog.sina.com.cn/u/1789873620" target="_blank">永明星空</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_6d08c98901014iok.html?tj=1" target="_blank"><img src="" alt="德国留学利好：鼓励留学生移民"></a></li>
</ul>
<p><a href="http://blog.sina.com.cn/s/blog_6d08c98901014iok.html?tj=1" target="_blank">德国留学利好：鼓励留学.</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_a0c8726f01011pzz.html?tj=1" target="_blank"><img src="" alt="缘何加拿大贵族高中“投资回报率”高居不下"></a></li>
</ul>
<p><a href="http://blog.sina.com.cn/s/blog_a0c8726f01011pzz.html?tj=1" target="_blank">缘何加拿大贵族高中“投.</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_a0b4831f01013ufd.html?tj=1" target="_blank"><img src="" alt="学在英国玩转欧洲：欧洲自助游全攻略"></a></li>
</ul>
<p><a href="http://blog.sina.com.cn/s/blog_a0b4831f01013ufd.html?tj=1" target="_blank">学在英国玩转欧洲：欧洲.</a></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_66d7ffd10100ylhc.html?tj=1" target="_blank"><img src="" alt="感人又有趣的马拉松"></a></li>
</ul>
<p><a href="http://blog.sina.com.cn/s/blog_66d7ffd10100ylhc.html?tj=1" target="_blank">感人又有趣的马拉松</a></p>
<p><a href="http://blog.sina.com.cn/lm/114/122/day.html" target="_blank">查看更多</a>&gt;&gt;</p>
<p>谁看过这篇博文</p>
<p><a href="http://blog.sina.com.cn/u/1079421027" target="_blank"><img src="&quot;Zhongdaiqi&quot;" alt="Zhongdaiqi"></a></p>
<p><a href="http://blog.sina.com.cn/u/1079421027" title="Zhongdaiqi" target="_blank">Zhongd…</a></p>
<p>8月29日</p>
<p><a href="http://blog.sina.com.cn/u/1685079684" target="_blank"><img src="&quot;thiswx&quot;" alt="thiswx"></a></p>
<p><a href="http://blog.sina.com.cn/u/1685079684" title="thiswx" target="_blank">thiswx</a></p>
<p>8月24日
<a href="http://blog.sina.com.cn/u/1362664712" target="_blank"><img src="&quot;临海听风&quot;" alt="临海听风"></a></p>
<p><a href="http://blog.sina.com.cn/u/1362664712" title="临海听风" target="_blank">临海听风</a></p>
<p>7月28日</p>
<p><a href="http://blog.sina.com.cn/u/1210703891" target="_blank"><img src="&quot;三儿&quot;" alt="三儿"></a></p>
<p><a href="http://blog.sina.com.cn/u/1210703891" title="三儿" target="_blank">三儿</a></p>
<p>7月2日
<a href="http://blog.sina.com.cn/u/1675754585" target="_blank"><img src="&quot;千年&quot;" alt="千年"></a></p>
<p><a href="http://blog.sina.com.cn/u/1675754585" title="千年" target="_blank">千年</a></p>
<p>4月9日</p>
<p><a href="http://blog.sina.com.cn/u/1611399391" target="_blank"><img src="&quot;Udistyle&quot;" alt="Udistyle"></a></p>
<p><a href="http://blog.sina.com.cn/u/1611399391" title="Udistyle" target="_blank">Udistyle</a></p>
<p>1月18日
<a href="http://blog.sina.com.cn/u/1421378207" target="_blank"><img src="&quot;qqpp&quot;" alt="qqpp"></a></p>
<p><a href="http://blog.sina.com.cn/u/1421378207" title="qqpp" target="_blank">qqpp</a></p>
<p>10月26日</p>
<p>正文 字体大小：<a href="">大</a> <strong>中</strong> <a href="">小</a></p>
<h2 id="windows-server-2008-">Windows Server 2008安装证书服务</h2>
<p><img src="&quot;此博文包含图片&quot;" alt="">  (2010-06-11 16:57:21)</p>
<p>标签：</p>
<h3 id="-http-search-sina-com-cn-c-blog-q-b0-b2-d7-b0-d6-a4-ca-e9-b7-fe-ce-f1-by-tag-"><a href="http://search.sina.com.cn/?c=blog&amp;q=%B0%B2%D7%B0%D6%A4%CA%E9%B7%FE%CE%F1&amp;by=tag" target="_blank">安装证书服务</a></h3>
<h3 id="-ca-http-search-sina-com-cn-c-blog-q-ca-by-tag-"><a href="http://search.sina.com.cn/?c=blog&amp;q=ca&amp;by=tag" target="_blank">ca</a></h3>
<p> 分类： <a href="http://blog.sina.com.cn/s/articlelist_1730710473_1_1.html" target="_blank">Windows</a>
一、在域控制器上安装证书服务</p>
<pre><code>1.添加服务器角色“Active Directory证书服务”
</code></pre><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=67288bc90100jbwh&amp;url=http://s8.sinaimg.cn/orignal/67288bc9t88bdbf20e0e7" target="_blank"><img src="&quot;Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务&quot;" alt="Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务"></a></p>
<pre><code>2.添加必须的角色服务，“证书颁发机构”和“证书颁发机构Web注册”
</code></pre><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=67288bc90100jbwh&amp;url=http://s9.sinaimg.cn/orignal/67288bc9t88bdbfb753b8" target="_blank"><img src="&quot;Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务&quot;" alt="Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务"></a></p>
<pre><code>3.在指定安装类型中，选择“企业”
</code></pre><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=67288bc90100jbwh&amp;url=http://s9.sinaimg.cn/orignal/67288bc9t88bdcb8f9908" target="_blank"><img src="&quot;Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务&quot;" alt="Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务"></a></p>
<pre><code>  CA类型有两种：企业CA和独立CA。

      企业CA的特点：
      ★企业CA需要AD服务。

      ★当安装企业根CA时，对于域中的所有用户和计算机，它都会自动添加到受信任的根证书颁
  发机构的证书储存区中。

      ★必须是域管理员或对AD具有写入权限的管理员，才能安装企业根CA。
      独立CA的特点：

      ☆独立CA不需要AD服务。
      ☆向独立CA提交证书申请时，证书申请者必须在证书申请中明确提供所有关于自己的标识信

  息以及证书申请所需要的证书类型。
      ☆默认情况下，发送到独立CA的所有证书申请都被设置为挂起，一直到独立CA的管理员验证

  申请者的身份并批准申请。


4.在“指定CA类型”中选择“根CA”
</code></pre><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=67288bc90100jbwh&amp;url=http://s7.sinaimg.cn/orignal/67288bc9t88bdee308096" target="_blank"><img src="&quot;Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务&quot;" alt="Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务"></a>
          企业CA和独立CA中又可以分为根CA和子级CA。</p>
<pre><code>      根CA是指在组织的PKI中最受信任的CA。
      子级CA是由组织中的根CA颁发证书的CA。


5.在设置私钥中，选择“新建私钥”
</code></pre><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=67288bc90100jbwh&amp;url=http://s8.sinaimg.cn/orignal/67288bc9t88be048e9fb7" target="_blank"><img src="&quot;Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务&quot;" alt="Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务"></a></p>
<pre><code>6.为CA配置加密
</code></pre><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=67288bc90100jbwh&amp;url=http://s15.sinaimg.cn/orignal/67288bc9t88be0cc7df9e" target="_blank"><img src="&quot;Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务&quot;" alt="Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务"></a></p>
<pre><code>7.配置CA名称
</code></pre><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=67288bc90100jbwh&amp;url=http://s14.sinaimg.cn/orignal/67288bc9t88be145e68fd" target="_blank"><img src="&quot;Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务&quot;" alt="Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务"></a></p>
<pre><code>8.设置CA证书的有效期，默认5年
</code></pre><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=67288bc90100jbwh&amp;url=http://s13.sinaimg.cn/orignal/67288bc9t88be1c67d2ac" target="_blank"><img src="&quot;Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务&quot;" alt="Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务"></a></p>
<pre><code>9.选择证书数据库保存位置
</code></pre><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=67288bc90100jbwh&amp;url=http://s13.sinaimg.cn/orignal/67288bc9t88be1f03a75c" target="_blank"><img src="&quot;Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务&quot;" alt="Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务"></a></p>
<pre><code>10.安装Web服务器所必须角色服务
</code></pre><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=67288bc90100jbwh&amp;url=http://s1.sinaimg.cn/orignal/67288bc9t88be285f4880" target="_blank"><img src="&quot;Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务&quot;" alt="Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务"></a></p>
<pre><code>11.确认安装信息后，开始安装
</code></pre><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=67288bc90100jbwh&amp;url=http://s13.sinaimg.cn/orignal/67288bc9t88be30028bac" target="_blank"><img src="&quot;Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务&quot;" alt="Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务"></a></p>
<pre><code>12.安装完成
</code></pre><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=67288bc90100jbwh&amp;url=http://s16.sinaimg.cn/orignal/67288bc9t88be3e20f79f" target="_blank"><img src="&quot;Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务&quot;" alt="Windows &lt;wbr&gt;Server &lt;wbr&gt;2008安装证书服务"></a></p>
<p>分享 <a href=""><img src="" alt=""></a> <a href="http://profile.live.com/badge/?url=http%3A%2F%2Fblog.sina.com.cn%2Fs%2Fblog_67288bc90100jbwh.html&amp;title=Windows%C2%A0Server%C2%A02008%E5%AE%89%E8%A3%85%E8%AF%81%E4%B9%A6%E6%9C%8D%E5%8A%A1&amp;screenshot=http%3A%2F%2Fs8.sinaimg.cn%2Fbmiddle%2F67288bc9t88bdbf20e0e7&amp;description=%E4%B8%80%E3%80%81%E5%9C%A8%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B8%8A%E5%AE%89%E8%A3%85%E8%AF%81%E4%B9%A6%E6%9C%8D%E5%8A%A1%C2%A0%C2%A0%C2%A01.%E6%B7%BB%E5%8A%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A7%92%E8%89%B2%E2%80%9CActive%20Directory%E8%AF%81%E4%B9%A6%E6%9C%8D%E5%8A%A1%E2%80%9D%C2%A0%C2%A0%C2%A0%C2%A02.%E6%B7%BB%E5%8A%A0%E5%BF%85%E9%A1%BB%E7%9A%84%E8%A7%92%E8%89%B2%E6%9C%8D%E5%8A%A1%EF%BC%8C%E2%80%9C%E8%AF%81%E4%B9%A6%E9%A2%81%E5%8F%91%E6%9C%BA%E6%9E%84%E2%80%9D%E5%92%8C%E2%80%9C%E8%AF%81%E4%B9%A6%E9%A2%81%E5%8F%91%E6%9C%BA%E6%9E%84Web%E6%B3%A8%E5%86%8C%E2%80%9D%C2%A0%C2%A0%C2%A0%C2%A03.%E5%9C%A8%E6%8C%87%E5%AE%9A%E5%AE%89%E8%A3%85%E7%B1%BB%E5%9E%8B%E4%B8%AD%EF%BC%8C" target="_blank"><img src="" alt=""></a> <a href=""><img src="" alt=""></a> <a href=""><img src="" alt=""></a> <a href="http://www.douban.com/recommend/?url=http://blog.sina.com.cn/s/blog_67288bc90100jbwh.html&amp;title=Windows%C2%A0Server%C2%A02008%E5%AE%89%E8%A3%85%E8%AF%81%E4%B9%A6%E6%9C%8D%E5%8A%A1_%E5%BA%AD%E5%AA%8A%E6%A4%9B%E8%90%BD%E6%A4%9B%E8%90%BD_%E6%96%B0%E6%B5%AA%E5%8D%9A%E5%AE%A2;window.open(u,&#39;douban&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330&#39;" target="_blank"><img src="" alt=""></a>;void(0)) <a href=""><img src="&quot;分享到新浪Qing&quot;" alt="">分享到新浪Qing</a></p>
<p>2</p>
<p><img src="" alt="">顶
阅读(298)<em>┊</em> <a href="">收藏</a>(0) <em>┊</em>禁止转载 <em>┊</em> <a href="">顶</a><a href=""><strong>▼</strong></a> <em>┊</em><a href="http://blog.sina.com.cn/main_v5/ria/print.html?blog_id=blog_67288bc90100jbwh" target="_blank">打印</a><em>┊</em><a href="http://blog.sina.com.cn/s/blog_67288bc90100jbwh.html#" target="_blank">举报</a></p>
<p>已投稿到： <img src="&quot;排行榜&quot;" alt=""> <a href="http://blog.sina.com.cn/lm/114/122/day.html" target="_blank">排行榜</a></p>
<p>加载中，请稍候......
前一篇：<a href="http://blog.sina.com.cn/s/blog_67288bc90100jbq3.html" target="_blank">证书颁发机构（CA）</a></p>
<p>后一篇：<a href="http://blog.sina.com.cn/s/blog_67288bc90100jbxn.html" target="_blank">为Web站点启用HTTPS</a></p>
<p><a href="http://control.blog.sina.com.cn/admin/advice/advice_list.php" target="_blank">新浪BLOG意见反馈留言板</a>　<a href="">不良信息反馈</a>　电话：4006900000 提示音后按1键（按当地市话标准计费）　欢迎批评指正</p>
<p><a href="http://corp.sina.com.cn/chn/" target="_blank">新浪简介</a> | <a href="http://corp.sina.com.cn/eng/" target="_blank">About Sina</a> | <a href="http://emarketing.sina.com.cn/" target="_blank">广告服务</a> | <a href="http://www.sina.com.cn/contactus.html" target="_blank">联系我们</a> | <a href="http://corp.sina.com.cn/chn/sina_job.html" target="_blank">招聘信息</a> | <a href="http://www.sina.com.cn/intro/lawfirm.shtml" target="_blank">网站律师</a> | <a href="http://english.sina.com/" target="_blank">SINA English</a> | <a href="http://members.sina.com.cn/apply/" target="_blank">会员注册</a> | <a href="http://help.sina.com.cn/" target="_blank">产品答疑</a></p>
<p>Copyright © 1996 - 2012 SINA Corporation, All Rights Reserved</p>
<p>新浪公司 <a href="http://www.sina.com.cn/intro/copyright.shtml" target="_blank">版权所有</a>
<a href="http://www.bj.cyberpolice.cn/index.jsp"></a>
<img src="&quot;长微博&quot;" alt=""><a href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php" target="_blank">长微博</a></p>
<p><img src="&quot;微语录&quot;" alt=""><a href="http://t.blog.sina.com.cn/weiyulu/weiyulu.php" target="_blank">微语录</a></p>
<p><img src="&quot;九宫格&quot;" alt=""><a href="http://control.blog.sina.com.cn/admin/article/daily.php" target="_blank">九宫格</a></p>
<p><img src="&quot;发照片&quot;" alt=""><a href="http://photo.blog.sina.com.cn/upload/upload.php" target="_blank">发照片</a></p>
<p><img src="&quot;发视频&quot;" alt=""><a href="http://vupload.you.video.sina.com.cn/u.php?m=1" target="_blank">发视频</a></p>
<ul>
<li><a href="">博文</a></li>
<li><a href="">博主</a></li>
<li><a href="">音乐</a></li>
<li><a href="">视频</a></li>
<li><a href="">播主</a>
<a href="&quot;关闭&quot;"></a></li>
</ul>
<p>最近顶了的博主：
<img src="" alt="">加载中…</p>
<ul>
<li><a href="&quot;转载到Qing博客&quot;"><img src="" alt="">Qing</a></li>
<li><a href="&quot;转载到博客&quot;"><img src="" alt="">博客</a></li>
<li><a href="&quot;转载原文&quot;"><img src="" alt="">转载原文</a>
分享到新浪Qing</li>
</ul>
<p>分享到新浪微博</p>
<p><img src="&quot;将选中内容分享到新浪微博&quot;" alt="">
<a href="http://qing.weibo.com/1204832102"></a></p>
<p><a href="&quot;关闭&quot;">关闭</a>
<a href="http://blog.sina.com.cn/s/blog_67288bc90100jbwh.html#" title="关闭" target="_blank"><img src="&quot;关闭&quot;" alt=""></a></p>
<p><img src="" alt=""><a href="http://sina.allyes.com/main/adfclick?db=sina&amp;bid=388958,449490,454789&amp;cid=0,0,0&amp;sid=452965&amp;advid=7610&amp;camid=71146&amp;show=ignore&amp;url=http://ad-apac.doubleclick.net/click;h=v2|3F2A|0|0|%2a|b;255923038;0-0;0;79591910;31-1|1;47629893|47645366|1;;%3fhttp://detail.tmall.com/item.htm?id=16620252164&amp;scm=1004.2.1.4&amp;utm_source=Sina&amp;utm_medium=Day&amp;utm_term=v1&amp;utm_content=PFA04&amp;utm_campaign=UL_Ponds_FC_Angie"></a></p>
<p><img src="" alt=""><a href="http://sina.allyes.com/main/adfclick?db=sina&amp;bid=388958,449490,454789&amp;cid=0,0,0&amp;sid=452965&amp;advid=7610&amp;camid=71146&amp;show=ignore&amp;url=http://ad-apac.doubleclick.net/click;h=v2|3F2A|0|0|%2a|b;255923038;0-0;0;79591910;31-1|1;47629893|47645366|1;;%3fhttp://detail.tmall.com/item.htm?id=16620252164&amp;scm=1004.2.1.4&amp;utm_source=Sina&amp;utm_medium=Day&amp;utm_term=v1&amp;utm_content=PFA04&amp;utm_campaign=UL_Ponds_FC_Angie"></a>
<a href="http://blog.sina.com.cn/s/blog_67288bc90100jbwh.html#" title="重新播放"></a>
<a href="http://blog.sina.com.cn/s/blog_67288bc90100jbwh.html#" title="关闭"></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/域/">域</a></li></span><span class="breadcrumb"><li><a href="/categories/域/">域</a></li><li><a href="/categories/域/win2008CA证书安装/">win2008CA证书安装</a></li></span></span> | <span class="tags">Tagged <a href="/tags/win2008CA证书安装/" class="label label-primary">win2008CA证书安装</a><a href="/tags/域/" class="label label-success">域</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:40"datetime="2014-03-07 09:54:40"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-域-win2008CA证书安装--Windows-Server-2008安装证书服务_庭媊椛落椛落_新浪博客/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-域-win2008CA证书安装--Windows-Server-2008安装证书服务_庭媊椛落椛落_新浪博客" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-性能调优--性能调优攻略-Coolshell/">性能调优攻略 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:40.000Z"> <a href="/2014/02/02/2014-02-02-性能调优--性能调优攻略-Coolshell/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-coolshell">性能调优攻略 -Coolshell</h1>
<h2 id="-">性能调优攻略</h2>
<p>2012年6月20日<a href="http://coolshell.cn/articles/author/haoel" title="由 陈皓 发布" target="_blank">陈皓</a><a href="http://coolshell.cn/articles/7490.html#respond" target="_blank">发表评论</a><a href="http://coolshell.cn/articles/7490.html#comments" target="_blank">阅读评论</a>48,645 人阅读    </p>
<p><img src="&quot;Performance Tuning&quot;" alt="">关于性能优化这是一个比较大的话题，在《<a href="http://coolshell.cn/articles/6470.html" title="由12306.cn谈谈网站性能技术" target="_blank">由12306.cn谈谈网站性能技术</a>》中我从业务和设计上说过一些可用的技术以及那些技术的优缺点，今天，想从一些技术细节上谈谈性能优化，主要是一些代码级别的技术和方法。<strong>本文的东西是我的一些经验和知识，并不一定全对，希望大家指正和补充</strong>。</p>
<p>在开始这篇文章之前，大家可以移步去看一下酷壳以前发表的《<a href="http://coolshell.cn/articles/2967.html" title="代码优化概要" target="_blank">代码优化概要</a>》，这篇文章基本上告诉你——<strong>要进行优化，先得找到性能瓶颈</strong>！ 但是在讲如何定位系统性能瓶劲之前，请让我讲一下系统性能的定义和测试，因为没有这两件事，后面的定位和优化无从谈起。</p>
<h3 id="-">一、系统性能定义</h3>
<p>让我们先来说说如何什么是系统性能。这个定义非常关键，如果我们不清楚什么是系统性能，那么我们将无法定位之。我见过很多朋友会觉得这很容易，但是仔细一问，其实他们并没有一个比较系统的方法，所以，在这里我想告诉大家如何系统地来定位性能。 总体来说，系统性能就是两个事：</p>
<ol>
<li><strong>Throughput</strong> ，吞吐量。也就是每秒钟可以处理的请求数，任务数。</li>
<li><strong>Latency</strong>， 系统延迟。也就是系统在处理一个请求或一个任务时的延迟。</li>
</ol>
<p>一般来说，一个系统的性能受到这两个条件的约束，缺一不可。比如，我的系统可以顶得住一百万的并发，但是系统的延迟是2分钟以上，那么，这个一百万的负载毫无意义。系统延迟很短，但是吞吐量很低，同样没有意义。所以，一个好的系统的性能测试必然受到这两个条件的同时作用。 有经验的朋友一定知道，这两个东西的一些关系：</p>
<ul>
<li><strong>Throughput越大，Latency会越差。</strong>因为请求量过大，系统太繁忙，所以响应速度自然会低。</li>
<li><strong>Latency越好，能支持的Throughput就会越高。</strong>因为Latency短说明处理速度快，于是就可以处理更多的请求。</li>
</ul>
<h3 id="-">二、系统性能测试</h3>
<p>经过上述的说明，我们知道要测试系统的性能，需要我们收集系统的Throughput和Latency这两个值。</p>
<ul>
<li><p>首先，<strong>需要定义Latency这个值</strong>，比如说，对于网站系统响应时间必需是5秒以内（对于某些实时系统可能需要定义的更短，比如5ms以内，这个更根据不同的业务来定义）</p>
</li>
<li><p>其次，<strong>开发性能测试工具</strong>，一个工具用来制造高强度的Throughput，另一个工具用来测量Latency。对于第一个工具，你可以参考一下“<a href="http://coolshell.cn/articles/2589.html" title="十个免费的Web压力测试工具" target="_blank">十个免费的Web压力测试工具</a>”，关于如何测量Latency，你可以在代码中测量，但是这样会影响程序的执行，而且只能测试到程序内部的Latency，真正的Latency是整个系统都算上，包括操作系统和网络的延时，你可以使用Wireshark来抓网络包来测量。这两个工具具体怎么做，这个还请大家自己思考去了。</p>
</li>
<li><p>最后，<strong>开始性能测试</strong>。你需要不断地提升测试的Throughput，然后观察系统的负载情况，如果系统顶得住，那就观察Latency的值。这样，你就可以找到系统的最大负载，并且你可以知道系统的响应延时是多少。</p>
</li>
</ul>
<p>再多说一些，</p>
<ul>
<li><p>关于Latency，如果吞吐量很少，这个值估计会非常稳定，当吞吐量越来越大时，系统的Latency会出现非常剧烈的抖动，所以，我们在测量Latency的时候，我们需要注意到Latency的分布，也就是说，有百分之几的在我们允许的范围，有百分之几的超出了，有百分之几的完全不可接受。也许，平均下来的Latency达标了，但是其中仅有50%的达到了我们可接受的范围。那也没有意义。</p>
</li>
<li><p>关于性能测试，我们还需要定义一个时间段。比如：在某个吞吐量上持续15分钟。因为当负载到达的时候，系统会变得不稳定，当过了一两分钟后，系统才会稳定。另外，也有可能是，你的系统在这个负载下前几分钟还表现正常，然后就不稳定了，甚至垮了。所以，需要这么一段时间。这个值，我们叫做峰值极限。</p>
</li>
<li><p>性能测试还需要做Soak Test，也就是在某个吞吐量下，系统可以持续跑一周甚至更长。这个值，我们叫做系统的正常运行的负载极限。</p>
</li>
</ul>
<p>性能测试有很多很复要的东西，比如：burst test等。 这里不能一一详述，这里只说了一些和性能调优相关的东西。总之，性能测试是一细活和累活。</p>
<h3 id="-">三、定位性能瓶颈</h3>
<p><img src="&quot;bottleneck&quot;" alt="">有了上面的铺垫，我们就可以测试到到系统的性能了，再调优之前，我们先来说说如何找到性能的瓶颈。我见过很多朋友会觉得这很容易，但是仔细一问，其实他们并没有一个比较系统的方法。</p>
<h3 id="3-1-">3.1）查看操作系统负载</h3>
<p>首先，当我们系统有问题的时候，我们不要急于去调查我们代码，这个毫无意义。我们首要需要看的是操作系统的报告。看看操作系统的CPU利用率，看看内存使用率，看看操作系统的IO，还有网络的IO，网络链接数，等等。Windows下的perfmon是一个很不错的工具，Linux下也有很多相关的命令和工具，比如：<a href="http://sourceware.org/systemtap/" target="_blank">SystemTap</a>，<a href="https://latencytop.org/" target="_blank">LatencyTOP</a>，vmstat, sar, iostat, top, tcpdump等等 。通过观察这些数据，我们就可以知道我们的软件的性能基本上出在哪里。比如：</p>
<p>1）先看CPU利用率，如果CPU利用率不高，但是系统的Throughput和Latency上不去了，这说明我们的程序并没有忙于计算，而是忙于别的一些事，比如IO。（另外，CPU的利用率还要看内核态的和用户态的，内核态的一上去了，整个系统的性能就下来了。而对于多核CPU来说，CPU 0 是相当关键的，如果CPU 0的负载高，那么会影响其它核的性能，因为CPU各核间是需要有调度的，这靠CPU0完成）</p>
<p>2）然后，我们可以看一下IO大不大，IO和CPU一般是反着来的，CPU利用率高则IO不大，IO大则CPU就小。关于IO，我们要看三个事，一个是磁盘文件IO，一个是驱动程序的IO（如：网卡），一个是内存换页率。这三个事都会影响系统性能。</p>
<p>3）然后，查看一下网络带宽使用情况，在Linux下，你可以使用iftop, iptraf, ntop, tcpdump这些命令来查看。或是用Wireshark来查看。</p>
<p>4）如果CPU不高，IO不高，内存使用不高，网络带宽使用不高。但是系统的性能上不去。这说明你的程序有问题，比如，你的程序被阻塞了。可能是因为等那个锁，可能是因为等某个资源，或者是在切换上下文。</p>
<p><strong>通过了解操作系统的性能，我们才知道性能的问题，比如：带宽不够，内存不够，TCP缓冲区不够，等等，很多时候，不需要调整程序的，只需要调整一下硬件或操作系统的配置就可以了</strong>。</p>
<h3 id="3-2-profiler-">3.2）使用Profiler测试</h3>
<p>接下来，我们需要使用性能检测工具，也就是使用某个Profiler来差看一下我们程序的运行性能。如：Java的JProfiler/TPTP/CodePro Profiler，GNU的gprof，IBM的PurifyPlus，Intel的VTune，AMD的CodeAnalyst，还有Linux下的OProfile/perf，后面两个可以让你对你的代码优化到CPU的微指令级别，如果你关心CPU的L1/L2的缓存调优，那么你需要考虑一下使用VTune。 使用这些Profiler工具，可以让你程序中各个模块函数甚至指令的很多东西，如：<strong>运行的时间</strong> ，<strong>调用的次数</strong>，<strong>CPU的利用率</strong>，等等。这些东西对我们来说非常有用。</p>
<p>我们重点观察运行时间最多，调用次数最多的那些函数和指令。这里注意一下，对于调用次数多但是时间很短的函数，你可能只需要轻微优化一下，你的性能就上去了（比如：某函数一秒种被调用100万次，你想想如果你让这个函数提高0.01毫秒的时间 ，这会给你带来多大的性能）</p>
<p>使用Profiler有个问题我们需要注意一下，因为Profiler会让你的程序运行的性能变低，像PurifyPlus这样的工具会在你的代码中插入很多代码，会导致你的程序运行效率变低，从而没发测试出在高吞吐量下的系统的性能，对此，一般有两个方法来定位系统瓶颈：</p>
<p>1）在你的代码中自己做统计，使用微秒级的计时器和函数调用计算器，每隔10秒把统计log到文件中。</p>
<p>2）分段注释你的代码块，让一些函数空转，做Hard Code的Mock，然后再测试一下系统的Throughput和Latency是否有质的变化，如果有，那么被注释的函数就是性能瓶颈，再在这个函数体内注释代码，直到找到最耗性能的语句。</p>
<p>最后再说一点，<strong>对于性能测试，不同的Throughput会出现不同的测试结果，不同的测试数据也会有不同的测试结果。所以，用于性能测试的数据非常重要，性能测试中，我们需要观测试不同Throughput的结果</strong>。</p>
<h3 id="-">四、常见的系统瓶颈</h3>
<p>下面这些东西是我所经历过的一些问题，也许并不全，也许并不对，大家可以补充指正，我<strong>纯属抛砖引玉</strong>。关于系统架构方面的性能调优，大家可移步看一下《<a href="http://coolshell.cn/articles/6470.html" title="由12306.cn谈谈网站性能技术" target="_blank">由12306.cn谈谈网站性能技术</a>》，关于Web方面的一些性能调优的东西，大家可以看看《<a href="http://coolshell.cn/articles/6043.html" title="Web开发中需要了解的东西" target="_blank">Web开发中需要了解的东西</a>》一文中的性能一章。我在这里就不再说设计和架构上的东西了。</p>
<p><em>**</em>一般来说，性能优化也就是下面的几个策略：</p>
<ul>
<li><p><strong>用空间换时间</strong>。各种cache如CPU L1/L2/RAM到硬盘，都是用空间来换时间的策略。这样策略基本上是把计算的过程一步一步的保存或缓存下来，这样就不用每次用的时候都要再计算一遍，比如数据缓冲，CDN，等。这样的策略还表现为冗余数据，比如数据镜象，负载均衡什么的。</p>
</li>
<li><p><strong>用时间换空间</strong>。有时候，少量的空间可能性能会更好，比如网络传输，如果有一些压缩数据的算法（如前些天说的“<a href="http://coolshell.cn/articles/7459.html" title="Huffman 编码压缩算法" target="_blank">Huffman 编码压缩算法</a>” 和 “<a href="http://coolshell.cn/articles/7425.html" title="rsync 的核心算法" target="_blank">rsync 的核心算法</a>”），这样的算法其实很耗时，但是因为瓶颈在网络传输，所以用时间来换空间反而能省时间。</p>
</li>
<li><p><strong>简化代码</strong>。最高效的程序就是不执行任何代码的程序，所以，代码越少性能就越高。关于代码级优化的技术大学里的教科书有很多示例了。如：减少循环的层数，减少递归，在循环中少声明变量，少做分配和释放内存的操作，尽量把循环体内的表达式抽到循环外，条件表达的中的多个条件判断的次序，尽量在程序启动时把一些东西准备好，注意函数调用的开销（栈上开销），注意面向对象语言中临时对象的开销，小心使用异常（不要用异常来检查一些可接受可忽略并经常发生的错误），…… 等等，等等，这连东西需要我们非常了解编程语言和常用的库。</p>
</li>
<li><p><strong>并行处理</strong>。如果CPU只有一个核，你要玩多进程，多线程，对于计算密集型的软件会反而更慢（因为操作系统调度和切换开销很大），CPU的核多了才能真正体现出多进程多线程的优势。并行处理需要我们的程序有Scalability，不能水平或垂直扩展的程序无法进行并行处理。从架构上来说，这表再为——是否可以做到不改代码只是加加机器就可以完成性能提升？</p>
</li>
</ul>
<p>总之，<strong>根据2：8原则来说，20%的代码耗了你80%的性能，找到那20%的代码，你就可以优化那80%的性能</strong>。 下面的一些东西都是我的一些经验，我只例举了一些最有价值的性能调优的的方法，供你参考，也欢迎补充。</p>
<p><strong>4.1）算法调优</strong>。算法非常重要，好的算法会有更好的性能。举几个我经历过的项目的例子，大家可以感觉一下。</p>
<ul>
<li><p>一个是<strong>过滤算法</strong>，系统需要对收到的请求做过滤，我们把可以被filter in/out的东西配置在了一个文件中，原有的过滤算法是遍历过滤配置，后来，我们找到了一种方法可以对这个过滤配置进行排序，这样就可以用二分折半的方法来过滤，系统性能增加了50%。</p>
</li>
<li><p>一个是<strong>哈希算法</strong>。计算哈希算法的函数并不高效，一方面是计算太费时，另一方面是碰撞太高，碰撞高了就跟单向链表一个性能（可参看<a href="http://coolshell.cn/articles/6424.html" title="Hash Collision DoS 问题" target="_blank">Hash Collision DoS 问题</a>）。我们知道，算法都是和需要处理的数据很有关系的，就算是被大家所嘲笑的“冒泡排序”在某些情况下（大多数数据是排好序的）其效率会高于所有的排序算法。哈希算法也一样，广为人知的哈希算法都是用英文字典做测试，但是我们的业务在数据有其特殊性，所以，对于还需要根据自己的数据来挑选适合的哈希算法。对于我以前的一个项目，公司内某牛人给我发来了一个哈希算法，结果让我们的系统性能上升了150%。（关于各种哈希算法，你一定要看看<a href="http://programmers.stackexchange.com/questions/49550/which-hashing-algorithm-is-best-for-uniqueness-and-speed/145633#145633" target="_blank">StackExchange上的这篇关于各种hash算法的文章</a> ）</p>
</li>
<li><p><strong>分而治之和预处理</strong>。以前有一个程序为了生成月报表，每次都需要计算很长的时间，有时候需要花将近一整天的时间。于是我们把我们找到了一种方法可以把这个算法发成增量式的，也就是说我每天都把当天的数据计算好了后和前一天的报表合并，这样可以大大的节省计算时间，每天的数据计算量只需要20分钟，但是如果我要算整个月的，系统则需要10个小时以上（SQL语句在大数据量面前性能成级数性下降）。这种分而治之的思路在大数据面前对性能有很帮助，就像merge排序一样。SQL语句和数据库的性能优化也是这一策略，如：使用嵌套式的Select而不是笛卡尔积的Select，使用视图，等等。</p>
</li>
</ul>
<p><strong>4.2）代码调优</strong>。从我的经验上来说，代码上的调优有下面这几点：</p>
<ul>
<li><p><strong>字符串操作</strong>。这是最费系统性能的事了，无论是strcpy, strcat还是strlen，最需要注意的是字符串子串匹配。所以，能用整型最好用整型。举几个例子，第一个例子是N年前做银行的时候，我的同事喜欢把日期存成字符串（如：2012-05-29 08:30:02），我勒个去，一个select  where between语句相当耗时。另一个例子是，我以前有个同事把一些状态码用字符串来处理，他的理由是，这样可以在界面上直接显示，后来性能调优的时候，我把这些状态码全改成整型，然后用位操作查状态，因为有一个每秒钟被调用了150K次的函数里面有三处需要检查状态，经过改善以后，整个系统的性能上升了30%左右。还有一个例子是，我以前从事的某个产品编程规范中有一条是要在每个函数中把函数名定义出来，如：const char fname[]=”functionName()”, 这是为了好打日志，但是为什么不声明成 static类型的呢？</p>
</li>
<li><p><strong>多线程调优</strong>。有人说，thread is evil，这个对于系统性能在某些时候是个问题。因为多线程瓶颈就在于互斥和同步的锁上，以及线程上下文切换的成本，怎么样的少用锁或不用锁是根本（比如：<a href="http://coolshell.cn/articles/6790.html" title="多版本并发控制(MVCC)在分布式系统中的应用" target="_blank">多版本并发控制(MVCC)在分布式系统中的应用</a> 中说的乐观锁可以解决性能问题），此外，还有读写锁也可以解决大多数是读操作的并发的性能问题。这里多说一点在C++中，我们可能会使用线程安全的智能指针AutoPtr或是别的一些容器，只要是线程安全的，其不管三七二十一都要上锁，上锁是个成本很高的操作，使用AutoPtr会让我们的系统性能下降得很快，如果你可以保证不会有线程并发问题，那么你应该不要用AutoPtr。我记得我上次我们同事去掉智能指针的引用计数，让系统性能提升了50%以上。对于Java对象的引用计数，如果我猜的没错的话，到处都是锁，所以，Java的性能问题一直是个问题。另外，线程不是越多越好，线程间的调度和上下文切换也是很夸张的事，尽可能的在一个线程里干，尽可能的不要同步线程。这会让你有很多的性能。</p>
</li>
<li><p><strong>内存分配</strong>。不要小看程序的内存分配。malloc/realloc/calloc这样的系统调非常耗时，尤其是当内存出现碎片的时候。我以前的公司出过这样一个问题——在用户的站点上，我们的程序有一天不响应了，用GDB跟进去一看，系统hang在了malloc操作上，20秒都没有返回，重启一些系统就好了。这就是内存碎片的问题。这就是为什么很多人抱怨STL有严重的内存碎片的问题，因为太多的小内存的分配释放了。有很多人会以为用内存池可以解决这个问题，但是实际上他们只是重新发明了Runtime-C或操作系统的内存管理机制，完全于事无补。当然解决内存碎片的问题还是通过内存池，具体来说是一系列不同尺寸的内存池（这个留给大家自己去思考）。当然，少进行动态内存分配是最好的。说到内存池就需要说一下池化技术。比如线程池，连接池等。池化技术对于一些短作业来说（如http服务） 相当相当的有效。这项技术可以减少链接建立，线程创建的开销，从而提高性能。</p>
</li>
<li><p><strong>异步操作</strong>。我们知道Unix下的文件操作是有block和non-block的方式的，像有些系统调用也是block式的，如：Socket下的select，Windows下的WaitforObject之类的，如果我们的程序是同步操作，那么会非常影响性能，我们可以改成异步的，但是改成异步的方式会让你的程序变复杂。异步方式一般要通过队列，要注间队列的性能问题，另外，异步下的状态通知通常是个问题，比如消息事件通知方式，有callback方式，等，这些方式同样可能会影响你的性能。但是通常来说，异步操作会让性能的吞吐率有很大提升（Throughput），但是会牺牲系统的响应时间（latency）。这需要业务上支持。</p>
</li>
<li><p><strong>语言和代码库</strong>。我们要熟悉语言以及所使用的函数库或类库的性能。比如：STL中的很多容器分配了内存后，那怕你删除元素，内存也不会回收，其会造成内存泄露的假像，并可能造成内存碎片问题。再如，STL某些容器的size()==0  和 empty()是不一样的，因为，size()是O(n)复杂度，empty()是O(1)的复杂度，这个要小心。Java中的JVM调优需要使用的这些参数：-Xms -Xmx -Xmn -XX:SurvivorRatio -XX:MaxTenuringThreshold，还需要注意JVM的GC，GC的霸气大家都知道，尤其是full GC（还整理内存碎片），他就像“恐龙特级克赛号”一样，他运行的时候，整个世界的时间都停止了。</p>
</li>
</ul>
<p><strong>4.3）网络调优</strong></p>
<p>关于网络调优，尤其是TCP Tuning（你可以以这两个关键词在网上找到很多文章），这里面有很多很多东西可以说。看看Linux下TCP/IP的那么多参数就知道了（顺便说一下，你也许不喜欢Linux，但是你不能否认Linux给我们了很多可以进行内核调优的权力）。强烈建议大家看看《<a href="http://book.douban.com/subject/1088054/" target="_blank">TCP/IP 详解 卷1:协议</a>》这本书。我在这里只讲一些概念上的东西。</p>
<p><strong>A） TCP调优</strong></p>
<p>我们知道TCP链接是有很多开销的，一个是会占用文件描述符，另一个是会开缓存，一般来说一个系统可以支持的TCP链接数是有限的，我们需要清楚地认识到TCP链接对系统的开销是很大的。正是因为TCP是耗资源的，所以，很多攻击都是让你系统上出现大量的TCP链接，把你的系统资源耗尽。比如著名的SYNC Flood攻击。</p>
<p>所以，我们要注意配置KeepAlive参数，这个参数的意思是定义一个时间，如果链接上没有数据传输，系统会在这个时间发一个包，如果没有收到回应，那么TCP就认为链接断了，然后就会把链接关闭，这样可以回收系统资源开销。（注：HTTP层上也有KeepAlive参数）对于像HTTP这样的短链接，设置一个1-2分钟的keepalive非常重要。这可以在一定程度上防止DoS攻击。有下面几个参数（下面这些参数的值仅供参考）：
1</p>
<p>2
3 net.ipv4.tcp_keepalive_probes = 5</p>
<p>net.ipv4.tcp_keepalive_intvl = 20
net.ipv4.tcp_fin_timeout = 30</p>
<p>对于TCP的TIME_WAIT这个状态，主动关闭的一方进入TIME_WAIT状态，TIME_WAIT状态将持续2个MSL(Max Segment Lifetime)，默认为4分钟，TIME_WAIT状态下的资源不能回收。有大量的TIME_WAIT链接的情况一般是在HTTP服务器上。对此，有两个参数需要注意，</p>
<p>1</p>
<p>2
 net.ipv4.tcp_tw_reuse=1</p>
<p>net.ipv4.tcp_tw_recycle=1</p>
<p>前者表示重用TIME_WAIT，后者表示回收TIME_WAIT的资源。</p>
<p>TCP还有一个重要的概念叫RWIN（TCP Receive Window Size），这个东西的意思是，我一个TCP链接在没有向Sender发出ack时可以接收到的最大的数据包。为什么这个很重要？因为如果Sender没有收到Receiver发过来ack，Sender就会停止发送数据并会等一段时间，如果超时，那么就会重传。这就是为什么TCP链接是可靠链接的原因。重传还不是最严重的，如果有丢包发生的话，TCP的带宽使用率会马上受到影响（会盲目减半），再丢包，再减半，然后如果不丢包了，就逐步恢复。相关参数如下：
1</p>
<p>2
3</p>
<p>4
 net.core.wmem_default = 8388608</p>
<p>net.core.rmem_default = 8388608
net.core.rmem_max = 16777216</p>
<p>net.core.wmem_max = 16777216</p>
<p>一般来说，理论上的RWIN应该设置成：吞吐量  /* 回路时间。Sender端的buffer应该和RWIN有一样的大小，因为Sender端发送完数据后要等Receiver端确认，如果网络延时很大，buffer过小了，确认的次数就会多，于是性能就不高，对网络的利用率也就不高了。也就是说，对于延迟大的网络，我们需要大的buffer，这样可以少一点ack，多一些数据，对于响应快一点的网络，可以少一些buffer。因为，如果有丢包（没有收到ack），buffer过大可能会有问题，因为这会让TCP重传所有的数据，反而影响网络性能。（当然，网络差的情况下，就别玩什么高性能了） 所以，高性能的网络重要的是要让网络丢包率非常非常地小（基本上是用在LAN里），如果网络基本是可信的，这样用大一点的buffer会有更好的网络传输性能（来来回回太多太影响性能了）。</p>
<p>另外，我们想一想，如果网络质量非常好，基本不丢包，而业务上我们不怕偶尔丢几个包，如果是这样的话，那么，我们为什么不用速度更快的UDP呢？你想过这个问题了吗？</p>
<p><strong>B）UDP调优</strong></p>
<p>说到UDP的调优，有一些事我想重点说一样，那就是MTU——最大传输单元（其实这对TCP也一样，因为这是链路层上的东西）。所谓最大传输单元，你可以想像成是公路上的公交车，假设一个公交车可以最多坐70人，带宽就像是公路的车道数一样，如果一条路上最多可以容下100辆公交车，那意味着我最多可以运送7000人，但是如果公交车坐不满，比如平均每辆车只有20人，那么我只运送了2000人，于是我公路资源（带宽资源）就被浪费了。 所以，我们对于一个UDP的包，我们要尽量地让他大到MTU的最大尺寸再往网络上传，这样可以最大化带宽利用率。对于这个MTU，以太网是1500字节，光纤是4352字节，802.11无线网是7981。但是，当我们用TCP/UDP发包的时候，我们的有效负载Payload要低于这个值，因为IP协议会加上20个字节，UDP会加上8个字节（TCP加的更多），所以，一般来说，你的一个UDP包的最大应该是1500-8-20=1472，这是你的数据的大小。当然，如果你用光纤的话， 这个值就可以更大一些。（顺便说一下，对于某些NB的千光以态网网卡来说，在网卡上，网卡硬件如果发现你的包的大小超过了MTU，其会帮你做fragment，到了目标端又会帮你做重组，这就不需要你在程序中处理了）</p>
<p>再多说一下，使用Socket编程的时候，你可以使用setsockopt() 设置 SO_SNDBUF/SO_RCVBUF 的大小，TTL和KeepAlive这些关键的设置，当然，还有很多，具体你可以查看一下Socket的手册。</p>
<p>最后说一点，UDP还有一个最大的好处是multi-cast多播，这个技术对于你需要在内网里通知多台结点时非常方便和高效。而且，多播这种技术对于机会的水平扩展（需要增加机器来侦听多播信息）也很有利。</p>
<p><strong>C）网卡调优</strong></p>
<p><em>**</em>对于网卡，我们也是可以调优的，这对于千兆以及网网卡非常必要，在Linux下，我们可以用ifconfig查看网上的统计信息，如果我们看到overrun上有数据，我们就可能需要调整一下txqueuelen的尺寸（一般默认为1000），我们可以调大一些，如：ifconfig eth0 txqueuelen 5000。Linux下还有一个命令叫：ethtool可以用于设置网卡的缓冲区大小。在Windows下，我们可以在网卡适配器中的高级选项卡中调整相关的参数（如：Receive Buffers, Transmit Buffer等，不同的网卡有不同的参数）。把Buffer调大对于需要大数据量的网络传输非常有效。</p>
<p><strong>D）其它网络性能</strong></p>
<p>关于多路复用技术，也就是用一个线程来管理所有的TCP链接，有三个系统调用要重点注意：一个是select，这个系统调用只支持上限1024个链接，第二个是poll，其可以突破1024的限制，但是select和poll本质上是使用的轮询机制，轮询机制在链接多的时候性能很差，因主是O(n)的算法，所以，epoll出现了，epoll是操作系统内核支持的，仅当在链接活跃时，操作系统才会callback，这是由操作系统通知触发的，但其只有Linux Kernel 2.6以后才支持（准确说是2.5.44中引入的），当然，如果所有的链接都是活跃的，过多的使用epoll_ctl可能会比轮询的方式还影响性能，不过影响的不大。</p>
<p>另外，关于一些和DNS Lookup的系统调用要小心，比如：gethostbyaddr/gethostbyname，这个函数可能会相当的费时，因为其要到网络上去找域名，因为DNS的递归查询，会导致严重超时，而又不能通过设置什么参数来设置time out，对此你可以通过配置hosts文件来加快速度，或是自己在内存中管理对应表，在程序启动时查好，而不要在运行时每次都查。另外，在多线程下面，gethostbyname会一个更严重的问题，就是如果有一个线程的gethostbyname发生阻塞，其它线程都会在gethostbyname处发生阻塞，这个比较变态，要小心。（你可以试试GNU的gethostbyname_r()，这个的性能要好一些） 这种到网上找信息的东西很多，比如，如果你的Linux使用了NIS，或是NFS，某些用户或文件相关的系统调用就很慢，所以要小心。</p>
<p><strong>4.4）系统调优</strong></p>
<p><strong>A）I/O模型</strong></p>
<p>前面说到过select/poll/epoll这三个系统调用，我们都知道，Unix/Linux下把所有的设备都当成文件来进行I/O，所以，那三个操作更应该算是I/O相关的系统调用。说到  I/O模型，这对于我们的I/O性能相当重要，我们知道，Unix/Linux经典的I/O方式是（关于Linux下的I/O模型，大家可以读一下这篇文章《<a href="http://www.ibm.com/developerworks/cn/linux/l-async/" target="_blank">使用异步I/O大大提高性能</a>》）：</p>
<p>第一种，同步阻塞式I/O，这个不说了。</p>
<p>第二种，同步无阻塞方式。其通过fctnl设置 O_NONBLOCK 来完成。</p>
<p>第三种，对于select/poll/epoll这三个是I/O不阻塞，但是在事件上阻塞，算是：I/O异步，事件同步的调用。</p>
<p>第四种，AIO方式。这种I/O 模型是一种处理与 I/O 并行的模型。I/O请求会立即返回，说明请求已经成功发起了。在后台完成I/O操作时，向应用程序发起通知，通知有两种方式：一种是产生一个信号，另一种是执行一个基于线程的回调函数来完成这次 I/O 处理过程。</p>
<p>第四种因为没有任何的阻塞，无论是I/O上，还是事件通知上，所以，其可以让你充分地利用CPU，比起第二种同步无阻塞好处就是，第二种要你一遍一遍地去轮询。Nginx之所所以高效，是其使用了epoll和AIO的方式来进行I/O的。</p>
<p>再说一下Windows下的I/O模型，</p>
<p>a）一个是WriteFile系统调用，这个系统调用可以是同步阻塞的，也可以是同步无阻塞的，关于看文件是不是以Overlapped打开的。关于同步无阻塞，需要设置其最后一个参数Overlapped，微软叫Overlapped I/O，你需要WaitForSingleObject才能知道有没有写完成。这个系统调用的性能可想而知。</p>
<p>b）另一个叫WriteFileEx的系统调用，其可以实现异步I/O，并可以让你传入一个callback函数，等I/O结束后回调之， 但是这个回调的过程Windows是把callback函数放到了APC（<a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms681951(v=vs.85" target="_blank">Asynchronous Procedure Calls</a>.aspx)）的队列中，然后，只用当应用程序当前线程成为可被通知状态（Alterable）时，才会被回调。只有当你的线程使用了这几个函数时<a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms687036(v=vs.85" target="_blank">WaitForSingleObjectEx</a>.aspx), <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms687028(v=vs.85" target="_blank">WaitForMultipleObjectsEx</a>.aspx), <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms684245(v=vs.85" target="_blank">MsgWaitForMultipleObjectsEx</a>.aspx), <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms686293(v=vs.85" target="_blank">SignalObjectAndWait</a>.aspx) 和 <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms686307(v=vs.85" target="_blank">SleepEx</a>.aspx)，线程才会成为Alterable状态。可见，这个模型，还是有wait，所以性能也不高。</p>
<p>c）然后是IOCP – IO Completion Port，IOCP会把I/O的结果放在一个队列中，但是，侦听这个队列的不是主线程，而是专门来干这个事的一个或多个线程去干（老的平台要你自己创建线程，新的平台是你可以创建一个线程池）。IOCP是一个线程池模型。这个和Linux下的AIO模型比较相似，但是实现方式和使用方式完全不一样。</p>
<p>当然，真正提高I/O性能方式是把和外设的I/O的次数降到最低，最好没有，所以，对于读来说，内存cache通常可以从质上提升性能，因为内存比外设快太多了。对于写来说，cache住要写的数据，少写几次，但是cache带来的问题就是实时性的问题，也就是latency会变大，我们需要在写的次数上和相应上做权衡。</p>
<p><strong>B）多核</strong>CPU<strong>调优</strong></p>
<p>关于CPU的多核技术，我们知道，CPU0是很关键的，如果0号CPU被用得过狠的话，别的CPU性能也会下降，因为CPU0是有调整功能的，所以，我们不能任由操作系统负载均衡，因为我们自己更了解自己的程序，所以，我们可以手动地为其分配CPU核，而不会过多地占用CPU0，或是让我们关键进程和一堆别的进程挤在一起。</p>
<ul>
<li><p>对于Windows来说，我们可以通过“任务管理器”中的“进程”而中右键菜单中的“设置相关性……”（Set Affinity…）来设置并限制这个进程能被运行在哪些核上。</p>
</li>
<li><p>对于Linux来说，可以使用taskset命令来设置（你可以通过安装schedutils来安装这个命令：apt-get install schedutils）</p>
</li>
</ul>
<p>多核CPU还有一个技术叫<a href="http://en.wikipedia.org/wiki/Non-Uniform_Memory_Access" target="_blank">NUMA</a>技术（Non-Uniform Memory Access）。传统的多核运算是使用SMP(Symmetric Multi-Processor )模式，多个处理器共享一个集中的存储器和I/O总线。于是就会出现一致存储器访问的问题，一致性通常意味着性能问题。NUMA模式下，处理器被划分成多个node， 每个node有自己的本地存储器空间。关于NUMA的一些技术细节，你可以查看一下这篇文章《<a href="http://www.ibm.com/developerworks/cn/linux/l-numa/index.html" target="_blank">Linux 的 NUMA 技术</a>》，在Linux下，对NUMA调优的命令是：<strong>numactl </strong>。如下面的命令：（指定命令“myprogram arg1 arg2”运行在node 0 上，其内存分配在node 0 和 1上）
1 numactl --cpubind=0 --membind=0,1 myprogram arg1 arg2</p>
<p>当然，上面这个命令并不好，因为内存跨越了两个node，这非常不好。最好的方式是只让程序访问和自己运行一样的node，如：</p>
<p>1 $ numactl --membind 1 --cpunodebind 1 --localalloc myapplication</p>
<p><strong>C）文件系统调优</strong></p>
<p>关于文件系统，因为文件系统也是有cache的，所以，为了让文件系统有最大的性能。首要的事情就是分配足够大的内存，这个非常关键，在Linux下可以使用free命令来查看 free/used/buffers/cached，理想来说，buffers和cached应该有40%左右。然后是一个快速的硬盘控制器，SCSI会好很多。最快的是Intel SSD 固态硬盘，速度超快，但是写次数有限。</p>
<p>接下来，我们就可以调优文件系统配置了，对于Linux的Ext3/4来说，几乎在所有情况下都有所帮助的一个参数是关闭文件系统访问时间，在/etc/fstab下看看你的文件系统 有没有noatime参数（一般来说应该有），还有一个是dealloc，它可以让系统在最后时刻决定写入文件发生时使用哪个块，可优化这个写入程序。还要注间一下三种日志模式：data=journal、data=ordered和data=writeback。默认设置data=ordered提供性能和防护之间的最佳平衡。</p>
<p>当然，对于这些来说，ext4的默认设置基本上是最佳优化了。</p>
<p>这里介绍一个Linux下的查看I/O的命令—— iotop，可以让你看到各进程的磁盘读写的负载情况。</p>
<p>其它还有一些关于NFS、XFS的调优，大家可以上google搜索一些相关优化的文章看看。关于各文件系统，大家可以看一下这篇文章——《<a href="http://www.ibm.com/developerworks/cn/linux/l-jfs/" target="_blank">Linux日志文件系统及性能分析</a>》</p>
<p><strong>4.5）数据库调优</strong></p>
<p>数据库调优并不是我的强项，我就仅用我非常有限的知识说上一些吧。注意，下面的这些东西并不一定正确，因为在不同的业务场景，不同的数据库设计下可能会得到完全相反的结论，所以，我仅在这里做一些一般性的说明，具体问题还要具体分析。</p>
<p><strong>A）数据库引擎调优</strong></p>
<p>我对数据库引擎不是熟，但是有几个事情我觉得是一定要去了解的。</p>
<ul>
<li><strong>数据库的锁的方式</strong>。这个非常非常地重要。并发情况下，锁是非常非常影响性能的。各种隔离级别，行锁，表锁，页锁，读写锁，事务锁，以及各种写优先还是读优先机制。性能最高的是不要锁，所以，分库分表，冗余数据，减少一致性事务处理，可以有效地提高性能。NoSQL就是牺牲了一致性和事务处理，并冗余数据，从而达到了分布式和高性能。</li>
<li><strong>数据库的存储机制</strong>。不但要搞清楚各种类型字段是怎么存储的，更重要的是数据库的数据存储方式，是怎么分区的，是怎么管理的，比如Oracle的数据文件，表空间，段，等等。了解清楚这个机制可以减轻很多的I/O负载。比如：MySQL下使用show engines;可以看到各种存储引擎的支持。不同的存储引擎有不同的侧重点，针对不同的业务或数据库设计会让你有不同的性能。</li>
<li><strong>数据库的分布式策略</strong>。最简单的就是复制或镜像，需要了解分布式的一致性算法，或是主主同步，主从同步。通过了解这种技术的机理可以做到数据库级别的水平扩展。</li>
</ul>
<p><strong>B）SQL语句优化</strong></p>
<p>关于SQL语句的优化，首先也是要使用工具，比如：<a href="http://www.mysql.com/products/enterprise/query.html" target="_blank">MySQL SQL Query Analyzer</a>，<a href="http://www.oracle-base.com/articles/11g/sql-performance-analyzer-11gr1.php" target="_blank">Oracle SQL Performance Analyzer</a>，或是微软<a href="http://msdn.microsoft.com/en-us/library/aa216945(v=sql.80" target="_blank">SQL Query Analyzer</a>.aspx)，基本上来说，所有的RMDB都会有这样的工具，来让你查看你的应用中的SQL的性能问题。 还可以使用explain来看看SQL语句最终Execution Plan会是什么样的。</p>
<p>还有一点很重要，数据库的各种操作需要大量的内存，所以服务器的内存要够，优其应对那些多表查询的SQL语句，那是相当的耗内存。</p>
<p>下面我根据我有限的数据库SQL的知识说几个会有性能问题的SQL：</p>
<ul>
<li><p><strong>全表检索</strong>。比如：select /* from user where lastname = “xxxx”，这样的SQL语句基本上是全表查找，线性复杂度O(n)，记录数越多，性能也越差（如：100条记录的查找要50ms，一百万条记录需要5分钟）。对于这种情况，我们可以有两种方法提高性能：一种方法是分表，把记录数降下来，另一种方法是建索引（为lastname建索引）。索引就像是key-value的数据结构一样，key就是where后面的字段，value就是物理行号，对索引的搜索复杂度是基本上是O(log(n)) ——用B-Tree实现索引（如：100条记录的查找要50ms，一百万条记录需要100ms）。</p>
</li>
<li><p><strong>索引</strong>。对于索引字段，最好不要在字段上做计算、类型转换、函数、空值判断、字段连接操作，这些操作都会破坏索引原本的性能。当然，索引一般都出现在Where或是Order by字句中，所以对Where和Order by子句中的子段最好不要进行计算操作，或是加上什么NOT之类的，或是使用什么函数。</p>
</li>
<li><p><strong>多表查询</strong>。关系型数据库最多的操作就是多表查询，多表查询主要有三个关键字，EXISTS，IN和JOIN（关于各种join，可以参看<a href="http://coolshell.cn/articles/3463.html" title="图解SQL的Join" target="_blank">图解SQL的Join</a>一文）。基本来说，现代的数据引擎对SQL语句优化得都挺好的，JOIN和IN/EXISTS在结果上有些不同，但性能基本上都差不多。有人说，EXISTS的性能要好于IN，IN的性能要好于JOIN，我各人觉得，这个还要看你的数据、schema和SQL语句的复杂度，对于一般的简单的情况来说，都差不多，所以千万不要使用过多的嵌套，千万不要让你的SQL太复杂，宁可使用几个简单的SQL也不要使用一个巨大无比的嵌套N级的SQL。还有人说，如果两个表的数据量差不多，Exists的性能可能会高于In，In可能会高于Join，如果这两个表一大一小，那么子查询中，Exists用大表，In则用小表。这个，我没有验证过，放在这里让大家讨论吧。另，有一篇关于SQL Server的文章大家可以看看《<a href="http://explainextended.com/2009/06/16/in-vs-join-vs-exists/" target="_blank">IN vs JOIN vs EXISTS</a>》</p>
</li>
<li><p><strong>JOIN操作</strong>。有人说，Join表的顺序会影响性能，只要Join的结果集是一样，性能和join的次序无关。因为后台的数据库引擎会帮我们优化的。Join有三种实现算法，嵌套循环，排序归并，和Hash式的Join。（MySQL只支持第一种）</p>
</li>
<li><p>嵌套循环，就好像是我们常见的多重嵌套循环。注意，前面的索引说过，数据库的索引查找算法用的是B-Tree，这是O(log(n))的算法，所以，整个算法复法度应该是O(log(n)) /* O(log(m)) 这样的。</p>
</li>
<li>Hash式的Join，主要解决嵌套循环的O(log(n))的复杂，使用一个临时的hash表来标记。</li>
<li>排序归并，意思是两个表按照查询字段排好序，然后再合并。当然，索引字段一般是排好序的。</li>
</ul>
<p>还是那句话，具体要看什么样的数据，什么样的SQL语句，你才知道用哪种方法是最好的。</p>
<ul>
<li><p><strong>部分结果集。</strong>我们知道MySQL里的Limit关键字，Oracle里的rownum，SQL Server里的Top都是在限制前几条的返回结果。这给了我们数据库引擎很多可以调优的空间。一般来说，返回top n的记录数据需要我们使用order by，注意在这里我们需要为order by的字段建立索引。有了被建索引的order by后，会让我们的select语句的性能不会被记录数的所影响。使用这个技术，一般来说我们前台会以分页方式来显现数据，Mysql用的是OFFSET，SQL Server用的是FETCH NEXT，这种Fetch的方式其实并不好是线性复杂度，所以，如果我们能够知道order by字段的第二页的起始值，我们就可以在where语句里直接使用&gt;=的表达式来select，这种技术叫seek，而不是fetch，seek的性能比fetch要高很多。</p>
</li>
<li><p><strong>字符串</strong>。正如我前面所说的，字符串操作对性能上有非常大的恶梦，所以，能用数据的情况就用数字，比如：时间，工号，等。</p>
</li>
<li><p><strong>全文检索</strong>。千万不要用Like之类的东西来做全文检索，如果要玩全文检索，可以尝试使用<a href="http://sphinxsearch.com/" target="_blank">Sphinx</a>。</p>
</li>
<li><p><strong>其它</strong>。</p>
</li>
<li><p>不要select /*，而是明确指出各个字段，如果有多个表，一定要在字段名前加上表名，不要让引擎去算。</p>
</li>
<li>不要用Having，因为其要遍历所有的记录。性能差得不能再差。</li>
<li>尽可能地使用UNION ALL  取代  UNION。</li>
<li>索引过多，insert和delete就会越慢。而update如果update多数索引，也会慢，但是如果只update一个，则只会影响一个索引表。</li>
<li>等等。</li>
</ul>
<p>关于SQL语句的优化，网上有很多文章， 不同的数据库引擎有不同的优化技巧，正如本站以前转发的《<a href="http://coolshell.cn/articles/1846.html" target="_blank">MySQL性能优化的最佳20+条经验</a>》</p>
<p>先写这么多吧，欢迎大家指正补充。
<strong>注：</strong>这篇文章的确是个大杂烩。其实其中的说到的很多技术在网上都有很多很多的技术文章，google一下就能找到一堆有很多细节的文章，所以我也就不写了。这篇性能调优的文章写作的动机是之前看到 <a href="http://weibo.com/n/%E6%B7%98%E5%AE%9D%E8%A4%9A%E9%9C%B8" target="_blank">@淘宝褚霸</a> 强推的<a href="http://highscalability.com/" target="_blank">highscalability.com</a>上的这篇文章：<a href="http://highscalability.com/blog/2012/5/16/big-list-of-20-common-bottlenecks.html" target="_blank">Big List Of 20 Common Bottlenecks</a>，觉得这篇文章泛泛而谈，觉得自己能写得比它好，所以就产生了动机。
来源： <a href="[http://coolshell.cn/articles/7490.html](http://coolshell.cn/articles/7490.html)">[http://coolshell.cn/articles/7490.html](http://coolshell.cn/articles/7490.html)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/性能调优/">性能调优</a></li></span></span> | <span class="tags">Tagged <a href="/tags/性能调优/" class="label label-primary">性能调优</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:40"datetime="2014-03-07 09:54:40"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-性能调优--性能调优攻略-Coolshell/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-性能调优--性能调优攻略-Coolshell" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/74/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/72/">72</a></li><li><a class="page-number" href="/page/73/">73</a></li><li><a class="page-number" href="/page/74/">74</a></li><li class="active"><li><span class="page-number current">75</span></li><li><a class="page-number" href="/page/76/">76</a></li><li><a class="page-number" href="/page/77/">77</a></li><li><a class="page-number" href="/page/78/">78</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/76/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 17:26:53</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
