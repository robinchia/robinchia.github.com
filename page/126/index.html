
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 126 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-分区--Oracle数据库中分区表的操作方法1/">Oracle数据库中分区表的操作方法1</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:35.000Z"> <a href="/2014/02/02/2014-02-02-DB-分区--Oracle数据库中分区表的操作方法1/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="oracle-1">Oracle数据库中分区表的操作方法1</h1>
<p><a href="http://reg.163.com/" target="_blank">通行证</a>：用户名  密码 <a href="http://mail.163.com/" target="_blank"></a><a href="http://www.163.com/">首页</a> - <a href="http://news.163.com/" target="_blank">新闻</a> - <a href="http://www.126.com/" target="_blank">免费邮箱</a> - <a href="http://sms.163.com/" target="_blank">短信</a> - <a href="http://popo.163.com/" target="_blank">POPO</a> - <a href="http://photo.163.com/" target="_blank">相册</a> - <a href="http://so.163.com/" target="_blank">搜索</a> - <a href="http://love.163.com/" target="_blank">交友</a> - <a href="http://adfarm.mediaplex.com/ad/ck/4080-25846-9511-15?cn=netease;textlink;hp" target="_blank">拍卖</a> <a href="http://www.163.com/" target="_blank"><img src="" alt="NetEase"></a>
 <a href="http://news.163.com/" target="_blank">新闻</a> | <a href="http://sports.163.com/" target="_blank">体育</a> | <a href="http://finance.163.com/" target="_blank">财经</a> | <a href="http://ent.163.com/" target="_blank">娱乐</a> | <a href="http://biz.163.com/" target="_blank">商业</a>| <a href="http://tech.163.com/" target="_blank"><strong>科技</strong></a> | <a href="http://auto.163.com/" target="_blank">汽车</a> | <a href="http://digi.163.com/" target="_blank">数码</a> | <a href="http://lady.163.com/" target="_blank">女人</a> | <a href="http://travel.163.com/" target="_blank">旅游</a> | <a href="http://education.163.com/" target="_blank">教育</a> | <a href="http://culture.163.com/" target="_blank">文化</a> | <a href="http://gz.163.com/" target="_blank">广州</a> | <a href="http://news.163.com/war/" target="_blank">军事</a> | <a href="http://bulo.163.com/" target="_blank">部落</a>
<a href="http://talk.163.com/" target="_blank">评论</a> | <a href="http://sports.163.com/nba/" target="_blank">NBA</a> | <a href="http://ent.163.com/people/" target="_blank">明星</a> | <a href="http://stock.163.com/" target="_blank">证券</a> | <a href="http://fund.163.com/" target="_blank">基金</a> | <a href="http://tech.163.com/discover/" target="_blank">探索</a> | <a href="http://soufun.163.com/" target="_blank">房产</a> | <a href="http://mobile.163.com/" target="_blank">手机</a> | <a href="http://health.163.com/sex/" target="_blank">两性</a> | <a href="http://health.163.com/" target="_blank">健康</a> | <a href="http://px.163.com/" target="_blank">培训</a> | <a href="http://ent.163.com/ent/level1/movie.html" target="_blank">电影</a> | <a href="http://game.163.com/" target="_blank">游戏</a>| <a href="http://adfarm.mediaplex.com/ad/ck/4080-25838-9511-9?cn=netease;2word;hp" target="_blank">拍卖</a> | <a href="http://bbs.163.com/" target="_blank">论坛</a>  <a href="http://tech.163.com/school/" target="_blank"><img src="" alt="网易学院·教程"></a> ·<a href="http://tech.163.com/special/t/000915AD/tools.html" target="_blank">工具软件</a>·<a href="http://tech.163.com/special/o/000915A6/officetool.html" target="_blank">办公软件</a>·<a href="http://tech.163.com/special/O/000915A0/OS.html" target="_blank">操作系统</a>·<a href="http://tech.163.com/special/p/0009158A/photos.html" target="_blank">图形图像</a>·<a href="http://tech.163.com/special/w/0009158K/website.html" target="_blank">网站建设</a>·<a href="http://tech.163.com/special/d/0009159F/developer.html" target="_blank">编程开发</a>·<a href="http://tech.163.com/special/m/0009158R/multimedia.html" target="_blank">多媒体</a>·<a href="http://tech.163.com/special/n/000917GE/net.html" target="_blank">网络</a>·<a href="http://tech.163.com/special/d/000917GF/du.html" target="_blank">病毒</a> ·<a href="http://tech.163.com/school" target="_blank">学院首页</a>·<a href="http://tech.163.com/special/S/000915SN/S_Special.html" target="_blank">精选专题</a>·<a href="http://tech.163.com/special/A/00091593/Arts1.html" target="_blank">艺术设计</a>·<a href="http://tech.163.com/special/E/00091ESS/Ebook.html" target="_blank">电子杂志</a>·<a href="http://tech.163.com/special/S/000915AH/S_InterView.html" target="_blank">教授视点</a>·<a href="http://tech.163.com/special/A/000915AH/AllPro1.html" target="_blank">教授名录</a>·<a href="http://tech.163.com/special/s/000915AS/softnews.html" target="_blank">软件新闻</a>·<a href="http://tech.163.com/special/s/000917D5/schoolbbs.html" target="_blank">论坛</a></p>
<p>你现在的位置是： <a href="http://www.163.com/" target="_blank">网易</a> &gt; <a href="http://tech.163.com/" target="_blank">网易科技</a> &gt; <a href="http://tech.163.com/school" target="_blank">网易学院·教程</a></p>
<h1 id="oracle-">Oracle数据库中分区表的操作方法</h1>
<p><a href="http://tech.163.com/school" target="_blank">http://tech.163.com/school</a> · 2005-06-16 11:44:19 · 来源: blog</p>
<p>第1页：Oracle数据库中分区表的操作方法 第2页：Oracle数据库中分区表的操作方法
<strong>摘要</strong>：在大量业务数据处理的项目中，可以考虑使用分区表来提高应用系统的性能并方便数据管理，本文详细介绍了分区表的使用。
在大型的企业应用或企业级的数据库应用中，要处理的数据量通常可以达到几十到几百GB，有的甚至可以到TB级。虽然存储介质和数据处理技术的发展也很快，但是仍然不能满足用户的需求，为了使用户的大量的数据在读写操作和查询中速度更快，Oracle提供了对表和索引进行分区的技术，以改善大型应用系统的性能。
使用分区的优点：
·增强可用性：如果表的某个分区出现故障，表在其他分区的数据仍然可用；
·维护方便：如果表的某个分区出现故障，需要修复数据，只修复该分区即可；
·均衡I/O：可以把不同的分区映射到磁盘以平衡I/O，改善整个系统性能；
·改善查询性能：对分区对象的查询可以仅搜索自己关心的分区，提高检索速度。
Oracle数据库提供对表或索引的分区方法有三种：
·范围分区
·Hash分区（散列分区）
·复合分区
下面将以实例的方式分别对这三种分区方法来说明分区表的使用。为了测试方便，我们先建三个表空间。</p>
<p>create tablespace dinya_space01    datafile ’/test/demo/oracle/demodata/dinya01.dnf’ size 50M    create tablespace dinya_space01    datafile ’/test/demo/oracle/demodata/dinya02.dnf’ size 50M    create tablespace dinya_space01    datafile ’/test/demo/oracle/demodata/dinya03.dnf’ size 50M
<strong>1.1. 分区表的创建</strong>
1.1.1. 范围分区
范围分区就是对数据表中的某个值的范围进行分区，根据某个值的范围，决定将该数据存储在哪个分区上。如根据序号分区，根据业务记录的创建日期进行分区等。
需求描述：有一个物料交易表，表名：material_transactions。该表将来可能有千万级的数据记录数。要求在建该表的时候使用分区表。这时候我们可以使用序号分区三个区，每个区中预计存储三千万的数据，也可以使用日期分区，如每五年的数据存储在一个分区上。
根据交易记录的序号分区建表：</p>
<p>SQL&gt; create table dinya_test    2 (    3 transaction_id number primary key,    4 item_id number(8) not null,    5 item_description varchar2(300),    6 transaction_date date not null    7 )    8 partition by range (transaction_id)    9 (    10 partition part_01 values less than(30000000) tablespace dinya_space01,    11 partition part_02 values less than(60000000) tablespace dinya_space02,    12 partition part_03 values less than(maxvalue) tablespace dinya_space03    13 );    Table created.
建表成功，根据交易的序号，交易ID在三千万以下的记录将存储在第一个表空间dinya_space01中，分区名为:par_01，在三千万到六千万之间的记录存储在第二个表空间：
dinya_space02中，分区名为：par_02，而交易ID在六千万以上的记录存储在第三个表空间dinya_space03中，分区名为par_03.
根据交易日期分区建表：</p>
<p>SQL&gt; create table dinya_test    2 (    3 transaction_id number primary key,    4 item_id number(8) not null,    5 item_description varchar2(300),    6 transaction_date date not null    7 )    8 partition by range (transaction_date)    9 (    10 partition part_01 values less than(to_date(’2006-01-01’,’yyyy-mm-dd’))    tablespace dinya_space01,    11 partition part_02 values less than(to_date(’2010-01-01’,’yyyy-mm-dd’))    tablespace dinya_space02,    12 partition part_03 values less than(maxvalue) tablespace dinya_space03    13 );    Table created.
这样我们就分别建了以交易序号和交易日期来分区的分区表。每次插入数据的时候，系统将根据指定的字段的值来自动将记录存储到制定的分区（表空间）中。
当然，我们还可以根据需求，使用两个字段的范围分布来分区，如partition by range ( transaction_id ,transaction_date), 分区条件中的值也做相应的改变，请读者自行测试。
1.1.2. Hash分区（散列分区）
散列分区为通过指定分区编号来均匀分布数据的一种分区类型，因为通过在I/O设备上进行散列分区，使得这些分区大小一致。如将物料交易表的数据根据交易ID散列地存放在指定的三个表空间中：</p>
<p>SQL&gt; create table dinya_test    2 (    3 transaction_id number primary key,    4 item_id number(8) not null,    5 item_description varchar2(300),    6 transaction_date date    7 )    8 partition by hash(transaction_id)    9 (    10 partition part_01 tablespace dinya_space01,    11 partition part_02 tablespace dinya_space02,    12 partition part_03 tablespace dinya_space03    13 );    Table created.
建表成功，此时插入数据，系统将按transaction_id将记录散列地插入三个分区中，这里也就是三个不同的表空间中。
1.1.3. 复合分区
有时候我们需要根据范围分区后，每个分区内的数据再散列地分布在几个表空间中，这样我们就要使用复合分区。复合分区是先使用范围分区，然后在每个分区内再使用散列分区的一种分区方法，如将物料交易的记录按时间分区，然后每个分区中的数据分三个子分区，将数据散列地存储在三个指定的表空间中：</p>
<p>SQL&gt; create table dinya_test    2 (    3 transaction_id number primary key,    4 item_id number(8) not null,    5 item_description varchar2(300),    6 transaction_date date    7 )    8 partition by range(transaction_date)subpartition by hash(transaction_id)    9 subpartitions 3 store in (dinya_space01,dinya_space02,dinya_space03)    10 (    11 partition part_01 values less than(to_date(’2006-01-01’,’yyyy-mm-dd’)),    12 partition part_02 values less than(to_date(’2010-01-01’,’yyyy-mm-dd’)),    13 partition part_03 values less than(maxvalue)    14 );    Table created.
该例中，先是根据交易日期进行范围分区，然后根据交易的ID将记录散列地存储在三个表空间中。
<strong>1.2. 分区表操作</strong>
以上了解了三种分区表的建表方法，下面将使用实际的数据并针对按日期的范围分区来测试分区表的数据记录的操作。
1.2.1. 插入记录：</p>
<p>SQL&gt; insert into dinya_test values(1,12,’BOOKS’,sysdate);    1 row created.    SQL&gt; insert into dinya_test values(2,12, ’BOOKS’,sysdate+30);    1 row created.    SQL&gt; insert into dinya_test values(3,12, ’BOOKS’,to_date(’2006-05-30’,’yyyy-mm-dd’));    1 row created.    SQL&gt; insert into dinya_test values(4,12, ’BOOKS’,to_date(’2007-06-23’,’yyyy-mm-dd’));    1 row created.    SQL&gt; insert into dinya_test values(5,12, ’BOOKS’,to_date(’2011-02-26’,’yyyy-mm-dd’));    1 row created.    SQL&gt; insert into dinya_test values(6,12, ’BOOKS’,to_date(’2011-04-30’,’yyyy-mm-dd’));    1 row created.    SQL&gt; commit;    Commit complete.    SQL&gt;
按上面的建表结果，2006年前的数据将存储在第一个分区part_01上，而2006年到2010年的交易数据将存储在第二个分区part_02上，2010年以后的记录存储在第三个分区part_03上。</p>
<p><img src="" alt="落叶秋客"> <a href="http://tech.163.com/" target="_blank">[返回首页]</a></p>
<p><a href="http://tech.163.com/05/0616/11/1MC8AUT900091589.html#" target="_blank"><img src="" alt=""></a> [1] [<a href="http://tech.163.com/05/0616/11/1MC8AUT900091589_2.html" target="_blank">2</a>] <a href="http://tech.163.com/05/0616/11/1MC8AUT900091589_2.html" target="_blank"><img src="" alt=""></a>
<strong>相关文章：</strong></p>
<ul>
<li>·<a href="http://tech.163.com/05/0610/11/1LSQ9ANG00091589.html" target="_blank">Oracle数据库集中复制方法浅议</a>(2005-06-10 11:50:09)</li>
<li>·<a href="http://tech.163.com/05/0608/11/1LNJOGMA00091589.html" target="_blank">Oracle中使用PL/SQL操作COM对象</a>(2005-06-08 11:19:55)</li>
<li>·<a href="http://tech.163.com/05/0607/15/1LLF6ODF00091589.html" target="_blank">Oracle平台应用数据库系统的设计与开发</a>(2005-06-07 15:21:49)</li>
<li>·<a href="http://tech.163.com/05/0606/10/1LIAGLN000091589.html" target="_blank">Oracle与SQL Server在企业应用中的比较</a>(2005-06-06 10:02:08)</li>
<li>·<a href="http://tech.163.com/05/0420/08/1HP5LHI6000915DD.html" target="_blank">SUN与Oracle牵手对抗SAP和IBM信息化巨头</a>(2005-04-20 08:49:19)</li>
</ul>
<p><strong>推荐文章：</strong></p>
<p>·<a href="http://tech.163.com/08/0117/13/42DNAAL500091589.html" target="_blank">赢在2007赛迪网年度企业人物榜单揭晓</a> ·<a href="http://tech.163.com/08/0111/14/41UC892E00091589.html" target="_blank">你最需要哪种类型的视频教程</a> ·<a href="http://tech.163.com/07/1206/14/3V1M3KJA00091589.html" target="_blank">不用网银也网上购物 三步自助开通</a> ·<a href="http://tech.163.com/07/1204/09/3US0INJ500091589.html" target="_blank">2007年UPA用户体验大会成功闭幕</a> ·<a href="http://tech.163.com/07/1124/10/3U2B680L00091589.html" target="_blank">2007中国青年设计节暨用户体验年会在京开幕</a> ·<a href="http://tech.163.com/07/1123/14/3U07BF3000091589.html" target="_blank">User Friendly 2007现场图片</a> ·<a href="http://tech.163.com/07/1120/15/3TOJAKSS00091589.html" target="_blank">手机畅游互联网 空中Opera 2.0实测</a> ·<a href="http://tech.163.com/07/1120/10/3TO3Q38200091589.html" target="_blank">动易软件即将全面开源和免费</a> ·<a href="http://tech.163.com/07/0830/17/3N5MP1KG000917GR.html" target="_blank">搜图有“道” 图片达人的搜索秘籍</a> ·<a href="http://tech.163.com/07/0827/15/3MTMJAC60009159C.html" target="_blank">数字水墙 08年世博会亮相</a> ·<a href="http://tech.163.com/07/0827/14/3MTLTCQM00091599.html" target="_blank">RabbitAir MinusA2空气净化器设计</a> ·<a href="http://tech.163.com/07/0827/14/3MTL6T860009159B.html" target="_blank">Oscar Bjarnason 平面设计</a> ·<a href="http://tech.163.com/07/0827/12/3MTDSFIV00091JFM.html" target="_blank">国产杀毒软件半个月内勇夺两项国际权威认证</a> ·<a href="http://tech.163.com/07/0827/11/3MT9FRH900092A5O.html" target="_blank">美化你的博客-推荐多个博客图标下载网站</a> ·<a href="http://tech.163.com/07/0827/11/3MT8N9K6000920O4.html" target="_blank">微软回应Vista用户遇到的网络问题“设计如此”</a> ·<a href="http://tech.163.com/07/0827/10/3MT8ALLD000918BL.html" target="_blank">eBay改进用户体验 借鉴亚马逊页面设计搜索功能</a> ·<a href="http://tech.163.com/07/0827/10/3MT86E56000915AS.html" target="_blank">极点五笔6.0正式版发布</a> ·<a href="http://tech.163.com/07/0827/10/3MT5KT0J000915AC.html" target="_blank">WPS Office 2007抢先试用</a> ·<a href="http://tech.163.com/07/0827/10/3MT5A8I4000915AS.html" target="_blank">报告称Google Apps功能远不及微软Office</a> ·<a href="http://tech.163.com/07/0827/10/3MT55K55000917GE.html" target="_blank">什么是SOCK5代理，什么是HTTP代理</a>
<a href=""></a> 最新评论<a href=""></a> <a href="http://comment.news.163.com/reply/post.jsp?board=tech_bbs&amp;threadid=1MC8AUT900091589" target="_blank"><img src="" alt=""></a>   <img src="" alt=""> <strong><a href="http://comment.news.163.com/reply/post.jsp?type=re&amp;board=tech_bbs&amp;threadid=1MC8AUT900091589" target="_blank">更多评论</a></strong> 共 <strong><em>0</em></strong>条评论 网易通行证：  　 密码：  　 　      参与评论   您的发表的评论将在5分钟内被审核，请耐心等待</p>
<p>网易学院联系电话：020-61210163-560 合作/投稿邮箱：NeteaseSchool(at)126.com</p>
<p>合作媒体：<a href="http://www.isblog.cn/" target="_blank">结绳记事</a> <a href="http://www.arthtml.com/" target="_blank">艺网</a> <a href="http://www.pc120.net.cn/" target="_blank">中国电脑救援中心</a> <a href="http://www.ad110.com/" target="_blank">ad110.com</a> <a href="http://www.jcwcn.com/" target="_blank">中国教程网</a> <a href="http://fif.hlw.cn/" target="_blank">FIF多媒体制作组</a> <a href="http://www.xjke.com/" target="_blank">金鹰电脑教程网</a> <a href="http://www.cybermagics.com/" target="_blank">时代光魔</a> <a href="http://www.ttup.cn/" target="_blank">好好学习 天天向上</a>
<a href="http://tech.163.com/special/d/00091M9L/draftad1.html" target="_blank">主编信箱</a>　热线:020-　<a href="http://bbs3.news.163.com/board/postlist.jsp?b=idea" target="_blank">给网易提意见</a>　<a href="http://corp.163.com/" target="_blank">About NetEase</a> - <a href="http://gb.corp.163.com/gb/about/overview.html" target="_blank">公司简介</a> - <a href="http://gb.corp.163.com/gb/contactus.html" target="_blank">联系方法</a> - <a href="http://corp.163.com/gb/job/job.html" target="_blank">招聘信息</a> - <a href="http://gb.corp.163.com/gb/cs.html" target="_blank">客户服务</a> - <a href="http://gb.corp.163.com/gb/legal.html" target="_blank">相关法律</a> - <a href="http://emarketing.biz.163.com/" target="_blank">网络营销</a> - <a href="http://help.163.com/" target="_blank">帮助中心</a>
网易公司版权所有
©1997-2009</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/分区/">分区</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/分区/" class="label label-success">分区</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:35"datetime="2014-03-07 09:54:35"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-分区--Oracle数据库中分区表的操作方法1/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-分区--Oracle数据库中分区表的操作方法1" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-oracle--Oraclenotin查不到应有的结果2/">Oracle not in查不到应有的结果 (2)</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:34.000Z"> <a href="/2014/02/02/2014-02-02-DB-oracle--Oraclenotin查不到应有的结果2/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="oracle-not-in-2-">Oracle not in查不到应有的结果 (2)</h1>
<p><a href="http://g.live.com/9uxp9en-us/hdr_main1??su=http://shared.live.com/" target="_blank"><img src="" alt="Windows Live">Windows Live™</a></p>
<ul>
<li><a href="http://g.live.com/9uxp9en-us/hdr_main1??su=http://shared.live.com/Live.Spaces" target="_blank">Home</a></li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_main2??su=http://shared.live.com/Live.Spaces" target="_blank">Profile</a></li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_main3??su=http://shared.live.com/Live.Spaces" target="_blank">People</a></li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_main4??su=http://shared.live.com/Live.Spaces" target="_blank">Mail</a></li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_main5??su=http://shared.live.com/Live.Spaces" target="_blank">Photos</a></li>
<li><p><a href="http://x-spirit.spaces.live.com/mmm2009-09-01_09.47/#" target="_blank">More ▼</a></p>
</li>
<li><p><a href="http://g.live.com/9uxp9en-us/hdr_main6??su=http://shared.live.com/Live.Spaces" target="_blank">Calendar</a></p>
</li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_more12??su=http://shared.live.com/Live.Spaces" target="_blank">Events</a></li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_more2??su=http://shared.live.com/Live.Spaces" target="_blank">SkyDrive</a></li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_more1??su=http://shared.live.com/Live.Spaces" target="_blank">Groups</a></li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_more11??su=http://shared.live.com/Live.Spaces" target="_blank">Spaces</a></li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_more4??su=http://shared.live.com/Live.Spaces" target="_blank">Family Safety</a></li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_more6??su=http://shared.live.com/Live.Spaces" target="_blank">Mobile</a></li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_more5??su=http://shared.live.com/Live.Spaces" target="_blank">Downloads</a></li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_more9??su=http://shared.live.com/Live.Spaces" target="_blank">Office Live</a></li>
<li><a href="http://g.live.com/9uxp9en-us/hdr_more13??su=http://shared.live.com/Live.Spaces" target="_blank">All services</a></li>
<li><p><a href="http://x-spirit.spaces.live.com/mmm2009-09-01_09.47/#" target="_blank">MSN ▼</a></p>
</li>
<li><p><a href="http://g.live.com/9uxp9msn/mhm-en-us??su=http://shared.live.com/Live.Spaces" target="_blank">Home</a></p>
</li>
<li><a href="http://g.live.com/9uxp9msn/mau-en-us??su=http://shared.live.com/Live.Spaces" target="_blank">Autos</a></li>
<li><a href="http://g.live.com/9uxp9msn/mga-en-us??su=http://shared.live.com/Live.Spaces" target="_blank">Games</a></li>
<li><a href="http://g.live.com/9uxp9msn/mmo-en-us??su=http://shared.live.com/Live.Spaces" target="_blank">Money</a></li>
<li><a href="http://g.live.com/9uxp9msn/mmv-en-us??su=http://shared.live.com/Live.Spaces" target="_blank">Movies</a></li>
<li><a href="http://g.live.com/9uxp9msn/mmu-en-us??su=http://shared.live.com/Live.Spaces" target="_blank">Music</a></li>
<li><a href="http://g.live.com/9uxp9msn/mnw-en-us??su=http://shared.live.com/Live.Spaces" target="_blank">News</a></li>
<li><a href="http://g.live.com/9uxp9msn/msp-en-us??su=http://shared.live.com/Live.Spaces" target="_blank">Sports</a></li>
<li><p><a href="http://g.live.com/9uxp9msn/mwe-en-us??su=http://shared.live.com/Live.Spaces" target="_blank">Weather</a>
Search People or web</p>
</li>
<li><p><a href="http://x-spirit.spaces.live.com/mmm2009-09-01_09.47/#" target="_blank">Search People</a></p>
</li>
<li><a href="http://x-spirit.spaces.live.com/mmm2009-09-01_09.47/#" target="_blank">Search the web</a>
<a href="http://x-spirit.spaces.live.com/mmm2009-09-01_09.47/#" target="_blank"><img src="&quot;Search&quot;" alt="Search"></a>
<a href="http://login.live.com/login.srf?wa=wsignin1.0&amp;rpsnv=11&amp;ct=1269518164&amp;rver=5.5.4177.0&amp;wp=MBI&amp;wreply=http:%2F%2Fx-spirit.spaces.live.com%2Fblog%2Fcns!CC0B04AE126337C0!844.entry%3F&amp;lc=1033&amp;id=73625&amp;mkt=en-US" target="_blank">Sign in</a><a href="http://login.live.com/login.srf?wa=wsignin1.0&amp;rpsnv=11&amp;ct=1269518164&amp;rver=5.5.4177.0&amp;wp=MBI&amp;wreply=http:%2F%2Fx-spirit.spaces.live.com%2Fblog%2Fcns!CC0B04AE126337C0!844.entry%3F&amp;lc=1033&amp;id=73625&amp;mkt=en-US" target="_blank"><img src="" alt=""></a></li>
</ul>
<p><a href="http://cid-cc0b04ae126337c0.profile.live.com/" target="_blank">威&#39;s profile</a><a href="http://x-spirit.spaces.live.com/default.aspx" target="_blank">X-Spirit</a><a href="http://cid-cc0b04ae126337c0.skydrive.live.com/albums.aspx" target="_blank">Photos</a><a href="http://x-spirit.spaces.live.com/blog/" target="_blank">Blog</a><a href="http://cid-cc0b04ae126337c0.profile.live.com/Lists/" target="_blank">Lists</a><a href="http://x-spirit.spaces.live.com/" target="_blank">More <img src="" alt=""></a></p>
<ul>
<li><a href="http://x-spirit.spaces.live.com/guestbook/" target="_blank">Guestbook</a></li>
<li><p><a href="http://people.live.com/?rru=friends%3fcid%3dcc0b04ae126337c0" target="_blank">Network</a>
<a href="http://x-spirit.spaces.live.com/" target="_blank"><img src="" alt=""> Tools <img src="" alt=""></a></p>
</li>
<li><p><a href="http://spaces.live.com/api.aspx?wx_action=sendMessage&amp;wxp_toCid=-3743893519549122624&amp;wx_ru=http%3a%2f%2fx-spirit.spaces.live.com%2fblog%2fcns!CC0B04AE126337C0!844.entry" target="_blank">Send a private message</a></p>
</li>
<li><a href="http://cid-cc0b04ae126337c0.users.api.live.net/Users(-3743893519549122624" target="_blank">Subscribe to RSS feed</a>/Main?$format=rss20)</li>
<li><a href="mailto:?subject=http://x-spirit.spaces.live.com/&amp;body=http://x-spirit.spaces.live.com/">Tell a friend</a></li>
<li><a href="http://my.msn.com/addtomymsn.armx?id=rss&amp;ut=http%3a%2f%2fcid-cc0b04ae126337c0.users.api.live.net%2fUsers%28-3743893519549122624%29%2fMain%3f%24format%3drss20&amp;ru=http%3a%2f%2fx-spirit.spaces.live.com%2f" target="_blank">Add to My MSN</a></li>
<li><a href="http://www.live.com/?add=http://cid-cc0b04ae126337c0.users.api.live.net/Users(-3743893519549122624" target="_blank">Add to Live.com</a>/Main?$format=rss20)</li>
<li><a href="http://profile.live.com/connect/send.aspx?cid=0xcc0b04ae126337c0&amp;scontext=0&amp;name=&amp;ru=http%3a%2f%2fx-spirit.spaces.live.com%2fblog%2fcns%21CC0B04AE126337C0%21844.entry" target="_blank">Add to your network</a></li>
<li><a href="http://signup.alerts.live.com/alerts/userSignup.do?partner=spaces&amp;ut=http://x-spirit.spaces.live.com/feed.rss&amp;mkt=en-us&amp;returnURL=http%3a%2f%2fx-spirit.spaces.live.com%2fblog%2fcns!CC0B04AE126337C0!844.entry" target="_blank">Sign up for alerts</a>
<a href="http://x-spirit.spaces.live.com/mmm2009-09-01_09.47/#" target="_blank">Help</a></li>
</ul>
<h2 id="blog">Blog</h2>
<ul>
<li>[<img src="" alt=""></li>
</ul>
<p>Entries
](<a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart" target="_blank">http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart</a>)</p>
<ul>
<li>[<img src="" alt=""></li>
</ul>
<p>Summary
](<a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=summary&amp;_c=BlogPart" target="_blank">http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=summary&amp;_c=BlogPart</a>)
Listed by:  Date Category</p>
<ul>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d3%26ayear%3d2010" title="View all entries published during this time period" target="_blank">March 2010</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d2%26ayear%3d2010" title="View all entries published during this time period" target="_blank">February 2010</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d1%26ayear%3d2010" title="View all entries published during this time period" target="_blank">January 2010</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d12%26ayear%3d2009" title="View all entries published during this time period" target="_blank">December 2009</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d11%26ayear%3d2009" title="View all entries published during this time period" target="_blank">November 2009</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d10%26ayear%3d2009" title="View all entries published during this time period" target="_blank">October 2009</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d9%26ayear%3d2009" title="View all entries published during this time period" target="_blank">September 2009</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d8%26ayear%3d2009" title="View all entries published during this time period" target="_blank">August 2009</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d7%26ayear%3d2009" title="View all entries published during this time period" target="_blank">July 2009</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d6%26ayear%3d2009" title="View all entries published during this time period" target="_blank">June 2009</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d5%26ayear%3d2009" title="View all entries published during this time period" target="_blank">May 2009</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d4%26ayear%3d2009" title="View all entries published during this time period" target="_blank">April 2009</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d3%26ayear%3d2009" title="View all entries published during this time period" target="_blank">March 2009</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d2%26ayear%3d2009" title="View all entries published during this time period" target="_blank">February 2009</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d1%26ayear%3d2009" title="View all entries published during this time period" target="_blank">January 2009</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d12%26ayear%3d2008" title="View all entries published during this time period" target="_blank">December 2008</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d11%26ayear%3d2008" title="View all entries published during this time period" target="_blank">November 2008</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d10%26ayear%3d2008" title="View all entries published during this time period" target="_blank">October 2008</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d9%26ayear%3d2008" title="View all entries published during this time period" target="_blank">September 2008</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d8%26ayear%3d2008" title="View all entries published during this time period" target="_blank">August 2008</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d7%26ayear%3d2008" title="View all entries published during this time period" target="_blank">July 2008</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d6%26ayear%3d2008" title="View all entries published during this time period" target="_blank">June 2008</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d5%26ayear%3d2008" title="View all entries published during this time period" target="_blank">May 2008</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d4%26ayear%3d2008" title="View all entries published during this time period" target="_blank">April 2008</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d3%26ayear%3d2008" title="View all entries published during this time period" target="_blank">March 2008</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d2%26ayear%3d2008" title="View all entries published during this time period" target="_blank">February 2008</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d1%26ayear%3d2008" title="View all entries published during this time period" target="_blank">January 2008</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d12%26ayear%3d2007" title="View all entries published during this time period" target="_blank">December 2007</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d11%26ayear%3d2007" title="View all entries published during this time period" target="_blank">November 2007</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d10%26ayear%3d2007" title="View all entries published during this time period" target="_blank">October 2007</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d9%26ayear%3d2007" title="View all entries published during this time period" target="_blank">September 2007</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d8%26ayear%3d2007" title="View all entries published during this time period" target="_blank">August 2007</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d7%26ayear%3d2007" title="View all entries published during this time period" target="_blank">July 2007</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d6%26ayear%3d2007" title="View all entries published during this time period" target="_blank">June 2007</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d5%26ayear%3d2007" title="View all entries published during this time period" target="_blank">May 2007</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d4%26ayear%3d2007" title="View all entries published during this time period" target="_blank">April 2007</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d3%26ayear%3d2007" title="View all entries published during this time period" target="_blank">March 2007</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d2%26ayear%3d2007" title="View all entries published during this time period" target="_blank">February 2007</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d1%26ayear%3d2007" title="View all entries published during this time period" target="_blank">January 2007</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d12%26ayear%3d2006" title="View all entries published during this time period" target="_blank">December 2006</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d11%26ayear%3d2006" title="View all entries published during this time period" target="_blank">November 2006</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d10%26ayear%3d2006" title="View all entries published during this time period" target="_blank">October 2006</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d9%26ayear%3d2006" title="View all entries published during this time period" target="_blank">September 2006</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d8%26ayear%3d2006" title="View all entries published during this time period" target="_blank">August 2006</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d7%26ayear%3d2006" title="View all entries published during this time period" target="_blank">July 2006</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d6%26ayear%3d2006" title="View all entries published during this time period" target="_blank">June 2006</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d5%26ayear%3d2006" title="View all entries published during this time period" target="_blank">May 2006</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d4%26ayear%3d2006" title="View all entries published during this time period" target="_blank">April 2006</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d3%26ayear%3d2006" title="View all entries published during this time period" target="_blank">March 2006</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d2%26ayear%3d2006" title="View all entries published during this time period" target="_blank">February 2006</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d1%26ayear%3d2006" title="View all entries published during this time period" target="_blank">January 2006</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d12%26ayear%3d2005" title="View all entries published during this time period" target="_blank">December 2005</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d11%26ayear%3d2005" title="View all entries published during this time period" target="_blank">November 2005</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d10%26ayear%3d2005" title="View all entries published during this time period" target="_blank">October 2005</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d9%26ayear%3d2005" title="View all entries published during this time period" target="_blank">September 2005</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d8%26ayear%3d2005" title="View all entries published during this time period" target="_blank">August 2005</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d7%26ayear%3d2005" title="View all entries published during this time period" target="_blank">July 2005</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d6%26ayear%3d2005" title="View all entries published during this time period" target="_blank">June 2005</a></li>
<li><a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=amonth%3d5%26ayear%3d2005" title="View all entries published during this time period" target="_blank">May 2005</a> *    <a href="http://x-spirit.spaces.live.com/blog/cns!CC0B04AE126337C0!829.entry" title="Go to: Linux下面利用crontab来实现mysql数据库的定时备份" target="_blank">&lt; Previous</a>   <a href="http://x-spirit.spaces.live.com/blog/cns!CC0B04AE126337C0!845.entry" title="Go to: Oracle数据库导入命令，导出换成exp就可以了" target="_blank">Next &gt;</a></li>
</ul>
<p>Sorry, your entry can&#39;t be deleted right now. Please try again later.</p>
<p>January 25</p>
<h3 id="oracle-not-in-">Oracle not in查不到应有的结果</h3>
<p>首先我要感谢aa和Liu Xing帮我发现了我日志中的错误。之前比较粗心，把3条SQL语句写成一样的了，对于给读者造成的麻烦，我深表抱歉。
今天我把原文做了修订，为了对得起读者对我的关注，我重新深入的研究了这个问题，在后面，我会把来龙去脉写清楚。
<em>问题：
语句1：
</em></p>
<p><em>Select /</em> from  table1 A where A.col1 not in ( select col1 from table2 B )
<em>
</em>如果这样，本来应该有一条数据，结果没有。
如果我改写成这样：
语句2：
*</p>
<p><em>select /</em> from table1 A where not exists (SELECT /<em> FROM table2 B where B.col1 = A.col1)</em>
<em>结果就正确，有一条数据显示。
经过一番搜索，原以为是子查询结果集太大的原因。</em> <em>后来有网上强人指点：子查询里面有空集。即子查询的结果集里面有NULL的结果。</em> <em>把查询语句修改成：**语句3：
</em></p>
<p><em>Select /</em> from  table1 A where A.col1 not in ( select col1 from table2 B where B.col1 is not null )
<em>
</em>果然就查出来了。而且一点不差。。。厉害阿～～～<em>
下面是针对本文题的分析：
1。 首先来说说Oracle中的NULL。
Oracle中的NULL代表的是无意义，或者没有值。将NULL和其他的值进行逻辑运算，运算过程中，NULL的表现更象是FALSE。
下面请看真值表：
 AND NULL
  OR NULL  TRUE  NULL  TRUE  FALSE  FALSE  NULL  NULL  NULL
  NULL
另外，NULL和其他的值进行比较或者算术运算（&lt;、&gt;、=、!=、+、-、/</em>、/），结果仍是NULL。
如果想要判定某个值是否为NULL，可以用IS NULL或者IS NOT NULL。</p>
<ol>
<li>再来说说Oracle中的IN。
in是一个成员条件, 对于给定的一个集合或者子查询,它会比较每一个成员值。
IN功能上相当于 =ANY 的操作，而NOT IN 功能上相当于 !=ALL 的操作。
IN在逻辑上实际上就是对给定的成员集合或者子查询结果集进行逐条的判定，例如：
SELECT /<em> FROM table1 A WHERE A.col1 in (20,50,NULL);实际上就是执行了
SELECT /</em> FROM table1 A WHERE A.col1=20 OR A.col1=50 OR A.col1=NULL;这样，根据NULL的运算特点和真值表，我们可以看出，上边这个WHERE 字句可以被简化(如果返回NULL则无结果集返回，这一点和FALSE是一样的)为
WHERE A.col1=20 OR A.col1=50也就是说，如果你的table1中真的存在含有NULL值的col1列，则执行该语句，无法查询出那些值为null的记录。
再来看看NOT IN。根据逻辑运算关系，我们知道，NOT (X=Y OR N=M) 等价于 X!=Y AND N!=M，那么：
SELECT /<em> FROM table1 A WHERE A.col1 not in (20,50,NULL)等价于
SELECT /</em> FROM table1 A WHERE A.col1!=20 AND A.col1!=50 AND A.col1!=NULL根据NULL的运算特性和真值表，该语句无论前两个判定条件是否为真，其结果一定是NULL或者FALSE。故绝对没有任何记录可以返回。
这就是为什么语句1查不到应有结果的原因。当然，如果你用NOT IN的时候，预先在子查询里把NULL去掉的话，那就没问题了，例如语句3。
有些童鞋可能要问了：那如果我想把A表里面那些和B表一样col1列的值一样的记录都查出来，即便A、B两表里面的col1列都包括值为NULL的记录的话，用这一条语句就没办法了吗？
我只能很遗憾的告诉你，如果你想在WHERE后面单纯用IN 似乎不太可能了，当然，你可以在外部的查询语句中将NULL条件并列进去，例如：
SELECT /* FROM table1 A WHERE A.col1 in (SELECT B.col1 FROM table2 B) OR A.col1 IS NULL;</li>
<li>最后谈谈EXISTS。
有人说EXISTS的性能比IN要好。但这是很片面的。我们来看看EXISTS的执行过程：
select /<em> from t1 where exists ( select /</em> from t2 where t2.col1 = t1.col1 )相当于：
for x in ( select /<em> from t1 )
loop
   if ( exists ( select /</em> from t2 where t2.col1 = x.col1 )
   then<pre><code>  OUTPUT THE RECORD in x
</code></pre>   end if
end loop
也就是说，EXISTS语句实际上是通过循环外部查询的结果集，来过滤出符合子查询标准的结果集。于是外部查询的结果集数量对该语句执行性能影响最大，故如果外部查询的结果集数量庞大，用EXISTS语句的性能也不一定就会好很多。
当然，有人说NOT IN是对外部查询和子查询都做了全表扫描，如果有索引的话，还用不上索引，但是NOT EXISTS是做连接查询，所以，如果连接查询的两列都做了索引，性能会有一定的提升。
当然至于实际的查询效率，我想还是具体情况具体分析吧。
那么我们不妨来分析一下语句2为什么能够的到正确的结果吧：
语句2是这样的：**</li>
</ol>
<p><em>select /</em> from table1 A where not exists (SELECT B.col1 FROM table2 B where B.col1 = A.col1)<em>
实际上是这样的执行过程：
for x in ( select /</em> from table1 A )
   loop
      if (not exists ( select /<em> from table2 B where B.col1 = x.col1 )
      then
         OUTPUT THE RECORD in x
      end if
end loop
由于表A中不包含NULL的记录，所以，遍历完表A，也只能挑出表A中独有的记录。
这就是为什么语句2能够完成语句3的任务的原因。
但如果表A中存在NULL记录而表B中不存在呢？
这个问题请大家自己分析吧。哈哈。有答案了可以给我留言哦。
答案：A表中的NULL也会被查出来。因为select /</em> from table2 B where B.col1 = NULL不返回结果，故
not exists ( select /* from table2 B where B.col1 = x.col1 )的值为真。
以上SQL运行结果在MySQL和Oracle上都已经通过。</p>
<p>11:33 AM | <a href="&quot;Blog about this entry in your space&quot;">Blog it</a> | <a href="http://x-spirit.spaces.live.com/?_c11_BlogPart_BlogPart=blogview&amp;_c=BlogPart&amp;partqs=cat%3d%25e8%25ae%25a1%25e7%25ae%2597%25e6%259c%25ba%25e4%25b8%258e%2520Internet" title="Show all entries for this category" target="_blank">计算机与 Internet</a></p>
<p><a href=""></a><a href="http://x-spirit.spaces.live.com/mmm2009-09-01_09.47/#"></a></p>
<h3 id="comments-1-">Comments (1)</h3>
<p>Please wait...</p>
<p>Sorry, the comment you entered is too long. Please shorten it.
You didn&#39;t enter anything. Please try again.</p>
<p>Sorry, we can&#39;t add your comment right now. Please try again later.
To add a comment, you need permission from your parent. <a href="https://fss.live.com/krl/AddContact.aspx?Rurl=http%3a%2f%2fx-spirit.spaces.live.com%2fblog%2fcns%21CC0B04AE126337C0%21844.entry%23comment" target="_blank">Ask for permission</a></p>
<p>Your parent has turned off comments.
Sorry, we can&#39;t delete your comment right now. Please try again later.</p>
<p>You&#39;ve exceeded the maximum number of comments that can be left in one day. Please try again in 24 hours.
Your account has had the ability to leave comments disabled because our systems indicate that you may be spamming other users. If you believe that your account has been disabled in error please contact <a href="http://support.live.com/eform.aspx?productKey=wlspaces&amp;ct=eformts" target="_blank">Windows Live support</a>.</p>
<p>Complete the security check below to finish leaving your comment.
The characters you type in the security check must match the characters in the picture or audio.
To add a comment, sign in with your Windows Live ID (if you use Hotmail, Messenger, or Xbox LIVE, you have a Windows Live ID). <a href="http://login.live.com/login.srf?wa=wsignin1.0&amp;rpsnv=11&amp;ct=1269518164&amp;rver=5.5.4177.0&amp;wp=MBI&amp;wreply=http:%2F%2Fx-spirit.spaces.live.com%2Fblog%2Fcns!CC0B04AE126337C0!844.entry&amp;lc=1033&amp;id=73625" target="_blank">Sign in</a></p>
<p>Don&#39;t have a Windows Live ID? <a href="https://signup.live.com/signup.aspx?ID=62862&amp;mkt=en-US&amp;RU=http%3a%2f%2fx-spirit.spaces.live.com%2fblog%2fcns%21CC0B04AE126337C0%21844.entry&amp;RX=http%3a%2f%2fx-spirit.spaces.live.com%2fblog%2fcns%21CC0B04AE126337C0%21844.entry&amp;cp=1" target="_blank">Sign up</a> <a href="http://cid-09e46a4d043ff077.profile.live.com/" title="Picture of Xing Liu" target="_blank"><img src="" alt="Picture of Xing Liu"></a></p>
<p><img src="" alt="Picture of Xing Liu"> <a href="http://cid-09e46a4d043ff077.profile.live.com/" title="Xing Liu" target="_blank">Xing Liu</a>wrote:</p>
<p>这几个命令行怎么都一样啊?</p>
<p>Feb. 11</p>
<h3 id="trackbacks">Trackbacks</h3>
<p>The trackback URL for this entry is:</p>
<p><a href="http://x-spirit.spaces.live.com/blog/cns!CC0B04AE126337C0!844.trak" target="_blank">http://x-spirit.spaces.live.com/blog/cns!CC0B04AE126337C0!844.trak</a>
Weblogs that reference this entry</p>
<ul>
<li>None</li>
<li><a href="http://g.live.com/9uxp9en-us/ftr1" target="_blank">© 2010 Microsoft</a></li>
<li><a href="http://go.microsoft.com/fwlink/?LinkId=74170" target="_blank">Privacy</a></li>
<li><a href="http://g.msn.com/0TO_/enus" target="_blank">Terms of use</a><ul>
<li><a href="http://help.live.com/help.aspx?mkt=en-us&amp;project=tou&amp;querytype=keyword&amp;query=coc" target="_blank">Code of Conduct</a></li>
</ul>
</li>
<li><a href="http://support.live.com/default.aspx?productKey=WLSpacesAbuse" target="_blank">Report Abuse</a></li>
<li><a href="http://help.live.com/help.aspx?mkt=en-us&amp;project=WL_Spacesv3&amp;querytype=keyword&amp;query=spitpot&amp;format=b1" target="_blank">Safety</a></li>
<li><a href="http://g.live.com/9uxp9en-us/ftr3" target="_blank">Account</a></li>
<li><a href="http://g.live.com/9uxp9en-us/ftr4?productkey=WLSpaces" target="_blank">Feedback</a>    <img src="" alt=""><img src="" alt=""></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/oracle/">oracle</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/oracle/" class="label label-success">oracle</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:34"datetime="2014-03-07 09:54:34"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-oracle--Oraclenotin查不到应有的结果2/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-oracle--Oraclenotin查不到应有的结果2" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-oracle--SQLLoader学习小记命令行参考/">SQL Loader学习小记(命令行参考)</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:34.000Z"> <a href="/2014/02/02/2014-02-02-DB-oracle--SQLLoader学习小记命令行参考/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="sql-loader-">SQL Loader学习小记(命令行参考)</h1>
<p>SQL Loader 命令行参考
   Command line Sample:
   SQLLDR CONTROL=sample.ctl, LOG=sample.log, BAD=baz.bad, DATA=etc.dat
   USERID=scott/tiger, ERRORS=999, LOAD=2000, DISCARD=toss.dsc,
   DISCARDMAX=5
   常用的keywords:
userid     -- orACLE username/password
control    -- control file name
log        -- log file name
bad        -- bad file name
data       -- data file name
discard    -- discard file name
discardmax -- number of discards to allow (Default all)
skip       -- number of logical records to skip (Default 0)
load       -- number of logical records to load (Default all)
errors     -- number of errors to allow (Default 50)(允许出错的记录数)
rows       -- number of rows in conventional path bind array or between direct path data saves
               (Default: Conventional path 64, Direct path all)(每次提交的记录数)
bindsize   -- size of conventional path bind array in bytes (Default 256000)
silent     -- suppress messages during run (header,feedback,errors,discards,partitions)(是否显示load信息)
direct     -- use direct path (Default FALSE)
parfile    -- parameter file: name of file that contains parameter specifications
parallel   -- do parallel load (Default FALSE)
file       -- file to allocate extents from
skip_unusable_indexes  -- disallow/allow unusable indexes or index partitions(Default FALSE)
skip_index_maintenance -- do not maintain indexes, mark affected indexes as unusable (Default FALSE)
commit_discontinued    -- commit loaded rows when load is discontinued (Default FALSE)
readsize           -- size of read buffer (Default 1048576)
external_table     -- use external table for load; NOT_USED, GENERATE_ONLY, EXECUTE (Default NOT_USED)
columnarrayrows    -- number of rows for direct path column array (Default 5000)
streamsize         -- size of direct path stream buffer in bytes (Default 256000)
multithreading     -- use multithreading in direct path
resumable          -- enable or disable resumable for current session (Default FALSE)
resumable_name     -- text string to help identify resumable statement
resumable_timeout  -- wait time (in seconds) for RESUMABLE (Default 7200)
date_cache         -- size (in entries) of date conversion cache (Default 1000)
    上述大部分的参数定义可以入在control file中的option里。
    执行结果返回代码
All rows loaded successfully      EX_SUCC
All or some rows rejected      EX_WARN
All or some rows discarded      EX_WARN
Discontinued load EX_WARN
Command-line or syntax errors      EX_FAIL
oracle errors nonrecoverable for SQL/*Loader    EX_FAIL
Operating system errors (such as file open/close and malloc)  EX_FAIL
    For UNIX, the exit codes are as follows:
EX_SUCC 0
EX_FAIL 1
EX_WARN 2
EX_FTL  3</p>
<p>来源： <a href="[http://www.wudongqi.com/article/540.htm](http://www.wudongqi.com/article/540.htm)">[http://www.wudongqi.com/article/540.htm](http://www.wudongqi.com/article/540.htm)</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/oracle/">oracle</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/oracle/" class="label label-success">oracle</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:34"datetime="2014-03-07 09:54:34"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-oracle--SQLLoader学习小记命令行参考/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-oracle--SQLLoader学习小记命令行参考" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB--面向程序员的数据库访问性能优化法则-数据库/">面向程序员的数据库访问性能优化法则</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:34.000Z"> <a href="/2014/02/02/2014-02-02-DB--面向程序员的数据库访问性能优化法则-数据库/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">面向程序员的数据库访问性能优化法则-数据库</h1>
<pre><code>      面向程序员的数据库访问性能优化法则   火龙果软件    发布于 2013-8-28   引言
</code></pre><p>在网上有很多文章介绍数据库优化知识，但是大部份文章只是对某个一个方面进行说明，而对于我们程序员来说这种介绍并不能很好的掌握优化知识，因为很多介绍只是对一些特定的场景优化的，所以反而有时会产生误导或让程序员感觉不明白其中的奥妙而对数据库优化感觉很神秘。</p>
<p>很多程序员总是问如何学习数据库优化，有没有好的教材之类的问题。在书店也看到了许多数据库优化的专业书籍，但是感觉更多是面向DBA或者是PL/SQL开发方面的知识，个人感觉不太适合普通程序员。而要想做到数据库优化的高手，不是花几周，几个月就能达到的，这并不是因为数据库优化有多高深，而是因为要做好优化一方面需要有非常好的技术功底，对操作系统、存储硬件网络、数据库原理等方面有比较扎实的基础知识，另一方面是需要花大量时间对特定的数据库进行实践测试与总结。</p>
<p>作为一个程序员，我们也许不清楚线上正式的服务器硬件配置，我们不可能像DBA那样专业的对数据库进行各种实践测试与总结，但我们都应该非常了解我们SQL的业务逻辑，我们清楚SQL中访问表及字段的数据情况，我们其实只关心我们的SQL是否能尽快返回结果。那程序员如何利用已知的知识进行数据库优化？如何能快速定位SQL性能问题并找到正确的优化方向？</p>
<p>面对这些问题，笔者总结了一些面向程序员的基本优化法则，本文将结合实例来坦述数据库开发的优化知识。</p>
<p>一、数据库访问优化法则简介</p>
<p>要正确的优化SQL，我们需要快速定位能性的瓶颈点，也就是说快速找到我们SQL主要的开销在哪里？而大多数情况性能最慢的设备会是瓶颈点，如下载时网络速度可能会是瓶颈点，本地复制文件时硬盘可能会是瓶颈点，为什么这些一般的工作我们能快速确认瓶颈点呢，因为我们对这些慢速设备的性能数据有一些基本的认识，如网络带宽是2Mbps，硬盘是每分钟7200转等等。因此，为了快速找到SQL的性能瓶颈点，我们也需要了解我们计算机系统的硬件基本性能指标，下图展示的当前主流计算机性能指标数据。</p>
<p><img src="" alt=""></p>
<p>从图上可以看到基本上每种设备都有两个指标：</p>
<p>延时（响应时间）：表示硬件的突发处理能力；</p>
<p>带宽（吞吐量）：代表硬件持续处理能力。</p>
<p>从上图可以看出，计算机系统硬件性能从高到代依次为：</p>
<p>CPU——Cache(L1-L2-L3)——内存——SSD硬盘——网络——硬盘</p>
<p>由于SSD硬盘还处于快速发展阶段，所以本文的内容不涉及SSD相关应用系统。</p>
<p>根据数据库知识，我们可以列出每种硬件主要的工作内容：</p>
<p>CPU及内存：缓存数据访问、比较、排序、事务检测、SQL解析、函数或逻辑运算；</p>
<p>网络：结果数据传输、SQL请求、远程数据库访问（dblink）；</p>
<p>硬盘：数据访问、数据写入、日志记录、大数据量排序、大表连接。</p>
<p>根据当前计算机硬件的基本性能指标及其在数据库中主要操作内容，可以整理出如下图所示的性能基本优化法则：</p>
<p><img src="" alt=""></p>
<p>这个优化法则归纳为5个层次：</p>
<p>1、 减少数据访问（减少磁盘访问）</p>
<p>2、 返回更少数据（减少网络传输或磁盘访问）</p>
<p>3、 减少交互次数（减少网络传输）</p>
<p>4、 减少服务器CPU开销（减少CPU及内存开销）</p>
<p>5、 利用更多资源（增加资源）</p>
<p>由于每一层优化法则都是解决其对应硬件的性能问题，所以带来的性能提升比例也不一样。传统数据库系统设计是也是尽可能对低速设备提供优化方法，因此针对低速设备问题的可优化手段也更多，优化成本也更低。我们任何一个SQL的性能优化都应该按这个规则由上到下来诊断问题并提出解决方案，而不应该首先想到的是增加资源解决问题。</p>
<p>以下是每个优化法则层级对应优化效果及成本经验参考：</p>
<p><img src="" alt=""></p>
<p>接下来，我们针对5种优化法则列举常用的优化手段并结合实例分析。</p>
<p>二、Oracle数据库两个基本概念</p>
<p>数据块(Block)</p>
<p>数据块是数据库中数据在磁盘中存储的最小单位，也是一次IO访问的最小单位，一个数据块通常可以存储多条记录，数据块大小是DBA在创建数据库或表空间时指定，可指定为2K、4K、8K、16K或32K字节。下图是一个Oracle数据库典型的物理结构，一个数据库可以包括多个数据文件，一个数据文件内又包含多个数据块；</p>
<p><img src="" alt=""></p>
<p>ROWID</p>
<p>ROWID是每条记录在数据库中的唯一标识，通过ROWID可以直接定位记录到对应的文件号及数据块位置。ROWID内容包括文件号、对像号、数据块号、记录槽号，如下图所示：</p>
<p><img src="" alt=""></p>
<p>三、数据库访问优化法则详解</p>
<p>1、减少数据访问</p>
<p>1.1、创建并使用正确的索引</p>
<p>数据库索引的原理非常简单，但在复杂的表中真正能正确使用索引的人很少，即使是专业的DBA也不一定能完全做到最优。</p>
<p>索引会大大增加表记录的DML(INSERT,UPDATE,DELETE)开销，正确的索引可以让性能提升100，1000倍以上，不合理的索引也可能会让性能下降100倍，因此在一个表中创建什么样的索引需要平衡各种业务需求。
索引常见问题：</p>
<p>索引有哪些种类？</p>
<p>常见的索引有B-TREE索引、位图索引、全文索引，位图索引一般用于数据仓库应用，全文索引由于使用较少，这里不深入介绍。B-TREE索引包括很多扩展类型，如组合索引、反向索引、函数索引等等，以下是B-TREE索引的简单介绍：</p>
<p>B-TREE索引也称为平衡树索引(Balance Tree)，它是一种按字段排好序的树形目录结构，主要用于提升查询性能和唯一约束支持。B-TREE索引的内容包括根节点、分支节点、叶子节点。</p>
<p>叶子节点内容：索引字段内容+表记录ROWID</p>
<p>根节点，分支节点内容：当一个数据块中不能放下所有索引字段数据时，就会形成树形的根节点或分支节点，根节点与分支节点保存了索引树的顺序及各层级间的引用关系。</p>
<p>一个普通的BTREE索引结构示意图如下所示：</p>
<p><img src="" alt=""></p>
<p>如果我们把一个表的内容认为是一本字典，那索引就相当于字典的目录，如下图所示：</p>
<p><img src="" alt=""></p>
<p><img src="" alt=""></p>
<p>图中是一个字典按部首+笔划数的目录，相当于给字典建了一个按部首+笔划的组合索引。</p>
<p>一个表中可以建多个索引，就如一本字典可以建多个目录一样（按拼音、笔划、部首等等）。</p>
<p>一个索引也可以由多个字段组成，称为组合索引，如上图就是一个按部首+笔划的组合目录。</p>
<p><strong>SQL什么条件会使用索引？</strong></p>
<p>当字段上建有索引时，通常以下情况会使用索引：</p>
<p>INDEX_COLUMN = ?</p>
<p>INDEX_COLUMN &gt; ?</p>
<p>INDEX_COLUMN &gt;= ?</p>
<p>INDEX_COLUMN &lt; ?</p>
<p>INDEX_COLUMN &lt;= ?</p>
<p>INDEX_COLUMN between ? and ?</p>
<p>INDEX_COLUMN in (?,?,...,?)</p>
<p>INDEX_COLUMN like ?||&#39;%&#39;（后导模糊查询）</p>
<p>T1. INDEX_COLUMN=T2. COLUMN1（两个表通过索引字段关联）</p>
<p><strong>SQL什么条件不会使用索引？</strong></p>
<p><img src="" alt=""></p>
<p>我们一般在什么字段上建索引？</p>
<p>这是一个非常复杂的话题，需要对业务及数据充分分析后再能得出结果。主键及外键通常都要有索引，其它需要建索引的字段应满足以下条件：</p>
<p>1、字段出现在查询条件中，并且查询条件可以使用索引；</p>
<p>2、语句执行频率高，一天会有几千次以上；</p>
<p>3、通过字段条件可筛选的记录集很小，那数据筛选比例是多少才适合？</p>
<p>这个没有固定值，需要根据表数据量来评估，以下是经验公式，可用于快速评估：</p>
<p>小表(记录数小于10000行的表)：筛选比例&lt;10%；</p>
<p>大表：(筛选返回记录数)&lt;(表总记录数/*单条记录长度)/10000/16</p>
<p>单条记录长度≈字段平均内容长度之和+字段数/*2</p>
<p>以下是一些字段是否需要建B-TREE索引的经验分类：</p>
<p><img src="" alt=""></p>
<p><strong>如何知道SQL是否使用了正确的索引？</strong></p>
<p>简单SQL可以根据索引使用语法规则判断，复杂的SQL不好办，判断SQL的响应时间是一种策略，但是这会受到数据量、主机负载及缓存等因素的影响，有时数据全在缓存里，可能全表访问的时间比索引访问时间还少。要准确知道索引是否正确使用，需要到数据库中查看SQL真实的执行计划，这个话题比较复杂，详见SQL执行计划专题介绍。</p>
<p>索引对DML(INSERT,UPDATE,DELETE)附加的开销有多少？</p>
<p>这个没有固定的比例，与每个表记录的大小及索引字段大小密切相关，以下是一个普通表测试数据，仅供参考：</p>
<p>索引对于Insert性能降低56%</p>
<p>索引对于Update性能降低47%</p>
<p>索引对于Delete性能降低29%</p>
<p>因此对于写IO压力比较大的系统，表的索引需要仔细评估必要性，另外索引也会占用一定的存储空间。</p>
<p>1.2、只通过索引访问数据</p>
<p>有些时候，我们只是访问表中的几个字段，并且字段内容较少，我们可以为这几个字段单独建立一个组合索引，这样就可以直接只通过访问索引就能得到数据，一般索引占用的磁盘空间比表小很多，所以这种方式可以大大减少磁盘IO开销。</p>
<p>如：select id,name from company where type=&#39;2&#39;;</p>
<p>如果这个SQL经常使用，我们可以在type,id,name上创建组合索引</p>
<p>create index my_comb_index on company(type,id,name);</p>
<p>有了这个组合索引后，SQL就可以直接通过my_comb_index索引返回数据，不需要访问company表。</p>
<p>还是拿字典举例：有一个需求，需要查询一本汉语字典中所有汉字的个数，如果我们的字典没有目录索引，那我们只能从字典内容里一个一个字计数，最后返回结果。如果我们有一个拼音目录，那就可以只访问拼音目录的汉字进行计数。如果一本字典有1000页，拼音目录有20页，那我们的数据访问成本相当于全表访问的50分之一。</p>
<p>切记，性能优化是无止境的，当性能可以满足需求时即可，不要过度优化。在实际数据库中我们不可能把每个SQL请求的字段都建在索引里，所以这种只通过索引访问数据的方法一般只用于核心应用，也就是那种对核心表访问量最高且查询字段数据量很少的查询。</p>
<p>1.3、优化SQL执行计划</p>
<p>SQL执行计划是关系型数据库最核心的技术之一，它表示SQL执行时的数据访问算法。由于业务需求越来越复杂，表数据量也越来越大，程序员越来越懒惰，SQL也需要支持非常复杂的业务逻辑，但SQL的性能还需要提高，因此，优秀的关系型数据库除了需要支持复杂的SQL语法及更多函数外，还需要有一套优秀的算法库来提高SQL性能。</p>
<p>目前ORACLE有SQL执行计划的算法约300种，而且一直在增加，所以SQL执行计划是一个非常复杂的课题，一个普通DBA能掌握50种就很不错了，就算是资深DBA也不可能把每个执行计划的算法描述清楚。虽然有这么多种算法，但并不表示我们无法优化执行计划，因为我们常用的SQL执行计划算法也就十几个，如果一个程序员能把这十几个算法搞清楚，那就掌握了80%的SQL执行计划调优知识。</p>
<p>由于篇幅的原因，SQL执行计划需要专题介绍，在这里就不多说了。</p>
<p>2、返回更少的数据</p>
<p>2.1、数据分页处理</p>
<p>一般数据分页方式有：</p>
<p><strong>2.1.1、客户端(应用程序或浏览器)分页</strong></p>
<p>将数据从应用服务器全部下载到本地应用程序或浏览器，在应用程序或浏览器内部通过本地代码进行分页处理</p>
<p>优点：编码简单，减少客户端与应用服务器网络交互次数</p>
<p>缺点：首次交互时间长，占用客户端内存</p>
<p>适应场景：客户端与应用服务器网络延时较大，但要求后续操作流畅，如手机GPRS，超远程访问（跨国）等等。</p>
<p><strong>2.1.2、应用服务器分页</strong></p>
<p>将数据从数据库服务器全部下载到应用服务器，在应用服务器内部再进行数据筛选。以下是一个应用服务器端Java程序分页的示例：
List list=executeQuery(“select /* from employee order by id”);
Int count= list.size();
List subList= list.subList(10, 20);</p>
<p>优点：编码简单，只需要一次SQL交互，总数据与分页数据差不多时性能较好。</p>
<p>缺点：总数据量较多时性能较差。</p>
<p>适应场景：数据库系统不支持分页处理，数据量较小并且可控。</p>
<p><strong>2.1.3、数据库SQL分页</strong></p>
<p>采用数据库SQL分页需要两次SQL完成</p>
<p>一个SQL计算总数量</p>
<p>一个SQL返回分页后的数据</p>
<p>优点：性能好</p>
<p>缺点：编码复杂，各种数据库语法不同，需要两次SQL交互。</p>
<p>oracle数据库一般采用rownum来进行分页，常用分页语法有如下两种：</p>
<p>直接通过rownum分页：
select /<em> from (
         select a./</em>,rownum rn from
                   (select /* from product a where company_id=? order by status) a
         where rownum&lt;=20)
where rn&gt;10;</p>
<p>数据访问开销=索引IO+索引全部记录结果对应的表数据IO</p>
<p>采用rowid分页语法</p>
<p>优化原理是通过纯索引找出分页记录的ROWID，再通过ROWID回表返回数据，要求内层查询和排序字段全在索引里。
create index myindex on product(company_id,status);
select b./<em> from (
         select /</em> from (
                   select a./*,rownum rn from
                            (select rowid rid,status from product a where company_id=? order by status) a
                   where rownum&lt;=20)
         where rn&gt;10) a, product b
where a.rid=b.rowid;</p>
<p>数据访问开销=索引IO+索引分页结果对应的表数据IO</p>
<p>实例：</p>
<p>一个公司产品有1000条记录，要分页取其中20个产品，假设访问公司索引需要50个IO，2条记录需要1个表数据IO。</p>
<p>那么按第一种ROWNUM分页写法，需要550(50+1000/2)个IO，按第二种ROWID分页写法，只需要60个IO(50+20/2);</p>
<p>2.2、只返回需要的字段</p>
<p>通过去除不必要的返回字段可以提高性能，例：</p>
<p>调整前：select /* from product where company_id=?;</p>
<p>调整后：select id,name from product where company_id=?;</p>
<p>优点：</p>
<p>1、减少数据在网络上传输开销</p>
<p>2、减少服务器数据处理开销</p>
<p>3、减少客户端内存占用</p>
<p>4、字段变更时提前发现问题，减少程序BUG</p>
<p>5、如果访问的所有字段刚好在一个索引里面，则可以使用纯索引访问提高性能。</p>
<p>缺点：增加编码工作量</p>
<p>由于会增加一些编码工作量，所以一般需求通过开发规范来要求程序员这么做，否则等项目上线后再整改工作量更大。</p>
<p>如果你的查询表中有大字段或内容较多的字段，如备注信息、文件内容等等，那在查询表时一定要注意这方面的问题，否则可能会带来严重的性能问题。如果表经常要查询并且请求大内容字段的概率很低，我们可以采用分表处理，将一个大表分拆成两个一对一的关系表，将不常用的大内容字段放在一张单独的表中。如一张存储上传文件的表：</p>
<p>T_FILE（ID,FILE_NAME,FILE_SIZE,FILE_TYPE,FILE_CONTENT）</p>
<p>我们可以分拆成两张一对一的关系表：</p>
<p>T_FILE（ID,FILE_NAME,FILE_SIZE,FILE_TYPE）</p>
<p>T_FILECONTENT（ID, FILE_CONTENT）</p>
<p>通过这种分拆，可以大大提少T_FILE表的单条记录及总大小，这样在查询T_FILE时性能会更好，当需要查询FILE_CONTENT字段内容时再访问T_FILECONTENT表。</p>
<p>3、减少交互次数</p>
<p>3.1、batch DML</p>
<p>数据库访问框架一般都提供了批量提交的接口，jdbc支持batch的提交处理方法，当你一次性要往一个表中插入1000万条数据时，如果采用普通的executeUpdate处理，那么和服务器交互次数为1000万次，按每秒钟可以向数据库服务器提交10000次估算，要完成所有工作需要1000秒。如果采用批量提交模式，1000条提交一次，那么和服务器交互次数为1万次，交互次数大大减少。采用batch操作一般不会减少很多数据库服务器的物理IO，但是会大大减少客户端与服务端的交互次数，从而减少了多次发起的网络延时开销，同时也会降低数据库的CPU开销。</p>
<p>假设要向一个普通表插入1000万数据，每条记录大小为1K字节，表上没有任何索引，客户端与数据库服务器网络是100Mbps，以下是根据现在一般计算机能力估算的各种batch大小性能对比值：</p>
<p><img src="" alt=""></p>
<p>从上可以看出，Insert操作加大Batch可以对性能提高近8倍性能，一般根据主键的Update或Delete操作也可能提高2-3倍性能，但不如Insert明显，因为Update及Delete操作可能有比较大的开销在物理IO访问。以上仅是理论计算值，实际情况需要根据具体环境测量。</p>
<p>3.2、In List</p>
<p>很多时候我们需要按一些ID查询数据库记录，我们可以采用一个ID一个请求发给数据库，如下所示：
for :var in ids[] do begin
  select /* from mytable where id=:var;
end;</p>
<p>我们也可以做一个小的优化， 如下所示，用ID INLIST的这种方式写SQL：</p>
<p>select /* from mytable where id in(:id1,id2,...,idn);</p>
<p>通过这样处理可以大大减少SQL请求的数量，从而提高性能。那如果有10000个ID，那是不是全部放在一条SQL里处理呢？答案肯定是否定的。首先大部份数据库都会有SQL长度和IN里个数的限制，如ORACLE的IN里就不允许超过1000个值。</p>
<p>另外当前数据库一般都是采用基于成本的优化规则，当IN数量达到一定值时有可能改变SQL执行计划，从索引访问变成全表访问，这将使性能急剧变化。随着SQL中IN的里面的值个数增加，SQL的执行计划会更复杂，占用的内存将会变大，这将会增加服务器CPU及内存成本。</p>
<p>评估在IN里面一次放多少个值还需要考虑应用服务器本地内存的开销，有并发访问时要计算本地数据使用周期内的并发上限，否则可能会导致内存溢出。</p>
<p>综合考虑，一般IN里面的值个数超过20个以后性能基本没什么太大变化，也特别说明不要超过100，超过后可能会引起执行计划的不稳定性及增加数据库CPU及内存成本，这个需要专业DBA评估。</p>
<p>3.3、设置Fetch Size</p>
<p>当我们采用select从数据库查询数据时，数据默认并不是一条一条返回给客户端的，也不是一次全部返回客户端的，而是根据客户端fetch_size参数处理，每次只返回fetch_size条记录，当客户端游标遍历到尾部时再从服务端取数据，直到最后全部传送完成。所以如果我们要从服务端一次取大量数据时，可以加大fetch_size，这样可以减少结果数据传输的交互次数及服务器数据准备时间，提高性能。</p>
<p>以下是jdbc测试的代码，采用本地数据库，表缓存在数据库CACHE中，因此没有网络连接及磁盘IO开销，客户端只遍历游标，不做任何处理，这样更能体现fetch参数的影响：
String vsql =&quot;select /* from t_employee&quot;;
PreparedStatement pstmt = conn.prepareStatement(vsql,ResultSet.TYPE_FORWARD_ONLY,ResultSet.CONCUR_READ_ONLY);
pstmt.setFetchSize(1000);
ResultSet rs = pstmt.executeQuery(vsql);
int cnt = rs.getMetaData().getColumnCount();
Object o;
while (rs.next()) {
    for (int i = 1; i &lt;= cnt; i++) {
       o = rs.getObject(i);
    }
}</p>
<p>测试示例中的employee表有100000条记录，每条记录平均长度135字节</p>
<p>以下是测试结果，对每种fetchsize测试5次再取平均值：</p>
<p><img src="" alt=""></p>
<p><img src="" alt=""></p>
<p>Oracle jdbc fetchsize默认值为10，由上测试可以看出fetchsize对性能影响还是比较大的，但是当fetchsize大于100时就基本上没有影响了。fetchsize并不会存在一个最优的固定值，因为整体性能与记录集大小及硬件平台有关。根据测试结果建议当一次性要取大量数据时这个值设置为100左右，不要小于40。注意，fetchsize不能设置太大，如果一次取出的数据大于JVM的内存会导致内存溢出，所以建议不要超过1000，太大了也没什么性能提高，反而可能会增加内存溢出的危险。</p>
<p>注：图中fetchsize在128以后会有一些小的波动，这并不是测试误差，而是由于resultset填充到具体对像时间不同的原因，由于resultset已经到本地内存里了，所以估计是由于CPU的L1,L2 Cache命中率变化造成，由于变化不大，所以笔者也未深入分析原因。</p>
<p>iBatis的SqlMapping配置文件可以对每个SQL语句指定fetchsize大小，如下所示：</p>
<select id="getAllProduct" resultMap="HashMap" fetchSize="1000">
select /* from employee
</select>

<p>3.4、使用存储过程</p>
<p>大型数据库一般都支持存储过程，合理的利用存储过程也可以提高系统性能。如你有一个业务需要将A表的数据做一些加工然后更新到B表中，但是又不可能一条SQL完成，这时你需要如下3步操作：</p>
<p>a：将A表数据全部取出到客户端；</p>
<p>b：计算出要更新的数据；</p>
<p>c：将计算结果更新到B表。</p>
<p>如果采用存储过程你可以将整个业务逻辑封装在存储过程里，然后在客户端直接调用存储过程处理，这样可以减少网络交互的成本。</p>
<p><strong>当然，存储过程也并不是十全十美，存储过程有以下缺点：</strong></p>
<p>a、不可移植性，每种数据库的内部编程语法都不太相同，当你的系统需要兼容多种数据库时最好不要用存储过程。</p>
<p>b、学习成本高，DBA一般都擅长写存储过程，但并不是每个程序员都能写好存储过程，除非你的团队有较多的开发人员熟悉写存储过程，否则后期系统维护会产生问题。</p>
<p>c、业务逻辑多处存在，采用存储过程后也就意味着你的系统有一些业务逻辑不是在应用程序里处理，这种架构会增加一些系统维护和调试成本。</p>
<p>d、存储过程和常用应用程序语言不一样，它支持的函数及语法有可能不能满足需求，有些逻辑就只能通过应用程序处理。</p>
<p>e、如果存储过程中有复杂运算的话，会增加一些数据库服务端的处理成本，对于集中式数据库可能会导致系统可扩展性问题。</p>
<p>f、为了提高性能，数据库会把存储过程代码编译成中间运行代码(类似于java的class文件)，所以更像静态语言。当存储过程引用的对像(表、视图等等)结构改变后，存储过程需要重新编译才能生效，在24/*7高并发应用场景，一般都是在线变更结构的，所以在变更的瞬间要同时编译存储过程，这可能会导致数据库瞬间压力上升引起故障(Oracle数据库就存在这样的问题)。</p>
<p>个人观点：普通业务逻辑尽量不要使用存储过程，定时性的ETL任务或报表统计函数可以根据团队资源情况采用存储过程处理。</p>
<p>3.5、优化业务逻辑</p>
<p>要通过优化业务逻辑来提高性能是比较困难的，这需要程序员对所访问的数据及业务流程非常清楚。</p>
<p>举一个案例：</p>
<p>某移动公司推出优惠套参，活动对像为VIP会员并且2010年1，2，3月平均话费20元以上的客户。</p>
<p>那我们的检测逻辑为：
select avg(money) as avg_money from bill where phone_no=&#39;13988888888&#39; and date between &#39;201001&#39; and &#39;201003&#39;;
select vip_flag from member where phone_no=&#39;13988888888&#39;;
if avg_money&gt;20 and vip_flag=true then
begin
  执行套参();
end;</p>
<p>如果我们修改业务逻辑为:</p>
<p>select avg(money) as  avg_money from bill where phone_no=&#39;13988888888&#39; and date between &#39;201001&#39; and &#39;201003&#39;;
if avg_money&gt;20 then
begin
  select vip_flag from member where phone_no=&#39;13988888888&#39;;
  if vip_flag=true then
  begin
    执行套参();
  end;
end;</p>
<p>通过这样可以减少一些判断vip_flag的开销，平均话费20元以下的用户就不需要再检测是否VIP了。</p>
<p>如果程序员分析业务，VIP会员比例为1%，平均话费20元以上的用户比例为90%，那我们改成如下：
select vip_flag from member where phone_no=&#39;13988888888&#39;;
if vip_flag=true then
begin
  select avg(money) as avg_money from bill where phone_no=&#39;13988888888&#39; and date between &#39;201001&#39; and &#39;201003&#39;;
  if avg_money&gt;20 then
  begin
    执行套参();
  end;
end;</p>
<p>这样就只有1%的VIP会员才会做检测平均话费，最终大大减少了SQL的交互次数。</p>
<p>以上只是一个简单的示例，实际的业务总是比这复杂得多，所以一般只是高级程序员更容易做出优化的逻辑，但是我们需要有这样一种成本优化的意识。</p>
<p>3.6、使用ResultSet游标处理记录</p>
<p>现在大部分Java框架都是通过jdbc从数据库取出数据，然后装载到一个list里再处理，list里可能是业务Object，也可能是hashmap。</p>
<p>由于JVM内存一般都小于4G，所以不可能一次通过sql把大量数据装载到list里。为了完成功能，很多程序员喜欢采用分页的方法处理，如一次从数据库取1000条记录，通过多次循环搞定，保证不会引起JVM Out of memory问题。</p>
<p>以下是实现此功能的代码示例，t_employee表有10万条记录，设置分页大小为1000：
d1 = Calendar.getInstance().getTime();
vsql = &quot;select count(/<em>) cnt from t_employee&quot;;
pstmt = conn.prepareStatement(vsql);
ResultSet rs = pstmt.executeQuery();
Integer cnt = 0;
while (rs.next()) {
         cnt = rs.getInt(&quot;cnt&quot;);
}
Integer lastid=0;
Integer pagesize=1000;
System.out.println(&quot;cnt:&quot; + cnt);
String vsql = &quot;select count(/</em>) cnt from t_employee&quot;;
PreparedStatement pstmt = conn.prepareStatement(vsql);
ResultSet rs = pstmt.executeQuery();
Integer cnt = 0;
while (rs.next()) {
         cnt = rs.getInt(&quot;cnt&quot;);
}
Integer lastid = 0;
Integer pagesize = 1000;
System.out.println(&quot;cnt:&quot; + cnt);
for (int i = 0; i &lt;= cnt / pagesize; i++) {
         vsql = &quot;select /<em> from (select /</em> from t_employee where id&gt;? order by id) where rownum&lt;=?&quot;;
         pstmt = conn.prepareStatement(vsql);
         pstmt.setFetchSize(1000);
         pstmt.setInt(1, lastid);
         pstmt.setInt(2, pagesize);
         rs = pstmt.executeQuery();
         int col_cnt = rs.getMetaData().getColumnCount();
         Object o;
         while (rs.next()) {
                   for (int j = 1; j &lt;= col_cnt; j++) {
                            o = rs.getObject(j);
                   }
                   lastid = rs.getInt(&quot;id&quot;);
         }
         rs.close();
         pstmt.close();
}</p>
<p>以上代码实际执行时间为6.516秒</p>
<p>很多持久层框架为了尽量让程序员使用方便，封装了jdbc通过statement执行数据返回到resultset的细节，导致程序员会想采用分页的方式处理问题。实际上如果我们采用jdbc原始的resultset游标处理记录，在resultset循环读取的过程中处理记录，这样就可以一次从数据库取出所有记录。显著提高性能。</p>
<p>这里需要注意的是，采用resultset游标处理记录时，应该将游标的打开方式设置为FORWARD_READONLY模式(ResultSet.TYPE_FORWARD_ONLY,ResultSet.CONCUR_READ_ONLY)，否则会把结果缓存在JVM里，造成JVM Out of memory问题。</p>
<p>代码示例：
String vsql =&quot;select /* from t_employee&quot;;
PreparedStatement pstmt = conn.prepareStatement(vsql,ResultSet.TYPE_FORWARD_ONLY,ResultSet.CONCUR_READ_ONLY);
pstmt.setFetchSize(100);
ResultSet rs = pstmt.executeQuery(vsql);
int col_cnt = rs.getMetaData().getColumnCount();
Object o;
while (rs.next()) {
         for (int j = 1; j &lt;= col_cnt; j++) {
                   o = rs.getObject(j);
         }
}</p>
<p>调整后的代码实际执行时间为3.156秒</p>
<p>从测试结果可以看出性能提高了1倍多，如果采用分页模式数据库每次还需发生磁盘IO的话那性能可以提高更多。</p>
<p>iBatis等持久层框架考虑到会有这种需求，所以也有相应的解决方案，在iBatis里我们不能采用queryForList的方法，而应用该采用queryWithRowHandler加回调事件的方式处理，如下所示：
MyRowHandler myrh=new MyRowHandler();
sqlmap.queryWithRowHandler(&quot;getAllEmployee&quot;, myrh);
class MyRowHandler implements RowHandler {
    public void handleRow(Object o) {
       //todo something
    }
}</p>
<p>iBatis的queryWithRowHandler很好的封装了resultset遍历的事件处理，效果及性能与resultset遍历一样，也不会产生JVM内存溢出。</p>
<p>4、减少数据库服务器CPU运算</p>
<p>4.1、使用绑定变量</p>
<p>绑定变量是指SQL中对变化的值采用变量参数的形式提交，而不是在SQL中直接拼写对应的值。</p>
<p>非绑定变量写法：Select /* from employee where id=1234567</p>
<p>绑定变量写法：
Select /* from employee where id=?
Preparestatement.setInt(1,1234567)</p>
<p>Java中Preparestatement就是为处理绑定变量提供的对像，绑定变量有以下优点：</p>
<p>1、防止SQL注入</p>
<p>2、提高SQL可读性</p>
<p>3、提高SQL解析性能，不使用绑定变更我们一般称为硬解析，使用绑定变量我们称为软解析。</p>
<p>第1和第2点很好理解，做编码的人应该都清楚，这里不详细说明。关于第3点，到底能提高多少性能呢，下面举一个例子说明：</p>
<p>假设有这个这样的一个数据库主机：</p>
<p>2个4核CPU</p>
<p>100块磁盘，每个磁盘支持IOPS为160</p>
<p>业务应用的SQL如下：</p>
<p>select /* from table where pk=?</p>
<p>这个SQL平均4个IO（3个索引IO+1个数据IO）</p>
<p>IO缓存命中率75%（索引全在内存中，数据需要访问磁盘）</p>
<p>SQL硬解析CPU消耗：1ms （常用经验值）</p>
<p>SQL软解析CPU消耗：0.02ms（常用经验值）</p>
<p>假设CPU每核性能是线性增长，访问内存Cache中的IO时间忽略，要求计算系统对如上应用采用硬解析与采用软解析支持的每秒最大并发数：</p>
<p><img src="" alt=""></p>
<p>从以上计算可以看出，不使用绑定变量的系统当并发达到8000时会在CPU上产生瓶颈，当使用绑定变量的系统当并行达到16000时会在磁盘IO上产生瓶颈。所以如果你的系统CPU有瓶颈时请先检查是否存在大量的硬解析操作。</p>
<p>使用绑定变量为何会提高SQL解析性能，这个需要从数据库SQL执行原理说明，一条SQL在Oracle数据库中的执行过程如下图所示：</p>
<p><img src="" alt=""></p>
<p>当一条SQL发送给数据库服务器后，系统首先会将SQL字符串进行hash运算，得到hash值后再从服务器内存里的SQL缓存区中进行检索，如果有相同的SQL字符，并且确认是同一逻辑的SQL语句，则从共享池缓存中取出SQL对应的执行计划，根据执行计划读取数据并返回结果给客户端。</p>
<p>如果在共享池中未发现相同的SQL则根据SQL逻辑生成一条新的执行计划并保存在SQL缓存区中，然后根据执行计划读取数据并返回结果给客户端。</p>
<p>为了更快的检索SQL是否在缓存区中，首先进行的是SQL字符串hash值对比，如果未找到则认为没有缓存，如果存在再进行下一步的准确对比，所以要命中SQL缓存区应保证SQL字符是完全一致，中间有大小写或空格都会认为是不同的SQL。</p>
<p>如果我们不采用绑定变量，采用字符串拼接的模式生成SQL,那么每条SQL都会产生执行计划，这样会导致共享池耗尽，缓存命中率也很低。</p>
<p><strong>一些不使用绑定变量的场景：</strong></p>
<p>a、数据仓库应用，这种应用一般并发不高，但是每个SQL执行时间很长，SQL解析的时间相比SQL执行时间比较小，绑定变量对性能提高不明显。数据仓库一般都是内部分析应用，所以也不太会发生SQL注入的安全问题。</p>
<p>b、数据分布不均匀的特殊逻辑，如产品表，记录有1亿，有一产品状态字段，上面建有索引，有审核中，审核通过，审核未通过3种状态，其中审核通过9500万，审核中1万，审核不通过499万。</p>
<p>要做这样一个查询：</p>
<p>select count(/*) from product where status=?</p>
<p>采用绑定变量的话，那么只会有一个执行计划，如果走索引访问，那么对于审核中查询很快，对审核通过和审核不通过会很慢；如果不走索引，那么对于审核中与审核通过和审核不通过时间基本一样；</p>
<p>对于这种情况应该不使用绑定变量，而直接采用字符拼接的方式生成SQL，这样可以为每个SQL生成不同的执行计划，如下所示。
select count(/<em>) from product where status=&#39;approved&#39;; //不使用索引
select count(/</em>) from product where status=&#39;tbd&#39;; //不使用索引
select count(/*) from product where status=&#39;auditing&#39;;//使用索引</p>
<p>4.2、合理使用排序</p>
<p>Oracle的排序算法一直在优化，但是总体时间复杂度约等于nLog(n)。普通OLTP系统排序操作一般都是在内存里进行的，对于数据库来说是一种CPU的消耗，曾在PC机做过测试，单核普通CPU在1秒钟可以完成100万条记录的全内存排序操作，所以说由于现在CPU的性能增强，对于普通的几十条或上百条记录排序对系统的影响也不会很大。但是当你的记录集增加到上万条以上时，你需要注意是否一定要这么做了，大记录集排序不仅增加了CPU开销，而且可能会由于内存不足发生硬盘排序的现象，当发生硬盘排序时性能会急剧下降，这种需求需要与DBA沟通再决定，取决于你的需求和数据，所以只有你自己最清楚，而不要被别人说排序很慢就吓倒。</p>
<p><strong>以下列出了可能会发生排序操作的SQL语法：</strong></p>
<p>Order by</p>
<p>Group by</p>
<p>Distinct</p>
<p>Exists子查询</p>
<p>Not Exists子查询</p>
<p>In子查询</p>
<p>Not In子查询</p>
<p>Union（并集），Union All也是一种并集操作，但是不会发生排序，如果你确认两个数据集不需要执行去除重复数据操作，那请使用Union All 代替Union。</p>
<p>Minus（差集）</p>
<p>Intersect（交集）</p>
<p>Create Index</p>
<p>Merge Join，这是一种两个表连接的内部算法，执行时会把两个表先排序好再连接，应用于两个大表连接的操作。如果你的两个表连接的条件都是等值运算，那可以采用Hash Join来提高性能，因为Hash Join使用Hash 运算来代替排序的操作。具体原理及设置参考SQL执行计划优化专题。</p>
<p>4.3、减少比较操作</p>
<p>我们SQL的业务逻辑经常会包含一些比较操作，如a=b，a&lt;b之类的操作，对于这些比较操作数据库都体现得很好，但是如果有以下操作，我们需要保持警惕：</p>
<p>Like模糊查询，如下所示：</p>
<p>a like ‘%abc%’</p>
<p>Like模糊查询对于数据库来说不是很擅长，特别是你需要模糊检查的记录有上万条以上时，性能比较糟糕，这种情况一般可以采用专用Search或者采用全文索引方案来提高性能。</p>
<p>不能使用索引定位的大量In List，如下所示：</p>
<p>a in (:1,:2,:3,…,:n) ----n&gt;20</p>
<p>如果这里的a字段不能通过索引比较，那数据库会将字段与in里面的每个值都进行比较运算，如果记录数有上万以上，会明显感觉到SQL的CPU开销加大，这个情况有两种解决方式：</p>
<p>a、 将in列表里面的数据放入一张中间小表，采用两个表Hash Join关联的方式处理；</p>
<p>b、 采用str2varList方法将字段串列表转换一个临时表处理，关于str2varList方法可以在网上直接查询，这里不详细介绍。</p>
<p>以上两种解决方案都需要与中间表Hash Join的方式才能提高性能，如果采用了Nested Loop的连接方式性能会更差。</p>
<p>如果发现我们的系统IO没问题但是CPU负载很高，就有可能是上面的原因，这种情况不太常见，如果遇到了最好能和DBA沟通并确认准确的原因。</p>
<p>4.4、大量复杂运算在客户端处理</p>
<p>什么是复杂运算，一般我认为是一秒钟CPU只能做10万次以内的运算。如含小数的对数及指数运算、三角函数、3DES及BASE64数据加密算法等等。</p>
<p>如果有大量这类函数运算，尽量放在客户端处理，一般CPU每秒中也只能处理1万-10万次这样的函数运算，放在数据库内不利于高并发处理。</p>
<p>5、利用更多的资源</p>
<p>5.1、客户端多进程并行访问</p>
<p>多进程并行访问是指在客户端创建多个进程(线程)，每个进程建立一个与数据库的连接，然后同时向数据库提交访问请求。当数据库主机资源有空闲时，我们可以采用客户端多进程并行访问的方法来提高性能。如果数据库主机已经很忙时，采用多进程并行访问性能不会提高，反而可能会更慢。所以使用这种方式最好与DBA或系统管理员进行沟通后再决定是否采用。</p>
<p>例如：</p>
<p>我们有10000个产品ID，现在需要根据ID取出产品的详细信息，如果单线程访问，按每个IO要5ms计算，忽略主机CPU运算及网络传输时间，我们需要50s才能完成任务。如果采用5个并行访问，每个进程访问2000个ID，那么10s就有可能完成任务。</p>
<p>那是不是并行数越多越好呢，开1000个并行是否只要50ms就搞定，答案肯定是否定的，当并行数超过服务器主机资源的上限时性能就不会再提高，如果再增加反而会增加主机的进程间调度成本和进程冲突机率。</p>
<p><strong>以下是一些如何设置并行数的基本建议：</strong></p>
<p>如果瓶颈在服务器主机，但是主机还有空闲资源，那么最大并行数取主机CPU核数和主机提供数据服务的磁盘数两个参数中的最小值，同时要保证主机有资源做其它任务。</p>
<p>如果瓶颈在客户端处理，但是客户端还有空闲资源，那建议不要增加SQL的并行，而是用一个进程取回数据后在客户端起多个进程处理即可，进程数根据客户端CPU核数计算。</p>
<p>如果瓶颈在客户端网络，那建议做数据压缩或者增加多个客户端，采用map reduce的架构处理。</p>
<p>如果瓶颈在服务器网络，那需要增加服务器的网络带宽或者在服务端将数据压缩后再处理了。</p>
<p>5.2、数据库并行处理</p>
<p>数据库并行处理是指客户端一条SQL的请求，数据库内部自动分解成多个进程并行处理，如下图所示：</p>
<p><img src="" alt=""></p>
<p>并不是所有的SQL都可以使用并行处理，一般只有对表或索引进行全部访问时才可以使用并行。数据库表默认是不打开并行访问，所以需要指定SQL并行的提示，如下所示：</p>
<p>select //<em>+parallel(a,4)/</em>/ /* from employee;</p>
<p><strong>并行的优点：</strong></p>
<p>使用多进程处理，充分利用数据库主机资源（CPU,IO），提高性能。</p>
<p><strong>并行的缺点：</strong></p>
<p>1、单个会话占用大量资源，影响其它会话，所以只适合在主机负载低时期使用；</p>
<p>2、只能采用直接IO访问，不能利用缓存数据，所以执行前会触发将脏缓存数据写入磁盘操作。</p>
<p><strong>注：</strong></p>
<p>1、并行处理在OLTP类系统中慎用，使用不当会导致一个会话把主机资源全部占用，而正常事务得不到及时响应，所以一般只是用于数据仓库平台。</p>
<p>2、一般对于百万级记录以下的小表采用并行访问性能并不能提高，反而可能会让性能更差。 相关文章 相关文档 相关视频  <a href="http://www.uml.org.cn/sjjm/201210265.asp" target="_blank">我们该如何设计数据库</a> <a href="http://www.uml.org.cn/sjjm/201007233.asp" target="_blank">数据库设计经验谈</a> <a href="http://www.uml.org.cn/sjjm/200903311.asp" target="_blank">数据库设计过程</a> <a href="http://www.uml.org.cn/sjjm/201005131.asp" target="_blank">数据库编程总结</a> <a href="http://wenku.uml.com.cn/document.asp?fileid=4002&amp;partname=%CA%FD%BE%DD%BF%E2" target="_blank">数据库性能调优技巧</a> <a href="http://wenku.uml.com.cn/document.asp?fileid=1050&amp;partname=%CA%FD%BE%DD%BF%E2" target="_blank">数据库性能调整</a> <a href="http://wenku.uml.com.cn/document.asp?fileid=1390&amp;partname=%CA%FD%BE%DD%BF%E2" target="_blank">数据库性能优化讲座</a> <a href="http://wenku.uml.com.cn/document.asp?fileid=1049&amp;partname=%CA%FD%BE%DD%BF%E2" target="_blank">数据库系统性能调优系列</a> <a href="http://www.uml.org.cn/course-db/xnsjksj.asp" target="_blank">高性能数据库设计与优化</a> <a href="http://www.uml.org.cn/course-db/shujk.asp" target="_blank">高级数据库架构师</a> <a href="http://www.uml.org.cn/course-db/dbdesign15.asp" target="_blank">数据仓库和数据挖掘技术</a> <a href="http://www.uml.org.cn/course-db/Hadoop-xnty.asp" target="_blank">Hadoop原理、部署与性能调优</a>
来源： <a href="[http://www.uml.org.cn/sjjm/201308283.asp](http://www.uml.org.cn/sjjm/201308283.asp)">[http://www.uml.org.cn/sjjm/201308283.asp](http://www.uml.org.cn/sjjm/201308283.asp)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:34"datetime="2014-03-07 09:54:34"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB--面向程序员的数据库访问性能优化法则-数据库/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB--面向程序员的数据库访问性能优化法则-数据库" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-oracle--oracle的表空间，分区表，以及索引的总结_开拓者_百度空间2/">oracle的表空间，分区表，以及索引的总结_开拓者_百度空间 (2)</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:34.000Z"> <a href="/2014/02/02/2014-02-02-DB-oracle--oracle的表空间，分区表，以及索引的总结_开拓者_百度空间2/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="oracle-_-_-2-">oracle的表空间，分区表，以及索引的总结<em>开拓者</em>百度空间 (2)</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">QQ空间</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">新浪微博</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">百度搜藏</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">人人网</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">腾讯微博</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">开心网</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">腾讯朋友</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">百度空间</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">豆瓣网</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">搜狐微博</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">百度新首页</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">QQ收藏</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">和讯微博</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">我的淘宝</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">百度贴吧</a></li>
<li><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">更多...</a></li>
</ul>
<p><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">百度分享</a></p>
<p><a href="http://hi.baidu.com/"></a></p>
<ul>
<li><a href="http://hi.baidu.com/index" target="_blank">广场</a></li>
<li><a href="https://passport.baidu.com/center" target="_blank">jywv</a>
*</li>
<li><a href="https://passport.baidu.com/?logout&amp;bdstoken=aa9855a9aad4216b27441b12182ad1a7&amp;u=http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3" target="_blank">退出</a>
<a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">关注此空间</a><h1 id="-http-hi-baidu-com-new-cnbxj-"><a href="http://hi.baidu.com/new/cnbxj" target="_blank">开拓者</a></h1>
</li>
</ul>
<p>开拓者</p>
<p>2008-06-02 22:46</p>
<h2 id="oracle-">oracle的表空间，分区表，以及索引的总结</h2>
<p>表空间：
Oracle的UNDOTBS01.DBF文件太大的解决办法
1、.禁止undo tablespace自动增长
alter database datafile &#39;full_path\undotbs01.dbf&#39; autoextend off;
2.-- 创建一个新的小空间的undo tablespace
create undo tablespace undotBS2 datafile &#39;full_path\UNDOTBS02.DBF&#39; size 100m;
-- 设置新的表空间为系统undo_tablespace
alter system set undo_tablespace=undotBS2;
-- Drop 旧的表空间
drop tablespace undotbs1 including contents;
--查看所有表空间的情况
select /<em> from dba_tablespaces
--创建表空间
create tablespace HRPM0
datafile &#39;/oradata/misdb/HRPM0.DBF&#39; size 5m autoextend on next 10m maxsize unlimited
--删除表空间
DROP TABLESPACE data01 INCLUDING CONTENTS AND DATAFILES;
--修改表空间大小
alter database datafile &#39;/path/NADDate05.dbf&#39; resize 100M
分区表：
当表中的数据量不断增大，查询数据的速度就会变慢，应用程序的性能就会下降，这时就应该考虑对表进行分区。表进行分区后，逻辑上表仍然是一张完整的表，只是将表中的数据在物理上存放到多个表空间(物理文件上)，这样查询数据时，不至于每次都扫描整张表。
Oracle中提供了以下几种表分区：
一、范围分区：这种类型的分区是使用列的一组值，通常将该列成为分区键。
示例1：假设有一个CUSTOMER表，表中有数据200000行，我们将此表通过CUSTOMER_ID进行分区，每个分区存储100000行，我们将每个分区保存到单独的表空间中，这样数据文件就可以跨越多个物理磁盘。下面是创建表和分区的代码，如下：
CREATE TABLE CUSTOMER
(
CUSTOMER_ID NUMBER NOT NULL PRIMARY KEY,
FIRST_NAME VARCHAR2(30) NOT NULL,
LAST_NAME VARCHAR2(30) NOT NULL,
PHONE VARCHAR2(15) NOT NULL,
EMAIL VARCHAR2(80),
STATUS CHAR(1)
)
PARTITION BY RANGE (CUSTOMER_ID)
(
PARTITION CUS_PART1 VALUES LESS THAN (100000) TABLESPACE CUS_TS01,
PARTITION CUS_PART2 VALUES LESS THAN (200000) TABLESPACE CUS_TS02
)
注意：在创建表进行分区时，表空间必须先存在，而且建议将不同的分区放入不同的表空间中。
示例2：假设有ORDER_ACTIVITIES表，每6个月对订单进行清理，我们可以按月份对表进行分区，分区代码如下：
CREATE TABLE ORDER_ACTIVITIES
(
ORDER_ID NUMBER(7) NOT NULL,
ORDER_DATE DATE,
TOTAL_AMOUNT NUMBER,
CUSTOTMER_ID NUMBER(7),
PAID CHAR(1)
)
PARTITION BY RANGE (ORDER_DATE)
(
PARTITION ORD_ACT_PART01 VALUES LESS THAN (TO_DATE(&#39;01-MAY-2003&#39;,&#39;DD-MON-YYYY&#39;)) TABLESPACE ORD_TS01,
PARTITION ORD_ACT_PART02 VALUES LESS THAN (TO_DATE(&#39;01-JUN-2003&#39;,&#39;DD-MON-YYYY&#39;)) TABLESPACE ORD_TS02,
PARTITION ORD_ACT_PART02 VALUES LESS THAN (TO_DATE(&#39;01-JUL-2003&#39;,&#39;DD-MON-YYYY&#39;)) TABLESPACE ORD_TS03
)
二、列表分区：该分区的特点是某列的值只有几个，基于这样的特点我们可以采用列表分区。
示例1：
CREATE TABLE PROBLEM_TICKETS
(
PROBLEM_ID NUMBER(7) NOT NULL PRIMARY KEY,
DESCRIPTION VARCHAR2(2000),
CUSTOMER_ID NUMBER(7) NOT NULL,
DATE_ENTERED DATE NOT NULL,
STATUS VARCHAR2(20)
)
PARTITION BY LIST (STATUS)
(
PARTITION PROB_ACTIVE VALUES (&#39;ACTIVE&#39;) TABLESPACE PROB_TS01,
PARTITION PROB_INACTIVE VALUES (&#39;INACTIVE&#39;) TABLESPACE PROB_TS02
)
三、散列分区：这类分区是在列值上使用散列算法，以确定将行放入哪个分区中。当列的值没有合适的条件时，建议使用散列分区。请看下列示例：
示例1：
CREATE TABLE HASH_TABLE
(
COL NUMBER(8),
INF VARCHAR2(100)
)
PARTITION BY HASH (COL)
(
PARTITION PART01 TABLESPACE HASH_TS01,
PARTITION PART02 TABLESPACE HASH_TS02,
PARTITION PART03 TABLESPACE HASH_TS03
)
四、复合范围列表分区：这种分区是基于范围分区和列表分区，表首先按某列进行范围分区，然后再按某列进行列表分区，分区之中的分区被称为子分区。
示例1：
CREATE TABLE SALES
(
PRODUCT_ID VARCHAR2(5),
SALES_DATE DATE,
SALES_COST NUMBER(10),
STATUS VARCHAR2(20)
)
PARTITION BY RANGE(SALES_DATE)
SUBPARTITION BY LIST (STATUS)
(
PARTITION P1 VALUES LESS THAN (TO_DATE(&#39;2003-01-01&#39;,&#39;YYYY-MM-DD&#39;)) TABLESPACE P1_TS
(
SUBPARTITION P1SUB1 VALUES (&#39;ACTIVE&#39;) TABLESPACE SUBP1_TS1,
SUBPARTITION P1SUB2 VALUES (&#39;INACTIVE&#39;) TABLESPACE SUBP1_TS2
),
PARTITION P2 VALUES LESS THAN (TO_DATE(&#39;2003-03-01&#39;,&#39;YYYY-MM-DD&#39;)) TABLESPACE P2_TS
(
SUBPARTITION P2SUB1 VALUES (&#39;ACTIVE&#39;) TABLESPACE SUBP2_TS1,
SUBPARTITION P2SUB2 VALUES (&#39;INACTIVE&#39;) TABLESPACE SUBP2_TS2
)
)
示例2：使用TEMPLATE模板
CREATE TABLE SALES
(
PRODUCT_ID VARCHAR2(5),
SALES_DATE DATE,
SALES_COST NUMBER(10),
STATUS VARCHAR2(20)
)
PARTITION BY RANGE(SALES_DATE)
SUBPARTITION BY LIST (STATUS)
SUBPARTITION TEMPLATE
(
SUBPARTITION SUB1 VALUES (&#39;ACTIVE&#39;) TABLESPACE SUBP1_TS1,
SUBPARTITION SUB2 VALUES (&#39;INACTIVE&#39;) TABLESPACE SUBP2_TS2
)
(
PARTITION P1 VALUES LESS THAN (TO_DATE(&#39;2003-01-01&#39;,&#39;YYYY-MM-DD&#39;)) TABLESPACE P1_TS,
PARTITION P2 VALUES LESS THAN (TO_DATE(&#39;2003-03-01&#39;,&#39;YYYY-MM-DD&#39;)) TABLESPACE P2_TS
)
五、复合范围散列分区：这种分区是基于范围分区和散列分区，表首先按某列进行范围分区，然后再按某列进行散列分区。与上面的定义方式非常的类似，在此不单独举例。
表分区对于用户来说是透明的，我们在插入数据时Oracle会自动判断插入的数据，然后放入相应的表分区中。但有时我们想单独查询某个分区中的数据时，就必须手工指定分区的名称。
示例1：(此示例基于：四、复合范围列表分区的示例一)
向SALES表插入记录，不必指定表分区。
INSERT INTO SALES VALUES(&#39;00001&#39;,&#39;01-1月-02&#39;,100,&#39;ACTIVE&#39;)
/
INSERT INTO SALES VALUES(&#39;00002&#39;,&#39;01-1月-01&#39;,200,&#39;ACTIVE&#39;)
/
INSERT INTO SALES VALUES(&#39;00003&#39;,&#39;01-2月-03&#39;,300,&#39;INACTIVE&#39;)
/
INSERT INTO SALES VALUES(&#39;00004&#39;,&#39;04-2月-03&#39;,300,&#39;INACTIVE&#39;)
/
INSERT INTO SALES VALUES(&#39;00005&#39;,&#39;04-2月-02&#39;,300,&#39;INACTIVE&#39;)
/
不指定表分区查看SALES表信息：
SELECT /</em> FROM SALES; 结果如下所示：
指定P1表分区查询SALES表信息：
SELECT /<em> FROM SALES PARTITION(P1); 结果如下所示：
指定P1SUB1子分区查询SALES表信息:
SELECT /</em> FROM SALES SUBPARTITION(P1SUB1); 结果如下所示：
示例2：(此示例基于：四、复合范围列表分区的示例二)
示例2基于TEMPLATE模板的表分区，查询稍稍烦琐一点。
指定P1表分区查询SALES表信息：
SELECT /<em> FROM SALES PARTITION(P1); 结果如下所示,和刚才查询一致。
指定SUB1子分区查询SALES表信息:
SELECT /</em> FROM SALES SUBPARTITION(SUB1); 出现如下错误信息：
怎么解决以上问题呢？我们通过sys模式查看分区信息的数据字典,如下：
可以看出子分区不叫SUB1，而是P1_SUB1,重新查询信息，如下图所示：
有关表分区的一些维护性操作：
一、添加分区
以下代码给SALES表添加了一个P3分区
ALTER TABLE SALES ADD PARTITION P3 VALUES LESS THAN(TO_DATE(&#39;2003-06-01&#39;,&#39;YYYY-MM-DD&#39;));
注意：以上添加的分区界限应该高于最后一个分区界限。
以下代码给SALES表的P3分区添加了一个P3SUB1子分区
ALTER TABLE SALES MODIFY PARTITION P3 ADD SUBPARTITION P3SUB1 VALUES(&#39;COMPLETE&#39;);
二、删除分区
以下代码删除了P3表分区：
ALTER TABLE SALES DROP PARTITION P3;
在以下代码删除了P4SUB1子分区：
ALTER TABLE SALES DROP SUBPARTITION P4SUB1;
注意：如果删除的分区是表中唯一的分区，那么此分区将不能被删除，要想删除此分区，必须删除表。
三、截断分区
截断某个分区是指删除某个分区中的数据，并不会删除分区，也不会删除其它分区中的数据。当表中即使只有一个分区时，也可以截断该分区。通过以下代码截断分区：
ALTER TABLE SALES TRUNCATE PARTITION P2;
通过以下代码截断子分区：
ALTER TABLE SALES TRUNCATE SUBPARTITION P2SUB2;
四、合并分区
合并分区是将相邻的分区合并成一个分区，结果分区将采用较高分区的界限，值得注意的是，不能将分区合并到界限较低的分区。以下代码实现了P1 P2分区的合并：
ALTER TABLE SALES MERGE PARTITIONS P1,P2 INTO PARTITION P2;
五、拆分分区
拆分分区将一个分区拆分两个新分区，拆分后原来分区不再存在。注意不能对HASH类型的分区进行拆分。
ALTER TABLE SALES SBLIT PARTITION P2 AT(TO_DATE(&#39;2003-02-01&#39;,&#39;YYYY-MM-DD&#39;))
INTO (PARTITION P21,PARTITION P22);
六、接合分区(coalesca)
结合分区是将散列分区中的数据接合到其它分区中，当散列分区中的数据比较大时，可以增加散列分区，然后进行接合，值得注意的是，接合分区只能用于散列分区中。通过以下代码进行接合分区：
ALTER TABLE SALES COALESCA PARTITION;
七、重命名表分区
以下代码将P21更改为P2
ALTER TABLE SALES RENAME PARTITION P21 TO P2;
九、跨分区查询
select sum( /<em>) from (
(select count(/</em>) cn from t_table_SS PARTITION (P200709_1)
union all
select count(/<em>) cn from t_table_SS PARTITION (P200709_2));
十、查询表上有多少分区
SELECT /</em> FROM useR_TAB_PARTITIONS WHERE TABLE_NAME=&#39;tableName&#39;
十一、查询索引信息
select object_name,object_type,tablespace_name,sum(value)
from v$segment_statistics
where statistic_name IN (&#39;physical reads&#39;,&#39;physical write&#39;,&#39;logical reads&#39;)and object_type=&#39;INDEX&#39;
group by object_name,object_type,tablespace_name
order by 4 desc
--显示数据库所有分区表的信息：
select /<em> from DBA_PART_TABLES
--显示当前用户可访问的所有分区表信息:
select /</em> from ALL_PART_TABLES
--显示当前用户所有分区表的信息：
select /<em> from USER_PART_TABLES
--显示表分区信息 显示数据库所有分区表的详细分区信息：
select /</em> from DBA_TAB_PARTITIONS
--显示当前用户可访问的所有分区表的详细分区信息：
select /<em> from ALL_TAB_PARTITIONS
--显示当前用户所有分区表的详细分区信息：
select /</em> from USER_TAB_PARTITIONS
--显示子分区信息 显示数据库所有组合分区表的子分区信息：
select /<em> from DBA_TAB_SUBPARTITIONS
--显示当前用户可访问的所有组合分区表的子分区信息：
select /</em> from ALL_TAB_SUBPARTITIONS
--显示当前用户所有组合分区表的子分区信息：
select /<em> from USER_TAB_SUBPARTITIONS
--显示分区列 显示数据库所有分区表的分区列信息：
select /</em> from DBA_PART_KEY_COLUMNS
--显示当前用户可访问的所有分区表的分区列信息：
select /<em> from ALL_PART_KEY_COLUMNS
--显示当前用户所有分区表的分区列信息：
select /</em> from USER_PART_KEY_COLUMNS
--显示子分区列 显示数据库所有分区表的子分区列信息：
select /<em> from DBA_SUBPART_KEY_COLUMNS
--显示当前用户可访问的所有分区表的子分区列信息：
select /</em> from ALL_SUBPART_KEY_COLUMNS
--显示当前用户所有分区表的子分区列信息：
select /<em> from USER_SUBPART_KEY_COLUMNS
--怎样查询出oracle数据库中所有的的分区表
select /</em> from user_tables a where a.partitioned=&#39;YES&#39;
--删除一个表的数据是
truncate table table_name;
--删除分区表一个分区的数据是
alter table table_name truncate partition p5;
注：分区根据具体情况选择。
表分区有以下优点：
1、数据查询：数据被存储到多个文件上，减少了I/O负载，查询速度提高。
2、数据修剪：保存历史数据非常的理想。
3、备份：将大表的数据分成多个文件，方便备份和恢复。</p>
<h1 id="4-dml-">4、并行性：可以同时向表中进行DML操作，并行性性能提高。</h1>
<p>索引：
1、一般索引：
create index index_name on table(col_name);
2、Oracle 分区索引详解
语法：Table Index
CREATE [UNIQUE|BITMAP] INDEX [schema.]index_name
ON [schema.]table_name [tbl_alias]
(col [ASC | DESC]) index_clause index_attribs
index_clauses:
分以下两种情况</p>
<ol>
<li>Local Index
就是索引信息的存放位置依赖于父表的Partition信息，换句话说创建这样的索引必须保证父表是Partition
1.1 索引信息存放在父表的分区所在的表空间。但是仅可以创建在父表为HashTable或者composite分区表的。
LOCAL STORE IN (tablespace)
1.2 仅可以创建在父表为HashTable或者composite分区表的。并且指定的分区数目要与父表的分区数目要一致
LOCAL STORE IN (tablespace) (PARTITION [partition [LOGGING|NOLOGGING] [TABLESPACE {tablespace|DEFAULT}] [PCTFREE int] [PCTUSED int] [INITRANS int] [MAXTRANS int] [STORAGE storage_clause] [STORE IN {tablespace_name|DEFAULT] [SUBPARTITION [subpartition [TABLESPACE tablespace]]]])
1.3 索引信息存放在父表的分区所在的表空间，这种语法最简单，也是最常用的分区索引创建方式。
Local
1.4 并且指定的Partition 数目要与父表的Partition要一致
LOCAL (PARTITION [partition
[LOGGING|NOLOGGING]
[TABLESPACE {tablespace|DEFAULT}]
[PCTFREE int]
[PCTUSED int]
[INITRANS int]
[MAXTRANS int]
[STORAGE storage_clause]
[STORE IN {tablespace_name|DEFAULT]
[SUBPARTITION [subpartition [TABLESPACE tablespace]]]])
Global Index
索引信息的存放位置与父表的Partition信息完全不相干。甚至父表是不是分区表都无所谓的。语法如下：
GLOBAL PARTITION BY RANGE (col_list)
( PARTITION partition VALUES LESS THAN (value_list)
[LOGGING|NOLOGGING]
[TABLESPACE {tablespace|DEFAULT}]
[PCTFREE int]
[PCTUSED int]
[INITRANS int]
[MAXTRANS int]
[STORAGE storage_clause] )
但是在这种情况下，如果父表是分区表，要删除父表的一个分区都必须要更新Global Index ,否则索引信息不正确
ALTER TABLE TableName DROP PARTITION PartitionName Update Global Indexes
--查询索引
select object_name,object_type,tablespace_name,sum(value)
from v$segment_statistics
where statistic_name IN (&#39;physical reads&#39;,&#39;physical write&#39;,&#39;logical reads&#39;)and object_type=&#39;INDEX&#39;
group by object_name,object_type,tablespace_name
order by 4 desc
<a href="http://hi.baidu.com/tag/Oracle/feeds" target="_blank">/#Oracle</a></li>
</ol>
<p>分享到： <a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" title="分享到QQ空间" target="_blank"></a> <a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" title="分享到新浪微博"></a> <a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" title="分享到腾讯微博" target="_blank"></a> <a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" title="分享到人人网"></a></p>
<p><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">举报</a> 浏览(64) <a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">评论</a> <a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">转载</a></p>
<h3 id="-">您可能也喜欢</h3>
<p><a href="http://hi.baidu.com/cnbxj/item/7e7a9de4639d4ab72f140be7" title="上一篇"></a></p>
<p><a href="http://hi.baidu.com/cnbxj/item/535c1a31f17a51f1e7bb7ae7" title="下一篇"></a></p>
<p>评论</p>
<p> 同时评论给 </p>
<p> 同时评论给原文作者 </p>
<p><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank"> 发布 </a></p>
<p>500/0</p>
<p><a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#" target="_blank">收起</a>|<a href="http://hi.baidu.com/cnbxj/item/9b1f8128e885e90842634ae3#reply" target="_blank">查看更多</a></p>
<p><a href="http://hi.baidu.com/go/show/introduce" target="_blank">帮助中心</a> | <a href="http://tieba.baidu.com/p/1781683739" target="_blank">空间客服</a> | <a href="http://tousu.baidu.com/hi/add" target="_blank">投诉中心</a> | <a href="http://www.baidu.com/search/hi_contract.html" target="_blank">空间协议</a></p>
<p>©2012 Baidu</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/oracle/">oracle</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/oracle/" class="label label-success">oracle</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:34"datetime="2014-03-07 09:54:34"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-oracle--oracle的表空间，分区表，以及索引的总结_开拓者_百度空间2/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-oracle--oracle的表空间，分区表，以及索引的总结_开拓者_百度空间2" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/125/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/123/">123</a></li><li><a class="page-number" href="/page/124/">124</a></li><li><a class="page-number" href="/page/125/">125</a></li><li class="active"><li><span class="page-number current">126</span></li><li><a class="page-number" href="/page/127/">127</a></li><li><a class="page-number" href="/page/128/">128</a></li><li><a class="page-number" href="/page/129/">129</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/127/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-23 21:54:38</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
