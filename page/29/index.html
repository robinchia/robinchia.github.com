
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 29 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-Flex--如何避免层被其它对象挡住/">如何避免层被其它对象挡住</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-Flex--如何避免层被其它对象挡住/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">如何避免层被其它对象挡住</h1>
<p><a href="http://www.javaeye.com/" target="_blank">首页</a> <a href="http://www.javaeye.com/news" target="_blank">新闻</a> <a href="http://www.javaeye.com/forums" target="_blank">论坛</a> <a href="http://www.javaeye.com/ask" target="_blank">问答</a> <a href="http://www.javaeye.com/blogs" target="_blank">博客</a> <a href="http://www.javaeye.com/job" target="_blank">招聘</a> <a href="http://wangpingsx.javaeye.com/blog/468349#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.javaeye.com/wiki" target="_blank">专栏</a> <a href="http://www.javaeye.com/groups" target="_blank">圈子</a> <a href="http://www.javaeye.com/search" target="_blank">搜索</a></p>
<p><a href="http://wangpingsx.javaeye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.javaeye.com/all" target="_blank">我的应用</a> <a href="http://wangpingsx.javaeye.com/login" target="_blank">登录</a> <a href="http://wangpingsx.javaeye.com/signup" target="_blank">注册</a></p>
<h1 id="-wangpingsx-http-wangpingsx-javaeye-com-"><a href="http://wangpingsx.javaeye.com/" target="_blank">wangpingsx</a></h1>
<p>永久域名 <a href="http://wangpingsx.javaeye.com/" target="_blank"><a href="http://wangpingsx.javaeye.com/">http://wangpingsx.javaeye.com/</a></a></p>
<p><a href="http://wangpingsx.javaeye.com/blog/480848" title="在Eclipse中查看android 源代码的方法！" target="_blank">在Eclipse中查看android 源代码的方法！</a> | <a href="http://wangpingsx.javaeye.com/blog/466800" title="写 treeItemrenderer 还是有点儿难度的" target="_blank">写 treeItemrenderer 还是有点儿难度的</a></p>
<p>2009-09-14</p>
<h3 id="-http-wangpingsx-javaeye-com-blog-468349-"><a href="http://wangpingsx.javaeye.com/blog/468349" target="_blank">如何避免层被其它对象挡住</a></h3>
<p>关键字: div被底层的东西挡住
来自于：</p>
<p><a href="http://www2.flash8.net/teach/3959.htm" target="_blank">http://www2.flash8.net/teach/3959.htm</a></p>
<p>我找了好多地方，只有这个文章的内容对我有帮助。</p>
<p>之前先列另一个文章出来：</p>
<ol>
<li>避免Flash挡住Div层的方式：增加 <param name="wmode" value="transparent">，另外增加<embed wmode="transparent" ...其他选项></li>
<li>select和flash挡住div，可以采取移除节点的方式防止挡住</li>
<li>select和flash采用display:none的方式防止挡住</li>
<li>在select和flash上面加一层隐藏的iframe对象，因为iframe对象跟select和flash界面显示平级，然后把目标div放在iframe上面</li>
<li>如果是按钮、提交、图片按钮，采用 button 标签来取代input标签，其他一致</li>
</ol>
<p>wmode=&quot;transparent&quot; 不管用，要用 wmode 为opaque  要用下边文章中写的样子。</p>
<p><img src="" alt=""> 如何避免层被其它对象挡住
<img src="" alt="">解决思路 ：
    根据挡隔对象的不同，解决办法也不同。
<img src="" alt="">具体步骤 ：
1.被Flash挡住。
设置Flash的wmode属性值 为opaque或transparent，代码示例：</p>
<p><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab/#version=6,0,29,0" width="468" height="60"><param name="movie" value="http://pepsi.flash8.net/pepsi46860.swf"></p>
<p><param name="wmode" value="opaque"><param name="quality" value="high"><embed src="http://pepsi.flash8.net/pepsi46860.swf" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="468" height="60" wmode="opaque"></embed></object></p>
<p><div style="position:absolute;left:150;top:50;width:100px;height:50px;background:green">
</div>
2.被图片挡住。
这个估计是因为图片也放在层中，而图片所在层的Z轴索引值比该层大，所以被挡住，解决办法是更改该层的Z轴索引值至比图片层大。
代码示例：</p>
<p><div style="position:absolute;left:0;top:20;z-index:2;background:red;width:120px;height:70px">
1<img src="http://www.flash8.net/images/logo.gif">
</div></p>
<p><div style="position:absolute;left:50;top:50;z-index:2;background:green;width:120px;height:70px">
2<img src="http://www.flash8.net/images/logo.gif">
</div></p>
<p><div style="position:absolute;left:90;top:80;z-index:2;background:blue;width:120px;height:70px">
3<img src="http://www.flash8.net/images/logo.gif">
</div>
3.被表单控件挡住
这个目前还没有完美的解决方法，一般都是在设计排版时就尽量避免这种情况，如果是万不得已，就在层经过表单控件时让表单控件隐藏，过后再让它显示：
代码示例：</p>
<p><button onClick="oSelect.style.display=’none’;oLayer.style.display=’inline’">显示层隐藏下拉选项
</button></p>
<p><button onClick="oSelect.style.display=’inline’;oLayer.style.display=’none’">显示下拉选项隐藏层</button></p>
<p><div style="position:absolute;left:0;top:50;z-index:2;background:red;width:120px;height:50px">
z-index:1<select id="oSelect"><option>1<option>1<option>1<option>1<option>1<option>1<option>1<option>1<option>1<option>1<option>1</select>
</div></p>
<p><div id="oLayer" style="position:absolute;left:30;top:60;z-index:2;background:green;width:120px;height:70px;display:none">
z-index:2<img src="http://www.flash8.net/images/logo.gif">
</div>
4.当然还有用优先级别较高的控件来代替层的方法解决，但控件并非是每台机器上都有安装，而且控件的可定制性也差，在兼容性上也存在问题。
(1)hhctrl.ocx控件：
 <OBJECT id=hhctrl type="application/x-oleobject" classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11" codebase="<I>file:</I>hhctrl.ocx/#Version=4,0,0,24" width=80 height=20>
 <PARAM name="Command" value="Related Topics, MENU">
 <PARAM name="Button" value="Menu">
 <PARAM name="Item1" value="[X-Eyes];http://x-lover.com/forums/">
 <PARAM name="Item2" value="闪客之吧;http://www.flash8.net">
 <PARAM name="Item3" value="零刻联盟;http://www.linkmeng.com/">
 <PARAM name="Item4" value="蓝色理想;http://www.blueidea.com/">
 <PARAM name="Item5" value="5D多媒体;http://www.5d.cn">
 </OBJECT>
 <select></select><iframe></iframe>
(2)X-Scriptlet控件
 <object style="position:absolute;top:150;left:20;width:100;height:50;border:1px
 solid /#000000" type="text/x-scriptlet" data="demo.gif"></object>
 <SELECT></SELECT><iframe></iframe>
 或
 <object style="position:absolute;top:150;left:20;width:100;height:50;border:1px solid /#000000" type="text/html" data="demo.gif"></object>
 <select></select><iframe></iframe>
(3) window.createPopup()
  <SCRIPT>
 var oPopup = window.createPopup();
 function showPopupWin(){
     var oPopBody = oPopup.document.body;
     oPopBody.style.backgroundColor = &quot;green&quot;;
     oPopup.show(50, 120, 180, 65,document.body);
 }
 </SCRIPT>
 <BUTTON onclick="showPopupWin()">显示窗口</BUTTON><select></select><iframe></iframe>
    注意：用createPopup方法打开的Popup窗口需要IE5.5以上浏览器的支持。
特别提示
本例所给代码的运行效果分别如图1.3.17~图1.3.22所示。
<img src="" alt="">
图 1.3.17 层与Flash的优先级别控制
<img src="" alt="">
图 1.3.18 层与层间的优先级别控制
<img src="" alt="">
图1.3.19层与表单控件的优先级别控制
<img src="" alt="">
图 1.3.20 HHCtrl控件与其它控件的优先级测试
<img src="" alt="">
图1.3.21X-Scriptlet控件与其它控件的优先级别测试
<img src="" alt="">
图1.3.22 Popup窗口与其它控件的优先级别测试</p>
<h3 id="-">特别说明</h3>
<p>本例问题的解决方式需要根据实际情况而定，一般来说用前三种方法就可以了，除非必要，否则尽量不要用后面的三种方法。</p>
<p>总结：</p>
<pre><code> 在网上可以找到一些代码，但有些代码只能在ie 下运行，到了firefox里就变了。
</code></pre><p>以下是一段例子，用z轴的方式来解决问题。但不适合我们的项目。</p>
<p>&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;" target="_blank">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</a> <html xmlns="http://www.w3.org/1999/xhtml"> <head> <meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> <title></title> <style type="text/css"> /*{margin:0; padding:0;} body {background:/#298DC8;color:/#333;font-size:12px;font-family:Arial, Helvetica, Verdana, sans-serif;line-height:150%;} /#t-iframe{ background:/#fff; position:relative; z-index:1;} .box{ position:relative; background:/#f7f7f7; border:solid 1px /#f09; width:200px; height:200px;} pre{ padding:8px; color:/#f09;} </style> </head> <body> <div class="box" style="z-index:5; top:50px;"> <pre> 利用pre这个标签可以将 其包起来的文字排版、格 式，原封不动的呈现出来 。算是相当好用的标签之 一。也就是说你输入的东 西被原封不动的输出,包 括你输入的空格之类的, 不用和等来表示空格或者 回车 </pre> </div> <iframe id="t-iframe" scrolling="no" frameborder="0" height="300" width="100%" src="http://www.baidu.com"></iframe> <div style="position:relative; z-index:3;"> <embed height="80" width="750" wmode="opaque" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash" quality="autohigh" src="http://gg.blueidea.com/2009/hp/3/home.swf"/> </div> <div class="box" style="z-index:2; top:-230px;"> <pre> 利用pre这个标签可以将其包起来的文 字排版、格式，原封不动的 呈现出来。算是相当好用的标签之一。也 就是说你输入的东西被原封不动的输出,包 括你输入的空格之类的,不用和等来 表示空格或者回车了 </pre> </div> <div class="box" style="z-index:4; top:-220px;"> <pre> 利用pre这个标签可以将其包起来的文 字排版、格式，原封不动的 呈现出来。算是相当好用的标签之一。也 就是说你输入的东西被原封不动的输出,包 括你输入的空格之类的,不用和等来 表示ddd </pre> </div> </body> </html> </p>
<p>以下是我在项目里的代码：</p>
<p>&lt;%@page contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt; &lt;%@ page language=&quot;java&quot;%&gt; &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt; &lt;% String map_URL = (String)request.getParameter(&quot;map_URL&quot;); if(map_URL == null){ Object tempURL = request.getAttribute(&quot;map_URL&quot;); if(tempURL == null){ map_URL = &quot;com.wxxr.web.ui.config.systemConfig&quot;;//TODO test code //map_URL = &quot;&quot;; //TODO if user not support any url system will use default url. }else{ map_URL = tempURL + &quot;&quot;; } } String contextPath = request.getContextPath(); %&gt; <!-- saved from url=(0014)about:internet --> <html lang="en"> <!-- Smart developers always View Source. This application was built using Adobe Flex, an open source framework for building rich Internet applications that get delivered via the Flash Player or to desktops via Adobe AIR. Learn more about Flex at http://flex.org // --> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <!-- BEGIN Browser History required section --> <link rel="stylesheet" type="text/css" href="<%=contextPath%>/history/history.css" /> <!-- END Browser History required section --> <title></title> <STYLE> /#_iframe{ position: relative; display: none; top: 20px; left: 30px; background-color: /#ffffff; text-align: center; border: solid 1px; padding: 10px; z-index: 1; } </STYLE> <script src="<%=contextPath%>/AC_OETags.js" language="javascript"></script> <!-- BEGIN Browser History required section --> <script src="<%=contextPath%>/history/history.js" language="javascript"></script> <!-- END Browser History required section --> <script src="<%=contextPath%>/MxIframe.js" language="javascript"></script> <style> body { margin: 0px; overflow:hidden } </style> <script language="JavaScript" type="text/javascript"> <!-- // ----------------------------------------------------------------------------- // Globals // Major version of Flash required var requiredMajorVersion = 9; // Minor version of Flash required var requiredMinorVersion = 0; // Minor version of Flash required var requiredRevision = 28; // ----------------------------------------------------------------------------- // --> </script> </head> <body scroll="no"> <script language="JavaScript" type="text/javascript"> <!-- // Version check for the Flash Player that has the ability to start Player Product Install (6.0r65) var hasProductInstall = DetectFlashVer(6, 0, 65); // Version check based upon the values defined in globals var hasRequestedVersion = DetectFlashVer(requiredMajorVersion, requiredMinorVersion, requiredRevision); if ( hasProductInstall && !hasRequestedVersion ) { // DO NOT MODIFY THE FOLLOWING FOUR LINES // Location visited after installation is complete if installation is required var MMPlayerType = (isIE == true) ? "ActiveX" : "PlugIn"; var MMredirectURL = window.location; document.title = document.title.slice(0, 47) + " - Flash Player Installation"; var MMdoctitle = document.title; AC_FL_RunContent( "src", "<%=contextPath%>/playerProductInstall", "FlashVars", "MMredirectURL="+MMredirectURL+'&MMplayerType='+MMPlayerType+'&MMdoctitle='+MMdoctitle+"", "width", "100%", "height", "100%", "align", "middle", "id", "workbench", "quality", "high", "wmode", "opaque", "bgcolor", "/#869ca7", "name", "workbench", "allowScriptAccess","sameDomain", "type", "application/x-shockwave-flash", "base","<%=contextPath%>/", "pluginspage", "http://www.adobe.com/go/getflashplayer" ); } else if (hasRequestedVersion) { // if we've detected an acceptable version // embed the Flash Content SWF when all tests are passed AC_FL_RunContent( "src", "<%=contextPath%>/workbench", "width", "100%", "height", "100%", "align", "middle", "id", "workbench", "quality", "high", "wmode", "opaque", "bgcolor", "/#869ca7", "name", "workbench", "allowScriptAccess","sameDomain", "type", "application/x-shockwave-flash", "base","<%=contextPath%>/", "pluginspage", "http://www.adobe.com/go/getflashplayer", "flashvars","map_URL=<%=map_URL%>" ); } else { // flash is too old or we can't detect the plugin var alternateContent = 'Alternate HTML content should be placed here. ' + 'This content requires the Adobe Flash Player. ' + '<a href=http://www.adobe.com/go/getflash/>Get Flash</a>'; document.write(alternateContent); // insert non-flash content } // --> </script> <div id="_iframe"> <DIV align=center> <IFRAME id="_frame" frameBorder=0 marginwidth=0 marginheight=0 scrolling=no width=100% height=100% scrolling=no ALLOWTRANSPARENCY="true"> </IFRAME> <a href="javascript:iframe_close();">close</a> </DIV> </div> <noscript> <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="workbench" width="100%" height="100%" codebase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab"> <param name="movie" value="<%=contextPath%>/workbench.swf" /> <param name="quality" value="high" /> <param name="bgcolor" value="/#869ca7" /> <param name="allowScriptAccess" value="sameDomain" /> <embed src="<%=contextPath%>/workbench.swf" quality="high" bgcolor="/#869ca7" width="100%" height="100%" name="workbench" align="middle" play="true" loop="false" quality="high" allowScriptAccess="sameDomain" type="application/x-shockwave-flash" pluginspage="http://www.adobe.com/go/getflashplayer"> </embed> </object> </noscript> </body> </html> </p>
<p><a href="http://wangpingsx.javaeye.com/blog/480848" title="在Eclipse中查看android 源代码的方法！" target="_blank">在Eclipse中查看android 源代码的方法！</a> | <a href="http://wangpingsx.javaeye.com/blog/466800" title="写 treeItemrenderer 还是有点儿难度的" target="_blank">写 treeItemrenderer 还是有点儿难度的</a></p>
<ul>
<li>14:04</li>
<li>浏览 (408)</li>
<li><a href="http://wangpingsx.javaeye.com/blog/468349#comments" target="_blank">评论</a> (0)</li>
<li>分类: <a href="http://wangpingsx.javaeye.com/category/79328" target="_blank">html+flash</a></li>
<li><a href="http://www.javaeye.com/wiki/topic/468349" target="_blank">相关推荐</a></li>
</ul>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<h3 id="-">发表评论</h3>
<p>您还没有登录，请<a href="http://wangpingsx.javaeye.com/login" target="_blank">登录</a>后发表评论(快捷键 Alt+S / Ctrl+Enter)</p>
<p><a href="http://wangpingsx.javaeye.com/" target="_blank"><img src="&quot;wangpingsx的博客: wangpingsx&quot;" alt="wangpingsx的博客"></a></p>
<p>wangpingsx</p>
<ul>
<li>浏览: 5856 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 北京</li>
<li><img src="" alt=""></li>
<li><a href="http://wangpingsx.javaeye.com/blog/profile" target="_blank">详细资料</a> <a href="http://wangpingsx.javaeye.com/blog/guest_book" target="_blank">留言簿</a></li>
</ul>
<h3 id="-">搜索本博客</h3>
<h3 id="-http-wangpingsx-javaeye-com-blog-user_visits-">最近访客 <a href="http://wangpingsx.javaeye.com/blog/user_visits" target="_blank">&gt;&gt;更多访客</a></h3>
<p><a href="http://davidgchen1.javaeye.com/" target="_blank"><img src="&quot;davidgchen1的博客: &quot;" alt="davidgchen1的博客"></a></p>
<p><a href="http://davidgchen1.javaeye.com/" target="_blank">davidgchen1</a></p>
<p><a href="http://whj222126.javaeye.com/" target="_blank"><img src="&quot;whj222126的博客: &quot;" alt="whj222126的博客"></a></p>
<p><a href="http://whj222126.javaeye.com/" target="_blank">whj222126</a>
<a href="http://pengchen617.javaeye.com/" target="_blank"><img src="&quot;pengchen617的博客: pengchen617&quot;" alt="pengchen617的博客"></a></p>
<p><a href="http://pengchen617.javaeye.com/" target="_blank">pengchen617</a></p>
<p><a href="http://ruyuntao.javaeye.com/" target="_blank"><img src="&quot;入云涛的博客: 今天的一切是为了明天更美好！&quot;" alt="入云涛的博客"></a></p>
<p><a href="http://ruyuntao.javaeye.com/" target="_blank">入云涛</a></p>
<h3 id="-">博客分类</h3>
<ul>
<li><a href="http://wangpingsx.javaeye.com/" target="_blank">全部博客 (14)</a></li>
<li><a href="http://wangpingsx.javaeye.com/category/77170" target="_blank">Flex as3 (2)</a></li>
<li><a href="http://wangpingsx.javaeye.com/category/77171" target="_blank">java (0)</a></li>
<li><a href="http://wangpingsx.javaeye.com/category/77172" target="_blank">android (1)</a></li>
<li><a href="http://wangpingsx.javaeye.com/category/77173" target="_blank">ophone (0)</a></li>
<li><a href="http://wangpingsx.javaeye.com/category/77189" target="_blank">android与ophone入门 (6)</a></li>
<li><a href="http://wangpingsx.javaeye.com/category/78994" target="_blank">B/S架构，B端cache (3)</a></li>
<li><a href="http://wangpingsx.javaeye.com/category/79328" target="_blank">html+flash (1)</a></li>
<li><p><a href="http://wangpingsx.javaeye.com/category/106957" target="_blank">eclipse (1)</a></p>
<h3 id="-">其他分类</h3>
</li>
<li><p><a href="http://wangpingsx.javaeye.com/blog/favorite" target="_blank">我的收藏</a> (10)</p>
</li>
<li><a href="http://wangpingsx.javaeye.com/blog/topic" target="_blank">我的论坛主题贴</a> (1)</li>
<li><a href="http://wangpingsx.javaeye.com/blog/post" target="_blank">我的所有论坛贴</a> (2)</li>
<li><a href="http://wangpingsx.javaeye.com/blog/article" target="_blank">我的精华良好贴</a> (0)</li>
</ul>
<h3 id="-">最近加入圈子</h3>
<ul>
<li><p><a href="http://jsfgroup.group.javaeye.com/" target="_blank">JSF</a></p>
<h3 id="-">存档</h3>
</li>
<li><p><a href="http://wangpingsx.javaeye.com/blog/monthblog/2010-05" target="_blank">2010-05</a> (1)</p>
</li>
<li><a href="http://wangpingsx.javaeye.com/blog/monthblog/2009-09" target="_blank">2009-09</a> (7)</li>
<li><a href="http://wangpingsx.javaeye.com/blog/monthblog/2009-08" target="_blank">2009-08</a> (6)</li>
<li><a href="http://wangpingsx.javaeye.com/blog/monthblog_more" target="_blank">更多存档...</a></li>
</ul>
<h3 id="-">评论排行榜</h3>
<ul>
<li><a href="http://wangpingsx.javaeye.com/blog/466551" title="ehcache " target="_blank">ehcache</a></li>
<li><a href="http://wangpingsx.javaeye.com/blog/466699" title="B/S架构，B端cache" target="_blank">B/S架构，B端cache</a></li>
<li><a href="http://wangpingsx.javaeye.com/blog/466711" title="资料xxxx" target="_blank">资料xxxx</a></li>
<li><a href="http://wangpingsx.javaeye.com/blog/480848" title="在Eclipse中查看android 源代码的方法！" target="_blank">在Eclipse中查看android 源代码的方法！</a></li>
<li><a href="http://wangpingsx.javaeye.com/blog/466800" title="写 treeItemrenderer 还是有点儿难度的" target="_blank">写 treeItemrenderer 还是有点儿难度的</a></li>
<li><a href="http://wangpingsx.javaeye.com/rss" target="_blank"><img src="" alt="Rss"></a></li>
<li><a href="http://fusion.google.com/add?feedurl=http://wangpingsx.javaeye.com/rss" target="_blank"><img src="" alt="Rss_google"></a></li>
<li><a href="http://www.xianguo.com/subscribe.php?url=http://wangpingsx.javaeye.com/rss" target="_blank"><img src="" alt="Rss_xianguo"></a></li>
<li><a href="http://www.google.com/search?hl=zh-CN&amp;q=RSS" target="_blank">[什么是RSS?]</a>
声明：JavaEye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2010 JavaEye.com. All rights reserved. 上海炯耐计算机软件有限公司 [ 沪ICP备05023328号 ]</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Flex/">Flex</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Flex/" class="label label-primary">Flex</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-Flex--如何避免层被其它对象挡住/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-Flex--如何避免层被其它对象挡住" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--BinarySearch/">BinarySearch</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--BinarySearch/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="binarysearch">BinarySearch</h1>
<h1 id="-algorithm-gossip-"><a href="">Algorithm Gossip: 二分搜寻法（搜寻原则的代表）</a></h1>
<h2 id="-">说明</h2>
<p>如果搜寻的数列已经有排序，应该尽量利用它们已排序的特性，以减少搜寻比对的次数，这是搜寻的基本原则，二分搜寻法是这个基本原则的代表。</p>
<h2 id="-">解法</h2>
<p>在二分搜寻法中，从数列的中间开始搜寻，如果这个数小于我们所搜寻的数，由于数列已排序，则该数左边的数一定都小于要搜寻的对象，所以无需浪费时间在左边的数；如果搜寻的数大于所搜寻的对象，则右边的数无需再搜寻，直接搜寻左边的数。
所以在二分搜寻法中，将数列不断的分为两个部份，每次从分割的部份中取中间数比对，例如要搜寻92于以下的数列，首先中间数索引为(0+9)/2 = 4（索引由0开始）：
[3 24 57 57 67 68 83 90 92 95]
由于67小于92，所以转搜寻右边的数列：
3 24 57 57 67 [68 83 90 92 95]
由于90小于92，再搜寻右边的数列，这次就找到所要的数了：
3 24 57 57 67 68 83 90 [92 95]</p>
<h2 id="-">实作</h2>
<ul>
<li><p>C
/#include <stdio.h>
/#include <stdlib.h>
/#include <time.h>
/#define MAX 10
/#define SWAP(x,y) {int t; t = x; x = y; y = t;}
void quicksort(int[], int, int);
int bisearch(int[], int);
int main(void) {
int number[MAX] = {0};
int i, find;
srand(time(NULL));
for(i = 0; i &lt; MAX; i++) {
number[i] = rand() % 100;
}
quicksort(number, 0, MAX-1);
printf(&quot;数列：&quot;);
for(i = 0; i &lt; MAX; i++)
printf(&quot;%d &quot;, number[i]);
printf(&quot;\n输入寻找对象：&quot;);
scanf(&quot;%d&quot;, &amp;find);
if((i = bisearch(number, find)) &gt;= 0)
printf(&quot;找到数字于索引 %d &quot;, i);
else
printf(&quot;\n找不到指定数&quot;);
printf(&quot;\n&quot;);
return 0;
}
int bisearch(int number[], int find) {
int low, mid, upper;
low = 0;
upper = MAX - 1;
while(low &lt;= upper) {
mid = (low+upper) / 2;
if(number[mid] &lt; find)
low = mid+1;
else if(number[mid] &gt; find)
upper = mid - 1;
else
return mid;
}
return -1;
}
void quicksort(int number[], int left, int right) {
int i, j, k, s;
if(left &lt; right) {
s = number[(left+right)/2];
i = left - 1;
j = right + 1;
while(1) {
while(number[++i] &lt; s) ; // 向右找
while(number[--j] &gt; s) ; // 向左找
if(i &gt;= j)
break;
SWAP(number[i], number[j]);
}
quicksort(number, left, i-1); // 对左边进行递回
quicksort(number, j+1, right); // 对右边进行递回
}
}</p>
</li>
<li><p>Java
public class BinarySearch {
public static int search(int[] number, int des) {
int low = 0;
int upper = number.length - 1;
while(low &lt;= upper) {
int mid = (low+upper) / 2;
if(number[mid] &lt; des)
low = mid+1;
else if(number[mid] &gt; des)
upper = mid - 1;
else
return mid;
}
return -1;
}
public static void main(String[] args) {
int[] number = {1, 4, 2, 6, 7, 3, 9, 8};
QuickSort.sort(number);
int find = BinarySearch.search(number, 3);
if(find != -1)
System.out.println(&quot;找到数值于索引&quot; + find);
else
System.out.println(&quot;找不到数值&quot;);
}
}</p>
</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/AlgorithmGossip/">AlgorithmGossip</a></li></span></span> | <span class="tags">Tagged <a href="/tags/AlgorithmGossip/" class="label label-primary">AlgorithmGossip</a></span> | <span class="time">recent updated:<time title="2014-03-07 10:38:25"datetime="2014-03-07 10:38:25"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--BinarySearch/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-AlgorithmGossip-AlgorithmGossip--BinarySearch" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-TCPIP--TCPIP传输层，你懂多少？--ITeye技术网站/">TCP IP传输层，你懂多少？ </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-TCPIP--TCPIP传输层，你懂多少？--ITeye技术网站/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="tcp-ip-iteye-">TCP IP传输层，你懂多少？ - - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">新闻</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/wiki" target="_blank">专栏</a>  <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://java-mzd.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/all" target="_blank">我的应用</a> <a href="http://java-mzd.iteye.com/login" target="_blank">登录</a> <a href="http://java-mzd.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-java-mzd-http-java-mzd-iteye-com-"><a href="http://java-mzd.iteye.com/" target="_blank">java-mzd</a></h1>
<p>永久域名 <a href="http://java-mzd.iteye.com/" target="_blank"><a href="http://java-mzd.iteye.com">http://java-mzd.iteye.com</a></a></p>
<p><a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">141顶</a>
<a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">25踩</a></p>
<p><a href="http://java-mzd.iteye.com/blog/1019088" title="TCP/IP网络层谜云" target="_blank">TCP/IP网络层谜云</a> | <a href="http://java-mzd.iteye.com/blog/1005945" title="Jpcap简易教程" target="_blank">Jpcap简易教程</a></p>
<p>2011-04-19</p>
<h3 id="-tcp-ip-"><a href="">TCP/IP传输层，你懂多少？</a></h3>
<p><strong>文章分类:<a href="http://www.iteye.com/blogs/category/tech" target="_blank">综合技术</a></strong></p>
<p>你所不知道的传输层
题记：23页的文档上，满满当当的写满了笔记，纸质的东西，始终害怕丢失，还是选择把它总结到博客上来。</p>
<p>PS.老规矩，列出可能遇到的20个问题，如果您是都能回答的高手，请您绕道，我是小菜，只做自己的学习笔记。</p>
<ol>
<li>传输层的主要功能是什么？</li>
<li>传输层如何区分不同应用程序的数据流？</li>
<li>传输层有哪些协议？</li>
<li>什么是UDP协议？</li>
<li>为什么有了UDP，还需要TCP？</li>
<li>什么是TCP协议？</li>
<li>怎么理解协议和程序？</li>
<li>TCP是否真的有链接？</li>
<li>链接是如何建立的（逻辑上）？</li>
<li>所谓的建立TCP链接开销很大，具体是指什么？</li>
<li>三次握手的目的是什么？</li>
<li>TCP如何提供可靠性？</li>
<li>什么是预期确认？什么是肯定确认与重新传输？哪些情况会重传？</li>
<li>TCP中，序列号和应答号有哪些作用？</li>
<li>TCP链接中，网络失败，是怎么判断的？</li>
<li>为什么需要窗口技术？</li>
<li>如何实现流量控制？</li>
<li>UDP的开销很小，具体是指什么？</li>
<li>UDP数据包、TCP数据包大小如何确认？</li>
<li>UDP适合哪些环境？TCP适合哪些环境？</li>
</ol>
<hr>
<p><strong>一。传输层的主要功能是什么？</strong></p>
<p> 分割并重新组装上层提供的数据流，为数据流提供端到端的传输服务。</p>
<p><strong>二。传输层如何区分不同应用程序的数据流？</strong></p>
<hr>
<p>因为，对应传输层而言，它只需要知道目标主机上的哪个服务程序来响应这个程序，而不需要知道这个服务程序是干什么的。因此，我们只需要能够抽象的表示出来这些应用程序和服务程序即可。我们使用端口号来抽象标识每个网络程序。</p>
<p><strong>传输层的TCP和UDP可以接收来自多个应用程序的数据流，用端口号标识他们，然后把他们送给Internet层处理；</strong></p>
<p><strong>同时TCP和UDP接收来自Internet层的数据包，用端口号区分他们，然后交给不同的应用程序。</strong></p>
<p><img src="" alt=""></p>
<p>因此：在同一IP地址（同一个目标主机）上不同的端口号是两个不同的链接。IP地址和端口号用来唯一的确定网络上数据的目的地。</p>
<p><strong>三。传输层有哪些协议？</strong></p>
<p><strong>**传输层的两大协议：TCP（传输控制协议）UDP（用户数据包协议）
</strong>TCP是一个可靠的面向链接的协议，UDP是不可靠的或者说无连接的协议。**
可以用打电话和发短信来说明这种关系：</p>
<p>UDP就好似发短信，只管发出去，至于对方是不是空号（网络不可到达）能不能收到（丢包）等并不关心。</p>
<p>TCP好像打电话，双方要通话，首先，要确定对方不是开机（网络可以到达），然后要确定是不是没有信号（），然后还需要对方接听（通信链接）。</p>
<hr>
<p><strong>四。什么是UDP协议？</strong></p>
<hr>
<p>UDP数据包结构如下图所示</p>
<p>源端口(16)</p>
<p>目标端口(16) 报文长度(16)</p>
<p>校验和(16) 数据（可变）</p>
<p>UDP为应用程序提供的是一种不可靠的、无连接的分组交付，因此，UDP报文可能会出现丢失、乱序、重复、延时等问题。
因为它不提供可靠性，它的开销很小。（<strong>开销很小具体指什么？</strong>下文揭秘）</p>
<hr>
<p><strong>五。为什么有了UDP，还需要TCP？</strong></p>
<p>问题4中已经说到，UDP为应用程序提供的是一种无连接、不可靠的分组交付。当网络硬件失效或者负担太重时，数据包可能就会产生丢失、重复、延时、乱序的现象。这些都会导致我们的通信不正常。如果让应用程序来担负差错控制的工作，无疑将给程序员带来许多复杂的工作，于是，我们使用独立的通信协议来保证通信的可靠性是非常必要的。</p>
<hr>
<p><strong>六。什么是TCP协议？</strong></p>
<p> 传输控制协议TCP是一个面向链接的、可靠的通信协议。</p>
<ol>
<li>在开始传输前，需要进行三次握手建立链接</li>
<li>可靠性：在传输过程中，通信双方的协议模块继续进行通信</li>
<li>通信结束后，通信双方都会使用改进的三次握手来关闭链接</li>
</ol>
<p>TCP数据包结构如下图</p>
<p>源端口(16)</p>
<p>目标端口(16) 序号(32) 应答号(32) 头长度(4)</p>
<p>保留(6)</p>
<p>编码位(6)</p>
<p>窗口(16) 校验和(16)</p>
<p>紧急(16) 可选项(如果有，0或32) 数据(可变)</p>
<p><strong>/<em>/</em>七。怎么理解协议和程序？/<em>/</em></strong></p>
<p>如同我们自定义的应用层协议一样：<strong>协议只是给出了一组规范，规定我们应该怎么样（按什么规则）保存数据。</strong></p>
<p>在计算机间传输的永远都是二进制字节码（对于传输层，可以理解为传输的始终是下层的IP数据包），<strong>是**</strong>计算机中的程序通过对这些字节码进行逻辑分析、判断，来控制程序完成差错控制等功能。**
至于解析这些字节码的程序，则可以有不同的实现，只要我们按照规则来解析，并作出相应的控制，我们大可以自己写个程序是实现相应功能。</p>
<p>知道了这些后，显然，我们也可以使用前面说的Jpcap，来自己实现一个基于Java的TCP或者UDP协议。可以参考Linux下的Tcp源码。</p>
<p>/net/ipv4/udp.c
/net/ipv4/datagram.c
/net/ipv4/tcp_input.c
/net/ipv4//tcp_output.c
/net/ipv4/tcp.c  </p>
<p><strong>八。TCP是否真的有链接？</strong></p>
<p>我们都知道，TCP通过完成三次握手来建立链接的，但是这种连接是面向虚电路的，是物理上不存在的，<strong>只是双方的TCP程序，逻辑上的认为建立了这样的链接**</strong>。 **</p>
<hr>
<p><strong>九。链接是如何建立的（逻辑上）？</strong></p>
<p>假设：当我们在主机A上启动一个程序，通过TCP去链接主机B上的9091端口。</p>
<p><img src="" alt="">
 整个过程是怎么样的呢？逻辑上我们可以这么理解建立链接的过程：</p>
<p>1.SYN:seq=X;</p>
<p>1.1 A的TCP程序，为这个链接分配一个端口（设为9090）。
1.2 同时<strong>逻辑上</strong>的将TCP连接的状态设置为：正在连接。（通过在链接状态表中添加一条记录，记录中状态为：正在连接）</p>
<p>猜想：</p>
<p>TCP程序中， 应该有张表来保持链接的状态，其中每个状态应该有：</p>
<p>本机地址（IP加port）、对方地址、链接状态</p>
<p>1.3 同时，随机生成一个初始序列号X，生成一个TCP包，将初始化序列号X设置为TCP中的序列号，发送给主机B。</p>
<p><strong>2.SYN:seq=Y ACK:ack=X+1;</strong></p>
<p>2.1 B上TCP程序收到该数据包，查询9091端口状态，如果可以链接。
2.2 同样的，在逻辑上的将TCP连接的状态设置为：正在连接
2.3 同时，随机生成一个初始化序列号Y，根据接收的序列号X，生成应答号X+1，生成一个TCP包，将序列号和应答号分别设置到TCP包头中，将TCP数据包发给主机A。</p>
<p><strong>3.SYN:seq=X+1 ACK:ack=Y+1.</strong></p>
<p>3.1  A上的TCP程序接收到数据包，查询9090端口状态。
3.2 根据收到的SYN:seq=Y;ACK:ack=X+1; 封装一个TCP包 SYN:seq=x+1;ACK:ack=Y+1;发送给主机B。同时，TCP程序将链接状态表中该条记录状态设置为已连接。
3.3 主机B收到数据包，TCP程序将链接状态表中该条记录状态设置为已连接。</p>
<p>至此，一个TCP链接建立（三次握手）完成。
我们可以看到：
第一：传送的都是IP数据包，其实只是将收到的数据包交给TCP程序处理。
第二：<strong>链接状态，只是TCP程序中的一个逻辑状态。</strong></p>
<p><strong>十：所谓的建立TCP链接开销很大，具体是指什么？</strong></p>
<p>从九中，很容易看出。要简历TCP链接，必须进行三次IP数据包的成功传输。</p>
<p><strong>十一：三次握手的目的是什么？</strong></p>
<p>TCP是面向链接的，在面向链接的环境中，开始传输数据之前，在两个中端之间必须先建立一个链接。建立链接的过程可以确保通信双方在发送应用程序数据包之前，都已经准备好了传送和接收数据。并且使通信双方统一了初始化序列号。</p>
<p>十二：TCP如何提供可靠性？</p>
<p><strong>在传输过程中，通信双方的协议模块继续进行通信，从而确保了传输的可靠性。</strong>
<strong>针对乱序：</strong>在通过三次握手进行链接时，序列号被初始化。在传输过程中，TCP继续使用这个序列号来标记发送的每一个数据段，没传送一个数据段，序列号加一。接收方依据序列号重装收到的数据段。
<strong>针对丢包</strong>：在传输过程中，接收方收到一个数据段后，会用ACK应答码向发送端回复一个IP包进行应答，确认号ACK用来告诉发送端哪些数据包已经成功接收，发送方对未被应答的报文段提供重传。
<strong>针对重复</strong>：接收端收到数据段后，查看序列号，如果已经成功接收改数据包，则丢弃后面这个数据段。
<strong>针对延时</strong>：延时造成的第一个问题，就是数据包达到接收端时乱序。
当延时严重时，接收端一直未收到数据段，则不会回复ACK，发送端认为丢包，重发。</p>
<p><strong>十三：什么是预期确认？什么是肯定确认与重新传输？哪些情况会重传？</strong></p>
<p>1.确认号ACK会告诉发送端哪些数据段已经成功接收，并且确认号会向发送端指出接收端希望收到的下一个序列号。即，确实号ACK为上个数据序列号+1，这种机制称为<strong>预期确认</strong>。</p>
<p>2.为了提高效率，我们在发送端，将数据段保存在缓冲区中，直道发送端收到来自接收端的确认号。这种机制被称为“<strong>肯定确认与重新传输</strong>”。</p>
<p>3.当<strong>发送端在给定时间间隔内收不到那个数据段的应答时，发送端就会重传那个数据段**</strong>。**
情况1：网络延时/环路，数据段丢失
情况2：网络延时，数据段推迟到达
情况3：数据段成功到达，应答因为1.2不能达到。</p>
<p><strong>十四： TCP中，序列号和应答号有哪些作用？</strong></p>
<p>从以上10,11,12中，很明显的可以看到</p>
<ol>
<li></li>
<li></li>
<li><p>依靠序列号重组数据段</p>
</li>
<li>依靠数据包消除网络中的重复包</li>
<li>依靠序列号和应答号进行差错重传，提高了TCP的可靠性</li>
</ol>
<p><strong>十六：为什么需要窗口技术？</strong></p>
<p>前面我们已经说了，TCP的可靠性，是通过预期确认来实现的。即发送方发送一个数据段后，需要得到对方的确认后，才会发送下一个数据段。
因此，假设一个数据段大小为64KB（IP包最大值），一次发送和确认需要的时间为500MS，则，1S内，只能传送128KB的数据，如果带宽为1M，显然很浪费带宽。为了充分利用带宽，我们使用窗口技术。滑动窗口允许发送方在收到接收方的确认之前发送多个数据段。（窗口大小决定了在收到确认前可以发送的数据段数量）</p>
<p><strong>十七：如何实现流量控制？</strong></p>
<p><strong>窗口数决定了当前传输的最大流量</strong>。当我们在传输过程中，通信双方可以根据网络条件动态协商窗口大小，调整窗口大小时，即可实现流量控制。（在TCP的每个确认中，除了ACK外，还包括一个窗口通知）</p>
<p><strong>十八：UDP的开销很小，具体是指什么？</strong></p>
<p>1.因为UDP是无连接的。在传输数据之前，不需要进行复杂的三次握手来建立连接。
2.在传输数据时，没有协议间通信流量（确认信号），也不需要浪费不必要的处理时间（接收确认信号再发一下）。
3；传输结束后，也不用再用改进的三次握手来端口连接。</p>
<p><strong>十九：UDP数据包、TCP数据包大小如何确认？</strong></p>
<ol>
<li></li>
<li><p>无论TCP还是UDP数据包，都需要交给Internet层封装为IP包，而一个IP包，包头中的长度位为16位，所以IP包最大为2的16方，即<strong>65535</strong>（64KB还需要减去各种包头长度）。</p>
</li>
<li>TCP因为面向流，且可以凭借序列号对大文件进行分段和重组，因此，<strong>TCP可以用来传输较大的文件</strong>。而UDP，如果要传输大于64KB的数据，则需要自己在应用层进行差错控制。</li>
<li>为了提高传输效率和减少网络通信量（协议间的通信），TCP也会一次传输足够多的数据。</li>
<li>因为MTU的存在，TCP包和UDP包不是越大越好。（在路由中分包，在接收端重组，加大路由与接收端负担，增大丢包概率。分组丢失，整个数据包重传。）</li>
</ol>
<p><strong>二十：UDP适用哪些环境？TCP适用哪些环境？</strong></p>
<p>适合UDP的环境：
1.在<strong>高效可靠的网络</strong>环境中（不需要考虑网络不好导致的丢包、乱序、延时、重复等问题），因为UDP是无连接的服务，不用消耗不必要的网络资源（TCP中的协议间通信）和处理时间（预期确认需要的时间），从而效率要高的多。
2.在<strong>轻权通信</strong>中，当需要传输的数据量很小（可以装在一个IP数据包内）时。如果我们使用TCP协议，那么，先建立连接，一共需要发送3个IP数据包，然后数据传输，1个IP数据包，产生一个确认信号的IP包，然后关闭连接，需要传输5个IP数据包。使用TCP协议IP包的利用率为1/10。而使用UDP，只需要发送一个IP数据包。哪怕丢包（服务不成功），也可重新申请服务（重传）。
注：而且无论UDP还是TCP，传输的都是IP数据包。当网络环境不好导致丢包时，无论TCP还是UDP都会丢包，这是没有区别的。（如果考虑发送丢包，那么TCP效率更低），只是使用TCP，当连接建立成功后，TCP程序会进行可靠性控制。
<strong>UDP很适合这种客户机向服务器传送简单服务请求的环境</strong>。此类应用层协议包括TFTP , SNMP , DNS ,DHCP等。
3.在<strong>对实时性要求很强</strong>的通信中：在诸如实时视频直播等对实时性要求很高的环境中，从而允许一定量的丢包的情况下（直播比赛，前面丢失的包，重传出来已经意义不大了），UDP更适合。（可以根据具体需要通过应用层协议提供可靠性，不用像TCP那么严格。）</p>
<p>适合TCP协议的环境：</p>
<p>当网络硬件失效或者负担太重时，数据包可能就会产生丢失、重复、延时、乱序的现象。这些都会导致<strong>我们的通信不正常的时候</strong>。如果让应用程序来担负差错控制的工作，无疑将给程序员带来许多复杂的工作，于是，我们使用独立的通信协议来保证通信的可靠性是非常必要的。 </p>
<p><strong>PS.写博客真累。。</strong></p>
<p><strong>特别是根据一堆读书笔记写博客。。</strong></p>
<p><strong>特别是写4-5000字的总结博客。。</strong></p>
<p><strong>累的感觉瘫痪了两次。。唉。。伤不起啊。。</strong></p>
<ul>
<li><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></li>
<li><p>大小: 11.3 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 11.7 KB</p>
</li>
<li><p><a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">查看图片附件</a>
<a href="http://java-mzd.iteye.com/blog/1007577#"><strong>141</strong>
顶</a><a href="http://java-mzd.iteye.com/blog/1007577#"><strong>25</strong>
踩</a></p>
</li>
</ul>
<p><a href="http://java-mzd.iteye.com/blog/1019088" title="TCP/IP网络层谜云" target="_blank">TCP/IP网络层谜云</a> | <a href="http://java-mzd.iteye.com/blog/1005945" title="Jpcap简易教程" target="_blank">Jpcap简易教程</a></p>
<ul>
<li>02:04</li>
<li>浏览 (11300)</li>
<li><a href="http://java-mzd.iteye.com/blog/1007577#comments" target="_blank">评论</a> (53)</li>
<li>分类: <a href="http://java-mzd.iteye.com/category/153171" target="_blank">TCP/IP</a></li>
<li><a href="http://www.iteye.com/wiki/topic/1007577" target="_blank">相关推荐</a></li>
</ul>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<p>53 楼 <a href="http://lucane.iteye.com/" target="_blank">lucane</a> 2011-05-14   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>十：所谓的建立TCP链接开销很大，具体是指什么？
从九中，很容易看出。要&quot;简历&quot;TCP链接，必须进行三次IP数据包的成功传输。
52 楼 <a href="http://xsz.iteye.com/" target="_blank">xsz</a> 2011-05-14   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>顶顶楼主。</p>
<p>51 楼 <a href="http://wgh596.iteye.com/" target="_blank">wgh596</a> 2011-05-14   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p><img src="" alt=""> 辛苦，辛苦。
50 楼 <a href="http://hbice.iteye.com/" target="_blank">hbice</a> 2011-05-14   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>获益匪浅，lz辛苦，我也辛苦了，顶着牙疼看帖子。。。赶紧去看牙医了。。。</p>
<p>49 楼 <a href="http://lagunarock.iteye.com/" target="_blank">Lagunarock</a> 2011-05-14   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>非常不错
涵盖面广，排版又好
值得学习
48 楼 <a href="http://adeline-pan.iteye.com/" target="_blank">adeline.pan</a> 2011-05-13   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>写得很好，上学时候学的差不多都忘了，看了又都想起来了，收藏</p>
<p>47 楼 <a href="http://qq376727939.iteye.com/" target="_blank">qq376727939</a> 2011-05-12   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>好贴啊,dou zhu
46 楼 <a href="http://vcloud.iteye.com/" target="_blank">gubingo</a> 2011-05-12   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>议和程序？/<em>/</em></p>
<p>greatwqs 写道
<img src="" alt=""> 总结的很好!</p>
<p>45 楼 <a href="http://greatwqs.iteye.com/" target="_blank">greatwqs</a> 2011-05-10   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p><img src="" alt=""> 总结的很好!
44 楼 <a href="http://794217655-qq-com.iteye.com/" target="_blank">嘻哈方式</a> 2011-05-10   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>这方面一直都是我的薄弱项 看后我的功力又增强啦！ 多谢楼主！！！</p>
<p>43 楼 <a href="http://steafler.iteye.com/" target="_blank">steafler</a> 2011-05-08   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>IP是网络层协议
42 楼 <a href="http://wuhuajun.iteye.com/" target="_blank">wuhuajun</a> 2011-05-07   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>好<img src="" alt=""></p>
<p>41 楼 <a href="http://pan-java.iteye.com/" target="_blank">pan_java</a> 2011-05-05   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>顶楼主，不错！
40 楼 <a href="http://liuyes.iteye.com/" target="_blank">liuyes</a> 2011-05-05   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>写得很好哈</p>
<p>39 楼 <a href="http://beiyangshuishi.iteye.com/" target="_blank">beiyangshuishi</a> 2011-05-03   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>写的不错，增长知识了。以前我对网络知识一窍不通。
38 楼 <a href="http://gogopengyou.iteye.com/" target="_blank">gogopengyou</a> 2011-05-03   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>基本都看明白了，总结的挺好的</p>
<p>37 楼 <a href="http://housonglin1122-163-com.iteye.com/" target="_blank">小猪笨笨</a> 2011-04-28   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>哈哈，谢谢了，其实我对这些东西一直一知半解，看了你这篇文有很大收获
36 楼 <a href="http://torry-1979.iteye.com/" target="_blank">torry_1979</a> 2011-04-27   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>作为一个普及性的资料还不错</p>
<p>35 楼 <a href="http://sswh.iteye.com/" target="_blank">sswh</a> 2011-04-27   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>mark
谢谢分享。
34 楼 <a href="http://yanglijun888.iteye.com/" target="_blank">20444465</a> 2011-04-26   <a href="http://java-mzd.iteye.com/blog/1007577#" target="_blank">引用</a></p>
<p>做it的一家要懂</p>
<p>« 上一页 1 <a href="http://java-mzd.iteye.com/blog/1007577?page=2#comments" target="_blank">2</a> <a href="http://java-mzd.iteye.com/blog/1007577?page=3#comments" target="_blank">3</a> <a href="http://java-mzd.iteye.com/blog/1007577?page=2#comments" target="_blank">下一页 »</a></p>
<h3 id="-">发表评论</h3>
<h3 id="-">表情图标</h3>
<p><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""></p>
<p>字体颜色: 标准深红红色橙色棕色黄色绿色橄榄青色蓝色深蓝靛蓝紫色灰色白色黑色 字体大小: 标准1 (xx-small)2 (x-small)3 (small)4 (medium)5 (large)6 (x-large)7 (xx-large) 对齐: 标准居左居中居右</p>
<p>提示：选择您需要装饰的文字, 按上列按钮即可添加上相应的标签</p>
<p>您还没有登录，请<a href="http://java-mzd.iteye.com/login" target="_blank">登录</a>后发表评论(快捷键 Alt+S / Ctrl+Enter)</p>
<p><a href="http://java-mzd.iteye.com/" target="_blank"><img src="&quot;java_mzd的博客: &quot;" alt="java_mzd的博客"></a></p>
<p>java_mzd</p>
<ul>
<li>浏览: 70746 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 长沙</li>
<li><img src="" alt=""></li>
<li><a href="http://java-mzd.iteye.com/blog/profile" target="_blank">详细资料</a> <a href="http://java-mzd.iteye.com/blog/guest_book" target="_blank">留言簿</a></li>
</ul>
<h3 id="-">搜索本博客</h3>
<h3 id="-http-java-mzd-iteye-com-blog-user_visits-">最近访客 <a href="http://java-mzd.iteye.com/blog/user_visits" target="_blank">&gt;&gt;更多访客</a></h3>
<p><a href="http://zhxing.iteye.com/" target="_blank"><img src="&quot;zhxing的博客: ヾ孤星随缘ツ  http://t.sina.com.cn/samzhxing&quot;" alt="zhxing的博客"></a></p>
<p><a href="http://zhxing.iteye.com/" target="_blank">zhxing</a></p>
<p><a href="http://java-suddy.iteye.com/" target="_blank"><img src="&quot;java_suddy的博客: “平凡”的思想&quot;" alt="java_suddy的博客"></a></p>
<p><a href="http://java-suddy.iteye.com/" target="_blank">java_suddy</a>
<a href="http://liuxinglanyue.iteye.com/" target="_blank"><img src="&quot;liuxinglanyue的博客: liuxinglanyue&quot;" alt="liuxinglanyue的博客"></a></p>
<p><a href="http://liuxinglanyue.iteye.com/" target="_blank">liuxinglanyue</a></p>
<p><a href="http://libo-591.iteye.com/" target="_blank"><img src="&quot;libo_591的博客: 让更多的人站在巨人的肩膀上&quot;" alt="libo_591的博客"></a></p>
<p><a href="http://libo-591.iteye.com/" target="_blank">libo_591</a></p>
<h3 id="-">博客分类</h3>
<ul>
<li><a href="http://java-mzd.iteye.com/" target="_blank">全部博客 (43)</a></li>
<li><a href="http://java-mzd.iteye.com/category/133623" target="_blank">数据结构----------JAVA类集 (5)</a></li>
<li><p><a href="http://java-mzd.iteye.com/category/153171" target="_blank">TCP/IP (7)</a></p>
<h3 id="-http-java-mzd-iteye-com-blog-guest_book-">我的留言簿 <a href="http://java-mzd.iteye.com/blog/guest_book" target="_blank">&gt;&gt;更多留言</a></h3>
</li>
<li><p>楼主 你工作多久了。。。。
-- by <a href="http://java-mzd.iteye.com/blog/guest_book#39913" target="_blank">fanmingxing</a></p>
</li>
<li>写的不错，学习，谢谢！
-- by <a href="http://java-mzd.iteye.com/blog/guest_book#39693" target="_blank">chenge2k</a></li>
<li>看了LZ的文章，发现工作快两年的我，就像是一块浮起来的木头，真的很惭愧！也不怪我拿 ...
-- by <a href="http://java-mzd.iteye.com/blog/guest_book#39618" target="_blank">GoTiger</a></li>
</ul>
<h3 id="-">其他分类</h3>
<ul>
<li><a href="http://java-mzd.iteye.com/blog/favorite" target="_blank">我的收藏</a> (23)</li>
<li><a href="http://java-mzd.iteye.com/blog/code_favorite" target="_blank">我的代码</a> (0)</li>
<li><a href="http://java-mzd.iteye.com/blog/topic" target="_blank">我的论坛主题帖</a> (3)</li>
<li><a href="http://java-mzd.iteye.com/blog/post" target="_blank">我的所有论坛帖</a> (37)</li>
<li><p><a href="http://java-mzd.iteye.com/blog/article" target="_blank">我的精华良好帖</a> (0)</p>
<h3 id="-">最近加入群组</h3>
</li>
<li><p><a href="http://android.group.iteye.com/" target="_blank">Android</a></p>
</li>
</ul>
<h3 id="-">存档</h3>
<ul>
<li><a href="http://java-mzd.iteye.com/blog/monthblog/2011-05" target="_blank">2011-05</a> (2)</li>
<li><a href="http://java-mzd.iteye.com/blog/monthblog/2011-04" target="_blank">2011-04</a> (7)</li>
<li><a href="http://java-mzd.iteye.com/blog/monthblog/2011-03" target="_blank">2011-03</a> (2)</li>
<li><p><a href="http://java-mzd.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://java-mzd.iteye.com/blog/1050043" title="腾讯、淘宝、金山网络，实习生我该何去何从" target="_blank">腾讯、淘宝、金山网络，实习生我该何去何从</a></p>
</li>
<li><a href="http://java-mzd.iteye.com/blog/1050926" title="淘宝、金山网络，百感交集" target="_blank">淘宝、金山网络，百感交集</a></li>
<li><a href="&quot;TCP/IP传输层，你懂多少？&quot;">TCP/IP传输层，你懂多少？</a></li>
<li><a href="http://java-mzd.iteye.com/blog/1004784" title="淘宝武汉*面试归来" target="_blank">淘宝武汉/*面试归来</a></li>
<li><p><a href="http://java-mzd.iteye.com/blog/862787" title="开源软件？自由软件？免费软件？你了解多少？" target="_blank">开源软件？自由软件？免费软件？你了解多少 ...</a></p>
</li>
<li><p><a href="http://java-mzd.iteye.com/rss" target="_blank"><img src="" alt="Rss"></a></p>
</li>
<li><a href="http://fusion.google.com/add?feedurl=http://java-mzd.iteye.com/rss" target="_blank"><img src="" alt="Rss_google"></a>
声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2011 ITeye.com. All rights reserved. [ 京ICP证110151号 ]
<img src="" alt=""></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/TCPIP/">TCPIP</a></li></span></span> | <span class="tags">Tagged <a href="/tags/TCPIP/" class="label label-primary">TCPIP</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-TCPIP--TCPIP传输层，你懂多少？--ITeye技术网站/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-TCPIP--TCPIP传输层，你懂多少？--ITeye技术网站" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-TCPIP--TCPIP网络层谜云--ITeye技术网站/">TCP IP网络层谜云 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-TCPIP--TCPIP网络层谜云--ITeye技术网站/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="tcp-ip-iteye-">TCP IP网络层谜云 - - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">新闻</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://java-mzd.iteye.com/blog/1019088#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/wiki" target="_blank">专栏</a>  <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://java-mzd.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/all" target="_blank">我的应用</a> <a href="http://java-mzd.iteye.com/login" target="_blank">登录</a> <a href="http://java-mzd.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-java-mzd-http-java-mzd-iteye-com-"><a href="http://java-mzd.iteye.com/" target="_blank">java-mzd</a></h1>
<p>永久域名 <a href="http://java-mzd.iteye.com/" target="_blank"><a href="http://java-mzd.iteye.com">http://java-mzd.iteye.com</a></a></p>
<p><a href="http://java-mzd.iteye.com/blog/1019088#" target="_blank">4顶</a>
<a href="http://java-mzd.iteye.com/blog/1019088#" target="_blank">3踩</a></p>
<p><a href="http://java-mzd.iteye.com/blog/1019089" title="TCP/IP网络层谜云之ICMP" target="_blank">TCP/IP网络层谜云之ICMP</a> | <a href="http://java-mzd.iteye.com/blog/1007577" title="TCP/IP传输层，你懂多少？" target="_blank">TCP/IP传输层，你懂多少？</a></p>
<p>2011-04-27</p>
<h3 id="-tcp-ip-"><a href="">TCP/IP网络层谜云</a></h3>
<p><strong>文章分类:<a href="http://www.iteye.com/blogs/category/java" target="_blank">Java编程</a></strong></p>
<p>PS.又调了好几遍，还是无法将整篇文章作为一个博客发表。所以，还是将文件分成两部分吧。</p>
<p>第一部分主要介绍网络层的基本知识</p>
<p>第二部分介绍ICMP有关知识。
<strong>你所不知道的网络层</strong></p>
<hr>
<p>**上文《TCP/IP传输层，你懂多少》 <a href="http://java-mzd.iteye.com/blog/1007577中，我们介绍了“传输层是如何为数据提供端对端的服务的”" target="_blank">http://java-mzd.iteye.com/blog/1007577中，我们介绍了“传输层是如何为数据提供端对端的服务的”</a>.</p>
<p>可是，数据包又是怎样从你的电脑出发，历经网络世界的艰辛，到达对方电脑的呢？在网络的世界当中，你的数据包又会遇到些什么问题？它们又是怎么解决的你？要回答这个问题，我们就必须研究TCP/IP协议栈中的Internet层（和数据链路层了）。**</p>
<p><strong>同以往一样，给出我自己认为会遇到的15个问题，并且列出来，如果大家能熟练的回答，请您绕道。</strong></p>
<ol>
<li>网络层的作用？</li>
<li>网络层有哪些协议？</li>
<li>IP数据包的格式？</li>
<li>IP数据包传输的过程？</li>
<li>为什么需要ARP协议？</li>
<li>ARP协议通信过程是怎么样的？（ARP协议如何控制网络？）</li>
<li>数据包的最大值？（分片的地方？分片重组的地方？分片的原则？）</li>
<li>数据包在局域网内怎么从一台主机传送到另外一台主机？</li>
<li>数据怎么实现跨网段传输？（路由如何实现跨网段传输？）</li>
<li>什么是默认网关？</li>
<li>代理ARP的作用？</li>
<li>数据跨网段传输时在路由器中的具体情形？（所谓的穿过路由是指什么？）</li>
<li>数据包路由的过程？</li>
<li>为什么需要ICMP协议？（ICMP协议差错控制与TCP差错控制对比）</li>
<li>什么是ICMP协议？</li>
<li>ICMP协议有哪些数据包？（Ping程序的实现？trancerouter程序的实现？） </li>
</ol>
<p><strong>一。网络层的作用：</strong> </p>
<p>TCP/IP协议栈的<strong>Internet层主要负责处理主机到主机的通信**</strong>，决定数据包如何交付**：是交给网关(路由器)还是交给本地端口。</p>
<p><strong>二。网络层的协议及作用：</strong></p>
<p>网际协议IP：用来路由</p>
<p>网际控制报文协议 ICMP：给IP层提供一定的可靠性</p>
<p>地址解析协议ARP：</p>
<p>反向地址解析协议RARP</p>
<p><strong>三。IP数据包格式：</strong> </p>
<p>版本（4）</p>
<p>头长度（4）</p>
<p>服务类型（8）</p>
<p>总长度（16） 标识（16）</p>
<p>标志（3）</p>
<p>段位移（13） 生存期（8）</p>
<p>协议（8）</p>
<p>头校验和（16） 源IP地址（32） 目的IP地址（32） IP选项（0或者32） 数据</p>
<p><strong>四。数据包传输的过程</strong></p>
<p>首先，传输层将封装好的数据交给Internet层，Internet层收到数据后，<strong>将数据封装成一个**</strong>IP<strong>**数据包。</strong></p>
<p><strong>注意协议之间的底层无关性：</strong>Internet层封装上层数据包时，不关心不管上层传给他的是UDP数据包还是TCP数据包，都将上层传来的数据封装为IP数据包。同样，传输层在封装用户信息流时也是同样的不关心上层数据的内容。</p>
<hr>
<p><strong>五。为什么需要ARP协议？</strong></p>
<p><strong>IP数据包要想继续向下发送，就必须转化为在物理设备上传输的数据帧。</strong> </p>
<p>在物理设备上传输数据时，数据包首先是被网卡接收，如果网卡接收到的数据包的硬件地址与本机不符，则直接丢弃，如果相符，再交由上层协议处理的。而在我们的网络通信中，源主机的应用程序知道目的程序的IP地址和端口号，却不知道目的主机的硬件地址，<strong>因此在通讯前必须获得目的主机的硬件地址。ARP**</strong>协议就起到这个作用。**</p>
<hr>
<p><strong>六。ARP**</strong>协议通信过程？**</p>
<p><strong>每台机器上都维护着一个ARP缓存表，保存着IP地址到MAC**</strong>地址的映射**</p>
<p>注意：缓存表中的记录有过期时间T，如果T时间内没有再次使用某条记录，则该记录失效，下次使用时，还要再次发ARP请求来获得目的主机的硬件地址。</p>
<p>作用：因为我们的机器需要和大量机器通信，如果没有过期机制的话，显然将会产生巨大的记录量，降低效率。</p>
<p>主机A要和主机B（192.168.0.1）通信，则先查询主机A中的ARP缓存表，看是否有该记录，如果有，则取出对应MAC地址。</p>
<p>如果缓存中没有该记录，主机A发出ARP请求，询问“IP地址是192.168.0.1的主机的硬件地址是多少”，并将这个ARP请求<strong>广播</strong>到本地网段（本地网段的任何一个主机都可能是接受者，所以用广播, 广播的目的MAC地址为:FF:FF:FF:FF:FF:FF）主机B收到广播的ARP请求，发现其中的IP地址（192.168.0.1）与本机相符，发送一个ARP应答数据包给源主机，将自己的硬件地址填写在应答包中,主机A接收ARP应答，提取MAC地址，并且将IP和MAC映射存入ARP缓存。</p>
<p>对于其他主机，虽然这个ARP请求可能与它无关，但ARP协议软件也会把其中的源MAC地址与源IP地址的映射记录下来，这样做能够有效的减少ARP请求在局域网的发送次数。 </p>
<p><strong>ARP欺骗的原理：</strong> </p>
<p>通过以上的知识，我们可以知道，主机A要和主机B通信，必须请求得到主机B的MAC地址，而MAC地址，又是通过ARP请求来得到的。又，根据ARP请求的广播机制，与非接收主机也会讲收到的ARP请求存入自己的ARP缓存。那么，我们可以自己发送一个ARP请求，将默认网关的IP作为发送IP，自己的MAC地址作为发送的MAC地址，随便请求一个IP地址的MAC地址。这样，网络中的所有计算机都会更新到默认网关的ARP缓存，而将默认网关IP对于的MAC地址改为我们网卡的MAC地址。从而，发送给默认网关的IP数据帧都会发送给我们自己的主机，我们监视完IP数据包后，再将IP数据包转发出去，即可通过ARP欺骗来完成对网络的监控。同样。当我们只进行ARP欺骗，而不进行转发的时候，则整个网络(内网)都将瘫痪。</p>
<p>当然，这些都只是雕虫小计，装了ARP防火墙的机器，你就不能监控了，要实现监控，最好的方式，还是把你的机器，作为内网的默认网关，所有通往外网的机器都通过你的主机。这样比较合适。</p>
<p><strong>七。数据包的最大值：</strong></p>
<p>就像前面我们说的，IP数据包要想继续向下发送，就必须转化为在物理设备上传输的数据帧。<strong>对于网络硬件来说，能传输的物理帧的大小是有物理上限的</strong>。这个上限值就是最大传输单元MTU。{令牌环网4500字节，以太网1500字节}。当数据包的比MTU大的时候，数据包是无法封装成帧在网络上传输的，当数据包比MTU小的时候，显然又会浪费网络带宽。</p>
<p>因此，<strong>IP数据包最理想的大小应该是相连网络的MTU相符。</strong>又因为 ，<strong>不同的网络MTU可能不同，当数据包需要经过较小MTU的网络时，我们需要将大数据包划分成更小的数据包（分片），以确保他们能通过无力处理大IP数据包的网络。</strong></p>
<p>分片发生的位置：相连MTU网络间的路由</p>
<p>分片重组的位置：目标主机</p>
<p>分片发生在IP层，通过IP数据报报头中的“标志”和“段位移”来标识</p>
<p>(标识由)</p>
<p>分片后，<strong>形成的还是IP数据包</strong>，在路由中的处理方式与其他IP数据包一样</p>
<p> 分片示意图：</p>
<pre><code>    原始数据包：
</code></pre><p>IP报头</p>
<p>数据1480字节</p>
<p> 分片以后数据包</p>
<p>IP报头</p>
<p>数据600字节</p>
<p>段位移0</p>
<p>IP报头</p>
<p>数据600字节</p>
<p>段位移600</p>
<p>IP报头</p>
<p>数据280字节  段位移1200</p>
<p><strong>分片的优点</strong>：可以让数据包穿过MTU多变的网络。</p>
<p><strong>缺点</strong>：分片后形成的多个IP数据包，每个都单独路由，又因为重组发送在目标主机，且又一个分片丢失，则整个原始IP数据包丢失，增大丢包风险。</p>
<p>说了这么多，我们还是只是不知道，<strong>数据怎么从一台主机到另外一台主机</strong>，接下来，我们一一分解，先从局域网开始。</p>
<p><strong>八。数据在局域网中是如何传播的？</strong></p>
<p>我们知道，在局域网中，无论是按何种拓扑结构组网，还是按何种方式来处理介质访问权限，任何<strong>两个节点之间都存在实际的线路链接</strong>。</p>
<p>因此，我们通过ARP协议，得到目标主机的MAC地址后，在数据链路层将IP数据包封装为数据帧，将数据帧发送到本地网段上，即可将数据帧成功的交给目标主机（目标主机网卡收到数据帧后，判断MAC地址是否为本网卡MAC地址）。
当你要和很多很多主机通信时，你不可能保证他们都和你在同一网段内</p>
<p>那么不在一个局域网的数据之间，又是如何通信的呢？</p>
<p><strong>九。数据是怎么样实现跨网段传输的？</strong></p>
<p>这就需要路由器通过IP协议来完成此工作了。</p>
<p>下面我们通过一个实际的例子来看：主机A：192.168.1.1 需要和主机B:172.16.1.1通信。</p>
<pre><code>      ![]()
</code></pre><p>两个主机并不在同一个局域网，并没有实际的物理线路将他们链接起来。</p>
<p>这个时候，<strong>我们在两个网段之间增加一个中转点（路由器），</strong>路由器上<strong>插有多个网卡</strong>,可以同时通过网卡E0接入局域网1 （192.168.1.0/24），同时通过网卡E2接入局域网2（172.168.1.0/24）。这样，局域网1中的机器A（192.168.1.1）要和局域网2中的机器B（172.16.1.1）通信。<strong>A将数据将数据包发送到本网段，路由器的E1口接收数据包，再将其通过E2口发送到网段B，主机B即可成功接收来自主机A的信息了。即可实现数据的跨网段传输。</strong></p>
<p><strong>大家发现问题了嘛？</strong></p>
<p>没错，我们前面说了“网卡接收数据包后，首先判断MAC地址是不是本机地址，如果不是，则丢弃。”</p>
<p>而且我们说了“ARP请求是发送广播”，而大家都知道，为了防止广播风暴，路由器是不转发广播的。</p>
<p>那么，这个时候，即使A能有办法获得B的MAC地址，路由器的E1口上的网卡，MAC地址也不是B的MAC地址，这个时候，我们该怎么办呢？</p>
<p><strong>十。什么是默认网关？</strong></p>
<p><strong>默认网关是TCP/IP中的一个配置参数，它是处于本地网络上的某个路由器的接口的IP地址。</strong></p>
<p>在有默认网关的情况下，目的地为非本网段的数据包，源主机都发送给默认网关，由默认网关将数据包正确的发送给目标主机。</p>
<p>在上图中，网络192.168.1.0/24的默认网关为192.168.1.254，目的地为非本地网段的数据包，都发送给这个IP对应的Router，再由该Router转发给目的主机。</p>
<p><strong>十一：什么是代理ARP?</strong></p>
<p>在没有默认网关的情况下，我们也可以使用代理ARP技术来实现让路由器完成数据的跨网段传输功能。</p>
<p>如果我们<strong>将网络中所有主机的目的地都设为本地网络</strong>，那么当有要发送给外网IP的数据包时，源主机依然会认为目的地为本网段，而使用目的IP发出ARP请求。这个时候，对于目的IP不是本网段的ARP请求，连接在本网段的路由器使用自己的MAC地址回复这个ARP请求。于是主机A将数据发到本地网段，连在本地网络的路由器接收数据，路由器再将数据转发到正确的目的地。（<strong>其实运行代理ARP的路由器就相当于默认网关</strong>）</p>
<p> <strong>代理ARP的优点</strong>：简化了主机的管理（不用再每个主机都单独配置默认网关了）</p>
<p>  <strong>缺点</strong>：因为针对每个局域网，外网IP都是很多的，所以：</p>
<pre><code> 1.在路由器上需要保存一个很大的ARP缓存。

     2.每个外网IP都需要发送ARP请求，增大了内网的通信。
</code></pre><p>在上图中，当没有设置默认网关的时候，主机A发送给主机B的数据包，主机A发送ARP请求后，由连接E1口的Router 用自己E1口的MAC地址回复该ARP请求 。</p>
<p><strong>路由器在E1口接到数据包后，怎么样通过E2口发到主机B所在的网段上去？</strong></p>
<p><strong>十二.路由器中数据跨网段传输的具体情形？</strong></p>
<p><strong>每个路由器中都存有一张路由表，记录着目标网段和对应的网卡出口的映射。</strong></p>
<p>在上面的例子中，路由器的E1口收到数据包，根据数据包取出对应的目的网段的地址172.16.1.1，然后路由器查找路由表，根据IP地址，找到通过E2口可以达到目标网络。于是，路由将数据包从E1口读入，穿过路由器，从E2口写出。</p>
<p><strong>所谓的穿过路由器</strong>，应该是指：两个网卡上都分别运行着TCP/IP协议，穿过路由，即从路由的内存中，将数据从网卡1的IP程序拷贝到网卡2的IP程序。</p>
<p>至此，关于路由中的部分，我们就几乎讲完了，我们再来总结下：</p>
<p><strong>【路由器都有哪些功能？】</strong></p>
<p>   1.<strong>交换和转发功能：将数据从路由器的进入接口，穿过路由器，送到输出接口。</strong></p>
<p>  （将一个数据包从一个网段，发送到另外一个网段。）</p>
<p>   2.<strong>路由功能：即寻址</strong>，通过IP数据包决定正确的下一跳路径</p>
<p> （通过哪个网卡写出。）</p>
<p><strong>【路由器实现跨网段传输的基础？】</strong></p>
<p>1.<strong>硬件基础</strong>：有多个网卡，同时在多个网段上，同时属于多个局域网。</p>
<p>2.<strong>软件基础：</strong>代理ARP（主机将目的地址都配置为本网段，路由器代理回应ARP请求）</p>
<p>在实际中的很多情况下，两个局域网之间可能不仅仅隔了一个网段，同理，我们可以在多个网段之间，通过多个路由器而使彼此连接起来。<strong>其实路由器就是将世界各地的各个局域网都连接起来，得到了我们现在的互联网。</strong></p>
<p><strong>十三：路由过程：</strong></p>
<p>1.主机A的传输层将数据交给网络层，网络层加上双方IP地址，TTL等IP报头信息，成为IP数据包，网络层将IP数据报交给数据链路层。</p>
<p>2.数据链路层根据IP地址，通过ARP得到MAC，封装为物理帧，通过网卡发出。</p>
<p>3.主机B接收物理帧，根据MAC地址判断：如果目的MAC地址不是本网卡MAC地址，则丢弃；如果是发给自己的，则交给网络层处理。</p>
<p>4.网络层通过IP地址判断：如果是发给自己的，则交给上层协议处理；如果不是发给自己的，则在路由表中查找此IP合理的下一跳地址（即通过哪个网卡发送到下一个网段），并将数据通过内存，从接收数据网卡的IP程序拷贝到需要发送数据网卡的IP程序。在发送网卡中，IP程序将数据包交给链路层，链路层发送ARP请求，得到下一跳的目的MAC地址，封装为帧，发送。</p>
<p><strong>如此反复，直到IP数据包到达最终正确的接收主机。</strong></p>
<p><strong>好了，关于ARP和IP都讲了挺多了，可是，为什么有ICMP协议呢？这个协议是干嘛的呢？
</strong></p>
<p>预知详情，请看下篇《TCP/IP网络层谜云之ICMP》 <a href="http://java-mzd.iteye.com/blog/1019089" target="_blank"><a href="http://java-mzd.iteye.com/blog/1019089">http://java-mzd.iteye.com/blog/1019089</a></a></p>
<p><a href="http://java-mzd.iteye.com/blog/1019088#"><strong>4</strong>
顶</a><a href="http://java-mzd.iteye.com/blog/1019088#"><strong>3</strong>
踩</a>
<a href="http://java-mzd.iteye.com/blog/1019089" title="TCP/IP网络层谜云之ICMP" target="_blank">TCP/IP网络层谜云之ICMP</a> | <a href="http://java-mzd.iteye.com/blog/1007577" title="TCP/IP传输层，你懂多少？" target="_blank">TCP/IP传输层，你懂多少？</a></p>
<ul>
<li>00:37</li>
<li>浏览 (311)</li>
<li><a href="http://java-mzd.iteye.com/blog/1019088#comments" target="_blank">评论</a> (0)</li>
<li>分类: <a href="http://java-mzd.iteye.com/category/153171" target="_blank">TCP/IP</a></li>
<li><a href="http://www.iteye.com/wiki/topic/1019088" target="_blank">相关推荐</a><h3 id="-">评论</h3>
</li>
</ul>
<p><a href=""></a></p>
<h3 id="-">发表评论</h3>
<h3 id="-">表情图标</h3>
<p><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""></p>
<p>字体颜色: 标准深红红色橙色棕色黄色绿色橄榄青色蓝色深蓝靛蓝紫色灰色白色黑色 字体大小: 标准1 (xx-small)2 (x-small)3 (small)4 (medium)5 (large)6 (x-large)7 (xx-large) 对齐: 标准居左居中居右</p>
<p>提示：选择您需要装饰的文字, 按上列按钮即可添加上相应的标签</p>
<p>您还没有登录，请<a href="http://java-mzd.iteye.com/login" target="_blank">登录</a>后发表评论(快捷键 Alt+S / Ctrl+Enter)</p>
<p><a href="http://java-mzd.iteye.com/" target="_blank"><img src="&quot;java_mzd的博客: &quot;" alt="java_mzd的博客"></a></p>
<p>java_mzd</p>
<ul>
<li>浏览: 70754 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 长沙</li>
<li><img src="" alt=""></li>
<li><a href="http://java-mzd.iteye.com/blog/profile" target="_blank">详细资料</a> <a href="http://java-mzd.iteye.com/blog/guest_book" target="_blank">留言簿</a></li>
</ul>
<h3 id="-">搜索本博客</h3>
<h3 id="-http-java-mzd-iteye-com-blog-user_visits-">最近访客 <a href="http://java-mzd.iteye.com/blog/user_visits" target="_blank">&gt;&gt;更多访客</a></h3>
<p><a href="http://aria.iteye.com/" target="_blank"><img src="&quot;aria的博客: &quot;" alt="aria的博客"></a></p>
<p><a href="http://aria.iteye.com/" target="_blank">aria</a></p>
<p><a href="http://zhxing.iteye.com/" target="_blank"><img src="&quot;zhxing的博客: ヾ孤星随缘ツ  http://t.sina.com.cn/samzhxing&quot;" alt="zhxing的博客"></a></p>
<p><a href="http://zhxing.iteye.com/" target="_blank">zhxing</a>
<a href="http://java-suddy.iteye.com/" target="_blank"><img src="&quot;java_suddy的博客: “平凡”的思想&quot;" alt="java_suddy的博客"></a></p>
<p><a href="http://java-suddy.iteye.com/" target="_blank">java_suddy</a></p>
<p><a href="http://liuxinglanyue.iteye.com/" target="_blank"><img src="&quot;liuxinglanyue的博客: liuxinglanyue&quot;" alt="liuxinglanyue的博客"></a></p>
<p><a href="http://liuxinglanyue.iteye.com/" target="_blank">liuxinglanyue</a></p>
<h3 id="-">博客分类</h3>
<ul>
<li><a href="http://java-mzd.iteye.com/" target="_blank">全部博客 (43)</a></li>
<li><a href="http://java-mzd.iteye.com/category/133623" target="_blank">数据结构----------JAVA类集 (5)</a></li>
<li><p><a href="http://java-mzd.iteye.com/category/153171" target="_blank">TCP/IP (7)</a></p>
<h3 id="-http-java-mzd-iteye-com-blog-guest_book-">我的留言簿 <a href="http://java-mzd.iteye.com/blog/guest_book" target="_blank">&gt;&gt;更多留言</a></h3>
</li>
<li><p>楼主 你工作多久了。。。。
-- by <a href="http://java-mzd.iteye.com/blog/guest_book#39913" target="_blank">fanmingxing</a></p>
</li>
<li>写的不错，学习，谢谢！
-- by <a href="http://java-mzd.iteye.com/blog/guest_book#39693" target="_blank">chenge2k</a></li>
<li>看了LZ的文章，发现工作快两年的我，就像是一块浮起来的木头，真的很惭愧！也不怪我拿 ...
-- by <a href="http://java-mzd.iteye.com/blog/guest_book#39618" target="_blank">GoTiger</a></li>
</ul>
<h3 id="-">其他分类</h3>
<ul>
<li><a href="http://java-mzd.iteye.com/blog/favorite" target="_blank">我的收藏</a> (23)</li>
<li><a href="http://java-mzd.iteye.com/blog/code_favorite" target="_blank">我的代码</a> (0)</li>
<li><a href="http://java-mzd.iteye.com/blog/topic" target="_blank">我的论坛主题帖</a> (3)</li>
<li><a href="http://java-mzd.iteye.com/blog/post" target="_blank">我的所有论坛帖</a> (37)</li>
<li><p><a href="http://java-mzd.iteye.com/blog/article" target="_blank">我的精华良好帖</a> (0)</p>
<h3 id="-">最近加入群组</h3>
</li>
<li><p><a href="http://android.group.iteye.com/" target="_blank">Android</a></p>
</li>
</ul>
<h3 id="-">存档</h3>
<ul>
<li><a href="http://java-mzd.iteye.com/blog/monthblog/2011-05" target="_blank">2011-05</a> (2)</li>
<li><a href="http://java-mzd.iteye.com/blog/monthblog/2011-04" target="_blank">2011-04</a> (7)</li>
<li><a href="http://java-mzd.iteye.com/blog/monthblog/2011-03" target="_blank">2011-03</a> (2)</li>
<li><p><a href="http://java-mzd.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://java-mzd.iteye.com/blog/1050043" title="腾讯、淘宝、金山网络，实习生我该何去何从" target="_blank">腾讯、淘宝、金山网络，实习生我该何去何从</a></p>
</li>
<li><a href="http://java-mzd.iteye.com/blog/1050926" title="淘宝、金山网络，百感交集" target="_blank">淘宝、金山网络，百感交集</a></li>
<li><a href="http://java-mzd.iteye.com/blog/1007577" title="TCP/IP传输层，你懂多少？" target="_blank">TCP/IP传输层，你懂多少？</a></li>
<li><a href="http://java-mzd.iteye.com/blog/1004784" title="淘宝武汉*面试归来" target="_blank">淘宝武汉/*面试归来</a></li>
<li><p><a href="http://java-mzd.iteye.com/blog/862787" title="开源软件？自由软件？免费软件？你了解多少？" target="_blank">开源软件？自由软件？免费软件？你了解多少 ...</a></p>
</li>
<li><p><a href="http://java-mzd.iteye.com/rss" target="_blank"><img src="" alt="Rss"></a></p>
</li>
<li><a href="http://fusion.google.com/add?feedurl=http://java-mzd.iteye.com/rss" target="_blank"><img src="" alt="Rss_google"></a>
声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2011 ITeye.com. All rights reserved. [ 京ICP证110151号 ]
<img src="" alt=""></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/TCPIP/">TCPIP</a></li></span></span> | <span class="tags">Tagged <a href="/tags/TCPIP/" class="label label-primary">TCPIP</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-TCPIP--TCPIP网络层谜云--ITeye技术网站/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-TCPIP--TCPIP网络层谜云--ITeye技术网站" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-Nutz--Nutz的数据库事务/">Nutz的 数据库事务</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-Nutz--Nutz的数据库事务/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="nutz-">Nutz的 数据库事务</h1>
<p>1.数据库事务
 数据库的事务是作为单个逻辑工作单元执行的一系列操作。一个逻辑工作单元必须有四个属性，称为原子性、一致性、隔离性和持久性 (ACID) 属性，只有这样才能成为一个事务。一般来讲，隔离性是通过锁机制来实现，而其他三个特性通过日志机制实现。
 当一个数据库的某些数据由多个客户端并发访问操作的时候，可能会出现一系列的问题：(1)脏读(dirty read),(2)不可重复读(unrepeatable read),(3)幻象读(phantom read),(4)丢失更新</p>
<p>2.使用Nutz来处理事务
 在nutz中使用一个类org.nutz.trans.Trans来处理事务，使用方式如下：
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"></a></p>
<ol>
<li>//TODO 选择事务级别   </li>
<li>int level=Connection.TRANSACTION_SERIALIZABLE;  </li>
<li>Trans.exec(level, new Atom(){  </li>
<li>@Override  </li>
<li>public void run() {  </li>
<li>//TODO 事务内的操作逻辑  </li>
<li>}     </li>
<li>});  </li>
</ol>
<p>  当然你也可是使用如下默认方式：</p>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"></a></p>
<ol>
<li>Trans.exec(new Atom(){  </li>
<li>@Override  </li>
<li>public void run() {  </li>
<li>//TODO   </li>
<li>}  </li>
<li><p>});  </p>
<p>在这种情况下，level默认是Connection.TRANSACTION_READ_COMMITTED
注：如果你使用jdbc来直接操作事务，当然你可以在某一个位置设置保存点，如果事务失败，可以回滚到那个点，在nutz中整个事务要么成功，要么失败，全部回滚。如果你希望使用savepoint改怎么办呢，你可以这么用：</p>
</li>
</ol>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"></a></p>
<ol>
<li>Dao dao=null;  </li>
<li>dao.run(new ConnCallback(){  </li>
<li>@Override  </li>
<li>public void invoke(Connection conn) throws Exception {  </li>
<li>// TODO 在这里面使用Connection来操作     </li>
<li>}     </li>
<li>});  </li>
</ol>
<p>3.ThreadLocal
 Nutz在实现Trans这个类的时候用到了ThreadLcoal（方便了使用者存储变量到当前线程。）,用来存储用户的每一次事务动作。具体实现请参见源代码类org.nutz.trans.Trans。 </p>
<p>来源： <a href="[http://amosleaf.iteye.com/blog/548337](http://amosleaf.iteye.com/blog/548337)">[http://amosleaf.iteye.com/blog/548337](http://amosleaf.iteye.com/blog/548337)</a></p>
<p>4、事务的嵌套</p>
<h2 id="-">设置事务的级别</h2>
<p>在 JDBC 的 java.sql.Connection 接口中定义的 setTransactionIsolation 函数可以设置事务的级别Nutz.Dao 也提供另外一个静态函数，允许你设置事务的级别:</p>
<p><strong>Trans.exec 的函数声明</strong>
public static void exec(int level, Atom... atoms);</p>
<p>这里的第一个参数 level 和 java.sql.Connection 接口中的 setTransactionIsolation 规定的 level 是一样的。下面是在 java.sql.Connection 里面关于 level 参数的 JDoc 说明：</p>
<p>它可以是下列常量中的任意一个值：</p>
<ul>
<li>Connection.TRANSACTION_READ_UNCOMMITTED</li>
<li>Connection.TRANSACTION_READ_COMMITTED</li>
<li>Connection.TRANSACTION_REPEATABLE_READ</li>
<li>Connection.TRANSACTION_SERIALIZABLE</li>
</ul>
<p><strong>注意： </strong>不能使用常量 Connection.TRANSACTION_NONE，因为它的意思是“不支持事务”</p>
<p>关于 level 参数的更多说明，请参看<a href="http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#setTransactionIsolation(int" target="_blank">java.sql.Connection 的文档</a>)</p>
<p>不同的数据库，对于 JDBC 事务级别的规范，支持的力度不同。请参看相应数据库的文档，已 确定你设置的数据库事务级别是否被支持。</p>
<p><a href="http://code.google.com/p/nutz/wiki/dao_transaction#Top" target="_blank">/#Top</a></p>
<h2 id="-"><a href=""></a>事务的嵌套</h2>
<p>Nutz 的事务模板可以嵌套吗？ 答案是肯定的。事实上，Nutz 支持事务模板的无限层级嵌套。</p>
<p>这里，如果每一层嵌套，指定的事务级别有所不同，不同的数据库，可能引发不可预知的错误。所以，嵌套的事务模板的事务，将以最顶层的事务为级别为标准。就是说，如果最顶层的事务级别为 &#39;TRANSACTION_READ_COMMITTED&#39;，那么下面所包含的所有事务，无论你指定什么样的事务级别，都是 &#39;TRANSACTION_READ_COMMITTED&#39;， 这一点，由抽象类 Transaction 来保证。其 setLevel 当被设置了一个大于 0 的整数以后，将不再 接受任何其他的值。</p>
<p>你可以通过继承 Transaction 来修改这个默认的行为，当然，这个行为修改一般是没有必要的。</p>
<p>另外，你还可能需要知道，通过 Trans.setup 方法，能让整个虚拟机的 Nutz 事务操作都使用你的 Transaction 实现</p>
<p>下面我给出两个例子:</p>
<p><strong>最外层模板决定了整个事务的级别:</strong>
Trans.exec(Connection.TRANSACTION_READ_COMMITTED, new Atom(){
        public void run(){
                dao.update(xxx);
                dao.update(bbb);
                // 在下层模板，虽然你指定了新的事务级别，但是这里的事务级别还是
                // &#39;TRANSACTION_READ_COMMITTED&#39;。在一个事务中，级别一旦设定就不可更改
                Trans.exec(Connection.TRANSACTION_SERIALIZABLE, new Atom(){
                        public void run(){
                                dao.update(CCC);
                                dao.update(EEE);
                        }
                });
        }
});</p>
<p><strong>让整个函数都是事务的:</strong></p>
<p>public void updatePet(final Pet pet){
        Trans.exec(new Atom(){
                public void run(){
                        dao.update(pet);
                        dao.update(pet.getMaster());
                }
        });
}
// 在另外一个函数里，可以这么使用
public void updateDogAndCat(final Pet dog, final Pet cat){
        Trans.exec(new Atom(){
                public void run(){
                        updatePet(dog);
                        updatePet(cat);
                }
        });
}</p>
<p>来源： <a href="[http://code.google.com/p/nutz/wiki/dao_transaction](http://code.google.com/p/nutz/wiki/dao_transaction)">[http://code.google.com/p/nutz/wiki/dao_transaction](http://code.google.com/p/nutz/wiki/dao_transaction)</a>
以上需要注意的几个细节,文档还没提及: <strong>1. 数据库连接池的AutoCommit属性</strong> 对于我见到的大部分连接池和数据库驱动,默认情况下AutoCommit=true,应该是为了性能 这就导致如果用户不自行设置的话,Trans的大部分操作都是不可回滚的.故,如果使用Trans,那么务必设置AutoCommit</p>
<p><strong>2. 多个数据源的事务</strong> 大部分情况下,用户都不是使用XA驱动,故,多数据源的事务提交,在最后的提交阶段出错的话,已经执行commit操作的数据源,是不可能回滚的</p>
<p><strong>3. 子线程的事务</strong> 考虑下面的代码:
Trans.exec(new Atom(){   public void run() {       dao.insert(pet);       new MySuperPowerThread().start();       dao.count(Pet.class);   }});</p>
<p>那么MySuperPowerThread的代码并不是在事务模板中执行的,因为这里的事务不会被子线程继承</p>
<p><strong>4. 返回值问题(更新了)</strong> 使用Molecule
Molecule<object> mc = new Molecule<object>() {    public void run() {        dao.insert(pet);        setObj(dao.count(Pet.class));    }};Trans.exec(mc);System.out.println(mc.getObj());</p>
<p>来源： <a href="[http://wendal.net/324.html](http://wendal.net/324.html)">[http://wendal.net/324.html](http://wendal.net/324.html)</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Nutz/">Nutz</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Nutz/" class="label label-primary">Nutz</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-Nutz--Nutz的数据库事务/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-Nutz--Nutz的数据库事务" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/28/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/26/">26</a></li><li><a class="page-number" href="/page/27/">27</a></li><li><a class="page-number" href="/page/28/">28</a></li><li class="active"><li><span class="page-number current">29</span></li><li><a class="page-number" href="/page/30/">30</a></li><li><a class="page-number" href="/page/31/">31</a></li><li><a class="page-number" href="/page/32/">32</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/30/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-26 21:21:32</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
