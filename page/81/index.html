
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 81 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-缓存-ehcache--Java缓存组件EhCache入门教程-OPEN开发经验库/">Java缓存组件 EhCache 入门教程 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-缓存-ehcache--Java缓存组件EhCache入门教程-OPEN开发经验库/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-ehcache-open-">Java缓存组件 EhCache 入门教程 - OPEN 开发经验库</h1>
<p><a href="http://lib.open-open.com/members/login?keepThis=true&amp;TB_iframe=true&amp;height=177&amp;width=278" title="登录OPEN经验库" target="_blank">登录</a>   <a href="http://lib.open-open.com/members/register?keepThis=true&amp;TB_iframe=true&amp;height=460&amp;width=710" title="注册新的账号" target="_blank">注册</a></p>
<ul>
<li><a href="http://www.open-open.com/" title="Java开源" target="_blank">Java开源</a></li>
<li><a href="http://www.php-open.com/" title="PHP开源" target="_blank">PHP开源</a></li>
<li><a href="http://ajax.open-open.com/" title="JS脚本大全" target="_blank">JS脚本大全</a></li>
<li><a href="http://home.open-open.com/" title="OPEN家园" target="_blank">OPEN家园</a></li>
<li>OPEN经验库</li>
<li><a href="http://doc.open-open.com/" title="OPEN文档频道" target="_blank">OPEN文档</a></li>
<li><a href="http://news.open-open.com/" title="OPEN资讯频道" target="_blank">OPEN资讯</a></li>
<li><a href="http://www.open-open.com/bbs" title="OPEN论坛频道" target="_blank">OPEN论坛</a></li>
</ul>
<p><a href="http://lib.open-open.com/" title="OPEN开发经验库" target="_blank"><img src="" alt="OPEN开发经验库"></a>
<a href="http://lib.open-open.com/list/all" target="_blank">所有分类</a>  &gt;  <a href="http://lib.open-open.com/list/1" target="_blank">软件开发</a>  &gt;  <a href="http://lib.open-open.com/list/7" target="_blank">缓存组件</a>  &gt;  <a href="http://lib.open-open.com/list/287" target="_blank">Ehcache</a></p>
<h3 id="java-ehcache-">Java缓存组件 EhCache 入门教程</h3>
<p><strong>您的评价</strong>:         <a href=""><strong>收藏该经验</strong></a></p>
<p>1.技术背景：</p>
<pre><code>系统缓存是位于应用程序与物理数据源之间，用于临时存放复制数据的内存区域，目的是为减少应用程序对物理数据源访问的次数，从而提高应用程序的运行性能。缓存设想内存是有限的，缓存的时效性也是有限的，所以可以设定内存数量的大小可以执行失效算法，可以在内存满了的情况下，按照最少访问等算法将缓存直接移除或切换到硬盘上。

Ehcache从Hibernate发展而来，逐渐涵盖了Cache界的全部功能，是目前发展势头最好的一个项目，具有快速、简单、低消耗、扩展性强、支持对象或序列化缓存，支持缓存或元素的失效，提供LRU、LFU和FIFO缓存策略，支持内存缓存和硬盘缓存和分布式缓存机制等特点。其中Cache的存储方式为内存或磁盘（ps：无须担心容量问题）
</code></pre><p>2.EhCahe的类层次介绍：</p>
<pre><code>主要分为三层，最上层是CacheManager，它是操作Ehcache的入口。可以通过CacheManager.getInstance()获得一个单子的CacheManager，或者通过CacheManager的构造函数创建一个新的CacheManager。每个CacheManger都管理多个Cache。每个Cache都以一种类Hash的方式，关联多个Element。Element就是我们用于存放缓存内容的地方。
</code></pre><p>3.环境搭建：</p>
<pre><code>很简单只需要将ehcache-2.1.0-distribution.tar.gz和ehcache-web-2.0.2-distribution.tar.gz挤压的jar包放入WEB-INF/lib下。

再创建一个重要的配置文件ehcache.xml，可以从ehcache组件包中拷贝一个，也可以自己建立一个，需要放到classpath下，一般放于/WEB-INF/classed/ehcache.xml；具体的配置文件可以网上搜一下
</code></pre><p>4.实际运用</p>
<pre><code>一个网站的首页估计是被访问次数最多的，我们可以考虑给首页做一个页面缓存；

缓存策略：应该是某个固定时间之内不变的，比如说2分钟更新一次，以应用结构page-filter-action-service-dao-db为例。

位置：页面缓存做到尽量靠近客户的地方，就是在page和filter之间，这样的优点就是第一个用户请求后，页面被缓存，第二个用户在请求，走到filter这个请求就结束了，需要在走到action-service-dao-db，好处当然是服务器压力大大降低和客户端页面响应速度加快。

首页页面缓存存活时间定为2分钟，也就是参数timeToLiveSeconds（缓存的存活时间）应该设置为120，同时timeToIdleSeconds（多长时间不访问缓存，就清楚该缓存）最好也设为2分钟或者小于2分钟。
</code></pre><p>﻿﻿﻿﻿</p>
<p>接着我们来看一下SimplePageCachingFilter 的配置，
<a href="http://lib.open-open.com/view/open1322892011546.html#viewSource" title="查看源码" target="_blank">查看源码</a><a href="http://lib.open-open.com/view/open1322892011546.html#printSource" title="打印" target="_blank">打印</a><a href="http://lib.open-open.com/view/open1322892011546.html#about" title="?" target="_blank">?</a></p>
<p>01</p>
<p>&lt;</p>
<p>filter</p>
<p>&gt;</p>
<p>02</p>
<p>&lt;</p>
<p>filter-name</p>
<blockquote>
<p>indexCacheFilterfilter-name&gt;
03</p>
</blockquote>
<p>&lt;</p>
<p>filter-class</p>
<p>&gt;</p>
<p>04</p>
<p>net.sf.ehcache.constructs.web.filter.SimplePageCachingFilter
05</p>
<p>&lt;</p>
<p>filter-class</p>
<p>&gt;</p>
<p>06</p>
<p>&lt;</p>
<p>filter</p>
<p>&gt;
07</p>
<p>&lt;</p>
<p>filter-mapping</p>
<p>&gt;</p>
<p>08</p>
<p>&lt;</p>
<p>filter-name</p>
<blockquote>
<p>indexCacheFilterfilter-name&gt;
09</p>
</blockquote>
<p>&lt;</p>
<p>url-pattern</p>
<blockquote>
<p>/*index.actionurl-pattern&gt;</p>
</blockquote>
<p>10</p>
<p>&lt;</p>
<p>filter-mapping</p>
<p>&gt;
将上述代码加入到web.xml，那么当打开首页时，你会发现2分钟才会有一堆sql语句出现在控制台，也可以调整为5分钟，总之一切尽在掌控之中。</p>
<p>当然，如果你像缓存首页的部分内容时，你需要使用SimplePageFragmentCachingFilter这个filter，我看一下：
<a href="http://lib.open-open.com/view/open1322892011546.html#viewSource" title="查看源码" target="_blank">查看源码</a><a href="http://lib.open-open.com/view/open1322892011546.html#printSource" title="打印" target="_blank">打印</a><a href="http://lib.open-open.com/view/open1322892011546.html#about" title="?" target="_blank">?</a></p>
<p>01</p>
<p>&lt;</p>
<p>filter</p>
<p>&gt;</p>
<p>02</p>
<p>&lt;</p>
<p>filter-name</p>
<blockquote>
<p>indexCacheFilterfilter-name&gt;
03</p>
</blockquote>
<p>&lt;</p>
<p>filter-class</p>
<p>&gt;</p>
<p>04</p>
<p>net.sf.ehcache.constructs.web.filter.SimplePageFragmentCachingFilter
05</p>
<p>&lt;</p>
<p>filter-class</p>
<p>&gt;</p>
<p>06</p>
<p>filter&gt;
07</p>
<p>&lt;</p>
<p>filter-mapping</p>
<p>&gt;</p>
<p>08</p>
<p>&lt;</p>
<p>filter-name</p>
<blockquote>
<p>indexCacheFilterfilter-name&gt;
09</p>
</blockquote>
<p>&lt;</p>
<p>url-pattern</p>
<blockquote>
<p>/*/index_right.jsp&lt;</p>
</blockquote>
<p>url-pattern</p>
<p>&gt;</p>
<p>10</p>
<p>&lt;</p>
<p>filter-mapping</p>
<p>&gt;
如此我们将jsp页面通过jsp：include到其他页面，这样就做到了页面局部缓存的效果，这一点貌似没有oscache的tag好用。</p>
<p>此外cachefilter中还有一个特性，就是gzip，也就是缓存中的元素是被压缩过的，如果客户端浏览器支持压缩的话，filter会直接返回压缩过的流，这样节省了带宽，把解压的工作交给了客户端浏览即可，当然如果客户端不支持gzip，那么filter会把缓存的元素拿出来解压后在返回给客户端浏览器（大多数爬虫是不支持gzip的，所以filter也会解压后在返回流）。</p>
<p>总之，Ehcache是一个非常轻量级的缓存实现，而且从1.2之后支持了集群，而且是hibernate默认的缓存provider，本文主要介绍Ehcahe对页面缓存的支持，但是它的功能远不止如此，要用好缓存，对J2ee中缓存的原理、适用范围、适用场景等等都需要比较深刻的理解，这样才能用好用对缓存。</p>
<p>为了大家通过实际例子加深了解与场景运用，在奉献一个实例：</p>
<p>/*在Spring中运用EhCache</p>
<pre><code>适用任意一个现有开源Cache Framework，要求可以Cache系统中service或者DAO层的get/find等方法返回结果，如果数据更新（适用了Create/update/delete），则刷新cache中相应的内容。

根据需求，计划适用Spring AOP+enCache来实现这个功能，采用ehCache原因之一就是Spring提供了enCache的支持，至于为何仅仅支持ehcache而不支持oscache和jbosscache就无从得知了。

AOP少不了拦截器，先创建一个实现了MethodInterceptor接口的拦截器，用来拦截Service/DAO的方法调用，拦截到方法后，搜索该方法的结果在cache中是否存在，如果存在，返回cache中结果，如果不存在返回数据库查询结果，并将结果返回到缓存。
</code></pre><p><a href="http://lib.open-open.com/view/open1322892011546.html#viewSource" title="查看源码" target="_blank">查看源码</a><a href="http://lib.open-open.com/view/open1322892011546.html#printSource" title="打印" target="_blank">打印</a><a href="http://lib.open-open.com/view/open1322892011546.html#about" title="?" target="_blank">?</a></p>
<p>01</p>
<p>public</p>
<p>class</p>
<p>MethodCacheInterceptor</p>
<p>implements</p>
<p>MethodInterceptor, InitializingBean</p>
<p>02</p>
<p>{
03</p>
<p>private</p>
<p>static</p>
<p>final</p>
<p>Log logger = LogFactory.getLog(MethodCacheInterceptor.</p>
<p>class</p>
<p>);</p>
<p>04</p>
<p>private</p>
<p>Cache cache;
05</p>
<p>public</p>
<p>void</p>
<p>setCache(Cache cache) {</p>
<p>06</p>
<p>this</p>
<p>.cache = cache;
07</p>
<p>}</p>
<p>08</p>
<p>public</p>
<p>MethodCacheInterceptor() {
09</p>
<p>super</p>
<p>();</p>
<p>10</p>
<p>}
11</p>
<p>//<em>/</em></p>
<p>12</p>
<p>/* 拦截Service/DAO 的方法，并查找该结果是否存在，如果存在就返回cache 中的值，
13</p>
<p>/* 否则，返回数据库查询结果，并将查询结果放入cache</p>
<p>14</p>
<p>/*/
15</p>
<p>public</p>
<p>Object invoke(MethodInvocation invocation)</p>
<p>throws</p>
<p>Throwable {</p>
<p>16</p>
<p>String targetName = invocation.getThis().getClass().getName();
17</p>
<p>String methodName = invocation.getMethod().getName();</p>
<p>18</p>
<p>Object[] arguments = invocation.getArguments();
19</p>
<p>Object result;</p>
<p>20</p>
<p>logger.debug(</p>
<p>&quot;Find object from cache is &quot;</p>
<ul>
<li>cache.getName());
21</li>
</ul>
<p>String cacheKey = getCacheKey(targetName, methodName, arguments);</p>
<p>22</p>
<p>Element element = cache.get(cacheKey);
23</p>
<p>Page</p>
<p>13</p>
<p>of</p>
<p>26</p>
<p>24</p>
<p>if</p>
<p>(element ==</p>
<p>null</p>
<p>) {
25</p>
<p>logger.debug(</p>
<p>&quot;Hold up method , Get method result and create cache........!&quot;</p>
<p>);</p>
<p>26</p>
<p>result = invocation.proceed();
27</p>
<p>element =</p>
<p>new</p>
<p>Element(cacheKey, (Serializable) result);</p>
<p>28</p>
<p>cache.put(element);
29</p>
<p>}</p>
<p>30</p>
<p>return</p>
<p>element.getValue();
31</p>
<p>}</p>
<p>32</p>
<p>//<em>/</em>
33</p>
<p>/* 获得cache key 的方法，cache key 是Cache 中一个Element 的唯一标识</p>
<p>34</p>
<p>/* cache key 包括包名+类名+方法名，如com.co.cache.service.UserServiceImpl.getAllUser
35</p>
<p>/*/</p>
<p>36</p>
<p>private</p>
<p>String getCacheKey(String targetName, String methodName, Object[] arguments) {
37</p>
<p>StringBuffer sb =</p>
<p>new</p>
<p>StringBuffer();</p>
<p>38</p>
<p>sb.append(targetName).append(</p>
<p>&quot;.&quot;</p>
<p>).append(methodName);
39</p>
<p>if</p>
<p>((arguments !=</p>
<p>null</p>
<p>) &amp;&amp; (arguments.length !=</p>
<p>0</p>
<p>)) {</p>
<p>40</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>i =</p>
<p>0</p>
<p>; i &lt; arguments.length; i++) {
41</p>
<p>sb.append(</p>
<p>&quot;.&quot;</p>
<p>).append(arguments[i]);</p>
<p>42</p>
<p>}
43</p>
<p>}</p>
<p>44</p>
<p>return</p>
<p>sb.toString();
45</p>
<p>}</p>
<p>46</p>
<p>//<em>/</em>
47</p>
<p>/* implement InitializingBean，检查cache 是否为空</p>
<p>48</p>
<p>/*/
49</p>
<p>public</p>
<p>void</p>
<p>afterPropertiesSet()</p>
<p>throws</p>
<p>Exception {</p>
<p>50</p>
<p>Assert.notNull(cache,</p>
<p>&quot;Need a cache. Please use setCache(Cache) create it.&quot;</p>
<p>);
51</p>
<p>}</p>
<p>52</p>
<p>}</p>
<p>上面的代码可以看到，在方法invoke中，完成了搜索cache/新建cache的功能</p>
<p>随后，再建立一个拦截器MethodCacheAfterAdvice，作用是在用户进行create/update/delete操作时来刷新、remove相关cache内容，这个拦截器需要实现AfterRetruningAdvice接口，将会在所拦截的方法执行后执行在afterReturning（object arg0，Method arg1，Object[] arg2,object arg3)方法中所预定的操作
<a href="http://lib.open-open.com/view/open1322892011546.html#viewSource" title="查看源码" target="_blank">查看源码</a><a href="http://lib.open-open.com/view/open1322892011546.html#printSource" title="打印" target="_blank">打印</a><a href="http://lib.open-open.com/view/open1322892011546.html#about" title="?" target="_blank">?</a></p>
<p>01</p>
<p>public</p>
<p>class</p>
<p>MethodCacheAfterAdvice</p>
<p>implements</p>
<p>AfterReturningAdvice, InitializingBean</p>
<p>02</p>
<p>{
03</p>
<p>private</p>
<p>static</p>
<p>final</p>
<p>Log logger = LogFactory.getLog(MethodCacheAfterAdvice.</p>
<p>class</p>
<p>);</p>
<p>04</p>
<p>private</p>
<p>Cache cache;
05</p>
<p>Page</p>
<p>15</p>
<p>of</p>
<p>26</p>
<p>06</p>
<p>public</p>
<p>void</p>
<p>setCache(Cache cache) {
07</p>
<p>this</p>
<p>.cache = cache;</p>
<p>08</p>
<p>}
09</p>
<p>public</p>
<p>MethodCacheAfterAdvice() {</p>
<p>10</p>
<p>super</p>
<p>();
11</p>
<p>}</p>
<p>12</p>
<p>public</p>
<p>void</p>
<p>afterReturning(Object arg0, Method arg1, Object[] arg2, Object arg3)</p>
<p>throws
13</p>
<p>Throwable {</p>
<p>14</p>
<p>String className = arg3.getClass().getName();
15</p>
<p>List list = cache.getKeys();</p>
<p>16</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>i =</p>
<p>0</p>
<p>;i&lt;list.size();i++){
17</p>
<p>String cacheKey = String.valueOf(list.get(i));</p>
<p>18</p>
<p>if</p>
<p>(cacheKey.startsWith(className)){
19</p>
<p>cache.remove(cacheKey);</p>
<p>20</p>
<p>logger.debug(</p>
<p>&quot;remove cache &quot;</p>
<ul>
<li>cacheKey);
21</li>
</ul>
<p>}</p>
<p>22</p>
<p>}
23</p>
<p>}</p>
<p>24</p>
<p>public</p>
<p>void</p>
<p>afterPropertiesSet()</p>
<p>throws</p>
<p>Exception {
25</p>
<p>Assert.notNull(cache,</p>
<p>&quot;Need a cache. Please use setCache(Cache) create it.&quot;</p>
<p>);</p>
<p>26</p>
<p>}
27</p>
<p>}
该方法获取目标class的全名，如：com.co.cache.test.TestServiceImpl，然后循环cache的key list，刷新/remove cache中所有和该class相关的element。</p>
<p>接着就是配置encache的属性，如最大缓存数量、cache刷新的时间等等。
<a href="http://lib.open-open.com/view/open1322892011546.html#viewSource" title="查看源码" target="_blank">查看源码</a><a href="http://lib.open-open.com/view/open1322892011546.html#printSource" title="打印" target="_blank">打印</a><a href="http://lib.open-open.com/view/open1322892011546.html#about" title="?" target="_blank">?</a></p>
<p>01</p>
<p>&lt;</p>
<p>ehcache</p>
<p>&gt;</p>
<p>02</p>
<p>&lt;</p>
<p>diskStore</p>
<p>path</p>
<p>=</p>
<p>&quot;c:\myapp\cache&quot;</p>
<p>/&gt;
03</p>
<p>&lt;</p>
<p>defaultCache</p>
<p>04</p>
<p>maxElementsInMemory</p>
<p>=</p>
<p>&quot;1000&quot;
05</p>
<p>eternal</p>
<p>=</p>
<p>&quot;false&quot;</p>
<p>06</p>
<p>timeToIdleSeconds</p>
<p>=</p>
<p>&quot;120&quot;
07</p>
<p>timeToLiveSeconds</p>
<p>=</p>
<p>&quot;120&quot;</p>
<p>08</p>
<p>overflowToDisk</p>
<p>=</p>
<p>&quot;true&quot;
09</p>
<p>/&gt;</p>
<p>10</p>
<p>&lt;</p>
<p>cache</p>
<p>name</p>
<p>=</p>
<p>&quot;DEFAULT_CACHE&quot;
11</p>
<p>maxElementsInMemory</p>
<p>=</p>
<p>&quot;10000&quot;</p>
<p>12</p>
<p>eternal</p>
<p>=</p>
<p>&quot;false&quot;
13</p>
<p>timeToIdleSeconds</p>
<p>=</p>
<p>&quot;300000&quot;</p>
<p>14</p>
<p>timeToLiveSeconds</p>
<p>=</p>
<p>&quot;600000&quot;
15</p>
<p>overflowToDisk</p>
<p>=</p>
<p>&quot;true&quot;</p>
<p>16</p>
<p>/&gt;
17</p>
<p>&lt;/</p>
<p>ehcache</p>
<p>&gt;
这里需要注意的是defaultCache定义了一个默认的cache，这个Cache不能删除，否则会抛出No default cache is configured异常。另外由于使用拦截器来刷新Cache内容，因此在定义cache生命周期时可以定义较大的数值，timeToIdleSeconds=&quot;30000000&quot;,timeToLiveSeconds=&quot;6000000&quot;，好像还不够大？</p>
<p>然后再将Cache和两个拦截器配置到Spring的配置文件cache.xml中即可，需要创建两个“切入点”，分别用于拦截不同方法名的方法。在配置application.xml并且导入cache.xml。这样一个简单的Spring+Encache框架就搭建完成。</p>
<p>由于时间关系就介绍到这里，以后有机会还会介绍Ehcache在分布式集群系统中的使用，谢谢大家。
转自：<a href="http://blog.csdn.net/yangchao228/article/details/7027485" target="_blank"><a href="http://blog.csdn.net/yangchao228/article/details/7027485">http://blog.csdn.net/yangchao228/article/details/7027485</a></a>
<strong>相关资讯</strong> 　—　<a href="http://news.open-open.com/" target="_blank">更多</a></p>
<ul>
<li><a href="http://news.open-open.com/view/1f8183e" title="Java 缓存组件Ehcache 2.5.0 发布" target="_blank">Java 缓存组件Ehcache 2.5.0 发布</a></li>
<li><a href="http://news.open-open.com/view/b9f7fd" title="Web缓存组件 Ehcache Web 2.0.4 发布" target="_blank">Web缓存组件 Ehcache Web 2.0.4 发布</a></li>
<li><a href="http://news.open-open.com/view/31cbce" title="Java的缓存框架 Ehcache 2.4.4 发布" target="_blank">Java的缓存框架 Ehcache 2.4.4 发布</a></li>
<li><a href="http://news.open-open.com/view/a3d21b" title="Java 的缓存框架，Ehcache 2.5.1 发布" target="_blank">Java 的缓存框架，Ehcache 2.5.1 发布</a></li>
<li><a href="http://news.open-open.com/view/96fb86" title="Java缓存框架 ehcache 2.4.6 发布" target="_blank">Java缓存框架 ehcache 2.4.6 发布</a></li>
<li><a href="http://news.open-open.com/view/1ed8575" title="Java的缓存框架 Ehcache 2.4.5 发布" target="_blank">Java的缓存框架 Ehcache 2.4.5 发布</a></li>
<li><a href="http://news.open-open.com/view/621c2b" title="Java 缓存框架，Ehcache 2.5.5 发布" target="_blank">Java 缓存框架，Ehcache 2.5.5 发布</a></li>
<li><a href="http://news.open-open.com/view/9fecb" title="Java缓存框架 Ehcache 2.5 beta 发布" target="_blank">Java缓存框架 Ehcache 2.5 beta 发布</a></li>
<li><a href="http://news.open-open.com/view/12e2e14" title="JSR-107（JCache）正在制定当中，将成为Java EE 7的一部分" target="_blank">JSR-107（JCache）正在制定当中，将成为Java EE 7的一部分</a></li>
<li><a href="http://news.open-open.com/view/1392891" title="整合Ehcache的Java集群平台  Terracotta 3.5.4 发布" target="_blank">整合Ehcache的Java集群平台 Terracotta 3.5.4 发布</a></li>
<li><a href="http://news.open-open.com/view/1c91d17" title="分布式缓存能否作为NoSQL数据库？" target="_blank">分布式缓存能否作为NoSQL数据库？</a></li>
<li><a href="http://news.open-open.com/view/11cdbc8" title="Java 的 ORM 框架，Hibernate 4.1.7 发布" target="_blank">Java 的 ORM 框架，Hibernate 4.1.7 发布</a></li>
<li><a href="http://news.open-open.com/view/13a6403" title="Java极速Web框架 JFinal 1.0.7 正式发布" target="_blank">Java极速Web框架 JFinal 1.0.7 正式发布</a></li>
<li><a href="http://news.open-open.com/view/34159c" title="JavaEE参考示例，SpringSide 4.0.0 RC3 版发布" target="_blank">JavaEE参考示例，SpringSide 4.0.0 RC3 版发布</a></li>
<li><a href="http://news.open-open.com/view/12399fd" title="JavaEE参考示例 SpringSide 4.0.0.RC4 -- 2012.08.26发布" target="_blank">JavaEE参考示例 SpringSide 4.0.0.RC4 -- 2012.08.26发布</a></li>
<li><a href="http://news.open-open.com/view/abda76" title="SpringSide 4.0.0 GA 版发布, JavaEE 参考示例" target="_blank">SpringSide 4.0.0 GA 版发布, JavaEE 参考示例</a></li>
<li><a href="http://news.open-open.com/view/cceee7" title="Java数据持久化组件 Apache Empire-db 2.2.0-incubating 发布" target="_blank">Java数据持久化组件 Apache Empire-db 2.2.0-incubating 发布</a></li>
<li><a href="http://news.open-open.com/view/1f3a61f" title="JavaOne 2011战略主题：Java ME、SE和EE的未来规划" target="_blank">JavaOne 2011战略主题：Java ME、SE和EE的未来规划</a></li>
<li><a href="http://news.open-open.com/view/669161" title="Java Web框架Apache Wicket 1.5发布" target="_blank">Java Web框架Apache Wicket 1.5发布</a></li>
<li><p><a href="http://news.open-open.com/view/137d738" title="Java分布式内存对象缓存系统，Sapphire 1.1.9 发布" target="_blank">Java分布式内存对象缓存系统，Sapphire 1.1.9 发布</a>
<strong>相关文档</strong> 　—　<a href="http://doc.open-open.com/" target="_blank">更多</a></p>
</li>
<li><p><a href="http://doc.open-open.com/view/52e79572119048649cf9e0df1b0df443" title="EHCache使用.doc" target="_blank">EHCache使用.doc</a></p>
</li>
<li><a href="http://doc.open-open.com/view/7ee6bdf742114414a58eafda5d83521a" title="Ehcache文档_单点登录.doc" target="_blank">Ehcache文档_单点登录.doc</a></li>
<li><a href="http://doc.open-open.com/view/13df1074061f477b8ac85bad611d23be" title="Java 框架思路.doc" target="_blank">Java 框架思路.doc</a></li>
<li><a href="http://doc.open-open.com/view/8ae6e9269cd74418a9e3f4ca8ccab45c" title="Ehcache用户指南(分布式缓存).pdf" target="_blank">Ehcache用户指南(分布式缓存).pdf</a></li>
<li><a href="http://doc.open-open.com/view/8feca624e6674c5e9b98c02644b0b65e" title="EHCache 总结.doc" target="_blank">EHCache 总结.doc</a></li>
<li><a href="http://doc.open-open.com/view/3cad4d15c8ba4ae39d46378ccf71f016" title="EHCache技术文档.pdf" target="_blank">EHCache技术文档.pdf</a></li>
<li><a href="http://doc.open-open.com/view/829642794b3b4d5f9c8e77e706f1fc75" title="EHCache 详解 技术文档.doc" target="_blank">EHCache 详解 技术文档.doc</a></li>
<li><a href="http://doc.open-open.com/view/8836684368864a9db0d1980a885caad1" title="EHCache 详解技术文档.doc" target="_blank">EHCache 详解技术文档.doc</a></li>
<li><a href="http://doc.open-open.com/view/e6a6faf0ebb34bb993a984483415c0b3" title="Ehcache 学习手册.doc" target="_blank">Ehcache 学习手册.doc</a></li>
<li><a href="http://doc.open-open.com/view/6a2b3b07d3b44678a0039af87af28bd8" title="使用ehcache .doc" target="_blank">使用ehcache .doc</a></li>
<li><a href="http://doc.open-open.com/view/b50e8ad1e2d84ad9a0da96dc988d9d77" title="Ehcache技术文档详解.doc" target="_blank">Ehcache技术文档详解.doc</a></li>
<li><a href="http://doc.open-open.com/view/f3f353ba610944b695617d775fd8f245" title="关于ehcache配置.doc" target="_blank">关于ehcache配置.doc</a></li>
<li><a href="http://doc.open-open.com/view/46b071301657417abd9453eb521d1fee" title="Ehcache缓存配置.doc" target="_blank">Ehcache缓存配置.doc</a></li>
<li><a href="http://doc.open-open.com/view/fab64aa1633e4795847a5ee35fdf0f2c" title="Hibernate 的缓存.doc" target="_blank">Hibernate 的缓存.doc</a></li>
<li><a href="http://doc.open-open.com/view/0e9db4af60694e8dbd714f1081976d7c" title="JAVA 缓存详解.doc" target="_blank">JAVA 缓存详解.doc</a></li>
<li><a href="http://doc.open-open.com/view/04fba124ce414965968b2c5b940a7894" title="Hibernate实践(2)-Java EE分布式开发.ppt" target="_blank">Hibernate实践(2)-Java EE分布式开发.ppt</a></li>
<li><a href="http://doc.open-open.com/view/f771c4b17a21435eba6bc6831b3000aa" title="Hibernate 的二级缓存介绍.doc" target="_blank">Hibernate 的二级缓存介绍.doc</a></li>
<li><a href="http://doc.open-open.com/view/c5d24b54dcbe40958c8c89b2613e7ce9" title="Memcached 入门资料.ppt" target="_blank">Memcached 入门资料.ppt</a></li>
<li><a href="http://doc.open-open.com/view/e2e77590b0b14b74be0ea8c981ff5b07" title="JAVA缓存体系及应用.ppt" target="_blank">JAVA缓存体系及应用.ppt</a></li>
<li><a href="http://doc.open-open.com/view/55c8674b67e54a239b7677ac52a35a5e" title="Java组件设计.doc" target="_blank">Java组件设计.doc</a></li>
</ul>
<p>-
<a href="http://lib.open-open.com/view/open1322892011546.html#"></a></p>
<p>内容信息</p>
<p> 4.5
(已有8个人评价)</p>
<p>   63%
   25%
   13%
   0%
   0%</p>
<p>浏览：1568次
贡献者：<a href="http://home.open-open.com/361" target="_blank">openkk</a>
上传时间：2011-12-03 14:00:11
经验标签</p>
<p><a href="http://lib.open-open.com/tag/EhCache" target="_blank">EhCache</a></p>
<p>同类热门经验</p>
<ul>
<li><a href="http://lib.open-open.com/view/open1322893330405.html" title="Ehcache入门指南" target="_blank">Ehcache入门指南</a></li>
</ul>
<p>1225次浏览</p>
<ul>
<li><a href="http://lib.open-open.com/view/open1322893871640.html" title="在Hibernate中使用EhCache" target="_blank">在Hibernate中使用EhCache</a></li>
</ul>
<p>1125次浏览</p>
<ul>
<li><a href="http://lib.open-open.com/view/open1329182508390.html" title="Java" target="_blank">Java Cache 的HashMap实现, 适用场景及分布式ehcache实例</a></li>
</ul>
<p>1347次浏览</p>
<ul>
<li><a href="http://lib.open-open.com/view/open1329923205374.html" title="超轻量级Java缓存组件" target="_blank">超轻量级Java缓存组件 - EhCache</a></li>
</ul>
<p>670次浏览</p>
<ul>
<li><a href="http://lib.open-open.com/view/open1342696876495.html" title="EhCache" target="_blank">EhCache 分布式缓存/缓存集群</a></li>
</ul>
<p>471次浏览</p>
<ul>
<li><a href="http://lib.open-open.com/view/open1322893835030.html" title="EHCache" target="_blank">EHCache 初步使用指南</a></li>
</ul>
<p>1002次浏览
相关经验</p>
<ul>
<li><a href="http://lib.open-open.com/view/open1329923205374.html" title="超轻量级Java缓存组件" target="_blank">超轻量级Java缓存组件 - EhCache</a>
3人评</li>
<li><a href="http://lib.open-open.com/view/open1344438054796.html" title="【EhCache】Java缓存框架使用EhCache结合Spring" target="_blank">【EhCache】Java缓存框架使用EhCache结合Spring AOP</a>
0人评</li>
<li><a href="http://lib.open-open.com/view/open1344322434702.html" title="EhCahce缓存框架使用" target="_blank">EhCahce缓存框架使用</a>
1人评</li>
<li><a href="http://lib.open-open.com/view/open1324813123124.html" title="Java集成各种cache组件" target="_blank">Java集成各种cache组件 multicache4j</a>
0人评</li>
<li><a href="http://lib.open-open.com/view/open1330063709155.html" title="Hibernate一级缓存" target="_blank">Hibernate一级缓存 &amp; 二级缓存</a>
3人评</li>
<li><a href="http://lib.open-open.com/view/open1329182508390.html" title="Java" target="_blank">Java Cache 的HashMap实现, 适用场景及分布式ehcache实例</a>
3人评</li>
<li><a href="http://lib.open-open.com/view/open1347268610553.html" title="Portal-Basic" target="_blank">Portal-Basic Java Web 应用开发框架</a>
0人评</li>
<li><a href="http://lib.open-open.com/view/open1346722442303.html" title="EhCache" target="_blank">EhCache 分布式下缓存对象的同步</a>
0人评</li>
<li><a href="http://lib.open-open.com/view/open1322893330405.html" title="Ehcache入门指南" target="_blank">Ehcache入门指南</a>
6人评</li>
<li><a href="http://lib.open-open.com/view/open1338942486578.html" title="Ehcache缓存之web应用实例" target="_blank">Ehcache缓存之web应用实例</a>
1人评</li>
<li><a href="http://lib.open-open.com/view/open1342696876495.html" title="EhCache" target="_blank">EhCache 分布式缓存/缓存集群</a>
2人评</li>
<li><a href="http://lib.open-open.com/view/open1342061957640.html" title="Ehcache" target="_blank">Ehcache 整合Spring 使用页面、对象缓存</a>
3人评</li>
<li><a href="http://lib.open-open.com/view/open1329463211437.html" title="ehCache+spring的简单实用" target="_blank">ehCache+spring的简单实用</a>
7人评</li>
<li><a href="http://lib.open-open.com/view/open1322893835030.html" title="EHCache" target="_blank">EHCache 初步使用指南</a>
1人评</li>
</ul>
<p>相关讨论 - <a href="http://www.open-open.com/bbs" target="_blank">更多</a></p>
<ul>
<li><a href="http://www.open-open.com/bbs/view/1324279205202" title="软件架构的一致性" target="_blank">软件架构的一致性</a></li>
<li><a href="http://www.open-open.com/bbs/view/1318332443124" title="Java入门教程学习" target="_blank">Java入门教程学习</a></li>
<li><a href="http://www.open-open.com/bbs/view/1320567848811" title="Java" target="_blank">Java NIO基本使用</a></li>
<li><a href="http://www.open-open.com/bbs/view/1320131360999" title="java的concurrent用法详解" target="_blank">java的concurrent用法详解</a></li>
<li><a href="http://www.open-open.com/bbs/view/1318820562093" title="Android" target="_blank">Android 中各种 JAVA 包的功能描述</a></li>
<li><a href="http://www.open-open.com/bbs/view/1319456388311" title="Java开源类库" target="_blank">Java开源类库 Gilead</a></li>
<li><a href="http://www.open-open.com/bbs/view/1320131462624" title="Java" target="_blank">Java Concurrent处理并发需求</a></li>
</ul>
<p><a href="http://www.open-open.com/home/1" target="_blank">联系我们</a> - <a href="http://www.open-open.com/home/1" target="_blank">问题反馈</a></p>
<p>2005-2012 OPEN-OPEN, all rights reserved.
-</p>
<p>收藏提示<a href="http://lib.open-open.com/view/open1322892011546.html#" target="_blank">close</a></p>
<p>文件夹 请选择... ------------- 新增文件夹... 新增文件夹 标签 (多个标签用逗号分隔)
取消确认</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/缓存/">缓存</a></li></span><span class="breadcrumb"><li><a href="/categories/缓存/">缓存</a></li><li><a href="/categories/缓存/ehcache/">ehcache</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ehcache/" class="label label-primary">ehcache</a><a href="/tags/缓存/" class="label label-success">缓存</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-缓存-ehcache--Java缓存组件EhCache入门教程-OPEN开发经验库/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-缓存-ehcache--Java缓存组件EhCache入门教程-OPEN开发经验库" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-缓存-ehcache--EhCache小结--ITeye技术网站/">EhCache小结 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-缓存-ehcache--EhCache小结--ITeye技术网站/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="ehcache-iteye-">EhCache小结 - - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">资讯</a> <a href="http://www.iteye.com/magazines" target="_blank">精华</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a> <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://nanguocoffee.iteye.com/blog/356324#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://nanguocoffee.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://nanguocoffee.iteye.com/login" target="_blank">登录</a> <a href="http://nanguocoffee.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-nanguocoffee-http-nanguocoffee-iteye-com-"><a href="http://nanguocoffee.iteye.com/" target="_blank">nanguocoffee</a></h1>
<ul>
<li><a href="http://nanguocoffee.iteye.com/" target="_blank"><strong>博客</strong></a></li>
<li><a href="http://nanguocoffee.iteye.com/weibo" target="_blank">微博</a></li>
<li><a href="http://nanguocoffee.iteye.com/album" target="_blank">相册</a></li>
<li><a href="http://nanguocoffee.iteye.com/link" target="_blank">收藏</a></li>
<li><a href="http://nanguocoffee.iteye.com/blog/guest_book" target="_blank">留言</a></li>
<li><a href="http://nanguocoffee.iteye.com/blog/profile" target="_blank">关于我</a></li>
</ul>
<h3 id="-ehcache-"><a href="">EhCache小结</a> **</h3>
<p><strong>博客分类：</strong></p>
<ul>
<li><a href="http://nanguocoffee.iteye.com/category/60003" target="_blank">缓存</a>
<a href="http://www.iteye.com/blogs/tag/Cache" target="_blank">Cache</a><a href="http://www.iteye.com/blogs/tag/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" target="_blank">数据结构</a><a href="http://www.iteye.com/blogs/tag/%E7%AE%97%E6%B3%95" target="_blank">算法</a><a href="http://www.iteye.com/blogs/tag/%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86" target="_blank">配置管理</a><a href="http://www.iteye.com/blogs/tag/Hibernate" target="_blank">Hibernate</a> </li>
</ul>
<p>一：接口和类的作用：
Elemenet：
key
value
lastAccessTime
hitCount
等描述cache中元素的信息。
Store: 实际上存放Element的对象，Cache针对对象的操作一般都委托Store对象。</p>
<ul>
<li>MemoryStore： 继承该类来实现自定义MemoryStore。该类存放数据时，先使用Map存放数据，然后再判断是否超出容量。
put()
doPut() // 用来清理元素
-LruMemoryStore.java  使用 LinkedHashMap的子类，doput（）为空，因为该map的实现中的removeEldestEntry方法清理了超出容量的元素。
-LfuMemoryStore.java  使用HashMap
-FifoMemoryStore.java 使用LinkedHashMap  这里用队列应该更快吧？？源码中还需要遍历map。
-DiskStore：
其实diskStore也是用一个hashmap来存放数据，只有显式的调用flush（）方法的时候才判断是否要将元素写入文件中。
CacheManager 来管理 Cache ；
Cache用来操作Element，Cache是抽象出来的逻辑概念，其 内部使用Store来处理Element
Element就是数据描述缓存对象的基本信息。
Store是保管缓存对象的仓库，这个仓库分Memory和Disk两种。
EHCache中的EventListener是针对分布式的，普通的应用可以不用考虑。
二：一些功能细节：
1：超出设定的元素容量的解决方法
MemoryStore：
When an element is added to a cache and it goes beyond its maximum memory size,
an existing element is either deleted, if overflowToDisk is false, or evaluated for spooling to disk,
if overflowToDisk is true. In the latter case, a check for expiry is carried out. If it is expired it is deleted; if not it is spooled.
判断元素是否过期，MemoryStore有3种策略可选，LRU，LFU，FIFO，默认为LRU。
DiskStore：
使用LFU，DiskStore使用一个守护线程，DiskStore.SpoolAndExpiryThread内部类来定时检查diskStore中的元素，
定时刷新到文件中，如果遇到过期的元素则移除。
2：元素存活时间到期
MemoryStore：
在get（）和超出容量的时候才判断是否过期
DiskStore：
只有在flush的时候才判断是否过期，如果过期则移除。
也就是说，这两种方式，不论在文件或者内存中，都会依然存在过期的元素，
这些元算可能永远存在，但不影响我们的操作，因为我们get（）或者超出容量的时候都会判断是否过期并清除。
三：初始化
CacheManager cacheManager = new CacheManager();
调用protected void init(Configuration configuration, String configurationFileName, URL configurationURL,   InputStream configurationInputStream) 方法进行初始化。
1：解析配置信息：
1.1 查找ehcache.xml文件，如果找不到则使用默认的ehcache-failsafe.xml，返回一个URL对象。
1.2 调用ConfigurationFactory.parseConfiguration(input) 方法来进行解析。返回Configuration对象。
Configuration的数据结构：
  private DiskStoreConfiguration diskStoreConfiguration;
  private CacheConfiguration defaultCacheConfiguration;
  private List<FactoryConfiguration> cacheManagerPeerProviderFactoryConfiguration = new ArrayList<FactoryConfiguration>();
  private List<FactoryConfiguration> cacheManagerPeerListenerFactoryConfiguration = new ArrayList<FactoryConfiguration>();
  private FactoryConfiguration cacheManagerEventListenerFactoryConfiguration;
  private final Map cacheConfigurations = new HashMap();
  private String configurationSource;
该数据结构是针对xml定义来的，其中最复杂也最常用的算是CacheConfiguration，其内部结构也很简单。
cacheConfigurations存放多个CacheConfiguration。
2：根据Configuration进行CacheManager，Cache，Store等数据结构的初始化。
总结：
EHCache是一款比较简单的开源缓存产品，但也存在一些不足之处：
比如：
1：CacheManager和Cache这个具体类耦合，当然也提供了针对EHCache接口的方法，如果使用自定义的Cache的话容易混淆方法。
2：针对不同的Cache类，我们希望指定不同的MemoryStore实现、DiskStore实现，EHCache只提供了通过程序来达到这一功能，
没有提供通过配置文件来提供(类似于Hibernate配置文件中CacheProvider，JDBC  dialect 等)。
3：有些算法实现得不算好，比如FifoMemoryStore.java中的清理元素算法选择的数据结构不够快速。
分享到： <a href="&quot;分享到新浪微博&quot;"><img src="" alt=""></a> <a href="&quot;分享到腾讯微博&quot;"><img src="" alt=""></a></li>
</ul>
<p><a href="http://nanguocoffee.iteye.com/blog/467199" title="JForum源码学习研究1-起步" target="_blank">JForum源码学习研究1-起步</a> | <a href="http://nanguocoffee.iteye.com/blog/356322" title="EhCache入门" target="_blank">EhCache入门</a></p>
<ul>
<li>2009-03-27 18:34</li>
<li>浏览 1010</li>
<li><a href="http://nanguocoffee.iteye.com/blog/356324#comments" target="_blank">评论(0)</a></li>
<li><a href="http://www.iteye.com/wiki/blog/356324" target="_blank">相关推荐</a></li>
</ul>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<h3 id="-">发表评论</h3>
<p><a href="http://nanguocoffee.iteye.com/login" target="_blank"><img src="" alt=""></a><a href="http://nanguocoffee.iteye.com/login" target="_blank">您还没有登录,请您登录后再发表评论</a></p>
<p><a href="http://nanguocoffee.iteye.com/" target="_blank"><img src="&quot;NanguoCoffee的博客: &quot;" alt="NanguoCoffee的博客"></a></p>
<p>NanguoCoffee</p>
<ul>
<li>浏览: 10206 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 北京</li>
<li><img src="" alt=""><h3 id="-http-nanguocoffee-iteye-com-blog-user_visits-">最近访客 <a href="http://nanguocoffee.iteye.com/blog/user_visits" target="_blank">更多访客&gt;&gt;</a></h3>
</li>
</ul>
<p><a href="http://bingki.iteye.com/" target="_blank"><img src="&quot;bingki的博客: 我的IT生活...&quot;" alt="bingki的博客"></a></p>
<p><a href="http://bingki.iteye.com/" title="bingki" target="_blank">bingki</a></p>
<p><a href="http://turandot.iteye.com/" target="_blank"><img src="&quot;Turandot的博客: &quot;" alt="Turandot的博客"></a></p>
<p><a href="http://turandot.iteye.com/" title="Turandot" target="_blank">Turandot</a>
<a href="http://dylinshi126.iteye.com/" target="_blank"><img src="&quot;dylinshi126的博客: &quot;" alt="dylinshi126的博客"></a></p>
<p><a href="http://dylinshi126.iteye.com/" title="dylinshi126" target="_blank">dylinshi126</a></p>
<p><a href="http://luwies.iteye.com/" target="_blank"><img src="&quot;luwies的博客: &quot;" alt="luwies的博客"></a></p>
<p><a href="http://luwies.iteye.com/" title="luwies" target="_blank">luwies</a></p>
<h3 id="-">文章分类</h3>
<ul>
<li><a href="http://nanguocoffee.iteye.com/" target="_blank">全部博客 (23)</a></li>
<li><a href="http://nanguocoffee.iteye.com/category/60003" target="_blank">缓存 (2)</a></li>
<li><a href="http://nanguocoffee.iteye.com/category/79080" target="_blank">JForum (3)</a></li>
<li><a href="http://nanguocoffee.iteye.com/category/121602" target="_blank">Java IO (3)</a></li>
<li><a href="http://nanguocoffee.iteye.com/category/121603" target="_blank">其他 (7)</a></li>
<li><a href="http://nanguocoffee.iteye.com/category/121996" target="_blank">Java 多线程 (1)</a></li>
<li><a href="http://nanguocoffee.iteye.com/category/132461" target="_blank">性能优化 (1)</a></li>
<li><a href="http://nanguocoffee.iteye.com/category/132820" target="_blank">Oracle (1)</a></li>
<li><p><a href="http://nanguocoffee.iteye.com/category/137742" target="_blank">编码相关 (6)</a></p>
<h3 id="-">社区版块</h3>
</li>
<li><p><a href="http://nanguocoffee.iteye.com/blog/news" target="_blank">我的资讯</a> (0)</p>
</li>
<li><a href="http://nanguocoffee.iteye.com/blog/post" target="_blank">我的论坛</a> (118)</li>
<li><a href="http://nanguocoffee.iteye.com/blog/answered_problems" target="_blank">我的问答</a> (18)</li>
</ul>
<h3 id="-">存档分类</h3>
<ul>
<li><a href="http://nanguocoffee.iteye.com/blog/monthblog/2011-02" target="_blank">2011-02</a> (1)</li>
<li><a href="http://nanguocoffee.iteye.com/blog/monthblog/2011-01" target="_blank">2011-01</a> (1)</li>
<li><a href="http://nanguocoffee.iteye.com/blog/monthblog/2010-12" target="_blank">2010-12</a> (6)</li>
<li><p><a href="http://nanguocoffee.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">最新评论</h3>
</li>
<li><p><a href="http://nanguocoffee.iteye.com/" title="NanguoCoffee" target="_blank">NanguoCoffee</a>： javantsky 写道楼主为什么要自己实现分离锁呢？ jav ...
<a href="http://nanguocoffee.iteye.com/blog/907824#bc1905975" target="_blank">知道为啥HashMap里面的数组size必须是2的次幂？</a></p>
</li>
<li><a href="http://javantsky.iteye.com/" title="javantsky" target="_blank">javantsky</a>： 楼主为什么要自己实现分离锁呢？java.util.concur ...
<a href="http://nanguocoffee.iteye.com/blog/907824#bc1905933" target="_blank">知道为啥HashMap里面的数组size必须是2的次幂？</a></li>
<li><a href="http://obullxl.iteye.com/" title="obullxl" target="_blank">obullxl</a>： LZ分析有道理，最后的&amp;操作，（LOCK_NUM - ...
<a href="http://nanguocoffee.iteye.com/blog/907824#bc1905828" target="_blank">知道为啥HashMap里面的数组size必须是2的次幂？</a></li>
<li><a href="http://nanguocoffee.iteye.com/" title="NanguoCoffee" target="_blank">NanguoCoffee</a>： sniffer123 写道LZ你自己的写法有问题啊。。跟HAS ...
<a href="http://nanguocoffee.iteye.com/blog/907824#bc1905087" target="_blank">知道为啥HashMap里面的数组size必须是2的次幂？</a></li>
<li><a href="http://sniffer123.iteye.com/" title="sniffer123" target="_blank">sniffer123</a>： LZ你自己的写法有问题啊。。跟HASH是不是 2的幂一点关系也 ...
<a href="http://nanguocoffee.iteye.com/blog/907824#bc1905063" target="_blank">知道为啥HashMap里面的数组size必须是2的次幂？</a>
声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2012 ITeye.com. All rights reserved. [ 京ICP证110151号 京公网安备110105010620 ]
<img src="" alt=""></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/缓存/">缓存</a></li></span><span class="breadcrumb"><li><a href="/categories/缓存/">缓存</a></li><li><a href="/categories/缓存/ehcache/">ehcache</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ehcache/" class="label label-primary">ehcache</a><a href="/tags/缓存/" class="label label-success">缓存</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-缓存-ehcache--EhCache小结--ITeye技术网站/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-缓存-ehcache--EhCache小结--ITeye技术网站" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-缓存-ehcache--EHCache的使用教程-黑神领主的博客-dev26com/">EHCache的使用教程</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-缓存-ehcache--EHCache的使用教程-黑神领主的博客-dev26com/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="ehcache-dev26-com">EHCache的使用教程-黑神领主的博客-dev26.com</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="http://www.dev26.com/blog/article/352/1#" target="_blank">QQ空间</a></li>
<li><a href="http://www.dev26.com/blog/article/352/1#" target="_blank">新浪微博</a></li>
<li><a href="http://www.dev26.com/blog/article/352/1#" target="_blank">百度搜藏</a></li>
<li><a href="http://www.dev26.com/blog/article/352/1#" target="_blank">人人网</a></li>
<li><a href="http://www.dev26.com/blog/article/352/1#" target="_blank">腾讯微博</a></li>
<li><a href="http://www.dev26.com/blog/article/352/1#" target="_blank">开心网</a></li>
<li><a href="http://www.dev26.com/blog/article/352/1#" target="_blank">腾讯朋友</a></li>
<li><a href="http://www.dev26.com/blog/article/352/1#" target="_blank">更多...</a></li>
</ul>
<p><a href="http://www.dev26.com/blog/article/352/1#" target="_blank">百度分享</a></p>
<p><a href="http://www.dev26.com/blog/article/352/1#" target="_blank">首页</a>|<a href="http://www.dev26.com/blog/article/352/1#" target="_blank">文章</a>|<a href="http://www.dev26.com/blog/article/352/1#" target="_blank">博客</a>|<a href="http://www.dev26.com/blog/article/352/1#" target="_blank">开源</a></p>
<h1 id="www-dev26-com">www.dev26.com</h1>
<h2 id="-web-">黑神领主的Web开发站博客</h2>
<p>在 文章 博客 开源 论坛 中检索</p>
<h3 id="-">个人资料</h3>
<p><a href="http://www.dev26.com/blog/start/undead" target="_blank"><img src="" alt="黑神领主"></a></p>
<p>这家伙很懒，什么都没有留下……</p>
<p>等级: <img src="&quot;等级：20&quot;" alt="20"></p>
<p>加入时间:2011-12-05 22:36</p>
<p><a href="http://www.dev26.com/blog/article/352/1#inline1" target="_blank">发送消息</a></p>
<h3 id="-">操作中心</h3>
<ul>
<li><a href="&quot;我的博客&quot;">我的博客</a></li>
<li><a href="http://www.dev26.com/bbs/topic/focus/1" title="我关注的话题" target="_blank">我关注的话题</a></li>
<li>新闻投递</li>
<li><a href="http://www.dev26.com/manage/home/start" target="_blank">管理</a></li>
<li><a href="http://www.dev26.com/manage/blog/edit" target="_blank">发表文章</a></li>
<li><p><a href="">安全退出</a></p>
<h3 id="-">操作中心</h3>
</li>
<li><p><a href="http://www.dev26.com/login" target="_blank">登录</a></p>
</li>
<li><a href="http://www.dev26.com/runtime/register" target="_blank">注册</a></li>
</ul>
<h3 id="-http-www-dev26-com-blog-start-undead-http-www-dev26-com-rss-blog-username-undead-"><a href="http://www.dev26.com/blog/start/undead" target="_blank">所有文章</a> <a href="http://www.dev26.com/rss/blog?username=undead" target="_blank"><img src="&quot;订阅&quot;" alt=""></a></h3>
<ul>
<li><a href="http://www.dev26.com/blog/category/32" target="_blank">JDK基础</a></li>
<li><a href="http://www.dev26.com/blog/category/33" target="_blank">html5</a></li>
<li><a href="http://www.dev26.com/blog/category/35" target="_blank">javascript</a></li>
<li><a href="http://www.dev26.com/blog/category/5" target="_blank">我的JavaEE</a></li>
<li><a href="http://www.dev26.com/blog/category/6" target="_blank">我的博客</a></li>
<li><p><a href="http://www.dev26.com/blog/category/34" target="_blank">数据结构</a></p>
<h3 id="-">最新发表&gt;&gt;</h3>
</li>
<li><p><a href="http://www.dev26.com/blog/article/622/1" title="javascript中使用mvc" target="_blank">javascript中使用mvc</a></p>
</li>
<li><a href="http://www.dev26.com/blog/article/621/1" title="java实现二级域名" target="_blank">java实现二级域名</a></li>
<li><a href="http://www.dev26.com/blog/article/620/1" title="java Annotation注解知识" target="_blank">java Annotation注解知识</a></li>
<li><a href="http://www.dev26.com/blog/article/618/1" title="inner join,left join,right join,full join 的区别说明" target="_blank">inner join,left join,right join,full join 的区别说明</a></li>
<li><a href="http://www.dev26.com/blog/article/617/1" title="REST的概念是什么" target="_blank">REST的概念是什么</a></li>
</ul>
<h3 id="-">最新评论&gt;&gt;</h3>
<p><a href="http://www.dev26.com/blog/article.htm?articleId=558&amp;tmp=1#comments">你好，能不能把示例代码和xml发给我，我研究下自定义类，我这里用起来有点问题。谢谢
jiangdk85@126.com</a></p>
<p><a href="http://www.dev26.com/blog/article.htm?articleId=113&amp;tmp=1#comments" target="_blank">上面的代码找不到ResourceDetailsBuilder这个类</a>
<a href="http://www.dev26.com/blog/article.htm?articleId=113&amp;tmp=1#comments" target="_blank">上面已经是源码了哟，只是没有JAR包而已，你下载一下吧</a></p>
<p><a href="http://www.dev26.com/blog/article.htm?articleId=113&amp;tmp=1#comments" target="_blank">大大共享下源码可以么？</a>
<a href="http://www.dev26.com/blog/article.htm?articleId=113&amp;tmp=1#comments" target="_blank">是内存中的权限缓存，这样设置的权限可以即时生效</a>
-</p>
<h3 id="ehcache-">EHCache的使用教程</h3>
<p>发表于2012-06-08 19:19 | 阅读 218 | 1人对此综合评价 <img src="&quot;5分&quot;" alt="5分"></p>
<p>开发高并发量，高性能的网站应用系统时，缓存Cache起到了非常重要的作用。本文主要介绍EHCache的使用，以及使用EHCache的实践经验。
笔者使用过多种基于Java的开源Cache组件，其中包括OSCache、JBossCache、EHCache。OSCache功能强大，使用灵活，可用于对象缓存、Filter缓存以及在JSP中直接使用cache标签。笔者在最近的使用过程中发现，在并发量较高时，OSCache会出现线程阻塞和数据错误，通过分析源代码发现是其内部实现的缺陷。JBossCache最大的优点是支持基于对象属性的集群同步，不过JBossCache的配置使用都较复杂，在并发量较高的情况下，对象属性数据在集群中同步也会加大系统的开销。以上两种Cache本文仅作简单介绍，不做深入探讨。
EHCache是来自sourceforge（<a href="http://ehcache.sourceforge.net/" target="_blank"><a href="http://ehcache.sourceforge.net/">http://ehcache.sourceforge.net/</a></a>）的开源项目，也是纯Java实现的简单、快速的Cache组件。EHCache支持内存和磁盘的缓存，支持LRU、LFU和FIFO多种淘汰算法，支持分布式的Cache，可以作为Hibernate的缓存插件。同时它也能提供基于Filter的Cache，该Filter可以缓存响应的内容并采用Gzip压缩提高响应速度。</p>
<p> EHCache API的基本用法
首先介绍CacheManager类。它主要负责读取配置文件，默认读取CLASSPATH下的ehcache.xml，根据配置文件创建并管理Cache对象。
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
// 使用默认配置文件创建CacheManager</p>
<p>CacheManager manager = CacheManager.create();
// 通过manager可以生成指定名称的Cache对象</p>
<p>Cache cache = cache = manager.getCache(</p>
<p>&quot;demoCache&quot;</p>
<p>);
// 使用manager移除指定名称的Cache对象</p>
<p>manager.removeCache(</p>
<p>&quot;demoCache&quot;</p>
<p>);
可以通过调用manager.removalAll()来移除所有的Cache。通过调用manager的shutdown()方法可以关闭CacheManager。</p>
<p>有了Cache对象之后就可以进行一些基本的Cache操作，例如：
//往cache中添加元素</p>
<p>Element element =</p>
<p>new</p>
<p>Element(</p>
<p>&quot;key&quot;</p>
<p>,</p>
<p>&quot;value&quot;</p>
<p>);
cache.put(element);</p>
<p>//从cache中取回元素
Element element = cache.get(</p>
<p>&quot;key&quot;</p>
<p>);</p>
<p>element.getValue();
//从Cache中移除一个元素</p>
<p>cache.remove(</p>
<p>&quot;key&quot;</p>
<p>);</p>
<p>可以直接使用上面的API进行数据对象的缓存，这里需要注意的是对于缓存的对象都是必须可序列化的。在下面的篇幅中笔者还会介绍EHCache和Spring、Hibernate的整合使用。</p>
<p> 配置文件
配置文件ehcache.xml中命名为demoCache的缓存配置：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7&lt;</p>
<p>cache</p>
<p>name</p>
<p>=</p>
<p>&quot;demoCache&quot;</p>
<p>maxElementsInMemory</p>
<p>=</p>
<p>&quot;10000&quot;
eternal</p>
<p>=</p>
<p>&quot;false&quot;</p>
<p>overflowToDisk</p>
<p>=</p>
<p>&quot;true&quot;
timeToIdleSeconds</p>
<p>=</p>
<p>&quot;300&quot;</p>
<p>timeToLiveSeconds</p>
<p>=</p>
<p>&quot;600&quot;
memoryStoreEvictionPolicy</p>
<p>=</p>
<p>&quot;LFU&quot;</p>
<p>/&gt;</p>
<p>各配置参数的含义：
maxElementsInMemory：缓存中允许创建的最大对象数
eternal：缓存中对象是否为永久的，如果是，超时设置将被忽略，对象从不过期。
timeToIdleSeconds：缓存数据的钝化时间，也就是在一个元素消亡之前，两次访问时间的最大时间间隔值，这只能在元素不是永久驻留时有效，如果该值是 0 就意味着元素可以停顿无穷长的时间。
timeToLiveSeconds：缓存数据的生存时间，也就是一个元素从构建到消亡的最大时间间隔值，这只能在元素不是永久驻留时有效，如果该值是0就意味着元素可以停顿无穷长的时间。
overflowToDisk：内存不足时，是否启用磁盘缓存。
memoryStoreEvictionPolicy：缓存满了之后的淘汰算法。LRU和FIFO算法这里就不做介绍。LFU算法直接淘汰使用比较少的对象，在内存保留的都是一些经常访问的对象。对于大部分网站项目，该算法比较适用。
如果应用需要配置多个不同命名并采用不同参数的Cache，可以相应修改配置文件，增加需要的Cache配置即可。</p>
<p> 利用Spring APO整合EHCache
首先，在CLASSPATH下面放置ehcache.xml配置文件。在Spring的配置文件中先添加如下cacheManager配置：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10</p>
<bean id=

"cacheManager"

class=

"org.springframework.cache.ehcache.EhCacheManagerFactoryBean"

>
</bean>

<p>配置demoCache：</p>
<bean id=

"demoCache"

class=

"org.springframework.cache.ehcache.EhCacheFactoryBean"

>

<property name=

"cacheManager"

ref=

"cacheManager"

/>
<property name=

"cacheName"

>

<value>demoCache</value>
</property>

</bean>

<p>接下来，写一个实现org.aopalliance.intercept.MethodInterceptor接口的拦截器类。有了拦截器就可以有选择性的配置想要缓存的 bean 方法。如果被调用的方法配置为可缓存，拦截器将为该方法生成 cache key 并检查该方法返回的结果是否已缓存。如果已缓存，就返回缓存的结果，否则再次执行被拦截的方法，并缓存结果供下次调用。具体代码如下：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24
25</p>
<p>26
27</p>
<p>28
29</p>
<p>30
31</p>
<p>32
33</p>
<p>34
35</p>
<p>36
37</p>
<p>38
39</p>
<p>40
41</p>
<p>42
43</p>
<p>44
public</p>
<p>class</p>
<p>MethodCacheInterceptor</p>
<p>implements</p>
<p>MethodInterceptor,</p>
<p>InitializingBean {
private</p>
<p>Cache cache;</p>
<p>public</p>
<p>void</p>
<p>setCache(Cache cache) {</p>
<p>this</p>
<p>.cache = cache;
}</p>
<p>public</p>
<p>void</p>
<p>afterPropertiesSet()</p>
<p>throws</p>
<p>Exception {</p>
<p>Assert.notNull(cache,
&quot;A cache is required. Use setCache(Cache) to provide one.&quot;</p>
<p>);</p>
<p>}</p>
<p>public</p>
<p>Object invoke(MethodInvocation invocation)</p>
<p>throws</p>
<p>Throwable {
String targetName = invocation.getThis().getClass().getName();</p>
<p>String methodName = invocation.getMethod().getName();
Object[] arguments = invocation.getArguments();</p>
<p>Object result;
String cacheKey = getCacheKey(targetName, methodName, arguments);</p>
<p>Element element =</p>
<p>null</p>
<p>;
synchronized</p>
<p>(</p>
<p>this</p>
<p>){</p>
<p>element = cache.get(cacheKey);
if</p>
<p>(element ==</p>
<p>null</p>
<p>) {</p>
<p>//调用实际的方法
result = invocation.proceed();</p>
<p>element =</p>
<p>new</p>
<p>Element(cacheKey, (Serializable) result);
cache.put(element);</p>
<p>}
}</p>
<p>return</p>
<p>element.getValue();
}</p>
<p>private</p>
<p>String getCacheKey(String targetName, String methodName,</p>
<p>Object[] arguments) {
StringBuffer sb =</p>
<p>new</p>
<p>StringBuffer();</p>
<p>sb.append(targetName).append(</p>
<p>&quot;.&quot;</p>
<p>).append(methodName);
if</p>
<p>((arguments !=</p>
<p>null</p>
<p>) &amp;&amp; (arguments.length !=</p>
<p>0</p>
<p>)) {</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>i =</p>
<p>0</p>
<p>; i &lt; arguments.length; i++) {
sb.append(</p>
<p>&quot;.&quot;</p>
<p>).append(arguments[i]);</p>
<p>}
}</p>
<p>return</p>
<p>sb.toString();
}</p>
<p>}</p>
<p>synchronized (this)这段代码实现了同步功能。为什么一定要同步？Cache对象本身的get和put操作是同步的。如果我们缓存的数据来自数据库查询，在没有这段同步代码时，当key不存在或者key对应的对象已经过期时，在多线程并发访问的情况下，许多线程都会重新执行该方法，由于对数据库进行重新查询代价是比较昂贵的，而在瞬间大量的并发查询，会对数据库服务器造成非常大的压力。所以这里的同步代码是很重要的。</p>
<p>接下来，继续完成拦截器和Bean的配置：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15&lt;</p>
<p>bean</p>
<p>id</p>
<p>=</p>
<p>&quot;methodCacheInterceptor&quot;</p>
<p>class</p>
<p>=</p>
<p>&quot;com.xiebing.utils.interceptor.MethodCacheInterceptor&quot;</p>
<p>&gt;</p>
<p>&lt;</p>
<p>property</p>
<p>name</p>
<p>=</p>
<p>&quot;cache&quot;</p>
<p>&gt;
&lt;</p>
<p>ref</p>
<p>local</p>
<p>=</p>
<p>&quot;demoCache&quot;</p>
<p>/&gt;</p>
<p>&lt;/</p>
<p>property</p>
<p>&gt;
&lt;/</p>
<p>bean</p>
<p>&gt;</p>
<p>&lt;</p>
<p>bean</p>
<p>id</p>
<p>=</p>
<p>&quot;methodCachePointCut&quot;</p>
<p>class</p>
<p>=</p>
<p>&quot;org.springframework.aop.support.RegexpMethodPointcutAdvisor&quot;</p>
<p>&gt;
&lt;</p>
<p>property</p>
<p>name</p>
<p>=</p>
<p>&quot;advice&quot;</p>
<p>&gt;</p>
<p>&lt;</p>
<p>ref</p>
<p>local</p>
<p>=</p>
<p>&quot;methodCacheInterceptor&quot;</p>
<p>/&gt;
&lt;/</p>
<p>property</p>
<p>&gt;</p>
<p>&lt;</p>
<p>property</p>
<p>name</p>
<p>=</p>
<p>&quot;patterns&quot;</p>
<p>&gt;
&lt;</p>
<p>list</p>
<p>&gt;</p>
<p>&lt;</p>
<p>value</p>
<blockquote>
<p>./*myMethod&lt;/</p>
</blockquote>
<p>value</p>
<p>&gt;
&lt;/</p>
<p>list</p>
<p>&gt;</p>
<p>&lt;/</p>
<p>property</p>
<p>&gt;
&lt;/</p>
<p>bean</p>
<p>&gt;</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13&lt;</p>
<p>bean</p>
<p>id</p>
<p>=</p>
<p>&quot;myServiceBean&quot;</p>
<p>class</p>
<p>=</p>
<p>&quot;com.xiebing.ehcache.spring.MyServiceBean&quot;</p>
<p>&gt;
&lt;/</p>
<p>bean</p>
<p>&gt;</p>
<p>&lt;</p>
<p>bean</p>
<p>id</p>
<p>=</p>
<p>&quot;myService&quot;</p>
<p>class</p>
<p>=</p>
<p>&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</p>
<p>&gt;
&lt;</p>
<p>property</p>
<p>name</p>
<p>=</p>
<p>&quot;target&quot;</p>
<p>&gt;</p>
<p>&lt;</p>
<p>ref</p>
<p>local</p>
<p>=</p>
<p>&quot;myServiceBean&quot;</p>
<p>/&gt;
&lt;/</p>
<p>property</p>
<p>&gt;</p>
<p>&lt;</p>
<p>property</p>
<p>name</p>
<p>=</p>
<p>&quot;interceptorNames&quot;</p>
<p>&gt;
&lt;</p>
<p>list</p>
<p>&gt;</p>
<p>&lt;</p>
<p>value</p>
<blockquote>
<p>methodCachePointCut&lt;/</p>
</blockquote>
<p>value</p>
<p>&gt;
&lt;/</p>
<p>list</p>
<p>&gt;</p>
<p>&lt;/</p>
<p>property</p>
<p>&gt;
&lt;/</p>
<p>bean</p>
<p>&gt;</p>
<p>其中myServiceBean是实现了业务逻辑的Bean，里面的方法myMethod()的返回结果需要被缓存。这样每次对myServiceBean的myMethod()方法进行调用,都会首先从缓存中查找,其次才会查询数据库。使用AOP的方式极大地提高了系统的灵活性，通过修改配置文件就可以实现对方法结果的缓存，所有的对Cache的操作都封装在了拦截器的实现中。</p>
<p> CachingFilter功能
使用Spring的AOP进行整合，可以灵活的对方法的的返回结果对象进行缓存。CachingFilter功能可以对HTTP响应的内容进行缓存。这种方式缓存数据的粒度比较粗，例如缓存整张页面。它的优点是使用简单、效率高，缺点是不够灵活，可重用程度不高。
EHCache使用SimplePageCachingFilter类实现Filter缓存。该类继承自CachingFilter，有默认产生cache key的calculateKey()方法，该方法使用HTTP请求的URI和查询条件来组成key。也可以自己实现一个Filter，同样继承CachingFilter类,然后覆写calculateKey()方法，生成自定义的key。
在笔者参与的项目中很多页面都使用AJAX，为保证JS请求的数据不被浏览器缓存，每次请求都会带有一个随机数参数i。如果使用SimplePageCachingFilter，那么每次生成的key都不一样，缓存就没有意义了。这种情况下，我们就会覆写calculateKey()方法。</p>
<p>要使用SimplePageCachingFilter，首先在配置文件ehcache.xml中，增加下面的配置：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
&lt;</p>
<p>cache</p>
<p>name</p>
<p>=</p>
<p>&quot;SimplePageCachingFilter&quot;</p>
<p>maxElementsInMemory</p>
<p>=</p>
<p>&quot;10000&quot;</p>
<p>eternal</p>
<p>=</p>
<p>&quot;false&quot;</p>
<p>overflowToDisk</p>
<p>=</p>
<p>&quot;false&quot;</p>
<p>timeToIdleSeconds</p>
<p>=</p>
<p>&quot;300&quot;</p>
<p>timeToLiveSeconds</p>
<p>=</p>
<p>&quot;600&quot;
memoryStoreEvictionPolicy</p>
<p>=</p>
<p>&quot;LFU&quot;</p>
<p>/&gt;</p>
<p>其中name属性必须为SimplePageCachingFilter，修改web.xml文件，增加一个Filter的配置：
&lt;</p>
<p>filter</p>
<p>&gt;</p>
<p>&lt;</p>
<p>filter-name</p>
<blockquote>
<p>SimplePageCachingFilter&lt;/</p>
</blockquote>
<p>filter-name</p>
<p>&gt;
&lt;</p>
<p>filter-class</p>
<blockquote>
<p>net.sf.ehcache.constructs.web.filter.SimplePageCachingFilter&lt;/</p>
</blockquote>
<p>filter-class</p>
<p>&gt;</p>
<p>&lt;/</p>
<p>filter</p>
<p>&gt;
&lt;</p>
<p>filter-mapping</p>
<p>&gt;</p>
<p>&lt;</p>
<p>filter-name</p>
<blockquote>
<p>SimplePageCachingFilter&lt;/</p>
</blockquote>
<p>filter-name</p>
<p>&gt;
&lt;</p>
<p>url-pattern</p>
<blockquote>
<p>/test.jsp&lt;/</p>
</blockquote>
<p>url-pattern</p>
<p>&gt;</p>
<p>&lt;/</p>
<p>filter-mapping</p>
<p>&gt;</p>
<p>下面我们写一个简单的test.jsp文件进行测试，缓存后的页面每次刷新，在600秒内显示的时间都不会发生变化的。代码如下：</p>
<p>1</p>
<p>2
3&lt;%</p>
<p>out.println(</p>
<p>new</p>
<p>Date());
%&gt;</p>
<p>CachingFilter输出的数据会根据浏览器发送的Accept-Encoding头信息进行Gzip压缩。经过笔者测试，Gzip压缩后的数据量是原来的1/4，速度是原来的4-5倍，所以缓存加上压缩，效果非常明显。
在使用Gzip压缩时，需注意两个问题：</p>
<ol>
<li>Filter在进行Gzip压缩时，采用系统默认编码，对于使用GBK编码的中文网页来说，需要将操作系统的语言设置为：zh_CN.GBK，否则会出现乱码的问题。</li>
<li>默认情况下CachingFilter会根据浏览器发送的请求头部所包含的Accept-Encoding参数值来判断是否进行Gzip压缩。虽然IE6/7浏览器是支持Gzip压缩的，但是在发送请求的时候却不带该参数。为了对IE6/7也能进行Gzip压缩，可以通过继承CachingFilter，实现自己的Filter，然后在具体的实现中覆写方法acceptsGzipEncoding。</li>
</ol>
<p>具体实现参考：
1</p>
<p>2
3</p>
<p>4
5protected</p>
<p>boolean</p>
<p>acceptsGzipEncoding(HttpServletRequest request) {</p>
<p>final</p>
<p>boolean</p>
<p>ie6 = headerContains(request,</p>
<p>&quot;User-Agent&quot;</p>
<p>,</p>
<p>&quot;MSIE 6.0&quot;</p>
<p>);
final</p>
<p>boolean</p>
<p>ie7 = headerContains(request,</p>
<p>&quot;User-Agent&quot;</p>
<p>,</p>
<p>&quot;MSIE 7.0&quot;</p>
<p>);</p>
<p>return</p>
<p>acceptsEncoding(request,</p>
<p>&quot;gzip&quot;</p>
<p>) || ie6 || ie7;
}</p>
<p>EHCache在Hibernate中的使用
EHCache可以作为Hibernate的二级缓存使用。在hibernate.cfg.xml中需增加如下设置：</p>
<p>1</p>
<p>2
3&lt;</p>
<p>prop</p>
<p>key</p>
<p>=</p>
<p>&quot;hibernate.cache.provider_class&quot;</p>
<p>&gt;</p>
<p>org.hibernate.cache.EhCacheProvider
&lt;/</p>
<p>prop</p>
<p>&gt;</p>
<p>然后在Hibernate映射文件的每个需要Cache的Domain中，加入类似如下格式信息：</p>
<p><cache usage="read-write|nonstrict-read-write|read-only" />
比如：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9&lt;</p>
<p>cache</p>
<p>usage</p>
<p>=</p>
<p>&quot;read-write&quot;</p>
<p>/&gt;</p>
<p>最后在配置文件ehcache.xml中增加一段cache的配置，其中name为该domain的类名。
&lt;</p>
<p>cache</p>
<p>name</p>
<p>=</p>
<p>&quot;domain.class.name&quot;</p>
<p>maxElementsInMemory</p>
<p>=</p>
<p>&quot;10000&quot;
eternal</p>
<p>=</p>
<p>&quot;false&quot;</p>
<p>timeToIdleSeconds</p>
<p>=</p>
<p>&quot;300&quot;
timeToLiveSeconds</p>
<p>=</p>
<p>&quot;600&quot;</p>
<p>overflowToDisk</p>
<p>=</p>
<p>&quot;false&quot;
/&gt;</p>
<p>EHCache的监控
对于Cache的使用，除了功能，在实际的系统运营过程中，我们会比较关注每个Cache对象占用的内存大小和Cache的命中率。有了这些数据，我们就可以对Cache的配置参数和系统的配置参数进行优化，使系统的性能达到最优。EHCache提供了方便的API供我们调用以获取监控数据，其中主要的方法有：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
//得到缓存中的对象数</p>
<p>cache.getSize();
//得到缓存对象占用内存的大小</p>
<p>cache.getMemoryStoreSize();
//得到缓存读取的命中次数</p>
<p>cache.getStatistics().getCacheHits()
//得到缓存读取的错失次数</p>
<p>cache.getStatistics().getCacheMisses()</p>
<p>分布式缓存
EHCache从1.2版本开始支持分布式缓存。分布式缓存主要解决集群环境中不同的服务器间的数据的同步问题。具体的配置如下：</p>
<p>在配置文件ehcache.xml中加入
1</p>
<p>2
3</p>
<p>4
5&lt;</p>
<p>cacheManagerPeerProviderFactory</p>
<p>class</p>
<p>=</p>
<p>&quot;net.sf.ehcache.distribution.RMICacheManagerPeerProviderFactory&quot;
properties</p>
<p>=</p>
<p>&quot;peerDiscovery=automatic, multicastGroupAddress=230.0.0.1, multicastGroupPort=4446&quot;</p>
<p>/&gt;</p>
<p>&lt;</p>
<p>cacheManagerPeerListenerFactory
class</p>
<p>=</p>
<p>&quot;net.sf.ehcache.distribution.RMICacheManagerPeerListenerFactory&quot;</p>
<p>/&gt;</p>
<p>另外，需要在每个cache属性中加入</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
&lt;</p>
<p>cacheEventListenerFactory</p>
<p>class</p>
<p>=</p>
<p>&quot;net.sf.ehcache.distribution.RMICacheReplicatorFactory&quot;</p>
<p>/&gt;</p>
<p>例如：
&lt;</p>
<p>cache</p>
<p>name</p>
<p>=</p>
<p>&quot;demoCache&quot;</p>
<p>maxElementsInMemory</p>
<p>=</p>
<p>&quot;10000&quot;
eternal</p>
<p>=</p>
<p>&quot;true&quot;</p>
<p>overflowToDisk</p>
<p>=</p>
<p>&quot;true&quot;</p>
<p>&gt;
&lt;</p>
<p>cacheEventListenerFactory</p>
<p>class</p>
<p>=</p>
<p>&quot;net.sf.ehcache.distribution.RMICacheReplicatorFactory&quot;</p>
<p>/&gt;</p>
<p>&lt;/</p>
<p>cache</p>
<p>&gt;</p>
<p>总结
EHCache是一个非常优秀的基于Java的Cache实现。它简单、易用，而且功能齐全，并且非常容易与Spring、Hibernate等流行的开源框架进行整合。通过使用EHCache可以减少网站项目中数据库服务器的访问压力，提高网站的访问速度，改善用户的体验。</p>
<p>原文:<a href="http://blog.sina.com.cn/s/blog_46d5caa40100ka9z.html" target="_blank">http://blog.sina.com.cn/s/blog_46d5caa40100ka9z.html</a>
<a href="http://www.dev26.com/blog/article/352/1#" title="分享到QQ空间" target="_blank"></a> <a href="http://www.dev26.com/blog/article/352/1#" title="分享到新浪微博"></a> <a href="http://www.dev26.com/blog/article/352/1#" title="分享到腾讯微博" target="_blank"></a> <a href="http://www.dev26.com/blog/article/352/1#" title="分享到人人网"></a> 更多 <a href="http://www.dev26.com/blog/article/352/1#" title="累计分享0次" target="_blank">0</a></p>
<p>-
评分
请<a href="http://www.dev26.com/login" target="_blank">登录</a>后再对此文章评分</p>
<p><a href=""></a>列出所有评论</p>
<p><strong>没有可显示的项目</strong></p>
<p>发表您的评论</p>
<p>您尚未登录，无法发表评论   <img src="&quot;登录&quot;" alt="dev26登录">为什么要登录后才能发表评论？ 我们发现许多网站的大多数恶意评论（人身攻击，广告等）都是以匿名形式发布的，这样难以使一个技术社区形成一个和谐的讨论氛围。我们鼓励网友提出中肯的评论，留下您的身份也使得作者更容易与您交流。  您当前的登录名为<em>**</em> 评论：</p>
<p><a href="">加入收藏</a>- <a href="&quot;设为首页&quot;">设为首页</a>- <a href="http://www.dev26.com/runtime/privacy.html" target="_blank">隐私保护</a>- <a href="http://www.dev26.com/runtime/contact.html" target="_blank">联系我们</a>- <a href="http://www.dev26.com/runtime/help.html" target="_blank">获得帮助</a></p>
<p>Web开发站——为Web开发增添活力 <a href="http://tongji.baidu.com/hm-web/welcome/ico?s=ac500a971f22019aa0e7403308701c33" target="_blank"><img src="" alt=""></a></p>
<p>版权所有 © 2011-2012 备案号:京ICP备12003253号-1</p>
<h3 id="-">发送消息</h3>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/缓存/">缓存</a></li></span><span class="breadcrumb"><li><a href="/categories/缓存/">缓存</a></li><li><a href="/categories/缓存/ehcache/">ehcache</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ehcache/" class="label label-primary">ehcache</a><a href="/tags/缓存/" class="label label-success">缓存</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-缓存-ehcache--EHCache的使用教程-黑神领主的博客-dev26com/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-缓存-ehcache--EHCache的使用教程-黑神领主的博客-dev26com" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-缓存-ehcache--EHCache-单落撒旦的日志-网易博客/">EHCache </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-缓存-ehcache--EHCache-单落撒旦的日志-网易博客/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="ehcache-">EHCache - 单落撒旦的日志 - 网易博客</h1>
<p><a href="http://www.360doc.com/help.html" target="_blank">帮助</a>|<a href="http://www.360doc.com/advice.html" target="_blank">留言交流</a>|  <a href="http://www.360doc.com/login.aspx?reurl=http://www.360doc.com/content/10/1207/16/3880760_75861362.shtml" target="_blank">登录</a></p>
<p><img src="" alt=""></p>
<p><a href="http://www.360doc.com/index.html" target="_blank">首 页</a> <a href="http://www.360doc.com/readroom.html" target="_blank">阅览室</a> <a href="http://www.360doc.com/weekstar.html" target="_blank">馆友</a> <a href="http://www.360doc.com/my360doc.aspx" target="_blank">我的图书馆</a>
<img src="" alt=""></p>
<p><a href=""><img src="" alt=""></a>
来自：<a href="http://www.360doc.com/userhome/3880760" target="_blank">软件123</a> &gt; <a href="http://www.360doc.com/userhome.aspx?userid=3880760&amp;cid=3" target="_blank">Hibernate</a></p>
<p>配色： <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> 字号：大中小 EHCache - 单落撒旦的日志 - 网易博客 2010-12-07 | 阅：257  转：1  |  <a href="http://www.360doc.com/content/10/1207/16/3880760_75861362.shtml#" target="_blank">分享</a> </p>
<p><img src="" alt=""></p>
<ul>
<li><a href="&quot;分享到QQ空间&quot;"><img src="" alt="分享到QQ空间">腾讯空间</a></li>
<li><a href="&quot;分享到人人&quot;"><img src="" alt="">人人网</a></li>
<li><a href="&quot;分享到开心&quot;"><img src="" alt="">开心网</a></li>
<li><a href=""><img src="" alt="分享到新浪微博">新浪微博</a></li>
<li><a href=""><img src="" alt="分享到腾讯微博">腾讯微博</a></li>
<li><a href="&quot;分享到搜狐微博&quot;"><img src="" alt="分享到搜狐微博">搜狐空间</a></li>
<li><img src="" alt="">推荐给朋友</li>
<li><img src="" alt="">举报
<a href="http://www.360doc.com/register.aspx?refer=57&amp;reurl=resaveArt.aspx?articleid=" target="_blank"><img src="" alt=""></a>
 <a href="http://yxp.163.com/h/action/photoplay.html?sss=frombkerz1116"></a>  </li>
</ul>
<p><a href="http://blog.163.com/zhang-_-jie/blog/static/16178437820105811397991/" target="_blank">Cache技术―OSCache</a></p>
<h3 id="ehcache">EHCache</h3>
<p><a href="http://blog.163.com/zhang-_-jie/blog/#m=0&amp;t=1&amp;c=fks_084067086083080064080080082095085080080068092082085068092" title="缓存技术" target="_blank">缓存技术</a> 2010-06-08 14:07:18 阅读170 评论0   字号：大<strong>中</strong>小 <a href="">订阅</a>
一、简介</p>
<p>非常简单，而且易用。</p>
<p>ehcache 是一个非常轻量级的缓存实现，而且从1.2 之后就支持了集群，而且是hibernate 默认的缓存provider 。EhCache 是一个纯Java的进程内缓存框架，具有快速、精干等特点，是Hibernate中默认的CacheProvider。</p>
<p>Ehcache可以直接使用。也可以和Hibernate对象/关系框架结合使用。还可以做Servlet缓存。</p>
<p>Cache 存储方式 ：内存或磁盘。</p>
<pre><code>   官方网站：[http://ehcache.sourceforge.net/](http://ehcache.sourceforge.net/)
</code></pre><p>主要特性</p>
<ol>
<li>快速.</li>
<li>简单.</li>
<li>多种缓存策略</li>
<li>缓存数据有两级：内存和磁盘，因此无需担心容量问题</li>
<li>缓存数据会在虚拟机重启的过程中写入磁盘</li>
<li>可以通过RMI、可插入API等方式进行分布式缓存</li>
<li>具有缓存和缓存管理器的侦听接口</li>
<li>支持多缓存管理器实例，以及一个实例的多个缓存区域</li>
<li>提供Hibernate的缓存实现</li>
<li>等等</li>
</ol>
<p>二、快速上手</p>
<p>1、  项目类库中添加ehcache.jar；</p>
<p>2、  在类路径下编写ehcache.xml配置文件。</p>
<p>三、配置文件参数详解</p>
<p>ehcache.xml是ehcache的配置文件，并且存放在应用的classpath中。下面是对该XML文件中的一些元素及其属性的相关说明： </p>
<p><diskStore>元素：指定一个文件目录，当EHCache把数据写到硬盘上时，将把数据写到这个文件目录下。 下面的参数这样解释：   </p>
<pre><code>     user.home – 用户主目录   

     user.dir      – 用户当前工作目录   

     java.io.tmpdir – 默认临时文件路径
</code></pre><p><defaultCache>元素：设定缓存的默认数据过期策略。 </p>
<cache>元素：设定具体的命名缓存的数据过期策略。



<cache>元素的属性 

name：缓存名称。通常为缓存对象的类名（非严格标准）。 

maxElementsInMemory：设置基于内存的缓存可存放对象的最大数目。 

maxElementsOnDisk：设置基于硬盘的缓存可存放对象的最大数目。<br>
eternal：如果为true，表示对象永远不会过期，此时会忽略timeToIdleSeconds和timeToLiveSeconds属性，默认为false; 

timeToIdleSeconds： 设定允许对象处于空闲状态的最长时间，以秒为单位。当对象自从最近一次被访问后，如果处于空闲状态的时间超过了timeToIdleSeconds属性值，这个对象就会过期。当对象过期，EHCache将把它从缓存中清空。只有当eternal属性为false，该属性才有效。如果该属性值为0，则表示对象可以无限期地处于空闲状态。 

timeToLiveSeconds：设定对象允许存在于缓存中的最长时间，以秒为单位。当对象自从被存放到缓存中后，如果处于缓存中的时间超过了 timeToLiveSeconds属性值，这个对象就会过期。当对象过期，EHCache将把它从缓存中清除。只有当eternal属性为false，该属性才有效。如果该属性值为0，则表示对象可以无限期地存在于缓存中。timeToLiveSeconds必须大于timeToIdleSeconds属性，才有意义。 

overflowToDisk：如果为true,表示当基于内存的缓存中的对象数目达到了maxElementsInMemory界限后，会把益出的对象写到基于硬盘的缓存中。注意：如果缓存的对象要写入到硬盘中的话，则该对象必须实现了Serializable接口才行。

memoryStoreEvictionPolicy：缓存对象清除策略。有三种：

1 FIFO ，first in first out ，这个是大家最熟的，先进先出，不多讲了

2 LFU ， Less Frequently Used ，就是上面例子中使用的策略，直白一点就是讲一直以来最少被使用的。如上面所讲，缓存的元素有一个hit 属性，hit 值最小的将会被清出缓存。

2 LRU ，Least Recently Used ，最近最少使用的，缓存的元素有一个时间戳，当缓存容量满了，而又需要腾出地方来缓存新的元素的时候，那么现有缓存元素中时间戳离当前时间最远的元素将被清出缓存。

四、单独使用EHCache

1.创建CacheManager （net.sf.ehcache.CacheManager）

（1）使用默认配置文件创建

CacheManager manager = CacheManager.create();

（2）使用指定配置文件创建

CacheManager manager = CacheManager.create(&quot;src/config/ehcache.xml&quot;);

（3）从classpath找寻配置文件并创建

URL url = getClass().getResource(&quot;/anothername.xml&quot;);

CacheManager manager = CacheManager.create(url);

（4）通过输入流创建

InputStream fis = new FileInputStream(new File(&quot;src/config/ehcache.xml&quot;).getAbsolutePath());

try { manager = CacheManager.create(fis); } finally { fis.close(); }



2.创建Caches （net.sf.ehcache.Cache）

（1）取得配置文件中预先 定义的sampleCache1设置,生成一个Cache

Cache cache = manager.getCache(&quot;sampleCache1&quot;);



（2）设置一个名为test 的新cache,test属性为默认

CacheManager manager = CacheManager.create();

manager.addCache(&quot;test&quot;);



（3）设置一个名为test 的新cache,并定义其属性

CacheManager manager = CacheManager.create();

Cache cache = new Cache(&quot;test&quot;, 1, true, false, 5, 2);

manager.addCache(cache);



（4）删除cache

CacheManager singletonManager = CacheManager.create();

singletonManager.removeCache(&quot;sampleCache1&quot;);<br>


3.使用Caches

（1）往cache中加入元素

Element element = new Element(&quot;key1&quot;, &quot;value1&quot;);

cache.put(new Element(element);



（2）从cache中取得元素

Element element = cache.get(&quot;key1&quot;);



（3）从cache中删除元素

Cache cache = manager.getCache(&quot;sampleCache1&quot;);

Element element = new Element(&quot;key1&quot;, &quot;value1&quot;);

cache.remove(&quot;key1&quot;);<br>


3.卸载CacheManager ,关闭Cache

 manager.shutdown();

下附代码。





五、在 Hibernate 中运用EHCache

1、hibernate.cfg.xml中需设置如下：

3系列版本加入
<property name=” hibernate.cache.provider_class”>
org.hibernate.cache.EhCacheProvider
</property>  EhCacheProvider类位于hibernate3.jar

2.1版本加入

net.sf.ehcache.hibernate.Provider

2.1以下版本加入

net.sf.hibernate.cache.EhCache



2、在Hibernate3.x中的etc目录下有ehcache.xml的示范文件，将其复制应用程序的src目录下（编译时会把ehcache.xml复制到WEB-INF/classess目录下），对其中的相关值进行更改以和自己的程序相适合。



3、持久化类的映射文件进行配置

       <cache usage="read-write"/>

在<set>标记中设置了<cache usage="read-write"/>，但Hibernate仅把和Group相关的Student的主键id加入到缓存中，如果希望把整个Student的散装属性都加入到二级缓存中，还需要在Student.hbm.xml文件的<class>标记中加入<cache>子标记，如下所示：

<cache usage="read-write" /> <!--cache标记需跟在class标记后-->



注：SSH中hibernate配置的cache信息

<prop key="hibernate.cache.provider_class">org.hibernate.cache.EhCacheProvider</prop>

六、在页面中使用EHCache缓存

       简单的来说，如果一个应用中80% 的时间内都在访问20% 的数据，那么，这时候就应该使用缓存了。

       在80/20 原则生效的地方，我们都应该考虑是否可以使用缓存。但即使是这样，缓存也有不同的用法，举个例子，一个网站的首页估计是被访问的次数最多的，我们可以考虑给首页做一个页面缓存。页面访问最频繁的，做缓存。不同的页面的缓存策略有可能有天壤之别。

       毫无疑问，几乎所有的网站的首页都是访问率最高的，而首页上的数据来源又是非常广泛的，大多数来自不同的对象，而且有可能来自不同的db ，所以给首页做缓存是一个不错的主意，那么主页的缓存策略是什么样子的呢，我认为应该是某个固定时间之内不变的，比如说2 分钟更新一次。或者根据不同的网页功能采取合理的策略。



在使用ehcache 的页面缓存之前，我们必须要了解ehcache 的2个概念：

（1）timeToIdleSeconds ，多长时间不访问该缓存，那么ehcache 就会清除该缓存。

（2）timeToLiveSeconds ，缓存的存活时间，从开始创建的时间算起。



1、配置ehcache.xml文件

2、在web.xml配置文件中配置过滤器信息

好了，缓存整个页面看上去是非常的简单，甚至都不需要写一行代码，只需要几行配置就行了，够简单吧，虽然看上去简单，但是事实上内部实现却不简单哦，有兴趣的话，大家可以看看SimplePageCachingFilter 继承体系的源代码。



缓存首页（整个页面）示例：

&lt; filter &gt;

        &lt; filter-name &gt; indexCacheFilter </filter-name >

        &lt; filter-class &gt;

            net.sf.ehcache.constructs.web.filter.SimplePageCachingFilter

        </filter-class >

</filter ><br>
&lt; filter-mapping &gt;

        &lt; filter-name &gt; indexCacheFilter </filter-name >

        &lt; url-pattern &gt; /<em>index.action </url-pattern >

</filter-mapping >



缓存首页的部分内容时，需要使用SimplePageFragmentCachingFilter 这个filter 。如：<br>
&lt; filter &gt;

        &lt; filter-name &gt; indexCacheFilter </filter-name >

        &lt; filter-class &gt;

            net.sf.ehcache.constructs.web.filter.SimplePageFragmentCachingFilter

        </filter-class >

</filter ><br>
&lt; filter-mapping &gt;

        &lt; filter-name &gt; indexCacheFilter </filter-name >

        &lt; url-pattern &gt; /</em>/index_right.jsp </url-pattern >

</filter-mapping ><br>
这个jsp 需要被jsp:include 到其他页面，这样就做到的局部页面的缓存。这一点貌似没有oscache 的tag 好用。



七、在Spring框架中使用EHCache缓存



       就是使用Spring提供的springmodules和EHCache来简化程序的开发，通过配置文件来完成提供缓存。参考springmodules的文档。



1、配置ehcache.xml文件

2、创建Spring EHCache的配置xml文件

配置文件代码示例（调试通过）：

&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

<beans xmlns="http://www.springframework.org/schema/beans"

    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"

    xmlns:aop="http://www.springframework.org/schema/aop"

    xmlns:tx="http://www.springframework.org/schema/tx"

    xmlns:ehcache="http://www.springmodules.org/schema/ehcache"

    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd  

    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd  

    http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd   

    http://www.springmodules.org/schema/ehcache http://www.springmodules.org/schema/cache/springmodules-ehcache.xsd">



    <bean id="EhCacheFacade"

       class="org.springmodules.cache.provider.ehcache.EhCacheFacade">

       <property name="failQuietlyEnabled" value="true" />

       <property name="cacheManager">

           <bean

              class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean">

              <property name="configLocation"

                  value="classpath:ehcache.xml">

              </property>

           </bean>

       </property>

    </bean>



    <bean id="cachingInterceptor"

       class="org.springmodules.cache.interceptor.caching.MethodMapCachingInterceptor">

       <property name="cacheProviderFacade" ref="EhCacheFacade" />

       <property name="cachingModels">

           <props>

              <prop key="com....test.Manager.get/*">

                  cacheName=dictCache

              </prop>

           </props>

       </property>

    </bean>



    <bean id="flushingInterceptor"

       class="org.springmodules.cache.interceptor.flush.MethodMapFlushingInterceptor">

       <property name="cacheProviderFacade" ref="EhCacheFacade" />

       <property name="flushingModels">

           <props>

              <prop key="com....test.Manager.update/*">

                  cacheNames=dictCache

              </prop>

           </props>

       </property>

    </bean>



    <bean

       class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator">

       <property name="beanNames">

           <value>/*anager</value>

       </property>

       <property name="interceptorNames">

           <list>

              <value>flushingInterceptor</value>

              <value>cachingInterceptor</value>

           </list>

       </property>

    </bean>

    <bean id="manager" class="com...test.Manager"></bean>

</beans>

 <cache name="dictCache"

    maxElementsInMemory="50"

    eternal="false"

    timeToIdleSeconds="60"

    timeToLiveSeconds="60"

    overflowToDisk="false"

    memoryStoreEvictionPolicy="LFU">

    </cache>



<p>也可以使用注解的形式进行标注缓存方法，不过要修改配置文件，详见springmodules的文档，这里就不提供了。</p>
<p>缓存说明：</p>
<p>1、方法不含有参数</p>
<pre><code>时间到期缓存失效；调用flush，缓存失效。
</code></pre><p>2、方法中含有参数</p>
<pre><code>参数不同则每次都缓存,若缓存中存在相同对象，则调用缓存。

当调用flush，该id对应的缓存都失效。

当缓存时间到期，该id对应的缓存都失效。
</code></pre><p>建议：对没有关联的缓存对象采取不同的id配置。所以ehcache会有好多的cache-id配置信息。</p>
<pre><code>       &lt;props&gt;

          &lt;prop key=&quot;com....test.Manager.get/*&quot;&gt;

              cacheName=dictCache

          &lt;/prop&gt;

          ………                     

          &lt;prop key=&quot;com....test.Manager2.get/*&quot;&gt;

              cacheName=dictCache2

          &lt;/prop&gt;

       &lt;/props&gt;



       &lt;props&gt;

          &lt;prop key=&quot;com....test.Manager.update/*&quot;&gt;

              cacheNames=dictCache

          &lt;/prop&gt;

          ………

          &lt;prop key=&quot;com....test.Manager2.update/*&quot;&gt;

              cacheNames=dictCache2

          &lt;/prop&gt;

       &lt;/props&gt;
</code></pre><p>  上一篇：<a href="http://www.360doc.com/content/10/1206/20/3880760_75614432.shtml" target="_blank">基于按annotation的hibernate主键生成策略 - 白首穷经通秘义...</a></p>
<p>下一篇：<a href="http://www.360doc.com/content/10/1207/16/3880760_75862016.shtml" target="_blank">Cache技术―OSCache - 单落撒旦的日志 - 网易博客</a> <a href=""><img src="" alt=""></a></p>
<p>献花(0)</p>
<p>+1 分享到：<a href="&quot;分享到QQ空间&quot;"><img src="" alt="分享到QQ空间"></a><a href="&quot;分享到人人&quot;"><img src="" alt=""></a><a href="&quot;分享到开心&quot;"><img src="" alt=""></a><a href=""><img src="" alt="分享到新浪微博"></a><a href=""><img src="" alt="分享到腾讯微博"></a><a href="&quot;分享到搜狐微博&quot;"><img src="" alt="分享到搜狐微博"></a><a href=""><img src="" alt=""></a></p>
<ul>
<li><img src="" alt="">推荐给朋友</li>
<li><img src="" alt="">举报  (本文系<a href="http://www.360doc.com/userhome/3880760" target="_blank">软件123</a>首藏  <a href="http://blog.163.com/zhang-_-jie/blog/static/1617843782010582718212/" target="_blank">源文网址</a>)</li>
</ul>
<p>类似文章</p>
<ul>
<li><a href="http://www.360doc.com/content/11/0811/15/7270363_139632250.shtml" target="_blank">Ehcache</a></li>
<li><a href="http://www.360doc.com/content/07/0828/15/5136_700268.shtml" target="_blank">配置Spring+hibernate使用ehcache作为se...</a></li>
<li><a href="http://www.360doc.com/content/06/0927/12/6272_218072.shtml" target="_blank">Hibernate ehcache二级缓存技术</a></li>
<li><a href="http://www.360doc.com/content/10/1011/11/2560742_60066155.shtml" target="_blank">EhCache使用详细介绍（转）</a></li>
<li><a href="http://www.360doc.com/content/11/0402/17/6069386_106731794.shtml" target="_blank">二级 ehcache</a></li>
<li><a href="http://www.360doc.com/content/11/1216/17/6088543_172744745.shtml" target="_blank">Hibernate一级缓存和二级缓存</a></li>
<li><a href="http://www.360doc.com/content/10/1128/16/1689336_73159043.shtml" target="_blank">【有声读物】单田芳评书 - 浅草细浪的日...</a></li>
<li><a href="http://www.360doc.com/content/09/0803/16/189491_4643744.shtml" target="_blank">低血压 - 只要有你的日志 - 网易博客</a></li>
<li><a href="http://www.360doc.com/content/10/0207/18/289502_15377865.shtml" target="_blank">网易博客教程一 - 闲人SGM的日志 - 网易...</a>
<a href="http://www.360doc.com/relevant/75861362_more.shtml" target="_blank">更多</a></li>
</ul>
<p>0</p>
<p><img src="" alt="正在加载推荐文章"></p>
<p>您可能会喜欢</p>
<p>[<img src="" alt=""></p>
<p>老师开博客 天天开&quot;网上家长会&quot;
](<a href="http://www.360doc.com/content/07/0508/10/26144_488073.shtml" target="_blank">http://www.360doc.com/content/07/0508/10/26144_488073.shtml</a> &quot;老师开博客 天天开&quot;网上家长会&quot;&quot;) [<img src="" alt=""></p>
<p>博客冲击波（1）----商业周刊精华文章
](<a href="http://www.360doc.com/content/08/0706/10/8596_1402791.shtml" target="_blank">http://www.360doc.com/content/08/0706/10/8596_1402791.shtml</a> &quot;博客冲击波（1）----商业周刊精华文章&quot;) [<img src="" alt=""></p>
<p>红杏妹的博客 l
](<a href="http://www.360doc.com/content/12/0307/16/5060984_192513101.shtml" target="_blank">http://www.360doc.com/content/12/0307/16/5060984_192513101.shtml</a> &quot;红杏妹的博客 l&quot;) [<img src="" alt=""></p>
<p>Ehcache
](<a href="http://www.360doc.com/content/11/0811/15/7270363_139632250.shtml" target="_blank">http://www.360doc.com/content/11/0811/15/7270363_139632250.shtml</a> &quot;Ehcache&quot;) [<img src="" alt=""></p>
<p>教你怎样制作博客首页 - 敏儿的日志 - 网易博客
](<a href="http://www.360doc.com/content/10/0317/13/826574_19113845.shtml" target="_blank">http://www.360doc.com/content/10/0317/13/826574_19113845.shtml</a> &quot;教你怎样制作博客首页 - 敏儿的日志 - 网易博客&quot;)</p>
<p><a href="http://www.wumii.com/widget/relatedItems" title="无觅相关文章插件" target="_blank">无觅</a>
<a href=""></a></p>
<p><img src="" alt=""></p>
<p>发表评论：</p>
<p>您好，请 <a href="">登录</a> 或者 <a href="http://www.360doc.com/register.aspx?refer=53&amp;reurl=showweb/0/0/75861362.aspx" target="_blank">注册</a> 后再进行评论
使用合作网站登录：<img src="" alt="">新浪微博<img src="" alt="">QQ<img src="" alt="">人人
<img src="" alt="">
  <a href="http://www.360doc.com/userhome/3880760" target="_blank"><img src="" alt=""></a></p>
<p><a href="http://www.360doc.com/userhome/3880760" target="_blank">孙中熙——路</a></p>
<p>馆藏：<a href="http://www.360doc.com/userhome.aspx?userid=3880760&amp;app=1" target="_blank">157</a>
关注我：<a href="http://www.360doc.com/userhome.aspx?userid=3880760&amp;app=2" target="_blank">1</a></p>
<p><a href=""><img src="" alt=""></a> <a href=""><img src="" alt=""></a></p>
<p>最新文章</p>
<ul>
<li><a href="http://www.360doc.com/content/12/0912/20/3880760_235775281.shtml" target="_blank">JS计算字符串所占字节数</a></li>
<li><a href="http://www.360doc.com/content/12/0624/09/3880760_220086498.shtml" target="_blank">List的功能方法</a></li>
<li><a href="http://www.360doc.com/content/12/0225/15/3880760_189532854.shtml" target="_blank">maven dependency:sources</a></li>
<li><a href="http://www.360doc.com/content/12/0219/15/3880760_187825046.shtml" target="_blank">IBatis</a></li>
<li><a href="http://www.360doc.com/content/12/0218/13/3880760_187576669.shtml" target="_blank">myeclipse 8.5-9.0 安装 svn 方...</a></li>
<li><a href="http://www.360doc.com/content/12/0218/11/3880760_187551055.shtml" target="_blank">深入理解Java序列化中的SerialV...</a></li>
<li><a href="http://www.360doc.com/content/12/0218/11/3880760_187550886.shtml" target="_blank">关于spring中 几个 java.lang.C...</a></li>
<li><a href="http://www.360doc.com/content/12/0216/20/3880760_187173708.shtml" target="_blank">Derby 轻量级数据库</a></li>
<li><a href="http://www.360doc.com/content/12/0216/20/3880760_187173508.shtml" target="_blank">Template method pattern 模板...</a></li>
<li><a href="http://www.360doc.com/content/12/0216/20/3880760_187173416.shtml" target="_blank">工厂方法模式(Factory method)...</a></li>
<li><a href="http://www.360doc.com/content/12/0216/20/3880760_187173300.shtml" target="_blank">DAO层的分析（一）</a></li>
<li><a href="http://www.360doc.com/content/12/0216/20/3880760_187173130.shtml" target="_blank">提高数据库并发性能概要</a>
<a href="http://www.360doc.com/userhome/3880760" target="_blank">更多&gt;&gt;</a>
-</li>
</ul>
<p>热门文章</p>
<ul>
<li><a href="http://www.360doc.com/content/12/0428/23/0_207401601.shtml" target="_blank">99天毛笔书法速成练习</a></li>
<li><a href="http://www.360doc.com/content/11/0111/14/0_85740115.shtml" target="_blank">素饺子 做法集锦</a></li>
<li><a href="http://www.360doc.com/content/11/0609/10/0_122630336.shtml" target="_blank">趣图：我就喜欢你最丑的样子</a></li>
<li><a href="http://www.360doc.com/content/12/0222/16/0_188656716.shtml" target="_blank">巧做爽口腌黄瓜（图）</a></li>
<li><a href="http://www.360doc.com/content/12/0305/14/0_191838346.shtml" target="_blank">一个人的私奔</a></li>
<li><a href="http://www.360doc.com/content/10/0719/06/0_39976494.shtml" target="_blank">老中医的长寿秘诀——长寿粥</a></li>
<li><a href="http://www.360doc.com/content/11/0813/18/0_140148370.shtml" target="_blank">海论英语《从零开始学口语》（4...</a></li>
<li><a href="http://www.360doc.com/content/11/1205/23/0_169982196.shtml" target="_blank">尿路结石的秘方</a></li>
<li><a href="http://www.360doc.com/content/10/0713/13/0_38709357.shtml" target="_blank">能不能不要装可爱(图片)</a></li>
<li><a href="http://www.360doc.com/content/12/0511/08/0_210233282.shtml" target="_blank">好吃的茄饼蒸肉</a></li>
<li><a href="http://www.360doc.com/content/10/0811/21/0_45363446.shtml" target="_blank">庄子的快活 穿越时空之舞</a></li>
<li><a href="http://www.360doc.com/content/11/0613/15/0_126649064.shtml" target="_blank">健康教育处方大全</a>
<a href="http://www.360doc.com/readroom.html" target="_blank">更多&gt;&gt;</a></li>
</ul>
<p><a href="">关闭</a></p>
<p><a href="http://www.360doc.com/mobilapp.htm" target="_blank"><img src="" alt=""></a></p>
<p><a href="http://www.360doc.com/content/10/1207/16/3880760_75861362.shtml#"></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/缓存/">缓存</a></li></span><span class="breadcrumb"><li><a href="/categories/缓存/">缓存</a></li><li><a href="/categories/缓存/ehcache/">ehcache</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ehcache/" class="label label-primary">ehcache</a><a href="/tags/缓存/" class="label label-success">缓存</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-缓存-ehcache--EHCache-单落撒旦的日志-网易博客/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-缓存-ehcache--EHCache-单落撒旦的日志-网易博客" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-缓存-ehcache--EHCache分布式缓存集群环境配置-七郎-博客园/">EHCache分布式缓存集群环境配置 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-缓存-ehcache--EHCache分布式缓存集群环境配置-七郎-博客园/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="ehcache-">EHCache分布式缓存集群环境配置 - 七郎 - 博客园</h1>
<p><a href=""></a></p>
<p><a href="http://www.cnblogs.com/yangy608/" target="_blank"><img src="" alt="返回主页"></a></p>
<h1 id="-s-blog-http-www-cnblogs-com-yangy608-"><a href="http://www.cnblogs.com/yangy608/" target="_blank">七郎&#39;s Blog</a></h1>
<h2 id="-">草木竹石皆可為劒。至人之用人若鏡，不將不迎，應而不藏，故能勝物而不傷。</h2>
<ul>
<li><a href="http://www.cnblogs.com/" target="_blank">博客园</a></li>
<li><a href="http://www.cnblogs.com/yangy608/" target="_blank">首页</a></li>
<li><a href="http://news.cnblogs.com/" target="_blank">新闻</a></li>
<li><a href="http://www.cnblogs.com/yangy608/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a></li>
<li><a href="http://space.cnblogs.com/msg/send/%e4%b8%83%e9%83%8e" target="_blank">联系</a></li>
<li><a href="http://www.cnblogs.com/yangy608/admin/EditPosts.aspx" target="_blank">管理</a></li>
<li><a href="http://www.cnblogs.com/yangy608/rss" target="_blank">订阅</a><a href="http://www.cnblogs.com/yangy608/rss" target="_blank"><img src="" alt="订阅"></a>
随笔- 144 文章- 1 评论- 1 </li>
</ul>
<h1 id="-ehcache-http-www-cnblogs-com-yangy608-archive-2011-10-07-2200669-html-"><a href="http://www.cnblogs.com/yangy608/archive/2011/10/07/2200669.html" target="_blank">EHCache分布式缓存集群环境配置</a></h1>
<p>ehcache提供三种网络连接策略来实现集群，rmi,jgroup还有jms。同时ehcache可以可以实现多播的方式实现集群,也可以手动指定集群主机序列实现集群。</p>
<p>Ehcache支持的分布式缓存支持有三种RMI，JGroups，JMS，这里介绍下MRI和JGrpups两种方式，Ehcache使用版本为1.5.0，关于ehcache的其他信息请参考<a href="http://ehcache.sourceforge.net/EhcacheUserGuide.html" target="_blank"><a href="http://ehcache.sourceforge.net/EhcacheUserGuide.html">http://ehcache.sourceforge.net/EhcacheUserGuide.html</a></a>，</p>
<p>关于jgroups的信息请参考<a href="http://www.jgroups.org/manual/html_single/index.html。" target="_blank">http://www.jgroups.org/manual/html_single/index.html。</a></p>
<p>环境为两台机器 server1 ip：192.168.2.154，server2 ip：192.168.2.23</p>
<h3 id="1-rmi-">1. RMI方式：</h3>
<p>rmi的方式配置要点（下面均是server1上的配置，server2上的只需要把ip兑换即可）</p>
<p><strong>a. 配置PeerProvider：</strong></p>
<p>Xml代码</p>
<cacheManagerPeerProviderFactory class="net.sf.ehcache.distribution.RMICacheManagerPeerProviderFactory"

properties="peerDiscovery=manual,rmiUrls=//192.168.2.23:40001/userCache|//192.168.2.23:40001/resourceCache" /> 

<p>配置中通过手动方式同步sever2中的userCache和resourceCache。</p>
<p><strong>b. 配置CacheManagerPeerListener：</strong></p>
<p>Xml代码</p>
<cacheManagerPeerListenerFactory class="net.sf.ehcache.distribution.RMICacheManagerPeerListenerFactory"

properties="hostName=192.168.2.154, port=40001,socketTimeoutMillis=2000" /> 

<p>配置中server1监听本机40001端口。</p>
<p><strong>c. 在每一个cache中添加cacheEventListener，例子如下：</strong></p>
<p>Xml代码</p>
<cache name="userCache" maxElementsInMemory="10000" eternal="true" overflowToDisk="true" timeToIdleSeconds="0" timeToLiveSeconds="0"diskPersistent="false" diskExpiryThreadIntervalSeconds="120">

<cacheEventListenerFactory class="net.sf.ehcache.distribution.RMICacheReplicatorFactory" properties="replicateAsynchronously=true, replicatePuts=true, replicateUpdates=true,replicateUpdatesViaCopy= false, replicateRemovals= true " />

</cache>

<p><strong>属性解释：</strong></p>
<p>必须属性：</p>
<pre><code>    name:设置缓存的名称，用于标志缓存,惟一

    maxElementsInMemory:在内存中最大的对象数量

    maxElementsOnDisk：在DiskStore中的最大对象数量，如为0，则没有限制

    eternal：设置元素是否永久的，如果为永久，则timeout忽略

    overflowToDisk：是否当memory中的数量达到限制后，保存到Disk
</code></pre><p>可选的属性：</p>
<pre><code>    timeToIdleSeconds：设置元素过期前的空闲时间

    timeToLiveSeconds：设置元素过期前的活动时间

    diskPersistent：是否disk store在虚拟机启动时持久化。默认为false
</code></pre><p>   diskExpiryThreadIntervalSeconds:运行disk终结线程的时间，默认为120秒</p>
<pre><code>    memoryStoreEvictionPolicy：策略关于Eviction
</code></pre><p>缓存子元素：</p>
<pre><code>cacheEventListenerFactory：注册相应的的缓存监听类，用于处理缓存事件，如put,remove,update,和expire

bootstrapCacheLoaderFactory:指定相应的BootstrapCacheLoader，用于在初始化缓存，以及自动设置。
</code></pre><p>参考另外一篇学习笔记<a href="http://wozailongyou.javaeye.com/blog/230252" title="http://wozailongyou.javaeye.com/blog/230252" target="_blank"><a href="http://wozailongyou.javaeye.com/blog/230252">http://wozailongyou.javaeye.com/blog/230252</a></a>，也有集群的说明</p>
<h3 id="2-jgroups-">2. JGroups方式：</h3>
<p>ehcache 1.5.0之后版本支持的一种方式，配置起来比较简单，要点：</p>
<p><strong>a. 配置PeerProvider，使用tcp的方式，例子如下：</strong></p>
<p>Xml代码</p>
<cacheManagerPeerProviderFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheManagerPeerProviderFactory"

properties="connect=TCP(start_port=7800):

TCPPING(initial_hosts=192.168.2.154[7800],192.168.2.23[7800];port_range=10;timeout=3000;

num_initial_members=3;up_thread=true;down_thread=true):

VERIFY_SUSPECT(timeout=1500;down_thread=false;up_thread=false):

pbcast.NAKACK(down_thread=true;up_thread=true;gc_lag=100;retransmit_timeout=3000):

pbcast.GMS(join_timeout=5000;join_retry_timeout=2000;shun=false;

print_local_addr=false;down_thread=true;up_thread=true)"

propertySeparator="::" />

<hr>
<p><strong>b.为每个cache添加cacheEventListener：</strong></p>
<p>Xml代码</p>
<cache name="userCache" maxElementsInMemory="10000" eternal="true"

overflowToDisk="true" timeToIdleSeconds="0" timeToLiveSeconds="0"

diskPersistent="false" diskExpiryThreadIntervalSeconds="120">

<cacheEventListenerFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"

properties="replicateAsynchronously=true, replicatePuts=true,

replicateUpdates=true, replicateUpdatesViaCopy=false, replicateRemovals=true"/>

</cache>

<p>JGroup方式配置的两个server上的配置文件一样，若有多个server，在initial_hosts中将server ip加上即可。</p>
<p>一个完整的ehcache.xml文件：</p>
<p>Xml代码
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</p>
<ehcache xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"

xsi:noNamespaceSchemaLocation="http://ehcache.sf.net/ehcache.xsd">

<diskStore path="java.io.tmpdir" />



<cacheManagerPeerProviderFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheManagerPeerProviderFactory"

properties="connect=TCP(start_port=7800):

TCPPING(initial_hosts=192.168.2.154[7800],192.168.2.23[7800];port_range=10;timeout=3000;

num_initial_members=3;up_thread=true;down_thread=true):

VERIFY_SUSPECT(timeout=1500;down_thread=false;up_thread=false):

pbcast.NAKACK(down_thread=true;up_thread=true;gc_lag=100;retransmit_timeout=3000):

pbcast.GMS(join_timeout=5000;join_retry_timeout=2000;shun=false;

print_local_addr=false;down_thread=true;up_thread=true)"

propertySeparator="::" />



<defaultCache maxElementsInMemory="10000" eternal="true"

overflowToDisk="true" timeToIdleSeconds="0" timeToLiveSeconds="0"

diskPersistent="false" diskExpiryThreadIntervalSeconds="120">

<cacheEventListenerFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"

properties="replicateAsynchronously=true, replicatePuts=true,

replicateUpdates=true, replicateUpdatesViaCopy=false, replicateRemovals=true"/>

</defaultCache>



<cache name="velcroCache" maxElementsInMemory="10000" eternal="true"

overflowToDisk="true" timeToIdleSeconds="0" timeToLiveSeconds="0"

diskPersistent="false" diskExpiryThreadIntervalSeconds="120">

<cacheEventListenerFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"

properties="replicateAsynchronously=true, replicatePuts=true,

replicateUpdates=true, replicateUpdatesViaCopy=false, replicateRemovals=true"/>

</cache>

<cache name="userCache" maxElementsInMemory="10000" eternal="true"

overflowToDisk="true" timeToIdleSeconds="0" timeToLiveSeconds="0"

diskPersistent="false" diskExpiryThreadIntervalSeconds="120">

<cacheEventListenerFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"

properties="replicateAsynchronously=true, replicatePuts=true,

replicateUpdates=true, replicateUpdatesViaCopy=false, replicateRemovals=true"/>

</cache>

<cache name="resourceCache" maxElementsInMemory="10000"

eternal="true" overflowToDisk="true" timeToIdleSeconds="0"

timeToLiveSeconds="0" diskPersistent="false"

diskExpiryThreadIntervalSeconds="120">

<cacheEventListenerFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"

properties="replicateAsynchronously=true, replicatePuts=true,

replicateUpdates=true, replicateUpdatesViaCopy=false, replicateRemovals=true"/>

</cache>

</ehcache>

<p>posted @ 2011-10-07 17:30 <a href="http://www.cnblogs.com/yangy608/" target="_blank">七郎</a> 阅读(1963) 评论(0) <a href="http://www.cnblogs.com/yangy608/admin/EditPosts.aspx?postid=2200669" target="_blank">编辑</a> <a href="http://www.cnblogs.com/yangy608/archive/2011/10/07/2200669.html#" target="_blank">收藏</a>
<img src="" alt=""></p>
<p><a href="http://www.cnblogs.com/yangy608/archive/2011/10/07/2200669.html#" target="_blank">刷新页面</a><a href="http://www.cnblogs.com/yangy608/archive/2011/10/07/2200669.html#top" target="_blank">返回顶部</a></p>
<p>（评论功能已被博主禁用）
<a href="http://q.cnblogs.com/" target="_blank">程序员问答社区，解决您的技术难题</a></p>
<p><a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园首页</a><a href="http://q.cnblogs.com/" title="程序员问答社区" target="_blank">博问</a><a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a></p>
<h3 id="-">公告</h3>
<p>Copyright ©2012 七郎</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/缓存/">缓存</a></li></span><span class="breadcrumb"><li><a href="/categories/缓存/">缓存</a></li><li><a href="/categories/缓存/ehcache/">ehcache</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ehcache/" class="label label-primary">ehcache</a><a href="/tags/缓存/" class="label label-success">缓存</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-缓存-ehcache--EHCache分布式缓存集群环境配置-七郎-博客园/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-缓存-ehcache--EHCache分布式缓存集群环境配置-七郎-博客园" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/80/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/78/">78</a></li><li><a class="page-number" href="/page/79/">79</a></li><li><a class="page-number" href="/page/80/">80</a></li><li class="active"><li><span class="page-number current">81</span></li><li><a class="page-number" href="/page/82/">82</a></li><li><a class="page-number" href="/page/83/">83</a></li><li><a class="page-number" href="/page/84/">84</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/82/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 19:05:47</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
