
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 146 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--ibatis学习（三）-ibatis与spring的整合-joe-专注java-开源-架/">ibatis学习（三）</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--ibatis学习（三）-ibatis与spring的整合-joe-专注java-开源-架/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="ibatis-ibatis-spring-joe-java-blogjava">ibatis学习（三）---ibatis与spring的整合 - joe --专注java,开源,架构,项目管理 - BlogJava</h1>
<h1 id="-joe-java-http-www-blogjava-net-freeman1984-"><a href="http://www.blogjava.net/freeman1984/" target="_blank">joe --专注java,开源,架构,项目管理</a></h1>
<p>STANDING ON THE SHOULDERS OF GIANTS</p>
<p>posts - 339, comments - 292, trackbacks - 0, articles - 1  <a href="http://www.blogjava.net/" target="_blank">BlogJava</a> :: <a href="http://www.blogjava.net/freeman1984/" target="_blank">首页</a> :: <a href="http://www.blogjava.net/freeman1984/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a> :: <a href="http://www.blogjava.net/freeman1984/contact.aspx?id=1" target="_blank">联系</a> :: <a href="http://www.blogjava.net/freeman1984/rss" target="_blank">聚合</a> <a href="http://www.blogjava.net/freeman1984/rss" target="_blank"><img src="" alt=""></a> :: <a href="http://www.blogjava.net/freeman1984/admin/EditPosts.aspx" target="_blank">管理</a> ## <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html" target="_blank">ibatis学习（三）---ibatis与spring的整合</a></p>
<p>Posted on 2007-12-07 18:26 <a href="http://www.blogjava.net/freeman1984/" target="_blank">@joe</a> 阅读(13593) <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#Post" target="_blank">评论(11)</a>  <a href="http://www.blogjava.net/freeman1984/admin/EditPosts.aspx?postid=166112" target="_blank">编辑</a>  <a href="http://www.blogjava.net/freeman1984/AddToFavorite.aspx?id=166112" target="_blank">收藏</a> <img src="" alt=""></p>
<p>Spring通过DAO模式，提供了对iBATIS的良好支持。SqlMapClient对象是iBATIS中的主要对象，我们可以通过配置让spring来管理SqlMapClient对象的创建。</p>
<p>与hibernate类似，Spring 提供了SqlMapClientDaoSupport对象，我们的DAO可以继承这个类，通过它所提供的SqlMapClientTemplate对象来操纵数据库。看起来这些概念都与hibernate类似。</p>
<p>通过SqlMapClientTemplate来操纵数据库的CRUD是没有问题的，这里面关键的问题是事务处理。Spring提供了强大的声明式事务处理的功能，我们已经清楚hibernate中如何配置声明式的事务，那么在iBATIS中如何获得声明式事务的能力呢？</p>
<p>第一，我们需要了解的是spring通过AOP来拦截方法的调用，从而在这些方法上面添加声明式事务处理的能力。典型配置如下：applicationContext-common.xml
    <!-- 配置事务特性 --></p>
<pre><code>&lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;*事务管理器名称*&quot;&gt;

    &lt;tx:attributes&gt;

       &lt;tx:method name=&quot;add/*&quot; propagation=&quot;REQUIRED&quot;/&gt;

       &lt;tx:method name=&quot;del/*&quot; propagation=&quot;REQUIRED&quot;/&gt;

       &lt;tx:method name=&quot;update/*&quot; propagation=&quot;REQUIRED&quot;/&gt;

       &lt;tx:method name=&quot;/*&quot; read-only=&quot;true&quot;/&gt;

   &lt;/tx:attributes&gt;

&lt;/tx:advice&gt;



&lt;!-- 配置哪些类的方法需要进行事务管理 --&gt;

&lt;aop:config&gt;

   &lt;aop:pointcut id=&quot;allManagerMethod&quot; expression=&quot;execution(/* com.ibatis.manager./*./*(..))&quot;/&gt;

   &lt;aop:advisor advice-ref=&quot;txAdvice&quot; pointcut-ref=&quot;allManagerMethod&quot;/&gt;

&lt;/aop:config&gt;
</code></pre><p>这些事务都是声明在业务逻辑层的对象上的。</p>
<p>第二，我们需要一个事务管理器，对事务进行管理。
    <bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"></p>
<pre><code>&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;

&lt;/bean&gt;

&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;&gt;

    &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;

    &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://127.0.0.1/ibatis&quot;/&gt;

    &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;

    &lt;property name=&quot;password&quot; value=&quot;mysql&quot;/&gt;

&lt;/bean&gt;
</code></pre><p>此后，我们需要让spring来管理SqlMapClient对象：</p>
<pre><code>&lt;bean id=&quot;sqlMapClient&quot; class=&quot;org.springframework.orm.ibatis.SqlMapClientFactoryBean&quot;&gt;

   &lt;property name=&quot;configLocation&quot;&gt;&lt;value&gt;classpath:sqlMapConfig.xml&lt;/value&gt;&lt;/property&gt;

&lt;/bean&gt;
</code></pre><p>我们的sqlMapConfig.xml就可以简写为：</p>
<p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</p>
<p>&lt;!DOCTYPE sqlMapConfig     </p>
<pre><code>PUBLIC &quot;-//ibatis.apache.org//DTD SQL Map Config 2.0//EN&quot;     

&quot;http://ibatis.apache.org/dtd/sql-map-config-2.dtd&quot;&gt;
</code></pre><sqlMapConfig>

    <settings

       lazyLoadingEnabled="true"

        useStatementNamespaces="true" />

    <!-- 使用spring之后，数据源的配置移植到了spring上，所以iBATIS本身的配置可以取消 -->

  <sqlMap resource="com/ibatis/dao/impl/ibatis/User.xml"/>

</sqlMapConfig>

<p>User.xml:如下</p>
<p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</p>
<p>&lt;!DOCTYPE sqlMap     </p>
<pre><code>PUBLIC &quot;-//ibatis.apache.org//DTD SQL Map 2.0//EN&quot;     

&quot;http://ibatis.apache.org/dtd/sql-map-2.dtd&quot;&gt;
</code></pre><sqlMap namespace="User">

 <!-- Use type aliases to avoid typing the full classname every time. -->

 <typeAlias alias="User" type="com.ibatis.User"/>

 <!-- Select with no parameters using the result map for Account class. -->

 <select id="selectAllUsers" resultClass="User">

    select /<em> from t_user

 </select>



 <select id="selectUser" resultClass="User" parameterClass="int">

  select /</em> from t_user where id=/#id/#

 </select>



 <insert id="insertUser" parameterClass="User">

  insert into t_user values (

       null,/#username/#,/#password/#

  )

 </insert>



 <update id="updateUser" parameterClass="User">

  update t_user set username = /#username/#,password=/#password/#

  where id=/#id/#

  </update>



 <delete id="deleteUser" parameterClass="int">

  delete from t_user where id=/#id/#

 </delete>

</sqlMap>

<p>我们的DAO的编写：
package com.iabtis.dao.impl.ibatis;</p>
<p>import java.util.List;</p>
<p>import org.springframework.orm.ibatis.support.SqlMapClientDaoSupport;</p>
<p>import com.ibatis.dao.UserDAO;</p>
<p>import com.ibatis.crm.model.User;</p>
<p>public class UserDAOImpl extends SqlMapClientDaoSupport implements UserDAO {</p>
<pre><code>public void select(User user) {

          getSqlMapClientTemplate().delete(&quot;selectUser &quot;,user.getId());

   }
</code></pre><p>   public List findAll() {</p>
<pre><code>          return getSqlMapClientTemplate().queryForList(&quot;selectAllUsers &quot;);

   }

   public void delete(User user) {

          getSqlMapClientTemplate().delete(&quot;deleteUser &quot;,user.getId());

   }

   public void save(User user) {

          getSqlMapClientTemplate().insert(&quot;insertUser &quot;,user);

   }

   public void update(User user) {

          getSqlMapClientTemplate().update(&quot;updateUser &quot;,user);

   }
</code></pre><p>}</p>
<p>继承SqlMapClientDaoSupport，要求我们注入SqlMapClient对象，因此，需要有如下的DAO配置：</p>
<bean id="userDAO" class="com.ibatils.dao.impl.ibatis.UserDAOImpl">

     <property name=”sqlMapClient” ref=”sqlMapClient”/>

</bean>

<p>这就是所有需要注意的问题了，此后就可以在业务逻辑层调用DAO对象了！</p>
<p><a href=""></a></p>
<h3 id="-">评论</h3>
<h2 id="-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-166209-permalink-re-ibatis-ibatis-spring-re-ibatis-ibatis-spring-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-post-http-www-blogjava-net-comment-author-laocat-"><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#166209" title="permalink: re: ibatis学习（三）---ibatis与spring的整合" target="_blank">/#</a> <a href=""></a>re: ibatis学习（三）---ibatis与spring的整合  <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#post">回复</a>  <a href="http://www.blogjava.net/comment?author=laocat" title="查看该作者发表过的评论" target="_blank">更多评论</a> <a href=""></a>  <a href=""></a></h2>
<p>2007-12-08 09:42 by <a href="">laocat</a></p>
<p>豁然开朗 ！！</p>
<h2 id="-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-188269-permalink-re-ibatis-ibatis-spring-re-ibatis-ibatis-spring-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-post-http-www-blogjava-net-comment-author-e5-b1-b9-e7-a0-be-"><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#188269" title="permalink: re: ibatis学习（三）---ibatis与spring的整合" target="_blank">/#</a> <a href=""></a>re: ibatis学习（三）---ibatis与spring的整合  <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#post">回复</a>  <a href="http://www.blogjava.net/comment?author=%e5%b1%b9%e7%a0%be" title="查看该作者发表过的评论" target="_blank">更多评论</a> <a href=""></a>  <a href=""></a></h2>
<p>2008-03-24 16:08 by <a href="http://www.blogjava.net/eli/" target="_blank">屹砾</a></p>
<p>整合的问题现在终于清楚了，
对于advice和aop还有点不清楚。</p>
<h2 id="-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-207721-permalink-re-ibatis-ibatis-spring-re-ibatis-ibatis-spring-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-post-http-www-blogjava-net-comment-author-e5-86-b7-e6-bc-a0-e5-a4-a7-e7-a5-9e-"><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#207721" title="permalink: re: ibatis学习（三）---ibatis与spring的整合[未登录]" target="_blank">/#</a> <a href=""></a>re: ibatis学习（三）---ibatis与spring的整合[未登录]  <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#post">回复</a>  <a href="http://www.blogjava.net/comment?author=%e5%86%b7%e6%bc%a0%e5%a4%a7%e7%a5%9e" title="查看该作者发表过的评论" target="_blank">更多评论</a> <a href=""></a>  <a href=""></a></h2>
<p>2008-06-13 17:26 by <a href="http://o(â©_â©" target="_blank">冷漠大神</a>o.../)</p>
<p>真是不错的文章啊 如果在在可以把源码提供下载 那就更完美了 :-) 呵呵 是不是有点贪心</p>
<h2 id="-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-207724-permalink-re-ibatis-ibatis-spring-re-ibatis-ibatis-spring-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-post-http-www-blogjava-net-comment-author-e5-86-b7-e6-bc-a0-e5-a4-a7-e7-a5-9e-"><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#207724" title="permalink: re: ibatis学习（三）---ibatis与spring的整合[未登录]" target="_blank">/#</a> <a href=""></a>re: ibatis学习（三）---ibatis与spring的整合[未登录]  <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#post">回复</a>  <a href="http://www.blogjava.net/comment?author=%e5%86%b7%e6%bc%a0%e5%a4%a7%e7%a5%9e" title="查看该作者发表过的评论" target="_blank">更多评论</a> <a href=""></a>  <a href=""></a></h2>
<p>2008-06-13 17:34 by <a href="http://o(â©_â©" target="_blank">冷漠大神</a>o.../)</p>
<p>有没有代码下载啊？</p>
<h2 id="-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-224098-permalink-re-ibatis-ibatis-spring-re-ibatis-ibatis-spring-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-post-http-www-blogjava-net-comment-author-379548695qq-"><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#224098" title="permalink: re: ibatis学习（三）---ibatis与spring的整合" target="_blank">/#</a> <a href=""></a>re: ibatis学习（三）---ibatis与spring的整合  <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#post">回复</a>  <a href="http://www.blogjava.net/comment?author=379548695qq" title="查看该作者发表过的评论" target="_blank">更多评论</a> <a href=""></a>  <a href=""></a></h2>
<p>2008-08-25 11:35 by <a href="">379548695qq</a></p>
<p>UserDAO类里面的内容是什么？</p>
<h2 id="-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-260672-permalink-re-ibatis-ibatis-spring-re-ibatis-ibatis-spring-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-post-http-www-blogjava-net-comment-author-e8-99-ab-e5-ad-90-"><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#260672" title="permalink: re: ibatis学习（三）---ibatis与spring的整合[未登录]" target="_blank">/#</a> <a href=""></a>re: ibatis学习（三）---ibatis与spring的整合[未登录]  <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#post">回复</a>  <a href="http://www.blogjava.net/comment?author=%e8%99%ab%e5%ad%90" title="查看该作者发表过的评论" target="_blank">更多评论</a> <a href=""></a>  <a href=""></a></h2>
<p>2009-03-19 10:17 by <a href="">虫子</a></p>
<p>正在烦恼中，google到了你的方案！呵呵</p>
<h2 id="-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-291041-permalink-re-ibatis-ibatis-spring-re-ibatis-ibatis-spring-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-post-http-www-blogjava-net-comment-author-jadmin-"><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#291041" title="permalink: re: ibatis学习（三）---ibatis与spring的整合" target="_blank">/#</a> <a href=""></a>re: ibatis学习（三）---ibatis与spring的整合  <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#post">回复</a>  <a href="http://www.blogjava.net/comment?author=jadmin" title="查看该作者发表过的评论" target="_blank">更多评论</a> <a href=""></a>  <a href=""></a></h2>
<p>2009-08-13 16:32 by <a href="http://hi.baidu.com/jadmin" target="_blank">jadmin</a></p>
<p>很好，学习了</p>
<h2 id="-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-291296-permalink-re-ibatis-ibatis-spring-re-ibatis-ibatis-spring-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-post-http-www-blogjava-net-comment-author-e5-8c-b9-e9-a9-ac-e5-8d-95-e6-9e-aa-"><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#291296" title="permalink: re: ibatis学习（三）---ibatis与spring的整合" target="_blank">/#</a> <a href=""></a>re: ibatis学习（三）---ibatis与spring的整合  <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#post">回复</a>  <a href="http://www.blogjava.net/comment?author=%e5%8c%b9%e9%a9%ac%e5%8d%95%e6%9e%aa" title="查看该作者发表过的评论" target="_blank">更多评论</a> <a href=""></a>  <a href=""></a></h2>
<p>2009-08-15 23:15 by <a href="">匹马单枪</a></p>
<p>好帖， 学习了！</p>
<h2 id="-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-293434-permalink-re-ibatis-ibatis-spring-re-ibatis-ibatis-spring-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-post-http-www-blogjava-net-comment-author-2-"><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#293434" title="permalink: re: ibatis学习（三）---ibatis与spring的整合" target="_blank">/#</a> <a href=""></a>re: ibatis学习（三）---ibatis与spring的整合  <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#post">回复</a>  <a href="http://www.blogjava.net/comment?author=2" title="查看该作者发表过的评论" target="_blank">更多评论</a> <a href=""></a>  <a href=""></a></h2>
<p>2009-09-01 13:07 by <a href="">2</a></p>
<p>为什么我的出错了</p>
<h2 id="-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-319581-permalink-re-ibatis-ibatis-spring-re-ibatis-ibatis-spring-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-post-http-www-blogjava-net-comment-author-test-"><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#319581" title="permalink: re: ibatis学习（三）---ibatis与spring的整合[未登录]" target="_blank">/#</a> <a href=""></a>re: ibatis学习（三）---ibatis与spring的整合[未登录]  <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#post">回复</a>  <a href="http://www.blogjava.net/comment?author=test" title="查看该作者发表过的评论" target="_blank">更多评论</a> <a href=""></a>  <a href=""></a></h2>
<p>2010-04-28 11:10 by <a href="">test</a></p>
<p>autocommit 如果不设置为false, 事务有用么</p>
<h2 id="-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-336667-permalink-re-ibatis-ibatis-spring-re-ibatis-ibatis-spring-http-www-blogjava-net-freeman1984-archive-2007-12-07-166112-html-post-http-www-blogjava-net-comment-author-rr-"><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#336667" title="permalink: re: ibatis学习（三）---ibatis与spring的整合" target="_blank">/#</a> <a href=""></a>re: ibatis学习（三）---ibatis与spring的整合<a href=""></a>  <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=rr" title="查看该作者发表过的评论" target="_blank">更多评论</a> <a href=""></a>  <a href=""></a></h2>
<p>2010-11-01 13:42 by <a href="">rr</a></p>
<p>sqlMapClient里应该注入dataSource</p>
<p><a href="http://www.blogjava.net/RequireRegister.aspx" target="_blank">新用户注册</a>  <a href="">刷新评论列表</a><br><a href=""></a> <a href="http://job.cnblogs.com/">找优秀程序员，就在博客园</a>
IT新闻：
· <a href="http://news.cnblogs.com/n/112126/" target="_blank">婚恋网世纪佳缘乱象重生 成一夜情猎场</a>
· <a href="http://news.cnblogs.com/n/112124/" target="_blank">帝国时代 Online 已发布，可免费下载</a>
· <a href="http://news.cnblogs.com/n/112123/" target="_blank">小米发布会中的亮点与尿点：“狗日的 1999”</a>
· <a href="http://news.cnblogs.com/n/112122/" target="_blank">315投诉网疑被关后改名重开张 新网站否认</a>
· <a href="http://news.cnblogs.com/n/112121/" target="_blank">团购网站融资冷却裁员求生 行业洗牌危机并存</a>    <a href="http://www.cnblogs.com/" target="_blank">博客园</a>  <a href="http://home.cnblogs.com/q/" target="_blank">博问</a>  <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>  <a href="http://job.cnblogs.com/cate-java_programmer/" target="_blank">Java程序员招聘</a> 标题  请输入标题 姓名  请输入你的姓名 主页 请输入验证码 验证码 /*  <img src="" alt=""> 内容(请不要发表任何与政治相关的内容) 请输入评论内容 Remember Me?   <a href="http://www.blogjava.net/login.aspx?ReturnURL=http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html&amp;SourceURL=/freeman1984/archive/2007/12/07/166112.html" target="_blank">登录</a>       [使用Ctrl+Enter键可以直接提交]    推荐职位：
· <a href="http://job.cnblogs.com/offer/15741/" target="_blank">广州ASP.NET程序员(广州丹霄信息技术)</a>
· <a href="http://job.cnblogs.com/offer/15624/" target="_blank">上海 .NET软件工程师(上海苏秦网络)</a>
· <a href="http://job.cnblogs.com/offer/15546/" target="_blank">上海.NET软件开发工程师(东方财富信息)</a>
· <a href="http://job.cnblogs.com/offer/14109/" target="_blank">北京 SQL数据库开发工程师(圣特尔科技)</a>
· <a href="http://job.cnblogs.com/offer/15489/" target="_blank">北京高新诚聘 ASP.NET 程序员(盈科融通软件)</a>
· <a href="http://job.cnblogs.com/Offer/15346/" target="_blank">北京 .NET软件工程师(北京科胜永昌)</a>
· <a href="http://job.cnblogs.com/offer/5914/" target="_blank">北京.NET 研发工程师 (北京捷报数据)</a>
· <a href="http://job.cnblogs.com/offer/14108/" target="_blank">北京C/#开发工程师 B/S方向(圣特尔科技)</a></p>
<p>博客园首页随笔：
· <a href="http://www.cnblogs.com/saville/archive/2011/08/17/2142754.html" target="_blank">C/#设计模式——命令模式(Command Pattern)</a>
· <a href="http://www.cnblogs.com/ahl5esoft/archive/2011/08/17/2142739.html" target="_blank">老系统维护</a>
· <a href="http://www.cnblogs.com/codingmyworld/archive/2011/08/17/2141706.html" target="_blank">使用单例模式实现自己的HttpClient工具类</a>
· <a href="http://www.cnblogs.com/powertoolsteam/archive/2011/08/17/2142085.html" target="_blank">Spread for Windows Forms高级主题(2)---理解单元格类型</a>
· <a href="http://www.cnblogs.com/JamesLi2015/archive/2011/08/17/2142012.html" target="_blank">ERP/MIS开发 菜单设计器(Menu Designer)及其B/S,C/S双重实现（B/S开源）</a>
知识库：
· <a href="http://kb.cnblogs.com/page/104475/" target="_blank">IT项目管理的六种错误思维</a>
· <a href="http://kb.cnblogs.com/page/107415/" target="_blank">我的10个开发原则</a>
· <a href="http://kb.cnblogs.com/page/111704/" target="_blank">大数据下的数据分析平台架构</a>
· <a href="http://kb.cnblogs.com/page/109493/" target="_blank">为什么编程是独一无二的职业</a>
· <a href="http://kb.cnblogs.com/page/104736/" target="_blank">分享8年开发经验，浅谈个人发展经历，明确自己发展方向</a> 最简洁阅读版式：
<a href="http://archive.cnblogs.com/b/166112/" target="_blank">ibatis学习（三）---ibatis与spring的整合</a> 网站导航:</p>
<p><a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园</a>   <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>   <a href="http://kb.cnblogs.com/" target="_blank">知识库</a>   <a href="http://www.cnweblog.com/" target="_blank">博客生活</a>   <a href="http://www.cnitblog.com/" target="_blank">IT博客网</a>   <a href="http://www.cppblog.com/" target="_blank">C++博客</a>   <a href="http://space.cnblogs.com/q/" title="IT问答" target="_blank">博问</a>   <a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html?opt=admin" target="_blank">管理</a>    Powered by:
<a href="http://www.blogjava.net/" target="_blank">BlogJava</a>
Copyright © @joe</p>
<p><img src="" alt=""></p>
<h3 id="-">公告</h3>
<p><a href="http://shop59092284.taobao.com/" target="_blank"></a><a href="http://shop59092284.taobao.com/"></a><a href="http://shop59092284.taobao.com/" target="_blank"><strong> 老婆的淘宝,欢迎选购</strong></a></p>
<p><img src="" alt=""></p>
<h3 id="-2-">留言簿(2)</h3>
<ul>
<li><a href="http://www.blogjava.net/freeman1984/Contact.aspx?id=1" target="_blank">给我留言</a></li>
<li><a href="http://www.blogjava.net/freeman1984/default.aspx?opt=msg" target="_blank">查看公开留言</a></li>
<li><a href="http://www.blogjava.net/freeman1984/admin/MyMessages.aspx" target="_blank">查看私人留言</a>
<img src="" alt=""></li>
</ul>
<h3 id="-">随笔分类</h3>
<ul>
<li><a href="http://www.blogjava.net/freeman1984/category/26087.html/rss" title="Subscribe to all 生活杂谈(14)" target="_blank"><img src="&quot;Subscribe to all 生活杂谈(14" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/26087.html" target="_blank">all 生活杂谈(14)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/42532.html/rss" title="Subscribe to android(18)" target="_blank"><img src="&quot;Subscribe to android(18" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/42532.html" target="_blank">android(18)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/46243.html/rss" title="Subscribe to apache项目(13)" target="_blank"><img src="&quot;Subscribe to apache项目(13" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/46243.html" target="_blank">apache项目(13)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/43680.html/rss" title="Subscribe to chart(1)" target="_blank"><img src="&quot;Subscribe to chart(1" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/43680.html" target="_blank">chart(1)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/49019.html/rss" title="Subscribe to concurrent(1)" target="_blank"><img src="&quot;Subscribe to concurrent(1" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/49019.html" target="_blank">concurrent(1)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/38740.html/rss" title="Subscribe to database(34)" target="_blank"><img src="&quot;Subscribe to database(34" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/38740.html" target="_blank">database(34)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/42595.html/rss" title="Subscribe to dwr(3)" target="_blank"><img src="&quot;Subscribe to dwr(3" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/42595.html" target="_blank">dwr(3)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/43586.html/rss" title="Subscribe to flex(1)" target="_blank"><img src="&quot;Subscribe to flex(1" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/43586.html" target="_blank">flex(1)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/42534.html/rss" title="Subscribe to hibernate(23)" target="_blank"><img src="&quot;Subscribe to hibernate(23" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/42534.html" target="_blank">hibernate(23)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/26086.html/rss" title="Subscribe to java (123)" target="_blank"><img src="&quot;Subscribe to java (123" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/26086.html" target="_blank">java (123)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/41058.html/rss" title="Subscribe to javafx(1)" target="_blank"><img src="&quot;Subscribe to javafx(1" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/41058.html" target="_blank">javafx(1)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/43930.html/rss" title="Subscribe to java安全(6)" target="_blank"><img src="&quot;Subscribe to java安全(6" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/43930.html" target="_blank">java安全(6)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/43783.html/rss" title="Subscribe to java性能(12)" target="_blank"><img src="&quot;Subscribe to java性能(12" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/43783.html" target="_blank">java性能(12)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/38739.html/rss" title="Subscribe to jbpm(1)" target="_blank"><img src="&quot;Subscribe to jbpm(1" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/38739.html" target="_blank">jbpm(1)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/44698.html/rss" title="Subscribe to jquery(3)" target="_blank"><img src="&quot;Subscribe to jquery(3" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/44698.html" target="_blank">jquery(3)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/46405.html/rss" title="Subscribe to linux(6)" target="_blank"><img src="&quot;Subscribe to linux(6" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/46405.html" target="_blank">linux(6)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/47431.html/rss" title="Subscribe to lucene(1)" target="_blank"><img src="&quot;Subscribe to lucene(1" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/47431.html" target="_blank">lucene(1)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/47801.html/rss" title="Subscribe to lucene(1)" target="_blank"><img src="&quot;Subscribe to lucene(1" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/47801.html" target="_blank">lucene(1)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/26088.html/rss" title="Subscribe to others(2)" target="_blank"><img src="&quot;Subscribe to others(2" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/26088.html" target="_blank">others(2)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/38742.html/rss" title="Subscribe to questions(7)" target="_blank"><img src="&quot;Subscribe to questions(7" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/38742.html" target="_blank">questions(7)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/38741.html/rss" title="Subscribe to questions_hander(5)" target="_blank"><img src="&quot;Subscribe to questions_hander(5" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/38741.html" target="_blank">questions_hander(5)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/42533.html/rss" title="Subscribe to spring(24)" target="_blank"><img src="&quot;Subscribe to spring(24" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/42533.html" target="_blank">spring(24)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/42535.html/rss" title="Subscribe to struts(8)" target="_blank"><img src="&quot;Subscribe to struts(8" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/42535.html" target="_blank">struts(8)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/42536.html/rss" title="Subscribe to swing" target="_blank"><img src="&quot;Subscribe to swing&quot;" alt=""></a><a href="http://www.blogjava.net/freeman1984/category/42536.html" target="_blank">swing</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/48926.html/rss" title="Subscribe to UML(2)" target="_blank"><img src="&quot;Subscribe to UML(2" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/48926.html" target="_blank">UML(2)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/44672.html/rss" title="Subscribe to web(33)" target="_blank"><img src="&quot;Subscribe to web(33" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/44672.html" target="_blank">web(33)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/38743.html/rss" title="Subscribe to webservice(5)" target="_blank"><img src="&quot;Subscribe to webservice(5" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/38743.html" target="_blank">webservice(5)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/43702.html/rss" title="Subscribe to xml(2)" target="_blank"><img src="&quot;Subscribe to xml(2" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/43702.html" target="_blank">xml(2)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/46247.html/rss" title="Subscribe to 敏捷(6)" target="_blank"><img src="&quot;Subscribe to 敏捷(6" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/46247.html" target="_blank">敏捷(6)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/46503.html/rss" title="Subscribe to 方法论(14)" target="_blank"><img src="&quot;Subscribe to 方法论(14" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/46503.html" target="_blank">方法论(14)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/46575.html/rss" title="Subscribe to 架构(10)" target="_blank"><img src="&quot;Subscribe to 架构(10" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/46575.html" target="_blank">架构(10)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/49063.html/rss" title="Subscribe to 网络通讯(5)" target="_blank"><img src="&quot;Subscribe to 网络通讯(5" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/49063.html" target="_blank">网络通讯(5)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/category/46246.html/rss" title="Subscribe to 项目管理(17)" target="_blank"><img src="&quot;Subscribe to 项目管理(17" alt="">&quot;)</a><a href="http://www.blogjava.net/freeman1984/category/46246.html" target="_blank">项目管理(17)</a></li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-">相册</h3>
<ul>
<li><a href="http://www.blogjava.net/freeman1984/gallery/42537.html" target="_blank">我的相册</a>
<img src="" alt=""></li>
</ul>
<h3 id="-">搜索</h3>
<ul>
<li></li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-">积分与排名</h3>
<ul>
<li>积分 - 249820</li>
<li>排名 - 69
<img src="" alt=""></li>
</ul>
<h3 id="-http-www-blogjava-net-freeman1984-commentsrss-aspx-">最新评论 <a href="http://www.blogjava.net/freeman1984/CommentsRSS.aspx" target="_blank"><img src="" alt=""></a></h3>
<ul>
<li><a href="http://www.blogjava.net/freeman1984/archive/2011/08/08/148850.html#356038" target="_blank">1. re: 一篇不错的讲解Java异常的文章(转载）----感觉很不错，读了以后很有启发[未登录]</a></li>
<li>受教了。非常感谢。
不过，后面罗列的那么多异常有点不必要了。</li>
<li>--jake</li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2011/07/25/324133.html#355011" target="_blank">2. re: strtuts2 异常之Could not create and/or set value back on to object [未登录]</a></li>
<li>thank you very much！</li>
<li>--fighting</li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2011/07/22/301081.html#354834" target="_blank">3. re: Android屏幕元素层次结构[未登录]</a></li>
<li><p style="color:red">顶一下</p></li>
<li>--黑石</li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2011/07/21/354712.html#354750" target="_blank">4. re: 不同技术团队的配合问题及DevOps(不错的文章，来自infoq)</a></li>
<li>做个记号。</li>
<li>--何杨</li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2011/07/12/154309.html#354154" target="_blank">5. re: other[未登录]</a></li>
<li>希望学习，谢谢！
trust_myself@126.com</li>
<li>--asa</li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-">阅读排行榜</h3>
<ul>
<li><a href="http://www.blogjava.net/freeman1984/archive/2007/09/27/148850.html" target="_blank">1. 一篇不错的讲解Java异常的文章(转载）----感觉很不错，读了以后很有启发(17440)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2009/11/05/301262.html" target="_blank">2. 世界上最健康的作息时间表 大家对比下(16717)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166112.html" target="_blank">3. ibatis学习（三）---ibatis与spring的整合(13592)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2007/09/24/147879.html" target="_blank">4. 如何用javascript控制checkbox，并进行批量删除(8527)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2007/12/07/166113.html" target="_blank">5. ibatis学习（二）--ibatis使用介绍(6368)</a>
<img src="" alt=""></li>
</ul>
<h3 id="-">评论排行榜</h3>
<ul>
<li><a href="http://www.blogjava.net/freeman1984/archive/2007/10/19/154309.html" target="_blank">1. other(41)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2007/09/27/148850.html" target="_blank">2. 一篇不错的讲解Java异常的文章(转载）----感觉很不错，读了以后很有启发(22)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2007/11/16/161093.html" target="_blank">3. ssh中利用pager-taglib和filter进行分页(14)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2010/11/12/337878.html" target="_blank">4. 团队内是有必要统一IDE(14)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2009/11/05/301262.html" target="_blank">5. 世界上最健康的作息时间表 大家对比下(13)</a></li>
</ul>
<h3 id="60-">60天内阅读排行</h3>
<ul>
<li><a href="http://www.blogjava.net/freeman1984/archive/2011/06/20/352649.html" target="_blank">1. 大家都用什么bug管理软件？(2031)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2011/07/04/353654.html" target="_blank">2. CountDownLatch 简介和例子(1412)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2011/08/04/355820.html" target="_blank">3. 统计指标和术语汇总(1396)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2011/07/20/354712.html" target="_blank">4. 不同技术团队的配合问题及DevOps(不错的文章，来自infoq)(1321)</a></li>
<li><a href="http://www.blogjava.net/freeman1984/archive/2011/08/04/355808.html" target="_blank">5. connection.release_mode，connection.autocommit和transaction.auto_close_session用法(1003)</a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/框架汇总/">框架汇总</a></li></span><span class="breadcrumb"><li><a href="/categories/框架汇总/">框架汇总</a></li><li><a href="/categories/框架汇总/ORM/">ORM</a></li><li><a href="/categories/框架汇总/ORM/ibatis/">ibatis</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ORM/" class="label label-primary">ORM</a><a href="/tags/ibatis/" class="label label-success">ibatis</a><a href="/tags/框架汇总/" class="label label-info">框架汇总</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--ibatis学习（三）-ibatis与spring的整合-joe-专注java-开源-架/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-框架汇总-ORM-ibatis--ibatis学习（三）-ibatis与spring的整合-joe-专注java-开源-架" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-架构师--五年经验跳槽历程-Eric77的专栏/">五年经验跳槽历程 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-架构师--五年经验跳槽历程-Eric77的专栏/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-eric77-">五年经验跳槽历程 - Eric77的专栏</h1>
<h1 id="-eric77-http-blog-csdn-net-eric77-"><a href="http://blog.csdn.net/Eric77" target="_blank">Eric77的专栏</a></h1>
<h2 id="-">上士闻道,勤而行之;中士闻道,若存若亡;下士闻道,大笑之,不笑不足以为道. 后悔过去不如奋斗将来!</h2>
<ul>
<li><a href="http://hi.csdn.net/space-notice.html" target="_blank">条新通知</a></li>
<li><a href="http://passport.csdn.net/UserLogin.aspx" target="_blank">登录</a></li>
<li><a href="http://passport.csdn.net/CSDNUserRegister.aspx" target="_blank">注册</a></li>
<li><a href="http://hi.csdn.net/" target="_blank">欢迎</a></li>
<li><a href="http://writeblog.csdn.net/Signout.aspx" target="_blank">退出</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">我的博客</a></li>
<li><a href="http://writeblog.csdn.net/configure.aspx" target="_blank">配置</a></li>
<li><a href="http://writeblog.csdn.net/PostEdit.aspx" target="_blank">写文章</a></li>
<li><a href="http://writeblog.csdn.net/PostList.aspx" target="_blank">文章管理</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">博客首页</a></li>
</ul>
<p>*</p>
<ul>
<li><p>全站 当前博客
*</p>
</li>
<li><p><a href="http://hi.csdn.net/Eric77" target="_blank">空间</a></p>
</li>
<li><a href="http://blog.csdn.net/Eric77" target="_blank">博客</a></li>
<li><a href="http://hi.csdn.net/!s/friend/list/Eric77" target="_blank">好友</a></li>
<li><a href="http://hi.csdn.net/!s/album/list/Eric77" target="_blank">相册</a></li>
<li><a href="http://hi.csdn.net/!s/wall/to/Eric77" target="_blank">留言</a></li>
</ul>
<p>用户操作<a href="http://hi.csdn.net/!s/wall/to/Eric77" target="_blank">[留言]</a>  <a href="http://hi.csdn.net/!s/msg/to/Eric77" target="_blank">[发消息]</a>  <a href="http://hi.csdn.net/!s/friend/add/Eric77" target="_blank">[加为好友]</a> 订阅我的博客<a href="http://feeds.feedsky.com/csdn.net/Eric77" target="_blank"><img src="" alt="XML聚合"></a>   <a href="http://feeds.feedsky.com/csdn.net/Eric77" target="_blank"><img src="" alt="FeedSky"></a><a href="http://www.xianguo.com/subscribe.php?url=http://feeds.feedsky.com/csdn.net/Eric77" target="_blank"><img src="" alt="订阅到鲜果"></a><a href="http://fusion.google.com/add?feedurl=http://feeds.feedsky.com/csdn.net/Eric77" target="_blank"><img src="" alt="订阅到Google"></a><a href="http://www.zhuaxia.com/add_channel.php?url=http://feeds.feedsky.com/csdn.net/Eric77" target="_blank"><img src="" alt="订阅到抓虾"></a><a href="http://writeblog.csdn.net/configure.aspx" target="_blank">[编辑]</a>Eric77的公告<a href="http://writeblog.csdn.net/EditCategories.aspx?catID=1" target="_blank">[编辑]</a>文章分类* <a href="http://blog.csdn.net/Eric77/category/503384.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/Eric77/category/503384.aspx" title="&lt;塞梅普雷斯 如是说&gt; 第一部  系列" target="_blank">&lt;塞梅普雷斯 如是说&gt; 第一部</a></p>
<ul>
<li><a href="http://blog.csdn.net/Eric77/category/503385.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/Eric77/category/503385.aspx" title="我带你去哪里 系列" target="_blank">&lt;我带你去哪里&gt;</a></li>
<li><a href="http://blog.csdn.net/Eric77/category/635207.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/Eric77/category/635207.aspx" title="五花八门的经验总结" target="_blank">经验总结</a></li>
<li><a href="http://blog.csdn.net/Eric77/category/513046.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/Eric77/category/513046.aspx" title="一些复杂的思考" target="_blank">科学/神秘主义</a><a href="http://writeblog.csdn.net/EditLinks.aspx" target="_blank">[编辑]</a>What I think<a href="http://douban.com/people/eric77/" target="_blank">我的豆瓣</a><a href="http://writeblog.csdn.net/EditLinks.aspx" target="_blank">[编辑]</a>朋友们的<a href="http://hi.baidu.com/moliny" target="_blank">一花一世界</a><a href="http://yashuawu.blog.sohu.com/" target="_blank">五四青年</a><a href="http://blog.sina.com.cn/bubble521" target="_blank">小女子的大世界</a><a href="http://blog.sina.com.cn/5sui" target="_blank">小朋友的小花园</a><a href="http://yimei1013.blog.sohu.com/" target="_blank">左掌的春暖花开</a><a href="http://harry-zhy.blog.sohu.com/" target="_blank">异次元-十三少</a><a href="http://www.lixin.name/" target="_blank">绿洲家后院儿</a><a href="http://jseafly.blog.sohu.com/" target="_blank">飘来的海</a><a href="http://writeblog.csdn.net/EditLinks.aspx" target="_blank">[编辑]</a>在别人的BLOG<a href="http://www.blogcn.com/user13/lonestone/index.html" target="_blank">一个人的狂欢</a><a href="http://blog.tianya.cn/blogger/view_blog.asp?BlogName=wanran" target="_blank">宛然流轉</a>存档* <a href="http://blog.csdn.net/Eric77/archive/2010/08.aspx" target="_blank">2010年08月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2010/07.aspx" target="_blank">2010年07月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2010/06.aspx" target="_blank">2010年06月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2010/05.aspx" target="_blank">2010年05月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2010/03.aspx" target="_blank">2010年03月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/12.aspx" target="_blank">2009年12月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/11.aspx" target="_blank">2009年11月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/09.aspx" target="_blank">2009年09月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/08.aspx" target="_blank">2009年08月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/06.aspx" target="_blank">2009年06月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/04.aspx" target="_blank">2009年04月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/03.aspx" target="_blank">2009年03月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2009/02.aspx" target="_blank">2009年02月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/12.aspx" target="_blank">2008年12月(4)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/10.aspx" target="_blank">2008年10月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/08.aspx" target="_blank">2008年08月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/07.aspx" target="_blank">2008年07月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/06.aspx" target="_blank">2008年06月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/05.aspx" target="_blank">2008年05月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/04.aspx" target="_blank">2008年04月(4)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/02.aspx" target="_blank">2008年02月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2008/01.aspx" target="_blank">2008年01月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/12.aspx" target="_blank">2007年12月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/11.aspx" target="_blank">2007年11月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/10.aspx" target="_blank">2007年10月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/08.aspx" target="_blank">2007年08月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/07.aspx" target="_blank">2007年07月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/06.aspx" target="_blank">2007年06月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/05.aspx" target="_blank">2007年05月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/04.aspx" target="_blank">2007年04月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/03.aspx" target="_blank">2007年03月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/02.aspx" target="_blank">2007年02月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2007/01.aspx" target="_blank">2007年01月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/12.aspx" target="_blank">2006年12月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/11.aspx" target="_blank">2006年11月(9)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/09.aspx" target="_blank">2006年09月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/08.aspx" target="_blank">2006年08月(4)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/06.aspx" target="_blank">2006年06月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/05.aspx" target="_blank">2006年05月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2006/01.aspx" target="_blank">2006年01月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2005/09.aspx" target="_blank">2005年09月(14)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2005/08.aspx" target="_blank">2005年08月(4)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2005/07.aspx" target="_blank">2005年07月(2)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2005/02.aspx" target="_blank">2005年02月(1)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2005/01.aspx" target="_blank">2005年01月(9)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/12.aspx" target="_blank">2004年12月(17)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/11.aspx" target="_blank">2004年11月(10)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/10.aspx" target="_blank">2004年10月(23)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/09.aspx" target="_blank">2004年09月(14)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/08.aspx" target="_blank">2004年08月(3)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/07.aspx" target="_blank">2004年07月(5)</a></li>
<li><a href="http://blog.csdn.net/Eric77/archive/2004/06.aspx" target="_blank">2004年06月(6)</a><h3 id="-http-forum-csdn-net-slist-blogsupport-http-blog-csdn-net-blogdevteam-">公告： <a href="http://forum.csdn.net/SList/blogSupport" target="_blank">[意见反馈]</a><a href="http://blog.csdn.net/blogdevteam" target="_blank">[官方博客]</a></h3>
</li>
</ul>
<h1 id="-"><img src="" alt="原创">  五年经验跳槽历程 <a href="&quot;收藏到我的网摘中，并分享给我的朋友&quot;">收藏</a>  <img src="" alt=""></h1>
<p>此文于2010-07-27被推荐到CSDN首页
<a href="http://blog.csdn.net/blogdevteam/archive/2009/08/25/4481848.aspx" target="_blank">如何被推荐？</a></p>
<p>//2010-07-23 21:29</p>
<p>经过两个月的折腾,终于在这个周三得到了IBM的offer,从5月18日到现在,两个多月过去了.</p>
<p>睡觉前,我要简要记录一下这次跳槽的故事,下周一就要去报到了,害怕以后没时间写出来,或者淡忘了.</p>
<p>这次跳槽,首先我的目标很明确:1.要离家近的(30分钟以内,南山区) 2.大公司(成规模的,有良好管理和发展的公司) 3.适合我自己职业发展的公司 4.待遇还不错的公司</p>
<p>一开始的首选计划是: 招商研发中心,IBM,腾讯. 招商没有投简历,因为听他的人资说之前招了一大堆人,又由于没有淘汰机制,现在已经人满为患了. IBM让5号(一朋友的昵称)帮我投了简历,自己也瞎去投了投. 腾讯也投了.</p>
<p>开始在网上更新简历后,第一个和我联系的就是外包公司,第二天一早就和我联系了,可惜我对外包公司不太感兴趣,主要是因为在外包公司完全没有归属感.外包公司大约有6家,我都一一拒绝了. 还有一个是morningstar股票评级机构在深圳的公司,挺不错,可惜在福田那边,有点远,就没有联系.还有一个叫中青宝,做游戏的上市公司,他的人资说他们领导看到我的简历,相约我找个时间聊聊,我查了下这个公司,也不错,可惜后来也没有和他们联系. 还有一个是A8音乐网,这个公司在香港上市,应该也不错,他们的人资挺负责,跟我联系了两次,还让我多了解一下他们公司,本来也想有机会去一下的,可惜还是没有和他们联系.</p>
<p>有一天,接到了一个中兴的电话,开始也想推掉,但是打电话的人态度很好,还说过来瞧一瞧嘛.后来我就请了一天假,因为中兴的班车起点站就在我家楼下,很方便,而且我家对门也是中兴的.我就和她一起坐班车去了西丽的中兴园区. 见到人,很和善,领我上了楼,办公地点很宽广,他发给了我一张试卷,说30分钟简单做一下吧.试题很简单,大部分都是多线程和java传值传引用的试题.我对我的答案很有信心. 不一会儿答完了检查了一遍就给了那个人. 他边领我去会议室边看了看我的答案,应该很满意,和我聊了聊,由于我以前在华为干过,所以很多东西一说大家都知道,方便许多.他说想招个人做Swing,我明确说我对做Swing不感兴趣,我的强项是做后台,多线程和设计之类.他说没关系,反正这是公司的名额,不招就浪费了,来了做服务器端也可以,不会让你做界面的. 我一听能让我做我擅长的方面,很高兴. 接着他就问我想开多少工资,我说12000,他没说啥,跟我讲了他们这里有年终奖,绩效奖,项目奖之类的. 然后说能不能少点,我说最少10000吧.他苦笑了下,说还是有点多,不过你真想来,我就找我老大过来跟你聊聊,我说好吧.然后他就找了一个笑眯眯的中年人(45岁左右)过来了,我给他说我考过了软件设计师证书,他很高兴,简单的问了我两句,就谈到工资,我说12000,他也说给不了那么多,我就说10000,他就问我现在多少钱,我说8000,他说给你8500,你看行不行,这个价格在我们这里已经很高了.我一想,虽然比现在高一点,但是离家近,工作轻松,还有房补和奖金什么的,而且这是第一个面试,先留条后路,就答应了.(后来我辞职那几天,我公司的另外一个同事辞职,正好碰见,他也说他去了中兴面试,最高也只能给8500,后来他去了UT,UT能给到万). 这里的唯一不好就是,我怕我来到这里就变成养老了,中兴基本是个国企类型的,混好别惹事,就会安然无恙.可是对我的职业发展真的是不太好,因为之前做的J2EE开发来这里八成都用不着,而且考试题都是JDK1.4的,5.0以上的语法和特性之类都没有见到. 总之,这个工作,优点不少,缺点也比较严重.</p>
<p>然后就是腾讯面试,第一次笔试,过了,第二个星期约了我去二面,两个人面我,据一个跳到那里的同事说,这各部门是做QQ的那个部门,好牛好核心.问了我不少关于大容量并发处理,数据库调优,性能方面的东西,可惜,我之前的工作对这方面接触实在是太少.挂掉了.又过了几个星期,听说他们周六周日开专场招聘会,我印了3分简历,10点多过去投了两份.结果直接让我上去进行面试了. 其中一个部门又是运营支撑组的,好像叫这个名,还有一个是3G部门. 运营支撑组先让我答了一套题,应该答的也不错,然后是一个女的面试我,面的都比较基本,也不错. 她还说,我们这边招来,主要是做QQ内部监控和一些内部系统,但是如果外部项目来了,也要开始做外部系统,我们每个人的工作都安排到两年后了.然后我们这里的人要会Java,Struts,Spring,Hibernate,Javascript,Flex等若干门技术,而且可能要经常加班,哎,我说我怎么看腾讯这帮人脸色都发黑呢,真的,从我第一次面试到这一次,看到接待我的男人,基本脸上都有一层黑气,脸色很暗而且眼圈也是黑的.我一直都很纳闷,听她这么一说,我也大致清楚了一些,倒吸了一口凉气.她面完了我,说不错,通过了,下一面就是他们老大,叫happy(音译),这位老大看起来很严很狠,但是说起话来轻声轻气,让人得侧着耳朵仔细听才能听清楚.他问了我半天,关于怎么分1000个苹果到10个箱子,还有一些智力算法的题,我都一一给了答复,这时已经到下午3点左右了,他又让我把我设计的超过long范围的大数加法思路说了一遍,我说完后,他说,问了这么久,你还没有写过什么呢,这样吧,你把两个你设计的大数乘法算法写出来,我一听晕了,饿阿,那就写吧.在这层面试期间,3G部门的面试官上午11点就给我打电话要我去9楼面试,我说等一等,一下就等到了下午,他又打了几次电话,说再不来他就要走了,我慌忙写完乘法,给了happy看,他看了看,说写的太对阿,因为期间用了加法的算法,我没有写实现,他又让我把加法的实现也写一遍,我跑到屋里,把加法的算法刚写了个初稿,3G部门的那位面试管又给我打电话了,说再不来他就走了.我问了一下他那里面试要多久,他说很快,聊两句吧.我就跑去happy那里,说,我先下去一下,等下上来在把算法抄清楚了.其实那时,我有点不耐烦了,听到那么恐怖的工作要求和加班,而且对这个老大有点不喜欢,就有些不想面试的想法.后来到了3G部门,和那个人聊了几句,我以前一个小组的人就跳到了这个部门,一说,还都认识,之前的同事也提到过我,聊了一会,他们是做手机方面的,也要求对Javascript很高.然后我又回到了之前的部门,把最后的加法部分整齐的抄到了纸上,那时大约快下午5点了.而且当时听到其中一个人和happy说:哎,这一天又没招到一个人,我们招人,一定要从开始假设他什么也不会,他要从头去证明给我们看.我听了以后,觉得这个部门的人心理状态有点变态.交了卷,和happy说一下就走了. 可能是我和腾讯没有缘分吧. 以后再也不来这里面试了.</p>
<p>然后,有一天,又接到了一个猎头的电话,还是让我去杭州的阿里巴巴,说了很多诱人的话,我想了想,也许可以去试试,然后就答应了她,说先面试一下吧.之后,有一天是中午1点左右,阿里集团的人给我打了电话,聊了40分钟,很不错,考察的很仔细,很全面,沟通也很好,根本不像腾讯那样就捡你不会的问.后来他说,他这一面过了,又问了问我的情况,是否愿意来杭州之类的.然后和我说,让我等2面.过了几天,晚上6点50的时候,又有电话打来,又问了不少问题,这次更深入,把我当成架构师的等级来问的,像分布式Hadoop的细节,你熟悉哪几类通讯协议,有哪些优点和缺点,和很多的方方面面.问题还都算实在.我答的也不错.只有几个真不太专业,比如数据库分表 和 调优,我对mysql这些方面还真没怎么搞过, 但这些方面在大容量系统里真的很重要,以后要主要学习研究下. 最后他也问了一下我来杭州工作没意见吧之类的问题. 第二天,我看了那本叫做&lt;幸运的人更幸运&gt;的书,我问了我自己,这个工作是否真的是我想要的,我有没有欺骗自己,我是否愿意把老婆一个人丢在这里生了小孩我也不在身边,干几年如果不在那边呆了我还要回来重新到新公司积累,或者到那边发展,这边的户口房子和七七八八乱七八糟的事情的处理. 我反复的想了想,我发现我十分不愿背井离乡去杭州做这份工作后,第一时间就联系了我那个猎头,说明了这边也有我想要的工作,抱歉,可能不会去杭州了之类的话. 猎头表示理解,并希望以后再联系之类的.</p>
<p>其实,在接到阿里第二个面试之前,我已经完成了IBM的一面和二面了. 一面是在一个星期六的中午,上海IBM那边提前一天给我打了电话进行预约时间,让我做好准备. 对方在上海有一个IBM招聘会,由于我在深圳,所以只能电话联系,我答的很好,主要是面试了这么久,有了很多经验,并且问的问题实在是很基本,真的很实在. 后来他很高兴的和我说,恭喜你通过了,等下周人资会安排你下一次面试的具体细节. 我去网上查了下,一般IBM就两面,再后来,果然又要电话远程给我二面,我提出要求,能否找个人来当面面一下,聊两句,见不到人发挥不了我的长处. 那位人资一开始和我约了电话面试时间,不一会儿又打来,说,周六去长城大厦那边专门找了个人给我面试. 我说好吧. 周六面试也不错,沟通很好. 再后来,我等了一个星期,怎么没有动静,我快离职之前发了邮件问当时的人资还有没有戏,她很快回过电话来说当然有了. 您还愿意来吗? 我晕,难道最后这一次你要主动联系他们? 我说当然愿意来啦.然后就谈到工资,我要13000.她当时把我夸了一通,说我的技术above average,英语很好,还有管理经验,可以给你订到band7,工资呢,可惜给不了这么多,11000怎么样? 我当时也没多想,11000也行,现在想起来应该跟她谈一下12000了,让她觉得我比较好对付.后来她又让我把现在的工资单发给她.还承诺说跟我谈的这个工资没有任何关系,也不会少.只是证明你再现在的公司干过.后来我发给她(工资单加奖金数目是7500+),下午的时候,她打电话过来说,哎呀,11000没批过,老大说你工作年限太短了(我5年经验还短!!!),10000行不行? 我十分不愿意,可是怎么办? 我问她我有选择没,她笑了. 后悔啊后悔啊. 她接着又说,我看了你的简历,你的经验和水平不错,现在就差像我们这样的跨国公司的经历了,有了这样的经历,你以后出去再找工作也不难. 没办法,我抱着先打入IBM内部的思想,就咬着牙同意了,然后叮嘱她说,不要等下打电话和我说又没批过变9000了阿.她说不会,10000都批完了. 哎呀呀.</p>
<p>总之吧,前途和发展方向才是最重要的,对吧.</p>
<p>最后的时刻,没想到还真能进入IBM,我都准备收拾东西去中兴上班养老了呢.</p>
<p>今天去华强北买了G2000的白衬衣和西裤(便宜又实惠),然后去外贸市场买了条范思哲的皮带,还是真皮的呢,厉害. 以后上班要穿正装了,还真有点不习惯,希望能在IBM有好的发展吧.</p>
<p>发现,机会真的是给有准备的人,我这么多年来,一直坚持每周都看N部欧美电影,玩XO的正版游戏,玩MassEffect和DragonAge的全英文对话游戏,对我的英语保持和发展还真有不少作用呢.平时的积累很重要,还有要抓住机会,你是否还应得到更好的?</p>
<p>海阔凭鱼跃,天高任鸟飞. Good Luck.</p>
<p>//23:47</p>
<p>发表于 @ 2010年07月23日　23:54:00 | <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#FeedBack" title="评论" target="_blank">评论( loading...  )</a>| <a href="http://writeblog.csdn.net/PostEdit.aspx?entryId=5759042" title="编辑" target="_blank">编辑</a>| <a href="mailto:webmaster@csdn.net?subject=Article Report!!!&amp;body=Author:Eric77URL:http://blog.csdn.net/ArticleContent.aspx?UserName=Eric77&amp;Entryid=5759042">举报</a>| <a href="&quot;收藏到我的网摘中，并分享给我的朋友&quot;">收藏</a></p>
<h3 id="-http-blog-csdn-net-eric77-archive-2010-06-30-5704612-aspx-http-blog-csdn-net-eric77-archive-2010-08-01-5781573-aspx-"><a href="http://blog.csdn.net/Eric77/archive/2010/06/30/5704612.aspx" target="_blank">旧一篇:幸运的人更幸运 - 节选</a> | <a href="http://blog.csdn.net/Eric77/archive/2010/08/01/5781573.aspx" target="_blank">新一篇:软件开发的一些感想(五年工作总结版)</a></h3>
<p><a href="http://blog.csdn.net/" target="_blank">查看最新精华文章 请访问博客首页</a>相关文章<a href=""></a></p>
<ul>
<li><p>发表评论</p>
</li>
<li><p>表 情：</p>
</li>
<li><p><a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;顶&quot;" alt="顶"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;砸&quot;" alt="砸"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;棒&quot;" alt="棒"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;大笑&quot;" alt="大笑"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;愤怒&quot;" alt="愤怒"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;大哭&quot;" alt="大哭"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;疑问&quot;" alt="疑问"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;汗&quot;" alt="汗"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;呕吐&quot;" alt="呕吐"></a> <a href="http://blog.csdn.net/Eric77/archive/2010/07/23/5759042.aspx#" target="_blank"><img src="&quot;送花&quot;" alt="送花"></a></p>
</li>
<li><p>评论内容：
*</p>
</li>
<li>用 户 名：</li>
<li><p><a href="">登录</a> <a href="http://passport.csdn.net/CSDNUserRegister.aspx" target="_blank">注册</a> 匿名评论</p>
</li>
<li><p>验 证 码：</p>
</li>
<li><a href=""><img src="" alt="验证码"></a> <a href="">重新获得验证码</a></li>
</ul>
<p><em>
</em></p>
<h3 id="-">热门招聘职位<img src="" alt=""></h3>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/架构师/">架构师</a></li></span></span> | <span class="tags">Tagged <a href="/tags/架构师/" class="label label-primary">架构师</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-架构师--五年经验跳槽历程-Eric77的专栏/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-架构师--五年经验跳槽历程-Eric77的专栏" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-架构师--PODC-keynote/">PODC</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-架构师--PODC-keynote/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="podc-keynote">PODC-keynote</h1>
<p><img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> Inktomi at a Glance
Company Overview Applications
Search Technology Network Products Online Shopping Wireless Systems
Towards Robust Distributed Systems
Dr. Eric A. Brewer
Professor, UC Berkeley Co-Founder &amp; Chief Scientist, Inktomi CoPODC Keynote, July 19, 2000
“INKT” on NASDAQ Founded 1996 out of UC Berkeley ~700 Employees
PODC Keynote, July 19, 2000
Our Perspective
Inktomi builds two distributed systems:
– Global Search Engines – Distributed Web Caches
“Distributed Systems” don’t work...
There exist working DS:
– Simple protocols: DNS, WWW – Inktomi search, Content Delivery Networks – Napster, Verisign, AOL
Based on scalable cluster &amp; parallel computing technology But very little use of classic DS research...
PODC Keynote, July 19, 2000
But these are not classic DS:
– – – – Not distributed objects No RPC No modularity Complex ones are single owner (except phones)
PODC Keynote, July 19, 2000
1
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> Three Basic Issues
Where is the state? Consistency vs. Availability Understanding Boundaries
PODC Keynote, July 19, 2000
Where’s the state?
(not all locations are equal)
PODC Keynote, July 19, 2000
Santa Clara Cluster
Delivering High Availability
We kept up the service through: Crashes &amp; disk failures (weekly) Database upgrades (daily) Software upgrades (weekly to monthly) OS upgrades (twice) Power outage (several) Network outages (now have 11 connections) Physical move of all equipment (twice)
PODC Keynote, July 19, 2000 PODC Keynote, July 19, 2000
• Very uniform • No monitors • No people • No cables • Working power • Working A/C • Working BW
2
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> Berkeley Ninja Architecture Persistent State is HARD
Base: Scalable, highlyavailable platform for persistent-state services
Classic DS focus on the computation, not the data
– this is WRONG, computation is the easy part
Workstations &amp; PCs
Data centers exist for a reason
– can’t have consistency or availability without them AP
Internet
Other locations are for caching only:
– proxies, basestations, set-top boxes, desktops basestations, set– phones, PDAs, … PDAs,
Active Proxy: Bootstraps thin devices into infrastructure, runs mobile code
AP
Distributed systems can’t ignore location distinctions
Cellphones, Pagers, etc.
PODC Keynote, July 19, 2000
PDAs (e.g. IBM Workpad)
ACID vs. BASE
DBMS research is about ACID (mostly)
Consistency vs. Availability
(ACID vs. BASE)
But we forfeit “C” and “I” for availability, graceful degradation, and performance
This tradeoff is fundamental.
BASE: – Basically Available – Soft-state oft– Eventual consistency
PODC Keynote, July 19, 2000
PODC Keynote, July 19, 2000
3
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> ACID vs. BASE
ACID
Strong consistency Isolation Focus on “commit” Nested transactions Availability? Conservative (pessimistic) Difficult evolution (e.g. schema)
–
The CAP Theorem
BASE
Weak consistency
stale data OK
Availability first Best effort Approximate answers OK Aggressive (optimistic) Simpler! Faster Easier evolution Tolerance to network
Consistency
Availability
Partitions
But I think it’s a spectrum
PODC Keynote, July 19, 2000
Theorem: You can have at most two of these properties for any shared-data system
PODC Keynote, July 19, 2000
Forfeit Partitions
Examples Single-site databases SingleCluster databases
Forfeit Availability
Examples Distributed databases Distributed locking
Consistency
Availability
LDAP xFS file system Traits 2-phase commit cache validation protocols
PODC Keynote, July 19, 2000
Consistency
Availability
Majority protocols
Traits Tolerance to network
Tolerance to network
Partitions
Partitions
Pessimistic locking Make minority partitions unavailable
PODC Keynote, July 19, 2000
4
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> Forfeit Consistency
Examples Coda Web cachinge
These Tradeoffs are Real
The whole space is useful Real internet systems are a careful mixture of ACID and BASE subsystems
– We use ACID for user profiles and logging (for revenue) Traits
Consistency
Availability
DNS
But there is almost no work in this area Symptom of a deeper problem: systems and database communities are separate but overlapping (with distinct vocabulary)
PODC Keynote, July 19, 2000
Tolerance to network
expirations/leases conflict resolution optimistic
PODC Keynote, July 19, 2000
Partitions
CAP Take Homes
Can have consistency &amp; availability within a cluster (foundation of Ninja), but it is still hard in practice OS/Networking good at BASE/Availability, but terrible at consistency Databases better at C than Availability Wide-area databases can’t have both WideDisconnected clients can’t have both All systems are probabilistic…
PODC Keynote, July 19, 2000 PODC Keynote, July 19, 2000
Understanding Boundaries
(the RPC hangover)
5
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> The Boundary
The interface between two modules
– client/server, peers, libaries, etc… libaries,
Different Address Spaces
What if the two sides are NOT in the same address space?
– IPC or LRPC
Basic boundary = the procedure call
C S
Can’t do pass-by-reference (pointers) pass-by– Most IPC screws this up: pass by value-result value– There are TWO copies of args not one
– thread traverses the boundary – two sides are in the same address space
PODC Keynote, July 19, 2000
What if they share some memory?
– Can pass pointers, but… – Need synchronization between client/server – Not all pointers can be passed
PODC Keynote, July 19, 2000
Trust the other side?
What if we don’t trust the other side? Have to check args, no pointer passing args, Kernels get this right:
– copy/check args – use opaque references (e.g. File Descriptors)
Partial Failure
Can the two sides fail independently?
– RPC, IPC, LRPC
Can’t be transparent (like RPC) !! New exceptions (other side gone) Reclaim local resources
– e.g. kernels leak sockets over time =&gt; reboot
Most systems do not:
– TCP – Napster – web browsers
PODC Keynote, July 19, 2000
Can use leases?
– Different new exceptions: lease expired
RPC tries to hide these issues (but fails)
PODC Keynote, July 19, 2000
6
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> Multiplexing clients?
Boundary evolution?
Does the server have to:
– – – – – deal with high concurrency? Say “no” sometimes (graceful degradation) Treat clients equally (fairness) Bill for resources (and have audit trail) Isolate clients performance, data, ….
Can the two sides be updated independently? (NO) The DLL problem... Boundaries need versions Negotiation protocol for upgrade? Promises of backward compatibility? Affects naming too (version number)
These all affect the boundary definition
PODC Keynote, July 19, 2000
PODC Keynote, July 19, 2000
Example: protocols vs. APIs
Example: XML
Protocols have been more successful the APIs Some reasons:
– – – – protocols are pass by value protocols designed for partial failure not trying to look like local procedure calls explicit state machine, rather than call/return (this exposes exceptions well)
XML doesn’t solve any of these issues It is RPC with an extensible type system It makes evolution better?
– two sides need to agree on schema – can ignore stuff you don’t understand
Protocols still not good at trust, billing, evolution
PODC Keynote, July 19, 2000
Can mislead us to ignore the real issues
PODC Keynote, July 19, 2000
7
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> Boundary Summary
Conclusions
We have been very sloppy about boundaries Leads to fragile systems Root cause is false transparency: trying to look like local procedure calls Relatively little work in evolution, federation, client-based resource allocation, failure recovery client-
Classic Distributed Systems are fragile Some of the causes:
– – – – focus on computation, not data ignoring location distinctions poor definitions of consistency/availability goals poor understanding of boundaries (RPC in particular)
These are all fixable, but need to be far more common
PODC Keynote, July 19, 2000
PODC Keynote, July 19, 2000
The DQ Principle
Harvest &amp; Yield
Yield: Fraction of Answered Queries Yield:
Data/query /<em> Queries/sec = constant = DQ
– for a given node – for a given app/OS release
– Related to uptime but measured by queries, not by time – Drop 1 out of 10 connections =&gt; 90% yield – At full utilization: yield ~ capacity ~ Q
Harvest: Fraction of the Complete Result Harvest:
– Reflects that some of the data may be missing due to faults – Replication: maintain D under faults
A fault can reduce the capacity (Q), completeness (D) or both Faults reduce this constant linearly (at best)
DQ corollary: harvest /</em> yield ~ constant
– ACID =&gt; choose 100% harvest (reduce Q but 100% D) – Internet =&gt; choose 100% yield (available but reduced D)
PODC Keynote, July 19, 2000
PODC Keynote, July 19, 2000
8
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> Harvest Options
1) Ignore lost nodes
– RPC gives up – forfeit small part of the database – reduce D, keep Q
Replica Groups
With n members: Each fault reduces Q by 1/n 1/n D stable until nth fault Added load is 1/(n-1) per fault 1/(n
RAID RAID – n=2 =&gt; double load or 50% capacity – n=4 =&gt; 133% load or 75% capacity – “load redirection problem”
2) Pair up nodes
– RPC tries alternate – survives one fault per pair – reduce Q, keep D
3) n-member replica groups Decide when you care...
PODC Keynote, July 19, 2000
Disaster tolerance: better have &gt;3 mirrors
PODC Keynote, July 19, 2000
Graceful Degradation
Goal: smooth decrease in harvest/yield proportional to faults
– we know DQ drops linearly
Thinking Probabilistically
Maximize symmetry
– SPMD + simple replication schemes
Make faults independent
– – – – requires thought avoid cascading errors/faults understand redirected load KISS
Saturation will occur
– high peak/average ratios... – must reduce harvest or yield (or both) – must do admission control!!!
One answer: reduce D dynamically
– disaster =&gt; redirect load, then reduce D to compensate for extra load
PODC Keynote, July 19, 2000
Use randomness
– makes worst-case and average case the same worst– ex: Inktomi spreads data &amp; queries randomly – Node loss implies a random 1% harvest reduction
PODC Keynote, July 19, 2000
9
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> Server Pollution
Can’t fix all memory leaks Third-party software leaks memory and sockets Third– so does the OS sometimes
Evolution
Three Approaches: Flash Upgrade
– Fast reboot into new version – Focus on MTTR (&lt; 10 sec) – Reduces yield (and uptime)
Some failures tie up local resources Solution: planned periodic “bounce”
– Not worth the stress to do any better – Bounce time is less than 10 seconds – Nice to remove load first…
PODC Keynote, July 19, 2000
Rolling Upgrade
– Upgrade nodes one at time in a “wave” – Temporary 1/n harvest reduction, 100% yield – Requires co-existing versions co-
“Big Flip”
PODC Keynote, July 19, 2000
The Big Flip
Steps:
1) take down 1/2 the nodes 2) upgrade that half 3) flip the “active half” (site upgraded) 4) upgrade second half 5) return to 100%
Key New Problems
Unknown but large growth
– Incremental &amp; Absolute scalability – 1000’s of components
Must be truly highly available
– Hot swap everything (no recovery time allowed) – No “night” – Graceful degradation under faults &amp; saturation
50% Harvest, 100% Yield
– or inverse?
Constant evolution (internet time)
– Software will be buggy – Hardware will fail – These can’t be emergencies...
PODC Keynote, July 19, 2000
No mixed versions
– can replace schema, protocols, ...
Twice used to change physical location
PODC Keynote, July 19, 2000
10
<img src="" alt=""> <img src="" alt=""> <img src="" alt=""> <img src="" alt=""> Conclusions
Parallel Programming is very relevant, except…
– – – – historically avoids availability no notion of online evolution limited notions of graceful degradation (checkpointing) best for CPU-bound tasks CPU-
Conclusions
Winning solution is message-passing clusters message– fine-grain communication =&gt; finefine-grain exception handling fine– don’t want every load/store to deal with partial failure
Key open problems:
– – – – – – libraries &amp; data structures for HA shared state support for replication and partial failure better understanding of probabilistic systems cleaner support for exceptions (graceful degradation) support for split-phase I/O and many concurrent threads splitsupport for 10,000 threads/node (to avoid FSMs)
PODC Keynote, July 19, 2000
Must think probabilistically about everything
– – – – no such thing as a 100% working system no such thing as 100% fault tolerance partial results are often OK (and better than none) Capacity /* Completeness == Constant
PODC Keynote, July 19, 2000
New Hard Problems...
Really need to manage disks well
– problems are I/O bound, not CPU bound
Backup slides
Lots of simultaneous connections
– 50Kb/s =&gt; at least 2000 connections/node
HAS to be highly available
– no maintenance window, even for upgrades
Continuous evolution
– constant site changes, always small bugs... – large but unpredictable traffic growth
Graceful degradation under saturation
PODC Keynote, July 19, 2000 PODC Keynote, July 19, 2000
11
<img src="" alt=""> Parallel Disk I/O
Want 50+ outstanding reads/disk
– Provides disk-head scheduler with many choices disk– Trades response time for throughput
Pushes towards a split-phase approach to disks splitGeneral trend: each query is a finite-state machine finite– split-phase disk/network operations are state transitions split– multiplex many FSMs over small number of threads – FSM handles state rather than thread stack
PODC Keynote, July 19, 2000
12</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/架构师/">架构师</a></li></span></span> | <span class="tags">Tagged <a href="/tags/架构师/" class="label label-primary">架构师</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-架构师--PODC-keynote/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-架构师--PODC-keynote" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-框架汇总-Spring--Spring-设计模式-aop-ioc/">Spring</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-框架汇总-Spring--Spring-设计模式-aop-ioc/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="spring-aop-ioc">Spring-设计模式-aop-ioc</h1>
<p><a href="http://www.goldendoc.org/" target="_blank">黄金档</a></p>
<p>路漫漫其修远兮，吾将上下而求索……</p>
<ul>
<li><a href="http://www.goldendoc.org/" title="首页" target="_blank">首页</a></li>
<li><a href="http://www.goldendoc.org/hire/" target="_blank">招聘</a></li>
<li><a href="http://www.goldendoc.org/about/" target="_blank">关于</a></li>
</ul>
<h1 id="spring">Spring</h1>
<h2 id="-spring-http-www-goldendoc-org-2010-12-spring_design_pattern-spring-"><a href="http://www.goldendoc.org/2010/12/spring_design_pattern/" title="永久链接：Spring中的设计模式" target="_blank">Spring中的设计模式</a></h2>
<p><a href="http://www.goldendoc.org/2010/12/spring_design_pattern/#comments" target="_blank">2</a></p>
<p>2年前</p>
<p>由<a href="http://www.goldendoc.org/author/jackey/" title="jackey发表的文章 " target="_blank">jackey</a>发布 在<a href="http://www.goldendoc.org/category/spring/" title="Spring (4主题)" target="_blank">Spring</a>
应该说设计模式是我们在写代码时候的一种被承认的较好的模式。好的设计模式就像是给代码造了一个很好的骨架，在这个骨架里，你可以知道心在哪里，肺在哪里，因为大多数人都认识这样的骨架，就有了很好的传播性。这是从易读和易传播来感知设计模式的好处。当然设计模式本身更重要的是设计原则的一种实现，比如开闭原则，依赖倒置原则，这些是在代码的修改和扩展上说事。说到底就是人类和代码发生关系的四种场合：阅读，修改，增加，删除。让每一种场合都比较舒服的话，就需要用设计模式。</p>
<p>下面来简单列举Spring中的设计模式：
<strong>1. 简单工厂</strong>
又叫做静态工厂方法（StaticFactory Method）模式，但不属于23种GOF设计模式之一。
简单工厂模式的实质是由一个工厂类根据传入的参数，动态决定应该创建哪一个产品类。
Spring中的BeanFactory就是简单工厂模式的体现，根据传入一个唯一的标识来获得Bean对象，但是否是在传入参数后创建还是传入参数前创建这个要根据具体情况来定。
<strong>2. 工厂方法（Factory Method）</strong>
定义一个用于创建对象的接口，让子类决定实例化哪一个类。Factory Method使一个类的实例化延迟到其子类。
Spring中的FactoryBean就是典型的工厂方法模式。如下图：
<a href="http://pic.yupoo.com/goldendoc/AFbYXQy8/cgvMF.jpg" target="_blank"><img src="" alt=""></a></p>
<p><strong>3. 单例（Singleton）</strong>
保证一个类仅有一个实例，并提供一个访问它的全局访问点。
Spring中的单例模式完成了后半句话，即提供了全局的访问点BeanFactory。但没有从构造器级别去控制单例，这是因为Spring管理的是是任意的Java对象。
<strong>4. 适配器（Adapter）</strong>
将一个类的接口转换成客户希望的另外一个接口。Adapter模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。
Spring中在对于AOP的处理中有Adapter模式的例子，见如下图：
<a href="http://pic.yupoo.com/goldendoc/AFbYXG9r/yaKsE.jpg" target="_blank"><img src="" alt=""></a>
由于Advisor链需要的是MethodInterceptor对象，所以每一个Advisor中的Advice都要适配成对应的MethodInterceptor对象。
<strong>5.包装器（Decorator）</strong>
动态地给一个对象添加一些额外的职责。就增加功能来说，Decorator模式相比生成子类更为灵活。 <em>**</em></p>
<p><a href="http://pic.yupoo.com/goldendoc/AFbYXVzM/iEPst.jpg" target="_blank"><img src="" alt=""></a>
Spring中用到的包装器模式在类名上有两种表现：一种是类名中含有Wrapper，另一种是类名中含有Decorator。基本上都是动态地给一个对象添加一些额外的职责。
<strong>6. 代理（Proxy）</strong>
为其他对象提供一种代理以控制对这个对象的访问。
从结构上来看和Decorator模式类似，但Proxy是控制，更像是一种对功能的限制，而Decorator是增加职责。
<img src="" alt="">
Spring的Proxy模式在aop中有体现，比如JdkDynamicAopProxy和Cglib2AopProxy。
<strong>7.观察者（Observer）</strong>
定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。
<a href="http://pic.yupoo.com/goldendoc/AFbYY79B/QRttX.jpg" target="_blank"><img src="" alt=""></a>
Spring中Observer模式常用的地方是listener的实现。如ApplicationListener。
<strong>8. 策略（Strategy）</strong>
定义一系列的算法，把它们一个个封装起来，并且使它们可相互替换。本模式使得算法可独立于使用它的客户而变化。
Spring中在实例化对象的时候用到Strategy模式，见如下图：
<a href="http://pic.yupoo.com/goldendoc/AFbYYjl6/c2IJb.jpg" target="_blank"><img src="" alt=""></a>
在SimpleInstantiationStrategy中有如下代码说明了策略模式的使用情况：
<a href="http://pic.yupoo.com/goldendoc/AFbYYecL/xJ2n1.jpg" target="_blank"><img src="" alt=""></a>
<strong>9.模板方法（Template Method）</strong>
定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。Template Method使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。
<img src="" alt="">
Template Method模式一般是需要继承的。这里想要探讨另一种对Template Method的理解。Spring中的JdbcTemplate，在用这个类时并不想去继承这个类，因为这个类的方法太多，但是我们还是想用到JdbcTemplate已有的稳定的、公用的数据库连接，那么我们怎么办呢？我们可以把变化的东西抽出来作为一个参数传入JdbcTemplate的方法中。但是变化的东西是一段代码，而且这段代码会用到JdbcTemplate中的变量。怎么办？那我们就用回调对象吧。在这个回调对象中定义一个操纵JdbcTemplate中变量的方法，我们去实现这个方法，就把变化的东西集中到这里了。然后我们再传入这个回调对象到JdbcTemplate，从而完成了调用。这可能是Template Method不需要继承的另一种实现方式吧。</p>
<p>以下是一个具体的例子：
JdbcTemplate中的execute方法：</p>
<p><a href="http://pic.yupoo.com/goldendoc/AFbYXJ1i/Gqxeo.jpg" target="_blank"><img src="" alt=""></a>
JdbcTemplate执行execute方法：
<a href="http://pic.yupoo.com/goldendoc/AFbYYoCZ/coCXA.jpg" target="_blank"><img src="" alt=""></a></p>
<p><a href="http://www.goldendoc.org/tag/%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f/" title="设计模式 (1主题)" target="_blank">设计模式</a></p>
<h2 id="-spring-aop-http-www-goldendoc-org-2010-12-spring_aop-spring-aop-"><a href="http://www.goldendoc.org/2010/12/spring_aop/" title="永久链接：Spring AOP介绍及源码分析" target="_blank">Spring AOP介绍及源码分析</a></h2>
<p><a href="http://www.goldendoc.org/2010/12/spring_aop/#comments" target="_blank">3</a></p>
<p>2年前</p>
<p>由<a href="http://www.goldendoc.org/author/lwei/" title="lwei发表的文章 " target="_blank">lwei</a>发布 在<a href="http://www.goldendoc.org/category/spring/" title="Spring (4主题)" target="_blank">Spring</a>
软件开发经历了从汇编语言到高级语言和从过程化编程到面向对象编程；前者是为了提高开发效率，而后者则使用了归纳法，把具有共性的东西进行归类并使之模块化，达到便于维护和扩展的目的；如果说面向对象编程可以对业务需求进行很好的分解使之模块化；那么面向切面编程AOP（Aspect-Oriented Programming）则可以对系统需求进行很好的模软件开发经历了从汇编语言到高级语言和从过程化编程到面向对象编程；前者是为了提高开发效率，而后者则使用了归纳法，把具有共性的东西进行归类并使之模块化，达到便于维护和扩展的目的；如果说面向对象编程可以对业务需求进行很好的分解使之模块化；那么面向切面编程AOP（Aspect-Oriented Programming）则可以对系统需求进行很好的模块组织，简化系统需求和实现之间的对比关系，是对OOP思想的一种补充；块组织，简化系统需求和实现之间的对比关系，是对OOP思想的一种补充；</p>
<p><strong>一、AOP介绍
</strong></p>
<p>举个例子来说明一下吧！现在系统中有很多的业务方法，如上传产品信息、修改产品信息、发布公司库等；现在需要对这些方法的执行做性能监控，看每个业务方法的执行时间；在不改变原业务代码的基础上，也许我们会这么做：</p>
<p><strong>Offer接口：
</strong></p>
<p><img src="" alt=""></p>
<p><strong>Offer实现：
</strong></p>
<p><img src="" alt=""></p>
<p><strong>Offer代理：
</strong></p>
<p><img src="" alt=""></p>
<p>我们要通过下面的方式来使用：</p>
<p><img src="" alt=""></p>
<p>上面的例子的输出为：</p>
<p><img src="" alt=""></p>
<p>上面的例子中，OfferProxy实现了IOffer，而所有的业务实现均委托给其成员offer；可以想像，这应该就是最简单的AOP的实现了；但这种方式会存在一个问题：如果有非常多的这种业务对象需要性能监控，我们就需要写同样多的XyzProxy来满足需求，这也是非常巨大的工作量。</p>
<p>上面说到了代理，我们先看看代理模式吧！</p>
<p><strong>二、代理模式及实现
</strong></p>
<p>下面是代理模式的类图：</p>
<p><img src="" alt=""></p>
<p>代理模式类图</p>
<p>代理模式中，存在一个称为ProxyObject的代理对象和RealObject的真实对象，它们都实现了相同的接口；在调用的地方持有ProxyObject的实例，当调用request()方法时，ProxyObject可以在执行RealObject.request()前后做一些特定的业务，甚至不调用RealObject.request()方法。</p>
<p>目前实现代理模式的方式有两种：基于JDK的动态代理和基于CGLIB字节码的代理。</p>
<p><strong>2.1 JDK动态代理
</strong></p>
<p>JDK动态代理，顾名思义，是基于JDK的反射(reflect)机制；在JDK中，提供了InvocationHandler这个接口，下面是JDK里面的注释：</p>
<p>InvocationHandler is the interface implemented by the invocation handler of a proxy instance.</p>
<p>Each proxy instance has an associated invocation handler. When a method is invoked on a proxy instance, the method invocation is encoded and dispatched to the invoke method of its invocation handler.</p>
<p>简单翻译，意思是说：该接口由被代理对象的handler所实现；当调用代理对象的方法时，该方法调用将被编码，然后交给代理对象的invoke方法去执行；</p>
<p>是不是有一种豁然开朗的感觉呢？没错，答案就在你心中。</p>
<p>这样，上面的代码就可以改成下面的实现方式：</p>
<p><img src="" alt=""><em>**</em></p>
<p><strong>调用端：
</strong></p>
<p><img src="" alt=""></p>
<p>通过这种方式，你不需要为针对每一个业务写一个代理对象，就可以很轻松地完成你的需求；但也许你已经注意到了，JDK的动态代理，在创建代理对象(上面红色代码部分)时，被代理的对象需要实现接口(即面向接口编程)；</p>
<p>这就是JDK的动态代理，简单吧！下面看看CGLIB代理方式。</p>
<p><strong>2.2 CGLIB代理
</strong></p>
<p>如果目标对象没有实现任何接口，那怎么办呢？不用担心，你可以用CGLIB来实现代理：</p>
<p><img src="" alt=""></p>
<p><strong>调用端：
</strong></p>
<p><img src="" alt=""></p>
<p>使用CGLIB创建的代理对象，其实就是继承了要代理的目标类，然后对目标类中所有非final方法进行覆盖，但在覆盖方法时会添加一些拦截代码(上面CglibProxyFactory类中的intercept方法)。</p>
<p>下面看看Spring中是如何实现AOP的。</p>
<p><strong>三、Spring AOP的实现
</strong></p>
<p><strong>3.1 Spring AOP的几个概念
</strong></p>
<p>Spring AOP中的几个基本概念，每次学习AOP都被这几个概念折腾的很不爽，我们在这里再把这几个概念描述一遍，力争把这几个概念搞清，在每次review这块内容的时候可以很快上手。</p>
<ol>
<li>切面(Aspect)：切面就是一个关注点的模块化，如事务管理、日志管理、权限管理等；</li>
<li>连接点(Joinpoint)：程序执行时的某个特定的点，在Spring中就是一个方法的执行；</li>
<li>通知(Advice)：通知就是在切面的某个连接点上执行的操作，也就是事务管理、日志管理等；</li>
<li>切入点(Pointcut)：切入点就是描述某一类选定的连接点，也就是指定某一类要织入通知的方法；</li>
<li>目标对象(Target)：就是被AOP动态代理的目标对象；</li>
</ol>
<p>用一张图来形象地表达AOP的概念及其关系如下：</p>
<p><img src="" alt=""></p>
<p><strong>3.2 Spring AOP中切入点、通知、切面的实现
</strong></p>
<p>理解了上面的几个概念后，我们分别来看看Spring AOP是如何实现这些概念的；</p>
<ol>
<li>切入点(Pointcut)：它定义了哪些连接点需要被织入横切逻辑；在Java中，连接点对应哪些类(接口)的方法。因此，我们都能猜到，所谓的切入点，就是定义了匹配哪些娄的哪些方法的一些规则，可以是静态的基于类(方法)名的值匹配，也可以是基于正则表达式的模式匹配。来看看Spring AOP Pointcut相关的类图：</li>
</ol>
<p><img src="" alt=""></p>
<p>在Pointcut接口的定义中，也许你已经想到了，ClassFilter是类过滤器，它定义了哪些类名需要拦截；典型的两个实现类为<strong>TypePatternClassFilter</strong>和<strong>TrueClassFilter</strong>(所有类均匹配)；而MethodMatcher为方法匹配器，定义哪些方法需要拦截。</p>
<p>在上面的类图中：</p>
<ul>
<li>StaticMethodMatch与DynamicMethodMatch的区别是后者在运行时会依据方法的参数值进行匹配。</li>
<li>NameMatchMethodPointCut根据指定的mappedNames来匹配方法。</li>
<li>AbstractRegexpMethodPointCut根据正则表达式来匹配方法。</li>
</ul>
<ol>
<li>通知(Advice)：通知定义了具体的横切逻辑。在Spring中，存在两种类型的Advice，即per-class和per-instance的Advice。</li>
</ol>
<p>所谓per-class，即该类型的Advice只提供方法拦截，不会为目标对象保存任何状态或者添加新的特性，它也是我们最常见的Advice。下面是per-class的类图：</p>
<p><img src="" alt=""></p>
<ul>
<li>BeforeAdvice：在连接点前执行的横切逻辑。</li>
<li>AfterReturningAdvice：在连接点执行后，再执行横切逻辑。</li>
<li>AfterAdvice：一般由程序自己实现，当抛出异常后，执行横切逻辑。</li>
<li>AroundAdvice：Spring AOP中并没有提供这个接口，而是采用了AOP Alliance的MethodInteceptor接口；通过看AfterReturningAdvice的源码我们知道，它是不能更改连接点所在方法的返回值的(更改引用)；但使用的MethodInteceptor，所有的事情，都不在话下。</li>
</ul>
<p>在上面的类图中，还有两种类没有介绍，那就是/<em>/</em>/<em>AdviceAdapter和/</em>/<em>/</em>AdviceInteceptor，我们以AfterReturningAdviceInterceptor为例来说明：</p>
<p><img src="" alt=""></p>
<p>该类实现了MethodInterceptor和AfterAdvice接口，同时构造函数中还有一个AfterReturningAdvice实例的参数；这个类存在的作用是为了什么呢？对，没错，Spring AOP把所有的Advice都适配成了MethodInterceptor，统一的好处是方便后面横切逻辑的执行(参看下一节)，适配的工作即由/<em>/</em>/*AdviceAdapter完成；</p>
<p>哈哈，Spring AOP的代码也不过如此嘛：所谓的AfterReturningAdvice，通过适配成MethodInterceptor后，其实就是在invoke方法中，先执行目标对象的方法，再执行的AfterReturningAdvice所定义的横切逻辑。你现在明白它为什么不能修改返回值的引用了吧？</p>
<p>对于per-instance的Advice，目前只有一种实现，就是Introduction，使用的场景比较少，有兴趣的同学可以自己研究一下，呵呵！</p>
<ol>
<li>切面(Aspect)：在Spring中，Advisor就是切面；但与通常的Aspect不同的是，Advisor通常只有一个Pointcut和一个Advice，而Aspect则可以包含多个Pointcut和多个Advice，因此Advisor是一种特殊的Aspect。但，这已经够用了！</li>
</ol>
<p>接下来看下per-class Advisor的类图：</p>
<p><img src="" alt=""></p>
<p>其实没有什么好看的，前面已经说过，Advisor包含一个Pointcut和一个Advisor；在AbstractGenericPointcutAdvisor中，持有一个Advice的引用；下面的几个实现，均是针对前面提到的几种不同的Pointcut的实现。</p>
<p><strong>3.3 Spring AOP实现的基本线索
</strong></p>
<p>我们选择ProxyFactoryBean作为入口点和分析的开始。ProxyFactoryBean是在Spring IoC环境中，创建AOP应用的最底层方法，从中，可以看到一条实现AOP的基本线索。</p>
<p>所有的逻辑从以下的方法开始,我们主要针对单例的代理对象的生成：</p>
<p><img src="" alt=""></p>
<p>下面我们深入到SpringAOP核心代码的内部，看看代理对象的生成机制，拦截器横切逻辑以及织入的实现。</p>
<p><strong>3.4  代理对象的生成
</strong></p>
<p>对于getSingletonInstance()方法返回了什么，这就是代理对象如何产生的逻辑了，然我们须根溯源，看看传说中的proxy到底是如何一步一步的产生的。</p>
<p><img src="" alt=""></p>
<p>ProxyFactoryBean是AdvisedSupport的子类，Spring使用AopProxy接口把AOP代理的实现与框架的其他部分分离开来。在AdvisedSupport中通过这样的方式来得到AopProxy,当然这里需要得到AopProxyFactory的帮助 ，从JDK或者cglib中得到想要的代理对象：</p>
<p><img src="" alt=""></p>
<p>这个DefaultAopProxyFactory是Spring用来生成AopProxy的地方，它包含JDK和Cglib两种实现方式。让我接着往里面看：</p>
<p><img src="" alt=""></p>
<p>可以看到其中的代理对象可以由JDK或者Cglib来生成，JdkDynamicAopProxy类和Cglib2AopProxy都实现的是AopProxy的接口，我们进入JdkDynamicAopProxy实现中看看Proxy是怎样生成的：</p>
<p><img src="" alt=""></p>
<p>用Proxy包装target之后，通过ProxyFactoryBean得到对其方法的调用就被Proxy拦截了， ProxyFactoryBean的getObject()方法得到的实际上是一个Proxy了，target对象已经被封装了。对 ProxyFactoryBean这个工厂bean而言，其生产出来的对象是封装了目标对象的代理对象。</p>
<p><strong>3.5 拦截器的作用
</strong></p>
<p>前面分析了SpringAOP实现中得到Proxy对象的过程，接下来我们去探寻Spring AOP中拦截器链是怎样被调用的，也就是Proxy模式是怎样起作用的。
还记得在JdkDynamicAopProxy中生成Proxy对象的时候，有一句这样的代码吗？</p>
<p><strong>return</strong> Proxy.<em>newProxyInstance</em>(classLoader, proxiedInterfaces, <strong>this</strong>);<em>**</em></p>
<p>这里我们的JdkDynamicAopProxy实现了InvocationHandler这个接口，this参数对应的是InvocationHandler对象,也就是说当 Proxy对象的函数被调用的时候，InvocationHandler的invoke方法会被作为回调函数调用：</p>
<p><img src="" alt=""></p>
<p><img src="" alt=""></p>
<p>上面所说的目标对象方法的调用，是通过AopUtils的方法调用，使用反射机制来对目标对象的方法进行的：</p>
<p><img src="" alt=""></p>
<p>接下来，我们来看具体的ReflectiveMethodInvocation中proceed()方法的实现，也就是拦截器链的实现机制：</p>
<p><img src="" alt=""></p>
<p>从上面的分析我们看到了Spring AOP拦截机制的基本实现，比如Spring怎样得到Proxy，怎样利用JAVA Proxy以及反射机制对用户定义的拦截器链进行处理。</p>
<p><strong>3.6 织入的实现
</strong></p>
<p>在上面调用拦截器的时候，经过一系列的注册，适配的过程以后，拦截器在拦截的时候，会调用到预置好的一个通知适配器，设置通知拦截器，这是一系列Spring设计好为通知服务的类的一个，是最终完成通知拦截和实现的地方，例如对 MethodBeforeAdviceInterceptor的实现是这样的：</p>
<p><img src="" alt=""></p>
<p>可以看到通知适配器将advice适配成Interceptor以后，会调用advice的before方法去执行横切逻辑。这样就成功的完成了before通知的织入。</p>
<p><a href="http://www.goldendoc.org/tag/aop/" title="AOP (1主题)" target="_blank">AOP</a></p>
<h2 id="-spring-ioc-applicationcontext-http-www-goldendoc-org-2010-11-spring_ioc_applicationcontext-2-spring-ioc-applicationcontext-"><a href="http://www.goldendoc.org/2010/11/spring_ioc_applicationcontext-2/" title="永久链接：Spring IoC之ApplicationContext" target="_blank">Spring IoC之ApplicationContext</a></h2>
<p><a href="http://www.goldendoc.org/2010/11/spring_ioc_applicationcontext-2/#comments" target="_blank">0</a></p>
<p>2年前</p>
<p>由<a href="http://www.goldendoc.org/author/iwlh/" title="iwlh发表的文章 " target="_blank">iwlh</a>发布 在<a href="http://www.goldendoc.org/category/spring/" title="Spring (4主题)" target="_blank">Spring</a>
本章主要讲ApplicationContext接口对BeanFactory接口的扩展内容。BeanFactory接口主要围绕着bean和bean相关配置方式，没有关注应用环境的相关配置。ApplicationContext接口从BeanFactory接口派生而来，它与BeanFactory的对比如下图所示：</p>
<p>BeanFactory </p>
<p>ApplicationContext  Bean配置/实例化</p>
<p>Yes </p>
<p>Yes  自动装配BeanPostProcessor</p>
<p>No </p>
<p>Yes  自动装配BeanFactoryPostProcessor</p>
<p>No </p>
<p>Yes  国际化信息（MessageSources）支持</p>
<p>No </p>
<p>Yes  容器内部事件（ApplicationEvent）支持</p>
<p>No </p>
<p>Yes  多配置模块加载</p>
<p>No </p>
<p>Yes </p>
<p><strong>1、统一资源加载
</strong></p>
<p>Spring中提供了org.springframework.core.io.Resource接口作为所有资源的抽象。Spring中默认提供了一些Resource接口的实现类，如图所示：</p>
<p><img src="" alt=""></p>
<p>实现类命名上就可以看出对应的资源，比如ClassPathResource类是从java应用程序的ClassPath中加载相关资源等等。</p>
<p>Spring中使用ResourceLoader来查找和定位Resource资源。ResorceLoader接口类图如下所示：</p>
<p><img src="" alt=""></p>
<p>从上图可以看出，ApplicationContext接口继承自ResourceLoader接口。AbstractApplicationContext抽象类也继承自DefaultResourceLoader类，而且还拥有一个PathMatchingResourcePatternResolver属性字段，需要加载多个Resource时候，委派给PathMatchingResourcePatternResolver类加载即可。</p>
<p>回过来，让我们再看下DefaultResourceLoader中getResource方法的实现代码。</p>
<p><img src="" alt=""></p>
<p>可以看到getResource方法尝试了classPath、url方式加载资源。需要注意的是，该类不能加载相对路径或绝对路径下的资源（例如文件），如果需要加载绝对路径的资源，可以使用FileSystemResourceLoader对象。</p>
<p><strong>2、国际化信息支持
</strong></p>
<p>Java SE中已经有了国际化支持，也就是java.util.Locale和java.util.ResourceBundle。Spring在JavaSE的国际化支持上，进一步抽象了国际化信息的访问接口，提供了org.springframework.context.MessageSource接口，该接口提供一下方法：</p>
<p><img src="" alt=""></p>
<p>ApplicationContext也实现了MessageSource接口。当ApplicationContext初始化时，它会自动在容器中查找名称为”messageSource”的bean。如果找到，对上述方法的调用将被委托给该bean。否则ApplicationContext会在其父类中查找是否含有同名的bean。如果有，就把它作为MessageSource。如果它最终没有找到任何的消息源，一个空的StaticMessageSource将会被实例化，使它能够接受上述方法的调用。messageSource bean的配置实例如下：</p>
<p><img src="" alt=""></p>
<p>Spring提供了三种MessageSource的实现。即StaticMessageSource（提供简单实现，可通过编程方式添加信息条目，多用于测试，不应该用于正式的生产环境）、ResourceBundleMessageSource（基于标准的java.util.ResourceBundle而实现的MessageSource，对父类AbstractMessageSource进行扩展，提供对多个ResourceBundle的缓存以提高查询速度。是最常用的，可用于生产环境下的MessageSource）、ReloadableResourceBundleMessageSource（同样是基于标准的java.util.ResourceBundle而实现的MessageSource，通过cacheSeconds属性可以定期刷新并检查properties资源文件是否发生变化，并且通过ResourceLoader加载properties资源文件。）</p>
<p>另外，MessageSourceAware接口还能用于获取任何已定义的MessageSource引用。任何实现了MessageSourceAware接口的bean将在Spring容器初始化时候与MessageSource一同被注入。</p>
<p>MessageSource与ApplicationContext的类结构图如下所示：</p>
<p><img src="" alt=""></p>
<p><strong>3、Spring容器内部事件发布
</strong></p>
<p>ApplicationContext容器提供了容器内部事件发布功能，是继承自JavaSE标准自定义事件类而实现的。</p>
<p>JavaSE标准自定义事件结构不在此详细描述，一张图很直观的描述清楚：</p>
<p><img src="" alt=""></p>
<p>EventObject，为JavaSE提供的事件类型基类，任何自定义的事件都继承自该类，例如上图中右侧灰色的各个事件。Spring中提供了该接口的子类ApplicationEvent。</p>
<p>EventListener，为JavaSE提供的事件监听者接口，任何自定义的事件监听者都实现了该接口，如上图左侧的各个事件监听者。Spring中提供了该接口的子类ApplicationListener接口。</p>
<p>JavaSE中未提供事件发布者这一角色类， 由各个应用程序自行实现事件发布者这一角色。Spring中提供了ApplicationEventPublisher接口作为事件发布者，并且ApplicationContext实现了这个接口，担当起了事件发布者这一角色。但ApplicationContext在具体实现上有所差异，Spring提供了ApplicationEventMulticaster接口，负责管理ApplicationListener和发布ApplicationEvent。ApplicationContext会把相应的事件相关工作委派给ApplicationEventMulticaster接口实现类来做。类图如下所示：</p>
<p><img src="" alt=""></p>
<p>附上一张事件发布的时序图：</p>
<p><a href="http://pic.yupoo.com/goldendoc/AH0MxsWp/jBIbm.png" target="_blank"><img src="" alt=""></a></p>
<p><strong>4、多配置模块加载
</strong></p>
<p>现在的应用程序，一般都会把配置信息按照某些规则进行分割，将不同类型或关注点的配置项放置在不同的文件中。相对BeanFactory来说，ApplicationContext已经支持了加载多个配置文件。</p>
<p>ApplicationContext加载多个配置文件的方法有：</p>
<p>1) 数组方式</p>
<p>String[] locations = new String[]{ “conf/bean1.xml”,”conf/bean2.xml”, “conf/bean3.xml”};</p>
<p>ApplicationContext container = new FileSystemXmlApplicationContext(locations);</p>
<p>2) 通配符</p>
<p>ApplicationContext container = new FileSystemXmlApplicationContext(“conf//<em>/</em>//*.xml”);</p>
<p>3) ClassPathXmlApplicationContext特性</p>
<p>ApplicationContext ctx = new ClassPathXmlApplicationContext(new String[] {“services.xml”, “daos.xml”}, MessengerService.class);</p>
<p>该方法可以通过MessengerService类在ClassPath中的位置定位配置文件，而不用指定每个配置文件的完整路径名。</p>
<p><a href="http://www.goldendoc.org/tag/applicationcontext/" title="ApplicationContext (1主题)" target="_blank">ApplicationContext</a></p>
<h2 id="-spring-ioc-beanfactory-http-www-goldendoc-org-2010-11-spring-ioc-e4-b9-8bbeanfactory-spring-ioc-beanfactory-"><a href="http://www.goldendoc.org/2010/11/spring-ioc%e4%b9%8bbeanfactory/" title="永久链接：Spring IoC之BeanFactory" target="_blank">Spring IoC之BeanFactory</a></h2>
<p><a href="http://www.goldendoc.org/2010/11/spring-ioc%e4%b9%8bbeanfactory/#comments" target="_blank">0</a></p>
<p>2年前</p>
<p>由<a href="http://www.goldendoc.org/author/khotyn/" title="khotyn发表的文章 " target="_blank">khotyn</a>发布 在<a href="http://www.goldendoc.org/category/spring/" title="Spring (4主题)" target="_blank">Spring</a>
本文的内容为对Spring IoC容器实现的分析。</p>
<p>本文一共分为5个部分：</p>
<ul>
<li>第一部分简要讲述了IoC的概念</li>
<li>第二部分对Spring IoC容器中的主要类及其职责做一些了解</li>
<li>第三部分分析了Spring IoC容器的初始化过程</li>
<li>第四部分分析了从Spring IoC容器中获取Bean的过程</li>
<li>第五部分简要讲述了Spring IoC容器对Bean生命周期的管理。</li>
</ul>
<p>本文假设读者对以下的概念有所了解：IoC（控制反转），DI（依赖注入），Bean，并且读者有使用Spring IoC容器的经验。</p>
<p>约定：本文中所指的IoC容器没有特别说明均为Spring IoC容器</p>
<h3 id="-ioc-"><a href="">一、什么是</a><a href="">IoC</a><a href=""></a></h3>
<p><a href=""></a></p>
<p><a href="">IoC是Inversion of Control的缩写，中文的意思是控制反转，在IoC中，组件不需要去寻找它所依赖的对象，而是由IoC容器来负责将组件所依赖的对象通过Java Bean的Setter方法或者是构造函数等方式注入给组件。IoC的另一个名字是DI，即依赖注入，关于IoC和DI之间的关系以及关于IoC的更多内容，大家可以参考Wiki上的</a><a href="http://www.google.com/url?q=http%3A%2F%2Fzh.wikipedia.org%2Fzh%2F%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGHDFZSBvJ9wlCDET_IgqV-4DVCzw">控制反转条目。
</a></p>
<p><a href="http://www.google.com/url?q=http%3A%2F%2Fzh.wikipedia.org%2Fzh%2F%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGHDFZSBvJ9wlCDET_IgqV-4DVCzw">
</a></p>
<h3 id="-http-www-google-com-url-q-http-3a-2f-2fzh-wikipedia-org-2fzh-2f-e6-8e-a7-e5-88-b6-e5-8f-8d-e8-bd-ac-sa-d-sntz-1-usg-afqjcnghdfzsbvj9wlcdet_igqv-4dvczw-ioc-"><a href="http://www.google.com/url?q=http%3A%2F%2Fzh.wikipedia.org%2Fzh%2F%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGHDFZSBvJ9wlCDET_IgqV-4DVCzw"></a>[二、IoC容器中的类主要类及其职责</h3>
<p>]()</p>
<p><a href="">
我们先来看下IoC容器的一个大概的类图：
</a></p>
<p><a href=""></a><a href="http://www.google.com/url?q=http%3A%2F%2Fpic.yupoo.com%2Fkhotyn%2F816909ab9c75%2Fji8tx5ue.jpg&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEixIuYlet6oZmgnSPQy-ZxrCs4yA"><img src="" alt=""></a></p>
<p><a href="http://www.google.com/url?q=http%3A%2F%2Fpic.yupoo.com%2Fkhotyn%2F816909ab9c75%2Fji8tx5ue.jpg&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEixIuYlet6oZmgnSPQy-ZxrCs4yA" target="_blank">点击查看大图</a></p>
<p>这张图中比较简单的展示了IoC容器中的各个类及其指责，我们需要重点把握几个接口的职责：</p>
<ul>
<li>BeanFactory：这个接口是整个IoC容器最底层的接口，定义了一组访问Bean容器的基本方法。一些其他的接口，比如ListableBeanFactory和ConfigurableBeanFactory，都是继承了BeanFactory，并添加了其他的方法来完成某些特别的功能（比如ConfigurableBeanFactory，顾名思义，这个接口的职责是让BeanFactory变得可配置，那么它就定义了一组可以配置BeanFactory的方法）。</li>
<li>AbstractBeanFactory：从名字可以看出，这个类是BeanFactory接口的一个抽象实现类，这个类本身实现的是ConfigurableBeanFactory，对ConfigurableBeanFactory以及BeanFactory中的方法提供了实现，并且提供了一些诸如单例缓存，别名等等功能。</li>
<li>SingletonBeanRegistry：定义了一组操作单例Bean的方法</li>
</ul>
<h3 id="-ioc-"><a href="">三、</a>[IoC容器的初始化</h3>
<p>]()<a href=""></a></p>
<p>[
使用过Spring的人都知道，我们都是在一份Bean配置文件中定义Bean，然后就可以通过BeanFactory的getBean()方法来获取Bean，那么我们就可以大致猜想到IoC容器的初始化工作大概就是将我们编写的Bean配置文件转换成IoC容器内部定义的用于放置Bean定义信息的数据结构，而这个数据结构就是BeanDefinition这个类。下面我们就来了解下这个转换过程是如何进行的。</p>
<p>我们通过实例化ClassPathXmlApplicationContext这个类来一步步来看其初始化的过程，简单地实例化ClassPathXmlApplicationContext的代码如下：</p>
<p><img src="" alt=""></p>
<p>这里我们传入一个beans.xml作为配置文件的路径去实例化一个ClassPathXmlApplicationContext。</p>
<p>首先我们还是来看下整个初始化过程的序列图：
]()</p>
<p><a href=""></a><a href="http://www.google.com/url?q=http%3A%2F%2Fpic.yupoo.com%2Fkhotyn%2F005389ab9c75%2Fogfhmraj.jpg&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHa07fld9fiZq1BzNzeljU3nfHFXQ"><img src="" alt=""></a></p>
<p><a href="http://www.google.com/url?q=http%3A%2F%2Fpic.yupoo.com%2Fkhotyn%2F005389ab9c75%2Fogfhmraj.jpg&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHa07fld9fiZq1BzNzeljU3nfHFXQ" target="_blank">点击查看大图</a></p>
<p>这个图中涉及到的类或许有点吓人，且慢，下面我会慢慢带你了解整个过程。从序列图里面我们看到初始化过程首先调用了refresh()方法，后面调用到了AbstractXmlApplicationContext的loadBeanDefinitions方法，来看下这个方法的实现：</p>
<p><img src="" alt=""></p>
<p>这个方法将beanFactory（实现了BeanDefinitionRegistry接口，后续将通过这个接口将Bean定义信息注册到BeanFactory中去）传入new了一个XmlBeanDefinitionReader对象，然后将刚刚new出来的beanDefinitionReader传入调用loadBeanDefinitions方法，最终调用了XmlBeanDefinitionReader的loadBeanDefinitions(EncodedResource encodedResource)方法：</p>
<p><img src="" alt=""></p>
<p>这个方法获取了Bean配置文件的输入流，并且调用了doLoadBeanDefinitions方法，在这个方法里面，程序将输入流转换成Document对象，然后调用了下面这个方法：</p>
<p><img src="" alt=""></p>
<p>需要注意这个createReaderContext(resource)方法，创建这个方法的时候XmlBeanDefinitionReader将自己传入，以便在后面可以获取到它的Registry对象。最终DefaultBeanDefinitionDocumentReader将解析BeanDefinition的工作又交给了BeanDefinitionParserDelegate对象：</p>
<p><img src="" alt=""></p>
<p>从上面的方法中，我们可以看到BeanDefinitionParserDelegate对象解析出BeanDefinition后，就由BeanDefinitionRegistry来将BeanDefinition注册到BeanFactory中去了。</p>
<p>至此，整个BeanFactory就初始化完毕了，可能一大堆方法调来调去地早就把大家给调晕了，我们就来总结下初始化过程中设计到的几个主要的类以及它们的职责吧：</p>
<ul>
<li>XmlBeanDefinitionReader：读取定义Bean的XML文件并且将XML文件转成Document对象，交给BeanDefinitionDocuementReader再做解析。它持有一个BeanDefinitionRegistry对象，用于将BeanDefinition注册到BeanFactory中去。</li>
<li>XmlBeanDefinitionDocumentReader：取出Docuement对象内的各个元素并将这些元素交给BeanDefinitionParserDelegate来解析。</li>
<li>BeanDefinitionParserDelegate：用于解析Bean定义信息的代理类，负责一个Bean定义信息（可以看作是一个<bean></bean>标签对）解析成一个BeanDefinition对象。</li>
<li>BeanDefinitionRegister：负责将BeanDefinition注册到BeanFactory中去。</li>
</ul>
<h3 id="-ioc-bean-"><a href="">四、从</a><a href="">IoC容器中获取Bean</a><a href=""></a></h3>
<p><a href="">
用过Spring的人大概都知道，在Spring中，我们是通过调用BeanFactory的getBean()方法来取得我们所需要的Bean的，而getBean()方法的主要逻辑在AbstactBeanFactory的doGetBean()方法中。在Spring中，有单例Bean和原型Bean的区分，在从容器中获取Bean的时候，单例Bean和原型Bean有些不同，当第一次获取单例Bean的时候，整个过程和获取原型Bean几乎是一样的，都需要创建一个Bean，但是当第二次，第三次，……，获取同样的单例Bean的时候，容器就直接从单例缓存中获取Bean了，而不会再去像获取原型Bean一样一而再再而三地创建Bean了。这样我们这一节也主要从两个方面来讲，一个是获取原型Bean，第一次获取单例Bean的逻辑和这个类似，有特别的地方也会在这里顺带提到，二则是将从单例缓存中获取单例Bean的过程，首先我们来看获取原型Bean：
</a></p>
<h3 id="-4-1-bean"><a href=""></a>[4.1、获取原型Bean</h3>
<p>]()</p>
<p>[
正如前面所说，我们来看下AbstractBeanFactory的doGetBean()方法来了解获取原型Bean的整个过程。</p>
<p>在获取Bean的时候，无论这个Bean是单例的还是原型的，Spring都会尝试从单例缓存中获取Bean，但是当拿原型Bean的时候，这里显然是拿不到的，接下来程序就会根据BeanDefinition信息来判断要创建的Bean是不是原型Bean，如果是，则进入下面这段逻辑：</p>
<p><img src="" alt=""></p>
<p>程序在上图的（1）中的位置调用了beforePrototypeCreation方法，告诉容器当前的这个Bean正在创建中，来防止发生重复创建的情况。接下来，程序在（2）处调用了createBean方法来创建这个prototypeBean，最后，在（3）处，程序调用afterProtytypeCreation来告诉容器，这个Bean现在已经不再创建过程中了。</p>
<p>那么，让我们来关注下createBean这个方法里面干了些什么事情：</p>
<p><img src="" alt=""></p>
<p>在做了一堆准备工作后，程序就到了上面的这一段中，从代码中我们可以看出这个方法主要的功能为以下两点：</p>
<ul>
<li>调用resolveBeforeInstantiation方法，让BeanPostProcessor可以有机会给你返回一个代理类而不是原来的类，当后面我们看到Spring AOP代理类的生成的时候，就会看到这个方法的用处了。</li>
<li>调用doCreateBean()方法创建Bean</li>
</ul>
<p>我们再来看下doCreateBean方法：</p>
<p><img src="" alt=""></p>
<p>同样，这个方法里面也有两个主要的功能：</p>
<ul>
<li>一是调用createBeanInstance方法，创建一个Bean实例，在这个方法的内部，会调用BeanUtils的instantiateClass来实例化Bean，并把它包装成一个BeanWrapper</li>
<li>二是调用populateBean方法来将Bean依赖的属性设置进去。
]()</li>
</ul>
<h3 id="-4-2-bean"><a href=""></a>[4.2、创建单例Bean</h3>
<p>]()</p>
<p>[
整个获取原型Bean的过程大概就是这样样子，因为创建单例Bean和这个过程基本上是一样的，但是也有一些稍微不一样的地方，这里也稍微提到一下：</p>
<p><img src="" alt=""></p>
<p>创建单例Bean是通过调用getSingleton来实现的，这个方法传入一个beanName和一个ObjectFactory，这个ObjectFactory的getObject方法里面调用到了我们前面提到的createBean方法，所以我们看下getSingleton这个方法的实现：</p>
<p><img src="" alt=""></p>
<p>这个方法先尝试从singletonObjects中获取单例Bean，如果获取不到，则自己创建，同样，和创建原型Bean一样，在创建开始之前会调用beforeSingletonCreation方法来将beanName放到singletonsCurrentlyInCreation来告诉容器这个Bean已经在创建中了，在创建完成之后，会将BeanName从singletonsCurrentlyInCreation中删除掉。创建的过程是调用了传入的ObjectFactory的getObject方法，和创建原型Bean类似。在创建完成之后，还有一步addSingleton的操作，来讲单例放到单例缓存中去，看一下这个的实现：</p>
<p><img src="" alt=""></p>
<p>方法的逻辑非常简单：把创建出来的单例Bean放到singletonObjects中去，然后从singletonFactories和earlySingletonObjects中删除掉，最后在registeredSingletons里面再加入这个Bean，对于这里面用到的几个容器，我觉得有必要在这里描述一下其作用，要不然读者肯定是晕呼晕呼的：</p>
<ul>
<li>singletonObjects：用于保存BeanName和Bean实例之间的关系</li>
<li>singletonFactories：用于保存BeanName和创建Bean的工厂之间的关系</li>
<li>earlySingletonObjects：也是保存BeanName和Bean实例之间的关系，与singletonObjects的不同之处在于，当一个单例Bean被放到这里面去后，那么当Bean还在创建过程中，就可以通过getBean来拿到了，其目的是用来检测循环引用。</li>
<li>registeredSingletons：用来保存当前所有已注册的Bean
]()</li>
</ul>
<h3 id="-4-3-bean"><a href=""></a>[4.3、从单例缓存中获取单例Bean</h3>
<p>]()</p>
<p>[
单例在Spring的同一个容器内只会被创建一次，后续再获取Bean，就直接从单例缓存中获取了，我们来看下这一段过程，看下doGetBean里面调用的getSingleton方法：</p>
<p><img src="" alt=""></p>
<p>这个方法的逻辑也相对简单，先尝试从singletonObjects里面获取，如果获取不到再从earlySingletonObjects里面获取，如果再获取不到，再尝试从singletonFactories里面获取beanName对应的ObjectFactory，然后调用这个ObjectFactory的getObject来创建Bean，并放到earlySingletonObjects里面去，并且从singletonFacotories里面remove掉这个ObjectFactory。</p>
<h3 id="-ioc-bean-">六、IoC容器对Bean生命周期的管理</h3>
<p>Spring有一套Bean生命周期去管理Bean，值得注意的是，Spring只对非单例的Bean进行生命周期管理。关于Spring中Bean的生命周期，我们来看下一张老图：</p>
<p><img src="" alt=""></p>
<p>在上面这张图里面，我们看到有很多的生命周期方法，那么这些生命周期方法是在哪里调用的呢？在前面获取原型Bean的一节中，我们已经知道，Spring会先调用createBeanInstance方法来创建Bean实例，然后通过populateBean方法来设置Bean的属性，在调用这个方法之后，其实Spring还调用了一个initializeBean的方法，上图中我们看到的生命周期方法基本上都在这个方法里面调用：</p>
<p><img src="" alt=""></p>
<p>在这个方法里面：</p>
<ul>
<li>Spring首先调用了invokeAwareMethods来调用各个Aware方法，包括BeanNameAware，BeanClassLoaderAware和BeanFactoryAware</li>
<li>然后调用了所有BeanPostProcessor的postProcessBeforeInitialization方法</li>
<li>接着调用invokeInitMethods方法，里面包括调用afterPropertiesSet和自定义的init方法</li>
<li>最后调用了所有BeanPostProcessor的postProcessAfterInitialization方法</li>
</ul>
<p>在调用这些方法以后，我们的Bean才算是可以使用啦。至于生命周期的最后两个方法，是在容器销毁的时候来调用的。
]()<a href=""></a></p>
<p><a href=""></a></p>
<p><a href=""></a><a href="http://www.goldendoc.org/tag/beanfactory/" title="BeanFactory (1主题)">BeanFactory</a></p>
<p>*</p>
<ul>
<li><h3 id="-">分类</h3>
</li>
<li><p><a href="http://www.goldendoc.org/category/java-nio/" title="查看 Java NIO下的所有文章" target="_blank">Java NIO <strong>(9)</strong> Java NIO相关内容</a></p>
</li>
<li><a href="http://www.goldendoc.org/category/jms/" title="查看 JMS下的所有文章" target="_blank">JMS <strong>(3)</strong> Java Messaging Service</a></li>
<li><a href="http://www.goldendoc.org/category/juc/" title="查看 JUC下的所有文章" target="_blank">JUC <strong>(4)</strong></a></li>
<li><a href="http://www.goldendoc.org/category/jvm/" title="查看 JVM下的所有文章" target="_blank">JVM <strong>(8)</strong> Java Virtual Machine</a></li>
<li><a href="http://www.goldendoc.org/category/spring/" title="查看 Spring下的所有文章" target="_blank">Spring <strong>(4)</strong></a></li>
<li><a href="http://www.goldendoc.org/category/tomcat/" title="查看 Tomcat下的所有文章" target="_blank">Tomcat <strong>(7)</strong></a></li>
<li><a href="http://www.goldendoc.org/category/translation/" title="查看 翻译下的所有文章" target="_blank">翻译 <strong>(1)</strong></a></li>
<li><h3 id="-">最新评论</h3>
</li>
<li><p><a href="http://www.goldendoc.org/2012/01/optimization-barrier3/#comment-306" title="在 优化屏障（Optimization barrier）第三讲" target="_blank"><img src="" alt="熊猫家族">  熊猫家族 很详细，了解了很多 5个月前</a></p>
</li>
<li><a href="http://www.goldendoc.org/2011/06/juc_concurrenthashmap/#comment-304" title="在 Java并发编程之ConcurrentHashMap" target="_blank"><img src="" alt="聊聊并发（四）深入分析ConcurrentHashMap并发编程网 | 并发编程网">  聊聊并发（四）深入分析ConcurrentHashMap并发编程网 | 并发编程网 [...] Java并发编程之ConcurrentHashMap [...] 6个月前</a></li>
<li><a href="http://www.goldendoc.org/2011/06/juc_concurrenthashmap/#comment-301" title="在 Java并发编程之ConcurrentHashMap" target="_blank"><img src="" alt="Jun">  Jun for (HashEntry p = first; p != e; p = p.next) newFirst = new HashEntry(p.key, p.hash, […] 6个月前</a></li>
<li><a href="http://www.goldendoc.org/2011/06/juc_concurrenthashmap/#comment-294" title="在 Java并发编程之ConcurrentHashMap" target="_blank"><img src="" alt="khotyn">  khotyn 这里是我搞错了，已经纠正过来了，谢谢赵姐夫指正。 7个月前</a></li>
<li><a href="http://www.goldendoc.org/2011/06/juc_concurrenthashmap/#comment-293" title="在 Java并发编程之ConcurrentHashMap" target="_blank"><img src="" alt="老赵">  老赵 这里Segment的数量是不大于concurrentLevel的最大的2的指数 应该是“不小于concurrentLevel”的最小的2的指数吧。 7个月前</a>
<a href="&quot;显示下5个条目&quot;">显示更多</a></li>
<li><h3 id="-">最新文章</h3>
</li>
<li><p><a href="http://www.goldendoc.org/2013/01/parentdelegation/" title="从问题出发看双亲委派" target="_blank">从问题出发看双亲委派 (0)  同事A问了这样一个问题： <em>BootstrapClassLoader为什么能够加载用户自定义的类？</em> 当时我想到的是这样的场景： javaagent设置Boot-Class-Path，或者添加启动参数-Xbootclasspath、-Xbootclasspath/a […] 5个月前</a></p>
</li>
<li><a href="http://www.goldendoc.org/2012/07/somethings_i_ve_learnt_about_programming/" title="我学到的一些关于编程的事儿（翻译）" target="_blank">我学到的一些关于编程的事儿（翻译） (3) 原文地址：Some things I&#39;ve learnt about programming ---- By John Graham-Cumming 我已经从事编程 30 年了，用过的机器包括从现在看来很差的（基于 Z80 和 6502）到最新的，用过的语言包括 […] 11个月前</a></li>
<li><a href="http://www.goldendoc.org/2012/02/classloader-jvm/" title="ClassLoader与JVM" target="_blank">ClassLoader与JVM (0) <strong>一、ClassLoader与HotSpot</strong> 对JVM有所了解的人应该知道，类文件的格式是不能违背JVM规范的，而JVM自然会有解析类文件的工具ClassFileParser。 ClassFileParser由ClassFileStream/*构造，其实 […] 1年前</a></li>
<li><a href="http://www.goldendoc.org/2012/01/optimization-barrier3/" title="优化屏障（Optimization barrier）第三讲" target="_blank">优化屏障（Optimization barrier）第三讲 (1) 上一篇 优化屏障（Optimization barrier）第二讲 1. […] 1年前</a></li>
<li><a href="http://www.goldendoc.org/2012/01/optimization-barrier2/" title="优化屏障（Optimization barrier）第二讲" target="_blank">优化屏障（Optimization barrier）第二讲 (1) 上一篇 优化屏障（Optimization barrier）第一讲 1. gcc编译的大致过程 可以看到，gcc优化主要分两大部分:Tree优化和RTL(Register Transfer Language)优化； 前文所说的指令调度（Instruction […] 1年前</a>
<a href="&quot;显示下5个条目&quot;">显示更多</a></li>
<li><h3 id="-">友情链接</h3>
</li>
<li><p><a href="http://ifeve.com/" target="_blank">并发编程促进并发编程的研究和传播</a>
自豪地使用<a href="http://wordpress.org/" target="_blank">WordPress</a>，Mystique主题来自<a href="http://digitalnature.eu/" target="_blank">digitalnature</a> | <a href="http://www.goldendoc.org/feed/" target="_blank">RSS订阅</a>  <a href="">回到顶部</a></p>
</li>
</ul>
<p><a href=""> </a></p>
<p><a href=""> </a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/框架汇总/">框架汇总</a></li></span><span class="breadcrumb"><li><a href="/categories/框架汇总/">框架汇总</a></li><li><a href="/categories/框架汇总/Spring/">Spring</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Spring/" class="label label-primary">Spring</a><a href="/tags/框架汇总/" class="label label-success">框架汇总</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-框架汇总-Spring--Spring-设计模式-aop-ioc/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-框架汇总-Spring--Spring-设计模式-aop-ioc" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--使用ibatis操作数据库的封装/">使用ibatis操作数据库的封装</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--使用ibatis操作数据库的封装/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-ibatis-">使用ibatis操作数据库的封装</h1>
<p><strong><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="[置顶]使用ibatis操作数据库的封装" target="_blank">使用ibatis操作数据库的封装</a><em>**</em></strong></p>
<p>近期刚进入公司，也是本人的第一份正式工作，公司使用的ORM框架是ibatis，下面代码是对batis dao的一个封装，主要继承自spring的SqlMapClientDaoSupport，负责为单个Entity 提供CRUD操作的IBatis DAO基类，使用该基类，可以减少不少代码量。</p>
<p><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="copy to clipboard" target="_blank">copy to clipboard</a><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="print" target="_blank">print</a><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="?" target="_blank">?</a></p>
<ol>
<li><p>package com.nfschina.utils.dao.ibatis  </p>
</li>
<li></li>
<li><p>import java.io.Serializable;  </p>
</li>
<li><p>import java.sql.Connection;  </p>
</li>
<li><p>import java.sql.ResultSet;  </p>
</li>
<li><p>import java.sql.SQLException;  </p>
</li>
<li><p>import java.util.HashMap;  </p>
</li>
<li><p>import java.util.List;  </p>
</li>
<li><p>import java.util.Map;  </p>
</li>
<li></li>
<li><p>import org.apache.commons.beanutils.PropertyUtils;  </p>
</li>
<li><p>import org.apache.commons.lang.StringUtils;  </p>
</li>
<li><p>import org.springframework.util.Assert;  </p>
</li>
<li></li>
<li><p>import com.ibatis.sqlmap.engine.impl.SqlMapClientImpl;  </p>
</li>
<li><p>import com.ibatis.sqlmap.engine.mapping.sql.stat.StaticSql;  </p>
</li>
<li><p>import com.ibatis.sqlmap.engine.mapping.statement.MappedStatement;  </p>
</li>
<li></li>
<li><p>importcom.nfschina.utils.BaseException;  </p>
</li>
<li><p>import com.nfschina.utils.DataPage;  </p>
</li>
<li></li>
<li><p>import org.springframework.orm.ibatis.support.SqlMapClientDaoSupport  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* IBatis Dao的泛型基类. </p>
</li>
<li><p>/* 继承于Spring的SqlMapClientDaoSupport,提供分页函数和若干便捷查询方法，并对返回值作了泛型类型转换. </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>@SuppressWarnings(&quot;unchecked&quot;)  </p>
</li>
<li><p>public class IBatisGenericDao extends SqlMapClientDaoSupport {  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_INSERT = &quot;.insert&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_UPDATE = &quot;.update&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_DELETE = &quot;.delete&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_DELETE_PRIAMARYKEY = &quot;.deleteByPrimaryKey&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_SELECT = &quot;.select&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_SELECTMAP = &quot;.selectByMap&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_SELECTSQL = &quot;.selectBySql&quot;;  </p>
</li>
<li></li>
<li><p>public static final String POSTFIX_COUNT = &quot;.count&quot;;  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据ID获取对象 </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @throws BaseException </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> T get(Class<T> entityClass, Serializable id) throws BaseException, SQLException {  </p>
</li>
<li></li>
<li><p>T o = (T) getSqlMapClient().queryForObject(entityClass.getName() + POSTFIX_SELECT, id);  </p>
</li>
<li><p>if (o == null)  </p>
</li>
<li><p>throw new BaseException(BaseException.DATA_NOTFOUND, &quot;未找到实体: &quot; + id);  </p>
</li>
<li><p>return o;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 获取全部对象 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> List<T> getAll(Class<T> entityClass) throws SQLException {  </p>
</li>
<li><p>return getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECT, null);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 新增对象 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public void insert(Object o) throws SQLException {  </p>
</li>
<li><p>getSqlMapClient().insert(o.getClass().getName() + POSTFIX_INSERT, o);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 保存对象 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public int update(Object o) throws SQLException {  </p>
</li>
<li><p>return getSqlMapClient().update(o.getClass().getName() + POSTFIX_UPDATE, o);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 删除对象 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public int remove(Object o) throws SQLException {  </p>
</li>
<li><p>return getSqlMapClient().delete(o.getClass().getName() + POSTFIX_DELETE, o);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据ID删除对象 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> int removeById(Class<T> entityClass, Serializable id) throws SQLException {  </p>
</li>
<li><p>return getSqlMapClient().delete(entityClass.getName() + POSTFIX_DELETE_PRIAMARYKEY, id);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* map查询. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @param map </p>
</li>
<li><p>/*            包含各种属性的查询 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> List<T> find(Class<T> entityClass, Map<String, Object> map) throws SQLException {  </p>
</li>
<li><p>if (map == null)  </p>
</li>
<li><p>return this.getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECT, null);  </p>
</li>
<li><p>else {  </p>
</li>
<li><p>map.put(&quot;findBy&quot;, &quot;True&quot;);  </p>
</li>
<li><p>return this.getSqlMapClient()  </p>
</li>
<li><p>.queryForList(entityClass.getName() + POSTFIX_SELECTMAP, map);  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* sql 查询. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @param sql </p>
</li>
<li><p>/*            直接sql的语句(需要防止注入式攻击) </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> List<T> find(Class<T> entityClass, String sql) throws SQLException {  </p>
</li>
<li><p>Assert.hasText(sql);  </p>
</li>
<li><p>if (StringUtils.isEmpty(sql))  </p>
</li>
<li><p>return this.getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECT, null);  </p>
</li>
<li><p>else  </p>
</li>
<li><p>return this.getSqlMapClient()  </p>
</li>
<li><p>.queryForList(entityClass.getName() + POSTFIX_SELECTSQL, sql);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性名和属性值查询对象. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @return 符合条件的对象列表 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> List<T> findBy(Class<T> entityClass, String name, Object value) throws SQLException {  </p>
</li>
<li><p>Assert.hasText(name);  </p>
</li>
<li><p>Map<String, Object> map = new HashMap<String, Object>();  </p>
</li>
<li><p>map.put(name, value);  </p>
</li>
<li><p>return find(entityClass, map);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性名和属性值查询对象. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @return 符合条件的唯一对象 </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> T findUniqueBy(Class<T> entityClass, String name, Object value) {  </p>
</li>
<li><p>Assert.hasText(name);  </p>
</li>
<li><p>Map<String, Object> map = new HashMap<String, Object>();  </p>
</li>
<li><p>try {  </p>
</li>
<li><p>PropertyUtils.getProperty(entityClass.newInstance(), name);  </p>
</li>
<li><p>map.put(name, value);  </p>
</li>
<li><p>map.put(&quot;findUniqueBy&quot;, &quot;True&quot;);  </p>
</li>
<li><p>return (T) getSqlMapClient().queryForObject(entityClass.getName() + POSTFIX_SELECTMAP,  </p>
</li>
<li><p>map);  </p>
</li>
<li><p>} catch (Exception e) {  </p>
</li>
<li><p>logger.error(&quot;Error when propertie on entity,&quot; + e.getMessage(), e.getCause());  </p>
</li>
<li><p>return null;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性名和属性值以Like AnyWhere方式查询对象. </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public <T> List<T> findByLike(Class<T> entityClass, String name, String value) throws SQLException {  </p>
</li>
<li><p>Assert.hasText(name);  </p>
</li>
<li><p>Map<String, Object> map = new HashMap<String, Object>();  </p>
</li>
<li><p>map.put(name, value);  </p>
</li>
<li><p>map.put(&quot;findLikeBy&quot;, &quot;True&quot;);  </p>
</li>
<li><p>return getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECTMAP, map);  </p>
</li>
<li></li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 判断对象某些属性的值在数据库中不存在重复 </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @param tableName </p>
</li>
<li><p>/*            数据表名字 </p>
</li>
<li><p>/* @param names </p>
</li>
<li><p>/*            在POJO里不能重复的属性列表,以逗号分割 如&quot;name,loginid,password&quot; <br> </p>
</li>
<li><p>/*            FIXME how about in different schema? </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public boolean isNotUnique(Object entity, String tableName, String names) {  </p>
</li>
<li><p>try {  </p>
</li>
<li><p>String primarykey;  </p>
</li>
<li><p>Connection con = getSqlMapClient().getCurrentConnection();  </p>
</li>
<li><p>ResultSet dbMetaData = con.getMetaData().getPrimaryKeys(con.getCatalog(), null, tableName);  </p>
</li>
<li><p>dbMetaData.next();  </p>
</li>
<li><p>if (dbMetaData.getRow() &gt; 0) {  </p>
</li>
<li><p>primarykey = dbMetaData.getString(4);  </p>
</li>
<li><p>if (names.indexOf(primarykey) &gt; -1)  </p>
</li>
<li><p>return false;  </p>
</li>
<li><p>} else {  </p>
</li>
<li><p>return true;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>} catch (SQLException e) {  </p>
</li>
<li><p>logger.error(e.getMessage(), e);  </p>
</li>
<li><p>return false;  </p>
</li>
<li><p>}  </p>
</li>
<li><p>return false;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 分页查询函数，使用PaginatedList. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @param pageNo </p>
</li>
<li><p>/*            页号,从0开始. </p>
</li>
<li><p>/* @throws SQLException </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>@SuppressWarnings(&quot;rawtypes&quot;)  </p>
</li>
<li><p>public DataPage pagedQuery(String sqlName, HashMap<String, Object> hashMap, Integer pageNo, Integer pageSize)  </p>
</li>
<li><p>throws SQLException {  </p>
</li>
<li></li>
<li><p>if (pageNo == null || pageSize == null) {  </p>
</li>
<li><p>List list = getSqlMapClient().queryForList(sqlName, hashMap);  </p>
</li>
<li><p>if (list == null || list.size() == 0) {  </p>
</li>
<li><p>return new DataPage();  </p>
</li>
<li><p>} else {  </p>
</li>
<li><p>return new DataPage(0, list.size(), list.size(), list);  </p>
</li>
<li><p>}  </p>
</li>
<li><p>} else {  </p>
</li>
<li><p>Assert.hasText(sqlName);  </p>
</li>
<li><p>Assert.isTrue(pageNo &gt;= 1, &quot;pageNo should start from 1&quot;);  </p>
</li>
<li><p>// Count查询   </p>
</li>
<li><p>Integer totalCount = (Integer) getSqlMapClient().queryForObject(sqlName + &quot;.Count&quot;, hashMap);  </p>
</li>
<li></li>
<li><p>if (totalCount &lt; 1) {  </p>
</li>
<li><p>return new DataPage();  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>// 实际查询返回分页对象   </p>
</li>
<li><p>int startIndex = DataPage.getStartOfPage(pageNo, pageSize);  </p>
</li>
<li><p>hashMap.put(&quot;startIndex&quot;, startIndex);  </p>
</li>
<li><p>hashMap.put(&quot;pageSize&quot;, pageSize);  </p>
</li>
<li><p>List list = getSqlMapClient().queryForList(sqlName, hashMap);  </p>
</li>
<li></li>
<li><p>return new DataPage(startIndex, totalCount, pageSize, list);  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>public String getMappedSQL(String sqlName) {  </p>
</li>
<li><p>String sql = null;  </p>
</li>
<li></li>
<li><p>SqlMapClientImpl sqlmap = (SqlMapClientImpl) getSqlMapClient();  </p>
</li>
<li></li>
<li><p>MappedStatement stmt = sqlmap.getMappedStatement(sqlName);  </p>
</li>
<li><p>StaticSql staticSql = (StaticSql) stmt.getSql();  </p>
</li>
<li><p>sql = staticSql.getSql(null, null);  </p>
</li>
<li><p>return sql;  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}  </p>
</li>
</ol>
<p>package com.nfschina.utils.dao.ibatis import java.io.Serializable; import java.sql.Connection; import java.sql.ResultSet; import java.sql.SQLException; import java.util.HashMap; import java.util.List; import java.util.Map; import org.apache.commons.beanutils.PropertyUtils; import org.apache.commons.lang.StringUtils; import org.springframework.util.Assert; import com.ibatis.sqlmap.engine.impl.SqlMapClientImpl; import com.ibatis.sqlmap.engine.mapping.sql.stat.StaticSql; import com.ibatis.sqlmap.engine.mapping.statement.MappedStatement; importcom.nfschina.utils.BaseException; import com.nfschina.utils.DataPage; import org.springframework.orm.ibatis.support.SqlMapClientDaoSupport //<em>/</em> /<em> IBatis Dao的泛型基类. /</em> 继承于Spring的SqlMapClientDaoSupport,提供分页函数和若干便捷查询方法，并对返回值作了泛型类型转换. /<em>/ @SuppressWarnings(&quot;unchecked&quot;) public class IBatisGenericDao extends SqlMapClientDaoSupport { public static final String POSTFIX_INSERT = &quot;.insert&quot;; public static final String POSTFIX_UPDATE = &quot;.update&quot;; public static final String POSTFIX_DELETE = &quot;.delete&quot;; public static final String POSTFIX_DELETE_PRIAMARYKEY = &quot;.deleteByPrimaryKey&quot;; public static final String POSTFIX_SELECT = &quot;.select&quot;; public static final String POSTFIX_SELECTMAP = &quot;.selectByMap&quot;; public static final String POSTFIX_SELECTSQL = &quot;.selectBySql&quot;; public static final String POSTFIX_COUNT = &quot;.count&quot;; //</em>/<em> /</em> 根据ID获取对象 /<em> /</em> @throws BaseException /<em> @throws SQLException /</em>/ public <T> T get(Class<T> entityClass, Serializable id) throws BaseException, SQLException { T o = (T) getSqlMapClient().queryForObject(entityClass.getName() + POSTFIX_SELECT, id); if (o == null) throw new BaseException(BaseException.DATA_NOTFOUND, &quot;未找到实体: &quot; + id); return o; } //<em>/</em> /<em> 获取全部对象 /</em> @throws SQLException /<em>/ public <T> List<T> getAll(Class<T> entityClass) throws SQLException { return getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECT, null); } //</em>/<em> /</em> 新增对象 /<em> @throws SQLException /</em>/ public void insert(Object o) throws SQLException { getSqlMapClient().insert(o.getClass().getName() + POSTFIX_INSERT, o); } //<em>/</em> /<em> 保存对象 /</em> @throws SQLException /<em>/ public int update(Object o) throws SQLException { return getSqlMapClient().update(o.getClass().getName() + POSTFIX_UPDATE, o); } //</em>/<em> /</em> 删除对象 /<em> @throws SQLException /</em>/ public int remove(Object o) throws SQLException { return getSqlMapClient().delete(o.getClass().getName() + POSTFIX_DELETE, o); } //<em>/</em> /<em> 根据ID删除对象 /</em> @throws SQLException /<em>/ public <T> int removeById(Class<T> entityClass, Serializable id) throws SQLException { return getSqlMapClient().delete(entityClass.getName() + POSTFIX_DELETE_PRIAMARYKEY, id); } //</em>/<em> /</em> map查询. /<em> /</em> @param map /<em> 包含各种属性的查询 /</em> @throws SQLException /<em>/ public <T> List<T> find(Class<T> entityClass, Map<String, Object> map) throws SQLException { if (map == null) return this.getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECT, null); else { map.put(&quot;findBy&quot;, &quot;True&quot;); return this.getSqlMapClient() .queryForList(entityClass.getName() + POSTFIX_SELECTMAP, map); } } //</em>/<em> /</em> sql 查询. /<em> /</em> @param sql /<em> 直接sql的语句(需要防止注入式攻击) /</em> @throws SQLException /<em>/ public <T> List<T> find(Class<T> entityClass, String sql) throws SQLException { Assert.hasText(sql); if (StringUtils.isEmpty(sql)) return this.getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECT, null); else return this.getSqlMapClient() .queryForList(entityClass.getName() + POSTFIX_SELECTSQL, sql); } //</em>/<em> /</em> 根据属性名和属性值查询对象. /<em> /</em> @return 符合条件的对象列表 /<em> @throws SQLException /</em>/ public <T> List<T> findBy(Class<T> entityClass, String name, Object value) throws SQLException { Assert.hasText(name); Map<String, Object> map = new HashMap<String, Object>(); map.put(name, value); return find(entityClass, map); } //<em>/</em> /<em> 根据属性名和属性值查询对象. /</em> /<em> @return 符合条件的唯一对象 /</em>/ public <T> T findUniqueBy(Class<T> entityClass, String name, Object value) { Assert.hasText(name); Map<String, Object> map = new HashMap<String, Object>(); try { PropertyUtils.getProperty(entityClass.newInstance(), name); map.put(name, value); map.put(&quot;findUniqueBy&quot;, &quot;True&quot;); return (T) getSqlMapClient().queryForObject(entityClass.getName() + POSTFIX_SELECTMAP, map); } catch (Exception e) { logger.error(&quot;Error when propertie on entity,&quot; + e.getMessage(), e.getCause()); return null; } } //<em>/</em> /<em> 根据属性名和属性值以Like AnyWhere方式查询对象. /</em> @throws SQLException /<em>/ public <T> List<T> findByLike(Class<T> entityClass, String name, String value) throws SQLException { Assert.hasText(name); Map<String, Object> map = new HashMap<String, Object>(); map.put(name, value); map.put(&quot;findLikeBy&quot;, &quot;True&quot;); return getSqlMapClient().queryForList(entityClass.getName() + POSTFIX_SELECTMAP, map); } //</em>/<em> /</em> 判断对象某些属性的值在数据库中不存在重复 /<em> /</em> @param tableName /<em> 数据表名字 /</em> @param names /<em> 在POJO里不能重复的属性列表,以逗号分割 如&quot;name,loginid,password&quot; <br> /</em> FIXME how about in different schema? /<em>/ public boolean isNotUnique(Object entity, String tableName, String names) { try { String primarykey; Connection con = getSqlMapClient().getCurrentConnection(); ResultSet dbMetaData = con.getMetaData().getPrimaryKeys(con.getCatalog(), null, tableName); dbMetaData.next(); if (dbMetaData.getRow() &gt; 0) { primarykey = dbMetaData.getString(4); if (names.indexOf(primarykey) &gt; -1) return false; } else { return true; } } catch (SQLException e) { logger.error(e.getMessage(), e); return false; } return false; } //</em>/<em> /</em> 分页查询函数，使用PaginatedList. /<em> /</em> @param pageNo /<em> 页号,从0开始. /</em> @throws SQLException /*/ @SuppressWarnings(&quot;rawtypes&quot;) public DataPage pagedQuery(String sqlName, HashMap<String, Object> hashMap, Integer pageNo, Integer pageSize) throws SQLException { if (pageNo == null || pageSize == null) { List list = getSqlMapClient().queryForList(sqlName, hashMap); if (list == null || list.size() == 0) { return new DataPage(); } else { return new DataPage(0, list.size(), list.size(), list); } } else { Assert.hasText(sqlName); Assert.isTrue(pageNo &gt;= 1, &quot;pageNo should start from 1&quot;); // Count查询 Integer totalCount = (Integer) getSqlMapClient().queryForObject(sqlName + &quot;.Count&quot;, hashMap); if (totalCount &lt; 1) { return new DataPage(); } // 实际查询返回分页对象 int startIndex = DataPage.getStartOfPage(pageNo, pageSize); hashMap.put(&quot;startIndex&quot;, startIndex); hashMap.put(&quot;pageSize&quot;, pageSize); List list = getSqlMapClient().queryForList(sqlName, hashMap); return new DataPage(startIndex, totalCount, pageSize, list); } } public String getMappedSQL(String sqlName) { String sql = null; SqlMapClientImpl sqlmap = (SqlMapClientImpl) getSqlMapClient(); MappedStatement stmt = sqlmap.getMappedStatement(sqlName); StaticSql staticSql = (StaticSql) stmt.getSql(); sql = staticSql.getSql(null, null); return sql; } }</p>
<p><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="copy to clipboard" target="_blank">copy to clipboard</a><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="print" target="_blank">print</a><a href="http://blog.csdn.net/boaifeng/article/details/5966940" title="?" target="_blank">?</a></p>
<ol>
<li><p>package com.nfschina.utils.dao.ibatis;  </p>
</li>
<li></li>
<li><p>import java.io.Serializable;  </p>
</li>
<li><p>import java.lang.reflect.InvocationTargetException;  </p>
</li>
<li><p>import java.sql.SQLException;  </p>
</li>
<li><p>import java.util.List;  </p>
</li>
<li><p>import java.util.Map;  </p>
</li>
<li></li>
<li><p>import org.apache.commons.beanutils.PropertyUtils;  </p>
</li>
<li><p>import org.apache.commons.lang.StringUtils;  </p>
</li>
<li><p>import org.springframework.orm.ObjectRetrievalFailureException;  </p>
</li>
<li></li>
<li><p>import com.nfschina.utils.BaseException;  </p>
</li>
<li><p>import com.nfschina.utils.GenericsUtils;  </p>
</li>
<li></li>
<li><p>import   </p>
</li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 负责为单个Entity 提供CRUD操作的IBatis DAO基类. </p>
</li>
<li><p>/* <p/> </p>
</li>
<li><p>/* 子类只要在类定义时指定所管理Entity的Class, 即拥有对单个Entity对象的CRUD操作. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* <pre> </p>
</li>
<li><p>/* public class UserManagerIbatis extends IBatisEntityDao<User> { </p>
</li>
<li><p>/* } </p>
</li>
<li><p>/* </pre> </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public class IBatisEntityDao<T> extends IBatisGenericDao {  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* DAO所管理的Entity类型. </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>protected Class<T> entityClass;  </p>
</li>
<li></li>
<li><p>protected String primaryKeyName;  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 在构造函数中将泛型T.class赋给entityClass. </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>@SuppressWarnings(&quot;unchecked&quot;)  </p>
</li>
<li><p>public IBatisEntityDao() {  </p>
</li>
<li><p>entityClass = (Class<T>) GenericsUtils.getSuperClassGenricType(getClass());  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性名和属性值查询对象. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @return 符合条件的对象列表 </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public List<T> findBy(String name, Object value) throws SQLException {  </p>
</li>
<li><p>return findBy(getEntityClass(), name, value);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性的名值对查询对象 </p>
</li>
<li><p>/* @param map </p>
</li>
<li><p>/* @return </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public List<T> find(Map<String, Object> map) throws SQLException{  </p>
</li>
<li><p>return find(getEntityClass(), map);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性的名值对查询唯一对象 </p>
</li>
<li><p>/* @param map </p>
</li>
<li><p>/* @return </p>
</li>
<li><p>/* @throws SQLException </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public T findUniqueByMap(Map<String, Object> map) throws SQLException{  </p>
</li>
<li><p>List<T> list = find(getEntityClass(), map);  </p>
</li>
<li><p>if(list == null || list.size() &lt;= 0){  </p>
</li>
<li><p>return null;  </p>
</li>
<li><p>}   </p>
</li>
<li><p>return list.get(0);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性名和属性值以Like AnyWhere方式查询对象. </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public List<T> findByLike(String name, String value) throws SQLException {  </p>
</li>
<li><p>return findByLike(getEntityClass(), name, value);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据属性名和属性值查询单个对象. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @return 符合条件的唯一对象 </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public T findUniqueBy(String name, Object value) {  </p>
</li>
<li><p>return findUniqueBy(getEntityClass(), name, value);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据ID获取对象. </p>
</li>
<li><p>/*  </p>
</li>
<li><p>/* @throws BaseException </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public T get(Serializable id) throws BaseException, SQLException {  </p>
</li>
<li><p>return get(getEntityClass(), id);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 获取全部对象. </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public List<T> getAll() throws SQLException {  </p>
</li>
<li><p>return getAll(getEntityClass());  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 取得entityClass. </p>
</li>
<li><p>/* <p/> </p>
</li>
<li><p>/* JDK1.4不支持泛型的子类可以抛开Class<T> entityClass,重载此函数达到相同效果。 </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>protected Class<T> getEntityClass() {  </p>
</li>
<li><p>return entityClass;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>public String getPrimaryKeyName() {  </p>
</li>
<li><p>if (StringUtils.isEmpty(primaryKeyName))  </p>
</li>
<li><p>primaryKeyName = &quot;id&quot;;  </p>
</li>
<li><p>return primaryKeyName;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>protected Object getPrimaryKeyValue(Object o) throws NoSuchMethodException, IllegalAccessException,  </p>
</li>
<li><p>InvocationTargetException, InstantiationException {  </p>
</li>
<li><p>return PropertyUtils.getProperty(entityClass.newInstance(), getPrimaryKeyName());  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 根据ID移除对象. </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public int removeById(Serializable id) throws SQLException {  </p>
</li>
<li><p>return removeById(getEntityClass(), id);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>//<em>/</em> </p>
</li>
<li><p>/* 保存对象. 为了实现IEntityDao 我在内部使用了insert和upate 2个方法. </p>
</li>
<li><p>/* @throws SQLException  </p>
</li>
<li><p>/*/  </p>
</li>
<li><p>public void saveOrUpdate(Object o) throws SQLException {  </p>
</li>
<li><p>Object primaryKey;  </p>
</li>
<li><p>try {  </p>
</li>
<li><p>primaryKey = getPrimaryKeyValue(o);  </p>
</li>
<li><p>} catch (Exception e) {  </p>
</li>
<li><p>throw new ObjectRetrievalFailureException(entityClass, e);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>if (primaryKey == null)  </p>
</li>
<li><p>insert(o);  </p>
</li>
<li><p>else  </p>
</li>
<li><p>update(o);  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>public void setPrimaryKeyName(String primaryKeyName) {  </p>
</li>
<li><p>this.primaryKeyName = primaryKeyName;  </p>
</li>
<li><p>}  </p>
</li>
<li></li>
<li><p>public String getIdName(Class&lt;?&gt; clazz) {  </p>
</li>
<li><p>return &quot;id&quot;;  </p>
</li>
<li><p>}  </p>
</li>
<li><p>}  </p>
</li>
</ol>
<p>package com.nfschina.utils.dao.ibatis; import java.io.Serializable; import java.lang.reflect.InvocationTargetException; import java.sql.SQLException; import java.util.List; import java.util.Map; import org.apache.commons.beanutils.PropertyUtils; import org.apache.commons.lang.StringUtils; import org.springframework.orm.ObjectRetrievalFailureException; import com.nfschina.utils.BaseException; import com.nfschina.utils.GenericsUtils; import //<em>/</em> /<em> 负责为单个Entity 提供CRUD操作的IBatis DAO基类. /</em> <p/> /<em> 子类只要在类定义时指定所管理Entity的Class, 即拥有对单个Entity对象的CRUD操作. /</em> /<em> <pre> /</em> public class UserManagerIbatis extends IBatisEntityDao<User> { /<em> } /</em> </pre> /<em>/ public class IBatisEntityDao<T> extends IBatisGenericDao { //</em>/<em> /</em> DAO所管理的Entity类型. /<em>/ protected Class<T> entityClass; protected String primaryKeyName; //</em>/<em> /</em> 在构造函数中将泛型T.class赋给entityClass. /<em>/ @SuppressWarnings(&quot;unchecked&quot;) public IBatisEntityDao() { entityClass = (Class<T>) GenericsUtils.getSuperClassGenricType(getClass()); } //</em>/<em> /</em> 根据属性名和属性值查询对象. /<em> /</em> @return 符合条件的对象列表 /<em> @throws SQLException /</em>/ public List<T> findBy(String name, Object value) throws SQLException { return findBy(getEntityClass(), name, value); } //<em>/</em> /<em> 根据属性的名值对查询对象 /</em> @param map /<em> @return /</em> @throws SQLException /<em>/ public List<T> find(Map<String, Object> map) throws SQLException{ return find(getEntityClass(), map); } //</em>/<em> /</em> 根据属性的名值对查询唯一对象 /<em> @param map /</em> @return /<em> @throws SQLException /</em>/ public T findUniqueByMap(Map<String, Object> map) throws SQLException{ List<T> list = find(getEntityClass(), map); if(list == null || list.size() &lt;= 0){ return null; } return list.get(0); } //<em>/</em> /<em> 根据属性名和属性值以Like AnyWhere方式查询对象. /</em> @throws SQLException /<em>/ public List<T> findByLike(String name, String value) throws SQLException { return findByLike(getEntityClass(), name, value); } //</em>/<em> /</em> 根据属性名和属性值查询单个对象. /<em> /</em> @return 符合条件的唯一对象 /<em>/ public T findUniqueBy(String name, Object value) { return findUniqueBy(getEntityClass(), name, value); } //</em>/<em> /</em> 根据ID获取对象. /<em> /</em> @throws BaseException /<em> @throws SQLException /</em>/ public T get(Serializable id) throws BaseException, SQLException { return get(getEntityClass(), id); } //<em>/</em> /<em> 获取全部对象. /</em> @throws SQLException /<em>/ public List<T> getAll() throws SQLException { return getAll(getEntityClass()); } //</em>/<em> /</em> 取得entityClass. /<em> <p/> /</em> JDK1.4不支持泛型的子类可以抛开Class<T> entityClass,重载此函数达到相同效果。 /<em>/ protected Class<T> getEntityClass() { return entityClass; } public String getPrimaryKeyName() { if (StringUtils.isEmpty(primaryKeyName)) primaryKeyName = &quot;id&quot;; return primaryKeyName; } protected Object getPrimaryKeyValue(Object o) throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException { return PropertyUtils.getProperty(entityClass.newInstance(), getPrimaryKeyName()); } //</em>/<em> /</em> 根据ID移除对象. /<em> @throws SQLException /</em>/ public int removeById(Serializable id) throws SQLException { return removeById(getEntityClass(), id); } //<em>/</em> /<em> 保存对象. 为了实现IEntityDao 我在内部使用了insert和upate 2个方法. /</em> @throws SQLException /*/ public void saveOrUpdate(Object o) throws SQLException { Object primaryKey; try { primaryKey = getPrimaryKeyValue(o); } catch (Exception e) { throw new ObjectRetrievalFailureException(entityClass, e); } if (primaryKey == null) insert(o); else update(o); } public void setPrimaryKeyName(String primaryKeyName) { this.primaryKeyName = primaryKeyName; } public String getIdName(Class&lt;?&gt; clazz) { return &quot;id&quot;; } }</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/框架汇总/">框架汇总</a></li></span><span class="breadcrumb"><li><a href="/categories/框架汇总/">框架汇总</a></li><li><a href="/categories/框架汇总/ORM/">ORM</a></li><li><a href="/categories/框架汇总/ORM/ibatis/">ibatis</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ORM/" class="label label-primary">ORM</a><a href="/tags/ibatis/" class="label label-success">ibatis</a><a href="/tags/框架汇总/" class="label label-info">框架汇总</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--使用ibatis操作数据库的封装/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-框架汇总-ORM-ibatis--使用ibatis操作数据库的封装" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/145/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/143/">143</a></li><li><a class="page-number" href="/page/144/">144</a></li><li><a class="page-number" href="/page/145/">145</a></li><li class="active"><li><span class="page-number current">146</span></li><li><a class="page-number" href="/page/147/">147</a></li><li><a class="page-number" href="/page/148/">148</a></li><li><a class="page-number" href="/page/149/">149</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/147/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 17:26:53</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
