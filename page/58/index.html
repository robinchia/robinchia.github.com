
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 58 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-SQL_Java--SQL解析Jsqlparser/">SQL解析(Jsqlparser)</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-SQL_Java--SQL解析Jsqlparser/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="sql-jsqlparser-">SQL解析(Jsqlparser)</h1>
<p>前段时间主要研究了一下SQL语句的解析，主要的几个开源产品试用了一下。本文大概总结一下个人体会。
首先是ZQL，ZQL有个比较突出的优点是使用起来比较简单，基本上属于拿上手就可以用的。但支持的功能有限，selectItem可以是简单的表达式，但不支持查询作为一个selectItem，对于其他的子查询同样也不支持。
最终我选择使用了Jsqlparser，主要原因有两点：
1）功能强大，基本上能够覆盖所有的SQL语法（没有研究是不是包含了数据库特殊的关键字，如LIMIT ），包含UNION,GROUP BY,HAVING,ORDER BY,JOIN,SUB JOIN,SUB SELECT,FUNCTION等。支持SQL深层嵌套。
2）本身设计不错，使用起来感觉很灵活。Jsqlparser对于SQL的遍历采用了VISITOR模式可以很方便的遍历SQL语句。
下面主要介绍一下Jsqlparser在我的项目中的应用情况。
背景：通过SQL语句的解析，从而增强SQL语句增加特定的查询过滤条件（如：状态过滤、权限过滤等）
1）解析SQL
2）根据SQL中涉及的表增强SQL
3）重新生成ORACLE数据库的SQL
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>CCJSqlParserManager parserManager = new CCJSqlParserManager();  </li>
<li>try {  </li>
<li>Select select = (Select) parserManager.parse(new StringReader(sql)); //解析SQL语句  </li>
<li>SelectBody body = select.getSelectBody();   </li>
<li>VisitContext vc = new VisitContext(filterContext, params);  </li>
<li>vc.setTableFilterFactory(tableFilterFactory);//表的字段过滤  </li>
<li>body.accept(new SelectVisitorImpl(vc)); //访问SQL并根据SQL中涉及的表来增强SQL  </li>
<li>ExpressionDeParser expressionDeParser = new ExpressionDeParser();  </li>
<li>StringBuffer stringBuffer = new StringBuffer();  </li>
<li>SelectDeParser deParser = new OracleSelectDeParser(expressionDeParser, stringBuffer); //针对ORACLE的SQL生成  </li>
<li>expressionDeParser.setSelectVisitor(deParser);  </li>
<li>expressionDeParser.setBuffer(stringBuffer);  </li>
<li></li>
<li>body.accept(deParser);  </li>
<li>return new FilterResult(deParser.getBuffer().toString(), vc.getResultSqlParams());  </li>
<li>} catch (JSQLParserException e) {  </li>
<li>throw new FilterException(e);  </li>
<li><p>}  </p>
<pre><code> CCJSqlParserManager parserManager = new CCJSqlParserManager();

 try {
     Select select = (Select) parserManager.parse(new StringReader(sql)); //解析SQL语句

     SelectBody body = select.getSelectBody();
     VisitContext vc = new VisitContext(filterContext, params);

     vc.setTableFilterFactory(tableFilterFactory);//表的字段过滤
     body.accept(new SelectVisitorImpl(vc)); //访问SQL并根据SQL中涉及的表来增强SQL

     ExpressionDeParser expressionDeParser = new ExpressionDeParser();
     StringBuffer stringBuffer = new StringBuffer();

     SelectDeParser deParser = new OracleSelectDeParser(expressionDeParser, stringBuffer); //针对ORACLE的SQL生成
     expressionDeParser.setSelectVisitor(deParser);

     expressionDeParser.setBuffer(stringBuffer);
</code></pre></li>
</ol>
<pre><code>        body.accept(deParser);
        return new FilterResult(deParser.getBuffer().toString(), vc.getResultSqlParams());

    } catch (JSQLParserException e) {
        throw new FilterException(e);

    }
</code></pre><p>接下去是各个VISITOR，用来访问解析后的SQL
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>public class SelectVisitorImpl extends AbstractVisitor implements SelectVisitor {  </li>
<li></li>
<li>public SelectVisitorImpl(VisitContext ctx) {  </li>
<li>super(ctx);  </li>
<li>}  </li>
<li></li>
<li>@SuppressWarnings(&quot;unchecked&quot;)  </li>
<li>public void visit(PlainSelect ps) {  </li>
<li>//SELECT ITEM访问  </li>
<li>List<SelectItem> selectItems = ps.getSelectItems();  </li>
<li>for (SelectItem item : selectItems) {  </li>
<li>item.accept(new SelectItemVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li></li>
<li>//FROM访问  </li>
<li>FromItem from = ps.getFromItem();  </li>
<li>FromItemVisitorImpl fv = new FromItemVisitorImpl(context);  </li>
<li>from.accept(fv);  </li>
<li></li>
<li>//查询条件访问  </li>
<li>if (ps.getWhere() != null) {  </li>
<li>ps.getWhere().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li></li>
<li>//过滤增强的条件  </li>
<li>if (fv.getEnhancedCondition() != null) {  </li>
<li>if (ps.getWhere() != null) {  </li>
<li>Expression expr = new Parenthesis(ps.getWhere());  </li>
<li>AndExpression and = new AndExpression(fv.getEnhancedCondition(), expr);  </li>
<li>ps.setWhere(and);  </li>
<li>} else {  </li>
<li>ps.setWhere(fv.getEnhancedCondition());  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>//JOIN表的访问  </li>
<li>List<Join> joins = ps.getJoins();  </li>
<li>if (CollectionUtil.isNotEmpty(joins)) {  </li>
<li>for (Join join : joins) {  </li>
<li>FromItemVisitorImpl tempfv = new FromItemVisitorImpl(context);  </li>
<li>join.getRightItem().accept(tempfv);  </li>
<li>if (join.getOnExpression() != null) {  </li>
<li>join.getOnExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>if (tempfv.getEnhancedCondition() != null) {  </li>
<li>Expression expr = new Parenthesis(join.getOnExpression());  </li>
<li>AndExpression and = new AndExpression(tempfv.getEnhancedCondition(), expr);  </li>
<li>join.setOnExpression(and);  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>//ORDER BY 访问  </li>
<li>List<OrderByElement> elements = ps.getOrderByElements();  </li>
<li>if (CollectionUtil.isNotEmpty(elements)) {  </li>
<li>for (OrderByElement e : elements) {  </li>
<li>e.getExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>//GROUP BY的HAVING访问  </li>
<li>if (ps.getHaving() != null) {  </li>
<li>ps.getHaving().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>@SuppressWarnings(&quot;unchecked&quot;)  </li>
<li>public void visit(Union un) {  </li>
<li>List<PlainSelect> selects = un.getPlainSelects();  </li>
<li>for (PlainSelect select : selects) {  </li>
<li>select.accept(new SelectVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li>List<OrderByElement> elements = un.getOrderByElements();  </li>
<li>if (CollectionUtil.isNotEmpty(elements)) {  </li>
<li>for (OrderByElement e : elements) {  </li>
<li>e.getExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>}  </li>
</ol>
<p>public class SelectVisitorImpl extends AbstractVisitor implements SelectVisitor {</p>
<pre><code>public SelectVisitorImpl(VisitContext ctx) {

    super(ctx);
}


@SuppressWarnings(&quot;unchecked&quot;)

public void visit(PlainSelect ps) {
    //SELECT ITEM访问

    List&lt;SelectItem&gt; selectItems = ps.getSelectItems();
    for (SelectItem item : selectItems) {

        item.accept(new SelectItemVisitorImpl(this.getContext()));
    }


    //FROM访问

    FromItem from = ps.getFromItem();
    FromItemVisitorImpl fv = new FromItemVisitorImpl(context);

    from.accept(fv);


    //查询条件访问
    if (ps.getWhere() != null) {

        ps.getWhere().accept(new ExpressionVisitorImpl(this.getContext()));
    }


    //过滤增强的条件

    if (fv.getEnhancedCondition() != null) {
        if (ps.getWhere() != null) {

            Expression expr = new Parenthesis(ps.getWhere());
            AndExpression and = new AndExpression(fv.getEnhancedCondition(), expr);

            ps.setWhere(and);
        } else {

            ps.setWhere(fv.getEnhancedCondition());
        }

    }


    //JOIN表的访问
    List&lt;Join&gt; joins = ps.getJoins();

    if (CollectionUtil.isNotEmpty(joins)) {
        for (Join join : joins) {

            FromItemVisitorImpl tempfv = new FromItemVisitorImpl(context);
            join.getRightItem().accept(tempfv);

            if (join.getOnExpression() != null) {
                join.getOnExpression().accept(new ExpressionVisitorImpl(this.getContext()));

                if (tempfv.getEnhancedCondition() != null) {
                    Expression expr = new Parenthesis(join.getOnExpression());

                    AndExpression and = new AndExpression(tempfv.getEnhancedCondition(), expr);
                    join.setOnExpression(and);

                }
            }

        }
    }


    //ORDER BY 访问

    List&lt;OrderByElement&gt; elements = ps.getOrderByElements();
    if (CollectionUtil.isNotEmpty(elements)) {

        for (OrderByElement e : elements) {
            e.getExpression().accept(new ExpressionVisitorImpl(this.getContext()));

        }
    }


    //GROUP BY的HAVING访问

    if (ps.getHaving() != null) {
        ps.getHaving().accept(new ExpressionVisitorImpl(this.getContext()));

    }
}


@SuppressWarnings(&quot;unchecked&quot;)

public void visit(Union un) {
    List&lt;PlainSelect&gt; selects = un.getPlainSelects();

    for (PlainSelect select : selects) {
        select.accept(new SelectVisitorImpl(this.getContext()));

    }
    List&lt;OrderByElement&gt; elements = un.getOrderByElements();

    if (CollectionUtil.isNotEmpty(elements)) {
        for (OrderByElement e : elements) {

            e.getExpression().accept(new ExpressionVisitorImpl(this.getContext()));
        }

    }
}
</code></pre><p>}
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>public class SelectItemVisitorImpl extends AbstractVisitor implements SelectItemVisitor {  </li>
<li></li>
<li>public SelectItemVisitorImpl(VisitContext ctx) {  </li>
<li>super(ctx);  </li>
<li>}  </li>
<li></li>
<li>public void visit(AllColumns ac) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(AllTableColumns atc) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(SelectExpressionItem sei) {  </li>
<li>sei.getExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li></li>
<li>}  </li>
</ol>
<p>public class SelectItemVisitorImpl extends AbstractVisitor implements SelectItemVisitor {</p>
<pre><code>public SelectItemVisitorImpl(VisitContext ctx) {

    super(ctx);
}


public void visit(AllColumns ac) {

}


public void visit(AllTableColumns atc) {
}


public void visit(SelectExpressionItem sei) {

    sei.getExpression().accept(new ExpressionVisitorImpl(this.getContext()));
}
</code></pre><p>}
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>public class ItemsListVisitorImpl extends AbstractVisitor implements ItemsListVisitor {  </li>
<li></li>
<li>public ItemsListVisitorImpl(VisitContext ctx) {  </li>
<li>super(ctx);  </li>
<li>}  </li>
<li></li>
<li>public void visit(SubSelect ss) {  </li>
<li>ss.getSelectBody().accept(new SelectVisitorImpl(context));  </li>
<li>}  </li>
<li></li>
<li>@SuppressWarnings(&quot;unchecked&quot;)  </li>
<li>public void visit(ExpressionList el) {  </li>
<li>List<Expression> list = el.getExpressions();  </li>
<li>if (CollectionUtil.isNotEmpty(list)) {  </li>
<li>for (Expression expr : list) {  </li>
<li>expr.accept(new ExpressionVisitorImpl(context));  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>}  </li>
</ol>
<p>public class ItemsListVisitorImpl extends AbstractVisitor implements ItemsListVisitor {</p>
<pre><code>public ItemsListVisitorImpl(VisitContext ctx) {

    super(ctx);
}


public void visit(SubSelect ss) {

    ss.getSelectBody().accept(new SelectVisitorImpl(context));
}


@SuppressWarnings(&quot;unchecked&quot;)

public void visit(ExpressionList el) {
    List&lt;Expression&gt; list = el.getExpressions();

    if (CollectionUtil.isNotEmpty(list)) {
        for (Expression expr : list) {

            expr.accept(new ExpressionVisitorImpl(context));
        }

    }
}
</code></pre><p>}
如果FROM的内容是table的话，则根据table的增强配置对SQL增强
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>public class FromItemVisitorImpl extends AbstractVisitor implements FromItemVisitor {  </li>
<li>private String varPattern = &quot;@\{\s/<em>?(\w+)\s/</em>?\}&quot;;  </li>
<li>private Expression enhancedCondition;  </li>
<li></li>
<li>public FromItemVisitorImpl(VisitContext ctx) {  </li>
<li>super(ctx);  </li>
<li>}  </li>
<li></li>
<li>public void visit(Table table) {  </li>
<li>Set<FieldFilter> filters = context.getTableFilterFactory().getTableFilter(table.getName());  </li>
<li>if (filters == null) {  </li>
<li>filters = Collections.emptySet();  </li>
<li>}  </li>
<li>for (FieldFilter ff : filters) {  </li>
<li>Column c = new Column(new Table(null, table.getAlias()), ff.getFieldName());  </li>
<li>JdbcParameter param = new JdbcParameter();  </li>
<li>Object fieldValue = getRawValue(ff.getFieldValue(), this.context.getFilterContext());  </li>
<li>Expression[] exps;  </li>
<li>if (&quot;between&quot;.equalsIgnoreCase(ff.getOperator()) || &quot;not between&quot;.equalsIgnoreCase(ff.getOperator())) {  </li>
<li>Object[] objs = (Object[]) fieldValue;  </li>
<li>this.getContext().getResultSqlParams().add(objs[0]);  </li>
<li>this.getContext().getResultSqlParams().add(objs[1]);  </li>
<li>exps = new Expression[] { c, param, param };  </li>
<li>} else if (&quot;is null&quot;.equalsIgnoreCase(ff.getOperator()) || &quot;is not null&quot;.equalsIgnoreCase(ff.getOperator())) {  </li>
<li>exps = new Expression[] { c };  </li>
<li>} else {  </li>
<li>this.getContext().getResultSqlParams().add(fieldValue);  </li>
<li>exps = new Expression[] { c, param };  </li>
<li>}  </li>
<li>Expression operator = this.getOperator(ff.getOperator(), exps);  </li>
<li>if (this.enhancedCondition != null) {  </li>
<li>enhancedCondition = new AndExpression(enhancedCondition, operator);  </li>
<li>} else {  </li>
<li>enhancedCondition = operator;  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>public void visit(SubSelect ss) {  </li>
<li>ss.getSelectBody().accept(new SelectVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li></li>
<li>public void visit(SubJoin sj) {  </li>
<li>Join join = sj.getJoin();  </li>
<li>join.getRightItem().accept(new FromItemVisitorImpl(this.getContext()));  </li>
<li>join.getOnExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li></li>
<li>private Expression getOperator(String op, Expression[] exp) {  </li>
<li>if (&quot;=&quot;.equals(op)) {  </li>
<li>EqualsTo eq = new EqualsTo();  </li>
<li>eq.setLeftExpression(exp[0]);  </li>
<li>eq.setRightExpression(exp[1]);  </li>
<li>return eq;  </li>
<li>} else if (&quot;&gt;&quot;.equals(op)) {  </li>
<li>GreaterThan gt = new GreaterThan();  </li>
<li>gt.setLeftExpression(exp[0]);  </li>
<li>gt.setRightExpression(exp[1]);  </li>
<li>return gt;  </li>
<li>} else if (&quot;&gt;=&quot;.equals(op)) {  </li>
<li>GreaterThanEquals geq = new GreaterThanEquals();  </li>
<li>geq.setLeftExpression(exp[0]);  </li>
<li>geq.setRightExpression(exp[1]);  </li>
<li>return geq;  </li>
<li>} else if (&quot;&lt;&quot;.equals(op)) {  </li>
<li>MinorThan mt = new MinorThan();  </li>
<li>mt.setLeftExpression(exp[0]);  </li>
<li>mt.setRightExpression(exp[1]);  </li>
<li>return mt;  </li>
<li>} else if (&quot;&lt;=&quot;.equals(op)) {  </li>
<li>MinorThanEquals leq = new MinorThanEquals();  </li>
<li>leq.setLeftExpression(exp[0]);  </li>
<li>leq.setRightExpression(exp[1]);  </li>
<li>return leq;  </li>
<li>} else if (&quot;&lt;&gt;&quot;.equals(op)) {  </li>
<li>NotEqualsTo neq = new NotEqualsTo();  </li>
<li>neq.setLeftExpression(exp[0]);  </li>
<li>neq.setRightExpression(exp[1]);  </li>
<li>return neq;  </li>
<li>} else if (&quot;is null&quot;.equalsIgnoreCase(op)) {  </li>
<li>IsNullExpression isNull = new IsNullExpression();  </li>
<li>isNull.setNot(false);  </li>
<li>isNull.setLeftExpression(exp[0]);  </li>
<li>return isNull;  </li>
<li>} else if (&quot;is not null&quot;.equalsIgnoreCase(op)) {  </li>
<li>IsNullExpression isNull = new IsNullExpression();  </li>
<li>isNull.setNot(true);  </li>
<li>isNull.setLeftExpression(exp[0]);  </li>
<li>return isNull;  </li>
<li>} else if (&quot;like&quot;.equalsIgnoreCase(op)) {  </li>
<li>LikeExpression like = new LikeExpression();  </li>
<li>like.setNot(false);  </li>
<li>like.setLeftExpression(exp[0]);  </li>
<li>like.setRightExpression(exp[1]);  </li>
<li>return like;  </li>
<li>} else if (&quot;not like&quot;.equalsIgnoreCase(op)) {  </li>
<li>LikeExpression nlike = new LikeExpression();  </li>
<li>nlike.setNot(true);  </li>
<li>nlike.setLeftExpression(exp[0]);  </li>
<li>nlike.setRightExpression(exp[1]);  </li>
<li>return nlike;  </li>
<li>} else if (&quot;between&quot;.equalsIgnoreCase(op)) {  </li>
<li>Between bt = new Between();  </li>
<li>bt.setNot(false);  </li>
<li>bt.setLeftExpression(exp[0]);  </li>
<li>bt.setBetweenExpressionStart(exp[1]);  </li>
<li>bt.setBetweenExpressionEnd(exp[2]);  </li>
<li>return bt;  </li>
<li>} else if (&quot;not between&quot;.equalsIgnoreCase(op)) {  </li>
<li>Between bt = new Between();  </li>
<li>bt.setNot(true);  </li>
<li>bt.setLeftExpression(exp[0]);  </li>
<li>bt.setBetweenExpressionStart(exp[1]);  </li>
<li>bt.setBetweenExpressionEnd(exp[2]);  </li>
<li>return bt;  </li>
<li>}  </li>
<li>throw new FilterException(&quot;Unknown operator:&quot; + op);  </li>
<li>}  </li>
<li></li>
<li>protected Object getRawValue(Object value, Map<String, Object> context) {  </li>
<li>if (context == null) {  </li>
<li>return value;  </li>
<li>}  </li>
<li>if (value instanceof String) {  </li>
<li>String v = (String) value;  </li>
<li>Pattern pattern = Pattern.compile(varPattern);  </li>
<li>Matcher matcher = pattern.matcher(v);  </li>
<li>if (matcher.find()) {  </li>
<li>return context.get(matcher.group(1));  </li>
<li>}  </li>
<li>}  </li>
<li>return value;  </li>
<li>}  </li>
<li></li>
<li>public Expression getEnhancedCondition() {  </li>
<li>return enhancedCondition;  </li>
<li>}  </li>
<li></li>
<li>}  </li>
</ol>
<p>public class FromItemVisitorImpl extends AbstractVisitor implements FromItemVisitor {</p>
<pre><code>private String varPattern = &quot;@\\{\\s/*?(\\w+)\\s/*?\\}&quot;;
private Expression enhancedCondition;


public FromItemVisitorImpl(VisitContext ctx) {

    super(ctx);
}


public void visit(Table table) {

    Set&lt;FieldFilter&gt; filters = context.getTableFilterFactory().getTableFilter(table.getName());
    if (filters == null) {

        filters = Collections.emptySet();
    }

    for (FieldFilter ff : filters) {
        Column c = new Column(new Table(null, table.getAlias()), ff.getFieldName());

        JdbcParameter param = new JdbcParameter();
        Object fieldValue = getRawValue(ff.getFieldValue(), this.context.getFilterContext());

        Expression[] exps;
        if (&quot;between&quot;.equalsIgnoreCase(ff.getOperator()) || &quot;not between&quot;.equalsIgnoreCase(ff.getOperator())) {

            Object[] objs = (Object[]) fieldValue;
            this.getContext().getResultSqlParams().add(objs[0]);

            this.getContext().getResultSqlParams().add(objs[1]);
            exps = new Expression[] { c, param, param };

        } else if (&quot;is null&quot;.equalsIgnoreCase(ff.getOperator()) || &quot;is not null&quot;.equalsIgnoreCase(ff.getOperator())) {
            exps = new Expression[] { c };

        } else {
            this.getContext().getResultSqlParams().add(fieldValue);

            exps = new Expression[] { c, param };
        }

        Expression operator = this.getOperator(ff.getOperator(), exps);
        if (this.enhancedCondition != null) {

            enhancedCondition = new AndExpression(enhancedCondition, operator);
        } else {

            enhancedCondition = operator;
        }

    }
}


public void visit(SubSelect ss) {

    ss.getSelectBody().accept(new SelectVisitorImpl(this.getContext()));
}


public void visit(SubJoin sj) {

    Join join = sj.getJoin();
    join.getRightItem().accept(new FromItemVisitorImpl(this.getContext()));

    join.getOnExpression().accept(new ExpressionVisitorImpl(this.getContext()));
}


private Expression getOperator(String op, Expression[] exp) {

    if (&quot;=&quot;.equals(op)) {
        EqualsTo eq = new EqualsTo();

        eq.setLeftExpression(exp[0]);
        eq.setRightExpression(exp[1]);

        return eq;
    } else if (&quot;&gt;&quot;.equals(op)) {

        GreaterThan gt = new GreaterThan();
        gt.setLeftExpression(exp[0]);

        gt.setRightExpression(exp[1]);
        return gt;

    } else if (&quot;&gt;=&quot;.equals(op)) {
        GreaterThanEquals geq = new GreaterThanEquals();

        geq.setLeftExpression(exp[0]);
        geq.setRightExpression(exp[1]);

        return geq;
    } else if (&quot;&lt;&quot;.equals(op)) {

        MinorThan mt = new MinorThan();
        mt.setLeftExpression(exp[0]);

        mt.setRightExpression(exp[1]);
        return mt;

    } else if (&quot;&lt;=&quot;.equals(op)) {
        MinorThanEquals leq = new MinorThanEquals();

        leq.setLeftExpression(exp[0]);
        leq.setRightExpression(exp[1]);

        return leq;
    } else if (&quot;&lt;&gt;&quot;.equals(op)) {

        NotEqualsTo neq = new NotEqualsTo();
        neq.setLeftExpression(exp[0]);

        neq.setRightExpression(exp[1]);
        return neq;

    } else if (&quot;is null&quot;.equalsIgnoreCase(op)) {
        IsNullExpression isNull = new IsNullExpression();

        isNull.setNot(false);
        isNull.setLeftExpression(exp[0]);

        return isNull;
    } else if (&quot;is not null&quot;.equalsIgnoreCase(op)) {

        IsNullExpression isNull = new IsNullExpression();
        isNull.setNot(true);

        isNull.setLeftExpression(exp[0]);
        return isNull;

    } else if (&quot;like&quot;.equalsIgnoreCase(op)) {
        LikeExpression like = new LikeExpression();

        like.setNot(false);
        like.setLeftExpression(exp[0]);

        like.setRightExpression(exp[1]);
        return like;

    } else if (&quot;not like&quot;.equalsIgnoreCase(op)) {
        LikeExpression nlike = new LikeExpression();

        nlike.setNot(true);
        nlike.setLeftExpression(exp[0]);

        nlike.setRightExpression(exp[1]);
        return nlike;

    } else if (&quot;between&quot;.equalsIgnoreCase(op)) {
        Between bt = new Between();

        bt.setNot(false);
        bt.setLeftExpression(exp[0]);

        bt.setBetweenExpressionStart(exp[1]);
        bt.setBetweenExpressionEnd(exp[2]);

        return bt;
    } else if (&quot;not between&quot;.equalsIgnoreCase(op)) {

        Between bt = new Between();
        bt.setNot(true);

        bt.setLeftExpression(exp[0]);
        bt.setBetweenExpressionStart(exp[1]);

        bt.setBetweenExpressionEnd(exp[2]);
        return bt;

    }
    throw new FilterException(&quot;Unknown operator:&quot; + op);

}


protected Object getRawValue(Object value, Map&lt;String, Object&gt; context) {
    if (context == null) {

        return value;
    }

    if (value instanceof String) {
        String v = (String) value;

        Pattern pattern = Pattern.compile(varPattern);
        Matcher matcher = pattern.matcher(v);

        if (matcher.find()) {
            return context.get(matcher.group(1));

        }
    }

    return value;
}


public Expression getEnhancedCondition() {

    return enhancedCondition;
}
</code></pre><p>}
1）对JDBC parameter做了处理，如果参数为NULL则自动忽略该parameter，忽略后需要处理and or between 等情况
   如：where name=? and age=? ，假如name对应的参数为null，则条件改为where 1=1 and age=?，如果是or的话则改为 where 1=0 or age=?
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>public class ExpressionVisitorImpl extends AbstractVisitor implements ExpressionVisitor {  </li>
<li></li>
<li>public ExpressionVisitorImpl(VisitContext ctx) {  </li>
<li>super(ctx);  </li>
<li>}  </li>
<li></li>
<li>public void visit(NullValue nv) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(Function f) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(InverseExpression ie) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(JdbcParameter jp) {  </li>
<li>this.getContext().getResultSqlParams().add(context.removeFirstParam());  </li>
<li>}  </li>
<li></li>
<li>public void visit(DoubleValue dv) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(LongValue lv) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(DateValue dv) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(TimeValue tv) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(TimestampValue tv) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(Parenthesis parenthesis) {  </li>
<li>ExpressionVisitorImpl ev = new ExpressionVisitorImpl(context);  </li>
<li>parenthesis.getExpression().accept(ev);  </li>
<li>if (ev.isNotValid()) {  </li>
<li>parenthesis.setExpression(this.createTrueEquals());  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>public void visit(StringValue s) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(Addition a) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(Division d) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(Multiplication m) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(Subtraction s) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(AndExpression and) {  </li>
<li>ExpressionVisitorImpl left = new ExpressionVisitorImpl(this.getContext());  </li>
<li>and.getLeftExpression().accept(left);  </li>
<li>if (left.isNotValid()) {  </li>
<li>and.setLeftExpression(this.createTrueEquals());  </li>
<li>}  </li>
<li>ExpressionVisitorImpl right = new ExpressionVisitorImpl(this.getContext());  </li>
<li>and.getRightExpression().accept(right);  </li>
<li>if (right.isNotValid()) {  </li>
<li>and.setRightExpression(this.createTrueEquals());  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>public void visit(OrExpression or) {  </li>
<li>ExpressionVisitorImpl left = new ExpressionVisitorImpl(this.getContext());  </li>
<li>or.getLeftExpression().accept(left);  </li>
<li>if (left.isNotValid()) {  </li>
<li>or.setLeftExpression(this.createFalseEquals());  </li>
<li>}  </li>
<li>ExpressionVisitorImpl right = new ExpressionVisitorImpl(this.getContext());  </li>
<li>or.getRightExpression().accept(right);  </li>
<li>if (right.isNotValid()) {  </li>
<li>or.setRightExpression(this.createFalseEquals());  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>public void visit(Between btw) {  </li>
<li>Expression start = btw.getBetweenExpressionStart();  </li>
<li>Expression end = btw.getBetweenExpressionEnd();  </li>
<li>if (start instanceof JdbcParameter &amp;&amp; end instanceof JdbcParameter) {  </li>
<li>Object o1 = this.context.getFirstParam();  </li>
<li>Object o2 = this.context.getParam(1);  </li>
<li>if (o1 == null || o2 == null) {  </li>
<li>this.context.removeFirstParam();  </li>
<li>this.context.removeFirstParam();  </li>
<li>this.setValid(false);  </li>
<li>return;  </li>
<li>}  </li>
<li>} else if (start instanceof JdbcParameter || end instanceof JdbcParameter) {  </li>
<li>Object o1 = this.context.getFirstParam();  </li>
<li>if (o1 == null) {  </li>
<li>this.context.removeFirstParam();  </li>
<li>this.setValid(false);  </li>
<li>return;  </li>
<li>}  </li>
<li>}  </li>
<li>btw.getLeftExpression().accept(new ExpressionVisitorImpl(context));  </li>
<li>btw.getBetweenExpressionStart().accept(new ExpressionVisitorImpl(context));  </li>
<li>btw.getBetweenExpressionEnd().accept(new ExpressionVisitorImpl(context));  </li>
<li>}  </li>
<li></li>
<li>public void visit(EqualsTo eq) {  </li>
<li>if (eq.getRightExpression() instanceof JdbcParameter) {  </li>
<li>Object o = this.context.getFirstParam();  </li>
<li>if (o == null) {  </li>
<li>this.setValid(false);  </li>
<li>this.getContext().removeFirstParam();  </li>
<li>return;  </li>
<li>}  </li>
<li>}  </li>
<li>eq.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>eq.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li></li>
<li>public void visit(GreaterThan gt) {  </li>
<li>if (gt.getRightExpression() instanceof JdbcParameter) {  </li>
<li>Object o = this.context.getFirstParam();  </li>
<li>if (o == null) {  </li>
<li>this.setValid(false);  </li>
<li>this.getContext().removeFirstParam();  </li>
<li>}  </li>
<li>}  </li>
<li>gt.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>gt.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li></li>
<li>public void visit(GreaterThanEquals gte) {  </li>
<li>if (gte.getRightExpression() instanceof JdbcParameter) {  </li>
<li>Object o = this.context.getFirstParam();  </li>
<li>if (o == null) {  </li>
<li>this.setValid(false);  </li>
<li>this.getContext().removeFirstParam();  </li>
<li>}  </li>
<li>}  </li>
<li>gte.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>gte.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li></li>
<li>public void visit(InExpression in) {  </li>
<li>ItemsList list = in.getItemsList();  </li>
<li>list.accept(new ItemsListVisitorImpl(context));  </li>
<li>}  </li>
<li></li>
<li>public void visit(IsNullExpression ine) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(LikeExpression le) {  </li>
<li>if (le.getRightExpression() instanceof JdbcParameter) {  </li>
<li>Object o = this.context.getFirstParam();  </li>
<li>if (o == null) {  </li>
<li>this.setValid(false);  </li>
<li>this.getContext().removeFirstParam();  </li>
<li>}  </li>
<li>}  </li>
<li>le.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>le.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li></li>
<li>public void visit(MinorThan mt) {  </li>
<li>if (mt.getRightExpression() instanceof JdbcParameter) {  </li>
<li>Object o = this.context.getFirstParam();  </li>
<li>if (o == null) {  </li>
<li>this.setValid(false);  </li>
<li>this.getContext().removeFirstParam();  </li>
<li>}  </li>
<li>}  </li>
<li>mt.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>mt.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li></li>
<li>public void visit(MinorThanEquals mte) {  </li>
<li>if (mte.getRightExpression() instanceof JdbcParameter) {  </li>
<li>Object o = this.context.getFirstParam();  </li>
<li>if (o == null) {  </li>
<li>this.setValid(false);  </li>
<li>this.getContext().removeFirstParam();  </li>
<li>}  </li>
<li>}  </li>
<li>mte.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>mte.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li></li>
<li>public void visit(NotEqualsTo neq) {  </li>
<li>if (neq.getRightExpression() instanceof JdbcParameter) {  </li>
<li>Object o = this.context.getFirstParam();  </li>
<li>if (o == null) {  </li>
<li>this.setValid(false);  </li>
<li>this.getContext().removeFirstParam();  </li>
<li>return;  </li>
<li>}  </li>
<li>}  </li>
<li>neq.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>neq.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));  </li>
<li>}  </li>
<li></li>
<li>public void visit(Column c) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(SubSelect ss) {  </li>
<li>ss.getSelectBody().accept(new SelectVisitorImpl(context));  </li>
<li>}  </li>
<li></li>
<li>public void visit(CaseExpression ce) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(WhenClause wc) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(ExistsExpression ee) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(AllComparisonExpression ace) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(AnyComparisonExpression ace) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(Concat c) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(Matches m) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(BitwiseAnd ba) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(BitwiseOr bo) {  </li>
<li>}  </li>
<li></li>
<li>public void visit(BitwiseXor bx) {  </li>
<li>}  </li>
<li></li>
<li>private EqualsTo createTrueEquals() {  </li>
<li>EqualsTo eq = new EqualsTo();  </li>
<li>eq.setLeftExpression(new LongValue(&quot;1&quot;));  </li>
<li>eq.setRightExpression(new LongValue(&quot;1&quot;));  </li>
<li>return eq;  </li>
<li>}  </li>
<li></li>
<li>private EqualsTo createFalseEquals() {  </li>
<li>EqualsTo eq = new EqualsTo();  </li>
<li>eq.setLeftExpression(new LongValue(&quot;1&quot;));  </li>
<li>eq.setRightExpression(new LongValue(&quot;0&quot;));  </li>
<li>return eq;  </li>
<li>}  </li>
<li></li>
<li>}  </li>
</ol>
<p>public class ExpressionVisitorImpl extends AbstractVisitor implements ExpressionVisitor {</p>
<pre><code>public ExpressionVisitorImpl(VisitContext ctx) {

    super(ctx);
}


public void visit(NullValue nv) {

}


public void visit(Function f) {
}


public void visit(InverseExpression ie) {

}


public void visit(JdbcParameter jp) {
    this.getContext().getResultSqlParams().add(context.removeFirstParam());

}


public void visit(DoubleValue dv) {
}


public void visit(LongValue lv) {

}


public void visit(DateValue dv) {
}


public void visit(TimeValue tv) {

}


public void visit(TimestampValue tv) {
}


public void visit(Parenthesis parenthesis) {

    ExpressionVisitorImpl ev = new ExpressionVisitorImpl(context);
    parenthesis.getExpression().accept(ev);

    if (ev.isNotValid()) {
        parenthesis.setExpression(this.createTrueEquals());

    }
}


public void visit(StringValue s) {

}


public void visit(Addition a) {
}


public void visit(Division d) {

}


public void visit(Multiplication m) {
}


public void visit(Subtraction s) {

}


public void visit(AndExpression and) {
    ExpressionVisitorImpl left = new ExpressionVisitorImpl(this.getContext());

    and.getLeftExpression().accept(left);
    if (left.isNotValid()) {

        and.setLeftExpression(this.createTrueEquals());
    }

    ExpressionVisitorImpl right = new ExpressionVisitorImpl(this.getContext());
    and.getRightExpression().accept(right);

    if (right.isNotValid()) {
        and.setRightExpression(this.createTrueEquals());

    }
}


public void visit(OrExpression or) {

    ExpressionVisitorImpl left = new ExpressionVisitorImpl(this.getContext());
    or.getLeftExpression().accept(left);

    if (left.isNotValid()) {
        or.setLeftExpression(this.createFalseEquals());

    }
    ExpressionVisitorImpl right = new ExpressionVisitorImpl(this.getContext());

    or.getRightExpression().accept(right);
    if (right.isNotValid()) {

        or.setRightExpression(this.createFalseEquals());
    }

}


public void visit(Between btw) {
    Expression start = btw.getBetweenExpressionStart();

    Expression end = btw.getBetweenExpressionEnd();
    if (start instanceof JdbcParameter &amp;&amp; end instanceof JdbcParameter) {

        Object o1 = this.context.getFirstParam();
        Object o2 = this.context.getParam(1);

        if (o1 == null || o2 == null) {
            this.context.removeFirstParam();

            this.context.removeFirstParam();
            this.setValid(false);

            return;
        }

    } else if (start instanceof JdbcParameter || end instanceof JdbcParameter) {
        Object o1 = this.context.getFirstParam();

        if (o1 == null) {
            this.context.removeFirstParam();

            this.setValid(false);
            return;

        }
    }

    btw.getLeftExpression().accept(new ExpressionVisitorImpl(context));
    btw.getBetweenExpressionStart().accept(new ExpressionVisitorImpl(context));

    btw.getBetweenExpressionEnd().accept(new ExpressionVisitorImpl(context));
}


public void visit(EqualsTo eq) {

    if (eq.getRightExpression() instanceof JdbcParameter) {
        Object o = this.context.getFirstParam();

        if (o == null) {
            this.setValid(false);

            this.getContext().removeFirstParam();
            return;

        }
    }

    eq.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));
    eq.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));

}


public void visit(GreaterThan gt) {
    if (gt.getRightExpression() instanceof JdbcParameter) {

        Object o = this.context.getFirstParam();
        if (o == null) {

            this.setValid(false);
            this.getContext().removeFirstParam();

        }
    }

    gt.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));
    gt.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));

}


public void visit(GreaterThanEquals gte) {
    if (gte.getRightExpression() instanceof JdbcParameter) {

        Object o = this.context.getFirstParam();
        if (o == null) {

            this.setValid(false);
            this.getContext().removeFirstParam();

        }
    }

    gte.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));
    gte.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));

}


public void visit(InExpression in) {
    ItemsList list = in.getItemsList();

    list.accept(new ItemsListVisitorImpl(context));
}


public void visit(IsNullExpression ine) {

}


public void visit(LikeExpression le) {
    if (le.getRightExpression() instanceof JdbcParameter) {

        Object o = this.context.getFirstParam();
        if (o == null) {

            this.setValid(false);
            this.getContext().removeFirstParam();

        }
    }

    le.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));
    le.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));

}


public void visit(MinorThan mt) {
    if (mt.getRightExpression() instanceof JdbcParameter) {

        Object o = this.context.getFirstParam();
        if (o == null) {

            this.setValid(false);
            this.getContext().removeFirstParam();

        }
    }

    mt.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));
    mt.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));

}


public void visit(MinorThanEquals mte) {
    if (mte.getRightExpression() instanceof JdbcParameter) {

        Object o = this.context.getFirstParam();
        if (o == null) {

            this.setValid(false);
            this.getContext().removeFirstParam();

        }
    }

    mte.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));
    mte.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));

}


public void visit(NotEqualsTo neq) {
    if (neq.getRightExpression() instanceof JdbcParameter) {

        Object o = this.context.getFirstParam();
        if (o == null) {

            this.setValid(false);
            this.getContext().removeFirstParam();

            return;
        }

    }
    neq.getLeftExpression().accept(new ExpressionVisitorImpl(this.getContext()));

    neq.getRightExpression().accept(new ExpressionVisitorImpl(this.getContext()));
}


public void visit(Column c) {

}


public void visit(SubSelect ss) {
    ss.getSelectBody().accept(new SelectVisitorImpl(context));

}


public void visit(CaseExpression ce) {
}


public void visit(WhenClause wc) {

}


public void visit(ExistsExpression ee) {
}


public void visit(AllComparisonExpression ace) {

}


public void visit(AnyComparisonExpression ace) {
}


public void visit(Concat c) {

}


public void visit(Matches m) {
}


public void visit(BitwiseAnd ba) {

}


public void visit(BitwiseOr bo) {
}


public void visit(BitwiseXor bx) {

}


private EqualsTo createTrueEquals() {
    EqualsTo eq = new EqualsTo();

    eq.setLeftExpression(new LongValue(&quot;1&quot;));
    eq.setRightExpression(new LongValue(&quot;1&quot;));

    return eq;
}


private EqualsTo createFalseEquals() {

    EqualsTo eq = new EqualsTo();
    eq.setLeftExpression(new LongValue(&quot;1&quot;));

    eq.setRightExpression(new LongValue(&quot;0&quot;));
    return eq;

}
</code></pre><p>}
增强后SQL语句的重新生成，根据ORACLE的语法重写了几个生成的方法
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>public class OracleSelectDeParser extends SelectDeParser {  </li>
<li></li>
<li>public OracleSelectDeParser(ExpressionDeParser expressionDeParser, StringBuffer sb) {  </li>
<li>super(expressionDeParser, sb);  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 重写父类方法，去掉父类方法中table前的as </li>
<li>/*/  </li>
<li>public void visit(Table tableName) {  </li>
<li>buffer.append(tableName.getWholeTableName());  </li>
<li>String alias = tableName.getAlias();  </li>
<li>if (alias != null &amp;&amp; StringUtil.isNotEmpty(alias)) {  </li>
<li>buffer.append(&quot; &quot;);  </li>
<li>buffer.append(alias);  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 重写父类方法，在JOIN之前增加空格 </li>
<li>/*/  </li>
<li>@SuppressWarnings(&quot;unchecked&quot;)  </li>
<li>public void deparseJoin(Join join) {  </li>
<li>if (join.isSimple()) {  </li>
<li>buffer.append(&quot;, &quot;);  </li>
<li>} else {  </li>
<li>buffer.append(&quot; &quot;);  </li>
<li>if (join.isRight()) {  </li>
<li>buffer.append(&quot;RIGHT &quot;);  </li>
<li>} else if (join.isNatural()) {  </li>
<li>buffer.append(&quot;NATURAL &quot;);  </li>
<li>} else if (join.isFull()) {  </li>
<li>buffer.append(&quot;FULL &quot;);  </li>
<li>} else if (join.isLeft()) {  </li>
<li>buffer.append(&quot;LEFT &quot;);  </li>
<li>}  </li>
<li>if (join.isOuter()) {  </li>
<li>buffer.append(&quot;OUTER &quot;);  </li>
<li>} else if (join.isInner()) {  </li>
<li>buffer.append(&quot;INNER &quot;);  </li>
<li>}  </li>
<li>buffer.append(&quot;JOIN &quot;);  </li>
<li>}  </li>
<li></li>
<li>FromItem fromItem = join.getRightItem();  </li>
<li>fromItem.accept(this);  </li>
<li>if (join.getOnExpression() != null) {  </li>
<li>buffer.append(&quot; ON &quot;);  </li>
<li>join.getOnExpression().accept(expressionVisitor);  </li>
<li>}  </li>
<li>if (join.getUsingColumns() != null) {  </li>
<li>buffer.append(&quot; USING ( &quot;);  </li>
<li>for (Iterator<Column> iterator = join.getUsingColumns().iterator(); iterator.hasNext();) {  </li>
<li>Column column = iterator.next();  </li>
<li>buffer.append(column.getWholeColumnName());  </li>
<li>if (iterator.hasNext()) {  </li>
<li>buffer.append(&quot; ,&quot;);  </li>
<li>}  </li>
<li>}  </li>
<li>buffer.append(&quot;)&quot;);  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>}  </li>
</ol>
<p>public class OracleSelectDeParser extends SelectDeParser {</p>
<pre><code>public OracleSelectDeParser(ExpressionDeParser expressionDeParser, StringBuffer sb) {

    super(expressionDeParser, sb);
}


//*/*

 /* 重写父类方法，去掉父类方法中table前的as
 /*/

public void visit(Table tableName) {
    buffer.append(tableName.getWholeTableName());

    String alias = tableName.getAlias();
    if (alias != null &amp;&amp; StringUtil.isNotEmpty(alias)) {

        buffer.append(&quot; &quot;);
        buffer.append(alias);

    }
}


//*/*

 /* 重写父类方法，在JOIN之前增加空格
 /*/

@SuppressWarnings(&quot;unchecked&quot;)
public void deparseJoin(Join join) {

    if (join.isSimple()) {
        buffer.append(&quot;, &quot;);

    } else {
        buffer.append(&quot; &quot;);

        if (join.isRight()) {
            buffer.append(&quot;RIGHT &quot;);

        } else if (join.isNatural()) {
            buffer.append(&quot;NATURAL &quot;);

        } else if (join.isFull()) {
            buffer.append(&quot;FULL &quot;);

        } else if (join.isLeft()) {
            buffer.append(&quot;LEFT &quot;);

        }
        if (join.isOuter()) {

            buffer.append(&quot;OUTER &quot;);
        } else if (join.isInner()) {

            buffer.append(&quot;INNER &quot;);
        }

        buffer.append(&quot;JOIN &quot;);
    }


    FromItem fromItem = join.getRightItem();

    fromItem.accept(this);
    if (join.getOnExpression() != null) {

        buffer.append(&quot; ON &quot;);
        join.getOnExpression().accept(expressionVisitor);

    }
    if (join.getUsingColumns() != null) {

        buffer.append(&quot; USING ( &quot;);
        for (Iterator&lt;Column&gt; iterator = join.getUsingColumns().iterator(); iterator.hasNext();) {

            Column column = iterator.next();
            buffer.append(column.getWholeColumnName());

            if (iterator.hasNext()) {
                buffer.append(&quot; ,&quot;);

            }
        }

        buffer.append(&quot;)&quot;);
    }

}
</code></pre><p>}</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/SQL_Java/">SQL_Java</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/SQL_Java/" class="label label-success">SQL_Java</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-SQL_Java--SQL解析Jsqlparser/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-SQL_Java--SQL解析Jsqlparser" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区/">100</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="100-java-windows-wmi-">100%纯java调用windows的wmi获取监控数据 - 肖国颖的个人页面 - 开源中国社区</h1>
<p><a href="http://www.oschina.net/" title="开源中国社区首页" target="_blank">开源中国社区</a></p>
<p>开源项目发现、使用和交流平台</p>
<ul>
<li><a href="http://www.oschina.net/project" target="_blank">项目</a></li>
<li><a href="http://www.oschina.net/question" target="_blank">讨论</a></li>
<li><a href="http://www.oschina.net/code/list" target="_blank">代码</a></li>
<li><a href="http://www.oschina.net/news" target="_blank">资讯</a></li>
<li><a href="http://www.oschina.net/translate" target="_blank">翻译</a></li>
<li><a href="http://www.oschina.net/blog" target="_blank">博客</a></li>
<li><a href="http://www.oschina.net/android" target="_blank">Android</a></li>
<li><a href="http://www.oschina.net/job" target="_blank">招聘</a></li>
</ul>
<p>当前访客身份： arctichia [ <a href="http://my.oschina.net/arcichia" target="_blank">我的空间</a> | <a href="http://my.oschina.net/action/user/logout?session=9c386f172b1174553110&amp;goto_page=http%3A%2F%2Fmy.oschina.net%2Fnoahxiao" target="_blank">退出</a> ]  <a href="http://my.oschina.net/arcichia/admin/inbox" title="进入我的留言箱" target="_blank">你有<em>0</em>新留言</a></p>
<p>软件 代码 讨论区 新闻 博客</p>
<p>软件</p>
<ul>
<li><a href="">软件</a></li>
<li><a href="">代码</a></li>
<li><a href="">讨论区</a></li>
<li><a href="">新闻</a></li>
<li><a href="">博客</a>
<a href="http://my.oschina.net/noahxiao" target="_blank"><img src="&quot;肖国颖&quot;" alt="肖国颖"></a>  <a href="http://my.oschina.net/noahxiao" title="男" target="_blank">肖国颖</a>  <img src="&quot;男&quot;" alt=""> <a href="&quot;成为TA的粉丝&quot;">关注此人</a></li>
</ul>
<p><a href="http://my.oschina.net/noahxiao/fellow" target="_blank">关注(4)</a> <a href="http://my.oschina.net/noahxiao/fans" target="_blank">粉丝(71)</a> <a href="http://www.oschina.net/question/3307_20931" title="查看OSCHINA积分规则" target="_blank">积分(280)</a></p>
<p>不做鬼中鬼，怎做人上人
<a href="">.发送留言</a> <a href="http://www.oschina.net/question/ask?user=569848" target="_blank">.请教问题</a></p>
<p><strong>博客分类</strong></p>
<ul>
<li><a href="http://my.oschina.net/noahxiao/blog?catalog=186739" target="_blank">工作日志</a>(47)</li>
<li><a href="http://my.oschina.net/noahxiao/blog?catalog=186740" target="_blank">日常记录</a>(0)</li>
<li><a href="http://my.oschina.net/noahxiao/blog?catalog=186741" target="_blank">转贴的文章</a>(0)
<strong>阅读排行</strong></li>
</ul>
<ol>
<li><a href="http://my.oschina.net/noahxiao/blog/61987" target="_blank">1. 在Android中嵌入AdMob广告，赚午饭钱</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/86328" target="_blank">2. 解决iOS6看YouTb的心酸，补充可看版(goagent+opendoor)</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/126357" target="_blank">3. 当单例（Singleton）爱上多线程——重复初始化问题</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/112759" target="_blank">4. Java序列化与JSON序列化大比拼</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/61495" target="_blank">5. 在Eclipse中用Scala语言开发Android应用</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/88687" target="_blank">6. Ubuntu 12.10下用Empathy（pidgin-lwqq）登录QQ</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/65071" target="_blank">7. 解决Ubuntu 12.04下频繁死机-Chrome</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/140771" target="_blank">8. 以Jar形式为Web项目提供资源文件（JS、CSS与图片）</a></li>
</ol>
<p><strong>最新评论</strong></p>
<ul>
<li><a href="http://my.oschina.net/wenshao" target="_blank">@wenshao</a>：fastjson缺省是做循环引用检测的，你关掉这个再测... <a href="http://my.oschina.net/action/tweet/go?obj=274988152&amp;type=18&amp;user=127152" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/wenshao" target="_blank">@wenshao</a>：这个测试不对，你直接测试JavaBean而不是Map看看... <a href="http://my.oschina.net/action/tweet/go?obj=274988031&amp;type=18&amp;user=127152" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/u/1182868" target="_blank">@rrstpit</a>：Fffff <a href="http://my.oschina.net/action/tweet/go?obj=274896306&amp;type=18&amp;user=1182868" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/fxl" target="_blank">@付学良</a>：引用来自“xautlx”的评论 Servlet3规范好像已经... <a href="http://my.oschina.net/action/tweet/go?obj=274529269&amp;type=18&amp;user=83617" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/112358" target="_blank">@yezheng1993</a>：引用来自“肖国颖”的评论 引用来自“yezheng19... <a href="http://my.oschina.net/action/tweet/go?obj=274481572&amp;type=18&amp;user=1173735" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/noahxiao" target="_blank">@肖国颖</a>：引用来自“yezheng1993”的评论 请问一下怎么在那... <a href="http://my.oschina.net/action/tweet/go?obj=274479348&amp;type=18&amp;user=569848" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/112358" target="_blank">@yezheng1993</a>：请问一下怎么在那边创建文件以及文件夹，新手，还... <a href="http://my.oschina.net/action/tweet/go?obj=274477519&amp;type=18&amp;user=1173735" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/u/151176" target="_blank">@xautlx</a>：Servlet3规范好像已经有标准支持：<a href="https://blogs" target="_blank">https://blogs</a>... <a href="http://my.oschina.net/action/tweet/go?obj=274464191&amp;type=18&amp;user=151176" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/u/613918" target="_blank">@ahnan</a>：www.webjars.org <a href="http://my.oschina.net/action/tweet/go?obj=274462857&amp;type=18&amp;user=613918" target="_blank">查看»</a></li>
<li><p><a href="http://my.oschina.net/wj2699" target="_blank">@wj2699</a>：spring的mvc确实有这么个功能，但是如果和apach... <a href="http://my.oschina.net/action/tweet/go?obj=274461745&amp;type=18&amp;user=106294" target="_blank">查看»</a>
<strong>访客统计</strong></p>
</li>
<li><p>今日访问：26</p>
</li>
<li>昨日访问：148</li>
<li>本周访问：389</li>
<li>本月访问：1573</li>
<li>所有访问：52224</li>
</ul>
<p><a href="http://my.oschina.net/noahxiao" target="_blank">空间</a> » <a href="http://my.oschina.net/noahxiao/blog" target="_blank">博客</a> » <a href="http://my.oschina.net/noahxiao/blog?catalog=186739" target="_blank">工作日志</a> » 博客正文</p>
<h1 id="-100-java-windows-wmi-"><img src="" alt=""> 100%纯java调用windows的wmi获取监控数据</h1>
<p><em>23</em>人收藏此文章,  <a href="&quot;添加到收藏夹&quot;">我要收藏</a>   发表于12个月前(2012-08-16 18:17) , 已有<strong>2348</strong>次阅读 ，共<strong><a href="">5</a></strong>个评论</p>
<p>纯java主要体现在可以跨平台调用com。所用的是j-Interop，它是100%纯java实现的com的调用</p>
<h3 id="1-">1、环境准备</h3>
<p>a、windows要开启Remote Registry与Windows Management Instrumentation服务</p>
<p>b、修改安全策略</p>
<p>我系统是英文的，如果是中文系统，翻译为中文，相对应的查找并修改。</p>
<p>Administrative Tools&gt;Local Security Policy&gt;Local Policy&gt;Security Policy&gt;Network access: Sharing and security model for local accounts</p>
<p>修改为Classic（经典）</p>
<p>c、禁用放火墙</p>
<p>d、window2008系统注册表越狱（高版本的win）</p>
<p>需要修改regedit中HKEY_CLASSES_ROOT\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}的权限，windows2008不再给Administrators完全控制权。</p>
<p>下载SetACL.exe，下载地址：<a href="http://files.helgeklein.com/downloads/SetACL/current/SetACL%20(executable%20version).zip" target="_blank">http://files.helgeklein.com/downloads/SetACL/current/SetACL%20(executable%20version).zip</a></p>
<p>set_wmi_reg_acl.cmd</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>1</p>
<p>SetACL.exe -on</p>
<p>&quot;HKEY_CLASSES_ROOT\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}&quot;</p>
<p>-ot reg -actn setowner -ownr</p>
<p>&quot;n:Administrators&quot;</p>
<p>2</p>
<p>SetACL.exe -on</p>
<p>&quot;HKEY_CLASSES_ROOT\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}&quot;</p>
<p>-ot reg -actn ace -ace</p>
<p>&quot;n:Administrators;p:full&quot;</p>
<p>以超级管理员身份执行这个cms，就会把owner与完全控制权限授予Administrators组</p>
<h2 id="-">#</h2>
<h3 id="2-">2、程序代码</h3>
<p>java类</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>001</p>
<p>package</p>
<p>org.noah.wmitest;</p>
<p>002</p>
<p>003</p>
<p>import</p>
<p>org.jinterop.dcom.common.JIException;</p>
<p>004</p>
<p>import</p>
<p>org.jinterop.dcom.common.JISystem;
005</p>
<p>import</p>
<p>org.jinterop.dcom.core./*;</p>
<p>006</p>
<p>import</p>
<p>org.jinterop.dcom.impls.JIObjectFactory;
007</p>
<p>import</p>
<p>org.jinterop.dcom.impls.automation.IJIDispatch;</p>
<p>008</p>
<p>import</p>
<p>org.jinterop.dcom.impls.automation.IJIEnumVariant;
009</p>
<p>import</p>
<p>org.slf4j.Logger;</p>
<p>010</p>
<p>import</p>
<p>org.slf4j.LoggerFactory;
011</p>
<p>012</p>
<p>import</p>
<p>java.net.UnknownHostException;
013</p>
<p>import</p>
<p>java.util.logging.Level;</p>
<p>014</p>
<p>015</p>
<p>//<em>/</em></p>
<p>016</p>
<p>/* Created with IntelliJ IDEA.
017</p>
<p>/* User: noah</p>
<p>018</p>
<p>/* Date: 8/16/12
019</p>
<p>/* Time: 8:00 AM</p>
<p>020</p>
<p>/* To change this template use File | Settings | File Templates.
021</p>
<p>/*/</p>
<p>022</p>
<p>public</p>
<p>class</p>
<p>WmiService {
023</p>
<p>024</p>
<p>private</p>
<p>JIComServer m_ComStub =</p>
<p>null</p>
<p>;
025</p>
<p>private</p>
<p>IJIComObject m_ComObject =</p>
<p>null</p>
<p>;</p>
<p>026</p>
<p>private</p>
<p>IJIDispatch m_Dispatch =</p>
<p>null</p>
<p>;
027</p>
<p>private</p>
<p>String m_Address =</p>
<p>null</p>
<p>;</p>
<p>028</p>
<p>private</p>
<p>JISession m_Session =</p>
<p>null</p>
<p>;
029</p>
<p>private</p>
<p>IJIDispatch m_WbemServices =</p>
<p>null</p>
<p>;</p>
<p>030</p>
<p>031</p>
<p>private</p>
<p>static</p>
<p>final</p>
<p>String WMI_CLSID =</p>
<p>&quot;76A6415B-CB41-11d1-8B02-00600806D9B6&quot;</p>
<p>;</p>
<p>032</p>
<p>private</p>
<p>static</p>
<p>final</p>
<p>String WMI_PROGID =</p>
<p>&quot;WbemScripting.SWbemLocator&quot;</p>
<p>;
033</p>
<p>034</p>
<p>private</p>
<p>Logger logger = LoggerFactory.getLogger(</p>
<p>this</p>
<p>.getClass());
035</p>
<p>036</p>
<p>037</p>
<p>public</p>
<p>WmiService(String address) {</p>
<p>038</p>
<p>JISystem.setAutoRegisteration(</p>
<p>true</p>
<p>);
039</p>
<p>JISystem.getLogger().setLevel(Level.WARNING);</p>
<p>040</p>
<p>m_Address = address;
041</p>
<p>}</p>
<p>042</p>
<p>043</p>
<p>public</p>
<p>void</p>
<p>query(String strQuery) {</p>
<p>044</p>
<p>045</p>
<p>System.out.println(</p>
<p>&quot;query:&quot;</p>
<ul>
<li>strQuery);</li>
</ul>
<p>046</p>
<p>047</p>
<p>JIVariant results[] =</p>
<p>new</p>
<p>JIVariant[</p>
<p>0</p>
<p>];</p>
<p>048</p>
<p>try</p>
<p>{
049</p>
<p>results = m_WbemServices.callMethodA(</p>
<p>&quot;ExecQuery&quot;</p>
<p>,</p>
<p>new</p>
<p>Object[]{</p>
<p>new</p>
<p>JIString(strQuery), JIVariant.OPTIONAL_PARAM(), JIVariant.OPTIONAL_PARAM(), JIVariant.OPTIONAL_PARAM()});</p>
<p>050</p>
<p>IJIDispatch wOSd = (IJIDispatch) JIObjectFactory.narrowObject((results[</p>
<p>0</p>
<p>]).getObjectAsComObject());
051</p>
<p>052</p>
<p>int</p>
<p>count = wOSd.get(</p>
<p>&quot;Count&quot;</p>
<p>).getObjectAsInt();
053</p>
<p>054</p>
<p>IJIComObject enumComObject = wOSd.get(</p>
<p>&quot;_NewEnum&quot;</p>
<p>).getObjectAsComObject();
055</p>
<p>IJIEnumVariant enumVariant = (IJIEnumVariant) JIObjectFactory.narrowObject(enumComObject.queryInterface(IJIEnumVariant.IID));</p>
<p>056</p>
<p>057</p>
<p>IJIDispatch wbemObject_dispatch =</p>
<p>null</p>
<p>;</p>
<p>058</p>
<p>059</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>c =</p>
<p>0</p>
<p>; c &lt; count; c++) {</p>
<p>060</p>
<p>061</p>
<p>Object[] values = enumVariant.next(</p>
<p>1</p>
<p>);</p>
<p>062</p>
<p>JIArray array = (JIArray) values[</p>
<p>0</p>
<p>];
063</p>
<p>Object[] arrayObj = (Object[]) array.getArrayInstance();</p>
<p>064</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>j =</p>
<p>0</p>
<p>; j &lt; arrayObj.length; j++) {
065</p>
<p>wbemObject_dispatch = (IJIDispatch) JIObjectFactory.narrowObject(((JIVariant) arrayObj[j]).getObjectAsComObject());</p>
<p>066</p>
<p>}
067</p>
<p>068</p>
<p>String str = (wbemObject_dispatch.callMethodA(</p>
<p>&quot;GetObjectText_&quot;</p>
<p>,</p>
<p>new</p>
<p>Object[]{</p>
<p>1</p>
<p>}))[</p>
<p>0</p>
<p>].getObjectAsString2();
069</p>
<p>System.out.println(</p>
<p>&quot;(&quot;</p>
<ul>
<li>c +</li>
</ul>
<p>&quot;):&quot;</p>
<p>);</p>
<p>070</p>
<p>System.out.println(str);
071</p>
<p>System.out.println();</p>
<p>072</p>
<p>}
073</p>
<p>074</p>
<p>075</p>
<p>}</p>
<p>catch</p>
<p>(JIException e) {</p>
<p>076</p>
<p>e.printStackTrace();
077</p>
<p>}</p>
<p>078</p>
<p>}
079</p>
<p>080</p>
<p>public</p>
<p>void</p>
<p>connect(</p>
<p>final</p>
<p>String domain,</p>
<p>final</p>
<p>String username,</p>
<p>final</p>
<p>String password) {
081</p>
<p>try</p>
<p>{</p>
<p>082</p>
<p>083</p>
<p>m_Session = JISession.createSession(domain, username, password);</p>
<p>084</p>
<p>m_Session.useSessionSecurity(</p>
<p>true</p>
<p>);
085</p>
<p>m_Session.setGlobalSocketTimeout(</p>
<p>5000</p>
<p>);</p>
<p>086</p>
<p>087</p>
<p>m_ComStub =</p>
<p>new</p>
<p>JIComServer(JIProgId.valueOf(WMI_PROGID), m_Address, m_Session);</p>
<p>088</p>
<p>089</p>
<p>IJIComObject unknown = m_ComStub.createInstance();</p>
<p>090</p>
<p>m_ComObject = unknown.queryInterface(WMI_CLSID);
091</p>
<p>092</p>
<p>m_Dispatch = (IJIDispatch) JIObjectFactory.narrowObject(m_ComObject.queryInterface(IJIDispatch.IID));
093</p>
<p>JIVariant results[] = m_Dispatch.callMethodA(</p>
<p>094</p>
<p>&quot;ConnectServer&quot;</p>
<p>,
095</p>
<p>new</p>
<p>Object[]{</p>
<p>096</p>
<p>new</p>
<p>JIString(m_Address),
097</p>
<p>JIVariant.OPTIONAL_PARAM(),</p>
<p>098</p>
<p>JIVariant.OPTIONAL_PARAM(),
099</p>
<p>JIVariant.OPTIONAL_PARAM(),</p>
<p>100</p>
<p>JIVariant.OPTIONAL_PARAM(),
101</p>
<p>JIVariant.OPTIONAL_PARAM(),</p>
<p>102</p>
<p>0</p>
<p>,
103</p>
<p>JIVariant.OPTIONAL_PARAM()</p>
<p>104</p>
<p>}
105</p>
<p>);</p>
<p>106</p>
<p>107</p>
<p>m_WbemServices = (IJIDispatch) JIObjectFactory.narrowObject((results[</p>
<p>0</p>
<p>]).getObjectAsComObject());</p>
<p>108</p>
<p>109</p>
<p>}</p>
<p>catch</p>
<p>(JIException e) {</p>
<p>110</p>
<p>e.printStackTrace();
111</p>
<p>if</p>
<p>(m_Session !=</p>
<p>null</p>
<p>) {</p>
<p>112</p>
<p>try</p>
<p>{
113</p>
<p>JISession.destroySession(m_Session);</p>
<p>114</p>
<p>}</p>
<p>catch</p>
<p>(JIException e1) {
115</p>
<p>logger.error(e.getMessage(), e);</p>
<p>116</p>
<p>}
117</p>
<p>}</p>
<p>118</p>
<p>}</p>
<p>catch</p>
<p>(UnknownHostException e) {
119</p>
<p>if</p>
<p>(m_Session !=</p>
<p>null</p>
<p>) {</p>
<p>120</p>
<p>try</p>
<p>{
121</p>
<p>JISession.destroySession(m_Session);</p>
<p>122</p>
<p>}</p>
<p>catch</p>
<p>(JIException e1) {
123</p>
<p>logger.error(e.getMessage(), e);</p>
<p>124</p>
<p>}
125</p>
<p>}</p>
<p>126</p>
<p>}
127</p>
<p>}</p>
<p>128</p>
<p>129</p>
<p>public</p>
<p>void</p>
<p>disconnect() {</p>
<p>130</p>
<p>try</p>
<p>{
131</p>
<p>JISession.destroySession(m_Session);</p>
<p>132</p>
<p>}</p>
<p>catch</p>
<p>(JIException e) {
133</p>
<p>logger.error(e.getMessage(), e);</p>
<p>134</p>
<p>}
135</p>
<p>}</p>
<p>136</p>
<p>137</p>
<p>138</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>main(String[] args) {
139</p>
<p>140</p>
<p>WmiService wmiService =</p>
<p>new</p>
<p>WmiService(</p>
<p>&quot;172.16.158.129&quot;</p>
<p>);
141</p>
<p>142</p>
<p>//域（一般为空字符），用户名，密码
143</p>
<p>wmiService.connect(</p>
<p>&quot;&quot;</p>
<p>,</p>
<p>&quot;username&quot;</p>
<p>,</p>
<p>&quot;password&quot;</p>
<p>);</p>
<p>144</p>
<p>145</p>
<p>//系统信息</p>
<p>146</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_ComputerSystem&quot;</p>
<p>);
147</p>
<p>148</p>
<p>//CPU信息
149</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_PerfFormattedData_PerfOS_Processor WHERE Name != &#39;_Total&#39;&quot;</p>
<p>);</p>
<p>150</p>
<p>151</p>
<p>//内存信息</p>
<p>152</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_PerfFormattedData_PerfOS_Memory&quot;</p>
<p>);
153</p>
<p>154</p>
<p>//磁盘信息
155</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_PerfRawData_PerfDisk_PhysicalDisk Where Name != &#39;_Total&#39;&quot;</p>
<p>);</p>
<p>156</p>
<p>157</p>
<p>wmiService.disconnect();</p>
<p>158</p>
<p>}
159</p>
<p>}</p>
<p>mavne配置(pom.xml)
<a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>01</p>
<p>&lt;?</p>
<p>xml</p>
<p>version</p>
<p>=</p>
<p>&quot;1.0&quot;</p>
<p>encoding</p>
<p>=</p>
<p>&quot;UTF-8&quot;</p>
<p>?&gt;</p>
<p>02</p>
<p>&lt;</p>
<p>project</p>
<p>xmlns</p>
<p>=</p>
<p>&quot;<a href="http://maven.apache.org/POM/4.0.0" target="_blank">http://maven.apache.org/POM/4.0.0</a>&quot;
03</p>
<p>xmlns:xsi</p>
<p>=</p>
<p>&quot;<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>&quot;</p>
<p>04</p>
<p>xsi:schemaLocation</p>
<p>=</p>
<p>&quot;<a href="http://maven.apache.org/POM/4.0.0" target="_blank">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_blank">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>&quot;</p>
<p>&gt;
05</p>
<p>&lt;</p>
<p>modelVersion</p>
<blockquote>
<p>4.0.0&lt;/</p>
</blockquote>
<p>modelVersion</p>
<p>&gt;</p>
<p>06</p>
<p>07</p>
<p>&lt;</p>
<p>groupId</p>
<blockquote>
<p>org.noahx&lt;/</p>
</blockquote>
<p>groupId</p>
<p>&gt;</p>
<p>08</p>
<p>&lt;</p>
<p>artifactId</p>
<blockquote>
<p>wmi-test&lt;/</p>
</blockquote>
<p>artifactId</p>
<p>&gt;
09</p>
<p>&lt;</p>
<p>version</p>
<blockquote>
<p>1.0&lt;/</p>
</blockquote>
<p>version</p>
<p>&gt;</p>
<p>10</p>
<p>11</p>
<p>12</p>
<p>&lt;</p>
<p>dependencies</p>
<p>&gt;
13</p>
<p>14</p>
<p>&lt;</p>
<p>dependency</p>
<p>&gt;
15</p>
<p>&lt;</p>
<p>groupId</p>
<blockquote>
<p>org.kohsuke.jinterop&lt;/</p>
</blockquote>
<p>groupId</p>
<p>&gt;</p>
<p>16</p>
<p>&lt;</p>
<p>artifactId</p>
<blockquote>
<p>j-interop&lt;/</p>
</blockquote>
<p>artifactId</p>
<p>&gt;
17</p>
<p>&lt;</p>
<p>version</p>
<blockquote>
<p>2.0.8-kohsuke-1&lt;/</p>
</blockquote>
<p>version</p>
<p>&gt;</p>
<p>18</p>
<p>&lt;/</p>
<p>dependency</p>
<p>&gt;
19</p>
<p>20</p>
<p>&lt;</p>
<p>dependency</p>
<p>&gt;
21</p>
<p>&lt;</p>
<p>groupId</p>
<blockquote>
<p>org.slf4j&lt;/</p>
</blockquote>
<p>groupId</p>
<p>&gt;</p>
<p>22</p>
<p>&lt;</p>
<p>artifactId</p>
<blockquote>
<p>slf4j-log4j12&lt;/</p>
</blockquote>
<p>artifactId</p>
<p>&gt;
23</p>
<p>&lt;</p>
<p>version</p>
<blockquote>
<p>1.6.4&lt;/</p>
</blockquote>
<p>version</p>
<p>&gt;</p>
<p>24</p>
<p>&lt;/</p>
<p>dependency</p>
<p>&gt;
25</p>
<p>26</p>
<p>&lt;/</p>
<p>dependencies</p>
<p>&gt;
27</p>
<p>28</p>
<p>&lt;/</p>
<p>project</p>
<p>&gt;</p>
<p>运行结果</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>001</p>
<p>query:SELECT /* FROM Win32_ComputerSystem</p>
<p>002</p>
<p>(0):
003</p>
<p>004</p>
<p>instance of Win32_ComputerSystem
005</p>
<p>{</p>
<p>006</p>
<p>AdminPasswordStatus = 1;
007</p>
<p>AutomaticResetBootOption = FALSE;</p>
<p>008</p>
<p>AutomaticResetCapability = TRUE;
009</p>
<p>BootOptionOnLimit = 3;</p>
<p>010</p>
<p>BootOptionOnWatchDog = 3;
011</p>
<p>BootROMSupported = TRUE;</p>
<p>012</p>
<p>BootupState =</p>
<p>&quot;Normal boot&quot;</p>
<p>;
013</p>
<p>Caption =</p>
<p>&quot;NAK-E1A7C21EA3C&quot;</p>
<p>;</p>
<p>014</p>
<p>ChassisBootupState = 3;
015</p>
<p>CreationClassName =</p>
<p>&quot;Win32_ComputerSystem&quot;</p>
<p>;</p>
<p>016</p>
<p>CurrentTimeZone = 480;
017</p>
<p>Description =</p>
<p>&quot;AT/AT COMPATIBLE&quot;</p>
<p>;</p>
<p>018</p>
<p>Domain =</p>
<p>&quot;WORKGROUP&quot;</p>
<p>;
019</p>
<p>DomainRole = 0;</p>
<p>020</p>
<p>EnableDaylightSavingsTime = TRUE;
021</p>
<p>FrontPanelResetStatus = 3;</p>
<p>022</p>
<p>InfraredSupported = FALSE;
023</p>
<p>KeyboardPasswordStatus = 3;</p>
<p>024</p>
<p>Manufacturer =</p>
<p>&quot;VMware, Inc.&quot;</p>
<p>;
025</p>
<p>Model =</p>
<p>&quot;VMware Virtual Platform&quot;</p>
<p>;</p>
<p>026</p>
<p>Name =</p>
<p>&quot;NAK-E1A7C21EA3C&quot;</p>
<p>;
027</p>
<p>NetworkServerModeEnabled = TRUE;</p>
<p>028</p>
<p>NumberOfLogicalProcessors = 2;
029</p>
<p>NumberOfProcessors = 1;</p>
<p>030</p>
<p>OEMStringArray = {</p>
<p>&quot;[MS_VM_CERT/SHA1/27d66596a61c48dd3dc7216fd715126e33f59ae7]&quot;</p>
<p>,</p>
<p>&quot;Welcome to the Virtual Machine&quot;</p>
<p>};
031</p>
<p>PartOfDomain = FALSE;</p>
<p>032</p>
<p>PauseAfterReset =</p>
<p>&quot;3932100000&quot;</p>
<p>;
033</p>
<p>PowerOnPasswordStatus = 0;</p>
<p>034</p>
<p>PowerState = 0;
035</p>
<p>PowerSupplyState = 3;</p>
<p>036</p>
<p>PrimaryOwnerName =</p>
<p>&quot;nak&quot;</p>
<p>;
037</p>
<p>ResetCapability = 1;</p>
<p>038</p>
<p>ResetCount = -1;
039</p>
<p>ResetLimit = -1;</p>
<p>040</p>
<p>Roles = {</p>
<p>&quot;LM_Workstation&quot;</p>
<p>,</p>
<p>&quot;LM_Server&quot;</p>
<p>,</p>
<p>&quot;NT&quot;</p>
<p>,</p>
<p>&quot;Potential_Browser&quot;</p>
<p>,</p>
<p>&quot;Master_Browser&quot;</p>
<p>};
041</p>
<p>Status =</p>
<p>&quot;OK&quot;</p>
<p>;</p>
<p>042</p>
<p>SystemStartupDelay = 0;
043</p>
<p>SystemStartupOptions = {</p>
<p>&quot;\&quot;Microsoft Windows XP Professional\&quot; /noexecute=optin /fastdetect&quot;</p>
<p>};</p>
<p>044</p>
<p>SystemStartupSetting = 0;
045</p>
<p>SystemType =</p>
<p>&quot;X86-based PC&quot;</p>
<p>;</p>
<p>046</p>
<p>ThermalState = 3;
047</p>
<p>TotalPhysicalMemory =</p>
<p>&quot;1610063872&quot;</p>
<p>;</p>
<p>048</p>
<p>UserName =</p>
<p>&quot;NAK-E1A7C21EA3C\a&quot;</p>
<p>;
049</p>
<p>WakeUpType = 6;</p>
<p>050</p>
<p>};
051</p>
<p>052</p>
<p>053</p>
<p>query:SELECT /* FROM Win32_PerfFormattedData_PerfOS_Processor WHERE Name !=</p>
<p>&#39;_Total&#39;</p>
<p>054</p>
<p>(0):
055</p>
<p>056</p>
<p>instance of Win32_PerfFormattedData_PerfOS_Processor
057</p>
<p>{</p>
<p>058</p>
<p>C1TransitionsPersec =</p>
<p>&quot;77&quot;</p>
<p>;
059</p>
<p>C2TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>060</p>
<p>C3TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;
061</p>
<p>DPCRate = 0;</p>
<p>062</p>
<p>DPCsQueuedPersec = 4;
063</p>
<p>InterruptsPersec = 71;</p>
<p>064</p>
<p>Name =</p>
<p>&quot;0&quot;</p>
<p>;
065</p>
<p>PercentC1Time =</p>
<p>&quot;96&quot;</p>
<p>;</p>
<p>066</p>
<p>PercentC2Time =</p>
<p>&quot;0&quot;</p>
<p>;
067</p>
<p>PercentC3Time =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>068</p>
<p>PercentDPCTime =</p>
<p>&quot;0&quot;</p>
<p>;
069</p>
<p>PercentIdleTime =</p>
<p>&quot;100&quot;</p>
<p>;</p>
<p>070</p>
<p>PercentInterruptTime =</p>
<p>&quot;0&quot;</p>
<p>;
071</p>
<p>PercentPrivilegedTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>072</p>
<p>PercentProcessorTime =</p>
<p>&quot;0&quot;</p>
<p>;
073</p>
<p>PercentUserTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>074</p>
<p>};
075</p>
<p>076</p>
<p>077</p>
<p>(1):</p>
<p>078</p>
<p>079</p>
<p>instance of Win32_PerfFormattedData_PerfOS_Processor</p>
<p>080</p>
<p>{
081</p>
<p>C1TransitionsPersec =</p>
<p>&quot;83&quot;</p>
<p>;</p>
<p>082</p>
<p>C2TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;
083</p>
<p>C3TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>084</p>
<p>DPCRate = 0;
085</p>
<p>DPCsQueuedPersec = 10;</p>
<p>086</p>
<p>InterruptsPersec = 67;
087</p>
<p>Name =</p>
<p>&quot;1&quot;</p>
<p>;</p>
<p>088</p>
<p>PercentC1Time =</p>
<p>&quot;96&quot;</p>
<p>;
089</p>
<p>PercentC2Time =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>090</p>
<p>PercentC3Time =</p>
<p>&quot;0&quot;</p>
<p>;
091</p>
<p>PercentDPCTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>092</p>
<p>PercentIdleTime =</p>
<p>&quot;100&quot;</p>
<p>;
093</p>
<p>PercentInterruptTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>094</p>
<p>PercentPrivilegedTime =</p>
<p>&quot;0&quot;</p>
<p>;
095</p>
<p>PercentProcessorTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>096</p>
<p>PercentUserTime =</p>
<p>&quot;0&quot;</p>
<p>;
097</p>
<p>};</p>
<p>098</p>
<p>099</p>
<p>100</p>
<p>query:SELECT /* FROM Win32_PerfFormattedData_PerfOS_Memory
101</p>
<p>(0):</p>
<p>102</p>
<p>103</p>
<p>instance of Win32_PerfFormattedData_PerfOS_Memory</p>
<p>104</p>
<p>{
105</p>
<p>AvailableBytes =</p>
<p>&quot;1142099968&quot;</p>
<p>;</p>
<p>106</p>
<p>AvailableKBytes =</p>
<p>&quot;1115332&quot;</p>
<p>;
107</p>
<p>AvailableMBytes =</p>
<p>&quot;1089&quot;</p>
<p>;</p>
<p>108</p>
<p>CacheBytes =</p>
<p>&quot;70725632&quot;</p>
<p>;
109</p>
<p>CacheBytesPeak =</p>
<p>&quot;72904704&quot;</p>
<p>;</p>
<p>110</p>
<p>CacheFaultsPersec = 634;
111</p>
<p>CommitLimit =</p>
<p>&quot;3063078912&quot;</p>
<p>;</p>
<p>112</p>
<p>CommittedBytes =</p>
<p>&quot;326488064&quot;</p>
<p>;
113</p>
<p>DemandZeroFaultsPersec = 13965;</p>
<p>114</p>
<p>FreeSystemPageTableEntries = 159743;
115</p>
<p>PageFaultsPersec = 13965;</p>
<p>116</p>
<p>PageReadsPersec = 0;
117</p>
<p>PagesInputPersec = 0;</p>
<p>118</p>
<p>PagesOutputPersec = 0;
119</p>
<p>PagesPersec = 0;</p>
<p>120</p>
<p>PageWritesPersec = 0;
121</p>
<p>PercentCommittedBytesInUse = 10;</p>
<p>122</p>
<p>PoolNonpagedAllocs = 38040;
123</p>
<p>PoolNonpagedBytes =</p>
<p>&quot;7585792&quot;</p>
<p>;</p>
<p>124</p>
<p>PoolPagedAllocs = 57820;
125</p>
<p>PoolPagedBytes =</p>
<p>&quot;29380608&quot;</p>
<p>;</p>
<p>126</p>
<p>PoolPagedResidentBytes =</p>
<p>&quot;28622848&quot;</p>
<p>;
127</p>
<p>SystemCacheResidentBytes =</p>
<p>&quot;40235008&quot;</p>
<p>;</p>
<p>128</p>
<p>SystemCodeResidentBytes =</p>
<p>&quot;1867776&quot;</p>
<p>;
129</p>
<p>SystemCodeTotalBytes =</p>
<p>&quot;1167360&quot;</p>
<p>;</p>
<p>130</p>
<p>SystemDriverResidentBytes =</p>
<p>&quot;0&quot;</p>
<p>;
131</p>
<p>SystemDriverTotalBytes =</p>
<p>&quot;4071424&quot;</p>
<p>;</p>
<p>132</p>
<p>TransitionFaultsPersec = 0;
133</p>
<p>WriteCopiesPersec = 0;</p>
<p>134</p>
<p>};
135</p>
<p>136</p>
<p>137</p>
<p>query:SELECT /* FROM Win32_PerfRawData_PerfDisk_PhysicalDisk Where Name !=</p>
<p>&#39;_Total&#39;</p>
<p>138</p>
<p>(0):
139</p>
<p>140</p>
<p>instance of Win32_PerfRawData_PerfDisk_PhysicalDisk
141</p>
<p>{</p>
<p>142</p>
<p>AvgDiskBytesPerRead =</p>
<p>&quot;138920448&quot;</p>
<p>;
143</p>
<p>AvgDiskBytesPerRead_Base = 8000;</p>
<p>144</p>
<p>AvgDiskBytesPerTransfer =</p>
<p>&quot;208285696&quot;</p>
<p>;
145</p>
<p>AvgDiskBytesPerTransfer_Base = 13701;</p>
<p>146</p>
<p>AvgDiskBytesPerWrite =</p>
<p>&quot;69365248&quot;</p>
<p>;
147</p>
<p>AvgDiskBytesPerWrite_Base = 5701;</p>
<p>148</p>
<p>AvgDiskQueueLength =</p>
<p>&quot;581460650&quot;</p>
<p>;
149</p>
<p>AvgDiskReadQueueLength =</p>
<p>&quot;405581626&quot;</p>
<p>;</p>
<p>150</p>
<p>AvgDisksecPerRead = 2794786622;
151</p>
<p>AvgDisksecPerRead_Base = 8000;</p>
<p>152</p>
<p>AvgDisksecPerTransfer = 322083534;
153</p>
<p>AvgDisksecPerTransfer_Base = 13701;</p>
<p>154</p>
<p>AvgDisksecPerWrite = 1822264208;
155</p>
<p>AvgDisksecPerWrite_Base = 5701;</p>
<p>156</p>
<p>AvgDiskWriteQueueLength =</p>
<p>&quot;175879024&quot;</p>
<p>;
157</p>
<p>CurrentDiskQueueLength = 0;</p>
<p>158</p>
<p>DiskBytesPersec =</p>
<p>&quot;208285696&quot;</p>
<p>;
159</p>
<p>DiskReadBytesPersec =</p>
<p>&quot;138920448&quot;</p>
<p>;</p>
<p>160</p>
<p>DiskReadsPersec = 8000;
161</p>
<p>DiskTransfersPersec = 13701;</p>
<p>162</p>
<p>DiskWriteBytesPersec =</p>
<p>&quot;69365248&quot;</p>
<p>;
163</p>
<p>DiskWritesPersec = 5701;</p>
<p>164</p>
<p>Frequency_Object =</p>
<p>&quot;0&quot;</p>
<p>;
165</p>
<p>Frequency_PerfTime =</p>
<p>&quot;3034010000&quot;</p>
<p>;</p>
<p>166</p>
<p>Frequency_Sys100NS =</p>
<p>&quot;10000000&quot;</p>
<p>;
167</p>
<p>Name =</p>
<p>&quot;0 C:&quot;</p>
<p>;</p>
<p>168</p>
<p>PercentDiskReadTime =</p>
<p>&quot;405581626&quot;</p>
<p>;
169</p>
<p>PercentDiskReadTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>170</p>
<p>PercentDiskTime =</p>
<p>&quot;581460650&quot;</p>
<p>;
171</p>
<p>PercentDiskTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>172</p>
<p>PercentDiskWriteTime =</p>
<p>&quot;175879024&quot;</p>
<p>;
173</p>
<p>PercentDiskWriteTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>174</p>
<p>PercentIdleTime =</p>
<p>&quot;18446744072967667781&quot;</p>
<p>;
175</p>
<p>PercentIdleTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>176</p>
<p>SplitIOPerSec = 1074;
177</p>
<p>Timestamp_Object =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>178</p>
<p>Timestamp_PerfTime =</p>
<p>&quot;3635534093651&quot;</p>
<p>;
179</p>
<p>Timestamp_Sys100NS =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>180</p>
<p>};&lt;span style=</p>
<p>&quot;font-family:&#39;sans serif, tahoma, verdana, helvetica&#39;;font-size:x-small;&quot;</p>
<blockquote>
<p>&lt;span style=</p>
</blockquote>
<p>&quot;line-height:18.18181800842285px;white-space:normal;&quot;</p>
<blockquote>
<p></span></span></p>
</blockquote>
<h2 id="-">#</h2>
<h3 id="3-">3、有可能出现的问题</h3>
<p>报错a</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>01</p>
<p>org.jinterop.dcom.common.JIException: Message not found</p>
<p>for</p>
<p>errorCode:</p>
<p>0xC0000034</p>
<p>02</p>
<p>at org.jinterop.winreg.smb.JIWinRegStub.winreg_OpenHKLM(JIWinRegStub.java:</p>
<p>115</p>
<p>)
03</p>
<p>at org.jinterop.dcom.core.JIProgId.getIdFromWinReg(JIProgId.java:</p>
<p>130</p>
<p>)</p>
<p>04</p>
<p>at org.jinterop.dcom.core.JIProgId.getCorrespondingCLSID(JIProgId.java:</p>
<p>162</p>
<p>)
05</p>
<p>at org.jinterop.dcom.core.JIComServer.<init>(JIComServer.java:</p>
<p>413</p>
<p>)</p>
<p>06</p>
<p>at org.noah.wmitest.WmiService.connect(WmiService.java:</p>
<p>122</p>
<p>)
07</p>
<p>at org.noah.wmitest.WmiService.main(WmiService.java:</p>
<p>177</p>
<p>)</p>
<p>08</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
09</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</p>
<p>39</p>
<p>)</p>
<p>10</p>
<p>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</p>
<p>25</p>
<p>)
11</p>
<p>at java.lang.reflect.Method.invoke(Method.java:</p>
<p>597</p>
<p>)</p>
<p>12</p>
<p>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:</p>
<p>120</p>
<p>)
13</p>
<p>Caused by: jcifs.smb.SmbException: The system cannot find the file specified.</p>
<p>14</p>
<p>at jcifs.smb.SmbTransport.checkStatus(SmbTransport.java:</p>
<p>522</p>
<p>)
15</p>
<p>at jcifs.smb.SmbTransport.send(SmbTransport.java:</p>
<p>622</p>
<p>)</p>
<p>16</p>
<p>at jcifs.smb.SmbSession.send(SmbSession.java:</p>
<p>239</p>
<p>)
17</p>
<p>at jcifs.smb.SmbTree.send(SmbTree.java:</p>
<p>109</p>
<p>)</p>
<p>18</p>
<p>at jcifs.smb.SmbFile.send(SmbFile.java:</p>
<p>718</p>
<p>)
19</p>
<p>at jcifs.smb.SmbFile.open0(SmbFile.java:</p>
<p>923</p>
<p>)</p>
<p>20</p>
<p>at jcifs.smb.SmbFile.open(SmbFile.java:</p>
<p>940</p>
<p>)
21</p>
<p>at jcifs.smb.SmbFileOutputStream.<init>(SmbFileOutputStream.java:</p>
<p>142</p>
<p>)</p>
<p>22</p>
<p>at jcifs.smb.TransactNamedPipeOutputStream.<init>(TransactNamedPipeOutputStream.java:</p>
<p>32</p>
<p>)
23</p>
<p>at jcifs.smb.SmbNamedPipe.getNamedPipeOutputStream(SmbNamedPipe.java:</p>
<p>187</p>
<p>)</p>
<p>24</p>
<p>at rpc.ncacn_np.RpcTransport.attach(RpcTransport.java:</p>
<p>92</p>
<p>)
25</p>
<p>at rpc.Stub.attach(Stub.java:</p>
<p>105</p>
<p>)</p>
<p>26</p>
<p>at rpc.Stub.call(Stub.java:</p>
<p>110</p>
<p>)
27</p>
<p>at org.jinterop.winreg.smb.JIWinRegStub.winreg_OpenHKLM(JIWinRegStub.java:</p>
<p>113</p>
<p>)</p>
<p>28</p>
<p>...</p>
<p>10</p>
<p>more</p>
<p>需要开启Remote Registry服务
报错b</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>01</p>
<p>org.jinterop.dcom.common.JIException: Message not found</p>
<p>for</p>
<p>errorCode:</p>
<p>0xC0000001</p>
<p>02</p>
<p>at org.jinterop.winreg.smb.JIWinRegStub.winreg_OpenHKLM(JIWinRegStub.java:</p>
<p>115</p>
<p>)
03</p>
<p>at org.jinterop.dcom.core.JIProgId.getIdFromWinReg(JIProgId.java:</p>
<p>130</p>
<p>)</p>
<p>04</p>
<p>at org.jinterop.dcom.core.JIProgId.getCorrespondingCLSID(JIProgId.java:</p>
<p>162</p>
<p>)
05</p>
<p>at org.jinterop.dcom.core.JIComServer.<init>(JIComServer.java:</p>
<p>413</p>
<p>)</p>
<p>06</p>
<p>at org.noah.wmitest.WmiService.connect(WmiService.java:</p>
<p>87</p>
<p>)
07</p>
<p>at org.noah.wmitest.WmiService.main(WmiService.java:</p>
<p>142</p>
<p>)</p>
<p>08</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
09</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</p>
<p>39</p>
<p>)</p>
<p>10</p>
<p>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</p>
<p>25</p>
<p>)
11</p>
<p>at java.lang.reflect.Method.invoke(Method.java:</p>
<p>597</p>
<p>)</p>
<p>12</p>
<p>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:</p>
<p>120</p>
<p>)
13</p>
<p>Caused by: jcifs.smb.SmbException: Connection timeout</p>
<p>14</p>
<p>jcifs.util.transport.TransportException: Connection timeout
15</p>
<p>16</p>
<p>或
17</p>
<p>18</p>
<p>org.jinterop.dcom.common.JIException: Message not found</p>
<p>for</p>
<p>errorCode:</p>
<p>0x8001FFFF
19</p>
<p>at org.jinterop.dcom.core.JIComServer.init(JIComServer.java:</p>
<p>576</p>
<p>)</p>
<p>20</p>
<p>at org.jinterop.dcom.core.JIComServer.initialise(JIComServer.java:</p>
<p>481</p>
<p>)
21</p>
<p>at org.jinterop.dcom.core.JIComServer.<init>(JIComServer.java:</p>
<p>414</p>
<p>)</p>
<p>22</p>
<p>at org.noah.wmitest.WmiService.connect(WmiService.java:</p>
<p>87</p>
<p>)
23</p>
<p>at org.noah.wmitest.WmiService.main(WmiService.java:</p>
<p>142</p>
<p>)</p>
<p>24</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
25</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</p>
<p>39</p>
<p>)</p>
<p>26</p>
<p>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</p>
<p>25</p>
<p>)
27</p>
<p>at java.lang.reflect.Method.invoke(Method.java:</p>
<p>597</p>
<p>)</p>
<p>28</p>
<p>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:</p>
<p>120</p>
<p>)
29</p>
<p>Caused by: java.net.ConnectException: Connection timed out</p>
<p>需要禁用放火墙</p>
<h3 id="4-">4、总结</h3>
<p>j-Interop纯java跨平台，我就是linux系统。</p>
<p>用j-Interop就可以很方便的调用windows系统com，虽然这里只演示了WMI。
如果关心WMI与监控的话，建议去opennms-wmi看一看，他们有更好api封装（底层也是j-Interop）。
<strong>关键字：</strong> <a href="http://www.oschina.net/search?scope=blog&amp;q=wmi" target="_blank">wmi</a> <a href="http://www.oschina.net/search?scope=blog&amp;q=windows" target="_blank">windows</a> <a href="http://www.oschina.net/search?scope=blog&amp;q=j-interop" target="_blank">j-interop</a></p>
<p>声明：OSCHINA 博客文章版权属于作者，受法律保护。未经作者同意不得转载。</p>
<ul>
<li><a href="http://my.oschina.net/noahxiao/blog/72861" title="上一篇：既爱又恨的VA-API(Ubuntu视频加速)" target="_blank">« 既爱又恨的VA-API(Ubuntu视频加速)</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/75463" title="下一篇：通过javamelody监控web应用的性能指标" target="_blank">通过javamelody监控web应用的性能指标 »</a></li>
</ul>
<p>开源中国-程序员在线工具：<a href="http://www.ostools.net/apidocs" target="_blank">API文档大全(120+)</a> <a href="http://runjs.cn/" target="_blank">JS在线编辑演示</a> <a href="http://www.ostools.net/qr" target="_blank">二维码</a> <a href="http://www.ostools.net/" target="_blank">更多&gt;&gt;</a>
<strong>分享到：</strong> <a href="&quot;分享到新浪微博&quot;"></a> <a href="&quot;分享到腾讯微博&quot;"></a>  <a href="">顶</a>已有 <em>0</em>人顶</p>
<h2 id="-5-"><a href=""></a>共有 5 条网友评论</h2>
<ul>
<li><a href="http://my.oschina.net/u/657242" target="_blank"><img src="&quot;leehark&quot;" alt="leehark"></a> 1楼：<a href="http://my.oschina.net/u/657242" target="_blank">leehark</a>(Android) 发表于 2012-08-18 19:35 <a href="">回复此评论</a></li>
</ul>
<p>能通过代码禁止防火墙么？是都要管理员权限？</p>
<ul>
<li><a href="http://my.oschina.net/mingyuejingque" target="_blank"><img src="&quot;明月惊鹊&quot;" alt="明月惊鹊"></a> 2楼：<a href="http://my.oschina.net/mingyuejingque" target="_blank">明月惊鹊</a> 发表于 2012-08-19 14:40 <a href="">回复此评论</a></li>
</ul>
<p>WMI里应该就有控制防火墙的。这种操作肯定需要管理员权限了。</p>
<ul>
<li><a href="http://my.oschina.net/u/124197" target="_blank"><img src="&quot;黄金比&quot;" alt="黄金比"></a> 3楼：<a href="http://my.oschina.net/u/124197" target="_blank">黄金比</a>(iPhone) 发表于 2012-08-21 07:06 <a href="">回复此评论</a></li>
</ul>
<p>不知道远程调用行不行呢?请博主明确一下。</p>
<ul>
<li><a href="http://my.oschina.net/noahxiao" target="_blank"><img src="&quot;肖国颖&quot;" alt="肖国颖"></a> 4楼：<a href="http://my.oschina.net/noahxiao" target="_blank">肖国颖</a>(iPhone) 发表于 2012-08-21 08:23 <a href="">回复此评论</a></li>
</ul>
<h3 id="-">引用来自“黄金比”的评论</h3>
<p>不知道远程调用行不行呢?请博主明确一下。
你指的是非本机吗？我测试的方式就是一台linux运行程序指定ip调用另一台win服务器的wmi</p>
<ul>
<li><a href="http://my.oschina.net/u/124197" target="_blank"><img src="&quot;黄金比&quot;" alt="黄金比"></a> 5楼：<a href="http://my.oschina.net/u/124197" target="_blank">黄金比</a>(iPhone) 发表于 2012-08-21 12:47 <a href="">回复此评论</a></li>
</ul>
<h3 id="-">引用来自“肖国颖”的评论</h3>
<h3 id="-">引用来自“黄金比”的评论</h3>
<p>不知道远程调用行不行呢?请博主明确一下。
你指的是非本机吗？我测试的方式就是一台linux运行程序指定ip调用另一台win服务器的wmi</p>
<p>收到，谢博主，试下先!</p>
<p>文明上网，理性发言
<a href=""></a></p>
<p><img src="" alt=""> 文明上网，理性发言  <a href="">回到页首</a> | <a href="">回到评论列表</a></p>
<p><strong><a href="">关闭</a>相关文章阅读</strong></p>
<ul>
<li>2012/08/16 <a href="http://my.oschina.net/u/581475/blog/73199" title="100%纯java调用windows的wmi获取监控数据" target="_blank">100%纯java调用windows的wmi获取监控...</a></li>
<li>2011/07/06 <a href="http://my.oschina.net/veterans/blog/27840" title="使用WMI修改文件文件夹的NTFS权限" target="_blank">使用WMI修改文件文件夹的NTFS权限...</a></li>
<li>2013/04/24 <a href="http://my.oschina.net/fenlog/blog/124859" title="利用WMI实现ring3进程监控 - vc" target="_blank">利用WMI实现ring3进程监控 - vc...</a></li>
<li>2012/03/22 <a href="http://my.oschina.net/zhajiang/blog/50524" title="py2exe打包包含wmi模块的脚本后，运行时出现win32api.pyd错误的解决办法。" target="_blank">py2exe打包包含wmi模块的脚本后，运...</a></li>
<li>2011/09/02 <a href="http://my.oschina.net/u/129490/blog/30675" title="在windows下使用OpenSSH（上）" target="_blank">在windows下使用OpenSSH（上）...</a></li>
</ul>
<p>© 开源中国(OsChina.NET) | <a href="http://www.oschina.net/home/about" target="_blank">关于我们</a> | <a href="mailto:oschina.net@gmail.com">广告联系</a> | <a href="http://weibo.com/oschina2010" target="_blank">@新浪微博</a> | <a href="http://m.oschina.net/" target="_blank">开源中国手机版</a> | <a href="http://www.miitbeian.gov.cn/" target="_blank">粤ICP备12009483号-3</a> 开源中国手机客户端： <a href="http://www.oschina.net/app" title="Android客户端" target="_blank">Android</a> <a href="http://www.oschina.net/app" title="iPhone 客户端" target="_blank">iPhone</a> <a href="http://www.oschina.net/app" title="Windows Phone 客户端" target="_blank">WP7</a></p>
<p><a href=""></a><a href=""></a><a href=""></a>
<img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/java-com/">java-com</a></li><li><a href="/categories/Java&J2EE/java-com/wmi-监控/">wmi-监控</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/java-com/" class="label label-success">java-com</a><a href="/tags/wmi-监控/" class="label label-info">wmi-监控</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-proguard--Android23代码混淆proguard技术介绍/">Android 2.3 代码混淆proguard技术介绍</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-proguard--Android23代码混淆proguard技术介绍/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="android-2-3-proguard-">Android 2.3 代码混淆proguard技术介绍</h1>
<p><a href="http://blog.csdn.net/zengyangtech/article/details/6127600" target="_blank">Android 2.3 代码混淆proguard技术介绍</a></p>
<p>由于各种反编译工具的泛滥，作为Android程序员在2.3版本以前只能通过手动添加proguard来实现代码混淆</p>
<p>proguard这个工具是一个java代码混淆的工具</p>
<p>在2.3版本的sdk中 我们可以看到在android-sdk-windows/tools/下面多了一个proguard文件夹</p>
<p>google已经把proguard技术放在了android sdk里面 可以通过正常的编译方式也能实现代码混淆了</p>
<p><img src="" alt=""></p>
<p>可以看见新建一个工程里面有default.properties和proguard.cfg</p>
<p>默认的default.properties代码如下</p>
<p><strong>[c-sharp]</strong> <a href="http://blog.csdn.net/Zengyangtech/article/details/6127600#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/Zengyangtech/article/details/6127600#" title="copy" target="_blank">copy</a></p>
<ol>
<li>/# This file is automatically generated by Android Tools.  </li>
<li>/# Do not modify this file -- YOUR CHANGES WILL BE ERASED!  </li>
<li>/#  </li>
<li>/# This file must be checked in Version Control Systems.  </li>
<li>/#  </li>
<li>/# To customize properties used by the Ant build system use,  </li>
<li>/# &quot;build.properties&quot;, and override values to adapt the script to your  </li>
<li>/# project structure.  </li>
<li>/# Project target.  </li>
<li>target=android-9  </li>
</ol>
<p>我们可以看到proguard.cfg已经帮我们写好了优化代码脚本</p>
<p><strong>[c-sharp]</strong> <a href="http://blog.csdn.net/Zengyangtech/article/details/6127600#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/Zengyangtech/article/details/6127600#" title="copy" target="_blank">copy</a></p>
<ol>
<li>-optimizationpasses 5  </li>
<li>-dontusemixedcaseclassnames  </li>
<li>-dontskipnonpubliclibraryclasses  </li>
<li>-dontpreverify  </li>
<li>-verbose  </li>
<li>-optimizations !code/simplification/arithmetic,!field//<em>,!class/merging//</em>  </li>
<li>-keep public class /* extends android.app.Activity  </li>
<li>-keep public class /* extends android.app.Application  </li>
<li>-keep public class /* extends android.app.Service  </li>
<li>-keep public class /* extends android.content.BroadcastReceiver  </li>
<li>-keep public class /* extends android.content.ContentProvider  </li>
<li>-keep public class com.android.vending.licensing.ILicensingService  </li>
<li>-keepclasseswithmembernames class /* {  </li>
<li>native <methods>;  </li>
<li>}  </li>
<li>-keepclasseswithmembernames class /* {  </li>
<li>public <init>(android.content.Context, android.util.AttributeSet);  </li>
<li>}  </li>
<li>-keepclasseswithmembernames class /* {  </li>
<li>public <init>(android.content.Context, android.util.AttributeSet, int);  </li>
<li>}  </li>
<li>-keepclassmembers enum /* {  </li>
<li>public static /<em>/</em>[] values();  </li>
<li>public static /<em>/</em> valueOf(java.lang.String);  </li>
<li>}  </li>
<li>-keep class /* implements android.os.Parcelable {  </li>
<li>public static final android.os.Parcelable$Creator /*;  </li>
<li>}  </li>
</ol>
<p>从脚本中可以看到，混淆中保留了继承自Activity、Service、Application、BroadcastReceiver、ContentProvider等基本组件以及com.android.vending.licensing.ILicensingService</p>
<p>并保留了所有的Native变量名及类名，所有类中部分以设定了固定参数格式的构造函数，枚举等等。(详细信息请参考<proguard_path>/examples中的例子及注释。)</p>
<p>接下来 按照google帮助文档里说的</p>
<p><strong>[c-sharp]</strong> <a href="http://blog.csdn.net/Zengyangtech/article/details/6127600#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/Zengyangtech/article/details/6127600#" title="copy" target="_blank">copy</a></p>
<ol>
<li>To enable ProGuard so that it runs as part of an Ant or Eclipse build, set the proguard.config property in the <project_root>/default.properties file. The path can be an absolute path or a path relative to the project&#39;s root.  </li>
</ol>
<p>所以我们修改default.properties file</p>
<p>加上一句</p>
<p>proguard.config=proguard.cfg</p>
<p>如下</p>
<p><strong>[c-sharp]</strong> <a href="http://blog.csdn.net/Zengyangtech/article/details/6127600#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/Zengyangtech/article/details/6127600#" title="copy" target="_blank">copy</a></p>
<ol>
<li>/# This file is automatically generated by Android Tools.  </li>
<li>/# Do not modify this file -- YOUR CHANGES WILL BE ERASED!  </li>
<li>/#  </li>
<li>/# This file must be checked in Version Control Systems.  </li>
<li>/#  </li>
<li>/# To customize properties used by the Ant build system use,  </li>
<li>/# &quot;build.properties&quot;, and override values to adapt the script to your  </li>
<li>/# project structure.  </li>
<li>/# Project target.  </li>
<li>target=android-9  </li>
<li>proguard.config=proguard.cfg  </li>
</ol>
<p>然后正常的编译签名即可</p>
<p>然后用Android Tools生成一个发布的apk即可</p>
<p><img src="" alt=""></p>
<p>然后用反编译工具查看dex文件</p>
<p>最后导出反编译之后的混淆代码如下图</p>
<p><img src="" alt=""></p>
<p>是不是很轻松加愉快!希望各位程序员都能保护好自己的Android代码!
来源： <a href="[http://blog.csdn.net/Zengyangtech/article/details/6127600](http://blog.csdn.net/Zengyangtech/article/details/6127600)">[http://blog.csdn.net/Zengyangtech/article/details/6127600](http://blog.csdn.net/Zengyangtech/article/details/6127600)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/proguard/">proguard</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/proguard/" class="label label-success">proguard</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-proguard--Android23代码混淆proguard技术介绍/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-proguard--Android23代码混淆proguard技术介绍" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-proguard--开源混淆工具ProGuard配置详解及配置实例/">开源混淆工具ProGuard配置详解及配置实例</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-proguard--开源混淆工具ProGuard配置详解及配置实例/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-proguard-">开源混淆工具ProGuard配置详解及配置实例</h1>
<p>开源混淆工具ProGuard配置详解及配置实例</p>
<p>ProGuard是一个免费的java类文件压缩,优化,混淆器.它探测并删除没有使用的类,字段,方法和属性.它删除没有用的说明并使用字节码得到最大优化.它使用无意义的名字来重命名类,字段和方法.</p>
<p>ProGuard的作用: </p>
<p>1.创建紧凑的代码文档是为了更快的网络传输,快速装载和更小的内存占用. 
2.创建的程序和程序库很难使用反向工程. 
3.所以它能删除来自源文件中的没有调用的代码 
4.充分利用java6的快速加载的优点来提前检测和返回java6中存在的类文件. </p>
<p><strong>参数： </strong></p>
<p>-include {filename}    从给定的文件中读取配置参数 
-basedirectory {directoryname}    指定基础目录为以后相对的档案名称 
-injars {class_path}    指定要处理的应用程序jar,war,ear和目录 
-outjars {class_path}    指定处理完后要输出的jar,war,ear和目录的名称 
-libraryjars {classpath}    指定要处理的应用程序jar,war,ear和目录所需要的程序库文件 
-dontskipnonpubliclibraryclasses    指定不去忽略非公共的库类。 
-dontskipnonpubliclibraryclassmembers    指定不去忽略包可见的库类的成员。 
<strong>保留选项 </strong>
-keep {Modifier} {class_specification}    保护指定的类文件和类的成员 
-keepclassmembers {modifier} {class_specification}    保护指定类的成员，如果此类受到保护他们会保护的更好 
-keepclasseswithmembers {class_specification}    保护指定的类和类的成员，但条件是所有指定的类和类成员是要存在。 
-keepnames {class_specification}    保护指定的类和类的成员的名称（如果他们不会压缩步骤中删除） 
-keepclassmembernames {class_specification}    保护指定的类的成员的名称（如果他们不会压缩步骤中删除） 
-keepclasseswithmembernames {class_specification}    保护指定的类和类的成员的名称，如果所有指定的类成员出席（在压缩步骤之后） 
-printseeds {filename}    列出类和类的成员-keep选项的清单，标准输出到给定的文件 </p>
<p><strong>压缩 </strong>
-dontshrink    不压缩输入的类文件 
-printusage {filename} 
-whyareyoukeeping {class_specification}     </p>
<p><strong>优化 </strong>
-dontoptimize    不优化输入的类文件 
-assumenosideeffects {class_specification}    优化时假设指定的方法，没有任何副作用 
-allowaccessmodification    优化时允许访问并修改有修饰符的类和类的成员 </p>
<p><strong>混淆 </strong>
-dontobfuscate    不混淆输入的类文件 
-printmapping {filename} 
-applymapping {filename}    重用映射增加混淆 
-obfuscationdictionary {filename}    使用给定文件中的关键字作为要混淆方法的名称 
-overloadaggressively    混淆时应用侵入式重载 
-useuniqueclassmembernames    确定统一的混淆类的成员名称来增加混淆 
-flattenpackagehierarchy {package_name}    重新包装所有重命名的包并放在给定的单一包中 
-repackageclass {package_name}    重新包装所有重命名的类文件中放在给定的单一包中 
-dontusemixedcaseclassnames    混淆时不会产生形形色色的类名 
-keepattributes {attribute_name,...}    保护给定的可选属性，例如LineNumberTable, LocalVariableTable, SourceFile, Deprecated, Synthetic, Signature, and InnerClasses. 
-renamesourcefileattribute {string}    设置源文件中给定的字符串常量
<strong>Ant Example:</strong>
<!-- This Ant build file illustrates how to process applications,
     by including ProGuard-style configuration options.
     Usage: ant -f applications2.xml --></p>
<p><project name="Applications" default="obfuscate" basedir="../.."></p>
<p><target name="obfuscate">
  <taskdef resource="proguard/ant/task.properties"
           classpath="lib/proguard.jar" />
  <proguard>
    <!-- Specify the input jars, output jars, and library jars. -->
    -injars  in.jar
    -outjars out.jar
    -libraryjars ${java.home}/lib/rt.jar
    <!-- -libraryjars junit.jar    -->
    <!-- -libraryjars servlet.jar  -->
    <!-- -libraryjars jai_core.jar -->
    <!-- ...                       -->
    <!-- Save the obfuscation mapping to a file, and preserve line numbers. -->
    -printmapping out.map
    -renamesourcefileattribute SourceFile
    -keepattributes SourceFile,LineNumberTable
    <!-- Preserve all annotations. -->
    -keepattributes /<em>Annotation/</em>
    <!-- Preserve all public applications. -->
    -keepclasseswithmembers public class /<em> {
        public static void main(java.lang.String[]);
    }
    <!-- Preserve all native method names and the names of their classes. -->
    -keepclasseswithmembernames class /</em> {
        native &lt;methods&gt;;
    }
    <!-- Preserve the methods that are required in all enumeration classes. -->
    -keepclassmembers class /<em> extends java.lang.Enum {
        public static /</em>/<em>[] values();
        public static /</em>/<em> valueOf(java.lang.String);
    }
    <!-- Explicitly preserve all serialization members. The Serializable
         interface is only a marker interface, so it wouldn't save them.
         You can comment this out if your library doesn't use serialization.
         If your code contains serializable classes that have to be backward
         compatible, please refer to the manual. -->
    -keepclassmembers class /</em> implements java.io.Serializable {
        static final long serialVersionUID;
        static final java.io.ObjectStreamField[] serialPersistentFields;
        private void writeObject(java.io.ObjectOutputStream);
        private void readObject(java.io.ObjectInputStream);
        java.lang.Object writeReplace();
        java.lang.Object readResolve();
    }
    <!-- Your application may contain more items that need to be preserved;
         typically classes that are dynamically created using Class.forName -->
  </proguard>
</target>
</project>
来源： <a href="[http://www.kaiyuanba.cn/html/1/131/138/7820.htm](http://www.kaiyuanba.cn/html/1/131/138/7820.htm)">[http://www.kaiyuanba.cn/html/1/131/138/7820.htm](http://www.kaiyuanba.cn/html/1/131/138/7820.htm)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/proguard/">proguard</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/proguard/" class="label label-success">proguard</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-proguard--开源混淆工具ProGuard配置详解及配置实例/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-proguard--开源混淆工具ProGuard配置详解及配置实例" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-java深入分析--JDKJREJVM区别/">JDKJREJVM区别</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-java深入分析--JDKJREJVM区别/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="jdkjrejvm-">JDKJREJVM区别</h1>
<p><strong><a href="http://java-mzd.iteye.com/blog/838514" target="_blank">JDK,JRE,JVM区别与联系</a></strong></p>
<p><strong>文章分类**</strong>:<a href="http://www.iteye.com/blogs/category/java" target="_blank">Java编程</a>**</p>
<pre><code>很多朋友可能跟我一样，已经使用JAVA开发很久了，可是对JDK,JRE,JVM这三者的联系与区别，一直都是模模糊糊的。

今天特写此文，来整理下三者的关系。



JDK : Java Development ToolKit(Java开发工具包)。JDK是整个JAVA的核心，包括了Java运行环境（Java Runtime Envirnment），一堆Java工具（javac/java/jdb等）和Java基础的类库（即Java API 包括rt.jar）。

最主流的JDK是Sun公司发布的JDK，除了Sun之外，还有很多公司和组织都开发了属于自己的JDK，例如国外IBM公司开发了属于自己的JDK，国内淘宝也开发了属于自己的JDK，各个组织开发自己的JDK都是为了在某些方面得到一些提高，以适应自己的需求，比如IBM的JDK据说运行效率就比SUN的JDK高的多。但不管怎么说，我们还是需要先把基础的Sun JDK掌握好。

JDK有以下三种版本：
</code></pre><p>J2SE，standard edition，标准版，是我们通常用的一个版本J2EE，enterpsise edtion，企业版，使用这种JDK开发J2EE应用程序J2ME，micro edtion，主要用于移动设备、嵌入式设备上的java应用程序</p>
<pre><code>我们常常用JDK来代指Java API，Java API是Java的应用程序接口，其实就是前辈们写好的一些java Class，包括一些重要的语言结构以及基本图形，网络和文件I/O等等 ，我们在自己的程序中，调用前辈们写好的这些Class，来作为我们自己开发的一个基础。当然，现在已经有越来越多的性能更好或者功能更强大的第三方类库供我们使用。



JRE:Java  Runtime  Enviromental(java运行时环境)。也就是我们说的JAVA平台，所有的Java程序都要在JRE下才能运行。包括JVM和JAVA核心类库和支持文件。与JDK相比，它不包含开发工具——编译器、调试器和其它工具。



JVM：Java Virtual Mechinal(JAVA虚拟机)。JVM是JRE的一部分，它是一个虚构出来的计算机，是通过在实际的计算机上仿真模拟各种计算机功能来实现的。JVM有自己完善的硬件架构，如处理器、堆栈、寄存器等，还具有相应的指令系统。JVM 的主要工作是解释自己的指令集（即字节码）并映射到本地的 CPU 的指令集或 OS 的系统调用。Java语言是跨平台运行的，其实就是不同的操作系统，使用不同的JVM映射规则，让其与操作系统无关，完成了跨平台性。JVM 对上层的Java 源文件是不关心的，它关注的只是由源文件生成的类文件（ class file ）。类文件的组成包括JVM 指令集，符号表以及一些补助信息。
</code></pre><p>下图很好的表面了JDK,JRE,JVM三者间的关系：</p>
<p><img src="" alt="http://dl.iteye.com/upload/attachment/364841/7dbc84af-e878-3718-beb5-6471ad99b995.gif"></p>
<pre><code>我们开发的实际情况是：我们利用JDK（调用JAVA API）开发了属于我们自己的JAVA程序后，通过JDK中的编译程序（javac）将我们的文本java文件编译成JAVA字节码，在JRE上运行这些JAVA字节码，JVM解析这些字节码，映射到CPU指令集或OS的系统调用。
</code></pre><p>url: <a href="http://java-mzd.iteye.com/blog/838514" target="_blank">http://java-mzd.iteye.com/blog/838514</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/java深入分析/">java深入分析</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/java深入分析/" class="label label-success">java深入分析</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-java深入分析--JDKJREJVM区别/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-java深入分析--JDKJREJVM区别" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/57/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/55/">55</a></li><li><a class="page-number" href="/page/56/">56</a></li><li><a class="page-number" href="/page/57/">57</a></li><li class="active"><li><span class="page-number current">58</span></li><li><a class="page-number" href="/page/59/">59</a></li><li><a class="page-number" href="/page/60/">60</a></li><li><a class="page-number" href="/page/61/">61</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/59/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 16:33:41</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
