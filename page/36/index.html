
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 36 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-连接池--druid教程/">druid 教程</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:43.000Z"> <a href="/2014/02/02/2014-02-02-连接池--druid教程/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="druid-">druid 教程</h1>
<pre><code> java程序很大一部分要操作数据库，为了提高性能操作数据库的时候，有不得不使用数据库连接池。数据库连接池有很多选择，c3p、dhcp、proxool等，druid作为一名后起之秀，凭借其出色的性能，也逐渐印入了大家的眼帘。接下来本教程就说一下druid的简单使用。
</code></pre><p> 首先从<a href="http://repo1.maven.org/maven2/com/alibaba/druid/" target="_blank"><a href="http://repo1.maven.org/maven2/com/alibaba/druid/">http://repo1.maven.org/maven2/com/alibaba/druid/</a></a> 下载最新的jar包。如果想使用最新的源码编译，可以从<a href="https://github.com/alibaba/druid" target="_blank"><a href="https://github.com/alibaba/druid">https://github.com/alibaba/druid</a></a> 下载源码，然后使用maven命令行，或者导入到eclipse中进行编译。</p>
<h2 id="-1-"><a href=""></a>1 配置</h2>
<p>和dbcp类似，druid的配置项如下</p>
<p>配置 缺省值 说明 name   配置这个属性的意义在于，如果存在多个数据源，监控的时候
可以通过名字来区分开来。如果没有配置，将会生成一个名字，
格式是：&quot;DataSource-&quot; + System.identityHashCode(this) jdbcUrl   连接数据库的url，不同数据库不一样。例如：
mysql : jdbc:mysql://10.20.153.104:3306/druid2 
oracle : jdbc:oracle:thin:@10.20.149.85:1521:ocnauto username   连接数据库的用户名 password   连接数据库的密码。如果你不希望密码直接写在配置文件中，
可以使用ConfigFilter。详细看这里：
<a href="https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter" target="_blank"><a href="https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter">https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter</a></a> driverClassName 根据url自动识别 这一项可配可不配，如果不配置druid会根据url自动识别dbType，
然后选择相应的driverClassName initialSize 0 初始化时建立物理连接的个数。初始化发生在显示调用init方法，
或者第一次getConnection时 maxActive 8 最大连接池数量 maxIdle 8 已经不再使用，配置了也没效果 minIdle   最小连接池数量 maxWait   获取连接时最大等待时间，单位毫秒。配置了maxWait之后，
缺省启用公平锁，并发效率会有所下降，
如果需要可以通过配置useUnfairLock属性为true使用非公平锁。 poolPreparedStatements false 是否缓存preparedStatement，也就是PSCache。
PSCache对支持游标的数据库性能提升巨大，比如说oracle。
在mysql下建议关闭。 maxOpenPreparedStatements -1 要启用PSCache，必须配置大于0，当大于0时，
poolPreparedStatements自动触发修改为true。
在Druid中，不会存在Oracle下PSCache占用内存过多的问题，
可以把这个数值配置大一些，比如说100 validationQuery   用来检测连接是否有效的sql，要求是一个查询语句。
如果validationQuery为null，testOnBorrow、testOnReturn、
testWhileIdle都不会其作用。 testOnBorrow true 申请连接时执行validationQuery检测连接是否有效，
做了这个配置会降低性能。 testOnReturn false 归还连接时执行validationQuery检测连接是否有效，
做了这个配置会降低性能 testWhileIdle false 建议配置为true，不影响性能，并且保证安全性。
申请连接的时候检测，如果空闲时间大于
timeBetweenEvictionRunsMillis，
执行validationQuery检测连接是否有效。 timeBetweenEvictionRunsMillis   有两个含义：
1) Destroy线程会检测连接的间隔时间
 2) testWhileIdle的判断依据，详细看testWhileIdle属性的说明 numTestsPerEvictionRun   不再使用，一个DruidDataSource只支持一个EvictionRun minEvictableIdleTimeMillis     connectionInitSqls   物理连接初始化的时候执行的sql exceptionSorter 根据dbType自动识别 当数据库抛出一些不可恢复的异常时，抛弃连接 filters   属性类型是字符串，通过别名的方式配置扩展插件，
常用的插件有：
监控统计用的filter:stat 
日志用的filter:log4j
 防御sql注入的filter:wall proxyFilters   类型是List<com.alibaba.druid.filter.Filter>，
如果同时配置了filters和proxyFilters，
是组合关系，并非替换关系<strong>表1.1 配置属性</strong></p>
<p>根据常用的配置属性，首先给出一个如下的配置文件，放置于src目录下。</p>
<p><strong>[plain]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>url:jdbc:mysql://localhost:3306/dragoon_v25_masterdb  </li>
<li>driverClassName:com.mysql.jdbc.Driver  </li>
<li>username:root  </li>
<li>password:aaaaaaaa  </li>
<li></li>
<li>filters:stat  </li>
<li></li>
<li>maxActive:20  </li>
<li>initialSize:1  </li>
<li>maxWait:60000  </li>
<li>minIdle:10  </li>
<li>/#maxIdle:15  </li>
<li></li>
<li>timeBetweenEvictionRunsMillis:60000  </li>
<li>minEvictableIdleTimeMillis:300000  </li>
<li></li>
<li>validationQuery:SELECT &#39;x&#39;  </li>
<li>testWhileIdle:true  </li>
<li>testOnBorrow:false  </li>
<li>testOnReturn:false  </li>
<li>/#poolPreparedStatements:true  </li>
<li>maxOpenPreparedStatements:20  </li>
<li></li>
<li>/#对于长时间不使用的连接强制关闭  </li>
<li>removeAbandoned:true  </li>
<li>/#超过30分钟开始关闭空闲连接  </li>
<li>removeAbandonedTimeout:1800  </li>
<li>/#将当前关闭动作记录到日志  </li>
<li>logAbandoned:true  </li>
</ol>
<p><strong>配置文件1.1 </strong></p>
<p>配置项中指定了各个参数后，在连接池内部是这么使用这些参数的。数据库连接池在初始化的时候会创建initialSize个连接，当有数据库操作时，会从池中取出一个连接。如果当前池中正在使用的连接数等于maxActive，则会等待一段时间，等待其他操作释放掉某一个连接，如果这个等待时间超过了maxWait，则会报错；如果当前正在使用的连接数没有达到maxActive，则判断当前是否空闲连接，如果有则直接使用空闲连接，如果没有则新建立一个连接。在连接使用完毕后，不是将其物理连接关闭，而是将其放入池中等待其他操作复用。</p>
<p>同时连接池内部有机制判断，如果当前的总的连接数少于miniIdle，则会建立新的空闲连接，以保证连接数得到miniIdle。如果当前连接池中某个连接在空闲了timeBetweenEvictionRunsMillis时间后任然没有使用，则被物理性的关闭掉。有些数据库连接的时候有超时限制（mysql连接在8小时后断开），或者由于网络中断等原因，连接池的连接会出现失效的情况，这时候设置一个testWhileIdle参数为true，可以保证连接池内部定时检测连接的可用性，不可用的连接会被抛弃或者重建，最大情况的保证从连接池中得到的Connection对象是可用的。当然，为了保证绝对的可用性，你也可以使用testOnBorrow为true（即在获取Connection对象时检测其可用性），不过这样会影响性能。</p>
<h2 id="-2-"><a href=""></a>2 代码编写</h2>
<h3 id="-2-1-spring"><a href=""></a>2.1 使用spring</h3>
<p>首先给出spring配置文件</p>
<p><strong>[html]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;  </li>
<li>&lt;beans xmlns=&quot;<a href="http://www.springframework.org/schema/beans" target="_blank">http://www.springframework.org/schema/beans</a>&quot;  </li>
<li>xmlns:xsi=&quot;<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>&quot;  </li>
<li>xsi:schemaLocation=&quot;<a href="http://www.springframework.org/schema/mvc" target="_blank">http://www.springframework.org/schema/mvc</a> <a href="http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd" target="_blank">http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd</a>  </li>
<li><a href="http://www.springframework.org/schema/beans" target="_blank">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans-3.0.xsd" target="_blank">http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</a>  </li>
<li><a href="http://www.springframework.org/schema/context" target="_blank">http://www.springframework.org/schema/context</a> <a href="http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot;&gt;" target="_blank">http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot;&gt;</a>  </li>
<li><!-- 给web使用的spring文件 -->  </li>
<li>&lt;bean id=&quot;propertyConfigurer&quot;  </li>
<li>class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt;  </li>
<li><property name="locations">  </li>
<li><list>  </li>
<li><value>/WEB-INF/classes/dbconfig.properties</value>  </li>
<li></list>  </li>
<li></property>  </li>
<li></bean>  </li>
<li>&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;  </li>
<li>destroy-method=&quot;close&quot;&gt;  </li>
<li><property name="url" value="${url}" />  </li>
<li><property name="username" value="${username}" />  </li>
<li><property name="password" value="${password}" />  </li>
<li><property name="driverClassName" value="${driverClassName}" />  </li>
<li><property name="filters" value="${filters}" />  </li>
<li></li>
<li><property name="maxActive" value="${maxActive}" />  </li>
<li><property name="initialSize" value="${initialSize}" />  </li>
<li><property name="maxWait" value="${maxWait}" />  </li>
<li><property name="minIdle" value="${minIdle}" />  </li>
<li></li>
<li><property name="timeBetweenEvictionRunsMillis" value="${timeBetweenEvictionRunsMillis}" />  </li>
<li><property name="minEvictableIdleTimeMillis" value="${minEvictableIdleTimeMillis}" />  </li>
<li></li>
<li><property name="validationQuery" value="${validationQuery}" />  </li>
<li><property name="testWhileIdle" value="${testWhileIdle}" />  </li>
<li><property name="testOnBorrow" value="${testOnBorrow}" />  </li>
<li><property name="testOnReturn" value="${testOnReturn}" />  </li>
<li>&lt;property name=&quot;maxOpenPreparedStatements&quot;  </li>
<li>value=&quot;${maxOpenPreparedStatements}&quot; /&gt;  </li>
<li><property name="removeAbandoned" value="${removeAbandoned}" /> <!-- 打开removeAbandoned功能 -->  </li>
<li><property name="removeAbandonedTimeout" value="${removeAbandonedTimeout}" /> <!-- 1800秒，也就是30分钟 -->  </li>
<li><property name="logAbandoned" value="${logAbandoned}" /> <!-- 关闭abanded连接时输出错误日志 -->  </li>
<li></bean>  </li>
<li></li>
<li>&lt;bean id=&quot;dataSourceDbcp&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;  </li>
<li>destroy-method=&quot;close&quot;&gt;  </li>
<li></li>
<li><property name="driverClassName" value="${driverClassName}" />  </li>
<li><property name="url" value="${url}" />  </li>
<li><property name="username" value="${username}" />  </li>
<li><property name="password" value="${password}" />  </li>
<li></li>
<li><property name="maxActive" value="${maxActive}" />  </li>
<li><property name="minIdle" value="${minIdle}" />  </li>
<li><property name="maxWait" value="${maxWait}" />  </li>
<li><property name="defaultAutoCommit" value="true" />  </li>
<li></li>
<li><property name="timeBetweenEvictionRunsMillis" value="${timeBetweenEvictionRunsMillis}" />  </li>
<li><property name="minEvictableIdleTimeMillis" value="${minEvictableIdleTimeMillis}" />  </li>
<li></li>
<li><property name="validationQuery" value="${validationQuery}" />  </li>
<li><property name="testWhileIdle" value="${testWhileIdle}" />  </li>
<li><property name="testOnBorrow" value="${testOnBorrow}" />  </li>
<li><property name="testOnReturn" value="${testOnReturn}" />  </li>
<li>&lt;property name=&quot;maxOpenPreparedStatements&quot;  </li>
<li>value=&quot;${maxOpenPreparedStatements}&quot; /&gt;  </li>
<li><property name="removeAbandoned" value="${removeAbandoned}" />   </li>
<li><property name="removeAbandonedTimeout" value="${removeAbandonedTimeout}" />  </li>
<li><property name="logAbandoned" value="${logAbandoned}" />  </li>
<li></bean>  </li>
<li></li>
<li></li>
<li><!-- jdbcTemplate -->  </li>
<li><bean id="jdbc" class="org.springframework.jdbc.core.JdbcTemplate">  </li>
<li><property name="dataSource">  </li>
<li><ref bean="dataSource" />  </li>
<li></property>  </li>
<li></bean>  </li>
<li></li>
<li>&lt;bean id=&quot;SpringTableOperatorBean&quot; class=&quot;com.whyun.druid.model.TableOperator&quot;  </li>
<li>scope=&quot;prototype&quot;&gt;  </li>
<li><property name="dataSource">  </li>
<li><ref bean="dataSource" />  </li>
<li></property>  </li>
<li></bean>  </li>
<li></li>
<li></beans>  </li>
</ol>
<p><strong>配置文件2.1</strong></p>
<p>其中第一个bean中给出的配置文件/WEB-INF/classes/dbconfig.properties就是第1节中给出的配置文件。我这里还特地给出dbcp的spring配置项，目的就是将两者进行对比，方便大家进行迁移。这里没有使用JdbcTemplate，所以jdbc那个bean没有使用到。下面给出com.whyun.druid.model.TableOperator类的代码。</p>
<p><strong>[java]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>package com.whyun.druid.model;  </li>
<li></li>
<li>import java.sql.Connection;  </li>
<li>import java.sql.PreparedStatement;  </li>
<li>import java.sql.SQLException;  </li>
<li>import java.sql.Statement;  </li>
<li></li>
<li>import javax.sql.DataSource;  </li>
<li></li>
<li>public class TableOperator {  </li>
<li>private DataSource dataSource;  </li>
<li>public void setDataSource(DataSource dataSource) {  </li>
<li>this.dataSource = dataSource;  </li>
<li>}  </li>
<li></li>
<li>private static final int COUNT = 800;      </li>
<li></li>
<li>public TableOperator() {  </li>
<li></li>
<li>}  </li>
<li></li>
<li>public void tearDown() throws Exception {  </li>
<li>try {  </li>
<li>dropTable();  </li>
<li>} catch (SQLException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}         </li>
<li>}  </li>
<li></li>
<li>public void insert() throws Exception {  </li>
<li></li>
<li>StringBuffer ddl = new StringBuffer();  </li>
<li>ddl.append(&quot;INSERT INTO t_big (&quot;);  </li>
<li>for (int i = 0; i &lt; COUNT; ++i) {  </li>
<li>if (i != 0) {  </li>
<li>ddl.append(&quot;, &quot;);  </li>
<li>}  </li>
<li>ddl.append(&quot;F&quot; + i);  </li>
<li>}  </li>
<li>ddl.append(&quot;) VALUES (&quot;);  </li>
<li>for (int i = 0; i &lt; COUNT; ++i) {  </li>
<li>if (i != 0) {  </li>
<li>ddl.append(&quot;, &quot;);  </li>
<li>}  </li>
<li>ddl.append(&quot;?&quot;);  </li>
<li>}  </li>
<li>ddl.append(&quot;)&quot;);  </li>
<li></li>
<li>Connection conn = dataSource.getConnection();  </li>
<li></li>
<li>//        System.out.println(ddl.toString());  </li>
<li></li>
<li>PreparedStatement stmt = conn.prepareStatement(ddl.toString());  </li>
<li></li>
<li>for (int i = 0; i &lt; COUNT; ++i) {  </li>
<li>stmt.setInt(i + 1, i);  </li>
<li>}  </li>
<li>stmt.execute();  </li>
<li>stmt.close();  </li>
<li></li>
<li>conn.close();  </li>
<li>}  </li>
<li></li>
<li>private void dropTable() throws SQLException {  </li>
<li></li>
<li>Connection conn = dataSource.getConnection();  </li>
<li></li>
<li>Statement stmt = conn.createStatement();  </li>
<li>stmt.execute(&quot;DROP TABLE t_big&quot;);  </li>
<li>stmt.close();  </li>
<li></li>
<li>conn.close();  </li>
<li>}  </li>
<li></li>
<li>public void createTable() throws SQLException {  </li>
<li>StringBuffer ddl = new StringBuffer();  </li>
<li>ddl.append(&quot;CREATE TABLE t_big (FID INT AUTO_INCREMENT PRIMARY KEY &quot;);  </li>
<li>for (int i = 0; i &lt; COUNT; ++i) {  </li>
<li>ddl.append(&quot;, &quot;);  </li>
<li>ddl.append(&quot;F&quot; + i);  </li>
<li>ddl.append(&quot; BIGINT NULL&quot;);  </li>
<li>}  </li>
<li>ddl.append(&quot;)&quot;);  </li>
<li></li>
<li>Connection conn = dataSource.getConnection();  </li>
<li></li>
<li>Statement stmt = conn.createStatement();  </li>
<li>stmt.execute(ddl.toString());  </li>
<li>stmt.close();  </li>
<li></li>
<li>conn.close();  </li>
<li>}  </li>
<li>}  </li>
</ol>
<p><strong>代码片段2.1</strong></p>
<p><strong>注意：在使用的时候，通过获取完Connection对象，在使用完之后，要将其close掉，这样其实是将用完的连接放入到连接池中，如果你不close的话，会造成连接泄露。</strong>
然后我们写一个servlet来测试他.</p>
<p><strong>[java]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>package com.whyun.druid.servelt;  </li>
<li></li>
<li>import java.io.IOException;  </li>
<li>import java.io.PrintWriter;  </li>
<li>import java.sql.SQLException;  </li>
<li></li>
<li>import javax.servlet.ServletContext;  </li>
<li>import javax.servlet.ServletException;  </li>
<li>import javax.servlet.http.HttpServlet;  </li>
<li>import javax.servlet.http.HttpServletRequest;  </li>
<li>import javax.servlet.http.HttpServletResponse;  </li>
<li></li>
<li>import org.springframework.web.context.WebApplicationContext;  </li>
<li>import org.springframework.web.context.support.WebApplicationContextUtils;  </li>
<li></li>
<li>import com.whyun.druid.model.TableOperator;  </li>
<li></li>
<li>public class TestServlet extends HttpServlet {  </li>
<li>private TableOperator operator;  </li>
<li></li>
<li></li>
<li>@Override  </li>
<li>public void init() throws ServletException {  </li>
<li></li>
<li>super.init();  </li>
<li>ServletContext servletContext = this.getServletContext();     </li>
<li></li>
<li>WebApplicationContext ctx  </li>
<li>= WebApplicationContextUtils.getWebApplicationContext(servletContext);  </li>
<li>operator = (TableOperator)ctx.getBean(&quot;SpringTableOperatorBean&quot;);  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* The doGet method of the servlet. <br> </li>
<li>/* </li>
<li>/* This method is called when a form has its tag value method equals to get. </li>
<li>/*  </li>
<li>/* @param request the request send by the client to the server </li>
<li>/* @param response the response send by the server to the client </li>
<li>/* @throws ServletException if an error occurred </li>
<li>/* @throws IOException if an error occurred </li>
<li>/*/  </li>
<li>public void doGet(HttpServletRequest request, HttpServletResponse response)  </li>
<li>throws ServletException, IOException {  </li>
<li></li>
<li>response.setContentType(&quot;text/html&quot;);  </li>
<li>PrintWriter out = response.getWriter();  </li>
<li></li>
<li>boolean createResult = false;  </li>
<li>boolean insertResult = false;  </li>
<li>boolean dropResult = false;  </li>
<li></li>
<li>try {  </li>
<li>operator.createTable();  </li>
<li>createResult = true;  </li>
<li>} catch (SQLException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>if (createResult) {  </li>
<li>try {  </li>
<li>operator.insert();  </li>
<li>insertResult = true;  </li>
<li>} catch (Exception e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>try {  </li>
<li>operator.tearDown();  </li>
<li>dropResult = true;  </li>
<li>} catch (Exception e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li></li>
<li>out.println(&quot;{&#39;createResult&#39;:&quot;+createResult+&quot;,&#39;insertResult&#39;:&quot;  </li>
<li>+insertResult+&quot;,&#39;dropResult&#39;:&quot;+dropResult+&quot;}&quot;);  </li>
<li></li>
<li>out.flush();  </li>
<li>out.close();  </li>
<li>}  </li>
<li></li>
<li>}<br><strong>代码片段2.2</strong></li>
</ol>
<p>这里没有用到struts2或者springmvc，虽然大部分开发者用的是这两种框架。</p>
<h3 id="-2-2-spring"><a href=""></a>2.2 不使用spring</h3>
<p>类似于dbcp，druid也提供了原生态的支持。先看下面这段代码：</p>
<p><strong>[java]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>package com.whyun.util.db;  </li>
<li></li>
<li>import javax.sql.DataSource;  </li>
<li></li>
<li>import org.apache.commons.dbcp.BasicDataSourceFactory;  </li>
<li></li>
<li>import com.alibaba.druid.pool.DruidDataSourceFactory;  </li>
<li>import com.whyun.util.config.MySqlConfigProperty;  </li>
<li>import com.whyun.util.config.MySqlConfigProperty2;  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* The Class DataSourceUtil. </li>
<li>/*/  </li>
<li>public class DataSourceUtil {  </li>
<li></li>
<li>//<em>/</em> 使用配置文件dbconfig.properties构建Druid数据源. /*/  </li>
<li>public static final int DRUID_MYSQL_SOURCE = 0;  </li>
<li></li>
<li>//<em>/</em> 使用配置文件dbconfig2.properties构建Druid数据源. /*/  </li>
<li>public static final int DRUID_MYSQL_SOURCE2 = 1;  </li>
<li></li>
<li>//<em>/</em> 使用配置文件dbconfig.properties构建Dbcp数据源. /*/  </li>
<li>public static final int DBCP_SOURCE = 4;  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 根据类型获取数据源 </li>
<li>/* </li>
<li>/* @param sourceType 数据源类型 </li>
<li>/* @return druid或者dbcp数据源 </li>
<li>/* @throws Exception the exception </li>
<li>/*/  </li>
<li>public static final DataSource getDataSource(int sourceType)  </li>
<li>throws Exception {  </li>
<li>DataSource dataSource = null;  </li>
<li>switch(sourceType) {  </li>
<li>case DRUID_MYSQL_SOURCE:              </li>
<li>dataSource = DruidDataSourceFactory.createDataSource(  </li>
<li>MySqlConfigProperty.getInstance().getProperties());               </li>
<li>break;  </li>
<li>case DRUID_MYSQL_SOURCE2:  </li>
<li>dataSource = DruidDataSourceFactory.createDataSource(  </li>
<li>MySqlConfigProperty2.getInstance().getProperties());  </li>
<li>break;  </li>
<li>case DBCP_SOURCE:  </li>
<li>dataSource = BasicDataSourceFactory.createDataSource(  </li>
<li>MySqlConfigProperty.getInstance().getProperties());  </li>
<li>break;  </li>
<li>}  </li>
<li>return dataSource;  </li>
<li>}  </li>
<li>}  </li>
</ol>
<p><strong>代码片段2.3 手动读取配置文件初始化连接池</strong></p>
<p>第37行中调用了类com.alibaba.druid.pool.DruidDataSourceFactory中createDataSource方法来初始化一个连接池。对比dbcp的使用方法，两者很相似。</p>
<p>下面给出一个多线程的测试程序。运行后可以比较druid和dbcp的性能差别。</p>
<p><strong>[java]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>package com.whyun.druid.test;  </li>
<li></li>
<li>import java.sql.SQLException;  </li>
<li>import java.util.ArrayList;  </li>
<li>import java.util.List;  </li>
<li>import java.util.concurrent.Callable;  </li>
<li>import java.util.concurrent.ExecutorService;  </li>
<li>import java.util.concurrent.Executors;  </li>
<li>import java.util.concurrent.Future;  </li>
<li>import java.util.concurrent.TimeUnit;  </li>
<li></li>
<li>import com.whyun.druid.model.TableOperator;  </li>
<li>import com.whyun.util.db.DataSourceUtil;  </li>
<li></li>
<li>public class MutilThreadTest {  </li>
<li>public static void test(int dbType, int times)  </li>
<li>throws Exception {   </li>
<li>int numOfThreads =Runtime.getRuntime().availableProcessors()/*2;  </li>
<li>ExecutorService executor = Executors.newFixedThreadPool(numOfThreads);    </li>
<li>final TableOperator test = new TableOperator();  </li>
<li>//        int dbType = DataSourceUtil.DRUID_MYSQL_SOURCE;  </li>
<li>//        dbType = DataSourceUtil.DBCP_SOURCE;  </li>
<li>test.setDataSource(DataSourceUtil.getDataSource(dbType));  </li>
<li></li>
<li>boolean createResult = false;  </li>
<li>try {  </li>
<li>test.createTable();  </li>
<li>createResult = true;  </li>
<li>} catch (SQLException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>if (createResult) {  </li>
<li>List<Future<Long>&gt; results = new ArrayList<Future<Long>&gt;();     </li>
<li>for (int i = 0; i &lt; times; i++) {    </li>
<li>results.add(executor.submit(new Callable<Long>() {    </li>
<li>@Override    </li>
<li>public Long call() throws Exception {    </li>
<li>long begin = System.currentTimeMillis();  </li>
<li>try {  </li>
<li>test.insert();  </li>
<li>//insertResult = true;  </li>
<li>} catch (Exception e) {  </li>
<li>e.printStackTrace();  </li>
<li>}                             </li>
<li>long end = System.currentTimeMillis();    </li>
<li>return end - begin;    </li>
<li>}    </li>
<li>}));    </li>
<li>}    </li>
<li>executor.shutdown();    </li>
<li>while(!executor.awaitTermination(Long.MAX_VALUE, TimeUnit.DAYS));    </li>
<li></li>
<li>long sum = 0;    </li>
<li>for (Future<Long> result : results) {    </li>
<li>sum += result.get();    </li>
<li>}    </li>
<li></li>
<li></li>
<li>System.out.println(&quot;---------------db type &quot;+dbType+&quot;------------------&quot;);    </li>
<li>System.out.println(&quot;number of threads :&quot; + numOfThreads + &quot; times:&quot; + times);    </li>
<li>System.out.println(&quot;running time: &quot; + sum + &quot;ms&quot;);    </li>
<li>System.out.println(&quot;TPS: &quot; + (double)(100000 /* 1000) / (double)(sum));    </li>
<li>System.out.println();    </li>
<li>try {  </li>
<li>test.tearDown();  </li>
<li>//dropResult = true;  </li>
<li>} catch (Exception e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>} else {  </li>
<li>System.out.println(&quot;初始化数据库失败&quot;);  </li>
<li>}  </li>
<li></li>
<li>}    </li>
<li></li>
<li>public static void main (String argc[])  </li>
<li>throws Exception {  </li>
<li>test(DataSourceUtil.DBCP_SOURCE,50);  </li>
<li>test(DataSourceUtil.DRUID_MYSQL_SOURCE,50);  </li>
<li></li>
<li>}  </li>
<li>}  </li>
</ol>
<p><strong>代码片段2.4 连接池多线程测试程序</strong></p>
<hr>
<h2 id="-3-"><a href=""></a><strong>3 监控</strong></h2>
<h3 id="-3-1-web-"><a href=""></a><strong>3.1 web监控</strong></h3>
<p>druid提供了sql语句查询时间等信息的监控功能。为了让数据库查询一直运行，下面特地写了一个ajax进行轮询。同时，还要保证在web.xml中配置如下信息</p>
<p><strong>[html]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li><servlet>  </li>
<li><servlet-name>DruidStatView</servlet-name>  </li>
<li><servlet-class>com.alibaba.druid.support.http.StatViewServlet</servlet-class>  </li>
<li></servlet>  </li>
<li><servlet-mapping>  </li>
<li><servlet-name>DruidStatView</servlet-name>  </li>
<li><url-pattern>/druid//*</url-pattern>  </li>
<li></servlet-mapping><br><strong>配置文件3.1 在web.xml中添加druid监控</strong></li>
</ol>
<p><em>**</em>同时将ajax代码提供如下</p>
<p><strong>[javascript]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>function showTime() {  </li>
<li>var myDate = new Date();  </li>
<li>var timeStr = &#39;&#39;;  </li>
<li>timeStr += myDate.getFullYear()+&#39;-&#39;; //获取完整的年份(4位,1970-????)  </li>
<li>timeStr += myDate.getMonth()+&#39;-&#39;;      //获取当前月份(0-11,0代表1月)  </li>
<li>timeStr += myDate.getDate() + &#39; &#39;;      //获取当前日(1-31)  </li>
<li>timeStr += myDate.getHours()+&#39;:&#39;;      //获取当前小时数(0-23)  </li>
<li>timeStr += myDate.getMinutes()+&#39;:&#39;;    //获取当前分钟数(0-59)  </li>
<li>timeStr += myDate.getSeconds();    //获取当前秒数(0-59)  </li>
<li>return timeStr  </li>
<li>}  </li>
<li>$(document).ready(function() {  </li>
<li>function loadDBTestMessage() {  </li>
<li>$.get(&#39;servlet/MysqlTestServlet&#39;,function(data) {  </li>
<li>if (typeof(data) != &#39;object&#39;) {  </li>
<li>data = eval(&#39;(&#39; + data + &#39;)&#39;);  </li>
<li>}  </li>
<li>var html = &#39;[&#39;+showTime()+&#39;]&#39;;  </li>
<li>html += &#39;创建：&#39; + data[&#39;createResult&#39;];  </li>
<li>html +=  &#39;插入：&#39; + data[&#39;insertResult&#39;];  </li>
<li>html += &#39;销毁:&#39; + data[&#39;dropResult&#39;];  </li>
<li>html +=   </li>
<li>$(&#39;/#message&#39;).html(html);  </li>
<li>});  </li>
<li>}  </li>
<li></li>
<li>setInterval(function() {  </li>
<li>loadDBTestMessage();  </li>
<li>}, 10000);  </li>
<li>});<br><strong>代码片段3.1 ajax轮询</strong></li>
</ol>
<p>这时打开<a href="http://localhost/druid-web/druid/" target="_blank">http://localhost/druid-web/druid/</a> 地址，会看到监控界面，点击其中的sql标签。</p>
<p><img src="" alt=""></p>
<p><strong>图3.1 监控界面查看sql查询时间</strong></p>
<p><strong>注意：在写配置文件1.1时，要保证filter配置项中含有stat属性，否则这个地方看不到sql语句的监控数据。</strong></p>
<p>表格中各项含义如下</p>
<hr>
<p>名称</p>
<p>解释</p>
<p>备注 ExecuteCount</p>
<p>当前sql已执行次数 ExecTime</p>
<p>当前sql已执行时间 ExecMax</p>
<p>当前sql最大执行时间 Txn</p>
<p>当前运行的事务数量 Error</p>
<p>当前sql执行出错的数目 Update</p>
<p>当前sql更新或者删除操作中已经影响的行数 FetchRow</p>
<p>当前sql操作中已经读取的行数 Running</p>
<p>当前sql正在运行的数目 Concurrent</p>
<p>当前sql最大并发执行数  ExecHisto </p>
<p>当前sql做execute操作的时间分布数组</p>
<p>分为0-1,1-10,10-100,100-1000，&gt;1000，5个时间分布区域，单位为ms ExecRsHisto </p>
<p>当前sql做execute操作和resultSet</p>
<p>打开至关闭的时间总和分布数组</p>
<p>同上 FetchRowHisto</p>
<p>当前sql查询时间分布数组</p>
<p>同上 UpdateHisto </p>
<p>当前sql更新、删除时间分布数组</p>
<p>同上表3.1 监控字段含义</p>
<p>老版本的druid的jar包中不支持通过web界面进行远程监控，从0.2.14开始可以通过配置jmx地址来获取远程运行druid的服务器的监控信息。具体配置方法如下：</p>
<p><strong>[html]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li><servlet>  </li>
<li><servlet-name>DruidStatView</servlet-name>  </li>
<li><servlet-class>com.alibaba.druid.support.http.StatViewServlet</servlet-class>  </li>
<li><init-param>  </li>
<li><param-name>jmxUrl</param-name>  </li>
<li><param-value>service:jmx:rmi:///jndi/rmi://localhost:9004/jmxrmi</param-value>  </li>
<li></init-param>  </li>
<li></servlet>  </li>
<li><servlet-mapping>  </li>
<li><servlet-name>DruidStatView</servlet-name>  </li>
<li><url-pattern>/druid//*</url-pattern>  </li>
<li></servlet-mapping><br>配置文件3.2 远程监控web</li>
</ol>
<p>这里连接的配置参数中多了一个jmxUrl，里面配置一个jmx连接地址。jmx连接中也可以指定用户名、密码，在上面的servlet中添加两个init-param，其param-name分别为jmxUsername和jmxPassword，分别对应连接jmx的用户名和密码。对于jmx在服务器端的配置，可以参考3.2节中的介绍。</p>
<h3 id="-3-2-jconsole-"><a href=""></a><strong>3.2 jconsole监控</strong></h3>
<p>同时druid提供了jconsole监控的功能，因为界面做的不是很好，所以官方中没有对其的相关介绍。如果是纯java程序的话，上面提到的web监控就无法使用了，jconsole的作用就体现出来了。不过我在下面做教程的时候，依然使用的是刚才用的web项目。</p>
<p>首先在catalina.bat（或者catalina.sh）中加入java的启动选项，放置于if &quot;%OS%&quot; == &quot;Windows_NT&quot; setlocal这句之后。</p>
<p>set JAVA_OPTS=%JAVA_OPTS% -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=&quot;9004&quot; -Dcom.sun.management.jmxremote.authenticate=&quot;false&quot; -Dcom.sun.management.jmxremote.ssl=&quot;false&quot;</p>
<p>保存完之后，启动startup.bat(或者startup.sh)来运行tomcat（上面设置java启动项的配置，按理来说在eclipse中也能适用，但是笔者在其下没有试验成功）。然后在远程的某台电脑的命令行中运行如下命令</p>
<p>jconsole -pluginpath E:\kuaipan\workspace6\druid-web\WebRoot\WEB-INF\lib\druid-0.2.11.jar</p>
<p>这里的最后一个参数就是你的druid的jar包的路径。</p>
<p><img src="" alt=""></p>
<p><strong>图3.2 jconsole连接界面</strong></p>
<p>在远程进程的输入框里面输入ip:端口号，然后点击连接（上面的配置中没有指定用户名、密码，所以这里不用填写）。打开的界面如下：</p>
<p><img src="" alt=""></p>
<p><strong>图3.3 jconsole 连接成功界面</strong></p>
<p>可以看到和web监控界面类似的数据了。
来源： <a href="[http://blog.csdn.net/yunnysunny/article/details/8657095](http://blog.csdn.net/yunnysunny/article/details/8657095)">[http://blog.csdn.net/yunnysunny/article/details/8657095](http://blog.csdn.net/yunnysunny/article/details/8657095)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/连接池/">连接池</a></li></span></span> | <span class="tags">Tagged <a href="/tags/连接池/" class="label label-primary">连接池</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:43"datetime="2014-03-07 09:54:43"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-连接池--druid教程/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-连接池--druid教程" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-ruby--InstallRuby193orMultipleRubyVersionon/">Install Ruby 1.9.3 ( or Multiple Ruby Version ) on</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:43.000Z"> <a href="/2014/02/02/2014-02-02-ruby--InstallRuby193orMultipleRubyVersionon/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="install-ruby-1-9-3-or-multiple-ruby-version-on-centos-redhat-using-rvm">Install Ruby 1.9.3 ( or Multiple Ruby Version ) on CentOS, RedHat using RVM</h1>
<p>I am using CentOS 6.3, below is easy steps to install ruby using RVM , or Ruby Version Manager.  RVM provides easy set of commands to install single or multiple versions of Ruby on single server.</p>
<h3 id="step-1-upgrade-packages">Step 1: Upgrade Packages</h3>
<p>It is the best practice to keep your system up to date with latest packages. Before running below command make sure that update will not affect to your running apps ( if any )on server else skip it
/# yumupdate</p>
<h3 id="step-2-installing-recommended-packages">Step 2: Installing Recommended Packages</h3>
<p>There are few developemnt libraries required to run Ruby on Linux. Use following command to install recommended packages on your server using yum.
/# yuminstallgcc-c++ patch readline readline-devel zlib zlib-devel  /# yuminstalllibyaml-devel libffi-devel openssl-devel make  /# yuminstallbzip2 autoconf automake libtool bison iconv-devel</p>
<h3 id="step-3-install-rvm-ruby-version-manager-">Step 3: Install RVM ( Ruby Version Manager )</h3>
<p>Install latest stable version of RVM on your system using following command. This command will automatically download all required files and install on your system.
/# curl -Lget.rvm.io| bash -sstable</p>
<p>[Sample Output]</p>
<p>[root@redhat6 beef]/# rvm install 1.9.3                                                                                 </p>
<p>bash: rvm: command not found                                                                                           </p>
<p>[root@redhat6 beef]/# curl -L get.rvm.io | bash -s stable</p>
<p>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</p>
<pre><code>                             Dload  Upload   Total   Spent    Left  Speed  
</code></pre><p>100 20511  100 20511    0     0  11534      0  0:00:01  0:00:01 --:--:--  175k </p>
<p>Downloading <a href="https://github.com/wayneeseguin/rvm/archive/stable.tar.gz" target="_blank">https://github.com/wayneeseguin/rvm/archive/stable.tar.gz</a>          </p>
<p>Creating group &#39;rvm&#39;                                                           </p>
<p>Installing RVM to /usr/local/rvm/                                                                                        </p>
<p>Installation of RVM in /usr/local/rvm/ is almost complete:                                                               </p>
<p>  /* First you need to add all users that will be using rvm to &#39;rvm&#39; group,</p>
<pre><code>and logout - login again, anyone using rvm will be operating with `umask u=rwx,g=rwx,o=rx`.
</code></pre><p>  /* To start using RVM you need to run <code>source /etc/profile.d/rvm.sh</code></p>
<pre><code>in all your open shell windows, in rare cases you need to reopen all shell windows.
</code></pre><p>/# robin,</p>
<p>/#       </p>
<p>/#   Thank you for using RVM!</p>
<p>/#   We sincerely hope that RVM helps to make your life easier and more enjoyable!!!</p>
<p>/#                                                                                  </p>
<p>/# ~Wayne, Michal &amp; team.                                                           </p>
<p>In case of problems: <a href="http://rvm.io/help" target="_blank">http://rvm.io/help</a> and <a href="https://twitter.com/rvm_io" target="_blank">https://twitter.com/rvm_io</a></p>
<h3 id="step-4-setup-rvm-environment">Step 4: Setup RVM Environment</h3>
<p>After installing RVM first we need to setup rvm environment using below command.
/# source/etc/profile.d/rvm.sh</p>
<h3 id="step-5-install-required-ruby-version">Step 5: Install Required Ruby Version</h3>
<p>RVM provides option to manage multiple ruby version on single system. Use following command to install required version of Ruby.
/# rvm install1.9.3</p>
<p>[Sample Output]</p>
<p>[root@redhat6 soft]/# rvm install 1.9.3                                                                  </p>
<p>Searching for binary rubies, this might take some time.                                                 </p>
<p>No binary rubies available for: redhat/6/x86_64/ruby-1.9.3-p484.                                        </p>
<p>Continuing with compilation. Please read &#39;rvm help mount&#39; to get more information on binary rubies.                      </p>
<p>Checking requirements for redhat.                                                                                        </p>
<p>Installing requirements for redhat.                                                                                      </p>
<p>Updating system.                                                                                                         </p>
<p>Installing required packages: libyaml-devel, libffi-devel........                                                        </p>
<p>Requirements installation successful.                                                                                    </p>
<p>Installing Ruby from source to: /usr/local/rvm/rubies/ruby-1.9.3-p484, this may take a while depending on your cpu(s)... </p>
<p>ruby-1.9.3-p484 - /#downloading ruby-1.9.3-p484, this may take a while depending on your connection...                    </p>
<p>Warning: Transient problem: timeout Will retry in 2 seconds. 3 retries left.</p>
<p>Warning: Transient problem: timeout Will retry in 2 seconds. 2 retries left.</p>
<p>Warning: Transient problem: timeout Will retry in 2 seconds. 1 retries left.</p>
<p>curl: (28) connect() timed out!</p>
<p>There was an error(28).        </p>
<p>Checking fallback: <a href="http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p484.tar.bz2" target="_blank">http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p484.tar.bz2</a></p>
<p>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current </p>
<pre><code>                             Dload  Upload   Total   Spent    Left  Speed   
</code></pre><p>100 9806k  100 9806k    0     0   207k      0  0:00:47  0:00:47 --:--:--  239k  </p>
<p>ruby-1.9.3-p484 - /#extracting ruby-1.9.3-p484 to /usr/local/rvm/src/ruby-1.9.3-p484.</p>
<p>ruby-1.9.3-p484 - /#applying patch /usr/local/rvm/patches/ruby/GH-488.patch.         </p>
<p>ruby-1.9.3-p484 - /#applying patch /usr/local/rvm/patches/ruby/ssl_no_ec2m.patch.    </p>
<p>ruby-1.9.3-p484 - /#configuring.............................................         </p>
<p>ruby-1.9.3-p484 - /#post-configuration.                                              </p>
<p>ruby-1.9.3-p484 - /#compiling....................................................................</p>
<p>ruby-1.9.3-p484 - /#installing........................                                           </p>
<p>ruby-1.9.3-p484 - /#making binaries executable.                                                  </p>
<p>ruby-1.9.3-p484 - /#downloading rubygems-2.2.2                                                   </p>
<p>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                 </p>
<pre><code>                             Dload  Upload   Total   Spent    Left  Speed                   
</code></pre><p>100  404k  100  404k    0     0  39849      0  0:00:10  0:00:10 --:--:-- 41083                  </p>
<p>No checksum for downloaded archive, recording checksum in user configuration.                   </p>
<p>ruby-1.9.3-p484 - /#extracting rubygems-2.2.2.                                                   </p>
<p>ruby-1.9.3-p484 - /#removing old rubygems.                                                       </p>
<p>ruby-1.9.3-p484 - /#installing rubygems-2.2.2...............                                     </p>
<p>ruby-1.9.3-p484 - /#gemset created /usr/local/rvm/gems/ruby-1.9.3-p484@global                    </p>
<p>ruby-1.9.3-p484 - /#importing gemset /usr/local/rvm/gemsets/global.gems.....                     </p>
<p>ruby-1.9.3-p484 - /#generating global wrappers.                                                  </p>
<p>ruby-1.9.3-p484 - /#gemset created /usr/local/rvm/gems/ruby-1.9.3-p484                           </p>
<p>ruby-1.9.3-p484 - /#importing gemsetfile /usr/local/rvm/gemsets/default.gems evaluated to empty gem list</p>
<p>ruby-1.9.3-p484 - /#generating default wrappers.                                                        </p>
<p>ruby-1.9.3-p484 - /#adjusting /#shebangs for (gem irb erb ri rdoc testrb rake).                          </p>
<p>Install of ruby-1.9.3-p484 - /#complete                                                                 </p>
<p>WARNING: Please be aware that you just installed a ruby that will finish normal maintenance on 2014-02-23, for a list of maintained rubies visit:                                                                                                 </p>
<pre><code>http://bugs.ruby-lang.org/projects/ruby/wiki/ReleaseEngineering                                                      
</code></pre><p>Please consider upgrading to ruby-2.1.0 which will have all of the latest security patches.                              </p>
<p>Ruby was built without documentation, to build it run: rvm docs generate-ri</p>
<h3 id="step-6-install-another-version-if-required-">Step 6: Install Another Version ( if Required )</h3>
<p>If you want using multiple versions of ruby, you can install it also using rvm else skip this step.
/# rvm install1.8.6</p>
<h3 id="step-7-setup-default-ruby-version">Step 7: Setup Default Ruby Version</h3>
<p>Use rvm command to setup default ruby version to be used by applications.
/#rvm use 1.9.3 --defaultUsing /usr/local/rvm/gems/ruby-1.9.3-p448</p>
<h3 id="step-8-check-current-ruby-version">Step 8: Check Current Ruby Version</h3>
<p>Using following command you can check the current ruby version is used.
/# ruby --versionruby 1.9.3p448 (2013-06-27 revision 41675) [i686-linux]</p>
<p><strong>Step 9:gem install eventmachine or  bundle install</strong></p>
<p> Step 10: bundle show  </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/ruby/">ruby</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ruby/" class="label label-primary">ruby</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:43"datetime="2014-03-07 09:54:43"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-ruby--InstallRuby193orMultipleRubyVersionon/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-ruby--InstallRuby193orMultipleRubyVersionon" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-unix--Awk学习笔记/">Awk学习笔记</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:43.000Z"> <a href="/2014/02/02/2014-02-02-unix--Awk学习笔记/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="awk-">Awk学习笔记</h1>
<h1 id="-awk-"><a href=""></a>Awk学习笔记</h1>
<h3 id="-jims-of-http-www-ringkee-com-">整理：Jims of <a href="http://www.ringkee.com/" target="_blank">肥肥世家</a></h3>
<p><a href="&#109;&#97;&#x69;&#x6c;&#x74;&#111;&#58;&#91;&#x6a;&#x69;&#x6d;&#115;&#46;&#121;&#97;&#x6e;&#103;&#64;&#103;&#x6d;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#x5d;&#40;&#109;&#x61;&#x69;&#108;&#x74;&#x6f;&#x3a;&#106;&#x69;&#x6d;&#x73;&#x2e;&#x79;&#97;&#110;&#103;&#64;&#x67;&#x6d;&#x61;&#x69;&#108;&#46;&#x63;&#111;&#109;&#x29;">&#91;&#x6a;&#x69;&#x6d;&#115;&#46;&#121;&#97;&#x6e;&#103;&#64;&#103;&#x6d;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#x5d;&#40;&#109;&#x61;&#x69;&#108;&#x74;&#x6f;&#x3a;&#106;&#x69;&#x6d;&#x73;&#x2e;&#x79;&#97;&#110;&#103;&#64;&#x67;&#x6d;&#x61;&#x69;&#108;&#46;&#x63;&#111;&#109;&#x29;</a>
Copyright © 2004 本文遵从GPL协议，欢迎转载、修改、散布。</p>
<p>第一次发布时间:2004年8月6日</p>
<p><strong>Table of Contents</strong>
<a href="">1. awk简介</a><a href="">2. awk命令格式和选项</a><a href="">2.1. awk的语法有两种形式</a><a href="">2.2. 命令选项</a><a href="">3. 模式和操作</a><a href="">3.1. 模式</a><a href="">3.2. 操作</a><a href="">4. awk的环境变量</a><a href="">5. awk运算符</a><a href="">6. 记录和域</a><a href="">6.1. 记录</a><a href="">6.2. 域</a><a href="">6.3. 域分隔符</a><a href="">7. gawk专用正则表达式元字符</a><a href="">8. POSIX字符集</a><a href="">9. 匹配操作符(~)</a><a href="">10. 比较表达式</a><a href="">11. 范围模板</a><a href="">12. 一个验证passwd文件有效性的例子</a><a href="">13. 几个实例</a><a href="">14. awk编程</a><a href="">14.1. 变量</a><a href="">14.2. BEGIN模块</a><a href="">14.3. END模块</a><a href="">14.4. 重定向和管道</a><a href="">14.5. 条件语句</a><a href="">14.6. 循环</a><a href="">14.7. 数组</a><a href="">14.8. awk的内建函数</a><a href="">15. How-to</a></p>
<h2 id="-1-awk-"><a href=""></a>1. awk简介</h2>
<p>awk是一种编程语言，用于在linux/unix下对文本和数据进行处理。数据可以来自标准输入、一个或多个文件，或其它命令的输出。它支持用户自定义函数和动态正则表达式等先进功能，是linux/unix下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。awk的处理文本和数据的方式是这样的，它逐行扫描文件，从第一行到最后一行，寻找匹配的特定模式的行，并在这些行上进行你想要的操作。如果没有指定处理动作，则把匹配的行显示到标准输出(屏幕)，如果没有指定模式，则所有被操作所指定的行都被处理。awk分别代表其作者姓氏的第一个字母。因为它的作者是三个人，分别是Alfred Aho、Brian Kernighan、Peter Weinberger。gawk是awk的GNU版本，它提供了Bell实验室和GNU的一些扩展。下面介绍的awk是以GUN的gawk为例的，在linux系统中已把awk链接到gawk，所以下面全部以awk进行介绍。</p>
<h2 id="-2-awk-"><a href=""></a>2. awk命令格式和选项</h2>
<h3 id="-2-1-awk-"><a href=""></a>2.1. awk的语法有两种形式</h3>
<ul>
<li>awk [options] &#39;script&#39; var=value file(s)</li>
<li>awk [options] -f scriptfile var=value file(s)<h3 id="-2-2-"><a href=""></a>2.2. 命令选项</h3>
</li>
</ul>
<p>-F fs or --field-separator fs
指定输入文件折分隔符，fs是一个字符串或者是一个正则表达式，如-F:。
-v var=value or --asign var=value
赋值一个用户定义变量。
-f scripfile or --file scriptfile
从脚本文件中读取awk命令。
-mf nnn and -mr nnn
对nnn值设置内在限制，-mf选项限制分配给nnn的最大块数目；-mr选项限制记录的最大数目。这两个功能是Bell实验室版awk的扩展功能，在标准awk中不适用。
-W compact or --compat, -W traditional or --traditional
在兼容模式下运行awk。所以gawk的行为和标准的awk完全一样，所有的awk扩展都被忽略。
-W copyleft or --copyleft, -W copyright or --copyright
打印简短的版权信息。
-W help or --help, -W usage or --usage
打印全部awk选项和每个选项的简短说明。
-W lint or --lint
打印不能向传统unix平台移植的结构的警告。
-W lint-old or --lint-old
打印关于不能向传统unix平台移植的结构的警告。
-W posix
打开兼容模式。但有以下限制，不识别：\x、函数关键字、func、换码序列以及当fs是一个空格时，将新行作为一个域分隔符；操作符/<em>/</em>和/<em>/</em>=不能代替^和^=；fflush无效。
-W re-interval or --re-inerval
允许间隔正则表达式的使用，参考(grep中的Posix字符类)，如括号表达式[[:alpha:]]。
-W source program-text or --source program-text
使用program-text作为源代码，可与-f命令混用。
-W version or --version
打印bug报告信息的版本。</p>
<h2 id="-3-"><a href=""></a>3. 模式和操作</h2>
<p>awk脚本是由模式和操作组成的：
pattern {action} 如$ awk &#39;/root/&#39; test，或$ awk &#39;$3 &lt; 100&#39; test。</p>
<p>两者是可选的，如果没有模式，则action应用到全部记录，如果没有action，则输出匹配全部记录。默认情况下，每一个输入行都是一条记录，但用户可通过RS变量指定不同的分隔符进行分隔。</p>
<h3 id="-3-1-"><a href=""></a>3.1. 模式</h3>
<p>模式可以是以下任意一个：</p>
<ul>
<li>/正则表达式/：使用通配符的扩展集。</li>
<li>关系表达式：可以用下面运算符表中的关系运算符进行操作，可以是字符串或数字的比较，如$2&gt;%1选择第二个字段比第一个字段长的行。</li>
<li>模式匹配表达式：用运算符~(匹配)和~!(不匹配)。</li>
<li>模式，模式：指定一个行的范围。该语法不能包括BEGIN和END模式。</li>
<li>BEGIN：让用户指定在第一条输入记录被处理之前所发生的动作，通常可在这里设置全局变量。</li>
<li>END：让用户在最后一条输入记录被读取之后发生的动作。</li>
</ul>
<h3 id="-3-2-"><a href=""></a>3.2. 操作</h3>
<p>操作由一人或多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内。主要有四部份：</p>
<ul>
<li>变量或数组赋值</li>
<li>输出命令</li>
<li>内置函数</li>
<li>控制流命令</li>
</ul>
<h2 id="-4-awk-"><a href=""></a>4. awk的环境变量</h2>
<p><a href=""></a></p>
<p><strong>Table 1. awk的环境变量</strong></p>
<p>变量描述$n当前记录的第n个字段，字段间由FS分隔。$0完整的输入记录。ARGC命令行参数的数目。ARGIND命令行中当前文件的位置(从0开始算)。ARGV包含命令行参数的数组。CONVFMT数字转换格式(默认值为%.6g)ENVIRON环境变量关联数组。ERRNO最后一个系统错误的描述。FIELDWIDTHS字段宽度列表(用空格键分隔)。FILENAME当前文件名。FNR同NR，但相对于当前文件。FS字段分隔符(默认是任何空格)。IGNORECASE如果为真，则进行忽略大小写的匹配。NF当前记录中的字段数。NR当前记录数。OFMT数字的输出格式(默认值是%.6g)。OFS输出字段分隔符(默认值是一个空格)。ORS输出记录分隔符(默认值是一个换行符)。RLENGTH由match函数所匹配的字符串的长度。RS记录分隔符(默认是一个换行符)。RSTART由match函数所匹配的字符串的第一个位置。SUBSEP数组下标分隔符(默认值是\034)。</p>
<h2 id="-5-awk-"><a href=""></a>5. awk运算符</h2>
<p><a href=""></a></p>
<p><strong>Table 2. 运算符</strong></p>
<p>运算符描述= += -= /<em>= /= %= ^= /</em>/<em>=赋值?:C条件表达式||逻辑或&amp;&amp;逻辑与~ ~!匹配正则表达式和不匹配正则表达式&lt; &lt;= &gt; &gt;= != ==关系运算符空格连接+ -加，减/</em> / &amp;乘，除与求余+ - !一元加，减和逻辑非^ /<em>/</em>/*求幂++ --增加或减少，作为前缀或后缀$字段引用in数组成员</p>
<h2 id="-6-"><a href=""></a>6. 记录和域</h2>
<h3 id="-6-1-"><a href=""></a>6.1. 记录</h3>
<p>awk把每一个以换行符结束的行称为一个记录。</p>
<p>记录分隔符：默认的输入和输出的分隔符都是回车，保存在内建变量ORS和RS中。</p>
<p>$0变量：它指的是整条记录。如$ awk &#39;{print $0}&#39; test将输出test文件中的所有记录。</p>
<p>变量NR：一个计数器，每处理完一条记录，NR的值就增加1。如$ awk &#39;{print NR,$0}&#39; test将输出test文件中所有记录，并在记录前显示记录号。</p>
<h3 id="-6-2-"><a href=""></a>6.2. 域</h3>
<p>记录中每个单词称做“域”，默认情况下以空格或tab分隔。awk可跟踪域的个数，并在内建变量NF中保存该值。如$ awk &#39;{print $1,$3}&#39; test将打印test文件中第一和第三个以空格分开的列(域)。</p>
<h3 id="-6-3-"><a href=""></a>6.3. 域分隔符</h3>
<p>内建变量FS保存输入域分隔符的值，默认是空格或tab。我们可以通过-F命令行选项修改FS的值。如$ awk -F: &#39;{print $1,$5}&#39; test将打印以冒号为分隔符的第一，第五列的内容。</p>
<p>可以同时使用多个域分隔符，这时应该把分隔符写成放到方括号中，如$awk -F&#39;[:\t]&#39; &#39;{print $1,$3}&#39; test，表示以空格、冒号和tab作为分隔符。</p>
<p>输出域的分隔符默认是一个空格，保存在OFS中。如$ awk -F: &#39;{print $1,$5}&#39; test，$1和$5间的逗号就是OFS的值。</p>
<h2 id="-7-gawk-"><a href=""></a>7. gawk专用正则表达式元字符</h2>
<p>一般通用的元字符集就不讲了，可参考我的<a href="http://www.ringkee.com/jims/technic_folder/sed.htm" target="_blank">Sed</a>和<a href="http://www.ringkee.com/jims/technic_floder/grep.htm" target="_blank">Grep</a>学习笔记。以下几个是gawk专用的，不适合unix版本的awk。</p>
<p>\Y
匹配一个单词开头或者末尾的空字符串。
\B
匹配单词内的空字符串。
\&lt;
匹配一个单词的开头的空字符串，锚定开始。
>
匹配一个单词的末尾的空字符串，锚定末尾。
\w
匹配一个字母数字组成的单词。
\W
匹配一个非字母数字组成的单词。
\‘
匹配字符串开头的一个空字符串。
\&#39;
匹配字符串末尾的一个空字符串。</p>
<h2 id="-8-posix-"><a href=""></a>8. POSIX字符集</h2>
<p>可参考我的<a href="http://www.ringkee.com/jims/technic_folder/grep.htm" target="_blank">Grep学习笔记</a></p>
<h2 id="-9-"><a href=""></a>9. 匹配操作符(~)</h2>
<p>用来在记录或者域内匹配正则表达式。如$ awk &#39;$1 ~/^root/&#39; test将显示test文件第一列中以root开头的行。</p>
<h2 id="-10-"><a href=""></a>10. 比较表达式</h2>
<p>conditional expression1 ? expression2: expression3，例如：$ awk &#39;{max = {$1 &gt; $3} ? $1: $3: print max}&#39; test。如果第一个域大于第三个域，$1就赋值给max，否则$3就赋值给max。</p>
<p>$ awk &#39;$1 + $2 &lt; 100&#39; test。如果第一和第二个域相加大于100，则打印这些行。</p>
<p>$ awk &#39;$1 &gt; 5 &amp;&amp; $2 &lt; 10&#39; test,如果第一个域大于5，并且第二个域小于10，则打印这些行。</p>
<h2 id="-11-"><a href=""></a>11. 范围模板</h2>
<p>范围模板匹配从第一个模板的第一次出现到第二个模板的第一次出现之间所有行。如果有一个模板没出现，则匹配到开头或末尾。如$ awk &#39;/root/,/mysql/&#39; test将显示root第一次出现到mysql第一次出现之间的所有行。</p>
<h2 id="-12-passwd-"><a href=""></a>12. 一个验证passwd文件有效性的例子</h2>
<p><a href=""></a><img src="http://man.lupaworld.com/content/manage/ringkee/images/callouts/1.png" alt="1">$ cat /etc/passwd | awk -F: &#39;\ <a href=""></a><img src="http://man.lupaworld.com/content/manage/ringkee/images/callouts/2.png" alt="2">NF != 7{\ <a href=""></a><img src="http://man.lupaworld.com/content/manage/ringkee/images/callouts/3.png" alt="3">printf(&quot;line %d,does not have 7 fields:%s\n&quot;,NR,$0)}\ <a href=""></a><img src="http://man.lupaworld.com/content/manage/ringkee/images/callouts/4.png" alt="4">$1 !~ /[A-Za-z0-9]/{printf(&quot;line %d,non alpha and numeric user id:%d: %s\n,NR,$0)}\ <a href=""></a><img src="http://man.lupaworld.com/content/manage/ringkee/images/callouts/5.png" alt="5">$2 == &quot;/*&quot; {printf(&quot;line %d, no password: %s\n&quot;,NR,$0)}&#39;</p>
<p><a href=""><img src="http://man.lupaworld.com/content/manage/ringkee/images/callouts/1.png" alt="1"></a>
cat把结果输出给awk，awk把域之间的分隔符设为冒号。<a href=""><img src="http://man.lupaworld.com/content/manage/ringkee/images/callouts/2.png" alt="2"></a>
如果域的数量(NF)不等于7，就执行下面的程序。<a href=""><img src="http://man.lupaworld.com/content/manage/ringkee/images/callouts/3.png" alt="3"></a>
printf打印字符串&quot;line ?? does not have 7 fields&quot;，并显示该条记录。<a href=""><img src="http://man.lupaworld.com/content/manage/ringkee/images/callouts/4.png" alt="4"></a>
如果第一个域没有包含任何字母和数字，printf打印“no alpha and numeric user id&quot; ，并显示记录数和记录。<a href=""><img src="http://man.lupaworld.com/content/manage/ringkee/images/callouts/5.png" alt="5"></a>
如果第二个域是一个星号，就打印字符串“no passwd”，紧跟着显示记录数和记录本身。</p>
<h2 id="-13-"><a href=""></a>13. 几个实例</h2>
<ul>
<li>$ awk &#39;/^(no|so)/&#39; test-----打印所有以模式no或so开头的行。</li>
<li>$ awk &#39;/^[ns]/{print $1}&#39; test-----如果记录以n或s开头，就打印这个记录。</li>
<li>$ awk &#39;$1 ~/[0-9][0-9]$/(print $1}&#39; test-----如果第一个域以两个数字结束就打印这个记录。</li>
<li>$ awk &#39;$1 == 100 || $2 &lt; 50&#39; test-----如果第一个或等于100或者第二个域小于50，则打印该行。</li>
<li>$ awk &#39;$1 != 10&#39; test-----如果第一个域不等于10就打印该行。</li>
<li>$ awk &#39;/test/{print $1 + 10}&#39; test-----如果记录包含正则表达式test，则第一个域加10并打印出来。</li>
<li>$ awk &#39;{print ($1 &gt; 5 ? &quot;ok &quot;$1: &quot;error&quot;$1)}&#39; test-----如果第一个域大于5则打印问号后面的表达式值，否则打印冒号后面的表达式值。</li>
<li>$ awk &#39;/^root/,/^mysql/&#39; test----打印以正则表达式root开头的记录到以正则表达式mysql开头的记录范围内的所有记录。如果找到一个新的正则表达式root开头的记录，则继续打印直到下一个以正则表达式mysql开头的记录为止，或到文件末尾。</li>
</ul>
<h2 id="-14-awk-"><a href=""></a>14. awk编程</h2>
<h3 id="-14-1-"><a href=""></a>14.1. 变量</h3>
<ul>
<li>在awk中，变量不需要定义就可以直接使用，变量类型可以是数字或字符串。</li>
<li>赋值格式：Variable = expression，如$ awk &#39;$1 ~/test/{count = $2 + $3; print count}&#39; test,上式的作用是,awk先扫描第一个域，一旦test匹配，就把第二个域的值加上第三个域的值，并把结果赋值给变量count，最后打印出来。</li>
<li>awk可以在命令行中给变量赋值，然后将这个变量传输给awk脚本。如$ awk -F: -f awkscript month=4 year=2004 test，上式的month和year都是自定义变量，分别被赋值为4和2004。在awk脚本中，这些变量使用起来就象是在脚本中建立的一样。注意，如果参数前面出现test，那么在BEGIN语句中的变量就不能被使用。</li>
<li>域变量也可被赋值和修改，如$ awk &#39;{$2 = 100 + $1; print }&#39; test,上式表示，如果第二个域不存在，awk将计算表达式100加$1的值，并将其赋值给$2，如果第二个域存在，则用表达式的值覆盖$2原来的值。再例如：$ awk &#39;$1 == &quot;root&quot;{$1 =&quot;test&quot;;print}&#39; test，如果第一个域的值是“root”，则把它赋值为“test”，注意，字符串一定要用双引号。</li>
<li>内建变量的使用。变量列表在前面已列出，现在举个例子说明一下。$ awk -F: &#39;{IGNORECASE=1; $1 == &quot;MARY&quot;{print NR,$1,$2,$NF}&#39;test，把IGNORECASE设为1代表忽略大小写，打印第一个域是mary的记录数、第一个域、第二个域和最后一个域。<h3 id="-14-2-begin-"><a href=""></a>14.2. BEGIN模块</h3>
</li>
</ul>
<p>BEGIN模块后紧跟着动作块，这个动作块在awk处理任何输入文件之前执行。所以它可以在没有任何输入的情况下进行测试。它通常用来改变内建变量的值，如OFS,RS和FS等，以及打印标题。如：$ awk &#39;BEGIN{FS=&quot;:&quot;; OFS=&quot;\t&quot;; ORS=&quot;\n\n&quot;}{print $1,$2,$3} test。上式表示，在处理输入文件以前，域分隔符(FS)被设为冒号，输出文件分隔符(OFS)被设置为制表符，输出记录分隔符(ORS)被设置为两个换行符。$ awk &#39;BEGIN{print &quot;TITLE TEST&quot;}只打印标题。</p>
<h3 id="-14-3-end-"><a href=""></a>14.3. END模块</h3>
<p>END不匹配任何的输入文件，但是执行动作块中的所有动作，它在整个输入文件处理完成后被执行。如$ awk &#39;END{print &quot;The number of records is&quot; NR}&#39; test，上式将打印所有被处理的记录数。</p>
<h3 id="-14-4-"><a href=""></a>14.4. 重定向和管道</h3>
<ul>
<li>awk可使用shell的重定向符进行重定向输出，如：$ awk &#39;$1 = 100 {print $1 &gt; &quot;output_file&quot; }&#39; test。上式表示如果第一个域的值等于100，则把它输出到output_file中。也可以用&gt;&gt;来重定向输出，但不清空文件，只做追加操作。</li>
<li>输出重定向需用到getline函数。getline从标准输入、管道或者当前正在处理的文件之外的其他输入文件获得输入。它负责从输入获得下一行的内容，并给NF,NR和FNR等内建变量赋值。如果得到一条记录，getline函数返回1，如果到达文件的末尾就返回0，如果出现错误，例如打开文件失败，就返回-1。如：</li>
</ul>
<p>$ awk &#39;BEGIN{ &quot;date&quot; | getline d; print d}&#39; test。执行linux的date命令，并通过管道输出给getline，然后再把输出赋值给自定义变量d，并打印它。</p>
<p>$ awk &#39;BEGIN{&quot;date&quot; | getline d; split(d,mon); print mon[2]}&#39; test。执行shell的date命令，并通过管道输出给getline，然后getline从管道中读取并将输入赋值给d，split函数把变量d转化成数组mon，然后打印数组mon的第二个元素。</p>
<p>$ awk &#39;BEGIN{while( &quot;ls&quot; | getline) print}&#39;，命令ls的输出传递给geline作为输入，循环使getline从ls的输出中读取一行，并把它打印到屏幕。这里没有输入文件，因为BEGIN块在打开输入文件前执行，所以可以忽略输入文件。</p>
<p>$ awk &#39;BEGIN{printf &quot;What is your name?&quot;; getline name &lt; &quot;/dev/tty&quot; } $1 ~name {print &quot;Found&quot; name on line &quot;, NR &quot;.&quot;} END{print &quot;See you,&quot; name &quot;.&quot;} test。在屏幕上打印”What is your name?&quot;,并等待用户应答。当一行输入完毕后，getline函数从终端接收该行输入，并把它储存在自定义变量name中。如果第一个域匹配变量name的值，print函数就被执行，END块打印See you和name的值。</p>
<p>$ awk &#39;BEGIN{while (getline &lt; &quot;/etc/passwd&quot; &gt; 0) lc++; print lc}&#39;。awk将逐行读取文件/etc/passwd的内容，在到达文件末尾前，计数器lc一直增加，当到末尾时，打印lc的值。注意，如果文件不存在，getline返回-1，如果到达文件的末尾就返回0，如果读到一行，就返回1，所以命令 while (getline &lt; &quot;/etc/passwd&quot;)在文件不存在的情况下将陷入无限循环，因为返回-1表示逻辑真。</p>
<ul>
<li>可以在awk中打开一个管道，且同一时刻只能有一个管道存在。通过close()可关闭管道。如：$ awk &#39;{print $1, $2 | &quot;sort&quot; }&#39; test END {close(&quot;sort&quot;)}。awd把print语句的输出通过管道作为linux命令sort的输入,END块执行关闭管道操作。</li>
<li>system函数可以在awk中执行linux的命令。如：$ awk &#39;BEGIN{system(&quot;clear&quot;)&#39;。</li>
<li>fflush函数用以刷新输出缓冲区，如果没有参数，就刷新标准输出的缓冲区，如果以空字符串为参数，如fflush(&quot;&quot;),则刷新所有文件和管道的输出缓冲区。</li>
</ul>
<h3 id="-14-5-"><a href=""></a>14.5. 条件语句</h3>
<p>awk中的条件语句是从C语言中借鉴过来的，可控制程序的流程。</p>
<h3 id="-14-5-1-if-if-expression-statement-statement-"><a href=""></a>14.5.1. if语句格式： {if (expression){ statement; statement; ... } }</h3>
<p>$ awk &#39;{if ($1 &lt;$2) print $2 &quot;too high&quot;}&#39; test。如果第一个域小于第二个域则打印。</p>
<p>$ awk &#39;{if ($1 &lt; $2) {count++; print &quot;ok&quot;}}&#39; test.如果第一个域小于第二个域，则count加一，并打印ok。</p>
<h3 id="-14-5-2-if-else-if-expression-statement-statement-else-statement-statement-"><a href=""></a>14.5.2. if/else语句，用于双重判断。格式： {if (expression){ statement; statement; ... } else{ statement; statement; ... } }</h3>
<p>$ awk &#39;{if ($1 &gt; 100) print $1 &quot;bad&quot; ; else print &quot;ok&quot;}&#39; test。如果$1大于100则打印$1 bad,否则打印ok。</p>
<p>$ awk &#39;{if ($1 &gt; 100){ count++; print $1} else {count--; print $2}&#39; test。如果$1大于100，则count加一，并打印$1，否则count减一，并打印$1。</p>
<h3 id="-14-5-3-if-else-else-if-if-expression-statement-statement-else-if-expression-statement-statement-else-if-expression-statement-statement-else-statement-statement-"><a href=""></a>14.5.3. if/else else if语句，用于多重判断。格式： {if (expression){ statement; statement; ... } else if (expression){ statement; statement; ... } else if (expression){ statement; statement; ... } else { statement; statement; ... } }</h3>
<h3 id="-14-6-"><a href=""></a>14.6. 循环</h3>
<ul>
<li>awk有三种循环:while循环；for循环；special for循环。</li>
<li>$ awk &#39;{ i = 1; while ( i &lt;= NF ) { print NF,$i; i++}}&#39; test。变量的初始值为1，若i小于可等于NF(记录中域的个数),则执行打印语句，且i增加1。直到i的值大于NF.</li>
<li>$ awk &#39;{for (i = 1; i&lt;NF; i++) print NF,$i}&#39; test。作用同上。</li>
<li>breadkcontinue语句。break用于在满足条件的情况下跳出循环；continue用于在满足条件的情况下忽略后面的语句，直接返回循环的顶端。如：
{for ( x=3; x&lt;=NF; x++) if ($x&lt;0){print &quot;Bottomed out!&quot;; break}} {for ( x=3; x&lt;=NF; x++) if ($x==0){print &quot;Get next item&quot;; continue}}</li>
<li>next语句从输入文件中读取一行，然后从头开始执行awk脚本。如：
{if ($1 ~/test/){next} else {print} }</li>
<li>exit语句用于结束awk程序，但不会略过END块。退出状态为0代表成功，非零值表示出错。</li>
</ul>
<h3 id="-14-7-"><a href=""></a>14.7. 数组</h3>
<p>awk中的数组的下标可以是数字和字母，称为关联数组。</p>
<h3 id="-14-7-1-"><a href=""></a>14.7.1. 下标与关联数组</h3>
<ul>
<li>用变量作为数组下标。如：$ awk {name[x++]=$2};END{for(i=0;i&lt;NR;i++) print i,name[i]}&#39; test。数组name中的下标是一个自定义变量x，awk初始化x的值为0，在每次使用后增加1。第二个域的值被赋给name数组的各个元素。在END模块中，for循环被用于循环整个数组，从下标为0的元素开始，打印那些存储在数组中的值。因为下标是关健字，所以它不一定从0开始，可以从任何值开始。</li>
<li>special for循环用于读取关联数组中的元素。格式如下：
{for (item in arrayname){ print arrayname[item] } } $ awk &#39;/^tom/{name[NR]=$1}; END{for(i in name){print name[i]}}&#39; test。打印有值的数组元素。打印的顺序是随机的。</li>
<li>用字符串作为下标。如：count[&quot;test&quot;]</li>
<li>用域值作为数组的下标。一种新的for循环方式，for (index_value in array) statement。如:$ awk &#39;{count[$1]++} END{for(name in count) print name,count[name]}&#39; test。该语句将打印$1中字符串出现的次数。它首先以第一个域作数组count的下标，第一个域变化，索引就变化。</li>
<li>delete函数用于删除数组元素。如：$ awk &#39;{line[x++]=$1} END{for(x in line) delete(line[x])}&#39; test。分配给数组line的是第一个域的值，所有记录处理完成后，special for循环将删除每一个元素。<h3 id="-14-8-awk-"><a href=""></a>14.8. awk的内建函数</h3>
</li>
</ul>
<h3 id="-14-8-1-"><a href=""></a>14.8.1. 字符串函数</h3>
<ul>
<li>sub函数匹配记录中最大、最靠左边的子字符串的正则表达式，并用替换字符串替换这些字符串。如果没有指定目标字符串就默认使用整个记录。替换只发生在第一次匹配的时候。格式如下：
sub (regular expression, substitution string): sub (regular expression, substitution string, target string)</li>
</ul>
<p>实例：</p>
<p>$ awk &#39;{ sub(/test/, &quot;mytest&quot;); print }&#39; testfile $ awk &#39;{ sub(/test/, &quot;mytest&quot;); $1}; print }&#39; testfile</p>
<p>第一个例子在整个记录中匹配，替换只发生在第一次匹配发生的时候。如要在整个文件中进行匹配需要用到gsub</p>
<p>第二个例子在整个记录的第一个域中进行匹配，替换只发生在第一次匹配发生的时候。</p>
<ul>
<li>gsub函数作用如sub，但它在整个文档中进行匹配。格式如下：
gsub (regular expression, substitution string) gsub (regular expression, substitution string, target string)</li>
</ul>
<p>实例：</p>
<p>$ awk &#39;{ gsub(/test/, &quot;mytest&quot;); print }&#39; testfile $ awk &#39;{ gsub(/test/, &quot;mytest&quot;), $1 }; print }&#39; testfile</p>
<p>第一个例子在整个文档中匹配test，匹配的都被替换成mytest。</p>
<p>第二个例子在整个文档的第一个域中匹配，所有匹配的都被替换成mytest。</p>
<ul>
<li>index函数返回子字符串第一次被匹配的位置，偏移量从位置1开始。格式如下：
index(string, substring)</li>
</ul>
<p>实例：</p>
<p>$ awk &#39;{ print index(&quot;test&quot;, &quot;mytest&quot;) }&#39; testfile</p>
<p>实例返回test在mytest的位置，结果应该是3。</p>
<ul>
<li>length函数返回记录的字符数。格式如下：
length( string ) length</li>
</ul>
<p>实例：</p>
<p>$ awk &#39;{ print length( &quot;test&quot; ) }&#39; $ awk &#39;{ print length }&#39; testfile</p>
<p>第一个实例返回test字符串的长度。</p>
<p>第二个实例返回testfile文件中第条记录的字符数。</p>
<ul>
<li>substr函数返回从位置1开始的子字符串，如果指定长度超过实际长度，就返回整个字符串。格式如下：
substr( string, starting position ) substr( string, starting position, length of string )</li>
</ul>
<p>实例：</p>
<p>$ awk &#39;{ print substr( &quot;hello world&quot;, 7,11 ) }&#39;</p>
<p>上例截取了world子字符串。</p>
<ul>
<li>match函数返回在字符串中正则表达式位置的索引，如果找不到指定的正则表达式则返回0。match函数会设置内建变量RSTART为字符串中子字符串的开始位置，RLENGTH为到子字符串末尾的字符个数。substr可利于这些变量来截取字符串。函数格式如下：
match( string, regular expression )</li>
</ul>
<p>实例：</p>
<p>$ awk &#39;{start=match(&quot;this is a test&quot;,/[a-z]+$/); print start}&#39; $ awk &#39;{start=match(&quot;this is a test&quot;,/[a-z]+$/); print start, RSTART, RLENGTH }&#39;</p>
<p>第一个实例打印以连续小写字符结尾的开始位置，这里是11。</p>
<p>第二个实例还打印RSTART和RLENGTH变量，这里是11(start)，11(RSTART)，4(RLENGTH)。</p>
<ul>
<li>toupper和tolower函数可用于字符串大小间的转换，该功能只在gawk中有效。格式如下：
toupper( string ) tolower( string )</li>
</ul>
<p>实例：</p>
<p>$ awk &#39;{ print toupper(&quot;test&quot;), tolower(&quot;TEST&quot;) }&#39;</p>
<ul>
<li>split函数可按给定的分隔符把字符串分割为一个数组。如果分隔符没提供，则按当前FS值进行分割。格式如下：
split( string, array, field separator ) split( string, array )</li>
</ul>
<p>实例：</p>
<p>$ awk &#39;{ split( &quot;20:18:00&quot;, time, &quot;:&quot; ); print time[2] }&#39;</p>
<p>上例把时间按冒号分割到time数组内，并显示第二个数组元素18。</p>
<h3 id="-14-8-2-"><a href=""></a>14.8.2. 时间函数</h3>
<ul>
<li>systime函数返回从1970年1月1日开始到当前时间(不计闰年)的整秒数。格式如下：
systime()</li>
</ul>
<p>实例：</p>
<p>$ awk &#39;{ now = systime(); print now }&#39;</p>
<ul>
<li>strftime函数使用C库中的strftime函数格式化时间。格式如下：
systime( [format specification][,timestamp] )</li>
</ul>
<p><a href=""></a></p>
<p><strong>Table 3. 日期和时间格式说明符</strong></p>
<p>格式描述%a星期几的缩写(Sun)%A星期几的完整写法(Sunday)%b月名的缩写(Oct)%B月名的完整写法(October)%c本地日期和时间%d十进制日期%D日期 08/20/99%e日期，如果只有一位会补上一个空格%H用十进制表示24小时格式的小时%I用十进制表示12小时格式的小时%j从1月1日起一年中的第几天%m十进制表示的月份%M十进制表示的分钟%p12小时表示法(AM/PM)%S十进制表示的秒%U十进制表示的一年中的第几个星期(星期天作为一个星期的开始)%w十进制表示的星期几(星期天是0)%W十进制表示的一年中的第几个星期(星期一作为一个星期的开始)%x重新设置本地日期(08/20/99)%X重新设置本地时间(12：00：00)%y两位数字表示的年(99)%Y当前月份%Z时区(PDT)%%百分号(%)</p>
<p>实例：
$ awk &#39;{ now=strftime( &quot;%D&quot;, systime() ); print now }&#39; $ awk &#39;{ now=strftime(&quot;%m/%d/%y&quot;); print now }&#39;</p>
<h3 id="-14-8-3-"><a href=""></a>14.8.3. 内建数学函数</h3>
<p><a href=""></a></p>
<p><strong>Table 4. </strong></p>
<p>函数名称返回值atan2(x,y)y,x范围内的余切cos(x)余弦函数exp(x)求幂int(x)取整log(x)自然对数rand()随机数sin(x)正弦sqrt(x)平方根srand(x)x是rand()函数的种子int(x)取整，过程没有舍入rand()产生一个大于等于0而小于1的随机数</p>
<h3 id="-14-8-4-"><a href=""></a>14.8.4. 自定义函数</h3>
<p>在awk中还可自定义函数，格式如下：</p>
<p>function name ( parameter, parameter, parameter, ... ) { statements return expression /# the return statement and expression are optional }</p>
<h2 id="-15-how-to"><a href=""></a>15. How-to</h2>
<ul>
<li>如何把一行竖排的数据转换成横排？</li>
</ul>
<p>awk &#39;{printf(&quot;%s,&quot;,$1)}&#39; filename</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/unix/">unix</a></li></span></span> | <span class="tags">Tagged <a href="/tags/unix/" class="label label-primary">unix</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:43"datetime="2014-03-07 09:54:43"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-unix--Awk学习笔记/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-unix--Awk学习笔记" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-unix--bash-useradd-commandnotfound/">bash</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:43.000Z"> <a href="/2014/02/02/2014-02-02-unix--bash-useradd-commandnotfound/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="bash-useradd-command-not-found">bash: useradd :command not found</h1>
<h2 id="bash-useradd-command-not-found">bash: useradd :command not found</h2>
<p>在网上查了一下,发现应该如下操作：
利用su - ，而不是su进入root，然后再敲useradd test1,这样就OK了.
注意：是su - 而不是su，因为su是只取得ROOT的权限，su - 是取得ROOT的权限后还执行ROOT的PROFILE来取得ROOT的环境变量。</p>
<p>加了这个减号的目的是使环境变量和欲转换的用户相同、不加-是取得用户的临时权限
来源： <a href="[http://hi.baidu.com/peng123/item/0751b74478ccefeabdf451f0](http://hi.baidu.com/peng123/item/0751b74478ccefeabdf451f0)">[http://hi.baidu.com/peng123/item/0751b74478ccefeabdf451f0](http://hi.baidu.com/peng123/item/0751b74478ccefeabdf451f0)</a> 
对于bash:useradd:command not found错误</p>
<p>在命令行中添加用户时显示bash:useradd:command not found的错误，在网上查了一下资料。
思路：
        在UNIX系统里面，每个系统用户都由自己的环境变量来定义自己登录上来的shell、终端类型、路径等。Linux下Bshell用户登录后执行主目录下的.bash_profile，Cshell用户执行.cshrc_profile文件。
        当以普通用户登录主机，而此用户的环境里没有定义系统命令所在的路径，如/usr/bin，/usr/sbin等；或在一些情况下TELNET上主机后也会遗失环境变量。
解决方法：
       1.在绝对路径/usr/sbin中执行；
       2.用root用户执行命令。用“su -”可以取得root用户的权限和环境（注：是“su -”不是“su”，因为“su”只取得root的权限，“su -”取得root权限后还执行root的profile来取得root的环境变量）
       3.如果确定要使用非root用户的当前用户来执行命令，需要把系统路径加到该用户的.bash_profile或者.cshrc_profile文件中去
附：
      useradd指令的用法
       作用：账户建立或更新使用者的信息
       语法：useradd  &lt;选项&gt;  用户名
       常用参数：</p>
<pre><code>   1. -c comment
      新账号password档的说明栏
   2. -d home_dir
      新账号的家目录路径
   3. -e expire_date
      账号的截止日期，格式为MM/DD/YY
   4. -f inactive_days
      账号过期几日后永久封停。当值为0时账号立即被封停，当值为-1时则是关闭这个功能，默认为-1
   5. -g initial_group
      group名称或以数字来做为使用者登陆的起始组。组名必须是存在的名称
   6. -G group,[...]
      定义用户所属的其他组，可以有多个
   7. -m [-k skeleton_dir]
      用户家目录如果不存在则自动建立。如果使用-k选项，skeleton_dir内的文档会被复制到家目录下，而/etc/skel目录下的文档也会被复制过来
   8. -M
      强制不建立用户家目录，即使/etc/login.defs设定要建立家目录
   9. -s
      使用者登陆后使用的shell名称。预设是不填写，这样系统会指定预设的登陆shell
   10. -u
      手动设定用户的ID值，ID值必须是唯一的。

  userdel指令的用法
</code></pre><p>来源： <a href="&#x6d;&#97;&#105;&#x6c;&#116;&#x6f;&#58;&#x5b;&#104;&#116;&#116;&#112;&#58;&#47;&#x2f;&#98;&#108;&#111;&#x67;&#46;&#x31;&#x36;&#51;&#46;&#99;&#111;&#109;&#47;&#98;&#104;&#x6a;&#98;&#x68;&#x6a;&#x40;&#x79;&#101;&#97;&#104;&#47;&#x62;&#108;&#111;&#103;&#x2f;&#x73;&#x74;&#97;&#116;&#105;&#x63;&#x2f;&#54;&#x37;&#57;&#x32;&#x32;&#49;&#48;&#57;&#50;&#x30;&#49;&#x32;&#56;&#51;&#53;&#49;&#x35;&#x33;&#x34;&#49;&#48;&#x39;&#x2f;&#93;&#x28;&#x68;&#x74;&#116;&#x70;&#x3a;&#x2f;&#x2f;&#98;&#108;&#111;&#x67;&#46;&#49;&#54;&#x33;&#46;&#99;&#x6f;&#x6d;&#47;&#98;&#104;&#x6a;&#x62;&#104;&#106;&#64;&#x79;&#101;&#97;&#x68;&#47;&#98;&#x6c;&#x6f;&#103;&#x2f;&#x73;&#116;&#97;&#116;&#x69;&#99;&#47;&#x36;&#x37;&#57;&#x32;&#x32;&#x31;&#48;&#57;&#50;&#x30;&#x31;&#50;&#x38;&#51;&#x35;&#49;&#53;&#x33;&#52;&#49;&#48;&#57;&#47;&#41;">&#x5b;&#104;&#116;&#116;&#112;&#58;&#47;&#x2f;&#98;&#108;&#111;&#x67;&#46;&#x31;&#x36;&#51;&#46;&#99;&#111;&#109;&#47;&#98;&#104;&#x6a;&#98;&#x68;&#x6a;&#x40;&#x79;&#101;&#97;&#104;&#47;&#x62;&#108;&#111;&#103;&#x2f;&#x73;&#x74;&#97;&#116;&#105;&#x63;&#x2f;&#54;&#x37;&#57;&#x32;&#x32;&#49;&#48;&#57;&#50;&#x30;&#49;&#x32;&#56;&#51;&#53;&#49;&#x35;&#x33;&#x34;&#49;&#48;&#x39;&#x2f;&#93;&#x28;&#x68;&#x74;&#116;&#x70;&#x3a;&#x2f;&#x2f;&#98;&#108;&#111;&#x67;&#46;&#49;&#54;&#x33;&#46;&#99;&#x6f;&#x6d;&#47;&#98;&#104;&#x6a;&#x62;&#104;&#106;&#64;&#x79;&#101;&#97;&#x68;&#47;&#98;&#x6c;&#x6f;&#103;&#x2f;&#x73;&#116;&#97;&#116;&#x69;&#99;&#47;&#x36;&#x37;&#57;&#x32;&#x32;&#x31;&#48;&#57;&#50;&#x30;&#x31;&#50;&#x38;&#51;&#x35;&#49;&#53;&#x33;&#52;&#49;&#48;&#57;&#47;&#41;</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/unix/">unix</a></li></span></span> | <span class="tags">Tagged <a href="/tags/unix/" class="label label-primary">unix</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:43"datetime="2014-03-07 09:54:43"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-unix--bash-useradd-commandnotfound/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-unix--bash-useradd-commandnotfound" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-unix--unix系统中字符集的查看及修改方法/">unix系统中字符集的查看及修改方法</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:43.000Z"> <a href="/2014/02/02/2014-02-02-unix--unix系统中字符集的查看及修改方法/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="unix-">unix系统中字符集的查看及修改方法</h1>
<h1 id="-http-blog-csdn-net-wuxicxh-"><a href="http://blog.csdn.net/wuxicxh" target="_blank">蔡蔡博客</a></h1>
<h1 id="-">#</h1>
<ul>
<li><a href="http://hi.csdn.net/space-notice.html" target="_blank">条新通知</a></li>
<li><a href="http://passport.csdn.net/UserLogin.aspx" target="_blank">登录</a></li>
<li><a href="http://passport.csdn.net/CSDNUserRegister.aspx" target="_blank">注册</a></li>
<li><a href="http://hi.csdn.net/" target="_blank">欢迎</a></li>
<li><a href="http://writeblog.csdn.net/Signout.aspx" target="_blank">退出</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">我的博客</a></li>
<li><a href="http://writeblog.csdn.net/configure.aspx" target="_blank">配置</a></li>
<li><a href="http://writeblog.csdn.net/PostEdit.aspx" target="_blank">写文章</a></li>
<li><a href="http://writeblog.csdn.net/PostList.aspx" target="_blank">文章管理</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">博客首页</a></li>
</ul>
<p>*</p>
<ul>
<li><p>全站 当前博客
*</p>
</li>
<li><p><a href="http://hi.csdn.net/wuxicxh" target="_blank">空间</a></p>
</li>
<li><a href="http://blog.csdn.net/wuxicxh" target="_blank">博客</a></li>
<li><a href="http://hi.csdn.net/!s/friend/list/wuxicxh" target="_blank">好友</a></li>
<li><a href="http://hi.csdn.net/!s/album/list/wuxicxh" target="_blank">相册</a></li>
<li><a href="http://hi.csdn.net/!s/wall/to/wuxicxh" target="_blank">留言</a></li>
</ul>
<p>用户操作<a href="http://hi.csdn.net/!s/wall/to/wuxicxh" target="_blank">[留言]</a>  <a href="http://hi.csdn.net/!s/msg/to/wuxicxh" target="_blank">[发消息]</a>  <a href="http://hi.csdn.net/!s/friend/add/wuxicxh" target="_blank">[加为好友]</a> 订阅我的博客<a href="http://feeds.feedsky.com/csdn.net/wuxicxh" target="_blank"><img src="" alt="XML聚合"></a>   <a href="http://feeds.feedsky.com/csdn.net/wuxicxh" target="_blank"><img src="" alt="FeedSky"></a><a href="http://www.xianguo.com/subscribe.php?url=http://feeds.feedsky.com/csdn.net/wuxicxh" target="_blank"><img src="" alt="订阅到鲜果"></a><a href="http://fusion.google.com/add?feedurl=http://feeds.feedsky.com/csdn.net/wuxicxh" target="_blank"><img src="" alt="订阅到Google"></a><a href="http://www.zhuaxia.com/add_channel.php?url=http://feeds.feedsky.com/csdn.net/wuxicxh" target="_blank"><img src="" alt="订阅到抓虾"></a><a href="http://writeblog.csdn.net/configure.aspx" target="_blank">[编辑]</a>wuxicxh的公告<a href="http://writeblog.csdn.net/EditCategories.aspx?catID=1" target="_blank">[编辑]</a>文章分类* <a href="http://blog.csdn.net/wuxicxh/category/629935.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/wuxicxh/category/629935.aspx" target="_blank">C++</a></p>
<ul>
<li><a href="http://blog.csdn.net/wuxicxh/category/629934.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/wuxicxh/category/629934.aspx" target="_blank">JAVA</a></li>
<li><a href="http://blog.csdn.net/wuxicxh/category/629930.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/wuxicxh/category/629930.aspx" target="_blank">操作系统</a></li>
<li><a href="http://blog.csdn.net/wuxicxh/category/629926.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/wuxicxh/category/629926.aspx" target="_blank">软件测试</a></li>
<li><a href="http://blog.csdn.net/wuxicxh/category/629929.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/wuxicxh/category/629929.aspx" target="_blank">软件开发</a></li>
<li><a href="http://blog.csdn.net/wuxicxh/category/629925.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/wuxicxh/category/629925.aspx" target="_blank">数据库</a></li>
<li><a href="http://blog.csdn.net/wuxicxh/category/629931.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/wuxicxh/category/629931.aspx" target="_blank">网络</a></li>
<li><a href="http://blog.csdn.net/wuxicxh/category/629938.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/wuxicxh/category/629938.aspx" target="_blank">性能测试</a></li>
<li><a href="http://blog.csdn.net/wuxicxh/category/629927.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/wuxicxh/category/629927.aspx" target="_blank">英语</a>存档* <a href="http://blog.csdn.net/wuxicxh/archive/2010/04.aspx" target="_blank">2010年04月(1)</a></li>
<li><a href="http://blog.csdn.net/wuxicxh/archive/2010/01.aspx" target="_blank">2010年01月(1)</a></li>
<li><a href="http://blog.csdn.net/wuxicxh/archive/2009/12.aspx" target="_blank">2009年12月(5)</a><h1 id="-unix-"><img src="" alt="原创">  unix系统中字符集的查看及修改方法 <a href="&quot;收藏到我的网摘中，并分享给我的朋友&quot;">收藏</a></h1>
</li>
</ul>
<p>一、查看字符集方法：</p>
<pre><code>  1、输入命令：echo $LANG

  2、输入命令：env | grep LANG

  3、输入命令：locale
</code></pre><p>二、修改字符集的方法：</p>
<pre><code>  编辑/etc/sysconfig/language文件，将该文件中的rc_lang=&quot; &quot;修改成rc_lang = &quot;zh_CN.GBK&quot;。然后在命令行中运行SuSEconfig命令激活更改。当运行完毕后注意一定要注销并重新登录，此时再运行locale时，就能看到当前系统的字符集是zh_CN.GBK了。
</code></pre><p>发表于 @ 2009年12月11日　11:26:00 | <a href="http://blog.csdn.net/wuxicxh/archive/2009/12/11/4985072.aspx#FeedBack" title="评论" target="_blank">评论( loading...  )</a>| <a href="http://writeblog.csdn.net/PostEdit.aspx?entryId=4985072" title="编辑" target="_blank">编辑</a>| <a href="mailto:webmaster@csdn.net?subject=Article Report!!!&amp;body=Author:wuxicxhURL:http://blog.csdn.net/ArticleContent.aspx?UserName=wuxicxh&amp;Entryid=4985072">举报</a>| <a href="&quot;收藏到我的网摘中，并分享给我的朋友&quot;">收藏</a></p>
<h3 id="-jdbc-mysql5-http-blog-csdn-net-wuxicxh-archive-2009-12-10-4979436-aspx-loadruner-http-blog-csdn-net-wuxicxh-archive-2009-12-11-4985235-aspx-"><a href="http://blog.csdn.net/wuxicxh/archive/2009/12/10/4979436.aspx" target="_blank">旧一篇:JDBC调用MySQL5存储过程</a> | <a href="http://blog.csdn.net/wuxicxh/archive/2009/12/11/4985235.aspx" target="_blank">新一篇:LoadRuner选择录制方式的原则</a></h3>
<p><a href="http://blog.csdn.net/" target="_blank">查看最新精华文章 请访问博客首页</a>相关文章<a href=""></a></p>
<ul>
<li><p>发表评论</p>
</li>
<li><p>表 情：</p>
</li>
<li><p><a href="http://blog.csdn.net/wuxicxh/archive/2009/12/11/4985072.aspx#" target="_blank"><img src="&quot;顶&quot;" alt="顶"></a> <a href="http://blog.csdn.net/wuxicxh/archive/2009/12/11/4985072.aspx#" target="_blank"><img src="&quot;砸&quot;" alt="砸"></a> <a href="http://blog.csdn.net/wuxicxh/archive/2009/12/11/4985072.aspx#" target="_blank"><img src="&quot;棒&quot;" alt="棒"></a> <a href="http://blog.csdn.net/wuxicxh/archive/2009/12/11/4985072.aspx#" target="_blank"><img src="&quot;大笑&quot;" alt="大笑"></a> <a href="http://blog.csdn.net/wuxicxh/archive/2009/12/11/4985072.aspx#" target="_blank"><img src="&quot;愤怒&quot;" alt="愤怒"></a> <a href="http://blog.csdn.net/wuxicxh/archive/2009/12/11/4985072.aspx#" target="_blank"><img src="&quot;大哭&quot;" alt="大哭"></a> <a href="http://blog.csdn.net/wuxicxh/archive/2009/12/11/4985072.aspx#" target="_blank"><img src="&quot;疑问&quot;" alt="疑问"></a> <a href="http://blog.csdn.net/wuxicxh/archive/2009/12/11/4985072.aspx#" target="_blank"><img src="&quot;汗&quot;" alt="汗"></a> <a href="http://blog.csdn.net/wuxicxh/archive/2009/12/11/4985072.aspx#" target="_blank"><img src="&quot;呕吐&quot;" alt="呕吐"></a> <a href="http://blog.csdn.net/wuxicxh/archive/2009/12/11/4985072.aspx#" target="_blank"><img src="&quot;送花&quot;" alt="送花"></a></p>
</li>
<li><p>评论内容：
*</p>
</li>
<li>用 户 名：</li>
<li><p><a href="">登录</a> <a href="http://passport.csdn.net/CSDNUserRegister.aspx" target="_blank">注册</a> 匿名评论</p>
</li>
<li><p>验 证 码：</p>
</li>
<li><a href=""><img src="" alt="验证码"></a> <a href="">重新获得验证码</a></li>
</ul>
<p><em>
</em><img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/unix/">unix</a></li></span></span> | <span class="tags">Tagged <a href="/tags/unix/" class="label label-primary">unix</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:43"datetime="2014-03-07 09:54:43"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-unix--unix系统中字符集的查看及修改方法/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-unix--unix系统中字符集的查看及修改方法" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/35/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/33/">33</a></li><li><a class="page-number" href="/page/34/">34</a></li><li><a class="page-number" href="/page/35/">35</a></li><li class="active"><li><span class="page-number current">36</span></li><li><a class="page-number" href="/page/37/">37</a></li><li><a class="page-number" href="/page/38/">38</a></li><li><a class="page-number" href="/page/39/">39</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/37/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 19:25:39</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
