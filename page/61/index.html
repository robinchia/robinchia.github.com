
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 61 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--使用J-Interop在Java中调用WMI/">使用 J</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--使用J-Interop在Java中调用WMI/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-j-interop-java-wmi">使用 J-Interop 在 Java 中调用WMI</h1>
<p><a href="http://simpleframework.net/space.html" target="_blank">我的空间</a> <img src="" alt="">|<a href="http://simpleframework.net/invite.html" target="_blank">邀请</a> |<a href="">登录</a>|<a href="http://simpleframework.net/regist.html" target="_blank">注册</a> <a href="http://simpleframework.net/" target="_blank"> </a>  简单就是最好的，java web 开发，simple 让你化繁为简 !</p>
<p><a href="http://simpleframework.net/index.html" target="_blank">首页</a><a href=""></a><a href="http://simpleframework.net/news.html">新闻资讯</a><a href=""></a><a href="http://simpleframework.net/blog.html">博客</a><a href=""></a><a href="http://simpleframework.net/bbs.html">论坛</a><a href=""></a><a href="http://simpleframework.net/market.html">Simple市场</a><a href=""></a><a href="http://simpleframework.net/doc/d2.html">全面介绍</a><a href=""></a><a href="http://demo.simpleframework.net/simple3">simple3演示</a><a href=""></a><a href="http://simple4.simpleframework.net/simple4">simple4演示</a><a href=""></a><a href="http://simpleframework.net/home.html">My Portal</a></p>
<p><img src="" alt=""><a href="http://simpleframework.net/news/v/27953.html" target="_blank">SimpleFramework开发者必读</a></p>
<p><a href="http://simpleframework.net/space/176.html" target="_blank"><img src="" alt=""></a></p>
<p><a href="http://simpleframework.net/blog/176.html" target="_blank">赵老师的博客</a></p>
<ul>
<li><a href="http://simpleframework.net/blog.html" target="_blank">全部</a></li>
<li><a href="http://simpleframework.net/blog.html?t=recommended" target="_blank">推荐</a></li>
<li><a href="http://simpleframework.net/$resource/default/login/jsp/location.jsp" target="_blank">关注</a></li>
<li><a href="http://simpleframework.net/$resource/default/login/jsp/location.jsp" target="_blank">我的博客</a></li>
</ul>
<p><a href="">关注</a> (<a href="">1</a>)</p>
<p><a href="http://simpleframework.net/blog.html" target="_blank">博客</a>»<a href="http://simpleframework.net/blog/176.html" target="_blank">赵老师</a>»显示全文</p>
<p>使用 J-Interop 在 Java 中调用WMI
5评/3355阅</p>
<p>发表于: 2011-06-16 07:12</p>
<p><strong>有关**</strong>WMI<strong>**的小知识</strong></p>
<p><a href="http://msdn.microsoft.com/en-us/library/aa394582(VS.85" target="_blank"><strong>Windows**</strong>管理规范（<strong><strong>WMI</strong></strong>）**</a>.aspx)是微软对来自<a href="http://en.wikipedia.org/wiki/Distributed_Management_Task_Force" title="Distributed Management Task Force" target="_blank">分布式管理任务组</a>（<strong>DMTF</strong>）的<a href="http://en.wikipedia.org/wiki/Web-Based_Enterprise_Management" title="Web-Based Enterprise Management" target="_blank">基于Web的企业管理</a>（WBEM）和<a href="http://en.wikipedia.org/wiki/Common_Information_Model_(computing" target="_blank">通用信息模型</a> &quot;Common Information Model (computing)&quot;)（CIM）标准的实现。WMI用于访问Windows系统、应用、网络、设备等组件，并管理它们。连接到一台机器通过<strong>DCOM</strong>进行管理。因此，有关<strong>DCOM</strong>的小知识将有助于本文的理解。你可以到MSDN了解有关WMI的更多细节。</p>
<h3 id="-j-interop-"><strong>J-Interop</strong></h3>
<p>市场上有一些在使用 JAVA 调用 WMI 的好库，包括 <a href="http://www.j-interop.org/index.html" target="_blank">J-Interop</a>、<a href="http://sourceforge.net/projects/jacob-project/" target="_blank">JACOB-Project</a> 和 <a href="http://j-integra.intrinsyc.com/products/com/" target="_blank">J-Integra</a>。其中，我更喜欢J-Interop，因为它是完全免费和开源的API。它提供了没有任何依赖的纯DCOM桥，完全用Java编写的没有任何JNI代码。</p>
<h3 id="-wmi-windows-"><strong>使用**</strong>WMI<strong><strong>管理</strong></strong>Windows<strong>**服务</strong></h3>
<p>现在，来看一个使用JAVA调用WMI的例子。这个例子利用J-Interop的API使用Win32_Service类解释WMI操作，将启动和停止在这个例子中的窗口服务。</p>
<h3 id="-1-wbem-"><strong>步骤**</strong>1<strong><strong>：连接到</strong></strong>WBEM<strong>**服务</strong></h3>
<p>下面的代码示例显示了使用J-Interop如何初始化DCOM会话，并连接到远程DCOM服务使。它使用SWbemLocator对象连接到<strong>SWbemServices</strong>，<strong>SWbemServices</strong>对象提供对本地或远程计算机WMI的访问，它调用“ConnectServer”方法连接到<strong>SWbemServices**</strong>。在本例中，<em>提供管理员级别的用户连接到远程计算机。**</em>
JISessiondcomSession=JISession.createSession(domainName,userName,password); dcomSession.useSessionSecurity(false);   JIComServercomServer=newJIComServer(valueOf(&quot;WbemScripting.SWbemLocator&quot;),hostIP,dcomSession); IJIDispatchwbemLocator=(IJIDispatch)narrowObject(comServer.createInstance().queryInterface(IID)); //parameterstoconnecttoWbemScripting.SWbemLocator Object[]params=newObject[]{                           newJIString(hostIP),//strServer                           newJIString(win32_namespace),//strNamespace                           JIVariant.OPTIONAL_PARAM(),//strUser                           JIVariant.OPTIONAL_PARAM(),//strPassword                           JIVariant.OPTIONAL_PARAM(),//strLocale                           JIVariant.OPTIONAL_PARAM(),//strAuthority                           newInteger(0),//iSecurityFlags                           JIVariant.OPTIONAL_PARAM()//objwbemNamedValueSet                           };   JIVariantresults[]=wbemLocator.callMethodA(&quot;ConnectServer&quot;,params); IJIDispatchwbemServices=(IJIDispatch)narrowObject(results[0].getObjectAsComObject());</p>
<p>（<strong>domainName</strong>=远程计算机域名，<strong>hostIP</strong>=远程计算机IP地址,<strong>用户名</strong>=管理员级别的用户，<strong>密码</strong>=密码）</p>
<h3 id="-2-win32_service-"><strong>第**</strong>2<strong><strong>步：获取</strong></strong>Win32_Service<strong>**实例</strong></h3>
<p>一旦你获得对<strong>SWbemServices</strong>对象的引用，就可以调用这个类的任何方法。其中<strong>WbemServices.InstancesOf**</strong>方法获得任何<strong><strong>Win32</strong></strong>类的实例。**</p>
<p>也可以使用WMI查询语言(WQL)达到同样的目的，如下所示：
finalintRETURN_IMMEDIATE=0x10; finalintFORWARD_ONLY=0x20; Object[]params=newObject[]{ newJIString(&quot;SELECT/*FROMWin32_Service&quot;), JIVariant.OPTIONAL_PARAM(), newJIVariant(newInteger(RETURN_IMMEDIATE+FORWARD_ONLY)) }; JIVariant[]servicesSet=wbemServices.callMethodA(&quot;ExecQuery&quot;,params); IJIDispatchwbemObjectSet=(IJIDispatch)narrowObject(servicesSet[0].getObjectAsComObject());</p>
<h3 id="-"><strong>第三步：执行方法</strong></h3>
<p>现在，已得到<strong>Win32_Service</strong>类的实例，可采用下述代码来调用同一类的方法，因为，它返回多个服务实例，要列举它们以便获取IJIDispatcher服务。
JIVariant newEnumvariant = wbemObjectSet.get(&quot;_NewEnum&quot;); IJIComObject enumComObject = newEnumvariant.getObjectAsComObject(); IJIEnumVariant enumVariant = (IJIEnumVariant) narrowObject(enumComObject.queryInterface(IJIEnumVariant.IID));   Object[] elements = enumVariant.next(1); JIArray aJIArray = (JIArray) elements[0];   JIVariant[] array = (JIVariant[]) aJIArray.getArrayInstance(); for (JIVariant variant : array) {     IJIDispatch wbemObjectDispatch = (IJIDispatch) narrowObject(variant.getObjectAsComObject());       JIVariant returnStatus = wbemObjectDispatch.callMethodA(&quot;StopService&quot;);       System.out.println(returnStatus.getObjectAsInt()); }</p>
<p>现在，下面的代码显示了一个使用WMI启动和停止Windows服务的完整Java类。</p>
<p>packagecom.wmi.windows;   importstaticorg.jinterop.dcom.core.JIProgId.valueOf; importstaticorg.jinterop.dcom.impls.JIObjectFactory.narrowObject; importstaticorg.jinterop.dcom.impls.automation.IJIDispatch.IID; importjava.util.logging.Level; importorg.jinterop.dcom.common.JIException; importorg.jinterop.dcom.common.JIRuntimeException; importorg.jinterop.dcom.common.JISystem; importorg.jinterop.dcom.core.IJIComObject; importorg.jinterop.dcom.core.JIArray; importorg.jinterop.dcom.core.JIComServer; importorg.jinterop.dcom.core.JISession; importorg.jinterop.dcom.core.JIString; importorg.jinterop.dcom.core.JIVariant; importorg.jinterop.dcom.impls.automation.IJIDispatch; importorg.jinterop.dcom.impls.automation.IJIEnumVariant;   publicclassServiceManager{            privatestaticStringdomainName=&quot;&quot;;          privatestaticStringuserName=&quot;administrator&quot;;          privatestaticStringpassword=&quot;&quot;;          privatestaticStringhostIP=&quot;127.0.0.1&quot;;          privatestaticfinalStringwin32<em>namespace=&quot;ROOT\CIMV2&quot;;            privatestaticfinalintSTOP_SERVICE=0;          privatestaticfinalintSTART_SERVICE=1;            privateJISessiondcomSession=null;          //<em>/</em>          /<em>          /</em>@paramargs          /<em>/          publicstaticvoidmain(String[]args){                  ServiceManagermanager=newServiceManager();                   manager.stopService(domainName,hostIP,userName,password,&quot;MySql&quot;);//stopsaservicenamedMySql          }          //</em>/<em>          /</em>Startsagivenserviceifitsstopped.          /<em>          /</em>@paramdomainName          /<em>@paramhostname          /</em>@paramusername          /<em>@parampassword          /</em>@paramserviceName          /<em>/    publicvoidstartService(StringdomainName,Stringhostname,Stringusername,Stringpassword,StringserviceName){                  execute(domainName,hostname,username,password,serviceName,START_SERVICE);          }          //</em>/<em>          /</em>Stopsagivenserviceifitsrunning.          /<em>          /</em>@paramdomainName          /<em>@paramhostname          /</em>@paramusername          /<em>@parampassword          /</em>@paramserviceName          /<em>/     publicvoidstopService(StringdomainName,Stringhostname,Stringusername,Stringpassword,StringserviceName){                  execute(domainName,hostname,username,password,serviceName,STOP_SERVICE);          }          //</em>/<em>          /</em>Starts/Stopsagivenserviceofremotemachineashostname.          /<em>          /</em>@paramdomainName          /<em>@paramhostname          /</em>@paramusername          /<em>@parampassword          /</em>@paramserviceName          /<em>@paramaction          /</em>/ publicvoidexecute(StringdomainName,Stringhostname,Stringusername,Stringpassword,StringserviceName,intaction){                    try{                           IJIDispatchwbemServices=createCOMServer();                             finalintRETURN_IMMEDIATE=0x10;                           finalintFORWARD_ONLY=0x20;                           Object[]params=newObject[]{                                             newJIString(&quot;SELECT/*FROMWin32_ServiceWHEREName=&#39;&quot;+serviceName+&quot;&#39;&quot;),                                             JIVariant.OPTIONAL_PARAM(),                                             newJIVariant(newInteger(RETURN_IMMEDIATE+FORWARD_ONLY))                           };                           JIVariant[]servicesSet=wbemServices.callMethodA(&quot;ExecQuery&quot;,params);                           IJIDispatchwbemObjectSet=(IJIDispatch)narrowObject(servicesSet[0].getObjectAsComObject());                             JIVariantnewEnumvariant=wbemObjectSet.get(&quot;_NewEnum&quot;);                           IJIComObjectenumComObject=newEnumvariant.getObjectAsComObject();                    IJIEnumVariantenumVariant=(IJIEnumVariant)narrowObject(enumComObject.queryInterface(IJIEnumVariant.IID));                             Object[]elements=enumVariant.next(1);                           JIArrayaJIArray=(JIArray)elements[0];                             JIVariant[]array=(JIVariant[])aJIArray.getArrayInstance();                           for(JIVariantvariant:array){                                    IJIDispatchwbemObjectDispatch=(IJIDispatch)narrowObject(variant.getObjectAsComObject());                                      //Printobjectastext.                                    JIVariant[]v=wbemObjectDispatch.callMethodA(&quot;GetObjectText</em>&quot;,newObject[]{1});                                    System.out.println(v[0].getObjectAsString().getString());                                      //StartorStoptheservice                                    StringmethodToInvoke=(action==START_SERVICE)?&quot;StartService&quot;:&quot;StopService&quot;;                                    JIVariantreturnStatus=wbemObjectDispatch.callMethodA(methodToInvoke);                           System.out.println(&quot;Returnstatus:&quot;+returnStatus.getObjectAsInt());//ifreturncode=0success.Seemsdnformoredetailsaboutthemethod.                           }                  }catch(Exceptione){                           e.printStackTrace();                  }finally{                           if(dcomSession!=null){                                    try{                                             JISession.destroySession(dcomSession);                                    }catch(Exceptionex){                                             ex.printStackTrace();                                    }                           }                  }          }          //<em>/</em>          /<em>InitializeDCOMsessionandconnecttoSWBEMserviceongivenhostmachine.          /</em>@return          /*/          privateIJIDispatchcreateCOMServer(){                  JIComServercomServer;                  try{                           JISystem.getLogger().setLevel(Level.WARNING);                           JISystem.setAutoRegisteration(true);                           dcomSession=JISession.createSession(domainName,userName,password);                           dcomSession.useSessionSecurity(false);                           comServer=newJIComServer(valueOf(&quot;WbemScripting.SWbemLocator&quot;),hostIP,dcomSession);                             IJIDispatchwbemLocator=(IJIDispatch)narrowObject(comServer.createInstance().queryInterface(IID));                           //parameterstoconnecttoWbemScripting.SWbemLocator                           Object[]params=newObject[]{                                             newJIString(hostIP),//strServer                                             newJIString(win32_namespace),//strNamespace                                             JIVariant.OPTIONAL_PARAM(),//strUser                                             JIVariant.OPTIONAL_PARAM(),//strPassword                                             JIVariant.OPTIONAL_PARAM(),//strLocale                                             JIVariant.OPTIONAL_PARAM(),//strAuthority                                             newInteger(0),//iSecurityFlags                                             JIVariant.OPTIONAL_PARAM()//objwbemNamedValueSet                           };                           JIVariantresults[]=wbemLocator.callMethodA(&quot;ConnectServer&quot;,params);                           IJIDispatchwbemServices=(IJIDispatch)narrowObject(results[0].getObjectAsComObject());                           returnwbemServices;                  }catch(JIExceptionjie){                           System.out.println(jie.getMessage());                           jie.printStackTrace();                  }catch(JIRuntimeExceptionjire){                           jire.printStackTrace();                  }catch(Exceptione){                           e.printStackTrace();                  }finally{                           if(dcomSession!=null){                                    try{                                             JISession.destroySession(dcomSession);                                    }catch(JIExceptione){                                             e.printStackTrace();                                    }                           }                  }                  returnnull;          } }</p>
<p>【原文】<a href="http://nikunjp.wordpress.com/" target="_blank"><a href="http://nikunjp.wordpress.com/">http://nikunjp.wordpress.com/</a></a>
评论 (共 5 条评论)</p>
<p>匿名 (219.142.23.106), 475天前</p>
<p>j-interop 远程收集WIN7 的eventlog日志怎么不行啊，求助赵老师
<a href="">回复</a>|<a href="">支持</a>|<a href="">反对</a>
匿名 (219.142.23.106), 475天前</p>
<p>是啊，win7怎么不行呢。。
<a href="">回复</a>|<a href="">支持</a>|<a href="">反对</a></p>
<p>匿名 (59.40.119.215), 497天前</p>
<p>xp的开始Remote Register 服务就可以了。 win7还在研究中
<a href="">回复</a>|<a href="">支持</a>|<a href="">反对</a>
匿名 (219.133.0.1), 501天前</p>
<p>win7平台为什么会用不了呢？ 我也测试过了，xp的机器可以成功运行。
有些xp的也不行，我觉得可能是有什么配置项没有配置而导致。
<a href="">回复</a>|<a href="">支持</a>|<a href="">反对</a></p>
<p>匿名 (111.4.219.247), 722天前</p>
<p>我测试报错：The system cannot find the file specified. win7平台。
<a href="">回复</a>|<a href="">支持</a>|<a href="">反对</a> (共5, 显示全部)/</p>
<p><a href="">表情</a> 发表评论</p>
<p><img src="" alt=""></p>
<p><a href="">看不清楚，再换一张</a> <a href="">高级模式</a></p>
<p>相关主题</p>
<p><a href="http://simpleframework.net/blog/v/32903.html" target="_blank">JAVA问题定位技术</a> 2/3333</p>
<p><a href="http://simpleframework.net/space/26397.html" target="_blank">sword</a>, 799天前</p>
<p><a href="http://simpleframework.net/blog/v/18467.html" target="_blank">Java序列化和克隆</a> 0/1568</p>
<p><a href="http://simpleframework.net/space/534.html" target="_blank">书生</a>, 870天前
<a href="http://simpleframework.net/blog/v/46888.html" target="_blank">Java EE6中的装饰器，高级用法</a> 0/1163</p>
<p><a href="http://simpleframework.net/space/176.html" target="_blank">赵老师</a>, 733天前</p>
<p><a href="http://simpleframework.net/blog/v/16596.html" target="_blank">通过 Java 编程处理 XML 服务定义</a> 1/1691</p>
<p><a href="http://simpleframework.net/space/534.html" target="_blank">书生</a>, 877天前
<a href="http://simpleframework.net/blog/v/34389.html" target="_blank">解析Java软件开发中的五种认识误区</a> 0/1178</p>
<p><a href="http://simpleframework.net/space/534.html" target="_blank">书生</a>, 792天前</p>
<p><a href="http://simpleframework.net/blog/v/23210.html" target="_blank">Java内省和反射机制三步曲之(2)反射</a> 0/1409</p>
<p><a href="http://simpleframework.net/space/534.html" target="_blank">书生</a>, 854天前</p>
<p>一周点击排行
<a href="http://simpleframework.net/guestbook.html" target="_blank">留言</a>|<a href="http://simpleframework.net/contact.html" target="_blank">联系我们</a>|<a href="http://simpleframework.net/copyright.html" target="_blank">版权声明</a>|<a href="http://simpleframework.net/about.html" target="_blank">关于</a></p>
<p>simpleframework.net Copyright ©2011 版权所有</p>
<p>Powered by SimpleFramework [ 0.156 s ]</p>
<p>*</p>
<ul>
<li>数据装载中...
*</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/java-com/">java-com</a></li><li><a href="/categories/Java&J2EE/java-com/wmi-监控/">wmi-监控</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/java-com/" class="label label-success">java-com</a><a href="/tags/wmi-监控/" class="label label-info">wmi-监控</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--使用J-Interop在Java中调用WMI/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-java-com-wmi-监控--使用J-Interop在Java中调用WMI" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--多线程讲解/">多线程讲解</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--多线程讲解/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">多线程讲解</h1>
<p>多线程是java应用程序的一个特点，掌握java的多线程也是作为一java程序员必备的知识。多线程指的是在单个程序中可以同时运行多个同的线程执行不同的任务.线程是程序内的顺序控制流，只能使用分配给序的资源和环境。还记得刚开始学习的时候总是和进程分不清，总是对这两个名词所迷惑。</p>
<p>下面就首先对这两个名词区分来作为本篇博客的开始：</p>
<p><strong>    一、线程与进程的区别</strong></p>
<p>多个进程的内部数据和状态都是完全独立的,而多线程是共享一块内存空间和一组系统资源,有可能互相影响. •线程本身的数据通常只有寄存器数据，以及一个程序执行时使用的堆栈，所以线程的切换比进程切换的负担要小。</p>
<p> 多线程编程的目的，就是&quot;最大限度地利用CPU资源&quot;，当某一线程的处理不需要占用CPU而只和I/O等资源打交道时，让需要占用CPU资源的其它线程有机会获得CPU资源。从根本上说，这就是多线程编程的最终目的。</p>
<p>二、了解一下java在多线程中的基础知识</p>
<p>1.Java中如果我们自己没有产生线程，那么系统就会给我们产生一个线程（主线程，main方法就在主线程上运行），我们的程序都是由线程来执行的。</p>
<ol>
<li>进程：执行中的程序（程序是静态的概念，进程是动态的概念）。 </li>
</ol>
<ol>
<li><p>线程的实现有两种方式，<strong>第一种方式是继承Thread类，然后重写run方法；第二种是实现Runnable接口，然后实现其run方法。 </strong></p>
</li>
<li><p>将我们希望线程执行的代码放到run方法中，然后通过start方法来启动线程，<strong>start方法首先为线程的执行准备好系统资源，然后再去调用run方法。</strong>当某个类继承了Thread类之后，该类就叫做一个线程类。 </p>
</li>
<li><p>一个进程至少要包含一个线程。 </p>
</li>
<li><p>对于单核CPU来说，某一时刻只能有一个线程在执行（微观串行），从宏观角度来看，多个线程在同时执行（宏观并行）。 </p>
</li>
<li><p>对于双核或双核以上的CPU来说，可以真正做到微观并行。</p>
</li>
</ol>
<p>三、Thread源码研究： </p>
<p>1) Thread类也实现了Runnable接口，因此实现了Runnable接口中的run方法； </p>
<p>2) 当生成一个线程对象时，如果没有为其设定名字，那么线程对象的名字将使用如下形式：Thread-number,该number将是自动增加的，并被所有的Thread对象所共享（因为它是static的成员变量）。 </p>
<p>3) 当使用第一种方式来生成线程对象时，我们需要重写run方法，因为Thread类的run方法此时什么事情也不做。</p>
<p>4）当使用第二种方式生成线程对象时，我们需要实现Runnable接口的run方法，然后使用new Thread（new MyThread（））（假如MyThread已经实现了Runnable接口）来生成线程对象，这时的线程对象的run方法或调就会MyThread类的run方法，这样我们自己编写的run方法就执行了。</p>
<p>说明： </p>
<p>Public void run(){</p>
<p>If(target!=null){</p>
<p>Target.run();</p>
<p>}}</p>
<p>当使用继承Thread生成线程对象时，target为空，什么也不执行，当使用第二种方式生成时，执行target.run（），target为runnable的实例对象，即为执行重写后的方法</p>
<p>总结：两种生成线程对象的区别：</p>
<p>1.两种方法均需执行线程的start方法为线程分配必须的系统资源、调度线程运行并执行线程的run方法。 </p>
<p>2.在具体应用中，采用哪种方法来构造线程体要视情况而定。通常，当一个线程已继承了另一个类时，就应该用第二种方法来构造，即实现Runnable接口。 </p>
<p><strong>四：线程的生命周期：</strong></p>
<p><img src="" alt=""></p>
<p>由上图可以看出，一个线程由出生到死亡分为五个阶段：</p>
<p><strong>1）.创建状态 </strong></p>
<p>•当用new操作符创建一个新的线程对象时，该线程处于创建状态。 </p>
<p>•处于创建状态的线程只是一个空的线程对象，系统不为它分配资源 </p>
<p><strong>2）. 可运行状态 </strong></p>
<p>•执行线程的start()方法将为线程分配必须的系统资源，安排其运行，并调用线程体—run()方法，这样就使得该线程处于可运行( Runnable )状态。 </p>
<p>•这一状态并不是运行中状态（Running )，因为线程也许实际上并未真正运行。 </p>
<p><strong>3）.不可运行状态 </strong></p>
<p>.当发生下列事件时，处于运行状态的线程会转入到不可运行状态。 </p>
<p>调用了sleep（）方法； </p>
<p>•线程调用wait方法等待特定条件的满足 </p>
<p>•线程输入/输出阻塞 </p>
<p><strong>4）返回可运行状态： </strong></p>
<p>•处于睡眠状态的线程在指定的时间过去后 </p>
<p>•如果线程在等待某一条件，另一个对象必须通过notify()或notifyAll()方法通知等待线程条件的改变 </p>
<p>•如果线程是因为输入/输出阻塞，等待输入/输出完成 </p>
<p><strong>5）. 消亡状态 </strong></p>
<p>当线程的run方法执行结束后，该线程自然消亡。 </p>
<p>注意：</p>
<p>1.停止线程的方式：不能使用Thread类的stop方法来终止线程的执行。一般要设定一个变量，在run方法中是一个循环，循环每次检查该变量，如果满足条件则继续执行，否则跳出循环，线程结束。 </p>
<p>2.不能依靠线程的优先级来决定线程的执行顺序。 </p>
<p><strong>五：多线程并发</strong></p>
<p>多线程并发是线程同步中比较常见的现象，java多线程为了避免多线程并发解决多线程共享数据同步问题提供了<strong>synchronized关键字</strong></p>
<p>synchronized关键字：当synchronized关键字修饰一个方法的时候，该方法叫做同步方法。 </p>
<p>1.Java中的每个对象都有一个锁（lock）或者叫做监视器（monitor），当访问某个对象的synchronized方法时，表示将该对象上锁，此时其他任何线程都无法再去访问该synchronized方法了，直到之前的那个线程执行方法完毕后（或者是抛出了异常），那么将该对象的锁释放掉，其他线程才有可能再去访问该synchronized方法。 </p>
<ol>
<li>如果一个对象有多个synchronized方法，某一时刻某个线程已经进入到了某个synchronized方法，那么在该方法没有执行完毕前，其他线程是无法访问该对象的任何synchronized方法的。 </li>
</ol>
<p>3.如果某个synchronized方法是static的，那么当线程访问该方法时，它锁的并不是synchronized方法所在的对象，而是synchronized方法所在的对象所对应的Class对象，因为Java中无论一个类有多少个对象，这些对象会对应唯一一个Class对象，因此当线程分别访问同一个类的两个对象的两个static，synchronized方法时，他们的执行顺序也是顺序的，也就是说一个线程先去执行方法，执行完毕后另一个线程才开始执行。 </p>
<ol>
<li>synchronized块，写法： </li>
</ol>
<p>synchronized(object) </p>
<p>{ </p>
<p>} </p>
<p>表示线程在执行的时候会对object对象上锁。 </p>
<p>5.synchronized方法是一种粗粒度的并发控制，某一时刻，只能有一个线程执行该synchronized方法;synchronized块则是一种细粒度的并发控制，只会将块中的代码同步，位于方法内、synchronized块之外的代码是可以被多个线程同时访问到的。 </p>
<p>同步的线程状态图：</p>
<p><img src="" alt=""></p>
<p><strong>六：wait与notify</strong></p>
<p>1.wait与notify方法都是定义在Object类中，而且是final的，因此会被所有的Java类所继承并且无法重写。这两个方法要求在调用时线程应该已经获得了对象的锁，因此对这两个方法的调用需要放在synchronized方法或块当中。当线程执行了wait方法时，它会释放掉对象的锁。 </p>
<ol>
<li>另一个会导致线程暂停的方法就是Thread类的sleep方法，它会导致线程睡眠指定的毫秒数，但线程在睡眠的过程中是不会释放掉对象的锁的。 </li>
</ol>
<p>3.notify():唤醒在此对象监视器上等待的单个线程。如果所有线程都在此对象上等待，则会选择唤醒其中一个线程。选择是任意性的，并在对实现做出决定时发生。线程通过调用其中一个 wait 方法，在对象的监视器上等待。 </p>
<p>直到当前线程放弃此对象上的锁定，才能继续执行被唤醒的线程。被唤醒的线程将以常规方式与在该对象上主动同步的其他所有线程进行竞争；例如，唤醒的线程在作为锁定此对象的下一个线程方面没有可靠的特权或劣势。</p>
<p>此方法只应由作为此对象监视器的所有者的线程来调用。通过以下三种方法之一，线程可以成为此对象监视器的所有者：</p>
<p>o 通过执行此对象的同步实例方法。</p>
<p>o 通过执行在此对象上进行同步的 synchronized 语句的正文。</p>
<p>o 对于 Class 类型的对象，可以通过执行该类的同步静态方法。</p>
<p>一次只能有一个线程拥有对象的监视器。</p>
<p><img src="" alt=""></p>
<p> <strong>关于成员变量与局部变量</strong>：如果一个变量是成员变量，那么多个线程对同一个对象的成员变量进行操作时，他们对该成员变量是彼此影响的（也就是说一个线程对成员变量的改变会影响到另一个线程）。  如果一个变量是局部变量，那么每个线程都会有一个该局部变量的拷贝，一个线程对该局部变量的改变不会影响到其他的线程。</p>
<p><strong>七：死锁的问题： </strong></p>
<p>定义：线程1锁住了对象A的监视器，等待对象B的监视器，线程2锁住了对象B的监视器，等待对象A的监视器，就造成了死锁。</p>
<pre><code> 导致死锁的根源在于不适当地运用“synchronized”关键词来管理线程对特定对象的访问。“synchronized”关键词的作用是，确保在某个时刻只有一个线程被允许执行特定的代码块，因此，被允许执行的线程首先必须拥有对变量或对象的排他性访问权。当线程访问对象时，线程会给对象加锁
</code></pre><p>Java中每个对象都有一把锁与之对应。但Java不提供单独的lock和unlock操作。下面笔者分析死锁的两个过程“上锁”和“锁死” 。</p>
<p>(1) 上锁
     许多线程在执行中必须考虑与其他线程之间共享数据或协调执行状态，就需要同步机制。因此大多数应用程序要求线程互相通信来同步它们的动作，在 Java 程序中最简单实现同步的方法就是上锁。在 Java 编程中，所有的对象都有锁。线程可以使用 synchronized 关键字来获得锁。在任一时刻对于给定的类的实例，方法或同步的代码块只能被一个线程执行。这是因为代码在执行之前要求获得对象的锁。</p>
<pre><code>为了防止同时访问共享资源，线程在使用资源的前后可以给该资源上锁和开锁。给共享变量上锁就使得 Java 线程能够快速方便地通信和同步。某个线程若给一个对象上了锁，就可以知道没有其他线程能够访问该对象。即使在抢占式模型中，其他线程也不能够访问此对象，直到上锁的线程被唤醒、完成工作并开锁。那些试图访问一个上锁对象的线程通常会进入睡眠状态，直到上锁的线程开锁。一旦锁被打开，这些睡眠进程就会被唤醒并移到准备就绪队列中。
</code></pre><p>(2)锁死
     如果程序中有几个竞争资源的并发线程,那么保证均衡是很重要的。系统均衡是指每个线程在执行过程中都能充分访问有限的资源，系统中没有饿死和死锁的线程。当多个并发的线程分别试图同时占有两个锁时，会出现加锁冲突的情形。如果一个线程占有了另一个线程必需的锁，互相等待时被阻塞就有可能出现死锁。</p>
<pre><code>在编写多线程代码时，笔者认为死锁是最难处理的问题之一。因为死锁可能在最意想不到的地方发生，所以查找和修正它既费时又费力。例如，常见的例子如下面这段程序。[print](http://write.blog.csdn.net/postedit#)[?](http://write.blog.csdn.net/postedit#)
</code></pre><p>1 public int sumArrays(int[] a1, int[] a2){  </p>
<p>2   int value = 0;  </p>
<p>3   int size = a1.length;  </p>
<p>4   if (size == a2.length) {  </p>
<p>5      synchronized(a1) { //1        </p>
<p>6        synchronized(a2) { //2          </p>
<p>7          for (int i=0; i&lt;size; i++)  </p>
<p>8             value += a1[i] + a2[i];  </p>
<p>9        }    </p>
<p>10      }    </p>
<p>11   } return value;  </p>
<p>12 }   </p>
<p>这段代码在求和操作中访问两个数组对象之前锁定了这两个数组对象。它形式简短，编写也适合所要执行的任务；但不幸的是，它有一个潜在的问题。这个问题就是它埋下了死锁的种子。</p>
<p><strong>ThreadLocal类（这个类本人没用过，暂时不太懂）</strong></p>
<p>首先，ThreadLocal 不是用来解决共享对象的多线程访问问题的，一般情况下，通过ThreadLocal.set() 到线程中的对象是该线程自己使用的对象，其他线程是不需要访问的，也访问不到的。各个线程中访问的是不同的对象。
另外，说ThreadLocal使得各线程能够保持各自独立的一个对象，并不是通过ThreadLocal.set()来实现的，而是通过每个线程中的new 对象 的操作来创建的对象，每个线程创建一个，不是什么对象的拷贝或副本。通过ThreadLocal.set()将这个新创建的对象的引用保存到各线程的自己的一个map中，每个线程都有这样一个map，执行ThreadLocal.get()时，各线程从自己的map中取出放进去的对象，因此取出来的是各自自己线程中的对象，ThreadLocal实例是作为map的key来使用的。
如果ThreadLocal.set()进去的东西本来就是多个线程共享的同一个对象，那么多个线程的ThreadLocal.get()取得的还是这个共享对象本身，还是有并发访问问题。</p>
<p><strong> 本文来自：曹胜欢博客专栏。转载请注明出处：<a href="http://blog.csdn.net/csh624366188" target="_blank"><a href="http://blog.csdn.net/csh624366188">http://blog.csdn.net/csh624366188</a></a></strong></p>
<p>来源： <a href="[http://blog.csdn.net/csh624366188/article/details/7318245](http://blog.csdn.net/csh624366188/article/details/7318245)">[http://blog.csdn.net/csh624366188/article/details/7318245](http://blog.csdn.net/csh624366188/article/details/7318245)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_多线程/">Java_多线程</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_多线程/" class="label label-success">Java_多线程</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--多线程讲解/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_多线程--多线程讲解" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--探索java多线程（连载）1守护线程-ikon-BlogJava/">探索java多线程（连载）1 守护线程 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--探索java多线程（连载）1守护线程-ikon-BlogJava/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-java-1-ikon-blogjava">探索java多线程（连载）1 守护线程 - ikon - BlogJava</h1>
<h1 id="-ikon-http-www-blogjava-net-ikon-"><a href="http://www.blogjava.net/ikon/" target="_blank">ikon</a></h1>
<p>posts - 1, comments - 0, trackbacks - 0, articles - 1   <a href="http://www.blogjava.net/" target="_blank">BlogJava</a> :: <a href="http://www.blogjava.net/ikon/" target="_blank">首页</a> :: <a href="http://www.blogjava.net/ikon/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a> :: <a href="http://www.blogjava.net/ikon/contact.aspx?id=1" target="_blank">联系</a> :: <a href="http://www.blogjava.net/ikon/rss" target="_blank">聚合</a> <a href="http://www.blogjava.net/ikon/rss" target="_blank"><img src="" alt=""></a> :: <a href="http://www.blogjava.net/ikon/admin/EditPosts.aspx" target="_blank">管理</a> <img src="" alt=""></p>
<h3 id="-">日历</h3>
<p><a href="&quot;Go to the previous month&quot;">&lt;</a>2011年3月<a href="&quot;Go to the next month&quot;">&gt;</a>日一二三四五六2728123456789101112131415161718192021<a href="http://www.blogjava.net/ikon/archive/2011/03/22.html" target="_blank">22</a>232425262728293031123456789</p>
<p><img src="" alt=""></p>
<h3 id="-">常用链接</h3>
<ul>
<li><a href="http://www.blogjava.net/ikon/MyPosts.html" target="_blank">我的随笔</a></li>
<li><a href="http://www.blogjava.net/ikon/MyComments.html" target="_blank">我的评论</a></li>
<li><a href="http://www.blogjava.net/ikon/OtherPosts.html" target="_blank">我的参与</a>
<img src="" alt=""></li>
</ul>
<h3 id="-">留言簿</h3>
<ul>
<li><a href="http://www.blogjava.net/ikon/Contact.aspx?id=1" target="_blank">给我留言</a></li>
<li><a href="http://www.blogjava.net/ikon/default.aspx?opt=msg" target="_blank">查看公开留言</a></li>
<li><a href="http://www.blogjava.net/ikon/admin/MyMessages.aspx" target="_blank">查看私人留言</a></li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-">随笔档案</h3>
<ul>
<li><a href="http://www.blogjava.net/ikon/archive/2011/03.html" target="_blank">2011年3月 (1)</a>
<img src="" alt=""></li>
</ul>
<h3 id="-">搜索</h3>
<ul>
<li></li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-http-www-blogjava-net-ikon-commentsrss-aspx-java-1-">最新评论 <a href="http://www.blogjava.net/ikon/CommentsRSS.aspx" target="_blank"><img src="" alt=""></a> ## <a href="">探索java多线程（连载）1 守护线程</a></h3>
<p>Posted on 2011-03-22 19:25 <a href="http://www.blogjava.net/ikon/" target="_blank">ikon</a> 阅读(1692) <a href="http://www.blogjava.net/ikon/archive/2011/03/22/346738.html#Post" target="_blank">评论(0)</a>  <a href="http://www.blogjava.net/ikon/admin/EditPosts.aspx?postid=346738" target="_blank">编辑</a>  <a href="http://www.blogjava.net/ikon/AddToFavorite.aspx?id=346738" target="_blank">收藏</a> <img src="" alt=""></p>
<pre><code>  在java中有一类线程，专门在后台提供服务，此类线程无需显式关闭，当程序结束了，它也就结束了，这就是守护线程 daemon thread。如果还有非守护线程的线程在执行，它就不会结束。      守护线程有何用处呢？让我们来看个实践中的例子。

  在我们的系统中经常应用各种配置文件（黑名单，禁用词汇），当修改配置文件后，一般要重启服务，系统才能够加载；当重启服务的代价比较高的情况下，这种加载方式不能满足我们的要求，这个时候守护线程该发挥它的作用了，它可以实时加载你的配置文件，无需重启。（当然，相当重要的配置文件，不推荐实时加载）
</code></pre><p><img src="" alt="">package com.ikon.thread.daemon;
<img src="" alt="">
<img src="" alt="">import java.io.File;
<img src="" alt="">import java.util./<em>;
<img src="" alt="">
<img src="" alt=""><img src="" alt="">//</em>/<em> /</em>///<em>/</em>
<img src="" alt=""> /<em> 文件监测
<img src="" alt=""> /</em> @author ikon99999
<img src="" alt=""> /<em> 
<img src="" alt=""> /</em>/
<img src="" alt=""><img src="" alt="">public abstract class FileWatchdog extends Thread <img src="" alt="">{
<img src="" alt="">
<img src="" alt=""> 
<img src="" alt="">  static final public long DEFAULT_DELAY = 20/*1000; 
<img src="" alt=""> 
<img src="" alt=""><br><img src="" alt="">  protected HashMap fileList;
<img src="" alt=""> 
<img src="" alt="">  protected long delay = DEFAULT_DELAY; 
<img src="" alt=""><br><img src="" alt="">  boolean warnedAlready = false;
<img src="" alt=""><br><img src="" alt="">  boolean interrupted = false;
<img src="" alt="">
<img src="" alt="">  public static class Entity
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{
<img src="" alt="">        File file;
<img src="" alt="">        long lastModify;
<img src="" alt="">        Entity(File file,long lastModify)
<img src="" alt=""><img src="" alt="">        <img src="" alt="">{
<img src="" alt="">            this.file = file;
<img src="" alt="">            this.lastModify = lastModify;
<img src="" alt="">        }
<img src="" alt="">  }
<img src="" alt=""><br><img src="" alt=""><img src="" alt="">  protected  FileWatchdog() <img src="" alt="">{
<img src="" alt="">      fileList = new HashMap ();
<img src="" alt="">    setDaemon(true);
<img src="" alt="">  }
<img src="" alt="">
<img src="" alt=""> 
<img src="" alt=""><img src="" alt="">  public  void setDelay(long delay) <img src="" alt="">{
<img src="" alt="">    this.delay = delay;
<img src="" alt="">  }
<img src="" alt="">
<img src="" alt="">  public void addFile(File file)
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{
<img src="" alt="">        fileList.put(file.getAbsolutePath(),new Entity(file,file.lastModified()));<br><img src="" alt="">  }
<img src="" alt=""><br><img src="" alt="">  public boolean contains(File file)
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{
<img src="" alt="">        if( fileList.get(file.getAbsolutePath()) != null) return true;
<img src="" alt="">        else return false;
<img src="" alt="">  }
<img src="" alt=""><br><img src="" alt="">  abstract   protected   void doOnChange(File file);
<img src="" alt="">
<img src="" alt=""><img src="" alt="">  protected  void checkAndConfigure() <img src="" alt="">{
<img src="" alt="">      HashMap map = (HashMap)fileList.clone(); 
<img src="" alt="">      Iterator it = map.values().iterator();
<img src="" alt=""><br><img src="" alt="">      while( it.hasNext())
<img src="" alt=""><img src="" alt="">      <img src="" alt="">{
<img src="" alt=""><br><img src="" alt="">            Entity entity = (Entity)it.next();
<img src="" alt=""><br><img src="" alt="">            boolean fileExists;
<img src="" alt=""><img src="" alt="">            try <img src="" alt="">{
<img src="" alt="">              fileExists = entity.file.exists();
<img src="" alt="">            } catch(SecurityException  e) 
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt="">              System.err.println (&quot;Was not allowed to read check file existance, file:[&quot;+ entity.file .getAbsolutePath() +&quot;].&quot;);
<img src="" alt="">              interrupted = true; 
<img src="" alt="">              return;
<img src="" alt="">            }
<img src="" alt="">
<img src="" alt="">            if(fileExists) 
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt=""><br><img src="" alt="">              long l = entity.file.lastModified(); // this can also throw a SecurityException
<img src="" alt=""><img src="" alt="">              if(l &gt; entity.lastModify) <img src="" alt="">{           // however, if we reached this point this
<img src="" alt="">                    entity.lastModify = l;              // is very unlikely.
<img src="" alt="">                    newThread(entity.file);
<img src="" alt="">              }
<img src="" alt="">            }
<img src="" alt="">            else 
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt="">                System.err.println (&quot;[&quot;+entity.file .getAbsolutePath()+&quot;] does not exist.&quot;);
<img src="" alt="">            }
<img src="" alt="">      }
<img src="" alt="">  }
<img src="" alt=""><br><img src="" alt="">  private void newThread(File file)
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{
<img src="" alt="">      class MyThread extends Thread
<img src="" alt=""><img src="" alt="">      <img src="" alt="">{
<img src="" alt="">            File f;
<img src="" alt="">            public MyThread(File f)
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt="">                this.f = f;
<img src="" alt="">            }
<img src="" alt=""><br><img src="" alt="">            public void run()
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt="">                doOnChange(f);
<img src="" alt="">            }
<img src="" alt="">      }
<img src="" alt=""><br><img src="" alt="">      MyThread mt = new MyThread(file);
<img src="" alt="">      mt.start();
<img src="" alt="">  }
<img src="" alt="">
<img src="" alt="">  public  void run() 
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{<br><img src="" alt=""><img src="" alt="">    while(!interrupted) <img src="" alt="">{
<img src="" alt=""><img src="" alt="">      try <img src="" alt="">{
<img src="" alt="">        Thread.currentThread().sleep(delay);
<img src="" alt=""><img src="" alt="">      } catch(InterruptedException e) <img src="" alt="">{
<img src="" alt="">    // no interruption expected
<img src="" alt="">      }
<img src="" alt="">      checkAndConfigure();
<img src="" alt="">    }
<img src="" alt="">  }
<img src="" alt="">}
<img src="" alt=""></p>
<pre><code>FileWatchdog是个抽象类，本身是线程的子类；在构造函数中设置为守护线程；
此类用hashmap维护着一个文件和最新修改时间值对，checkAndConfigure()方法用来检测哪些文件的修改时间更新了，如果发现文件更新了则调用doOnChange方法来完成监测逻辑；doOnChange方法是我们需要实现的；看下面关于一个黑名单服务的监测服务：
</code></pre><p> 1<img src="" alt="">package com.ikon.thread.daemon;
 2<img src="" alt="">
 3<img src="" alt="">import java.io.File;
 4<img src="" alt="">
 5<img src="" alt=""><img src="" alt="">//<em>/</em> /<em>///</em>/<em>
 6<img src="" alt=""> /</em> 黑名单服务
 7<img src="" alt=""> /<em> @author ikon99999
 8<img src="" alt=""> /</em> 2011-3-21
 9<img src="" alt=""> /<em>/
10<img src="" alt=""><img src="" alt="">public class BlacklistService <img src="" alt="">{
11<img src="" alt="">    private File configFile = new File(&quot;c:/blacklist.txt&quot;);
12<img src="" alt=""><br>13<img src="" alt=""><img src="" alt="">    public void init() throws Exception<img src="" alt="">{
14<img src="" alt="">        loadConfig();
15<img src="" alt="">        ConfigWatchDog dog = new ConfigWatchDog();
16<img src="" alt="">        dog.setName(&quot;daemon_demo_config_watchdog&quot;);//a
17<img src="" alt="">        dog.addFile(configFile);//b
18<img src="" alt="">        dog.start();//c
19<img src="" alt="">    }
20<img src="" alt=""><br>21<img src="" alt=""><img src="" alt="">    public void loadConfig()<img src="" alt="">{
22<img src="" alt=""><img src="" alt="">        try<img src="" alt="">{
23<img src="" alt="">            Thread.sleep(1/</em>1000);//d
24<img src="" alt=""><br>25<img src="" alt="">            System.out.println(&quot;加载黑名单&quot;);
26<img src="" alt=""><img src="" alt="">        }catch(InterruptedException ex)<img src="" alt="">{
27<img src="" alt="">            System.out.println(&quot;加载配置文件失败！&quot;);
28<img src="" alt="">        }
29<img src="" alt="">    }
30<img src="" alt=""><br>31<img src="" alt=""><img src="" alt="">    public File getConfigFile() <img src="" alt="">{
32<img src="" alt="">        return configFile;
33<img src="" alt="">    }
34<img src="" alt="">
35<img src="" alt=""><img src="" alt="">    public void setConfigFile(File configFile) <img src="" alt="">{
36<img src="" alt="">        this.configFile = configFile;
37<img src="" alt="">    }
38<img src="" alt="">
39<img src="" alt="">
40<img src="" alt=""><img src="" alt="">    private class ConfigWatchDog extends FileWatchdog<img src="" alt="">{
41<img src="" alt=""><br>42<img src="" alt="">        @Override
43<img src="" alt=""><img src="" alt="">        protected void doOnChange(File file) <img src="" alt="">{
44<img src="" alt="">            System.out.println(&quot;文件&quot;+file.getName()+&quot;发生改变，重新加载&quot;);
45<img src="" alt="">            loadConfig();
46<img src="" alt="">        }
47<img src="" alt=""><br>48<img src="" alt="">    }
49<img src="" alt=""><br>50<img src="" alt=""><img src="" alt="">    public static void main(String[] args) throws Exception <img src="" alt="">{
51<img src="" alt="">        BlacklistService service = new BlacklistService();
52<img src="" alt="">        service.init();
53<img src="" alt=""><br>54<img src="" alt="">        Thread.sleep(60/<em>60/</em>1000);//e
55<img src="" alt="">    }
56<img src="" alt="">}
57<img src="" alt="">
        ConfigWatchDog内部类实现了doOnChange(File file)方法，当文件被修改后，watchdog调用doOnChange方法完成重新加载操作；
        在blackservice的init方法中初始化watchdog线程；
        d：模拟文件加载耗时
        e：主要是防止主线程退出；
        其实上面的FileWatchdog就是取自log4j；</p>
<p><a href="http://www.blogjava.net/RequireRegister.aspx" target="_blank">新用户注册</a>  <a href="">刷新评论列表</a>  </p>
<p><a href=""></a> <a href="http://job.cnblogs.com/">找优秀程序员，就在博客园</a>
<a href="http://job.cnblogs.com/offer/12368/" target="_blank">网易有道诚聘CRM研发工程师</a>
<a href="http://job.cnblogs.com/offer/11576/" target="_blank">锦江国际诚聘Java高级软件工程师</a>
<a href="http://job.cnblogs.com/offer/12493/" target="_blank">福州几维网络诚聘Java服务端程序员</a>
IT新闻：
· <a href="http://news.cnblogs.com/n/101664/" target="_blank">开放，开放，开放 —— 垄断</a>
· <a href="http://news.cnblogs.com/n/101663/" target="_blank">GNOME讨论放弃支持非Linux操作系统</a>
· <a href="http://news.cnblogs.com/n/101662/" target="_blank">Chrome 13将隐藏地址栏</a>
· <a href="http://news.cnblogs.com/n/101661/" target="_blank">联想：USB 3.0将在2012年成为主流</a>
· <a href="http://news.cnblogs.com/n/101659/" target="_blank">意法半导体 CEO ：诺基亚 Windows Phone 将采用 U8500 双核芯片</a>   <a href="http://www.cnblogs.com/" target="_blank">博客园</a>  <a href="http://home.cnblogs.com/q/" target="_blank">博问</a>  <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>  <a href="http://job.cnblogs.com/cate-java_programmer/" target="_blank">Java程序员招聘</a> 标题  请输入标题 姓名  请输入你的姓名 主页 请输入验证码 验证码 /*  <img src="" alt=""> 内容(请不要发表任何与政治相关的内容) 请输入评论内容 Remember Me?   <a href="http://www.blogjava.net/login.aspx?ReturnURL=http://www.blogjava.net/ikon/archive/2011/03/22/346738.html&amp;SourceURL=/ikon/archive/2011/03/22/346738.html" target="_blank">登录</a>       [使用Ctrl+Enter键可以直接提交]    推荐职位：
· <a href="http://job.cnblogs.com/offer/5914/" target="_blank">北京.NET 研发工程师 (北京捷报数据)</a>
· <a href="http://job.cnblogs.com/offer/12527/" target="_blank">(北京).NET软件开发工程师(北京龙达)</a>
· <a href="http://job.cnblogs.com/offer/11584/" target="_blank">厦门高级.NET软件工程师(服务于美国Amazon)</a>
· <a href="http://job.cnblogs.com/offer/10723/" target="_blank">高级Web页面前端开发工程师(新蛋中国)</a>
· <a href="http://job.cnblogs.com/offer/12493/" target="_blank">厦门Java服务端程序员(福州几维网络)</a>
· <a href="http://job.cnblogs.com/offer/9051/" target="_blank">.NET 高级软件开发工程师 (新蛋中国)</a>
· <a href="http://job.cnblogs.com/offer/12439/" target="_blank">北京ASP.NET 工程师（月薪12k）(北京盛安德)</a>
· <a href="http://job.cnblogs.com/offer/12492/" target="_blank">厦门C/#游戏客户端程序员 (福州几维网络)</a></p>
<p>博客园首页随笔：
· <a href="http://www.cnblogs.com/kqingchao/archive/2011/05/20/character-encoding-2.html" target="_blank">字符编码浅谈（二）</a>
· <a href="http://www.cnblogs.com/xuesong/archive/2011/05/20/2051892.html" target="_blank">Windows Phone 7编程实践—必应地图导航</a>
· <a href="http://www.cnblogs.com/ini_always/archive/2011/05/20/2050517.html" target="_blank">绕死你不偿命的UNICODE、_UNICODE、<strong>TEXT、</strong>T、_T、_TEXT、TEXT宏</a>
· <a href="http://www.cnblogs.com/leslies2/archive/2011/05/20/2051844.html" target="_blank">学习笔记：JAVA RMI远程方法调用简单实例</a>
· <a href="http://www.cnblogs.com/bobomouse/archive/2011/05/20/2051846.html" target="_blank">关于CellSet转DataTable的改进方案</a>
知识库：
· <a href="http://kb.cnblogs.com/page/101423/" target="_blank">程序员的本质</a>
· <a href="http://kb.cnblogs.com/page/101345/" target="_blank">Scrum之成败——从自身案例说起</a>
· <a href="http://kb.cnblogs.com/page/101321/" target="_blank">清除代码异味</a>
· <a href="http://kb.cnblogs.com/page/101198/" target="_blank">详解.NET程序集的加载规则</a>
· <a href="http://kb.cnblogs.com/page/101162/" target="_blank">如何通过ildasm/ilasm修改assembly的IL代码</a> 最简洁阅读版式：
<a href="http://archive.cnblogs.com/b/346738/" target="_blank">探索java多线程（连载）1 守护线程</a> 网站导航:</p>
<p><a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园</a>   <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>   <a href="http://kb.cnblogs.com/" target="_blank">知识库</a>   <a href="http://www.cnweblog.com/" target="_blank">博客生活</a>   <a href="http://www.cnitblog.com/" target="_blank">IT博客网</a>   <a href="http://www.cppblog.com/" target="_blank">C++博客</a>   <a href="http://space.cnblogs.com/q/" title="IT问答" target="_blank">博问</a>   <a href="http://www.blogjava.net/ikon/archive/2011/03/22/346738.html?opt=admin" target="_blank">管理</a>    Powered by:
<a href="http://www.blogjava.net/" target="_blank">BlogJava</a>
Copyright © ikon</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_多线程/">Java_多线程</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_多线程/" class="label label-success">Java_多线程</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--探索java多线程（连载）1守护线程-ikon-BlogJava/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_多线程--探索java多线程（连载）1守护线程-ikon-BlogJava" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--用apache的configuration实现实时配置-steven_cheng-ITeye/">用apache的configuration实现实时配置 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--用apache的configuration实现实时配置-steven_cheng-ITeye/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-apache-configuration-steven_cheng-iteye-">用apache的configuration实现实时配置 - steven_cheng - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">新闻</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://steven-cheng.iteye.com/blog/70634#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/wiki" target="_blank">专栏</a>  <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://steven-cheng.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/all" target="_blank">我的应用</a> <a href="http://steven-cheng.iteye.com/login" target="_blank">登录</a> <a href="http://steven-cheng.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-steven_cheng-http-steven-cheng-iteye-com-"><a href="http://steven-cheng.iteye.com/" target="_blank">steven_cheng</a></h1>
<p>永久域名 <a href="http://steven-cheng.iteye.com/" target="_blank"><a href="http://steven-cheng.iteye.com">http://steven-cheng.iteye.com</a></a></p>
<p><a href="http://steven-cheng.iteye.com/blog/87667" title="异常处理" target="_blank">异常处理</a></p>
<p>2006-03-24</p>
<h3 id="-apache-configuration-"><a href="">用apache的configuration实现实时配置</a></h3>
<p>关键字: java 开源
apache下commons有一个configeration包，对于做配置很方便，尤其是实时热配置。可以自动监测到配置文件的更改而reload配置文件。在项目中使用所以进行了一下封装。
java 代码</p>
<ol>
<li>public class DefaultRealTimeXMLConfiger {   </li>
<li></li>
<li>private static Log logger = LogFactory.getLog(DefaultRealTimeXMLConfiger.class);   </li>
<li></li>
<li>private String fileName;   </li>
<li></li>
<li>private long reloadPeriod;   </li>
<li></li>
<li>private XMLConfiguration config;   </li>
<li></li>
<li>public void init()   </li>
<li>{   </li>
<li>String filePath = GlobalConfigerImpl.getConfDir()+&quot;/&quot;+fileName;   </li>
<li>logger.debug(&quot;will config with XML file[&quot;+filePath+&quot;]&quot;);   </li>
<li></li>
<li>File file = new File(filePath);   </li>
<li>if (!file.exists() || !file.isFile()) {   </li>
<li>logger.error(&quot; can&#39;t find file[&quot; + filePath + &quot;]&quot;);   </li>
<li>throw new IllegalArgumentException(&quot;config error! can&#39;t find file[&quot; + filePath + &quot;]&quot;);   </li>
<li>}   </li>
<li>this.init(file);   </li>
<li>}   </li>
<li></li>
<li>public void init(File file) {   </li>
<li>try {   </li>
<li>config = new XMLConfiguration(file);   </li>
<li>FileChangedReloadingStrategy fs = new FileChangedReloadingStrategy();   </li>
<li>fs.setConfiguration(config);   </li>
<li></li>
<li>if(this.reloadPeriod&gt;0)   </li>
<li>{   </li>
<li>fs.setRefreshDelay(this.reloadPeriod);   </li>
<li>}   </li>
<li>config.setReloadingStrategy(fs);   </li>
<li></li>
<li>} catch (ConfigurationException e) {   </li>
<li>logger.error(&quot;error! configer error[&quot;+file.getPath()+&quot;]&quot;);   </li>
<li>logger.error(e);   </li>
<li>e.printStackTrace();   </li>
<li>}   </li>
<li>}   </li>
<li></li>
<li>public Object getProperty(String name) {   </li>
<li>Object s = this.config.getProperty(name);   </li>
<li>return s;   </li>
<li>}   </li>
<li></li>
<li>public String getString(String name) {   </li>
<li>Object s = this.config.getProperty(name);   </li>
<li>String result = null;   </li>
<li>if (s != null)   </li>
<li>result = (String) s;   </li>
<li></li>
<li>return result;   </li>
<li>}   </li>
<li></li>
<li>public String[] getStringArray(String name) {   </li>
<li>String[] target = this.config.getStringArray(name);   </li>
<li></li>
<li>return target;   </li>
<li>}   </li>
<li></li>
<li></li>
<li>//<em>/</em>  </li>
<li>/* @return Returns the fileName.  </li>
<li>/*/  </li>
<li>public String getFileName() {   </li>
<li>return fileName;   </li>
<li>}   </li>
<li></li>
<li>//<em>/</em>  </li>
<li>/* @param fileName The fileName to set.  </li>
<li>/*/  </li>
<li>public void setFileName(String fileName) {   </li>
<li>this.fileName = fileName;   </li>
<li>}   </li>
<li></li>
<li>//<em>/</em>  </li>
<li>/* @return Returns the reloadPeriod.  </li>
<li>/*/  </li>
<li>public long getReloadPeriod() {   </li>
<li>return reloadPeriod;   </li>
<li>}   </li>
<li></li>
<li>//<em>/</em>  </li>
<li>/* @param reloadPeriod The reloadPeriod to set.  </li>
<li>/*/  </li>
<li>public void setReloadPeriod(long reloadPeriod) {   </li>
<li>this.reloadPeriod = reloadPeriod;   </li>
<li>}   </li>
<li>}<br><a href="http://steven-cheng.iteye.com/blog/87667" title="异常处理" target="_blank">异常处理</a></li>
</ol>
<ul>
<li>06:34</li>
<li>浏览 (988)</li>
<li><a href="http://steven-cheng.iteye.com/blog/70634#comments" target="_blank">评论</a> (0)</li>
<li>分类: <a href="http://steven-cheng.iteye.com/category/12345" target="_blank">java</a></li>
<li><a href="http://www.iteye.com/wiki/topic/70634" target="_blank">相关推荐</a><h3 id="-">评论</h3>
</li>
</ul>
<p><a href=""></a></p>
<h3 id="-">发表评论</h3>
<h3 id="-">表情图标</h3>
<p><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""></p>
<p>字体颜色: 标准深红红色橙色棕色黄色绿色橄榄青色蓝色深蓝靛蓝紫色灰色白色黑色 字体大小: 标准1 (xx-small)2 (x-small)3 (small)4 (medium)5 (large)6 (x-large)7 (xx-large) 对齐: 标准居左居中居右</p>
<p>提示：选择您需要装饰的文字, 按上列按钮即可添加上相应的标签</p>
<p>您还没有登录，请<a href="http://steven-cheng.iteye.com/login" target="_blank">登录</a>后发表评论(快捷键 Alt+S / Ctrl+Enter)</p>
<p><a href="http://steven-cheng.iteye.com/" target="_blank"><img src="&quot;steven_cheng的博客: steven_cheng&quot;" alt="steven_cheng的博客"></a></p>
<p>steven_cheng</p>
<ul>
<li>浏览: 6938 次</li>
<li>来自: 北京</li>
<li><img src="" alt=""></li>
<li><a href="http://steven-cheng.iteye.com/blog/profile" target="_blank">详细资料</a> <a href="http://steven-cheng.iteye.com/blog/guest_book" target="_blank">留言簿</a></li>
</ul>
<h3 id="-">搜索本博客</h3>
<h3 id="-http-steven-cheng-iteye-com-blog-user_visits-">最近访客 <a href="http://steven-cheng.iteye.com/blog/user_visits" target="_blank">&gt;&gt;更多访客</a></h3>
<p><a href="http://loudyn.iteye.com/" target="_blank"><img src="&quot;Loudyn的博客: &quot;" alt="Loudyn的博客"></a></p>
<p><a href="http://loudyn.iteye.com/" target="_blank">Loudyn</a></p>
<p><a href="http://hepeng19861212.iteye.com/" target="_blank"><img src="&quot;hepeng19861212的博客: 火柴天堂&quot;" alt="hepeng19861212的博客"></a></p>
<p><a href="http://hepeng19861212.iteye.com/" target="_blank">hepeng19861212</a>
<a href="http://osacar.iteye.com/" target="_blank"><img src="&quot;osacar的博客: &quot;" alt="osacar的博客"></a></p>
<p><a href="http://osacar.iteye.com/" target="_blank">osacar</a></p>
<p><a href="http://kevin-gzhz.iteye.com/" target="_blank"><img src="&quot;kevin_gzhz的博客: kevin_gzhz&quot;" alt="kevin_gzhz的博客"></a></p>
<p><a href="http://kevin-gzhz.iteye.com/" target="_blank">kevin_gzhz</a></p>
<h3 id="-">博客分类</h3>
<ul>
<li><a href="http://steven-cheng.iteye.com/" target="_blank">全部博客 (8)</a></li>
<li><a href="http://steven-cheng.iteye.com/category/4287" target="_blank">默认类别 (0)</a></li>
<li><a href="http://steven-cheng.iteye.com/category/12345" target="_blank">java (6)</a></li>
<li><a href="http://steven-cheng.iteye.com/category/24850" target="_blank">单元测试和TDD (0)</a></li>
<li><a href="http://steven-cheng.iteye.com/category/48191" target="_blank">freemarker (1)</a></li>
<li><a href="http://steven-cheng.iteye.com/category/73657" target="_blank">linux (1)</a></li>
<li><p><a href="http://steven-cheng.iteye.com/category/75601" target="_blank">restlet (1)</a></p>
<h3 id="-http-steven-cheng-iteye-com-blog-guest_book-">我的留言簿 <a href="http://steven-cheng.iteye.com/blog/guest_book" target="_blank">&gt;&gt;更多留言</a></h3>
</li>
<li><p>steven_cheng 写道restlet那片原文是你的吗，如果是给个原文连接。 ...
-- by <a href="http://steven-cheng.iteye.com/blog/guest_book#6151" target="_blank">whaosoft</a></p>
</li>
</ul>
<h3 id="-">其他分类</h3>
<ul>
<li><a href="http://steven-cheng.iteye.com/blog/favorite" target="_blank">我的收藏</a> (15)</li>
<li><a href="http://steven-cheng.iteye.com/blog/code_favorite" target="_blank">我的代码</a> (0)</li>
<li><a href="http://steven-cheng.iteye.com/blog/topic" target="_blank">我的论坛主题帖</a> (1)</li>
<li><a href="http://steven-cheng.iteye.com/blog/post" target="_blank">我的所有论坛帖</a> (8)</li>
<li><a href="http://steven-cheng.iteye.com/blog/article" target="_blank">我的精华良好帖</a> (0)</li>
<li><p><a href="http://steven-cheng.iteye.com/blog/solution" target="_blank">我解决的问题</a> (1)</p>
<h3 id="-">最近加入群组</h3>
</li>
<li><p><a href="http://restlet.group.iteye.com/" target="_blank">Restlet</a></p>
</li>
<li><a href="http://freemarker.group.iteye.com/" target="_blank">FreeMarker</a></li>
</ul>
<h3 id="-">存档</h3>
<ul>
<li><a href="http://steven-cheng.iteye.com/blog/monthblog/2010-02" target="_blank">2010-02</a> (1)</li>
<li><a href="http://steven-cheng.iteye.com/blog/monthblog/2009-09" target="_blank">2009-09</a> (2)</li>
<li><a href="http://steven-cheng.iteye.com/blog/monthblog/2009-07" target="_blank">2009-07</a> (1)</li>
<li><p><a href="http://steven-cheng.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://steven-cheng.iteye.com/rss" target="_blank"><img src="" alt="Rss"></a></p>
</li>
<li><a href="http://fusion.google.com/add?feedurl=http://steven-cheng.iteye.com/rss" target="_blank"><img src="" alt="Rss_google"></a></li>
</ul>
<p>声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2011 ITeye.com. All rights reserved. [ 京ICP证110151号 ]
<img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_多线程/">Java_多线程</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_多线程/" class="label label-success">Java_多线程</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--用apache的configuration实现实时配置-steven_cheng-ITeye/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_多线程--用apache的configuration实现实时配置-steven_cheng-ITeye" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程-并发--Java并发编程之ConcurrentHashMap/">Java并发编程之ConcurrentHashMap</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程-并发--Java并发编程之ConcurrentHashMap/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-concurrenthashmap">Java并发编程之ConcurrentHashMap</h1>
<h3 id="concurrenthashmap">ConcurrentHashMap</h3>
<p>ConcurrentHashMap是一个线程安全的Hash Table，它的主要功能是提供了一组和HashTable功能相同但是线程安全的方法。ConcurrentHashMap可以做到读取数据不加锁，并且其内部的结构可以让其在进行写操作的时候能够将锁的粒度保持地尽量地小，不用对整个ConcurrentHashMap加锁。</p>
<h3 id="concurrenthashmap-">ConcurrentHashMap的内部结构</h3>
<p>ConcurrentHashMap为了提高本身的并发能力，在内部采用了一个叫做Segment的结构，一个Segment其实就是一个类Hash Table的结构，Segment内部维护了一个链表数组，我们用下面这一幅图来看下ConcurrentHashMap的内部结构：
<a href="http://www.yupoo.com/photos/goldendoc/81556254/" title="图表1" target="_blank"><img src="" alt="图表1"></a>
从上面的结构我们可以了解到，ConcurrentHashMap定位一个元素的过程需要进行两次Hash操作，第一次Hash定位到Segment，第二次Hash定位到元素所在的链表的头部，因此，这一种结构的带来的副作用是Hash的过程要比普通的HashMap要长，但是带来的好处是写操作的时候可以只对元素所在的Segment进行加锁即可，不会影响到其他的Segment，这样，在最理想的情况下，ConcurrentHashMap可以最高同时支持Segment数量大小的写操作（刚好这些写操作都非常平均地分布在所有的Segment上），所以，通过这一种结构，ConcurrentHashMap的并发能力可以大大的提高。</p>
<h3 id="segment">Segment</h3>
<p>我们再来具体了解一下Segment的数据结构：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7 static</p>
<p>final</p>
<p>class</p>
<p>Segment<K,V></p>
<p>extends</p>
<p>ReentrantLock</p>
<p>implements</p>
<p>Serializable {</p>
<p>transient</p>
<p>volatile</p>
<p>int</p>
<p>count;</p>
<p>transient</p>
<p>int</p>
<p>modCount;</p>
<p>transient</p>
<p>int</p>
<p>threshold;</p>
<p>transient</p>
<p>volatile</p>
<p>HashEntry<K,V>[] table;</p>
<p>final</p>
<p>float</p>
<p>loadFactor;
}</p>
<p>详细解释一下Segment里面的成员变量的意义：</p>
<ul>
<li>count：Segment中元素的数量</li>
<li>modCount：对table的大小造成影响的操作的数量（比如put或者remove操作）</li>
<li>threshold：阈值，Segment里面元素的数量超过这个值依旧就会对Segment进行扩容</li>
<li>table：链表数组，数组中的每一个元素代表了一个链表的头部</li>
<li>loadFactor：负载因子，用于确定threshold</li>
</ul>
<h3 id="hashentry">HashEntry</h3>
<p>Segment中的元素是以HashEntry的形式存放在链表数组中的，看一下HashEntry的结构：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
 static</p>
<p>final</p>
<p>class</p>
<p>HashEntry<K,V> {</p>
<p>final</p>
<p>K key;</p>
<p>final</p>
<p>int</p>
<p>hash;</p>
<p>volatile</p>
<p>V value;</p>
<p>final</p>
<p>HashEntry<K,V> next;</p>
<p>}</p>
<p>可以看到HashEntry的一个特点，除了value以外，其他的几个变量都是final的，这样做是为了防止链表结构被破坏，出现ConcurrentModification的情况。</p>
<h3 id="concurrenthashmap-">ConcurrentHashMap的初始化</h3>
<p>下面我们来结合源代码来具体分析一下ConcurrentHashMap的实现，先看下初始化方法：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24
25</p>
<p>26
27</p>
<p>28
29</p>
<p>30
31 public</p>
<p>ConcurrentHashMap(</p>
<p>int</p>
<p>initialCapacity,</p>
<p>float</p>
<p>loadFactor,</p>
<p>int</p>
<p>concurrencyLevel) {</p>
<p>if</p>
<p>(!(loadFactor &gt;</p>
<p>0</p>
<p>) || initialCapacity &lt;</p>
<p>0</p>
<p>|| concurrencyLevel &lt;=</p>
<p>0</p>
<p>)</p>
<p>throw</p>
<p>new</p>
<p>IllegalArgumentException();</p>
<p>if</p>
<p>(concurrencyLevel &gt; MAX_SEGMENTS)</p>
<p>concurrencyLevel = MAX_SEGMENTS;</p>
<p>int</p>
<p>sshift =</p>
<p>0</p>
<p>;</p>
<p>int</p>
<p>ssize =</p>
<p>1</p>
<p>;</p>
<p>while</p>
<p>(ssize &lt; concurrencyLevel) {</p>
<p>++sshift;</p>
<p>ssize &lt;&lt;=</p>
<p>1</p>
<p>;</p>
<p>}</p>
<p>segmentShift =</p>
<p>32</p>
<ul>
<li>sshift;</li>
</ul>
<p>segmentMask = ssize -</p>
<p>1</p>
<p>;</p>
<p>this</p>
<p>.segments = Segment.newArray(ssize);</p>
<p>if</p>
<p>(initialCapacity &gt; MAXIMUM_CAPACITY)</p>
<p>initialCapacity = MAXIMUM_CAPACITY;</p>
<p>int</p>
<p>c = initialCapacity / ssize;</p>
<p>if</p>
<p>(c /* ssize &lt; initialCapacity)</p>
<p>++c;</p>
<p>int</p>
<p>cap =</p>
<p>1</p>
<p>;</p>
<p>while</p>
<p>(cap &lt; c)</p>
<p>cap &lt;&lt;=</p>
<p>1</p>
<p>;</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>i =</p>
<p>0</p>
<p>; i &lt;</p>
<p>this</p>
<p>.segments.length; ++i)</p>
<p>this</p>
<p>.segments[i] =</p>
<p>new</p>
<p>Segment<K,V>(cap, loadFactor);
}</p>
<p>CurrentHashMap的初始化一共有三个参数，一个initialCapacity，表示初始的容量，一个loadFactor，表示负载参数，最后一个是concurrentLevel，代表ConcurrentHashMap内部的Segment的数量，ConcurrentLevel一经指定，不可改变，后续如果ConcurrentHashMap的元素数量增加导致ConrruentHashMap需要扩容，ConcurrentHashMap不会增加Segment的数量，而只会增加Segment中链表数组的容量大小，这样的好处是扩容过程不需要对整个ConcurrentHashMap做rehash，而只需要对Segment里面的元素做一次rehash就可以了。</p>
<p>整个ConcurrentHashMap的初始化方法还是非常简单的，先是根据concurrentLevel来new出Segment，这里Segment的数量是不小于concurrentLevel的最大的2的指数，就是说Segment的数量永远是2的指数个，这样的好处是方便采用移位操作来进行hash，加快hash的过程。接下来就是根据intialCapacity确定Segment的容量的大小，每一个Segment的容量大小也是2的指数，同样使为了加快hash的过程。</p>
<p>这边需要特别注意一下两个变量，分别是segmentShift和segmentMask，这两个变量在后面将会起到很大的作用，假设构造函数确定了Segment的数量是2的n次方，那么segmentShift就等于32减去n，而segmentMask就等于2的n次方减一。</p>
<h3 id="concurrenthashmap-get-">ConcurrentHashMap的get操作</h3>
<p>前面提到过ConcurrentHashMap的get操作是不用加锁的，我们这里看一下其实现：
1</p>
<p>2
3</p>
<p>4
 public</p>
<p>V get(Object key) {</p>
<p>int</p>
<p>hash = hash(key.hashCode());</p>
<p>return</p>
<p>segmentFor(hash).get(key, hash);</p>
<p>}</p>
<p>看第三行，segmentFor这个函数用于确定操作应该在哪一个segment中进行，几乎对ConcurrentHashMap的所有操作都需要用到这个函数，我们看下这个函数的实现：</p>
<p>1</p>
<p>2
3 final</p>
<p>Segment<K,V> segmentFor(</p>
<p>int</p>
<p>hash) {</p>
<p>return</p>
<p>segments[(hash &gt;&gt;&gt; segmentShift) &amp; segmentMask];
}</p>
<p>这个函数用了位操作来确定Segment，根据传入的hash值向右无符号右移segmentShift位，然后和segmentMask进行与操作，结合我们之前说的segmentShift和segmentMask的值，就可以得出以下结论：假设Segment的数量是2的n次方，根据元素的hash值的高n位就可以确定元素到底在哪一个Segment中。</p>
<p>在确定了需要在哪一个segment中进行操作以后，接下来的事情就是调用对应的Segment的get方法：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15 V get(Object key,</p>
<p>int</p>
<p>hash) {</p>
<p>if</p>
<p>(count !=</p>
<p>0</p>
<p>) {</p>
<p>HashEntry<K,V> e = getFirst(hash);</p>
<p>while</p>
<p>(e !=</p>
<p>null</p>
<p>) {</p>
<p>if</p>
<p>(e.hash == hash &amp;&amp; key.equals(e.key)) {</p>
<p>V v = e.value;</p>
<p>if</p>
<p>(v !=</p>
<p>null</p>
<p>)</p>
<p>return</p>
<p>v;</p>
<p>return</p>
<p>readValueUnderLock(e);</p>
<p>}</p>
<p>e = e.next;</p>
<p>}</p>
<p>}</p>
<p>return</p>
<p>null</p>
<p>;
}</p>
<p>先看第二行代码，这里对count进行了一次判断，其中count表示Segment中元素的数量，我们可以来看一下count的定义：</p>
<p>1 transient</p>
<p>volatile</p>
<p>int</p>
<p>count;</p>
<p>可以看到count是volatile的，实际上这里里面利用了volatile的语义：</p>
<p>对volatile字段的写入操作happens-before于每一个后续的同一个字段的读操作。</p>
<p>因为实际上put、remove等操作也会更新count的值，所以当竞争发生的时候，volatile的语义可以保证写操作在读操作之前，也就保证了写操作对后续的读操作都是可见的，这样后面get的后续操作就可以拿到完整的元素内容。</p>
<p>然后，在第三行，调用了getFirst()来取得链表的头部：
1</p>
<p>2
3</p>
<p>4
 HashEntry<K,V> getFirst(</p>
<p>int</p>
<p>hash) {</p>
<p>HashEntry<K,V>[] tab = table;</p>
<p>return</p>
<p>tab[hash &amp; (tab.length -</p>
<p>1</p>
<p>)];</p>
<p>}</p>
<p>同样，这里也是用位操作来确定链表的头部，hash值和HashTable的长度减一做与操作，最后的结果就是hash值的低n位，其中n是HashTable的长度以2为底的结果。</p>
<p>在确定了链表的头部以后，就可以对整个链表进行遍历，看第4行，取出key对应的value的值，如果拿出的value的值是null，则可能这个key，value对正在put的过程中，如果出现这种情况，那么就加锁来保证取出的value是完整的，如果不是null，则直接返回value。</p>
<h3 id="concurrenthashmap-put-">ConcurrentHashMap的put操作</h3>
<p>看完了get操作，再看下put操作，put操作的前面也是确定Segment的过程，这里不再赘述，直接看关键的segment的put方法：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24
25</p>
<p>26
27</p>
<p>28
29</p>
<p>30
 V put(K key,</p>
<p>int</p>
<p>hash, V value,</p>
<p>boolean</p>
<p>onlyIfAbsent) {</p>
<p>lock();</p>
<p>try</p>
<p>{</p>
<p>int</p>
<p>c = count;</p>
<p>if</p>
<p>(c++ &gt; threshold)</p>
<p>rehash();</p>
<p>HashEntry<K,V>[] tab = table;</p>
<p>int</p>
<p>index = hash &amp; (tab.length -</p>
<p>1</p>
<p>);</p>
<p>HashEntry<K,V> first = tab[index];</p>
<p>HashEntry<K,V> e = first;</p>
<p>while</p>
<p>(e !=</p>
<p>null</p>
<p>&amp;&amp; (e.hash != hash || !key.equals(e.key)))</p>
<p>e = e.next;</p>
<p>V oldValue;</p>
<p>if</p>
<p>(e !=</p>
<p>null</p>
<p>) {</p>
<p>oldValue = e.value;</p>
<p>if</p>
<p>(!onlyIfAbsent)</p>
<p>e.value = value;</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>oldValue =</p>
<p>null</p>
<p>;</p>
<p>++modCount;</p>
<p>tab[index] =</p>
<p>new</p>
<p>HashEntry<K,V>(key, hash, first, value);</p>
<p>count = c;</p>
<p>}</p>
<p>return</p>
<p>oldValue;</p>
<p>}</p>
<p>finally</p>
<p>{</p>
<p>unlock();</p>
<p>}</p>
<p>}</p>
<p>首先对Segment的put操作是加锁完成的，然后在第五行，如果Segment中元素的数量超过了阈值（由构造函数中的loadFactor算出）这需要进行对Segment扩容，并且要进行rehash，关于rehash的过程大家可以自己去了解，这里不详细讲了。</p>
<p>第8和第9行的操作就是getFirst的过程，确定链表头部的位置。</p>
<p>第11行这里的这个while循环是在链表中寻找和要put的元素相同key的元素，如果找到，就直接更新更新key的value，如果没有找到，则进入21行这里，生成一个新的HashEntry并且把它加到整个Segment的头部，然后再更新count的值。</p>
<h3 id="concurrenthashmap-remove-">ConcurrentHashMap的remove操作</h3>
<p>Remove操作的前面一部分和前面的get和put操作一样，都是定位Segment的过程，然后再调用Segment的remove方法：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24
25</p>
<p>26
27</p>
<p>28
29</p>
<p>30
31</p>
<p>32
33 V remove(Object key,</p>
<p>int</p>
<p>hash, Object value) {</p>
<p>lock();</p>
<p>try</p>
<p>{</p>
<p>int</p>
<p>c = count -</p>
<p>1</p>
<p>;</p>
<p>HashEntry<K,V>[] tab = table;</p>
<p>int</p>
<p>index = hash &amp; (tab.length -</p>
<p>1</p>
<p>);</p>
<p>HashEntry<K,V> first = tab[index];</p>
<p>HashEntry<K,V> e = first;</p>
<p>while</p>
<p>(e !=</p>
<p>null</p>
<p>&amp;&amp; (e.hash != hash || !key.equals(e.key)))</p>
<p>e = e.next;</p>
<p>V oldValue =</p>
<p>null</p>
<p>;</p>
<p>if</p>
<p>(e !=</p>
<p>null</p>
<p>) {</p>
<p>V v = e.value;</p>
<p>if</p>
<p>(value ==</p>
<p>null</p>
<p>|| value.equals(v)) {</p>
<p>oldValue = v;</p>
<p>++modCount;</p>
<p>HashEntry<K,V> newFirst = e.next;</p>
<p>for</p>
<p>(HashEntry<K,V> p = first; p != e; p = p.next)</p>
<p>newFirst =</p>
<p>new</p>
<p>HashEntry<K,V>(p.key, p.hash,</p>
<p>newFirst, p.value);</p>
<p>tab[index] = newFirst;</p>
<p>count = c;</p>
<p>}</p>
<p>}</p>
<p>return</p>
<p>oldValue;</p>
<p>}</p>
<p>finally</p>
<p>{</p>
<p>unlock();</p>
<p>}
}</p>
<p>首先remove操作也是确定需要删除的元素的位置，不过这里删除元素的方法不是简单地把待删除元素的前面的一个元素的next指向后面一个就完事了，我们之前已经说过HashEntry中的next是final的，一经赋值以后就不可修改，在定位到待删除元素的位置以后，程序就将待删除元素前面的那一些元素全部复制一遍，然后再一个一个重新接到链表上去，看一下下面这一幅图来了解这个过程：
<a href="http://www.yupoo.com/photos/goldendoc/81555357/" title="1" target="_blank"><img src="" alt="1"></a>
假设链表中原来的元素如上图所示，现在要删除元素3，那么删除元素3以后的链表就如下图所示：
<a href="http://www.yupoo.com/photos/goldendoc/81555358/" title="2" target="_blank"><img src="" alt="2"></a></p>
<h3 id="concurrenthashmap-size-">ConcurrentHashMap的size操作</h3>
<p>在前面的章节中，我们涉及到的操作都是在单个Segment中进行的，但是ConcurrentHashMap有一些操作是在多个Segment中进行，比如size操作，ConcurrentHashMap的size操作也采用了一种比较巧的方式，来尽量避免对所有的Segment都加锁。</p>
<p>前面我们提到了一个Segment中的有一个modCount变量，代表的是对Segment中元素的数量造成影响的操作的次数，这个值只增不减，size操作就是遍历了两次Segment，每次记录Segment的modCount值，然后将两次的modCount进行比较，如果相同，则表示期间没有发生过写入操作，就将原先遍历的结果返回，如果不相同，则把这个过程再重复做一次，如果再不相同，则就需要将所有的Segment都锁住，然后一个一个遍历了，具体的实现大家可以看ConcurrentHashMap的源码，这里就不贴了。
来源： <a href="[http://www.goldendoc.org/2011/06/juc_concurrenthashmap/](http://www.goldendoc.org/2011/06/juc_concurrenthashmap/)">[http://www.goldendoc.org/2011/06/juc_concurrenthashmap/](http://www.goldendoc.org/2011/06/juc_concurrenthashmap/)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_多线程/">Java_多线程</a></li><li><a href="/categories/Java&J2EE/Java_多线程/并发/">并发</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_多线程/" class="label label-success">Java_多线程</a><a href="/tags/并发/" class="label label-info">并发</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程-并发--Java并发编程之ConcurrentHashMap/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_多线程-并发--Java并发编程之ConcurrentHashMap" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/60/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/58/">58</a></li><li><a class="page-number" href="/page/59/">59</a></li><li><a class="page-number" href="/page/60/">60</a></li><li class="active"><li><span class="page-number current">61</span></li><li><a class="page-number" href="/page/62/">62</a></li><li><a class="page-number" href="/page/63/">63</a></li><li><a class="page-number" href="/page/64/">64</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/62/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 16:01:36</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
