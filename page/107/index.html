
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 107 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-linux--Linux大文件传输/">Linux大文件传输</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:36.000Z"> <a href="/2014/02/02/2014-02-02-linux--Linux大文件传输/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h2 id="linux-">Linux大文件传输</h2>
<p>作者: <a href="http://www.yankay.com/author/admin/" title="查看 颜开 的所有文章" target="_blank">颜开</a> 日期: 2012 年 2 月 7 日<br>我们经常需要在机器之间传输文件。比如备份，复制数据等等。这个是很常见，也是很简单的。用scp或者rsync就能很好的完成任务。但是如果文件很大，需要占用一些传输时间的时候，怎样又快又好地完成任务就很重要了。在我的测试用例中，一个最佳的方案比最差的方案，性能提高了10倍。</p>
<h3 id="-"><strong>复制文件</strong></h3>
<p>如果我们是复制一个<strong>未压缩</strong>的文件。这里走如下步骤：</p>
<ol>
<li>压缩数据</li>
<li>发送到另外一台机器上</li>
<li>数据解压缩</li>
<li>校验正确性
这样做会很有效率，数据压缩后可以更有效的利用带宽</li>
</ol>
<h3 id="-zip-scp-"><strong>使用ZIP+SCP</strong></h3>
<p>我们可以通过ZIP+SCP的组合实现这个功能。</p>
<p>gzip -c /home/yankay/data | ssh yankay01 &quot;gunzip -c - &gt; /home/yankay/data&quot;</p>
<p>这条命令是将/home/yankay/data经过GZIP压缩，通过ssh传输到yankay01的机器上。
data文件的大小是1.1GB,经过Zip压缩后是183MB，执行上面的命令需要45.6s。平均吞吐量为24.7MB/s</p>
<p>我们会发现Scp也有压缩功能，所以上面的语句可以写成
scp -C -c blowfish /home/yankay/data yankay01:/home/yankay/data</p>
<p>这样运行效果是相同的，不通之处在于我使用了blowfish算法作为Scp的密匙算法，使用这个算法可以比默认的情况快很多。单单对与scp,使用了blowfish 吞吐量是62MB/s,不使用只有46MB/s。</p>
<p>可是我执行上面一条命令的时候，发现还是需要45s。平均吞吐量还为24MB/s。没有丝毫的提升，可见瓶颈不在网络上。
那瓶颈在哪里呢？</p>
<h3 id="-"><strong>性能分析</strong></h3>
<p>我们先定义几个变量</p>
<ul>
<li>压缩工具的压缩比是 CompressRadio</li>
<li>压缩工具的压缩吞吐是CompressSpeed MB/s</li>
<li>网络传输的吞吐是 NetSpeed MB/s</li>
</ul>
<p>由于使用了管道，管道的性能取决于管道中最慢的部分的性能，所以整体的性能是：</p>
<p>speed=min(NetSpeed/CompressRadio,CompressSpeed)</p>
<p>当压缩吞吐较网络传输慢的时候，压缩是瓶颈；但网络较慢的时候，网络传输/吞吐 是瓶颈。</p>
<p>根据现有的测试数据(纯文本)，可以得到表格：
压缩比 吞吐量 千兆网卡(100MB/s)吞吐量 千兆网卡吞吐量,基于ssh(62MB/s) 百兆网卡(10MB/s)吞吐量 ZLIB 35.80% 9.6 9.6 9.6 9.6 LZO 54.40% 101.7 101.7 101.7 18.38235294 LIBLZF 54.60% 134.3 134.3 113.5531136 18.31501832 QUICKLZ 54.90% 183.4 182.1493625 112.9326047 18.21493625 FASTLZ 56.20% 134.4 134.4 110.3202847 17.79359431 SNAPPY 59.80% 189 167.2240803 103.6789298 16.72240803 NONE 100% 300 100 62 10</p>
<p>可以看出来。在千兆网卡下，使用QuickLZ作为压缩算法，可以达到最高的性能。如果使用SSH作为数据传输通道，则远远没有达到网卡可以达到的最佳性能。在百兆网卡的情况下，各个算法相近。对比下来QuickLZ是有优势的。</p>
<p>对于不同的数据和不同的机器，可以得出不同的最佳压缩算法。但有一点是肯定的，尽量把瓶颈压在网络上。对于较慢的网络环境，高压缩比的算法会比较有优势；相反对于较快的网络环境，低压缩比的算法会更好。</p>
<h3 id="-"><strong>结论</strong></h3>
<p>根据上面的分析结果，我们不能是用SSH作为网络传输通道，可以使用NC这个基本网络工具，提高性能。同时使用qpress作为压缩算法。
scp /usr/bin/qpress yankay01:/usr/bin/qpress ssh yankay01 &quot;nc -l 12345 | qpress -dio &gt; /home/yankay/data&quot; &amp; qpress -o /home/yankay/data |nc yankay01 12345</p>
<p>第一行是将gpress安装到远程机器上，第二行在远程机器上使用nc监听一个端口，第三行压缩并传送数据。</p>
<p>执行上面的命令需要2.8s。平均吞吐量为402MB/s,比使用Gzip+Scp快了16倍！！</p>
<p>根据上文的公式，和自己的数据，可以绘出上面的表格，就可以选择出最适合的压缩算法和传输方式。达到满意的效果。如果是一个长期运行的脚本的话，这么做是值得的。
Share the post &quot;Linux大文件传输&quot;</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/linux/">linux</a></li></span></span> | <span class="tags">Tagged <a href="/tags/linux/" class="label label-primary">linux</a></span> | <span class="time">recent updated:<time title="2014-03-30 13:46:15"datetime="2014-03-30 13:46:15"> mar. 30 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-linux--Linux大文件传输/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-linux--Linux大文件传输" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-hadoop--hdfs_shell/">hdfs_shell</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:36.000Z"> <a href="/2014/02/02/2014-02-02-hadoop--hdfs_shell/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="hdfs_shell">hdfs_shell</h1>
<p>HDFS File System Shell Guide
Table of contents
1
Overview............................................................................................................................3
1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9
cat ................................................................................................................................. 3 chgrp ............................................................................................................................. 3 chmod ........................................................................................................................... 3 chown ........................................................................................................................... 4 copyFromLocal..............................................................................................................4 copyToLocal..................................................................................................................4 count ............................................................................................................................. 4 cp .................................................................................................................................. 4 du................................................................................................................................... 5 dus ...............................................................................................................................5 expunge .......................................................................................................................5 get ................................................................................................................................5 getmerge ......................................................................................................................6 ls...................................................................................................................................6 lsr................................................................................................................................. 6 mkdir ...........................................................................................................................7 moveFromLocal ..........................................................................................................7 moveToLocal............................................................................................................... 7 mv ............................................................................................................................... 7 put ............................................................................................................................... 8 rm ................................................................................................................................ 8 rmr ...............................................................................................................................8 setrep ...........................................................................................................................9
Copyright © 2008 The Apache Software Foundation. All rights reserved.
1.10 1.11 1.12 1.13 1.14 1.15 1.16 1.17 1.18 1.19 1.20 1.21 1.22 1.23
HDFS File System Shell Guide
1.24 1.25 1.26 1.27 1.28
stat ...............................................................................................................................9 tail ............................................................................................................................... 9 test .............................................................................................................................10 text ............................................................................................................................ 10 touchz ........................................................................................................................10
Page 2
Copyright © 2008 The Apache Software Foundation. All rights reserved.
HDFS File System Shell Guide</p>
<ol>
<li>Overview
The FileSystem (FS) shell is invoked by bin/hadoop fs <args>. All FS shell commands take path URIs as arguments. The URI format is scheme://autority/path. For HDFS the scheme is hdfs, and for the local filesystem the scheme is file. The scheme and authority are optional. If not specified, the default scheme specified in the configuration is used. An HDFS file or directory such as /parent/child can be specified as hdfs://namenodehost/parent/child or simply as /parent/child (given that your configuration is set to point to hdfs://namenodehost). Most of the commands in FS shell behave like corresponding Unix commands. Differences are described with each of the commands. Error information is sent to stderr and the output is sent to stdout.
1.1. cat
Usage: hadoop fs -cat URI [URI …] Copies source paths to stdout. Example: • hadoop fs -cat hdfs://nn1.example.com/file1 hdfs://nn2.example.com/file2 • hadoop fs -cat file:///file3 /user/hadoop/file4 Exit Code: Returns 0 on success and -1 on error.
1.2. chgrp
Usage: hadoop fs -chgrp [-R] GROUP URI [URI …] Change group association of files. With -R, make the change recursively through the directory structure. The user must be the owner of files, or else a super-user. Additional information is in the HDFS Admin Guide: Permissions.
1.3. chmod
Usage: hadoop fs -chmod [-R] <MODE[,MODE]... | OCTALMODE> URI [URI …] Change the permissions of files. With -R, make the change recursively through the directory structure. The user must be the owner of the file, or else a super-user. Additional information is in the HDFS Admin Guide: Permissions.
Page 3
Copyright © 2008 The Apache Software Foundation. All rights reserved.
HDFS File System Shell Guide
1.4. chown
Usage: hadoop fs -chown [-R] [OWNER][:[GROUP]] URI [URI ] Change the owner of files. With -R, make the change recursively through the directory structure. The user must be a super-user. Additional information is in the HDFS Admin Guide: Permissions.
1.5. copyFromLocal
Usage: hadoop fs -copyFromLocal <localsrc> URI Similar to put command, except that the source is restricted to a local file reference.
1.6. copyToLocal
Usage: hadoop fs -copyToLocal [-ignorecrc] [-crc] URI <localdst> Similar to get command, except that the destination is restricted to a local file reference.
1.7. count
Usage: hadoop fs -count [-q] <paths> Count the number of directories, files and bytes under the paths that match the specified file pattern. The output columns are: DIR_COUNT, FILE_COUNT, CONTENT_SIZE FILE_NAME. The output columns with -q are: QUOTA, REMAINING_QUATA, SPACE_QUOTA, REMAINING_SPACE_QUOTA, DIR_COUNT, FILE_COUNT, CONTENT_SIZE, FILE_NAME. Example: • hadoop fs -count hdfs://nn1.example.com/file1 hdfs://nn2.example.com/file2 • hadoop fs -count -q hdfs://nn1.example.com/file1 Exit Code: Returns 0 on success and -1 on error.
1.8. cp
Page 4
Copyright © 2008 The Apache Software Foundation. All rights reserved.
HDFS File System Shell Guide
Usage: hadoop fs -cp URI [URI …] <dest> Copy files from source to destination. This command allows multiple sources as well in which case the destination must be a directory. Example: • hadoop fs -cp /user/hadoop/file1 /user/hadoop/file2 • hadoop fs -cp /user/hadoop/file1 /user/hadoop/file2 /user/hadoop/dir Exit Code: Returns 0 on success and -1 on error.
1.9. du
Usage: hadoop fs -du URI [URI …] Displays aggregate length of files contained in the directory or the length of a file in case its just a file. Example: hadoop fs -du /user/hadoop/dir1 /user/hadoop/file1 hdfs://nn.example.com/user/hadoop/dir1 Exit Code: Returns 0 on success and -1 on error.
1.10. dus
Usage: hadoop fs -dus <args> Displays a summary of file lengths.
1.11. expunge
Usage: hadoop fs -expunge Empty the Trash. Refer to HDFS Architecture for more information on Trash feature.
1.12. get
Usage: hadoop fs -get [-ignorecrc] [-crc] <src> <localdst> Copy files to the local file system. Files that fail the CRC check may be copied with the -ignorecrc option. Files and CRCs may be copied using the -crc option.
Page 5
Copyright © 2008 The Apache Software Foundation. All rights reserved.
HDFS File System Shell Guide
Example: • hadoop fs -get /user/hadoop/file localfile • hadoop fs -get hdfs://nn.example.com/user/hadoop/file localfile Exit Code: Returns 0 on success and -1 on error.
1.13. getmerge
Usage: hadoop fs -getmerge <src> <localdst> [addnl] Takes a source directory and a destination file as input and concatenates files in src into the destination local file. Optionally addnl can be set to enable adding a newline character at the end of each file.
1.14. ls
Usage: hadoop fs -ls <args> For a file returns stat on the file with the following format: permissions number_of_replicas userid groupid filesize modification_date modification_time filename For a directory it returns list of its direct children as in unix.A directory is listed as: permissions userid groupid modification_date modification_time dirname Example: hadoop fs -ls /user/hadoop/file1 Exit Code: Returns 0 on success and -1 on error.
1.15. lsr
Usage: hadoop fs -lsr <args> Recursive version of ls. Similar to Unix ls -R.
Page 6
Copyright © 2008 The Apache Software Foundation. All rights reserved.
HDFS File System Shell Guide
1.16. mkdir
Usage: hadoop fs -mkdir <paths> Takes path uri&#39;s as argument and creates directories. The behavior is much like unix mkdir -p creating parent directories along the path. Example: • hadoop fs -mkdir /user/hadoop/dir1 /user/hadoop/dir2 • hadoop fs -mkdir hdfs://nn1.example.com/user/hadoop/dir hdfs://nn2.example.com/user/hadoop/dir Exit Code: Returns 0 on success and -1 on error.
1.17. moveFromLocal
Usage: dfs -moveFromLocal <localsrc> <dst> Similar to put command, except that the source localsrc is deleted after it&#39;s copied.
1.18. moveToLocal
Usage: hadoop fs -moveToLocal [-crc] <src> <dst> Displays a &quot;Not implemented yet&quot; message.
1.19. mv
Usage: hadoop fs -mv URI [URI …] <dest> Moves files from source to destination. This command allows multiple sources as well in which case the destination needs to be a directory. Moving files across filesystems is not permitted. Example: • hadoop fs -mv /user/hadoop/file1 /user/hadoop/file2 • hadoop fs -mv hdfs://nn.example.com/file1 hdfs://nn.example.com/file2 hdfs://nn.example.com/file3 hdfs://nn.example.com/dir1 Exit Code:
Page 7
Copyright © 2008 The Apache Software Foundation. All rights reserved.
HDFS File System Shell Guide
Returns 0 on success and -1 on error.
1.20. put
Usage: hadoop fs -put <localsrc> ... <dst> Copy single src, or multiple srcs from local file system to the destination filesystem. Also reads input from stdin and writes to destination filesystem. • hadoop fs -put localfile /user/hadoop/hadoopfile • hadoop fs -put localfile1 localfile2 /user/hadoop/hadoopdir • hadoop fs -put localfile hdfs://nn.example.com/hadoop/hadoopfile • hadoop fs -put - hdfs://nn.example.com/hadoop/hadoopfile Reads the input from stdin. Exit Code: Returns 0 on success and -1 on error.
1.21. rm
Usage: hadoop fs -rm [-skipTrash] URI [URI …] Delete files specified as args. Only deletes non empty directory and files. If the -skipTrash option is specified, the trash, if enabled, will be bypassed and the specified file(s) deleted immediately. This can be useful when it is necessary to delete files from an over-quota directory. Refer to rmr for recursive deletes. Example: • hadoop fs -rm hdfs://nn.example.com/file /user/hadoop/emptydir Exit Code: Returns 0 on success and -1 on error.
1.22. rmr
Usage: hadoop fs -rmr [-skipTrash] URI [URI …] Recursive version of delete. If the -skipTrash option is specified, the trash, if enabled, will be bypassed and the specified file(s) deleted immediately. This can be useful when it is necessary to delete files from an over-quota directory.
Page 8
Copyright © 2008 The Apache Software Foundation. All rights reserved.
HDFS File System Shell Guide
Example: • hadoop fs -rmr /user/hadoop/dir • hadoop fs -rmr hdfs://nn.example.com/user/hadoop/dir Exit Code: Returns 0 on success and -1 on error.
1.23. setrep
Usage: hadoop fs -setrep [-R] <path> Changes the replication factor of a file. -R option is for recursively increasing the replication factor of files within a directory. Example: • hadoop fs -setrep -w 3 -R /user/hadoop/dir1 Exit Code: Returns 0 on success and -1 on error.
1.24. stat
Usage: hadoop fs -stat URI [URI …] Returns the stat information on the path. Example: • hadoop fs -stat path Exit Code: Returns 0 on success and -1 on error.
1.25. tail
Usage: hadoop fs -tail [-f] URI Displays last kilobyte of the file to stdout. -f option can be used as in Unix. Example: • hadoop fs -tail pathname Exit Code:
Page 9
Copyright © 2008 The Apache Software Foundation. All rights reserved.
HDFS File System Shell Guide
Returns 0 on success and -1 on error.
1.26. test
Usage: hadoop fs -test -[ezd] URI Options: -e check to see if the file exists. Return 0 if true. -z check to see if the file is zero length. Return 0 if true. -d check to see if the path is directory. Return 0 if true. Example: • hadoop fs -test -e filename
1.27. text
Usage: hadoop fs -text <src> Takes a source file and outputs the file in text format. The allowed formats are zip and TextRecordInputStream.
1.28. touchz
Usage: hadoop fs -touchz URI [URI …] Create a file of zero length. Example: • hadoop -touchz pathname Exit Code: Returns 0 on success and -1 on error.
Page 10
Copyright © 2008 The Apache Software Foundation. All rights reserved.</li>
</ol>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/hadoop/">hadoop</a></li></span></span> | <span class="tags">Tagged <a href="/tags/hadoop/" class="label label-primary">hadoop</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:36"datetime="2014-03-07 09:54:36"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-hadoop--hdfs_shell/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-hadoop--hdfs_shell" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-hadoop--基于Hadoop220的高可用性集群搭建步骤（64位）/">基于Hadoop 2.2.0的高可用性集群搭建步骤（64位）</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:36.000Z"> <a href="/2014/02/02/2014-02-02-hadoop--基于Hadoop220的高可用性集群搭建步骤（64位）/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-hadoop-2-2-0-64-">基于Hadoop 2.2.0的高可用性集群搭建步骤（64位）</h1>
<p> 内容概要: CentSO_64bit集群搭建， hadoop2.2(64位)编译，安装，配置以及测试步骤</p>
<p>新版亮点:基于yarn计算框架和高可用性DFS的第一个稳定版本。</p>
<p>注1：官网只提供32位release版本, 若机器为64位，需要手动编译。</p>
<p>注2：目前网上传的2.2版本的安装步骤几乎都有问题，没有一个版本是完全正确的。若不懂新框架内部机制，不要照抄网传的版本。</p>
<p><strong>0. 编译前的准备</strong></p>
<p><strong>虚拟机vmware准备，64bit CentOS准备</strong></p>
<p><strong>节点ip</strong></p>
<p>cluster1   172.16.102. 201</p>
<p>cluster2  172.16.102. 202</p>
<p>cluster3  172.16.102. 203</p>
<p>cluster4  172.16.102. 204</p>
<p><strong>各节点职能划分</strong>     </p>
<p>cluster1        resourcemanager, nodemanager,</p>
<p>proxyserver,historyserver, datanode, namenode,</p>
<p>cluster2        datanode, nodemanager</p>
<p>cluster3 datanode, nodemanager</p>
<p>cluster4 datanode, nodemanager</p>
<p><strong>说明</strong></p>
<p>以下关于修改hostname, 设置静态ip, ssh免登陆，关闭防火墙等步骤，放在文章末尾，这些内容并不是本文讨论的重点。</p>
<p><strong>1. hadoop2.2**</strong>编译**
1说明：标准的</p>
<p>bash</p>
<p>提示符，root用户为</p>
<p>&#39;/#&#39;</p>
<p>，普通用户为</p>
<p>&#39;%&#39;</p>
<p>，由于博客编辑器的缘故，</p>
<p>&#39;/#&#39;</p>
<p>提示符会被默认为comment, 因此在这篇博文中不再区分root和普通user的提示符， 默认全部为</p>
<p>&#39;$&#39;</p>
<p>因为我们安装的CentOS是64bit的，而官方release的hadoop2.2.0版本没有对应的64bit安装包，故需要自行编译。</p>
<p>首先需要去oracle下载64位jdk:
1</p>
<p>2
$</p>
<p>su</p>
<p>root</p>
<p>$wget http:</p>
<p>//download</p>
<p>.oracle.com</p>
<p>/otn-pub/java/jdk/7u45-b18/jdk-7u45-linux-x64</p>
<p>.</p>
<p>tar</p>
<p>.gz</p>
<p>注: prompt（提示符）为%默认为当前用户， /#则为root,注意以下各步骤中的prompt类型。</p>
<p>下面为hadoop编译步骤（注：中间部分的文本框里内容提要只是一些补充说明，不要执行框里的命令）</p>
<p>1.1 BOTPROTO改为”dhcp”
1</p>
<p>2
$</p>
<p>su</p>
<p>root</p>
<p>$</p>
<p>sed</p>
<p>–i  s</p>
<p>/static/dhcp/g</p>
<p>/etc/sysconfig/network-scripts/ifcfg-eth0</p>
<p>/#servicenetwork restart</p>
<p>1.2 下载hadoop2.2.0 源码</p>
<p>1</p>
<p>2
3$</p>
<p>su</p>
<p>grid</p>
<p>$</p>
<p>cd</p>
<p>~
wget  http:</p>
<p>//apache</p>
<p>.dataguru.cn</p>
<p>/hadoop/common/stable/hadoop-2</p>
<p>.2.0-src.</p>
<p>tar</p>
<p>.gz</p>
<p>1.3 安装maven</p>
<p>1</p>
<p>2
3</p>
<p>4
5$</p>
<p>su</p>
<p>root</p>
<p>$</p>
<p>cd</p>
<p>/opt
wget http:</p>
<p>//apache</p>
<p>.fayea.com</p>
<p>/apache-mirror/maven/maven-3/3</p>
<p>.1.1</p>
<p>/binaries/apache-maven-3</p>
<p>.1.1-bin.</p>
<p>tar</p>
<p>.gz</p>
<p>$</p>
<p>tar</p>
<p>zxvf apache-maven-3.1.1-bin.</p>
<p>tar</p>
<p>.gz
$</p>
<p>cd</p>
<p>apache-maven-3.1.1</p>
<p><em>**</em>修改系统环境变量有两种方式，修改/etc/profile， 或者在/etc/profile.d/下添加定制的shell文件，</p>
<p>鉴于profile文件的重要性，尽量不要在profile文件里添加内容，官方建议采用第二种，以保证profile文件的绝对安全。</p>
<p>下面采用第二种方式：</p>
<p>首先，创建一个简单shell脚脚本并添加相关内容进去：
1</p>
<p>2
$</p>
<p>cd</p>
<p>/etc/profile</p>
<p>.d/</p>
<p>$</p>
<p>touch</p>
<p>maven.sh     其次，maven.sh里添加内容如下：1</p>
<p>2
3/#environmentvariable settings for mavn2</p>
<p>export</p>
<p>MAVEN_HOME=</p>
<p>&#39;/opt/apache-maven-3.1.1&#39;</p>
<p>3
export</p>
<p>PATH=$MAVEN_HOME</p>
<p>/bin</p>
<p>:$PATH</p>
<p>最后，source一下</p>
<p>1$</p>
<p>source</p>
<p>/etc/profile</p>
<p><br><br>$</p>
<p>source</p>
<p>/etc/profile1</p>
<p>2
3&lt;em</p>
<p>id</p>
<p>=</p>
<p>&quot;__mceDel&quot;</p>
<blockquote>
<p>$mvn -version</p>
</blockquote>
<p>Apache Maven 3.1.1
&lt;</p>
<p>/em</p>
<p>&gt;</p>
<p>1.4 安装protobuf</p>
<p>注意apache官方网站上的提示“NOTE: You will need protoc 2.5.0 installed.”
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
$</p>
<p>su</p>
<p>root</p>
<p>$</p>
<p>cd</p>
<p>/opt
wget https:</p>
<p>//protobuf</p>
<p>.googlecode.com</p>
<p>/files/protobuf-2</p>
<p>.5.0.</p>
<p>tar</p>
<p>.bz2</p>
<p>$</p>
<p>tar</p>
<p>xvf protobuf-2.5.0.</p>
<p>tar</p>
<p>.bz2 (注意压缩文件后缀， maven安装包是—</p>
<p>gzip</p>
<p>文件，解压时需加–z)
$</p>
<p>cd</p>
<p>protobuf-2.5.0</p>
<p>.</p>
<p>/configure</p>
<p>安装protobuf时提示报错”configure: error: C++ preprocessor &quot;/lib/cpp&quot; failssanity check”</p>
<p>安装gcc
1$yum</p>
<p>install</p>
<p>gcc</p>
<p>1.5 编译hadoop</p>
<p>首先从官网下载hadoop2.2.0source code:
1</p>
<p>2
3$</p>
<p>su</p>
<p>grid;</p>
<p>$</p>
<p>cd</p>
<p>~grid/
wget http:</p>
<p>//apache</p>
<p>.dataguru.cn</p>
<p>/hadoop/common/stable/hadoop-2</p>
<p>.2.0-src.</p>
<p>tar</p>
<p>.gz</p>
<p>好了，痛苦的编译过程来了。</p>
<p>解压之：
1</p>
<p>2
$</p>
<p>tar</p>
<p>zxvf hadoop-2.2.0-src.</p>
<p>tar</p>
<p>.gz</p>
<p>$</p>
<p>cd</p>
<p>hadoop-2.2.0-src</p>
<p>1.6 给maven指定国内镜像源</p>
<p>1.6.1. 切换root权限, 修改/opt/apache-maven-3.1.1/conf/settings.xml
1</p>
<p>2
$</p>
<p>su</p>
<p>root</p>
<p>$vim</p>
<p>/opt/apache-maven-3</p>
<p>.1.1</p>
<p>/conf/settings</p>
<p>.xml</p>
<p>修改1. 在<mirrors>…</mirrors>里添加国内源（注意，保留原本就有的<mirrors>...</mirrors>）：</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>
1  <mirrors> 2     <mirror>3         <id>nexus-osc</id>4         <mirrorOf>/*</mirrorOf>5     <name>Nexusosc</name>6     <url><a href="http://maven.oschina.net/content/groups/public/" target="_blank">http://maven.oschina.net/content/groups/public/</a></url>7     </mirror>8 </mirrors></p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>修改2. 在<profiles>标签中增加以下内容（保留原来的<profiles>…</profiles>， jdk版本根据用户的情况填写）</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>
 1  <profile> 2       <id>jdk-1.4</id> 3       <activation> 4         <jdk>1.4</jdk> 5       </activation> 6       <repositories> 7         <repository> 8           <id>nexus</id> 9           <name>local private nexus</name>10           <url><a href="http://maven.oschina.net/content/groups/public/">http://maven.oschina.net/content/groups/public/</a></url>11           <releases>12             <enabled>true</enabled>13           </releases>14           <snapshots>15             <enabled>false</enabled>16           </snapshots>17         </repository>18       </repositories>19       <pluginRepositories>20         <pluginRepository>21           <id>nexus</id>22           <name>local private nexus</name>23           <url><a href="http://maven.oschina.net/content/groups/public/" target="_blank">http://maven.oschina.net/content/groups/public/</a></url>24           <releases>25             <enabled>true</enabled>26           </releases>27           <snapshots>28             <enabled>false</enabled>29           </snapshots>30         </pluginRepository>31       </pluginRepositories>32     </profile>33 </profiles></p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>   1.6.2 将刚才修改的配置文件拷到当前用户home目录下</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>
$ su grid $ sudo cp /opt/apache-maven-3.1.1/conf/settings.xml ~/.m2//#若提示该用户不在sudoers里，执行以下步骤： $ su root  /#在sudoers里第99行添加当前用户（下面行号不要加）： $ cat /etc/sudoers98  root     ALL=(ALL)       ALL99  grid     ALL=(ALL)       ALL</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>1.7 现在执行官方的clean步骤： $mvn clean install –DskipTests</p>
<p>漫长的等待后发现安装一切正常。</p>
<p>1.8 安装3个依赖包
1</p>
<p>2
3Cmake</p>
<p>ncurses-devel
openssl-devel</p>
<p>执行以下步骤：</p>
<p>1</p>
<p>2
3</p>
<p>4
$</p>
<p>su</p>
<p>root</p>
<p>$yum</p>
<p>install</p>
<p>ncurses-devel
$yum</p>
<p>install</p>
<p>openssl-devel</p>
<p>$yum</p>
<p>install</p>
<p>cmake89</p>
<p>以上安装完成后，切回用户grid：</p>
<p>1</p>
<p>2
$</p>
<p>su</p>
<p>grid</p>
<p>$</p>
<p>cd</p>
<p>~</p>
<p>/hadoop-2</p>
<p>.2.0-src</p>
<p><em>**</em>1.9 所有依赖已安装完毕，开始编译</p>
<p>1$mvn package-Pdist,native -DskipTests -Dtar</p>
<p>漫长的等待后，编译成功，查看结果：</p>
<p><img src="http://m1.img.libdd.com/farm4/d/2013/1114/11/160569527B88184A5CFD1B4C6D260A60_B500_900_500_214.png" alt=""></p>
<p>一切正常。至此，hadoop2.2.0编译完成。</p>
<p><em>**</em>1.10 验证</p>
<p>下面验证编译结果是否符合预期, 注意我们当前是在目录~/hadoop-2.2.0-src下，
1</p>
<p>2
3$</p>
<p>cd</p>
<p>hadoop-dist/</p>
<p>$</p>
<p>ls
pom.xml  target</p>
<p>以上为maven编译的配置文件</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7$</p>
<p>cd</p>
<p>target</p>
<p>$</p>
<p>ls</p>
<p>-sF
total 276M</p>
<p>4.0K antrun/                    92M hadoop-2.2.0.</p>
<p>tar</p>
<p>.gz            4.0K maven-archiver/
4.0K dist-layout-stitching.sh  4.0K hadoop-dist-2.2.0.jar          4.0K</p>
<p>test</p>
<p>-</p>
<p>dir</p>
<p>/</p>
<p>4.0K dist-</p>
<p>tar</p>
<p>-stitching.sh     184M hadoop-dist-2.2.0-javadoc.jar
4.0K hadoop-2.2.0/             4.0K javadoc-bundle-options/</p>
<p>以上为maven编译后自动生成的目录文件，进入hadoop-2.2.0:</p>
<p>1</p>
<p>2
3$</p>
<p>cd</p>
<p>hadoop-2.2.023</p>
<p>$</p>
<p>ls
bin  etc  include  lib libexec  sbin  share</p>
<p>这才是和官方release2.2.0版本（官方只有32bit版本）的相同的目录结构。</p>
<p>1.10.1 下面主要验证两项：</p>
<p><em>**</em>a.验证版本号
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7$bin</p>
<p>/hadoop</p>
<p>version</p>
<p>Hadoop 2.2.0
Subversion Unknown -r Unknown</p>
<p>Compiled by grid on 2013-11-06T13:51Z
Compiled with protoc 2.5.0</p>
<p>From</p>
<p>source</p>
<p>with checksum 79e53ce7994d1628b240f09af91e1af4
This</p>
<p>command</p>
<p>was run using</p>
<p>/home/grid/hadoop-2</p>
<p>.2.0-src</p>
<p>/hadoop-dist/target/hadoop-2</p>
<p>.2.0</p>
<p>/share/hadoop/common/hadoop-common-2</p>
<p>.2.0.jar</p>
<p>可以看到hadoop版本号，编译工具（protoc2.5.0版本号与官方要求一致）以及编译日期.</p>
<p><em>**</em>b.验证hadoop lib的位数
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
$</p>
<p>file</p>
<p>lib</p>
<p>//native/</p>
<p>/*</p>
<p>lib</p>
<p>//native/libhadoop</p>
<p>.a:        current ar archive
lib</p>
<p>//native/libhadooppipes</p>
<p>.a:   current ar archive</p>
<p>lib</p>
<p>//native/libhadoop</p>
<p>.so:       symbolic link to `libhadoop.so.1.0.0&#39;
lib</p>
<p>//native/libhadoop</p>
<p>.so.1.0.0:<strong>ELF 64-bitLSB&lt;</p>
<p>/strong</p>
<blockquote>
<p>shared object, x86-64, version 1 (SYSV), dynamically linked, notstripped1011 lib</p>
</blockquote>
<p>//native/libhadooputils</p>
<p>.a:   current ar archive1213 lib</p>
<p>//native/libhdfs</p>
<p>.a:          current ar archive1415 lib</p>
<p>//native/libhdfs</p>
<p>.so:         symbolic link to `libhdfs.so.0.0.0&#39;</p>
<p>lib</p>
<p>//native/libhdfs</p>
<p>.so.0.0.0:   <strong>ELF 64-bit LSB shared object&lt;</p>
<p>/strong</p>
<blockquote>
<p>, x86-64,version 1 (SYSV), dynamically linked, not stripped</p>
</blockquote>
<p>看到黑色的“ELF-64bit LSB”证明64bit hadoop2.2.0初步编译成功，查看我们之前的hadoop0.20.3版本，会发现lib//native/libhadoop.so.1.0.0是32bit，这是不正确的！。^_^</p>
<p><strong>2. hadoop2.2**</strong>配置**</p>
<p><strong>**</strong>2.1 home设置**</p>
<p>为了和MRv1区别， 2.2版本的home目录直接命名为yarn:
1</p>
<p>2
3</p>
<p>4
$</p>
<p>su</p>
<p>hadoop</p>
<p>$</p>
<p>cd</p>
<p>~
$</p>
<p>mkdir</p>
<p>–p yarn</p>
<p>/yarn_data67</p>
<p>$</p>
<p>cp</p>
<p>–a ~hadoop</p>
<p>/hadoop-2</p>
<p>.2.0-src</p>
<p>/hadoop-dist/target/hadoop-2</p>
<p>.2.0  ~hadoop</p>
<p>/yarn</p>
<p><strong>2.2 环境变量设置</strong></p>
<p>~/.bashrc里添加新环境变量：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
/# javaenv</p>
<p>export</p>
<p>JAVA_HOME=</p>
<p>&quot;/usr/java/jdk1.7.0_45&quot;</p>
<p>exportPATH=</p>
<p>&quot;$JAVA_HOME/bin:$PATH&quot;
/# hadoopvariable settings</p>
<p>export</p>
<p>HADOOP_HOME=</p>
<p>&quot;$HOME/yarn/hadoop-2.2.0&quot;
export</p>
<p>HADOOP_PREFIX=</p>
<p>&quot;$HADOOP_HOME/&quot;</p>
<p>export</p>
<p>YARN_HOME=$HADOOP_HOME
export</p>
<p>HADOOP_MAPRED_HOME=</p>
<p>&quot;$HADOOP_HOME&quot;</p>
<p>export</p>
<p>HADOOP_COMMON_HOME=</p>
<p>&quot;$HADOOP_HOME&quot;
export</p>
<p>HADOOP_HDFS_HOME=</p>
<p>&quot;$HADOOP_HOME&quot;</p>
<p>export</p>
<p>HADOOP_CONF_DIR=</p>
<p>&quot;$HADOOP_HOME/etc/hadoop/&quot;
export</p>
<p>YARN_CONF_DIR=$HADOOP_CONF_DIR</p>
<p>export</p>
<p>PATH=</p>
<p>&quot;$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$PATH&quot;</p>
<p>以上操作注意2点：</p>
<ol>
<li>jdk一定要保证是64bit的</li>
</ol>
<p>2.HADOOP_PREFIX极其重要，主要是为了兼容MRv1，优先级最高（比 如寻找conf目录，即使我们配置了HADOOP_CONF_DIR,启动脚本依然会优先从$HADOOP_PREFIX/conf/里查找），一定要保 证此变量正确配置(也可不设置，则默认使用HADOOP_HOME/etc/hadoop/下的配置文件)</p>
<p><strong>**</strong>2.3 改官方启动脚本的bug**</p>
<p><em>**</em>说明：此版本虽然是release稳定版，但是依然有非常弱智的bug存在。</p>
<p>正常情况下，启动守护进程$YARN_HOME/sbin/hadoop-daemons.sh中可以指定node.</p>
<p>我们看下该启动脚本的说明：
1</p>
<p>2
$sbin</p>
<p>/hadoop-daemons</p>
<p>.sh</p>
<p>Usage:hadoop-daemons.sh [--config confdir] [--hosts hostlistfile] [start|stop]</p>
<p>command</p>
<p>args...</p>
<p>可以看到--hosts可以指定需要启动的存放节点名的文件名：</p>
<p>但这是无效的，此脚本调用的$YARN_HOME/libexec/hadoop-config.sh脚本有bug.</p>
<p>先建一个文件datanodefile 添加datanode节点，放入conf/文件夹下，然后执行一下启动脚本：
1</p>
<p>2
$sbin</p>
<p>/hadoop-daemons</p>
<p>.sh --hosts datanodefile start datanode</p>
<p>at:</p>
<p>/home/grid/yarn/hadoop-2</p>
<p>.2.0</p>
<p>/etc/hadoop//126571</p>
<p>:No such</p>
<p>file</p>
<p>or directory</p>
<p>分析脚本，定位到嵌套脚本$YARN_HOME/libexec/hadoop-config.sh第96行：</p>
<p>196        </p>
<p>export</p>
<p>HADOOP_SLAVES=</p>
<p>&quot;${HADOOP_CONF_DIR}/$$1&quot;</p>
<p>看到红色部分是不对的，应该修改为：</p>
<p>196        </p>
<p>export</p>
<p>HADOOP_SLAVES=</p>
<p>&quot;${HADOOP_CONF_DIR}/$1&quot;</p>
<p>备注1：此版本11月初发布至今，网上教程不论中文还是英文，均未提及此错误。</p>
<p>备注2：$YARN_HOME/libexec/hadoop-config.sh中分析hostfile的逻辑非常脑残：
1</p>
<p>2
3</p>
<p>4
593    </p>
<p>if</p>
<p>[</p>
<p>&quot;--hosts&quot;</p>
<p>=</p>
<p>&quot;$1&quot;</p>
<p>]</p>
<p>94    </p>
<p>then
95        </p>
<p>shift</p>
<p>96        </p>
<p>export</p>
<p>HADOOP_SLAVES=</p>
<p>&quot;${HADOOP_CONF_DIR}/%$1&quot;
97        </p>
<p>shift</p>
<p>因此，用户只能将自己的hostfile放在${HADOOP_CONF_DIR}/ 下面，放在其它地方是无效的。</p>
<p>备注3：按照$YARN_HOME/libexec/hadoop-config.sh脚本的逻辑，还有一种方式指定host
1$hadoop-daemons.sh –hostnames cluster1 start datanode</p>
<p>注意，因为bash脚本区分输入参数的分割符为\t或\s，所以限制了此种方式只能指定一个单独的节点</p>
<p>总结以上分析和修改步骤：
1</p>
<p>2
3</p>
<p>4
5$</p>
<p>cd</p>
<p>$YARN_HOME</p>
<p>/libexec/</p>
<p>$vim hadoop-config.sh
/#修改第96行代码为：</p>
<p>export</p>
<p>HADOOP_SLAVES=</p>
<p>&quot;${HADOOP_CONF_DIR}/$1&quot;
/#保存退出vim</p>
<p><strong>**</strong>2.4 配置文件设置**</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>
 1 <!--$YARN_HOME/etc/hadoop/core-site.xml--> 2                                                                                                                                                                                                                                  3 &lt;?xml version=&quot;1.0&quot;?&gt; 4 &lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt; 5                                                                                                                                                                                                                                  6 <configuration> 7 <property> 8 <name>fs.defaultFS</name> 9   <value>hdfs://cluster1:9000</value>10 </property>11                                                                                                                                                                                                                                 12 <property>13 <name>hadoop.tmp.dir</name>14   <value>/home/grid/hadoop-2.2.0-src/hadoop-dist/target/hadoop-2.2.0//yarn_data/tmp/hadoop-grid</value>15 </property>16 </configuration>17   备注1：注意fs.defaultFS为新的变量，代替旧的：fs.default.name18 19  备注2：tmp文件夹放在我们刚才新建的$HOME/yarn/yarn_data/下面。20 21     <!--$YARN_HOME/etc/hadoop/hdfs-site.xml-->22 <configuration>23     <property>24     <name>dfs.replication</name>25     <value>3</value>26     </property>27 </configuration></p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><em>**</em>备注1. 新：dfs.namenode.name.dir，旧：dfs.name.dir，新：dfs.datanode.name.dir，旧：dfs.data.dir</p>
<p><em>**</em>备注2. dfs.replication确定 data block的副本数目，hadoop基于rackawareness(机架感知)默认复制3份分block,（同一个rack下两个，另一个rack下一 份，按照最短距离确定具体所需block, 一般很少采用跨机架数据块，除非某个机架down了）</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>
 1     <!--$YARN_HOME/etc/hadoop/yarn-site.xml--> 2                                                                                                                                                                                                                             3 <configuration> 4    <property> 5      <name>yarn.nodemanager.aux-services</name> 6      <value>mapreduce_shuffle</value> 7   </property> 8                                                                                                                                                                                                                             9   <property>10      <name>yarn.resourcemanager.address</name>11      <value>cluster1:8032</value>12   </property>13                                                                                                                                                                                                                            14   <property>15       <name>yarn.resourcemanager.resource-tracker.address</name>16       <value>cluster1:8031</value>17   </property>18                                                                                                                                                                                                                            19   <property>20       <name>yarn.resourcemanager.admin.address</name>21       <value>cluster1:8033</value>22   </property>23                                                                                                                                                                                                                            24   <property>25       <name>yarn.resourcemanager.scheduler.address</name>26       <value>cluster1:8030</value>27   </property>28                                                                                                                                                                                                                            29   <property>30       <name>yarn.nodemanager.loacl-dirs</name>31       <value>/home/grid/hadoop-2.2.0-src/hadoop-dist/target//hadoop-2.2.0/yarn_data/mapred/nodemanager</value>32       <final>true</final>33   </property>34                                                                                                                                                                                                                            35   <property>36       <name>yarn.web-proxy.address</name>37       <value>cluster1:8888</value>38   </property>39                                                                                                                                                                                                                            40   <property>41      <name>yarn.nodemanager.aux-services.mapreduce.shuffle.class</name>42      <value>org.apache.hadoop.mapred.ShuffleHandler</value>43   </property>44 </configuration></p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>在此特意提醒：</strong></p>
<p>(1) 目前网上盛传的各种hadoop2.2的基于分布式集群的安装教程大部分都是错的,hadoop2.2配置里最重要的也莫过于yarn-site.xml里的变量了吧？</p>
<p>(2)不同于单机安装，基于集群的搭建必须设置</p>
<p>yarn-site.xml可选变量yarn.web-proxy.address
和</p>
<p>yarn.nodemanager.loacl-dirs
外的其它所有变量！后续会专门讨论yarn-site.xml里各个端口配置的含义。</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>
1 <!--$YARN_HOME/etc/hadoop/mapred-site.xml-->2                                                                                                                                                                                                            3 <configuration>4     <property>5         <name>mapreduce.framework.name</name>6         <value>yarn</value>7     </property>8 </configuration></p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>备注1：新的计算框架取消了实体上的jobtracker, 故不需要再指定mapreduce.jobtracker.addres，而是要指定一种框架，这里选择yarn. 备注2：hadoop2.2.还支持第三方的计算框架，但没怎么关注过。
          配置好以后将$HADOOP_HOME下的所有文件，包括hadoop目录分别copy到其它3个节点上。</p>
<p><strong>2.5**</strong>各节点功能规划**</p>
<p>确保在每主机的/etc/hosts里添加了所有node的域名解析表（i.e.cluster1   198.0.0.1）；iptables已关闭；/etc/sysconfig/network-script/ifcfg-eth0里 BOTPROTO=static；/etc/sysconfig/network文件里已设置了各台主机的hostname, 静态ip地址，且已经重启过每台机器；jdk和hadoop都为64bit；ssh免登陆已配置；完成以上几项后，就可以启动hadoop2.2.0了。</p>
<p>注意到从头到尾都没有提到Master, Slave,也没有提到namenode,datanode,是因为，新的计算框架，新的hdfs中不存在物理上的Master节点，所有的节点都是等价的。</p>
<p>各节点职能划分在篇首已有说明， 在此重提一下：
1</p>
<p>2
3</p>
<p>4
cluster1    resourcemanager, nodemanager, proxyserver,historyserver, datanode, namenode,</p>
<p>cluster2    datanode, nodemanager
cluster3    datanode, nodemanager</p>
<p>cluster4    datanode, nodemanager</p>
<p><strong>2.6 hdfs 格式化</strong></p>
<p>1$bin</p>
<p>/hdfs</p>
<p>namenode –</p>
<p>format</p>
<p>(注意：hadoop 2.2.0的格式化步骤和旧版本不一样，旧的为 $YARN_HOME/bin/hadoop namenode –format)</p>
<p><strong>2.7 hadoop整体启动</strong></p>
<p><em>**</em>启动方式（1）分别登录各自主机开启</p>
<p>在cluster1节点上，分别启动resourcemanager,nodemanager, proxyserver, historyserver, datanode, namenode,</p>
<p>在cluster2, cluster3, cluster4 节点主机上，分别启动datanode,nodemanager</p>
<p><strong>备注</strong>：如果resourcemanager是 独立的，则除了resourcemanager,其余每一个节点都需要一个nodemanager，我们可以在$YARN_HOME/etc /hadoop/下新建一个nodehosts, 在里面添加所有的除了resourcemanager外的所有node，因为此处我们配置的resourcemanager和namenode是同一台主 机，所以此处也需要添加nodemanager</p>
<p>执行步骤如下：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13$</p>
<p>hostname</p>
<p>/#查看host名字</p>
<p>cluster1
$sbin</p>
<p>/hadoop-daemon</p>
<p>.sh  --script hdfs start namenode</p>
<p>/# 启动namenode</p>
<p>$sbin</p>
<p>/hadoop-daemon</p>
<p>.sh --script hdfs start datanode</p>
<p>/# 启动datanode
$sbin</p>
<p>/yarndaemon</p>
<p>.shstart nodemanager</p>
<p>/#启动nodemanager</p>
<p>$sbin</p>
<p>/yarn-daemon</p>
<p>.sh   start resourcemanager</p>
<p>/# 启动resourcemanager
$sbin</p>
<p>/yarn-daemon</p>
<p>.shstart proxyserver</p>
<p>/# 启动web App proxy, 作用类似jobtracker,若yarn-site.xml里没有设置yarn.web-proxy.address的host和端口，或者设置了和 resourcemanager相同的host和端口，则hadoop默认proxyserver和resourcemanager共享 host:port</p>
<p>$sbin</p>
<p>/mr-jobhistory-daemon</p>
<p>.sh   start historyserver</p>
<p>/#你懂得
$</p>
<p>ssh</p>
<p>cluster2 </p>
<p>/#登录cluster2</p>
<p>$</p>
<p>hostname</p>
<p>/#查看host名字cluster2
$sbin</p>
<p>/yarndaemon</p>
<p>.shstart nodemanager</p>
<p>/# 启动nodemanager</p>
<p>$sbin</p>
<p>/hadoop-daemon</p>
<p>.sh  --script hdfs start datanode</p>
<p>/# 启动datanode
$</p>
<p>ssh</p>
<p>cluster3 </p>
<p>/#登录cluster3.../# cluster2, cluster3, cluster4启动方式和cluster2一样。</p>
<p>启动方式（2）使用hadoop自带的批处理脚本开启</p>
<p>Step1.确认已登录cluster1:
1$</p>
<p>hostname</p>
<p>cluster1</p>
<p>在$YARN_HOME/etc/hadoop/下新建namenodehosts,添加所有namenode节点</p>
<p>1</p>
<p>2</p>
<p>$</p>
<p>cat</p>
<p>$YARN_HOME</p>
<p>/etc/hadoop/namenodehosts</p>
<p>cluster1</p>
<p>在$YARN_HOME/etc/hadoop/下新建datanodehosts,添加所有datanode节点</p>
<p>1</p>
<p>2
3</p>
<p>4
$</p>
<p>cat</p>
<p>$YARN_HOME</p>
<p>/etc/hadoop/datanodehosts</p>
<p>cluster2
cluster3</p>
<p>cluster4</p>
<p>在$YARN_HOME/etc/hadoop/下新建nodehosts,添加所有datanode和namenode节点</p>
<p>1</p>
<p>2
3</p>
<p>4
5$</p>
<p>cat</p>
<p>$YARN_HOME</p>
<p>/etc/hadoop/datanodehosts</p>
<p>cluster1
cluster2</p>
<p>cluster3
cluster4</p>
<p><strong>备注</strong>：以上的hostfile名字是随便起的，可以是任意的file1,file2,file3, 但是必须放在$YARN_HOME/etc/hadoop/下面！</p>
<p>Step2.执行脚本
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
$sbin</p>
<p>/hadoop-daemons</p>
<p>.sh--hosts namenodehosts --script  hdfsstart  namenode</p>
<p>$sbin</p>
<p>/hadoop-daemons</p>
<p>.sh--hosts datanodehosts --script  hdfsstart  datanode
$sbin</p>
<p>/yarn-daemons</p>
<p>.sh--hostnames cluster1 start resourcemanager</p>
<p>$sbin</p>
<p>/yarn-daemons</p>
<p>.sh--hosts allnodehosts start nodemanager
$sbin</p>
<p>/yarn-daemons</p>
<p>.sh--hostnames cluster1 start proxyserver</p>
<p>$sbin</p>
<p>/mr-jobhistory-daemon</p>
<p>.sh   start  historyserver</p>
<p><strong>在这里不得不纠正一个其他教程上关于对hadoop2.2做相关配置和运行时的错误!</strong></p>
<p>我们在core-site.xml指定了default filesystem为cluster1, 并指定了其节点ip（或节点名）和端口号， 这意味着若启动hadoop时不额外添加配置（启动hadoop时命令行里加--conf指定用户配置文件的存放位置)，则默认的namenode就一 个，那就是cluster1, 如果随意指定namenode必然会出现错误！</p>
<p>如果你要还要再启动一个新的namenode(以cluster3为例)，则必须如下操作：</p>
<p>a. 新建一个core-site.xml，添加fs.defaultFS的value为hdfs://cluster3:9000</p>
<p>b. command：
1$sbin</p>
<p>/hadoop-daemon</p>
<p>.sh --hostnames cluster3 --conf you_conf_dir --script hdfs --start namenode</p>
<p>我们之前启动的namenode为cluster1, 假如要查看放在此文件系统根目录下的文件input_file，则它的完整路径为 hdfs://cluster1:9000/input_file</p>
<p>Step3.查看启动情况</p>
<p>在cluster1上：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
$jps</p>
<p>22411 NodeManager
23356 Jps</p>
<p>22292 ResourceManager
22189 DataNode</p>
<p>22507 WebAppProxyServer</p>
<p>在cluster2上</p>
<p>1</p>
<p>2
3</p>
<p>4
$jps</p>
<p>8147 DataNode
8355 Jps</p>
<p>8234 NodeManagercluster3，cluster4上和cluster2一样。</p>
<p><em>**</em>Step4.查看各节点状态以及yarncluster运行状态</p>
<p>（1）查看各节点状态</p>
<p>FireFox进入： <a href="http://cluster1:50070(cluster1为namenode所在节点" target="_blank">http://cluster1:50070(cluster1为namenode所在节点</a>)</p>
<p>在主页面（第一张图）上点击Live Node，查看（第二张图）上各Live Node状态：</p>
<p><img src="http://m1.img.libdd.com/farm4/d/2013/1114/14/5D0856F11A09F93C0BD97246AE6DEE43_B500_900_500_218.png" alt=""></p>
<p>（2）查看resourcemanager上cluster运行状态</p>
<p>Firefox进入：<a href="http://cluster2:8088(node1为resourcemanager所在节点" target="_blank">http://cluster2:8088(node1为resourcemanager所在节点</a>)</p>
<p><img src="http://m3.img.libdd.com/farm4/d/2013/1114/14/5B46215F81D52CF3C3DB80D2DEFF8770_B500_900_500_195.png" alt=""></p>
<p><strong> </strong>Step5. Cluster上MapReduce测试</p>
<p>现提供3个test cases</p>
<p><strong>Test Case 1 testimated_value_of_pi</strong></p>
<p>command:
$sbin/yarnjar $YARN_HOME/share/hadoop//mapreduce/hadoop-mapreduce-examples-2.2.0.jar \pi 101000000</p>
<p>console输出：</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>
Number of Maps  =10                        Samples per Map = 1000000                         Wrote input for Map /#0                          Wrote input for Map /#1                          Wrote input for Map /#2                         Wrote input for Map /#3                        Wrote input for Map /#4                       Wrote input for Map /#5                         Wrote input for Map /#6                        Wrote input for Map /#7                        Wrote input for Map /#8                        Wrote input for Map /#9                        Starting Job                        13/11/06 23:20:07 INFO Configuration.deprecation: mapred.map.tasksis deprecated. Instead, use mapreduce.job.maps                        13/11/06 23:20:07 INFO Configuration.deprecation:mapred.output.key.class is deprecated. Instead, usemapreduce.job.output.key.class                         13/11/06 23:20:07 INFO Configuration.deprecation:mapred.working.dir is deprecated. Instead, use mapreduce.job.working.dir                         13/11/06 23:20:11 INFO mapreduce.JobSubmitter: Submittingtokens for job: job_1383806445149_0001                         13/11/06 23:20:15 INFO impl.YarnClientImpl: Submittedapplication application_1383806445149_0001 to ResourceManager at /0.0.0.0:8032                       13/11/06 23:20:16 INFO mapreduce.Job: The url to trackthe job: <a href="http://Node1:8088/proxy/application_1383806445149_0001/" target="_blank">http://Node1:8088/proxy/application_1383806445149_0001/</a>                        13/11/06 23:20:16 INFO mapreduce.Job: Running job:job_1383806445149_0001                         13/11/06 23:21:09 INFO mapreduce.Job: Jobjob_1383806445149_0001 running in uber mode : false                        13/11/06 23:21:10 INFO mapreduce.Job:  map 0% reduce 0%                          13/11/06 23:24:28 INFO mapreduce.Job:  map 20% reduce 0%                         13/11/06 23:24:30 INFO mapreduce.Job:  map 30% reduce 0%                          13/11/06 23:26:56 INFO mapreduce.Job:  map 57% reduce 0%                          13/11/06 23:26:58 INFO mapreduce.Job:  map 60% reduce 0%                          13/11/06 23:28:33 INFO mapreduce.Job:  map 70% reduce 20%                         13/11/06 23:28:35 INFO mapreduce.Job:  map 80% reduce 20%                         13/11/06 23:28:39 INFO mapreduce.Job:  map 80% reduce 27%                         13/11/06 23:30:06 INFO mapreduce.Job:  map 90% reduce 27%                         13/11/06 23:30:09 INFO mapreduce.Job:  map 100% reduce 27%                         13/11/06 23:30:12 INFO mapreduce.Job:  map 100% reduce 33%                         13/11/06 23:30:25 INFO mapreduce.Job:  map 100% reduce 100%                          13/11/06 23:30:54 INFO mapreduce.Job: Jobjob_1383806445149_0001 completed successfully                          13/11/06 23:31:10 INFO mapreduce.Job: Counters: 43                                    File SystemCounters                                             FILE:Number of bytes read=226                                             FILE:Number of bytes written=879166                                              FILE:Number of read operations=0                                             FILE:Number of large read operations=0                                            FILE:Number of write operations=0                                             HDFS:Number of bytes read=2590                                               HDFS:Number of bytes written=215                                               HDFS:Number of read operations=43                                               HDFS:Number of large read operations=0                                                 HDFS:Number of write operations=3                                    JobCounters                                              Launchedmap tasks=10                                                Launchedreduce tasks=1                                               Data-localmap tasks=10                                                Totaltime spent by all maps in occupied slots (ms)=1349359                                             Totaltime spent by all reduces in occupied slots (ms)=190811                                    Map-ReduceFramework                                             Mapinput records=10                                              Mapoutput records=20                                                Mapoutput bytes=180                                                 Mapoutput materialized bytes=280                                                Inputsplit bytes=1410                                                 Combineinput records=0                                                Combineoutput records=0                                                  Reduceinput groups=2                                                 Reduceshuffle bytes=280                                              Reduceinput records=20                                                Reduceoutput records=0                                                 SpilledRecords=40                                                 ShuffledMaps =10                                                  FailedShuffles=0                                                MergedMap outputs=10                                                 GCtime elapsed (ms)=45355                                                 CPUtime spent (ms)=29860                                                 Physicalmemory (bytes) snapshot=1481818112                                                 Virtualmemory (bytes) snapshot=9214468096                                                 Totalcommitted heap usage (bytes)=1223008256                                        ShuffleErrors                                              BAD_ID=0                                              CONNECTION=0                                             IO_ERROR=0                                              WRONG_LENGTH=0                                               WRONG_MAP=0                                            WRONG_REDUCE=0                                    File InputFormat Counters                                              BytesRead=1180                                    File OutputFormat Counters                                             BytesWritten=97                           13/11/06 23:31:15 INFO mapred.ClientServiceDelegate:Application state is completed. FinalApplicationStatus=SUCCEEDED. Redirectingto job history server                           Job Finished in 719.041 seconds                           Estimated value of Pi is 3.14158440000000000000</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>说明</strong>：可以看到最后输出值为该job使用了 10个maps, job id为job<em>1383806445149_000, 最后计算得Pi的值为13.14158440000000000000， job Id分配原则为job</em>年月日时分<em>job序列号，序列号从0开始，上限值为1000， task id分配原则为job</em>年月日时分<em>job序列号_task序列号_m, job</em>年月日时分_job序列号_task序列号_r, m代表map taskslot , r代表reduce task slot, task 序列号从0开始，上限值为1000.</p>
<p><strong>Test Case 2 random_writting</strong>
/#command line $sbin/yarnjar $YARN_HOME/share/hadoop//mapreduce/hadoop-mapreduce-examples-2.2.0.jar \randomwriter/user/grid/test/test_randomwriter/out</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>/#Console输出摘录：                                                                                                                                                    Running 10 maps.Job started: Wed Nov 0623:42:17 PST 201313/11/0623:42:17 INFO client.RMProxy: Connecting toResourceManager at /0.0.0.0:803213/11/0623:42:19 INFO mapreduce.JobSubmitter: number ofsplits:1013/11/0623:42:20 INFO mapreduce.JobSubmitter: Submittingtokens for job: job_1383806445149_000213/11/0623:42:21 INFO impl.YarnClientImpl: Submittedapplication application_1383806445149_0002 to ResourceManager at /0.0.0.0:803213/11/0623:42:21 INFO mapreduce.Job: The url to trackthe job: <a href="http://Master:8088/proxy/application_1383806445149_0002/13/11/0623:42:21" target="_blank">http://Master:8088/proxy/application_1383806445149_0002/13/11/0623:42:21</a> INFO mapreduce.Job: Running job:job_1383806445149_000213/11/0623:42:40 INFO mapreduce.Job: Jobjob_1383806445149_0002 running in uber mode : false13/11/0623:42:40 INFO mapreduce.Job:  map 0% reduce 0%                  13/11/0623:55:02 INFO mapreduce.Job:  map 10% reduce 0%                    13/11/0623:55:14 INFO mapreduce.Job:  map 20% reduce 0%                  13/11/0623:55:42 INFO mapreduce.Job:  map 30% reduce 0%                    13/11/0700:06:55 INFO mapreduce.Job:  map 40% reduce 0%                    13/11/0700:07:10 INFO mapreduce.Job:  map 50% reduce 0%                   13/11/0700:07:36 INFO mapreduce.Job:  map 60% reduce 0%                    13/11/0700:13:47 INFO mapreduce.Job:  map 70% reduce 0%                     13/11/0700:13:54 INFO mapreduce.Job:  map 80% reduce 0%                     13/11/0700:13:58 INFO mapreduce.Job:  map 90% reduce 0%                    13/11/0700:16:29 INFO mapreduce.Job:  map 100% reduce 0%                    13/11/0700:16:37 INFO mapreduce.Job: Jobjob_1383806445149_0002 completed successfully        File OutputFormat Counters                  BytesWritten=10772852496Job ended: Thu Nov 0700:16:40 PST 2013The job took 2062 seconds.</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>说明</strong>：电脑存储空间足够的话，可以从hdfs里down下来看看。</p>
<p>现只能看一看输出文件存放的具体形式：</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>
./bin/hadoopfs -ls /user/grid/test/test_randomwriter/out/Found 11items-rw-r--r--   2 grid supergroup          02013-11-0700:16/user/grid/test/test_randomwriter/out/_SUCCESS-rw-r--r--   2 grid supergroup 10772782142013-11-0623:54 /user/grid/test/test_randomwriter/out/part-m-00000                                                                                                                                                   -rw-r--r--   2 grid supergroup 10772827512013-11-0623:55 /user/grid/test/test_randomwriter/out/part-m-00001                                                                                                                                                   -rw-r--r--   2 grid supergroup 10772802982013-11-0623:55 /user/grid/test/test_randomwriter/out/part-m-00002                                                                                                                                                   -rw-r--r--   2 grid supergroup 10773031522013-11-0700:07 /user/grid/test/test_randomwriter/out/part-m-00003                                                                                                                                                   -rw-r--r--   2 grid supergroup 10772842402013-11-0700:06 /user/grid/test/test_randomwriter/out/part-m-00004                                                                                                                                                   -rw-r--r--   2 grid supergroup 10772866042013-11-0700:07 /user/grid/test/test_randomwriter/out/part-m-00005                                                                                                                                                   -rw-r--r--   2 grid supergroup 10772843362013-11-0700:13 /user/grid/test/test_randomwriter/out/part-m-00006                                                                                                                                                   -rw-r--r--   2 grid supergroup 10772848292013-11-0700:13 /user/grid/test/test_randomwriter/out/part-m-00007                                                                                                                                                   -rw-r--r--   2 grid supergroup 10772897062013-11-0700:13 /user/grid/test/test_randomwriter/out/part-m-00008                                                                                                                                                   -rw-r--r--   2 grid supergroup 10772783662013-11-0700:16 /user/grid/test/test_randomwriter/out/part-m-00009</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>Test Case3 word_count</strong></p>
<p>（1）Locaol上创建文件：
$mkdirinput%echo ‘hello,world’ &gt;&gt; input/file1.in$echo ‘hello, ruby’ &gt;&gt; input/file2.in</p>
<p>（2）上传到hdfs上：
./bin/hadoop fs -mkdir -p /user/grid/test/test_wordcount/./bin/hadoop fs –put input/user/grid/test/test_wordcount/in</p>
<p>（3）用yarn新计算框架运行mapreduce：</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>
/#command line $bin/yarn jar$YARN_HOME/share/hadoop//mapreduce/hadoop-mapreduce-examples-2.2.0.jarwordcount  /user/grid/test/test_wordcount/in/user/grid/test/test_wordcount/out                                                                                                                                             /#ConSole输出摘录：3/11/0700:35:03 INFO client.RMProxy:Connecting to ResourceManager at /0.0.0.0:803213/11/0700:35:05 INFO input.FileInputFormat:Total input paths to process : 213/11/0700:35:05 INFO mapreduce.JobSubmitter:number of splits:213/11/0700:35:06 INFO mapreduce.JobSubmitter:Submitting tokens for job: job_1383806445149_000313/11/0700:35:08 INFO impl.YarnClientImpl:Submitted application application_1383806445149_0003 to ResourceManager at /0.0.0.0:803213/11/0700:35:08 INFO mapreduce.Job: The urlto track the job: <a href="http://Master:8088/proxy/application_1383806445149_0003/13/11/0700:35:08" target="_blank">http://Master:8088/proxy/application_1383806445149_0003/13/11/0700:35:08</a> INFO mapreduce.Job: Runningjob: job_1383806445149_000313/11/0700:35:25 INFO mapreduce.Job: Jobjob_1383806445149_0003 running in uber mode : false13/11/0700:35:25 INFO mapreduce.Job:  map 0% reduce 0%                                                                                                                                              13/11/0700:37:50 INFO mapreduce.Job:  map 33% reduce 0%                                                                                                                                              13/11/0700:37:54 INFO mapreduce.Job:  map 67% reduce 0%                                                                                                                                              13/11/0700:37:55 INFO mapreduce.Job:  map 83% reduce 0%                                                                                                                                              13/11/0700:37:58 INFO mapreduce.Job:  map 100% reduce 0%                                                                                                                                              13/11/0700:38:51 INFO mapreduce.Job:  map 100% reduce 100%                                                                                                                                              13/11/0700:38:54 INFO mapreduce.Job: Jobjob_1383806445149_0003 completed successfully13/11/0700:38:56 INFO mapreduce.Job:Counters: 43</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><strong>说明</strong>：查看word count的计算结果：
1</p>
<p>2
3</p>
<p>4
$bin</p>
<p>/hadoop</p>
<p>fs -</p>
<p>cat</p>
<p>/user/grid/test//test_wordcount/out/</p>
<p>/*</p>
<p>hadoop 1
hello  1</p>
<p>ruby</p>
<p><strong>补充</strong>：因为新的YARN为了保持与MRv1框 架的旧版本兼容性，很多老的API还是可以用，但是会有INFO。此处通过修改$YARN_HOME/etc/hadoop /log4j.properties可以turn offconfiguration deprecation warnings.</p>
<p>建议去掉第138行的注释（可选），确保错误级别为WARN（默认为INFO级别，详见第20行：hadoop.root.logger=INFO,console）：
1138 log4j.logger.org.apache.hadoop.conf.Configuration.deprecation=WARN</p>
<p>附文：</p>
<p><strong>集群搭建、配置步骤（基于CentOS_64bit）</strong></p>
<p><strong>0. 说明</strong></p>
<p>大体规划如下：</p>
<p>虚拟机： VMware-workstation-full-8.0.3-703057（VMware10中文版不完整，此版本内含vmware tools，为设定共享文件夹所必须）</p>
<p>电脑1，VMWare,内装2个虚拟系统，(cluster1, cluster2)</p>
<p>电脑2,，VMware内装2个虚拟系统，(cluster3, cluster4)</p>
<p>虚拟主机： CentOS x86 64bit</p>
<p>局域网IP设置：<em>**</em>
1</p>
<p>2
3</p>
<p>4</p>
<p>cluster1  172.16.102. 201</p>
<p>cluster2   172.16.102. 202
cluster3   172.16.102. 203</p>
<p>cluster4   172.16.102. 204</p>
<p>网关</p>
<p>1172.16.102.254</p>
<p><strong>1. Linux集群安装</strong></p>
<p>(1) 准备</p>
<p>Vmware: VMware-workstation-full-8.0.3-703057(此安装包自带VMWare Tools)</p>
<p>Linux:CentOS.iso</p>
<p>(2) VMWare配置</p>
<p>VMWare以及所有安装的虚拟机均为桥接</p>
<p>Step1. 配置VMWare 联网方式： Editor-&gt;Virtual Network Editor-&gt;选择Bridged， 点击确定</p>
<p>Step2. 安装虚拟机</p>
<p>Step3.配置各虚拟机接网方式：右键已安装虚拟机-&gt;点击NetworkAdapter, 选择桥接，确定</p>
<p>Step4. 为所有安装好的虚拟系统设置一个共享目录(类似FTP，但是设置共享目录更方便) ：右键已安装虚拟机-&gt;点击Virtual Machine Settings对话框上部Options， 选择Shared Folder， 在本地新建SharedFolder并添加进来,确定。</p>
<p>(3) linux下网卡以及IP配置</p>
<p>以下配置在三个虚拟系统里均相同, 以cluster1为例：</p>
<p>配置前需切换为root</p>
<p>Step1. 修改主机名， 设置为开启网络</p>
<p>配置/etc/sysconfig/network：
1</p>
<p>2
3[root@localhost ~]</p>
<p>/# cat /etc/sysconfig/network</p>
<p>NETWORKING=</p>
<p>yes
HOSTNAME=cluster1</p>
<p>Step2.修改当前机器的IP， 默认网关， IP分配方式， 设置网络接口为系统启动时有效：</p>
<p>a.查看配置前的ip:
1</p>
<p>2
3</p>
<p>4
[root@localhost ~]</p>
<p>/# ifconfig</p>
<p>eth0      Link encap:Ethernet  HWaddr 00:0C:29:E1:FB:95 
inet addr:172.16.102.3  Bcast:172.16.102.255  Mask:255.255.255.0</p>
<p>inet6 addr: fe80::20c:29ff:fee1:fb95</p>
<p>/64</p>
<p>Scope:Lin</p>
<p>b.配置/etc/sysconfig/network-scripts/ifcfg-eth0</p>
<p>注意以下几项：</p>
<p>BOOTPROTO=&quot;static&quot; (IP分配方式, 设为static则主机ip即为IPADDR里所设，若为”dhcp”, 此时只有局域网有效，则vmware会启动自带虚拟”dhcp”, 动态分配ip， 此时可以连接互联网 )</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>
IPV6INIT=&quot;no&quot;  /#你懂得 IPADDR=&quot;172.16.102.201&quot; /#ip地址 GETEWAY=&quot;172.16.102.254&quot; /#默认网关地址 ONBOOT=&quot;yes&quot; /#系统启动时网络接口有效 [root@localhost ~]/# cat /etc/sysconfig/network-scripts/ifcfg-eth0  DEVICE=&quot;eth0&quot;BOOTPROTO=&quot;static&quot;HWADDR=&quot;00:0C:29:E1:FB:95&quot;BOOTPROTO=&quot;dhcp&quot;IPV6INIT=&quot;no&quot;IPADDR=&quot;172.16.102.201&quot;GETEWAY=&quot;172.16.102.254&quot;ONBOOT=&quot;yes&quot;NM_CONTROLLED=&quot;yes&quot;TYPE=&quot;Ethernet&quot;UUID=&quot;79612b26-326b-472c-94af-9ab151fc2831</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>c.使当前设置生效：
$service network restart $ifdown eth0 /#关闭默认网卡 $ifup eth/#重新启用默认网卡 $service network restart; ifdown eth0; ifup eth0</p>
<p>d.查看新设置的ip:
$ifconfigeth0      Link encap:Ethernet  HWaddr 00:0C:29:E1:FB:95  inet addr:192.168.1.200  Bcast:192.168.1.255  Mask:255.255.255.0inet6 addr: fe80::20c:29ff:fee1:fb95/64 Scope:Link UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</p>
<p>Step3. 修改hosts文件，此文件会被ＤＮＳ解析，类似linux里的alias, 设置后以后，hostname就是ip地址， 两者可以互换。</p>
<p>配置/etc/hosts, 添加三行如下， （注意，此3行在3个虚拟主机里都相同，切必须全部都要加上）</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a>
[root@localhost ~]/# cat /etc/hosts127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6 cluster1   172.16.102. 201cluster2   172.16.102. 202cluster3   172.16.102. 203cluster4   172.16.102. 204</p>
<p><a href="&quot;复制代码&quot;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>Step4. 按照以上3个步骤分别设置两外两个虚拟主机，</p>
<p>配置完以后必须按照之前的三个命令分别重启 network, ifeth0:
$service network restart $ifdown eth0 $ifup eth0</p>
<p>重新初始化以后查看各自主机的ip配置是否正确。</p>
<p>在任意一台主机上执行： ping cluster1; ping cluster2; ping cluster3; ping cluster4</p>
<p>若配置正确，一定可以ping通，否则，请检查各个主机的/etc/hosts文件是否已经添加新的映射！至此，linux集群已成功配置。</p>
<p><strong>2. 设置 ssh免登陆</strong></p>
<p>a. 新建一个用户</p>
<p>在三台主机上分别以root权限新建一个用户，此处默认为grid:</p>
<p>cluster1,cluster2, cluster3, cluster4上：
$useradd –m grid $passwd grid 1qaz!QAZ</p>
<p>注意一定要保证4台主机上有相同的用户名， 以实现同一个用户在4台主机上登录。</p>
<p>b. 在cluster1上生成RSA密钥</p>
<p>切换回user: grid
$su grid $cd ~</p>
<p>生成密钥对：</p>
<p>1</p>
<p>2
3$</p>
<p>ssh</p>
<p>-keygen –t rsa</p>
<p>/#一路回车到最后（ 此处生成无需密码的秘钥-公钥对）。
/#上一个步骤 ssh-keygen –t rsa会在grid的home目录下生成一个.ssh文件夹</p>
<p>之后：</p>
<p>$cd ~/.ssh/$cp id_rsa.pub authorized_keys</p>
<p>c. 在另外3个主机上的grid用户home目录下也声称相应的密钥对, 并在.ssh目录下生成一个</p>
<p>authorized_keys
文件</p>
<p>d. 想办法将4台主机grid用户下刚生成的</p>
<p>authorized_keys
里的内容整合成一个完整的</p>
<p>authorized_keys.</p>
<p>比如将4个authorized_keys里的内容全部复制到cluster1上的authorized_keys里， 然后：
$chmod 600 authorized_keys $scp .ssh/authorized_keys  cluster2:/home/grid/.ssh/$scp .ssh/authorized_keys  cluster3:/home/grid/.ssh/$scp .ssh/authorized_keys  cluster4:/home/grid/.ssh/</p>
<p>若要求输入密码，则输入之前新建用户grid时设置的密码， 一路回车到最后.</p>
<p>e. 下面尝试ssh无秘钥登录：</p>
<p>在cluster1主机上：ssh cluster2， 依次尝试登陆cluster2, cluster3, cluster4</p>
<p>若均可可以免密码登录，则直接跳到下一步骤，否则，请看下面的解决方案：</p>
<p>可能出现的问题有3，</p>
<p>第一种可能，.ssh文件夹非自动生成，而是你手动新建的，若如此，会出现.ssh的安全上下文问题， 解决方案， 在三个主机上以grid用户，删除刚才生成的.ssh文件夹，重新进入home目录，务必用 /# ssh-keygen –t rsa 生成秘钥， 此过程ssh程序会自动在home目录下成成一个.ssh文件夹</p>
<p>第二种可能, authorized_keys权限不一致。 在各自.ssh目录下：ls–alauthorizedkeys,查看此文件的权限，一定为600(−rw−−−−−−−),即只对当前用户grid开放可读可写权限，若不是，则修改authorizedkeys文件权限chmod 600 authorized_keys</p>
<p>若经过以上两步还不行，则执行以下命令，重新启动ssh-agent， 且加入当前用户秘钥id_rsa
$ssh-add ~grid/.ssh/id_rsa</p>
<p>经过以上三步，一定可以实现grid从cluster1到其它3个节点的免秘钥登录。</p>
<p>因为hadoop2.2新架构的缘故，我们还应该设置为每一个节点到其它任意节点免登陆。</p>
<p>具体步骤:</p>
<p>1.在将cluster2, cluster3, cluster4上各自的.ssh/id_rsa.pub 分别复制到cluster1的.ssh/下： scp id_rsa.pub cluster1:/home/grid/.ssh/tmp2, scp id_rsa.pub cluster1:/home/grid/.ssh/tmp3 ...</p>
<p>2.将cluster1节点/home/grid/.ssh/下的tmp2, tmp3, tmp4分别appand到authorized_keys里， 并请将各自节点上的id_rsa.pub也append到各自节点的authorized_keys里，以实现本地登陆（类似： ssh localhost)</p>
<p>至此，ssh免秘钥登陆设置完成。</p>
<p><strong>3. 安装jdk</strong></p>
<p>Step1. 记得之前在安装cluster1时在VMWare里设置的共享目录吗？</p>
<p>在Windows下将Hadoop安装包，jdk安装包Copy到共享目录下，然后在linux下从/mnt/hgfs/Data-shared/下cp到/home/grid/下，直接执行jdk安装包，不需要解压。</p>
<p>注意：若在安装过程中提示”Extracting… install.sfx 5414: /lib/ld-linux.50.2 No such file or directory, 则执行以下命令:</p>
<p>a.我们之前为了测试自定义的ip是否有效，已将各台主机的ip分配方式设为了BOOTPROTO=”static”, 这种方式是无法连入外部网络的，所以此时为了安装缺省的包，切换到root, 修改/etc/sysconfig/network-script/ifcfg-eth0，将BOOTPROTO=”static” 修改为BOOTPROTO=”dhcp”,</p>
<p>b.重启网络服务和网卡: 在root权限下:
$service network restart; ifdown eth0; ifup eth0 $yum install glibc.i686</p>
<p>d.切换回grid,重新安装jdk</p>
<p>$cd /usr/java/  /#注意必须进入java文件夹，因为java安装包默认安装在当前目录下 $./jdk-6u25-linux-i586.bin /#安装jdk</p>
<p>安装完以后，记得将eth0文件修改回来：</p>
<p>$sed -i s/dhcp/static/g /etc/sysconfig/network-scripts/ifcfg-eth0 /#此处用sed直接替换，若不放心也可以用编辑器修改 /#service network restart; ifdown eth0;ifup eth0</p>
<p>至此，jdk已在linux下安装完毕。</p>
<p>最后，将java安装好的路径append到$PATH变量里（处于个人习惯，新环境变量一律添加到所需用户的.bashrc文件里， 即只对当前用户有效）
$su grid $vim ~/.bashrc （修改.bashrc文件，添加如下两行：） $tail -2 ~/.bashrc export JAVA_HOME=&quot;/usr/java/jdk1.6.0_25/&quot;export PATH=&quot;${PATH}:${JAVA_HOME}/bin&quot;</p>
<p>测试一下java是否可以正常启动：</p>
<p>$source ~/.bashrc $which java $/usr/java/jdk1.6.0_25/bin/java</p>
<p>至此，jdk安装完毕。</p>
<p>用同样的方式在另外3台虚拟主机上安装jdk, 提示：先复制到home下
$scp -r /mnt/hgfs/Data-shared/Archive/jdk-6u25-linux-i586.bin  cluster2:/home/grid/$scp -r /mnt/hgfs/Data-shared/Archive/jdk-6u25-linux-i586.bin  cluster3:/home/grid/$scp -r /mnt/hgfs/Data-shared/Archive/jdk-6u25-linux-i586.bin  cluster4:/home/grid/</p>
<p>再切root, copy到/usr/java下， cd /usr/java, 然后再安装.</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/hadoop/">hadoop</a></li></span></span> | <span class="tags">Tagged <a href="/tags/hadoop/" class="label label-primary">hadoop</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:36"datetime="2014-03-07 09:54:36"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-hadoop--基于Hadoop220的高可用性集群搭建步骤（64位）/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-hadoop--基于Hadoop220的高可用性集群搭建步骤（64位）" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-linux--linux之sort用法/">linux之sort用法</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:36.000Z"> <a href="/2014/02/02/2014-02-02-linux--linux之sort用法/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="linux-sort-">linux之sort用法</h1>
<p>sort命令是帮我们依据不同的数据类型进行排序，其语法及常用参数格式：
sort [-bcfMnrtk][源文件][-o 输出文件]
补充说明：sort可针对文本文件的内容，以行为单位来排序。</p>
<p>参　　数：
  -b   忽略每行前面开始出的空格字符。
  -c   检查文件是否已经按照顺序排序。
  -f   排序时，忽略大小写字母。
  -M   将前面3个字母依照月份的缩写进行排序。
  -n   依照数值的大小排序。
  -o&lt;输出文件&gt;   将排序后的结果存入指定的文件。
  -r   以相反的顺序来排序。
  -t&lt;分隔字符&gt;   指定排序时所用的栏位分隔字符。
  -k  选择以哪个区间进行排序。
  <del>~</del><del>~</del><del>~</del><del>~</del><del>~</del><del>~</del>~~~~</p>
<p>下面通过几个例子来讲述Sort的使用。
（1）sort将文件的每一行作为一个单位，相互比较，比较原则是从首字符向后，依次按ASCII码值进行比较，最后将他们按升序输出。</p>
<p>[rocrocket@rocrocket programming]$ cat seq.txt
banana
apple
pear
orange
[rocrocket@rocrocket programming]$ sort seq.txt
apple
banana
orange
pear</p>
<p>用户可以保存排序后的文件内容，或把排序后的文件内容输出至打印机。下例中用户把排序后的文件内容保存到名为result的文件中。
$ Sort seq.txt &gt; result</p>
<p>（2）sort的-u选项</p>
<p>它的作用很简单，就是在输出行中去除重复行。</p>
<p>[rocrocket@rocrocket programming]$ cat seq.txt
banana
apple
pear
orange
pear
[rocrocket@rocrocket programming]$ sort seq.txt
apple
banana
orange
pear
pear
[rocrocket@rocrocket programming]$ sort -u seq.txt
apple
banana
orange
pear</p>
<p>pear由于重复被-u选项无情的删除了。</p>
<p>（3）sort的-r选项</p>
<p>sort默认的排序方式是升序，如果想改成降序，就加个-r就搞定了。</p>
<p>[rocrocket@rocrocket programming]$ cat number.txt
1
3
5
2
4
[rocrocket@rocrocket programming]$ sort number.txt
1
2
3
4
5
[rocrocket@rocrocket programming]$ sort -r number.txt
5
4
3
2
1
（5）sort的-o选项</p>
<p>由于sort默认是把结果输出到标准输出，所以需要用重定向才能将结果写入文件，形如sort filename &gt; newfile。</p>
<p>但是，如果你想把排序结果输出到原文件中，用重定向可就不行了。</p>
<p>[rocrocket@rocrocket programming]$ sort -r number.txt &gt; number.txt
[rocrocket@rocrocket programming]$ cat number.txt
[rocrocket@rocrocket programming]$
看，竟然将number清空了。</p>
<p>就在这个时候，-o选项出现了，它成功的解决了这个问题，让你放心的将结果写入原文件。这或许也是-o比重定向的唯一优势所在。</p>
<p>[rocrocket@rocrocket programming]$ cat number.txt
1
3
5
2
4
[rocrocket@rocrocket programming]$ sort -r number.txt -o number.txt
[rocrocket@rocrocket programming]$ cat number.txt
5
4
3
2
1</p>
<p>（6） sort的-n选项</p>
<p>你有没有遇到过10比2小的情况。我反正遇到过。出现这种情况是由于排序程序将这些数字按字符来排序了，排序程序会先比较1和2，显然1小，所以就将10放在2前面喽。这也是sort的一贯作风。</p>
<p>我们如果想改变这种现状，就要使用-n选项，来告诉sort，“要以数值来排序”！</p>
<p>[rocrocket@rocrocket programming]$ cat number.txt
1
10
19
11
2
5
[rocrocket@rocrocket programming]$ sort number.txt
1
10
11
19
2
5
[rocrocket@rocrocket programming]$ sort -n number.txt
1
2
5
10
11
19</p>
<p>（7） sort的-t选项和-k选项</p>
<p>如果有一个文件的内容是这样：</p>
<p>[rocrocket@rocrocket programming]$ cat facebook.txt
banana:30:5.5
apple:10:2.5
pear:90:2.3
orange:20:3.4</p>
<p>这个文件有三列，列与列之间用冒号隔开了，第一列表示水果类型，第二列表示水果数量，第三列表示水果价格。那么我想以水果数量来排序，也就是以第二列来排序，如何利用sort实现？幸好，sort提供了-t选项，后面可以设定间隔符。指定了间隔符之后，就可以用-k来指定列数了。</p>
<p>[rocrocket@rocrocket programming]$ sort -n -k 2 -t ‘:’ facebook.txt
apple:10:2.5
orange:20:3.4
banana:30:5.5
pear:90:2.3</p>
<p>（8） 其他的sort常用选项</p>
<p>-f会将小写字母都转换为大写字母来进行比较，亦即忽略大小写</p>
<p>-c会检查文件是否已排好序，如果乱序，则输出第一个乱序的行的相关信息，最后返回1</p>
<p>-C会检查文件是否已排好序，如果乱序，不输出内容，仅返回1</p>
<p>-M会以月份来排序，比如JAN小于FEB等等</p>
<p>-b会忽略每一行前面的所有空白部分，从第一个可见字符开始比较。
来源： <a href="[http://www.cnblogs.com/dong008259/archive/2011/12/08/2281214.html](http://www.cnblogs.com/dong008259/archive/2011/12/08/2281214.html)">[http://www.cnblogs.com/dong008259/archive/2011/12/08/2281214.html](http://www.cnblogs.com/dong008259/archive/2011/12/08/2281214.html)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/linux/">linux</a></li></span></span> | <span class="tags">Tagged <a href="/tags/linux/" class="label label-primary">linux</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:36"datetime="2014-03-07 09:54:36"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-linux--linux之sort用法/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-linux--linux之sort用法" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-linux--很靠谱linux常用命令/">很靠谱linux常用命令</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:36.000Z"> <a href="/2014/02/02/2014-02-02-linux--很靠谱linux常用命令/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-linux-">很靠谱linux常用命令</h1>
<p>vim是打开vim编辑器，别的编辑器还有vi(功能没有vim 强大),nano，emacs等等，感觉还是vim最强大，其次是vi,别的就要差一些了。 我听我们老师说，用图形界面本身已经会被高手笑了，如果打开一个gpedit或者kwrite那就废了......
常用的命令
ls,列出当前目录下的文件，ls -l是列出详细信息，ls -a列出隐藏文件。
cd,更改目录。clear，清屏命令。reset，重置终端。
startx,启动图形界面。fdisk -l,查看硬盘分区。
ps aux，列出系统进程。cat,显示文本。tac,逆序显示文本。
od,二进制格式显示文本。wc,判断文件的大小行数和字符数等等。
aspell，检查文件中的拼写错误。less，分页读取文件。more，与less类似，但是功能不及less。
reboot，重启系统。poweroff，关机。halt，也是关机，但是需要手动切断电源，不推荐使用。shutdown -h now,立即关机，后面的now可以替换成时间，可以指定关机时间的指令，据说良好的系统管理员应该使用这个命令。shutdown -r now,与上一条类似，只不过是重启。sync，同步硬盘数据，重启或关机前应该多次使用。
locate，查询文件位置，每隔一段时间应该使用updatedb命令以提供搜索范围。find，强大的查询命令，参数众多。find / -name /<em>,这是查询/下所有文件的意思。
whereis，我用他来判断命令的所在位置，如whereis ls。
sudo，在普通帐户的情况下使用root权限，不过需要修改/etc/sudoers文件才可以。
mv，移动文件或者重命名。mv /etc//</em> /home/tom，是将/etc所有文件移动到tom目录下的意思。mv a b,把a重命名为b.当然，这只是个例子，具体操作的时候需要看具体情况进行判定。
cp,于mv类似，也是相同的格式，只不过不是移动，是复制。如果复制的是目录的话，需使用-r参数，cp -r /<em>/</em>/<em>.
rm,这是删除指令，与cp类似，删除目录添加-r,提示删除使用-i
useradd，添加一个新帐户。userdel，删除一个帐户。
passwd，为一个帐户设置密码。都有许多参数来实现其他功能。
chown，更改文件所属。如chown tom.tom 文件名，将文件改为所属组tom，所属者也是tom。
chmod,更改文件的权限，只说简单的改法，chmod 777 文件名，文件将有所有的权限。
chkconfig --list,用来观察服务状态，chkconfig --level ? 服务名 on/off,打开或者关闭服务，？代表运行级别。
init (1,2,3,4,5,6)用来在6个运行级别切换。
runlevel查看现在的运行级别。
bc，一个计算器。date，显示时间。cal显示日历。
如果是redhat的话，还有setup，用来设置一些系统相关，ntsysv，专门用来设置服务，这样就不用chkconfig了。
tr，压缩或者替换字符。dh，计算目录的大小。df，显示文件系统的信息。
free，显示内存cpu的时用情况。top，动态观察进程。
tar -czvf,创建/</em>.tar.gz压缩包，tar -xzvf,解压这种压缩包。
tar -cjvf,创建的是/*.tar.bz2,解压是tar -xjvf
rpm -ivh,安装rpm包，rpm -e卸载rpm包
who，观察登录情况。whoami，who am i，两条命令有一些区别，不过差不多。id，用来查看帐户的信息。w，也是查看登录情况的，更加详细。
echo,用来显示环境变量等等，例子echo $LANG。
history,显示命令历史。mount挂在设备。umount，卸载设备。dmesg，显示启动信息。yum，更新时用的命令。
ssh，ssh登录。telnet，telnet登录。还有ftp命令。
gcc,g++，java，javac，都是编程用的命令。make，如果有makefile的话，可以用他编译。 </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/linux/">linux</a></li></span></span> | <span class="tags">Tagged <a href="/tags/linux/" class="label label-primary">linux</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:36"datetime="2014-03-07 09:54:36"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-linux--很靠谱linux常用命令/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-linux--很靠谱linux常用命令" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/106/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/104/">104</a></li><li><a class="page-number" href="/page/105/">105</a></li><li><a class="page-number" href="/page/106/">106</a></li><li class="active"><li><span class="page-number current">107</span></li><li><a class="page-number" href="/page/108/">108</a></li><li><a class="page-number" href="/page/109/">109</a></li><li><a class="page-number" href="/page/110/">110</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/108/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 19:25:39</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
