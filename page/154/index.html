
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 154 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JS用法--一个javascriptvoid0引发的异常-Tech-JavaEye论坛/">一个javascriptvoid(0)引发的异常 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:28.000Z"> <a href="/2014/02/02/2014-02-02-JS用法--一个javascriptvoid0引发的异常-Tech-JavaEye论坛/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-javascriptvoid-0-tech-javaeye-">一个javascriptvoid(0)引发的异常 - Tech - JavaEye论坛</h1>
<p><a href="http://www.javaeye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.javaeye.com/all" target="_blank">我的应用</a> <a href="http://www.javaeye.com/login" target="_blank">登录</a> <a href="http://www.javaeye.com/signup" target="_blank">注册</a></p>
<p><a href="http://www.javaeye.com/" target="_blank"><img src="&quot;JavaEye-最棒的软件开发交流社区&quot;" alt="JavaEye-最棒的软件开发交流社区"></a></p>
<p><img src="" alt=""></p>
<p><a href="http://www.javaeye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.javaeye.com/forums/board/Tech" target="_blank">综合技术版</a> →</p>
<h1 id="-javascript-void-0-">一个javascript:void(0)引发的异常</h1>
<p><a href="http://www.javaeye.com/forums/board/Tech" target="_blank">全部</a> <a href="http://www.javaeye.com/forums/tag/Database" target="_blank">Database</a> <a href="http://www.javaeye.com/forums/tag/Haskell" target="_blank">Haskell</a> <a href="http://www.javaeye.com/forums/tag/Erlang" target="_blank">Erlang</a> <a href="http://www.javaeye.com/forums/tag/FP" target="_blank">FP</a> <a href="http://www.javaeye.com/forums/tag/Linux" target="_blank">Linux</a> <a href="http://www.javaeye.com/forums/tag/algorithm" target="_blank">数据结构和算法</a>
浏览 567 次 锁定老贴子 <a href="http://www.javaeye.com/topic/290261" target="_blank">主题：一个javascript:void(0)引发的异常</a></p>
<p>精华帖 (0) :: 良好帖 (0) :: 新手帖 (0) :: 隐藏帖 (0) 作者 正文 * classicbride</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://classicbride.javaeye.com/" target="_blank"><img src="&quot;classicbride的博客: classicbride&quot;" alt="classicbride的博客"></a></li>
<li>文章: 41</li>
<li>积分: 30</li>
<li>来自: 北京</li>
<li><img src="" alt="">
发表时间：2008-12-10</li>
</ul>
<p>相关文章: <a href="http://www.javaeye.com/topic/290261#" title="关闭" target="_blank"> </a></p>
<ul>
<li><a href="http://www.javaeye.com/topic/214030" title="Broken pipe　/  socket write error异常" target="_blank">Broken pipe　/ socket write error异常</a></li>
<li><a href="http://www.javaeye.com/topic/31800" title="ClientAbortException原因探究" target="_blank">ClientAbortException原因探究</a></li>
<li><a href="http://www.javaeye.com/topic/10392" title="确实冤枉好同志了" target="_blank">确实冤枉好同志了</a>
推荐圈子: <a href="http://jsfgroup.group.javaeye.com/" target="_blank">JSF</a>
<a href="http://www.javaeye.com/wiki/topic/290261" target="_blank">更多相关推荐</a>  当用户登陆时，需要用户输入验证码，在服务器端生成一张内存图像，写入response流中...
当用户点击“看不清楚，换成图片”时，利用javascript重新请求服务器端，生成新的图像... 到了这里万事大吉一切正常，在firefox下，IE7下都没有问题，但是在IE6下问题来了，无法刷新验证码，后台报错：
ClientAbortException:  java.net.SocketException: Connection reset by peer: socket write error
at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:319)
at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:288)
at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:98)
at javax.imageio.stream.FileCacheImageOutputStream.flushBefore(FileCacheImageOutputStream.java:212)
at javax.imageio.stream.ImageInputStreamImpl.flush(ImageInputStreamImpl.java:801)
at com.sun.imageio.plugins.jpeg.JPEGImageWriter.write(JPEGImageWriter.java:1002)
google半天，说法很多，有说是因为服务器端数据没有写完时，客户端就停止了引发的... 但一直找不到问题的根本原因，继续google，终于找到原因，首先看看偶的代码
<img id="codeImage" src="validateCode.action" border="0" /> <a id="getValidateCode" href="javascript:void(0);">重新获得验证码</a>
function flashValidateCode(){ var randomStr = random(); $(&quot;/#codeImage&quot;).get(0).src = &quot;validateCode.action?randomStr=&quot; + randomStr; } function random(){ return Math.round(Math.random() /* 10000); }
当用户有点击重新获取验证码时，我监听一个onclick事件，请求服务器生成新的图像，而我又写了href=&quot;javascript:void(0);&quot;
对了，问题就出在javascript:void(0)，<a></a>本身是一个超链接，它一个接受到了void(0)，就认为请求处理完毕了，垃圾IE6就停止了对服务器端的响应，就造成了上述的问题，所以将代码改成：
<img id="codeImage" src="validateCode.action" border="0" /> <a id="getValidateCode" href="/#">重新获得验证码</a>
就o了~ 吼吼~ 这个小问题折磨我很久，日~！！ 
声明：JavaEye文章版权属于作者，受法律保护。没有作者书面许可不得转载。</li>
</ul>
<p>推荐链接</p>
<ul>
<li><a href="http://www.javaeye.com/clicks/111" target="_blank"><img src="&quot;taobao，赢在淘宝&quot;" alt="taobao，赢在淘宝"></a> <a href="http://www.javaeye.com/topic/290261#" target="_blank">返回顶楼</a> <a href="http://classicbride.javaeye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://classicbride.javaeye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://app.javaeye.com/messages/new?message%5Breceiver_name%5D=classicbride" title="发送站内短信" target="_blank"> </a> <a href="http://classicbride.javaeye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> 最后修改：2008-12-10</li>
</ul>
<p><a href="http://www.javaeye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.javaeye.com/forums/board/Tech" target="_blank">综合技术版</a>
跳转论坛:Java编程和Java企业应用 Web前端技术：AJAX和RIA 移动编程和手机应用开发 C/C++编程 Ruby编程 Python编程 PHP编程 Flash编程 Microsoft .Net 综合技术 软件开发和项目管理 行业应用 入门讨论 招聘求职 海阔天空</p>
<ul>
<li><a href="http://www.javaeye.com/" target="_blank">首页</a></li>
<li><a href="http://www.javaeye.com/news" target="_blank">新闻</a></li>
<li><a href="http://www.javaeye.com/forums" target="_blank">论坛</a></li>
<li><a href="http://www.javaeye.com/ask" target="_blank">问答</a></li>
<li><a href="http://www.javaeye.com/wiki" target="_blank">知识库</a></li>
<li><a href="http://www.javaeye.com/blogs" target="_blank">博客</a></li>
<li><a href="http://www.javaeye.com/groups" target="_blank">圈子</a></li>
<li><a href="http://www.javaeye.com/hunters" target="_blank">猎头</a></li>
<li><a href="http://www.javaeye.com/job" target="_blank">招聘</a></li>
<li><a href="http://www.javaeye.com/index/service" target="_blank">服务</a></li>
<li><a href="http://www.javaeye.com/google_search" target="_blank">搜索</a></li>
<li><a href="http://java.javaeye.com/" target="_blank">Java</a></li>
<li><a href="http://webapp.javaeye.com/" target="_blank">Web</a></li>
<li><a href="http://ruby.javaeye.com/" target="_blank">Ruby</a></li>
<li><a href="http://python.javaeye.com/" target="_blank">Python</a></li>
<li><a href="http://agile.javaeye.com/" target="_blank">敏捷</a></li>
<li><a href="http://mysql.javaeye.com/" target="_blank">MySQL</a></li>
<li><a href="http://primeton.javaeye.com/" target="_blank">普元</a></li>
<li><a href="http://dorado.javaeye.com/" target="_blank">Dorado</a></li>
<li><a href="http://kingdee.javaeye.com/" target="_blank">金蝶中间件</a></li>
<li><a href="http://book.javaeye.com/" target="_blank">图书</a></li>
<li><a href="http://www.javaeye.com/index/service" target="_blank">广告服务</a></li>
<li><a href="http://webmaster.javaeye.com/" target="_blank">JavaEye黑板报</a></li>
<li><a href="http://www.javaeye.com/index/aboutus" target="_blank">关于我们</a></li>
<li><a href="http://www.javaeye.com/index/contactus" target="_blank">联系我们</a></li>
<li><a href="http://www.javaeye.com/index/friend_links" target="_blank">友情链接</a></li>
</ul>
<p>© 2003-2009 JavaEye.com. All rights reserved. [ 沪ICP备05023328号 ]</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/JS用法/">JS用法</a></li></span></span> | <span class="tags">Tagged <a href="/tags/JS用法/" class="label label-primary">JS用法</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:28"datetime="2014-03-07 09:54:28"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JS用法--一个javascriptvoid0引发的异常-Tech-JavaEye论坛/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JS用法--一个javascriptvoid0引发的异常-Tech-JavaEye论坛" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JS用法--»javascript在ie和firefox下的一些差异-某人的栖息地/">» javascript在ie和firefox下的一些差异 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:28.000Z"> <a href="/2014/02/02/2014-02-02-JS用法--»javascript在ie和firefox下的一些差异-某人的栖息地/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-javascript-ie-firefox-">» javascript在ie和firefox下的一些差异 - 某人的栖息地</h1>
<h1 id="-http-www-ooso-net-"><a href="http://www.ooso.net/" target="_blank">某人的栖息地</a></h1>
<p>« <a href="http://www.ooso.net/archives/364" target="_blank">PriadoBlender可支持php-gtk2</a></p>
<p><a href="http://www.ooso.net/archives/366" target="_blank">MySQL Proxy的Alpha版本发布</a> »</p>
<h2 id="-javascript-ie-firefox-http-www-ooso-net-archives-362-permanent-link-to-javascript-ie-firefox-"><a href="http://www.ooso.net/archives/362" title="Permanent link to javascript在ie和firefox下的一些差异" target="_blank">javascript在ie和firefox下的一些差异</a></h2>
<p>2007-07-31 @ 08:40:30 · 作者 <a href="http://www.ooso.net/archives/author/volcano/" title="Posts by Volcano" target="_blank">Volcano</a> · 归类于 <a href="http://www.ooso.net/category/firefox" title="View all posts in FIREFOX" target="_blank">FIREFOX</a>, <a href="http://www.ooso.net/category/javascript" title="View all posts in JAVASCRIPT" target="_blank">JAVASCRIPT</a></p>
<h2 id="-">你可能会感兴趣的内容</h2>
<ul>
<li><a href="http://www.ooso.net/archives/417" title="jQuerify书签" target="_blank">jQuerify书签</a></li>
<li><a href="http://www.ooso.net/archives/400" title="用greasemonkey生成土豆的豆单下载清单" target="_blank">用greasemonkey生成土豆的豆单下载清单</a></li>
<li><a href="http://www.ooso.net/archives/302" title="用来看新浪新闻的greasemonkey脚本" target="_blank">用来看新浪新闻的greasemonkey脚本</a></li>
<li><a href="http://www.ooso.net/archives/268" title="Firebug 1.0 beta is out" target="_blank">Firebug 1.0 beta is out</a></li>
<li><a href="http://www.ooso.net/archives/254" title="检测javascript的内存泄漏" target="_blank">检测javascript的内存泄漏</a></li>
</ul>
<p>javascript在ie和<a href="http://www.ooso.net/index.php?tag=firefox" target="_blank">firefox</a>下,运行结果有一些差异。下面把最近碰到的情况做个记录，以后也会不断补充以备忘。</p>
<h2 id="object-">object操作</h2>
<ul>
<li>firefox:可支持</li>
</ul>
<p><a href="http://www.ooso.net/archives/362#" target="_blank">PLAIN TEXT</a>
CODE:</p>
<ol>
<li>var obj = { &#39;key&#39; : &#39;aaa&#39;, }</li>
<li>ie:不支持</li>
</ol>
<p><a href="http://www.ooso.net/archives/362#" target="_blank">PLAIN TEXT</a>
CODE:</p>
<ol>
<li>var obj = { &#39;key&#39; : &#39;aaa&#39;, }</li>
</ol>
<p>会报javascript错误,最后的&quot;<strong>,</strong>&quot;必须去掉</p>
<h2 id="-javascript-http-www-ooso-net-index-php-tag-javascript-select-option-"><a href="http://www.ooso.net/index.php?tag=javascript" target="_blank">javascript</a>对select元素的option操作</h2>
<ol>
<li>firefox:可直接设置</li>
</ol>
<p><a href="http://www.ooso.net/archives/362#" target="_blank">PLAIN TEXT</a>
CODE:</p>
<ol>
<li>option.text = &#39;foooooooo&#39;;</li>
<li>ie:只能设置</li>
</ol>
<p><a href="http://www.ooso.net/archives/362#" target="_blank">PLAIN TEXT</a>
CODE:</p>
<ol>
<li>option.innerHTML = &#39;fooooooo&#39;;</li>
</ol>
<h2 id="-select-option">删除一个select的option</h2>
<ol>
<li>firefox:可以</li>
</ol>
<p><a href="http://www.ooso.net/archives/362#" target="_blank">PLAIN TEXT</a>
CODE:</p>
<ol>
<li>select.options.remove(selectedIndex);</li>
<li>ie7:可以用</li>
</ol>
<p><a href="http://www.ooso.net/archives/362#" target="_blank">PLAIN TEXT</a>
CODE:</p>
<ol>
<li>select.options[i] = null;</li>
<li>ie6:需要写</li>
</ol>
<p><a href="http://www.ooso.net/archives/362#" target="_blank">PLAIN TEXT</a>
CODE:</p>
<ol>
<li>select.options[i].outerHTML = null;</li>
</ol>
<p>真是万恶的浏览器。</p>
<p>作者: <a href="http://www.ooso.net/archives/author/volcano/" title="Posts by Volcano" target="_blank">Volcano</a> 发表于July 31, 2007 at 8:40 am</p>
<p><a href="http://creativecommons.org/licenses/by/3.0/deed.zh" target="_blank">版权信息</a>: <strong>可以任意转载, 转载时请务必以超链接形式标明文章<a href="http://www.ooso.net/archives/362" target="_blank">原始出处</a>和<a href="http://www.ooso.net/" target="_blank">作者信息</a>及此声明</strong></p>
<p><a href="http://www.ooso.net/archives/362" title="永久链接到 javascript在ie和firefox下的一些差异" target="_blank">永久链接 - <a href="http://www.ooso.net/archives/362">http://www.ooso.net/archives/362</a></a></p>
<h3 id="tags-firefox-http-www-ooso-net-tag-firefox-ie-http-www-ooso-net-tag-ie-javascript-http-www-ooso-net-tag-javascript-">Tags: <a href="http://www.ooso.net/tag/firefox" target="_blank">FIREFOX</a>,<a href="http://www.ooso.net/tag/ie" target="_blank">ie</a>,<a href="http://www.ooso.net/tag/javascript" target="_blank">JAVASCRIPT</a></h3>
<h2 id="4-http-www-ooso-net-archives-362-postcomment-">4 条评论 <a href="http://www.ooso.net/archives/362#postcomment" title="跳转到评论表单" target="_blank">»</a></h2>
<ol>
<li><img src="" alt=""></li>
</ol>
<h3 id="-perfectworks-http-www-ttyc-com-cn-2007-07-31-13-08-25-http-www-ooso-net-archives-362-comment-14274-"><a href="http://www.ttyc.com.cn/" target="_blank">PerfectWorks</a> 于 2007-07-31 @ 13:08:25 <a href="http://www.ooso.net/archives/362#comment-14274" title="永久链接到本条评论" target="_blank">留言</a>：</h3>
<p>浏览器确实让人很头疼
昨天调试一个程序FF正常IE报错，是因为一个参数列表
opintions = {
opt1 = var1,
}
后面的那个逗号，IE解析不正常……
调试了半小时</p>
<ol>
<li><img src="" alt=""></li>
</ol>
<h3 id="-volcano-http-www-ooso-net-2007-07-31-14-18-00-http-www-ooso-net-archives-362-comment-14276-"><a href="http://www.ooso.net/" target="_blank">volcano</a> 于 2007-07-31 @ 14:18:00 <a href="http://www.ooso.net/archives/362#comment-14276" title="永久链接到本条评论" target="_blank">留言</a>：</h3>
<p>感谢补充，我以前也碰到过，只是这会没想起来。</p>
<ol>
<li><img src="" alt=""></li>
</ol>
<h3 id="-http-3rgb-com-2007-11-24-11-41-17-http-www-ooso-net-archives-362-comment-17901-"><a href="http://3rgb.com/" target="_blank">柠檬园主</a> 于 2007-11-24 @ 11:41:17 <a href="http://www.ooso.net/archives/362#comment-17901" title="永久链接到本条评论" target="_blank">留言</a>：</h3>
<p>所以说，还是用一些好的JS类库省事一些。比如jQuery。
但IE确实是在JS方面恶心到家了，最近在做的一个项目要大量用到JS，
很多时候都是FF不报错的情况下，IE一个劲错，原因是经常少个；之类的。。。。莫名。。。。</p>
<ol>
<li><img src="" alt=""></li>
</ol>
<h3 id="-http-www-qbencao-com-2008-04-18-10-25-14-http-www-ooso-net-archives-362-comment-22182-"><a href="http://www.qbencao.com/" target="_blank">阿草哥</a> 于 2008-04-18 @ 10:25:14 <a href="http://www.ooso.net/archives/362#comment-22182" title="永久链接到本条评论" target="_blank">留言</a>：</h3>
<p>这些差异真的郁闷啊 有的开发者平时做的时候只用了IE 到时候发布测试才发现ff也不行 回头再改</p>
<p><a href="http://www.ooso.net/archives/362/feed" target="_blank">RSS 为此帖反馈评论</a> · <a href="http://www.ooso.net/archives/362/trackback" target="_blank">反向跟踪 网站</a></p>
<h2 id="-">留条评论</h2>
<p>作者 (required)</p>
<p>邮箱 (required)</p>
<p>网站</p>
<ul>
<li><h2 id="search">Search</h2>
</li>
<li><h2 id="-">本站其它搜索结果</h2>
</li>
<li><h2 id="-">分类</h2>
</li>
<li><p><a href="http://www.ooso.net/category/ajax" title="View all posts filed under AJAX" target="_blank">AJAX</a></p>
</li>
<li><a href="http://www.ooso.net/category/common" title="View all posts filed under COMMON" target="_blank">COMMON</a></li>
<li><a href="http://www.ooso.net/category/firefox" title="View all posts filed under FIREFOX" target="_blank">FIREFOX</a></li>
<li><a href="http://www.ooso.net/category/flash" title="View all posts filed under FLASH" target="_blank">FLASH</a></li>
<li><a href="http://www.ooso.net/category/google" title="View all posts filed under GOOGLE" target="_blank">GOOGLE</a></li>
<li><a href="http://www.ooso.net/category/javascript" title="View all posts filed under JAVASCRIPT" target="_blank">JAVASCRIPT</a></li>
<li><a href="http://www.ooso.net/category/mysql" title="View all posts filed under MYSQL" target="_blank">MYSQL</a></li>
<li><a href="http://www.ooso.net/category/pear" title="View all posts filed under PEAR" target="_blank">PEAR</a></li>
<li><a href="http://www.ooso.net/category/php" title="View all posts filed under PHP" target="_blank">PHP</a></li>
<li><a href="http://www.ooso.net/category/wordpress" title="View all posts filed under WORDPRESS" target="_blank">WORDPRESS</a></li>
<li><h2 id="-">谁来过这里</h2>
</li>
<li><h2 id="meta">Meta</h2>
</li>
<li><p><a href="http://www.ooso.net/wp-login.php" target="_blank">Log in</a></p>
</li>
<li><a href="http://feed.ooso.net/" title="Syndicate this site using RSS" target="_blank">RSS Feed</a></li>
<li><a href="https://friendfeed.com/diablo" target="_blank">Friendfeed</a></li>
<li><a href="http://www.zhuaxia.com/add_channel.php?url=http%3A//feed.ooso.net" target="_blank">订阅到 抓虾</a></li>
<li><a href="http://www.xianguo.com/subscribe.php?url=http%3A//feed.ooso.net" target="_blank">订阅到 鲜果</a></li>
<li><a href="http://www.google.com/reader/preview/*/feed/http://feed.ooso.net" target="_blank">订阅到 Google Reader</a>
*</li>
</ul>
<p>Powered by <a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform." target="_blank"><strong>WordPress</strong></a>
Copyright © 2002 - 2008 ooso.net</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/JS用法/">JS用法</a></li></span></span> | <span class="tags">Tagged <a href="/tags/JS用法/" class="label label-primary">JS用法</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:28"datetime="2014-03-07 09:54:28"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JS用法--»javascript在ie和firefox下的一些差异-某人的栖息地/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JS用法--»javascript在ie和firefox下的一些差异-某人的栖息地" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JS用法--JSURL传中文参数引发的乱码问题_javascript技巧_脚本之家/">JS URL传中文参数引发的乱码问题_javascript技巧_脚本之家</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:28.000Z"> <a href="/2014/02/02/2014-02-02-JS用法--JSURL传中文参数引发的乱码问题_javascript技巧_脚本之家/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="js-url-_javascript-_-">JS URL传中文参数引发的乱码问题<em>javascript技巧</em>脚本之家</h1>
<p>脚 本 之 家 www.jb51.net</p>
<ul>
<li><a href="http://www.jb51.net/codes/index.html" target="_blank">源码下载</a></li>
<li><a href="http://www.jb51.net/softs/index.html" target="_blank">软件下载</a></li>
<li><a href="http://www.jb51.net/s.htm" target="_blank">服务器常用软件</a></li>
<li><a href="http://www.jb51.net/new/new_1.htm" target="_blank">最近更新</a></li>
<li><a href="">繁体中文</a></li>
</ul>
<p><a href="http://www.jb51.net/" title="脚本之家" target="_blank"><img src="" alt="脚本之家"></a></p>
<ul>
<li><a href="http://www.jb51.net/" target="_blank">首页</a></li>
<li><a href="http://www.jb51.net/web/index.html" title="网页制作" target="_blank">网页制作</a></li>
<li><a href="http://www.jb51.net/list/index_96.htm" title="脚本专栏" target="_blank">脚本专栏</a></li>
<li><a href="http://www.jb51.net/list/index_1.htm" title="网络编程" target="_blank">网络编程</a></li>
<li><a href="http://www.jb51.net/list/index_104.htm" title="数据库" target="_blank">数据库</a></li>
<li><a href="http://www.jb51.net/jiaoben/index.html" title="脚本下载" target="_blank">脚本下载</a></li>
<li><a href="http://www.jb51.net/cms/index.html" title="cms使用教程" target="_blank">程序教学</a></li>
<li><a href="http://www.jb51.net/books/index.html" title="电子书籍" target="_blank">电子书籍</a></li>
<li><a href="http://www.jb51.net/pingmian/index.html" title="平面设计" target="_blank">平面设计</a></li>
<li><a href="http://www.jb51.net/media/index.html" title="媒体动画" target="_blank">媒体动画</a></li>
<li><a href="http://www.jb51.net/moban/index.html" title="模板下载" target="_blank">模板下载</a></li>
<li><a href="http://www.jb51.net/os/index.html" title="操作系统" target="_blank">操作系统</a></li>
<li><p><a href="http://www.jb51.net/yunying/index.html" title="网站运营" target="_blank">网站运营</a></p>
</li>
<li><p><a href="http://www.cnkuai.cn/GetSpace.htm" title="主机租用,服务器租用,主机托管,服务器托管" target="_blank"><strong>主机租用</strong></a></p>
</li>
<li><a href="http://www.cnkuai.cn/domain.htm" title="域名查询,域名注册,域名申请,域名" target="_blank"><strong>域名查询</strong></a></li>
<li><a href="http://www.jb51.net/list/list_61_1.htm" title="基础知识" target="_blank">基础知识</a></li>
<li><a href="http://www.jb51.net/list/list_23_1.htm" title="javascript类库" target="_blank">javascript类库</a></li>
<li><a href="http://www.jb51.net/list/list_22_1.htm" title="表单特效" target="_blank">表单特效</a></li>
<li><a href="http://www.jb51.net/list/list_18_1.htm" title="广告代码" target="_blank">广告代码</a></li>
<li><a href="http://www.jb51.net/list/list_43_1.htm" title="网页特效" target="_blank">网页特效</a></li>
<li><a href="http://www.jb51.net/list/list_26_1.htm" title="黑客性质" target="_blank">黑客性质</a></li>
<li><a href="http://www.jb51.net/list/list_222_1.htm" title="javascript技巧" target="_blank">javascript技巧</a>
页面导航： <a href="http://www.jb51.net/index.htm" target="_blank">首页</a> → <a href="http://www.jb51.net/list/index_1.htm" title="网络编程" target="_blank">网络编程</a> → <a href="http://www.jb51.net/list/list_3_1.htm" title="JavaScript" target="_blank">JavaScript</a> → <a href="http://www.jb51.net/list/list_222_1.htm" title="javascript技巧" target="_blank">javascript技巧</a> → 正文内容 url中文参数 乱码</li>
</ul>
<h1 id="js-url-">JS URL传中文参数引发的乱码问题</h1>
<p>发布：dxy 字体：[<a href="">增加</a> <a href="">减小</a>] 类型：转载</p>
<p>今天的项目中碰到了一个乱码问题，从JS里传URL到服务器，URL中有中文参数，服务器里读出的中文参数来的全是“？”，查了网上JS编码相关资料得以解决。
解决方法如下：
1、在JS里对中文参数进行两次转码
复制代码 代码如下:</p>
<p>var login_name = document.getElementById(&quot;loginname&quot;).value;
login_name = encodeURI(login_name);
login_name = encodeURI(login_name);
2、在服务器端对参数进行解码
复制代码 代码如下:</p>
<p>String loginName = ParamUtil.getString(request, &quot;login_name&quot;);
loginName = java.net.URLDecoder.decode(loginName,&quot;UTF-8&quot;);
在使用url进行参数传递时，经常会传递一些中文名的参数或URL地址，在后台处理时会发生转换错误。在有些传递页面使用GB2312，而在接收页面使用UTF8，这样接收到的参数就可能会与原来发生不一致。使用服务器端的urlEncode函数编码的URL，与使用客户端javascript的encodeURI函数编码的URL，结果就不一样。
javaScript中的编码方法：
escape() 方法：
采用ISO Latin字符集对指定的字符串进行编码。所有的空格符、标点符号、特殊字符以及其他非ASCII字符都将被转化成%xx格式的字符编码（xx等于该字符在字符集表里面的编码的16进制数字）。比如，空格符对应的编码是%20。unescape方法与此相反。不会被此方法编码的字符： @ /<em> / +
英文解释：MSDN JScript Reference: The escape method returns a string value (in Unicode format) that contains the contents of [the argument]. All spaces, punctuation, accented characters, and any other non-ASCII characters are replaced with %xx encoding, where xx is equivalent to the hexadecimal number representing the character. For example, a space is returned as &quot;%20.&quot;
Edge Core Javascript Guide: The escape and unescape functions let you encode and decode strings. The escape function returns the hexadecimal encoding of an argument in the ISO Latin character set. The unescape function returns the ASCII string for the specified hexadecimal encoding value.
encodeURI() 方法：把URI字符串采用UTF-8编码格式转化成escape格式的字符串。不会被此方法编码的字符：! @ /# $&amp; /</em> ( ) = : / ; ? + &#39;
英文解释：MSDN JScript Reference: The encodeURI method returns an encoded URI. If you pass the result to decodeURI, the original string is returned. The encodeURI method does not encode the following characters: &quot;:&quot;, &quot;/&quot;, &quot;;&quot;, and &quot;?&quot;. Use encodeURIComponent to encode these characters. Edge Core Javascript Guide: Encodes a Uniform Resource Identifier (URI) by replacing each instance of certain characters by one, two, or three escape sequences representing the UTF-8 encoding of the character
encodeURIComponent() 方法：把URI字符串采用UTF-8编码格式转化成escape格式的字符串。与encodeURI()相比，这个方法将对更多的字符进行编码，比如 / 等字符。所以如果字符串里面包含了URI的几个部分的话，不能用这个方法来进行编码，否则 / 字符被编码之后URL将显示错误。不会被此方法编码的字符：! /* ( )
英文解释：MSDN JScript Reference: The encodeURIComponent method returns an encoded URI. If you pass the result to decodeURIComponent, the original string is returned. Because the encodeURIComponent method encodes all characters, be careful if the string represents a path such as /folder1/folder2/default.html. The slash characters will be encoded and will not be valid if sent as a request to a web server. Use the encodeURI method if the string contains more than a single URI component. Mozilla Developer Core Javascript Guide： Encodes a Uniform Resource Identifier (URI) component by replacing each instance of certain characters by one, two, or three escape sequences representing the UTF-8 encoding of the character.
因此，对于中文字符串来说，如果不希望把字符串编码格式转化成UTF-8格式的（比如原页面和目标页面的charset是一致的时候），只需要使用escape。如果你的页面是GB2312或者其他的编码，而接受参数的页面是UTF-8编码的，就要采用encodeURI或者encodeURIComponent。
另外，encodeURI/encodeURIComponent是在javascript1.5之后引进的，escape则在javascript1.0版本就有。
英文注释：The escape() method does not encode the + character which is interpreted as a space on the server side as well as generated by forms with spaces in their fields. Due to this shortcoming, you should avoid use of escape() whenever possible. The best alternative is usually encodeURIComponent().Use of the encodeURI() method is a bit more specialized than escape() in that it encodes for URIs [REF] as opposed to the querystring, which is part of a URL. Use this method when you need to encode a string to be used for any resource that uses URIs and needs certain characters to remain un-encoded. Note that this method does not encode the &#39; character, as it is a valid character within URIs.Lastly, the encodeURIComponent() method should be used in most cases when encoding a single component of a URI. This method will encode certain chars that would normally be recognized as special chars for URIs so that many components may be included. Note that this method does not encode the &#39; character, as it is a valid character within URIs.</p>
<p><strong>Tags：</strong><a href="http://img.jb51.net/tag/url/1.htm" title="搜索关于url的文章" target="_blank">url</a> <a href="http://img.jb51.net/tag/ÖÐÎÄ²ÎÊý/1.htm" title="搜索关于中文参数的文章" target="_blank">中文参数</a> <a href="http://img.jb51.net/tag/ÂÒÂë/1.htm" title="搜索关于乱码的文章" target="_blank">乱码</a>
<a href="&quot;复制本文链接发给你QQ/MSN上的好友&quot;">复制链接发给好友</a><a href="">收藏本文</a><a href="">打印本文</a><a href="">关闭本文</a><a href="http://www.jb51.net/index.htm" target="_blank">返回首页</a></p>
<p>上一篇：<a href="http://www.jb51.net/article/19845.htm" title="FF IE兼容性的修改小结" target="_blank">FF IE兼容性的修改小结</a></p>
<p>下一篇：<a href="http://www.jb51.net/article/21463.htm" target="_blank">Javascript 中介者模式实例</a></p>
<h2 id="-">同类文章</h2>
<ul>
<li><a href="http://www.jb51.net/article/19448.htm" title="Javascript 学习笔记 错误处理" target="_blank">Javascript 学习笔记 错误处理</a></li>
<li><a href="http://www.jb51.net/article/21210.htm" title="IE与firefox下Dhtml的一些区别小结" target="_blank">IE与firefox下Dhtml的一些区别小结</a></li>
<li><a href="http://www.jb51.net/article/4908.htm" title="js变量作用域及可访问性的探讨" target="_blank">js变量作用域及可访问性的探讨</a></li>
<li><a href="http://www.jb51.net/article/17662.htm" title="javascript 表格排序和表头浮动效果(扩展SortTable)" target="_blank">javascript 表格排序和表头浮动效果(扩展SortTab</a></li>
<li><a href="http://www.jb51.net/article/18465.htm" title="javascript 冒号 使用说明" target="_blank">javascript 冒号 使用说明</a></li>
<li><a href="http://www.jb51.net/article/15353.htm" title="效率高的Javscript字符串替换函数的benchmark" target="_blank">效率高的Javscript字符串替换函数的benchmark</a></li>
<li><a href="http://www.jb51.net/article/18398.htm" title="Javascript 获取字符串字节数的多种方法" target="_blank">Javascript 获取字符串字节数的多种方法</a></li>
<li><a href="http://www.jb51.net/article/20450.htm" title="简单的加密css地址防止别人下载你的CSS文件的方法" target="_blank">简单的加密css地址防止别人下载你的CSS文件的方法</a></li>
<li><a href="http://www.jb51.net/article/14972.htm" title="教你如何解密js/vbs/vbscript加密的编码异处理小结" target="_blank">教你如何解密js/vbs/vbscript加密的编码异处理小</a></li>
<li><a href="http://www.jb51.net/article/10638.htm" title="服务器安全设置的几个注册表设置" target="_blank">服务器安全设置的几个注册表设置</a></li>
<li><a href="http://www.jb51.net/article/16706.htm" title="js 深拷贝函数" target="_blank">js 深拷贝函数</a></li>
<li><a href="http://www.jb51.net/article/15676.htm" title="js实现右下角窗口弹出窗口效果" target="_blank">js实现右下角窗口弹出窗口效果</a></li>
<li><a href="http://www.jb51.net/article/13086.htm" title="JS的递增/递减运算符和带操作的赋值运算符的等价式" target="_blank">JS的递增/递减运算符和带操作的赋值运算符的等价</a></li>
<li><a href="http://www.jb51.net/article/587.htm" title="如何用JS取得网址中的文件名" target="_blank">如何用JS取得网址中的文件名</a></li>
<li><a href="http://www.jb51.net/article/21326.htm" title="javascript 支持页码格式的分页类" target="_blank">javascript 支持页码格式的分页类</a></li>
<li><a href="http://www.jb51.net/article/14733.htm" title="javascript模仿msgbox提示效果代码" target="_blank">javascript模仿msgbox提示效果代码</a></li>
</ul>
<h2 id="-">文章评论</h2>
<p>共有 <em>**</em>位脚本之家网友发表了评论<a href="http://img.jb51.net/comment.asp?id=19850" target="_blank">我来说两句</a></p>
<h3 id="-">最 近 更 新</h3>
<ul>
<li><a href="http://www.jb51.net/article/13345.htm" title="javascript 点击整页变灰的效果（可做退出效果）。" target="_blank">javascript 点击整页变灰的效果（可做退出</a></li>
<li><a href="http://www.jb51.net/article/4870.htm" title="使两个iframe的高度与内容自适应,且相等" target="_blank">使两个iframe的高度与内容自适应,且相等</a></li>
<li><a href="http://www.jb51.net/article/17070.htm" title="javascript 自动转到命名锚记" target="_blank">javascript 自动转到命名锚记</a></li>
<li><a href="http://www.jb51.net/article/20880.htm" title="Javascript 定时器调用传递参数的方法" target="_blank">Javascript 定时器调用传递参数的方法</a></li>
<li><a href="http://www.jb51.net/article/592.htm" title="无间断滚动marquee的详细用法解析" target="_blank">无间断滚动marquee的详细用法解析</a></li>
<li><a href="http://www.jb51.net/article/6605.htm" title="Js之软键盘实现(js源码)" target="_blank">Js之软键盘实现(js源码)</a></li>
<li><a href="http://www.jb51.net/article/2835.htm" title="document.createRange实例" target="_blank">document.createRange实例</a></li>
<li><a href="http://www.jb51.net/article/18800.htm" title="javascript 连连看代码出炉" target="_blank">javascript 连连看代码出炉</a></li>
<li><a href="http://www.jb51.net/article/14718.htm" title="JavaScript容错例外处理" target="_blank">JavaScript容错例外处理</a></li>
<li><p><a href="http://www.jb51.net/article/14274.htm" title="js实现双击单元格变成文本输入框效果代码" target="_blank">js实现双击单元格变成文本输入框效果代码</a></p>
<h3 id="-">热 点 排 行</h3>
</li>
<li><p><a href="http://www.jb51.net/article/16884.htm" title="清除网页历史记录，屏蔽后退按钮!" target="_blank">清除网页历史记录，屏蔽后退按钮</a></p>
</li>
<li><a href="http://www.jb51.net/article/14397.htm" title="js刷新页面方法大全" target="_blank">js刷新页面方法大全</a></li>
<li><a href="http://www.jb51.net/article/425.htm" title="Div+CSS+JS树型菜单，可刷新" target="_blank">Div+CSS+JS树型菜单，可刷新</a></li>
<li><a href="http://www.jb51.net/article/9705.htm" title="eval(function(p,a,c,k,e,d)系列解密javascript程序" target="_blank">eval(function(p,a,c,k,e,d)系列</a></li>
<li><a href="http://www.jb51.net/article/13051.htm" title="JavaScript 节点操作 以及DOMDocument属性和方法" target="_blank">JavaScript 节点操作 以及DOMDoc</a></li>
<li><a href="http://www.jb51.net/article/7508.htm" title="JavaScript实现Sleep函数的代码" target="_blank">JavaScript实现Sleep函数的代码</a></li>
<li><a href="http://www.jb51.net/article/583.htm" title="javascript小技巧  超强推荐" target="_blank">javascript小技巧 超强推荐</a></li>
<li><a href="http://www.jb51.net/article/14178.htm" title="JavaScript修改css样式style" target="_blank">JavaScript修改css样式style</a></li>
<li><a href="http://www.jb51.net/article/1335.htm" title="在线游戏大家来找茬II" target="_blank">在线游戏大家来找茬II</a></li>
<li><a href="http://www.jb51.net/article/9386.htm" title="身份证号码前六位所代表的省,市,区, 以及地区编码下载" target="_blank">身份证号码前六位所代表的省,市,</a></li>
</ul>
<p><a href="http://www.jb51.net/about.htm" target="_blank">关于本站</a> - <a href="http://www.jb51.net/support.htm" target="_blank">广告合作</a> - <a href="http://www.jb51.net/linkus.htm" target="_blank">联系我们</a> - <a href="http://www.jb51.net/sm.htm" target="_blank">免责声明</a> - <a href="http://www.jb51.net/sitemap.htm" target="_blank">网站地图</a> - <a href="http://www.jb51.net/do/plus/guestbook/index.php" target="_blank">意见反馈</a> - <a href="http://www.jb51.net/article/19850.htm#top" target="_blank">返回顶部</a></p>
<p>欢迎转载我们的原创作品，转载请注明出处。<a href="http://www.miibeian.gov.cn/" target="_blank">苏ICP备06043639号</a>
Copyright © 2006-2010 www.jb51.net online services. All rights reserved. .
QQ群1:14624678 QQ群2:36345889或业务QQ:461478385</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/JS用法/">JS用法</a></li></span></span> | <span class="tags">Tagged <a href="/tags/JS用法/" class="label label-primary">JS用法</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:28"datetime="2014-03-07 09:54:28"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JS用法--JSURL传中文参数引发的乱码问题_javascript技巧_脚本之家/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JS用法--JSURL传中文参数引发的乱码问题_javascript技巧_脚本之家" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JS用法--FusionChartsFREE-XMLStructure/">FusionCharts FREE </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:28.000Z"> <a href="/2014/02/02/2014-02-02-JS用法--FusionChartsFREE-XMLStructure/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="fusioncharts-free-xml-structure">FusionCharts FREE - XML Structure</h1>
<p>Candlestick Chart Specification Sheet
SWF: FCF_Candlestick.swf
<img src="" alt=""> A general XML document for the candlestick chart looks as under:  <graph caption='3 Months - As on 04/02/04' yaXisMinValue='89' yaXisMaxValue='102' canvasBorderColor='DAE1E8' canvasBgColor='FFFFFF' bgColor='EEF2FB' numDivLines='12' divLineColor='DAE1E8' decimalPrecision='1' numberPrefix='$' showNames='1' bearBorderColor='E33C3C' bearFillColor='E33C3C' bullBorderColor='1F3165' baseFontColor='444C60' outCnvBaseFontColor='444C60' hoverCapBorderColor='DAE1E8' hoverCapBgColor='FFFFFF' rotateNames='0' ></p>
<p><categories font='Verdana' fontSize='10' fontColor='000000' verticalLineColor='' verticalLineThickness='1' verticalLineAlpha='100'></p>
<p><category Name='2004' xIndex='1' showLine='1'/></p>
<p><category Name='Feb' xIndex='31' showLine='1'/></p>
<p><category Name='March' xIndex='59' showLine='1'/></p>
<p><category Name='Split' xIndex='44' showLine='1'/>
</categories>
<data></p>
<p><set open='92.57' high='93.79' low='92.45' close='93.39' xIndex='1' /></p>
<p><set open='92.4' high='92.7' low='91.42' close='92.45' xIndex='2' /></p>
<p><set open='92.6' high='92.69' low='90.88' close='91.82' xIndex='3'/></p>
<p><set open='92' high='93.38' low='91.68' close='93.3' xIndex='4'/></p>
<p><set open='92' high='92.98' low='91.15' close='91.21' xIndex='5'/>
<em><!-- More Data Here --></em></p>
<p><set open='93.23' high='93.25' low='92.67' close='93.14' xIndex='60'/></p>
<p><set open='93' high='93.38' low='92.5' close='92.73' xIndex='61'/></p>
<p><set open='93.85' high='93.87' low='92.85' close='93.4' xIndex='62'/>
</data></p>
<p><trendLines></p>
<p><line startValue='89.5' endValue='98' color='FF0000' displayvalue='Roll. Avg.' thickness='2' alpha='100' isTrendZone='0'/>
</trendLines>
</graph> As you can see in the above XML document, there are basically four sections of data:</p>
<ol>
<li><graph> section - This section helps you set the various visual attributes for the chart apart from a few other numerical attributes.</li>
<li><categories> section - This section of data lets you create the textual categories to be displayed on the chart. It also helps you configure the category vertical lines and their formatting.</li>
<li><data> section - This is the actual section where you define your financial data.</li>
<li><trendLines> section - This section helps you set the trend lines on the chart.</li>
</ol>
<p>Let&#39;s now see each of them in detail. <graph> Attributes of the <graph> element help you set the visual looks of the chart and a few functional parameters. Here we&#39;ll group those attributes by their parent chart element and then look at it.</p>
<p>Graph Properties</p>
<ul>
<li>bgColor=&quot;HexColorCode&quot; : This attribute helps you set the background color of the chart.</li>
<li>bgAlpha=&quot;NumericalValue(0-100)&quot; : This attribute helps you set the alpha (transparency) of the graph.</li>
</ul>
<p>Canvas Properties</p>
<ul>
<li>canvasBgColor=&quot;HexColorCode&quot; : This attribute helps you set the background color of the canvas.</li>
<li>canvasBgAlpha=&quot;NumericalValue(0-100)&quot; : This attribute helps you set the alpha (transparency) of the canvas.</li>
<li>canvasBorderColor=&quot;HexColorCode&quot; : This attribute helps you set the border color of the canvas.</li>
<li>canvasBorderThickness=&quot;NumericalValue(0-100)&quot; : This attribute helps you set the border thickness (in pixels) of the canvas.</li>
</ul>
<p>Chart Numerical Limits</p>
<ul>
<li>xAxisMinValue=&quot;value&quot; : This attribute determines the lower limit of x-axis.</li>
<li>xAxisMaxValue=&quot;value&quot;: This attribute determines the upper limit of x-axis.</li>
<li>yAxisMinValue=&quot;value&quot;: This attribute determines the lower limit of y-axis.</li>
<li>yAxisMaxValue=&quot;value&quot; : This attribute determines the upper limit of y-axis.
If you don&#39;t specify any of the above 4 values, it is automatically calculated by FusionCharts based on the data provided by you.</li>
<li>overRideLimitCalc=&quot;1/0&quot;: When you provide data and the upper and lower limits to FusionCharts, FusionCharts (while rendering) checks whether the upper and lower limits are correctly provided - that is it checks whether all the data values fall within the specified range. Sometimes, this process takes a little extra time when you have a large amount of data. If in that case you don&#39;t want FusionCharts to cross check the limits explicitly provided by you, you can set this attribute value to 1 and then FusionCharts won&#39;t delve into the process of checking thus saving that extra bit of time required.</li>
</ul>
<p>Bars or Candles</p>
<ul>
<li>showAsBars=&quot;1/0&quot;: Whether to show candles or bars on the chart.</li>
</ul>
<p>Divisional Lines (Horizontal)</p>
<ul>
<li>numdivlines=&quot;NumericalValue&quot; : This attribute sets the number of divisional lines to be drawn.</li>
<li>divlinecolor=&quot;HexColorCode&quot; : The color of grid divisional line.</li>
<li>divLineThickness=&quot;NumericalValue&quot; : Thickness (in pixels) of the grid divisional line.</li>
<li>divLineAlpha=&quot;NumericalValue0-100&quot; : Alpha (transparency) of the grid divisional line.</li>
<li>showDivLineValue=&quot;1/0&quot; : Option to show/hide the textual value of the divisional line.</li>
<li>showAlternateHGridColor=&quot;1/0&quot; : Option on whether to show alternate colored horizontal grid bands.</li>
<li>alternateHGridColor=&quot;HexColorCode&quot; : Color of the alternate horizontal grid bands.</li>
<li>alternateHGridAlpha=&quot;NumericalValue0-100&quot; : Alpha (transparency) of the alternate horizontal grid bands.</li>
</ul>
<p>Divisional Lines (Vertical)</p>
<ul>
<li>numVDivLines=&quot;NumericalValue&quot; : Sets the number of vertical divisional lines to be drawn.</li>
<li>VDivlinecolor=&quot;HexColorCode&quot; : Color of vertical grid divisional line.</li>
<li>VDivLineThickness=&quot;NumericalValue&quot; : Thickness (in pixels) of the line</li>
<li>VDivLineAlpha=&quot;NumericalValue0-100&quot; : Alpha (transparency) of the line.</li>
<li>showAlternateVGridColor=&quot;1/0&quot; : Option on whether to show alternate colored vertical grid bands.</li>
<li>alternateVGridColor=&quot;HexColorCode&quot; : Color of the alternate vertical grid bands.</li>
<li>alternateVGridAlpha=&quot;NumericalValue0-100&quot; : Alpha (transparency) of the alternate vertical grid bands.</li>
</ul>
<p>General Properties</p>
<ul>
<li>caption=&quot;String&quot; : Caption of the chart</li>
<li>subCaption=&quot;String&quot; : Sub-caption of the chart</li>
<li>shownames=&quot;1/0&quot; : Option whether to show/hide the category names.</li>
<li>showLimits=&quot;1/0&quot; : Option whether to show/hide the chart limit textboxes.</li>
<li>rotateNames=&quot;1/0&quot; : Configuration that sets whether the category name text boxes would be rotated or not.</li>
</ul>
<p>Number Formatting Options</p>
<ul>
<li>numberPrefix=&quot;$&quot; : Using this attribute, you could add prefix to all the numbers visible on the graph. For example, to represent all dollars figure on the chart, you could specify this attribute to &#39; $&#39; to show like $40000, $50000.</li>
<li>numberSuffix=&quot;p.a&quot; : Using this attribute, you could add prefix to all the numbers visible on the graph. For example, to represent all figure quantified as per annum on the chart, you could specify this attribute to &#39; /a&#39; to show like 40000/a, 50000/a.
To use special characters for numberPrefix or numberSuffix, you&#39;ll need to URL Encode them. That is, suppose you wish to have numberSuffix as % (like 30%), you&#39;ll need to specify it as under:
numberSuffix=&#39;%25&#39;</li>
<li>formatNumber=&quot;1/0&quot; : This configuration determines whether the numbers displayed on the graph will be formatted using commas, e.g., 40,000 if formatNumber=&#39;1&#39; and 40000 if formatNumber=&#39;0 &#39;</li>
<li>formatNumberScale=&quot;1/0&quot; : Configuration whether to add K (thousands) and M (millions) to a number after truncating and rounding it - e.g., if formatNumberScale is set to 1, 10434 would become 1.04K (with decimalPrecision set to 2 places). Same with numbers in millions - a M will added at the end.</li>
<li>decimalSeparator=&quot;.&quot; : This option helps you specify the character to be used as the decimal separator in a number.</li>
<li>thousandSeparator=&quot;,&quot; : This option helps you specify the character to be used as the thousands separator in a number.</li>
<li>decimalPrecision=&quot;2&quot; : Number of decimal places to which all numbers on the chart would be rounded to.</li>
<li>divLineDecimalPrecision=&quot;2&quot;: Number of decimal places to which all divisional line (horizontal) values on the chart would be rounded to.</li>
<li>limitsDecimalPrecision=&quot;2&quot; : Number of decimal places to which upper and lower limit values on the chart would be rounded to.</li>
</ul>
<p>Hover Caption Properties</p>
<ul>
<li>showhovercap=&quot;1/0&quot; : Option whether to show/hide hover caption box.</li>
<li>hoverCapBgColor=&quot;HexColorCode&quot; : Background color of the hover caption box.</li>
<li>hoverCapBorderColor=&quot;HexColorCode&quot; : Border color of the hover caption box.</li>
<li>hoverCapSepChar=&quot;Char&quot; : The character specified as the value of this attribute separates the name and value displayed in the hover caption box.</li>
</ul>
<p>Font Properties</p>
<ul>
<li>baseFont=&quot;FontName&quot; : This attribute sets the base font family of the graph font which lies on the canvas i.e., all the values and the names in the graph which lie on the canvas will be displayed using the font name provided here.</li>
<li>baseFontSize=&quot;FontSize&quot; : This attribute sets the base font size of the graph i.e., all the values and the names in the graph which lie on the canvas will be displayed using the font size provided here.</li>
<li>baseFontColor=&quot;HexColorCode&quot; : This attribute sets the base font color of the graph i.e., all the values and the names in the graph which lie on the canvas will be displayed using the font color provided here.</li>
<li>outCnvBaseFont = &quot;FontName&quot; : This attribute sets the base font family of the graph font which lies outside the canvas i.e., all the values and the names in the graph which lie outside the canvas will be displayed using the font name provided here.</li>
<li>outCnvBaseFontSize=&quot;FontSize&quot; : This attribute sets the base font size of the graph i.e., all the values and the names in the graph which lie outside the canvas will be displayed using the font size provided here.</li>
<li>outCnvBaseFontColor=&quot;HexColorCode&quot;: This attribute sets the base font color of the graph i.e., all the values and the names in the graph which lie outside the canvas will be displayed using the font color provided here.</li>
</ul>
<p>Candle Properties</p>
<ul>
<li>candleWidth=&quot;NumericalValue&quot; (Optional): If you explicitly wish to define the width of each candle in the chart, you can use this attribute. However, this attribute is optional in the sense that FusionCharts would automatically calculate the best fit value for the candle width.</li>
<li>bearBorderColor=&quot;HexColor&quot;: Border Color for a bear candle.</li>
<li>bearFillColor=&quot;HexColor&quot;: Fill Color for a bear candle.</li>
<li>bullBorderColor=&quot;HexColor&quot;: Border Color for a bull candle.</li>
<li>bullFillColor=&quot;HexColor&quot;: Fill Color for a bull candle. <categories> attributes and elements Attributes and child-elements of the <category> elements help you create the x-axis labels on the chart. They also help you create the vertical category lines on the chart and configure their visual properties.</li>
</ul>
<p>The <categories> element has the following attributes:</p>
<ul>
<li>font=&#39;FontName&#39; : This attribute helps you set the font face for the x-axis labels in specific.</li>
<li>fontSize=&#39;FontSize&#39; : This attribute helps you set the font size for the x-axis labels in specific.</li>
<li>fontColor=&#39;HexColor&#39; : This attribute helps you set the font color for the x-axis labels in specific.</li>
<li>verticalLineColor=&#39;HexColor&#39; : This attribute helps you set the color of the category line (i.e., the vertical line drawn through the entire span of the canvas just above the category name)</li>
<li>verticalLineThickness=&#39;NumericalValue&#39; : This attribute helps you set the thickness of the category line in pixels.</li>
<li>verticalLineAlpha=&#39;NumericalValue0-100&#39; : This attribute helps you set the alpha (transparency) of the category line</li>
</ul>
<p>For each category name, you&#39;ll need to define a <category> element as under:</p>
<category Name='Split' xIndex='44' showLine='1'/>

<p>The <category> element can have the following attributes:</p>
<ul>
<li>name=&#39;String&#39;: x-axis label to be displayed.</li>
<li>xIndex=&#39;NumericalValue&#39;: x-axis position where the category name is to be displayed. In the candlestick chart, the x-axis is also numbered - i.e., it has an upper limit and a lower limit. For example, when you&#39;re plotting a chart to show the data for a month, the lower limit of x-axis would be 1 and the upper limit 31. So, when you need to render a category label for the 15th day of the month say &quot;Mid-month&quot;, you&#39;ll have specify xIndex as 15 for that <category>.</li>
<li>showLine=&#39;1/0&#39; : Option to whether show or hide the line just above this particular category name. <data> child elements The actual data of the chart comes under the <data> element. For each data item, you&#39;ve to specify a <set> element as under:<set open='92' high='93.38' low='91.68' close='93.3' xIndex='4' link='Detail.asp?day=32'/>

</li>
</ul>
<p>The <set> element can have the following attributes:</p>
<ul>
<li>open=&quot;NumericalValue&quot; : This attribute determines the open value for the data set. It is compulsory to provide this value.</li>
<li>high=&quot;NumericalValue&quot; : This attribute determines the high value for the data set. It is compulsory to provide this value.</li>
<li>low =&quot;NumericalValue&quot; : This attribute determines the low value for the data set. It is compulsory to provide this value.</li>
<li>close =&quot;NumericalValue&quot; : This attribute determines the close value for the data set. It is compulsory to provide this value.</li>
<li>borderColor=&quot;HexColorCode&quot; [Optional]: This attribute lets you change the border color of particular candle on the chart. All the candles on the chart follow the color code as specified in bearBorderColor and bullBorderColor attributes of the <graph> element. However, if in some case you want to highlight one particular candle by changing it&#39;s color, you can use this option.</li>
<li>color=&quot;HexColorCode&quot; [Optional]: Similar to the border color (previous attribute), this attribute lets you set the fill color of a particular candle selectively.</li>
<li>xIndex=&quot;NumericalValue&quot; [Optional]: x-axis position of the candle. In the candlestick chart, the x-axis is also numbered - i.e., it has an upper limit and a lower limit. For example, when you&#39;re plotting a chart to show the data for a month, the lower limit of x-axis would be 1 and the upper limit 31. So, when you&#39;re providing data for 15th day, you need to mention xIndex as 15. However, if you do not provide x-index for any of the <set> elements, FusionCharts will auto number them for you starting from 1.</li>
<li>link=&quot;link&quot; [Optional]: Sets the link for a particular candle <trendLines> Using the <trendLines> element (and child elements), you can define trend lines on the charts. Trend lines are the horizontal lines spanning the chart canvas that aid in interpretation of data with respect to some previous pre-determined figure. For each trend line on the chart, you need to define a <line> element as under:<line startValue='89.5' endValue='98' color='FF0000' displayvalue='Roll. Avg.' thickness='2' alpha='100' isTrendZone='0' showOnTop='1'/>

</li>
</ul>
<p>The <line> element can have the following attributes:</p>
<ul>
<li>startValue=&#39;NumericalValue&#39;: The starting y-axis value for the trendline. Say, if you want to plot a slanted trendline from value 102 to 109, the startValue would 102.</li>
<li>endValue=&#39;NumericalValue&#39;: The ending y-axis value for the trendline. Say, if you want to plot a slanted trendline from value 102 to 109, the endValue would 109. If you do not specify a value for endValue, it would automatically assume the same value as startValue.</li>
<li>color=&#39;HexCode&#39; : Color of the trend line and its associated text.</li>
<li>displayValue=&#39;StringValue&#39; : If you want to display a string caption for the trend line by its side, you can use this attribute. Example: displayValue=&#39;Last Month High&#39;. When you don&#39;t supply this attribute, it automatically takes the value of startValue.</li>
<li>thickness=&#39;NumericalValue&#39; : Thickness of the trend line</li>
<li>isTrendZone=&#39;1/0&#39;: Whether the trend would display a line, or a zone (filled colored rectangle).</li>
<li>showOnTop=&#39;1/0&#39;: Whether the trend line/zone would be displayed over the candles or under the candles.</li>
<li>alpha=&#39;NumericalValue0-100&#39;: Alpha (transparency) of the trend line  In the next section we&#39;ll see a few examples of XML document for the candlestick chart.</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/JS用法/">JS用法</a></li></span></span> | <span class="tags">Tagged <a href="/tags/JS用法/" class="label label-primary">JS用法</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:28"datetime="2014-03-07 09:54:28"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JS用法--FusionChartsFREE-XMLStructure/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JS用法--FusionChartsFREE-XMLStructure" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-架构师-架构--淘宝图片服务的学习/">淘宝图片服务的学习</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:28.000Z"> <a href="/2014/02/02/2014-02-02-架构师-架构--淘宝图片服务的学习/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">淘宝图片服务的学习</h1>
<p>原文出处： <a href="http://www.biaodianfu.com/taobao-tfs.html" target="_blank">标点符</a></p>
<p><strong>一、淘宝网的困境</strong></p>
<p>对于淘宝网这样的大型电子商务网站，对于图片服务的要求特别的高。而且对于卖家来说，图片远胜于文字描述，因此卖家也格外看重图片的显示质量、访问速度等问题。根据淘宝网的流量分析，整个淘宝网流量中，图片的访问流量会占到90%以上，而主站的网页则占到不到10%。同时大量的图片需要根据不同的应用位置，生成不同大小规格的缩略图。考虑到多种不同的应用场景以及改版的可能性，一张原图有可能需要生成20多个不同尺寸规格的缩略图。</p>
<p>淘宝整体图片存储系统容量1800TB（1.8PB），已经占用空间990TB（约1PB）。保存的图片文件数量达到286亿多个，这些图片文件包括根据原图生成的缩略图。平均图片大小是17.45K；8K以下图片占图片数总量的61%，占存储容量的11%。对于如此大规模的小文件存储与读取需要频繁的寻道和换道，在大量高并发访问量的情况下，非常容易造成读取延迟。</p>
<p>2007年之前淘宝采用NetApp公司的文件存储系统。至2006年， NetApp公司最高端的产品也不能满足淘宝存储的要求。首先是商用的存储系统没有对小文件存储和读取的环境进行有针对性的优化;其次，文件数量大，网络存储设备无法支撑;另外，整个系统所连接的服务器也越来越多，网络连接数已经到达了网络存储设备的极限。此外，商用存储系统扩容成本高，10T的存储容量需要几百万，而且存在单点故障，容灾和安全性无法得到很好的保证。</p>
<p><strong>二、淘宝网自主开发的目的</strong></p>
<ol>
<li>商用软件很难满足大规模系统的应用需求，无论存储还是CDN还是负载均衡，因为在厂商实验室端，很难实现如此大的数据规模测试。</li>
<li>研发过程中，将开源和自主开发相结合，会有更好的可控性，系统出问题了，完全可以从底层解决问题，系统扩展性也更高。</li>
<li>在一定规模效应基础上，研发的投入都是值得的。当规模超过交叉点后自主研发才能收到较好的经济效果。实际上淘宝网的规模已经远远超过了交叉点。</li>
<li>自主研发的系统可在软件和硬件多个层次不断的优化。</li>
</ol>
<p><strong>三、淘宝TFS的介绍</strong></p>
<p><strong>1、 TFS 1.0版本</strong></p>
<p><em>**</em>从2006年开始，淘宝网决定自己开发一套针对海量小文件存储难题的文件系统，用于解决自身图片存储的难题。到2007年6月，TFS(淘宝文件系统，Taobao File System)正式上线运营。在生产环境中应用的集群规模达到了200台PC Server(146G/*6 SAS 15K Raid5)，文件数量达到上亿级别;系统部署存储容量: 140 TB;实际使用存储容量: 50 TB;单台支持随机IOPS 200+，流量3MBps。<a href="http://cdn2.jobbole.com/2013/07/tfs-1.jpg" title="tfs-1" target="_blank"><img src="&quot;tfs-1&quot;" alt=""></a></p>
<p>图为淘宝集群文件系统TFS 1.0第一版的逻辑架构：集群由一对Name Server和多台Data Server构成，Name Server的两台服务器互为双机，就是集群文件系统中管理节点的概念。</p>
<ul>
<li>每个Data Server运行在一台普通的Linux主机上</li>
<li>以block文件的形式存放数据文件(一般64M一个block)</li>
<li>block存多份保证数据安全</li>
<li>利用ext3文件系统存放数据文件</li>
<li>磁盘raid5做数据冗余</li>
<li>文件名内置元数据信息，用户自己保存TFS文件名与实际文件的对照关系–使得元数据量特别小。</li>
</ul>
<p>TFS最大的特点就是将一部分元数据隐藏到图片的保存文件名上，大大简化了元数据，消除了管理节点对整体系统性能的制约，这一理念和目前业界流行的“对象存储”较为类似。传统的集群系统里面元数据只有1份，通常由管理节点来管理，因而很容易成为瓶颈。而对于淘宝网的用户来说，图片文件究竟用什么名字来保存实际上用户并不关心，因此TFS在设计规划上考虑在图片的保存文件名上暗藏了一些元数据信息，例如图片的大小、时间、访问频次等等信息，包括所在的逻辑块号。而在元数据上，实际上保存的信息很少，因此元数据结构非常简单。仅仅只需要一个fileID，能够准确定位文件在什么地方。由于大量的文件信息都隐藏在文件名中，整个系统完全抛弃了传统的目录树结构，因为目录树开销最大。拿掉后，整个集群的高可扩展性极大提高。</p>
<p><strong>2、 TFS 1.3版本</strong></p>
<p>到2009年6月，TFS 1.3版本上线，集群规模大大扩展，部署到淘宝的图片生产系统上，整个系统已经从原有200台PC服务器扩增至440台PC Server(300G/<em>12 SAS 15K RPM) + 30台PC Server (600G/</em>12 SAS 15K RPM)。支持文件数量也扩容至百亿级别;系统部署存储容量：1800TB(1.8PB);当前实际存储容量：995TB;单台Data Server支持随机IOPS 900+，流量15MB+;目前Name Server运行的物理内存是217MB(服务器使用千兆网卡)。</p>
<p><a href="http://cdn2.jobbole.com/2013/07/tfs-2.jpg" title="tfs-2" target="_blank"><img src="&quot;tfs-2&quot;" alt=""></a></p>
<p>图为TFS1.3版本的逻辑结构图，在TFS1.3版本中，淘宝网的软件工作组重点改善了心跳和同步的性能，最新版本的心跳和同步在几秒钟之内就可完成切换，同时进行了一些新的优化：包括元数据存内存上，清理磁盘空间，性能上也做了优化，包括：</p>
<ul>
<li>完全扁平化的数据组织结构，抛弃了传统文件系统的目录结构。</li>
<li>在块设备基础上建立自有的文件系统，减少EXT3等文件系统数据碎片带来的性能损耗</li>
<li>单进程管理单块磁盘的方式，摒除RAID5机制</li>
<li>带有HA机制的中央控制节点，在安全稳定和性能复杂度之间取得平衡。</li>
<li>尽量缩减元数据大小，将元数据全部加载入内存，提升访问速度。</li>
<li>跨机架和IDC的负载均衡和冗余安全策略。</li>
<li>完全平滑扩容。</li>
</ul>
<p>TFS主要的性能参数不是IO吞吐量，而是单台PCServer提供随机读写IOPS。由于硬件型号不同，很难给出一个参考值来说明性能。但基本上可以达到单块磁盘随机IOPS理论最大值的60%左右，整机的输出随盘数增加而线性增加。</p>
<p><strong>3、 TFS 2.0版本</strong></p>
<p>TFS 2.0（下面简称<a href="http://code.taobao.org/p/tfs/src/" target="_blank">TFS</a>，目前已经开源）是一个高可扩展、高可用、高性能、面向互联网服务的分布式文件系统，主要针对海量的非结构化数据，它构筑在普通的Linux机器集群上，可为外部提供高可靠和高并发的存储访问。TFS为淘宝提供海量小文件存储，通常文件大小不超过1M，满足了淘宝对小文件存储的需求，被广泛地应用在淘宝各项应用中。它采用了HA架构和平滑扩容，保证了整个文件系统的可用性和扩展性。同时扁平化的数据组织结构，可将文件名映射到文件的物理地址，简化了文件的访问流程，一定程度上为TFS提供了良好的读写性能。</p>
<p><a href="http://cdn2.jobbole.com/2013/07/tfs-3-1.jpg" title="tfs-3-1" target="_blank"><img src="&quot;tfs-3-1&quot;" alt=""></a></p>
<p> 一个TFS集群由两个!NameServer节点（一主一备）和多个!DataServer节点组成。这些服务程序都是作为一个用户级的程序运行在普通Linux机器上的。在TFS中，将大量的小文件(实际数据文件)合并成为一个大文件，这个大文件称为块(Block), 每个Block拥有在集群内唯一的编号(Block Id), Block Id在!NameServer在创建Block的时候分配, !NameServer维护block与!DataServer的关系。Block中的实际数据都存储在!DataServer上。而一台!DataServer服务器一般会有多个独立!DataServer进程存在，每个进程负责管理一个挂载点，这个挂载点一般是一个独立磁盘上的文件目录，以降低单个磁盘损坏带来的影响。正常情况下，一个块会在!DataServer上存在，主!NameServer负责Block的创建，删除，复制，均衡，整理， !NameServer不负责实际数据的读写，实际数据的读写由!DataServer完成。</p>
<ul>
<li>!NameServer主要功能是: 管理维护Block和!DataServer相关信息,包括!DataServer加入，退出, 心跳信息, block和!DataServer的对应关系建立，解除。</li>
<li>!DataServer主要功能是: 负责实际数据的存储和读写。</li>
</ul>
<p>同时为了考虑容灾，!NameServer采用了HA结构，即两台机器互为热备，同时运行，一台为主，一台为备，主机绑定到对外vip，提供服务；当主机器宕机后，迅速将vip绑定至备份!NameServer，将其切换为主机，对外提供服务。图中的HeartAgent就完成了此功能。</p>
<p>TFS的块大小可以通过配置项来决定，通常使用的块大小为64M。TFS的设计目标是海量小文件的存储，所以每个块中会存储许多不同的小文件。!DataServer进程会给Block中的每个文件分配一个ID(File ID，该ID在每个Block中唯一)，并将每个文件在Block中的信息存放在和Block对应的Index文件中。这个Index文件一般都会全部load在内存，除非出现!DataServer服务器内存和集群中所存放文件平均大小不匹配的情况。</p>
<p>另外，还可以部署一个对等的TFS集群，作为当前集群的辅集群。辅集群不提供来自应用的写入，只接受来自主集群的写入。当前主集群的每个数据变更操作都会重放至辅集群。辅集群也可以提供对外的读，并且在主集群出现故障的时候，可以接管主集群的工作。</p>
<p><strong>平滑扩容</strong></p>
<p>原有TFS集群运行一定时间后，集群容量不足，此时需要对TFS集群扩容。由于DataServer与NameServer之间使用心跳机制通信，如果系统扩容，只需要将相应数量的新!DataServer服务器部署好应用程序后启动即可。这些!DataServer服务器会向!NameServer进行心跳汇报。!NameServer会根据!DataServer容量的比率和!DataServer的负载决定新数据写往哪台!DataServer的服务器。根据写入策略，容量较小，负载较轻的服务器新数据写入的概率会比较高。同时，在集群负载比较轻的时候，!NameServer会对!DataServer上的Block进行均衡，使所有!DataServer的容量尽早达到均衡。</p>
<p>进行均衡计划时，首先计算每台机器应拥有的blocks平均数量，然后将机器划分为两堆，一堆是超过平均数量的，作为移动源；一类是低于平均数量的，作为移动目的。</p>
<p>移动目的的选择：首先一个block的移动的源和目的，应该保持在同一网段内，也就是要与另外的block不同网段；另外，在作为目的的一定机器内，优先选择同机器的源到目的之间移动，也就是同台!DataServer服务器中的不同!DataServer进程。
当有服务器故障或者下线退出时（单个集群内的不同网段机器不能同时退出），不影响TFS的服务。此时!NameServer会检测到备份数减少的Block，对这些Block重新进行数据复制。</p>
<p>在创建复制计划时，一次要复制多个block, 每个block的复制源和目的都要尽可能的不同，并且保证每个block在不同的子网段内。因此采用轮换选择(roundrobin)算法，并结合加权平均。</p>
<p>由于DataServer之间的通信是主要发生在数据写入转发的时候和数据复制的时候，集群扩容基本没有影响。假设一个Block为64M，数量级为1PB。那么NameServer上会有 1 /<em> 1024 /</em> 1024 /* 1024 / 64 = 16.7M个block。假设每个Block的元数据大小为0.1K，则占用内存不到2G。</p>
<p><strong>存储机制</strong></p>
<p>在TFS中，将大量的小文件(实际用户文件)合并成为一个大文件，这个大文件称为块(Block)。TFS以Block的方式组织文件的存储。每一个Block在整个集群内拥有唯一的编号，这个编号是由NameServer进行分配的，而DataServer上实际存储了该Block。在!NameServer节点中存储了所有的Block的信息，一个Block存储于多个!DataServer中以保证数据的冗余。对于数据读写请求，均先由!NameServer选择合适的!DataServer节点返回给客户端，再在对应的!DataServer节点上进行数据操作。!NameServer需要维护Block信息列表，以及Block与!DataServer之间的映射关系，其存储的元数据结构如下：</p>
<p><a href="http://cdn2.jobbole.com/2013/07/20130724154417.jpg" title="20130724154417" target="_blank"><img src="&quot;20130724154417&quot;" alt=""></a></p>
<p>在!DataServer节点上，在挂载目录上会有很多物理块，物理块以文件的形式存在磁盘上，并在!DataServer部署前预先分配，以保证后续的访问速度和减少碎片产生。为了满足这个特性，!DataServer现一般在EXT4文件系统上运行。物理块分为主块和扩展块，一般主块的大小会远大于扩展块，使用扩展块是为了满足文件更新操作时文件大小的变化。每个Block在文件系统上以“主块+扩展块”的方式存储。每一个Block可能对应于多个物理块，其中包括一个主块，多个扩展块。</p>
<p>在DataServer端，每个Block可能会有多个实际的物理文件组成：一个主Physical Block文件，N个扩展Physical Block文件和一个与该Block对应的索引文件。Block中的每个小文件会用一个block内唯一的fileid来标识。!DataServer会在启动的时候把自身所拥有的Block和对应的Index加载进来。</p>
<p><strong>容错机制</strong></p>
<p><strong>集群容错。</strong>TFS可以配置主辅集群，一般主辅集群会存放在两个不同的机房。主集群提供所有功能，辅集群只提供读。主集群会把所有操作重放到辅集群。这样既提供了负载均衡，又可以在主集群机房出现异常的情况不会中断服务或者丢失数据。</p>
<p><strong>!NameServer容错。</strong>Namserver主要管理了!DataServer和Block之间的关系。如每个!DataServer拥有哪些Block，每个Block存放在哪些!DataServer上等。同时，!NameServer采用了HA结构，一主一备，主NameServer上的操作会重放至备NameServer。如果主NameServer出现问题，可以实时切换到备NameServer。另外!NameServer和!DataServer之间也会有定时的heartbeat，!DataServer会把自己拥有的Block发送给!NameServer。!NameServer会根据这些信息重建!DataServer和Block的关系。</p>
<p><strong>!DataServer容错。</strong>TFS采用Block存储多份的方式来实现!DataServer的容错。每一个Block会在TFS中存在多份，一般为3份，并且分布在不同网段的不同!DataServer上。对于每一个写入请求，必须在所有的Block写入成功才算成功。当出现磁盘损坏!DataServer宕机的时候，TFS启动复制流程，把备份数未达到最小备份数的Block尽快复制到其他DataServer上去。 TFS对每一个文件会记录校验crc，当客户端发现crc和文件内容不匹配时，会自动切换到一个好的block上读取。此后客户端将会实现自动修复单个文件损坏的情况。</p>
<p><strong>并发机制</strong></p>
<p>对于同一个文件来说，多个用户可以并发读。现有TFS并不支持并发写一个文件。一个文件只会有一个用户在写。这在TFS的设计里面对应着是一个block同时只能有一个写或者更新操作。</p>
<p><strong>TFS文件名的结构</strong></p>
<p>TFS的文件名由块号和文件号通过某种对应关系组成，最大长度为18字节。文件名固定以T开始，第二字节为该集群的编号(可以在配置项中指定，取值范围 1~9)。余下的字节由Block ID和File ID通过一定的编码方式得到。文件名由客户端程序进行编码和解码，它映射方式如下图：</p>
<p><a href="http://cdn2.jobbole.com/2013/07/tfs-3-3.jpg" title="tfs-3-3" target="_blank"><img src="&quot;tfs-3-3&quot;" alt=""></a></p>
<p>TFS客户程序在读文件的时候通过将文件名转换为BlockID和FileID信息，然后可以在!NameServer取得该块所在!DataServer信息（如果客户端有该Block与!DataServere的缓存，则直接从缓存中取），然后与!DataServer进行读取操作。</p>
<p><strong>四、图片服务器部署与缓存</strong></p>
<p>下图为淘宝网整体系统的拓扑图结构。整个系统就像一个庞大的服务器一样，有处理单元、缓存单元和存储单元。前面已经详细介绍过了后台的TFS集群文件存储系统，在TFS前端，还部署着200多台图片文件服务器，用Apatch实现，用于生成缩略图的运算。</p>
<p>根据淘宝网的缩略图生成规则，缩略图都是实时生成的。这样做的好处有两点：一是为了避免后端图片服务器上存储的图片数量过多，大大节约后台存储空间的需求，淘宝网计算，采用实时生成缩略图的模式比提前全部生成好缩略图的模式节约90%的存储空间，也就是说，存储空间只需要后一种模式的10%;二是，缩略图可根据需要实时生成出来，更为灵活。</p>
<p><a href="http://cdn2.jobbole.com/2013/07/tfs-4-4.jpg" title="tfs-4-4" target="_blank"><img src="&quot;tfs-4-4&quot;" alt=""></a></p>
<p>淘宝网图片存储与处理系统全局拓扑，图片服务器前端还有一级和二级缓存服务器，尽量让图片在缓存中命中，最大程度的避免图片热点，实际上后端到达TFS的流量已经非常离散和平均。</p>
<p>图片文件服务器的前端则是一级缓存和二级缓存，前面还有全局负载均衡的设置，解决图片的访问热点问题。图片的访问热点一定存在，重要的是，让图片尽量在缓存中命中。目前淘宝网在各个运营商的中心点设有二级缓存，整体系统中心店设有一级缓存，加上全局负载均衡，传递到后端TFS的流量就已经非常均衡和分散了，对前端的响应性能也大大提高。</p>
<p>根据淘宝的缓存策略，大部分图片都尽量在缓存中命中，如果缓存中无法命中，则会在本地服务器上查找是否存有原图，并根据原图生成缩略图，如果都没有命中，则会考虑去后台TFS集群文件存储系统上调取，因此，最终反馈到TFS集群文件存储系统上的流量已经被大大优化了。</p>
<p>淘宝网将图片处理与缓存编写成基于Nginx的模块（<a href="https://github.com/alibaba/nginx-tfs" target="_blank">Nginx-tfs</a>），淘宝认为Nginx是目前性能最高的HTTP服务器(用户空间)，代码清晰，模块化非常好。淘宝使用GraphicsMagick进行图片处理，采用了面向小对象的缓存文件系统，前端有LVS+Haproxy将原图和其所有缩略图请求都调度到同一台Image Server。</p>
<p>文件定位上，内存用hash算法做索引，最多一次读盘。写盘方式则采用Append方式写，并采用了淘汰策略FIFO，主要考虑降低硬盘的写操作，没有必要进一步提高Cache命中率，因为Image Server和TFS在同一个数据中心，读盘效率还是非常高的。
<img src="&quot;3 votes, average: 5.00 out of 5&quot;" alt="3 votes, average: 5.00 out of 5"><img src="&quot;3 votes, average: 5.00 out of 5&quot;" alt="3 votes, average: 5.00 out of 5"><img src="&quot;3 votes, average: 5.00 out of 5&quot;" alt="3 votes, average: 5.00 out of 5"><img src="&quot;3 votes, average: 5.00 out of 5&quot;" alt="3 votes, average: 5.00 out of 5"><img src="&quot;3 votes, average: 5.00 out of 5&quot;" alt="3 votes, average: 5.00 out of 5"> (<strong>*3</strong> 个评分，平均: <strong>5.00*</strong>)</p>
<p><img src="&quot;Loading ...&quot;" alt="Loading ..."> Loading ...</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/架构师/">架构师</a></li></span><span class="breadcrumb"><li><a href="/categories/架构师/">架构师</a></li><li><a href="/categories/架构师/架构/">架构</a></li></span></span> | <span class="tags">Tagged <a href="/tags/架构/" class="label label-primary">架构</a><a href="/tags/架构师/" class="label label-success">架构师</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-架构师-架构--淘宝图片服务的学习/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-架构师-架构--淘宝图片服务的学习" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/153/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/151/">151</a></li><li><a class="page-number" href="/page/152/">152</a></li><li><a class="page-number" href="/page/153/">153</a></li><li class="active"><li><span class="page-number current">154</span></li><li><a class="page-number" href="/page/155/">155</a></li><li><a class="page-number" href="/page/156/">156</a></li><li><a class="page-number" href="/page/157/">157</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/155/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 16:55:37</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
