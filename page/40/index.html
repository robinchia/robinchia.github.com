
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 40 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_总结类--java实现double的精确计算和四舍五入/">java实现double的精确计算和四舍五入</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:43.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_总结类--java实现double的精确计算和四舍五入/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-double-">java实现double的精确计算和四舍五入</h1>
<h1 id="-http-blog-csdn-net-a9529lty-"><a href="http://blog.csdn.net/a9529lty" target="_blank">遗忘的角落</a></h1>
<h1 id="-">#</h1>
<ul>
<li><a href="http://passport.csdn.net/UserLogin.aspx" target="_blank">登录</a></li>
<li><a href="http://passport.csdn.net/CSDNUserRegister.aspx" target="_blank">注册</a></li>
<li><a href="http://hi.csdn.net/" target="_blank">欢迎</a></li>
<li><a href="http://writeblog.csdn.net/Signout.aspx" target="_blank">退出</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">我的博客</a></li>
<li><a href="http://writeblog.csdn.net/configure.aspx" target="_blank">配置</a></li>
<li><a href="http://writeblog.csdn.net/PostEdit.aspx" target="_blank">写文章</a></li>
<li><a href="http://writeblog.csdn.net/PostList.aspx" target="_blank">文章管理</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">博客首页</a></li>
</ul>
<p>*</p>
<ul>
<li><p>全站 当前博客
*</p>
</li>
<li><p><a href="http://hi.csdn.net/a9529lty" target="_blank">空间</a></p>
</li>
<li><a href="http://blog.csdn.net/a9529lty" target="_blank">博客</a></li>
<li><a href="http://hi.csdn.net/!s/friend/list/a9529lty" target="_blank">好友</a></li>
<li><a href="http://hi.csdn.net/!s/album/list/a9529lty" target="_blank">相册</a></li>
<li><a href="http://hi.csdn.net/!s/wall/to/a9529lty" target="_blank">留言</a></li>
</ul>
<p>用户操作<a href="http://hi.csdn.net/!s/wall/to/a9529lty" target="_blank">[留言]</a>  <a href="http://hi.csdn.net/!s/msg/to/a9529lty" target="_blank">[发消息]</a>  <a href="http://hi.csdn.net/!s/friend/add/a9529lty" target="_blank">[加为好友]</a> 订阅我的博客<a href="http://feeds.feedsky.com/csdn.net/a9529lty" target="_blank"><img src="" alt="XML聚合"></a>   <a href="http://feeds.feedsky.com/csdn.net/a9529lty" target="_blank"><img src="" alt="FeedSky"></a><a href="http://www.xianguo.com/subscribe.php?url=http://feeds.feedsky.com/csdn.net/a9529lty" target="_blank"><img src="" alt="订阅到鲜果"></a><a href="http://fusion.google.com/add?feedurl=http://feeds.feedsky.com/csdn.net/a9529lty" target="_blank"><img src="" alt="订阅到Google"></a><a href="http://www.zhuaxia.com/add_channel.php?url=http://feeds.feedsky.com/csdn.net/a9529lty" target="_blank"><img src="" alt="订阅到抓虾"></a><a href="http://writeblog.csdn.net/configure.aspx" target="_blank">[编辑]</a>a9529lty的公告我的QQ是297453997欢迎大家加我一起讨论问题<a href="http://writeblog.csdn.net/EditCategories.aspx?catID=1" target="_blank">[编辑]</a>文章分类* <a href="http://blog.csdn.net/a9529lty/category/354401.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/354401.aspx" target="_blank">Ajax</a></p>
<ul>
<li><a href="http://blog.csdn.net/a9529lty/category/352346.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/352346.aspx" target="_blank">C/#</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/526658.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/526658.aspx" title="Eclipse" target="_blank">Eclipse</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/354338.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/354338.aspx" target="_blank">Hibernate</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/352340.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/352340.aspx" target="_blank">Java</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/352342.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/352342.aspx" target="_blank">Javascript</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/356239.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/356239.aspx" target="_blank">Jsf</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/356238.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/356238.aspx" target="_blank">Jsp</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/600868.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/600868.aspx" title="Lua " target="_blank">Lua</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/431500.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/431500.aspx" target="_blank">Mysql</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/352341.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/352341.aspx" target="_blank">Netbeans</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/353973.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/353973.aspx" target="_blank">Oracle</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/403584.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/403584.aspx" target="_blank">Sql</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/430229.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/430229.aspx" target="_blank">Struts</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/354337.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/354337.aspx" target="_blank">Tomcat</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/593722.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/593722.aspx" title="面试专用" target="_blank">基础知识(面试专用)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/449114.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/449114.aspx" target="_blank">日语</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/507814.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/507814.aspx" target="_blank">算法</a></li>
<li><a href="http://blog.csdn.net/a9529lty/category/352351.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/a9529lty/category/352351.aspx" target="_blank">正则表达式</a><a href="http://writeblog.csdn.net/ArticleList.aspx" target="_blank">[编辑]</a>收藏<a href="http://blog.csdn.net/a9529lty/category/352350.aspx" target="_blank">正则表达式</a>存档* <a href="http://blog.csdn.net/a9529lty/archive/2009/10.aspx" target="_blank">2009年10月(7)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2009/09.aspx" target="_blank">2009年09月(10)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2009/07.aspx" target="_blank">2009年07月(4)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2009/06.aspx" target="_blank">2009年06月(6)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2009/05.aspx" target="_blank">2009年05月(9)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2009/04.aspx" target="_blank">2009年04月(16)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2009/03.aspx" target="_blank">2009年03月(9)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2009/02.aspx" target="_blank">2009年02月(4)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2009/01.aspx" target="_blank">2009年01月(17)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2008/12.aspx" target="_blank">2008年12月(34)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2008/11.aspx" target="_blank">2008年11月(23)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2008/10.aspx" target="_blank">2008年10月(16)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2008/09.aspx" target="_blank">2008年09月(13)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2008/08.aspx" target="_blank">2008年08月(21)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2008/07.aspx" target="_blank">2008年07月(20)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2008/06.aspx" target="_blank">2008年06月(1)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2008/05.aspx" target="_blank">2008年05月(12)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2008/04.aspx" target="_blank">2008年04月(2)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2008/03.aspx" target="_blank">2008年03月(3)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2008/01.aspx" target="_blank">2008年01月(4)</a></li>
<li><a href="http://blog.csdn.net/a9529lty/archive/2007/12.aspx" target="_blank">2007年12月(51)</a><h1 id="java-double-">java实现double的精确计算和四舍五入 <a href="&quot;收藏到我的网摘中，并分享给我的朋友&quot;">收藏</a></h1>
</li>
</ul>
<hr>
<p><strong>Java中的简单浮点数类型float和double不能够进行运算。不光是Java，在其它很多编程语言中也有这样的问题。在大多数情况下，计算的结果是准确的，但是多试几次（可以做一个循环）就可以试出类似上面的错误。现在终于理解为什么要有BCD码了。
这个问题相当严重，如果你有9.999999999999元，你的计算机是不会认为你可以购买10元的商品的。
在有的编程语言中提供了专门的货币类型来处理这种情况，但是Java没有。现在让我们看看如何解决这个问题。
四舍五入
我们的第一个反应是做四舍五入。Math类中的round方法不能设置保留几位小数，我们只能象这样（保留两位）：
public double round(double value){
    return Math.round(value/<em>100)/100.0;
}
非常不幸，上面的代码并不能正常工作，给这个方法传入4.015它将返回4.01而不是4.02，如我们在上面看到的
4.015/</em>100=401.49999999999994
因此如果我们要做到精确的四舍五入，不能利用简单类型做任何运算
java.text.DecimalFormat也不能解决这个问题：
System.out.println(new java.text.DecimalFormat(&quot;0.00&quot;).format(4.025));
输出是4.02</strong>
**java 代码</p>
<p>import java.math.BigDecimal; public class Arith { private static final int DEF_DIV_SCALE = 10; private Arith() { } //<em>/</em> /<em> 提供精确的加法运算。 /</em> @param v1 被加数 /<em> @param v2 加数 /</em> @return 两个参数的和 /<em>/ public static double add(double v1,double v2) { BigDecimal b1 = new BigDecimal(Double.toString(v1)); BigDecimal b2 = new BigDecimal(Double.toString(v2)); return b1.add(b2).doubleValue(); } //</em>/<em> /</em> 提供精确的减法运算。 /<em> @param v1 被减数 /</em> @param v2 减数 /<em> @return 两个参数的差 /</em>/ public static double sub(double v1,double v2) { BigDecimal b1 = new BigDecimal(Double.toString(v1)); BigDecimal b2 = new BigDecimal(Double.toString(v2)); return b1.subtract(b2).doubleValue(); } //<em>/</em> /<em> 提供精确的乘法运算。 /</em> @param v1 被乘数 /<em> @param v2 乘数 /</em> @return 两个参数的积 /<em>/ public static double mul(double v1,double v2) { BigDecimal b1 = new BigDecimal(Double.toString(v1)); BigDecimal b2 = new BigDecimal(Double.toString(v2)); return b1.multiply(b2).doubleValue(); } //</em>/<em> /</em> 提供（相对）精确的除法运算，当发生除不尽的情况时，精确到 /<em> 小数点以后10位，以后的数字四舍五入。 /</em> @param v1 被除数 /<em> @param v2 除数 /</em> @return 两个参数的商 /<em>/ public static double div(double v1,double v2) { return div(v1,v2,DEF_DIV_SCALE); } //</em>/<em> /</em> 提供（相对）精确的除法运算。当发生除不尽的情况时，由scale参数指 /<em> 定精度，以后的数字四舍五入。 /</em> @param v1 被除数 /<em> @param v2 除数 /</em> @param scale 表示表示需要精确到小数点以后几位。 /<em> @return 两个参数的商 /</em>/ public static double div(double v1,double v2,int scale) { if(scale&lt;0) { throw new IllegalArgumentException(&quot;The scale must be a positive integer or zero&quot;); } BigDecimal b1 = new BigDecimal(Double.toString(v1)); BigDecimal b2 = new BigDecimal(Double.toString(v2)); return b1.divide(b2,scale,BigDecimal.ROUND_HALF_UP).doubleValue(); } //<em>/</em> /<em> 提供精确的小数位四舍五入处理。 /</em> @param v 需要四舍五入的数字 /<em> @param scale 小数点后保留几位 /</em> @return 四舍五入后的结果 /<em>/ public static double round(double v,int scale){ if(scale&lt;0) { throw new IllegalArgumentException(&quot;The scale must be a positive integer or zero&quot;); } BigDecimal b = new BigDecimal(Double.toString(v)); BigDecimal one = new BigDecimal(&quot;1&quot;); return b.divide(one,scale,BigDecimal.ROUND_HALF_UP).doubleValue(); } }
*</em></p>
<p>发表于 @ 2009年05月18日　23:07:00 | <a href="http://blog.csdn.net/a9529lty/archive/2009/05/18/4199684.aspx#FeedBack" title="评论" target="_blank">评论( loading...  )</a>| <a href="http://writeblog.csdn.net/PostEdit.aspx?entryId=4199684" title="编辑" target="_blank">编辑</a>| <a href="mailto:webmaster@csdn.net?subject=Article%20Report!!!&amp;body=Author:a9529lty%0D%0AURL:http://blog.csdn.net/ArticleContent.aspx?UserName=a9529lty&amp;Entryid=4199684">举报</a>| <a href="&quot;收藏到我的网摘中，并分享给我的朋友&quot;">收藏</a></p>
<h3 id="-http-blog-csdn-net-a9529lty-archive-2009-05-13-4179695-aspx-oracle-http-blog-csdn-net-a9529lty-archive-2009-05-27-4221509-aspx-"><a href="http://blog.csdn.net/a9529lty/archive/2009/05/13/4179695.aspx" target="_blank">旧一篇:淘宝生成预览图片</a> | <a href="http://blog.csdn.net/a9529lty/archive/2009/05/27/4221509.aspx" target="_blank">新一篇:Oracle层次查询和分析函数</a><a href=""></a></h3>
<p>Copyright © a9529ltyPowered by CSDN Blog<img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_总结类/">Java_总结类</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_总结类/" class="label label-success">Java_总结类</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:43"datetime="2014-03-07 09:54:43"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_总结类--java实现double的精确计算和四舍五入/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_总结类--java实现double的精确计算和四舍五入" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_总结类--jsp-servlet技术：一篇写的详细的sessi___1_javanewlearner的空间/">jsp</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:43.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_总结类--jsp-servlet技术：一篇写的详细的sessi___1_javanewlearner的空间/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="jsp-servlet-sessi___-1-_javanewlearner-_-">jsp-servlet技术：一篇写的详细的sessi<em>__(1)_javanewlearner的空间</em>百度空间</h1>
<p><a href="http://hi.baidu.com/"></a></p>
<ul>
<li><a href="http://hi.baidu.com/index" target="_blank">广场</a></li>
<li><a href="https://passport.baidu.com/center" target="_blank">jywv</a>
*</li>
<li><a href="https://passport.baidu.com/?logout&amp;bdstoken=aa9855a9aad4216b27441b12182ad1a7&amp;u=http://hi.baidu.com/yrynxtecldbjmxq/item/a733704e39f5f4d8c1a59298" target="_blank">退出</a>
<a href="http://hi.baidu.com/yrynxtecldbjmxq/item/a733704e39f5f4d8c1a59298#" target="_blank">关注此空间</a></li>
</ul>
<h1 id="-javanewlearner-http-hi-baidu-com-new-yrynxtecldbjmxq-"><a href="http://hi.baidu.com/new/yrynxtecldbjmxq" target="_blank">javanewlearner的空间</a></h1>
<p>2012-02-25 16:24</p>
<h2 id="jsp-servlet-sessi-1-">jsp-servlet技术：一篇写的详细的sessi...(1)</h2>
<p>摘要：虽然session机制在web应用程序中被采用已经很长时间了，但是仍然有很多人不清楚session机制的本质，以至不能正确的应用这一技术。本文将详细讨论session的工作机制并且对在Java web application中应用session机制时常见的问题作出解答。</p>
<p><strong>一、术语session</strong></p>
<p>在我的经验里，session这个词被滥用的程度大概仅次于transaction，更加有趣的是transaction与session在某些语境下的含义是相同的。</p>
<p>session，中文经常翻译为会话，其本来的含义是指有始有终的一系列动作/消息，比如打电话时从拿起电话拨号到挂断电话这中间的一系列过程可以称之为一个session。有时候我们可以看到这样的话“在一个浏览器会话期间，...”，这里的会话一词用的就是其本义，是指从一个浏览器窗口打开到关闭这个期间①。最混乱的是“用户（客户端）在一次会话期间”这样一句话，它可能指用户的一系列动作（一般情况下是同某个具体目的相关的一系列动作，比如从登录到选购商品到结账登出这样一个网上购物的过程，有时候也被称为一个transaction），然而有时候也可能仅仅是指一次连接，也有可能是指含义①，其中的差别只能靠上下文来推断②。</p>
<p>然而当session一词与网络协议相关联时，它又往往隐含了“面向连接”和/或“保持状态”这样两个含义，“面向连接”指的是在通信双方在通信之前要先建立一个通信的渠道，比如打电话，直到对方接了电话通信才能开始，与此相对的是写信，在你把信发出去的时候你并不能确认对方的地址是否正确，通信渠道不一定能建立，但对发信人来说，通信已经开始了。“保持状态”则是指通信的一方能够把一系列的消息关联起来，使得消息之间可以互相依赖，比如一个服务员能够认出再次光临的老顾客并且记得上次这个顾客还欠店里一块钱。这一类的例子有“一个TCP session”或者“一个POP3 session”③。</p>
<p>而到了web服务器蓬勃发展的时代，session在web开发语境下的语义又有了新的扩展，它的含义是指一类用来在客户端与服务器之间保持状态的解决方案④。有时候session也用来指这种解决方案的存储结构，如“把xxx保存在session里”⑤。由于各种用于web开发的语言在一定程度上都提供了对这种解决方案的支持，所以在某种特定语言的语境下，session也被用来指代该语言的解决方案，比如经常把Java里提供的javax.servlet.http.HttpSession简称为session⑥。</p>
<p>鉴于这种混乱已不可改变，本文中session一词的运用也会根据上下文有不同的含义，请大家注意分辨。</p>
<p>在本文中，使用中文“浏览器会话期间”来表达含义①，使用“session机制”来表达含义④，使用“session”表达含义⑤，使用具体的“HttpSession”来表达含义⑥</p>
<p><strong>二、HTTP协议与状态保持</strong></p>
<p>HTTP协议本身是无状态的，这与HTTP协议本来的目的是相符的，客户端只需要简单的向服务器请求下载某些文件，无论是客户端还是服务器都没有必要纪录彼此过去的行为，每一次请求之间都是独立的，好比一个顾客和一个自动售货机或者一个普通的（非会员制）大卖场之间的关系一样。</p>
<p>然而聪明（或者贪心？）的人们很快发现如果能够提供一些按需生成的动态信息会使web变得更加有用，就像给有线电视加上点播功能一样。这种需求一方面迫使HTML逐步添加了表单、脚本、DOM等客户端行为，另一方面在服务器端则出现了CGI规范以响应客户端的动态请求，作为传输载体的HTTP协议也添加了文件上载、cookie这些特性。其中cookie的作用就是为了解决HTTP协议无状态的缺陷所作出的努力。至于后来出现的session机制则是又一种在客户端与服务器之间保持状态的解决方案。</p>
<p>让我们用几个例子来描述一下cookie和session机制之间的区别与联系。笔者曾经常去的一家咖啡店有喝5杯咖啡免费赠一杯咖啡的优惠，然而一次性消费5杯咖啡的机会微乎其微，这时就需要某种方式来纪录某位顾客的消费数量。想象一下其实也无外乎下面的几种方案：</p>
<p>1、该店的店员很厉害，能记住每位顾客的消费数量，只要顾客一走进咖啡店，店员就知道该怎么对待了。这种做法就是协议本身支持状态。</p>
<p>2、发给顾客一张卡片，上面记录着消费的数量，一般还有个有效期限。每次消费时，如果顾客出示这张卡片，则此次消费就会与以前或以后的消费相联系起来。这种做法就是在客户端保持状态。</p>
<p>3、发给顾客一张会员卡，除了卡号之外什么信息也不纪录，每次消费时，如果顾客出示该卡片，则店员在店里的纪录本上找到这个卡号对应的纪录添加一些消费信息。这种做法就是在服务器端保持状态。</p>
<p>由于HTTP协议是无状态的，而出于种种考虑也不希望使之成为有状态的，因此，后面两种方案就成为现实的选择。具体来说cookie机制采用的是在客户端保持状态的方案，而session机制采用的是在服务器端保持状态的方案。同时我们也看到，由于采用服务器端保持状态的方案在客户端也需要保存一个标识，所以session机制可能需要借助于cookie机制来达到保存标识的目的，但实际上它还有其他选择。</p>
<p><strong>三、理解cookie机制</strong></p>
<p>cookie机制的基本原理就如上面的例子一样简单，但是还有几个问题需要解决：“会员卡”如何分发；“会员卡”的内容；以及客户如何使用“会员卡”。</p>
<p>正统的cookie分发是通过扩展HTTP协议来实现的，服务器通过在HTTP的响应头中加上一行特殊的指示以提示浏览器按照指示生成相应的cookie。然而纯粹的客户端脚本如JavaScript或者VBScript也可以生成cookie。</p>
<p>而cookie的使用是由浏览器按照一定的原则在后台自动发送给服务器的。浏览器检查所有存储的cookie，如果某个cookie所声明的作用范围大于等于将要请求的资源所在的位置，则把该cookie附在请求资源的HTTP请求头上发送给服务器。意思是麦当劳的会员卡只能在麦当劳的店里出示，如果某家分店还发行了自己的会员卡，那么进这家店的时候除了要出示麦当劳的会员卡，还要出示这家店的会员卡。</p>
<p>cookie的内容主要包括：名字，值，过期时间，路径和域。</p>
<p>其中域可以指定某一个域比如.google.com，相当于总店招牌，比如宝洁公司，也可以指定一个域下的具体某台机器比如www.google.com或者froogle.google.com，可以用飘柔来做比。</p>
<p>路径就是跟在域名后面的URL路径，比如/或者/foo等等，可以用某飘柔专柜做比。</p>
<p>路径与域合在一起就构成了cookie的作用范围。</p>
<p>如果不设置过期时间，则表示这个cookie的生命期为浏览器会话期间，只要关闭浏览器窗口，cookie就消失了。这种生命期为浏览器会话期的cookie被称为会话cookie。会话cookie一般不存储在硬盘上而是保存在内存里，当然这种行为并不是规范规定的。如果设置了过期时间，浏览器就会把cookie保存到硬盘上，关闭后再次打开浏览器，这些cookie仍然有效直到超过设定的过期时间。</p>
<p>存储在硬盘上的cookie可以在不同的浏览器进程间共享，比如两个IE窗口。而对于保存在内存里的cookie，不同的浏览器有不同的处理方式。对于IE，在一个打开的窗口上按Ctrl-N（或者从文件菜单）打开的窗口可以与原窗口共享，而使用其他方式新开的IE进程则不能共享已经打开的窗口的内存cookie；对于Mozilla Firefox0.8，所有的进程和标签页都可以共享同样的cookie。一般来说是用javascript的window.open打开的窗口会与原窗口共享内存cookie。浏览器对于会话cookie的这种只认cookie不认人的处理方式经常给采用session机制的web应用程序开发者造成很大的困扰。</p>
<p>下面就是一个goolge设置cookie的响应头的例子</p>
<p>HTTP/1.1 302 Found
Location: <a href="http://www.google.com/intl/zh-CN/" target="_blank">http://www.google.com/intl/zh-CN/</a>
Set-Cookie: PREF=ID=0565f77e132de138:NW=1:TM=1098082649:LM=1098082649:S=KaeaCFPo49RiA_d8; expires=Sun, 17-Jan-2038 19:14:07 GMT; path=/; domain=.google.com
Content-Type: text/html</p>
<p><img src="" alt=""></p>
<p>这是使用HTTPLook这个HTTP Sniffer软件来俘获的HTTP通讯纪录的一部分</p>
<p><img src="" alt=""></p>
<p>浏览器在再次访问goolge的资源时自动向外发送cookie</p>
<p><img src="" alt=""></p>
<p>使用Firefox可以很容易的观察现有的cookie的值</p>
<p>使用HTTPLook配合Firefox可以很容易的理解cookie的工作原理。</p>
<p><img src="" alt=""></p>
<p>IE也可以设置在接受cookie前询问</p>
<p><img src="" alt=""></p>
<p>这是一个询问接受cookie的对话框。</p>
<p><strong>四、理解session机制</strong></p>
<p>session机制是一种服务器端的机制，服务器使用一种类似于散列表的结构（也可能就是使用散列表）来保存信息。</p>
<p>当程序需要为某个客户端的请求创建一个session的时候，服务器首先检查这个客户端的请求里是否已包含了一个session标识 - 称为session id，如果已包含一个session id则说明以前已经为此客户端创建过session，服务器就按照session id把这个session检索出来使用（如果检索不到，可能会新建一个），如果客户端请求不包含session id，则为此客户端创建一个session并且生成一个与此session相关联的session id，session id的值应该是一个既不会重复，又不容易被找到规律以仿造的字符串，这个session id将被在本次响应中返回给客户端保存。</p>
<p>保存这个session id的方式可以采用cookie，这样在交互过程中浏览器可以自动的按照规则把这个标识发挥给服务器。一般这个cookie的名字都是类似于SEEESIONID，而。比如weblogic对于web应用程序生成的cookie，JSESSIONID=ByOK3vjFD75aPnrF7C2HmdnV6QZcEbzWoWiBYEnLerjQ99zWpBng!-145788764，它的名字就是JSESSIONID。</p>
<p>由于cookie可以被人为的禁止，必须有其他机制以便在cookie被禁止时仍然能够把session id传递回服务器。经常被使用的一种技术叫做URL重写，就是把session id直接附加在URL路径的后面，附加方式也有两种，一种是作为URL路径的附加信息，表现形式为<a href="http://...../xxx;jsessionid=ByOK3vjFD75aPnrF7C2HmdnV6QZcEbzWoWiBYEnLerjQ99zWpBng!-145788764另一种是作为查询字符串附加在URL后面，表现形式为http://...../xxx?jsessionid=ByOK3vjFD75aPnrF7C2HmdnV6QZcEbzWoWiBYEnLerjQ99zWpBng!-145788764" target="_blank">http://...../xxx;jsessionid=ByOK3vjFD75aPnrF7C2HmdnV6QZcEbzWoWiBYEnLerjQ99zWpBng!-145788764另一种是作为查询字符串附加在URL后面，表现形式为http://...../xxx?jsessionid=ByOK3vjFD75aPnrF7C2HmdnV6QZcEbzWoWiBYEnLerjQ99zWpBng!-145788764</a>
这两种方式对于用户来说是没有区别的，只是服务器在解析的时候处理的方式不同，采用第一种方式也有利于把session id的信息和正常程序参数区分开来。</p>
<p>为了在整个交互过程中始终保持状态，就必须在每个客户端可能请求的路径后面都包含这个session id。</p>
<p>另一种技术叫做表单隐藏字段。就是服务器会自动修改表单，添加一个隐藏字段，以便在表单提交时能够把session id传递回服务器。比如下面的表单</p>
<form name="testform" action="/xxx">
<input type="text">
</form>

<p>在被传递给客户端之前将被改写成</p>
<form name="testform" action="/xxx">
<input type="hidden" name="jsessionid" value="ByOK3vjFD75aPnrF7C2HmdnV6QZcEbzWoWiBYEnLerjQ99zWpBng!-145788764">
<input type="text">
</form>

<p>这种技术现在已较少应用，笔者接触过的很古老的iPlanet6(SunONE应用服务器的前身)就使用了这种技术。实际上这种技术可以简单的用对action应用URL重写来代替。</p>
<p>在谈论session机制的时候，常常听到这样一种误解“只要关闭浏览器，session就消失了”。其实可以想象一下会员卡的例子，除非顾客主动对店家提出销卡，否则店家绝对不会轻易删除顾客的资料。对session来说也是一样的，除非程序通知服务器删除一个session，否则服务器会一直保留，程序一般都是在用户做log off的时候发个指令去删除session。然而浏览器从来不会主动在关闭之前通知服务器它将要关闭，因此服务器根本不会有机会知道浏览器已经关闭，之所以会有这种错觉，是大部分session机制都使用会话cookie来保存session id，而关闭浏览器后这个session id就消失了，再次连接服务器时也就无法找到原来的session。如果服务器设置的cookie被保存到硬盘上，或者使用某种手段改写浏览器发出的HTTP请求头，把原来的session id发送给服务器，则再次打开浏览器仍然能够找到原来的session。</p>
<p>恰恰是由于关闭浏览器不会导致session被删除，迫使服务器为seesion设置了一个失效时间，当距离客户端上一次使用session的时间超过这个失效时间时，服务器就可以认为客户端已经停止了活动，才会把session删除以节省存储空间。
<a href="http://hi.baidu.com/tag/J2ee/feeds" target="_blank">/#J2ee</a></p>
<p><a href="http://hi.baidu.com/yrynxtecldbjmxq/item/a733704e39f5f4d8c1a59298#" target="_blank">举报</a>浏览(45) <a href="http://hi.baidu.com/yrynxtecldbjmxq/item/a733704e39f5f4d8c1a59298#" target="_blank">评论</a><a href="http://hi.baidu.com/yrynxtecldbjmxq/item/a733704e39f5f4d8c1a59298#" target="_blank">转载</a></p>
<p><a href="http://hi.baidu.com/yrynxtecldbjmxq/item/3aaa4928228f59846e2cc391" title="上一篇"></a></p>
<p><a href="http://hi.baidu.com/yrynxtecldbjmxq/item/928f80073d46012da0312d9c" title="下一篇"></a>
评论
<a href="http://hi.baidu.com/go/show/introduce" target="_blank">帮助中心</a> | <a href="http://tieba.baidu.com/p/1781683739" target="_blank">空间客服</a> | <a href="http://tousu.baidu.com/hi/add" target="_blank">投诉中心</a> | <a href="http://www.baidu.com/search/hi_contract.html" target="_blank">空间协议</a></p>
<p>©2012 Baidu</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_总结类/">Java_总结类</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_总结类/" class="label label-success">Java_总结类</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:43"datetime="2014-03-07 09:54:43"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_总结类--jsp-servlet技术：一篇写的详细的sessi___1_javanewlearner的空间/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_总结类--jsp-servlet技术：一篇写的详细的sessi___1_javanewlearner的空间" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_总结类--sessionId产生方法参考-balaschen-JavaEye技术网站/">sessionId产生方法参考 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:43.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_总结类--sessionId产生方法参考-balaschen-JavaEye技术网站/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="sessionid-balaschen-javaeye-">sessionId产生方法参考 - balaschen - JavaEye技术网站</h1>
<p><a href="http://www.javaeye.com/" target="_blank">首页</a> <a href="http://www.javaeye.com/news" target="_blank">新闻</a> <a href="http://www.javaeye.com/forums" target="_blank">论坛</a> <a href="http://www.javaeye.com/ask" target="_blank">问答</a> <a href="http://www.javaeye.com/blogs" target="_blank">博客</a> <a href="http://www.javaeye.com/job" target="_blank">招聘</a> <a href="http://balaschen.javaeye.com/blog/83882#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.javaeye.com/wiki" target="_blank">专栏</a> <a href="http://www.javaeye.com/articles" target="_blank">文摘</a> <a href="http://www.javaeye.com/groups" target="_blank">圈子</a> <a href="http://www.javaeye.com/google_search" target="_blank">搜索</a></p>
<p><a href="http://balaschen.javaeye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.javaeye.com/all" target="_blank">我的应用</a> <a href="http://balaschen.javaeye.com/login" target="_blank">登录</a> <a href="http://balaschen.javaeye.com/signup" target="_blank">注册</a></p>
<h1 id="-balaschen-http-balaschen-javaeye-com-"><a href="http://balaschen.javaeye.com/" target="_blank">balaschen</a></h1>
<p>永久域名 <a href="http://balaschen.javaeye.com/" target="_blank"><a href="http://balaschen.javaeye.com/">http://balaschen.javaeye.com/</a></a></p>
<p><a href="http://balaschen.javaeye.com/blog/72498" title="rad rail plugin" target="_blank">rad rail plugin</a> | <a href="http://balaschen.javaeye.com/blog/81611" title="Spring Hibernate SessionFactory配置" target="_blank">Spring Hibernate SessionFactory配置</a></p>
<p>2007-05-28</p>
<h3 id="-sessionid-http-balaschen-javaeye-com-blog-83882-"><a href="http://balaschen.javaeye.com/blog/83882" target="_blank">sessionId产生方法参考</a></h3>
<p>tomcat
java 代码</p>
<ol>
<li>protected synchronized String generateSessionId() {   </li>
<li></li>
<li>byte random[] = new byte[16];   </li>
<li></li>
<li>// Render the result as a String of hexadecimal digits   </li>
<li>StringBuffer result = new StringBuffer();   </li>
<li>int resultLenBytes = 0;   </li>
<li>while (resultLenBytes &lt; this.sessionIdLength) {   </li>
<li>getRandomBytes(random);   </li>
<li>random = getDigest().digest(random);   </li>
<li>for (int j = 0;   </li>
<li>j &lt; random.length &amp;&amp; resultLenBytes &lt; this.sessionIdLength;   </li>
<li>j++) {   </li>
<li>byte b1 = (byte) ((random[j] &amp; 0xf0) &gt;&gt; 4);   </li>
<li>byte b2 = (byte) (random[j] &amp; 0x0f);   </li>
<li>if (b1 &lt; 10)   </li>
<li>result.append((char) (&#39;0&#39; + b1));   </li>
<li>else  </li>
<li>result.append((char) (&#39;A&#39; + (b1 - 10)));   </li>
<li>if (b2 &lt; 10)   </li>
<li>result.append((char) (&#39;0&#39; + b2));   </li>
<li>else  </li>
<li>result.append((char) (&#39;A&#39; + (b2 - 10)));   </li>
<li>resultLenBytes++;   </li>
<li>}   </li>
<li>}   </li>
<li>return (result.toString());   </li>
<li></li>
<li>}  </li>
</ol>
<p>hibernate uuid：
java 代码</p>
<ol>
<li>public abstract class AbstractUUIDGenerator implements IdentifierGenerator {   </li>
<li></li>
<li>private static final int IP;   </li>
<li>static {   </li>
<li>int ipadd;   </li>
<li>try {   </li>
<li>ipadd = BytesHelper.toInt( InetAddress.getLocalHost().getAddress() );   </li>
<li>}   </li>
<li>catch (Exception e) {   </li>
<li>ipadd = 0;   </li>
<li>}   </li>
<li>IP = ipadd;   </li>
<li>}   </li>
<li>private static short counter = (short) 0;   </li>
<li>private static final int JVM = (int) ( System.currentTimeMillis() &gt;&gt;&gt; 8 );   </li>
<li></li>
<li>public AbstractUUIDGenerator() {   </li>
<li>}   </li>
<li></li>
<li>//<em>/</em>  </li>
<li>/* Unique across JVMs on this machine (unless they load this class  </li>
<li>/* in the same quater second - very unlikely)  </li>
<li>/*/  </li>
<li>protected int getJVM() {   </li>
<li>return JVM;   </li>
<li>}   </li>
<li></li>
<li>//<em>/</em>  </li>
<li>/* Unique in a millisecond for this JVM instance (unless there  </li>
<li>/* are &gt; Short.MAX_VALUE instances created in a millisecond)  </li>
<li>/*/  </li>
<li>protected short getCount() {   </li>
<li>synchronized(AbstractUUIDGenerator.class) {   </li>
<li>if (counter&lt;0) counter=0;   </li>
<li>return counter++;   </li>
<li>}   </li>
<li>}   </li>
<li></li>
<li>//<em>/</em>  </li>
<li>/* Unique in a local network  </li>
<li>/*/  </li>
<li>protected int getIP() {   </li>
<li>return IP;   </li>
<li>}   </li>
<li></li>
<li>//<em>/</em>  </li>
<li>/* Unique down to millisecond  </li>
<li>/*/  </li>
<li>protected short getHiTime() {   </li>
<li>return (short) ( System.currentTimeMillis() &gt;&gt;&gt; 32 );   </li>
<li>}   </li>
<li>protected int getLoTime() {   </li>
<li>return (int) System.currentTimeMillis();   </li>
<li>}   </li>
<li></li>
<li></li>
<li>}   </li>
<li></li>
<li>public class UUIDHexGenerator extends AbstractUUIDGenerator implements Configurable {   </li>
<li></li>
<li>private String sep = &quot;&quot;;   </li>
<li></li>
<li>protected String format(int intval) {   </li>
<li>String formatted = Integer.toHexString(intval);   </li>
<li>StringBuffer buf = new StringBuffer(&quot;00000000&quot;);   </li>
<li>buf.replace( 8-formatted.length(), 8, formatted );   </li>
<li>return buf.toString();   </li>
<li>}   </li>
<li></li>
<li>protected String format(short shortval) {   </li>
<li>String formatted = Integer.toHexString(shortval);   </li>
<li>StringBuffer buf = new StringBuffer(&quot;0000&quot;);   </li>
<li>buf.replace( 4-formatted.length(), 4, formatted );   </li>
<li>return buf.toString();   </li>
<li>}   </li>
<li></li>
<li>public Serializable generate(SessionImplementor session, Object obj) {   </li>
<li>return new StringBuffer(36)   </li>
<li>.append( format( getIP() ) ).append(sep)   </li>
<li>.append( format( getJVM() ) ).append(sep)   </li>
<li>.append( format( getHiTime() ) ).append(sep)   </li>
<li>.append( format( getLoTime() ) ).append(sep)   </li>
<li>.append( format( getCount() ) )   </li>
<li>.toString();   </li>
<li>}   </li>
<li></li>
<li>public void configure(Type type, Properties params, Dialect d) {   </li>
<li>sep = PropertiesHelper.getString(&quot;separator&quot;, params, &quot;&quot;);   </li>
<li>}   </li>
<li></li>
<li>public static void main( String[] args ) throws Exception {   </li>
<li>Properties props = new Properties();   </li>
<li>props.setProperty(&quot;separator&quot;, &quot;/&quot;);   </li>
<li>IdentifierGenerator gen = new UUIDHexGenerator();   </li>
<li>( (Configurable) gen ).configure(Hibernate.STRING, props, null);   </li>
<li>IdentifierGenerator gen2 = new UUIDHexGenerator();   </li>
<li>( (Configurable) gen2 ).configure(Hibernate.STRING, props, null);   </li>
<li></li>
<li>for ( int i=0; i&lt;10; i++) {   </li>
<li>String id = (String) gen.generate(null, null);   </li>
<li>System.out.println(id);   </li>
<li>String id2 = (String) gen2.generate(null, null);   </li>
<li>System.out.println(id2);   </li>
<li>}   </li>
<li></li>
<li>}   </li>
<li></li>
<li>}<br><a href="http://balaschen.javaeye.com/blog/72498" title="rad rail plugin" target="_blank">rad rail plugin</a> | <a href="http://balaschen.javaeye.com/blog/81611" title="Spring Hibernate SessionFactory配置" target="_blank">Spring Hibernate SessionFactory配置</a></li>
</ol>
<ul>
<li>13:41</li>
<li>浏览 (870)</li>
<li><a href="http://balaschen.javaeye.com/blog/83882#comments" target="_blank">评论</a> (0)</li>
<li><a href="http://www.javaeye.com/wiki/topic/83882" target="_blank">相关推荐</a><h3 id="-">评论</h3>
</li>
</ul>
<p><a href=""></a></p>
<h3 id="-">发表评论</h3>
<p>您还没有登录，请<a href="http://balaschen.javaeye.com/login" target="_blank">登录</a>后发表评论(快捷键 Alt+S / Ctrl+Enter)</p>
<p><a href="http://balaschen.javaeye.com/" target="_blank"><img src="&quot;balaschen的博客: balaschen&quot;" alt="balaschen的博客"></a></p>
<p>balaschen</p>
<ul>
<li>浏览: 69884 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li><img src="" alt=""></li>
<li><a href="http://balaschen.javaeye.com/blog/profile" target="_blank">详细资料</a> <a href="http://balaschen.javaeye.com/blog/guest_book" target="_blank">留言簿</a></li>
</ul>
<h3 id="-">搜索本博客</h3>
<h3 id="-http-balaschen-javaeye-com-blog-user_visits-">最近访客 <a href="http://balaschen.javaeye.com/blog/user_visits" target="_blank">&gt;&gt;更多访客</a></h3>
<p><a href="http://wangzhongjie.javaeye.com/" target="_blank"><img src="&quot;wangzhongjie的博客: wangzhongjie&quot;" alt="wangzhongjie的博客"></a></p>
<p><a href="http://wangzhongjie.javaeye.com/" target="_blank">wangzhongjie</a></p>
<p><a href="http://yqwan.javaeye.com/" target="_blank"><img src="&quot;yqwan的博客: &quot;" alt="yqwan的博客"></a></p>
<p><a href="http://yqwan.javaeye.com/" target="_blank">yqwan</a>
<a href="http://icecityman.javaeye.com/" target="_blank"><img src="&quot;icecityman的博客: &quot;" alt="icecityman的博客"></a></p>
<p><a href="http://icecityman.javaeye.com/" target="_blank">icecityman</a></p>
<p><a href="http://chilongxph.javaeye.com/" target="_blank"><img src="&quot;chilongxph的博客: &quot;" alt="chilongxph的博客"></a></p>
<p><a href="http://chilongxph.javaeye.com/" target="_blank">chilongxph</a></p>
<h3 id="-">博客分类</h3>
<ul>
<li><a href="http://balaschen.javaeye.com/" target="_blank">全部博客 (51)</a></li>
<li><a href="http://balaschen.javaeye.com/category/25461" target="_blank">生活 (0)</a></li>
<li><a href="http://balaschen.javaeye.com/category/22646" target="_blank">ror (3)</a></li>
<li><a href="http://balaschen.javaeye.com/category/13760" target="_blank">综合 (18)</a></li>
<li><a href="http://balaschen.javaeye.com/category/14027" target="_blank">spring (2)</a></li>
<li><a href="http://balaschen.javaeye.com/category/25457" target="_blank">MVC (3)</a></li>
<li><a href="http://balaschen.javaeye.com/category/25458" target="_blank">测试 (3)</a></li>
<li><a href="http://balaschen.javaeye.com/category/25459" target="_blank">hibernate (1)</a></li>
<li><a href="http://balaschen.javaeye.com/category/25460" target="_blank">系统(安装配置) (3)</a></li>
<li><p><a href="http://balaschen.javaeye.com/category/38240" target="_blank">asp.net (3)</a></p>
<h3 id="-">其他分类</h3>
</li>
<li><p><a href="http://balaschen.javaeye.com/blog/favorite" target="_blank">我的收藏</a> (156)</p>
</li>
<li><a href="http://balaschen.javaeye.com/blog/topic" target="_blank">我的论坛主题贴</a> (63)</li>
<li><a href="http://balaschen.javaeye.com/blog/post" target="_blank">我的所有论坛贴</a> (203)</li>
<li><a href="http://balaschen.javaeye.com/blog/article" target="_blank">我的精华良好贴</a> (3)</li>
</ul>
<h3 id="-">最近加入圈子</h3>
<ul>
<li><a href="http://seam.group.javaeye.com/" target="_blank">JBoss SEAM</a></li>
<li><p><a href="http://wfp.group.javaeye.com/" target="_blank">函数式编程の道</a></p>
<h3 id="-">存档</h3>
</li>
<li><p><a href="http://balaschen.javaeye.com/blog/monthblog/2008-08" target="_blank">2008-08</a> (2)</p>
</li>
<li><a href="http://balaschen.javaeye.com/blog/monthblog/2008-02" target="_blank">2008-02</a> (1)</li>
<li><a href="http://balaschen.javaeye.com/blog/monthblog/2008-01" target="_blank">2008-01</a> (5)</li>
<li><a href="http://balaschen.javaeye.com/blog/monthblog_more" target="_blank">更多存档...</a></li>
</ul>
<h3 id="-">最新评论</h3>
<ul>
<li><a href="http://balaschen.javaeye.com/blog/51591#comments" title="FreeMarker解析字符串模板" target="_blank">FreeMarker解析字符串模板</a>
Map valuesMap = HashMap(); valuesMap.put( ...
-- by <a href="http://loveexception.javaeye.com/" target="_blank">抛出异常的爱</a></li>
<li><a href="http://balaschen.javaeye.com/blog/89107#comments" title="添加用户、修改ad密码" target="_blank">添加用户、修改ad密码</a>
是的，确实是证书没正确导入。后来我解决了。请问，我能不能添加或删除一个Group ...
-- by <a href="http://leecupn.javaeye.com/" target="_blank">Leecupn</a></li>
<li><a href="http://balaschen.javaeye.com/blog/89107#comments" title="添加用户、修改ad密码" target="_blank">添加用户、修改ad密码</a>
应该是证书没正确导入到keyStord指定的位置
-- by <a href="http://balaschen.javaeye.com/" target="_blank">balaschen</a></li>
<li><a href="http://balaschen.javaeye.com/blog/89107#comments" title="添加用户、修改ad密码" target="_blank">添加用户、修改ad密码</a>
你这明显是SSL没配置好。
-- by <a href="http://balaschen.javaeye.com/" target="_blank">balaschen</a></li>
<li><p><a href="http://balaschen.javaeye.com/blog/89107#comments" title="添加用户、修改ad密码" target="_blank">添加用户、修改ad密码</a>
你好，我用你的方法，但是不知道怎么搞的，报以下异常: Exception in ...
-- by <a href="http://leecupn.javaeye.com/" target="_blank">Leecupn</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://balaschen.javaeye.com/rss" target="_blank"><img src="" alt="Rss"></a></p>
</li>
<li><a href="http://fusion.google.com/add?feedurl=http://balaschen.javaeye.com/rss" target="_blank"><img src="" alt="Rss_google"></a></li>
<li><a href="http://www.xianguo.com/subscribe.php?url=http://balaschen.javaeye.com/rss" target="_blank"><img src="" alt="Rss_xianguo"></a></li>
<li><a href="http://www.google.com/search?hl=zh-CN&amp;q=RSS" target="_blank">[什么是RSS?]</a></li>
</ul>
<p>声明：JavaEye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2009 JavaEye.com. All rights reserved. 上海炯耐计算机软件有限公司 [ 沪ICP备05023328号 ]</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_总结类/">Java_总结类</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_总结类/" class="label label-success">Java_总结类</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:43"datetime="2014-03-07 09:54:43"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_总结类--sessionId产生方法参考-balaschen-JavaEye技术网站/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_总结类--sessionId产生方法参考-balaschen-JavaEye技术网站" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_总结类--为什么要使用集合框架？--ITeye技术网站/">为什么要使用集合框架？ </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:43.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_总结类--为什么要使用集合框架？--ITeye技术网站/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-iteye-">为什么要使用集合框架？ - - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">新闻</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://java-mzd.iteye.com/blog/1002387#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/wiki" target="_blank">专栏</a>  <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://java-mzd.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/all" target="_blank">我的应用</a> <a href="http://java-mzd.iteye.com/login" target="_blank">登录</a> <a href="http://java-mzd.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-java-mzd-http-java-mzd-iteye-com-"><a href="http://java-mzd.iteye.com/" target="_blank">java-mzd</a></h1>
<p>永久域名 <a href="http://java-mzd.iteye.com/" target="_blank"><a href="http://java-mzd.iteye.com">http://java-mzd.iteye.com</a></a></p>
<p><a href="http://java-mzd.iteye.com/blog/1002387#" target="_blank">13顶</a>
<a href="http://java-mzd.iteye.com/blog/1002387#" target="_blank">5踩</a></p>
<p><a href="http://java-mzd.iteye.com/blog/1004784" title="淘宝武汉*面试归来" target="_blank">淘宝武汉/*面试归来</a> | <a href="http://java-mzd.iteye.com/blog/945822" title="湖南大学生软件联盟官网建设" target="_blank">湖南大学生软件联盟官网建设</a></p>
<p>2011-04-14</p>
<h3 id="-"><a href="">为什么要使用集合框架？</a></h3>
<p><strong>文章分类:<a href="http://www.iteye.com/blogs/category/java" target="_blank">Java编程</a></strong>
  题序：<strong>很多时候，我们专心研究一个东西的时候，往往忘记了我们最初的目的是什么。</strong></p>
<pre><code>    曾经研究过那么久的Java集合框架，为了搞清里面的细节，甚至都跑去重新买了一本数据结构，终于知道了线性表，知道了树，知道了查找表。也自己动手实现了ArrayList，LinkedList，HashMap等。

    今天在公交车上，突然想到“**我们为什么要使用****Java****集合框架呢？**”竟然一时语塞，半天想不起来，也说不出个所以然呢。顿时悲从中来啊。还是决定再次好好复习一把，现总结如下：
</code></pre><p><strong>    PS.还是那句老话，如果这些问题您都能轻松解答，没必要再浪费时间看下去了。</strong></p>
<ul>
<li><strong>Question one：我们为什么要使用集合框架？</strong></li>
<li><strong>Question two:关于ArrayList 和Vector  （HashMap和HashTable）PS</strong></li>
<li><strong>Question three：总体把握，集合框架的继承图</strong></li>
<li><strong>Question four：set 于map的关系（见李兴华书）</strong></li>
<li><strong>Question five：关于set（底层实现，关于TreeSet，关于排序，关于比较对象相等）</strong></li>
<li><strong>Question six： 已经存在了那么多的动态结构，为什么需要hash表？</strong></li>
<li><strong>Question seven：TreeMap 底层实现</strong></li>
</ul>
<p>Question One：我们为什么使用集合框架？</p>
<p>  大家还记得我们为什么要使用数组嘛？</p>
<p>  当我们需要保持一组一样（类型相同）的元素的时候，我们应该使用一个容器来保存，数组就是这样一个容器。</p>
<p>  那么，数组的缺点是什么呢？</p>
<p>  数组一旦定义，长度将不能再变化。</p>
<p>  然而在我们的开发实践中，经常需要保存一些变长的数据集合，于是，我们需要一些能够<strong>动态增长长度的容器</strong>来保存我们的数据。</p>
<p>  而我们需要对数据的保存的逻辑可能各种各样，于是就有了各种各样的数据结构。<strong>我们将数据结构在**</strong>Java中实现，于是就有了我们的集合框架。**</p>
<p>Question Two: List和Vector，HashMap和 HashTable 的区别在哪里呢？</p>
<p>前者都是在JDK1.2后推出的，在前者中，因为采用异步处理方式，性能更高。</p>
<p>（其实就是删掉了后者中操作数据{add ,remove等}时的线程同步锁，这样，效率更高了，但是却不再是线程安全的了，要线程安全，必须用户在程序中使用时自己控制。）</p>
<p>Question Three：集合框架继承图</p>
<p>本来想自己画个简图的，结果悲催的Rational Rose一直在抽风，也没时间去弄那个了。就网上Down了一个，暂且用着吧</p>
<pre><code>                                   ![]()
</code></pre><p>从这个图中，我们可以发现：Collection 接口包括List和Set两个子接口（其实还有Queue和Sorted两个子接口）</p>
<p>另外，也验证了我们前面说的，Array和Collection都是用来保存数据的容器。</p>
<p>Question Four：Set 和 Map 有什么关系？</p>
<p>从Question Three的继承图中，我们很明显的发现：Map虽然不像Set那样属 于 Collection，但是Set和Map的继承图是如此的相似。那么，他们之间到底有什么样的 关系呢？</p>
<p>从逻辑上来说：首先，如果我们只考察Map中的key，那么显然，这个key的集合就是一 个set：不能重复，无序。（Map中有keyset()的方法，能直接得到key的set）另外一 个层面，如果我们 将Map中的key何value当做一个整体，那么，显然，这个时候 的Map其实就是一个Set（在Map的实现中，都是通过一个内部类来将key和value当做 一个整体entity），</p>
<p>从代码角度本身角度来看，无论是HashSet还是TreeSet其实使用的都是对应 的Tree来实现的，我们用一个默认的Object，这样就可以存了。</p>
<p>而事实上Set的底层实现中，我们也可以发现，都是用对应的Map来实现的，只是，在每次存key-value 对的时候，都默认给了一个Object 类作为Value的默认值，</p>
<p>Question five：关于set（底层实现，关于TreeSet，关于排序，关于比较对象相等）</p>
<p>我们知道，Set是无序的，同时又是不能重复的，那么，这种不能重复性，是如何保证的呢？ 其实这个问题问的还是不到位，Question Four已经说了，底层是由Map实现的，那么都是由Map来实现的。</p>
<p><strong>为了唯一性，重点是能识别相同的元素（如何判断相等）<em>**</em></strong></p>
<p>在Java中，=号，表示内存地址相等，即是指向堆内存的同一引用，那么此时，显然两个元素是相等的。</p>
<p>当不是指向堆内存的同一引用时。<strong>我们就需要重写Object类的equals()**</strong>方法了**。在此，我们判断，如果我们需要比较的各个属性相等的话，那么则可认为这两个对象相等（关于属性相等的比较与此类似）</p>
<p>Question six： 已经存在了那么多的动态结构，为什么需要Hash表？</p>
<p>其实这个问题其实问的不恰当，应该是，有了诸如顺序表和有序表这样的静态表，诸如二叉排序树 平衡二叉树这样的动态表,为什么还需要Hash表呢?</p>
<p>因为记录在表中的<strong>位置</strong>和它的<strong>关键字</strong>之间<strong>不存在</strong>一个确定的关系。<strong>查找的过程</strong>为<strong>给定值</strong>依次和关键字集合中各个<strong>关键字</strong>进行<strong>比较</strong>。<strong>查找的效率</strong>取决于和给定值<strong>进行比较</strong>的关键字<strong>个数</strong>。</p>
<p>Question Seven: TreeMap 底层实现</p>
<p>TreeMap 底层由红黑树（Red-Black tree）实现。因为此部分内容包括算法分析，具体代码实现以及性能分析，内容比较多，所以本部分内容稍后专门用一个日志来推出。（形式类似HashMap那篇日志）</p>
<ul>
<li><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></li>
<li><p>大小: 4.4 KB</p>
</li>
<li><p><a href="http://java-mzd.iteye.com/blog/1002387#" target="_blank">查看图片附件</a>
<a href="http://java-mzd.iteye.com/blog/1002387#"><strong>13</strong>
顶</a><a href="http://java-mzd.iteye.com/blog/1002387#"><strong>5</strong>
踩</a></p>
</li>
</ul>
<p><a href="http://java-mzd.iteye.com/blog/1004784" title="淘宝武汉*面试归来" target="_blank">淘宝武汉/*面试归来</a> | <a href="http://java-mzd.iteye.com/blog/945822" title="湖南大学生软件联盟官网建设" target="_blank">湖南大学生软件联盟官网建设</a></p>
<ul>
<li>05:05</li>
<li>浏览 (3292)</li>
<li><a href="http://java-mzd.iteye.com/blog/1002387#comments" target="_blank">评论</a> (7)</li>
<li><a href="http://www.iteye.com/wiki/topic/1002387" target="_blank">相关推荐</a></li>
</ul>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<p>7 楼 <a href="http://scholers.iteye.com/" target="_blank">scholers</a> 2011-05-09   <a href="http://java-mzd.iteye.com/blog/1002387#" target="_blank">引用</a></p>
<p>重写了equals,那么必须要重写hashcode
否则在set,map中会出错，
这个也是一个规定！
6 楼 <a href="http://hastune.iteye.com/" target="_blank">hastune</a> 2011-04-22   <a href="http://java-mzd.iteye.com/blog/1002387#" target="_blank">引用</a></p>
<p>s929498110 写道</p>
<p>真的啊
打开JDK下面的src里面的源码看看、 一切就豁然开朗了
这些集合都有自己的实现机制、 了解了实现机制，他们的优缺点就一目了然了
没必要从别人对这些东西的看法理解中寻找属于自己的看法理解
源码看起来很容易的、 主要是其中有的算法需要琢磨琢磨
个人觉得需要琢磨的是怎么用好这些就行。算法的话，大可不必了。
源码有些地方也不太简单。原作者的一些思路还是可以琢磨一下吧。
如果需要自己写个容器的话，还是得想想算法吧。</p>
<p>5 楼 <a href="http://s929498110.iteye.com/" target="_blank">s929498110</a> 2011-04-22   <a href="http://java-mzd.iteye.com/blog/1002387#" target="_blank">引用</a></p>
<p>真的啊
打开JDK下面的src里面的源码看看、 一切就豁然开朗了
这些集合都有自己的实现机制、 了解了实现机制，他们的优缺点就一目了然了
没必要从别人对这些东西的看法理解中寻找属于自己的看法理解
源码看起来很容易的、 主要是其中有的算法需要琢磨琢磨
4 楼 <a href="http://yaoohfox.iteye.com/" target="_blank">yaoohfox</a> 2011-04-21   <a href="http://java-mzd.iteye.com/blog/1002387#" target="_blank">引用</a></p>
<p>写的不错。</p>
<p>3 楼 <a href="http://duriun-yahoo-cn.iteye.com/" target="_blank">Durian</a> 2011-04-19   <a href="http://java-mzd.iteye.com/blog/1002387#" target="_blank">引用</a></p>
<p>看文章，lz不是计算机专业
2 楼 <a href="http://java-mzd.iteye.com/" target="_blank">java_mzd</a> 2011-04-14   <a href="http://java-mzd.iteye.com/blog/1002387#" target="_blank">引用</a></p>
<p>悲剧了 写道</p>
<p>看来楼主没用好集合框架，看看源代码就知道了，及时它部提供，我们自己也要写，他提供了那就正好用他提供的，不用自己山寨写了
  呵呵，我水平不高，不会用。
也就明白明白道理，研究研究源码，自己写一写，检验自己懂不懂罢了。
高人面前，不敢称懂。</p>
<p>1 楼 <a href="http://feisuwoniu.iteye.com/" target="_blank">悲剧了</a> 2011-04-14   <a href="http://java-mzd.iteye.com/blog/1002387#" target="_blank">引用</a></p>
<p>看来楼主没用好集合框架，看看源代码就知道了，及时它部提供，我们自己也要写，他提供了那就正好用他提供的，不用自己山寨写了</p>
<h3 id="-">发表评论</h3>
<h3 id="-">表情图标</h3>
<p><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""></p>
<p>字体颜色: 标准深红红色橙色棕色黄色绿色橄榄青色蓝色深蓝靛蓝紫色灰色白色黑色 字体大小: 标准1 (xx-small)2 (x-small)3 (small)4 (medium)5 (large)6 (x-large)7 (xx-large) 对齐: 标准居左居中居右</p>
<p>提示：选择您需要装饰的文字, 按上列按钮即可添加上相应的标签</p>
<p>您还没有登录，请<a href="http://java-mzd.iteye.com/login" target="_blank">登录</a>后发表评论(快捷键 Alt+S / Ctrl+Enter)</p>
<p><a href="http://java-mzd.iteye.com/" target="_blank"><img src="&quot;java_mzd的博客: &quot;" alt="java_mzd的博客"></a></p>
<p>java_mzd</p>
<ul>
<li>浏览: 70748 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 长沙</li>
<li><img src="" alt=""></li>
<li><a href="http://java-mzd.iteye.com/blog/profile" target="_blank">详细资料</a> <a href="http://java-mzd.iteye.com/blog/guest_book" target="_blank">留言簿</a></li>
</ul>
<h3 id="-">搜索本博客</h3>
<h3 id="-http-java-mzd-iteye-com-blog-user_visits-">最近访客 <a href="http://java-mzd.iteye.com/blog/user_visits" target="_blank">&gt;&gt;更多访客</a></h3>
<p><a href="http://zhxing.iteye.com/" target="_blank"><img src="&quot;zhxing的博客: ヾ孤星随缘ツ  http://t.sina.com.cn/samzhxing&quot;" alt="zhxing的博客"></a></p>
<p><a href="http://zhxing.iteye.com/" target="_blank">zhxing</a></p>
<p><a href="http://java-suddy.iteye.com/" target="_blank"><img src="&quot;java_suddy的博客: “平凡”的思想&quot;" alt="java_suddy的博客"></a></p>
<p><a href="http://java-suddy.iteye.com/" target="_blank">java_suddy</a>
<a href="http://liuxinglanyue.iteye.com/" target="_blank"><img src="&quot;liuxinglanyue的博客: liuxinglanyue&quot;" alt="liuxinglanyue的博客"></a></p>
<p><a href="http://liuxinglanyue.iteye.com/" target="_blank">liuxinglanyue</a></p>
<p><a href="http://libo-591.iteye.com/" target="_blank"><img src="&quot;libo_591的博客: 让更多的人站在巨人的肩膀上&quot;" alt="libo_591的博客"></a></p>
<p><a href="http://libo-591.iteye.com/" target="_blank">libo_591</a></p>
<h3 id="-">博客分类</h3>
<ul>
<li><a href="http://java-mzd.iteye.com/" target="_blank">全部博客 (43)</a></li>
<li><a href="http://java-mzd.iteye.com/category/133623" target="_blank">数据结构----------JAVA类集 (5)</a></li>
<li><p><a href="http://java-mzd.iteye.com/category/153171" target="_blank">TCP/IP (7)</a></p>
<h3 id="-http-java-mzd-iteye-com-blog-guest_book-">我的留言簿 <a href="http://java-mzd.iteye.com/blog/guest_book" target="_blank">&gt;&gt;更多留言</a></h3>
</li>
<li><p>楼主 你工作多久了。。。。
-- by <a href="http://java-mzd.iteye.com/blog/guest_book#39913" target="_blank">fanmingxing</a></p>
</li>
<li>写的不错，学习，谢谢！
-- by <a href="http://java-mzd.iteye.com/blog/guest_book#39693" target="_blank">chenge2k</a></li>
<li>看了LZ的文章，发现工作快两年的我，就像是一块浮起来的木头，真的很惭愧！也不怪我拿 ...
-- by <a href="http://java-mzd.iteye.com/blog/guest_book#39618" target="_blank">GoTiger</a></li>
</ul>
<h3 id="-">其他分类</h3>
<ul>
<li><a href="http://java-mzd.iteye.com/blog/favorite" target="_blank">我的收藏</a> (23)</li>
<li><a href="http://java-mzd.iteye.com/blog/code_favorite" target="_blank">我的代码</a> (0)</li>
<li><a href="http://java-mzd.iteye.com/blog/topic" target="_blank">我的论坛主题帖</a> (3)</li>
<li><a href="http://java-mzd.iteye.com/blog/post" target="_blank">我的所有论坛帖</a> (37)</li>
<li><p><a href="http://java-mzd.iteye.com/blog/article" target="_blank">我的精华良好帖</a> (0)</p>
<h3 id="-">最近加入群组</h3>
</li>
<li><p><a href="http://android.group.iteye.com/" target="_blank">Android</a></p>
</li>
</ul>
<h3 id="-">存档</h3>
<ul>
<li><a href="http://java-mzd.iteye.com/blog/monthblog/2011-05" target="_blank">2011-05</a> (2)</li>
<li><a href="http://java-mzd.iteye.com/blog/monthblog/2011-04" target="_blank">2011-04</a> (7)</li>
<li><a href="http://java-mzd.iteye.com/blog/monthblog/2011-03" target="_blank">2011-03</a> (2)</li>
<li><p><a href="http://java-mzd.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://java-mzd.iteye.com/blog/1050043" title="腾讯、淘宝、金山网络，实习生我该何去何从" target="_blank">腾讯、淘宝、金山网络，实习生我该何去何从</a></p>
</li>
<li><a href="http://java-mzd.iteye.com/blog/1050926" title="淘宝、金山网络，百感交集" target="_blank">淘宝、金山网络，百感交集</a></li>
<li><a href="http://java-mzd.iteye.com/blog/1007577" title="TCP/IP传输层，你懂多少？" target="_blank">TCP/IP传输层，你懂多少？</a></li>
<li><a href="http://java-mzd.iteye.com/blog/1004784" title="淘宝武汉*面试归来" target="_blank">淘宝武汉/*面试归来</a></li>
<li><p><a href="http://java-mzd.iteye.com/blog/862787" title="开源软件？自由软件？免费软件？你了解多少？" target="_blank">开源软件？自由软件？免费软件？你了解多少 ...</a></p>
</li>
<li><p><a href="http://java-mzd.iteye.com/rss" target="_blank"><img src="" alt="Rss"></a></p>
</li>
<li><a href="http://fusion.google.com/add?feedurl=http://java-mzd.iteye.com/rss" target="_blank"><img src="" alt="Rss_google"></a>
声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2011 ITeye.com. All rights reserved. [ 京ICP证110151号 ]
<img src="" alt=""></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_总结类/">Java_总结类</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_总结类/" class="label label-success">Java_总结类</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:43"datetime="2014-03-07 09:54:43"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_总结类--为什么要使用集合框架？--ITeye技术网站/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_总结类--为什么要使用集合框架？--ITeye技术网站" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-连接池--druid教程/">druid 教程</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:43.000Z"> <a href="/2014/02/02/2014-02-02-连接池--druid教程/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="druid-">druid 教程</h1>
<pre><code> java程序很大一部分要操作数据库，为了提高性能操作数据库的时候，有不得不使用数据库连接池。数据库连接池有很多选择，c3p、dhcp、proxool等，druid作为一名后起之秀，凭借其出色的性能，也逐渐印入了大家的眼帘。接下来本教程就说一下druid的简单使用。
</code></pre><p> 首先从<a href="http://repo1.maven.org/maven2/com/alibaba/druid/" target="_blank"><a href="http://repo1.maven.org/maven2/com/alibaba/druid/">http://repo1.maven.org/maven2/com/alibaba/druid/</a></a> 下载最新的jar包。如果想使用最新的源码编译，可以从<a href="https://github.com/alibaba/druid" target="_blank"><a href="https://github.com/alibaba/druid">https://github.com/alibaba/druid</a></a> 下载源码，然后使用maven命令行，或者导入到eclipse中进行编译。</p>
<h2 id="-1-"><a href=""></a>1 配置</h2>
<p>和dbcp类似，druid的配置项如下</p>
<p>配置 缺省值 说明 name   配置这个属性的意义在于，如果存在多个数据源，监控的时候
可以通过名字来区分开来。如果没有配置，将会生成一个名字，
格式是：&quot;DataSource-&quot; + System.identityHashCode(this) jdbcUrl   连接数据库的url，不同数据库不一样。例如：
mysql : jdbc:mysql://10.20.153.104:3306/druid2 
oracle : jdbc:oracle:thin:@10.20.149.85:1521:ocnauto username   连接数据库的用户名 password   连接数据库的密码。如果你不希望密码直接写在配置文件中，
可以使用ConfigFilter。详细看这里：
<a href="https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter" target="_blank"><a href="https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter">https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter</a></a> driverClassName 根据url自动识别 这一项可配可不配，如果不配置druid会根据url自动识别dbType，
然后选择相应的driverClassName initialSize 0 初始化时建立物理连接的个数。初始化发生在显示调用init方法，
或者第一次getConnection时 maxActive 8 最大连接池数量 maxIdle 8 已经不再使用，配置了也没效果 minIdle   最小连接池数量 maxWait   获取连接时最大等待时间，单位毫秒。配置了maxWait之后，
缺省启用公平锁，并发效率会有所下降，
如果需要可以通过配置useUnfairLock属性为true使用非公平锁。 poolPreparedStatements false 是否缓存preparedStatement，也就是PSCache。
PSCache对支持游标的数据库性能提升巨大，比如说oracle。
在mysql下建议关闭。 maxOpenPreparedStatements -1 要启用PSCache，必须配置大于0，当大于0时，
poolPreparedStatements自动触发修改为true。
在Druid中，不会存在Oracle下PSCache占用内存过多的问题，
可以把这个数值配置大一些，比如说100 validationQuery   用来检测连接是否有效的sql，要求是一个查询语句。
如果validationQuery为null，testOnBorrow、testOnReturn、
testWhileIdle都不会其作用。 testOnBorrow true 申请连接时执行validationQuery检测连接是否有效，
做了这个配置会降低性能。 testOnReturn false 归还连接时执行validationQuery检测连接是否有效，
做了这个配置会降低性能 testWhileIdle false 建议配置为true，不影响性能，并且保证安全性。
申请连接的时候检测，如果空闲时间大于
timeBetweenEvictionRunsMillis，
执行validationQuery检测连接是否有效。 timeBetweenEvictionRunsMillis   有两个含义：
1) Destroy线程会检测连接的间隔时间
 2) testWhileIdle的判断依据，详细看testWhileIdle属性的说明 numTestsPerEvictionRun   不再使用，一个DruidDataSource只支持一个EvictionRun minEvictableIdleTimeMillis     connectionInitSqls   物理连接初始化的时候执行的sql exceptionSorter 根据dbType自动识别 当数据库抛出一些不可恢复的异常时，抛弃连接 filters   属性类型是字符串，通过别名的方式配置扩展插件，
常用的插件有：
监控统计用的filter:stat 
日志用的filter:log4j
 防御sql注入的filter:wall proxyFilters   类型是List<com.alibaba.druid.filter.Filter>，
如果同时配置了filters和proxyFilters，
是组合关系，并非替换关系<strong>表1.1 配置属性</strong></p>
<p>根据常用的配置属性，首先给出一个如下的配置文件，放置于src目录下。</p>
<p><strong>[plain]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>url:jdbc:mysql://localhost:3306/dragoon_v25_masterdb  </li>
<li>driverClassName:com.mysql.jdbc.Driver  </li>
<li>username:root  </li>
<li>password:aaaaaaaa  </li>
<li></li>
<li>filters:stat  </li>
<li></li>
<li>maxActive:20  </li>
<li>initialSize:1  </li>
<li>maxWait:60000  </li>
<li>minIdle:10  </li>
<li>/#maxIdle:15  </li>
<li></li>
<li>timeBetweenEvictionRunsMillis:60000  </li>
<li>minEvictableIdleTimeMillis:300000  </li>
<li></li>
<li>validationQuery:SELECT &#39;x&#39;  </li>
<li>testWhileIdle:true  </li>
<li>testOnBorrow:false  </li>
<li>testOnReturn:false  </li>
<li>/#poolPreparedStatements:true  </li>
<li>maxOpenPreparedStatements:20  </li>
<li></li>
<li>/#对于长时间不使用的连接强制关闭  </li>
<li>removeAbandoned:true  </li>
<li>/#超过30分钟开始关闭空闲连接  </li>
<li>removeAbandonedTimeout:1800  </li>
<li>/#将当前关闭动作记录到日志  </li>
<li>logAbandoned:true  </li>
</ol>
<p><strong>配置文件1.1 </strong></p>
<p>配置项中指定了各个参数后，在连接池内部是这么使用这些参数的。数据库连接池在初始化的时候会创建initialSize个连接，当有数据库操作时，会从池中取出一个连接。如果当前池中正在使用的连接数等于maxActive，则会等待一段时间，等待其他操作释放掉某一个连接，如果这个等待时间超过了maxWait，则会报错；如果当前正在使用的连接数没有达到maxActive，则判断当前是否空闲连接，如果有则直接使用空闲连接，如果没有则新建立一个连接。在连接使用完毕后，不是将其物理连接关闭，而是将其放入池中等待其他操作复用。</p>
<p>同时连接池内部有机制判断，如果当前的总的连接数少于miniIdle，则会建立新的空闲连接，以保证连接数得到miniIdle。如果当前连接池中某个连接在空闲了timeBetweenEvictionRunsMillis时间后任然没有使用，则被物理性的关闭掉。有些数据库连接的时候有超时限制（mysql连接在8小时后断开），或者由于网络中断等原因，连接池的连接会出现失效的情况，这时候设置一个testWhileIdle参数为true，可以保证连接池内部定时检测连接的可用性，不可用的连接会被抛弃或者重建，最大情况的保证从连接池中得到的Connection对象是可用的。当然，为了保证绝对的可用性，你也可以使用testOnBorrow为true（即在获取Connection对象时检测其可用性），不过这样会影响性能。</p>
<h2 id="-2-"><a href=""></a>2 代码编写</h2>
<h3 id="-2-1-spring"><a href=""></a>2.1 使用spring</h3>
<p>首先给出spring配置文件</p>
<p><strong>[html]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;  </li>
<li>&lt;beans xmlns=&quot;<a href="http://www.springframework.org/schema/beans" target="_blank">http://www.springframework.org/schema/beans</a>&quot;  </li>
<li>xmlns:xsi=&quot;<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>&quot;  </li>
<li>xsi:schemaLocation=&quot;<a href="http://www.springframework.org/schema/mvc" target="_blank">http://www.springframework.org/schema/mvc</a> <a href="http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd" target="_blank">http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd</a>  </li>
<li><a href="http://www.springframework.org/schema/beans" target="_blank">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans-3.0.xsd" target="_blank">http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</a>  </li>
<li><a href="http://www.springframework.org/schema/context" target="_blank">http://www.springframework.org/schema/context</a> <a href="http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot;&gt;" target="_blank">http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot;&gt;</a>  </li>
<li><!-- 给web使用的spring文件 -->  </li>
<li>&lt;bean id=&quot;propertyConfigurer&quot;  </li>
<li>class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt;  </li>
<li><property name="locations">  </li>
<li><list>  </li>
<li><value>/WEB-INF/classes/dbconfig.properties</value>  </li>
<li></list>  </li>
<li></property>  </li>
<li></bean>  </li>
<li>&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;  </li>
<li>destroy-method=&quot;close&quot;&gt;  </li>
<li><property name="url" value="${url}" />  </li>
<li><property name="username" value="${username}" />  </li>
<li><property name="password" value="${password}" />  </li>
<li><property name="driverClassName" value="${driverClassName}" />  </li>
<li><property name="filters" value="${filters}" />  </li>
<li></li>
<li><property name="maxActive" value="${maxActive}" />  </li>
<li><property name="initialSize" value="${initialSize}" />  </li>
<li><property name="maxWait" value="${maxWait}" />  </li>
<li><property name="minIdle" value="${minIdle}" />  </li>
<li></li>
<li><property name="timeBetweenEvictionRunsMillis" value="${timeBetweenEvictionRunsMillis}" />  </li>
<li><property name="minEvictableIdleTimeMillis" value="${minEvictableIdleTimeMillis}" />  </li>
<li></li>
<li><property name="validationQuery" value="${validationQuery}" />  </li>
<li><property name="testWhileIdle" value="${testWhileIdle}" />  </li>
<li><property name="testOnBorrow" value="${testOnBorrow}" />  </li>
<li><property name="testOnReturn" value="${testOnReturn}" />  </li>
<li>&lt;property name=&quot;maxOpenPreparedStatements&quot;  </li>
<li>value=&quot;${maxOpenPreparedStatements}&quot; /&gt;  </li>
<li><property name="removeAbandoned" value="${removeAbandoned}" /> <!-- 打开removeAbandoned功能 -->  </li>
<li><property name="removeAbandonedTimeout" value="${removeAbandonedTimeout}" /> <!-- 1800秒，也就是30分钟 -->  </li>
<li><property name="logAbandoned" value="${logAbandoned}" /> <!-- 关闭abanded连接时输出错误日志 -->  </li>
<li></bean>  </li>
<li></li>
<li>&lt;bean id=&quot;dataSourceDbcp&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;  </li>
<li>destroy-method=&quot;close&quot;&gt;  </li>
<li></li>
<li><property name="driverClassName" value="${driverClassName}" />  </li>
<li><property name="url" value="${url}" />  </li>
<li><property name="username" value="${username}" />  </li>
<li><property name="password" value="${password}" />  </li>
<li></li>
<li><property name="maxActive" value="${maxActive}" />  </li>
<li><property name="minIdle" value="${minIdle}" />  </li>
<li><property name="maxWait" value="${maxWait}" />  </li>
<li><property name="defaultAutoCommit" value="true" />  </li>
<li></li>
<li><property name="timeBetweenEvictionRunsMillis" value="${timeBetweenEvictionRunsMillis}" />  </li>
<li><property name="minEvictableIdleTimeMillis" value="${minEvictableIdleTimeMillis}" />  </li>
<li></li>
<li><property name="validationQuery" value="${validationQuery}" />  </li>
<li><property name="testWhileIdle" value="${testWhileIdle}" />  </li>
<li><property name="testOnBorrow" value="${testOnBorrow}" />  </li>
<li><property name="testOnReturn" value="${testOnReturn}" />  </li>
<li>&lt;property name=&quot;maxOpenPreparedStatements&quot;  </li>
<li>value=&quot;${maxOpenPreparedStatements}&quot; /&gt;  </li>
<li><property name="removeAbandoned" value="${removeAbandoned}" />   </li>
<li><property name="removeAbandonedTimeout" value="${removeAbandonedTimeout}" />  </li>
<li><property name="logAbandoned" value="${logAbandoned}" />  </li>
<li></bean>  </li>
<li></li>
<li></li>
<li><!-- jdbcTemplate -->  </li>
<li><bean id="jdbc" class="org.springframework.jdbc.core.JdbcTemplate">  </li>
<li><property name="dataSource">  </li>
<li><ref bean="dataSource" />  </li>
<li></property>  </li>
<li></bean>  </li>
<li></li>
<li>&lt;bean id=&quot;SpringTableOperatorBean&quot; class=&quot;com.whyun.druid.model.TableOperator&quot;  </li>
<li>scope=&quot;prototype&quot;&gt;  </li>
<li><property name="dataSource">  </li>
<li><ref bean="dataSource" />  </li>
<li></property>  </li>
<li></bean>  </li>
<li></li>
<li></beans>  </li>
</ol>
<p><strong>配置文件2.1</strong></p>
<p>其中第一个bean中给出的配置文件/WEB-INF/classes/dbconfig.properties就是第1节中给出的配置文件。我这里还特地给出dbcp的spring配置项，目的就是将两者进行对比，方便大家进行迁移。这里没有使用JdbcTemplate，所以jdbc那个bean没有使用到。下面给出com.whyun.druid.model.TableOperator类的代码。</p>
<p><strong>[java]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>package com.whyun.druid.model;  </li>
<li></li>
<li>import java.sql.Connection;  </li>
<li>import java.sql.PreparedStatement;  </li>
<li>import java.sql.SQLException;  </li>
<li>import java.sql.Statement;  </li>
<li></li>
<li>import javax.sql.DataSource;  </li>
<li></li>
<li>public class TableOperator {  </li>
<li>private DataSource dataSource;  </li>
<li>public void setDataSource(DataSource dataSource) {  </li>
<li>this.dataSource = dataSource;  </li>
<li>}  </li>
<li></li>
<li>private static final int COUNT = 800;      </li>
<li></li>
<li>public TableOperator() {  </li>
<li></li>
<li>}  </li>
<li></li>
<li>public void tearDown() throws Exception {  </li>
<li>try {  </li>
<li>dropTable();  </li>
<li>} catch (SQLException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}         </li>
<li>}  </li>
<li></li>
<li>public void insert() throws Exception {  </li>
<li></li>
<li>StringBuffer ddl = new StringBuffer();  </li>
<li>ddl.append(&quot;INSERT INTO t_big (&quot;);  </li>
<li>for (int i = 0; i &lt; COUNT; ++i) {  </li>
<li>if (i != 0) {  </li>
<li>ddl.append(&quot;, &quot;);  </li>
<li>}  </li>
<li>ddl.append(&quot;F&quot; + i);  </li>
<li>}  </li>
<li>ddl.append(&quot;) VALUES (&quot;);  </li>
<li>for (int i = 0; i &lt; COUNT; ++i) {  </li>
<li>if (i != 0) {  </li>
<li>ddl.append(&quot;, &quot;);  </li>
<li>}  </li>
<li>ddl.append(&quot;?&quot;);  </li>
<li>}  </li>
<li>ddl.append(&quot;)&quot;);  </li>
<li></li>
<li>Connection conn = dataSource.getConnection();  </li>
<li></li>
<li>//        System.out.println(ddl.toString());  </li>
<li></li>
<li>PreparedStatement stmt = conn.prepareStatement(ddl.toString());  </li>
<li></li>
<li>for (int i = 0; i &lt; COUNT; ++i) {  </li>
<li>stmt.setInt(i + 1, i);  </li>
<li>}  </li>
<li>stmt.execute();  </li>
<li>stmt.close();  </li>
<li></li>
<li>conn.close();  </li>
<li>}  </li>
<li></li>
<li>private void dropTable() throws SQLException {  </li>
<li></li>
<li>Connection conn = dataSource.getConnection();  </li>
<li></li>
<li>Statement stmt = conn.createStatement();  </li>
<li>stmt.execute(&quot;DROP TABLE t_big&quot;);  </li>
<li>stmt.close();  </li>
<li></li>
<li>conn.close();  </li>
<li>}  </li>
<li></li>
<li>public void createTable() throws SQLException {  </li>
<li>StringBuffer ddl = new StringBuffer();  </li>
<li>ddl.append(&quot;CREATE TABLE t_big (FID INT AUTO_INCREMENT PRIMARY KEY &quot;);  </li>
<li>for (int i = 0; i &lt; COUNT; ++i) {  </li>
<li>ddl.append(&quot;, &quot;);  </li>
<li>ddl.append(&quot;F&quot; + i);  </li>
<li>ddl.append(&quot; BIGINT NULL&quot;);  </li>
<li>}  </li>
<li>ddl.append(&quot;)&quot;);  </li>
<li></li>
<li>Connection conn = dataSource.getConnection();  </li>
<li></li>
<li>Statement stmt = conn.createStatement();  </li>
<li>stmt.execute(ddl.toString());  </li>
<li>stmt.close();  </li>
<li></li>
<li>conn.close();  </li>
<li>}  </li>
<li>}  </li>
</ol>
<p><strong>代码片段2.1</strong></p>
<p><strong>注意：在使用的时候，通过获取完Connection对象，在使用完之后，要将其close掉，这样其实是将用完的连接放入到连接池中，如果你不close的话，会造成连接泄露。</strong>
然后我们写一个servlet来测试他.</p>
<p><strong>[java]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>package com.whyun.druid.servelt;  </li>
<li></li>
<li>import java.io.IOException;  </li>
<li>import java.io.PrintWriter;  </li>
<li>import java.sql.SQLException;  </li>
<li></li>
<li>import javax.servlet.ServletContext;  </li>
<li>import javax.servlet.ServletException;  </li>
<li>import javax.servlet.http.HttpServlet;  </li>
<li>import javax.servlet.http.HttpServletRequest;  </li>
<li>import javax.servlet.http.HttpServletResponse;  </li>
<li></li>
<li>import org.springframework.web.context.WebApplicationContext;  </li>
<li>import org.springframework.web.context.support.WebApplicationContextUtils;  </li>
<li></li>
<li>import com.whyun.druid.model.TableOperator;  </li>
<li></li>
<li>public class TestServlet extends HttpServlet {  </li>
<li>private TableOperator operator;  </li>
<li></li>
<li></li>
<li>@Override  </li>
<li>public void init() throws ServletException {  </li>
<li></li>
<li>super.init();  </li>
<li>ServletContext servletContext = this.getServletContext();     </li>
<li></li>
<li>WebApplicationContext ctx  </li>
<li>= WebApplicationContextUtils.getWebApplicationContext(servletContext);  </li>
<li>operator = (TableOperator)ctx.getBean(&quot;SpringTableOperatorBean&quot;);  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* The doGet method of the servlet. <br> </li>
<li>/* </li>
<li>/* This method is called when a form has its tag value method equals to get. </li>
<li>/*  </li>
<li>/* @param request the request send by the client to the server </li>
<li>/* @param response the response send by the server to the client </li>
<li>/* @throws ServletException if an error occurred </li>
<li>/* @throws IOException if an error occurred </li>
<li>/*/  </li>
<li>public void doGet(HttpServletRequest request, HttpServletResponse response)  </li>
<li>throws ServletException, IOException {  </li>
<li></li>
<li>response.setContentType(&quot;text/html&quot;);  </li>
<li>PrintWriter out = response.getWriter();  </li>
<li></li>
<li>boolean createResult = false;  </li>
<li>boolean insertResult = false;  </li>
<li>boolean dropResult = false;  </li>
<li></li>
<li>try {  </li>
<li>operator.createTable();  </li>
<li>createResult = true;  </li>
<li>} catch (SQLException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>if (createResult) {  </li>
<li>try {  </li>
<li>operator.insert();  </li>
<li>insertResult = true;  </li>
<li>} catch (Exception e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>try {  </li>
<li>operator.tearDown();  </li>
<li>dropResult = true;  </li>
<li>} catch (Exception e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li></li>
<li>out.println(&quot;{&#39;createResult&#39;:&quot;+createResult+&quot;,&#39;insertResult&#39;:&quot;  </li>
<li>+insertResult+&quot;,&#39;dropResult&#39;:&quot;+dropResult+&quot;}&quot;);  </li>
<li></li>
<li>out.flush();  </li>
<li>out.close();  </li>
<li>}  </li>
<li></li>
<li>}<br><strong>代码片段2.2</strong></li>
</ol>
<p>这里没有用到struts2或者springmvc，虽然大部分开发者用的是这两种框架。</p>
<h3 id="-2-2-spring"><a href=""></a>2.2 不使用spring</h3>
<p>类似于dbcp，druid也提供了原生态的支持。先看下面这段代码：</p>
<p><strong>[java]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>package com.whyun.util.db;  </li>
<li></li>
<li>import javax.sql.DataSource;  </li>
<li></li>
<li>import org.apache.commons.dbcp.BasicDataSourceFactory;  </li>
<li></li>
<li>import com.alibaba.druid.pool.DruidDataSourceFactory;  </li>
<li>import com.whyun.util.config.MySqlConfigProperty;  </li>
<li>import com.whyun.util.config.MySqlConfigProperty2;  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* The Class DataSourceUtil. </li>
<li>/*/  </li>
<li>public class DataSourceUtil {  </li>
<li></li>
<li>//<em>/</em> 使用配置文件dbconfig.properties构建Druid数据源. /*/  </li>
<li>public static final int DRUID_MYSQL_SOURCE = 0;  </li>
<li></li>
<li>//<em>/</em> 使用配置文件dbconfig2.properties构建Druid数据源. /*/  </li>
<li>public static final int DRUID_MYSQL_SOURCE2 = 1;  </li>
<li></li>
<li>//<em>/</em> 使用配置文件dbconfig.properties构建Dbcp数据源. /*/  </li>
<li>public static final int DBCP_SOURCE = 4;  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 根据类型获取数据源 </li>
<li>/* </li>
<li>/* @param sourceType 数据源类型 </li>
<li>/* @return druid或者dbcp数据源 </li>
<li>/* @throws Exception the exception </li>
<li>/*/  </li>
<li>public static final DataSource getDataSource(int sourceType)  </li>
<li>throws Exception {  </li>
<li>DataSource dataSource = null;  </li>
<li>switch(sourceType) {  </li>
<li>case DRUID_MYSQL_SOURCE:              </li>
<li>dataSource = DruidDataSourceFactory.createDataSource(  </li>
<li>MySqlConfigProperty.getInstance().getProperties());               </li>
<li>break;  </li>
<li>case DRUID_MYSQL_SOURCE2:  </li>
<li>dataSource = DruidDataSourceFactory.createDataSource(  </li>
<li>MySqlConfigProperty2.getInstance().getProperties());  </li>
<li>break;  </li>
<li>case DBCP_SOURCE:  </li>
<li>dataSource = BasicDataSourceFactory.createDataSource(  </li>
<li>MySqlConfigProperty.getInstance().getProperties());  </li>
<li>break;  </li>
<li>}  </li>
<li>return dataSource;  </li>
<li>}  </li>
<li>}  </li>
</ol>
<p><strong>代码片段2.3 手动读取配置文件初始化连接池</strong></p>
<p>第37行中调用了类com.alibaba.druid.pool.DruidDataSourceFactory中createDataSource方法来初始化一个连接池。对比dbcp的使用方法，两者很相似。</p>
<p>下面给出一个多线程的测试程序。运行后可以比较druid和dbcp的性能差别。</p>
<p><strong>[java]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>package com.whyun.druid.test;  </li>
<li></li>
<li>import java.sql.SQLException;  </li>
<li>import java.util.ArrayList;  </li>
<li>import java.util.List;  </li>
<li>import java.util.concurrent.Callable;  </li>
<li>import java.util.concurrent.ExecutorService;  </li>
<li>import java.util.concurrent.Executors;  </li>
<li>import java.util.concurrent.Future;  </li>
<li>import java.util.concurrent.TimeUnit;  </li>
<li></li>
<li>import com.whyun.druid.model.TableOperator;  </li>
<li>import com.whyun.util.db.DataSourceUtil;  </li>
<li></li>
<li>public class MutilThreadTest {  </li>
<li>public static void test(int dbType, int times)  </li>
<li>throws Exception {   </li>
<li>int numOfThreads =Runtime.getRuntime().availableProcessors()/*2;  </li>
<li>ExecutorService executor = Executors.newFixedThreadPool(numOfThreads);    </li>
<li>final TableOperator test = new TableOperator();  </li>
<li>//        int dbType = DataSourceUtil.DRUID_MYSQL_SOURCE;  </li>
<li>//        dbType = DataSourceUtil.DBCP_SOURCE;  </li>
<li>test.setDataSource(DataSourceUtil.getDataSource(dbType));  </li>
<li></li>
<li>boolean createResult = false;  </li>
<li>try {  </li>
<li>test.createTable();  </li>
<li>createResult = true;  </li>
<li>} catch (SQLException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>if (createResult) {  </li>
<li>List<Future<Long>&gt; results = new ArrayList<Future<Long>&gt;();     </li>
<li>for (int i = 0; i &lt; times; i++) {    </li>
<li>results.add(executor.submit(new Callable<Long>() {    </li>
<li>@Override    </li>
<li>public Long call() throws Exception {    </li>
<li>long begin = System.currentTimeMillis();  </li>
<li>try {  </li>
<li>test.insert();  </li>
<li>//insertResult = true;  </li>
<li>} catch (Exception e) {  </li>
<li>e.printStackTrace();  </li>
<li>}                             </li>
<li>long end = System.currentTimeMillis();    </li>
<li>return end - begin;    </li>
<li>}    </li>
<li>}));    </li>
<li>}    </li>
<li>executor.shutdown();    </li>
<li>while(!executor.awaitTermination(Long.MAX_VALUE, TimeUnit.DAYS));    </li>
<li></li>
<li>long sum = 0;    </li>
<li>for (Future<Long> result : results) {    </li>
<li>sum += result.get();    </li>
<li>}    </li>
<li></li>
<li></li>
<li>System.out.println(&quot;---------------db type &quot;+dbType+&quot;------------------&quot;);    </li>
<li>System.out.println(&quot;number of threads :&quot; + numOfThreads + &quot; times:&quot; + times);    </li>
<li>System.out.println(&quot;running time: &quot; + sum + &quot;ms&quot;);    </li>
<li>System.out.println(&quot;TPS: &quot; + (double)(100000 /* 1000) / (double)(sum));    </li>
<li>System.out.println();    </li>
<li>try {  </li>
<li>test.tearDown();  </li>
<li>//dropResult = true;  </li>
<li>} catch (Exception e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>} else {  </li>
<li>System.out.println(&quot;初始化数据库失败&quot;);  </li>
<li>}  </li>
<li></li>
<li>}    </li>
<li></li>
<li>public static void main (String argc[])  </li>
<li>throws Exception {  </li>
<li>test(DataSourceUtil.DBCP_SOURCE,50);  </li>
<li>test(DataSourceUtil.DRUID_MYSQL_SOURCE,50);  </li>
<li></li>
<li>}  </li>
<li>}  </li>
</ol>
<p><strong>代码片段2.4 连接池多线程测试程序</strong></p>
<hr>
<h2 id="-3-"><a href=""></a><strong>3 监控</strong></h2>
<h3 id="-3-1-web-"><a href=""></a><strong>3.1 web监控</strong></h3>
<p>druid提供了sql语句查询时间等信息的监控功能。为了让数据库查询一直运行，下面特地写了一个ajax进行轮询。同时，还要保证在web.xml中配置如下信息</p>
<p><strong>[html]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li><servlet>  </li>
<li><servlet-name>DruidStatView</servlet-name>  </li>
<li><servlet-class>com.alibaba.druid.support.http.StatViewServlet</servlet-class>  </li>
<li></servlet>  </li>
<li><servlet-mapping>  </li>
<li><servlet-name>DruidStatView</servlet-name>  </li>
<li><url-pattern>/druid//*</url-pattern>  </li>
<li></servlet-mapping><br><strong>配置文件3.1 在web.xml中添加druid监控</strong></li>
</ol>
<p><em>**</em>同时将ajax代码提供如下</p>
<p><strong>[javascript]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li>function showTime() {  </li>
<li>var myDate = new Date();  </li>
<li>var timeStr = &#39;&#39;;  </li>
<li>timeStr += myDate.getFullYear()+&#39;-&#39;; //获取完整的年份(4位,1970-????)  </li>
<li>timeStr += myDate.getMonth()+&#39;-&#39;;      //获取当前月份(0-11,0代表1月)  </li>
<li>timeStr += myDate.getDate() + &#39; &#39;;      //获取当前日(1-31)  </li>
<li>timeStr += myDate.getHours()+&#39;:&#39;;      //获取当前小时数(0-23)  </li>
<li>timeStr += myDate.getMinutes()+&#39;:&#39;;    //获取当前分钟数(0-59)  </li>
<li>timeStr += myDate.getSeconds();    //获取当前秒数(0-59)  </li>
<li>return timeStr  </li>
<li>}  </li>
<li>$(document).ready(function() {  </li>
<li>function loadDBTestMessage() {  </li>
<li>$.get(&#39;servlet/MysqlTestServlet&#39;,function(data) {  </li>
<li>if (typeof(data) != &#39;object&#39;) {  </li>
<li>data = eval(&#39;(&#39; + data + &#39;)&#39;);  </li>
<li>}  </li>
<li>var html = &#39;[&#39;+showTime()+&#39;]&#39;;  </li>
<li>html += &#39;创建：&#39; + data[&#39;createResult&#39;];  </li>
<li>html +=  &#39;插入：&#39; + data[&#39;insertResult&#39;];  </li>
<li>html += &#39;销毁:&#39; + data[&#39;dropResult&#39;];  </li>
<li>html +=   </li>
<li>$(&#39;/#message&#39;).html(html);  </li>
<li>});  </li>
<li>}  </li>
<li></li>
<li>setInterval(function() {  </li>
<li>loadDBTestMessage();  </li>
<li>}, 10000);  </li>
<li>});<br><strong>代码片段3.1 ajax轮询</strong></li>
</ol>
<p>这时打开<a href="http://localhost/druid-web/druid/" target="_blank">http://localhost/druid-web/druid/</a> 地址，会看到监控界面，点击其中的sql标签。</p>
<p><img src="" alt=""></p>
<p><strong>图3.1 监控界面查看sql查询时间</strong></p>
<p><strong>注意：在写配置文件1.1时，要保证filter配置项中含有stat属性，否则这个地方看不到sql语句的监控数据。</strong></p>
<p>表格中各项含义如下</p>
<hr>
<p>名称</p>
<p>解释</p>
<p>备注 ExecuteCount</p>
<p>当前sql已执行次数 ExecTime</p>
<p>当前sql已执行时间 ExecMax</p>
<p>当前sql最大执行时间 Txn</p>
<p>当前运行的事务数量 Error</p>
<p>当前sql执行出错的数目 Update</p>
<p>当前sql更新或者删除操作中已经影响的行数 FetchRow</p>
<p>当前sql操作中已经读取的行数 Running</p>
<p>当前sql正在运行的数目 Concurrent</p>
<p>当前sql最大并发执行数  ExecHisto </p>
<p>当前sql做execute操作的时间分布数组</p>
<p>分为0-1,1-10,10-100,100-1000，&gt;1000，5个时间分布区域，单位为ms ExecRsHisto </p>
<p>当前sql做execute操作和resultSet</p>
<p>打开至关闭的时间总和分布数组</p>
<p>同上 FetchRowHisto</p>
<p>当前sql查询时间分布数组</p>
<p>同上 UpdateHisto </p>
<p>当前sql更新、删除时间分布数组</p>
<p>同上表3.1 监控字段含义</p>
<p>老版本的druid的jar包中不支持通过web界面进行远程监控，从0.2.14开始可以通过配置jmx地址来获取远程运行druid的服务器的监控信息。具体配置方法如下：</p>
<p><strong>[html]</strong> <a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/yunnysunny/article/details/8657095#" title="copy" target="_blank">copy</a></p>
<ol>
<li><servlet>  </li>
<li><servlet-name>DruidStatView</servlet-name>  </li>
<li><servlet-class>com.alibaba.druid.support.http.StatViewServlet</servlet-class>  </li>
<li><init-param>  </li>
<li><param-name>jmxUrl</param-name>  </li>
<li><param-value>service:jmx:rmi:///jndi/rmi://localhost:9004/jmxrmi</param-value>  </li>
<li></init-param>  </li>
<li></servlet>  </li>
<li><servlet-mapping>  </li>
<li><servlet-name>DruidStatView</servlet-name>  </li>
<li><url-pattern>/druid//*</url-pattern>  </li>
<li></servlet-mapping><br>配置文件3.2 远程监控web</li>
</ol>
<p>这里连接的配置参数中多了一个jmxUrl，里面配置一个jmx连接地址。jmx连接中也可以指定用户名、密码，在上面的servlet中添加两个init-param，其param-name分别为jmxUsername和jmxPassword，分别对应连接jmx的用户名和密码。对于jmx在服务器端的配置，可以参考3.2节中的介绍。</p>
<h3 id="-3-2-jconsole-"><a href=""></a><strong>3.2 jconsole监控</strong></h3>
<p>同时druid提供了jconsole监控的功能，因为界面做的不是很好，所以官方中没有对其的相关介绍。如果是纯java程序的话，上面提到的web监控就无法使用了，jconsole的作用就体现出来了。不过我在下面做教程的时候，依然使用的是刚才用的web项目。</p>
<p>首先在catalina.bat（或者catalina.sh）中加入java的启动选项，放置于if &quot;%OS%&quot; == &quot;Windows_NT&quot; setlocal这句之后。</p>
<p>set JAVA_OPTS=%JAVA_OPTS% -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=&quot;9004&quot; -Dcom.sun.management.jmxremote.authenticate=&quot;false&quot; -Dcom.sun.management.jmxremote.ssl=&quot;false&quot;</p>
<p>保存完之后，启动startup.bat(或者startup.sh)来运行tomcat（上面设置java启动项的配置，按理来说在eclipse中也能适用，但是笔者在其下没有试验成功）。然后在远程的某台电脑的命令行中运行如下命令</p>
<p>jconsole -pluginpath E:\kuaipan\workspace6\druid-web\WebRoot\WEB-INF\lib\druid-0.2.11.jar</p>
<p>这里的最后一个参数就是你的druid的jar包的路径。</p>
<p><img src="" alt=""></p>
<p><strong>图3.2 jconsole连接界面</strong></p>
<p>在远程进程的输入框里面输入ip:端口号，然后点击连接（上面的配置中没有指定用户名、密码，所以这里不用填写）。打开的界面如下：</p>
<p><img src="" alt=""></p>
<p><strong>图3.3 jconsole 连接成功界面</strong></p>
<p>可以看到和web监控界面类似的数据了。
来源： <a href="[http://blog.csdn.net/yunnysunny/article/details/8657095](http://blog.csdn.net/yunnysunny/article/details/8657095)">[http://blog.csdn.net/yunnysunny/article/details/8657095](http://blog.csdn.net/yunnysunny/article/details/8657095)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/连接池/">连接池</a></li></span></span> | <span class="tags">Tagged <a href="/tags/连接池/" class="label label-primary">连接池</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:43"datetime="2014-03-07 09:54:43"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-连接池--druid教程/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-连接池--druid教程" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/39/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/37/">37</a></li><li><a class="page-number" href="/page/38/">38</a></li><li><a class="page-number" href="/page/39/">39</a></li><li class="active"><li><span class="page-number current">40</span></li><li><a class="page-number" href="/page/41/">41</a></li><li><a class="page-number" href="/page/42/">42</a></li><li><a class="page-number" href="/page/43/">43</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/41/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 17:26:53</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
