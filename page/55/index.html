
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 55 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-JVM--GC悲观策略之ParallelGC篇/">GC悲观策略之Parallel GC篇</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-JVM--GC悲观策略之ParallelGC篇/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="gc-parallel-gc-">GC悲观策略之Parallel GC篇</h1>
<h1 id="-bluedavy-blog-https-blog-bluedavy-com-"><a href="https://blog.bluedavy.com/" target="_blank">BlueDavy之技术blog</a></h1>
<p>{互联网，OSGi，Java, High Scalability, High Performance,HA}</p>
<ul>
<li><a href="https://blog.bluedavy.com/" target="_blank">Home</a></li>
<li><a href="https://blog.bluedavy.com/?page_id=2" target="_blank">About</a></li>
<li><a href="https://blog.bluedavy.com/?page_id=81" target="_blank">Photos</a></li>
</ul>
<h2 id="-gc-parallel-gc-https-blog-bluedavy-com-p-166-gc-parallel-gc-"><a href="https://blog.bluedavy.com/?p=166" title="GC悲观策略之Parallel GC篇" target="_blank">GC悲观策略之Parallel GC篇</a></h2>
<p>Nov 07</p>
<p><a href="http://bluedavy.com/" title="Visit bluedavy’s website" target="_blank">bluedavy</a><a href="https://blog.bluedavy.com/?cat=13" title="View all posts in jvm" target="_blank">jvm</a> <a href="https://blog.bluedavy.com/?tag=gc" target="_blank">gc</a>, <a href="https://blog.bluedavy.com/?tag=jvm" target="_blank">jvm</a>, <a href="https://blog.bluedavy.com/?tag=pessimism-policy" target="_blank">pessimism policy</a>, <a href="https://blog.bluedavy.com/?tag=%e6%82%b2%e8%a7%82%e7%ad%96%e7%95%a5" target="_blank">悲观策略</a> <a href="&quot;Comment on GC悲观策略之Parallel GC篇&quot;">12 Comments</a>
先来看段代码：
<a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
import</p>
<p>java.util./*;</p>
<p>public</p>
<p>class</p>
<p>SummaryCase{</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>main(String[] args)</p>
<p>throws</p>
<p>Exception{</p>
<p>List<Object> caches=</p>
<p>new</p>
<p>ArrayList<Object>();</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>i=</p>
<p>0</p>
<p>;i&lt;</p>
<p>7</p>
<p>;i++){</p>
<p>caches.add(</p>
<p>new</p>
<p>byte</p>
<p>[</p>
<p>1024</p>
<p>/*</p>
<p>1024</p>
<p>/*</p>
<p>3</p>
<p>]);</p>
<p>}</p>
<p>caches.clear();</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>i=</p>
<p>0</p>
<p>;i&lt;</p>
<p>2</p>
<p>;i++){</p>
<p>caches.add(</p>
<p>new</p>
<p>byte</p>
<p>[</p>
<p>1024</p>
<p>/*</p>
<p>1024</p>
<p>/*</p>
<p>3</p>
<p>]);</p>
<p>}</p>
<p>Thread.sleep(</p>
<p>10000</p>
<p>);</p>
<p>}</p>
<p>}</p>
<p>当用-Xms30m -Xmx30m -Xmn10m -XX:+UseParallelGC执行上面的代码时会执行几次Minor GC和几次Full GC呢？
按照eden空间不足时触发minor gc的规则，上面代码执行后的GC应为：M、M、M、M，但实际上上面代码执行后GC则为：M、M、M、F、F。
这里的原因就在于Parallel Scavenge GC时的悲观策略，当在eden上分配内存失败时且对象的大小尚不需要直接在old上分配时，会触发YGC，代码片段如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24
25</p>
<p>26
27</p>
<p>28
29</p>
<p>30
31</p>
<p>32
33</p>
<p>34
35</p>
<p>36
37void</p>
<p>PSScavenge::invoke(){</p>
<p>...
bool</p>
<p>scavenge_was_done = PSScavenge::invoke_no_policy();</p>
<p>PSGCAdaptivePolicyCounters/* counters = heap-&gt;gc_policy_counters();
if</p>
<p>(UsePerfData)</p>
<p>counters-&gt;update_full_follows_scavenge(0);
if</p>
<p>(!scavenge_was_done ||</p>
<p>policy-&gt;should_full_GC(heap-&gt;old_gen()-&gt;free_in_bytes())) {
if</p>
<p>(UsePerfData)</p>
<p>counters-&gt;update_full_follows_scavenge(full_follows_scavenge);&lt;</p>
<p>GCCauseSetter gccs(heap, GCCause::_adaptive_size_policy);
if</p>
<p>(UseParallelOldGC) {</p>
<p>PSParallelCompact::invoke_no_policy(</p>
<p>false</p>
<p>);
}</p>
<p>else</p>
<p>{</p>
<p>PSMarkSweep::invoke_no_policy(</p>
<p>false</p>
<p>);
}</p>
<p>}
...</p>
<p>}
PSScavenge::invoke_no_policy{</p>
<p>...
if</p>
<p>(!should_attempt_scavenge()) {</p>
<p>return</p>
<p>false</p>
<p>;
}</p>
<p>...
}</p>
<p>bool</p>
<p>PSScavenge::should_attempt_scavenge() {
...</p>
<p>PSAdaptiveSizePolicy/* policy = heap-&gt;size_policy();</p>
<p>size_t</p>
<p>avg_promoted = (</p>
<p>size_t</p>
<p>) policy-&gt;padded_average_promoted_in_bytes();
size_t</p>
<p>promotion_estimate = MIN2(avg_promoted, young_gen-&gt;used_in_bytes());</p>
<p>bool</p>
<p>result = promotion_estimate &lt; old_gen-&gt;free_in_bytes();
...</p>
<p>return</p>
<p>result;
}</p>
<p>在上面should_attempt_scavenge代码片段中，可以看到会比较之前YGC晋升到Old中的平均大小与当前新生代中已被使用的字节数大小，取更小的值与旧生代目前剩余空间大小对比，如更大，则返回false，就终止了YGC的执行了，当返回false时，PSScavenge::invoke就将触发Full GC了。
在PSScavenge:invoke中还有一个条件为：policy-&gt;should_full_GC(heap-&gt;old_gen()-&gt;free_in_bytes()，来看看这段代码片段：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5bool</p>
<p>PSAdaptiveSizePolicy::should_full_GC(</p>
<p>size_t</p>
<p>old_free_in_bytes) {</p>
<p>bool</p>
<p>result = padded_average_promoted_in_bytes() &gt; (</p>
<p>float</p>
<p>) old_free_in_bytes;
...</p>
<p>return</p>
<p>result;
}</p>
<p>可看到，这段代码检查的也是之前YGC时晋升到old的平均大小是否大于了旧生代的剩余空间，如大于，则触发full gc。
总结上面分析的策略，可以看到采用Parallel GC的情况下，当YGC触发时，会有两个检查：
1、在YGC执行前，min(目前新生代已使用的大小,之前平均晋升到old的大小中的较小值) &gt; 旧生代剩余空间大小 ? 不执行YGC，直接执行Full GC : 执行YGC；
2、在YGC执行后，平均晋升到old的大小 &gt; 旧生代剩余空间大小 ? 触发Full GC ： 什么都不做。</p>
<p>按照这样的说明，再来看看上面代码的执行过程中eden和old大小的变化状况：
代码 eden old YGC FGC
第一次循环 3 0 0 0
第二次循环 6 0 0 0
第三次循环 3 6 1 0
第四次循环 6 6 1 0
第五次循环 3 12 2 0
第六次循环 6 12 2 0
第七次循环 3 18 3 1
第八次循环 6 18 3 1
第九次循环 3 3 3 2
在第7次循环时，YGC后旧生代剩余空间为2m，而之前平均晋级到old的对象大小为6m，因此在YGC后会触发一次FGC。
而第9次循环时，在YGC执行前，此时新生代已使用的大小为6m，之前晋级到old的平均大小为6m，这两者去最小值为6m，这个值已大于old的剩余空间，因此就不执行YGC，直接执行FGC了。</p>
<p>Sun JDK之所以要有悲观策略，我猜想理由是程序最终是会以一个较为稳态的状况执行的，此时每次YGC后晋升到old的对象大小应该是差不多的，在YGC时做好检查，避免等YGC后晋升到Old的对象导致old空间不足，因此还不如干脆就直接执行FGC，正因为悲观策略的存在，大家有些时候可能会看到old空间没满但full gc执行的状况。
埋个伏笔，大家将上面的执行参数换为-XX:+UseSerialGC执行看看，会发生什么呢？ <img src="" alt=":)"></p>
<p><a href="https://blog.bluedavy.com/?p=114" target="_blank">JavaOne美国之行–硅谷公司交流篇</a> <a href="https://blog.bluedavy.com/?p=170" target="_blank">GC悲观策略之Serial GC篇</a></p>
<h3 id="12-comments-add-yours-">12 Comments <em>(<a href="">+add yours?</a>)</em></h3>
<ol>
<li><img src="" alt=""> xan
<strong>Nov 08, 2010</strong> @ 11:58:44
代码布局不怎么给力啊 <img src="" alt=":)"></li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Nov 08, 2010</strong> @ 12:23:52
确实不给力，我折腾下。</li>
<li><img src="https://secure.gravatar.com/avatar/3ed95d835a4c573899a9be257428c69f?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://twitter.com/imbeneo" target="_blank">imbeneo</a>
<strong>Nov 08, 2010</strong> @ 13:12:45
我忘记了clean，结果总是OOM。</li>
<li><img src="https://secure.gravatar.com/avatar/03ec79001b70a7dc41d51c1db4db4baa?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> oliver
<strong>Apr 26, 2011</strong> @ 11:34:35
我的疑问是为什么第一次full gc时old里面使用空间没有被回收掉，第二次full gc时old里面才回收？</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Apr 26, 2011</strong> @ 13:32:18
因为caches.clear是后来才调的…</li>
<li><img src="https://secure.gravatar.com/avatar/3cc9849504cb6c7c78b5533df02043ac?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://www.dosmile.net/" target="_blank">yinhex</a>
<strong>Jul 09, 2011</strong> @ 22:38:20
这里我有个问题啊：我看你的分布式基础看到你能举例出很多大网站的设计。不知道你是从哪里可以看到这些信息的呢？可以细数一下你经常上去获取信息国外网站吗？</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Jul 11, 2011</strong> @ 10:01:48
@yinhex
一般来说，例如highscalability.com，还有各种国外的技术大会，各家著名公司的engineer的blog，都会有这些信息，:)</li>
<li><img src="https://secure.gravatar.com/avatar/f2ec9eb448e778dc947957c779fdd735?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> Gary
<strong>Sep 29, 2011</strong> @ 11:09:58
-XX:+UseSerialGC gc.log发现是MMMMF,符合预期啊</li>
<li><img src="https://secure.gravatar.com/avatar/e9ef6892fbac714e6678cd30f4a212f4?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> yangxuesong
<strong>Nov 29, 2011</strong> @ 17:31:49
一次full gc的执行流程是怎么用的呢？</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Dec 03, 2011</strong> @ 11:10:22
@yangxuesong
这个…要看是什么垃圾收集器…<h3 id="leave-a-reply">Leave a Reply</h3>
</li>
</ol>
<p><a href="">Cancel</a></p>
<p>Name (required)</p>
<p>Mail (required)</p>
<p>Website</p>
<p><img src="&quot;CAPTCHA Image&quot;" alt="CAPTCHA Image"></p>
<p><a href="&quot;Refresh Image&quot;"><img src="" alt="Refresh Image"></a></p>
<p>CAPTCHA Code /*</p>
<p><style type='text/css'>/#submit {display:none;}</style><br /> <input name="submit" type="submit" id="submit-alt" tabindex="6" value="Submit Comment" /></p>
<p>July 2013 M T W T F S S <a href="https://blog.bluedavy.com/?m=201303" title="View posts for March 2013" target="_blank">« Mar</a>     1234567 891011121314 15161718192021 22232425262728 293031  </p>
<h3 id="categories">Categories</h3>
<ul>
<li><a href="https://blog.bluedavy.com/?cat=63" title="View all posts filed under Java" target="_blank">Java</a> (10)</li>
<li><a href="https://blog.bluedavy.com/?cat=13" title="View all posts filed under jvm" target="_blank">jvm</a> (19)</li>
<li><a href="https://blog.bluedavy.com/?cat=56" title="View all posts filed under NoSQL" target="_blank">NoSQL</a> (7)</li>
<li><a href="https://blog.bluedavy.com/?cat=4" title="View all posts filed under SOA" target="_blank">SOA</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=11" title="关于《分布式Java应用：基础与实践》书部分章节的公开、书内容的纠错以及补充完善。" target="_blank">书:分布式Java应用</a> (5)</li>
<li><a href="https://blog.bluedavy.com/?cat=6" title="View all posts filed under 互联网" target="_blank">互联网</a> (5)</li>
<li><a href="https://blog.bluedavy.com/?cat=46" title="View all posts filed under 产品总结" target="_blank">产品总结</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=18" title="View all posts filed under 优化案例" target="_blank">优化案例</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=12" title="View all posts filed under 圆桌交流" target="_blank">圆桌交流</a> (2)</li>
<li><a href="https://blog.bluedavy.com/?cat=8" title="View all posts filed under 容量规划" target="_blank">容量规划</a> (2)</li>
<li><a href="https://blog.bluedavy.com/?cat=97" title="View all posts filed under 迁户口" target="_blank">迁户口</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=52" title="View all posts filed under 高可用" target="_blank">高可用</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=3" title="View all posts filed under 高并发" target="_blank">高并发</a> (3)</li>
<li><p><a href="https://blog.bluedavy.com/?cat=1" title="关于性能优化方面的一些东西。" target="_blank">高性能</a> (2)</p>
<h3 id="recent-comments">Recent Comments</h3>
</li>
<li><p><a href="http://code1.riaos.com/?p=5030138" target="_blank">JVM调优 | code1（code1.riaos.com）</a> on <a href="https://blog.bluedavy.com/?p=70&amp;cpage=1#comment-16520" target="_blank">说说MaxTenuringThreshold这个参数</a></p>
</li>
<li><a href="http://architecture1.riaos.com/?p=3063358" target="_blank">JVM调优 | architecture（riaos.com）</a> on <a href="https://blog.bluedavy.com/?p=70&amp;cpage=1#comment-16519" target="_blank">说说MaxTenuringThreshold这个参数</a></li>
<li><a href="http://bluedavy.com/" target="_blank">bluedavy</a> on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16462" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
<li>xiaobo on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16460" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
<li><a href="http://bluedavy.com/" target="_blank">bluedavy</a> on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16459" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
</ul>
<h3 id="tags">Tags</h3>
<p><a href="https://blog.bluedavy.com/?tag=btrace" title="2 topics" target="_blank">btrace</a> <a href="https://blog.bluedavy.com/?tag=c1" title="1 topic" target="_blank">c1</a> <a href="https://blog.bluedavy.com/?tag=c2" title="1 topic" target="_blank">c2</a> <a href="https://blog.bluedavy.com/?tag=deflater" title="1 topic" target="_blank">Deflater</a> <a href="https://blog.bluedavy.com/?tag=facebook" title="2 topics" target="_blank">facebook</a> <a href="https://blog.bluedavy.com/?tag=gc" title="4 topics" target="_blank">gc</a> <a href="https://blog.bluedavy.com/?tag=gc-tuning" title="2 topics" target="_blank">gc tuning</a> <a href="https://blog.bluedavy.com/?tag=grizzly" title="2 topics" target="_blank">Grizzly</a> <a href="https://blog.bluedavy.com/?tag=hbase" title="6 topics" target="_blank">HBase</a> <a href="https://blog.bluedavy.com/?tag=hotspot" title="1 topic" target="_blank">hotspot</a> <a href="https://blog.bluedavy.com/?tag=inflater" title="1 topic" target="_blank">Inflater</a> <a href="https://blog.bluedavy.com/?tag=interpreter" title="1 topic" target="_blank">interpreter</a> <a href="https://blog.bluedavy.com/?tag=javac" title="1 topic" target="_blank">javac</a> <a href="https://blog.bluedavy.com/?tag=java-code-generation" title="1 topic" target="_blank">java code generation</a> <a href="https://blog.bluedavy.com/?tag=javaone" title="4 topics" target="_blank">JavaOne</a> <a href="https://blog.bluedavy.com/?tag=javaone-general-technical-session" title="1 topic" target="_blank">javaone general technical session</a> <a href="https://blog.bluedavy.com/?tag=java%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c" title="1 topic" target="_blank">java代码执行</a> <a href="https://blog.bluedavy.com/?tag=java-%e5%b9%b6%e5%8f%91" title="1 topic" target="_blank">Java 并发</a> <a href="https://blog.bluedavy.com/?tag=jit" title="1 topic" target="_blank">jit</a> <a href="https://blog.bluedavy.com/?tag=jvm" title="12 topics" target="_blank">jvm</a> <a href="https://blog.bluedavy.com/?tag=memory-management" title="1 topic" target="_blank">memory management</a> <a href="https://blog.bluedavy.com/?tag=native-memory-leak" title="1 topic" target="_blank">Native Memory Leak</a> <a href="https://blog.bluedavy.com/?tag=nosql" title="2 topics" target="_blank">NoSQL</a> <a href="https://blog.bluedavy.com/?tag=oom" title="1 topic" target="_blank">oom</a> <a href="https://blog.bluedavy.com/?tag=oracle-keynote" title="1 topic" target="_blank">oracle keynote</a> <a href="https://blog.bluedavy.com/?tag=pessimism-policy" title="1 topic" target="_blank">pessimism policy</a> <a href="https://blog.bluedavy.com/?tag=references" title="1 topic" target="_blank">references</a> <a href="https://blog.bluedavy.com/?tag=rpc" title="2 topics" target="_blank">RPC</a> <a href="https://blog.bluedavy.com/?tag=serial-gc" title="1 topic" target="_blank">serial gc</a> <a href="https://blog.bluedavy.com/?tag=soa" title="2 topics" target="_blank">SOA</a> <a href="https://blog.bluedavy.com/?tag=sun-jdk" title="1 topic" target="_blank">sun jdk</a> <a href="https://blog.bluedavy.com/?tag=sun-jdk-oom" title="1 topic" target="_blank">sun jdk oom</a> <a href="https://blog.bluedavy.com/?tag=web%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92%e7%9a%84%e8%89%ba%e6%9c%af" title="1 topic" target="_blank">Web容量规划的艺术</a> <a href="https://blog.bluedavy.com/?tag=yuanzhuo" title="1 topic" target="_blank">yuanzhuo</a> <a href="https://blog.bluedavy.com/?tag=%e4%b9%a6" title="1 topic" target="_blank">书:分布式Java应用</a> <a href="https://blog.bluedavy.com/?tag=%e4%b9%a6%e8%af%84" title="1 topic" target="_blank">书评</a> <a href="https://blog.bluedavy.com/?tag=%e4%ba%92%e8%81%94%e7%bd%91%e6%8a%80%e6%9c%af" title="1 topic" target="_blank">互联网技术</a> <a href="https://blog.bluedavy.com/?tag=%e4%ba%a4%e6%b5%81" title="1 topic" target="_blank">交流</a> <a href="https://blog.bluedavy.com/?tag=%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86" title="1 topic" target="_blank">内存管理</a> <a href="https://blog.bluedavy.com/?tag=%e5%88%86%e5%b8%83%e5%bc%8fjava%e5%ba%94%e7%94%a8" title="2 topics" target="_blank">分布式Java应用</a> <a href="https://blog.bluedavy.com/?tag=%e5%9c%86%e6%a1%8c%e4%ba%a4%e6%b5%81" title="1 topic" target="_blank">圆桌交流</a> <a href="https://blog.bluedavy.com/?tag=%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92" title="2 topics" target="_blank">容量规划</a> <a href="https://blog.bluedavy.com/?tag=%e6%82%b2%e8%a7%82%e7%ad%96%e7%95%a5" title="3 topics" target="_blank">悲观策略</a> <a href="https://blog.bluedavy.com/?tag=%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6" title="1 topic" target="_blank">服务框架</a> <a href="https://blog.bluedavy.com/?tag=%e7%a1%85%e8%b0%b7%e5%85%ac%e5%8f%b8" title="1 topic" target="_blank">硅谷公司</a></p>
<h3 id="-">订阅</h3>
<h3 id="-">推荐书籍</h3>
<h3 id="my-book">My Book</h3>
<p><a href="http://book.douban.com/subject/4848587/" title="分布式Java应用：基础与实践" target="_blank"><img src="" alt=""></a> <a href="http://book.douban.com/subject/3843896/" title="OSGi原理与最佳实践" target="_blank"><img src="" alt=""></a>
© <a href="https://blog.bluedavy.com/" target="_blank">BlueDavy之技术blog</a> 2013</p>
<p><a href="http://icondock.com/" target="_blank">Icons</a> &amp; <a href="http://www.ndesign-studio.com/wp-themes" target="_blank">Wordpress Theme</a> by <a href="http://www.ndesign-studio.com/" target="_blank">N.Design</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/JVM/">JVM</a></li></span></span> | <span class="tags">Tagged <a href="/tags/JVM/" class="label label-primary">JVM</a><a href="/tags/Java&J2EE/" class="label label-success">Java&J2EE</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:42"datetime="2014-03-07 09:54:42"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-JVM--GC悲观策略之ParallelGC篇/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-JVM--GC悲观策略之ParallelGC篇" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-JVM--BTrace使用简介/">BTrace使用简介</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-JVM--BTrace使用简介/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="btrace-">BTrace使用简介</h1>
<h1 id="-bluedavy-blog-https-blog-bluedavy-com-"><a href="https://blog.bluedavy.com/" target="_blank">BlueDavy之技术blog</a></h1>
<p>{互联网，OSGi，Java, High Scalability, High Performance,HA}</p>
<ul>
<li><a href="https://blog.bluedavy.com/" target="_blank">Home</a></li>
<li><a href="https://blog.bluedavy.com/?page_id=2" target="_blank">About</a></li>
<li><a href="https://blog.bluedavy.com/?page_id=81" target="_blank">Photos</a></li>
</ul>
<h2 id="-btrace-https-blog-bluedavy-com-p-185-btrace-"><a href="https://blog.bluedavy.com/?p=185" title="BTrace使用简介" target="_blank">BTrace使用简介</a></h2>
<p>Nov 11</p>
<p><a href="http://bluedavy.com/" title="Visit bluedavy’s website" target="_blank">bluedavy</a><a href="https://blog.bluedavy.com/?cat=13" title="View all posts in jvm" target="_blank">jvm</a> <a href="https://blog.bluedavy.com/?tag=btrace" target="_blank">btrace</a> <a href="&quot;Comment on BTrace使用简介&quot;">13 Comments</a>
很多时候在online的应用出现问题时，很多时候我们需要知道更多的程序的运行细节，但又不可能在开发的时候就把程序中所有的运行细节都打印到日志上，通常这个时候能采取的就是修改代码，重新部署，然后再观察，但这种方法对于online应用来说不是很好，另外一方面如果碰到不好改的代码，例如引用的其他的外部的包什么的，就很麻烦了，BTrace就是一个可以在不改代码、不重启应用的情况下，动态的查看程序运行细节的工具，其官方网站在此：<a href="http://kenai.com/projects/btrace/" target="_blank"><a href="http://kenai.com/projects/btrace/">http://kenai.com/projects/btrace/</a></a>，在这篇blog中，就来看看如何用BTrace来动态的监测方法的一些运行细节状况。
BTrace通过动态的挂接用java写的代码到运行时上来获取到一些运行细节，例如典型的使用btrace的方法为：
btrace -cp [btrace的jar所在的路径，默认为btrace/build下] [pid] [需要运行的java代码]
例如一段这样的代码：
<a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24
25</p>
<p>26
import</p>
<p>java.util.Random;</p>
<p>public</p>
<p>class</p>
<p>Case1{</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>main(String[] args)</p>
<p>throws</p>
<p>Exception{</p>
<p>Random random=</p>
<p>new</p>
<p>Random();</p>
<p>CaseObject object=</p>
<p>new</p>
<p>CaseObject();</p>
<p>boolean</p>
<p>result=</p>
<p>true</p>
<p>;</p>
<p>while</p>
<p>(result){</p>
<p>result=object.execute(random.nextInt(</p>
<p>1000</p>
<p>));</p>
<p>Thread.sleep(</p>
<p>1000</p>
<p>);</p>
<p>}</p>
<p>}</p>
<p>}
public</p>
<p>class</p>
<p>CaseObject{</p>
<p>private</p>
<p>static</p>
<p>int</p>
<p>sleepTotalTime=</p>
<p>0</p>
<p>;  </p>
<p>public</p>
<p>boolean</p>
<p>execute(</p>
<p>int</p>
<p>sleepTime)</p>
<p>throws</p>
<p>Exception{</p>
<p>System.out.println(</p>
<p>&quot;sleep: &quot;</p>
<p>+sleepTime);</p>
<p>sleepTotalTime+=sleepTime;</p>
<p>Thread.sleep(sleepTime);</p>
<p>return</p>
<p>true</p>
<p>;</p>
<p>}</p>
<p>}</p>
<p>如在程序运行的情况下，想知道调用CaseObject的execute方法的以下几种情况，在BTrace中可以这么做：
1、调用此方法时传入的是什么参数，返回的是什么值，当时sleepTotalTime是多少？
BTrace脚本如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16</p>
<p>import</p>
<p>static</p>
<p>com.sun.btrace.BTraceUtils./*;</p>
<p>import</p>
<p>com.sun.btrace.annotations./*;</p>
<p>@BTrace</p>
<p>public</p>
<p>class</p>
<p>TraceMethodArgsAndReturn{</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>method=</p>
<p>&quot;execute&quot;</p>
<p>,</p>
<p>location=</p>
<p>@Location</p>
<p>(Kind.RETURN)</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecute(</p>
<p>@Self</p>
<p>CaseObject instance,</p>
<p>int</p>
<p>sleepTime,</p>
<p>@Return</p>
<p>boolean</p>
<p>result){</p>
<p>println(</p>
<p>&quot;call CaseObject.execute&quot;</p>
<p>);</p>
<p>println(strcat(</p>
<p>&quot;sleepTime is:&quot;</p>
<p>,str(sleepTime)));</p>
<p>println(strcat(</p>
<p>&quot;sleepTotalTime is:&quot;</p>
<p>,str(get(field(</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>&quot;sleepTotalTime&quot;</p>
<p>),instance))));</p>
<p>println(strcat(</p>
<p>&quot;return value is:&quot;</p>
<p>,str(result)));</p>
<p>}</p>
<p>}</p>
<p>然后直接执行btrace -cp btrace/build [pid] TraceMethodArgsAndReturn.java就可以了。
当程序中调用到caseobject的execute方法时，就会在btrace的console中输出相应的信息。
2、execute方法执行耗时是多久？
BTrace脚本如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24</p>
<p>import</p>
<p>static</p>
<p>com.sun.btrace.BTraceUtils./*;</p>
<p>import</p>
<p>com.sun.btrace.annotations./*;</p>
<p>@BTrace</p>
<p>public</p>
<p>class</p>
<p>TraceMethodExecuteTime{</p>
<p>@TLS</p>
<p>static</p>
<p>long</p>
<p>beginTime;</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>method=</p>
<p>&quot;execute&quot;</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecuteBegin(){</p>
<p>beginTime=timeMillis();</p>
<p>}</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>method=</p>
<p>&quot;execute&quot;</p>
<p>,</p>
<p>location=</p>
<p>@Location</p>
<p>(Kind.RETURN)</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecute(</p>
<p>int</p>
<p>sleepTime,</p>
<p>@Return</p>
<p>boolean</p>
<p>result){</p>
<p>println(strcat(strcat(</p>
<p>&quot;CaseObject.execute time is:&quot;</p>
<p>,str(timeMillis()-beginTime)),</p>
<p>&quot;ms&quot;</p>
<p>));</p>
<p>}</p>
<p>}</p>
<p>3、谁调用了execute方法？
BTrace脚本如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13     </p>
<p>import</p>
<p>static</p>
<p>com.sun.btrace.BTraceUtils./*;</p>
<p>import</p>
<p>com.sun.btrace.annotations./*;</p>
<p>@BTrace</p>
<p>public</p>
<p>class</p>
<p>TraceMethodCallee{</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>method=</p>
<p>&quot;execute&quot;</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecute(){</p>
<p>println(</p>
<p>&quot;who call CaseObject.execute :&quot;</p>
<p>);</p>
<p>jstack();</p>
<p>}
}</p>
<p>4、有没有人调用CaseObject中的哪一行代码？
BTrace脚本如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12</p>
<p>import</p>
<p>static</p>
<p>com.sun.btrace.BTraceUtils./*;</p>
<p>import</p>
<p>com.sun.btrace.annotations./*;</p>
<p>@BTrace</p>
<p>public</p>
<p>class</p>
<p>TraceMethodLine{</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>location=</p>
<p>@Location</p>
<p>(value=Kind.LINE,line=</p>
<p>5</p>
<p>)</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecute(</p>
<p>@ProbeClassName</p>
<p>String pcn,</p>
<p>@ProbeMethodName</p>
<p>String pmn,</p>
<p>int</p>
<p>line){</p>
<p>println(strcat(strcat(strcat(</p>
<p>&quot;call &quot;</p>
<p>,pcn),</p>
<p>&quot;.&quot;</p>
<p>),pmn));</p>
<p>}</p>
<p>}</p>
<p>从上面可看出，在有了BTrace后，要动态的跟踪代码的运行细节还是非常爽的，更多的细节的操作请大家查看BTrace的<a href="http://kenai.com/projects/btrace/pages/UserGuide" target="_blank">User Guide</a>。</p>
<p><a href="https://blog.bluedavy.com/?p=170" target="_blank">GC悲观策略之Serial GC篇</a> <a href="https://blog.bluedavy.com/?p=187" target="_blank">学习JVM的References</a></p>
<h3 id="13-comments-add-yours-">13 Comments <em>(<a href="">+add yours?</a>)</em></h3>
<ol>
<li><img src="" alt=""> <a href="http://www.helishi.net/" target="_blank">ikbear</a>
<strong>Nov 11, 2010</strong> @ 17:41:12
收藏了。</li>
<li><img src="https://secure.gravatar.com/avatar/4a2de3195dfd282b2f0ea420dc7a6a7a?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> pandonix
<strong>Nov 11, 2010</strong> @ 20:58:54
关于方法的执行时间和返回值，有个问题请教，如果调用量非常大的方法，有没有类似染色日志这样的功能：只需要打印参数符合某种条件的调用情况？</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Nov 12, 2010</strong> @ 11:42:06
<img src="" alt=":)"> ，这个自己可以在脚本里判断下…</li>
<li><img src="https://secure.gravatar.com/avatar/bd17360b1eb0b26b89a19de9cebed4f9?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> vitty
<strong>Nov 14, 2010</strong> @ 14:09:22
不知道这个对被监测程序的性能影响有多大？不过真的很爽呢。</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Nov 14, 2010</strong> @ 19:53:38
据使用来看，影响很小。</li>
<li><img src="https://secure.gravatar.com/avatar/baad2156c4a21abc487fb92bbd53a174?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> bobo
<strong>Nov 16, 2010</strong> @ 10:16:58
学习,哈哈</li>
<li><img src="https://secure.gravatar.com/avatar/5ef11dda80e7ce522810093bd8a791eb?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> xuanyuanzhiyuan
<strong>Dec 21, 2010</strong> @ 15:37:22
学习了 ：）</li>
<li><img src="https://secure.gravatar.com/avatar/4a2de3195dfd282b2f0ea420dc7a6a7a?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> pandonix
<strong>Dec 27, 2010</strong> @ 23:07:55
运行第一个例子：TraceMethodArgsAndReturn.java报错：
TraceMethodArgsAndReturn.java:10: 找不到符号
符号： 类 CaseObject
位置： 类 TraceMethodArgsAndReturn
把@Self CaseObject instance修改成为@Self Object self，并且去掉println(strcat(“sleepTotalTime is:”,str(get(field(“CaseObject”,”sleepTotalTime”),instance))));
就可以了，但是楼主希望获取sleepTotalTime的需求就满足不鸟了。还不太明白@Self的含义，再看看纠结的文档吧</li>
<li><img src="https://secure.gravatar.com/avatar/4a2de3195dfd282b2f0ea420dc7a6a7a?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> pandonix
<strong>Dec 27, 2010</strong> @ 23:44:37
找到原因了，是CaseObject不在classthpath中，如果用到了@Self CaseObject ，编译TraceMethodArgsAndReturn.java时会去找CaseObject类。
简单的将CaseObject.java放到跟TraceMethodArgsAndReturn.java同一目录即可</li>
<li><img src="https://secure.gravatar.com/avatar/6a8f8285a42a76f5e47159c9f09a7c4f?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> 光夏
<strong>Jan 23, 2011</strong> @ 11:34:36
使用TLS得注意递归调用的情况吧</li>
<li><img src="" alt=""> victorcai
<strong>Jul 19, 2011</strong> @ 15:03:18
请问各位大侠btrace能否在windows xp上使用,是否需要设置环境变量,我在windows xp上每次使用都失败<h3 id="leave-a-reply">Leave a Reply</h3>
</li>
</ol>
<p><a href="">Cancel</a></p>
<p>Name (required)</p>
<p>Mail (required)</p>
<p>Website</p>
<p><img src="https://blog.bluedavy.com/wp-content/plugins/si-captcha-for-wordpress/captcha/securimage_show.php?si_form_id=com&amp;prefix=2KNUhEvWsRaEKSqu" alt="CAPTCHA Image" title="CAPTCHA Image"></p>
<p><a href="&quot;Refresh Image&quot;"><img src="" alt="Refresh Image"></a></p>
<p>CAPTCHA Code /*</p>
<p><style type='text/css'>/#submit {display:none;}</style><br /> <input name="submit" type="submit" id="submit-alt" tabindex="6" value="Submit Comment" /></p>
<p>July 2013 M T W T F S S <a href="https://blog.bluedavy.com/?m=201303" title="View posts for March 2013" target="_blank">« Mar</a>     1234567 891011121314 15161718192021 22232425262728 293031  </p>
<h3 id="categories">Categories</h3>
<ul>
<li><a href="https://blog.bluedavy.com/?cat=63" title="View all posts filed under Java" target="_blank">Java</a> (10)</li>
<li><a href="https://blog.bluedavy.com/?cat=13" title="View all posts filed under jvm" target="_blank">jvm</a> (19)</li>
<li><a href="https://blog.bluedavy.com/?cat=56" title="View all posts filed under NoSQL" target="_blank">NoSQL</a> (7)</li>
<li><a href="https://blog.bluedavy.com/?cat=4" title="View all posts filed under SOA" target="_blank">SOA</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=11" title="关于《分布式Java应用：基础与实践》书部分章节的公开、书内容的纠错以及补充完善。" target="_blank">书:分布式Java应用</a> (5)</li>
<li><a href="https://blog.bluedavy.com/?cat=6" title="View all posts filed under 互联网" target="_blank">互联网</a> (5)</li>
<li><a href="https://blog.bluedavy.com/?cat=46" title="View all posts filed under 产品总结" target="_blank">产品总结</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=18" title="View all posts filed under 优化案例" target="_blank">优化案例</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=12" title="View all posts filed under 圆桌交流" target="_blank">圆桌交流</a> (2)</li>
<li><a href="https://blog.bluedavy.com/?cat=8" title="View all posts filed under 容量规划" target="_blank">容量规划</a> (2)</li>
<li><a href="https://blog.bluedavy.com/?cat=97" title="View all posts filed under 迁户口" target="_blank">迁户口</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=52" title="View all posts filed under 高可用" target="_blank">高可用</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=3" title="View all posts filed under 高并发" target="_blank">高并发</a> (3)</li>
<li><p><a href="https://blog.bluedavy.com/?cat=1" title="关于性能优化方面的一些东西。" target="_blank">高性能</a> (2)</p>
<h3 id="recent-comments">Recent Comments</h3>
</li>
<li><p><a href="http://code1.riaos.com/?p=5030138" target="_blank">JVM调优 | code1（code1.riaos.com）</a> on <a href="https://blog.bluedavy.com/?p=70&amp;cpage=1#comment-16520" target="_blank">说说MaxTenuringThreshold这个参数</a></p>
</li>
<li><a href="http://architecture1.riaos.com/?p=3063358" target="_blank">JVM调优 | architecture（riaos.com）</a> on <a href="https://blog.bluedavy.com/?p=70&amp;cpage=1#comment-16519" target="_blank">说说MaxTenuringThreshold这个参数</a></li>
<li><a href="http://bluedavy.com/" target="_blank">bluedavy</a> on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16462" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
<li>xiaobo on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16460" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
<li><a href="http://bluedavy.com/" target="_blank">bluedavy</a> on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16459" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
</ul>
<h3 id="tags">Tags</h3>
<p><a href="https://blog.bluedavy.com/?tag=btrace" title="2 topics" target="_blank">btrace</a> <a href="https://blog.bluedavy.com/?tag=c1" title="1 topic" target="_blank">c1</a> <a href="https://blog.bluedavy.com/?tag=c2" title="1 topic" target="_blank">c2</a> <a href="https://blog.bluedavy.com/?tag=deflater" title="1 topic" target="_blank">Deflater</a> <a href="https://blog.bluedavy.com/?tag=facebook" title="2 topics" target="_blank">facebook</a> <a href="https://blog.bluedavy.com/?tag=gc" title="4 topics" target="_blank">gc</a> <a href="https://blog.bluedavy.com/?tag=gc-tuning" title="2 topics" target="_blank">gc tuning</a> <a href="https://blog.bluedavy.com/?tag=grizzly" title="2 topics" target="_blank">Grizzly</a> <a href="https://blog.bluedavy.com/?tag=hbase" title="6 topics" target="_blank">HBase</a> <a href="https://blog.bluedavy.com/?tag=hotspot" title="1 topic" target="_blank">hotspot</a> <a href="https://blog.bluedavy.com/?tag=inflater" title="1 topic" target="_blank">Inflater</a> <a href="https://blog.bluedavy.com/?tag=interpreter" title="1 topic" target="_blank">interpreter</a> <a href="https://blog.bluedavy.com/?tag=javac" title="1 topic" target="_blank">javac</a> <a href="https://blog.bluedavy.com/?tag=java-code-generation" title="1 topic" target="_blank">java code generation</a> <a href="https://blog.bluedavy.com/?tag=javaone" title="4 topics" target="_blank">JavaOne</a> <a href="https://blog.bluedavy.com/?tag=javaone-general-technical-session" title="1 topic" target="_blank">javaone general technical session</a> <a href="https://blog.bluedavy.com/?tag=java%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c" title="1 topic" target="_blank">java代码执行</a> <a href="https://blog.bluedavy.com/?tag=java-%e5%b9%b6%e5%8f%91" title="1 topic" target="_blank">Java 并发</a> <a href="https://blog.bluedavy.com/?tag=jit" title="1 topic" target="_blank">jit</a> <a href="https://blog.bluedavy.com/?tag=jvm" title="12 topics" target="_blank">jvm</a> <a href="https://blog.bluedavy.com/?tag=memory-management" title="1 topic" target="_blank">memory management</a> <a href="https://blog.bluedavy.com/?tag=native-memory-leak" title="1 topic" target="_blank">Native Memory Leak</a> <a href="https://blog.bluedavy.com/?tag=nosql" title="2 topics" target="_blank">NoSQL</a> <a href="https://blog.bluedavy.com/?tag=oom" title="1 topic" target="_blank">oom</a> <a href="https://blog.bluedavy.com/?tag=oracle-keynote" title="1 topic" target="_blank">oracle keynote</a> <a href="https://blog.bluedavy.com/?tag=pessimism-policy" title="1 topic" target="_blank">pessimism policy</a> <a href="https://blog.bluedavy.com/?tag=references" title="1 topic" target="_blank">references</a> <a href="https://blog.bluedavy.com/?tag=rpc" title="2 topics" target="_blank">RPC</a> <a href="https://blog.bluedavy.com/?tag=serial-gc" title="1 topic" target="_blank">serial gc</a> <a href="https://blog.bluedavy.com/?tag=soa" title="2 topics" target="_blank">SOA</a> <a href="https://blog.bluedavy.com/?tag=sun-jdk" title="1 topic" target="_blank">sun jdk</a> <a href="https://blog.bluedavy.com/?tag=sun-jdk-oom" title="1 topic" target="_blank">sun jdk oom</a> <a href="https://blog.bluedavy.com/?tag=web%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92%e7%9a%84%e8%89%ba%e6%9c%af" title="1 topic" target="_blank">Web容量规划的艺术</a> <a href="https://blog.bluedavy.com/?tag=yuanzhuo" title="1 topic" target="_blank">yuanzhuo</a> <a href="https://blog.bluedavy.com/?tag=%e4%b9%a6" title="1 topic" target="_blank">书:分布式Java应用</a> <a href="https://blog.bluedavy.com/?tag=%e4%b9%a6%e8%af%84" title="1 topic" target="_blank">书评</a> <a href="https://blog.bluedavy.com/?tag=%e4%ba%92%e8%81%94%e7%bd%91%e6%8a%80%e6%9c%af" title="1 topic" target="_blank">互联网技术</a> <a href="https://blog.bluedavy.com/?tag=%e4%ba%a4%e6%b5%81" title="1 topic" target="_blank">交流</a> <a href="https://blog.bluedavy.com/?tag=%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86" title="1 topic" target="_blank">内存管理</a> <a href="https://blog.bluedavy.com/?tag=%e5%88%86%e5%b8%83%e5%bc%8fjava%e5%ba%94%e7%94%a8" title="2 topics" target="_blank">分布式Java应用</a> <a href="https://blog.bluedavy.com/?tag=%e5%9c%86%e6%a1%8c%e4%ba%a4%e6%b5%81" title="1 topic" target="_blank">圆桌交流</a> <a href="https://blog.bluedavy.com/?tag=%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92" title="2 topics" target="_blank">容量规划</a> <a href="https://blog.bluedavy.com/?tag=%e6%82%b2%e8%a7%82%e7%ad%96%e7%95%a5" title="3 topics" target="_blank">悲观策略</a> <a href="https://blog.bluedavy.com/?tag=%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6" title="1 topic" target="_blank">服务框架</a> <a href="https://blog.bluedavy.com/?tag=%e7%a1%85%e8%b0%b7%e5%85%ac%e5%8f%b8" title="1 topic" target="_blank">硅谷公司</a></p>
<h3 id="-">订阅</h3>
<h3 id="-">推荐书籍</h3>
<h3 id="my-book">My Book</h3>
<p><a href="http://book.douban.com/subject/4848587/" title="分布式Java应用：基础与实践" target="_blank"><img src="" alt=""></a> <a href="http://book.douban.com/subject/3843896/" title="OSGi原理与最佳实践" target="_blank"><img src="" alt=""></a>
© <a href="https://blog.bluedavy.com/" target="_blank">BlueDavy之技术blog</a> 2013</p>
<p><a href="http://icondock.com/" target="_blank">Icons</a> &amp; <a href="http://www.ndesign-studio.com/wp-themes" target="_blank">Wordpress Theme</a> by <a href="http://www.ndesign-studio.com/" target="_blank">N.Design</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/JVM/">JVM</a></li></span></span> | <span class="tags">Tagged <a href="/tags/JVM/" class="label label-primary">JVM</a><a href="/tags/Java&J2EE/" class="label label-success">Java&J2EE</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-JVM--BTrace使用简介/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-JVM--BTrace使用简介" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--使用J-Interop在Java中调用WMI/">使用 J</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--使用J-Interop在Java中调用WMI/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-j-interop-java-wmi">使用 J-Interop 在 Java 中调用WMI</h1>
<p><a href="http://simpleframework.net/space.html" target="_blank">我的空间</a> <img src="" alt="">|<a href="http://simpleframework.net/invite.html" target="_blank">邀请</a> |<a href="">登录</a>|<a href="http://simpleframework.net/regist.html" target="_blank">注册</a> <a href="http://simpleframework.net/" target="_blank"> </a>  简单就是最好的，java web 开发，simple 让你化繁为简 !</p>
<p><a href="http://simpleframework.net/index.html" target="_blank">首页</a><a href=""></a><a href="http://simpleframework.net/news.html">新闻资讯</a><a href=""></a><a href="http://simpleframework.net/blog.html">博客</a><a href=""></a><a href="http://simpleframework.net/bbs.html">论坛</a><a href=""></a><a href="http://simpleframework.net/market.html">Simple市场</a><a href=""></a><a href="http://simpleframework.net/doc/d2.html">全面介绍</a><a href=""></a><a href="http://demo.simpleframework.net/simple3">simple3演示</a><a href=""></a><a href="http://simple4.simpleframework.net/simple4">simple4演示</a><a href=""></a><a href="http://simpleframework.net/home.html">My Portal</a></p>
<p><img src="" alt=""><a href="http://simpleframework.net/news/v/27953.html" target="_blank">SimpleFramework开发者必读</a></p>
<p><a href="http://simpleframework.net/space/176.html" target="_blank"><img src="" alt=""></a></p>
<p><a href="http://simpleframework.net/blog/176.html" target="_blank">赵老师的博客</a></p>
<ul>
<li><a href="http://simpleframework.net/blog.html" target="_blank">全部</a></li>
<li><a href="http://simpleframework.net/blog.html?t=recommended" target="_blank">推荐</a></li>
<li><a href="http://simpleframework.net/$resource/default/login/jsp/location.jsp" target="_blank">关注</a></li>
<li><a href="http://simpleframework.net/$resource/default/login/jsp/location.jsp" target="_blank">我的博客</a></li>
</ul>
<p><a href="">关注</a> (<a href="">1</a>)</p>
<p><a href="http://simpleframework.net/blog.html" target="_blank">博客</a>»<a href="http://simpleframework.net/blog/176.html" target="_blank">赵老师</a>»显示全文</p>
<p>使用 J-Interop 在 Java 中调用WMI
5评/3355阅</p>
<p>发表于: 2011-06-16 07:12</p>
<p><strong>有关**</strong>WMI<strong>**的小知识</strong></p>
<p><a href="http://msdn.microsoft.com/en-us/library/aa394582(VS.85" target="_blank"><strong>Windows**</strong>管理规范（<strong><strong>WMI</strong></strong>）**</a>.aspx)是微软对来自<a href="http://en.wikipedia.org/wiki/Distributed_Management_Task_Force" title="Distributed Management Task Force" target="_blank">分布式管理任务组</a>（<strong>DMTF</strong>）的<a href="http://en.wikipedia.org/wiki/Web-Based_Enterprise_Management" title="Web-Based Enterprise Management" target="_blank">基于Web的企业管理</a>（WBEM）和<a href="http://en.wikipedia.org/wiki/Common_Information_Model_(computing" target="_blank">通用信息模型</a> &quot;Common Information Model (computing)&quot;)（CIM）标准的实现。WMI用于访问Windows系统、应用、网络、设备等组件，并管理它们。连接到一台机器通过<strong>DCOM</strong>进行管理。因此，有关<strong>DCOM</strong>的小知识将有助于本文的理解。你可以到MSDN了解有关WMI的更多细节。</p>
<h3 id="-j-interop-"><strong>J-Interop</strong></h3>
<p>市场上有一些在使用 JAVA 调用 WMI 的好库，包括 <a href="http://www.j-interop.org/index.html" target="_blank">J-Interop</a>、<a href="http://sourceforge.net/projects/jacob-project/" target="_blank">JACOB-Project</a> 和 <a href="http://j-integra.intrinsyc.com/products/com/" target="_blank">J-Integra</a>。其中，我更喜欢J-Interop，因为它是完全免费和开源的API。它提供了没有任何依赖的纯DCOM桥，完全用Java编写的没有任何JNI代码。</p>
<h3 id="-wmi-windows-"><strong>使用**</strong>WMI<strong><strong>管理</strong></strong>Windows<strong>**服务</strong></h3>
<p>现在，来看一个使用JAVA调用WMI的例子。这个例子利用J-Interop的API使用Win32_Service类解释WMI操作，将启动和停止在这个例子中的窗口服务。</p>
<h3 id="-1-wbem-"><strong>步骤**</strong>1<strong><strong>：连接到</strong></strong>WBEM<strong>**服务</strong></h3>
<p>下面的代码示例显示了使用J-Interop如何初始化DCOM会话，并连接到远程DCOM服务使。它使用SWbemLocator对象连接到<strong>SWbemServices</strong>，<strong>SWbemServices</strong>对象提供对本地或远程计算机WMI的访问，它调用“ConnectServer”方法连接到<strong>SWbemServices**</strong>。在本例中，<em>提供管理员级别的用户连接到远程计算机。**</em>
JISessiondcomSession=JISession.createSession(domainName,userName,password); dcomSession.useSessionSecurity(false);   JIComServercomServer=newJIComServer(valueOf(&quot;WbemScripting.SWbemLocator&quot;),hostIP,dcomSession); IJIDispatchwbemLocator=(IJIDispatch)narrowObject(comServer.createInstance().queryInterface(IID)); //parameterstoconnecttoWbemScripting.SWbemLocator Object[]params=newObject[]{                           newJIString(hostIP),//strServer                           newJIString(win32_namespace),//strNamespace                           JIVariant.OPTIONAL_PARAM(),//strUser                           JIVariant.OPTIONAL_PARAM(),//strPassword                           JIVariant.OPTIONAL_PARAM(),//strLocale                           JIVariant.OPTIONAL_PARAM(),//strAuthority                           newInteger(0),//iSecurityFlags                           JIVariant.OPTIONAL_PARAM()//objwbemNamedValueSet                           };   JIVariantresults[]=wbemLocator.callMethodA(&quot;ConnectServer&quot;,params); IJIDispatchwbemServices=(IJIDispatch)narrowObject(results[0].getObjectAsComObject());</p>
<p>（<strong>domainName</strong>=远程计算机域名，<strong>hostIP</strong>=远程计算机IP地址,<strong>用户名</strong>=管理员级别的用户，<strong>密码</strong>=密码）</p>
<h3 id="-2-win32_service-"><strong>第**</strong>2<strong><strong>步：获取</strong></strong>Win32_Service<strong>**实例</strong></h3>
<p>一旦你获得对<strong>SWbemServices</strong>对象的引用，就可以调用这个类的任何方法。其中<strong>WbemServices.InstancesOf**</strong>方法获得任何<strong><strong>Win32</strong></strong>类的实例。**</p>
<p>也可以使用WMI查询语言(WQL)达到同样的目的，如下所示：
finalintRETURN_IMMEDIATE=0x10; finalintFORWARD_ONLY=0x20; Object[]params=newObject[]{ newJIString(&quot;SELECT/*FROMWin32_Service&quot;), JIVariant.OPTIONAL_PARAM(), newJIVariant(newInteger(RETURN_IMMEDIATE+FORWARD_ONLY)) }; JIVariant[]servicesSet=wbemServices.callMethodA(&quot;ExecQuery&quot;,params); IJIDispatchwbemObjectSet=(IJIDispatch)narrowObject(servicesSet[0].getObjectAsComObject());</p>
<h3 id="-"><strong>第三步：执行方法</strong></h3>
<p>现在，已得到<strong>Win32_Service</strong>类的实例，可采用下述代码来调用同一类的方法，因为，它返回多个服务实例，要列举它们以便获取IJIDispatcher服务。
JIVariant newEnumvariant = wbemObjectSet.get(&quot;_NewEnum&quot;); IJIComObject enumComObject = newEnumvariant.getObjectAsComObject(); IJIEnumVariant enumVariant = (IJIEnumVariant) narrowObject(enumComObject.queryInterface(IJIEnumVariant.IID));   Object[] elements = enumVariant.next(1); JIArray aJIArray = (JIArray) elements[0];   JIVariant[] array = (JIVariant[]) aJIArray.getArrayInstance(); for (JIVariant variant : array) {     IJIDispatch wbemObjectDispatch = (IJIDispatch) narrowObject(variant.getObjectAsComObject());       JIVariant returnStatus = wbemObjectDispatch.callMethodA(&quot;StopService&quot;);       System.out.println(returnStatus.getObjectAsInt()); }</p>
<p>现在，下面的代码显示了一个使用WMI启动和停止Windows服务的完整Java类。</p>
<p>packagecom.wmi.windows;   importstaticorg.jinterop.dcom.core.JIProgId.valueOf; importstaticorg.jinterop.dcom.impls.JIObjectFactory.narrowObject; importstaticorg.jinterop.dcom.impls.automation.IJIDispatch.IID; importjava.util.logging.Level; importorg.jinterop.dcom.common.JIException; importorg.jinterop.dcom.common.JIRuntimeException; importorg.jinterop.dcom.common.JISystem; importorg.jinterop.dcom.core.IJIComObject; importorg.jinterop.dcom.core.JIArray; importorg.jinterop.dcom.core.JIComServer; importorg.jinterop.dcom.core.JISession; importorg.jinterop.dcom.core.JIString; importorg.jinterop.dcom.core.JIVariant; importorg.jinterop.dcom.impls.automation.IJIDispatch; importorg.jinterop.dcom.impls.automation.IJIEnumVariant;   publicclassServiceManager{            privatestaticStringdomainName=&quot;&quot;;          privatestaticStringuserName=&quot;administrator&quot;;          privatestaticStringpassword=&quot;&quot;;          privatestaticStringhostIP=&quot;127.0.0.1&quot;;          privatestaticfinalStringwin32<em>namespace=&quot;ROOT\CIMV2&quot;;            privatestaticfinalintSTOP_SERVICE=0;          privatestaticfinalintSTART_SERVICE=1;            privateJISessiondcomSession=null;          //<em>/</em>          /<em>          /</em>@paramargs          /<em>/          publicstaticvoidmain(String[]args){                  ServiceManagermanager=newServiceManager();                   manager.stopService(domainName,hostIP,userName,password,&quot;MySql&quot;);//stopsaservicenamedMySql          }          //</em>/<em>          /</em>Startsagivenserviceifitsstopped.          /<em>          /</em>@paramdomainName          /<em>@paramhostname          /</em>@paramusername          /<em>@parampassword          /</em>@paramserviceName          /<em>/    publicvoidstartService(StringdomainName,Stringhostname,Stringusername,Stringpassword,StringserviceName){                  execute(domainName,hostname,username,password,serviceName,START_SERVICE);          }          //</em>/<em>          /</em>Stopsagivenserviceifitsrunning.          /<em>          /</em>@paramdomainName          /<em>@paramhostname          /</em>@paramusername          /<em>@parampassword          /</em>@paramserviceName          /<em>/     publicvoidstopService(StringdomainName,Stringhostname,Stringusername,Stringpassword,StringserviceName){                  execute(domainName,hostname,username,password,serviceName,STOP_SERVICE);          }          //</em>/<em>          /</em>Starts/Stopsagivenserviceofremotemachineashostname.          /<em>          /</em>@paramdomainName          /<em>@paramhostname          /</em>@paramusername          /<em>@parampassword          /</em>@paramserviceName          /<em>@paramaction          /</em>/ publicvoidexecute(StringdomainName,Stringhostname,Stringusername,Stringpassword,StringserviceName,intaction){                    try{                           IJIDispatchwbemServices=createCOMServer();                             finalintRETURN_IMMEDIATE=0x10;                           finalintFORWARD_ONLY=0x20;                           Object[]params=newObject[]{                                             newJIString(&quot;SELECT/*FROMWin32_ServiceWHEREName=&#39;&quot;+serviceName+&quot;&#39;&quot;),                                             JIVariant.OPTIONAL_PARAM(),                                             newJIVariant(newInteger(RETURN_IMMEDIATE+FORWARD_ONLY))                           };                           JIVariant[]servicesSet=wbemServices.callMethodA(&quot;ExecQuery&quot;,params);                           IJIDispatchwbemObjectSet=(IJIDispatch)narrowObject(servicesSet[0].getObjectAsComObject());                             JIVariantnewEnumvariant=wbemObjectSet.get(&quot;_NewEnum&quot;);                           IJIComObjectenumComObject=newEnumvariant.getObjectAsComObject();                    IJIEnumVariantenumVariant=(IJIEnumVariant)narrowObject(enumComObject.queryInterface(IJIEnumVariant.IID));                             Object[]elements=enumVariant.next(1);                           JIArrayaJIArray=(JIArray)elements[0];                             JIVariant[]array=(JIVariant[])aJIArray.getArrayInstance();                           for(JIVariantvariant:array){                                    IJIDispatchwbemObjectDispatch=(IJIDispatch)narrowObject(variant.getObjectAsComObject());                                      //Printobjectastext.                                    JIVariant[]v=wbemObjectDispatch.callMethodA(&quot;GetObjectText</em>&quot;,newObject[]{1});                                    System.out.println(v[0].getObjectAsString().getString());                                      //StartorStoptheservice                                    StringmethodToInvoke=(action==START_SERVICE)?&quot;StartService&quot;:&quot;StopService&quot;;                                    JIVariantreturnStatus=wbemObjectDispatch.callMethodA(methodToInvoke);                           System.out.println(&quot;Returnstatus:&quot;+returnStatus.getObjectAsInt());//ifreturncode=0success.Seemsdnformoredetailsaboutthemethod.                           }                  }catch(Exceptione){                           e.printStackTrace();                  }finally{                           if(dcomSession!=null){                                    try{                                             JISession.destroySession(dcomSession);                                    }catch(Exceptionex){                                             ex.printStackTrace();                                    }                           }                  }          }          //<em>/</em>          /<em>InitializeDCOMsessionandconnecttoSWBEMserviceongivenhostmachine.          /</em>@return          /*/          privateIJIDispatchcreateCOMServer(){                  JIComServercomServer;                  try{                           JISystem.getLogger().setLevel(Level.WARNING);                           JISystem.setAutoRegisteration(true);                           dcomSession=JISession.createSession(domainName,userName,password);                           dcomSession.useSessionSecurity(false);                           comServer=newJIComServer(valueOf(&quot;WbemScripting.SWbemLocator&quot;),hostIP,dcomSession);                             IJIDispatchwbemLocator=(IJIDispatch)narrowObject(comServer.createInstance().queryInterface(IID));                           //parameterstoconnecttoWbemScripting.SWbemLocator                           Object[]params=newObject[]{                                             newJIString(hostIP),//strServer                                             newJIString(win32_namespace),//strNamespace                                             JIVariant.OPTIONAL_PARAM(),//strUser                                             JIVariant.OPTIONAL_PARAM(),//strPassword                                             JIVariant.OPTIONAL_PARAM(),//strLocale                                             JIVariant.OPTIONAL_PARAM(),//strAuthority                                             newInteger(0),//iSecurityFlags                                             JIVariant.OPTIONAL_PARAM()//objwbemNamedValueSet                           };                           JIVariantresults[]=wbemLocator.callMethodA(&quot;ConnectServer&quot;,params);                           IJIDispatchwbemServices=(IJIDispatch)narrowObject(results[0].getObjectAsComObject());                           returnwbemServices;                  }catch(JIExceptionjie){                           System.out.println(jie.getMessage());                           jie.printStackTrace();                  }catch(JIRuntimeExceptionjire){                           jire.printStackTrace();                  }catch(Exceptione){                           e.printStackTrace();                  }finally{                           if(dcomSession!=null){                                    try{                                             JISession.destroySession(dcomSession);                                    }catch(JIExceptione){                                             e.printStackTrace();                                    }                           }                  }                  returnnull;          } }</p>
<p>【原文】<a href="http://nikunjp.wordpress.com/" target="_blank"><a href="http://nikunjp.wordpress.com/">http://nikunjp.wordpress.com/</a></a>
评论 (共 5 条评论)</p>
<p>匿名 (219.142.23.106), 475天前</p>
<p>j-interop 远程收集WIN7 的eventlog日志怎么不行啊，求助赵老师
<a href="">回复</a>|<a href="">支持</a>|<a href="">反对</a>
匿名 (219.142.23.106), 475天前</p>
<p>是啊，win7怎么不行呢。。
<a href="">回复</a>|<a href="">支持</a>|<a href="">反对</a></p>
<p>匿名 (59.40.119.215), 497天前</p>
<p>xp的开始Remote Register 服务就可以了。 win7还在研究中
<a href="">回复</a>|<a href="">支持</a>|<a href="">反对</a>
匿名 (219.133.0.1), 501天前</p>
<p>win7平台为什么会用不了呢？ 我也测试过了，xp的机器可以成功运行。
有些xp的也不行，我觉得可能是有什么配置项没有配置而导致。
<a href="">回复</a>|<a href="">支持</a>|<a href="">反对</a></p>
<p>匿名 (111.4.219.247), 722天前</p>
<p>我测试报错：The system cannot find the file specified. win7平台。
<a href="">回复</a>|<a href="">支持</a>|<a href="">反对</a> (共5, 显示全部)/</p>
<p><a href="">表情</a> 发表评论</p>
<p><img src="" alt=""></p>
<p><a href="">看不清楚，再换一张</a> <a href="">高级模式</a></p>
<p>相关主题</p>
<p><a href="http://simpleframework.net/blog/v/32903.html" target="_blank">JAVA问题定位技术</a> 2/3333</p>
<p><a href="http://simpleframework.net/space/26397.html" target="_blank">sword</a>, 799天前</p>
<p><a href="http://simpleframework.net/blog/v/18467.html" target="_blank">Java序列化和克隆</a> 0/1568</p>
<p><a href="http://simpleframework.net/space/534.html" target="_blank">书生</a>, 870天前
<a href="http://simpleframework.net/blog/v/46888.html" target="_blank">Java EE6中的装饰器，高级用法</a> 0/1163</p>
<p><a href="http://simpleframework.net/space/176.html" target="_blank">赵老师</a>, 733天前</p>
<p><a href="http://simpleframework.net/blog/v/16596.html" target="_blank">通过 Java 编程处理 XML 服务定义</a> 1/1691</p>
<p><a href="http://simpleframework.net/space/534.html" target="_blank">书生</a>, 877天前
<a href="http://simpleframework.net/blog/v/34389.html" target="_blank">解析Java软件开发中的五种认识误区</a> 0/1178</p>
<p><a href="http://simpleframework.net/space/534.html" target="_blank">书生</a>, 792天前</p>
<p><a href="http://simpleframework.net/blog/v/23210.html" target="_blank">Java内省和反射机制三步曲之(2)反射</a> 0/1409</p>
<p><a href="http://simpleframework.net/space/534.html" target="_blank">书生</a>, 854天前</p>
<p>一周点击排行
<a href="http://simpleframework.net/guestbook.html" target="_blank">留言</a>|<a href="http://simpleframework.net/contact.html" target="_blank">联系我们</a>|<a href="http://simpleframework.net/copyright.html" target="_blank">版权声明</a>|<a href="http://simpleframework.net/about.html" target="_blank">关于</a></p>
<p>simpleframework.net Copyright ©2011 版权所有</p>
<p>Powered by SimpleFramework [ 0.156 s ]</p>
<p>*</p>
<ul>
<li>数据装载中...
*</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/java-com/">java-com</a></li><li><a href="/categories/Java&J2EE/java-com/wmi-监控/">wmi-监控</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/java-com/" class="label label-success">java-com</a><a href="/tags/wmi-监控/" class="label label-info">wmi-监控</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--使用J-Interop在Java中调用WMI/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-java-com-wmi-监控--使用J-Interop在Java中调用WMI" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区/">100</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="100-java-windows-wmi-">100%纯java调用windows的wmi获取监控数据 - 肖国颖的个人页面 - 开源中国社区</h1>
<p><a href="http://www.oschina.net/" title="开源中国社区首页" target="_blank">开源中国社区</a></p>
<p>开源项目发现、使用和交流平台</p>
<ul>
<li><a href="http://www.oschina.net/project" target="_blank">项目</a></li>
<li><a href="http://www.oschina.net/question" target="_blank">讨论</a></li>
<li><a href="http://www.oschina.net/code/list" target="_blank">代码</a></li>
<li><a href="http://www.oschina.net/news" target="_blank">资讯</a></li>
<li><a href="http://www.oschina.net/translate" target="_blank">翻译</a></li>
<li><a href="http://www.oschina.net/blog" target="_blank">博客</a></li>
<li><a href="http://www.oschina.net/android" target="_blank">Android</a></li>
<li><a href="http://www.oschina.net/job" target="_blank">招聘</a></li>
</ul>
<p>当前访客身份： arctichia [ <a href="http://my.oschina.net/arcichia" target="_blank">我的空间</a> | <a href="http://my.oschina.net/action/user/logout?session=9c386f172b1174553110&amp;goto_page=http%3A%2F%2Fmy.oschina.net%2Fnoahxiao" target="_blank">退出</a> ]  <a href="http://my.oschina.net/arcichia/admin/inbox" title="进入我的留言箱" target="_blank">你有<em>0</em>新留言</a></p>
<p>软件 代码 讨论区 新闻 博客</p>
<p>软件</p>
<ul>
<li><a href="">软件</a></li>
<li><a href="">代码</a></li>
<li><a href="">讨论区</a></li>
<li><a href="">新闻</a></li>
<li><a href="">博客</a>
<a href="http://my.oschina.net/noahxiao" target="_blank"><img src="&quot;肖国颖&quot;" alt="肖国颖"></a>  <a href="http://my.oschina.net/noahxiao" title="男" target="_blank">肖国颖</a>  <img src="&quot;男&quot;" alt=""> <a href="&quot;成为TA的粉丝&quot;">关注此人</a></li>
</ul>
<p><a href="http://my.oschina.net/noahxiao/fellow" target="_blank">关注(4)</a> <a href="http://my.oschina.net/noahxiao/fans" target="_blank">粉丝(71)</a> <a href="http://www.oschina.net/question/3307_20931" title="查看OSCHINA积分规则" target="_blank">积分(280)</a></p>
<p>不做鬼中鬼，怎做人上人
<a href="">.发送留言</a> <a href="http://www.oschina.net/question/ask?user=569848" target="_blank">.请教问题</a></p>
<p><strong>博客分类</strong></p>
<ul>
<li><a href="http://my.oschina.net/noahxiao/blog?catalog=186739" target="_blank">工作日志</a>(47)</li>
<li><a href="http://my.oschina.net/noahxiao/blog?catalog=186740" target="_blank">日常记录</a>(0)</li>
<li><a href="http://my.oschina.net/noahxiao/blog?catalog=186741" target="_blank">转贴的文章</a>(0)
<strong>阅读排行</strong></li>
</ul>
<ol>
<li><a href="http://my.oschina.net/noahxiao/blog/61987" target="_blank">1. 在Android中嵌入AdMob广告，赚午饭钱</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/86328" target="_blank">2. 解决iOS6看YouTb的心酸，补充可看版(goagent+opendoor)</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/126357" target="_blank">3. 当单例（Singleton）爱上多线程——重复初始化问题</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/112759" target="_blank">4. Java序列化与JSON序列化大比拼</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/61495" target="_blank">5. 在Eclipse中用Scala语言开发Android应用</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/88687" target="_blank">6. Ubuntu 12.10下用Empathy（pidgin-lwqq）登录QQ</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/65071" target="_blank">7. 解决Ubuntu 12.04下频繁死机-Chrome</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/140771" target="_blank">8. 以Jar形式为Web项目提供资源文件（JS、CSS与图片）</a></li>
</ol>
<p><strong>最新评论</strong></p>
<ul>
<li><a href="http://my.oschina.net/wenshao" target="_blank">@wenshao</a>：fastjson缺省是做循环引用检测的，你关掉这个再测... <a href="http://my.oschina.net/action/tweet/go?obj=274988152&amp;type=18&amp;user=127152" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/wenshao" target="_blank">@wenshao</a>：这个测试不对，你直接测试JavaBean而不是Map看看... <a href="http://my.oschina.net/action/tweet/go?obj=274988031&amp;type=18&amp;user=127152" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/u/1182868" target="_blank">@rrstpit</a>：Fffff <a href="http://my.oschina.net/action/tweet/go?obj=274896306&amp;type=18&amp;user=1182868" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/fxl" target="_blank">@付学良</a>：引用来自“xautlx”的评论 Servlet3规范好像已经... <a href="http://my.oschina.net/action/tweet/go?obj=274529269&amp;type=18&amp;user=83617" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/112358" target="_blank">@yezheng1993</a>：引用来自“肖国颖”的评论 引用来自“yezheng19... <a href="http://my.oschina.net/action/tweet/go?obj=274481572&amp;type=18&amp;user=1173735" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/noahxiao" target="_blank">@肖国颖</a>：引用来自“yezheng1993”的评论 请问一下怎么在那... <a href="http://my.oschina.net/action/tweet/go?obj=274479348&amp;type=18&amp;user=569848" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/112358" target="_blank">@yezheng1993</a>：请问一下怎么在那边创建文件以及文件夹，新手，还... <a href="http://my.oschina.net/action/tweet/go?obj=274477519&amp;type=18&amp;user=1173735" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/u/151176" target="_blank">@xautlx</a>：Servlet3规范好像已经有标准支持：<a href="https://blogs" target="_blank">https://blogs</a>... <a href="http://my.oschina.net/action/tweet/go?obj=274464191&amp;type=18&amp;user=151176" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/u/613918" target="_blank">@ahnan</a>：www.webjars.org <a href="http://my.oschina.net/action/tweet/go?obj=274462857&amp;type=18&amp;user=613918" target="_blank">查看»</a></li>
<li><p><a href="http://my.oschina.net/wj2699" target="_blank">@wj2699</a>：spring的mvc确实有这么个功能，但是如果和apach... <a href="http://my.oschina.net/action/tweet/go?obj=274461745&amp;type=18&amp;user=106294" target="_blank">查看»</a>
<strong>访客统计</strong></p>
</li>
<li><p>今日访问：26</p>
</li>
<li>昨日访问：148</li>
<li>本周访问：389</li>
<li>本月访问：1573</li>
<li>所有访问：52224</li>
</ul>
<p><a href="http://my.oschina.net/noahxiao" target="_blank">空间</a> » <a href="http://my.oschina.net/noahxiao/blog" target="_blank">博客</a> » <a href="http://my.oschina.net/noahxiao/blog?catalog=186739" target="_blank">工作日志</a> » 博客正文</p>
<h1 id="-100-java-windows-wmi-"><img src="" alt=""> 100%纯java调用windows的wmi获取监控数据</h1>
<p><em>23</em>人收藏此文章,  <a href="&quot;添加到收藏夹&quot;">我要收藏</a>   发表于12个月前(2012-08-16 18:17) , 已有<strong>2348</strong>次阅读 ，共<strong><a href="">5</a></strong>个评论</p>
<p>纯java主要体现在可以跨平台调用com。所用的是j-Interop，它是100%纯java实现的com的调用</p>
<h3 id="1-">1、环境准备</h3>
<p>a、windows要开启Remote Registry与Windows Management Instrumentation服务</p>
<p>b、修改安全策略</p>
<p>我系统是英文的，如果是中文系统，翻译为中文，相对应的查找并修改。</p>
<p>Administrative Tools&gt;Local Security Policy&gt;Local Policy&gt;Security Policy&gt;Network access: Sharing and security model for local accounts</p>
<p>修改为Classic（经典）</p>
<p>c、禁用放火墙</p>
<p>d、window2008系统注册表越狱（高版本的win）</p>
<p>需要修改regedit中HKEY_CLASSES_ROOT\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}的权限，windows2008不再给Administrators完全控制权。</p>
<p>下载SetACL.exe，下载地址：<a href="http://files.helgeklein.com/downloads/SetACL/current/SetACL%20(executable%20version).zip" target="_blank">http://files.helgeklein.com/downloads/SetACL/current/SetACL%20(executable%20version).zip</a></p>
<p>set_wmi_reg_acl.cmd</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>1</p>
<p>SetACL.exe -on</p>
<p>&quot;HKEY_CLASSES_ROOT\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}&quot;</p>
<p>-ot reg -actn setowner -ownr</p>
<p>&quot;n:Administrators&quot;</p>
<p>2</p>
<p>SetACL.exe -on</p>
<p>&quot;HKEY_CLASSES_ROOT\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}&quot;</p>
<p>-ot reg -actn ace -ace</p>
<p>&quot;n:Administrators;p:full&quot;</p>
<p>以超级管理员身份执行这个cms，就会把owner与完全控制权限授予Administrators组</p>
<h2 id="-">#</h2>
<h3 id="2-">2、程序代码</h3>
<p>java类</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>001</p>
<p>package</p>
<p>org.noah.wmitest;</p>
<p>002</p>
<p>003</p>
<p>import</p>
<p>org.jinterop.dcom.common.JIException;</p>
<p>004</p>
<p>import</p>
<p>org.jinterop.dcom.common.JISystem;
005</p>
<p>import</p>
<p>org.jinterop.dcom.core./*;</p>
<p>006</p>
<p>import</p>
<p>org.jinterop.dcom.impls.JIObjectFactory;
007</p>
<p>import</p>
<p>org.jinterop.dcom.impls.automation.IJIDispatch;</p>
<p>008</p>
<p>import</p>
<p>org.jinterop.dcom.impls.automation.IJIEnumVariant;
009</p>
<p>import</p>
<p>org.slf4j.Logger;</p>
<p>010</p>
<p>import</p>
<p>org.slf4j.LoggerFactory;
011</p>
<p>012</p>
<p>import</p>
<p>java.net.UnknownHostException;
013</p>
<p>import</p>
<p>java.util.logging.Level;</p>
<p>014</p>
<p>015</p>
<p>//<em>/</em></p>
<p>016</p>
<p>/* Created with IntelliJ IDEA.
017</p>
<p>/* User: noah</p>
<p>018</p>
<p>/* Date: 8/16/12
019</p>
<p>/* Time: 8:00 AM</p>
<p>020</p>
<p>/* To change this template use File | Settings | File Templates.
021</p>
<p>/*/</p>
<p>022</p>
<p>public</p>
<p>class</p>
<p>WmiService {
023</p>
<p>024</p>
<p>private</p>
<p>JIComServer m_ComStub =</p>
<p>null</p>
<p>;
025</p>
<p>private</p>
<p>IJIComObject m_ComObject =</p>
<p>null</p>
<p>;</p>
<p>026</p>
<p>private</p>
<p>IJIDispatch m_Dispatch =</p>
<p>null</p>
<p>;
027</p>
<p>private</p>
<p>String m_Address =</p>
<p>null</p>
<p>;</p>
<p>028</p>
<p>private</p>
<p>JISession m_Session =</p>
<p>null</p>
<p>;
029</p>
<p>private</p>
<p>IJIDispatch m_WbemServices =</p>
<p>null</p>
<p>;</p>
<p>030</p>
<p>031</p>
<p>private</p>
<p>static</p>
<p>final</p>
<p>String WMI_CLSID =</p>
<p>&quot;76A6415B-CB41-11d1-8B02-00600806D9B6&quot;</p>
<p>;</p>
<p>032</p>
<p>private</p>
<p>static</p>
<p>final</p>
<p>String WMI_PROGID =</p>
<p>&quot;WbemScripting.SWbemLocator&quot;</p>
<p>;
033</p>
<p>034</p>
<p>private</p>
<p>Logger logger = LoggerFactory.getLogger(</p>
<p>this</p>
<p>.getClass());
035</p>
<p>036</p>
<p>037</p>
<p>public</p>
<p>WmiService(String address) {</p>
<p>038</p>
<p>JISystem.setAutoRegisteration(</p>
<p>true</p>
<p>);
039</p>
<p>JISystem.getLogger().setLevel(Level.WARNING);</p>
<p>040</p>
<p>m_Address = address;
041</p>
<p>}</p>
<p>042</p>
<p>043</p>
<p>public</p>
<p>void</p>
<p>query(String strQuery) {</p>
<p>044</p>
<p>045</p>
<p>System.out.println(</p>
<p>&quot;query:&quot;</p>
<ul>
<li>strQuery);</li>
</ul>
<p>046</p>
<p>047</p>
<p>JIVariant results[] =</p>
<p>new</p>
<p>JIVariant[</p>
<p>0</p>
<p>];</p>
<p>048</p>
<p>try</p>
<p>{
049</p>
<p>results = m_WbemServices.callMethodA(</p>
<p>&quot;ExecQuery&quot;</p>
<p>,</p>
<p>new</p>
<p>Object[]{</p>
<p>new</p>
<p>JIString(strQuery), JIVariant.OPTIONAL_PARAM(), JIVariant.OPTIONAL_PARAM(), JIVariant.OPTIONAL_PARAM()});</p>
<p>050</p>
<p>IJIDispatch wOSd = (IJIDispatch) JIObjectFactory.narrowObject((results[</p>
<p>0</p>
<p>]).getObjectAsComObject());
051</p>
<p>052</p>
<p>int</p>
<p>count = wOSd.get(</p>
<p>&quot;Count&quot;</p>
<p>).getObjectAsInt();
053</p>
<p>054</p>
<p>IJIComObject enumComObject = wOSd.get(</p>
<p>&quot;_NewEnum&quot;</p>
<p>).getObjectAsComObject();
055</p>
<p>IJIEnumVariant enumVariant = (IJIEnumVariant) JIObjectFactory.narrowObject(enumComObject.queryInterface(IJIEnumVariant.IID));</p>
<p>056</p>
<p>057</p>
<p>IJIDispatch wbemObject_dispatch =</p>
<p>null</p>
<p>;</p>
<p>058</p>
<p>059</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>c =</p>
<p>0</p>
<p>; c &lt; count; c++) {</p>
<p>060</p>
<p>061</p>
<p>Object[] values = enumVariant.next(</p>
<p>1</p>
<p>);</p>
<p>062</p>
<p>JIArray array = (JIArray) values[</p>
<p>0</p>
<p>];
063</p>
<p>Object[] arrayObj = (Object[]) array.getArrayInstance();</p>
<p>064</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>j =</p>
<p>0</p>
<p>; j &lt; arrayObj.length; j++) {
065</p>
<p>wbemObject_dispatch = (IJIDispatch) JIObjectFactory.narrowObject(((JIVariant) arrayObj[j]).getObjectAsComObject());</p>
<p>066</p>
<p>}
067</p>
<p>068</p>
<p>String str = (wbemObject_dispatch.callMethodA(</p>
<p>&quot;GetObjectText_&quot;</p>
<p>,</p>
<p>new</p>
<p>Object[]{</p>
<p>1</p>
<p>}))[</p>
<p>0</p>
<p>].getObjectAsString2();
069</p>
<p>System.out.println(</p>
<p>&quot;(&quot;</p>
<ul>
<li>c +</li>
</ul>
<p>&quot;):&quot;</p>
<p>);</p>
<p>070</p>
<p>System.out.println(str);
071</p>
<p>System.out.println();</p>
<p>072</p>
<p>}
073</p>
<p>074</p>
<p>075</p>
<p>}</p>
<p>catch</p>
<p>(JIException e) {</p>
<p>076</p>
<p>e.printStackTrace();
077</p>
<p>}</p>
<p>078</p>
<p>}
079</p>
<p>080</p>
<p>public</p>
<p>void</p>
<p>connect(</p>
<p>final</p>
<p>String domain,</p>
<p>final</p>
<p>String username,</p>
<p>final</p>
<p>String password) {
081</p>
<p>try</p>
<p>{</p>
<p>082</p>
<p>083</p>
<p>m_Session = JISession.createSession(domain, username, password);</p>
<p>084</p>
<p>m_Session.useSessionSecurity(</p>
<p>true</p>
<p>);
085</p>
<p>m_Session.setGlobalSocketTimeout(</p>
<p>5000</p>
<p>);</p>
<p>086</p>
<p>087</p>
<p>m_ComStub =</p>
<p>new</p>
<p>JIComServer(JIProgId.valueOf(WMI_PROGID), m_Address, m_Session);</p>
<p>088</p>
<p>089</p>
<p>IJIComObject unknown = m_ComStub.createInstance();</p>
<p>090</p>
<p>m_ComObject = unknown.queryInterface(WMI_CLSID);
091</p>
<p>092</p>
<p>m_Dispatch = (IJIDispatch) JIObjectFactory.narrowObject(m_ComObject.queryInterface(IJIDispatch.IID));
093</p>
<p>JIVariant results[] = m_Dispatch.callMethodA(</p>
<p>094</p>
<p>&quot;ConnectServer&quot;</p>
<p>,
095</p>
<p>new</p>
<p>Object[]{</p>
<p>096</p>
<p>new</p>
<p>JIString(m_Address),
097</p>
<p>JIVariant.OPTIONAL_PARAM(),</p>
<p>098</p>
<p>JIVariant.OPTIONAL_PARAM(),
099</p>
<p>JIVariant.OPTIONAL_PARAM(),</p>
<p>100</p>
<p>JIVariant.OPTIONAL_PARAM(),
101</p>
<p>JIVariant.OPTIONAL_PARAM(),</p>
<p>102</p>
<p>0</p>
<p>,
103</p>
<p>JIVariant.OPTIONAL_PARAM()</p>
<p>104</p>
<p>}
105</p>
<p>);</p>
<p>106</p>
<p>107</p>
<p>m_WbemServices = (IJIDispatch) JIObjectFactory.narrowObject((results[</p>
<p>0</p>
<p>]).getObjectAsComObject());</p>
<p>108</p>
<p>109</p>
<p>}</p>
<p>catch</p>
<p>(JIException e) {</p>
<p>110</p>
<p>e.printStackTrace();
111</p>
<p>if</p>
<p>(m_Session !=</p>
<p>null</p>
<p>) {</p>
<p>112</p>
<p>try</p>
<p>{
113</p>
<p>JISession.destroySession(m_Session);</p>
<p>114</p>
<p>}</p>
<p>catch</p>
<p>(JIException e1) {
115</p>
<p>logger.error(e.getMessage(), e);</p>
<p>116</p>
<p>}
117</p>
<p>}</p>
<p>118</p>
<p>}</p>
<p>catch</p>
<p>(UnknownHostException e) {
119</p>
<p>if</p>
<p>(m_Session !=</p>
<p>null</p>
<p>) {</p>
<p>120</p>
<p>try</p>
<p>{
121</p>
<p>JISession.destroySession(m_Session);</p>
<p>122</p>
<p>}</p>
<p>catch</p>
<p>(JIException e1) {
123</p>
<p>logger.error(e.getMessage(), e);</p>
<p>124</p>
<p>}
125</p>
<p>}</p>
<p>126</p>
<p>}
127</p>
<p>}</p>
<p>128</p>
<p>129</p>
<p>public</p>
<p>void</p>
<p>disconnect() {</p>
<p>130</p>
<p>try</p>
<p>{
131</p>
<p>JISession.destroySession(m_Session);</p>
<p>132</p>
<p>}</p>
<p>catch</p>
<p>(JIException e) {
133</p>
<p>logger.error(e.getMessage(), e);</p>
<p>134</p>
<p>}
135</p>
<p>}</p>
<p>136</p>
<p>137</p>
<p>138</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>main(String[] args) {
139</p>
<p>140</p>
<p>WmiService wmiService =</p>
<p>new</p>
<p>WmiService(</p>
<p>&quot;172.16.158.129&quot;</p>
<p>);
141</p>
<p>142</p>
<p>//域（一般为空字符），用户名，密码
143</p>
<p>wmiService.connect(</p>
<p>&quot;&quot;</p>
<p>,</p>
<p>&quot;username&quot;</p>
<p>,</p>
<p>&quot;password&quot;</p>
<p>);</p>
<p>144</p>
<p>145</p>
<p>//系统信息</p>
<p>146</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_ComputerSystem&quot;</p>
<p>);
147</p>
<p>148</p>
<p>//CPU信息
149</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_PerfFormattedData_PerfOS_Processor WHERE Name != &#39;_Total&#39;&quot;</p>
<p>);</p>
<p>150</p>
<p>151</p>
<p>//内存信息</p>
<p>152</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_PerfFormattedData_PerfOS_Memory&quot;</p>
<p>);
153</p>
<p>154</p>
<p>//磁盘信息
155</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_PerfRawData_PerfDisk_PhysicalDisk Where Name != &#39;_Total&#39;&quot;</p>
<p>);</p>
<p>156</p>
<p>157</p>
<p>wmiService.disconnect();</p>
<p>158</p>
<p>}
159</p>
<p>}</p>
<p>mavne配置(pom.xml)
<a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>01</p>
<p>&lt;?</p>
<p>xml</p>
<p>version</p>
<p>=</p>
<p>&quot;1.0&quot;</p>
<p>encoding</p>
<p>=</p>
<p>&quot;UTF-8&quot;</p>
<p>?&gt;</p>
<p>02</p>
<p>&lt;</p>
<p>project</p>
<p>xmlns</p>
<p>=</p>
<p>&quot;<a href="http://maven.apache.org/POM/4.0.0" target="_blank">http://maven.apache.org/POM/4.0.0</a>&quot;
03</p>
<p>xmlns:xsi</p>
<p>=</p>
<p>&quot;<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>&quot;</p>
<p>04</p>
<p>xsi:schemaLocation</p>
<p>=</p>
<p>&quot;<a href="http://maven.apache.org/POM/4.0.0" target="_blank">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_blank">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>&quot;</p>
<p>&gt;
05</p>
<p>&lt;</p>
<p>modelVersion</p>
<blockquote>
<p>4.0.0&lt;/</p>
</blockquote>
<p>modelVersion</p>
<p>&gt;</p>
<p>06</p>
<p>07</p>
<p>&lt;</p>
<p>groupId</p>
<blockquote>
<p>org.noahx&lt;/</p>
</blockquote>
<p>groupId</p>
<p>&gt;</p>
<p>08</p>
<p>&lt;</p>
<p>artifactId</p>
<blockquote>
<p>wmi-test&lt;/</p>
</blockquote>
<p>artifactId</p>
<p>&gt;
09</p>
<p>&lt;</p>
<p>version</p>
<blockquote>
<p>1.0&lt;/</p>
</blockquote>
<p>version</p>
<p>&gt;</p>
<p>10</p>
<p>11</p>
<p>12</p>
<p>&lt;</p>
<p>dependencies</p>
<p>&gt;
13</p>
<p>14</p>
<p>&lt;</p>
<p>dependency</p>
<p>&gt;
15</p>
<p>&lt;</p>
<p>groupId</p>
<blockquote>
<p>org.kohsuke.jinterop&lt;/</p>
</blockquote>
<p>groupId</p>
<p>&gt;</p>
<p>16</p>
<p>&lt;</p>
<p>artifactId</p>
<blockquote>
<p>j-interop&lt;/</p>
</blockquote>
<p>artifactId</p>
<p>&gt;
17</p>
<p>&lt;</p>
<p>version</p>
<blockquote>
<p>2.0.8-kohsuke-1&lt;/</p>
</blockquote>
<p>version</p>
<p>&gt;</p>
<p>18</p>
<p>&lt;/</p>
<p>dependency</p>
<p>&gt;
19</p>
<p>20</p>
<p>&lt;</p>
<p>dependency</p>
<p>&gt;
21</p>
<p>&lt;</p>
<p>groupId</p>
<blockquote>
<p>org.slf4j&lt;/</p>
</blockquote>
<p>groupId</p>
<p>&gt;</p>
<p>22</p>
<p>&lt;</p>
<p>artifactId</p>
<blockquote>
<p>slf4j-log4j12&lt;/</p>
</blockquote>
<p>artifactId</p>
<p>&gt;
23</p>
<p>&lt;</p>
<p>version</p>
<blockquote>
<p>1.6.4&lt;/</p>
</blockquote>
<p>version</p>
<p>&gt;</p>
<p>24</p>
<p>&lt;/</p>
<p>dependency</p>
<p>&gt;
25</p>
<p>26</p>
<p>&lt;/</p>
<p>dependencies</p>
<p>&gt;
27</p>
<p>28</p>
<p>&lt;/</p>
<p>project</p>
<p>&gt;</p>
<p>运行结果</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>001</p>
<p>query:SELECT /* FROM Win32_ComputerSystem</p>
<p>002</p>
<p>(0):
003</p>
<p>004</p>
<p>instance of Win32_ComputerSystem
005</p>
<p>{</p>
<p>006</p>
<p>AdminPasswordStatus = 1;
007</p>
<p>AutomaticResetBootOption = FALSE;</p>
<p>008</p>
<p>AutomaticResetCapability = TRUE;
009</p>
<p>BootOptionOnLimit = 3;</p>
<p>010</p>
<p>BootOptionOnWatchDog = 3;
011</p>
<p>BootROMSupported = TRUE;</p>
<p>012</p>
<p>BootupState =</p>
<p>&quot;Normal boot&quot;</p>
<p>;
013</p>
<p>Caption =</p>
<p>&quot;NAK-E1A7C21EA3C&quot;</p>
<p>;</p>
<p>014</p>
<p>ChassisBootupState = 3;
015</p>
<p>CreationClassName =</p>
<p>&quot;Win32_ComputerSystem&quot;</p>
<p>;</p>
<p>016</p>
<p>CurrentTimeZone = 480;
017</p>
<p>Description =</p>
<p>&quot;AT/AT COMPATIBLE&quot;</p>
<p>;</p>
<p>018</p>
<p>Domain =</p>
<p>&quot;WORKGROUP&quot;</p>
<p>;
019</p>
<p>DomainRole = 0;</p>
<p>020</p>
<p>EnableDaylightSavingsTime = TRUE;
021</p>
<p>FrontPanelResetStatus = 3;</p>
<p>022</p>
<p>InfraredSupported = FALSE;
023</p>
<p>KeyboardPasswordStatus = 3;</p>
<p>024</p>
<p>Manufacturer =</p>
<p>&quot;VMware, Inc.&quot;</p>
<p>;
025</p>
<p>Model =</p>
<p>&quot;VMware Virtual Platform&quot;</p>
<p>;</p>
<p>026</p>
<p>Name =</p>
<p>&quot;NAK-E1A7C21EA3C&quot;</p>
<p>;
027</p>
<p>NetworkServerModeEnabled = TRUE;</p>
<p>028</p>
<p>NumberOfLogicalProcessors = 2;
029</p>
<p>NumberOfProcessors = 1;</p>
<p>030</p>
<p>OEMStringArray = {</p>
<p>&quot;[MS_VM_CERT/SHA1/27d66596a61c48dd3dc7216fd715126e33f59ae7]&quot;</p>
<p>,</p>
<p>&quot;Welcome to the Virtual Machine&quot;</p>
<p>};
031</p>
<p>PartOfDomain = FALSE;</p>
<p>032</p>
<p>PauseAfterReset =</p>
<p>&quot;3932100000&quot;</p>
<p>;
033</p>
<p>PowerOnPasswordStatus = 0;</p>
<p>034</p>
<p>PowerState = 0;
035</p>
<p>PowerSupplyState = 3;</p>
<p>036</p>
<p>PrimaryOwnerName =</p>
<p>&quot;nak&quot;</p>
<p>;
037</p>
<p>ResetCapability = 1;</p>
<p>038</p>
<p>ResetCount = -1;
039</p>
<p>ResetLimit = -1;</p>
<p>040</p>
<p>Roles = {</p>
<p>&quot;LM_Workstation&quot;</p>
<p>,</p>
<p>&quot;LM_Server&quot;</p>
<p>,</p>
<p>&quot;NT&quot;</p>
<p>,</p>
<p>&quot;Potential_Browser&quot;</p>
<p>,</p>
<p>&quot;Master_Browser&quot;</p>
<p>};
041</p>
<p>Status =</p>
<p>&quot;OK&quot;</p>
<p>;</p>
<p>042</p>
<p>SystemStartupDelay = 0;
043</p>
<p>SystemStartupOptions = {</p>
<p>&quot;\&quot;Microsoft Windows XP Professional\&quot; /noexecute=optin /fastdetect&quot;</p>
<p>};</p>
<p>044</p>
<p>SystemStartupSetting = 0;
045</p>
<p>SystemType =</p>
<p>&quot;X86-based PC&quot;</p>
<p>;</p>
<p>046</p>
<p>ThermalState = 3;
047</p>
<p>TotalPhysicalMemory =</p>
<p>&quot;1610063872&quot;</p>
<p>;</p>
<p>048</p>
<p>UserName =</p>
<p>&quot;NAK-E1A7C21EA3C\a&quot;</p>
<p>;
049</p>
<p>WakeUpType = 6;</p>
<p>050</p>
<p>};
051</p>
<p>052</p>
<p>053</p>
<p>query:SELECT /* FROM Win32_PerfFormattedData_PerfOS_Processor WHERE Name !=</p>
<p>&#39;_Total&#39;</p>
<p>054</p>
<p>(0):
055</p>
<p>056</p>
<p>instance of Win32_PerfFormattedData_PerfOS_Processor
057</p>
<p>{</p>
<p>058</p>
<p>C1TransitionsPersec =</p>
<p>&quot;77&quot;</p>
<p>;
059</p>
<p>C2TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>060</p>
<p>C3TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;
061</p>
<p>DPCRate = 0;</p>
<p>062</p>
<p>DPCsQueuedPersec = 4;
063</p>
<p>InterruptsPersec = 71;</p>
<p>064</p>
<p>Name =</p>
<p>&quot;0&quot;</p>
<p>;
065</p>
<p>PercentC1Time =</p>
<p>&quot;96&quot;</p>
<p>;</p>
<p>066</p>
<p>PercentC2Time =</p>
<p>&quot;0&quot;</p>
<p>;
067</p>
<p>PercentC3Time =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>068</p>
<p>PercentDPCTime =</p>
<p>&quot;0&quot;</p>
<p>;
069</p>
<p>PercentIdleTime =</p>
<p>&quot;100&quot;</p>
<p>;</p>
<p>070</p>
<p>PercentInterruptTime =</p>
<p>&quot;0&quot;</p>
<p>;
071</p>
<p>PercentPrivilegedTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>072</p>
<p>PercentProcessorTime =</p>
<p>&quot;0&quot;</p>
<p>;
073</p>
<p>PercentUserTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>074</p>
<p>};
075</p>
<p>076</p>
<p>077</p>
<p>(1):</p>
<p>078</p>
<p>079</p>
<p>instance of Win32_PerfFormattedData_PerfOS_Processor</p>
<p>080</p>
<p>{
081</p>
<p>C1TransitionsPersec =</p>
<p>&quot;83&quot;</p>
<p>;</p>
<p>082</p>
<p>C2TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;
083</p>
<p>C3TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>084</p>
<p>DPCRate = 0;
085</p>
<p>DPCsQueuedPersec = 10;</p>
<p>086</p>
<p>InterruptsPersec = 67;
087</p>
<p>Name =</p>
<p>&quot;1&quot;</p>
<p>;</p>
<p>088</p>
<p>PercentC1Time =</p>
<p>&quot;96&quot;</p>
<p>;
089</p>
<p>PercentC2Time =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>090</p>
<p>PercentC3Time =</p>
<p>&quot;0&quot;</p>
<p>;
091</p>
<p>PercentDPCTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>092</p>
<p>PercentIdleTime =</p>
<p>&quot;100&quot;</p>
<p>;
093</p>
<p>PercentInterruptTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>094</p>
<p>PercentPrivilegedTime =</p>
<p>&quot;0&quot;</p>
<p>;
095</p>
<p>PercentProcessorTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>096</p>
<p>PercentUserTime =</p>
<p>&quot;0&quot;</p>
<p>;
097</p>
<p>};</p>
<p>098</p>
<p>099</p>
<p>100</p>
<p>query:SELECT /* FROM Win32_PerfFormattedData_PerfOS_Memory
101</p>
<p>(0):</p>
<p>102</p>
<p>103</p>
<p>instance of Win32_PerfFormattedData_PerfOS_Memory</p>
<p>104</p>
<p>{
105</p>
<p>AvailableBytes =</p>
<p>&quot;1142099968&quot;</p>
<p>;</p>
<p>106</p>
<p>AvailableKBytes =</p>
<p>&quot;1115332&quot;</p>
<p>;
107</p>
<p>AvailableMBytes =</p>
<p>&quot;1089&quot;</p>
<p>;</p>
<p>108</p>
<p>CacheBytes =</p>
<p>&quot;70725632&quot;</p>
<p>;
109</p>
<p>CacheBytesPeak =</p>
<p>&quot;72904704&quot;</p>
<p>;</p>
<p>110</p>
<p>CacheFaultsPersec = 634;
111</p>
<p>CommitLimit =</p>
<p>&quot;3063078912&quot;</p>
<p>;</p>
<p>112</p>
<p>CommittedBytes =</p>
<p>&quot;326488064&quot;</p>
<p>;
113</p>
<p>DemandZeroFaultsPersec = 13965;</p>
<p>114</p>
<p>FreeSystemPageTableEntries = 159743;
115</p>
<p>PageFaultsPersec = 13965;</p>
<p>116</p>
<p>PageReadsPersec = 0;
117</p>
<p>PagesInputPersec = 0;</p>
<p>118</p>
<p>PagesOutputPersec = 0;
119</p>
<p>PagesPersec = 0;</p>
<p>120</p>
<p>PageWritesPersec = 0;
121</p>
<p>PercentCommittedBytesInUse = 10;</p>
<p>122</p>
<p>PoolNonpagedAllocs = 38040;
123</p>
<p>PoolNonpagedBytes =</p>
<p>&quot;7585792&quot;</p>
<p>;</p>
<p>124</p>
<p>PoolPagedAllocs = 57820;
125</p>
<p>PoolPagedBytes =</p>
<p>&quot;29380608&quot;</p>
<p>;</p>
<p>126</p>
<p>PoolPagedResidentBytes =</p>
<p>&quot;28622848&quot;</p>
<p>;
127</p>
<p>SystemCacheResidentBytes =</p>
<p>&quot;40235008&quot;</p>
<p>;</p>
<p>128</p>
<p>SystemCodeResidentBytes =</p>
<p>&quot;1867776&quot;</p>
<p>;
129</p>
<p>SystemCodeTotalBytes =</p>
<p>&quot;1167360&quot;</p>
<p>;</p>
<p>130</p>
<p>SystemDriverResidentBytes =</p>
<p>&quot;0&quot;</p>
<p>;
131</p>
<p>SystemDriverTotalBytes =</p>
<p>&quot;4071424&quot;</p>
<p>;</p>
<p>132</p>
<p>TransitionFaultsPersec = 0;
133</p>
<p>WriteCopiesPersec = 0;</p>
<p>134</p>
<p>};
135</p>
<p>136</p>
<p>137</p>
<p>query:SELECT /* FROM Win32_PerfRawData_PerfDisk_PhysicalDisk Where Name !=</p>
<p>&#39;_Total&#39;</p>
<p>138</p>
<p>(0):
139</p>
<p>140</p>
<p>instance of Win32_PerfRawData_PerfDisk_PhysicalDisk
141</p>
<p>{</p>
<p>142</p>
<p>AvgDiskBytesPerRead =</p>
<p>&quot;138920448&quot;</p>
<p>;
143</p>
<p>AvgDiskBytesPerRead_Base = 8000;</p>
<p>144</p>
<p>AvgDiskBytesPerTransfer =</p>
<p>&quot;208285696&quot;</p>
<p>;
145</p>
<p>AvgDiskBytesPerTransfer_Base = 13701;</p>
<p>146</p>
<p>AvgDiskBytesPerWrite =</p>
<p>&quot;69365248&quot;</p>
<p>;
147</p>
<p>AvgDiskBytesPerWrite_Base = 5701;</p>
<p>148</p>
<p>AvgDiskQueueLength =</p>
<p>&quot;581460650&quot;</p>
<p>;
149</p>
<p>AvgDiskReadQueueLength =</p>
<p>&quot;405581626&quot;</p>
<p>;</p>
<p>150</p>
<p>AvgDisksecPerRead = 2794786622;
151</p>
<p>AvgDisksecPerRead_Base = 8000;</p>
<p>152</p>
<p>AvgDisksecPerTransfer = 322083534;
153</p>
<p>AvgDisksecPerTransfer_Base = 13701;</p>
<p>154</p>
<p>AvgDisksecPerWrite = 1822264208;
155</p>
<p>AvgDisksecPerWrite_Base = 5701;</p>
<p>156</p>
<p>AvgDiskWriteQueueLength =</p>
<p>&quot;175879024&quot;</p>
<p>;
157</p>
<p>CurrentDiskQueueLength = 0;</p>
<p>158</p>
<p>DiskBytesPersec =</p>
<p>&quot;208285696&quot;</p>
<p>;
159</p>
<p>DiskReadBytesPersec =</p>
<p>&quot;138920448&quot;</p>
<p>;</p>
<p>160</p>
<p>DiskReadsPersec = 8000;
161</p>
<p>DiskTransfersPersec = 13701;</p>
<p>162</p>
<p>DiskWriteBytesPersec =</p>
<p>&quot;69365248&quot;</p>
<p>;
163</p>
<p>DiskWritesPersec = 5701;</p>
<p>164</p>
<p>Frequency_Object =</p>
<p>&quot;0&quot;</p>
<p>;
165</p>
<p>Frequency_PerfTime =</p>
<p>&quot;3034010000&quot;</p>
<p>;</p>
<p>166</p>
<p>Frequency_Sys100NS =</p>
<p>&quot;10000000&quot;</p>
<p>;
167</p>
<p>Name =</p>
<p>&quot;0 C:&quot;</p>
<p>;</p>
<p>168</p>
<p>PercentDiskReadTime =</p>
<p>&quot;405581626&quot;</p>
<p>;
169</p>
<p>PercentDiskReadTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>170</p>
<p>PercentDiskTime =</p>
<p>&quot;581460650&quot;</p>
<p>;
171</p>
<p>PercentDiskTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>172</p>
<p>PercentDiskWriteTime =</p>
<p>&quot;175879024&quot;</p>
<p>;
173</p>
<p>PercentDiskWriteTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>174</p>
<p>PercentIdleTime =</p>
<p>&quot;18446744072967667781&quot;</p>
<p>;
175</p>
<p>PercentIdleTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>176</p>
<p>SplitIOPerSec = 1074;
177</p>
<p>Timestamp_Object =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>178</p>
<p>Timestamp_PerfTime =</p>
<p>&quot;3635534093651&quot;</p>
<p>;
179</p>
<p>Timestamp_Sys100NS =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>180</p>
<p>};&lt;span style=</p>
<p>&quot;font-family:&#39;sans serif, tahoma, verdana, helvetica&#39;;font-size:x-small;&quot;</p>
<blockquote>
<p>&lt;span style=</p>
</blockquote>
<p>&quot;line-height:18.18181800842285px;white-space:normal;&quot;</p>
<blockquote>
<p></span></span></p>
</blockquote>
<h2 id="-">#</h2>
<h3 id="3-">3、有可能出现的问题</h3>
<p>报错a</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>01</p>
<p>org.jinterop.dcom.common.JIException: Message not found</p>
<p>for</p>
<p>errorCode:</p>
<p>0xC0000034</p>
<p>02</p>
<p>at org.jinterop.winreg.smb.JIWinRegStub.winreg_OpenHKLM(JIWinRegStub.java:</p>
<p>115</p>
<p>)
03</p>
<p>at org.jinterop.dcom.core.JIProgId.getIdFromWinReg(JIProgId.java:</p>
<p>130</p>
<p>)</p>
<p>04</p>
<p>at org.jinterop.dcom.core.JIProgId.getCorrespondingCLSID(JIProgId.java:</p>
<p>162</p>
<p>)
05</p>
<p>at org.jinterop.dcom.core.JIComServer.<init>(JIComServer.java:</p>
<p>413</p>
<p>)</p>
<p>06</p>
<p>at org.noah.wmitest.WmiService.connect(WmiService.java:</p>
<p>122</p>
<p>)
07</p>
<p>at org.noah.wmitest.WmiService.main(WmiService.java:</p>
<p>177</p>
<p>)</p>
<p>08</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
09</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</p>
<p>39</p>
<p>)</p>
<p>10</p>
<p>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</p>
<p>25</p>
<p>)
11</p>
<p>at java.lang.reflect.Method.invoke(Method.java:</p>
<p>597</p>
<p>)</p>
<p>12</p>
<p>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:</p>
<p>120</p>
<p>)
13</p>
<p>Caused by: jcifs.smb.SmbException: The system cannot find the file specified.</p>
<p>14</p>
<p>at jcifs.smb.SmbTransport.checkStatus(SmbTransport.java:</p>
<p>522</p>
<p>)
15</p>
<p>at jcifs.smb.SmbTransport.send(SmbTransport.java:</p>
<p>622</p>
<p>)</p>
<p>16</p>
<p>at jcifs.smb.SmbSession.send(SmbSession.java:</p>
<p>239</p>
<p>)
17</p>
<p>at jcifs.smb.SmbTree.send(SmbTree.java:</p>
<p>109</p>
<p>)</p>
<p>18</p>
<p>at jcifs.smb.SmbFile.send(SmbFile.java:</p>
<p>718</p>
<p>)
19</p>
<p>at jcifs.smb.SmbFile.open0(SmbFile.java:</p>
<p>923</p>
<p>)</p>
<p>20</p>
<p>at jcifs.smb.SmbFile.open(SmbFile.java:</p>
<p>940</p>
<p>)
21</p>
<p>at jcifs.smb.SmbFileOutputStream.<init>(SmbFileOutputStream.java:</p>
<p>142</p>
<p>)</p>
<p>22</p>
<p>at jcifs.smb.TransactNamedPipeOutputStream.<init>(TransactNamedPipeOutputStream.java:</p>
<p>32</p>
<p>)
23</p>
<p>at jcifs.smb.SmbNamedPipe.getNamedPipeOutputStream(SmbNamedPipe.java:</p>
<p>187</p>
<p>)</p>
<p>24</p>
<p>at rpc.ncacn_np.RpcTransport.attach(RpcTransport.java:</p>
<p>92</p>
<p>)
25</p>
<p>at rpc.Stub.attach(Stub.java:</p>
<p>105</p>
<p>)</p>
<p>26</p>
<p>at rpc.Stub.call(Stub.java:</p>
<p>110</p>
<p>)
27</p>
<p>at org.jinterop.winreg.smb.JIWinRegStub.winreg_OpenHKLM(JIWinRegStub.java:</p>
<p>113</p>
<p>)</p>
<p>28</p>
<p>...</p>
<p>10</p>
<p>more</p>
<p>需要开启Remote Registry服务
报错b</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>01</p>
<p>org.jinterop.dcom.common.JIException: Message not found</p>
<p>for</p>
<p>errorCode:</p>
<p>0xC0000001</p>
<p>02</p>
<p>at org.jinterop.winreg.smb.JIWinRegStub.winreg_OpenHKLM(JIWinRegStub.java:</p>
<p>115</p>
<p>)
03</p>
<p>at org.jinterop.dcom.core.JIProgId.getIdFromWinReg(JIProgId.java:</p>
<p>130</p>
<p>)</p>
<p>04</p>
<p>at org.jinterop.dcom.core.JIProgId.getCorrespondingCLSID(JIProgId.java:</p>
<p>162</p>
<p>)
05</p>
<p>at org.jinterop.dcom.core.JIComServer.<init>(JIComServer.java:</p>
<p>413</p>
<p>)</p>
<p>06</p>
<p>at org.noah.wmitest.WmiService.connect(WmiService.java:</p>
<p>87</p>
<p>)
07</p>
<p>at org.noah.wmitest.WmiService.main(WmiService.java:</p>
<p>142</p>
<p>)</p>
<p>08</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
09</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</p>
<p>39</p>
<p>)</p>
<p>10</p>
<p>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</p>
<p>25</p>
<p>)
11</p>
<p>at java.lang.reflect.Method.invoke(Method.java:</p>
<p>597</p>
<p>)</p>
<p>12</p>
<p>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:</p>
<p>120</p>
<p>)
13</p>
<p>Caused by: jcifs.smb.SmbException: Connection timeout</p>
<p>14</p>
<p>jcifs.util.transport.TransportException: Connection timeout
15</p>
<p>16</p>
<p>或
17</p>
<p>18</p>
<p>org.jinterop.dcom.common.JIException: Message not found</p>
<p>for</p>
<p>errorCode:</p>
<p>0x8001FFFF
19</p>
<p>at org.jinterop.dcom.core.JIComServer.init(JIComServer.java:</p>
<p>576</p>
<p>)</p>
<p>20</p>
<p>at org.jinterop.dcom.core.JIComServer.initialise(JIComServer.java:</p>
<p>481</p>
<p>)
21</p>
<p>at org.jinterop.dcom.core.JIComServer.<init>(JIComServer.java:</p>
<p>414</p>
<p>)</p>
<p>22</p>
<p>at org.noah.wmitest.WmiService.connect(WmiService.java:</p>
<p>87</p>
<p>)
23</p>
<p>at org.noah.wmitest.WmiService.main(WmiService.java:</p>
<p>142</p>
<p>)</p>
<p>24</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
25</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</p>
<p>39</p>
<p>)</p>
<p>26</p>
<p>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</p>
<p>25</p>
<p>)
27</p>
<p>at java.lang.reflect.Method.invoke(Method.java:</p>
<p>597</p>
<p>)</p>
<p>28</p>
<p>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:</p>
<p>120</p>
<p>)
29</p>
<p>Caused by: java.net.ConnectException: Connection timed out</p>
<p>需要禁用放火墙</p>
<h3 id="4-">4、总结</h3>
<p>j-Interop纯java跨平台，我就是linux系统。</p>
<p>用j-Interop就可以很方便的调用windows系统com，虽然这里只演示了WMI。
如果关心WMI与监控的话，建议去opennms-wmi看一看，他们有更好api封装（底层也是j-Interop）。
<strong>关键字：</strong> <a href="http://www.oschina.net/search?scope=blog&amp;q=wmi" target="_blank">wmi</a> <a href="http://www.oschina.net/search?scope=blog&amp;q=windows" target="_blank">windows</a> <a href="http://www.oschina.net/search?scope=blog&amp;q=j-interop" target="_blank">j-interop</a></p>
<p>声明：OSCHINA 博客文章版权属于作者，受法律保护。未经作者同意不得转载。</p>
<ul>
<li><a href="http://my.oschina.net/noahxiao/blog/72861" title="上一篇：既爱又恨的VA-API(Ubuntu视频加速)" target="_blank">« 既爱又恨的VA-API(Ubuntu视频加速)</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/75463" title="下一篇：通过javamelody监控web应用的性能指标" target="_blank">通过javamelody监控web应用的性能指标 »</a></li>
</ul>
<p>开源中国-程序员在线工具：<a href="http://www.ostools.net/apidocs" target="_blank">API文档大全(120+)</a> <a href="http://runjs.cn/" target="_blank">JS在线编辑演示</a> <a href="http://www.ostools.net/qr" target="_blank">二维码</a> <a href="http://www.ostools.net/" target="_blank">更多&gt;&gt;</a>
<strong>分享到：</strong> <a href="&quot;分享到新浪微博&quot;"></a> <a href="&quot;分享到腾讯微博&quot;"></a>  <a href="">顶</a>已有 <em>0</em>人顶</p>
<h2 id="-5-"><a href=""></a>共有 5 条网友评论</h2>
<ul>
<li><a href="http://my.oschina.net/u/657242" target="_blank"><img src="&quot;leehark&quot;" alt="leehark"></a> 1楼：<a href="http://my.oschina.net/u/657242" target="_blank">leehark</a>(Android) 发表于 2012-08-18 19:35 <a href="">回复此评论</a></li>
</ul>
<p>能通过代码禁止防火墙么？是都要管理员权限？</p>
<ul>
<li><a href="http://my.oschina.net/mingyuejingque" target="_blank"><img src="&quot;明月惊鹊&quot;" alt="明月惊鹊"></a> 2楼：<a href="http://my.oschina.net/mingyuejingque" target="_blank">明月惊鹊</a> 发表于 2012-08-19 14:40 <a href="">回复此评论</a></li>
</ul>
<p>WMI里应该就有控制防火墙的。这种操作肯定需要管理员权限了。</p>
<ul>
<li><a href="http://my.oschina.net/u/124197" target="_blank"><img src="&quot;黄金比&quot;" alt="黄金比"></a> 3楼：<a href="http://my.oschina.net/u/124197" target="_blank">黄金比</a>(iPhone) 发表于 2012-08-21 07:06 <a href="">回复此评论</a></li>
</ul>
<p>不知道远程调用行不行呢?请博主明确一下。</p>
<ul>
<li><a href="http://my.oschina.net/noahxiao" target="_blank"><img src="&quot;肖国颖&quot;" alt="肖国颖"></a> 4楼：<a href="http://my.oschina.net/noahxiao" target="_blank">肖国颖</a>(iPhone) 发表于 2012-08-21 08:23 <a href="">回复此评论</a></li>
</ul>
<h3 id="-">引用来自“黄金比”的评论</h3>
<p>不知道远程调用行不行呢?请博主明确一下。
你指的是非本机吗？我测试的方式就是一台linux运行程序指定ip调用另一台win服务器的wmi</p>
<ul>
<li><a href="http://my.oschina.net/u/124197" target="_blank"><img src="&quot;黄金比&quot;" alt="黄金比"></a> 5楼：<a href="http://my.oschina.net/u/124197" target="_blank">黄金比</a>(iPhone) 发表于 2012-08-21 12:47 <a href="">回复此评论</a></li>
</ul>
<h3 id="-">引用来自“肖国颖”的评论</h3>
<h3 id="-">引用来自“黄金比”的评论</h3>
<p>不知道远程调用行不行呢?请博主明确一下。
你指的是非本机吗？我测试的方式就是一台linux运行程序指定ip调用另一台win服务器的wmi</p>
<p>收到，谢博主，试下先!</p>
<p>文明上网，理性发言
<a href=""></a></p>
<p><img src="" alt=""> 文明上网，理性发言  <a href="">回到页首</a> | <a href="">回到评论列表</a></p>
<p><strong><a href="">关闭</a>相关文章阅读</strong></p>
<ul>
<li>2012/08/16 <a href="http://my.oschina.net/u/581475/blog/73199" title="100%纯java调用windows的wmi获取监控数据" target="_blank">100%纯java调用windows的wmi获取监控...</a></li>
<li>2011/07/06 <a href="http://my.oschina.net/veterans/blog/27840" title="使用WMI修改文件文件夹的NTFS权限" target="_blank">使用WMI修改文件文件夹的NTFS权限...</a></li>
<li>2013/04/24 <a href="http://my.oschina.net/fenlog/blog/124859" title="利用WMI实现ring3进程监控 - vc" target="_blank">利用WMI实现ring3进程监控 - vc...</a></li>
<li>2012/03/22 <a href="http://my.oschina.net/zhajiang/blog/50524" title="py2exe打包包含wmi模块的脚本后，运行时出现win32api.pyd错误的解决办法。" target="_blank">py2exe打包包含wmi模块的脚本后，运...</a></li>
<li>2011/09/02 <a href="http://my.oschina.net/u/129490/blog/30675" title="在windows下使用OpenSSH（上）" target="_blank">在windows下使用OpenSSH（上）...</a></li>
</ul>
<p>© 开源中国(OsChina.NET) | <a href="http://www.oschina.net/home/about" target="_blank">关于我们</a> | <a href="mailto:oschina.net@gmail.com">广告联系</a> | <a href="http://weibo.com/oschina2010" target="_blank">@新浪微博</a> | <a href="http://m.oschina.net/" target="_blank">开源中国手机版</a> | <a href="http://www.miitbeian.gov.cn/" target="_blank">粤ICP备12009483号-3</a> 开源中国手机客户端： <a href="http://www.oschina.net/app" title="Android客户端" target="_blank">Android</a> <a href="http://www.oschina.net/app" title="iPhone 客户端" target="_blank">iPhone</a> <a href="http://www.oschina.net/app" title="Windows Phone 客户端" target="_blank">WP7</a></p>
<p><a href=""></a><a href=""></a><a href=""></a>
<img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/java-com/">java-com</a></li><li><a href="/categories/Java&J2EE/java-com/wmi-监控/">wmi-监控</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/java-com/" class="label label-success">java-com</a><a href="/tags/wmi-监控/" class="label label-info">wmi-监控</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-jacob--jacob合并几个word文件到一个word文件/">jacob合并几个word文件到一个word文件</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-jacob--jacob合并几个word文件到一个word文件/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="jacob-word-word-">jacob合并几个word文件到一个word文件</h1>
<pre><code> 因项目需要将几个word文件合并到一个word文件，后面附项目运用的jar包jacob-1.9
</code></pre><p>jacob运用中，需要将附件内的jacob.dll放到windows/system32下</p>
<pre><code> 直接上代码：
</code></pre><p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>public static void main(String[] args) {  </li>
<li>List list  = new ArrayList();  </li>
<li>String file1= &quot;D:\file1.doc&quot;;  </li>
<li>String file2= &quot;D:\file2.doc&quot;;  </li>
<li>String file3= &quot;D:\file3.doc&quot;;  </li>
<li>list.add(file1);  </li>
<li>list.add(file2);  </li>
<li>list.add(file3);  </li>
<li>uniteDoc(list,&quot;d:\file.doc&quot;);  </li>
<li>}  </li>
<li>public static void uniteDoc(List fileList, String savepaths) {  </li>
<li>if (fileList.size() == 0 || fileList == null) {  </li>
<li>return;  </li>
<li>}  </li>
<li>//打开word  </li>
<li>ActiveXComponent app = new ActiveXComponent(&quot;Word.Application&quot;);//启动word  </li>
<li>try {  </li>
<li>// 设置word不可见  </li>
<li>app.setProperty(&quot;Visible&quot;, new Variant(false));  </li>
<li>//获得documents对象  </li>
<li>Object docs = app.getProperty(&quot;Documents&quot;).toDispatch();  </li>
<li>//打开第一个文件  </li>
<li>Object doc = Dispatch  </li>
<li>.invoke(  </li>
<li>(Dispatch) docs,  </li>
<li>&quot;Open&quot;,  </li>
<li>Dispatch.Method,  </li>
<li>new Object[] { (String) fileList.get(0),  </li>
<li>new Variant(false), new Variant(true) },  </li>
<li>new int[3]).toDispatch();  </li>
<li>//追加文件  </li>
<li>for (int i = 1; i &lt; fileList.size(); i++) {  </li>
<li>Dispatch.invoke(app.getProperty(&quot;Selection&quot;).toDispatch(),  </li>
<li>&quot;insertFile&quot;, Dispatch.Method, new Object[] {  </li>
<li>(String) fileList.get(i), &quot;&quot;,  </li>
<li>new Variant(false), new Variant(false),  </li>
<li>new Variant(false) }, new int[3]);  </li>
<li>}  </li>
<li>//保存新的word文件  </li>
<li>Dispatch.invoke((Dispatch) doc, &quot;SaveAs&quot;, Dispatch.Method,  </li>
<li>new Object[] { savepaths, new Variant(1) }, new int[3]);  </li>
<li>Variant f = new Variant(false);  </li>
<li>Dispatch.call((Dispatch) doc, &quot;Close&quot;, f);  </li>
<li>} catch (Exception e) {  </li>
<li>throw new RuntimeException(&quot;合并word文件出错.原因:&quot; + e);  </li>
<li>} finally {  </li>
<li>app.invoke(&quot;Quit&quot;, new Variant[] {});  </li>
<li>}  </li>
<li>}  </li>
</ol>
<p>public static void main(String[] args) {</p>
<pre><code>        List list  = new ArrayList();
        String file1= &quot;D:\\file1.doc&quot;;

        String file2= &quot;D:\\file2.doc&quot;;
        String file3= &quot;D:\\file3.doc&quot;;

        list.add(file1);
        list.add(file2);

        list.add(file3);
        uniteDoc(list,&quot;d:\\file.doc&quot;);

}
public static void uniteDoc(List fileList, String savepaths) {

    if (fileList.size() == 0 || fileList == null) {
        return;

    }
    //打开word

    ActiveXComponent app = new ActiveXComponent(&quot;Word.Application&quot;);//启动word
    try {

        // 设置word不可见
        app.setProperty(&quot;Visible&quot;, new Variant(false));

        //获得documents对象
        Object docs = app.getProperty(&quot;Documents&quot;).toDispatch();

        //打开第一个文件
        Object doc = Dispatch

            .invoke(
                    (Dispatch) docs,

                    &quot;Open&quot;,
                    Dispatch.Method,

                    new Object[] { (String) fileList.get(0),
                            new Variant(false), new Variant(true) },

                    new int[3]).toDispatch();
        //追加文件

        for (int i = 1; i &lt; fileList.size(); i++) {
            Dispatch.invoke(app.getProperty(&quot;Selection&quot;).toDispatch(),

                &quot;insertFile&quot;, Dispatch.Method, new Object[] {
                        (String) fileList.get(i), &quot;&quot;,

                        new Variant(false), new Variant(false),
                        new Variant(false) }, new int[3]);

        }
        //保存新的word文件

        Dispatch.invoke((Dispatch) doc, &quot;SaveAs&quot;, Dispatch.Method,
            new Object[] { savepaths, new Variant(1) }, new int[3]);

        Variant f = new Variant(false);
        Dispatch.call((Dispatch) doc, &quot;Close&quot;, f);

    } catch (Exception e) {
        throw new RuntimeException(&quot;合并word文件出错.原因:&quot; + e);

    } finally {
        app.invoke(&quot;Quit&quot;, new Variant[] {});

    }
}
</code></pre>
      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/java-com/">java-com</a></li><li><a href="/categories/Java&J2EE/java-com/jacob/">jacob</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/jacob/" class="label label-success">jacob</a><a href="/tags/java-com/" class="label label-info">java-com</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-java-com-jacob--jacob合并几个word文件到一个word文件/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-java-com-jacob--jacob合并几个word文件到一个word文件" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/54/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/52/">52</a></li><li><a class="page-number" href="/page/53/">53</a></li><li><a class="page-number" href="/page/54/">54</a></li><li class="active"><li><span class="page-number current">55</span></li><li><a class="page-number" href="/page/56/">56</a></li><li><a class="page-number" href="/page/57/">57</a></li><li><a class="page-number" href="/page/58/">58</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/56/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 17:47:11</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
