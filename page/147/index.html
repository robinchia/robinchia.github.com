
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 147 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-eclipse--myeclipse9X-101加密和破解机制/">myeclipse9.X</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-eclipse--myeclipse9X-101加密和破解机制/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="myeclipse9-x-10-1-">myeclipse9.X-10.1加密和破解机制</h1>
<p>不想了解破解机制急于破解的直接跳到最后 ‘ 具体操作 ’</p>
<p>myeclipse 9.1 终于出来了，有人尝鲜了，但是发现很受伤，很受伤是因为完整性验证部分，呵呵。</p>
<p><img src="" alt="图片"></p>
<p>myeclipse 9.0 完整性校验有参数可以控制.</p>
<p>-Dgenuitec.honorDevMode=true</p>
<p>-Dosgi.dev=true</p>
<p>但是9.1取消了这个选项。上面的命令就不好用了。反编译源代码即可看差异，确实删掉了开发模式的代码。</p>
<p>要想跳过校验，有两种选择。</p>
<p>看堆栈（使用 jconsole，Java内置），可以看到</p>
<p>...</p>
<p>com.genuitec.eclipse.core.SignatureVerifier.verifyJarSignatures(SignatureVerifier.java:172)</p>
<p>com.genuitec.eclipse.core.CommonCore.startup(CommonCore.java:39)</p>
<p>...</p>
<p>1.短路 com.genuitec.eclipse.core.CommonCore中的startup()方法</p>
<p>2.短路 com.genuitec.eclipse.core.SignatureVerifier中的verifyJarSignatures()方法</p>
<p>仔细看反编译的源代码即可发现 短路CommonCore中的startup()方法比较麻烦，因为需要别的类包中的库，找起来比较麻烦。</p>
<p>所以我选择短路SignatureVerifier中的verifyJarSignatures()方法</p>
<p>下面的类即可，什么也不需要，这个方法什么也不做，直接替换就行，用压缩软件打开，替换相应的类即可</p>
<p>注意：最好编译该类的时候使用JDK1.5。高版本也可以，移植的时候可能要考虑JDK的问题。因为1.5运行不了1.6的类文件</p>
<p>相应的包是 Common/plug/com.genuitec.eclipse.core.common_9.0.0.me2011/*.jar，包具体视情况而定.</p>
<p>Java代码 </p>
<ol>
<li>package com.genuitec.eclipse.core;  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* replace com.genuitec.eclipse.core.SignatureVerifier With this class<br> </li>
<li>/<em> in jar com.genuitec.eclipse.core.common_9.0.0.me2011/</em>.jar<br> </li>
<li>/* shorcut method verifyJarSignatures()<br> </li>
<li>/*  </li>
<li>/* @author macbookpro </li>
<li>/*/  </li>
<li>public class SignatureVerifier {  </li>
<li>public void verifyJarSignatures() {  </li>
<li>// do nothing ...  </li>
<li>}  </li>
<li>}  </li>
</ol>
<p>类可以自己编译，也可以用已上传的替换即可。</p>
<p>关于，进一步的用户licence和activecode破解，那个用9.0的破解方法即可，这部分都是一样的。
一个基于Java环境的破解程序。</p>
<p>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/*
有人用了以上的方法，没有破解成功，之后还有校验完整性错误的弹出框，这个是因为myeclipse的检测机制我之前没有弄清楚。</p>
<p>myeclipse检测完整性分为两个步骤</p>
<ol>
<li><p>myeclipse 启动校验</p>
</li>
<li><p>myeclipse 组件校验。</p>
</li>
</ol>
<p>上面写的只是myeclipse的启动的短路，其实还有组件的检测。</p>
<p>组件校验</p>
<p>当myeclipse启动成功，会首先加载eclipse的核心，然后挂载myeclipse组件。</p>
<p>当挂载myeclipse组件的时候，就会有完整性校验了。这个就是组件校验，9.0不知道是否存在这种校验。</p>
<p>找到那个组件校验的类包有两种方法（目前能想到的比较实际的）</p>
<ol>
<li><p>查看堆栈。（jconsole和jstack）</p>
<p>在弹出校验错误的窗口时，看堆栈，找出那个类进行的校验，然后找到该包，短路掉里面的校验逻辑。（找包的部分比较麻烦）</p>
<p>然后再打开myeclipse，再找出哪个类进行的校验………. 直到没有弹出框为止，证明都找到了。</p>
</li>
<li><p>jar文件遍历</p>
<p>编写程序，找出jar文件里的校验类。</p>
<p>程序很好写，就是找出plugin目录和子目录下的jar文件里的类名是否包括SignatureVerifier类即可。</p>
</li>
</ol>
<p>下面的类包和里面的类就是我通过上面两种方法共同找到的类。</p>
<p>Common/plugins/com.genuitec.eclipse.core.common_9.0.0.me201105301859.jar                      [com/genuitec/eclipse/core/SignatureVerifier.class]</p>
<p>Common/plugins/com.genuitec.eclipse.easie.core_9.0.0.me201106010603/easiecore.jar           [com/genuitec/eclipse/easie/core/SignatureVerifier.class]</p>
<p>Common/plugins/com.genuitec.eclipse.j2eedt.core_9.0.0.me201106292137/j2eedtcore.jar         [com/genuitec/eclipse/j2eedt/core/SignatureVerifier.class]</p>
<p>Common/plugins/com.genuitec.myeclipse.product_9.0.0.me201106290046/myeclipse-product.jar      [com/genuitec/myeclipse/product/SignatureVerifier.class]</p>
<p>我们需要把上面的类包中的SignatureVerifier短路掉即可，用上面SignatureVerifier类重新编译即可，注意包名。</p>
<p>替换的类我编写好了一份，要是自己编译麻烦的话，那就直接用附件里面的。</p>
<p>这几个类包短路掉之后，我用windows测试过没有问题。没有校验的弹出框了，基本可以解决校验问题。</p>
<p>替换类的方法我感觉还是比较麻烦，谁让我喜欢尝鲜了，尝鲜的朋友都知道，那就是必须的折腾。</p>
<p>myeclipse 9.1 破解说明</p>
<p>myeclipse 9.X 系列需要两个步骤：</p>
<p>第一步是破解Licence（所有系列都有）</p>
<p>第二步破解激活码activecode，（9.X系列特有）</p>
<p>Licence的算号，网上都有，这个基本没有什么问题，不需要借助其他的库，直接算法就可以。</p>
<p>关键是激活码的计算，这个比较麻烦，网上有关于9.0的破解程序，但是是exe文件的。</p>
<p>本人使用macbook ,要想破解起来必须装虚拟机或者bootcamp，所以对我来说比较麻烦，还有一个问题就是windows破解程序在计算activecode的时候需要systemid，但是替换成macbook的systemid之后再算的时候可能有问题。（可能有些人没这个问题）</p>
<p>所以自己看了myeclipse的验证逻辑，自己写了个破解。完全基于Java,任何系统都可以使用。</p>
<p>下面讲解一下myeclipse 9.X系列的注册验证问题</p>
<ol>
<li>systemid的计算</li>
</ol>
<p>systemid计算需要借助于其他类库</p>
<p>jniwrapper 关于这个可以到官方网站下载相应操作系统的类库。</p>
<p>systemid组成</p>
<p>“1f553430D3107d17834”</p>
<p>TypeField:1</p>
<p>Field:    15(f)</p>
<p>HostInfo:55 </p>
<p>SystemInfo:3430D31</p>
<p>MacAddress:07d1</p>
<p>HDSerial:7834</p>
<p>licenceCode由Licence算号算出。</p>
<p>Licence到期时间，可以由licenceCode反向转换得出，也可以自定义，只要在反向转换的时间之后就可以。</p>
<p>RSA加密解密</p>
<p>大家都知道myeclipse中有个publicKey.bytes文件，这个是公匙。</p>
<p>密匙（privateKey.bytes）在myeclipse公司手中，我们是拿不到的。</p>
<p>所以我们需要自己生成一个公匙和密匙，然后替换掉myeclipse中的公匙，这个就是9.0的破解过程，大家都清楚吧。</p>
<p>通过密匙加密，然后用公匙解出。这个也是RSA加密解密的机制。</p>
<p>激活码 是由上述三个字符串累加而成，然后通过RSA加密而成。</p>
<p>激活码注册验证需要通过三层验证</p>
<p>第一层</p>
<p>你输入的激活码解密出activecode（通过publicKey.bytes解出）</p>
<p>第二层</p>
<p>activecode分离出systemId,licenceCode,licenceDate</p>
<p>第三层</p>
<p>比对systemId,licenceCode,licenceDate三个参数，看是否匹配系统中的参数，即可完成验证。</p>
<p>9.0 的注册机在windows下很好用，但是在其他系统上却有些问题。手动填写systemid计算后的破解码有些问题。</p>
<p>有人使用MacOSX，所以必须借助于虚拟机或者其他的机器上来破解。在网上也找了很多，有一种方法就是使用9.0的注册机，替换掉里面生成systemid字符串（自己操作系统上的systemid，在myeclipse激活窗口能看到），然后运行那个exe文件，就可以破解。这个有些麻烦，但是也能解决问题。</p>
<p>有些人可能就是自己一台机器，借助不了其他的环境，那破解起来就会比较麻烦。</p>
<p> 9.1的破解</p>
<p>我们这里，使用java，可以跨平台使用，启动文件为jar文件，如果装了JDK双击即可，要是在命令行就用java -jar /*.jar（当然要配置好java环境变量，我相信在这里费劲注册激活myeclipse的人java环境变量配置都是入门知识的了吧）</p>
<p><strong>具体操作</strong></p>
<p><img src="" alt="图片"></p>
<p>第一步：Usrcode中输入任意用户名</p>
<p>第二步：点击systemid一次，这时候如果出现一行错误</p>
<p>Cannot find JNIWrapper native library (libjniwrap.so) in java.library.path:~~</p>
<p>不需要理会，再点击一次即可出现systemid。</p>
<p>第三步： 点菜单Tools-&gt;RebuildKey</p>
<p>第四步：点击active按钮.会在显示区域生成</p>
<p>LICENSE_KEY</p>
<p>ACTIVATION_CODE</p>
<p>ACTIVATION_KEY</p>
<p>这时候你并不需要打开myeclipse到激活页面输入。切记。next</p>
<p>第五步：打开菜单Tools-&gt;ReplaceJarFile，弹出文件选择对话框，到myeclipse的安装目录common文件夹下选择plugins文件夹</p>
<pre><code>点击打开，程序会卡住，不要担心，正在替换文件呢！
</code></pre><p>一会之后，会输出信息，文件已被替换</p>
<p>第六步：点菜单Tools-&gt;SaveProperites</p>
<p>OK 。打开你的myeclipse已经不需要再输入激活码什么的了。</p>
<p>仅供研究myeclipse9.X~~10.1加密和破解机制学习使用</p>
<p>我放在MSN网盘上共享，下载地址，  不需注册，刚添加了一下10.1破解的文件和源码
<a href="https://skydrive.live.com/redir.aspx?cid=3a056e7a1777dab0&amp;resid=3A056E7A1777DAB0!105" target="_blank"><a href="https://skydrive.live.com/redir.aspx?cid=3a056e7a1777dab0&amp;resid=3A056E7A1777DAB0!105">https://skydrive.live.com/redir.aspx?cid=3a056e7a1777dab0&amp;resid=3A056E7A1777DAB0!105</a></a></p>
<p>来源： <a href="[http://b1.cnc.qzone.qq.com/cgi-bin/blognew/blog_output_data?uin=894528596&amp;blogid=1317127373&amp;styledm=cnc.qzonestyle.gtimg.cn&amp;imgdm=cnc.qzs.qq.com&amp;bdm=b.cnc.qzone.qq.com&amp;mode=2&amp;numperpage=15&amp;blogseed=0.7196430717594922&amp;property=GoRE×tamp=1372298123&amp;dprefix=cnc.&amp;g_tk=5381&amp;ref=qzone&amp;entertime=1372298137865](http://b1.cnc.qzone.qq.com/cgi-bin/blognew/blog_output_data?uin=894528596&amp;blogid=1317127373&amp;styledm=cnc.qzonestyle.gtimg.cn&amp;imgdm=cnc.qzs.qq.com&amp;bdm=b.cnc.qzone.qq.com&amp;mode=2&amp;numperpage=15&amp;blogseed=0.7196430717594922&amp;property=GoRE&amp;timestamp=1372298123&amp;dprefix=cnc.&amp;g_tk=5381&amp;ref=qzone&amp;entertime=1372298137865)">[http://b1.cnc.qzone.qq.com/cgi-bin/blognew/blog_output_data?uin=894528596&amp;blogid=1317127373&amp;styledm=cnc.qzonestyle.gtimg.cn&amp;imgdm=cnc.qzs.qq.com&amp;bdm=b.cnc.qzone.qq.com&amp;mode=2&amp;numperpage=15&amp;blogseed=0.7196430717594922&amp;property=GoRE×tamp=1372298123&amp;dprefix=cnc.&amp;g_tk=5381&amp;ref=qzone&amp;entertime=1372298137865](http://b1.cnc.qzone.qq.com/cgi-bin/blognew/blog_output_data?uin=894528596&amp;blogid=1317127373&amp;styledm=cnc.qzonestyle.gtimg.cn&amp;imgdm=cnc.qzs.qq.com&amp;bdm=b.cnc.qzone.qq.com&amp;mode=2&amp;numperpage=15&amp;blogseed=0.7196430717594922&amp;property=GoRE&amp;timestamp=1372298123&amp;dprefix=cnc.&amp;g_tk=5381&amp;ref=qzone&amp;entertime=1372298137865)</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/eclipse/">eclipse</a></li></span></span> | <span class="tags">Tagged <a href="/tags/eclipse/" class="label label-primary">eclipse</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-eclipse--myeclipse9X-101加密和破解机制/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-eclipse--myeclipse9X-101加密和破解机制" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-eclipse-插件--EclipseProfilerPlugin/">Eclipse Profiler Plugin</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-eclipse-插件--EclipseProfilerPlugin/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="eclipse-profiler-plugin">Eclipse Profiler Plugin</h1>
<h1 id="eclipse-profiler-plugin">Eclipse Profiler Plugin</h1>
<p>This is a plugin for the Eclipse platform which allows java code profiling. <a href="http://sourceforge.net/projects/eclipsecolorer" target="_blank">Project</a></p>
<h2 id="license">License</h2>
<p>CPL.</p>
<h2 id="general-note">General note</h2>
<p>1.) if you run the remote profiler, the filter settings in the eclipse environment are not taken into account. Instead you must provide the filter settings in the start command of your application server. You do this by adding an environment variable <strong>PROFILER_PACKAGE_FILTER to the startup command of your aplication, see below. 2.) Setting up the profiler package filters (in general) You must define the environment variable </strong>PROFILER<em>PACKAGE<em>FILTER as shown below in the examples for tomcat, jboss, weblogic and resin. General important Note: The environment variable contains following parts: the application starting class (<strong>A</strong>) inclusion filters (<strong>P</strong>) exclusion filters (__M</em></em>) You must provide exactly one starting class, but you can have multiple inclusion and exclusion filters. The parts MUST be separated by the OS specific path.separator, i.e. &quot;:&quot; for unix or &quot;;&quot; for WINDOWS platforms) example package filter setting for WINDOWS: -D<strong>PROFILER_PACKAGE_FILTER=</strong>A<strong>org.apache.catalina.startup.Bootstrap;</strong>M<strong>sun.;</strong>P<strong>my.company.classes. example package filter setting for UNIX/LINUX: -D</strong>PROFILER_PACKAGE_FILTER=<strong>A</strong>org.apache.catalina.startup.Bootstrap:<strong>M</strong>sun.:<strong>P</strong>my.company.classes. In the examples below we provide the WINDOWS style. Please take care to use the LINUX/UNIX style if that aplies to you.</p>
<h2 id="win32-installation">Win32 installation</h2>
<p>Copy ProfilerDLL.dll from root plugin folder into bin folder of your JRE installation. You can skip this step, plugin will ask you and copy DLL into your JRE\BIN when you will start profiling local application inside of Eclipse first time. It will also check, that you have in JRE\BIN same DLL as in plugin directory.</p>
<h2 id="linux-installation">Linux installation</h2>
<p>Profiler has native part compiled with gcc 3.2, but if you have old gcc or libraries you can build native part yourself. Extract files from native\profiler_linux.tgz and look at script &quot;m&quot;. This is example of compilation script. Change it as needed for you OS.
See also profile_cpu/profile_heap for examples of start line for cpu and heap profiling and r_cpu/r_heap as example how to use them.</p>
<h2 id="usage">Usage</h2>
<p>Profiler plugin creates additional kind of launch configuration in Run menu. Profiler tab allows the user to define packages which shouldn&#39;t be instrumented, thus, all time usage will be referred to calling methods.
You can specify refresh rate, i.e. how often plugin will read statistics from prolifing JVM.
You can also set method, how to get time of enter in method and leave. There are two methods: fast, but usefull only if you have one active thread, which tries to use all CPU; or slow, which use JVMPI function GetCurrentThreadCpuTime() and allows detect how much of CPU was used by thread. However with this method profiled program runs about 3 times slower than with fast method.
<img src="" alt="">
<strong>Fig. 1. Launch configuration.</strong></p>
<p>Profiler supports inclusive (grren) and exlusive (red) filters. You can noy only specify what packages should be excluded from instrumentation, but also what packages should be included. Usefull, if you want to profile only your own classes. You can move filters up and down using buttons or drag and drop.
<img src="" alt="">
<strong>Fig. 1.1. Drag filters.</strong></p>
<p>Plugin allows remote profiling with &quot;Remote Profiler&quot; launch configuration. Notice, that remote profiling is supported only in &quot;run&quot; mode, i.e. when you create launch configuration using &quot;Run|Run...&quot; menu item.
You need to start remote application with special switches like: java -XrunProfilerDLL -Xbootclasspath/a:jakarta-regexp.jar;profiler<em>trace.jar;commons-lang.jar -D<strong>PROFILER_PACKAGE_FILTER=</strong>M<strong>sun.;</strong>M<strong>com.sun. -D</strong>PROFILER<em>USE<em>PACKAGE<em>FILTER=1 Here <strong>M</strong> prefix used for exclusive filter, __P</em></em> can be used for inclusive filter. And you should use __A</em></em> for class with method &quot;main&quot;.
<img src="" alt="">
<strong>Fig. 2. Remote launch configuration.</strong></p>
<h2 id="tomcat-cpu-profiling">Tomcat CPU profiling</h2>
<p>Profiler was tested with jakarta-tomcat-4.1.12. Add after lines in catalina.bat:
set <em>EXECJAVA=%<em>RUNJAVA%
set MAINCLASS=org.apache.catalina.startup.Bootstrap
set ACTION=start
set SECURITY_POLICY_FILE=
set DEBUG_OPTS=
set JPDA=
following line:
set JAVA_OPTS=-XrunProfilerDLL:1 -Xbootclasspath/a:jakarta-regexp.jar;profiler_trace.jar;commons-lang.jar -D<strong>PROFILER_PACKAGE_FILTER=</strong>A</em></em>%MAINCLASS%;<strong>M</strong>sun.;<strong>M</strong>com.sun.;<strong>M</strong>java.;<strong>M</strong>javax.;<strong>M</strong>org.apache. -D__PROFILER_TIMING_METHOD=1
Then copy jar&#39;s: commons-lang.jar jakarta-regexp.jar profiler_trace.jar to bin directory of tomcat. Now you can start tomcat using startup.bat and it will gather statistics for you. Next step is configuring Eclipse. You should create remote launch configuration and set host address as needed. This is all. Launch it, plugin will connect to your Tomcat and show you some statistics.</p>
<h2 id="tomcat-heap-profiling">Tomcat heap profiling</h2>
<p>Profiling heap is almost same as CPU profiling, but you should use following line:
set JAVA<em>OPTS=-XrunProfilerDLL:3,10,0 -D<strong>PROFILER_PROFILE_HEAP=1 -Xbootclasspath/a:jakarta-regexp.jar;profiler_trace.jar;commons-lang.jar -D</strong>PROFILER<em>PACKAGE<em>FILTER=<em>_A</em></em>%MAINCLASS%;__M</em></em> -D__PROFILER_TIMING_METHOD=1</p>
<h2 id="jboss-profiling">JBoss profiling</h2>
<p>Profiler was tested with jboss-3.0.6_tomcat-4.1.18. Add following line in your bin/run.bat (directly after echo off):
set JAVA_OPTS=-XrunProfilerDLL:1 -Xbootclasspath/a:jakarta-regexp.jar;profiler_trace.jar;commons-lang.jar -D<strong>PROFILER_PACKAGE_FILTER=</strong>A<strong>org.jboss.Main;</strong>M<strong>sun.;</strong>M<strong>com.sun.;</strong>M<strong>java.;</strong>M<strong>javax. -D</strong>PROFILER_TIMING_METHOD=1
Then copy jar&#39;s: commons-lang.jar jakarta-regexp.jar profiler_trace.jar to bin directory of JBoss. Now you can start JBoss using run.bat and it will gather statistics for you. Next step is configuring Eclipse. You should create remote launch configuration and set host address as needed. This is all. Launch it, plugin will connect to your JBoss and show you some statistics.</p>
<h2 id="weblogic-profiling">WebLogic profiling</h2>
<p>Profiler was tested with WebLogic 8.1, installed in &quot;c:/bea&quot;. WebLogic has its own JRE&#39;s, so you will need to copy ProfilerDLL.dll manually to C:\bea\jdk141_02\jre\bin. For profiling examples, change file C:\bea\weblogic81\samples\domains\examples\startExamplesServer.cmd, line where JAVA_OPTIONS is defined:
set JAVA_OPTIONS=-XrunProfilerDLL:1 -Xbootclasspath/a:jakarta-regexp.jar;profiler_trace.jar;commons-lang.jar -D<strong>PROFILER_PACKAGE_FILTER=</strong>A<strong>weblogic.Server;</strong>M<strong>sun.;</strong>M<strong>com.sun.;</strong>M<strong>java.;</strong>M<strong>javax.;</strong>M<strong>weblogic. -D</strong>PROFILER_TIMING_METHOD=1
Then copy jar&#39;s: commons-lang.jar jakarta-regexp.jar profiler_trace.jar to &quot;C:\bea\weblogic81\samples\domains\examples&quot;. Now you can start WebLogic examplex using startExamplesServer.cmd, or shortcut in Windows menu, and it will gather statistics for you. Next step is configuring Eclipse. You should create remote launch configuration and set host address as needed. This is all. Launch it, plugin will connect to your WebLogic and show you some statistics.</p>
<h2 id="resin-profiling">Resin profiling</h2>
<p>Profiler was tested with Resin-ee 2.1.10. Create batch file with following content in &quot;bin&quot;:
httpd.exe -J-XrunProfilerDLL:1 -Xbootclasspath/a:c:/prof/jakarta-regexp.jar;c:/prof/profiler_trace.jar;c:/prof/commons-lang.jar -D<strong>PROFILER_PACKAGE_FILTER=</strong>A<strong>com.caucho.server.http.HttpServer;</strong>M<strong>sun.;</strong>M<strong>com.sun.;</strong>M<strong>java.;</strong>M<strong>javax. -D</strong>PROFILER_TIMING_METHOD=1
Then create directory &quot;prof&quot; in disc &quot;C&quot; and copy jar&#39;s: commons-lang.jar jakarta-regexp.jar profiler_trace.jar. Now you can start your batch file and it will gather statistics for you. Next step is configuring Eclipse. You should create remote launch configuration and set host address as needed. This is all. Launch it, plugin will connect to your Resin and show you some statistics.</p>
<h2 id="options">Options</h2>
<p>Profiler supports several options via -DXXX.
Options Description <strong>PROFILER_PACKAGE_FILTER Contains list of packages to include or exclude.
Here </strong>P<strong> - inclusive pattern, </strong>M<strong> - exclusive pattern.
And </strong>A<strong> - application start class.
Examples:
Include only ru./<em> and de./</em> packages: </strong>P<strong>ru.;</strong>P<strong>de.
Exclude system packages: </strong>A<strong>org.jboss.Main;</strong>M<strong>sun.;</strong>M<strong>com.sun.;</strong>M<strong>java.;</strong>M<strong>javax.
If at least one inclusive pattern used, only classes accepted by inclusive patterns will be instrumented. </strong>PROFILER_TIMING_METHOD Specifies timing method - how to measure elapsed time.
0 - fast, System.currentTimeMillis(), good for application without sleeps and waits.
1 - precise, thread aware, slow, good for multithreaded applications.
2 - sampling profiling, very fast, good for long runned processes. <strong>PROFILER_PROFILE_HEAP 1, if HEAP profiling should be used. </strong>PROFILER_AUTO_START 0 - don&#39;t start automatically.
1 (default) - start automatically. <strong>PROFILER_START_ON_METHOD Start method name. When applications tries to enter in this method profiling starts (see </strong>PROFILER_AUTO_START, it should be 0).
Example: -D<strong>PROFILER_START_ON_METHOD=ru.nlmk.train.Main.mainLoop </strong>PROFILER_PAUSE_ON_METHOD 1, if you need pause profiling when <strong>PROFILER_START_ON_METHOD leaved. </strong>PROFILER_INSTRUMENT_SYSTEM_CLASSES 1, if you need instrument additional system classes, like java.lang.String, etc. Expensive! __PROFILER_WAIT_FRONTEND_CONNECT 1, if you need to wait, until frontend (plugin) will connect. (0 by default).</p>
<h2 id="cpu-profiling">CPU profiling</h2>
<p>Profiler supports CPU profiling and basic function for heap profiling. The profiler collects invocation count and direct time statistics for every method. Direct time is the amount of time used by selected method for execute. Also a total time value displayed in calling tree for selected thread. The total time means a time used by selected method and by all the methods it had called.</p>
<p>Only instrumentation profiling method is supported because of its precise. The overhead expenses reflects at speed decreasing app. 5 times to normal.</p>
<h2 id="how-it-works">How it works</h2>
<p>The profiler subscribes for JVPMI event JVMPI_EVENT_CLASS_LOAD_HOOK which called during every class loading. The profiler modifies loading byte-code by adding profiler&#39;s method call &quot;enter&quot; in the beginning of the every method of loading class and at the end of it - &quot;leave&quot;. &quot;Enter&quot; profiler&#39;s method notes the time of entering to profiling method. &quot;Leave&quot; makes method leaving timestamp and calculates a difference between enter and leave timestamps. This difference means total time for this method call. Direct time calculates as total time of this method minus total time of the all methods called by it. The profiles makes some time corrections for the time spent by profiler.</p>
<p>The profiler implemented as an Eclipse perspective with following views: Threads, Packages, Classes, Methods, Thread methods, Thread call tree, Heap.</p>
<p><strong>Threads.</strong>
Shows a list with all threads (alive or dead) in the current process. Here you can pause/resume refreshing of statistics in views, pause/resume all threads in profilied program, clear all statistics or run GC in profiled JVM.
<img src="" alt="">
<strong>Fig. 3. Threads View.</strong></p>
<p><strong>Call graph.</strong>
Profiler uses Draw2D for displaying call graph of thread. All methods shown in several columns, column depends on level, on which this method was called. Inside one column methods sorted by direct time used. Each node in graph has color from red to dark gray, depending on direct time. Methods with maximum time use have red color, and methods, which almost don&#39;t use time, have grey color. Each method has hint with detailed information. You can double click on method to open it in editor.
Lines between method present call from source method to target. Lines from one level to directly next have black color, to next - blue, inside one level - red, and from backward calls - green. Width of line depeneds on how much of time use in this call.
<img src="" alt="">
<strong>Fig. 3.1. Call graph.</strong>
You can also see hit for call. <img src="" alt="">
<strong>Fig. 3.2. Call hint.</strong>
As you can see, full graph looks fairly complex, but you can select part of it. Press mouse on some method and select then button &quot;Show callers&quot;, &quot;Show calles&quot; or &quot;Show caller and callees&quot;. You can see something like this: <img src="" alt="">
<strong>Fig. 3.3. Callers.</strong>
<img src="" alt="">
<strong>Fig. 3.4. Callees.</strong>
<img src="" alt="">
<strong>Fig. 3.5. Callers and callees.</strong>
You can double click on call line for opening editor with source method with highlighting places, where it calls target method. <img src="" alt="">
<strong>Fig. 3.6. Show calls.</strong></p>
<p><strong>Packages.</strong>
Shows a list with all methods with class hierarchy from package. This allows to determine packages which used the most of CPU time. In this view (and in Classes and Methods views also) the user can see in gray color the methods with unmodified parameters since last update. The user can hide such kind of methods by applying appropriate filters.
Here:
Name - name of package/class/method
Inv. - invocation count
% - percent of all invocations
Time - direct time used
% - percent of total time
Time/Inv. - average time used for one invocation
Total time - total time used directly by method and by all methods it calls
Inst. time - time used for instrumentation of class
<img src="" alt="">
<strong>Fig. 4. Packages View.</strong></p>
<p>You can add package or class to filter by pressing right mose button on element in table and selecting menu item. Filter can be added to launch configuration filter (will be used in next profiling, if you will active it) or to view filters (will be activated right now).
<img src="" alt="">
<strong>Fig. 4.1. Add filter.</strong></p>
<p><strong>Classes.</strong>
Shows a list of all class methods with method hierarchy from class. This allows to determine classes with the most CPU time usage.
<img src="" alt="">
<strong>Fig. 5. Classes View.</strong></p>
<p><strong>Filters.</strong>
Allows to define which kind of methods can be shown.
<img src="" alt="">
<strong>Fig. 6. Filters.</strong>
You can save configured name patterns (inclusive or exalusive) with some name and description, then you will able to select them in check list box. <img src="" alt="">
<strong>Fig. 6.1. New filter.</strong>
Later you can change this user defined filter. <img src="" alt="">
<strong>Fig. 6.2. Edit filter.</strong></p>
<p><strong>Methods.</strong>
Shows the statistics for all methods of the current process.
<img src="" alt="">
<strong>Fig. 7. All Methods View.</strong></p>
<p><strong>Thread methods.</strong>
Shows methods statictics for thread selected in Threads View.
<img src="" alt="">
<strong>Fig. 8. Thread Methods View.</strong></p>
<p><strong>Thread tree.</strong>
Shows a methods invocation tree for thread selected in Threads View. Here red square used for highlighted methods (from thread methods context menu) and green dot used for all other methods.
<img src="" alt="">
<strong>Fig. 9. Thread Tree View.</strong></p>
<p><strong>Inverted thread tree.</strong>
Shows a methods invocation tree for thread selected in Threads View starting from leaves. This allows you fastly detect, that some leaf method uses much of total time and see, what methods it is called.
<img src="" alt="">
<strong>Fig. 9.1. Inverted thread Tree View.</strong></p>
<p><strong>Heap.</strong>
Shows heap usage graph: total (green), used (blue) and free (yellow) heap.
<img src="" alt="Heap View.">
<strong>Fig. 10. Heap View.</strong></p>
<p>Here is an overall view of the profiler perspective. You can see a method HashMap.put opened in source code editor with highlighted lines of code which has the maximum hit count (size of annotation depends on hit count). You can open source code editor by choosing menu item &quot;Open method in editor&quot; in context menu.
<img src="" alt="">
<strong>Fig. 11. Perspective.</strong></p>
<p><a href="http://sourceforge.net/" target="_blank"><img src="" alt="SourceForge Logo"></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/eclipse/">eclipse</a></li></span><span class="breadcrumb"><li><a href="/categories/eclipse/">eclipse</a></li><li><a href="/categories/eclipse/插件/">插件</a></li></span></span> | <span class="tags">Tagged <a href="/tags/eclipse/" class="label label-primary">eclipse</a><a href="/tags/插件/" class="label label-success">插件</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-eclipse-插件--EclipseProfilerPlugin/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-eclipse-插件--EclipseProfilerPlugin" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-框架汇总-activemq--activemq的网络层介绍/">activemq的网络层介绍</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-框架汇总-activemq--activemq的网络层介绍/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="activemq-">activemq的网络层介绍</h1>
<p>#</p>
<h3 id="-">概要</h3>
<p>activemq是一个apache的顶级项目，其实现了<a href="http://www.goldendoc.org/2011/08/jms_spec_message/" title="JMS规范介绍(1) JMS消息" target="_blank">JMS规范</a>，作为一个开源的JMS实现，activemq已经在很多地方得到了应用。同时，开源小组在研究JMS实现的时候，也选择了activemq作为研究对象，希望能够读其源码，让<a href="http://www.goldendoc.org/" title="开源学习小组：黄金档" target="_blank">开源小组</a>更好的明白JMS规范和实现。</p>
<p>在学习activemq的时候，我们发现还不能一下子就进去学习JMS规范的实现，而是需要了解其底层代码，包括其对网络连接的处理等等。所以，这篇文章就学习了<a href="http://www.goldendoc.org/2011/09/activemq-network-process/" title="activemq的网络层实现" target="_blank">activemq的网络层实现</a>。</p>
<h3 id="activemq-">activemq网络层概念</h3>
<p>activemq 是支持多协议的，因此，把单一协议的server抽象成更高一层，就很有意义，请看下面这张图：
<a href="http://www.goldendoc.org/wp-content/uploads/2011/09/activemq%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A51.png" target="_blank"><img src="" alt=""></a></p>
<p>在activemq中，差不多每种概念都有生命周期（见Service接口）。
这张图十分简单，实际中当然比这个要复杂。下面针对每个概念进行叙述。</p>
<h3 id="transport">Transport</h3>
<p>Transport 应该算是很底层的概念，他封装了 Socket，职责是发送和接受连接方的信息。
同时，在Transport中，增加了同步和异步的概念。
Transport拥有一个TransportListener。</p>
<h3 id="transportlistener">TransportListener</h3>
<p>顾名思义，TransportListener 就是监听 Transport 事件的发生以及做出一定的反映。
在activemq中，正是利用了 TransportListener 对 Command 进行处理 —— Command 是 activemq 网络传递的形式，每个请求都会被反序列化成一个 Command。</p>
<h3 id="transportserver">TransportServer</h3>
<p>就是一个server实例，他会处理外部进来的Socket，进而封装成 Transport 。此 Server 拥有一个 TransportAcceptListener 。</p>
<h3 id="transportacceptlistener">TransportAcceptListener</h3>
<p>负责 Accept Transport，将 Transport 封装成 Connection，从而开启 Connection 的生命周期。
这里需要注意的是：TransportServer 将 Socket 封装成 Transport，而 TransportAcceptListener 将 Transport 封装成 Connection。</p>
<h3 id="connection">Connection</h3>
<p>可以理解成业务层面上的连接。 Connection 会给相应的 Transport 设置 TransportListener ，从而获取底层 Socket 的活动情况，进行业务的处理。</p>
<h3 id="connector">Connector</h3>
<p>Connector就是较高层次的抽象，它代表对外的连接器，每个连接器都可以支持不同的协议。
Connector 通过给 TransportServer 设置 TransportAcceptListener ，从而能够控制 Transport 并产生相应的 Connection。</p>
<h3 id="-">总结</h3>
<p>总体来说，两个Listener是连接 Conncetor与TransportServer 和 Connection和Transport 的关键概念。
至于为什么要分成 Connector ， TransportServer 这两层，我想原因应该就是开头提到的： activemq需要支持多协议，因此 Connector 抽象起来，可以当作是针对不同协议的统一行为；而 TransportServer 就是针对各协议的具体实现。 对于 Connection,Transport 来说， Connector 是与 Connection 统一层次， Transport 是与 TransportServer 统一层次。
如果读者有时间，还可以查看<a href="http://www.goldendoc.org/" title="开源小组" target="_blank">开源小组</a>当时分析的<a href="http://www.goldendoc.org/wp-content/uploads/2011/09/activemq%E7%BD%91%E7%BB%9C%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B.png" target="_blank">activemq网络连接序列图</a>（是基于TcpTransportServer的，图像有点大，需要耐心看）</p>
<p><img src="" alt="">
来源： <a href="[http://www.goldendoc.org/2011/09/activemq-network-process/](http://www.goldendoc.org/2011/09/activemq-network-process/)">[http://www.goldendoc.org/2011/09/activemq-network-process/](http://www.goldendoc.org/2011/09/activemq-network-process/)</a></p>
<p>本文会把主要篇幅集中在这几个组件的创建时期，运行时期来讲解，最后会总结一下这几个组建使用的线程情况。一下的分析是基于 bio 的（nio 也是在这个结构当中，只是行为是基于 nio 特点的）。在<a href="http://www.goldendoc.org/2011/09/activemq-network-process/" title="activemq的网络层介绍（一）" target="_blank">activemq的网络层介绍（一）</a>也讲过，activemq中很多组件都实现了 Service 接口，而 Service 接口的作用就是赋予实现者有生命周期的意义。</p>
<h3 id="transportconnector">TransportConnector</h3>
<p>TransportConnector 是 Connector 的实现，是基于 Transport 的 Connector（目前activemq的Connector实现，也就是基于Transport的）。其内部依赖了 TransportServer ，这个也容易理解，因为这个 Connector 是基于 Transport 的。因此 TransportServer 也是其所重点依赖的组件。 值得注意的是 TransportServer 的 AcceptListener 也是在 TransportConnector 中指定的，具体见下文。</p>
<h3 id="transportconnector-">TransportConnector 的创建</h3>
<p>TransportConnector 的创建比较简单，直接接受传入进来的 TransportServer （关于 TransportServer 的创建，详见下文）。</p>
<h3 id="transportconnector-">TransportConnector 的运行</h3>
<p>TransportConnector 是一个 Service，有自己的生命周期。因此，在 activemq 开始的时候，其生命周期，会被启动（具体表现为被调用 start 方法）。</p>
<p>在 TransportConnector 的 start 方法中，可以很明显的看到两个主要的逻辑：为 TransportServer 设置一个匿名的 AcceptListener ，调用 TransportServer 启动。</p>
<p>对于 TransportConnector 为 TransportServer 设置的 AcceptListener，其逻辑主要是当 TransportServer 接收到传输进来的 Transport（由 TransportServer 将 Socket 封装成 Transport）之后，将 Transport 封装成 Connection ，并且启动 Connection 的生命周期。这里也不难理解：在<a href="http://www.goldendoc.org/2011/09/activemq-network-process/" title="activemq的网络层介绍（一）" target="_blank">activemq网络层介绍（一）</a>中也讲过， Connector 是与 Connection 一个层次的，TransportServer 与 Transport 是一个层次的。因此，将 AcceptListener 的匿名实现放在 TransportConnector 中，也就很好理解了。</p>
<h3 id="connection">Connection</h3>
<p>在 TransportServer 的 AcceptListener 收到传输进来的 Transport 之后，就创建了 Connection（实际类型是 TransportConnection），然后为 Connection 开启生命周期。
但一个Socket是从什么时候传进来，进而被封装成 Transport 的，会在下文有描述。现在让我们跟着 TransportConnection ，看看他是如何被创建的，以及在它的生命周期中，会做什么事情。</p>
<h3 id="transportconnection-">TransportConnection 的创建</h3>
<p>TransportConnection 是在 AcceptListener 收到 TransportServer 传进来的 Transport 之后创建的。可以想象，TransportConnection 是封装了 Transport 的。同时， Transport 的 TransportListener ，也是在 TransportConnection 的构造方法中进行了创建。此 TransportListener 的逻辑就是服务一个 Command (Command是 activemq 实例之间交互的基本对象，任何请求和响应都被activemq 序列化成一个 Command)，在得到响应的时候，进行分发（响应其实也是一个Command）。</p>
<h3 id="transportconnection-">TransportConnection 的运行</h3>
<p>在开始说 TransportConnection 的生命周期之前，可以先说一下 activemq 的 Task 接口，此接口有一个 iterate 遍历方法，activemq 一般对这个接口的用法都是使用一个线程去跑 iterater 方法，直到 iterater 返回 false 。一般的，iterater 方法里面都是在重复的做一段逻辑，只不过是这个逻辑实施的对象不一样而已。TransportConnection 正是实现了此接口。</p>
<p>在 TransportConnection 的 start 方法中，主要做了两件事情：创建一个 taskRunner ，以做好跑 Task 的准备（就是在另起线程跑自己的 Iiterater 方法）；调用 Transport 的 Start 方法，开启 Transport 的生命周期。</p>
<p>在 TransportConnection 自己的 Iiterater 方法中，就是到一个队列中取出 Command，并且使用 Transport 的 oneWay，将 Command 发送出去。</p>
<h3 id="transportserver">TransportServer</h3>
<p>按理说要接下来讲 Transport，但如果不先把 TransportServer 弄清出的话， Transport 还是有些难以理解的。因为是 TransportServer 将 接受到的 Socket 封装成 Transport。这里说的是 TransportServer 的实现， TcpTransportServer。</p>
<h3 id="tcptransportserver-">TcpTransportServer 的创建</h3>
<p>TransportServer 是由 TransportFactory 创建的。TransportFactory，不同的 TransportFactory 创建出不同的 TransportServer，而 TcpTransportServer 则是由 TcpTransportFactory 创建的。关于 TransportFactory 如何创建相应的 TransportServer，activemq使用了一套基于分析参数和配置文件来实现，说起来很高深，其实很朴实的，有兴趣也可以了解一下，这里不做深入。</p>
<h3 id="tcptransportserver-">TcpTransportServer 的运行</h3>
<p>这里主要使用 TcpTransportServer，TcpTransportServer 生命周期，是通过 TransportConnector 来开启的，这点在上面已经有所讲述。</p>
<p>这里要说一下 TransportServerThreadSupport，此类的作用是支持 TransportServer 能够开启另外一个线程，只要实现了 TransportServer Runnable，在 start 的时候，就能够开启另外一个线程，这也是 TransportServerThreadSupport 命令的含义。同样的机制也出现在 TransportThreadSupport 中。</p>
<p>现在来看一下 TcpTransportServer 的 start ：
TcpTransportServer 会开启两个线程，包括：</p>
<ol>
<li>实现了Runnable的线程，此线程的工作是不停的 accept 外部的 socket，然后将 socket 扔到一个队列中。简单来说，此线程是一个 acceptor。</li>
<li>另外一个线程的工作是，从队列中取出 socket ，并且将 WireFormat（ WireFormat 是在 activemq 中负责序列化和发序列化的组件） 和socket 封装成一个 Transport ，然后将创建好的 Transport 通知到 AcceptListener 中。</li>
</ol>
<h3 id="transport">Transport</h3>
<p>这里也主要讲 TcpTransport。</p>
<h3 id="tcptransport-">TcpTransport 的创建</h3>
<p>上面已经讲到，TcpTransport 是在 TcpTransportServer 中创建，并扔给了 AcceptListener 。并且，TcpTransport 也支持 TransportThreadSupport 的形式，可以另起一个线程。</p>
<h3 id="tcptransport-">TcpTransport 的运行</h3>
<p>TcpTransport 开始执行之后，专注于做两个事情：</p>
<ol>
<li>初始化 socket，并且把 socket 的流给设置起来。</li>
<li>另起一个线程，利用 wireFormat 将 socket 传过来的字节序列转化成一个 command ，然后将 Command 扔给 transportListener 。transportListener 所做的事情就是进行业务处理，然后将得到的 response （也是一个 command）通过 tcpTransport 的 oneway 传给对方。</li>
</ol>
<p>这样，这个网络通讯的过程就完成了。下面我们来总结一下 TcpTransportServer 的线程模型。</p>
<h3 id="tcptransportserver-">TcpTransportServer 的线程模型</h3>
<p>如图所示：
<a href="http://www.goldendoc.org/wp-content/uploads/2011/09/activemq%E6%A8%A1%E5%9E%8B.jpg" target="_blank"><img src="" alt="activemq网络线程模型"></a></p>
<p>activemq网络线程模型</p>
<h3 id="-">总结</h3>
<p>从上图中可以看出，accpetor 和 sockethandler 线程是在整个 transportServer 中的，而 ThreadPool 中的线程不会进行消息的发送，相反，当需要发送消息的时候，总是会创建新的线程去发送。这也是为了 ThreadPool 能将自己的线程利用率提高。因为这是 bio 的网络，如果消息的发送是利用线程池中的线程来发送的，那么很有可能线程池中的线程会在发送的时候阻塞，因为对方的网络不可预知。因此，新建一个新的线程，利用新建的线程发送消息，则是很明智的选择。
来源： <a href="[http://www.goldendoc.org/2011/09/activemq-network-process-2/](http://www.goldendoc.org/2011/09/activemq-network-process-2/)">[http://www.goldendoc.org/2011/09/activemq-network-process-2/](http://www.goldendoc.org/2011/09/activemq-network-process-2/)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/框架汇总/">框架汇总</a></li></span><span class="breadcrumb"><li><a href="/categories/框架汇总/">框架汇总</a></li><li><a href="/categories/框架汇总/activemq/">activemq</a></li></span></span> | <span class="tags">Tagged <a href="/tags/activemq/" class="label label-primary">activemq</a><a href="/tags/框架汇总/" class="label label-success">框架汇总</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-框架汇总-activemq--activemq的网络层介绍/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-框架汇总-activemq--activemq的网络层介绍" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-框架汇总-ORM-hibernate--Hibernate的体系结构与分析、工作原理/">Hibernate的体系结构与分析、工作原理</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-框架汇总-ORM-hibernate--Hibernate的体系结构与分析、工作原理/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="hibernate-">Hibernate的体系结构与分析、工作原理</h1>
<p>本文摘自 李刚 著 《Java EE企业应用实战》</p>
<pre><code>    现在我们知道了一个概念**Hibernate Session**，只有处于**Session**管理下的**POJO**才具有持久化操作能力。当应用程序对于处于**Session**管理下的**POJO**实例执行操作时，**Hibernate**将这种面向对象的操作转换成了持久化操作能力。
</code></pre><p>HIbernate简要的体系结构如下图所示：</p>
<p><img src="" alt=""></p>
<pre><code>    通过上图能够发现HIbernate需要一个**hibernate.properties**文件，该文件用于配置**Hibernate**和数据库连接的信息。还需要一个XML文件，该映射文件确定了持久化类和数据表、数据列之间的想对应关系。
</code></pre><p>除了使用hibernate.properties文件，还可以采用另一种形式的配置文件： <strong>/*.cfg.xml</strong>文件。在实际应用中，采用XML配置文件的方式更加广泛，两种配置文件的实质是一样的。</p>
<pre><code>    Hibernate的持久化解决方案将用户从赤裸裸的JDBC访问中释放出来，用户无需关注底层的JDBC操作，而是以面向对象的方式进行持久层操作。底层数据连接的获得、数据访问的实现、事务控制都无需用户关心。这是一种“全面解决”的体系结构方案，将应用层从底层的JDBC/JTA API中抽象出来。通过配置文件来管理底层的JDBC连接，让Hibernate解决持久化访问的实现。这种“全面解决”方案的体系结构图如图所示：
</code></pre><p><img src="" alt=""></p>
<pre><code>    针对以上的Hibernate全面解决方案架构图：

  （1）**SessionFactory**：**这是Hibernate的关键对象，**它是单个数据库映射关系经过编译后的内存镜像，它也是**线程安全的**。**它是生成Session的工厂**，本身要应用到ConnectionProvider，该对象可以在进程和集群的级别上，为那些事务之间可以重用的数据提供可选的二级缓存。

  （2）**Session**：它是应用程序和持久存储层之间交互操作的一个单线程对象。它也是Hibernate持久化操作的关键对象，所有的持久化对象必须在Session的管理下才能够进行持久化操作。**此对象的生存周期很短，其隐藏了JDBC连接，也是Transaction 的工厂。Session对象有一个一级缓存，现实执行Flush之前，所有的持久化操作的数据都在缓存中Session对象处。**

  （3）**持久化对象**：系统创建的POJO实例一旦与特定Session关联，并对应数据表的指定记录，那该对象就处于持久化状态，这一系列的对象都被称为持久化对象。程序中对持久化对象的修改，都将自动转换为持久层的修改。**持久化对象完全可以是普通的Java Beans/POJO，唯一的特殊性是它们正与Session关联着。**

  （4）**瞬态对象和脱管对象**：系统进行new关键字进行创建的Java 实例，没有Session 相关联，此时处于瞬态。瞬态实例可能是在被应用程序实例化后，尚未进行持久化的对象。如果一个曾今持久化过的实例，但因为Session的关闭而转换为脱管状态。

  （5）**事务(Transaction)**：代表一次原子操作，它具有数据库事务的概念。但它通过抽象，将应用程序从底层的具体的JDBC、JTA和CORBA事务中隔离开。在某些情况下，一个Session 之内可能包含多个Transaction对象。虽然事务操作是可选的，但是所有的持久化操作都应该在事务管理下进行，即使是只读操作。

  （6）**连接提供者(ConnectionProvider)：****它是生成JDBC的连接的工厂，同时具备连接池的作用。他通过抽象将底层的DataSource和DriverManager隔离开。这个对象无需应用程序直接访问，仅在应用程序需要扩展时使用。**

  （7）事务工厂(TransactionFactory)：他是生成Transaction对象实例的工厂。该对象也无需应用程序的直接访问。
</code></pre><p>来源： <a href="[http://blog.csdn.net/titilover/article/details/6920457](http://blog.csdn.net/titilover/article/details/6920457)">[http://blog.csdn.net/titilover/article/details/6920457](http://blog.csdn.net/titilover/article/details/6920457)</a> </p>
<pre><code>前面说了一些宏观上学习框架相关的思想方面的东西，下面继续来介绍我经常使用的框架和框架的分析，这篇博客主要介绍的是hibernate框架。

  首先说hibernate框架是数据持久层的框架，这个框架是非常强大的，它让编程人员纯粹的用面向对象的方式来做开发，让编程人员所面对的都是对象。仅仅从这一点它的设计思路就是非常让编程人员喜爱的。

  回想我们普通的开发流程，和客户沟通定需求，抽象出来原型，从原型中建立数据模型到库表结构的建立，之后在映射成对象模型，之后在用oo的设计思想完成后续的程序开发。但是当我们使用了hibernate框架以后，原先的设计思路就显得不再那么具有优势了。我们直接建立对象模型，之后利用hibernate框架映射成数据模型，我们不再去考虑数据库关系模型的东西，仅仅考虑的东西仅仅就是类和对象，这样的开发才是面向对象的开发，也才是最接近人类思考问题的方式。所以hibernate框架的设计思路是非常好的。

    hibernate框架设计思路的优越性其实体现在了它本身的框架的原理上。hibernate封装了JDBC，减轻了开发人员在持久层的大量重复性工作，它利用了java反射机制来实现程序的透明性；它就是通过这两点才达到从对象出发而非关系数据库出发的效果。



  介绍这么多理论性的东西之后我们能够感觉到hibernate框架的强大，来看看它的结构图：
</code></pre><p><img src="" alt=""></p>
<pre><code>   在hibernate框架中有几个比较重要的接口和类：
</code></pre><ol>
<li><p>Query接口：Query负责执行各种数据库查询。它可以使用HQL语句或SQL语句两种表达方式。</p>
</li>
<li><p>Configuration类：Configuration类负责配置并启动Hibernate，创建SessionFactory对象</p>
</li>
<li><p>SessionFactory接口：SessionFactory接口负责初始化Hibernate。它充当数据存储源的代理，并负责创建Session对象</p>
</li>
<li><p>Session接口：Session接口负责执行被持久化对象的CRUD操作</p>
</li>
<li><p>Transaction接口：Transaction接口负责事务相关的操作</p>
</li>
</ol>
<pre><code>     hibernate框架就是在利用这几个接口来封装了JDBC，而且我们用这些接口来操作数据库变得非常简单，减少了我们在持久层的代码量。

   从这个结构图和我的一些分析就能发现hibernate框架是非常强大，而且它给我们开发人员的开发带来了非常大的便利，尤其是他的设计思路还有它的“全自动”的映射对象模型和关系模型。

   但是hibernate框架也有它的一些缺点：
</code></pre><ol>
<li><p>既然是封装了JDBC，所以很明显它没有JDBC的效率高，尤其是在大量的处理表更新操作的时候。</p>
</li>
<li><p>它有局限性，一个持久化类不能映射多个表</p>
</li>
<li>它应对大数量的时候显得非常笨拙，这一点没有JDBC和接下来要介绍的IBatis框架</li>
</ol>
<pre><code>   其实一项技术或者一个框架都有它的优缺点，选择最合适的才是王道。
</code></pre><p>来源： <a href="[http://blog.csdn.net/lfsf802/article/details/7941958](http://blog.csdn.net/lfsf802/article/details/7941958)">[http://blog.csdn.net/lfsf802/article/details/7941958](http://blog.csdn.net/lfsf802/article/details/7941958)</a> </p>
<p>Hibernate工作原理：</p>
<p>1.Hibernate 的初始化.</p>
<p>读取Hibernate 的配置信息-〉创建Session Factory</p>
<p>1)创建Configeration类的实例：</p>
<p>它的构造方法：将配置信息(Hibernate config.xml)读入到内存。 
一个Configeration 实例代表Hibernate 所有Java类到Sql数据库映射的集合。</p>
<p>2)创建SessionFactory实例：</p>
<p>把Configeration 对象中的所有配置信息拷贝到SessionFactory的缓存中。 
SessionFactory的实例代表一个数据库存储员源，创建后不再与Configeration 对象关联。</p>
<p>3)调用SessionFactory创建Session的方法：</p>
<pre><code>    1】用户自行提供JDBC连接。

    Connection con=dataSource.getConnection();
    Session s=sessionFactory.openSession(con);

    2】让SessionFactory提供连接

    Session s=sessionFactory.openSession();
</code></pre><p>4)通过Session 接口提供的各种方法来操纵数据库访问。</p>
<p>Hibernate 的缓存体系</p>
<p>一级缓存：</p>
<p>Session 有一个内置的缓存，其中存放了被当前工作单元加载的对象。 
每个Session 都有自己独立的缓存，且只能被当前工作单元访问。</p>
<p>二级缓存：</p>
<p>SessionFactory的外置的可插拔的缓存插件。其中的数据可被多个Session共享访问。</p>
<p>SessionFactory的内置缓存：存放了映射元数据，预定义的Sql语句。</p>
<p>Hibernate 中Java对象的状态</p>
<p>1.临时状态 (transient)</p>
<p>特征：</p>
<p>1】不处于Session 缓存中
2】数据库中没有对象记录</p>
<p>Java如何进入临时状态</p>
<p>1】通过new语句刚创建一个对象时 
2】当调用Session 的delete()方法，从Session 缓存中删除一个对象时。</p>
<p>2.持久化状态(persisted)</p>
<p>特征：</p>
<p>1】处于Session 缓存中 
2】持久化对象数据库中设有对象记录 
3】Session 在特定时刻会保持二者同步</p>
<p>Java如何进入持久化状态</p>
<p>1】Session 的save()把临时－》持久化状态 
2】Session 的load(),get()方法返回的对象 
3】Session 的find()返回的list集合中存放的对象 
4】Session 的update(),saveOrupdate()使游离－》持久化</p>
<p>3.游离状态(detached)</p>
<p>特征：</p>
<p>1】不再位于Session 缓存中 
2】游离对象由持久化状态转变而来，数据库中可能还有对应记录。</p>
<p>Java如何进入持久化状态－》游离状态</p>
<p>1】Session 的close()方法 
2】Session 的evict()方法，从缓存中删除一个对象。提高性能。少用。</p>
<p>总结一下Hibernate的好处：</p>
<p>1.JDBC访问数据库的代码做了封装，大大简化了数据访问层繁琐的重复性代码。</p>
<ol>
<li><p>Hibernate是一个基于JDBC的主流持久化框架，是一个优秀的ORM实现。他很大程度的简化DAO层的编码工作</p>
</li>
<li><p>hibernate使用Java反射机制，而不是字节码增强程序来实现透明性。</p>
</li>
<li><p>hibernate的性能非常好，因为它是个轻量级框架。映射的灵活性很出色。它支持各种关系数据库，从一对一到多对多的各种复杂关系。
来源： <a href="[http://www.linuxidc.com/Linux/2012-12/76684.htm](http://www.linuxidc.com/Linux/2012-12/76684.htm)">[http://www.linuxidc.com/Linux/2012-12/76684.htm](http://www.linuxidc.com/Linux/2012-12/76684.htm)</a> </p>
</li>
</ol>
<p><img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/框架汇总/">框架汇总</a></li></span><span class="breadcrumb"><li><a href="/categories/框架汇总/">框架汇总</a></li><li><a href="/categories/框架汇总/ORM/">ORM</a></li><li><a href="/categories/框架汇总/ORM/hibernate/">hibernate</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ORM/" class="label label-primary">ORM</a><a href="/tags/hibernate/" class="label label-success">hibernate</a><a href="/tags/框架汇总/" class="label label-info">框架汇总</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-框架汇总-ORM-hibernate--Hibernate的体系结构与分析、工作原理/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-框架汇总-ORM-hibernate--Hibernate的体系结构与分析、工作原理" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-框架汇总-ORM-hibernate--Hibernate知识点总结/">Hibernate知识点总结</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-框架汇总-ORM-hibernate--Hibernate知识点总结/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="hibernate-">Hibernate知识点总结</h1>
<h3 id="hibernate-">Hibernate(面试)知识点总结</h3>
<p>Hibernate是目前最流行的开源对象关系映射(ORM)框架。Hibernate采用低侵入式的设计，也即完全采用普通的Java对象（POJO），而不必继承Hibernate的某个基类，或实现Hibernate的某个接口。Hibernate是面向对象的程序设计语言和关系数据库之间的桥梁，Hibernate允许程序开发者采用面向对象的方式来操作关系数据库。</p>
<p>因为我们知道hibernate它能支持透明持久化从这个角度来看它没有侵入性所谓侵入性它没有侵入hibernate任何的API所以它叫轻量级框架，轻量级框架的好处是没有侵入性另外的一个好处是为测试带来了好处，测试非常简单测试就行我们写普通的java应用程序一样不需要什么环境只需要几个jar包就可以了写个main函数一侧就可以了它没有侵入性和测试非常简单 这是它流行的一个原因。</p>
<p>hibernate的优缺点 
优点：1、程序更加面向对象；
        2、提高了生产率；
        3、方便移植（修改配置文件）；
        4、无侵入性。
  缺点：
        1、效率比JDBC略差；
        2、不适合批量操作。</p>
<pre><code>    3、只能配置一种关联关系
</code></pre><p>Hibernate有四种查询方案 
  1、get,load方法，根据id查找对象
  2、HQL--hibernate query language（查询对象：Query)
  3、Criteria--标准查询语言（查询对象：Criteria，查询条件：Criterion）
  4、通过sql来查（查询对象：SQLQuery）</p>
<p>具体</p>
<p>Query/Criteria:</p>
<p>1.Query接口封装了Hibernate强大的对象查询能力，同时也支持数据库的更新操作</p>
<p>2.提供了动态查询的参数绑定功能</p>
<p>3.提供list(),iterator(),scroll()等对象导航方法</p>
<p>4.提供uiqueResult()方法获取单独的对象</p>
<p>5.提供executeUpdate()方法来执行DML语句</p>
<p>6.提供了可移植的分页查询方法</p>
<p>Session：</p>
<p>1、save，presist保存数据，persist在事务外不会产生insert语句。</p>
<p>2、delete，删除对象</p>
<p>3、update，更新对象，如果数据库中没有记录，会出现异常，脱管对象如属性改变需要保存，则调用update方法</p>
<p>4、get，根据ID查，会立刻访问数据库</p>
<p>5、load，根据ID查，（返回的是代理，不会立即访问数据库)</p>
<p>6、saveOrUpdate,merge(根据ID和version的值来确定是否是save或update），调用merge你的对象还是托管的。当不知该对象的状态时可调用该方法</p>
<p>小贴士：瞬时对象id无值，脱管对象有值，hibernate通过该方式判断对象的状态</p>
<p>7、lock（把对象变成持久对象，但不会同步对象的状态）</p>
<p>hibernate的工作原理<br>1.配置好hibernate的配置文件和与类对应的配置文件后，启动服务器
2.服务器通过实例化Configuration对象，读取hibernate.cfg.xml文件的配置内容，并根据相关的需求建好表或者和表建立好映射关系
3.通过实例化的Configuration对象就可以建立sessionFactory实例，进一步，通过sessionFactory实例可以创建 session对象
4.得到session之后，便可以对数据库进行增删改查操作了，除了比较复杂的全文搜索外，简单的操作都可以通过hibernate封装好的 session内置方法来实现
5.此外，还可以通过事物管理，表的关联来实现较为复杂的数据库设计
优点：hibernate相当于java类和数据库表之间沟通的桥梁，通过这座桥我们就可以做很多事情了</p>
<p>Hibernate 的初始化.
1)创建Configeration类的实例。
它的构造方法：将配置信息(Hibernate config.xml)读入到内存。
一个Configeration 实例代表Hibernate 所有Java类到Sql数据库映射的集合。</p>
<p>2)创建SessionFactory实例
把Configeration 对象中的所有配置信息拷贝到SessionFactory的缓存中。
SessionFactory的实例代表一个数据库存储员源，创建后不再与Configeration 对象关联。</p>
<p>3)调用SessionFactory创建Session的方法
1】用户自行提供JDBC连接。
Connection con=dataSource.getConnection();
Session s=sessionFactory.openSession(con);
2】让SessionFactory提供连接
Session s=sessionFactory.openSession();</p>
<p>状态转换</p>
<p>临时状态 (transient)</p>
<p>1】不处于Session 缓存中
2】数据库中没有对象记录</p>
<p>Java如何进入临时状态
1】通过new语句刚创建一个对象时
2】当调用Session 的delete()方法，从Session 缓存中删除一个对象时。</p>
<p>持久化状态(persisted)</p>
<p>1】处于Session 缓存中
2】持久化对象数据库中有对象记录
3】Session 在特定时刻会保持二者同步</p>
<p>Java如何进入持久化状态
1】Session 的save()把临时－》持久化状态
2】Session 的load(),get()方法返回的对象
3】Session 的find()返回的list集合中存放的对象
4】Session 的update(),saveOrupdate()使游离－》持久化</p>
<p>游离状态(detached)</p>
<p>1】不再位于Session 缓存中
2】游离对象由持久化状态转变而来，数据库中可能还有对应记录。</p>
<p>Java如何进入持久化状态－》游离状态
1】Session 的close()方法
2】Session 的evict()方法，从缓存中删除一个对象。提高性能。少用。</p>
<p>具体如图：</p>
<p>缓存</p>
<p>主要有session缓存（一级缓存）和sessionfactory缓存（内置缓存和外置缓存（也叫二级缓存））</p>
<p>Session的缓存是内置的，不能被卸载，也被称为Hibernate的第一级缓存（Session的一些集合属性包含的数据）。在第一级缓存中，持久化类的每个实例都具有唯一的OID。</p>
<p>SessionFactory的缓存又可以分为两类：</p>
<p>内置缓存（存放SessionFactory对象的一些集合属性包含的数据，SessionFactory的内置缓存中存放了映射元数据和预定义SQL语句，映射元数据是映射文件中数据的拷贝，而预定义SQL语句是在Hibernate初始化阶段根据映射元数据推导出来，SessionFactory的内置缓存是只读的，应用程序不能修改缓存中的映射元数据和预定义SQL语句，因此SessionFactory不需要进行内置缓存与映射文件的同步。）</p>
<p>外置缓存。SessionFactory的外置缓存是一个可配置的插件。在默认情况下，SessionFactory不会启用这个插件。外置缓存的数据是数据库数据的拷贝，外置缓存的介质可以是内存或者硬盘。SessionFactory的外置缓存也被称为Hibernate的第二级缓存。</p>
<p>缓存的范围分为三类。</p>
<p>1 事务范围：缓存只能被当前事务访问。</p>
<p>2 进程范围：缓存被进程内的所有事务共享。</p>
<p>3 集群范围：在集群环境中，缓存被一个机器或者多个机器的进程共享。</p>
<p>持久化层可以提供多种范围的缓存。如果在事务范围的缓存中没有查到相应的数据，还可以到进程范围或集群范围的缓存内查询，如果还是没有查到，那么只有到数据库中查询。事务范围的缓存是持久化层的第一级缓存，通常它是必需的；进程范围或集群范围的缓存是持久化层的第二级缓存，通常是可选的。</p>
<p>在进程范围或集群范围的缓存，即第二级缓存，会出现并发问题。因此可以设定以下四种类型的并发访问策略，每一种策略对应一种事务隔离级别。</p>
<p>事务型、读写型、非严格读写型、只读型</p>
<p>什么样的数据适合存放到第二级缓存中？</p>
<p>1 很少被修改的数据</p>
<p>2 不是很重要的数据，允许出现偶尔并发的数据</p>
<p>3 不会被并发访问的数据</p>
<p>4 参考数据</p>
<p>不适合存放到第二级缓存的数据？</p>
<p>1 经常被修改的数据</p>
<p>2 财务数据，绝对不允许出现并发</p>
<p>3 与其他应用共享的数据。</p>
<p>Hibernate的二级缓存策略的一般过程如下：</p>
<p>1) 条件查询的时候，总是发出一条select /* from table_name where …. （选择所有字段）这样的SQL语句查询数据库，一次获得所有的数据对象。</p>
<p>2) 把获得的所有数据对象根据ID放入到第二级缓存中。</p>
<p>3) 当Hibernate根据ID访问数据对象的时候，首先从Session一级缓存中查；查不到，如果配置了二级缓存，那么从二级缓存中查；查不到，再查询数据库，把结果按照ID放入到缓存。</p>
<p>4) 删除、更新、增加数据的时候，同时更新缓存。</p>
<p>注意几个关键字的含义</p>
<p>inverse=&quot;true&quot;表示此表不维护表之间的关系，由另外的表维护。</p>
<p>inverse属性默认是false的，就是说关系的两端都来维护关系。</p>
<p>false代表由己方来维护关系，true代表由对方来维护关系。在一个关系中，只能由一方来维护关系，否则会出问题（解疑中会讲到）；同时也必须由一方来维护关系，否则会出现双方互相推卸责任，谁也不管。</p>
<p>可以这样理解，cascade定义的是关系两端对象到对象的级联关系；而inverse定义的是关系和对象的级联关系。</p>
<p>Cascade属性的可能值有</p>
<pre><code>all: 所有情况下均进行关联操作，即save-update和delete。
none: 所有情况下均不进行关联操作。这是默认值。
save-update: 在执行save/update/saveOrUpdate时进行关联操作。
delete: 在执行delete 时进行关联操作。

all-delete-orphan: 当一个节点在对象图中成为孤儿节点时，删除该节点。比如在一个一对多的关系中，Student包含多个book，当在对象关系中删除一个book时，此book即成为孤儿节点。
</code></pre><p>来源： <a href="[http://blog.163.com/benbenfafa_88/blog/static/649301622011523909352/](http://blog.163.com/benbenfafa_88/blog/static/649301622011523909352/)">[http://blog.163.com/benbenfafa_88/blog/static/649301622011523909352/](http://blog.163.com/benbenfafa_88/blog/static/649301622011523909352/)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/框架汇总/">框架汇总</a></li></span><span class="breadcrumb"><li><a href="/categories/框架汇总/">框架汇总</a></li><li><a href="/categories/框架汇总/ORM/">ORM</a></li><li><a href="/categories/框架汇总/ORM/hibernate/">hibernate</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ORM/" class="label label-primary">ORM</a><a href="/tags/hibernate/" class="label label-success">hibernate</a><a href="/tags/框架汇总/" class="label label-info">框架汇总</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-框架汇总-ORM-hibernate--Hibernate知识点总结/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-框架汇总-ORM-hibernate--Hibernate知识点总结" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/146/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/144/">144</a></li><li><a class="page-number" href="/page/145/">145</a></li><li><a class="page-number" href="/page/146/">146</a></li><li class="active"><li><span class="page-number current">147</span></li><li><a class="page-number" href="/page/148/">148</a></li><li><a class="page-number" href="/page/149/">149</a></li><li><a class="page-number" href="/page/150/">150</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/148/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 15:12:19</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
