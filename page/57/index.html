
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 57 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--探索java多线程（连载）1守护线程-ikon-BlogJava/">探索java多线程（连载）1 守护线程 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--探索java多线程（连载）1守护线程-ikon-BlogJava/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-java-1-ikon-blogjava">探索java多线程（连载）1 守护线程 - ikon - BlogJava</h1>
<h1 id="-ikon-http-www-blogjava-net-ikon-"><a href="http://www.blogjava.net/ikon/" target="_blank">ikon</a></h1>
<p>posts - 1, comments - 0, trackbacks - 0, articles - 1   <a href="http://www.blogjava.net/" target="_blank">BlogJava</a> :: <a href="http://www.blogjava.net/ikon/" target="_blank">首页</a> :: <a href="http://www.blogjava.net/ikon/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a> :: <a href="http://www.blogjava.net/ikon/contact.aspx?id=1" target="_blank">联系</a> :: <a href="http://www.blogjava.net/ikon/rss" target="_blank">聚合</a> <a href="http://www.blogjava.net/ikon/rss" target="_blank"><img src="" alt=""></a> :: <a href="http://www.blogjava.net/ikon/admin/EditPosts.aspx" target="_blank">管理</a> <img src="" alt=""></p>
<h3 id="-">日历</h3>
<p><a href="&quot;Go to the previous month&quot;">&lt;</a>2011年3月<a href="&quot;Go to the next month&quot;">&gt;</a>日一二三四五六2728123456789101112131415161718192021<a href="http://www.blogjava.net/ikon/archive/2011/03/22.html" target="_blank">22</a>232425262728293031123456789</p>
<p><img src="" alt=""></p>
<h3 id="-">常用链接</h3>
<ul>
<li><a href="http://www.blogjava.net/ikon/MyPosts.html" target="_blank">我的随笔</a></li>
<li><a href="http://www.blogjava.net/ikon/MyComments.html" target="_blank">我的评论</a></li>
<li><a href="http://www.blogjava.net/ikon/OtherPosts.html" target="_blank">我的参与</a>
<img src="" alt=""></li>
</ul>
<h3 id="-">留言簿</h3>
<ul>
<li><a href="http://www.blogjava.net/ikon/Contact.aspx?id=1" target="_blank">给我留言</a></li>
<li><a href="http://www.blogjava.net/ikon/default.aspx?opt=msg" target="_blank">查看公开留言</a></li>
<li><a href="http://www.blogjava.net/ikon/admin/MyMessages.aspx" target="_blank">查看私人留言</a></li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-">随笔档案</h3>
<ul>
<li><a href="http://www.blogjava.net/ikon/archive/2011/03.html" target="_blank">2011年3月 (1)</a>
<img src="" alt=""></li>
</ul>
<h3 id="-">搜索</h3>
<ul>
<li></li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-http-www-blogjava-net-ikon-commentsrss-aspx-java-1-">最新评论 <a href="http://www.blogjava.net/ikon/CommentsRSS.aspx" target="_blank"><img src="" alt=""></a> ## <a href="">探索java多线程（连载）1 守护线程</a></h3>
<p>Posted on 2011-03-22 19:25 <a href="http://www.blogjava.net/ikon/" target="_blank">ikon</a> 阅读(1692) <a href="http://www.blogjava.net/ikon/archive/2011/03/22/346738.html#Post" target="_blank">评论(0)</a>  <a href="http://www.blogjava.net/ikon/admin/EditPosts.aspx?postid=346738" target="_blank">编辑</a>  <a href="http://www.blogjava.net/ikon/AddToFavorite.aspx?id=346738" target="_blank">收藏</a> <img src="" alt=""></p>
<pre><code>  在java中有一类线程，专门在后台提供服务，此类线程无需显式关闭，当程序结束了，它也就结束了，这就是守护线程 daemon thread。如果还有非守护线程的线程在执行，它就不会结束。      守护线程有何用处呢？让我们来看个实践中的例子。

  在我们的系统中经常应用各种配置文件（黑名单，禁用词汇），当修改配置文件后，一般要重启服务，系统才能够加载；当重启服务的代价比较高的情况下，这种加载方式不能满足我们的要求，这个时候守护线程该发挥它的作用了，它可以实时加载你的配置文件，无需重启。（当然，相当重要的配置文件，不推荐实时加载）
</code></pre><p><img src="" alt="">package com.ikon.thread.daemon;
<img src="" alt="">
<img src="" alt="">import java.io.File;
<img src="" alt="">import java.util./<em>;
<img src="" alt="">
<img src="" alt=""><img src="" alt="">//</em>/<em> /</em>///<em>/</em>
<img src="" alt=""> /<em> 文件监测
<img src="" alt=""> /</em> @author ikon99999
<img src="" alt=""> /<em> 
<img src="" alt=""> /</em>/
<img src="" alt=""><img src="" alt="">public abstract class FileWatchdog extends Thread <img src="" alt="">{
<img src="" alt="">
<img src="" alt=""> 
<img src="" alt="">  static final public long DEFAULT_DELAY = 20/*1000; 
<img src="" alt=""> 
<img src="" alt=""><br><img src="" alt="">  protected HashMap fileList;
<img src="" alt=""> 
<img src="" alt="">  protected long delay = DEFAULT_DELAY; 
<img src="" alt=""><br><img src="" alt="">  boolean warnedAlready = false;
<img src="" alt=""><br><img src="" alt="">  boolean interrupted = false;
<img src="" alt="">
<img src="" alt="">  public static class Entity
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{
<img src="" alt="">        File file;
<img src="" alt="">        long lastModify;
<img src="" alt="">        Entity(File file,long lastModify)
<img src="" alt=""><img src="" alt="">        <img src="" alt="">{
<img src="" alt="">            this.file = file;
<img src="" alt="">            this.lastModify = lastModify;
<img src="" alt="">        }
<img src="" alt="">  }
<img src="" alt=""><br><img src="" alt=""><img src="" alt="">  protected  FileWatchdog() <img src="" alt="">{
<img src="" alt="">      fileList = new HashMap ();
<img src="" alt="">    setDaemon(true);
<img src="" alt="">  }
<img src="" alt="">
<img src="" alt=""> 
<img src="" alt=""><img src="" alt="">  public  void setDelay(long delay) <img src="" alt="">{
<img src="" alt="">    this.delay = delay;
<img src="" alt="">  }
<img src="" alt="">
<img src="" alt="">  public void addFile(File file)
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{
<img src="" alt="">        fileList.put(file.getAbsolutePath(),new Entity(file,file.lastModified()));<br><img src="" alt="">  }
<img src="" alt=""><br><img src="" alt="">  public boolean contains(File file)
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{
<img src="" alt="">        if( fileList.get(file.getAbsolutePath()) != null) return true;
<img src="" alt="">        else return false;
<img src="" alt="">  }
<img src="" alt=""><br><img src="" alt="">  abstract   protected   void doOnChange(File file);
<img src="" alt="">
<img src="" alt=""><img src="" alt="">  protected  void checkAndConfigure() <img src="" alt="">{
<img src="" alt="">      HashMap map = (HashMap)fileList.clone(); 
<img src="" alt="">      Iterator it = map.values().iterator();
<img src="" alt=""><br><img src="" alt="">      while( it.hasNext())
<img src="" alt=""><img src="" alt="">      <img src="" alt="">{
<img src="" alt=""><br><img src="" alt="">            Entity entity = (Entity)it.next();
<img src="" alt=""><br><img src="" alt="">            boolean fileExists;
<img src="" alt=""><img src="" alt="">            try <img src="" alt="">{
<img src="" alt="">              fileExists = entity.file.exists();
<img src="" alt="">            } catch(SecurityException  e) 
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt="">              System.err.println (&quot;Was not allowed to read check file existance, file:[&quot;+ entity.file .getAbsolutePath() +&quot;].&quot;);
<img src="" alt="">              interrupted = true; 
<img src="" alt="">              return;
<img src="" alt="">            }
<img src="" alt="">
<img src="" alt="">            if(fileExists) 
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt=""><br><img src="" alt="">              long l = entity.file.lastModified(); // this can also throw a SecurityException
<img src="" alt=""><img src="" alt="">              if(l &gt; entity.lastModify) <img src="" alt="">{           // however, if we reached this point this
<img src="" alt="">                    entity.lastModify = l;              // is very unlikely.
<img src="" alt="">                    newThread(entity.file);
<img src="" alt="">              }
<img src="" alt="">            }
<img src="" alt="">            else 
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt="">                System.err.println (&quot;[&quot;+entity.file .getAbsolutePath()+&quot;] does not exist.&quot;);
<img src="" alt="">            }
<img src="" alt="">      }
<img src="" alt="">  }
<img src="" alt=""><br><img src="" alt="">  private void newThread(File file)
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{
<img src="" alt="">      class MyThread extends Thread
<img src="" alt=""><img src="" alt="">      <img src="" alt="">{
<img src="" alt="">            File f;
<img src="" alt="">            public MyThread(File f)
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt="">                this.f = f;
<img src="" alt="">            }
<img src="" alt=""><br><img src="" alt="">            public void run()
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt="">                doOnChange(f);
<img src="" alt="">            }
<img src="" alt="">      }
<img src="" alt=""><br><img src="" alt="">      MyThread mt = new MyThread(file);
<img src="" alt="">      mt.start();
<img src="" alt="">  }
<img src="" alt="">
<img src="" alt="">  public  void run() 
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{<br><img src="" alt=""><img src="" alt="">    while(!interrupted) <img src="" alt="">{
<img src="" alt=""><img src="" alt="">      try <img src="" alt="">{
<img src="" alt="">        Thread.currentThread().sleep(delay);
<img src="" alt=""><img src="" alt="">      } catch(InterruptedException e) <img src="" alt="">{
<img src="" alt="">    // no interruption expected
<img src="" alt="">      }
<img src="" alt="">      checkAndConfigure();
<img src="" alt="">    }
<img src="" alt="">  }
<img src="" alt="">}
<img src="" alt=""></p>
<pre><code>FileWatchdog是个抽象类，本身是线程的子类；在构造函数中设置为守护线程；
此类用hashmap维护着一个文件和最新修改时间值对，checkAndConfigure()方法用来检测哪些文件的修改时间更新了，如果发现文件更新了则调用doOnChange方法来完成监测逻辑；doOnChange方法是我们需要实现的；看下面关于一个黑名单服务的监测服务：
</code></pre><p> 1<img src="" alt="">package com.ikon.thread.daemon;
 2<img src="" alt="">
 3<img src="" alt="">import java.io.File;
 4<img src="" alt="">
 5<img src="" alt=""><img src="" alt="">//<em>/</em> /<em>///</em>/<em>
 6<img src="" alt=""> /</em> 黑名单服务
 7<img src="" alt=""> /<em> @author ikon99999
 8<img src="" alt=""> /</em> 2011-3-21
 9<img src="" alt=""> /<em>/
10<img src="" alt=""><img src="" alt="">public class BlacklistService <img src="" alt="">{
11<img src="" alt="">    private File configFile = new File(&quot;c:/blacklist.txt&quot;);
12<img src="" alt=""><br>13<img src="" alt=""><img src="" alt="">    public void init() throws Exception<img src="" alt="">{
14<img src="" alt="">        loadConfig();
15<img src="" alt="">        ConfigWatchDog dog = new ConfigWatchDog();
16<img src="" alt="">        dog.setName(&quot;daemon_demo_config_watchdog&quot;);//a
17<img src="" alt="">        dog.addFile(configFile);//b
18<img src="" alt="">        dog.start();//c
19<img src="" alt="">    }
20<img src="" alt=""><br>21<img src="" alt=""><img src="" alt="">    public void loadConfig()<img src="" alt="">{
22<img src="" alt=""><img src="" alt="">        try<img src="" alt="">{
23<img src="" alt="">            Thread.sleep(1/</em>1000);//d
24<img src="" alt=""><br>25<img src="" alt="">            System.out.println(&quot;加载黑名单&quot;);
26<img src="" alt=""><img src="" alt="">        }catch(InterruptedException ex)<img src="" alt="">{
27<img src="" alt="">            System.out.println(&quot;加载配置文件失败！&quot;);
28<img src="" alt="">        }
29<img src="" alt="">    }
30<img src="" alt=""><br>31<img src="" alt=""><img src="" alt="">    public File getConfigFile() <img src="" alt="">{
32<img src="" alt="">        return configFile;
33<img src="" alt="">    }
34<img src="" alt="">
35<img src="" alt=""><img src="" alt="">    public void setConfigFile(File configFile) <img src="" alt="">{
36<img src="" alt="">        this.configFile = configFile;
37<img src="" alt="">    }
38<img src="" alt="">
39<img src="" alt="">
40<img src="" alt=""><img src="" alt="">    private class ConfigWatchDog extends FileWatchdog<img src="" alt="">{
41<img src="" alt=""><br>42<img src="" alt="">        @Override
43<img src="" alt=""><img src="" alt="">        protected void doOnChange(File file) <img src="" alt="">{
44<img src="" alt="">            System.out.println(&quot;文件&quot;+file.getName()+&quot;发生改变，重新加载&quot;);
45<img src="" alt="">            loadConfig();
46<img src="" alt="">        }
47<img src="" alt=""><br>48<img src="" alt="">    }
49<img src="" alt=""><br>50<img src="" alt=""><img src="" alt="">    public static void main(String[] args) throws Exception <img src="" alt="">{
51<img src="" alt="">        BlacklistService service = new BlacklistService();
52<img src="" alt="">        service.init();
53<img src="" alt=""><br>54<img src="" alt="">        Thread.sleep(60/<em>60/</em>1000);//e
55<img src="" alt="">    }
56<img src="" alt="">}
57<img src="" alt="">
        ConfigWatchDog内部类实现了doOnChange(File file)方法，当文件被修改后，watchdog调用doOnChange方法完成重新加载操作；
        在blackservice的init方法中初始化watchdog线程；
        d：模拟文件加载耗时
        e：主要是防止主线程退出；
        其实上面的FileWatchdog就是取自log4j；</p>
<p><a href="http://www.blogjava.net/RequireRegister.aspx" target="_blank">新用户注册</a>  <a href="">刷新评论列表</a>  </p>
<p><a href=""></a> <a href="http://job.cnblogs.com/">找优秀程序员，就在博客园</a>
<a href="http://job.cnblogs.com/offer/12368/" target="_blank">网易有道诚聘CRM研发工程师</a>
<a href="http://job.cnblogs.com/offer/11576/" target="_blank">锦江国际诚聘Java高级软件工程师</a>
<a href="http://job.cnblogs.com/offer/12493/" target="_blank">福州几维网络诚聘Java服务端程序员</a>
IT新闻：
· <a href="http://news.cnblogs.com/n/101664/" target="_blank">开放，开放，开放 —— 垄断</a>
· <a href="http://news.cnblogs.com/n/101663/" target="_blank">GNOME讨论放弃支持非Linux操作系统</a>
· <a href="http://news.cnblogs.com/n/101662/" target="_blank">Chrome 13将隐藏地址栏</a>
· <a href="http://news.cnblogs.com/n/101661/" target="_blank">联想：USB 3.0将在2012年成为主流</a>
· <a href="http://news.cnblogs.com/n/101659/" target="_blank">意法半导体 CEO ：诺基亚 Windows Phone 将采用 U8500 双核芯片</a>   <a href="http://www.cnblogs.com/" target="_blank">博客园</a>  <a href="http://home.cnblogs.com/q/" target="_blank">博问</a>  <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>  <a href="http://job.cnblogs.com/cate-java_programmer/" target="_blank">Java程序员招聘</a> 标题  请输入标题 姓名  请输入你的姓名 主页 请输入验证码 验证码 /*  <img src="" alt=""> 内容(请不要发表任何与政治相关的内容) 请输入评论内容 Remember Me?   <a href="http://www.blogjava.net/login.aspx?ReturnURL=http://www.blogjava.net/ikon/archive/2011/03/22/346738.html&amp;SourceURL=/ikon/archive/2011/03/22/346738.html" target="_blank">登录</a>       [使用Ctrl+Enter键可以直接提交]    推荐职位：
· <a href="http://job.cnblogs.com/offer/5914/" target="_blank">北京.NET 研发工程师 (北京捷报数据)</a>
· <a href="http://job.cnblogs.com/offer/12527/" target="_blank">(北京).NET软件开发工程师(北京龙达)</a>
· <a href="http://job.cnblogs.com/offer/11584/" target="_blank">厦门高级.NET软件工程师(服务于美国Amazon)</a>
· <a href="http://job.cnblogs.com/offer/10723/" target="_blank">高级Web页面前端开发工程师(新蛋中国)</a>
· <a href="http://job.cnblogs.com/offer/12493/" target="_blank">厦门Java服务端程序员(福州几维网络)</a>
· <a href="http://job.cnblogs.com/offer/9051/" target="_blank">.NET 高级软件开发工程师 (新蛋中国)</a>
· <a href="http://job.cnblogs.com/offer/12439/" target="_blank">北京ASP.NET 工程师（月薪12k）(北京盛安德)</a>
· <a href="http://job.cnblogs.com/offer/12492/" target="_blank">厦门C/#游戏客户端程序员 (福州几维网络)</a></p>
<p>博客园首页随笔：
· <a href="http://www.cnblogs.com/kqingchao/archive/2011/05/20/character-encoding-2.html" target="_blank">字符编码浅谈（二）</a>
· <a href="http://www.cnblogs.com/xuesong/archive/2011/05/20/2051892.html" target="_blank">Windows Phone 7编程实践—必应地图导航</a>
· <a href="http://www.cnblogs.com/ini_always/archive/2011/05/20/2050517.html" target="_blank">绕死你不偿命的UNICODE、_UNICODE、<strong>TEXT、</strong>T、_T、_TEXT、TEXT宏</a>
· <a href="http://www.cnblogs.com/leslies2/archive/2011/05/20/2051844.html" target="_blank">学习笔记：JAVA RMI远程方法调用简单实例</a>
· <a href="http://www.cnblogs.com/bobomouse/archive/2011/05/20/2051846.html" target="_blank">关于CellSet转DataTable的改进方案</a>
知识库：
· <a href="http://kb.cnblogs.com/page/101423/" target="_blank">程序员的本质</a>
· <a href="http://kb.cnblogs.com/page/101345/" target="_blank">Scrum之成败——从自身案例说起</a>
· <a href="http://kb.cnblogs.com/page/101321/" target="_blank">清除代码异味</a>
· <a href="http://kb.cnblogs.com/page/101198/" target="_blank">详解.NET程序集的加载规则</a>
· <a href="http://kb.cnblogs.com/page/101162/" target="_blank">如何通过ildasm/ilasm修改assembly的IL代码</a> 最简洁阅读版式：
<a href="http://archive.cnblogs.com/b/346738/" target="_blank">探索java多线程（连载）1 守护线程</a> 网站导航:</p>
<p><a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园</a>   <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>   <a href="http://kb.cnblogs.com/" target="_blank">知识库</a>   <a href="http://www.cnweblog.com/" target="_blank">博客生活</a>   <a href="http://www.cnitblog.com/" target="_blank">IT博客网</a>   <a href="http://www.cppblog.com/" target="_blank">C++博客</a>   <a href="http://space.cnblogs.com/q/" title="IT问答" target="_blank">博问</a>   <a href="http://www.blogjava.net/ikon/archive/2011/03/22/346738.html?opt=admin" target="_blank">管理</a>    Powered by:
<a href="http://www.blogjava.net/" target="_blank">BlogJava</a>
Copyright © ikon</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_多线程/">Java_多线程</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_多线程/" class="label label-success">Java_多线程</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--探索java多线程（连载）1守护线程-ikon-BlogJava/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_多线程--探索java多线程（连载）1守护线程-ikon-BlogJava" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--多线程讲解/">多线程讲解</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--多线程讲解/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">多线程讲解</h1>
<p>多线程是java应用程序的一个特点，掌握java的多线程也是作为一java程序员必备的知识。多线程指的是在单个程序中可以同时运行多个同的线程执行不同的任务.线程是程序内的顺序控制流，只能使用分配给序的资源和环境。还记得刚开始学习的时候总是和进程分不清，总是对这两个名词所迷惑。</p>
<p>下面就首先对这两个名词区分来作为本篇博客的开始：</p>
<p><strong>    一、线程与进程的区别</strong></p>
<p>多个进程的内部数据和状态都是完全独立的,而多线程是共享一块内存空间和一组系统资源,有可能互相影响. •线程本身的数据通常只有寄存器数据，以及一个程序执行时使用的堆栈，所以线程的切换比进程切换的负担要小。</p>
<p> 多线程编程的目的，就是&quot;最大限度地利用CPU资源&quot;，当某一线程的处理不需要占用CPU而只和I/O等资源打交道时，让需要占用CPU资源的其它线程有机会获得CPU资源。从根本上说，这就是多线程编程的最终目的。</p>
<p>二、了解一下java在多线程中的基础知识</p>
<p>1.Java中如果我们自己没有产生线程，那么系统就会给我们产生一个线程（主线程，main方法就在主线程上运行），我们的程序都是由线程来执行的。</p>
<ol>
<li>进程：执行中的程序（程序是静态的概念，进程是动态的概念）。 </li>
</ol>
<ol>
<li><p>线程的实现有两种方式，<strong>第一种方式是继承Thread类，然后重写run方法；第二种是实现Runnable接口，然后实现其run方法。 </strong></p>
</li>
<li><p>将我们希望线程执行的代码放到run方法中，然后通过start方法来启动线程，<strong>start方法首先为线程的执行准备好系统资源，然后再去调用run方法。</strong>当某个类继承了Thread类之后，该类就叫做一个线程类。 </p>
</li>
<li><p>一个进程至少要包含一个线程。 </p>
</li>
<li><p>对于单核CPU来说，某一时刻只能有一个线程在执行（微观串行），从宏观角度来看，多个线程在同时执行（宏观并行）。 </p>
</li>
<li><p>对于双核或双核以上的CPU来说，可以真正做到微观并行。</p>
</li>
</ol>
<p>三、Thread源码研究： </p>
<p>1) Thread类也实现了Runnable接口，因此实现了Runnable接口中的run方法； </p>
<p>2) 当生成一个线程对象时，如果没有为其设定名字，那么线程对象的名字将使用如下形式：Thread-number,该number将是自动增加的，并被所有的Thread对象所共享（因为它是static的成员变量）。 </p>
<p>3) 当使用第一种方式来生成线程对象时，我们需要重写run方法，因为Thread类的run方法此时什么事情也不做。</p>
<p>4）当使用第二种方式生成线程对象时，我们需要实现Runnable接口的run方法，然后使用new Thread（new MyThread（））（假如MyThread已经实现了Runnable接口）来生成线程对象，这时的线程对象的run方法或调就会MyThread类的run方法，这样我们自己编写的run方法就执行了。</p>
<p>说明： </p>
<p>Public void run(){</p>
<p>If(target!=null){</p>
<p>Target.run();</p>
<p>}}</p>
<p>当使用继承Thread生成线程对象时，target为空，什么也不执行，当使用第二种方式生成时，执行target.run（），target为runnable的实例对象，即为执行重写后的方法</p>
<p>总结：两种生成线程对象的区别：</p>
<p>1.两种方法均需执行线程的start方法为线程分配必须的系统资源、调度线程运行并执行线程的run方法。 </p>
<p>2.在具体应用中，采用哪种方法来构造线程体要视情况而定。通常，当一个线程已继承了另一个类时，就应该用第二种方法来构造，即实现Runnable接口。 </p>
<p><strong>四：线程的生命周期：</strong></p>
<p><img src="" alt=""></p>
<p>由上图可以看出，一个线程由出生到死亡分为五个阶段：</p>
<p><strong>1）.创建状态 </strong></p>
<p>•当用new操作符创建一个新的线程对象时，该线程处于创建状态。 </p>
<p>•处于创建状态的线程只是一个空的线程对象，系统不为它分配资源 </p>
<p><strong>2）. 可运行状态 </strong></p>
<p>•执行线程的start()方法将为线程分配必须的系统资源，安排其运行，并调用线程体—run()方法，这样就使得该线程处于可运行( Runnable )状态。 </p>
<p>•这一状态并不是运行中状态（Running )，因为线程也许实际上并未真正运行。 </p>
<p><strong>3）.不可运行状态 </strong></p>
<p>.当发生下列事件时，处于运行状态的线程会转入到不可运行状态。 </p>
<p>调用了sleep（）方法； </p>
<p>•线程调用wait方法等待特定条件的满足 </p>
<p>•线程输入/输出阻塞 </p>
<p><strong>4）返回可运行状态： </strong></p>
<p>•处于睡眠状态的线程在指定的时间过去后 </p>
<p>•如果线程在等待某一条件，另一个对象必须通过notify()或notifyAll()方法通知等待线程条件的改变 </p>
<p>•如果线程是因为输入/输出阻塞，等待输入/输出完成 </p>
<p><strong>5）. 消亡状态 </strong></p>
<p>当线程的run方法执行结束后，该线程自然消亡。 </p>
<p>注意：</p>
<p>1.停止线程的方式：不能使用Thread类的stop方法来终止线程的执行。一般要设定一个变量，在run方法中是一个循环，循环每次检查该变量，如果满足条件则继续执行，否则跳出循环，线程结束。 </p>
<p>2.不能依靠线程的优先级来决定线程的执行顺序。 </p>
<p><strong>五：多线程并发</strong></p>
<p>多线程并发是线程同步中比较常见的现象，java多线程为了避免多线程并发解决多线程共享数据同步问题提供了<strong>synchronized关键字</strong></p>
<p>synchronized关键字：当synchronized关键字修饰一个方法的时候，该方法叫做同步方法。 </p>
<p>1.Java中的每个对象都有一个锁（lock）或者叫做监视器（monitor），当访问某个对象的synchronized方法时，表示将该对象上锁，此时其他任何线程都无法再去访问该synchronized方法了，直到之前的那个线程执行方法完毕后（或者是抛出了异常），那么将该对象的锁释放掉，其他线程才有可能再去访问该synchronized方法。 </p>
<ol>
<li>如果一个对象有多个synchronized方法，某一时刻某个线程已经进入到了某个synchronized方法，那么在该方法没有执行完毕前，其他线程是无法访问该对象的任何synchronized方法的。 </li>
</ol>
<p>3.如果某个synchronized方法是static的，那么当线程访问该方法时，它锁的并不是synchronized方法所在的对象，而是synchronized方法所在的对象所对应的Class对象，因为Java中无论一个类有多少个对象，这些对象会对应唯一一个Class对象，因此当线程分别访问同一个类的两个对象的两个static，synchronized方法时，他们的执行顺序也是顺序的，也就是说一个线程先去执行方法，执行完毕后另一个线程才开始执行。 </p>
<ol>
<li>synchronized块，写法： </li>
</ol>
<p>synchronized(object) </p>
<p>{ </p>
<p>} </p>
<p>表示线程在执行的时候会对object对象上锁。 </p>
<p>5.synchronized方法是一种粗粒度的并发控制，某一时刻，只能有一个线程执行该synchronized方法;synchronized块则是一种细粒度的并发控制，只会将块中的代码同步，位于方法内、synchronized块之外的代码是可以被多个线程同时访问到的。 </p>
<p>同步的线程状态图：</p>
<p><img src="" alt=""></p>
<p><strong>六：wait与notify</strong></p>
<p>1.wait与notify方法都是定义在Object类中，而且是final的，因此会被所有的Java类所继承并且无法重写。这两个方法要求在调用时线程应该已经获得了对象的锁，因此对这两个方法的调用需要放在synchronized方法或块当中。当线程执行了wait方法时，它会释放掉对象的锁。 </p>
<ol>
<li>另一个会导致线程暂停的方法就是Thread类的sleep方法，它会导致线程睡眠指定的毫秒数，但线程在睡眠的过程中是不会释放掉对象的锁的。 </li>
</ol>
<p>3.notify():唤醒在此对象监视器上等待的单个线程。如果所有线程都在此对象上等待，则会选择唤醒其中一个线程。选择是任意性的，并在对实现做出决定时发生。线程通过调用其中一个 wait 方法，在对象的监视器上等待。 </p>
<p>直到当前线程放弃此对象上的锁定，才能继续执行被唤醒的线程。被唤醒的线程将以常规方式与在该对象上主动同步的其他所有线程进行竞争；例如，唤醒的线程在作为锁定此对象的下一个线程方面没有可靠的特权或劣势。</p>
<p>此方法只应由作为此对象监视器的所有者的线程来调用。通过以下三种方法之一，线程可以成为此对象监视器的所有者：</p>
<p>o 通过执行此对象的同步实例方法。</p>
<p>o 通过执行在此对象上进行同步的 synchronized 语句的正文。</p>
<p>o 对于 Class 类型的对象，可以通过执行该类的同步静态方法。</p>
<p>一次只能有一个线程拥有对象的监视器。</p>
<p><img src="" alt=""></p>
<p> <strong>关于成员变量与局部变量</strong>：如果一个变量是成员变量，那么多个线程对同一个对象的成员变量进行操作时，他们对该成员变量是彼此影响的（也就是说一个线程对成员变量的改变会影响到另一个线程）。  如果一个变量是局部变量，那么每个线程都会有一个该局部变量的拷贝，一个线程对该局部变量的改变不会影响到其他的线程。</p>
<p><strong>七：死锁的问题： </strong></p>
<p>定义：线程1锁住了对象A的监视器，等待对象B的监视器，线程2锁住了对象B的监视器，等待对象A的监视器，就造成了死锁。</p>
<pre><code> 导致死锁的根源在于不适当地运用“synchronized”关键词来管理线程对特定对象的访问。“synchronized”关键词的作用是，确保在某个时刻只有一个线程被允许执行特定的代码块，因此，被允许执行的线程首先必须拥有对变量或对象的排他性访问权。当线程访问对象时，线程会给对象加锁
</code></pre><p>Java中每个对象都有一把锁与之对应。但Java不提供单独的lock和unlock操作。下面笔者分析死锁的两个过程“上锁”和“锁死” 。</p>
<p>(1) 上锁
     许多线程在执行中必须考虑与其他线程之间共享数据或协调执行状态，就需要同步机制。因此大多数应用程序要求线程互相通信来同步它们的动作，在 Java 程序中最简单实现同步的方法就是上锁。在 Java 编程中，所有的对象都有锁。线程可以使用 synchronized 关键字来获得锁。在任一时刻对于给定的类的实例，方法或同步的代码块只能被一个线程执行。这是因为代码在执行之前要求获得对象的锁。</p>
<pre><code>为了防止同时访问共享资源，线程在使用资源的前后可以给该资源上锁和开锁。给共享变量上锁就使得 Java 线程能够快速方便地通信和同步。某个线程若给一个对象上了锁，就可以知道没有其他线程能够访问该对象。即使在抢占式模型中，其他线程也不能够访问此对象，直到上锁的线程被唤醒、完成工作并开锁。那些试图访问一个上锁对象的线程通常会进入睡眠状态，直到上锁的线程开锁。一旦锁被打开，这些睡眠进程就会被唤醒并移到准备就绪队列中。
</code></pre><p>(2)锁死
     如果程序中有几个竞争资源的并发线程,那么保证均衡是很重要的。系统均衡是指每个线程在执行过程中都能充分访问有限的资源，系统中没有饿死和死锁的线程。当多个并发的线程分别试图同时占有两个锁时，会出现加锁冲突的情形。如果一个线程占有了另一个线程必需的锁，互相等待时被阻塞就有可能出现死锁。</p>
<pre><code>在编写多线程代码时，笔者认为死锁是最难处理的问题之一。因为死锁可能在最意想不到的地方发生，所以查找和修正它既费时又费力。例如，常见的例子如下面这段程序。[print](http://write.blog.csdn.net/postedit#)[?](http://write.blog.csdn.net/postedit#)
</code></pre><p>1 public int sumArrays(int[] a1, int[] a2){  </p>
<p>2   int value = 0;  </p>
<p>3   int size = a1.length;  </p>
<p>4   if (size == a2.length) {  </p>
<p>5      synchronized(a1) { //1        </p>
<p>6        synchronized(a2) { //2          </p>
<p>7          for (int i=0; i&lt;size; i++)  </p>
<p>8             value += a1[i] + a2[i];  </p>
<p>9        }    </p>
<p>10      }    </p>
<p>11   } return value;  </p>
<p>12 }   </p>
<p>这段代码在求和操作中访问两个数组对象之前锁定了这两个数组对象。它形式简短，编写也适合所要执行的任务；但不幸的是，它有一个潜在的问题。这个问题就是它埋下了死锁的种子。</p>
<p><strong>ThreadLocal类（这个类本人没用过，暂时不太懂）</strong></p>
<p>首先，ThreadLocal 不是用来解决共享对象的多线程访问问题的，一般情况下，通过ThreadLocal.set() 到线程中的对象是该线程自己使用的对象，其他线程是不需要访问的，也访问不到的。各个线程中访问的是不同的对象。
另外，说ThreadLocal使得各线程能够保持各自独立的一个对象，并不是通过ThreadLocal.set()来实现的，而是通过每个线程中的new 对象 的操作来创建的对象，每个线程创建一个，不是什么对象的拷贝或副本。通过ThreadLocal.set()将这个新创建的对象的引用保存到各线程的自己的一个map中，每个线程都有这样一个map，执行ThreadLocal.get()时，各线程从自己的map中取出放进去的对象，因此取出来的是各自自己线程中的对象，ThreadLocal实例是作为map的key来使用的。
如果ThreadLocal.set()进去的东西本来就是多个线程共享的同一个对象，那么多个线程的ThreadLocal.get()取得的还是这个共享对象本身，还是有并发访问问题。</p>
<p><strong> 本文来自：曹胜欢博客专栏。转载请注明出处：<a href="http://blog.csdn.net/csh624366188" target="_blank"><a href="http://blog.csdn.net/csh624366188">http://blog.csdn.net/csh624366188</a></a></strong></p>
<p>来源： <a href="[http://blog.csdn.net/csh624366188/article/details/7318245](http://blog.csdn.net/csh624366188/article/details/7318245)">[http://blog.csdn.net/csh624366188/article/details/7318245](http://blog.csdn.net/csh624366188/article/details/7318245)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_多线程/">Java_多线程</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_多线程/" class="label label-success">Java_多线程</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--多线程讲解/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_多线程--多线程讲解" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-jacob--jacob合并几个word文件到一个word文件/">jacob合并几个word文件到一个word文件</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-jacob--jacob合并几个word文件到一个word文件/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="jacob-word-word-">jacob合并几个word文件到一个word文件</h1>
<pre><code> 因项目需要将几个word文件合并到一个word文件，后面附项目运用的jar包jacob-1.9
</code></pre><p>jacob运用中，需要将附件内的jacob.dll放到windows/system32下</p>
<pre><code> 直接上代码：
</code></pre><p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>public static void main(String[] args) {  </li>
<li>List list  = new ArrayList();  </li>
<li>String file1= &quot;D:\file1.doc&quot;;  </li>
<li>String file2= &quot;D:\file2.doc&quot;;  </li>
<li>String file3= &quot;D:\file3.doc&quot;;  </li>
<li>list.add(file1);  </li>
<li>list.add(file2);  </li>
<li>list.add(file3);  </li>
<li>uniteDoc(list,&quot;d:\file.doc&quot;);  </li>
<li>}  </li>
<li>public static void uniteDoc(List fileList, String savepaths) {  </li>
<li>if (fileList.size() == 0 || fileList == null) {  </li>
<li>return;  </li>
<li>}  </li>
<li>//打开word  </li>
<li>ActiveXComponent app = new ActiveXComponent(&quot;Word.Application&quot;);//启动word  </li>
<li>try {  </li>
<li>// 设置word不可见  </li>
<li>app.setProperty(&quot;Visible&quot;, new Variant(false));  </li>
<li>//获得documents对象  </li>
<li>Object docs = app.getProperty(&quot;Documents&quot;).toDispatch();  </li>
<li>//打开第一个文件  </li>
<li>Object doc = Dispatch  </li>
<li>.invoke(  </li>
<li>(Dispatch) docs,  </li>
<li>&quot;Open&quot;,  </li>
<li>Dispatch.Method,  </li>
<li>new Object[] { (String) fileList.get(0),  </li>
<li>new Variant(false), new Variant(true) },  </li>
<li>new int[3]).toDispatch();  </li>
<li>//追加文件  </li>
<li>for (int i = 1; i &lt; fileList.size(); i++) {  </li>
<li>Dispatch.invoke(app.getProperty(&quot;Selection&quot;).toDispatch(),  </li>
<li>&quot;insertFile&quot;, Dispatch.Method, new Object[] {  </li>
<li>(String) fileList.get(i), &quot;&quot;,  </li>
<li>new Variant(false), new Variant(false),  </li>
<li>new Variant(false) }, new int[3]);  </li>
<li>}  </li>
<li>//保存新的word文件  </li>
<li>Dispatch.invoke((Dispatch) doc, &quot;SaveAs&quot;, Dispatch.Method,  </li>
<li>new Object[] { savepaths, new Variant(1) }, new int[3]);  </li>
<li>Variant f = new Variant(false);  </li>
<li>Dispatch.call((Dispatch) doc, &quot;Close&quot;, f);  </li>
<li>} catch (Exception e) {  </li>
<li>throw new RuntimeException(&quot;合并word文件出错.原因:&quot; + e);  </li>
<li>} finally {  </li>
<li>app.invoke(&quot;Quit&quot;, new Variant[] {});  </li>
<li>}  </li>
<li>}  </li>
</ol>
<p>public static void main(String[] args) {</p>
<pre><code>        List list  = new ArrayList();
        String file1= &quot;D:\\file1.doc&quot;;

        String file2= &quot;D:\\file2.doc&quot;;
        String file3= &quot;D:\\file3.doc&quot;;

        list.add(file1);
        list.add(file2);

        list.add(file3);
        uniteDoc(list,&quot;d:\\file.doc&quot;);

}
public static void uniteDoc(List fileList, String savepaths) {

    if (fileList.size() == 0 || fileList == null) {
        return;

    }
    //打开word

    ActiveXComponent app = new ActiveXComponent(&quot;Word.Application&quot;);//启动word
    try {

        // 设置word不可见
        app.setProperty(&quot;Visible&quot;, new Variant(false));

        //获得documents对象
        Object docs = app.getProperty(&quot;Documents&quot;).toDispatch();

        //打开第一个文件
        Object doc = Dispatch

            .invoke(
                    (Dispatch) docs,

                    &quot;Open&quot;,
                    Dispatch.Method,

                    new Object[] { (String) fileList.get(0),
                            new Variant(false), new Variant(true) },

                    new int[3]).toDispatch();
        //追加文件

        for (int i = 1; i &lt; fileList.size(); i++) {
            Dispatch.invoke(app.getProperty(&quot;Selection&quot;).toDispatch(),

                &quot;insertFile&quot;, Dispatch.Method, new Object[] {
                        (String) fileList.get(i), &quot;&quot;,

                        new Variant(false), new Variant(false),
                        new Variant(false) }, new int[3]);

        }
        //保存新的word文件

        Dispatch.invoke((Dispatch) doc, &quot;SaveAs&quot;, Dispatch.Method,
            new Object[] { savepaths, new Variant(1) }, new int[3]);

        Variant f = new Variant(false);
        Dispatch.call((Dispatch) doc, &quot;Close&quot;, f);

    } catch (Exception e) {
        throw new RuntimeException(&quot;合并word文件出错.原因:&quot; + e);

    } finally {
        app.invoke(&quot;Quit&quot;, new Variant[] {});

    }
}
</code></pre>
      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/java-com/">java-com</a></li><li><a href="/categories/Java&J2EE/java-com/jacob/">jacob</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/jacob/" class="label label-success">jacob</a><a href="/tags/java-com/" class="label label-info">java-com</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-java-com-jacob--jacob合并几个word文件到一个word文件/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-java-com-jacob--jacob合并几个word文件到一个word文件" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-jacob--java操作word文档jacob-poi/">java操作word文档(jacob</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-jacob--java操作word文档jacob-poi/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-word-jacob-poi-">java操作word文档(jacob,poi)</h1>
<p>项目需要，用户从系统里面下载word文档，该文档进行了填写限制和加密，用户只能在固定位置填写内容。现要求系统验证上传的附件是否从系统上下载下来的。</p>
<p>思路：系统上面的文档都加入一个固定书签，用户上传文档的时候，检验文档里是否包含这个书签。</p>
<p>采用jacob操作word文档</p>
<p>JACOB（java -com bridge）是一个 JAVA到微软的COM接口的桥梁。使用JACOB允许任何JVM访问COM对象，从而使JAVA应用程序能够调用COM对象。</p>
<p>下载地址：<a href="http://sourceforge.net/projects/jacob-project/" target="_blank"><a href="http://sourceforge.net/projects/jacob-project/">http://sourceforge.net/projects/jacob-project/</a></a></p>
<p>其中jacob-1.16.1-x64.dll 是用于64位机器上的，jacob-1.16.1-x86.dll用于32位的。</p>
<p>该dll放于 C:\Windows\system32 目录下。jacob.jar放于应用lib底下</p>
<p>测试代码
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>ActiveXComponent    word = null;  </li>
<li>try {  </li>
<li>word = new ActiveXComponent(&quot;Word.Application&quot;);  </li>
<li>System.out.println(&quot;jacob当前版本：&quot;+word.getBuildVersion());  </li>
<li>}catch(Exception e ){  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
</ol>
<p>ActiveXComponent    word = null;</p>
<p>try {
        word = new ActiveXComponent(&quot;Word.Application&quot;);</p>
<pre><code>    System.out.println(&quot;jacob当前版本：&quot;+word.getBuildVersion());
</code></pre><p>}catch(Exception e ){</p>
<pre><code>     e.printStackTrace();
</code></pre><p>}</p>
<p>下面再贴出网上常见的代码+自己整理的几个方法（模糊查询书签等）</p>
<p>注意插入书签+书签值的方法，要先插入书签值再选中书签值，之后插入书签。这样根据书签名才能取得书签值。否则根据网络上很多方法，都取不到书签值或者取到空。因为书签值可以是一个点也可以是一大段内容。
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>import java.io.File;  </li>
<li>import java.util.HashMap;  </li>
<li>import java.util.Map;  </li>
<li></li>
<li>import com.gdcn.bpaf.common.helper.StringHelper;  </li>
<li>import com.jacob.activeX.ActiveXComponent;  </li>
<li>import com.jacob.com.ComThread;  </li>
<li>import com.jacob.com.Dispatch;  </li>
<li>import com.jacob.com.Variant;  </li>
<li>//<em>/</em> </li>
<li>/<em>  /</em> </li>
<li>/* <p>Description: {jacob操作word类}    </p> </li>
<li>/* </li>
<li>/* <p>Copyright: Copyright (c) 2011</p> </li>
<li>/*  </li>
<li>/* <p>CreateDate: 2012-6-28</p> </li>
<li>/* </li>
<li>/* @author Beny </li>
<li>/* @version 1.0 </li>
<li>/*/  </li>
<li></li>
<li>public class JacobHelper {  </li>
<li>// word文档  </li>
<li>private Dispatch doc;  </li>
<li></li>
<li>// word运行程序对象  </li>
<li>private ActiveXComponent word;  </li>
<li></li>
<li>// 所有word文档集合  </li>
<li>private Dispatch documents;  </li>
<li></li>
<li>// 选定的范围或插入点  </li>
<li>private Dispatch selection;  </li>
<li></li>
<li>private boolean saveOnExit = true;  </li>
<li></li>
<li>public JacobHelper(boolean visible) throws Exception {  </li>
<li>ComThread.InitSTA();//线程启动  </li>
<li>if (word == null) {  </li>
<li>word = new ActiveXComponent(&quot;Word.Application&quot;);  </li>
<li>word.setProperty(&quot;Visible&quot;, new Variant(visible)); // 不可见打开word  </li>
<li>word.setProperty(&quot;AutomationSecurity&quot;, new Variant(3)); // 禁用宏  </li>
<li>}  </li>
<li>if (documents == null)  </li>
<li>documents = word.getProperty(&quot;Documents&quot;).toDispatch();  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 设置退出时参数 </li>
<li>/*  </li>
<li>/* @param saveOnExit </li>
<li>/*            boolean true-退出时保存文件，false-退出时不保存文件 </li>
<li>/*/  </li>
<li>public void setSaveOnExit(boolean saveOnExit) {  </li>
<li>this.saveOnExit = saveOnExit;  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 创建一个新的word文档 </li>
<li>/*  </li>
<li>/*/  </li>
<li>public void createNewDocument() {  </li>
<li>doc = Dispatch.call(documents, &quot;Add&quot;).toDispatch();  </li>
<li>selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 打开一个已存在的文档 </li>
<li>/*  </li>
<li>/* @param docPath </li>
<li>/*/  </li>
<li>public void openDocument(String docPath) {  </li>
<li>//      closeDocument();  </li>
<li>doc = Dispatch.call(documents, &quot;Open&quot;, docPath).toDispatch();  </li>
<li>selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 只读方式打开一个加密的文档 </li>
<li>/*  </li>
<li>/* @param docPath-文件全名 </li>
<li>/* @param pwd-密码 </li>
<li>/*/  </li>
<li>public void openDocumentOnlyRead(String docPath, String pwd)  </li>
<li>throws Exception {  </li>
<li>//      closeDocument();  </li>
<li>doc = Dispatch.callN(  </li>
<li>documents,  </li>
<li>&quot;Open&quot;,  </li>
<li>new Object[] { docPath, new Variant(false), new Variant(true),  </li>
<li>new Variant(true), pwd, &quot;&quot;, new Variant(false) })  </li>
<li>.toDispatch();  </li>
<li>selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();  </li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 打开一个加密的文档 </li>
<li>/* @param docPath </li>
<li>/* @param pwd </li>
<li>/* @throws Exception </li>
<li>/*/  </li>
<li>public void openDocument(String docPath, String pwd) throws Exception {  </li>
<li>//      closeDocument();  </li>
<li>doc = Dispatch.callN(  </li>
<li>documents,  </li>
<li>&quot;Open&quot;,  </li>
<li>new Object[] { docPath, new Variant(false), new Variant(false),  </li>
<li>new Variant(true), pwd }).toDispatch();  </li>
<li>selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 从选定内容或插入点开始查找文本 </li>
<li>/*  </li>
<li>/* @param toFindText </li>
<li>/*            要查找的文本 </li>
<li>/* @return boolean true-查找到并选中该文本，false-未查找到文本 </li>
<li>/*/  </li>
<li>@SuppressWarnings(&quot;static-access&quot;)  </li>
<li>public boolean find(String toFindText) {  </li>
<li>if (toFindText == null || toFindText.equals(&quot;&quot;))  </li>
<li>return false;  </li>
<li>// 从selection所在位置开始查询  </li>
<li>Dispatch find = word.call(selection, &quot;Find&quot;).toDispatch();  </li>
<li>// 设置要查找的内容  </li>
<li>Dispatch.put(find, &quot;Text&quot;, toFindText);  </li>
<li>// 向前查找  </li>
<li>Dispatch.put(find, &quot;Forward&quot;, &quot;True&quot;);  </li>
<li>// 设置格式  </li>
<li>Dispatch.put(find, &quot;Format&quot;, &quot;True&quot;);  </li>
<li>// 大小写匹配  </li>
<li>Dispatch.put(find, &quot;MatchCase&quot;, &quot;True&quot;);  </li>
<li>// 全字匹配  </li>
<li>Dispatch.put(find, &quot;MatchWholeWord&quot;, &quot;false&quot;);  </li>
<li>// 查找并选中  </li>
<li>return Dispatch.call(find, &quot;Execute&quot;).getBoolean();  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 把选定选定内容设定为替换文本 </li>
<li>/*  </li>
<li>/* @param toFindText </li>
<li>/*            查找字符串 </li>
<li>/* @param newText </li>
<li>/*            要替换的内容 </li>
<li>/* @return </li>
<li>/*/  </li>
<li>public boolean replaceText(String toFindText, String newText) {  </li>
<li>if (!find(toFindText))  </li>
<li>return false;  </li>
<li>Dispatch.put(selection, &quot;Text&quot;, newText);  </li>
<li>return true;  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 全局替换文本 </li>
<li>/*  </li>
<li>/* @param toFindText </li>
<li>/*            查找字符串 </li>
<li>/* @param newText </li>
<li>/*            要替换的内容 </li>
<li>/*/  </li>
<li>public void replaceAllText(String toFindText, String newText) {  </li>
<li>while (find(toFindText)) {  </li>
<li>Dispatch.put(selection, &quot;Text&quot;, newText);  </li>
<li>Dispatch.call(selection, &quot;MoveRight&quot;);  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 在当前插入点插入字符串 </li>
<li>/*  </li>
<li>/* @param newText </li>
<li>/*            要插入的新字符串 </li>
<li>/*/  </li>
<li>public void insertText(String newText) {  </li>
<li>Dispatch.put(selection, &quot;Text&quot;, newText);  </li>
<li>}  </li>
<li></li>
<li></li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 设置当前选定内容的字体 </li>
<li>/*  </li>
<li>/* @param boldSize </li>
<li>/* @param italicSize </li>
<li>/* @param underLineSize </li>
<li>/*            下划线 </li>
<li>/* @param colorSize </li>
<li>/*            字体颜色 </li>
<li>/* @param size </li>
<li>/*            字体大小 </li>
<li>/* @param name </li>
<li>/*            字体名称 </li>
<li>/* @param hidden </li>
<li>/*            是否隐藏 </li>
<li>/*/  </li>
<li>public void setFont(boolean bold, boolean italic, boolean underLine,  </li>
<li>String colorSize, String size, String name,boolean hidden) {  </li>
<li>Dispatch font = Dispatch.get(selection, &quot;Font&quot;).toDispatch();  </li>
<li>Dispatch.put(font, &quot;Name&quot;, new Variant(name));  </li>
<li>Dispatch.put(font, &quot;Bold&quot;, new Variant(bold));  </li>
<li>Dispatch.put(font, &quot;Italic&quot;, new Variant(italic));  </li>
<li>Dispatch.put(font, &quot;Underline&quot;, new Variant(underLine));  </li>
<li>Dispatch.put(font, &quot;Color&quot;, colorSize);  </li>
<li>Dispatch.put(font, &quot;Size&quot;, size);  </li>
<li>Dispatch.put(font, &quot;Hidden&quot;, hidden);  </li>
<li>}  </li>
<li></li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 文件保存或另存为 </li>
<li>/*  </li>
<li>/* @param savePath </li>
<li>/*            保存或另存为路径 </li>
<li>/*/  </li>
<li>public void save(String savePath) {  </li>
<li>Dispatch.call(Dispatch.call(word, &quot;WordBasic&quot;).getDispatch(),  </li>
<li>&quot;FileSaveAs&quot;, savePath);  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 文件保存为html格式 </li>
<li>/*  </li>
<li>/* @param savePath </li>
<li>/* @param htmlPath </li>
<li>/*/  </li>
<li>public void saveAsHtml(String htmlPath) {  </li>
<li>Dispatch.invoke(doc, &quot;SaveAs&quot;, Dispatch.Method, new Object[] {  </li>
<li>htmlPath, new Variant(8) }, new int[1]);  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 关闭文档 </li>
<li>/*  </li>
<li>/* @param val </li>
<li>/*            0不保存修改 -1 保存修改 -2 提示是否保存修改 </li>
<li>/*/  </li>
<li>public void closeDocument(int val) {  </li>
<li>Dispatch.call(doc, &quot;Close&quot;, new Variant(val));//注 是documents而不是doc  </li>
<li>documents = null;  </li>
<li>doc = null;  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 关闭当前word文档 </li>
<li>/*  </li>
<li>/*/  </li>
<li>public void closeDocument() {  </li>
<li>if (documents != null) {  </li>
<li>Dispatch.call(documents, &quot;Save&quot;);  </li>
<li>Dispatch.call(documents, &quot;Close&quot;, new Variant(saveOnExit));  </li>
<li>documents = null;  </li>
<li>doc = null;  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>public void closeDocumentWithoutSave() {  </li>
<li>if (documents != null) {  </li>
<li>Dispatch.call(documents, &quot;Close&quot;, new Variant(false));  </li>
<li>documents = null;  </li>
<li>doc = null;  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 保存并关闭全部应用 </li>
<li>/*  </li>
<li>/*/  </li>
<li>public void close() {  </li>
<li>closeDocument(-1);  </li>
<li>if (word != null) {  </li>
<li>//          Dispatch.call(word, &quot;Quit&quot;);  </li>
<li>word.invoke(&quot;Quit&quot;, new Variant[] {});  </li>
<li>word = null;  </li>
<li>}  </li>
<li>selection = null;  </li>
<li>documents = null;  </li>
<li>ComThread.Release();//释放com线程。根据jacob的帮助文档，com的线程回收不由java的垃圾回收器处理  </li>
<li></li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 打印当前word文档 </li>
<li>/*  </li>
<li>/*/  </li>
<li>public void printFile() {  </li>
<li>if (doc != null) {  </li>
<li>Dispatch.call(doc, &quot;PrintOut&quot;);  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 保护当前档,如果不存在, 使用expression.Protect(Type, NoReset, Password) </li>
<li>/*  </li>
<li>/* @param pwd </li>
<li>/* @param type </li>
<li>/*            WdProtectionType 常量之一(int 类型，只读)： </li>
<li>/*            1-wdAllowOnlyComments  仅批注 </li>
<li>/*            2-wdAllowOnlyFormFields 仅填写窗体 </li>
<li>/*            0-wdAllowOnlyRevisions 仅修订 </li>
<li>/*            -1-wdNoProtection 无保护,  </li>
<li>/*            3-wdAllowOnlyReading 只读 </li>
<li>/*  </li>
<li>/*/  </li>
<li>public void protectedWord(String pwd,String type) {  </li>
<li>String protectionType = Dispatch.get(doc, &quot;ProtectionType&quot;).toString();  </li>
<li>if (protectionType.equals(&quot;-1&quot;)) {  </li>
<li>Dispatch.call(doc, &quot;Protect&quot;, Integer.parseInt(type), new Variant(true),pwd);  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 解除文档保护,如果存在 </li>
<li>/*  </li>
<li>/* @param pwd </li>
<li>/*            WdProtectionType 常量之一(int 类型，只读)： </li>
<li>/*            1-wdAllowOnlyComments  仅批注 </li>
<li>/*            2-wdAllowOnlyFormFields 仅填写窗体 </li>
<li>/*            0-wdAllowOnlyRevisions 仅修订 </li>
<li>/*            -1-wdNoProtection 无保护,  </li>
<li>/*            3-wdAllowOnlyReading 只读 </li>
<li>/*  </li>
<li>/*/  </li>
<li>public void unProtectedWord(String pwd) {  </li>
<li>String protectionType = Dispatch.get(doc, &quot;ProtectionType&quot;).toString();  </li>
<li>if (!protectionType.equals(&quot;0&quot;)&amp;&amp;!protectionType.equals(&quot;-1&quot;)) {  </li>
<li>Dispatch.call(doc, &quot;Unprotect&quot;, pwd);  </li>
<li>}  </li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 返回文档的保护类型 </li>
<li>/* @return </li>
<li>/*/  </li>
<li>public String getProtectedType(){  </li>
<li>return Dispatch.get(doc, &quot;ProtectionType&quot;).toString();  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 设置word文档安全级别 </li>
<li>/*  </li>
<li>/* @param value </li>
<li>/*            1-msoAutomationSecurityByUI 使用“安全”对话框指定的安全设置。 </li>
<li>/*            2-msoAutomationSecurityForceDisable </li>
<li>/*            在程序打开的所有文件中禁用所有宏，而不显示任何安全提醒。 3-msoAutomationSecurityLow </li>
<li>/*            启用所有宏，这是启动应用程序时的默认值。 </li>
<li>/*/  </li>
<li>public void setAutomationSecurity(int value) {  </li>
<li>word.setProperty(&quot;AutomationSecurity&quot;, new Variant(value));  </li>
<li>}  </li>
<li></li>
<li></li>
<li></li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 在word中插入标签 labelName是标签名，labelValue是标签值 </li>
<li>/* @param labelName </li>
<li>/* @param labelValue </li>
<li>/*/  </li>
<li>public  void insertLabelValue(String labelName,String labelValue) {  </li>
<li></li>
<li>Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();  </li>
<li>boolean isExist = Dispatch.call(bookMarks, &quot;Exists&quot;, labelName).getBoolean();  </li>
<li>if (isExist == true) {  </li>
<li>Dispatch rangeItem1 = Dispatch.call(bookMarks, &quot;Item&quot;, labelName).toDispatch();  </li>
<li>Dispatch range1 = Dispatch.call(rangeItem1, &quot;Range&quot;).toDispatch();  </li>
<li>String bookMark1Value = Dispatch.get(range1, &quot;Text&quot;).toString();  </li>
<li>System.out.println(&quot;书签内容：&quot;+bookMark1Value);  </li>
<li>} else {  </li>
<li>System.out.println(&quot;当前书签不存在,重新建立!&quot;);  </li>
<li>//TODO 先插入文字，再查找选中文字，再插入标签  </li>
<li>this.insertText(labelValue);  </li>
<li>//          this.find(labelValue);//查找文字，并选中  </li>
<li>this.setFont(true, true,true,&quot;102,92,38&quot;, &quot;20&quot;, &quot;&quot;,true);  </li>
<li>Dispatch.call(bookMarks, &quot;Add&quot;, labelName, selection);  </li>
<li>Dispatch.call(bookMarks, &quot;Hidden&quot;, labelName);  </li>
<li>}  </li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 在word中插入标签 labelName是标签名 </li>
<li>/* @param labelName </li>
<li>/*/  </li>
<li>public  void insertLabel(String labelName) {  </li>
<li></li>
<li>Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();  </li>
<li>boolean isExist = Dispatch.call(bookMarks, &quot;Exists&quot;, labelName).getBoolean();  </li>
<li>if (isExist == true) {  </li>
<li>System.out.println(&quot;书签已存在&quot;);  </li>
<li>} else {  </li>
<li>System.out.println(&quot;建立书签：&quot;+labelName);  </li>
<li>Dispatch.call(bookMarks, &quot;Add&quot;, labelName, selection);  </li>
<li>}  </li>
<li>}     </li>
<li>//<em>/</em> </li>
<li>/* 查找书签 </li>
<li>/* @param labelName </li>
<li>/* @return </li>
<li>/*/  </li>
<li>public boolean findLabel(String labelName) {  </li>
<li>Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();  </li>
<li>boolean isExist = Dispatch.call(bookMarks, &quot;Exists&quot;, labelName).getBoolean();  </li>
<li>if (isExist == true) {  </li>
<li>return true;  </li>
<li>} else {  </li>
<li>System.out.println(&quot;当前书签不存在!&quot;);  </li>
<li>return false;  </li>
<li>}  </li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 模糊查找书签,并返回准确的书签名称 </li>
<li>/* @param labelName </li>
<li>/* @return </li>
<li>/*/  </li>
<li>public String findLabelLike(String labelName) {  </li>
<li>Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();  </li>
<li>int count = Dispatch.get(bookMarks, &quot;Count&quot;).getInt(); // 书签数  </li>
<li>Dispatch rangeItem = null;  </li>
<li>String lname = &quot;&quot;;  </li>
<li>for(int i=1;i&lt;=count;i++){  </li>
<li>rangeItem = Dispatch.call(bookMarks, &quot;Item&quot;, new Variant(i)).toDispatch();  </li>
<li>lname = Dispatch.call(rangeItem, &quot;Name&quot;).toString();//书签名称  </li>
<li>if(lname.startsWith(labelName)){//前面匹配  </li>
<li>//             return lname.replaceFirst(labelName, &quot;&quot;);//返回后面值  </li>
<li>return lname;  </li>
<li>}  </li>
<li>}  </li>
<li>return &quot;&quot;;  </li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 模糊删除书签 </li>
<li>/* @param labelName </li>
<li>/*/  </li>
<li>public void deleteLableLike(String labelName){  </li>
<li>Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();  </li>
<li>int count = Dispatch.get(bookMarks, &quot;Count&quot;).getInt(); // 书签数  </li>
<li>Dispatch rangeItem = null;  </li>
<li>String lname = &quot;&quot;;  </li>
<li>for(int i=1;i&lt;=count;i++){  </li>
<li>rangeItem = Dispatch.call(bookMarks, &quot;Item&quot;, new Variant(i)).toDispatch();  </li>
<li>lname = Dispatch.call(rangeItem, &quot;Name&quot;).toString();//书签名称  </li>
<li>if(lname.startsWith(labelName)){//前面匹配  </li>
<li>Dispatch.call(rangeItem, &quot;Delete&quot;);  </li>
<li>count--;//书签已被删除，书签数目和当前书签都要相应减1，否则会报错:集合找不到  </li>
<li>i--;  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 获取书签内容 </li>
<li>/* @param labelName </li>
<li>/* @return </li>
<li>/*/  </li>
<li>public String getLableValue(String labelName){  </li>
<li>if(this.findLabel(labelName)){  </li>
<li>Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();  </li>
<li>Dispatch rangeItem1 = Dispatch.call(bookMarks, &quot;Item&quot;, labelName).toDispatch();  </li>
<li>Dispatch range1 = Dispatch.call(rangeItem1, &quot;Range&quot;).toDispatch();  </li>
<li>Dispatch font = Dispatch.get(range1, &quot;Font&quot;).toDispatch();  </li>
<li>Dispatch.put(font, &quot;Hidden&quot;, new Variant(false)); //显示书签内容  </li>
<li>String bookMark1Value = Dispatch.get(range1, &quot;Text&quot;).toString();  </li>
<li>System.out.println(&quot;书签内容：&quot;+bookMark1Value);  </li>
<li>//            font = Dispatch.get(range1, &quot;Font&quot;).toDispatch();  </li>
<li>//              Dispatch.put(font, &quot;Hidden&quot;, new Variant(true)); //隐藏书签内容  </li>
<li>return bookMark1Value;  </li>
<li>}  </li>
<li>return &quot;&quot;;  </li>
<li>}  </li>
<li></li>
<li></li>
<li>public static void main(String[] args) throws Exception {  </li>
<li></li>
<li>}     </li>
<li></li>
<li>}  </li>
</ol>
<p>import java.io.File;</p>
<p>import java.util.HashMap;
import java.util.Map;</p>
<p>import com.gdcn.bpaf.common.helper.StringHelper;</p>
<p>import com.jacob.activeX.ActiveXComponent;
import com.jacob.com.ComThread;</p>
<p>import com.jacob.com.Dispatch;
import com.jacob.com.Variant;</p>
<p>//<em>/</em>
 /<em>  /</em></p>
<p> /<em> <p>Description: {jacob操作word类}    </p>
/</em></p>
<p>/<em> <p>Copyright: Copyright (c) 2011</p>
/</em></p>
<p>/<em> <p>CreateDate: 2012-6-28</p>
/</em></p>
<p>/<em> @author Beny
/</em> @version 1.0</p>
<p>/*/</p>
<p>public class JacobHelper {
    // word文档</p>
<pre><code>private Dispatch doc;


// word运行程序对象
private ActiveXComponent word;


// 所有word文档集合

private Dispatch documents;


// 选定的范围或插入点
private Dispatch selection;


private boolean saveOnExit = true;


public JacobHelper(boolean visible) throws Exception {

    ComThread.InitSTA();//线程启动
    if (word == null) {

        word = new ActiveXComponent(&quot;Word.Application&quot;);
        word.setProperty(&quot;Visible&quot;, new Variant(visible)); // 不可见打开word

        word.setProperty(&quot;AutomationSecurity&quot;, new Variant(3)); // 禁用宏
    }

    if (documents == null)
        documents = word.getProperty(&quot;Documents&quot;).toDispatch();

}


//*/*
 /* 设置退出时参数

 /*
 /* @param saveOnExit

 /*            boolean true-退出时保存文件，false-退出时不保存文件
 /*/

public void setSaveOnExit(boolean saveOnExit) {
    this.saveOnExit = saveOnExit;

}


//*/*
 /* 创建一个新的word文档

 /*
 /*/

public void createNewDocument() {
    doc = Dispatch.call(documents, &quot;Add&quot;).toDispatch();

    selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();
}


//*/*

 /* 打开一个已存在的文档
 /*

 /* @param docPath
 /*/

public void openDocument(String docPath) {
</code></pre><p>//        closeDocument();</p>
<pre><code>    doc = Dispatch.call(documents, &quot;Open&quot;, docPath).toDispatch();
    selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();

}


//*/*
 /* 只读方式打开一个加密的文档

 /*
 /* @param docPath-文件全名

 /* @param pwd-密码
 /*/

public void openDocumentOnlyRead(String docPath, String pwd)
        throws Exception {
</code></pre><p>//        closeDocument();
        doc = Dispatch.callN(</p>
<pre><code>            documents,
            &quot;Open&quot;,

            new Object[] { docPath, new Variant(false), new Variant(true),
                    new Variant(true), pwd, &quot;&quot;, new Variant(false) })

            .toDispatch();
    selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();

}
//*/*

 /* 打开一个加密的文档
 /* @param docPath

 /* @param pwd
 /* @throws Exception

 /*/
public void openDocument(String docPath, String pwd) throws Exception {
</code></pre><p>//        closeDocument();
        doc = Dispatch.callN(</p>
<pre><code>            documents,
            &quot;Open&quot;,

            new Object[] { docPath, new Variant(false), new Variant(false),
                    new Variant(true), pwd }).toDispatch();

    selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();
}


//*/*

 /* 从选定内容或插入点开始查找文本
 /*

 /* @param toFindText
 /*            要查找的文本

 /* @return boolean true-查找到并选中该文本，false-未查找到文本
 /*/

@SuppressWarnings(&quot;static-access&quot;)
public boolean find(String toFindText) {

    if (toFindText == null || toFindText.equals(&quot;&quot;))
        return false;

    // 从selection所在位置开始查询
    Dispatch find = word.call(selection, &quot;Find&quot;).toDispatch();

    // 设置要查找的内容
    Dispatch.put(find, &quot;Text&quot;, toFindText);

    // 向前查找
    Dispatch.put(find, &quot;Forward&quot;, &quot;True&quot;);

    // 设置格式
    Dispatch.put(find, &quot;Format&quot;, &quot;True&quot;);

    // 大小写匹配
    Dispatch.put(find, &quot;MatchCase&quot;, &quot;True&quot;);

    // 全字匹配
    Dispatch.put(find, &quot;MatchWholeWord&quot;, &quot;false&quot;);

    // 查找并选中
    return Dispatch.call(find, &quot;Execute&quot;).getBoolean();

}


//*/*
 /* 把选定选定内容设定为替换文本

 /*
 /* @param toFindText

 /*            查找字符串
 /* @param newText

 /*            要替换的内容
 /* @return

 /*/
public boolean replaceText(String toFindText, String newText) {

    if (!find(toFindText))
        return false;

    Dispatch.put(selection, &quot;Text&quot;, newText);
    return true;

}


//*/*
 /* 全局替换文本

 /*
 /* @param toFindText

 /*            查找字符串
 /* @param newText

 /*            要替换的内容
 /*/

public void replaceAllText(String toFindText, String newText) {
    while (find(toFindText)) {

        Dispatch.put(selection, &quot;Text&quot;, newText);
        Dispatch.call(selection, &quot;MoveRight&quot;);

    }
}


//*/*

 /* 在当前插入点插入字符串
 /*

 /* @param newText
 /*            要插入的新字符串

 /*/
public void insertText(String newText) {

    Dispatch.put(selection, &quot;Text&quot;, newText);
}





//*/*

 /* 设置当前选定内容的字体
 /*

 /* @param boldSize
 /* @param italicSize

 /* @param underLineSize
 /*            下划线

 /* @param colorSize
 /*            字体颜色

 /* @param size
 /*            字体大小

 /* @param name
 /*            字体名称

 /* @param hidden
 /*            是否隐藏

 /*/
public void setFont(boolean bold, boolean italic, boolean underLine,

        String colorSize, String size, String name,boolean hidden) {
    Dispatch font = Dispatch.get(selection, &quot;Font&quot;).toDispatch();

    Dispatch.put(font, &quot;Name&quot;, new Variant(name));
    Dispatch.put(font, &quot;Bold&quot;, new Variant(bold));

    Dispatch.put(font, &quot;Italic&quot;, new Variant(italic));
    Dispatch.put(font, &quot;Underline&quot;, new Variant(underLine));

    Dispatch.put(font, &quot;Color&quot;, colorSize);
    Dispatch.put(font, &quot;Size&quot;, size);

    Dispatch.put(font, &quot;Hidden&quot;, hidden);
}




//*/*
 /* 文件保存或另存为

 /*
 /* @param savePath

 /*            保存或另存为路径
 /*/

public void save(String savePath) {
    Dispatch.call(Dispatch.call(word, &quot;WordBasic&quot;).getDispatch(),

            &quot;FileSaveAs&quot;, savePath);
}


//*/*

 /* 文件保存为html格式
 /*

 /* @param savePath
 /* @param htmlPath

 /*/
public void saveAsHtml(String htmlPath) {

    Dispatch.invoke(doc, &quot;SaveAs&quot;, Dispatch.Method, new Object[] {
            htmlPath, new Variant(8) }, new int[1]);

}


//*/*
 /* 关闭文档

 /*
 /* @param val

 /*            0不保存修改 -1 保存修改 -2 提示是否保存修改
 /*/

public void closeDocument(int val) {
    Dispatch.call(doc, &quot;Close&quot;, new Variant(val));//注 是documents而不是doc

    documents = null;
    doc = null;

}


//*/*
 /* 关闭当前word文档

 /*
 /*/

public void closeDocument() {
    if (documents != null) {

        Dispatch.call(documents, &quot;Save&quot;);
        Dispatch.call(documents, &quot;Close&quot;, new Variant(saveOnExit));

        documents = null;
        doc = null;

    }
}


public void closeDocumentWithoutSave() {

    if (documents != null) {
        Dispatch.call(documents, &quot;Close&quot;, new Variant(false));

        documents = null;
        doc = null;

    }
}


//*/*

 /* 保存并关闭全部应用
 /*

 /*/
public void close() {

    closeDocument(-1);
    if (word != null) {
</code></pre><p>//            Dispatch.call(word, &quot;Quit&quot;);
            word.invoke(&quot;Quit&quot;, new Variant[] {});</p>
<pre><code>        word = null;
    }

    selection = null;
    documents = null;

    ComThread.Release();//释放com线程。根据jacob的帮助文档，com的线程回收不由java的垃圾回收器处理


}
//*/*

 /* 打印当前word文档
 /*

 /*/
public void printFile() {

    if (doc != null) {
        Dispatch.call(doc, &quot;PrintOut&quot;);

    }
}


//*/*

 /* 保护当前档,如果不存在, 使用expression.Protect(Type, NoReset, Password)
 /*

 /* @param pwd
 /* @param type

 /*            WdProtectionType 常量之一(int 类型，只读)：
 /*            1-wdAllowOnlyComments  仅批注

 /*            2-wdAllowOnlyFormFields 仅填写窗体
 /*            0-wdAllowOnlyRevisions 仅修订

 /*            -1-wdNoProtection 无保护,
 /*            3-wdAllowOnlyReading 只读

 /*
 /*/

public void protectedWord(String pwd,String type) {
    String protectionType = Dispatch.get(doc, &quot;ProtectionType&quot;).toString();

    if (protectionType.equals(&quot;-1&quot;)) {
        Dispatch.call(doc, &quot;Protect&quot;, Integer.parseInt(type), new Variant(true),pwd);

    }
}


//*/*

 /* 解除文档保护,如果存在
 /*

 /* @param pwd
 /*            WdProtectionType 常量之一(int 类型，只读)：

 /*            1-wdAllowOnlyComments  仅批注
 /*            2-wdAllowOnlyFormFields 仅填写窗体

 /*            0-wdAllowOnlyRevisions 仅修订
 /*            -1-wdNoProtection 无保护,

 /*            3-wdAllowOnlyReading 只读
 /*

 /*/
public void unProtectedWord(String pwd) {

    String protectionType = Dispatch.get(doc, &quot;ProtectionType&quot;).toString();
    if (!protectionType.equals(&quot;0&quot;)&amp;&amp;!protectionType.equals(&quot;-1&quot;)) {

        Dispatch.call(doc, &quot;Unprotect&quot;, pwd);
    }

}
//*/*

 /* 返回文档的保护类型
 /* @return

 /*/
public String getProtectedType(){

    return Dispatch.get(doc, &quot;ProtectionType&quot;).toString();
}


//*/*

 /* 设置word文档安全级别
 /*

 /* @param value
 /*            1-msoAutomationSecurityByUI 使用“安全”对话框指定的安全设置。

 /*            2-msoAutomationSecurityForceDisable
 /*            在程序打开的所有文件中禁用所有宏，而不显示任何安全提醒。 3-msoAutomationSecurityLow

 /*            启用所有宏，这是启动应用程序时的默认值。
 /*/

public void setAutomationSecurity(int value) {
    word.setProperty(&quot;AutomationSecurity&quot;, new Variant(value));

}






//*/*

 /* 在word中插入标签 labelName是标签名，labelValue是标签值
 /* @param labelName

 /* @param labelValue
 /*/

public  void insertLabelValue(String labelName,String labelValue) {


   Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();
   boolean isExist = Dispatch.call(bookMarks, &quot;Exists&quot;, labelName).getBoolean();

    if (isExist == true) {
        Dispatch rangeItem1 = Dispatch.call(bookMarks, &quot;Item&quot;, labelName).toDispatch();

        Dispatch range1 = Dispatch.call(rangeItem1, &quot;Range&quot;).toDispatch();
        String bookMark1Value = Dispatch.get(range1, &quot;Text&quot;).toString();

          System.out.println(&quot;书签内容：&quot;+bookMark1Value);
    } else {

        System.out.println(&quot;当前书签不存在,重新建立!&quot;);
        //TODO 先插入文字，再查找选中文字，再插入标签

        this.insertText(labelValue);
</code></pre><p>//            this.find(labelValue);//查找文字，并选中</p>
<pre><code>        this.setFont(true, true,true,&quot;102,92,38&quot;, &quot;20&quot;, &quot;&quot;,true);
         Dispatch.call(bookMarks, &quot;Add&quot;, labelName, selection);

         Dispatch.call(bookMarks, &quot;Hidden&quot;, labelName);
    }

}
//*/*

 /* 在word中插入标签 labelName是标签名
 /* @param labelName

 /*/
public  void insertLabel(String labelName) {


   Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();

   boolean isExist = Dispatch.call(bookMarks, &quot;Exists&quot;, labelName).getBoolean();
    if (isExist == true) {

          System.out.println(&quot;书签已存在&quot;);
    } else {

        System.out.println(&quot;建立书签：&quot;+labelName);
         Dispatch.call(bookMarks, &quot;Add&quot;, labelName, selection);

    }
}   

//*/*
 /* 查找书签

 /* @param labelName
 /* @return

 /*/
public boolean findLabel(String labelName) {

   Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();
   boolean isExist = Dispatch.call(bookMarks, &quot;Exists&quot;, labelName).getBoolean();

   if (isExist == true) {
          return true;

    } else {
        System.out.println(&quot;当前书签不存在!&quot;);

        return false;
    }

}
//*/*

 /* 模糊查找书签,并返回准确的书签名称
 /* @param labelName

 /* @return
 /*/

public String findLabelLike(String labelName) {
   Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();

   int count = Dispatch.get(bookMarks, &quot;Count&quot;).getInt(); // 书签数
   Dispatch rangeItem = null;

   String lname = &quot;&quot;;
   for(int i=1;i&lt;=count;i++){

       rangeItem = Dispatch.call(bookMarks, &quot;Item&quot;, new Variant(i)).toDispatch();
       lname = Dispatch.call(rangeItem, &quot;Name&quot;).toString();//书签名称

       if(lname.startsWith(labelName)){//前面匹配
</code></pre><p>//               return lname.replaceFirst(labelName, &quot;&quot;);//返回后面值</p>
<pre><code>           return lname;
       }

   }
   return &quot;&quot;;

}
//*/*

 /* 模糊删除书签
 /* @param labelName

 /*/
public void deleteLableLike(String labelName){

    Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();
   int count = Dispatch.get(bookMarks, &quot;Count&quot;).getInt(); // 书签数

   Dispatch rangeItem = null;
   String lname = &quot;&quot;;

   for(int i=1;i&lt;=count;i++){
       rangeItem = Dispatch.call(bookMarks, &quot;Item&quot;, new Variant(i)).toDispatch();

       lname = Dispatch.call(rangeItem, &quot;Name&quot;).toString();//书签名称
       if(lname.startsWith(labelName)){//前面匹配

           Dispatch.call(rangeItem, &quot;Delete&quot;);
           count--;//书签已被删除，书签数目和当前书签都要相应减1，否则会报错:集合找不到

           i--;
       }

   }
}

//*/*
 /* 获取书签内容

 /* @param labelName
 /* @return

 /*/
public String getLableValue(String labelName){

    if(this.findLabel(labelName)){
        Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();

        Dispatch rangeItem1 = Dispatch.call(bookMarks, &quot;Item&quot;, labelName).toDispatch();
        Dispatch range1 = Dispatch.call(rangeItem1, &quot;Range&quot;).toDispatch();

        Dispatch font = Dispatch.get(range1, &quot;Font&quot;).toDispatch();
        Dispatch.put(font, &quot;Hidden&quot;, new Variant(false)); //显示书签内容

        String bookMark1Value = Dispatch.get(range1, &quot;Text&quot;).toString();
          System.out.println(&quot;书签内容：&quot;+bookMark1Value);
</code></pre><p>//            font = Dispatch.get(range1, &quot;Font&quot;).toDispatch();
//              Dispatch.put(font, &quot;Hidden&quot;, new Variant(true)); //隐藏书签内容</p>
<pre><code>          return bookMark1Value;
    }

    return &quot;&quot;;
}




public static void main(String[] args) throws Exception {


}   
</code></pre><p>}</p>
<p> 采用jacob方式操作文档，经常会出现卡机的现象，所以最后采用poi方式来操作书签。若单纯的操作书签用poi方式还是比较简单的，但要操作表格、文档格式之类的还是用jacob功能比较强大。
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>InputStream input = null;  </li>
<li>File docFile = new File( fileName );  </li>
<li>HWPFDocument document = null;  </li>
<li>try{  </li>
<li>input = new FileInputStream(docFile);//加载 doc 文档  </li>
<li>document = new HWPFDocument(input);//文件流方式创建hwpf  </li>
<li>Bookmarks bookmarks =  document.getBookmarks();//文档书签  </li>
<li>for(int i=0,length=bookmarks.getBookmarksCount();i&lt;length;i++){  </li>
<li>bookmarkName = bookmarks.getBookmark(i).getName();  </li>
<li>//.....  </li>
<li>}  </li>
<li></li>
<li>}catch( Exception e){  </li>
<li></li>
<li>}finally{  </li>
<li>if( null != input )  </li>
<li>input.close();  </li>
<li>}  </li>
</ol>
<p>InputStream input = null;</p>
<p>File docFile = new File( fileName );
HWPFDocument document = null;</p>
<p>try{
    input = new FileInputStream(docFile);//加载 doc 文档</p>
<pre><code>document = new HWPFDocument(input);//文件流方式创建hwpf
Bookmarks bookmarks =  document.getBookmarks();//文档书签

for(int i=0,length=bookmarks.getBookmarksCount();i&lt;length;i++){
    bookmarkName = bookmarks.getBookmark(i).getName();

    //.....
}
</code></pre><p>}catch( Exception e){</p>
<p>}finally{</p>
<pre><code>if( null != input )
        input.close();
</code></pre><p>}</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/java-com/">java-com</a></li><li><a href="/categories/Java&J2EE/java-com/jacob/">jacob</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/jacob/" class="label label-success">jacob</a><a href="/tags/java-com/" class="label label-info">java-com</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-java-com-jacob--java操作word文档jacob-poi/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-java-com-jacob--java操作word文档jacob-poi" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区/">100</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="100-java-windows-wmi-">100%纯java调用windows的wmi获取监控数据 - 肖国颖的个人页面 - 开源中国社区</h1>
<p><a href="http://www.oschina.net/" title="开源中国社区首页" target="_blank">开源中国社区</a></p>
<p>开源项目发现、使用和交流平台</p>
<ul>
<li><a href="http://www.oschina.net/project" target="_blank">项目</a></li>
<li><a href="http://www.oschina.net/question" target="_blank">讨论</a></li>
<li><a href="http://www.oschina.net/code/list" target="_blank">代码</a></li>
<li><a href="http://www.oschina.net/news" target="_blank">资讯</a></li>
<li><a href="http://www.oschina.net/translate" target="_blank">翻译</a></li>
<li><a href="http://www.oschina.net/blog" target="_blank">博客</a></li>
<li><a href="http://www.oschina.net/android" target="_blank">Android</a></li>
<li><a href="http://www.oschina.net/job" target="_blank">招聘</a></li>
</ul>
<p>当前访客身份： arctichia [ <a href="http://my.oschina.net/arcichia" target="_blank">我的空间</a> | <a href="http://my.oschina.net/action/user/logout?session=9c386f172b1174553110&amp;goto_page=http%3A%2F%2Fmy.oschina.net%2Fnoahxiao" target="_blank">退出</a> ]  <a href="http://my.oschina.net/arcichia/admin/inbox" title="进入我的留言箱" target="_blank">你有<em>0</em>新留言</a></p>
<p>软件 代码 讨论区 新闻 博客</p>
<p>软件</p>
<ul>
<li><a href="">软件</a></li>
<li><a href="">代码</a></li>
<li><a href="">讨论区</a></li>
<li><a href="">新闻</a></li>
<li><a href="">博客</a>
<a href="http://my.oschina.net/noahxiao" target="_blank"><img src="&quot;肖国颖&quot;" alt="肖国颖"></a>  <a href="http://my.oschina.net/noahxiao" title="男" target="_blank">肖国颖</a>  <img src="&quot;男&quot;" alt=""> <a href="&quot;成为TA的粉丝&quot;">关注此人</a></li>
</ul>
<p><a href="http://my.oschina.net/noahxiao/fellow" target="_blank">关注(4)</a> <a href="http://my.oschina.net/noahxiao/fans" target="_blank">粉丝(71)</a> <a href="http://www.oschina.net/question/3307_20931" title="查看OSCHINA积分规则" target="_blank">积分(280)</a></p>
<p>不做鬼中鬼，怎做人上人
<a href="">.发送留言</a> <a href="http://www.oschina.net/question/ask?user=569848" target="_blank">.请教问题</a></p>
<p><strong>博客分类</strong></p>
<ul>
<li><a href="http://my.oschina.net/noahxiao/blog?catalog=186739" target="_blank">工作日志</a>(47)</li>
<li><a href="http://my.oschina.net/noahxiao/blog?catalog=186740" target="_blank">日常记录</a>(0)</li>
<li><a href="http://my.oschina.net/noahxiao/blog?catalog=186741" target="_blank">转贴的文章</a>(0)
<strong>阅读排行</strong></li>
</ul>
<ol>
<li><a href="http://my.oschina.net/noahxiao/blog/61987" target="_blank">1. 在Android中嵌入AdMob广告，赚午饭钱</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/86328" target="_blank">2. 解决iOS6看YouTb的心酸，补充可看版(goagent+opendoor)</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/126357" target="_blank">3. 当单例（Singleton）爱上多线程——重复初始化问题</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/112759" target="_blank">4. Java序列化与JSON序列化大比拼</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/61495" target="_blank">5. 在Eclipse中用Scala语言开发Android应用</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/88687" target="_blank">6. Ubuntu 12.10下用Empathy（pidgin-lwqq）登录QQ</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/65071" target="_blank">7. 解决Ubuntu 12.04下频繁死机-Chrome</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/140771" target="_blank">8. 以Jar形式为Web项目提供资源文件（JS、CSS与图片）</a></li>
</ol>
<p><strong>最新评论</strong></p>
<ul>
<li><a href="http://my.oschina.net/wenshao" target="_blank">@wenshao</a>：fastjson缺省是做循环引用检测的，你关掉这个再测... <a href="http://my.oschina.net/action/tweet/go?obj=274988152&amp;type=18&amp;user=127152" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/wenshao" target="_blank">@wenshao</a>：这个测试不对，你直接测试JavaBean而不是Map看看... <a href="http://my.oschina.net/action/tweet/go?obj=274988031&amp;type=18&amp;user=127152" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/u/1182868" target="_blank">@rrstpit</a>：Fffff <a href="http://my.oschina.net/action/tweet/go?obj=274896306&amp;type=18&amp;user=1182868" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/fxl" target="_blank">@付学良</a>：引用来自“xautlx”的评论 Servlet3规范好像已经... <a href="http://my.oschina.net/action/tweet/go?obj=274529269&amp;type=18&amp;user=83617" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/112358" target="_blank">@yezheng1993</a>：引用来自“肖国颖”的评论 引用来自“yezheng19... <a href="http://my.oschina.net/action/tweet/go?obj=274481572&amp;type=18&amp;user=1173735" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/noahxiao" target="_blank">@肖国颖</a>：引用来自“yezheng1993”的评论 请问一下怎么在那... <a href="http://my.oschina.net/action/tweet/go?obj=274479348&amp;type=18&amp;user=569848" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/112358" target="_blank">@yezheng1993</a>：请问一下怎么在那边创建文件以及文件夹，新手，还... <a href="http://my.oschina.net/action/tweet/go?obj=274477519&amp;type=18&amp;user=1173735" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/u/151176" target="_blank">@xautlx</a>：Servlet3规范好像已经有标准支持：<a href="https://blogs" target="_blank">https://blogs</a>... <a href="http://my.oschina.net/action/tweet/go?obj=274464191&amp;type=18&amp;user=151176" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/u/613918" target="_blank">@ahnan</a>：www.webjars.org <a href="http://my.oschina.net/action/tweet/go?obj=274462857&amp;type=18&amp;user=613918" target="_blank">查看»</a></li>
<li><p><a href="http://my.oschina.net/wj2699" target="_blank">@wj2699</a>：spring的mvc确实有这么个功能，但是如果和apach... <a href="http://my.oschina.net/action/tweet/go?obj=274461745&amp;type=18&amp;user=106294" target="_blank">查看»</a>
<strong>访客统计</strong></p>
</li>
<li><p>今日访问：26</p>
</li>
<li>昨日访问：148</li>
<li>本周访问：389</li>
<li>本月访问：1573</li>
<li>所有访问：52224</li>
</ul>
<p><a href="http://my.oschina.net/noahxiao" target="_blank">空间</a> » <a href="http://my.oschina.net/noahxiao/blog" target="_blank">博客</a> » <a href="http://my.oschina.net/noahxiao/blog?catalog=186739" target="_blank">工作日志</a> » 博客正文</p>
<h1 id="-100-java-windows-wmi-"><img src="" alt=""> 100%纯java调用windows的wmi获取监控数据</h1>
<p><em>23</em>人收藏此文章,  <a href="&quot;添加到收藏夹&quot;">我要收藏</a>   发表于12个月前(2012-08-16 18:17) , 已有<strong>2348</strong>次阅读 ，共<strong><a href="">5</a></strong>个评论</p>
<p>纯java主要体现在可以跨平台调用com。所用的是j-Interop，它是100%纯java实现的com的调用</p>
<h3 id="1-">1、环境准备</h3>
<p>a、windows要开启Remote Registry与Windows Management Instrumentation服务</p>
<p>b、修改安全策略</p>
<p>我系统是英文的，如果是中文系统，翻译为中文，相对应的查找并修改。</p>
<p>Administrative Tools&gt;Local Security Policy&gt;Local Policy&gt;Security Policy&gt;Network access: Sharing and security model for local accounts</p>
<p>修改为Classic（经典）</p>
<p>c、禁用放火墙</p>
<p>d、window2008系统注册表越狱（高版本的win）</p>
<p>需要修改regedit中HKEY_CLASSES_ROOT\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}的权限，windows2008不再给Administrators完全控制权。</p>
<p>下载SetACL.exe，下载地址：<a href="http://files.helgeklein.com/downloads/SetACL/current/SetACL%20(executable%20version).zip" target="_blank">http://files.helgeklein.com/downloads/SetACL/current/SetACL%20(executable%20version).zip</a></p>
<p>set_wmi_reg_acl.cmd</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>1</p>
<p>SetACL.exe -on</p>
<p>&quot;HKEY_CLASSES_ROOT\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}&quot;</p>
<p>-ot reg -actn setowner -ownr</p>
<p>&quot;n:Administrators&quot;</p>
<p>2</p>
<p>SetACL.exe -on</p>
<p>&quot;HKEY_CLASSES_ROOT\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}&quot;</p>
<p>-ot reg -actn ace -ace</p>
<p>&quot;n:Administrators;p:full&quot;</p>
<p>以超级管理员身份执行这个cms，就会把owner与完全控制权限授予Administrators组</p>
<h2 id="-">#</h2>
<h3 id="2-">2、程序代码</h3>
<p>java类</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>001</p>
<p>package</p>
<p>org.noah.wmitest;</p>
<p>002</p>
<p>003</p>
<p>import</p>
<p>org.jinterop.dcom.common.JIException;</p>
<p>004</p>
<p>import</p>
<p>org.jinterop.dcom.common.JISystem;
005</p>
<p>import</p>
<p>org.jinterop.dcom.core./*;</p>
<p>006</p>
<p>import</p>
<p>org.jinterop.dcom.impls.JIObjectFactory;
007</p>
<p>import</p>
<p>org.jinterop.dcom.impls.automation.IJIDispatch;</p>
<p>008</p>
<p>import</p>
<p>org.jinterop.dcom.impls.automation.IJIEnumVariant;
009</p>
<p>import</p>
<p>org.slf4j.Logger;</p>
<p>010</p>
<p>import</p>
<p>org.slf4j.LoggerFactory;
011</p>
<p>012</p>
<p>import</p>
<p>java.net.UnknownHostException;
013</p>
<p>import</p>
<p>java.util.logging.Level;</p>
<p>014</p>
<p>015</p>
<p>//<em>/</em></p>
<p>016</p>
<p>/* Created with IntelliJ IDEA.
017</p>
<p>/* User: noah</p>
<p>018</p>
<p>/* Date: 8/16/12
019</p>
<p>/* Time: 8:00 AM</p>
<p>020</p>
<p>/* To change this template use File | Settings | File Templates.
021</p>
<p>/*/</p>
<p>022</p>
<p>public</p>
<p>class</p>
<p>WmiService {
023</p>
<p>024</p>
<p>private</p>
<p>JIComServer m_ComStub =</p>
<p>null</p>
<p>;
025</p>
<p>private</p>
<p>IJIComObject m_ComObject =</p>
<p>null</p>
<p>;</p>
<p>026</p>
<p>private</p>
<p>IJIDispatch m_Dispatch =</p>
<p>null</p>
<p>;
027</p>
<p>private</p>
<p>String m_Address =</p>
<p>null</p>
<p>;</p>
<p>028</p>
<p>private</p>
<p>JISession m_Session =</p>
<p>null</p>
<p>;
029</p>
<p>private</p>
<p>IJIDispatch m_WbemServices =</p>
<p>null</p>
<p>;</p>
<p>030</p>
<p>031</p>
<p>private</p>
<p>static</p>
<p>final</p>
<p>String WMI_CLSID =</p>
<p>&quot;76A6415B-CB41-11d1-8B02-00600806D9B6&quot;</p>
<p>;</p>
<p>032</p>
<p>private</p>
<p>static</p>
<p>final</p>
<p>String WMI_PROGID =</p>
<p>&quot;WbemScripting.SWbemLocator&quot;</p>
<p>;
033</p>
<p>034</p>
<p>private</p>
<p>Logger logger = LoggerFactory.getLogger(</p>
<p>this</p>
<p>.getClass());
035</p>
<p>036</p>
<p>037</p>
<p>public</p>
<p>WmiService(String address) {</p>
<p>038</p>
<p>JISystem.setAutoRegisteration(</p>
<p>true</p>
<p>);
039</p>
<p>JISystem.getLogger().setLevel(Level.WARNING);</p>
<p>040</p>
<p>m_Address = address;
041</p>
<p>}</p>
<p>042</p>
<p>043</p>
<p>public</p>
<p>void</p>
<p>query(String strQuery) {</p>
<p>044</p>
<p>045</p>
<p>System.out.println(</p>
<p>&quot;query:&quot;</p>
<ul>
<li>strQuery);</li>
</ul>
<p>046</p>
<p>047</p>
<p>JIVariant results[] =</p>
<p>new</p>
<p>JIVariant[</p>
<p>0</p>
<p>];</p>
<p>048</p>
<p>try</p>
<p>{
049</p>
<p>results = m_WbemServices.callMethodA(</p>
<p>&quot;ExecQuery&quot;</p>
<p>,</p>
<p>new</p>
<p>Object[]{</p>
<p>new</p>
<p>JIString(strQuery), JIVariant.OPTIONAL_PARAM(), JIVariant.OPTIONAL_PARAM(), JIVariant.OPTIONAL_PARAM()});</p>
<p>050</p>
<p>IJIDispatch wOSd = (IJIDispatch) JIObjectFactory.narrowObject((results[</p>
<p>0</p>
<p>]).getObjectAsComObject());
051</p>
<p>052</p>
<p>int</p>
<p>count = wOSd.get(</p>
<p>&quot;Count&quot;</p>
<p>).getObjectAsInt();
053</p>
<p>054</p>
<p>IJIComObject enumComObject = wOSd.get(</p>
<p>&quot;_NewEnum&quot;</p>
<p>).getObjectAsComObject();
055</p>
<p>IJIEnumVariant enumVariant = (IJIEnumVariant) JIObjectFactory.narrowObject(enumComObject.queryInterface(IJIEnumVariant.IID));</p>
<p>056</p>
<p>057</p>
<p>IJIDispatch wbemObject_dispatch =</p>
<p>null</p>
<p>;</p>
<p>058</p>
<p>059</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>c =</p>
<p>0</p>
<p>; c &lt; count; c++) {</p>
<p>060</p>
<p>061</p>
<p>Object[] values = enumVariant.next(</p>
<p>1</p>
<p>);</p>
<p>062</p>
<p>JIArray array = (JIArray) values[</p>
<p>0</p>
<p>];
063</p>
<p>Object[] arrayObj = (Object[]) array.getArrayInstance();</p>
<p>064</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>j =</p>
<p>0</p>
<p>; j &lt; arrayObj.length; j++) {
065</p>
<p>wbemObject_dispatch = (IJIDispatch) JIObjectFactory.narrowObject(((JIVariant) arrayObj[j]).getObjectAsComObject());</p>
<p>066</p>
<p>}
067</p>
<p>068</p>
<p>String str = (wbemObject_dispatch.callMethodA(</p>
<p>&quot;GetObjectText_&quot;</p>
<p>,</p>
<p>new</p>
<p>Object[]{</p>
<p>1</p>
<p>}))[</p>
<p>0</p>
<p>].getObjectAsString2();
069</p>
<p>System.out.println(</p>
<p>&quot;(&quot;</p>
<ul>
<li>c +</li>
</ul>
<p>&quot;):&quot;</p>
<p>);</p>
<p>070</p>
<p>System.out.println(str);
071</p>
<p>System.out.println();</p>
<p>072</p>
<p>}
073</p>
<p>074</p>
<p>075</p>
<p>}</p>
<p>catch</p>
<p>(JIException e) {</p>
<p>076</p>
<p>e.printStackTrace();
077</p>
<p>}</p>
<p>078</p>
<p>}
079</p>
<p>080</p>
<p>public</p>
<p>void</p>
<p>connect(</p>
<p>final</p>
<p>String domain,</p>
<p>final</p>
<p>String username,</p>
<p>final</p>
<p>String password) {
081</p>
<p>try</p>
<p>{</p>
<p>082</p>
<p>083</p>
<p>m_Session = JISession.createSession(domain, username, password);</p>
<p>084</p>
<p>m_Session.useSessionSecurity(</p>
<p>true</p>
<p>);
085</p>
<p>m_Session.setGlobalSocketTimeout(</p>
<p>5000</p>
<p>);</p>
<p>086</p>
<p>087</p>
<p>m_ComStub =</p>
<p>new</p>
<p>JIComServer(JIProgId.valueOf(WMI_PROGID), m_Address, m_Session);</p>
<p>088</p>
<p>089</p>
<p>IJIComObject unknown = m_ComStub.createInstance();</p>
<p>090</p>
<p>m_ComObject = unknown.queryInterface(WMI_CLSID);
091</p>
<p>092</p>
<p>m_Dispatch = (IJIDispatch) JIObjectFactory.narrowObject(m_ComObject.queryInterface(IJIDispatch.IID));
093</p>
<p>JIVariant results[] = m_Dispatch.callMethodA(</p>
<p>094</p>
<p>&quot;ConnectServer&quot;</p>
<p>,
095</p>
<p>new</p>
<p>Object[]{</p>
<p>096</p>
<p>new</p>
<p>JIString(m_Address),
097</p>
<p>JIVariant.OPTIONAL_PARAM(),</p>
<p>098</p>
<p>JIVariant.OPTIONAL_PARAM(),
099</p>
<p>JIVariant.OPTIONAL_PARAM(),</p>
<p>100</p>
<p>JIVariant.OPTIONAL_PARAM(),
101</p>
<p>JIVariant.OPTIONAL_PARAM(),</p>
<p>102</p>
<p>0</p>
<p>,
103</p>
<p>JIVariant.OPTIONAL_PARAM()</p>
<p>104</p>
<p>}
105</p>
<p>);</p>
<p>106</p>
<p>107</p>
<p>m_WbemServices = (IJIDispatch) JIObjectFactory.narrowObject((results[</p>
<p>0</p>
<p>]).getObjectAsComObject());</p>
<p>108</p>
<p>109</p>
<p>}</p>
<p>catch</p>
<p>(JIException e) {</p>
<p>110</p>
<p>e.printStackTrace();
111</p>
<p>if</p>
<p>(m_Session !=</p>
<p>null</p>
<p>) {</p>
<p>112</p>
<p>try</p>
<p>{
113</p>
<p>JISession.destroySession(m_Session);</p>
<p>114</p>
<p>}</p>
<p>catch</p>
<p>(JIException e1) {
115</p>
<p>logger.error(e.getMessage(), e);</p>
<p>116</p>
<p>}
117</p>
<p>}</p>
<p>118</p>
<p>}</p>
<p>catch</p>
<p>(UnknownHostException e) {
119</p>
<p>if</p>
<p>(m_Session !=</p>
<p>null</p>
<p>) {</p>
<p>120</p>
<p>try</p>
<p>{
121</p>
<p>JISession.destroySession(m_Session);</p>
<p>122</p>
<p>}</p>
<p>catch</p>
<p>(JIException e1) {
123</p>
<p>logger.error(e.getMessage(), e);</p>
<p>124</p>
<p>}
125</p>
<p>}</p>
<p>126</p>
<p>}
127</p>
<p>}</p>
<p>128</p>
<p>129</p>
<p>public</p>
<p>void</p>
<p>disconnect() {</p>
<p>130</p>
<p>try</p>
<p>{
131</p>
<p>JISession.destroySession(m_Session);</p>
<p>132</p>
<p>}</p>
<p>catch</p>
<p>(JIException e) {
133</p>
<p>logger.error(e.getMessage(), e);</p>
<p>134</p>
<p>}
135</p>
<p>}</p>
<p>136</p>
<p>137</p>
<p>138</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>main(String[] args) {
139</p>
<p>140</p>
<p>WmiService wmiService =</p>
<p>new</p>
<p>WmiService(</p>
<p>&quot;172.16.158.129&quot;</p>
<p>);
141</p>
<p>142</p>
<p>//域（一般为空字符），用户名，密码
143</p>
<p>wmiService.connect(</p>
<p>&quot;&quot;</p>
<p>,</p>
<p>&quot;username&quot;</p>
<p>,</p>
<p>&quot;password&quot;</p>
<p>);</p>
<p>144</p>
<p>145</p>
<p>//系统信息</p>
<p>146</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_ComputerSystem&quot;</p>
<p>);
147</p>
<p>148</p>
<p>//CPU信息
149</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_PerfFormattedData_PerfOS_Processor WHERE Name != &#39;_Total&#39;&quot;</p>
<p>);</p>
<p>150</p>
<p>151</p>
<p>//内存信息</p>
<p>152</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_PerfFormattedData_PerfOS_Memory&quot;</p>
<p>);
153</p>
<p>154</p>
<p>//磁盘信息
155</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_PerfRawData_PerfDisk_PhysicalDisk Where Name != &#39;_Total&#39;&quot;</p>
<p>);</p>
<p>156</p>
<p>157</p>
<p>wmiService.disconnect();</p>
<p>158</p>
<p>}
159</p>
<p>}</p>
<p>mavne配置(pom.xml)
<a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>01</p>
<p>&lt;?</p>
<p>xml</p>
<p>version</p>
<p>=</p>
<p>&quot;1.0&quot;</p>
<p>encoding</p>
<p>=</p>
<p>&quot;UTF-8&quot;</p>
<p>?&gt;</p>
<p>02</p>
<p>&lt;</p>
<p>project</p>
<p>xmlns</p>
<p>=</p>
<p>&quot;<a href="http://maven.apache.org/POM/4.0.0" target="_blank">http://maven.apache.org/POM/4.0.0</a>&quot;
03</p>
<p>xmlns:xsi</p>
<p>=</p>
<p>&quot;<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>&quot;</p>
<p>04</p>
<p>xsi:schemaLocation</p>
<p>=</p>
<p>&quot;<a href="http://maven.apache.org/POM/4.0.0" target="_blank">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_blank">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>&quot;</p>
<p>&gt;
05</p>
<p>&lt;</p>
<p>modelVersion</p>
<blockquote>
<p>4.0.0&lt;/</p>
</blockquote>
<p>modelVersion</p>
<p>&gt;</p>
<p>06</p>
<p>07</p>
<p>&lt;</p>
<p>groupId</p>
<blockquote>
<p>org.noahx&lt;/</p>
</blockquote>
<p>groupId</p>
<p>&gt;</p>
<p>08</p>
<p>&lt;</p>
<p>artifactId</p>
<blockquote>
<p>wmi-test&lt;/</p>
</blockquote>
<p>artifactId</p>
<p>&gt;
09</p>
<p>&lt;</p>
<p>version</p>
<blockquote>
<p>1.0&lt;/</p>
</blockquote>
<p>version</p>
<p>&gt;</p>
<p>10</p>
<p>11</p>
<p>12</p>
<p>&lt;</p>
<p>dependencies</p>
<p>&gt;
13</p>
<p>14</p>
<p>&lt;</p>
<p>dependency</p>
<p>&gt;
15</p>
<p>&lt;</p>
<p>groupId</p>
<blockquote>
<p>org.kohsuke.jinterop&lt;/</p>
</blockquote>
<p>groupId</p>
<p>&gt;</p>
<p>16</p>
<p>&lt;</p>
<p>artifactId</p>
<blockquote>
<p>j-interop&lt;/</p>
</blockquote>
<p>artifactId</p>
<p>&gt;
17</p>
<p>&lt;</p>
<p>version</p>
<blockquote>
<p>2.0.8-kohsuke-1&lt;/</p>
</blockquote>
<p>version</p>
<p>&gt;</p>
<p>18</p>
<p>&lt;/</p>
<p>dependency</p>
<p>&gt;
19</p>
<p>20</p>
<p>&lt;</p>
<p>dependency</p>
<p>&gt;
21</p>
<p>&lt;</p>
<p>groupId</p>
<blockquote>
<p>org.slf4j&lt;/</p>
</blockquote>
<p>groupId</p>
<p>&gt;</p>
<p>22</p>
<p>&lt;</p>
<p>artifactId</p>
<blockquote>
<p>slf4j-log4j12&lt;/</p>
</blockquote>
<p>artifactId</p>
<p>&gt;
23</p>
<p>&lt;</p>
<p>version</p>
<blockquote>
<p>1.6.4&lt;/</p>
</blockquote>
<p>version</p>
<p>&gt;</p>
<p>24</p>
<p>&lt;/</p>
<p>dependency</p>
<p>&gt;
25</p>
<p>26</p>
<p>&lt;/</p>
<p>dependencies</p>
<p>&gt;
27</p>
<p>28</p>
<p>&lt;/</p>
<p>project</p>
<p>&gt;</p>
<p>运行结果</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>001</p>
<p>query:SELECT /* FROM Win32_ComputerSystem</p>
<p>002</p>
<p>(0):
003</p>
<p>004</p>
<p>instance of Win32_ComputerSystem
005</p>
<p>{</p>
<p>006</p>
<p>AdminPasswordStatus = 1;
007</p>
<p>AutomaticResetBootOption = FALSE;</p>
<p>008</p>
<p>AutomaticResetCapability = TRUE;
009</p>
<p>BootOptionOnLimit = 3;</p>
<p>010</p>
<p>BootOptionOnWatchDog = 3;
011</p>
<p>BootROMSupported = TRUE;</p>
<p>012</p>
<p>BootupState =</p>
<p>&quot;Normal boot&quot;</p>
<p>;
013</p>
<p>Caption =</p>
<p>&quot;NAK-E1A7C21EA3C&quot;</p>
<p>;</p>
<p>014</p>
<p>ChassisBootupState = 3;
015</p>
<p>CreationClassName =</p>
<p>&quot;Win32_ComputerSystem&quot;</p>
<p>;</p>
<p>016</p>
<p>CurrentTimeZone = 480;
017</p>
<p>Description =</p>
<p>&quot;AT/AT COMPATIBLE&quot;</p>
<p>;</p>
<p>018</p>
<p>Domain =</p>
<p>&quot;WORKGROUP&quot;</p>
<p>;
019</p>
<p>DomainRole = 0;</p>
<p>020</p>
<p>EnableDaylightSavingsTime = TRUE;
021</p>
<p>FrontPanelResetStatus = 3;</p>
<p>022</p>
<p>InfraredSupported = FALSE;
023</p>
<p>KeyboardPasswordStatus = 3;</p>
<p>024</p>
<p>Manufacturer =</p>
<p>&quot;VMware, Inc.&quot;</p>
<p>;
025</p>
<p>Model =</p>
<p>&quot;VMware Virtual Platform&quot;</p>
<p>;</p>
<p>026</p>
<p>Name =</p>
<p>&quot;NAK-E1A7C21EA3C&quot;</p>
<p>;
027</p>
<p>NetworkServerModeEnabled = TRUE;</p>
<p>028</p>
<p>NumberOfLogicalProcessors = 2;
029</p>
<p>NumberOfProcessors = 1;</p>
<p>030</p>
<p>OEMStringArray = {</p>
<p>&quot;[MS_VM_CERT/SHA1/27d66596a61c48dd3dc7216fd715126e33f59ae7]&quot;</p>
<p>,</p>
<p>&quot;Welcome to the Virtual Machine&quot;</p>
<p>};
031</p>
<p>PartOfDomain = FALSE;</p>
<p>032</p>
<p>PauseAfterReset =</p>
<p>&quot;3932100000&quot;</p>
<p>;
033</p>
<p>PowerOnPasswordStatus = 0;</p>
<p>034</p>
<p>PowerState = 0;
035</p>
<p>PowerSupplyState = 3;</p>
<p>036</p>
<p>PrimaryOwnerName =</p>
<p>&quot;nak&quot;</p>
<p>;
037</p>
<p>ResetCapability = 1;</p>
<p>038</p>
<p>ResetCount = -1;
039</p>
<p>ResetLimit = -1;</p>
<p>040</p>
<p>Roles = {</p>
<p>&quot;LM_Workstation&quot;</p>
<p>,</p>
<p>&quot;LM_Server&quot;</p>
<p>,</p>
<p>&quot;NT&quot;</p>
<p>,</p>
<p>&quot;Potential_Browser&quot;</p>
<p>,</p>
<p>&quot;Master_Browser&quot;</p>
<p>};
041</p>
<p>Status =</p>
<p>&quot;OK&quot;</p>
<p>;</p>
<p>042</p>
<p>SystemStartupDelay = 0;
043</p>
<p>SystemStartupOptions = {</p>
<p>&quot;\&quot;Microsoft Windows XP Professional\&quot; /noexecute=optin /fastdetect&quot;</p>
<p>};</p>
<p>044</p>
<p>SystemStartupSetting = 0;
045</p>
<p>SystemType =</p>
<p>&quot;X86-based PC&quot;</p>
<p>;</p>
<p>046</p>
<p>ThermalState = 3;
047</p>
<p>TotalPhysicalMemory =</p>
<p>&quot;1610063872&quot;</p>
<p>;</p>
<p>048</p>
<p>UserName =</p>
<p>&quot;NAK-E1A7C21EA3C\a&quot;</p>
<p>;
049</p>
<p>WakeUpType = 6;</p>
<p>050</p>
<p>};
051</p>
<p>052</p>
<p>053</p>
<p>query:SELECT /* FROM Win32_PerfFormattedData_PerfOS_Processor WHERE Name !=</p>
<p>&#39;_Total&#39;</p>
<p>054</p>
<p>(0):
055</p>
<p>056</p>
<p>instance of Win32_PerfFormattedData_PerfOS_Processor
057</p>
<p>{</p>
<p>058</p>
<p>C1TransitionsPersec =</p>
<p>&quot;77&quot;</p>
<p>;
059</p>
<p>C2TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>060</p>
<p>C3TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;
061</p>
<p>DPCRate = 0;</p>
<p>062</p>
<p>DPCsQueuedPersec = 4;
063</p>
<p>InterruptsPersec = 71;</p>
<p>064</p>
<p>Name =</p>
<p>&quot;0&quot;</p>
<p>;
065</p>
<p>PercentC1Time =</p>
<p>&quot;96&quot;</p>
<p>;</p>
<p>066</p>
<p>PercentC2Time =</p>
<p>&quot;0&quot;</p>
<p>;
067</p>
<p>PercentC3Time =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>068</p>
<p>PercentDPCTime =</p>
<p>&quot;0&quot;</p>
<p>;
069</p>
<p>PercentIdleTime =</p>
<p>&quot;100&quot;</p>
<p>;</p>
<p>070</p>
<p>PercentInterruptTime =</p>
<p>&quot;0&quot;</p>
<p>;
071</p>
<p>PercentPrivilegedTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>072</p>
<p>PercentProcessorTime =</p>
<p>&quot;0&quot;</p>
<p>;
073</p>
<p>PercentUserTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>074</p>
<p>};
075</p>
<p>076</p>
<p>077</p>
<p>(1):</p>
<p>078</p>
<p>079</p>
<p>instance of Win32_PerfFormattedData_PerfOS_Processor</p>
<p>080</p>
<p>{
081</p>
<p>C1TransitionsPersec =</p>
<p>&quot;83&quot;</p>
<p>;</p>
<p>082</p>
<p>C2TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;
083</p>
<p>C3TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>084</p>
<p>DPCRate = 0;
085</p>
<p>DPCsQueuedPersec = 10;</p>
<p>086</p>
<p>InterruptsPersec = 67;
087</p>
<p>Name =</p>
<p>&quot;1&quot;</p>
<p>;</p>
<p>088</p>
<p>PercentC1Time =</p>
<p>&quot;96&quot;</p>
<p>;
089</p>
<p>PercentC2Time =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>090</p>
<p>PercentC3Time =</p>
<p>&quot;0&quot;</p>
<p>;
091</p>
<p>PercentDPCTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>092</p>
<p>PercentIdleTime =</p>
<p>&quot;100&quot;</p>
<p>;
093</p>
<p>PercentInterruptTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>094</p>
<p>PercentPrivilegedTime =</p>
<p>&quot;0&quot;</p>
<p>;
095</p>
<p>PercentProcessorTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>096</p>
<p>PercentUserTime =</p>
<p>&quot;0&quot;</p>
<p>;
097</p>
<p>};</p>
<p>098</p>
<p>099</p>
<p>100</p>
<p>query:SELECT /* FROM Win32_PerfFormattedData_PerfOS_Memory
101</p>
<p>(0):</p>
<p>102</p>
<p>103</p>
<p>instance of Win32_PerfFormattedData_PerfOS_Memory</p>
<p>104</p>
<p>{
105</p>
<p>AvailableBytes =</p>
<p>&quot;1142099968&quot;</p>
<p>;</p>
<p>106</p>
<p>AvailableKBytes =</p>
<p>&quot;1115332&quot;</p>
<p>;
107</p>
<p>AvailableMBytes =</p>
<p>&quot;1089&quot;</p>
<p>;</p>
<p>108</p>
<p>CacheBytes =</p>
<p>&quot;70725632&quot;</p>
<p>;
109</p>
<p>CacheBytesPeak =</p>
<p>&quot;72904704&quot;</p>
<p>;</p>
<p>110</p>
<p>CacheFaultsPersec = 634;
111</p>
<p>CommitLimit =</p>
<p>&quot;3063078912&quot;</p>
<p>;</p>
<p>112</p>
<p>CommittedBytes =</p>
<p>&quot;326488064&quot;</p>
<p>;
113</p>
<p>DemandZeroFaultsPersec = 13965;</p>
<p>114</p>
<p>FreeSystemPageTableEntries = 159743;
115</p>
<p>PageFaultsPersec = 13965;</p>
<p>116</p>
<p>PageReadsPersec = 0;
117</p>
<p>PagesInputPersec = 0;</p>
<p>118</p>
<p>PagesOutputPersec = 0;
119</p>
<p>PagesPersec = 0;</p>
<p>120</p>
<p>PageWritesPersec = 0;
121</p>
<p>PercentCommittedBytesInUse = 10;</p>
<p>122</p>
<p>PoolNonpagedAllocs = 38040;
123</p>
<p>PoolNonpagedBytes =</p>
<p>&quot;7585792&quot;</p>
<p>;</p>
<p>124</p>
<p>PoolPagedAllocs = 57820;
125</p>
<p>PoolPagedBytes =</p>
<p>&quot;29380608&quot;</p>
<p>;</p>
<p>126</p>
<p>PoolPagedResidentBytes =</p>
<p>&quot;28622848&quot;</p>
<p>;
127</p>
<p>SystemCacheResidentBytes =</p>
<p>&quot;40235008&quot;</p>
<p>;</p>
<p>128</p>
<p>SystemCodeResidentBytes =</p>
<p>&quot;1867776&quot;</p>
<p>;
129</p>
<p>SystemCodeTotalBytes =</p>
<p>&quot;1167360&quot;</p>
<p>;</p>
<p>130</p>
<p>SystemDriverResidentBytes =</p>
<p>&quot;0&quot;</p>
<p>;
131</p>
<p>SystemDriverTotalBytes =</p>
<p>&quot;4071424&quot;</p>
<p>;</p>
<p>132</p>
<p>TransitionFaultsPersec = 0;
133</p>
<p>WriteCopiesPersec = 0;</p>
<p>134</p>
<p>};
135</p>
<p>136</p>
<p>137</p>
<p>query:SELECT /* FROM Win32_PerfRawData_PerfDisk_PhysicalDisk Where Name !=</p>
<p>&#39;_Total&#39;</p>
<p>138</p>
<p>(0):
139</p>
<p>140</p>
<p>instance of Win32_PerfRawData_PerfDisk_PhysicalDisk
141</p>
<p>{</p>
<p>142</p>
<p>AvgDiskBytesPerRead =</p>
<p>&quot;138920448&quot;</p>
<p>;
143</p>
<p>AvgDiskBytesPerRead_Base = 8000;</p>
<p>144</p>
<p>AvgDiskBytesPerTransfer =</p>
<p>&quot;208285696&quot;</p>
<p>;
145</p>
<p>AvgDiskBytesPerTransfer_Base = 13701;</p>
<p>146</p>
<p>AvgDiskBytesPerWrite =</p>
<p>&quot;69365248&quot;</p>
<p>;
147</p>
<p>AvgDiskBytesPerWrite_Base = 5701;</p>
<p>148</p>
<p>AvgDiskQueueLength =</p>
<p>&quot;581460650&quot;</p>
<p>;
149</p>
<p>AvgDiskReadQueueLength =</p>
<p>&quot;405581626&quot;</p>
<p>;</p>
<p>150</p>
<p>AvgDisksecPerRead = 2794786622;
151</p>
<p>AvgDisksecPerRead_Base = 8000;</p>
<p>152</p>
<p>AvgDisksecPerTransfer = 322083534;
153</p>
<p>AvgDisksecPerTransfer_Base = 13701;</p>
<p>154</p>
<p>AvgDisksecPerWrite = 1822264208;
155</p>
<p>AvgDisksecPerWrite_Base = 5701;</p>
<p>156</p>
<p>AvgDiskWriteQueueLength =</p>
<p>&quot;175879024&quot;</p>
<p>;
157</p>
<p>CurrentDiskQueueLength = 0;</p>
<p>158</p>
<p>DiskBytesPersec =</p>
<p>&quot;208285696&quot;</p>
<p>;
159</p>
<p>DiskReadBytesPersec =</p>
<p>&quot;138920448&quot;</p>
<p>;</p>
<p>160</p>
<p>DiskReadsPersec = 8000;
161</p>
<p>DiskTransfersPersec = 13701;</p>
<p>162</p>
<p>DiskWriteBytesPersec =</p>
<p>&quot;69365248&quot;</p>
<p>;
163</p>
<p>DiskWritesPersec = 5701;</p>
<p>164</p>
<p>Frequency_Object =</p>
<p>&quot;0&quot;</p>
<p>;
165</p>
<p>Frequency_PerfTime =</p>
<p>&quot;3034010000&quot;</p>
<p>;</p>
<p>166</p>
<p>Frequency_Sys100NS =</p>
<p>&quot;10000000&quot;</p>
<p>;
167</p>
<p>Name =</p>
<p>&quot;0 C:&quot;</p>
<p>;</p>
<p>168</p>
<p>PercentDiskReadTime =</p>
<p>&quot;405581626&quot;</p>
<p>;
169</p>
<p>PercentDiskReadTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>170</p>
<p>PercentDiskTime =</p>
<p>&quot;581460650&quot;</p>
<p>;
171</p>
<p>PercentDiskTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>172</p>
<p>PercentDiskWriteTime =</p>
<p>&quot;175879024&quot;</p>
<p>;
173</p>
<p>PercentDiskWriteTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>174</p>
<p>PercentIdleTime =</p>
<p>&quot;18446744072967667781&quot;</p>
<p>;
175</p>
<p>PercentIdleTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>176</p>
<p>SplitIOPerSec = 1074;
177</p>
<p>Timestamp_Object =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>178</p>
<p>Timestamp_PerfTime =</p>
<p>&quot;3635534093651&quot;</p>
<p>;
179</p>
<p>Timestamp_Sys100NS =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>180</p>
<p>};&lt;span style=</p>
<p>&quot;font-family:&#39;sans serif, tahoma, verdana, helvetica&#39;;font-size:x-small;&quot;</p>
<blockquote>
<p>&lt;span style=</p>
</blockquote>
<p>&quot;line-height:18.18181800842285px;white-space:normal;&quot;</p>
<blockquote>
<p></span></span></p>
</blockquote>
<h2 id="-">#</h2>
<h3 id="3-">3、有可能出现的问题</h3>
<p>报错a</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>01</p>
<p>org.jinterop.dcom.common.JIException: Message not found</p>
<p>for</p>
<p>errorCode:</p>
<p>0xC0000034</p>
<p>02</p>
<p>at org.jinterop.winreg.smb.JIWinRegStub.winreg_OpenHKLM(JIWinRegStub.java:</p>
<p>115</p>
<p>)
03</p>
<p>at org.jinterop.dcom.core.JIProgId.getIdFromWinReg(JIProgId.java:</p>
<p>130</p>
<p>)</p>
<p>04</p>
<p>at org.jinterop.dcom.core.JIProgId.getCorrespondingCLSID(JIProgId.java:</p>
<p>162</p>
<p>)
05</p>
<p>at org.jinterop.dcom.core.JIComServer.<init>(JIComServer.java:</p>
<p>413</p>
<p>)</p>
<p>06</p>
<p>at org.noah.wmitest.WmiService.connect(WmiService.java:</p>
<p>122</p>
<p>)
07</p>
<p>at org.noah.wmitest.WmiService.main(WmiService.java:</p>
<p>177</p>
<p>)</p>
<p>08</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
09</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</p>
<p>39</p>
<p>)</p>
<p>10</p>
<p>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</p>
<p>25</p>
<p>)
11</p>
<p>at java.lang.reflect.Method.invoke(Method.java:</p>
<p>597</p>
<p>)</p>
<p>12</p>
<p>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:</p>
<p>120</p>
<p>)
13</p>
<p>Caused by: jcifs.smb.SmbException: The system cannot find the file specified.</p>
<p>14</p>
<p>at jcifs.smb.SmbTransport.checkStatus(SmbTransport.java:</p>
<p>522</p>
<p>)
15</p>
<p>at jcifs.smb.SmbTransport.send(SmbTransport.java:</p>
<p>622</p>
<p>)</p>
<p>16</p>
<p>at jcifs.smb.SmbSession.send(SmbSession.java:</p>
<p>239</p>
<p>)
17</p>
<p>at jcifs.smb.SmbTree.send(SmbTree.java:</p>
<p>109</p>
<p>)</p>
<p>18</p>
<p>at jcifs.smb.SmbFile.send(SmbFile.java:</p>
<p>718</p>
<p>)
19</p>
<p>at jcifs.smb.SmbFile.open0(SmbFile.java:</p>
<p>923</p>
<p>)</p>
<p>20</p>
<p>at jcifs.smb.SmbFile.open(SmbFile.java:</p>
<p>940</p>
<p>)
21</p>
<p>at jcifs.smb.SmbFileOutputStream.<init>(SmbFileOutputStream.java:</p>
<p>142</p>
<p>)</p>
<p>22</p>
<p>at jcifs.smb.TransactNamedPipeOutputStream.<init>(TransactNamedPipeOutputStream.java:</p>
<p>32</p>
<p>)
23</p>
<p>at jcifs.smb.SmbNamedPipe.getNamedPipeOutputStream(SmbNamedPipe.java:</p>
<p>187</p>
<p>)</p>
<p>24</p>
<p>at rpc.ncacn_np.RpcTransport.attach(RpcTransport.java:</p>
<p>92</p>
<p>)
25</p>
<p>at rpc.Stub.attach(Stub.java:</p>
<p>105</p>
<p>)</p>
<p>26</p>
<p>at rpc.Stub.call(Stub.java:</p>
<p>110</p>
<p>)
27</p>
<p>at org.jinterop.winreg.smb.JIWinRegStub.winreg_OpenHKLM(JIWinRegStub.java:</p>
<p>113</p>
<p>)</p>
<p>28</p>
<p>...</p>
<p>10</p>
<p>more</p>
<p>需要开启Remote Registry服务
报错b</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>01</p>
<p>org.jinterop.dcom.common.JIException: Message not found</p>
<p>for</p>
<p>errorCode:</p>
<p>0xC0000001</p>
<p>02</p>
<p>at org.jinterop.winreg.smb.JIWinRegStub.winreg_OpenHKLM(JIWinRegStub.java:</p>
<p>115</p>
<p>)
03</p>
<p>at org.jinterop.dcom.core.JIProgId.getIdFromWinReg(JIProgId.java:</p>
<p>130</p>
<p>)</p>
<p>04</p>
<p>at org.jinterop.dcom.core.JIProgId.getCorrespondingCLSID(JIProgId.java:</p>
<p>162</p>
<p>)
05</p>
<p>at org.jinterop.dcom.core.JIComServer.<init>(JIComServer.java:</p>
<p>413</p>
<p>)</p>
<p>06</p>
<p>at org.noah.wmitest.WmiService.connect(WmiService.java:</p>
<p>87</p>
<p>)
07</p>
<p>at org.noah.wmitest.WmiService.main(WmiService.java:</p>
<p>142</p>
<p>)</p>
<p>08</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
09</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</p>
<p>39</p>
<p>)</p>
<p>10</p>
<p>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</p>
<p>25</p>
<p>)
11</p>
<p>at java.lang.reflect.Method.invoke(Method.java:</p>
<p>597</p>
<p>)</p>
<p>12</p>
<p>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:</p>
<p>120</p>
<p>)
13</p>
<p>Caused by: jcifs.smb.SmbException: Connection timeout</p>
<p>14</p>
<p>jcifs.util.transport.TransportException: Connection timeout
15</p>
<p>16</p>
<p>或
17</p>
<p>18</p>
<p>org.jinterop.dcom.common.JIException: Message not found</p>
<p>for</p>
<p>errorCode:</p>
<p>0x8001FFFF
19</p>
<p>at org.jinterop.dcom.core.JIComServer.init(JIComServer.java:</p>
<p>576</p>
<p>)</p>
<p>20</p>
<p>at org.jinterop.dcom.core.JIComServer.initialise(JIComServer.java:</p>
<p>481</p>
<p>)
21</p>
<p>at org.jinterop.dcom.core.JIComServer.<init>(JIComServer.java:</p>
<p>414</p>
<p>)</p>
<p>22</p>
<p>at org.noah.wmitest.WmiService.connect(WmiService.java:</p>
<p>87</p>
<p>)
23</p>
<p>at org.noah.wmitest.WmiService.main(WmiService.java:</p>
<p>142</p>
<p>)</p>
<p>24</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
25</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</p>
<p>39</p>
<p>)</p>
<p>26</p>
<p>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</p>
<p>25</p>
<p>)
27</p>
<p>at java.lang.reflect.Method.invoke(Method.java:</p>
<p>597</p>
<p>)</p>
<p>28</p>
<p>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:</p>
<p>120</p>
<p>)
29</p>
<p>Caused by: java.net.ConnectException: Connection timed out</p>
<p>需要禁用放火墙</p>
<h3 id="4-">4、总结</h3>
<p>j-Interop纯java跨平台，我就是linux系统。</p>
<p>用j-Interop就可以很方便的调用windows系统com，虽然这里只演示了WMI。
如果关心WMI与监控的话，建议去opennms-wmi看一看，他们有更好api封装（底层也是j-Interop）。
<strong>关键字：</strong> <a href="http://www.oschina.net/search?scope=blog&amp;q=wmi" target="_blank">wmi</a> <a href="http://www.oschina.net/search?scope=blog&amp;q=windows" target="_blank">windows</a> <a href="http://www.oschina.net/search?scope=blog&amp;q=j-interop" target="_blank">j-interop</a></p>
<p>声明：OSCHINA 博客文章版权属于作者，受法律保护。未经作者同意不得转载。</p>
<ul>
<li><a href="http://my.oschina.net/noahxiao/blog/72861" title="上一篇：既爱又恨的VA-API(Ubuntu视频加速)" target="_blank">« 既爱又恨的VA-API(Ubuntu视频加速)</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/75463" title="下一篇：通过javamelody监控web应用的性能指标" target="_blank">通过javamelody监控web应用的性能指标 »</a></li>
</ul>
<p>开源中国-程序员在线工具：<a href="http://www.ostools.net/apidocs" target="_blank">API文档大全(120+)</a> <a href="http://runjs.cn/" target="_blank">JS在线编辑演示</a> <a href="http://www.ostools.net/qr" target="_blank">二维码</a> <a href="http://www.ostools.net/" target="_blank">更多&gt;&gt;</a>
<strong>分享到：</strong> <a href="&quot;分享到新浪微博&quot;"></a> <a href="&quot;分享到腾讯微博&quot;"></a>  <a href="">顶</a>已有 <em>0</em>人顶</p>
<h2 id="-5-"><a href=""></a>共有 5 条网友评论</h2>
<ul>
<li><a href="http://my.oschina.net/u/657242" target="_blank"><img src="&quot;leehark&quot;" alt="leehark"></a> 1楼：<a href="http://my.oschina.net/u/657242" target="_blank">leehark</a>(Android) 发表于 2012-08-18 19:35 <a href="">回复此评论</a></li>
</ul>
<p>能通过代码禁止防火墙么？是都要管理员权限？</p>
<ul>
<li><a href="http://my.oschina.net/mingyuejingque" target="_blank"><img src="&quot;明月惊鹊&quot;" alt="明月惊鹊"></a> 2楼：<a href="http://my.oschina.net/mingyuejingque" target="_blank">明月惊鹊</a> 发表于 2012-08-19 14:40 <a href="">回复此评论</a></li>
</ul>
<p>WMI里应该就有控制防火墙的。这种操作肯定需要管理员权限了。</p>
<ul>
<li><a href="http://my.oschina.net/u/124197" target="_blank"><img src="&quot;黄金比&quot;" alt="黄金比"></a> 3楼：<a href="http://my.oschina.net/u/124197" target="_blank">黄金比</a>(iPhone) 发表于 2012-08-21 07:06 <a href="">回复此评论</a></li>
</ul>
<p>不知道远程调用行不行呢?请博主明确一下。</p>
<ul>
<li><a href="http://my.oschina.net/noahxiao" target="_blank"><img src="&quot;肖国颖&quot;" alt="肖国颖"></a> 4楼：<a href="http://my.oschina.net/noahxiao" target="_blank">肖国颖</a>(iPhone) 发表于 2012-08-21 08:23 <a href="">回复此评论</a></li>
</ul>
<h3 id="-">引用来自“黄金比”的评论</h3>
<p>不知道远程调用行不行呢?请博主明确一下。
你指的是非本机吗？我测试的方式就是一台linux运行程序指定ip调用另一台win服务器的wmi</p>
<ul>
<li><a href="http://my.oschina.net/u/124197" target="_blank"><img src="&quot;黄金比&quot;" alt="黄金比"></a> 5楼：<a href="http://my.oschina.net/u/124197" target="_blank">黄金比</a>(iPhone) 发表于 2012-08-21 12:47 <a href="">回复此评论</a></li>
</ul>
<h3 id="-">引用来自“肖国颖”的评论</h3>
<h3 id="-">引用来自“黄金比”的评论</h3>
<p>不知道远程调用行不行呢?请博主明确一下。
你指的是非本机吗？我测试的方式就是一台linux运行程序指定ip调用另一台win服务器的wmi</p>
<p>收到，谢博主，试下先!</p>
<p>文明上网，理性发言
<a href=""></a></p>
<p><img src="" alt=""> 文明上网，理性发言  <a href="">回到页首</a> | <a href="">回到评论列表</a></p>
<p><strong><a href="">关闭</a>相关文章阅读</strong></p>
<ul>
<li>2012/08/16 <a href="http://my.oschina.net/u/581475/blog/73199" title="100%纯java调用windows的wmi获取监控数据" target="_blank">100%纯java调用windows的wmi获取监控...</a></li>
<li>2011/07/06 <a href="http://my.oschina.net/veterans/blog/27840" title="使用WMI修改文件文件夹的NTFS权限" target="_blank">使用WMI修改文件文件夹的NTFS权限...</a></li>
<li>2013/04/24 <a href="http://my.oschina.net/fenlog/blog/124859" title="利用WMI实现ring3进程监控 - vc" target="_blank">利用WMI实现ring3进程监控 - vc...</a></li>
<li>2012/03/22 <a href="http://my.oschina.net/zhajiang/blog/50524" title="py2exe打包包含wmi模块的脚本后，运行时出现win32api.pyd错误的解决办法。" target="_blank">py2exe打包包含wmi模块的脚本后，运...</a></li>
<li>2011/09/02 <a href="http://my.oschina.net/u/129490/blog/30675" title="在windows下使用OpenSSH（上）" target="_blank">在windows下使用OpenSSH（上）...</a></li>
</ul>
<p>© 开源中国(OsChina.NET) | <a href="http://www.oschina.net/home/about" target="_blank">关于我们</a> | <a href="mailto:oschina.net@gmail.com">广告联系</a> | <a href="http://weibo.com/oschina2010" target="_blank">@新浪微博</a> | <a href="http://m.oschina.net/" target="_blank">开源中国手机版</a> | <a href="http://www.miitbeian.gov.cn/" target="_blank">粤ICP备12009483号-3</a> 开源中国手机客户端： <a href="http://www.oschina.net/app" title="Android客户端" target="_blank">Android</a> <a href="http://www.oschina.net/app" title="iPhone 客户端" target="_blank">iPhone</a> <a href="http://www.oschina.net/app" title="Windows Phone 客户端" target="_blank">WP7</a></p>
<p><a href=""></a><a href=""></a><a href=""></a>
<img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/java-com/">java-com</a></li><li><a href="/categories/Java&J2EE/java-com/wmi-监控/">wmi-监控</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/java-com/" class="label label-success">java-com</a><a href="/tags/wmi-监控/" class="label label-info">wmi-监控</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/56/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/54/">54</a></li><li><a class="page-number" href="/page/55/">55</a></li><li><a class="page-number" href="/page/56/">56</a></li><li class="active"><li><span class="page-number current">57</span></li><li><a class="page-number" href="/page/58/">58</a></li><li><a class="page-number" href="/page/59/">59</a></li><li><a class="page-number" href="/page/60/">60</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/58/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 18:24:57</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
