
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 103 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-Httpclient-HttpUrlConnection--HttpUrlConnection底层实现和关于javahost绑定ip即时生效的设置及分析-/">HttpUrlConnection底层实现和关于java host绑定ip即时生效的设置及分析 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-Httpclient-HttpUrlConnection--HttpUrlConnection底层实现和关于javahost绑定ip即时生效的设置及分析-/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="httpurlconnection-java-host-ip-csdn-net">HttpUrlConnection底层实现和关于java host绑定ip即时生效的设置及分析 - 程序员之路 - 博客频道 - CSDN.NET</h1>
<p>您还未登录！|<a href="https://passport.csdn.net/account/login" target="_blank">登录</a>|<a href="https://passport.csdn.net/account/register" target="_blank">注册</a>|<a href="https://passport.csdn.net/help/faq" target="_blank">帮助</a></p>
<ul>
<li><a href="http://www.csdn.net/" target="_blank">首页</a></li>
<li><a href="http://news.csdn.net/" target="_blank">业界</a></li>
<li><a href="http://mobile.csdn.net/" target="_blank">移动</a></li>
<li><a href="http://cloud.csdn.net/" target="_blank">云计算</a></li>
<li><a href="http://sd.csdn.net/" target="_blank">研发</a></li>
<li><a href="http://bbs.csdn.net/" target="_blank">论坛</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">博客</a></li>
<li><a href="http://download.csdn.net/" target="_blank">下载</a></li>
<li><h2 id="-"><a href="">更多</a></h2>
</li>
</ul>
<h1 id="-http-blog-csdn-net-zhongweijian-"><a href="http://blog.csdn.net/zhongweijian" target="_blank">程序员之路</a></h1>
<h2 id="-">求各种编程相关兼职</h2>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian?viewmode=contents" target="_blank"><img src="" alt="">目录视图</a></li>
<li><a href="http://blog.csdn.net/zhongweijian?viewmode=list" target="_blank"><img src="" alt="">摘要视图</a></li>
<li><a href="http://blog.csdn.net/zhongweijian/rss/list" target="_blank"><img src="" alt="">订阅</a>
<a href="http://blog.csdn.net/blogdevteam/article/details/8055079" target="_blank">“移动开发那点事”——主题征文活动</a>    <a href="http://hbtc2012.hadooper.cn/" target="_blank">浓缩六届精华，国内大数据领域最纯粹技术盛会</a>     <a href="http://blog.csdn.net/liushizao/article/details/8012164" target="_blank">CSDN高校俱乐部专家巡讲讲师招募</a>
<a href="http://mdcc.csdn.net/" target="_blank">移动开发者大会最新议题发布，八折抢票！</a>     <a href="http://blog.csdn.net/csdnproduct/article/details/8071931" target="_blank">新版论坛全民公测！</a>    <a href="http://blog.csdn.net/blogdevteam/article/details/8052186" target="_blank">2012年10月当选微软MVP的CSDN会员名单揭晓！</a></li>
</ul>
<h3 id="-httpurlconnection-java-host-ip-"><a href="">HttpUrlConnection底层实现和关于java host绑定ip即时生效的设置及分析</a></h3>
<p>分类： <a href="http://blog.csdn.net/zhongweijian/article/category/640345" target="_blank">java</a>  2012-05-31 13:49 202人阅读 <a href="http://blog.csdn.net/zhongweijian/article/details/7619453#comments" target="_blank">评论</a>(0) <a href="&quot;收藏&quot;">收藏</a> <a href="http://blog.csdn.net/zhongweijian/article/details/7619453#report" title="举报" target="_blank">举报</a>
<strong>[java]</strong> <a href="http://blog.csdn.net/zhongweijian/article/details/7619453#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/zhongweijian/article/details/7619453#" title="copy" target="_blank">copy</a><a href="http://blog.csdn.net/zhongweijian/article/details/7619453#" title="print" target="_blank">print</a><a href="http://blog.csdn.net/zhongweijian/article/details/7619453#" title="?" target="_blank">?</a></p>
<ol>
<li>最近有个需求需要对于获取URL页面进行host绑定并且立即生效，在java里面实现可以用代理服务器来实现：因为在测试环境下可能需要通过绑定来访问测试环境的应用  </li>
<li>实现代码如下：  </li>
<li></li>
<li>public static String getResponseText(String queryUrl,String host,String ip) { //queryUrl，完整的url，host和ip需要绑定的host和ip  </li>
<li>InputStream is = null;  </li>
<li>BufferedReader br = null;  </li>
<li>StringBuffer res = new StringBuffer();  </li>
<li>try {  </li>
<li>HttpURLConnection httpUrlConn = null;  </li>
<li>URL url = new URL(queryUrl);  </li>
<li>if(ip!=null){  </li>
<li>String str[] = ip.split(&quot;\.&quot;);  </li>
<li>byte[] b =new byte[str.length];  </li>
<li>for(int i=0,len=str.length;i&lt;len;i++){  </li>
<li>b[i] = (byte)(Integer.parseInt(str[i],10));  </li>
<li>}  </li>
<li>Proxy proxy = new Proxy(Proxy.Type.HTTP,  </li>
<li>new InetSocketAddress(InetAddress.getByAddress(b), 80));  //b是绑定的ip，生成proxy代理对象，因为http底层是socket实现，  </li>
<li>httpUrlConn = (HttpURLConnection) url  </li>
<li>.openConnection(proxy);  </li>
<li>}else{  </li>
<li>httpUrlConn = (HttpURLConnection) url  </li>
<li>.openConnection();   </li>
<li>}  </li>
<li>httpUrlConn.setRequestMethod(&quot;GET&quot;);  </li>
<li>httpUrlConn.setDoOutput(true);  </li>
<li>httpUrlConn.setConnectTimeout(2000);  </li>
<li>httpUrlConn.setReadTimeout(2000);  </li>
<li>httpUrlConn.setDefaultUseCaches(false);  </li>
<li>httpUrlConn.setUseCaches(false);  </li>
<li></li>
<li>is = httpUrlConn.getInputStream();  </li>
<li></li>
<li></li>
<li>那么底层对于proxy对象到底是怎么处理，底层的socket实现到底怎么样，带着这个疑惑看了下jdk的rt.jar对于这块的处理  </li>
<li>httpUrlConn = (HttpURLConnection) url.openConnection(proxy)  </li>
<li></li>
<li>java.net.URL类里面的openConnection方法：  </li>
<li>public URLConnection openConnection(Proxy proxy){  </li>
<li>…  </li>
<li>return handler.openConnection(this, proxy); Handler是sun.net.www.protocol.http.Handler.java类，继承java.net. URLStreamHandler.java类，用来处理http连接请求响应的。  </li>
<li>}  </li>
<li></li>
<li>Handler的方法：  </li>
<li>protected java.net.URLConnection openConnection(URL u, Proxy p)  </li>
<li>throws IOException {  </li>
<li>return new HttpURLConnection(u, p, this);  </li>
<li>}  </li>
<li></li>
<li>只是简单的生成sun.net.www.protocl.http.HttpURLConnection对象，并进行初始化  </li>
<li>protected HttpURLConnection(URL u, Proxy p, Handler handler) {  </li>
<li>super(u);  </li>
<li>requests = new MessageHeader();  请求头信息生成类  </li>
<li>responses = new MessageHeader(); 响应头信息解析类  </li>
<li>this.handler = handler;   </li>
<li>instProxy = p;  代理服务器对象  </li>
<li>cookieHandler = (CookieHandler)java.security.AccessController.doPrivileged(  </li>
<li>new java.security.PrivilegedAction() {  </li>
<li>public Object run() {  </li>
<li>return CookieHandler.getDefault();  </li>
<li>}  </li>
<li>});  </li>
<li>cacheHandler = (ResponseCache)java.security.AccessController.doPrivileged(  </li>
<li>new java.security.PrivilegedAction() {  </li>
<li>public Object run() {  </li>
<li>return ResponseCache.getDefault();  </li>
<li>}  </li>
<li>});  </li>
<li>}  </li>
<li></li>
<li></li>
<li>最终在httpUrlConn.getInputStream();才进行socket连接，发送http请求，解析http响应信息。具体过程如下：  </li>
<li></li>
<li>sun.net.www.protocl.http.HttpURLConnection.java的getInputStream方法：  </li>
<li></li>
<li>public synchronized InputStream getInputStream() throws IOException {  </li>
<li></li>
<li>...socket连接  </li>
<li>connect();  </li>
<li>...  </li>
<li>ps = (PrintStream)http.getOutputStream(); 获得输出流，打开连接之后已经生成。  </li>
<li></li>
<li>if (!streaming()) {  </li>
<li>writeRequests();  输出http请求头信息  </li>
<li>}  </li>
<li>...  </li>
<li>http.parseHTTP(responses, pi, this);  解析响应信息  </li>
<li>if(logger.isLoggable(Level.FINEST)) {  </li>
<li>logger.fine(responses.toString());  </li>
<li>}  </li>
<li>inputStream = http.getInputStream();  获得输入流  </li>
<li>}  </li>
<li></li>
<li>其中connect()调用方法链：  </li>
<li>plainConnect(){  </li>
<li>...  </li>
<li>Proxy p = null;  </li>
<li>if (sel != null) {  </li>
<li>URI uri = sun.net.www.ParseUtil.toURI(url);  </li>
<li>Iterator<Proxy> it = sel.select(uri).iterator();  </li>
<li>while (it.hasNext()) {  </li>
<li>p = it.next();  </li>
<li>try {  </li>
<li>if (!failedOnce) {  </li>
<li>http = getNewHttpClient(url, p, connectTimeout);  </li>
<li>...  </li>
<li>}  </li>
<li></li>
<li>getNewHttpClient(){  </li>
<li>...  </li>
<li>return HttpClient.New(url, p, connectTimeout, useCache);  </li>
<li>...  </li>
<li>}  </li>
<li></li>
<li>下面跟进去最终建立socket连接的代码：  </li>
<li>sun.net.www.http.HttpClient.java的openServer()方法建立socket连接：  </li>
<li></li>
<li>protected synchronized void openServer() throws IOException {  </li>
<li>...  </li>
<li>if ((proxy != null) &amp;&amp; (proxy.type() == Proxy.Type.HTTP)) {  </li>
<li>sun.net.www.URLConnection.setProxiedHost(host);  </li>
<li>if (security != null) {  </li>
<li>security.checkConnect(host, port);  </li>
<li>}  </li>
<li>privilegedOpenServer((InetSocketAddress) proxy.address());最终socket连接的是设置的代理服务器的地址，  </li>
<li>...  </li>
<li>}  </li>
<li></li>
<li>private synchronized void privilegedOpenServer(final InetSocketAddress server)  </li>
<li>throws IOException  </li>
<li>{  </li>
<li>try {  </li>
<li>java.security.AccessController.doPrivileged(  </li>
<li>new java.security.PrivilegedExceptionAction() {  </li>
<li>public Object run() throws IOException {  </li>
<li>openServer(server.getHostName(), server.getPort());  注意openserver函数  这里的server的getHostName是设置的代理服务器，（ip或者hostname，如果是host绑定设置的代理服务器的ip，那么这里getHostName出来的就是ip地址，可以去查看InetSocketAddress类的getHostName方法）  </li>
<li>return null;  </li>
<li>}  </li>
<li>});  </li>
<li>} catch (java.security.PrivilegedActionException pae) {  </li>
<li>throw (IOException) pae.getException();  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>public void openServer(String server, int port) throws IOException {  </li>
<li>serverSocket = doConnect(server, port);  生成的Socket连接对象  </li>
<li>try {  </li>
<li>serverOutput = new PrintStream(  </li>
<li>new BufferedOutputStream(serverSocket.getOutputStream()),  </li>
<li>false, encoding);   生成输出流，  </li>
<li>} catch (UnsupportedEncodingException e) {  </li>
<li>throw new InternalError(encoding+&quot; encoding not found&quot;);  </li>
<li>}  </li>
<li>serverSocket.setTcpNoDelay(true);  </li>
<li>}  </li>
<li></li>
<li></li>
<li>protected Socket doConnect (String server, int port)  </li>
<li>throws IOException, UnknownHostException {  </li>
<li>Socket s;  </li>
<li>if (proxy != null) {  </li>
<li>if (proxy.type() == Proxy.Type.SOCKS) {  </li>
<li>s = (Socket) AccessController.doPrivileged(  </li>
<li>new PrivilegedAction() {  </li>
<li>public Object run() {  </li>
<li>return new Socket(proxy);  </li>
<li>}});  </li>
<li>} else  </li>
<li>s = new Socket(Proxy.NO_PROXY);  </li>
<li>} else  </li>
<li>s = new Socket();  </li>
<li>// Instance specific timeouts do have priority, that means  </li>
<li>// connectTimeout &amp; readTimeout (-1 means not set)  </li>
<li>// Then global default timeouts  </li>
<li>// Then no timeout.  </li>
<li>if (connectTimeout &gt;= 0) {  </li>
<li>s.connect(new InetSocketAddress(server, port), connectTimeout);  </li>
<li>} else {  </li>
<li>if (defaultConnectTimeout &gt; 0) {  </li>
<li>s.connect(new InetSocketAddress(server, port), defaultConnectTimeout);//连接到代理服务器，看下面Socket类的connect方法代码  </li>
<li>} else {  </li>
<li>s.connect(new InetSocketAddress(server, port));  </li>
<li>}  </li>
<li>}  </li>
<li>if (readTimeout &gt;= 0)  </li>
<li>s.setSoTimeout(readTimeout);  </li>
<li>else if (defaultSoTimeout &gt; 0) {  </li>
<li>s.setSoTimeout(defaultSoTimeout);  </li>
<li>}  </li>
<li>return s;  </li>
<li>}  </li>
<li></li>
<li>上面的new InetSocketAddress(server, port)这里会涉及到java DNS cache的处理，  </li>
<li></li>
<li>public InetSocketAddress(String hostname, int port) {  </li>
<li>if (port &lt; 0 || port &gt; 0xFFFF) {  </li>
<li>throw new IllegalArgumentException(&quot;port out of range:&quot; + port);  </li>
<li>}  </li>
<li>if (hostname == null) {  </li>
<li>throw new IllegalArgumentException(&quot;hostname can&#39;t be null&quot;);  </li>
<li>}  </li>
<li>try {  </li>
<li>addr = InetAddress.getByName(hostname);  //这里会有java DNS缓存的处理，先从缓存取hostname绑定的ip地址，如果取不到再通过OS的DNS cache机制去取，取不到再从DNS服务器上取。  </li>
<li>} catch(UnknownHostException e) {  </li>
<li>this.hostname = hostname;  </li>
<li>addr = null;  </li>
<li>}  </li>
<li>this.port = port;  </li>
<li>}  </li>
<li></li>
<li></li>
<li></li>
<li>当然最终的Socket.java的connect方法  </li>
<li>java.net.socket  </li>
<li></li>
<li>public void connect(SocketAddress endpoint, int timeout) throws IOException {  </li>
<li>if (endpoint == null)  </li>
<li></li>
<li>if (timeout &lt; 0)  </li>
<li>throw new IllegalArgumentException(&quot;connect: timeout can&#39;t be negative&quot;);  </li>
<li></li>
<li>if (isClosed())  </li>
<li>throw new SocketException(&quot;Socket is closed&quot;);  </li>
<li></li>
<li>if (!oldImpl &amp;&amp; isConnected())  </li>
<li>throw new SocketException(&quot;already connected&quot;);  </li>
<li></li>
<li>if (!(endpoint instanceof InetSocketAddress))  </li>
<li>throw new IllegalArgumentException(&quot;Unsupported address type&quot;);  </li>
<li></li>
<li>InetSocketAddress epoint = (InetSocketAddress) endpoint;  </li>
<li></li>
<li>SecurityManager security = System.getSecurityManager();  </li>
<li>if (security != null) {  </li>
<li>if (epoint.isUnresolved())  </li>
<li>security.checkConnect(epoint.getHostName(),  </li>
<li>epoint.getPort());  </li>
<li>else  </li>
<li>security.checkConnect(epoint.getAddress().getHostAddress(),  </li>
<li>epoint.getPort());  </li>
<li>}  </li>
<li>if (!created)  </li>
<li>createImpl(true);  </li>
<li>if (!oldImpl)  </li>
<li>impl.connect(epoint, timeout);  </li>
<li>else if (timeout == 0) {  </li>
<li>if (epoint.isUnresolved())  //如果没有设置SocketAddress的ip地址，则用域名去访问  </li>
<li>impl.connect(epoint.getAddress().getHostName(),  </li>
<li>epoint.getPort());  </li>
<li>else  </li>
<li>impl.connect(epoint.getAddress(), epoint.getPort());  最终socket连接的是设置的SocketAddress的ip地址，  </li>
<li>} else  </li>
<li>throw new UnsupportedOperationException(&quot;SocketImpl.connect(addr, timeout)&quot;);  </li>
<li>connected = true;  </li>
<li>//* </li>
<li>/* If the socket was not bound before the connect, it is now because </li>
<li>/* the kernel will have picked an ephemeral port &amp; a local address </li>
<li>/*/  </li>
<li>bound = true;  </li>
<li>}  </li>
<li></li>
<li></li>
<li></li>
<li>我们再看下通过socket来发送HTTP请求的处理代码，也就是sun.net.www.protocl.http.HttpURLConnection.java的getInputStream方法中调用的writeRequests()方法：   </li>
<li>private void writeRequests() throws IOException {  这段代码就是封装http请求的头请求信息，通过socket发送出去  </li>
<li>//* print all message headers in the MessageHeader </li>
<li>/* onto the wire - all the ones we&#39;ve set and any </li>
<li>/* others that have been set </li>
<li>/*/  </li>
<li>// send any pre-emptive authentication  </li>
<li>if (http.usingProxy) {  </li>
<li>setPreemptiveProxyAuthentication(requests);  </li>
<li>}  </li>
<li>if (!setRequests) {  </li>
<li></li>
<li>//* We&#39;re very particular about the order in which we </li>
<li>/* set the request headers here.  The order should not </li>
<li>/* matter, but some careless CGI programs have been </li>
<li>/* written to expect a very particular order of the </li>
<li>/* standard headers.  To name names, the order in which </li>
<li>/<em> Navigator3.0 sends them.  In particular, we make /</em>sure/* </li>
<li>/* to send Content-type: &lt;&gt; and Content-length:&lt;&gt; second </li>
<li>/* to last and last, respectively, in the case of a POST </li>
<li>/* request. </li>
<li>/*/  </li>
<li>if (!failedOnce)  </li>
<li>requests.prepend(method + &quot; &quot; + http.getURLFile()+&quot; &quot;  +  </li>
<li>httpVersion, null);  </li>
<li>if (!getUseCaches()) {  </li>
<li>requests.setIfNotSet (&quot;Cache-Control&quot;, &quot;no-cache&quot;);  </li>
<li>requests.setIfNotSet (&quot;Pragma&quot;, &quot;no-cache&quot;);  </li>
<li>}  </li>
<li>requests.setIfNotSet(&quot;User-Agent&quot;, userAgent);  </li>
<li>int port = url.getPort();  </li>
<li>String host = url.getHost();  </li>
<li>if (port != -1 &amp;&amp; port != url.getDefaultPort()) {  </li>
<li>host += &quot;:&quot; + String.valueOf(port);  </li>
<li>}  </li>
<li>requests.setIfNotSet(&quot;Host&quot;, host);  </li>
<li>requests.setIfNotSet(&quot;Accept&quot;, acceptString);  </li>
<li></li>
<li>//* </li>
<li>/* For HTTP/1.1 the default behavior is to keep connections alive. </li>
<li>/* However, we may be talking to a 1.0 server so we should set </li>
<li>/* keep-alive just in case, except if we have encountered an error </li>
<li>/* or if keep alive is disabled via a system property </li>
<li>/*/  </li>
<li></li>
<li>// Try keep-alive only on first attempt  </li>
<li>if (!failedOnce &amp;&amp; http.getHttpKeepAliveSet()) {  </li>
<li>if (http.usingProxy) {  </li>
<li>requests.setIfNotSet(&quot;Proxy-Connection&quot;, &quot;keep-alive&quot;);  </li>
<li>} else {  </li>
<li>requests.setIfNotSet(&quot;Connection&quot;, &quot;keep-alive&quot;);  </li>
<li>}  </li>
<li>} else {  </li>
<li>//* </li>
<li>/* RFC 2616 HTTP/1.1 section 14.10 says: </li>
<li>/* HTTP/1.1 applications that do not support persistent </li>
<li>/* connections MUST include the &quot;close&quot; connection option </li>
<li>/* in every message </li>
<li>/*/  </li>
<li>requests.setIfNotSet(&quot;Connection&quot;, &quot;close&quot;);  </li>
<li>}  </li>
<li>// Set modified since if necessary  </li>
<li>long modTime = getIfModifiedSince();  </li>
<li>if (modTime != 0 ) {  </li>
<li>Date date = new Date(modTime);  </li>
<li>//use the preferred date format according to RFC 2068(HTTP1.1),  </li>
<li>// RFC 822 and RFC 1123  </li>
<li>SimpleDateFormat fo =  </li>
<li>new SimpleDateFormat (&quot;EEE, dd MMM yyyy HH:mm:ss &#39;GMT&#39;&quot;, Locale.US);  </li>
<li>fo.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));  </li>
<li>requests.setIfNotSet(&quot;If-Modified-Since&quot;, fo.format(date));  </li>
<li>}  </li>
<li>// check for preemptive authorization  </li>
<li>AuthenticationInfo sauth = AuthenticationInfo.getServerAuth(url);  </li>
<li>if (sauth != null &amp;&amp; sauth.supportsPreemptiveAuthorization() ) {  </li>
<li>// Sets &quot;Authorization&quot;  </li>
<li>requests.setIfNotSet(sauth.getHeaderName(), sauth.getHeaderValue(url,method));  </li>
<li>currentServerCredentials = sauth;  </li>
<li>}  </li>
<li></li>
<li>if (!method.equals(&quot;PUT&quot;) &amp;&amp; (poster != null || streaming())) {  </li>
<li>requests.setIfNotSet (&quot;Content-type&quot;,  </li>
<li>&quot;application/x-www-form-urlencoded&quot;);  </li>
<li>}  </li>
<li></li>
<li>if (streaming()) {  </li>
<li>if (chunkLength != -1) {  </li>
<li>requests.set (&quot;Transfer-Encoding&quot;, &quot;chunked&quot;);  </li>
<li>} else {  </li>
<li>requests.set (&quot;Content-Length&quot;, String.valueOf(fixedContentLength));  </li>
<li>}  </li>
<li>} else if (poster != null) {  </li>
<li>//<em> add Content-Length &amp; POST/PUT data /</em>/  </li>
<li>synchronized (poster) {  </li>
<li>//<em> close it, so no more data can be added /</em>/  </li>
<li>poster.close();  </li>
<li>requests.set(&quot;Content-Length&quot;,  </li>
<li>String.valueOf(poster.size()));  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>// get applicable cookies based on the uri and request headers  </li>
<li>// add them to the existing request headers  </li>
<li>setCookieHeader();  </li>
<li>…  </li>
<li>}  </li>
<li></li>
<li></li>
<li>再来看看把socket响应信息解析为http的响应信息的代码：  </li>
<li>sun.net.www.http.HttpClient.java的parseHTTP方法：  </li>
<li>private boolean parseHTTPHeader(MessageHeader responses, ProgressSource pi, HttpURLConnection httpuc)  </li>
<li>throws IOException {  </li>
<li>//<em> If &quot;HTTP//</em>&quot; is found in the beginning, return true.  Let </li>
<li>/* HttpURLConnection parse the mime header itself. </li>
<li>/* </li>
<li>/* If this isn&#39;t valid HTTP, then we don&#39;t try to parse a header </li>
<li>/* out of the beginning of the response into the responses, </li>
<li>/* and instead just queue up the output stream to it&#39;s very beginning. </li>
<li>/* This seems most reasonable, and is what the NN browser does. </li>
<li>/*/  </li>
<li></li>
<li>keepAliveConnections = -1;  </li>
<li>keepAliveTimeout = 0;  </li>
<li></li>
<li>boolean ret = false;  </li>
<li>byte[] b = new byte[8];  </li>
<li></li>
<li>try {  </li>
<li>int nread = 0;  </li>
<li>serverInput.mark(10);  </li>
<li>while (nread &lt; 8) {  </li>
<li>int r = serverInput.read(b, nread, 8 - nread);  </li>
<li>if (r &lt; 0) {  </li>
<li>break;  </li>
<li>}  </li>
<li>nread += r;  </li>
<li>}  </li>
<li>String keep=null;  </li>
<li>ret = b[0] == &#39;H&#39; &amp;&amp; b[1] == &#39;T&#39;  </li>
<li>&amp;&amp; b[2] == &#39;T&#39; &amp;&amp; b[3] == &#39;P&#39; &amp;&amp; b[4] == &#39;/&#39; &amp;&amp;  </li>
<li>b[5] == &#39;1&#39; &amp;&amp; b[6] == &#39;.&#39;;  </li>
<li>serverInput.reset();  </li>
<li>if (ret) { // is valid HTTP - response started w/ &quot;HTTP/1.&quot;  </li>
<li>responses.parseHeader(serverInput);  </li>
<li></li>
<li>// we&#39;ve finished parsing http headers  </li>
<li>// check if there are any applicable cookies to set (in cache)  </li>
<li>if (cookieHandler != null) {  </li>
<li>URI uri = ParseUtil.toURI(url);  </li>
<li>// NOTE: That cast from Map shouldn&#39;t be necessary but  </li>
<li>// a bug in javac is triggered under certain circumstances  </li>
<li>// So we do put the cast in as a workaround until  </li>
<li>// it is resolved.  </li>
<li>if (uri != null)  </li>
<li>cookieHandler.put(uri, (Map<java.lang.String,java.util.List<java.lang.String>&gt;)responses.getHeaders());  </li>
<li>}  </li>
<li></li>
<li>//* decide if we&#39;re keeping alive: </li>
<li>/* This is a bit tricky.  There&#39;s a spec, but most current </li>
<li>/* servers (10/1/96) that support this differ in dialects. </li>
<li>/* If the server/client misunderstand each other, the </li>
<li>/* protocol should fall back onto HTTP/1.0, no keep-alive. </li>
<li>/*/  </li>
<li>if (usingProxy) { // not likely a proxy will return this  </li>
<li>keep = responses.findValue(&quot;Proxy-Connection&quot;);  </li>
<li>}  </li>
<li>if (keep == null) {  </li>
<li>keep = responses.findValue(&quot;Connection&quot;);  </li>
<li>}  </li>
<li>if (keep != null &amp;&amp; keep.toLowerCase().equals(&quot;keep-alive&quot;)) {  </li>
<li>//* some servers, notably Apache1.1, send something like: </li>
<li>/* &quot;Keep-Alive: timeout=15, max=1&quot; which we should respect. </li>
<li>/*/  </li>
<li>HeaderParser p = new HeaderParser(  </li>
<li>responses.findValue(&quot;Keep-Alive&quot;));  </li>
<li>if (p != null) {  </li>
<li>//<em> default should be larger in case of proxy /</em>/  </li>
<li>keepAliveConnections = p.findInt(&quot;max&quot;, usingProxy?50:5);  </li>
<li>keepAliveTimeout = p.findInt(&quot;timeout&quot;, usingProxy?60:5);  </li>
<li>}  </li>
<li>} else if (b[7] != &#39;0&#39;) {  </li>
<li>//* </li>
<li>/* We&#39;re talking 1.1 or later. Keep persistent until </li>
<li>/* the server says to close. </li>
<li>/*/  </li>
<li>if (keep != null) {  </li>
<li>//* </li>
<li>/* The only Connection token we understand is close. </li>
<li>/* Paranoia: if there is any Connection header then </li>
<li>/* treat as non-persistent. </li>
<li>/*/  </li>
<li>keepAliveConnections = 1;  </li>
<li>} else {  </li>
<li>keepAliveConnections = 5;  </li>
<li>}  </li>
<li>}  </li>
<li>……  </li>
<li>}  </li>
<li></li>
<li></li>
<li>对于java.net包的http，ftp等各种协议的底层实现，可以参考rt.jar下面的几个包的代码：  </li>
<li>sun.net.www.protocl下的几个包。  </li>
<li></li>
<li></li>
<li>在http client中也可以设置代理：  </li>
<li>HostConfiguration conf = new HostConfiguration();  </li>
<li>conf.setHost(host);  </li>
<li>conf.setProxy(ip, 80);  </li>
<li>statusCode = httpclient.executeMethod(conf,getMethod);  </li>
<li></li>
<li>httpclient自己也是基于socket封装的http处理的库。底层代理的实现是一样的。  </li>
<li></li>
<li></li>
<li>另外一种不设置代理，通过反射修改InetAddress的cache也是ok的。但是这种方法非常不推荐，不要使用，因为对于proxy代理服务器概念了解不清楚，最开始还使用这种方法，  </li>
<li>public static void jdkDnsNoCache(final String host, final String ip)  </li>
<li>throws SecurityException, NoSuchFieldException,  </li>
<li>IllegalArgumentException, IllegalAccessException {  </li>
<li>if (StringUtils.isBlank(host)) {  </li>
<li>return;  </li>
<li>}  </li>
<li>final Class clazz = java.net.InetAddress.class;  </li>
<li>final Field cacheField = clazz.getDeclaredField(&quot;addressCache&quot;);  </li>
<li>cacheField.setAccessible(true);  </li>
<li>final Object o = cacheField.get(clazz);  </li>
<li>Class clazz2 = o.getClass();  </li>
<li>final Field cacheMapField = clazz2.getDeclaredField(&quot;cache&quot;);  </li>
<li>cacheMapField.setAccessible(true);  </li>
<li>final Map cacheMap = (Map) cacheMapField.get(o);  </li>
<li>AccessController.doPrivileged(new PrivilegedAction() {  </li>
<li>public Object run() {  </li>
<li>try {  </li>
<li>synchronized (o) {// 同步是必须的,因为o可能会有多个线程同时访问修改。  </li>
<li>// cacheMap.clear();//这步比较关键，用于清除原来的缓存  </li>
<li>//                   cacheMap.remove(host);  </li>
<li>if (!StringUtils.isBlank(ip)) {  </li>
<li>InetAddress inet = InetAddress.getByAddress(host,IPUtil.int2byte(ip));  </li>
<li>InetAddress addressstart = InetAddress.getByName(host);  </li>
<li>Object cacheEntry = cacheMap.get(host);  </li>
<li>cacheMap.put(host,newCacheEntry(inet,cacheEntry));  </li>
<li>//                       cacheMap.put(host,newCacheEntry(newInetAddress(host, ip)));  </li>
<li>}else{  </li>
<li>cacheMap.remove(host);  </li>
<li>}  </li>
<li>//                   System.out.println(getStaticProperty(  </li>
<li>//                          &quot;java.net.InetAddress&quot;, &quot;addressCacheInit&quot;));  </li>
<li>// System.out.println(invokeStaticMethod(&quot;java.net.InetAddress&quot;,&quot;getCachedAddress&quot;,new  </li>
<li>// Object[]{host}));  </li>
<li>}  </li>
<li>} catch (Throwable te) {  </li>
<li>throw new RuntimeException(te);  </li>
<li>}  </li>
<li>return null;  </li>
<li>}  </li>
<li>});  </li>
<li>final Map cacheMapafter = (Map) cacheMapField.get(o);  </li>
<li>System.out.println(cacheMapafter);  </li>
<li></li>
<li>}  </li>
<li></li>
<li>关于java中对于DNS的缓存设置可以参考：  </li>
<li>1.在${java_home}/jre/lib/secuiry/java.secuiry文件，修改下面为   </li>
<li>networkaddress.cache.negative.ttl=0   DNS解析不成功的缓存时间  </li>
<li>networkaddress.cache.ttl=0    DNS解析成功的缓存的时间  </li>
<li>2.jvm启动时增加下面两个启动环境变量  </li>
<li>-Dsun.net.inetaddr.ttl=0  </li>
<li>-Dsun.net.inetaddr.negative.ttl=0  </li>
<li></li>
<li></li>
<li>如果在java程序中使用，可以这么设置设置：  </li>
<li>java.security.Security.setProperty(&quot;networkaddress.cache.ttl&quot; , &quot;0&quot;);  </li>
<li>java.security.Security.setProperty(&quot;networkaddress.cache.negative.ttl&quot; , &quot;0&quot;);  </li>
<li></li>
<li>还有几篇文档链接可以查看：  </li>
<li><a href="http://www.rgagnon.com/javadetails/java-0445.html" target="_blank">http://www.rgagnon.com/javadetails/java-0445.html</a>  </li>
<li><a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6247501" target="_blank">http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6247501</a>  </li>
<li></li>
<li>linux下关于ＯＳ　ＤＮＳ设置的几个文件是  </li>
<li>/etc/resolve.conf  </li>
<li>/etc/nscd.conf  </li>
<li>/etc/nsswitch.conf  </li>
<li></li>
<li><a href="http://www.linuxfly.org/post/543/" target="_blank">http://www.linuxfly.org/post/543/</a>  </li>
<li><a href="http://linux.die.net/man/5/nscd.conf" target="_blank">http://linux.die.net/man/5/nscd.conf</a>  </li>
<li><a href="http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_:_Ch18_:_Configuring_DNS" target="_blank">http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_:_Ch18_:_Configuring_DNS</a>  </li>
<li><a href="http://linux.die.net/man/5/nscd.conf" target="_blank">http://linux.die.net/man/5/nscd.conf</a><br>最近有个需求需要对于获取URL页面进行host绑定并且立即生效，在java里面实现可以用代理服务器来实现：因为在测试环境下可能需要通过绑定来访问测试环境的应用 实现代码如下： public static String getResponseText(String queryUrl,String host,String ip) { //queryUrl，完整的url，host和ip需要绑定的host和ip InputStream is = null; BufferedReader br = null; StringBuffer res = new StringBuffer(); try { HttpURLConnection httpUrlConn = null; URL url = new URL(queryUrl); if(ip!=null){ String str[] = ip.split(&quot;\.&quot;); byte[] b =new byte[str.length]; for(int i=0,len=str.length;i<len;i++){ b[i] = (byte)(Integer.parseInt(str[i],10)); } Proxy proxy = new Proxy(Proxy.Type.HTTP, new InetSocketAddress(InetAddress.getByAddress(b), 80)); //b是绑定的ip，生成proxy代理对象，因为http底层是socket实现， httpUrlConn = (HttpURLConnection) url .openConnection(proxy); }else{ httpUrlConn = (HttpURLConnection) url .openConnection(); } httpUrlConn.setRequestMethod("GET"); httpUrlConn.setDoOutput(true); httpUrlConn.setConnectTimeout(2000); httpUrlConn.setReadTimeout(2000); httpUrlConn.setDefaultUseCaches(false); httpUrlConn.setUseCaches(false); is = httpUrlConn.getInputStream(); 那么底层对于proxy对象到底是怎么处理，底层的socket实现到底怎么样，带着这个疑惑看了下jdk的rt.jar对于这块的处理 httpUrlConn = (HttpURLConnection) url.openConnection(proxy) java.net.URL类里面的openConnection方法： public URLConnection openConnection(Proxy proxy){ … return handler.openConnection(this, proxy); Handler是sun.net.www.protocol.http.Handler.java类，继承java.net. URLStreamHandler.java类，用来处理http连接请求响应的。 } Handler的方法： protected java.net.URLConnection openConnection(URL u, Proxy p) throws IOException { return new HttpURLConnection(u, p, this); } 只是简单的生成sun.net.www.protocl.http.HttpURLConnection对象，并进行初始化 protected HttpURLConnection(URL u, Proxy p, Handler handler) { super(u); requests = new MessageHeader(); 请求头信息生成类 responses = new MessageHeader(); 响应头信息解析类 this.handler = handler; instProxy = p; 代理服务器对象 cookieHandler = (CookieHandler)java.security.AccessController.doPrivileged( new java.security.PrivilegedAction() { public Object run() { return CookieHandler.getDefault(); } }); cacheHandler = (ResponseCache)java.security.AccessController.doPrivileged( new java.security.PrivilegedAction() { public Object run() { return ResponseCache.getDefault(); } }); } 最终在httpUrlConn.getInputStream();才进行socket连接，发送http请求，解析http响应信息。具体过程如下： sun.net.www.protocl.http.HttpURLConnection.java的getInputStream方法： public synchronized InputStream getInputStream() throws IOException { ...socket连接 connect(); ... ps = (PrintStream)http.getOutputStream(); 获得输出流，打开连接之后已经生成。 if (!streaming()) { writeRequests(); 输出http请求头信息 } ... http.parseHTTP(responses, pi, this); 解析响应信息 if(logger.isLoggable(Level.FINEST)) { logger.fine(responses.toString()); } inputStream = http.getInputStream(); 获得输入流 } 其中connect()调用方法链： plainConnect(){ ... Proxy p = null; if (sel != null) { URI uri = sun.net.www.ParseUtil.toURI(url); Iterator<Proxy> it = sel.select(uri).iterator(); while (it.hasNext()) { p = it.next(); try { if (!failedOnce) { http = getNewHttpClient(url, p, connectTimeout); ... } getNewHttpClient(){ ... return HttpClient.New(url, p, connectTimeout, useCache); ... } 下面跟进去最终建立socket连接的代码： sun.net.www.http.HttpClient.java的openServer()方法建立socket连接： protected synchronized void openServer() throws IOException { ... if ((proxy != null) &amp;&amp; (proxy.type() == Proxy.Type.HTTP)) { sun.net.www.URLConnection.setProxiedHost(host); if (security != null) { security.checkConnect(host, port); } privilegedOpenServer((InetSocketAddress) proxy.address());最终socket连接的是设置的代理服务器的地址， ... } private synchronized void privilegedOpenServer(final InetSocketAddress server) throws IOException { try { java.security.AccessController.doPrivileged( new java.security.PrivilegedExceptionAction() { public Object run() throws IOException { openServer(server.getHostName(), server.getPort()); 注意openserver函数 这里的server的getHostName是设置的代理服务器，（ip或者hostname，如果是host绑定设置的代理服务器的ip，那么这里getHostName出来的就是ip地址，可以去查看InetSocketAddress类的getHostName方法） return null; } }); } catch (java.security.PrivilegedActionException pae) { throw (IOException) pae.getException(); } } public void openServer(String server, int port) throws IOException { serverSocket = doConnect(server, port); 生成的Socket连接对象 try { serverOutput = new PrintStream( new BufferedOutputStream(serverSocket.getOutputStream()), false, encoding); 生成输出流， } catch (UnsupportedEncodingException e) { throw new InternalError(encoding+&quot; encoding not found&quot;); } serverSocket.setTcpNoDelay(true); } protected Socket doConnect (String server, int port) throws IOException, UnknownHostException { Socket s; if (proxy != null) { if (proxy.type() == Proxy.Type.SOCKS) { s = (Socket) AccessController.doPrivileged( new PrivilegedAction() { public Object run() { return new Socket(proxy); }}); } else s = new Socket(Proxy.NO<em>PROXY); } else s = new Socket(); // Instance specific timeouts do have priority, that means // connectTimeout &amp; readTimeout (-1 means not set) // Then global default timeouts // Then no timeout. if (connectTimeout &gt;= 0) { s.connect(new InetSocketAddress(server, port), connectTimeout); } else { if (defaultConnectTimeout &gt; 0) { s.connect(new InetSocketAddress(server, port), defaultConnectTimeout);//连接到代理服务器，看下面Socket类的connect方法代码 } else { s.connect(new InetSocketAddress(server, port)); } } if (readTimeout &gt;= 0) s.setSoTimeout(readTimeout); else if (defaultSoTimeout &gt; 0) { s.setSoTimeout(defaultSoTimeout); } return s; } 上面的new InetSocketAddress(server, port)这里会涉及到java DNS cache的处理， public InetSocketAddress(String hostname, int port) { if (port &lt; 0 || port &gt; 0xFFFF) { throw new IllegalArgumentException(&quot;port out of range:&quot; + port); } if (hostname == null) { throw new IllegalArgumentException(&quot;hostname can&#39;t be null&quot;); } try { addr = InetAddress.getByName(hostname); //这里会有java DNS缓存的处理，先从缓存取hostname绑定的ip地址，如果取不到再通过OS的DNS cache机制去取，取不到再从DNS服务器上取。 } catch(UnknownHostException e) { this.hostname = hostname; addr = null; } this.port = port; } 当然最终的Socket.java的connect方法 java.net.socket public void connect(SocketAddress endpoint, int timeout) throws IOException { if (endpoint == null) if (timeout &lt; 0) throw new IllegalArgumentException(&quot;connect: timeout can&#39;t be negative&quot;); if (isClosed()) throw new SocketException(&quot;Socket is closed&quot;); if (!oldImpl &amp;&amp; isConnected()) throw new SocketException(&quot;already connected&quot;); if (!(endpoint instanceof InetSocketAddress)) throw new IllegalArgumentException(&quot;Unsupported address type&quot;); InetSocketAddress epoint = (InetSocketAddress) endpoint; SecurityManager security = System.getSecurityManager(); if (security != null) { if (epoint.isUnresolved()) security.checkConnect(epoint.getHostName(), epoint.getPort()); else security.checkConnect(epoint.getAddress().getHostAddress(), epoint.getPort()); } if (!created) createImpl(true); if (!oldImpl) impl.connect(epoint, timeout); else if (timeout == 0) { if (epoint.isUnresolved()) //如果没有设置SocketAddress的ip地址，则用域名去访问 impl.connect(epoint.getAddress().getHostName(), epoint.getPort()); else impl.connect(epoint.getAddress(), epoint.getPort()); 最终socket连接的是设置的SocketAddress的ip地址， } else throw new UnsupportedOperationException(&quot;SocketImpl.connect(addr, timeout)&quot;); connected = true; //<em> /</em> If the socket was not bound before the connect, it is now because /<em> the kernel will have picked an ephemeral port &amp; a local address /</em>/ bound = true; } 我们再看下通过socket来发送HTTP请求的处理代码，也就是sun.net.www.protocl.http.HttpURLConnection.java的getInputStream方法中调用的writeRequests()方法： private void writeRequests() throws IOException { 这段代码就是封装http请求的头请求信息，通过socket发送出去 //<em> print all message headers in the MessageHeader /</em> onto the wire - all the ones we&#39;ve set and any /<em> others that have been set /</em>/ // send any pre-emptive authentication if (http.usingProxy) { setPreemptiveProxyAuthentication(requests); } if (!setRequests) { //<em> We&#39;re very particular about the order in which we /</em> set the request headers here. The order should not /<em> matter, but some careless CGI programs have been /</em> written to expect a very particular order of the /<em> standard headers. To name names, the order in which /</em> Navigator3.0 sends them. In particular, we make /<em>sure/</em> /<em> to send Content-type: &lt;&gt; and Content-length:&lt;&gt; second /</em> to last and last, respectively, in the case of a POST /<em> request. /</em>/ if (!failedOnce) requests.prepend(method + &quot; &quot; + http.getURLFile()+&quot; &quot; + httpVersion, null); if (!getUseCaches()) { requests.setIfNotSet (&quot;Cache-Control&quot;, &quot;no-cache&quot;); requests.setIfNotSet (&quot;Pragma&quot;, &quot;no-cache&quot;); } requests.setIfNotSet(&quot;User-Agent&quot;, userAgent); int port = url.getPort(); String host = url.getHost(); if (port != -1 &amp;&amp; port != url.getDefaultPort()) { host += &quot;:&quot; + String.valueOf(port); } requests.setIfNotSet(&quot;Host&quot;, host); requests.setIfNotSet(&quot;Accept&quot;, acceptString); //<em> /</em> For HTTP/1.1 the default behavior is to keep connections alive. /<em> However, we may be talking to a 1.0 server so we should set /</em> keep-alive just in case, except if we have encountered an error /<em> or if keep alive is disabled via a system property /</em>/ // Try keep-alive only on first attempt if (!failedOnce &amp;&amp; http.getHttpKeepAliveSet()) { if (http.usingProxy) { requests.setIfNotSet(&quot;Proxy-Connection&quot;, &quot;keep-alive&quot;); } else { requests.setIfNotSet(&quot;Connection&quot;, &quot;keep-alive&quot;); } } else { //<em> /</em> RFC 2616 HTTP/1.1 section 14.10 says: /<em> HTTP/1.1 applications that do not support persistent /</em> connections MUST include the &quot;close&quot; connection option /<em> in every message /</em>/ requests.setIfNotSet(&quot;Connection&quot;, &quot;close&quot;); } // Set modified since if necessary long modTime = getIfModifiedSince(); if (modTime != 0 ) { Date date = new Date(modTime); //use the preferred date format according to RFC 2068(HTTP1.1), // RFC 822 and RFC 1123 SimpleDateFormat fo = new SimpleDateFormat (&quot;EEE, dd MMM yyyy HH:mm:ss &#39;GMT&#39;&quot;, Locale.US); fo.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;)); requests.setIfNotSet(&quot;If-Modified-Since&quot;, fo.format(date)); } // check for preemptive authorization AuthenticationInfo sauth = AuthenticationInfo.getServerAuth(url); if (sauth != null &amp;&amp; sauth.supportsPreemptiveAuthorization() ) { // Sets &quot;Authorization&quot; requests.setIfNotSet(sauth.getHeaderName(), sauth.getHeaderValue(url,method)); currentServerCredentials = sauth; } if (!method.equals(&quot;PUT&quot;) &amp;&amp; (poster != null || streaming())) { requests.setIfNotSet (&quot;Content-type&quot;, &quot;application/x-www-form-urlencoded&quot;); } if (streaming()) { if (chunkLength != -1) { requests.set (&quot;Transfer-Encoding&quot;, &quot;chunked&quot;); } else { requests.set (&quot;Content-Length&quot;, String.valueOf(fixedContentLength)); } } else if (poster != null) { //<em> add Content-Length &amp; POST/PUT data /</em>/ synchronized (poster) { //<em> close it, so no more data can be added /</em>/ poster.close(); requests.set(&quot;Content-Length&quot;, String.valueOf(poster.size())); } } // get applicable cookies based on the uri and request headers // add them to the existing request headers setCookieHeader(); … } 再来看看把socket响应信息解析为http的响应信息的代码： sun.net.www.http.HttpClient.java的parseHTTP方法： private boolean parseHTTPHeader(MessageHeader responses, ProgressSource pi, HttpURLConnection httpuc) throws IOException { //<em> If &quot;HTTP//</em>&quot; is found in the beginning, return true. Let /<em> HttpURLConnection parse the mime header itself. /</em> /<em> If this isn&#39;t valid HTTP, then we don&#39;t try to parse a header /</em> out of the beginning of the response into the responses, /<em> and instead just queue up the output stream to it&#39;s very beginning. /</em> This seems most reasonable, and is what the NN browser does. /<em>/ keepAliveConnections = -1; keepAliveTimeout = 0; boolean ret = false; byte[] b = new byte[8]; try { int nread = 0; serverInput.mark(10); while (nread &lt; 8) { int r = serverInput.read(b, nread, 8 - nread); if (r &lt; 0) { break; } nread += r; } String keep=null; ret = b[0] == &#39;H&#39; &amp;&amp; b[1] == &#39;T&#39; &amp;&amp; b[2] == &#39;T&#39; &amp;&amp; b[3] == &#39;P&#39; &amp;&amp; b[4] == &#39;/&#39; &amp;&amp; b[5] == &#39;1&#39; &amp;&amp; b[6] == &#39;.&#39;; serverInput.reset(); if (ret) { // is valid HTTP - response started w/ &quot;HTTP/1.&quot; responses.parseHeader(serverInput); // we&#39;ve finished parsing http headers // check if there are any applicable cookies to set (in cache) if (cookieHandler != null) { URI uri = ParseUtil.toURI(url); // NOTE: That cast from Map shouldn&#39;t be necessary but // a bug in javac is triggered under certain circumstances // So we do put the cast in as a workaround until // it is resolved. if (uri != null) cookieHandler.put(uri, (Map<java.lang.String,java.util.List<java.lang.String>&gt;)responses.getHeaders()); } //</em> decide if we&#39;re keeping alive: /<em> This is a bit tricky. There&#39;s a spec, but most current /</em> servers (10/1/96) that support this differ in dialects. /<em> If the server/client misunderstand each other, the /</em> protocol should fall back onto HTTP/1.0, no keep-alive. /<em>/ if (usingProxy) { // not likely a proxy will return this keep = responses.findValue(&quot;Proxy-Connection&quot;); } if (keep == null) { keep = responses.findValue(&quot;Connection&quot;); } if (keep != null &amp;&amp; keep.toLowerCase().equals(&quot;keep-alive&quot;)) { //</em> some servers, notably Apache1.1, send something like: /<em> &quot;Keep-Alive: timeout=15, max=1&quot; which we should respect. /</em>/ HeaderParser p = new HeaderParser( responses.findValue(&quot;Keep-Alive&quot;)); if (p != null) { //<em> default should be larger in case of proxy /</em>/ keepAliveConnections = p.findInt(&quot;max&quot;, usingProxy?50:5); keepAliveTimeout = p.findInt(&quot;timeout&quot;, usingProxy?60:5); } } else if (b[7] != &#39;0&#39;) { //<em> /</em> We&#39;re talking 1.1 or later. Keep persistent until /<em> the server says to close. /</em>/ if (keep != null) { //<em> /</em> The only Connection token we understand is close. /<em> Paranoia: if there is any Connection header then /</em> treat as non-persistent. /*/ keepAliveConnections = 1; } else { keepAliveConnections = 5; } } …… } 对于java.net包的http，ftp等各种协议的底层实现，可以参考rt.jar下面的几个包的代码： sun.net.www.protocl下的几个包。 在http client中也可以设置代理： HostConfiguration conf = new HostConfiguration(); conf.setHost(host); conf.setProxy(ip, 80); statusCode = httpclient.executeMethod(conf,getMethod); httpclient自己也是基于socket封装的http处理的库。底层代理的实现是一样的。 另外一种不设置代理，通过反射修改InetAddress的cache也是ok的。但是这种方法非常不推荐，不要使用，因为对于proxy代理服务器概念了解不清楚，最开始还使用这种方法， public static void jdkDnsNoCache(final String host, final String ip) throws SecurityException, NoSuchFieldException, IllegalArgumentException, IllegalAccessException { if (StringUtils.isBlank(host)) { return; } final Class clazz = java.net.InetAddress.class; final Field cacheField = clazz.getDeclaredField(&quot;addressCache&quot;); cacheField.setAccessible(true); final Object o = cacheField.get(clazz); Class clazz2 = o.getClass(); final Field cacheMapField = clazz2.getDeclaredField(&quot;cache&quot;); cacheMapField.setAccessible(true); final Map cacheMap = (Map) cacheMapField.get(o); AccessController.doPrivileged(new PrivilegedAction() { public Object run() { try { synchronized (o) {// 同步是必须的,因为o可能会有多个线程同时访问修改。 // cacheMap.clear();//这步比较关键，用于清除原来的缓存 // cacheMap.remove(host); if (!StringUtils.isBlank(ip)) { InetAddress inet = InetAddress.getByAddress(host,IPUtil.int2byte(ip)); InetAddress addressstart = InetAddress.getByName(host); Object cacheEntry = cacheMap.get(host); cacheMap.put(host,newCacheEntry(inet,cacheEntry)); // cacheMap.put(host,newCacheEntry(newInetAddress(host, ip))); }else{ cacheMap.remove(host); } // System.out.println(getStaticProperty( // &quot;java.net.InetAddress&quot;, &quot;addressCacheInit&quot;)); // System.out.println(invokeStaticMethod(&quot;java.net.InetAddress&quot;,&quot;getCachedAddress&quot;,new // Object[]{host})); } } catch (Throwable te) { throw new RuntimeException(te); } return null; } }); final Map cacheMapafter = (Map) cacheMapField.get(o); System.out.println(cacheMapafter); } 关于java中对于DNS的缓存设置可以参考： 1.在${java_home}/jre/lib/secuiry/java.secuiry文件，修改下面为 networkaddress.cache.negative.ttl=0 DNS解析不成功的缓存时间 networkaddress.cache.ttl=0 DNS解析成功的缓存的时间 2.jvm启动时增加下面两个启动环境变量 -Dsun.net.inetaddr.ttl=0 -Dsun.net.inetaddr.negative.ttl=0 如果在java程序中使用，可以这么设置设置： java.security.Security.setProperty(&quot;networkaddress.cache.ttl&quot; , &quot;0&quot;); java.security.Security.setProperty(&quot;networkaddress.cache.negative.ttl&quot; , &quot;0&quot;); 还有几篇文档链接可以查看： <a href="http://www.rgagnon.com/javadetails/java-0445.html" target="_blank">http://www.rgagnon.com/javadetails/java-0445.html</a> <a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6247501" target="_blank">http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6247501</a> linux下关于ＯＳ　ＤＮＳ设置的几个文件是 /etc/resolve.conf /etc/nscd.conf /etc/nsswitch.conf <a href="http://www.linuxfly.org/post/543/" target="_blank">http://www.linuxfly.org/post/543/</a> <a href="http://linux.die.net/man/5/nscd.conf" target="_blank">http://linux.die.net/man/5/nscd.conf</a> <a href="http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO" target="_blank">http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO</a></em>:<em>Ch18</em>:_Configuring_DNS <a href="http://linux.die.net/man/5/nscd.conf" target="_blank">http://linux.die.net/man/5/nscd.conf</a></li>
</ol>
<p>分享到： <a href="&quot;分享到新浪微博&quot;"></a><a href="&quot;分享到腾讯微博&quot;"></a></p>
<ol>
<li>上一篇：<a href="http://blog.csdn.net/zhongweijian/article/details/7619440" target="_blank">jetty源码阅读总结1</a></li>
<li><p>下一篇：<a href="http://blog.csdn.net/zhongweijian/article/details/7619460" target="_blank">关于jetty和webx对于HttpServletResponse getWriter和getOutputStream的处理</a>
查看评论<a href=""></a></p>
<p>暂无评论
您还没有登录,请<a href="http://passport.csdn.net/account/login?from=http%3A%2F%2Fblog.csdn.net%2Fzhongweijian%2Farticle%2Fdetails%2F7619453" target="_blank">[登录]</a>或<a href="http://passport.csdn.net/account/register?from=http%3A%2F%2Fblog.csdn.net%2Fzhongweijian%2Farticle%2Fdetails%2F7619453" target="_blank">[注册]</a></p>
</li>
</ol>
<p>/* 以上用户言论只代表其个人观点，不代表CSDN网站的观点或立场<a href=""></a><a href=""></a>
<a href="http://blog.csdn.net/zhongweijian/article/details/7619453#" title="回到顶部" target="_blank"><img src="" alt="TOP"></a></p>
<p>个人资料</p>
<p><a href="http://my.csdn.net/zhongweijian" target="_blank"><img src="&quot;访问我的空间&quot;" alt=""></a>
<a href="http://my.csdn.net/zhongweijian" target="_blank">zhongweijian</a></p>
<p><a href="http://blog.csdn.net/zhongweijian/article/details/7619453#" title="[加关注]" target="_blank"></a> <a href="http://my.csdn.net/my/letter/send/zhongweijian" title="[发私信]"></a>
<a href="http://medal.blog.csdn.net/allmedal.aspx" target="_blank"><img src="" alt=""></a></p>
<ul>
<li>访问：57737次</li>
<li>积分：2164分</li>
<li><p>排名：第2692名</p>
</li>
<li><p>原创：158篇</p>
</li>
<li>转载：3篇</li>
<li>译文：2篇</li>
<li>评论：30条</li>
</ul>
<p>文章搜索</p>
<p><a href=""></a>
文章分类</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/589017" target="_blank">acm</a>(8)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/657598" target="_blank">flash as</a>(1)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/606568" target="_blank">flex</a>(18)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/640345" target="_blank">java</a>(69)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/586565" target="_blank">java web开发</a>(12)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/644484" target="_blank">linux</a>(7)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/657599" target="_blank">web框架</a>(4)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/610388" target="_blank">数据库</a>(11)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/611805" target="_blank">脚本语言</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/1158398" target="_blank">c&amp;c++</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/1158401" target="_blank">nosql</a>(4)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/1158414" target="_blank">jetty&amp;tomcat</a>(4)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/1158428" target="_blank">开源框架</a>(27)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/1202606" target="_blank">架构</a>(1)</li>
</ul>
<p>文章存档</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2012/10" target="_blank">2012年10月</a>(1)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2012/09" target="_blank">2012年09月</a>(11)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2012/08" target="_blank">2012年08月</a>(14)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2012/07" target="_blank">2012年07月</a>(9)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2012/06" target="_blank">2012年06月</a>(41)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2012/05" target="_blank">2012年05月</a>(20)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2011/07" target="_blank">2011年07月</a>(1)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2010/06" target="_blank">2010年06月</a>(1)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2010/05" target="_blank">2010年05月</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2010/04" target="_blank">2010年04月</a>(1)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2010/03" target="_blank">2010年03月</a>(6)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2010/02" target="_blank">2010年02月</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2010/01" target="_blank">2010年01月</a>(10)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2009/12" target="_blank">2009年12月</a>(15)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2009/11" target="_blank">2009年11月</a>(4)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2009/10" target="_blank">2009年10月</a>(8)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2009/09" target="_blank">2009年09月</a>(10)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2009/08" target="_blank">2009年08月</a>(7)</li>
</ul>
<p>展开
阅读排行</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/8002034" title="HTTP超文本传输协议-HTTP/1.1中文版" target="_blank">HTTP超文本传输协议-HTTP/1.1中文版</a>(3067)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4692368" title="flex使用lineChart和DateTimeAxis实现时序图" target="_blank">flex使用lineChart和DateTimeAxis实现时序图</a>(3046)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4692668" title="flex柱状图和折线图的混合图使用" target="_blank">flex柱状图和折线图的混合图使用</a>(2486)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4742549" title="jython安装和使用" target="_blank">jython安装和使用</a>(1644)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/5381953" title="flex图表坐标轴样式设置" target="_blank">flex图表坐标轴样式设置</a>(1387)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/5113532" title="flex图表数据动态更新效果示例" target="_blank">flex图表数据动态更新效果示例</a>(1255)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/8002208" title="html5 新特性支持的浏览器检测" target="_blank">html5 新特性支持的浏览器检测</a>(1207)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/5047080" title="flex画直线示例" target="_blank">flex画直线示例</a>(1094)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/5339155" title="flash as3.0动态添加属性和方法" target="_blank">flash as3.0动态添加属性和方法</a>(1062)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/7622675" title="lucene3使用示例" target="_blank">lucene3使用示例</a>(998)</li>
</ul>
<p>评论排行</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4692668" title="flex柱状图和折线图的混合图使用" target="_blank">flex柱状图和折线图的混合图使用</a>(4)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4651329" title="Error parsing XML. org.xml.sax.SAXParseException: Element type &quot;sqlMapConfig&quot; must be declared出错解决方法" target="_blank">Error parsing XML. org.xml.sax.SAXParseException: Element type &quot;sqlMapConfig&quot; must be declared出错解决方法</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4517251" title="大数加减乘除求根源码" target="_blank">大数加减乘除求根源码</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/7619460" title="关于jetty和webx对于HttpServletResponse getWriter和getOutputStream的处理" target="_blank">关于jetty和webx对于HttpServletResponse getWriter和getOutputStream的处理</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4742549" title="jython安装和使用" target="_blank">jython安装和使用</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4504272" title="jfreechart图片无法显示问题" target="_blank">jfreechart图片无法显示问题</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/5160136" title="java 缓存框架java caching system使用示例" target="_blank">java 缓存框架java caching system使用示例</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4865966" title="linux c++连接mysql示例" target="_blank">linux c++连接mysql示例</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4494972" title=" oracle 定长字段查询问题 ，ibatis 与pl/sql查询的char类型字段查询不同" target="_blank">oracle 定长字段查询问题 ，ibatis 与pl/sql查询的char类型字段查询不同</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/5069509" title="flex 实现横向树状图" target="_blank">flex 实现横向树状图</a>(1)
推荐文章</li>
</ul>
<p>最新评论</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/7622693#comments" target="_blank">lucene3.6.0的查询条件分析</a></li>
</ul>
<p>main_xtgjfge: 不错——</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/8010745#comments" target="_blank">java内存分配之 Thread Local Allocation Buffer</a></li>
</ul>
<p>chenshufei2: 多个线程不是共享内存共享数据吗，只有进程才有独享的对象吗。，那怎么理解jvm为了优化，给每个线程分配...</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4865966#comments" target="_blank">linux c++连接mysql示例</a></li>
</ul>
<p>zhongweijian: 呵呵，弄错了，</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4865966#comments" target="_blank">linux c++连接mysql示例</a></li>
</ul>
<p>Meteora7: 楼主，换行好像是“\n” 吧</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/7619440#comments" target="_blank">jetty源码阅读总结1</a></li>
</ul>
<p>chancewang001: 很好，学习了</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/7619460#comments" target="_blank">关于jetty和webx对于HttpServletResponse getWriter和getOutputStream的处理</a></li>
</ul>
<p>zhongweijian: webx是做了个adapter能够解决的。</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/7619460#comments" target="_blank">关于jetty和webx对于HttpServletResponse getWriter和getOutputStream的处理</a></li>
</ul>
<p>yj504535760: 还是没有解决这个问题吗</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4742549#comments" target="_blank">jython安装和使用</a></li>
</ul>
<p>iNexus: 试了执行文件的部分。好用，谢谢！</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4517251#comments" target="_blank">大数加减乘除求根源码</a></li>
</ul>
<p>he381835877: 减法有问题啊~&gt;&gt;2 , &gt;&gt;25 &gt;&gt; 329 结果是-696？</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4651329#comments" target="_blank">Error parsing XML. org.xml.sax.SAXParseException: Element type &quot;sqlMapConfig&quot; must be declared出错解决方法</a></li>
</ul>
<p>lendar_2010: @ruelang:多了 Config
      <img src="" alt=""></p>
<p><a href="http://www.csdn.net/company/about.html" target="_blank">公司简介</a>|<a href="http://www.csdn.net/company/recruit.html" target="_blank">招贤纳士</a>|<a href="http://www.csdn.net/company/marketing.html" target="_blank">广告服务</a>|<a href="http://www.csdn.net/company/account.html" target="_blank">银行汇款帐号</a>|<a href="http://www.csdn.net/company/contact.html" target="_blank">联系方式</a>|<a href="http://www.csdn.net/company/statement.html" target="_blank">版权声明</a>|<a href="http://www.csdn.net/company/layer.html" target="_blank">法律顾问</a>|<a href="mailto:webmaster@csdn.net">问题报告</a>京 ICP 证 070598 号北京创新乐知信息技术有限公司 版权所有<img src="" alt=""> 联系邮箱：webmaster(at)csdn.netCopyright © 1999-2012, CSDN.NET, All Rights Reserved <a href="http://www.hd315.gov.cn/beian/view.asp?bianhao=010202001032100010" target="_blank"><img src="" alt="GongshangLogo"></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Httpclient/">Httpclient</a></li></span><span class="breadcrumb"><li><a href="/categories/Httpclient/">Httpclient</a></li><li><a href="/categories/Httpclient/HttpUrlConnection/">HttpUrlConnection</a></li></span></span> | <span class="tags">Tagged <a href="/tags/HttpUrlConnection/" class="label label-primary">HttpUrlConnection</a><a href="/tags/Httpclient/" class="label label-success">Httpclient</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-Httpclient-HttpUrlConnection--HttpUrlConnection底层实现和关于javahost绑定ip即时生效的设置及分析-/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-Httpclient-HttpUrlConnection--HttpUrlConnection底层实现和关于javahost绑定ip即时生效的设置及分析-" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-Httpclient--远程会话与远程桌面同步关闭问题/">远程会话与远程桌面同步关闭问题</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-Httpclient--远程会话与远程桌面同步关闭问题/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">远程会话与远程桌面同步关闭问题</h1>
<p>  <a href="http://blog.zxbc.cn/" target="_blank">专家博客</a> | <a href="http://bbs.zxbc.cn/" target="_blank">论坛</a> | <a href="http://down.zxbc.cn/" target="_blank">下载</a> | <a href="http://sp.zxbc.cn/" target="_blank">视频</a> | <a href="http://www.zxbc.cn/html/network/" target="_blank">网络</a> | <a href="http://dh.zxbc.cn/" target="_blank">导航</a> | <a href="http://www.zxbc.cn/html/windows/" target="_blank">Windows</a> | <a href="http://www.zxbc.cn/html/itrz/" target="_blank">IT认证</a> | <a href="http://down.zxbc.cn/shuji/" target="_blank">书籍</a> | <a href="http://www.zxbc.cn/opensource/" target="_blank">开源</a> | <a href="http://www.zxbc.cn/Solutions/" target="_blank">方案</a> | <a href="http://www.zxbc.cn/html/wzdh/" target="_blank">站内导航</a> <a href="http://www.zxbc.cn/plus/rssmap.html" target="_blank"><img src="" alt=""></a> <a href="http://www.zxbc.cn/" target="_blank"><img src="" alt="中国自学编程网"></a> <a href="http://www.zxbc.cn/html/news/" target="_blank"><strong>资讯</strong></a><a href="http://www.zxbc.cn/html/news/cmsnews/" target="_blank">动态</a><a href="http://www.zxbc.cn/html/ITnews/" target="_blank">业界</a>  <a href="http://www.zxbc.cn/html/kfyy/" title="编程语言" target="_blank"><strong>语言</strong></a><a href="http://www.zxbc.cn/html/Csutdy/" target="_blank">C语言</a><a href="http://www.zxbc.cn/html/cjj/" target="_blank">C++</a><a href="http://www.zxbc.cn/html/cshorp/" target="_blank">C/#</a><a href="http://www.zxbc.cn/html/vb/" target="_blank">VB</a>  <a href="http://www.zxbc.cn/html/rjkf/" target="_blank"><strong>开发</strong></a><a href="http://www.zxbc.cn/html/erp/" target="_blank">ERP</a><a href="http://www.zxbc.cn/html/pm/" target="_blank">项目管理</a><a href="http://www.zxbc.cn/html/rjgc/" target="_blank">软件工程</a>  <a href="http://www.zxbc.cn/html/sjk/" target="_blank"><strong>数据库</strong></a><a href="http://www.zxbc.cn/html/SQLServer/" target="_blank">MSSQL</a><a href="http://www.zxbc.cn/html/Oracle/" target="_blank">Oracle</a> <a href="http://www.zxbc.cn/html/MySQL/" target="_blank">Mysql</a>  <a href="http://www.zxbc.cn/html/webkaifa/" target="_blank"><strong>WEB</strong></a><a href="http://www.zxbc.cn/html/article/" target="_blank">ASP</a><a href="http://www.zxbc.cn/html/PHP/" target="_blank">PHP</a><a href="http://www.zxbc.cn/html/aspnet/" target="_blank">ASP.NET</a> <a href="http://www.zxbc.cn/html/renwu/" target="_blank">人物</a><a href="http://www.zxbc.cn/html/sydt/" target="_blank">商业</a><a href="http://www.zxbc.cn/html/tongxun/" target="_blank">通讯</a> <a href="http://www.zxbc.cn/html/dnet/" target="_blank">.NET</a><a href="http://www.zxbc.cn/html/java/" target="_blank">JAVA</a><a href="http://www.zxbc.cn/html/DELPHI/" target="_blank">Delphi</a><a href="http://www.zxbc.cn/html/sf/" target="_blank">算法</a> <a href="http://www.zxbc.cn/html/yxkf/" target="_blank">游戏</a><a href="http://www.zxbc.cn/html/qrskf/" target="_blank">嵌入式</a><a href="http://www.zxbc.cn/html/yyzh/" target="_blank">测 试</a><a href="http://www.zxbc.cn/html/3gwl/" target="_blank">移动开发</a> <a href="http://www.zxbc.cn/html/DB2/" target="_blank">IBM-DB2</a> <a href="http://www.zxbc.cn/html/Sybase/" target="_blank">Sybase</a> <a href="http://www.zxbc.cn/html/Access/" target="_blank">ACCESS</a><a href="http://www.zxbc.cn/html/VFP/" target="_blank">VFP</a> <a href="http://www.zxbc.cn/html/xml/" target="_blank">XML</a><a href="http://www.zxbc.cn/html/HEML/" target="_blank">HTML</a><a href="http://www.zxbc.cn/html/article/webprog/" target="_blank">CSS+DIV</a><a href="http://www.zxbc.cn/html/jsp2/" target="_blank">JSP</a>  <a href="http://www.zxbc.cn/" target="_blank">中国自学编程网</a> &gt; <a href="http://www.zxbc.cn/html/Windows/" target="_blank">Windows</a> &gt; <a href="http://www.zxbc.cn/html/oswl/" target="_blank">网络技巧</a> &gt; 正文 <img src="" alt="">   <a href=""></a> <strong>远程会话与远程桌面同步关闭问题</strong> 来源：中国自学编程网   发布日期：2008-06-03   在日常操作中，网管员往往哪个需要通过远程桌面在主机中进行下载、文件安装、程序运行等等操作，这时，即使管理员推出远程桌面我们也希望这些操作照常进行，不要中断，不过在实际情况中却有很多情况不是这样，只要管理员退出这些操作就会同步中断，给网管员的操作带来了很大的不便。从理论上来说，在对服务器主机进行远程控制时，网络管理员只要不对服务器系统执行系统注销操作或重新启动操作，只是简单地单击远程桌面连接窗口右上角处的关闭按钮时，那些通过远程控制方式启动运行的应用程序还应该继续以后台方式运行，并不会跟随远程桌面连接窗口的关闭而同步关闭。但为什么会出现同步关不的问题呢，经过笔者的观察，这主要是设置的问题，只要我们进行了正确的设置，就完全可以避免此种情况的发生。现在，本文就将该故障的详细排除过程贡献出来：</p>
<p>首先看看在远程登录服务器系统时使用的帐号设置是否正确，如果登录帐号的权限不够或者属性参数设置不当的话，那么就容易出现远程会话同步关闭的现象。假设网络管理员以系统管理员帐号“administrator”来远程登录服务器系统的，在检查“administrator”帐号的设置正确性时，我们可以在服务器系统中用鼠标右键单击桌面上的“我的电脑”图标，从弹出的右键菜单中执行“管理”命令，打开服务器系统的计算机管理界面。在该界面的左侧显示区域，用鼠标依次展开“系统工具”/“本地用户和用户组”/“用户”分支选项，在对应“用户”分支选项的右侧显示区域中，选中目标登录帐号“administrator”，并用鼠标右键单击该帐号，再执行右键菜单中的“属性”命令，打开对应帐号的属性设置界面；单击该设置界面中的“会话”选项卡，在对应的选项设置界面中我们会看到“空闲会话限制”、“活动会话限制”、“结束已断开的会话”、“当达到会话极限或连接中断时如何操作的设置”等几个参数（如图1所示）。其中“空闲会话限制”选项是在服务器系统中没有进行任何操作时所要设置的一项参数，“活动会话限制”选项是用来限制服务器系统中活动连接持续使用时间的一种参数，“结束已断开的会话”选项是用来强行关闭某个会话连接的一项参数。为了避免远程会话同步关闭现象的发生，我们必须在这里将上面的各项参数全部修改为“从不”，以确保远程会话不会被服务器系统强行关闭。</p>
<p><img src="&quot;图1&quot;" alt="图1"></p>
<p>图1</p>
<pre><code>其次检查服务器系统中的终端服务配置参数是否正确，如果终端服务器模式设置不当的话，也可能引起远程会话同步关闭的现象。打开服务器系统的“开始”菜单，从中依次选择“程序”/“管理工具”/“终端服务配置”选项，进入终端服务配置界面，选中该界面左侧显示区域的“服务器设置”选项，并在对应该选项的右侧显示区域我们就能看到终端服务器模式究竟是什么了，要是发现终端服务器模式不是“应用程序服务器”模式时，我们必须及时修改过来，并且还需要在这里将“活动桌面”功能启用起来（如图2所示）。
</code></pre><p><img src="&quot;图2&quot;" alt="图2"></p>
<p>图2</p>
<pre><code>下面我们还要对远程终端服务属性界面中的一些参数进行检查，并且这里的参数设置优先级一般要高于系统登录帐号属性界面中的参数设置。在进行这种检查时，我们可以先按照前面的操作打开服务器系统的终端服务配置界面，之后依次选中“终端服务配置”/“连接”选项，在对应该选项右侧显示区域中用鼠标右键单击“RDP-TCP”选项，从弹出的快捷菜单中执行“属性”命令，打开远程终端服务属性设置界面（如图3所示）；在该设置界面中我们看到了“替代用户设置”这个选项参数，要是将该选项参数选中的话，那么我们之前在系统登录帐号属性界面中设置的各项参数都将不能发挥作用，所有参数都会自动按照远程终端服务属性设置界面中的参数进行处理，要是没有选中“替代用户设置”这个选项参数时，那么我们之前在系统登录帐号属性界面中设置的各项参数才能生效。而且，“替代用户设置”设置项下面，我们同样也会看到“空闲会话限制”、“活动会话限制”、“结束已断开的会话”、“当达到会话极限或连接中断时如何操作的设置”等几个参数，我们可以根据工作需要进行有针对性设置就行了。
</code></pre><p><img src="&quot;图3&quot;" alt="图3"></p>
<p>图3</p>
<pre><code>网络管理员在远程控制单位服务器系统时，发现这里的“替代用户设置”选项被意外选中了，同时“结束已断开的会话”参数也被设置为了1分钟，这也是为什么网络管理员通过远程桌面连接在服务器系统中启动某个会话连接后，单击远程桌面连接窗口中的关闭按钮时该会话连接也会同步关闭的原因。找到故障原因后，问题就很好解决了，网络管理员在这里将“结束已断开的会话”参数设置为了“从不”后，就立即解决了服务器远程会话同步关闭故障。  ![]() 相关文章  关于 **远程会话与远程桌面同步关闭问题** ·[ADSl浅析](http://www.zxbc.cn/html/20080530/51611.html)
</code></pre><p>·<a href="http://www.zxbc.cn/html/20080530/51701.html" target="_blank">Windows 2000 Server DNS维护一点通</a>
·<a href="http://www.zxbc.cn/html/20080530/51959.html" target="_blank">用&quot;连接共享&quot;实现ADSL共享上网</a>
·<a href="http://www.zxbc.cn/html/20080530/51612.html" target="_blank">通过NETBIOS实现信息收集与渗透(1)</a>
·<a href="http://www.zxbc.cn/html/20080530/51636.html" target="_blank">未公开的Windows网络工具</a>
·<a href="http://www.zxbc.cn/html/20080530/51991.html" target="_blank">去除Windows 2000的默认共享</a> <strong>新闻动态</strong> ·<a href="http://www.zxbc.cn/html/20070419/1254.html" target="_blank">网络电视突遇监管风暴 腾讯QQlive停播部份节目</a>
 ·<a href="http://www.zxbc.cn/html/20070419/1111.html" target="_blank">熊猫烧香病毒案告破 8犯罪嫌疑人被抓获</a> ·<a href="http://www.zxbc.cn/html/20070616/22989.html" target="_blank">第三届中国(南京)国际软件产品博览会</a>
 ·<a href="http://www.zxbc.cn/html/20080527/51220.html" target="_blank">百度将推新一代营销平台“我的营销中心”</a> ·<a href="http://www.zxbc.cn/html/20070903/26868.html" target="_blank">微软收购企业群组通讯软件商Parlano</a>
 ·<a href="http://www.zxbc.cn/html/20080311/32227.html" target="_blank">Sun和微软加深合作成立了Sun/微软协作中心</a> ·<a href="http://www.zxbc.cn/html/20070510/16550.html" target="_blank">大企业领袖“高薪低能排行榜”</a>
 ·<a href="http://www.zxbc.cn/html/20070913/26946.html" target="_blank">入侵省内多所高校计算机系统，制贩假文凭被捕</a> ·<a href="http://www.zxbc.cn/html/20071127/29814.html" target="_blank">戴尔代工厂被曝出违反《劳动法》有关规定</a>
 ·<a href="http://www.zxbc.cn/html/20081121/68047.html" target="_blank">互联网公司应主动&quot;锻炼&quot;积极&quot;过冬&quot;</a>   <strong>栏目推荐</strong>   <img src="" alt=""> <img src="" alt=""> ·<a href="http://www.zxbc.cn/html/20080530/51542.html" target="_blank">让PXE无盘工作站使用固定的IP地址</a>
·<a href="http://www.zxbc.cn/html/20080530/51569.html" target="_blank">网络数据库的复制和同步(2)</a>
·<a href="http://www.zxbc.cn/html/20080530/51974.html" target="_blank">需要密码的Windows XP系统的共享文件夹</a>
·<a href="http://www.zxbc.cn/html/20081112/67722.html" target="_blank">巧设IP地址便于简化管理网络</a>
·<a href="http://www.zxbc.cn/html/20080530/51891.html" target="_blank">利用Win XP自带工具实现远程管理</a>
·<a href="http://www.zxbc.cn/html/20080530/51768.html" target="_blank">在网络服务中避免远程引用</a>   <strong>专家博客</strong>   <img src="" alt=""> <img src="" alt=""> <strong>程序人生</strong>   <a href="http://www.zxbc.cn/html/20090524/71367.html" target="_blank"><img src="" alt="编程的首要原则是？"></a> <a href="http://www.zxbc.cn/html/20090524/71367.html" target="_blank">编程的首要原则是？</a> <a href="http://www.zxbc.cn/html/20080829/64957.html" target="_blank"><img src="" alt="北漂IT人如何崛起网络间"></a> <a href="http://www.zxbc.cn/html/20080829/64957.html" target="_blank">北漂IT人如何崛起网络</a> ·<a href="http://www.zxbc.cn/html/20070511/16558.html" target="_blank">JBoss创始人Marc Fleury的成功职业生涯</a>
·<a href="http://www.zxbc.cn/html/20080813/64330.html" target="_blank">怎样才能成为高手?</a>
·<a href="http://www.zxbc.cn/html/20081225/69262.html" target="_blank">亲历惊心48小时,抢救35亿交易数据</a>
·<a href="http://www.zxbc.cn/html/20070804/25703.html" target="_blank">微软架构师谈编程语言发展（一）</a>
·<a href="http://www.zxbc.cn/html/20070519/20020.html" target="_blank">IT人你除了IT还能干什么？</a>
·<a href="http://www.zxbc.cn/html/20070521/20077.html" target="_blank">电子工程师也是十余年了</a> <a href="http://www.zxbc.cn/html/gyzd/" target="_blank">关于站点</a> - <a href="http://www.zxbc.cn/html/gywm/" target="_blank">联系我们</a> - <a href="http://www.zxbc.cn/html/bqys/" target="_blank">版权隐私</a> -  - <a href="http://www.zxbc.cn/html/20080603/56461.html#top" target="_blank">返回顶部</a>  中国自学编程网版权所有 本站原创文章，未经授权禁止转载或建立镜象站点 E-Mail:520it@163.com Tel:15802529892 Copyright 2006-2008 Zxbc.cn Corporation 中国自学编程网倡导软件开发学习文化，崇尚软件开源和共享，致力于帮助编程学习者在各自专业领域取得成功！</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Httpclient/">Httpclient</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Httpclient/" class="label label-primary">Httpclient</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-Httpclient--远程会话与远程桌面同步关闭问题/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-Httpclient--远程会话与远程桌面同步关闭问题" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-Httpclient--注意设置httpclient连接数-黄刚的专栏-CSDN博客/">注意设置httpclient连接数 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-Httpclient--注意设置httpclient连接数-黄刚的专栏-CSDN博客/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-httpclient-csdn-">注意设置httpclient连接数 - 黄刚的专栏 - CSDN博客</h1>
<h1 id="-http-blog-csdn-net-lovingprince-"><a href="http://blog.csdn.net/lovingprince" target="_blank">黄刚的专栏</a></h1>
<h2 id="no-complain-just-do-it-">No Complain ,Just Do It !</h2>
<ul>
<li><a href="http://hi.csdn.net/space-notice.html" target="_blank">条新通知</a></li>
<li><a href="http://passport.csdn.net/UserLogin.aspx" target="_blank">登录</a></li>
<li><a href="http://passport.csdn.net/CSDNUserRegister.aspx" target="_blank">注册</a></li>
<li><a href="http://hi.csdn.net/" target="_blank">欢迎</a></li>
<li><a href="http://writeblog.csdn.net/Signout.aspx" target="_blank">退出</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">我的博客</a></li>
<li><a href="http://writeblog.csdn.net/configure.aspx" target="_blank">配置</a></li>
<li><a href="http://writeblog.csdn.net/PostEdit.aspx" target="_blank">写文章</a></li>
<li><a href="http://writeblog.csdn.net/PostList.aspx" target="_blank">文章管理</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">博客首页</a></li>
</ul>
<p>*</p>
<ul>
<li><p>全站 当前博客
*</p>
</li>
<li><p><a href="http://hi.csdn.net/lovingprince" target="_blank">空间</a></p>
</li>
<li><a href="http://blog.csdn.net/lovingprince" target="_blank">博客</a></li>
<li><a href="http://hi.csdn.net/!s/friend/list/lovingprince" target="_blank">好友</a></li>
<li><a href="http://hi.csdn.net/!s/album/list/lovingprince" target="_blank">相册</a></li>
<li><a href="http://hi.csdn.net/!s/wall/to/lovingprince" target="_blank">留言</a></li>
</ul>
<p>用户操作<a href="http://hi.csdn.net/!s/wall/to/lovingprince" target="_blank">[留言]</a>  <a href="http://hi.csdn.net/!s/msg/to/lovingprince" target="_blank">[发消息]</a>  <a href="http://hi.csdn.net/!s/friend/add/lovingprince" target="_blank">[加为好友]</a> 订阅我的博客<a href="http://feeds.feedsky.com/csdn.net/lovingprince" target="_blank"><img src="" alt="XML聚合"></a>   <a href="http://feeds.feedsky.com/csdn.net/lovingprince" target="_blank"><img src="" alt="FeedSky"></a><a href="http://www.xianguo.com/subscribe.php?url=http://feeds.feedsky.com/csdn.net/lovingprince" target="_blank"><img src="" alt="订阅到鲜果"></a><a href="http://fusion.google.com/add?feedurl=http://feeds.feedsky.com/csdn.net/lovingprince" target="_blank"><img src="" alt="订阅到Google"></a><a href="http://www.zhuaxia.com/add_channel.php?url=http://feeds.feedsky.com/csdn.net/lovingprince" target="_blank"><img src="" alt="订阅到抓虾"></a><a href="http://writeblog.csdn.net/configure.aspx" target="_blank">[编辑]</a>lovingprince的公告权当备忘，分享经验点滴，不在乎内容是否简单，简单中其实更能体现出不平凡，不喜欢空谈的文章，更愿意实际一点，为需要的朋友做点贡献，如果能留下您宝贵的评价，相信您也可以让众多朋友受益，我分享，我快乐。
<a href="http://s.click.taobao.com/t_1?i=qzvnpphF1HNGGA%3D%3D&amp;p=mm_14667228_0_0&amp;n=12" target="_blank"><img src="" alt=""></a> <a href="http://s.click.taobao.com/t_1?i=qzvnpphF1HNGGA%3D%3D&amp;p=mm_14667228_0_0&amp;n=12" target="_blank">《淘宝天下》12个月/52期 260元 送价值599元Black Rivet包</a> 260.0元 <a href="http://s.click.taobao.com/t_1?i=qzvnpphF1HNGGA%3D%3D&amp;p=mm_14667228_0_0&amp;n=12" target="_blank"><img src="" alt=""></a>
<a href="http://s.click.taobao.com/t_1?i=qzvmMjgQtB0UgQ%3D%3D&amp;p=mm_14667228_0_0&amp;n=12" target="_blank"><img src="" alt=""></a> <a href="http://s.click.taobao.com/t_1?i=qzvmMjgQtB0UgQ%3D%3D&amp;p=mm_14667228_0_0&amp;n=12" target="_blank">《淘宝天下》6个月/26期 130元 送瑞士军刀旗舰店398元抵价券</a> 130.0元 <a href="http://s.click.taobao.com/t_1?i=qzvmMjgQtB0UgQ%3D%3D&amp;p=mm_14667228_0_0&amp;n=12" target="_blank"><img src="" alt=""></a>
<a href="http://s.click.taobao.com/t_1?i=qzvmMjm%2Bgumi1Q%3D%3D&amp;p=mm_14667228_0_0&amp;n=12" target="_blank"><img src="" alt=""></a> <a href="http://s.click.taobao.com/t_1?i=qzvmMjm%2Bgumi1Q%3D%3D&amp;p=mm_14667228_0_0&amp;n=12" target="_blank">《淘宝天下》3个月/13期 65元 送OOPS服饰专营店118元抵价券</a> 65.0元 <a href="http://s.click.taobao.com/t_1?i=qzvmMjm%2Bgumi1Q%3D%3D&amp;p=mm_14667228_0_0&amp;n=12" target="_blank"><img src="" alt=""></a><a href="http://writeblog.csdn.net/EditCategories.aspx?catID=1" target="_blank">[编辑]</a>文章分类* <a href="http://blog.csdn.net/lovingprince/category/489565.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/lovingprince/category/489565.aspx" title="架构分析" target="_blank">Architecture</a></p>
<ul>
<li><a href="http://blog.csdn.net/lovingprince/category/284705.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/lovingprince/category/284705.aspx" title="包含一些数据库处理心得" target="_blank">Database</a></li>
<li><a href="http://blog.csdn.net/lovingprince/category/289923.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/lovingprince/category/289923.aspx" title="设计模式" target="_blank">Design Pattern</a></li>
<li><a href="http://blog.csdn.net/lovingprince/category/267838.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/lovingprince/category/267838.aspx" title="包含一些基本的基础常识等" target="_blank">Java</a></li>
<li><a href="http://blog.csdn.net/lovingprince/category/601796.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/lovingprince/category/601796.aspx" title="linux相关， 命令，安装等" target="_blank">Linux</a></li>
<li><a href="http://blog.csdn.net/lovingprince/category/479430.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/lovingprince/category/479430.aspx" title="各种杂类文章" target="_blank">Others</a></li>
<li><a href="http://blog.csdn.net/lovingprince/category/604421.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/lovingprince/category/604421.aspx" title="项目管理" target="_blank">Project Management</a></li>
<li><a href="http://blog.csdn.net/lovingprince/category/289037.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/lovingprince/category/289037.aspx" title="数据结构与算法" target="_blank">Structure&amp;Arithmetic</a></li>
<li><a href="http://blog.csdn.net/lovingprince/category/284725.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/lovingprince/category/284725.aspx" title="记录一些平时开发过程中得到的启示和想法等等&lt;br /&gt;" target="_blank">Thinking</a></li>
<li><a href="http://blog.csdn.net/lovingprince/category/284704.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/lovingprince/category/284704.aspx" title="一些WEB处理技巧和方法" target="_blank">Web</a></li>
<li><a href="http://blog.csdn.net/lovingprince/category/490182.aspx/rss" target="_blank"><img src="" alt="(RSS)"></a><a href="http://blog.csdn.net/lovingprince/category/490182.aspx" title="职场的各大信息" target="_blank">职场风云</a><a href="http://writeblog.csdn.net/EditLinks.aspx" target="_blank">[编辑]</a>代码质量<a href="http://www.gotapi.com/html" target="_blank">各类API查询</a><a href="http://www.ibm.com/developerworks/cn/java/j-cq/" target="_blank">追求代码质量</a><a href="http://www.ibm.com/developerworks/cn/java/j-cq/" target="_blank">追求代码质量: 测试 Struts 遗留的应用程序</a><a href="http://www.ibm.com/developerworks/cn/java/j-cq05227/index.html?S_TACT=105AGX52&amp;S_CMP=techcsdn" target="_blank">追求代码质量: 谨防紧密耦合！</a><a href="http://writeblog.csdn.net/EditLinks.aspx" target="_blank">[编辑]</a>发表论文<a href="http://www.ahcit.com/lanmuyd.asp?id=1972" target="_blank">结合混沌密码理论的彩色图象水印算法</a><a href="http://writeblog.csdn.net/EditLinks.aspx" target="_blank">[编辑]</a>技术文章<a href="http://www.cjsdn.net/post/view?bid=1&amp;id=155312&amp;age=0" target="_blank">finally子句和try子句中return的先后关系，以及原理</a><a href="http://www.elook.net.cn/cms/Site/Article/wlbch15/Java400/J2EEEJBJMS421/45129.html" target="_blank">Hibernate包作用详解</a><a href="http://hsqldb.bokee.com/" target="_blank">HSQLDB中文网站</a><a href="http://dreamstone.javaeye.com/blog/77889" target="_blank">Java 1.5被忽略了的小动作</a><a href="http://www.360doc.com/showweb/0/0/402740.aspx" target="_blank">Java XML API 漫谈</a><a href="http://www.ibm.com/developerworks/cn/java/coretech/index.html?S_TACT=105AGX52&amp;S_CMP=techcsdn" target="_blank">Java 核心技术专题</a><a href="http://ltc603.javaeye.com/blog/123191" target="_blank">JavaScript 打印web页面</a><a href="http://searchwebservices.techtarget.com.cn/tips/362/2158862.shtml" target="_blank">Java类加载内幕</a><a href="http://www.jdon.com/jivejdon/thread/15456.html" target="_blank">Java编程极限考验：ClassLoader类装载策略</a><a href="http://tvjody.javaeye.com/blog/125643" target="_blank">java调用dll</a><a href="http://www.itisedu.com/phrase/200604261751455.html" target="_blank">JMX</a><a href="http://www.sonatype.com/" target="_blank">maven文档</a><a href="http://www.jdon.com/concurrent/reactor.htm" target="_blank">Reactor模式和NIO</a><a href="http://www.ibm.com/developerworks/cn/java/j-ropes/?S_TACT=105AGX52&amp;S_CMP=techcsdn" target="_blank">Rope：理论与实践 为何以及何时使用 Ropes for Java 操纵字符串</a><a href="http://www.ibm.com/developerworks/cn/java/wa-spring1/" target="_blank">Spring 系列: Spring 框架简介</a><a href="http://www-128.ibm.com/developerworks/cn/java/j-sr1.html" target="_blank">Struts 与 Velocity 的集成</a><a href="http://xdoclet.sourceforge.net/xdoclet/ant/xdoclet/modules/hibernate/HibernateDocletTask.html" target="_blank">xdoclet</a><a href="http://www.ibm.com/developerworks/cn/webservices/understand/index.html?S_TACT=105AGX52&amp;S_CMP=techcsdn" target="_blank">了解 Web 服务规范</a><a href="http://www-128.ibm.com/developerworks/cn/opensource/os-cn-cas/?S_TACT=105AGX52&amp;S_CMP=techcsdn" target="_blank">使用 CAS 在 Tomcat 中实现单点登录</a><a href="http://www-128.ibm.com/developerworks/cn/java/j-velocity/" target="_blank">使用 Velocity 实现客户端和服务器端模板</a><a href="http://coolyongzi.javaeye.com/blog/192957" target="_blank">使用spring2.5注释驱动的IOC功能</a><a href="http://www.blogjava.net/hopeshared/archive/2006/10/23/76780.html" target="_blank">初探Java类加载机制的奥秘（zz）</a><a href="http://www.ibm.com/developerworks/cn/java/j-ioc/index.html?S_TACT=105AGX52&amp;S_CMP=techcsdn" target="_blank">在方法签名中使用控制反转（IoC）</a><a href="http://www.cnblogs.com/passer/archive/2008/07/16/1243811.html" target="_blank">看看baidu是如何AJAX跨域的</a><a href="http://www.ibm.com/developerworks/cn/xml/x-jsonml/index.html?S_TACT=105AGX52&amp;S_CMP=techcsdn" target="_blank">认识 JsonML</a><a href="http://thinkbase.net/w/main/Wiki?Tomcat5SSL_ServerAndClient" target="_blank">配置适用于正式使用环境下的Tomcat Web服务器双向SSL认证</a><a href="http://writeblog.csdn.net/EditLinks.aspx" target="_blank">[编辑]</a>设计模式<a href="http://www.ibm.com/developerworks/cn/java/design/?S_TACT=105AGX52&amp;S_CMP=tec-csdn" target="_blank">Java 设计模式与建模专题</a><a href="http://hqmank.blog.bokee.net/bloggermodule/blog_viewblog.do?id=472499" target="_blank">jive的设计模式-jive源代码研究2</a><a href="http://www.jdon.com/designpatterns/index.htm" target="_blank">设计模式(Patterns in Java)</a><a href="http://www.cnblogs.com/kid-li/category/44668.html?Show=All" target="_blank">设计模式学习笔记-写得很好</a><a href="http://writeblog.csdn.net/EditLinks.aspx" target="_blank">[编辑]</a>系统架构<a href="http://www.ccs.neu.edu/groups/IEEE/ind-acad/brewer/index.htm" target="_blank">Lessons from Internet Services: ACID vs. BASE</a><a href="http://www.infoq.com/cn/interviews/fengdahui-database-architecture" target="_blank">与冯大辉谈数据库架构</a><a href="http://www.infoq.com/cn/articles/Qclub-on-open-platform" target="_blank">互联网开放平台技术趋势和讨论</a><a href="http://www.infoq.com/cn/articles/distributed-sys-usability" target="_blank">分布式系统中的一致性和可用性</a><a href="http://www.infoq.com/cn/articles/ebay-scalability-best-practices" target="_blank">可伸缩性最佳实践：来自eBay的经验</a><a href="http://www.infoq.com/cn/articles/scalability-panel" target="_blank">构建的可伸缩性和达到的性能</a><a href="http://www.infoq.com/cn/news/2008/03/ebaybase" target="_blank">牺牲一致性来换取分布式架构的可伸缩性</a><a href="http://www.infoq.com/cn/interviews/popescu-infoq-architecture-cn" target="_blank">谈InfoQ.com网站架构</a><a href="http://highscalability.com/" target="_blank">高伸缩性网站架构分析</a>存档* <a href="http://blog.csdn.net/lovingprince/archive/2010/01.aspx" target="_blank">2010年01月(1)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2009/12.aspx" target="_blank">2009年12月(4)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2009/11.aspx" target="_blank">2009年11月(1)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2009/10.aspx" target="_blank">2009年10月(5)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2009/09.aspx" target="_blank">2009年09月(5)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2009/07.aspx" target="_blank">2009年07月(2)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2009/06.aspx" target="_blank">2009年06月(4)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2009/05.aspx" target="_blank">2009年05月(1)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2009/04.aspx" target="_blank">2009年04月(2)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2009/03.aspx" target="_blank">2009年03月(5)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2009/02.aspx" target="_blank">2009年02月(4)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2009/01.aspx" target="_blank">2009年01月(5)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2008/12.aspx" target="_blank">2008年12月(7)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2008/11.aspx" target="_blank">2008年11月(14)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2008/10.aspx" target="_blank">2008年10月(4)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2008/09.aspx" target="_blank">2008年09月(5)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2008/08.aspx" target="_blank">2008年08月(6)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2008/07.aspx" target="_blank">2008年07月(8)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2008/06.aspx" target="_blank">2008年06月(7)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2008/05.aspx" target="_blank">2008年05月(8)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2008/04.aspx" target="_blank">2008年04月(2)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2008/03.aspx" target="_blank">2008年03月(3)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2008/02.aspx" target="_blank">2008年02月(1)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2008/01.aspx" target="_blank">2008年01月(1)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2007/12.aspx" target="_blank">2007年12月(9)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2007/11.aspx" target="_blank">2007年11月(3)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2007/10.aspx" target="_blank">2007年10月(2)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2007/09.aspx" target="_blank">2007年09月(3)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2007/08.aspx" target="_blank">2007年08月(5)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2007/06.aspx" target="_blank">2007年06月(7)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2007/05.aspx" target="_blank">2007年05月(6)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2007/04.aspx" target="_blank">2007年04月(20)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2007/03.aspx" target="_blank">2007年03月(22)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2007/02.aspx" target="_blank">2007年02月(2)</a></li>
<li><a href="http://blog.csdn.net/lovingprince/archive/2006/12.aspx" target="_blank">2006年12月(1)</a><h1 id="-httpclient-"><img src="" alt="原创">  注意设置httpclient连接数 <a href="&quot;收藏到我的网摘中，并分享给我的朋友&quot;">收藏</a></h1>
</li>
</ul>
<p>在使用Httpclient的过程中，线上的酒店出现过一个问题，就是当访问量增大的时候，会发现本地的连接等待时间急剧增加，例如从400ms增加到 78000ms，之前一直以为是航信系统问题，后面经过检查才发现，原来是本地httpclient设置时，最大连接数采用了默认设置的原因，而默认的最大连接数只有2个，所以当有大量连接需要建立时，大多数连接只有等待。后面将连接数设置修改成32个之后，这个响应时间就基本上很少出现很大的时候。</p>
<pre><code>  HttpConnectionManager httpConnectionManager = new MultiThreadedHttpConnectionManager();
    HttpConnectionManagerParams params = httpConnectionManager.getParams();
    params.setConnectionTimeout(5000);
    params.setSoTimeout(20000);
    params.setDefaultMaxConnectionsPerHost(32);//very important!!
    params.setMaxTotalConnections(256);//very important!!
    this.client = new HttpClient(httpConnectionManager);
    // 设置编码
    this.client.getParams().setContentCharset(CharsetHelper.GBK);
    this.client.getParams().setHttpElementCharset(CharsetHelper.GBK);
</code></pre><p>我们一般很容易注意到设置超时时间，例如这里的红色部分，但是极有可能忘记设置每个主机的最大连接数(绿色)，因此大家注意一下，本来是最简单的，但也最容易被忽略。</p>
<p>发表于 @ 2009年09月03日　18:39:00 | <a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516532.aspx#FeedBack" title="评论" target="_blank">评论( loading...  )</a>| <a href="http://writeblog.csdn.net/PostEdit.aspx?entryId=4516532" title="编辑" target="_blank">编辑</a>| <a href="mailto:webmaster@csdn.net?subject=Article Report!!!&amp;body=Author:lovingprinceURL:http://blog.csdn.net/ArticleContent.aspx?UserName=lovingprince&amp;Entryid=4516532">举报</a>| <a href="&quot;收藏到我的网摘中，并分享给我的朋友&quot;">收藏</a></p>
<h3 id="-java-http-blog-csdn-net-lovingprince-archive-2009-07-02-4317069-aspx-jboss-as-http-blog-csdn-net-lovingprince-archive-2009-09-03-4516537-aspx-"><a href="http://blog.csdn.net/lovingprince/archive/2009/07/02/4317069.aspx" target="_blank">旧一篇:java 类加载器体系结构</a> | <a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516537.aspx" target="_blank">新一篇:Jboss as 基本设置</a></h3>
<p><a href="http://blog.csdn.net/" target="_blank">查看最新精华文章 请访问博客首页</a>相关文章<a href=""></a></p>
<ul>
<li><p>发表评论</p>
</li>
<li><p>表 情：</p>
</li>
<li><p><a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516532.aspx#" target="_blank"><img src="&quot;顶&quot;" alt="顶"></a> <a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516532.aspx#" target="_blank"><img src="&quot;砸&quot;" alt="砸"></a> <a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516532.aspx#" target="_blank"><img src="&quot;棒&quot;" alt="棒"></a> <a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516532.aspx#" target="_blank"><img src="&quot;大笑&quot;" alt="大笑"></a> <a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516532.aspx#" target="_blank"><img src="&quot;愤怒&quot;" alt="愤怒"></a> <a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516532.aspx#" target="_blank"><img src="&quot;大哭&quot;" alt="大哭"></a> <a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516532.aspx#" target="_blank"><img src="&quot;疑问&quot;" alt="疑问"></a> <a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516532.aspx#" target="_blank"><img src="&quot;汗&quot;" alt="汗"></a> <a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516532.aspx#" target="_blank"><img src="&quot;呕吐&quot;" alt="呕吐"></a> <a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516532.aspx#" target="_blank"><img src="&quot;送花&quot;" alt="送花"></a></p>
</li>
<li><p>评论内容：
*</p>
</li>
<li>用 户 名：</li>
<li><p><a href="">登录</a> <a href="http://passport.csdn.net/CSDNUserRegister.aspx" target="_blank">注册</a> 匿名评论</p>
</li>
<li><p>验 证 码：</p>
</li>
<li><a href=""><img src="" alt="验证码"></a> <a href="">重新获得验证码</a></li>
</ul>
<p>*</p>
<ul>
<li><a href="http://blog.csdn.net/lovingprince/archive/2009/09/03/4516532.aspx#" target="_blank"><img src="" alt=""></a></li>
</ul>
<p>Copyright © lovingprincePowered by CSDN Blog<img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Httpclient/">Httpclient</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Httpclient/" class="label label-primary">Httpclient</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-Httpclient--注意设置httpclient连接数-黄刚的专栏-CSDN博客/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-Httpclient--注意设置httpclient连接数-黄刚的专栏-CSDN博客" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-Httpclient--关于HttpClient的中文参数编码问题-讨论区-开源中国社区/">关于HttpClient的中文参数编码问题 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-Httpclient--关于HttpClient的中文参数编码问题-讨论区-开源中国社区/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-httpclient-">关于HttpClient的中文参数编码问题 - 讨论区 - 开源中国社区</h1>
<ul>
<li><a href="http://www.oschina.net/" target="_blank">首页</a></li>
<li><a href="http://www.oschina.net/project" target="_blank">开源软件</a></li>
<li><a href="http://www.oschina.net/question" target="_blank">讨论区</a></li>
<li><a href="http://www.oschina.net/code/list" target="_blank">代码分享</a></li>
<li><a href="http://www.oschina.net/news" target="_blank">资讯</a></li>
<li><a href="http://www.oschina.net/blog" target="_blank">博客</a></li>
<li><a href="http://www.oschina.net/android" target="_blank">Android</a></li>
<li><a href="http://www.oschina.net/job" target="_blank">招聘</a></li>
</ul>
<p>当前访客身份：游客 [ <a href="http://www.oschina.net/home/login" target="_blank">登录</a> | <a href="http://www.oschina.net/home/reg" target="_blank">加入开源中国</a> ]</p>
<p>当前位置：<a href="http://www.oschina.net/question" target="_blank">讨论区</a> » <a href="http://www.oschina.net/question?catalog=2" target="_blank">技术分享</a> » <a href="http://www.oschina.net/p/httpclient" target="_blank">HttpComponents</a></p>
<p>软件 代码 讨论区 新闻 博客
<a href="http://my.oschina.net/javayou" target="_blank"><img src="&quot;红薯&quot;" alt="红薯"></a></p>
<h1 id="-httpclient-"><a href="">关于HttpClient的中文参数编码问题</a></h1>
<p><a href="http://my.oschina.net/javayou" target="_blank">红薯</a> 发表于 10-5 17:13 3年前, <a href="http://www.oschina.net/question/12_4535#answers" target="_blank">1</a>回/762阅, 最后回答: 4个月前
<strong><a href="http://www.oschina.net/question" target="_blank">讨论区</a> » <a href="http://www.oschina.net/question?catalog=2" target="_blank">技术分享</a></strong></p>
<p>开源扑克第二轮预售，截止时间 9 月 30 日 <a href="http://www.oschina.net/shop/item6/12" target="_blank">我要购买</a>
今天在使用HttpClient提交中文参数的时候发现服务器不管怎么处理得到的字符串都是乱码，考虑应该是客户端的问题，查阅 HttpClient的文档，提到这么一段：</p>
<p>The standard for URLs ( RFC1738 ) explictly states that URLs may only contain graphic printable characters of the US-ASCII coded character set and is defined in terms of octets. The octets 80-FF hexadecimal are not used in US-ASCII and the octets OO-1F hexadecimal represent control characters; characters in these ranges must be encoded.
Characters which cannot be represented by an 8-bit ASCII code, can not be used in an URL as there is no way to reliably encode them
(the encoding scheme for URLs is based off of octets). Despite this, some servers do support varying means of encoding double byte characters in URLs,
the most common technique seems to be to use UTF-8 encoding and encode each octet separately even if a pair of octets represents one character. This however, is not specified by the standard and is highly prone to error, so it is recommended that URLs be restricted to the 8-bit ASCII range.
因此在提交中文参数的时候必须进行转码：
NameValuePair content = new NameValuePair(&quot;content&quot;,new String(&quot; 你好中国&quot;.getBytes(),&quot;8859_1&quot;));
搞定！</p>
<p><strong>标签：</strong> <a href="http://www.oschina.net/question/tag/httpclient" title="Java的HTTP协议库 HttpComponents" target="_blank">HttpComponents</a> <a href="http://www.oschina.net/question/tag/httpclient_old" title=" HttpClient" target="_blank">HttpClient</a>
<a href="">补充话题说明»</a></p>
<p><strong>分享到</strong> <a href="&quot;分享到新浪微博&quot;"></a><a href="&quot;分享到腾讯微博&quot;"></a>**</p>
<p><a href="&quot;收藏此话题&quot;">收藏</a>
**</p>
<p>1
**</p>
<p><a href="">举报</a>
**</p>
<p><a href="&quot;踩：这问题不知道在说什么，或者没什么用&quot;">踩</a> 0 | <a href="&quot;顶：这问题很有用或者很清晰明了&quot;">顶</a> 0
**</p>
<h2 id="-http-www-oschina-net-question-12_4535-answers-http-www-oschina-net-question-12_4535-sort-time-answers-http-www-oschina-net-question-12_4535-top-1-http-www-oschina-net-question-12_4535-answerform-"><a href="http://www.oschina.net/question/12_4535#answers" target="_blank">按默认排序</a> | <a href="http://www.oschina.net/question/12_4535?sort=time#answers" target="_blank">显示最新评论</a> | <a href="http://www.oschina.net/question/12_4535#top" target="_blank">回页面顶部</a>  <a href=""></a>共有<em>1</em>个评论 <a href="http://www.oschina.net/question/12_4535#answerform">发表评论»</a></h2>
<ul>
<li><a href="http://my.oschina.net/u/437619" target="_blank"><img src="&quot;hujiong&quot;" alt="hujiong"></a></li>
</ul>
<p><a href="http://my.oschina.net/u/437619" target="_blank">hujiong</a> 回答于 2012-05-08 09:25</p>
<p><a href="">举报</a>
<a href=""><img src="" alt=""></a>
<a href="&quot;这是一个好评论，能解决问题&quot;">有帮助</a><em>(0)</em> | <a href="&quot;这评论无法解决问题，或者模糊不清&quot;">没帮助</a><em>(0)</em> | <a href="">评论</a><em>(0)</em> | <a href="http://www.oschina.net/question/answer?question=4535&amp;answer=211268" target="_blank">引用此评论</a></p>
<p><a href="http://www.oschina.net/question/$link.user($g_user" target="_blank"><img src="&quot;非会员用户&quot;" alt="非会员用户"></a>)   <a href="&quot;粗体(Ctrl+B"></a>&quot;)<a href="&quot;斜体(Ctrl+I"></a>&quot;)<a href="&quot;下划线(Ctrl+U"></a>&quot;)<a href="&quot;删除线&quot;"></a><a href="&quot;删除格式&quot;"></a><a href="&quot;编号&quot;"></a><a href="&quot;项目符号&quot;"></a><a href="&quot;文字颜色&quot;"></a><a href="&quot;文字背景&quot;"></a><a href="&quot;字体&quot;"></a><a href="&quot;文字大小&quot;"></a><a href="&quot;超级链接&quot;"></a><a href="&quot;取消超级链接&quot;"></a><a href="&quot;插入表情&quot;"></a><a href="&quot;插入程序代码或脚本&quot;"></a><a href="&quot;图片&quot;"></a><a href="&quot;插入Flash&quot;"></a><a href="&quot;引用某段文字&quot;"></a><a href="&quot;全选&quot;"></a><a href="&quot;HTML代码&quot;"></a><a href="&quot;关于&quot;"></a>
<a href="http://www.oschina.net/question/12_4535#answers" target="_blank">回评论顶部</a> | <a href="http://www.oschina.net/question/12_4535#top" target="_blank">回页面顶部</a>
有什么技术问题吗？ <a href="http://www.oschina.net/question/ask" target="_blank">我要提问</a></p>
<p><strong><a href="http://my.oschina.net/javayou/?ft=bbs&amp;scope=2&amp;showme=1" target="_blank">全部(4766)...</a><em>红薯</em>的其他问题</strong></p>
<ul>
<li><a href="http://www.oschina.net/question/12_70587" title="OSChina 用户动态设计说明" target="_blank">OSChina 用户动态设计说明</a>(2回/241阅,26分钟前)</li>
<li><a href="http://www.oschina.net/question/12_70313" title="提取 SQL Server 的日志信息并发送邮件" target="_blank">提取 SQL Server 的日志信息并发送邮件</a>(0回/71阅,3天前)</li>
<li><a href="http://www.oschina.net/question/12_70252" title="OSChina 的留言表设计说明" target="_blank">OSChina 的留言表设计说明</a>(59回/5932阅,3天前)</li>
<li><a href="http://www.oschina.net/question/12_70228" title="遠端管理 VirtualBox 的神兵利器－RemoteBox" target="_blank">遠端管理 VirtualBox 的神兵利器－RemoteBox</a>(0回/70阅,4天前)</li>
<li><p><a href="http://www.oschina.net/question/12_70166" title="在 Node.js 上运行 Perl 脚本" target="_blank">在 Node.js 上运行 Perl 脚本</a>(0回/75阅,5天前)
<strong>类似的话题</strong></p>
</li>
<li><p><a href="http://www.oschina.net/question/1092_2616" title="HttpClient 爬数据时  中文编码问题" target="_blank">HttpClient 爬数据时 中文编码问题</a>(2回/1351阅,2年前)</p>
</li>
<li><a href="http://www.oschina.net/question/157182_34442" title="HTTPClient PostMethod 中文乱码问题解决方法" target="_blank">HTTPClient PostMethod 中文乱码问题解决方法</a>(1回/382阅,9个月前)</li>
<li><a href="http://www.oschina.net/question/12_4534" title="应用HttpClient来对付各种顽固的WEB服务器" target="_blank">应用HttpClient来对付各种顽固的WEB服务器</a>(2回/1389阅,3年前)</li>
<li><a href="http://www.oschina.net/question/163910_34519" title="httpClient 4.x中，MultipartEntity中附加中文信息时的乱码解决" target="_blank">httpClient 4.x中，MultipartEntity中附加中文信息时的乱码解决</a>(1回/566阅,9个月前)</li>
<li><a href="http://www.oschina.net/question/54100_32895" title="Android 使用 httpClient 取消http请求的方法" target="_blank">Android 使用 httpClient 取消http请求的方法</a>(0回/411阅,9个月前)</li>
<li><a href="http://www.oschina.net/question/12_4839" title="使用 Apache HttpClient 突破 J2EE 站点认证" target="_blank">使用 Apache HttpClient 突破 J2EE 站点认证</a>(0回/361阅,3年前)</li>
<li><a href="http://www.oschina.net/question/129540_31320" title="为 Android 开发访问 JAX-RS Web 服务的 Apache HttpClient 客户端" target="_blank">为 Android 开发访问 JAX-RS Web 服务的 Apache HttpClient 客户端</a>(3回/714阅,10个月前)</li>
<li><a href="http://www.oschina.net/question/12_4532" title="使用 HttpClient 和 HtmlParser 实现简易爬虫" target="_blank">使用 HttpClient 和 HtmlParser 实现简易爬虫</a>(3回/2861阅,3年前)</li>
<li><a href="http://www.oschina.net/question/54100_31016" title="Android 与 HttpClient 通讯出现乱码问题的解决" target="_blank">Android 与 HttpClient 通讯出现乱码问题的解决</a>(0回/223阅,10个月前)</li>
<li><a href="http://www.oschina.net/question/54100_34472" title="Apache HttpClient Cookie rejected 解决方法" target="_blank">Apache HttpClient Cookie rejected 解决方法</a>(1回/279阅,9个月前)</li>
<li><a href="http://www.oschina.net/question/53600_13088" title="豆瓣API求帮助" target="_blank">豆瓣API求帮助</a>(0回/245阅,1年前)</li>
<li><a href="http://www.oschina.net/question/96637_11083" title="怎么自动注册一个账户，类似yahoo.com" target="_blank">怎么自动注册一个账户，类似yahoo.com</a>(18回/883阅,2年前)</li>
<li><a href="http://www.oschina.net/question/54100_33230" title="Android Http异步请求，Callback" target="_blank">Android Http异步请求，Callback</a>(0回/650阅,9个月前)</li>
<li><a href="http://www.oschina.net/question/166763_35390" title="Android中的几种网络请求方式详解" target="_blank">Android中的几种网络请求方式详解</a>(0回/1424阅,8个月前)</li>
<li><a href="http://www.oschina.net/question/12_29683" title="打造一款 Android 联网 tic-tac-toe 游戏" target="_blank">打造一款 Android 联网 tic-tac-toe 游戏</a>(4回/709阅,11个月前)</li>
<li><a href="http://www.oschina.net/question/54100_34407" title="HttpClient, 使用C#操作Web" target="_blank">HttpClient, 使用C/#操作Web</a>(0回/35阅,9个月前)</li>
</ul>
<p>© 开源中国社区(OsChina.NET) | <a href="http://www.oschina.net/home/about" target="_blank">关于我们</a> | <a href="mailto:oschina.net@gmail.com">广告联系</a> | <a href="http://weibo.com/oschina2010" target="_blank">@新浪微博</a> | <a href="http://m.oschina.net/" target="_blank">开源中国手机版</a> | 粤ICP备12009483号-3</p>
<p><a href=""></a><a href=""></a><a href=""></a>
<img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Httpclient/">Httpclient</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Httpclient/" class="label label-primary">Httpclient</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-Httpclient--关于HttpClient的中文参数编码问题-讨论区-开源中国社区/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-Httpclient--关于HttpClient的中文参数编码问题-讨论区-开源中国社区" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-Httpclient--httpclient中文乱码问题解决方法（收藏）_bingxuelian的空间_百度空间/">httpclient中文乱码问题解决方法（收藏）_bingxuelian的空间_百度空间</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-Httpclient--httpclient中文乱码问题解决方法（收藏）_bingxuelian的空间_百度空间/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="httpclient-_bingxuelian-_-">httpclient中文乱码问题解决方法（收藏）<em>bingxuelian的空间</em>百度空间</h1>
<p><img src="" alt=""></p>
<h3 id="-">分享到</h3>
<ul>
<li><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">QQ空间</a></li>
<li><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">新浪微博</a></li>
<li><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">百度搜藏</a></li>
<li><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">人人网</a></li>
<li><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">腾讯微博</a></li>
<li><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">开心网</a></li>
<li><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">腾讯朋友</a></li>
<li><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">更多...</a></li>
</ul>
<p><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">百度分享</a></p>
<p><a href="http://hi.baidu.com/"></a></p>
<ul>
<li><a href="http://hi.baidu.com/index" target="_blank">广场</a></li>
<li><a href="http://hi.baidu.com/go/login" target="_blank">登录</a>
*</li>
<li><a href="http://hi.baidu.com/go/reg?pmfrom=qingtop" target="_blank">注册</a>
<a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">关注此空间</a><h1 id="-bingxuelian-http-hi-baidu-com-new-rtgguumtrjjmqsr-"><a href="http://hi.baidu.com/new/rtgguumtrjjmqsr" target="_blank">bingxuelian的空间</a></h1>
</li>
</ul>
<p>安然学习的地方！冰雪莲！</p>
<p>2010-07-21 12:50</p>
<h2 id="httpclient-">httpclient中文乱码问题解决方法（收藏）</h2>
<p>这里，介绍一种解决抓取后网页内容显示为乱码的办法。
前几天，在抓取某网站的信息时(<a href="http://www.99sj.com/Price/Price/Default.aspx)，第一次碰到了这种应用下的乱码问题。于是上网查了一下，提供的解决办法大致有两种：" target="_blank">http://www.99sj.com/Price/Price/Default.aspx)，第一次碰到了这种应用下的乱码问题。于是上网查了一下，提供的解决办法大致有两种：</a>
１&gt;　　private static final String CONTENT<em>CHARSET = &quot;GBK&quot;;
httpClient.getParams().setContentCharset(&quot;UTF-8&quot;);
or
httpClient.getParams().setParameter(HttpMethodParams.HTTP_CONTENT_CHARSET, ＣONTENT_CHARSET);
2&gt;　　private static final String CONTENTTYPE = &quot; text/html; charset=GBK&quot;;
getMethod.setRequestHeader(&quot;Content-Type&quot;, CONTENTTYPE);
测试了，没有任何效果（换成UTF-8也不行）。也用了String result = new String(pageSrc.getBytes(&quot;UTF-8&quot;),&quot;GBK&quot;)，依然无效。
在焦头烂额时想到了以前在学校时经常用的一句话：找问题要会追根溯源。仔细想想，字符串里面的文本内容也是通过文件流获取的，既然转换字符串字符编码不起作用，那可以设置文件流的默认编码吗？查了jdk，是可行的。
private static final String CHARSET = &quot;UTF-8&quot;;
InputStream ins = getMethod.getResponseBodyAsStream();
//按指定的字符集构建文件流
BufferedReader br = new BufferedReader(new InputStreamReader(ins,CHARSET));
StringBuffer sbf = new StringBuffer();
String line = null;
while ((line = br.readLine()) != null)
{
sbf.append(line);
}
//<em>/</em> 回收资源 /<em>/
br.close();
getMethod.releaseConnection();
//</em>/<em> 页面源文件 /</em>/
pageSource = sbf.toString();
问题解决，^</em>^。这里的CHARSET要根据实际情况设置
<a href="http://hi.baidu.com/tag/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E--%E7%88%AC%E8%99%AB%E6%8A%80%E6%9C%AF/feeds" target="_blank">/#搜索引擎--爬虫技术</a></p>
<p><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">举报</a> 浏览(303) <a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">评论</a> <a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">转载</a></p>
<p><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/4c5e943cbb3be59eb80c03a5" title="上一篇"></a></p>
<p><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/9259a4973bc07ddb1f4271a5" title="下一篇"></a>
评论</p>
<p> 同时评论给 </p>
<p> 同时评论给原文作者 </p>
<p><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank"> 发布 </a></p>
<p>500/0</p>
<p><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">收起</a>|<a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#reply" target="_blank">查看更多</a></p>
<p><a href="http://hi.baidu.com/go/show/introduce" target="_blank">帮助中心</a> | <a href="http://tieba.baidu.com/p/1781683739" target="_blank">空间客服</a> | <a href="http://tousu.baidu.com/hi/add" target="_blank">投诉中心</a> | <a href="http://www.baidu.com/search/hi_contract.html" target="_blank">空间协议</a></p>
<p>©2012 Baidu
内容很精彩，关注此空间？<a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#"></a></p>
<p><a href="http://hi.baidu.com/new/rtgguumtrjjmqsr" title="bingxuelian666" target="_blank"><img src="" alt="bingxuelian666"></a></p>
<p><a href="http://hi.baidu.com/new/rtgguumtrjjmqsr" target="_blank">bingxuelian666</a></p>
<p>性别：女年龄：0岁</p>
<p>现居：<a href="&quot;陕西 西安 &quot;">陕西西安</a></p>
<p>粉丝：<a href="http://hi.baidu.com/rtgguumtrjjmqsr/qfriend/show/fans" target="_blank">37</a>关注：<a href="http://hi.baidu.com/rtgguumtrjjmqsr/qfriend/show/follow" target="_blank">47</a>
<a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">关注</a><a href="http://hi.baidu.com/rtgguumtrjjmqsr/item/7c49ab87b2b3ef804414cfa2#" target="_blank">暂不</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Httpclient/">Httpclient</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Httpclient/" class="label label-primary">Httpclient</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-Httpclient--httpclient中文乱码问题解决方法（收藏）_bingxuelian的空间_百度空间/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-Httpclient--httpclient中文乱码问题解决方法（收藏）_bingxuelian的空间_百度空间" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/102/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/100/">100</a></li><li><a class="page-number" href="/page/101/">101</a></li><li><a class="page-number" href="/page/102/">102</a></li><li class="active"><li><span class="page-number current">103</span></li><li><a class="page-number" href="/page/104/">104</a></li><li><a class="page-number" href="/page/105/">105</a></li><li><a class="page-number" href="/page/106/">106</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/104/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 17:47:11</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
