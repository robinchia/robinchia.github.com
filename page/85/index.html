
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 85 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台/">利用SQL注入漏洞登录后台</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-sql-">利用SQL注入漏洞登录后台</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度搜藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<p>用户名：  密码：   <a href="http://bbs.php100.com/register.php" target="_blank">新用户注册</a></p>
<p><a href="http://bbs.php100.com/read-htm-tid-693.html" target="_blank">PHP100三不条约</a> <a href="http://www.php100.com/cms/com/intome.php?tg" target="_blank">投稿</a></p>
<p><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/data/rssmap.html" title="rss" target="_blank"><img src="" alt="rss"></a></p>
<p><a href="http://www.php100.com/" target="_blank"><img src="" alt="PHP100中文网-中国第一档PHP资源分享门户"></a></p>
<p><a href="http://www.php100.com/" target="_blank">网站首页</a> | <a href="http://www.php100.com/html/itnews/" target="_blank">业界资讯</a> | <a href="http://www.php100.com/html/webkaifa/" target="_blank">相关开发资料</a> | <a href="http://www.php100.com/html/open-php/" target="_blank">IT开源报道</a> | <a href="http://www.php100.com/html/download/" target="_blank">相关下载</a> | <a href="http://www.php100.com/html/shipinjiaocheng/" target="_blank">视频教程</a> | <a href="http://www.php100.com/job.php" target="_blank">PHP求职招聘</a> | <a href="http://www.php100.com/waibao.php" target="_blank">项目供求</a> | <a href="http://www.php100.com/share.php" target="_blank">资源共享</a> | <a href="http://bbs.php100.com/" target="_blank">PHP100中文论坛</a></p>
<p><strong><a href="http://www.php100.com/html/webkaifa/apache/" target="_blank">Apache&amp;Nginx</a> | <a href="http://www.php100.com/html/webkaifa/DIV_CSS/" target="_blank">DIVCSS</a> | <a href="http://www.php100.com/html/webkaifa/PHP/" target="_blank">PHP</a> | <a href="http://www.php100.com/html/webkaifa/database/" target="_blank">DB</a> | <a href="http://www.php100.com/html/webkaifa/javascript/" target="_blank">JS&amp;JQuery</a> | <a href="http://www.php100.com/html/webkaifa/HTML5/" target="_blank">HTML5</a> | <a href="http://www.php100.com/html/webkaifa/Android/" target="_blank">Android</a> | <a href="http://www.php100.com/html/webkaifa/python/" target="_blank">python</a> | <a href="http://www.php100.com/html/webkaifa/ajax/" target="_blank">Ajax</a> | <a href="http://www.php100.com/html/webkaifa/xml/" target="_blank">XML&amp;JSON</a> | <a href="http://www.php100.com/html/webkaifa/Linux/" target="_blank">Linux</a> | <a href="http://www.php100.com/html/webkaifa/zhengzebiaodashi/" target="_blank">正则</a> |</strong>
<a href="http://www.chuangen.com/php_training.php" target="_blank"><img src="" alt=""></a></p>
<p><a href="http://www.php100.com/" target="_blank">首页</a> &gt; <a href="http://www.php100.com/html/webkaifa/" target="_blank">开发资料</a> &gt; <a href="http://www.php100.com/html/webkaifa/PHP/" target="_blank">PHP</a> &gt; <a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/" target="_blank">PHP应用</a> &gt; 正文</p>
<h1 id="-sql-">利用SQL注入漏洞登录后台</h1>
<p>发布时间：2012-02-10 09:42:17   来源：cnblogs.com/hongfei   评论：<a href="">0</a> 点击：12173 次 【字号：<a href="">大</a> <a href="">中</a> <a href="">小</a>】</p>
<p><a href="&quot;分享到QQ空间&quot;">QQ空间</a> <a href="&quot;分享到新浪微博&quot;">新浪微博</a> <a href="&quot;分享到腾讯微博&quot;">腾讯微博</a> <a href="&quot;分享到人人网&quot;">人人网</a> <a href="&quot;分享到豆瓣网&quot;">豆瓣网</a> <a href="&quot;分享到百度空间&quot;">百度空间</a> <a href="&quot;分享到百度搜藏&quot;">百度搜藏</a> <a href="&quot;分享到开心网&quot;">开心网</a> <a href="&quot;分享到复制网址&quot;">复制</a> 更多 <a href="&quot;累计分享8次&quot;">8</a>
题记：工作需要，得好好补习下关于WEB安全方面的相关知识，故撰此文，权当总结，别无它意。读这篇文章，我假设读者有过写SQL语句的经历，或者能看得懂SQL语句　　早在02年，国外关于SQL注入漏洞的技术文章已...</p>
<p>题记：工作需要，得好好补习下关于WEB安全方面的相关知识，故撰此文，权当总结，别无它意。读这篇文章，我假设读者有过写SQL语句的经历，或者能看得懂SQL语句</p>
<p>早在02年，国外关于SQL注入漏洞的技术文章已经很多，而国内在05年左右才开始的。</p>
<p>如今，谈SQL注入漏洞是否已是明日黄花，国内大大小小的网站都已经补上漏洞。但，百密必有一疏，入侵是偶然的，但安全绝对不是必然的。</p>
<p>前些天，网上传得沸沸扬扬的“拖库”事件给我们敲响了安全警钟。</p>
<p>在开发网站的时候，出于安全考虑，需要过滤从页面传递过来的字符。通常，用户可以通过以下接口调用数据库的内容：URL地址栏、登陆界面、留言板、搜索框等。这往往给骇客留下了可乘之机。轻则数据遭到泄露，重则服务器被拿下。</p>
<p>现在，很多网站开发人员知其然而不知其所以然，小弟也是，所以赶紧恶补下，总结如学习内容。希望对初学者能够起到抛砖引玉的作用。</p>
<p><strong>一、SQL注入的步骤</strong></p>
<p>a) 寻找注入点(如：登录界面、留言板等)</p>
<p>b) 用户自己构造SQL语句(如：’ or 1=1/#，后面会讲解)</p>
<p>c) 将sql语句发送给数据库管理系统(DBMS)</p>
<p>d) DBMS接收请求，并将该请求解释成机器代码指令，执行必要的存取操作</p>
<p>e) DBMS接受返回的结果，并处理，返回给用户</p>
<p>因为用户构造了特殊的SQL语句，必定返回特殊的结果(只要你的SQL语句够灵活的话)。</p>
<p>下面，我通过一个实例具体来演示下SQL注入</p>
<p><strong>二、SQL注入实例详解</strong>(以上测试均假设服务器未开启magic_quote_gpc)</p>
<p>1) 前期准备工作</p>
<p>先来演示通过SQL注入漏洞，登入后台管理员界面</p>
<p>首先，创建一张试验用的数据表：</p>
<p>CREATE TABLE <code>users</code> (</p>
<p><code>id</code> int(11) NOT NULL AUTO_INCREMENT,</p>
<p><code>username</code> varchar(64) NOT NULL,</p>
<p><code>password</code> varchar(64) NOT NULL,</p>
<p><code>email</code> varchar(64) NOT NULL,</p>
<p>PRIMARY KEY (<code>id</code>),</p>
<p>UNIQUE KEY <code>username</code> (<code>username</code>)</p>
<p>) ENGINE=MyISAM AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;</p>
<p>添加一条记录用于测试：</p>
<p>INSERT INTO users (username,password,email)</p>
<p>VALUES(&#39;MarcoFly&#39;,md5(&#39;test&#39;),&#39;marcofly@test.com&#39;);</p>
<p>接下来，贴上登录界面的源代码：</p>
<html>
<head>
<title>Sql注入演示</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>

<body >
<form action="validate.php" method="post">
  <fieldset >
    <legend>Sql注入演示</legend>
    <table>
      <tr>
        <td>用户名：</td>
        <td><input type="text" name="username"></td>
      </tr>
      <tr>
        <td>密&nbsp;&nbsp;码：</td>
        <td><input type="text" name="password"></td>
      </tr>
      <tr>
        <td><input type="submit" value="提交"></td>
        <td><input type="reset" value="重置"></td>
      </tr>
    </table>
  </fieldset>
</form>
</body>
</html>

<p>附上效果图：
<img src="" alt="\"></p>
<p>当用户点击提交按钮的时候，将会把表单数据提交给validate.php页面，validate.php页面用来判断用户输入的用户名和密码有没有都符合要求(这一步至关重要，也往往是SQL漏洞所在)</p>
<p>代码如下：</p>
<html>
<head>
<title>登录验证</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>

<body>
&lt;?php

       $conn=@mysql_connect(&quot;localhost&quot;,&#39;root&#39;,&#39;&#39;) or die(&quot;数据库连接失败！&quot;);;

       mysql_select_db(&quot;injection&quot;,$conn) or die(&quot;您要选择的数据库不存在&quot;);

       $name=$_POST[&#39;username&#39;];

       $pwd=$_POST[&#39;password&#39;];

       $sql=&quot;select /* from users where username=&#39;$name&#39; and password=&#39;$pwd&#39;&quot;;

       $query=mysql_query($sql);

       $arr=mysql_fetch_array($query);

       if(is_array($arr)){

              header(&quot;Location:manager.php&quot;);

       }else{

              echo &quot;您的用户名或密码输入有误，<a href=\"Login.php\">请重新登录！</a>&quot;;

       }

?&gt;
</body>
</html>

<p>注意到了没有，我们直接将用户提交过来的数据(用户名和密码)直接拿去执行，并没有实现进行特殊字符过滤，待会你们将明白，这是致命的。</p>
<p>代码分析：如果，用户名和密码都匹配成功的话，将跳转到管理员操作界面(manager.php)，不成功，则给出友好提示信息。</p>
<p>登录成功的界面：
<img src="" alt="\"></p>
<p>登录失败的提示：</p>
<p><img src="" alt="\"></p>
<p>到这里，前期工作已经做好了，接下来将展开我们的重头戏：SQL注入</p>
<p>2) 构造SQL语句</p>
<p>填好正确的用户名(marcofly)和密码(test)后，点击提交，将会返回给我们“欢迎管理员”的界面。</p>
<p>因为根据我们提交的用户名和密码被合成到SQL查询语句当中之后是这样的：</p>
<p>select /* from users where username=&#39;marcofly&#39; and password=md5(&#39;test&#39;)</p>
<p>很明显，用户名和密码都和我们之前给出的一样，肯定能够成功登陆。但是，如果我们输入一个错误的用户名或密码呢?很明显，肯定登入不了吧。恩，正常情况下是如此，但是对于有SQL注入漏洞的网站来说，只要构造个特殊的“字符串”，照样能够成功登录。</p>
<p>比如：在用户名输入框中输入:’ or 1=1/#,密码随便输入，这时候的合成后的SQL查询语句为：</p>
<p>select /* from users where username=&#39;&#39; or 1=1/#&#39; and password=md5(&#39;&#39;)</p>
<p>语义分析：“/#”在mysql中是注释符，这样井号后面的内容将被mysql视为注释内容，这样就不会去执行了，换句话说，以下的两句sql语句等价：</p>
<p>select /* from users where username=&#39;&#39; or 1=1/#&#39; and password=md5(&#39;&#39;)</p>
<p>等价于</p>
<p>select /* from users where username=&#39;&#39; or 1=1</p>
<p>因为1=1永远是都是成立的，即where子句总是为真，将该sql进一步简化之后，等价于如下select语句：</p>
<p>select /* from users</p>
<p>没错，该sql语句的作用是检索users表中的所有字段</p>
<p>小技巧：如果不知道’ or 1=1/#中的单引号的作用，可以自己echo 下sql语句，就一目了然了。</p>
<p>看到了吧，一个经构造后的sql语句竟有如此可怕的破坏力，相信你看到这后，开始对sql注入有了一个理性的认识了吧~</p>
<p>没错，SQL注入就是这么容易。但是，要根据实际情况构造灵活的sql语句却不是那么容易的。有了基础之后，自己再去慢慢摸索吧。</p>
<p>有没有想过，如果经由后台登录窗口提交的数据都被管理员过滤掉特殊字符之后呢?这样的话，我们的万能用户名’ or 1=1/#就无法使用了。但这并不是说我们就毫无对策，要知道用户和数据库打交道的途径不止这一条。
-</p>
<p>（责任编辑：phpcms）
本文关键字：</p>
<ul>
<li><a href="http://www.php100.com/index.php?m=content&amp;c=tag&amp;catid=21&amp;tag=%C0%FB%D3%C3" target="_blank">利用</a> <a href="http://www.php100.com/index.php?m=content&amp;c=tag&amp;catid=21&amp;tag=%D7%A2%C8%EB" target="_blank">注入</a> <a href="http://www.php100.com/index.php?m=content&amp;c=tag&amp;catid=21&amp;tag=%C2%A9%B6%B4" target="_blank">漏洞</a></li>
</ul>
<p><strong>上一篇：</strong><a href="http://www.php100.com/html/webkaifa/javascript/2012/0210/9802.html" target="_blank">JS 调用 Flash 方法</a>
<strong>下一篇：</strong><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/9804.html" target="_blank">几个 PHP 的“魔术常量”</a></p>
<ul>
<li>14 <img src="" alt="">
震惊</li>
<li>14 <img src="" alt="">
不解</li>
<li>3 <img src="" alt="">
愤怒</li>
<li>9 <img src="" alt="">
杯具</li>
<li>18 <img src="" alt="">
无聊</li>
<li>7 <img src="" alt="">
高兴</li>
<li>17 <img src="" alt="">
支持</li>
<li>83 <img src="" alt="">
超赞</li>
</ul>
<p>分享到：  <a href=""> </a> <a href="http://v.t.sina.com.cn/share/share.php?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;appkey=3172366919&amp;title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0" title="分享到新浪微博" target="_blank"> </a> <a href="http://www.douban.com/recommend/?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0" title="分享到豆瓣" target="_blank"> </a> <a href="http://share.renren.com/share/buttonshare.do?link=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0" title="分享到人人" target="_blank"> </a> <a href="http://www.kaixin001.com/repaste/share.php?rtitle=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0&amp;rurl=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;rcontent=" title="分享到开心网" target="_blank"> </a> <a href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html" title="分享到QQ空间" target="_blank"> </a>
最新资讯</p>
<ul>
<li><a href="http://www.php100.com/html/itnews/PHPxinwen/2013/0502/13421.html" target="_blank">PHP闭包（Closure）初探</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0502/13419.html" target="_blank">传 iOS 7 采用扁平化设计：颠覆拟物理念</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0502/13418.html" target="_blank">创业失败后如何找工作</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0502/13416.html" target="_blank">程序员的时间都去了哪儿？</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13414.html" target="_blank">如何组织大型JavaScript应用中的代码？</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13413.html" target="_blank">互联网 DBA 需要做那些事</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13412.html" target="_blank">Google 眼镜的核心代码</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13411.html" target="_blank">谷歌眼镜已被越狱：或削弱谷歌对用户的控制</a></li>
</ul>
<p>热门内容</p>
<ul>
<li><a href="http://www.php100.com/html/itnews/it/2013/0107/11895.html" title="2013年1月编程语言排行榜" target="_blank">2013年1月编程语言排行榜</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0427/13409.html" title="Ubuntu 13.04 正式版发布" target="_blank">Ubuntu 13.04 正式版发布</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2011/1118/9311.html" title="百度地图推出卫星地图" target="_blank">百度地图推出卫星地图</a></li>
<li><a href="http://www.php100.com/html/itnews/PHPxinwen/2009/0408/14.html" title="十天学会PHP和MYSQL视频教程篇" target="_blank">十天学会PHP和MYSQL视频教程篇</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0426/13402.html" title="如何做一个真正牛X 的开源项目" target="_blank">如何做一个真正牛X 的开源项目</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0408/13335.html" title="2013年4月编程语言排行榜" target="_blank">2013年4月编程语言排行榜</a></li>
<li><a href="http://www.php100.com/html/itnews/PHPxinwen/2010/0514/4515.html" title="使用方正字体侵权索赔过亿" target="_blank">使用方正字体侵权索赔过亿</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13414.html" title="如何组织大型JavaScript应用中的代码？" target="_blank">如何组织大型JavaScript应用中的代码？</a></li>
</ul>
<p><strong>热点推荐</strong> <a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/" target="_blank">更多</a></p>
<ul>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0610/4712.html" title="教你如何成为PHP高手?" target="_blank">教你如何成为PHP高手?</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0114/309.html" title="PHP导入导出Excel方法" target="_blank">PHP导入导出Excel方法</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2011/0406/7873.html" title="Redis 的安装配置介绍" target="_blank">Redis 的安装配置介绍</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0830/3245.html" title="数据库三范式，轻松理解" target="_blank">数据库三范式，轻松理解</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0905/3268.html" title="PHP网站开发方案（开发新人必读）" target="_blank">PHP网站开发方案（开发新人必读）</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0930/3362.html" title="PHP面向对象编程专题（附视频教程）" target="_blank">PHP面向对象编程专题（附视频教程）</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/1101/6727.html" title="php中使用exec,system等函数调用系统命令" target="_blank">php中使用exec,system等函数调用系</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0830/5346.html" title="SVN入门及配置使用" target="_blank">SVN入门及配置使用</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0721/3087.html" title="php excel类 ，phpExcel使用方法介绍" target="_blank">php excel类 ，phpExcel使用方法</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0826/5308.html" title="完美解决failed to open stream: HTTP request failed!" target="_blank">完美解决failed to open stream</a>
<strong>广告赞助商</strong> <a href="http://www.php100.com/cms/com/adservice.php" target="_blank">投放</a></li>
</ul>
<p><strong>最新视频推荐</strong> <a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/html/jiaocheng/" target="_blank">更多</a></p>
<ul>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0422/9129.html" target="_blank">［第77讲］新浪微博开放平台 -新</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0415/9128.html" target="_blank">［第76讲］微信公共平台 - 平台</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0407/9127.html" target="_blank">［第75讲］微信公共平台 - 开放</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9125.html" target="_blank">［第74讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9124.html" target="_blank">［第73讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9123.html" target="_blank">［第72讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9122.html" target="_blank">［第71讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9121.html" target="_blank">［第70讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9120.html" target="_blank">［第69讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9119.html" target="_blank">［第68讲］thinkphp 3.1.2 系列</a>
-
<a href="http://www.php100.com/cms/com/" target="_blank">关于我们</a> | <a href="http://www.php100.com/cms/com/buddy.php" target="_blank">管理团队</a> | <a href="">网站律师</a> | <a href="http://www.php100.com/cms/com/adservice.php" target="_blank">广告服务</a> | <a href="http://www.php100.com/cms/com/intome.php" target="_blank">投稿指南</a> | <a href="http://bbs.php100.com/thread-htm-fid-14.html" target="_blank">提建议</a> | <a href="http://www.php100.com/plus/flink.php" target="_blank">友情链接</a> | <a href="http://www.php100.com/plus/flink_add.php" target="_blank">申请加入</a> | <a href="http://www.php100.com/data/sitemap.html" target="_blank">网站地图</a></li>
</ul>
<p>Copyright (C) 2007-2011 PHP100.com, All Rights Reserved 版权所有 <a href="http://php100.com/go.php?url=http://www.php100.net/" target="_blank">上海创恩信息技术有限公司</a>. 沪ICP备08100465号
地址:上海徐汇区零陵路585号 爱邦大厦26H座 传真(FAX):021-61190281 电话(Tel):021-61190282
PHP100 Website Powered by PHPCMS. For PHP100. 服务器维护：阿里巴巴-阿里云</p>
<p><a href="http://www.cnzz.com/stat/website.php?web_id=1668579" title="站长统计" target="_blank">站长统计</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/SQL注入/">SQL注入</a></li></span></span> | <span class="tags">Tagged <a href="/tags/SQL注入/" class="label label-primary">SQL注入</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--cas配置全攻略-哈哈-吼吼-这是个好地方-BlogJava/">cas配置全攻略 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--cas配置全攻略-哈哈-吼吼-这是个好地方-BlogJava/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas-blogjava">cas配置全攻略 - 哈哈,吼吼,这是个好地方 - BlogJava</h1>
<p><a href="http://www.blogjava.net/tufanshu/" target="_blank">哈哈,吼吼,这是个好地方</a>
没有风雨躲的过， 没有坎坷不必走……</p>
<p><a href="http://www.blogjava.net/" target="_blank">BlogJava</a>    <a href="http://www.blogjava.net/tufanshu/" target="_blank">首页</a>    <a href="http://www.blogjava.net/tufanshu/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a>    <a href="http://www.blogjava.net/tufanshu/contact.aspx?id=1" target="_blank">联系</a>    <a href="http://www.blogjava.net/tufanshu/rss" target="_blank">聚合</a><a href="http://www.blogjava.net/tufanshu/rss" target="_blank"><img src="" alt=""></a>    <a href="http://www.blogjava.net/tufanshu/admin/EditPosts.aspx" target="_blank">管理</a></p>
<p>posts - 37,  comments - 50,  trackbacks - 0</p>
<p><a href="">cas配置全攻略</a></p>
<p>经过将近两天的测试，参考众多网友的贡献，终于完成了对cas的主要配置和测试，现记录如下</p>
<p>基本需求：</p>
<p>1.cas server-3.4.5,casclient-3.2（官方版本），均可在cas官方网站下载，<a href="http://www.jasig.org/" target="_blank"><a href="http://www.jasig.org">http://www.jasig.org</a></a></p>
<p>2.使用低成本的http协议进行传输，俺买不起ssl证书</p>
<p>3.通过jdbc进行用户验证</p>
<p>4.需要通过casserver提供除登录用户名以外的附加信息</p>
<p>参考资料：</p>
<p>1.cas官方网站的用户帮助手册和wiki</p>
<p>2.网友“城市猎人”的blog，<a href="http://yuzhwe.javaeye.com/blog/830143" target="_blank"><a href="http://yuzhwe.javaeye.com/blog/830143">http://yuzhwe.javaeye.com/blog/830143</a></a></p>
<p>3.网友“悟空悟道”的blog，<a href="http://llhdf.javaeye.com/blog/764385" target="_blank"><a href="http://llhdf.javaeye.com/blog/764385">http://llhdf.javaeye.com/blog/764385</a></a></p>
<p>4.其他网友贡献的相关的blog，都是通过google出来，就不一一列出了，一并致谢！！！</p>
<p>好了，下面进入正题，如果您不想测试中出现异常情况，或是获取不到相关数据，请关注文中的红色字体部分。</p>
<p>（1）使用http协议的设置，如果您也像我一样，买不起ssl数字证书，对安全的要求也不是特别的搞，下面的配置就可以帮助解决这个问题：</p>
<p>在cas-server-webapp中的/WEB-INF/spring-configuration/ticketGrantingTicketCookieGenerator.xml文件中有如下配置</p>
<bean id="ticketGrantingTicketCookieGenerator" class="org.jasig.cas.web.support.CookieRetrievingCookieGenerator"
  p:cookieSecure="true"     //默认为true，使用https,如果只需要http，修改为false即可
  p:cookieMaxAge="-1"
  p:cookieName="CASTGC"
  p:cookiePath="/cas" />

 （2）使用jdbc数据源进行用户认证，需要修改cas的authenticationHandlers方式，在文件/WEB-INF/deployerConfigContext.xml有如下配置：

<property name="authenticationHandlers">
   <list>
    <!--
     | This is the authentication handler that authenticates services by means of callback via SSL, thereby validating
     | a server side SSL certificate.
     +-->
    <bean class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler"
     p:httpClient-ref="httpClient" />
    <!--
     | This is the authentication handler declaration that every CAS deployer will need to change before deploying CAS
     | into production.  The default SimpleTestUsernamePasswordAuthenticationHandler authenticates UsernamePasswordCredentials
     | where the username equals the password.  You will need to replace this with an AuthenticationHandler that implements your
     | local authentication strategy.  You might accomplish this by coding a new such handler and declaring
     | edu.someschool.its.cas.MySpecialHandler here, or you might use one of the handlers provided in the adaptors modules.
     +-->
    <!--<bean class="org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler" />-->
     <bean  class="org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler">
         <property name="dataSource" ref="dataSource" />
        <property name="sql" value="select password from userInfo where username=? and enabled=true" />
         //用户密码编码方式
         <property name="passwordEncoder"
           ref="passwordEncoderBean"/>
         </bean><br>   </list>
  </property>

该属性中的list只要用一个认证通过即可，建议将红色部分放在第一位，如果确认只用jdbc一种方式，其他认证方式均可删除。另外需要在在文件中添加datasoure和passordEncoder两个bean，如下

<!-- Data source definition -->
 <bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
  <property name="driverClassName">
    <value>com.mysql.jdbc.Driver</value>
  </property>
  <property name="url">
    <value>jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8</value>    //如果使用mysql数据库，应该加上后面的编码参数，否则可能导致客户端对TGT票据无法识别的问题
  </property>
  <property name="username"><value>root</value></property>
  <property name="password"><value>password</value></property>
 </bean>
 <bean id="passwordEncoderBean" class="org.jasig.cas.authentication.handler.DefaultPasswordEncoder">
        <constructor-arg value="SHA1" />  //cas
server默认支持MD5和SHA1两种编码方式，如果需要其他的编码方式例如SHA256,512等，可自行实现org.jasig.cas.authentication.handler.PasswordEncoder接口
    </bean>

<p>附加备注：如果您是使用cas server的源码自行编译的话，需要在cas-server-web模块的pom.xml中添加如下模块的依赖：</p>
<dependency>
       <groupId>${project.groupId}</groupId>
       <artifactId>cas-server-support-jdbc</artifactId>
       <version>${project.version}</version>
  </dependency>  

<p>并添加对应数据库的jdbc的jar包。</p>
<p>（3）让cas server提供更多的用户数据共客户端使用</p>
<p>通过测试，由于cas的代码更新过程中的变化较大，所以包兼容的问题好像一直存在，在测试中我就碰到过，花费时间比较多，建议同学们在使用过程中使用官方的最新的发布版本。在我使用的这个版本中，请参考前面的关于server和client端的版本说明，应该没有包冲突的问题，测试通过。下面进行配置，配置文件：/WEB-INF/deployerConfigContext.xml</p>
<p><property name="credentialsToPrincipalResolvers">
   <list>
       <!--<bean class="org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver" />-->
    <!-- modify on 2011-01-18,add user info -->
    <bean class="org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver" >
      <property name="attributeRepository" >   //为认证过的用户的Principal添加属性
      <ref local="attributeRepository"/>
     </property> 
    </bean>
      <bean
     class="org.jasig.cas.authentication.principal.HttpBasedServiceCredentialsToPrincipalResolver" />
   </list>
  </property>
 修改该文件中默认的 attributeRepositorybean配置
<!-- 在这里配置获取更多用户的信息 -->
 <bean id="attributeRepository" class="org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao">
  <constructor-arg index="0" ref="dataSource" />
  <constructor-arg index="1" value="select id as UId, password_hint as ph from userInfo where username=? and enabled=true" />
  <property name="queryAttributeMapping">
   <map>
   <entry key="username" value="uid"/><!-- 这里必须这么写，系统会自己匹配，貌似和where语句后面的用户名字段的拼写没有什么关系 -->
   </map>
  </property>
   <!-- 要获取的属性在这里配置 -->
  <property name="resultAttributeMapping">
   <map>
   <entry key="UId" value="userId" /> //key为对应的数据库字段名称，value为提供给客户端获取的属性名字，系统会自动填充值
   <entry key="ph" value="passwordHint" /><br>   </map>
  </property>
</bean> 
备注：网上有很多的关于这个的配置，但是如果您使用的是我提供的版本或是高于这个版本，就应该象上面这样配置，无用质疑，网上大部分的配置都是基于
person-directory-impl,person-directory-api
1.1左右的版本，而最新的cas使用的是1.5的版本，经过查看源代码和api docs确定最新版本的属性参数如上配置。</p>
<p>修改该xml文件中最后一个默认的serviceRegistryDao bean中的属性全部注释掉，或者删除，
这个bean中的RegisteredServiceImpl的ignoreAttributes属性将决定是否添加attributes属性内容，默认为false:不添加，只有去掉这个配置，
cas server才会将获取的用户的附加属性添加到认证用的Principal的attributes中去，我在这里犯过这样的错误，最后还是通过跟踪源码才发现的。</p>
<bean
  id="serviceRegistryDao"
        class="org.jasig.cas.services.InMemoryServiceRegistryDaoImpl">
        &lt;!--
            <property name="registeredServices">
                <list>
                    <bean class="org.jasig.cas.services.RegisteredServiceImpl">
                        <property name="id" value="0" />
                        <property name="name" value="HTTP" />
                        <property name="description" value="Only Allows HTTP Urls" />
                        <property name="serviceId" value="http:///*/*" />
                    </bean>

<pre><code>                &lt;bean class=&quot;org.jasig.cas.services.RegisteredServiceImpl&quot;&gt;
                    &lt;property name=&quot;id&quot; value=&quot;1&quot; /&gt;
                    &lt;property name=&quot;name&quot; value=&quot;HTTPS&quot; /&gt;
                    &lt;property name=&quot;description&quot; value=&quot;Only Allows HTTPS Urls&quot; /&gt;
                    &lt;property name=&quot;serviceId&quot; value=&quot;https:///*/*&quot; /&gt;
                &lt;/bean&gt;

                &lt;bean class=&quot;org.jasig.cas.services.RegisteredServiceImpl&quot;&gt;
                    &lt;property name=&quot;id&quot; value=&quot;2&quot; /&gt;
                    &lt;property name=&quot;name&quot; value=&quot;IMAPS&quot; /&gt;
                    &lt;property name=&quot;description&quot; value=&quot;Only Allows HTTPS Urls&quot; /&gt;
                    &lt;property name=&quot;serviceId&quot; value=&quot;imaps:///*/*&quot; /&gt;
                &lt;/bean&gt;

                &lt;bean class=&quot;org.jasig.cas.services.RegisteredServiceImpl&quot;&gt;
                    &lt;property name=&quot;id&quot; value=&quot;3&quot; /&gt;
                    &lt;property name=&quot;name&quot; value=&quot;IMAP&quot; /&gt;
                    &lt;property name=&quot;description&quot; value=&quot;Only Allows IMAP Urls&quot; /&gt;
                    &lt;property name=&quot;serviceId&quot; value=&quot;imap:///*/*&quot; /&gt;
                &lt;/bean&gt;
            &lt;/list&gt;
        &lt;/property&gt;--&gt;
       &lt;/bean&gt;
</code></pre><p> 修改WEB-INF\view\jsp\protocol\2.0\casServiceValidationSuccess.jsp文件，如下：</p>
<p>&lt;%@ page session=&quot;false&quot;%&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;<a href="http://java.sun.com/jsp/jstl/core%22%" target="_blank"><a href="http://java.sun.com/jsp/jstl/core&quot;%">http://java.sun.com/jsp/jstl/core&quot;%</a></a>&gt;
&lt;%@ taglib uri=&quot;<a href="http://java.sun.com/jsp/jstl/functions" target="_blank"><a href="http://java.sun.com/jsp/jstl/functions">http://java.sun.com/jsp/jstl/functions</a></a>&quot; prefix=&quot;fn&quot;%&gt;</p>
<p><cas:serviceResponse xmlns:cas='http://www.yale.edu/tp/cas'>
 <cas:authenticationSuccess>
  <cas:user>${fn:escapeXml(assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.id)}</cas:user>
  <c:if test="${not empty pgtIou}">
   <cas:proxyGrantingTicket>${pgtIou}</cas:proxyGrantingTicket>
  </c:if>
  <c:if test="${fn:length(assertion.chainedAuthentications) > 1}">
   <cas:proxies>
    <c:forEach var="proxy" items="${assertion.chainedAuthentications}"
     varStatus="loopStatus" begin="0"
     end="${fn:length(assertion.chainedAuthentications)-2}" step="1">
     <cas:proxy>${fn:escapeXml(proxy.principal.id)}</cas:proxy>
    </c:forEach>
   </cas:proxies>
  </c:if>
   <c:if
   test="${fn:length(assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.attributes)
>
0}">
   <cas:attributes>
    <c:forEach
var="attr"
     items="${assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.attributes}"
     varStatus="loopStatus"
begin="0"
     end="${fn:length(assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.attributes)-1}"
     step="1">
     <cas:${fn:escapeXml(attr.key)}>${fn:escapeXml(attr.value)}</cas:${fn:escapeXml(attr.key)}>
    </c:forEach>
   </cas:attributes>
  </c:if>
 </cas:authenticationSuccess>
</cas:serviceResponse>
客户端配置:
1.过滤器CAS Validation Filter：</p>
<p><filter>
  <filter-name>CAS Validation Filter</filter-name>
  <filter-class> org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter</filter-class>
  <init-param>
    <param-name>casServerUrlPrefix</param-name>
    <param-value><a href="http://domainserver:8081/cas" target="_blank">http://domainserver:8081/cas</a></param-value>
  </init-param>
</filter>
在客户端获取信息
AttributePrincipal principal = (AttributePrincipal) request.getUserPrincipal();
String loginName = principal.getName();//获取用户名
Map<String, Object> attributes = principal.getAttributes();
if(attributes != null) {
 System.out.println(attributes.get(&quot;userId&quot;));
 System.out.println(attributes.get(&quot;passwordHint&quot;));
}</p>
<p>posted on 2011-01-21 10:06 <a href="http://www.blogjava.net/tufanshu/" target="_blank">雪地孤鸿</a> 阅读(3704) <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#Post" target="_blank">评论(7)</a>  <a href="http://www.blogjava.net/tufanshu/admin/EditPosts.aspx?postid=343290" target="_blank">编辑</a>  <a href="http://www.blogjava.net/tufanshu/AddToFavorite.aspx?id=343290" target="_blank">收藏</a> 所属分类: <a href="http://www.blogjava.net/tufanshu/category/4974.html" target="_blank">java</a> <img src="" alt=""></p>
<p><a href=""></a>
<strong>FeedBack:</strong></p>
<p><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#343395" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-01-23 13:13 | <a href="">来如风</a>
非常好，我上周也配置成功
只是最后过滤器有疑问</p>
<p><init-param></p>
<p><param-name>casServerUrlPrefix</param-name></p>
<p><param-value><a href="http://domainserver:8081/cas%3C/param-value%3E" target="_blank"><a href="http://domainserver:8081/cas">http://domainserver:8081/cas</a></param-value></a>
</init-param>
我是集成了spring security 的配置，貌似这些不在过滤其中配置，在bean文件中有  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=%e6%9d%a5%e5%a6%82%e9%a3%8e" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#343442" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-01-24 16:29 | <a href="">coolszy</a>
你好，按照你的配置，但是
Map<String, Object> attributes = principal.getAttributes();
还是得到空值，不知道什么原因  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=coolszy" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a></p>
<p><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#343924" title="permalink: re: cas配置全攻略[未登录]" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略[未登录]</p>
<p>2011-02-07 11:02 | <a href="">mcikeay</a></p>
<p><entry key="username" value="uid"/><!-- 这里必须这么写，系统会自己匹配，貌似和where语句后面的用户名字段的拼写没有什么关系 -->
cas 会自己组装<map>节点中的key-value, 节点间默认是 and 连接  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=mcikeay" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#344268" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-02-14 15:15 | <a href="http://040922/" target="_blank">tufanshu</a>
@coolszy
请检查cas client的版本是否正确  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=tufanshu" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a></p>
<p><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#347172" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-03-29 10:45 | <a href="">wuximin</a>
通过ldap验证，改怎样修改呢  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=wuximin" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#351783" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-06-05 18:19 | <a href="http://xn--rgv/" target="_blank">artd</a>
按您的要求，为何还是不行呀，不知道那里出问题了。
不过我用的server是3.3.5.1
用3.4.5也不行，有空交流一下哟。
以下是log信息
2011-06-05 18:09:19,515 DEBUG [org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver] - Attempting to resolve a principal...
2011-06-05 18:09:19,515 DEBUG [org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver] - Creating SimplePrincipal for [test]
2011-06-05 18:09:20,421 DEBUG [org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao] - Created seed map=&#39;{username=[test]}&#39; for uid=&#39;test&#39;
2011-06-05 18:09:20,421 DEBUG [org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao] - Adding attribute &#39;username&#39; with value &#39;[test]&#39; to query builder &#39;null&#39;
2011-06-05 18:09:20,421 DEBUG [org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao] - Generated query builder &#39;sql=[username = ?] args=[test]&#39; from query Map {username=[test]}.
2011-06-05 18:09:20,546 DEBUG [org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao] - Executed &#39;select id,username,password,email,score from user where username = ?&#39; with arguments [test] and got results [{id=20428, username=test, password=1a16128849444873, email=et@163.com, score=6}]
2011-06-05 18:09:20,562 INFO [org.jasig.cas.CentralAuthenticationServiceImpl] - Granted service ticket [ST-1-cp3cb14yiqbqnYfg7C1f-cas] for service [<a href="http://d7.abc.com/simple.php" target="_blank"><a href="http://d7.abc.com/simple.php">http://d7.abc.com/simple.php</a></a>] for user [test]
2011-06-05 18:09:20,640 DEBUG [org.springframework.web.servlet.view.RedirectView] - Rendering view with name &#39;null&#39; with model null and static attributes {}
2011-06-05 18:09:20,703 DEBUG [org.springframework.web.servlet.view.ResourceBundleViewResolver] - Cached view [casServiceSuccessView_zh_CN]
2011-06-05 18:09:20,703 DEBUG [org.springframework.web.servlet.view.JstlView] - Rendering view with name &#39;casServiceSuccessView&#39; with model {assertion=[principals={[[Principal=test, attributes={authenticationMethod=com.jute.framework.jdbc.QueryDatabaseAuthenticationHandler}]]} for service=<a href="http://d7.abc.com/simple.php" target="_blank"><a href="http://d7.abc.com/simple.php">http://d7.abc.com/simple.php</a></a>]} and static attributes {}
2011-06-05 18:09:20,750 DEBUG [org.springframework.web.servlet.view.JstlView] - Added model object &#39;assertion&#39; of type [org.jasig.cas.validation.ImmutableAssertionImpl] to request in view with name &#39;casServiceSuccessView&#39;
2011-06-05 18:09:20,750 DEBUG [org.springframework.web.servlet.view.JstlView] - Forwarding to resource [/WEB-INF/view/jsp/protocol/2.0/casServiceValidationSuccess.jsp] in InternalResourceView &#39;casServiceSuccessView&#39;
  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=artd" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a></p>
<p><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#361580" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略<a href=""></a></p>
<p>2011-10-19 15:24 | <a href="">fanfree</a>
同样遇到 Map是空的，没有附加属性  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=fanfree" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.blogjava.net/RequireRegister.aspx" target="_blank">新用户注册</a>  <a href="">刷新评论列表</a>  </p>
<p><a href=""></a> <a href="http://q.cnblogs.com/">博问 - 解决您的IT难题</a>   <a href="http://www.cnblogs.com/" target="_blank">博客园</a>  <a href="http://q.cnblogs.com/" target="_blank">博问</a>  <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>  <a href="http://job.cnblogs.com/cate-java_programmer/" target="_blank">Java程序员招聘</a> 标题  请输入标题 姓名  请输入你的姓名 主页 请输入验证码 验证码 /*  <img src="" alt=""> 内容(请不要发表任何与政治相关的内容) 请输入评论内容 Remember Me?   <a href="http://www.blogjava.net/login.aspx?ReturnURL=http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html&amp;SourceURL=/tufanshu/archive/2011/01/21/343290.html" target="_blank">登录</a>       [使用Ctrl+Enter键可以直接提交]    IT新闻：
· <a href="http://news.cnblogs.com/n/149115/" target="_blank">苹果在移动支付领域之慢，是福是祸？</a>
· <a href="http://news.cnblogs.com/n/149114/" target="_blank">黑莓应用商店应用下载量突破30亿次，应用数量达9万款</a>
· <a href="http://news.cnblogs.com/n/149113/" target="_blank">微软将推出Bing天使基金孵化器</a>
· <a href="http://news.cnblogs.com/n/149112/" target="_blank">苹果在华测试iPad mini：微胖 具备通话功能</a>
· <a href="http://news.cnblogs.com/n/149111/" target="_blank">抱上微软粗腿不怕！诺基亚豪言明年定走出困境</a></p>
<p>博客园首页随笔：
· <a href="http://www.cnblogs.com/lzrabbit/archive/2012/07/09/2574491.html" target="_blank">MVC3使用Unity实现依赖注入接口与于实现类自动注册</a>
· <a href="http://www.cnblogs.com/stoic/archive/2012/07/09/2582212.html" target="_blank">k-means clustering K平均算法</a>
· <a href="http://www.cnblogs.com/izumu/archive/2012/07/09/2582200.html" target="_blank">【hdu - 1061 Rightmost Digit】</a>
· <a href="http://www.cnblogs.com/refactor/archive/2012/07/09/2575995.html" target="_blank">SqlServer 对 数据类型 text 的操作</a>
· <a href="http://www.cnblogs.com/stephen-liu74/archive/2012/07/09/2423565.html" target="_blank">Step By Step(Lua弱引用table)</a>
知识库：
· <a href="http://kb.cnblogs.com/page/143279/" target="_blank">页面前端的水有多深？再议页面开发</a>
· <a href="http://kb.cnblogs.com/page/130367/" target="_blank">Fiddler 教程</a>
· <a href="http://kb.cnblogs.com/page/148772/" target="_blank">关于编程学习的七点思索</a>
· <a href="http://kb.cnblogs.com/page/115175/" target="_blank">一地鸡毛 — 软件项目中的人际困局</a>
· <a href="http://kb.cnblogs.com/page/148841/" target="_blank">互联网——降级论</a>  网站导航:</p>
<p><a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园</a>   <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>   <a href="http://kb.cnblogs.com/" target="_blank">知识库</a>   <a href="http://www.cppblog.com/" target="_blank">C++博客</a>   <a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a>   <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html?opt=admin" target="_blank">管理</a> 相关文章:</p>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/02/09/343972.html" target="_blank">cas server 3.4.5 部署在weblogic问题记录</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/01/26/343543.html" target="_blank">cas server使用mysql数据库和oralce数据库的差异</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343318.html" target="_blank">cas server logout的问题</a></li>
<li><a href="">cas配置全攻略</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/06/26/210852.html" target="_blank">JForum 的 SSO集成的问题解决</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2007/12/24/170126.html" target="_blank">apache2.2.6+tomcat5.5.17配置说明</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/12/04/85371.html" target="_blank">找不到C.TLD的问题</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/11/01/78479.html" target="_blank">roller2.3源代码部署笔录</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/07/31/60981.html" target="_blank">tomcat 服务器抛出socket异常“文件打开太多”的问题</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/12/26/25499.html" target="_blank">hsql的使用</a><br>Copyright ©2012 雪地孤鸿 Powered By: <a href="http://www.cnblogs.com/" target="_blank">博客园</a> 模板提供：<a href="http://blog.hjenglish.com/" target="_blank">沪江博客</a>
<a href="&quot;Go to the previous month&quot;">&lt;</a>2011年1月<a href="&quot;Go to the next month&quot;">&gt;</a>日一二三四五六2627282930311234567891011121314151617181920<a href="http://www.blogjava.net/tufanshu/archive/2011/01/21.html" target="_blank">21</a>22232425<a href="http://www.blogjava.net/tufanshu/archive/2011/01/26.html" target="_blank">26</a>272829303112345</li>
</ul>
<h3 id="-">常用链接</h3>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/MyPosts.html" target="_blank">我的随笔</a></li>
<li><a href="http://www.blogjava.net/tufanshu/MyComments.html" target="_blank">我的评论</a></li>
<li><a href="http://www.blogjava.net/tufanshu/OtherPosts.html" target="_blank">我的参与</a></li>
<li><a href="http://www.blogjava.net/tufanshu/RecentComments.html" target="_blank">最新评论</a></li>
</ul>
<h3 id="-13-">留言簿(13)</h3>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/Contact.aspx?id=1" target="_blank">给我留言</a></li>
<li><a href="http://www.blogjava.net/tufanshu/default.aspx?opt=msg" target="_blank">查看公开留言</a></li>
<li><a href="http://www.blogjava.net/tufanshu/admin/MyMessages.aspx" target="_blank">查看私人留言</a></li>
</ul>
<h1 id="-">随笔分类</h1>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/category/9675.html" target="_blank">appfuse(1)</a><a href="http://www.blogjava.net/tufanshu/category/9675.html/rss" title="Subscribe to appfuse(1)" target="_blank"><img src="&quot;Subscribe to appfuse(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/33305.html" target="_blank">CRM&amp;ERP(1)</a><a href="http://www.blogjava.net/tufanshu/category/33305.html/rss" title="Subscribe to CRM&amp;ERP(1)" target="_blank"><img src="&quot;Subscribe to CRM&amp;ERP(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/44350.html" target="_blank">Grails(3)</a><a href="http://www.blogjava.net/tufanshu/category/44350.html/rss" title="Subscribe to Grails(3)" target="_blank"><img src="&quot;Subscribe to Grails(3" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/4974.html" target="_blank">java(11)</a><a href="http://www.blogjava.net/tufanshu/category/4974.html/rss" title="Subscribe to java(11)" target="_blank"><img src="&quot;Subscribe to java(11" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/41549.html" target="_blank">ofbiz学习(1)</a><a href="http://www.blogjava.net/tufanshu/category/41549.html/rss" title="Subscribe to ofbiz学习(1)" target="_blank"><img src="&quot;Subscribe to ofbiz学习(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/30111.html" target="_blank">seam2.0学习笔记(1)</a><a href="http://www.blogjava.net/tufanshu/category/30111.html/rss" title="Subscribe to seam2.0学习笔记(1)" target="_blank"><img src="&quot;Subscribe to seam2.0学习笔记(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/4243.html" target="_blank">SPRING</a><a href="http://www.blogjava.net/tufanshu/category/4243.html/rss" title="Subscribe to SPRING" target="_blank"><img src="&quot;Subscribe to SPRING&quot;" alt=""></a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/30359.html" target="_blank">sso(3)</a><a href="http://www.blogjava.net/tufanshu/category/30359.html/rss" title="Subscribe to sso(3)" target="_blank"><img src="&quot;Subscribe to sso(3" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/4244.html" target="_blank">STRUTS(1)</a><a href="http://www.blogjava.net/tufanshu/category/4244.html/rss" title="Subscribe to STRUTS(1)" target="_blank"><img src="&quot;Subscribe to STRUTS(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/3522.html" target="_blank">Sync4j(1)</a><a href="http://www.blogjava.net/tufanshu/category/3522.html/rss" title="Subscribe to Sync4j(1)" target="_blank"><img src="&quot;Subscribe to Sync4j(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/3293.html" target="_blank">SyncML(2)</a><a href="http://www.blogjava.net/tufanshu/category/3293.html/rss" title="Subscribe to SyncML(2)" target="_blank"><img src="&quot;Subscribe to SyncML(2" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/36144.html" target="_blank">大战SOA &amp; MULE</a><a href="http://www.blogjava.net/tufanshu/category/36144.html/rss" title="Subscribe to 大战SOA &amp; MULE" target="_blank"><img src="&quot;Subscribe to 大战SOA &amp; MULE&quot;" alt=""></a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/15210.html" target="_blank">工作日志(2)</a><a href="http://www.blogjava.net/tufanshu/category/15210.html/rss" title="Subscribe to 工作日志(2)" target="_blank"><img src="&quot;Subscribe to 工作日志(2" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/4242.html" target="_blank">开发工具(3)</a><a href="http://www.blogjava.net/tufanshu/category/4242.html/rss" title="Subscribe to 开发工具(3)" target="_blank"><img src="&quot;Subscribe to 开发工具(3" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/22461.html" target="_blank">生活感悟(1)</a><a href="http://www.blogjava.net/tufanshu/category/22461.html/rss" title="Subscribe to 生活感悟(1)" target="_blank"><img src="&quot;Subscribe to 生活感悟(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/40597.html" target="_blank">系统维护(3)</a><a href="http://www.blogjava.net/tufanshu/category/40597.html/rss" title="Subscribe to 系统维护(3)" target="_blank"><img src="&quot;Subscribe to 系统维护(3" alt="">&quot;)</a></li>
</ul>
<h1 id="-">随笔档案</h1>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/02.html" target="_blank">2011年2月 (2)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/01.html" target="_blank">2011年1月 (3)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2010/12.html" target="_blank">2010年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2010/05.html" target="_blank">2010年5月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2010/03.html" target="_blank">2010年3月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/12.html" target="_blank">2009年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/09.html" target="_blank">2009年9月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/08.html" target="_blank">2009年8月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/07.html" target="_blank">2009年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/05.html" target="_blank">2009年5月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/04.html" target="_blank">2009年4月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/02.html" target="_blank">2009年2月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/07.html" target="_blank">2008年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/06.html" target="_blank">2008年6月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/03.html" target="_blank">2008年3月 (3)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2007/12.html" target="_blank">2007年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2007/08.html" target="_blank">2007年8月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2007/07.html" target="_blank">2007年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/12.html" target="_blank">2006年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/11.html" target="_blank">2006年11月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/10.html" target="_blank">2006年10月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/09.html" target="_blank">2006年9月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/07.html" target="_blank">2006年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/04.html" target="_blank">2006年4月 (2)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/12.html" target="_blank">2005年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/11.html" target="_blank">2005年11月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/10.html" target="_blank">2005年10月 (4)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/09.html" target="_blank">2005年9月 (1)</a></li>
</ul>
<h1 id="-">文章档案</h1>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archives/2005/09.html" target="_blank">2005年9月 (1)</a></li>
</ul>
<h1 id="blog">blog</h1>
<ul>
<li><a href="http://www.blogjava.net/eamoi/" target="_blank">eamoi之Coder日志</a></li>
<li>ajax</li>
<li><a href="http://www.blogjava.net/eamoi" target="_blank">liferayPortal</a></li>
<li><a href="http://steeven.cnblogs.com/" target="_blank">steeven</a></li>
<li><a href="http://www.cnblogs.com/zhengyun_ustc/" target="_blank">sync4j</a></li>
<li><a href="http://www.u2o.net/blog/default.asp" target="_blank">sync4j1</a></li>
<li><a href="http://www.blogjava.net/sean" target="_blank">大胃</a></li>
<li><a href="http://www.blogjava.net/zyb9114/" target="_blank">月亮的太阳</a></li>
<li><a href="http://www.blogjava.net/SteelHand" target="_blank">铁手剑谱</a></li>
<li>铁手</li>
</ul>
<h3 id="-">搜索</h3>
<p>*</p>
<ul>
<li></li>
</ul>
<h3 id="-http-www-blogjava-net-tufanshu-commentsrss-aspx-">最新评论 <a href="http://www.blogjava.net/tufanshu/CommentsRSS.aspx" target="_blank"><img src="" alt=""></a></h3>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/11/02/343972.html#362546" target="_blank">1. re: cas server 3.4.5 部署在weblogic问题记录[未登录]</a></li>
<li>评论内容较长,点击标题查看</li>
<li>--大雄</li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/10/19/343290.html#361580" target="_blank">2. re: cas配置全攻略</a></li>
<li>同样遇到 Map是空的，没有附加属性</li>
<li>--fanfree</li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/06/19/343318.html#352630" target="_blank">3. re: cas server logout的问题</a></li>
<li>加了这个还是停在原来的退出页面，</li>
<li>--artd</li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/06/05/343290.html#351783" target="_blank">4. re: cas配置全攻略</a></li>
<li>评论内容较长,点击标题查看</li>
<li>--artd</li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/03/29/343290.html#347172" target="_blank">5. re: cas配置全攻略</a></li>
<li>通过ldap验证，改怎样修改呢</li>
<li>--wuximin</li>
</ul>
<h3 id="-">阅读排行榜</h3>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/10/20/76389.html" target="_blank">1. linux+php5.1.6+mysql5.0.2+apache2.0.55安装配置说明：(12245)</a></li>
<li><a href="">2. cas配置全攻略(3704)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/09/14/69691.html" target="_blank">3. 在tomcat下发布使用eclipse中的ant打包后的war文件(3490)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/03/25/188552.html" target="_blank">4. cas配置之初体验(3313)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/07/26/217681.html" target="_blank">5. opencrx安装手记(2914)</a></li>
</ul>
<h3 id="-">评论排行榜</h3>
<ul>
<li><a href="">1. cas配置全攻略(7)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/10/20/76389.html" target="_blank">2. linux+php5.1.6+mysql5.0.2+apache2.0.55安装配置说明：(4)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/10/15/15574.html" target="_blank">3. SyncML Intensive 继续(4)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/11/17/20309.html" target="_blank">4. jdk1.4升级到JDK1.5的问题(3)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/09/03/293787.html" target="_blank">5. ofbiz9 + oracle 11g(3)</a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--cas配置全攻略-哈哈-吼吼-这是个好地方-BlogJava/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--cas配置全攻略-哈哈-吼吼-这是个好地方-BlogJava" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-Scripts--BrowserSecurity-css、javascript/">Browser Security</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-Scripts--BrowserSecurity-css、javascript/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="browser-security-css-javascript">Browser Security-css、javascript</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度云收藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<h1 id="-wooyun-http-drops-wooyun-org-wooyun-"><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">WooYun知识库</a></h1>
<p><a href="http://drops.wooyun.org/login" title="登录" target="_blank">登录</a></p>
<p>像一朵乌云一样成长</p>
<ul>
<li><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">首页</a></li>
<li><a href="http://www.wooyun.org/" target="_blank">WooYun</a></li>
<li><a href="http://zone.wooyun.org/" target="_blank">Zone</a></li>
<li><a href="http://drops.wooyun.org/newsend" target="_blank">投稿</a>
<a href="http://drops.wooyun.org/" title="首页" target="_blank">首页</a> » <a href="http://drops.wooyun.org/category/tips" title="查看 技术分享 中的全部文章" target="_blank">技术分享</a> » Browser Security-css、javascript</li>
</ul>
<h2 id="-browser-security-css-javascript-http-drops-wooyun-org-tips-150-permanent-link-to-browser-security-css-javascript-"><a href="http://drops.wooyun.org/tips/150" title="Permanent Link to Browser Security-css、javascript" target="_blank">Browser Security-css、javascript</a></h2>
<p>0人收藏 <a href="">收藏</a></p>
<p>2013/06/19 18:55  | <a href="http://drops.wooyun.org/author/瞌睡龙" title="由 瞌睡龙 发布" target="_blank">瞌睡龙</a>  | <a href="http://drops.wooyun.org/category/tips" title="查看 技术分享 中的全部文章" target="_blank">技术分享</a>  | <a href="">占个座先</a></p>
<h3 id="-css-">层叠样式表（css）</h3>
<p>调用方式有三种：
1 用<style> 2 通过<link rel=stylesheet>，或者使用style参数。 3 XML（包括XHTML）可以通过&lt;?xml-stylesheet href=...?&gt;</p>
<p>浏览器进行解析的时候会先HTML解析再做CSS解析，所以下面的代码会出错：</p>
<style> some_descriptor { background: url('http://www.example.com/</style><h1 > Gotcha!'); } </style>

<p>字符编码：</p>
<p>为了保证在css中可以使用可能产生问题的字符，css提供了一种方式由反斜杠()加六位十六进制数字。</p>
<p>字符e可以编码成\65 \065 \000065，当后面紧跟的字符也是十六进制字符中的一种的时候，只有最后一个才是对的。</p>
<p>例如teak编码成 t\65ak 不会正常，因为会解码时会把\65a当成一个字符。</p>
<p>为了避免上述情况可以编码以后加一个空白符，例如：t\65 k。</p>
<p>很多CSS解析器同样会解析引号之外的字符串。</p>
<p>下面两个代码IE下相同</p>
<p><A STYLE='color: expression\028 alert \028 1 \029 \029'> <A STYLE='color: expression(alert(1))'></p>
<h3 id="fuzzing">Fuzzing</h3>
<p>CSS的解析规则与HTML和JavaScript在几个方面不同。</p>
<p>JavaScript在语法错误的时候，整个代码都会被忽略，而CSS解析错误时，浏览器尝试忽略错误的代码。</p>
<p>这点上跟HTML比较类似，因为HTML语法错误时，浏览器会尝试修复并展现出来，</p>
<p>@符号用来在CSS样式表中定义一个特殊属性，定义字符集（@charset）或者media的样式（@media）。</p>
<p>导入外部样式（@import）或外部字体（@font-face）或命名空间（@namespace）或定义一个演示文件（@page）。</p>
<p>定义字符集的时候，可以定义一个多字节字符集（如：SHIFT-JIS，BIG5，EUC-JP，EUC-KR或GB2312）可能会使反斜线失效：
@charset &quot;GB-2312&quot;; /*{ content:&quot;a%90\&quot;; color:red; z:k&quot;; }</p>
<p>会解析为：</p>
<p>@charset &quot;GB-2312&quot;; /*{ content:&quot;a撞&quot;; color:red; z:k&quot;; }</p>
<p>还有一种时UTF-7字符：</p>
<p>@charset &quot;UTF-7&quot;; /*{ content:&quot;a+ACIAOw- color:red; z:k&quot;; }</p>
<p>会解析为：</p>
<p>@charset &quot;UTF-7&quot;; /*{ content:&quot;a&quot;; color:red; z:k&quot;; }</p>
<p>定义@charset在IE中并非这一种定义UTF-7的方式：</p>
<p>+/v8- /*{ content:&quot;a+ACIAOw- color:red; z:k&quot;; }</p>
<p>在一些浏览器中导入的时候可以定义字符集：</p>
<link rel=stylesheet charset=UTF-7 src=stylesheet>

<p>CSS的选择器是非常有趣的部分，他可以包含字符串，表达式，函数。选择器也可以由多行组成：</p>
<p>CSS中的声明时一个 属性/值 对里面的规则集，通常形式如下：
property: value;</p>
<p>property是一个关键字，包括字母数字破折号，和大于0x7F的字符，也有绕过的方式：</p>
<p>-moz-binding与\2d moz\2d binding相等。</p>
<p>IE中property没有严格遵守这个规则，如果一个属性包含多个字，只有第一个字将被使用，其他的都会忽略：</p>
<p>a b c: value; a: value;</p>
<p>上面两个规则是等效的。 并且IE中:可以替换为=</p>
<p>a = value; a: value;</p>
<p>上面两个也是等效的。</p>
<p>同样重要的是IE允许多行的字符串，URL，选择器。</p>
<p>CSS最明显的局限性是，他本身不是一种编程语言，而是一种语言风格，他没有任何的编程逻辑。</p>
<p>他很难不借助于JavaScript进行攻击，下面主要讨论的是完全基于CSS不依赖于其他脚本语言的攻击。</p>
<p>整体的逻辑：
element:condition{    action;    }</p>
<p>element可以为任意值，condition为CSS选择器，如:visited，:active，:hover，:selected。 事件选择器：</p>
<p>1 :hover 悬停鼠标在一个元素。 2 :active 点击一个元素。 3 :focus 光标放在一个元素上。</p>
<p>CSS造成点击劫持：</p>
<style> iframe{ filter:alpha(opacity=0);opacity: 0; position: absolute;top: 0px;left: 0px; height: 300px;width: 250px; } img{ position: absolute;top: 0px;left: 0px; height: 300px;width: 250px; } </style> <img src="用户看到的图片"> <iframe src="用户实际操作的页面"></iframe>

点击劫持的防御方法一是添加X-FRAME-OPTIONS:NEVER头，另外一种方式是利用JavaScript：

<body> <script> if(top!=self) document.write('<plaintext>'); </script>

两种方式都有局限性，之前发过点击劫持的文档了，详见：[http://drops.wooyun.org/tips/104](http://drops.wooyun.org/tips/104)

如下代码是一个有效的CSS2的代码，并且在Firefox，Safari，Chrome，Opera，IE7，IE8，IE9中没有影响，但是在IE6中，可执行代码：
<style> foo[bar|="} /*{xss: expression(alert(1));} x{"]{   color:red; } </style>

<p>以下代码中的color可以编码为c\olor，\c\o\l\or，c\6f l\06f r 。</p>
<p>/*{ color: red; }</p>
<h3 id="-">浏览器脚本语言</h3>
<p>解析javascript的时候以下两段代码不相同：
代码一 代码二 &amp;/#x3cscript&gt; var my_variable1 = 1; var my_variable2 = &amp;/#x3c/script&gt; &amp;/#x3cscript&gt; 2; &amp;/#x3c/script&gt; &amp;/#x3cscript&gt; var my_variable1 = 1; var my_variable2 = 2; &amp;/#x3c/script&gt;</p>
<p>这是因为</p>
<script>
在解析之前并没有链接起来，相反，代码一中的第一个script标签会引起错误。

从而导致整个标签被忽略，所有标签内的代码都无法执行。

在JS中有两种定义函数的方式：
var aaa=function(){...} function aaa(){...}

var 方式定义的函数，不能先调用函数，后声明，只能先声明函数，然后调用。

function方式定义函数可以先调用，后声明。
<script>   //aaa();这样调用就会出错   var aaa = function(){     alert("A");   }   aaa();//这样就不会出错   //先调用后声明   bbb();   function bbb(){     alert("bb");   }   </script>

<p>出于历史原因，某些HTML元素</p>
<p>（<IMG>，<FORM>，<EMBED>，<object>，<APPLET>）
的名字也直接映射到文档的命名空间，如下面的代码片段所示：</p>
<p><img name="hello" src="http://www.example.com/"> <script> alert(document.hello.src); </script></p>
<p>DOM操作：</p>
<p>document.getElementById(&quot;output&quot;).innerHTML = &quot;<b>Hi mom!</b>&quot;;</p>
<p>向id为output的标签里插入</p>
<p><b>Hi mom!</b>
。 采用.innerHTML插入数据时，必须为完整的数据块，比如下面的代码：</p>
<p>some_element.innerHTML = &quot;<b>Hi&quot;; some_element.innerHTML += &quot; mom!</b><i>&quot;;</p>
<p>等同于下面的代码：</p>
<p>some_element.innerHTML = &quot;<b>Hi</b> mom!<i></i>&quot;;</p>
<p>DOM操作时，其本身会对一些字符做解码处理，如下代码：</p>
<p><textarea style="display:none" id="json"> {   &quot;name&quot;:&quot;Jack&quot;&quot;,   &quot;country&quot;:&quot;China&quot; } </textarea> My name is :<span id="me">loading...</span> <script> function $(id){   return document.getElementById(id); } var data=$(&quot;json&quot;).value; alert(data); var profile=eval(&quot;(&quot;+data+&quot;)&quot;);//把string转成object方便操作 $(&quot;me&quot;).innerHTML = profile.name; </script></p>
<p>可以看到alert出的data数据为</p>
<p>{      &quot;name&quot;:&quot;Jack&quot;&quot;,      &quot;country&quot;:&quot;China&quot; }</p>
<p>下面的例子是使用getAttribute时也会解码：</p>
<p><img id="pic" src="http://www.baidu.com/img/baidu_sylogo1.gif" bigpic="http://baidu.com&quot;&gt;&lt;img src=1 onerror=alert(1)&gt;&lt;i b =" onclick="test()"> <div id="bigimage"> </div> <script> function $(id){   return document.getElementById(id); } function test(){   big=$(&quot;pic&quot;).getAttribute(&quot;bigpic&quot;);//big此时为：<a href="http://baidu.com&quot;&gt;" target="_blank">http://baidu.com&quot;&gt;</a><img src=1 onerror=alert(1)><i b =   $("bigimage").innerHTML="<img src=\"" + big + "\"/>"; } </script></p>
<h3 id="javascript-">javascript编码</h3>
<p>javascript支持多种字符编码方式：
1 C语言的编码，\b表示退格，\t表示水平制表符等等，公认的ECMAScript编码。 2 三位数字：用反斜杠加八位8进制来表示，如\145可表示字符e，该语法不属于ECMAScript，但是基本所有的浏览器都支持。 3 两位数字：用反斜杠加x加八位16进制表示，如\x65可表示字符e，同样不属于ECMAScript，但是在解析底层，C语言中有很好的支持。 4 四位数字：Unicode编码，十六位16进制表示，如\u0065可表示字符e，属于ECMAScript编码。</p>
<p>需要注意的是组后一种编码方式不止在字符串中才可以表示，如下代码也可正常的执行（但是不可替代括号与引号）：</p>
<script> \u0061lert("This displays a message!"); </script>

<h3 id="fuzzing">Fuzzing</h3>
<p>JavaScript中，window对象是一个全局变量，并且默认定义的变量都为全局变量，window下的方法可以直接访问：</p>
<script type="text/javascript"> alert(1); window.alert(1); window.alert(window.alert); </script>

<p>并且可重写：</p>
<script type="text/javascript"> function alert() {} alert(1) </script>

<p>定义数组的两种方式：</p>
<script type="text/javascript"> x=[1,alert,{},[],/a/]; alert(x[4]); </script>

<p>默认返回最后一个：</p>
<script type="text/javascript"> objLiteral={'objProperty':123}; alert(objLiteral[0,1,2,3,'objProperty']); </script> <script type="text/javascript"> objLiteral={'objProperty':123}; alert(objLiteral[(0,1,2,3,(0,'objProperty'))]); </script>

<p>JavaScript中定义字符串除了&#39;string&#39;，&quot;string&quot;方式之外，还有其他的方式：</p>
<script type="text/javascript"> alert(/I am a string/+''); alert(/I am a string/.source); alert(/I am a string/['source']); alert(['I am a string']+[]) </script>

<p>第一个alert中是一个正则表达式加一个空字符串，JavaScript会把正则强制转为字符串。 第二个alert中使用了标准的正则对象的source属性，返回结果为正则匹配完的字符串，第三个相同是属性的另外一种访问方式。 第三个alert中是利用了访问数组时如果不是指定的访问一个元素，会自动调用toString()方法，转为字符串。 还有一种非标准的使用字符串的方式（IE8，Safari，Opera，Firefox和Chrome已经支持），使用类似数组的方式：</p>
<script type="text/javascript"> alert('abcdefg'[0]); </script>

<p>火狐当中对函数名的规范非常的宽泛：</p>
<script type="text/javascript"> window.function=function function(){return function function() {return function function(){alert('Works in Firefox')}()}()}() </script>

<p>JavaScript支持多行的字符串，当一\结尾时，下一行的字符串会接着上一行的结尾：</p>
<script type="text/javascript"> alert("this is a \ \ \ \ \ string"); </script>

<p>似乎所有的JavaScript引擎都支持函数之前的运算符，如：+，-，~，++，--，!，运算符也可写在typeof和void之前。</p>
<script type="text/javascript"> !~+-++alert(1) </script> <script type="text/javascript"> void~void~typeof~typeof--alert(2) </script> <script type="text/javascript"> alert(3)/abc </script>

<p>最新的Chrome与Safari前两个已经不会执行了。 查看控制台可以看到三个js其实都是报错了的，前两个是由于alert函数返回的是undefined，进行++和--操作的时候是非法的。 最后一个是试图用alert函数除以一个未声明的变量，先执行alert函数后再除的时候报错。
<strong>Tags:</strong> <a href="http://drops.wooyun.org/tag/javascript" target="_blank">javascript</a>, <a href="http://drops.wooyun.org/tag/浏览器" target="_blank">浏览器</a></p>
<p>版权声明：未经授权禁止转载 <a href="http://drops.wooyun.org/author/瞌睡龙" title="由 瞌睡龙 发布" target="_blank">瞌睡龙</a>@<a href="http://drops.wooyun.org/" target="_blank">乌云知识库</a>
分享到： <a href="&quot;分享到QQ空间&quot;"></a> <a href="&quot;分享到新浪微博&quot;"></a> <a href="&quot;分享到腾讯微博&quot;"></a> <a href="&quot;分享到人人网&quot;"></a> <a href="&quot;分享到网易微博&quot;"></a> <a href="&quot;累计分享0次&quot;">0</a></p>
<h3 id="-">相关日志</h3>
<ul>
<li><a href="http://drops.wooyun.org/papers/146" target="_blank">Browser Security-基本概念</a></li>
<li><a href="http://drops.wooyun.org/tips/147" target="_blank">Browser Security-超文本标记语言（HTML）</a></li>
<li><a href="http://drops.wooyun.org/tips/151" target="_blank">Browser Security-同源策略、伪URL的域</a></li>
<li><a href="http://drops.wooyun.org/papers/526" target="_blank">浏览器安全（一）</a></li>
<li><a href="http://drops.wooyun.org/tips/188" target="_blank">详解XMLHttpRequest的跨域资源共享</a></li>
<li><a href="http://drops.wooyun.org/tips/134" target="_blank">针对性攻击与移动安全漏洞</a>
上一篇:<a href="http://drops.wooyun.org/tips/151" target="_blank">Browser Security-同源策略、伪URL的域</a></li>
</ul>
<p>下一篇:<a href="http://drops.wooyun.org/tips/147" target="_blank">Browser Security-超文本标记语言（HTML）</a></p>
<h3 id="-">发表评论</h3>
<p><a href="">点击这里取消回复。</a></p>
<p>您必须 <a href="http://drops.wooyun.org/login" target="_blank">登陆</a> 后才能发表评论。</p>
<h3 id="-">订阅更新</h3>
<ul>
<li><a href="http://drops.wooyun.org/feed" title="点击订阅" target="_blank"><img src="" alt=""></a></li>
</ul>
<h3 id="-">分类</h3>
<ul>
<li><a href="http://drops.wooyun.org/category/papers" title="漏洞分析" target="_blank">漏洞分析</a> (40)</li>
<li><a href="http://drops.wooyun.org/category/tips" title="技术分享" target="_blank">技术分享</a> (57)</li>
<li><a href="http://drops.wooyun.org/category/tools" title="工具收集" target="_blank">工具收集</a> (5)</li>
<li><p><a href="http://drops.wooyun.org/category/news" title="业界资讯" target="_blank">业界资讯</a> (3)</p>
<h3 id="-">最新日志</h3>
</li>
<li><p><a href="http://drops.wooyun.org/tips/688" title="Flash CSRF" target="_blank">Flash CSRF</a></p>
</li>
<li><a href="http://drops.wooyun.org/tips/689" title="XSS与字符编码的那些事儿 —科普文" target="_blank">XSS与字符编码的那些事儿 —科普文</a></li>
<li><a href="http://drops.wooyun.org/papers/680" title="Zabbix SQL Injection/RCE – CVE-2013-5743" target="_blank">Zabbix SQL Injection/RCE – CVE-2013-5743</a></li>
<li><a href="http://drops.wooyun.org/papers/679" title="CDN流量放大攻击思路" target="_blank">CDN流量放大攻击思路</a></li>
<li><a href="http://drops.wooyun.org/news/674" title="从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集" target="_blank">从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集</a></li>
<li><a href="http://drops.wooyun.org/tips/662" title="攻击JavaWeb应用[8]-后门篇" target="_blank">攻击JavaWeb应用[8]-后门篇</a></li>
<li><a href="http://drops.wooyun.org/papers/660" title="php4fun.sinaapp.com PHP挑战通关攻略" target="_blank">php4fun.sinaapp.com PHP挑战通关攻略</a></li>
<li><a href="http://drops.wooyun.org/papers/653" title="搭建基于Suricata+Barnyard2+Base的IDS前端Snorby" target="_blank">搭建基于Suricata+Barnyard2+Base的IDS前端Snorby</a></li>
<li><a href="http://drops.wooyun.org/tools/655" title="GPU破解神器Hashcat使用简介" target="_blank">GPU破解神器Hashcat使用简介</a></li>
<li><a href="http://drops.wooyun.org/tips/649" title="内网渗透应用 跨vlan渗透的一种思路" target="_blank">内网渗透应用 跨vlan渗透的一种思路</a></li>
</ul>
<h3 id="-">最新评论</h3>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>c2y2 在 <a href="http://drops.wooyun.org/tips/689#comment-1883" target="_blank">XSS与字符编码的那些事儿 ---科普文</a>
谢谢</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>Evi1c0de 在 <a href="http://drops.wooyun.org/tips/573#comment-1877" target="_blank">如何用意念获取附近美女的手机号码</a>
连接CMCC跳转到登陆页面 右键源码 修改即可</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>牛牛 在 <a href="http://drops.wooyun.org/tips/688#comment-1871" target="_blank">Flash CSRF</a>
支持一下呵呵</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>luwikes 在 <a href="http://drops.wooyun.org/papers/178#comment-1870" target="_blank">JBoss安全问题总结</a>
mark</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>NgInx 在 <a href="http://drops.wooyun.org/tips/688#comment-1869" target="_blank">Flash CSRF</a>
好吧，基佬，顶你一个，不错。</p>
<ul>
<li><a href="">下一页 »</a>
Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a> | GZai Theme by <a href="http://huaidan.org/" title="GZai Theme produced by 鬼仔" target="_blank">鬼仔</a>
<a href="http://tongji.baidu.com/hm-web/welcome/ico?s=9fc41da6a2322bdd80563c9d5a4bdb1d" target="_blank"><img src="" alt=""></a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/Scripts/">Scripts</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Scripts/" class="label label-primary">Scripts</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-Scripts--BrowserSecurity-css、javascript/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-Scripts--BrowserSecurity-css、javascript" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/">cas改造随笔 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas-horus-">cas改造随笔 - horus - 博客园</h1>
<p><a href=""></a></p>
<p><a href="http://www.cnblogs.com/hellowood/" target="_blank">hello wood</a>
<a href="http://www.cnblogs.com/" target="_blank">博客园</a>   <a href="http://www.cnblogs.com/hellowood/" target="_blank">首页</a>   <a href="http://space.cnblogs.com/" target="_blank">社区</a>   <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a>   <a href="http://space.cnblogs.com/msg/send/horus" target="_blank">联系</a>   <a href="http://www.cnblogs.com/hellowood/rss" target="_blank">订阅</a><a href="http://www.cnblogs.com/hellowood/rss" target="_blank"><img src="" alt="订阅"></a>   <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx" target="_blank">管理</a></p>
<p>随笔-9  评论-5  文章-1  trackbacks-0</p>
<h1 id="-cas-http-www-cnblogs-com-hellowood-archive-2010-08-05-1793364-html-"><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html" target="_blank">cas改造随笔</a></h1>
<p>Sso doc</p>
<p>关键字：</p>
<p>sso域名：cas.server.com</p>
<p>登陆地址（spring web flow）：<a href="https://cas.800jit.com/cas/login" target="_blank"><a href="https://cas.800jit.com/cas/login">https://cas.800jit.com/cas/login</a></a></p>
<p>登陆地址（直接）：<a href="https://cas.800jit.com/cas/directLogin" target="_blank"><a href="https://cas.800jit.com/cas/directLogin">https://cas.800jit.com/cas/directLogin</a></a></p>
<p>退出地址：<a href="https://cas.800jit.com/cas/logout" target="_blank"><a href="https://cas.800jit.com/cas/logout">https://cas.800jit.com/cas/logout</a></a></p>
<p>语言参数：locale=zh_CN，locale=en</p>
<h1 id="-">环境篇</h1>
<p> <img src="" alt=""></p>
<h2 id="-">一、所需软件</h2>
<p>Jdk：jdk1.6.0_13</p>
<p>Apache：httpd-2.2.15-win32-x86-openssl-0.9.8m-r2</p>
<p>Tomcat：apache-tomcat-6.0.10</p>
<p>jks2pfx：证书导出工具<a href="http://www.myssl.cn/download/jks2pfx.zip" target="_blank"><a href="http://www.myssl.cn/download/jks2pfx.zip">http://www.myssl.cn/download/jks2pfx.zip</a></a></p>
<p>memcache：memcached-1.2.1-win32（需要memcache集群环境）</p>
<h2 id="-">二、安全证书生成</h2>
<p>1、<strong>keytool</strong></p>
<p>Apache、tomcat、jdk需要使用安全证书，进windows command窗口生成证书，命令如下：</p>
<p>--生成证书库</p>
<p>keytool -genkey -alias 800jit -keyalg RSA -keystore d:/cert/800jitkey</p>
<p>--从证书库中到处证书</p>
<p>keytool -export -file d:/cert/800jit.crt -alias 800jit -keystore d:/cert/800jitkey</p>
<p>--把证书导入jdk的证书库</p>
<p>keytool -import -keystore d: /jdk1.6.0_13/jre/lib/security/cacerts -file d:/cert/800jit.crt -alias 800jit</p>
<p>--生成Apache服务器的SSL连接需要配置私钥文件和证书文件</p>
<p>D:\casex\jks2pfx&gt;JKS2PFX.bat .keystore 800jitkey tomcat server_dev00</p>
<p>生成的server_dev00.crt，server_dev00.key放到D:/work/Apache2.2/conf/</p>
<p><strong>2**</strong>、openssl**</p>
<p>openssl req -config ..\conf\openssl.cnf -new -out olymtech.csr</p>
<p>openssl rsa -in privkey.pem -out olymtech.key</p>
<p>openssl x509 -in olymtech.csr -out olymtech.cert -req -signkey olymtech.key -days 3650</p>
<p>openssl x509 -in olymtech.cert -out olymtech.der.crt -outform DER</p>
<p>keytool -import -keystore d:/work/jdk1.6.0_13/jre/lib/security/cacerts -file d:/casex/ssl/olymtech.crt -alias olymtech</p>
<p>keytool -import -keystore D:/casex/800jitkey -file D:/casex/cas-doc/ssl/olymtech.crt -alias olymtech</p>
<h2 id="-apache-">三、Apache配置</h2>
<p>Apache+ssl+虚拟机</p>
<p>--修改http.conf文件</p>
<p>取消注释 LoadModule ssl_module modules/mod_ssl.so</p>
<p>取消注释 Include conf/extra/httpd-ssl.conf</p>
<p>取消注释 Include conf/extra/httpd-vhosts.conf</p>
<p>ProxyPass /cas  balancer://cas lbmethod=bytraffic stickysession=jsessionid</p>
<proxy balancer://cas/>

    BalancerMember ajp://192.168.1.190:10009/cas  loadfactor=1 route=jvm1

    BalancerMember ajp://192.168.1.190:8009/cas  loadfactor=1 route=jvm2

</proxy>



<p>--修改httpd-ssl.conf</p>
<p>在<VirtualHost _default_:443>下增加</p>
<p>ProxyPass /cas  balancer://cas/ lbmethod=bytraffic stickysession=jsessionid</p>
<p>ProxyPassReverse /cas balancer://cas/</p>
<p>SSLProxyEngine On</p>
<p>修改</p>
<p>SSLCertificateFile &quot;D:/work/Apache2.2/conf/server_dev00.crt&quot;</p>
<p>SSLCertificateKeyFile &quot;D:/work/Apache2.2/conf/server_dev00.key&quot;</p>
<p>--修改httpd-vhosts.conf</p>
<p>在<VirtualHost /*:80>下增加</p>
<p>ProxyPass /cas  balancer://cas/ lbmethod=bytraffic stickysession=jsessionid</p>
<p>ProxyPassReverse /cas balancer://cas/</p>
<h2 id="-tomcat-">四、Tomcat配置</h2>
<p>修改server.xml</p>
<p>--配置ssl</p>
<Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"

               maxThreads="150" scheme="https" secure="true"

               clientAuth="false" sslProtocol="TLS"

                        keystoreFile="d:/work/apache-tomcat-6.0.10/conf/800jitkey"

                        keystorePass="111111" />



<h2 id="-session-tomcat-">五、session共享（Tomcat）</h2>
<h2 id="-memcache-">六、memcache集群</h2>
<h1 id="cas-server-">CAS SERVER篇</h1>
<h2 id="-cas-">一、CAS 原理介绍</h2>
<p> <img src="" alt=""></p>
<p>访问流程图</p>
<p><strong>主要原理：</strong>用户第一次访问一个CAS 服务的客户web 应用时（访问URL ：<a href="http://192.168.1.90:8081/web1" target="_blank"><a href="http://192.168.1.90:8081/web1">http://192.168.1.90:8081/web1</a></a> ），部署在客户web 应用的cas AuthenticationFilter ，会截获此请求，生成service 参数，然后redirect 到CAS 服务的login 接口，url为<a href="https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F" target="_blank"><a href="https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F">https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F</a></a> ，认证成功后，CAS 服务器会生成认证cookie ，写入浏览器，同时将cookie 缓存到服务器本地，CAS 服务器还会根据service 参数生成ticket,ticket 会保存到服务器，也会加在url 后面，然后将请求redirect 回客户web 应用，url 为<a href="http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20" target="_blank"><a href="http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20">http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20</a></a> 。这时客户端的AuthenticationFilter 看到ticket 参数后，会跳过，由其后面的TicketValidationFilter 处理，TicketValidationFilter 会利用httpclient 工具访问cas 服务的/serviceValidate 接口, 将ticket 、service 都传到此接口，由此接口验证ticket 的有效性，TicketValidationFilter 如果得到验证成功的消息，就会把用户信息写入web 应用的session里。至此为止，SSO 会话就建立起来了，以后用户在同一浏览器里访问此web 应用时，AuthenticationFilter 会在session 里读取到用户信息，所以就不会去CAS 认证，如果在此浏览器里访问别的web 应用时，AuthenticationFilter 在session 里读取不到用户信息，会去CAS 的login 接口认证，但这时CAS 会读取到浏览器传来的cookie ，所以CAS 不会要求用户去登录页面登录，只是会根据service 参数生成一个ticket ，然后再和web 应用做一个验证ticket 的交互。</p>
<h2 id="-cas-">二、CAS 服务端的处理逻辑</h2>
<p>CAS 服务端总共对外定义了9 个接口，客户端通过访问这9 个接口与服务端交互，这9个接口为：
接口</p>
<p>说明</p>
<p>备注 /login</p>
<p>认证接口</p>
<p>  /logout</p>
<p>退出接口，负责销毁认证cookie</p>
<p>  /validate</p>
<p>验证ticket 用的接口，CAS1.0 定义</p>
<p>  /serviceValidate</p>
<p>验证ticket 用的接口，CAS2.0 定义，返回xml 格式的数据</p>
<p>  /proxy</p>
<p>支持代理认证功能的接口</p>
<p>  /proxyValidate</p>
<p>支持代理认证功能的接口</p>
<p>  /CentralAuthenticationService</p>
<p>用于和远程的web services 交互</p>
<p>  /remoteLogin（新增）</p>
<p>认证接口</p>
<p>  /directLogin（新增）</p>
<p>认证接口</p>
<p>详细说明：</p>
<p> <strong>/login:</strong></p>
<p>登录流程这部分要考虑到不同种类用户凭证的获取方案，以及客户应用传来的service 、gateway 、renew 参数的不同取值组合，CAS 为了实现流程的高度可配置性，采用了Spring Web Flow 技术。通过CAS 发布包里的login-webflow.xml 、cas-servlet.xml 、applicationContext.xml 这3 个文件，找出 了登录有关的所有组件，画出处理流程图。</p>
<p> <img src="" alt=""></p>
<p>CAS 默认的登录处理流程</p>
<p> <img src="" alt=""></p>
<p>第一次访问Web 应用的流程走向</p>
<p> <img src="" alt=""></p>
<p>已经登录web1 后，访问web1 的资源（web1 没有启动session ），或访问web2 的资源</p>
<p>注：</p>
<p>1 ： InitialFlowSetupAction: 是流程的入口。用 request.getContextPath() 的值来设置 cookie 的 Path 值， Cookie 的 path 值是在配置文件里定义的，但这个 Action 负责将 request.getContextPath() 的值设置为 Cookie 的 path 值，这是在 cas 部署环境改变的情况下，灵活地设置 cookie path 的方式；把 cookie 的值以及 service 参数的值放入 requestContext 的 flowscope 里。</p>
<p>2 ： GenerateServiceTicketAction 此 Action 负责根据 service 、 GTC cookie 值生成 ServiceTicket 对象， ServiceTicket 的 ID 就是返回给客户应用的 ticket 参数，如果成功创建 ServiceTicket ，则转发到 WarnAction ，如果创建失败，且 gateway 参数为 true ，则直接redirect 到客户应用， 否则则需要重新认证。</p>
<p>3 ： viewLoginForm 这是登录页面， CAS 在此收集用户凭证。 CAS 提供的默认实现是 /WEB-INF/view/jsp/simple/ui/casLoginView.jsp 。</p>
<p>4 ： bindAndValidate 对应 AuthenticationViaFormAction 的 doBind 方法，该方法负责搜集登录页面上用户录入的凭证信息（用户名、密码等），然后把这些信息封装到 CAS 内部的 Credentials 对象中。用户在 casLoginView.jsp 页面上点击提交后，会触发此方法。</p>
<p>5:submit   对应 AuthenticationViaFormAction 的 submit 方法 , 如果 doBind 方法成功执行完， 则触发 submit 方法，此方法负责调用centralAuthenticationService 的      grantServiceTicket 方法，完成认证工作，如果认证成功，则生成 TicketGrantingTicket 对象，放在缓存里， TicketGrantingTicket 的 ID 就是 TGC Cookie 的 value 值。</p>
<p>6 ： warn  CAS 提供了一个功能：用户在一个 web 应用中跳到另一个 web 应用时， CAS 可以跳转到一个提示页面，该页面提示用户要离开一个应用进入另一个应用，可以让用户自己选择。用户在登录页面 viewLoginForm 上选中了 id=”warn” 的复选框，才能开启这个功能。</p>
<p>WarnAction 就检查用户有没有开启这个功能，如果开启了，则转发到showWarnView, 如果没开启，则直接redirect 到客户应用。</p>
<p>7 ：SendTicketGrantingTicketAction 此Action 负责为response 生成TGC Cookie ，cookie 的值就是 AuthenticationViaFormAction 的submit 方法生成的 TicketGrantingTicket 对象的 ID 。</p>
<p>8 ： viewGenerateLoginSuccess 这是 CAS 的认证成功页面。</p>
<p><strong>/logout:</strong> （ 对应实现类 org.jasig.cas.web.LogoutController ）</p>
<p>处理逻辑：   </p>
<pre><code>    1) removeCookie

   2) 在服务端删除TicketGrantingTicket 对象（此对象封装了cookie 的value 值）

   3 ）redirect 到退出页面，有2 种选择：

      if(LogoutController 的followServiceRedirects 属性为true 值，且url 里的service 参数非空){

            redirect 到 sevice 参数标识的url

         }

      else{

         redirect 到内置的casLogoutView （cas/WEB-INF/view/jsp/default/ui/casLogoutView.jsp ），如果url 里有url 参数，则此url 参数标识的链接会显示在casLogoutView 页面上。

       }
</code></pre><p><strong>/serviceValidate: </strong>（对应实现类 org.jasig.cas.web.ServiceValidateController ）</p>
<p> 处理逻辑：  </p>
<p>  如果service 参数为空或ticket 参数为空，则转发到failureView （/WEB-INF/view/jsp/default/protocol/2.0/casServiceValidationFailure.jsp ）</p>
<pre><code>验证ticket 。以ticket 为参数，去缓存里找ServiceTicketImpl 对象，如果能找到，且没有过期，且ServiceTicketImpl 对象对应的service 属性和service 参数对应，则验证通过，验证通过后，请求转发至casServiceSuccessView （cas/WEB-INF/view/jsp/default/protocol/2.0/casServiceValidationSuccess.jsp ），验证不通过，则转发到failureView 。
</code></pre><h2 id="-">三、认证相关的概念及流程</h2>
<p>概念</p>
<ul>
<li><strong>Credentials**</strong> **用户提供的用于登录用的凭据信息，如用户名/ 密码、证书、IP 地址、Cookie 值等。比如 UsernamePasswordCredentials ，封装的是用户名和密码。CAS 进行认证的第一步，就是把从UI 或request 对象里取到的用户凭据封装成Credentials 对象，然后交给认证管理器去认证。</li>
<li><strong>AuthenticationHandler**</strong> **认证Handler, 每种AuthenticationHandler 只能处理一种Credentials ，如AbstractUsernamePasswordAuthenticationHandler 只负责处理 U sernamePasswordCredentials 。</li>
<li><strong>Principal</strong> 封装用户标识，比如 SimplePrincipal, 只是封装了用户名。认证成功后， credentialsToPrincipalResolvers 负责由Credentials 生成 Principal 对象。</li>
<li><strong>CredentialsToPrincipalResolvers**</strong> **负责由 Credentials 生成 Principal 对象，每种 CredentialsToPrincipalResolvers 只处理 一种Credentials ，比如 UsernamePasswordCredentialsToPrincipalResolver 负责从 U sernamePasswordCredentials 中取出用户名，然后将其赋给生成的 SimplePrincipal 的 ID 属性。</li>
<li><strong>AuthenticationMetaDataPopulators</strong> 负责将 Credentials 的一些属性赋值给 Authentication 的 attributes 属性。</li>
<li><strong>Authentication</strong>   Authentication是认证管理器的最终处理结果， Authentication 封装了 Principal ，认证时间，及其他一些属性（可能来自 Credentials ）。</li>
<li><strong>AuthenticationManager</strong> 认证管理器得到 Credentials 对象后，负责调度AuthenticationHandler 去完成认证工作，最后返回的结果是 Authentication 对象。</li>
<li><strong>CentralAuthenticationService**</strong> <strong> CAS 的服务类，对 Web 层提供了一些方法。该类还负责调用 AuthenticationManager 完成认证逻辑</strong>。**</li>
</ul>
<p>序列图</p>
<p> <img src="" alt=""></p>
<p>类图</p>
<p> <img src="" alt=""></p>
<h2 id="-ticket-http-zhenkm0507-javaeye-com-blog-546805-">四、<a href="http://zhenkm0507.javaeye.com/blog/546805" target="_blank">Ticket介绍</a></h2>
<p>CAS的核心就是其Ticket，及其在Ticket之上的一系列处理操作。CAS的主要票据有TGT、ST、PGT、PGTIOU、PT，其中TGT、ST是CAS1.0协议中就有的票据，PGT、PGTIOU、PT是CAS2.0协议中有的票据。</p>
<h3 id="-">一 名词解释</h3>
<ul>
<li>TGT（Ticket Grangting Ticket）</li>
</ul>
<p>TGT是CAS为用户签发的登录票据，拥有了TGT，用户就可以证明自己在CAS成功登录过。TGT封装了Cookie值以及此Cookie值对应的用户信息。用户在CAS认证成功后，CAS生成cookie，写入浏览器，同时生成一个TGT对象，放入自己的缓存，TGT对象的ID就是cookie的值。当HTTP再次请求到来时，如果传过来的有CAS生成的cookie，则CAS以此cookie值为key查询缓存中有无TGT ，如果有的话，则说明用户之前登录过，如果没有，则用户需要重新登录。</p>
<ul>
<li>ST（Service Ticket）</li>
</ul>
<p>ST是CAS为用户签发的访问某一service的票据。用户访问service时，service发现用户没有ST，则要求用户去CAS获取ST。用户向CAS发出获取ST的请求，如果用户的请求中包含cookie，则CAS会以此cookie值为key查询缓存中有无TGT，如果存在TGT，则用此TGT签发一个ST，返回给用户。用户凭借ST去访问service，service拿ST去CAS验证，验证通过后，允许用户访问资源。</p>
<ul>
<li>PGT（Proxy Granting Ticket）</li>
</ul>
<p>Proxy Service的代理凭据。用户通过CAS成功登录某一Proxy Service后，CAS生成一个PGT对象，缓存在CAS本地，同时将PGT的值（一个UUID字符串）回传给Proxy Service，并保存在Proxy Service里。Proxy Service拿到PGT后，就可以为Target Service（back-end service）做代理，为其申请PT。</p>
<ul>
<li>PGTIOU（Proxy Granting Ticket IOU）</li>
</ul>
<p>PGTIOU是CAS协议中定义的一种附加票据，它增强了传输、获取PGT的安全性。
PGT的传输与获取的过程：Proxy Service调用CAS的serviceValidate接口验证ST成功后，CAS首先会访问pgtUrl指向的https url，将生成的 PGT及PGTIOU传输给proxy service，proxy service会以PGTIOU为key，PGT为value，将其存储在Map中；然后CAS会生成验证ST成功的xml消息，返回给Proxy Service，xml消息中含有PGTIOU，proxy service收到Xml消息后，会从中解析出PGTIOU的值，然后以其为key，在map中找出PGT的值，赋值给代表用户信息的Assertion对象的pgtId，同时在map中将其删除。</p>
<ul>
<li>PT（Proxy Ticket）</li>
</ul>
<p>PT是用户访问Target Service（back-end service）的票据。如果用户访问的是一个Web应用，则Web应用会要求浏览器提供ST，浏览器就会用cookie去CAS获取一个ST，然后就可以访问这个Web应用了。如果用户访问的不是一个Web应用，而是一个C/S结构的应用，因为C/S结构的应用得不到cookie，所以用户不能自己去CAS获取ST，而是通过访问proxy service的接口，凭借proxy service的PGT去获取一个PT，然后才能访问到此应用。</p>
<h3 id="-">二 代码解析</h3>
<p> <img src="" alt=""></p>
<p>CAS Ticket类图</p>
<ul>
<li>TicketGrantingTicket 的 grantServiceTicket方法</li>
</ul>
<p>方法声明：public synchronized ServiceTicket grantServiceTicket(final String id,final Service service, final ExpirationPolicy expirationPolicy, final boolean credentialsProvided)</p>
<p>方法描述:</p>
<p> 1：生成SerivceTicketImpl</p>
<p> 2：更新属性：</p>
<p>this.previousLastTimeUsed = this.lastTimeUsed;</p>
<p>   this.lastTimeUsed = System.currentTimeMillis();</p>
<p>   this.countOfUses++;</p>
<p> 3：给service对象的principal属性赋值</p>
<p> 4：将service对象放入map services</p>
<ul>
<li>ServiceTicket 的 grantTicketGrantingTicket方法</li>
</ul>
<p>方法声明：</p>
<p>public TicketGrantingTicket grantTicketGrantingTicket(final String id, final Authentication authentication,final ExpirationPolicy expirationPolicy)</p>
<p>方法描述：在CAS3.3对CAS2.0协议的实现中，PGT是由ST签发的，调用的就是ServiceTicket的grantTicketGrantingTicket方法。方法返回的TicketGrantingTicket对象，表征的是一个PGT对象，其中的ticketGrantingTicket属性的值是签发ST的TGT对象。</p>
<ul>
<li>TicketGrantingTicket 的 expire方法</li>
</ul>
<p>方法声明：void expire()</p>
<p>方法描述：</p>
<p>在CAS的logout接口实现中，要调用TGT对象的expire方法，然后会在缓存中清除此TGT对象。</p>
<p>expire方法的内容：循环遍历 services 中的Service对象，调用其logoutOfService方法。具体Service实现类中的logoutOfService方法的实现，要通知具体的应用，客户要退出。</p>
<h3 id="-tgt-st-pgt-pt-">三、TGT、ST、PGT、PT关系</h3>
<p>1：ST是TGT签发的。用户在CAS上认证成功后，CAS生成TGT，用TGT签发一个ST，ST的ticketGrantingTicket属性值是TGT对象，然后把ST的值redirect到客户应用。</p>
<p>2：PGT是ST签发的。用户凭借ST去访问Proxy service，Proxy service去CAS验证ST（同时传递PgtUrl参数给CAS），如果ST验证成功，则CAS用ST签发一个PGT，PGT对象里的ticketGrantingTicket是签发ST的TGT对象。</p>
<p>3：PT是PGT签发的。Proxy service代理back-end service去CAS获取PT的时候，CAS根据传来的pgt参数，获取到PGT对象，然后调用其grantServiceTicket方法，生成一个PT对象。</p>
<p> <img src="" alt=""></p>
<p>TGT、ST、PGT、PT之间的关联关系</p>
<h1 id="cas-client-">CAS CLIENT篇</h1>
<h2 id="casfilter-">CASFilter 参数说明：</h2>
<p>参数</p>
<p>是否必须</p>
<p>说明 com.olymtech.cas.client.filter.loginUrl</p>
<p>是</p>
<p>指定 CAS 提供登录页面的 URL com.olymtech.cas.client.filter.validateUrl</p>
<p>是</p>
<p>指定 CAS 提供 service ticket 或 proxy ticket 验证服务的 URL com.olymtech.cas.client.filter.serverName</p>
<p>是</p>
<p>指定客户端的域名和端口，是指客户端应用所在机器而不是 CAS Server 所在机器，该参数或 serviceUrl 至少有一个必须指定 com.olymtech.cas.client.filter.serviceUrl</p>
<p>否</p>
<p>该参数指定过后将覆盖 serverName 参数，成为登录成功过后重定向的目的地址 com.olymtech.cas.client.filter.wrapRequest</p>
<p>否</p>
<p>如果指定为 true，那么 CASFilter 将重新包装 HttpRequest,并且使 getRemoteUser() 方法返回当前登录用户的用户名 com.olymtech.cas.client.filter.noFilter</p>
<p>否</p>
<p>设置不过滤的路径，语法如下：/name1/,/name2, com.olymtech.cas.client.filter.proxyCallbackUrl</p>
<p>否</p>
<p>用于当前应用需要作为其他服务的代理(proxy)时获取 Proxy Granting Ticket 的地址 com.olymtech.cas.client.filter.authorizedProxy</p>
<p>否</p>
<p>用于允许当前应用从代理处获取 proxy tickets，该参数接受以空格分隔开的多个 proxy URLs，但实际使用只需要一个成功即可。当指定该参数过后，需要修改 validateUrl 到 proxyValidate，而不再是 serviceValidate com.olymtech.cas.client.filter.renew</p>
<p>否</p>
<p>如果指定为 true，那么受保护的资源每次被访问时均要求用户重新进行验证，而不管之前是否已经通过 com.olymtech.cas.client.filter.gateway</p>
<p>否</p>
<p>指定 gateway 属性</p>
<h1 id="-">应用整合篇</h1>
<h2 id="-java-">一、JAVA程序整合</h2>
<p><strong>1、**</strong>应用配置说明（结合cas client<strong>**）</strong></p>
<p>导入key到本地jdk（tomcat使用的jdk必须）</p>
<p>keytool -import -keystore d:/work/jdk1.6.0_13/jre/lib/security/cacerts -file d:/casex/800jit.crt -alias 800jit</p>
<p>在ie中导入证书800jit.crt</p>
<p>修改web程序的web.xml添加</p>
<pre><code>&lt;!-- 用于单点退出 --&gt;

&lt;listener&gt;

    &lt;listener-class&gt;org.jasig.cas.client.session.SingleSignOutHttpSessionListener&lt;/listener-class&gt;

&lt;/listener&gt;



&lt;filter&gt;

&lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;

&lt;filter-class&gt;org.jasig.cas.client.session.SingleSignOutFilter&lt;/filter-class&gt;

&lt;/filter&gt;



&lt;!-- 用于单点登录 --&gt;



&lt;filter&gt;

   &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;

   &lt;filter-class&gt;com.olymtech.cas.client.filter.CASFilter&lt;/filter-class&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.loginUrl&lt;/param-name&gt;

       &lt;param-value&gt;https://cas.server.com/cas/login&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.validateUrl&lt;/param-name&gt;

       &lt;param-value&gt;https://cas.server.com/cas/serviceValidate&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.serverName&lt;/param-name&gt;

       &lt;param-value&gt;saas.server.com&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.wrapRequest&lt;/param-name&gt;

       &lt;param-value&gt;true&lt;/param-value&gt;

   &lt;/init-param&gt;

&lt;/filter&gt;



&lt;filter-mapping&gt;

   &lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;

   &lt;url-pattern&gt;//*&lt;/url-pattern&gt;

&lt;/filter-mapping&gt;



&lt;filter-mapping&gt;

   &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;

   &lt;url-pattern&gt;//*&lt;/url-pattern&gt;

&lt;/filter-mapping&gt;
</code></pre><p>在jsp/servlet中得到登陆数据：</p>
<p>&lt;%@ page language=&quot;java&quot; import=&quot;com.olymtech.cas.client.filter.CASFilterRequestWrapper&quot;%&gt;</p>
<p>&lt;%</p>
<p>CASFilterRequestWrapper  reqWrapper=<strong>new</strong> CASFilterRequestWrapper(request);</p>
<p>String username = reqWrapper.getRemoteUser();</p>
<p>%&gt;</p>
<h2 id="-net-">二、.NET程序整合</h2>
<h1 id="-">附件</h1>
<p>ssl.rar（证书）</p>
<p>http.conf（apache配置文件）</p>
<p>httpd-ssl.conf（apache配置文件）</p>
<p>httpd-vhosts.conf（apache配置文件）</p>
<p>server.xml（tomcat配置文件）</p>
<p>AppSsoDemo-java.rar（java整合例子，包含所需jar包）</p>
<p>posted on 2010-08-05 17:23 <a href="http://www.cnblogs.com/hellowood/" target="_blank">horus</a> 阅读(2394) 评论(2) <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx?postid=1793364" target="_blank">编辑</a> <a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#" target="_blank">收藏</a>
<img src="" alt=""></p>
<p><a href="">刷新评论</a><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#" target="_blank">刷新页面</a><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#top" target="_blank">返回顶部</a></p>
<p><a href="http://q.cnblogs.com/" target="_blank">程序员问答社区，解决您的技术难题</a>
<a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园首页</a><a href="http://q.cnblogs.com/" title="程序员问答社区" target="_blank">博问</a><a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a>
Powered by: <a href="http://www.cnblogs.com/" target="_blank">博客园</a> 模板提供：<a href="http://blog.hjenglish.com/" target="_blank">沪江博客</a> Copyright ©2012 horus</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--cas改造随笔-horus-博客园" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--cas_presentation/">cas_presentation</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--cas_presentation/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas_presentation">cas_presentation</h1>
<p><img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Welcome! First of all, what is CAS?
●
●
Web single sign on Uses “federated” authentication, where all authentication is done by the CAS server, instead of individual application servers The implementation is an open source protocol, open source Java server, and several open source clients Purdue runs a CAS server, configured to authenticate with Purdue Career Account (<a href="https://www.purdue.edu/apps/account/cas" target="_blank">https://www.purdue.edu/apps/account/cas</a>) As of 4/5/2011, 349 application servers are authorized to check CAS tickets More can be found at:
– –
●
●
●
●
●
<a href="http://www.jasig.org/cas" target="_blank">http://www.jasig.org/cas</a> <a href="https://www.purdue.edu/apps/account/docs/CAS/CAS_information.jsp" target="_blank">https://www.purdue.edu/apps/account/docs/CAS/CAS_information.jsp</a>
Purdue University Identity and Access Management 1
4/7/2011
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
There are three machines in this game
●
a) Browser b) Application server
–
●
Configured with a CAS client to require authentication for certain urls Serves CAS login web page and authenticates users Issues TGT cookie (ticket granting ticket) so user does not have to login every redirect to CAS server Redirects back to application server with ticket=ST-xxx service ticket in url for CAS client to check Validates CAS service tickets for application servers
●
c) CAS server (<a href="http://www.jasig.org/cas" target="_blank">http://www.jasig.org/cas</a>)
– –
–
–
4/7/2011
Purdue University Identity and Access Management
2
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
Browser
1) initial request 2) redirect to CAS login page with service=url_back_to_sampleapp_page
sampleapp
CAS server
3) request CAS login page 4) html for CAS login page 5) POST login and password 6) set CASTGC cookie and redirect to sampleapp with ticket=ST-xxx 7) back to initial request, with ticket=ST-xxx (the service ticket) 10) sampleapp responds with application page 9)ticket validation response 8) validate ST-xxx service ticket
4/7/2011
Purdue University Identity and Access Management
3
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 1 – initial request
●
“sampleapp” application server is configured with a CAS client to require authentication for certain urls (in this example /test) User with browser accesses /test on sampleapp If browser does not already have session on sampleapp, sampleapp transfers control to the CAS client If the CAS client does not see a ticket parameter in the request, user is redirected back to the CAS login page with service=url_to_return_to, in this example <a href="http://localhost:8080/sampleapp/test" target="_blank">http://localhost:8080/sampleapp/test</a>
●
●
●
4/7/2011
Purdue University Identity and Access Management
4
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 2 – redirect to CAS login page
●
User is redirected back to CAS server for authentication Application server (sampleapp) logs
●
2011­03­29 09:16:46,843 DEBUG  [org.jasig.cas.client.authentication.AuthenticationFilter] ­ <no ticket and no  assertion found> 2011­03­29 09:16:46,843 DEBUG  [org.jasig.cas.client.authentication.AuthenticationFilter] ­ <Constructed service  url: http://localhost:8080/sampleapp/test/> 2011­03­29 09:16:46,844 DEBUG  [org.jasig.cas.client.authentication.AuthenticationFilter] ­ <redirecting to  "https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/login?service= 2F%2Flocalhost%3A8080%2Fsampleapp%2Ftest%2F"> application server access log: 0:0:0:0:0:0:0:1 ­ ­ [29/Mar/2011:09:16:46 ­0400] &quot;GET /sampleapp/test/ HTTP/1.1&quot;  302 ­
4/7/2011
Purdue University Identity and Access Management
5
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 3 – browser requests CAS login page
●
CAS server checks for its CASTGC cookie (ticket granting ticket), if it&#39;s there, user is already authenticated via CAS, skip to step 6 and redirect back to sampleapp with a service ticket If no CASTGC is present, serve browser the CAS login page CAS server access log:
●
●
0:0:0:0:0:0:0:1 ­ ­ [29/Mar/2011:09:16:47 ­0400] &quot;GET /cas­server­uber­webapp­ 3.4.6/login?service=http%3A%2F%2Flocalhost%3A8080%2Fsampleapp%2Ftest%2F HTTP/1.1&quot;  200 6935
4/7/2011
Purdue University Identity and Access Management
6
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 4 – CAS server sends login page to browser
●
This is nice because application servers do not need to
– – –
maintain their own login page maintain login/password credentials to do the actual authentication even see the password, it&#39;s between the browser and CAS server
4/7/2011
Purdue University Identity and Access Management
7
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 5 – browser POSTs login/password to CAS server
●
CAS server checks login and password, if authentication fails serve another login page to browser Too many unsuccessful authentication attempts in a short period of time will result in a “lockout”, where authentication will always fail for a 15 minute lockout period CAS server access log:
●
●
0:0:0:0:0:0:0:1 ­ ­ [29/Mar/2011:09:16:52 ­0400] &quot;POST /cas­server­uber­webapp­ 3.4.6/login?service=http%3A%2F%2Flocalhost%3A8080%2Fsampleapp%2Ftest%2F HTTP/1.1&quot;  302 ­
4/7/2011
Purdue University Identity and Access Management
8
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 6 – CAS server redirects back to application server
●
A ticket granting ticket TGT-xxx is stored on the CAS server, and set as a CASTGC cookie A service ticket is issued for the application (<a href="http://localhost:8080/sampleapp/test/" target="_blank">http://localhost:8080/sampleapp/test/</a>) and sent as a parameter back to the application server
●
2011­03­29 09:16:52,208 DEBUG  [org.jasig.cas.web.support.CookieRetrievingCookieGenerator] ­ <Added cookie with  name [CASTGC] and value [TGT­1­wKQjkOhweJE6MMTNCqTwv6WojMDBL61GISejnyCfigrMFCumYu­ cas]> 2011­03­29 09:16:52,214 DEBUG [org.jasig.cas.ticket.registry.DefaultTicketRegistry]  ­ <Added ticket [ST­1­bdgbwHIReBonmaudvxJl­cas] to registry.> 2011­03­29 09:16:52,214 INFO [org.jasig.cas.CentralAuthenticationServiceImpl] ­  <Granted service ticket [ST­1­bdgbwHIReBonmaudvxJl­cas] for service  [http://localhost:8080/sampleapp/test/] for user [jott]>
4/7/2011
Purdue University Identity and Access Management
9
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 7 – browser re-requests url from application server, with a CAS service ticket
●
Application server still has not yet established a session, so CAS client takes control CAS client sees a ticket parameter in the url, that can be checked with the CAS server CAS service ticket is only valid one time, and the CAS client needs to use it within 90 seconds or it will expire
●
●
4/7/2011
Purdue University Identity and Access Management
10
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 8 – application server checks CAS service ticket sent by browser in url
●
CAS client preparing to check service ticket:
2011­03­29 09:16:52,231 DEBUG  [org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter] ­  <Attempting to validate ticket: ST­1­bdgbwHIReBonmaudvxJl­cas> 2011­03­29 09:16:52,232 DEBUG  [org.jasig.cas.client.validation.Cas20ServiceTicketValidator] ­ <Constructing  validation url: https://www.purdue.edu/apps/account/cas­server­uber­webapp­ 3.4.6/serviceValidate?ticket=ST­1­bdgbwHIReBonmaudvxJl­cas&service=http%3A%2F %2Flocalhost%3A8080%2Fsampleapp%2Ftest%2F>
●
CAS server access log:
127.0.0.1 ­ ­ [29/Mar/2011:09:16:52 ­0400] &quot;GET /cas­server­uber­webapp­ 3.4.6/serviceValidate?ticket=ST­1­bdgbwHIReBonmaudvxJl­cas&amp;service=http%3A%2F %2Flocalhost%3A8080%2Fsampleapp%2Ftest%2F HTTP/1.1&quot; 200 281
4/7/2011
Purdue University Identity and Access Management
11
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 9 – CAS server responds to ticket check
●
CAS server response (notice the NEW attributes!):
2011­03­29 09:16:52,327 DEBUG  [org.jasig.cas.client.validation.Cas20ServiceTicketValidator] ­ <Server response:  <cas:serviceResponse xmlns:cas='http://www.yale.edu/tp/cas'> <cas:authenticationSuccess> <cas:user>jott</cas:user> <cas:attributes> <cas:email>jott@purdue.edu</cas:email> <cas:i2a2characteristics>0,3592,2000</cas:i2a2characteristics> <cas:lastname>Ott</cas:lastname> <cas:firstname>Jeffrey A</cas:firstname> <cas:fullname>Jeffrey A Ott</cas:fullname> <cas:puid>0012345678</cas:puid> </cas:attributes> </cas:authenticationSuccess> </cas:serviceResponse> &gt;
●
You can test this now yourself against the new CAS server version 3.4.6 (which will become production in May 2011):
<a href="https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/login" target="_blank">https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/login</a> <a href="https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/serviceValidate" target="_blank">https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/serviceValidate</a>
4/7/2011
Purdue University Identity and Access Management
12
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 10 – application server sends requested page
●
Some CAS clients (including the Java CAS client) can be configured to redirect the browser to the same url, but without the ticket parameter Application server access log:
●
0:0:0:0:0:0:0:1 ­ ­ [29/Mar/2011:09:16:52 ­0400] &quot;GET /sampleapp/test/?ticket=ST­1­ bdgbwHIReBonmaudvxJl­cas HTTP/1.1&quot; 302 ­ 0:0:0:0:0:0:0:1 ­ ­ [29/Mar/2011:09:16:52 ­0400] &quot;GET /sampleapp/test/ HTTP/1.1&quot;  200 202
4/7/2011
Purdue University Identity and Access Management
13
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Java CAS client
●
<a href="https://wiki.jasig.org/display/CASC/CAS+Client+for+Java+3.1" target="_blank">https://wiki.jasig.org/display/CASC/CAS+Client+for+Java+3.1</a> Previous example used version 3.1.10 Looking at one CAS client will help understand how any of them will need configured Next two slides show the web.xml to configure the Java CAS client for the previous example:
●
●
●
4/7/2011
Purdue University Identity and Access Management
14
<img src="" alt=""> A detailed walk through a CAS authentication</p>
<p><filter> <filter­name>CAS Authentication Filter</filter­name> <filter­class>org.jasig.cas.client.authentication.AuthenticationFilter</filter­class> <init­param> <param­name>casServerLoginUrl</param­name> <param­value><a href="https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/login" target="_blank">https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/login</a></param­value> </init­param> <init­param> <param­name>serverName</param­name> <param­value><a href="http://localhost:8080" target="_blank">http://localhost:8080</a></param­value> </init­param> </filter> <filter> <filter­name>CAS Validation Filter</filter­name> <filter­class>org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter</filter­class> <init­param> <param­name>casServerUrlPrefix</param­name> <param­value><a href="https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6" target="_blank">https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6</a></param­value> </init­param> <init­param> <param­name>serverName</param­name> <param­value><a href="http://localhost:8080" target="_blank">http://localhost:8080</a></param­value> </init­param> <init­param> <param­name>redirectAfterValidation</param­name> <param­value>true</param­value> </init­param> <init­param> <param­name>exceptionOnValidationFailure</param­name> <param­value>false</param­value> </init­param> </filter> 4/7/2011 Purdue University Identity and Access Management 15
(and how to get your mits on the authenticated user)
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Continued web.xml for Java CAS client configuration:</p>
<p><filter> <filter­name>CAS HttpServletRequest Wrapper Filter</filter­name> <filter­class>org.jasig.cas.client.util.HttpServletRequestWrapperFilter</filter­class> </filter> <filter­mapping> <filter­name>CAS Authentication Filter</filter­name> <url­pattern>/test//<em></url­pattern> </filter­mapping> <filter­mapping> <filter­name>CAS Validation Filter</filter­name> <url­pattern>/test//</em></url­pattern> </filter­mapping> <filter­mapping> <filter­name>CAS HttpServletRequest Wrapper Filter</filter­name> <url­pattern>/test//*</url­pattern> </filter­mapping>
4/7/2011
Purdue University Identity and Access Management
16
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
CAS is not just for web applications
●
Browsers hold CAS state with a cookie (called CASTGC that holds a CAS ticket granting ticket – TGT), but any client, such as a mobile app, can obtain and store a TGT See <a href="https://wiki.jasig.org/display/CASUM/RESTful+API" target="_blank">https://wiki.jasig.org/display/CASUM/RESTful+API</a> Example:
●
●
POST a username and password to <a href="https://CAS_SERVER_URL/v1/tickets" target="_blank">https://CAS_SERVER_URL/v1/tickets</a> (with “Accept: text/plain” as a header) And if the login/password check out, the server sends back 201 Created Location: <a href="https://CAS_SERVER_URL/v1/tickets/{TGT" target="_blank">https://CAS_SERVER_URL/v1/tickets/{TGT</a> id} If authentication fails, the server returns back a 400 code
4/7/2011
Purdue University Identity and Access Management
17
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Initiatives for later this year:
●
Ability to use Boilerkey for CAS authentication:
–
If Boilerkey is used, CAS server will expose an extra attribute returned by the ticket check that indicates that the authentication was a Boilerkey authentication
<a href="https://www.purdue.edu/apps/account/IAMO/Purdue_CareerAccount_BoilerKey.jsp" target="_blank">https://www.purdue.edu/apps/account/IAMO/Purdue_CareerAccount_BoilerKey.jsp</a>
●
Separate mobile app CAS login page Application server administrators will be able to manage CAS ticket check server lists via web page Check for more at:
–
●
●
<a href="https://www.purdue.edu/apps/account/docs/CAS/CAS_information.jsp" target="_blank">https://www.purdue.edu/apps/account/docs/CAS/CAS_information.jsp</a>
4/7/2011
Purdue University Identity and Access Management
18
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Thanks for your attention! Questions? Purdue Identity and Access Management can be reached at accounts@purdue.edu Please fill out an evaluation at <a href="http://www.itap.purdue.edu/boilerweb/survey" target="_blank">http://www.itap.purdue.edu/boilerweb/survey</a>
●
●
●
4/7/2011
Purdue University Identity and Access Management
19</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--cas_presentation/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--cas_presentation" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/84/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/82/">82</a></li><li><a class="page-number" href="/page/83/">83</a></li><li><a class="page-number" href="/page/84/">84</a></li><li class="active"><li><span class="page-number current">85</span></li><li><a class="page-number" href="/page/86/">86</a></li><li><a class="page-number" href="/page/87/">87</a></li><li><a class="page-number" href="/page/88/">88</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/86/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 15:12:18</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
