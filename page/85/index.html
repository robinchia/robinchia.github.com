
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 85 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--单点登录CASServer介绍-Java综合-Java-ITeye论坛/">单点登录CAS Server 介绍 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--单点登录CASServer介绍-Java综合-Java-ITeye论坛/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-cas-server-java-java-iteye-">单点登录CAS Server 介绍 - Java综合 - Java - ITeye论坛</h1>
<p><a href="http://www.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/login" target="_blank">登录</a> <a href="http://www.iteye.com/signup" target="_blank">注册</a></p>
<p><a href="http://www.iteye.com/" target="_blank"><img src="&quot;ITeye-最棒的软件开发交流社区&quot;" alt="ITeye-最棒的软件开发交流社区"></a></p>
<p><a href="http://www.iteye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.iteye.com/forums/board/Java" target="_blank">Java企业应用论坛</a> →</p>
<h1 id="-cas-server-">单点登录CAS Server 介绍</h1>
<p><a href="http://www.iteye.com/forums/board/Java" target="_blank">全部</a> <a href="http://www.iteye.com/forums/tag/Hibernate" target="_blank">Hibernate</a> <a href="http://www.iteye.com/forums/tag/Spring" target="_blank">Spring</a> <a href="http://www.iteye.com/forums/tag/Struts" target="_blank">Struts</a> <a href="http://www.iteye.com/forums/tag/iBATIS" target="_blank">iBATIS</a> <a href="http://www.iteye.com/forums/tag/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8" target="_blank">企业应用</a> <a href="http://www.iteye.com/forums/tag/Lucene" target="_blank">Lucene</a> <a href="http://www.iteye.com/forums/tag/SOA" target="_blank">SOA</a> <a href="http://www.iteye.com/forums/tag/Java%E7%BB%BC%E5%90%88" target="_blank">Java综合</a> <a href="http://www.iteye.com/forums/tag/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" target="_blank">设计模式</a> <a href="http://www.iteye.com/forums/tag/Tomcat" target="_blank">Tomcat</a> <a href="http://www.iteye.com/forums/tag/OO" target="_blank">OO</a> <a href="http://www.iteye.com/forums/tag/JBoss" target="_blank">JBoss</a>
浏览 3057 次 锁定老帖子 <a href="">主题：单点登录CAS Server 介绍</a></p>
<p>精华帖 (0) :: 良好帖 (0) :: 新手帖 (2) :: 隐藏帖 (0) 作者 正文 * boli.jiang</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://bolijiang.iteye.com/" target="_blank"><img src="&quot;boli.jiang的博客: 天天向上&quot;" alt="boli.jiang的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 3</li>
<li>积分: 40</li>
<li>来自: 成都</li>
<li><img src="" alt="">
  发表时间：2010-04-22   最后修改：2010-04-23</li>
</ul>
<p><a href="http://www.iteye.com/topic/650595#" target="_blank">&lt;</a> <a href="http://www.iteye.com/topic/650595#" target="_blank">&gt;</a>  猎头职位: <a href="http://www.iteye.com/jobs/2245" target="_blank">上海:  【上海】外资企业高新诚聘web开发工程师</a></p>
<p>相关文章: <a href="http://www.iteye.com/topic/650595#" title="关闭" target="_blank"> </a></p>
<ul>
<li><a href="http://www.iteye.com/topic/257036" title="CAS与LDAP整合的实现" target="_blank">CAS与LDAP整合的实现</a></li>
<li><a href="http://www.iteye.com/topic/87654" title="扩展cas验证系统自己又一些小小的疑问请教大家!" target="_blank">扩展cas验证系统自己又一些小小的疑问请教大家!</a></li>
<li><a href="http://www.iteye.com/topic/544899" title="【原创】CAS调研总结" target="_blank">【原创】CAS调研总结</a>
推荐群组: <a href="http://liferay.group.iteye.com/" target="_blank">liferay</a>
<a href="http://www.iteye.com/wiki/topic/650595" target="_blank">更多相关推荐</a>
<a href="http://www.iteye.com/forums/tag/Java%E7%BB%BC%E5%90%88" target="_blank">Java综合</a></li>
</ul>
<p>下面的讲解基于CAS Server 3.3.5版本。</p>
<p>CAS Server 配置文件</p>
<p>login-webflow.xml：其中内容指定了当访问cas/login时的程序流程，初始“initialFlowSetup”</p>
<p>cas-servlet.xml：servlet与class对应关系</p>
<p>deployerConfigContext.xml：认证管理器相关</p>
<p>cas.properties：系统属性设置</p>
<p>applicationContext.xml：系统属性相关</p>
<p>argumentExtractorsConfiguration.xml：不是很了解它的用途</p>
<p>ticketExpirationPolicies.xml：ticket过期时间设置</p>
<p>ticketGrantingTicketCookieGenerator.xml：TGT cookie属性相关，是否支持http也在这儿修改</p>
<p>ticketRegistry.xml：保存ticket的类相关设置</p>
<p>uniqueIdGenerators.xml：ticket自动生成类设置</p>
<p>warnCookieGenerator.xml：同ticketGrantingTicketCookieGenerator.xml，生成的 cookie名为CASPRIVACY</p>
<p><strong>/login</strong> ：</p>
<p>当访问/login时，会调用login-webflow.xml中的流程图：</p>
<p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt="">
 </a></p>
<p><strong>/serviceValidate:</strong></p>
<p>对应的处理类是org.jasig.cas.web.ServiceValidateController，主要负责对service ticket的验证，失败返回casServiceValidationFailure.jsp，成功返回casServiceValidationSuccess.jsp</p>
<p>对service ticket的验证是通过client端向server端发送http（或https）实现的</p>
<p>逻辑：</p>
<p>1.通过由client端传来的ticket到DefaultTicketRegistry中获取缓存的ServiceTicketImpl对象，并判断其是否已经过期（ST过期时间默认是5分钟，TGT默认是2个小时，可以在ticketExpirationPolicies.xml中进行修改）以及与当前service的id是否相一，以上都满足则表示验证通过。</p>
<p>2.通过ServiceTicketImpl对象获取到登录之后的Authentication对象，借助于它生成ImmutableAssertionImpl对象并返回</p>
<p>3.成功返回</p>
<p><strong>CAS数据流程</strong></p>
<p>Credentials--&gt;Principal--&gt;Authentication</p>
<p><strong>定义自己的AuthenticationHandler</strong></p>
<p>在中心认证进行认证的过程中会调用deployerConfigContext.xml中设置的AuthenticationHandler来进行认证工作。
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><property name="authenticationHandlers">  </li>
<li><list>  </li>
<li>&lt;!--  </li>
<li></li>
<li>This is the authentication handler that authenticates services by means of callback via SSL, thereby validating  </li>
<li></li>
<li>a server side SSL certificate.  </li>
<li>--&gt;  </li>
<li>&lt;bean class=&quot;org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler&quot;  </li>
<li>p:httpClient-ref=&quot;httpClient&quot; /&gt;  </li>
<li>&lt;!--  </li>
<li>This is the authentication handler declaration that every CAS deployer will need to change before deploying CAS   </li>
<li>into production.  The default SimpleTestUsernamePasswordAuthenticationHandler authenticates UsernamePasswordCredentials  </li>
<li>where the username equals the password.  You will need to replace this with an AuthenticationHandler that implements your  </li>
<li>local authentication strategy.  You might accomplish this by coding a new such handler and declaring  </li>
<li>edu.someschool.its.cas.MySpecialHandler here, or you might use one of the handlers provided in the adaptors modules.  </li>
<li>--&gt;  </li>
<li>&lt;bean  </li>
<li>class=&quot;org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler&quot; /&gt;  </li>
<li><bean class="com.goldarmor.live800.cas.Live800CasAuthenticationHandler">  </li>
<li><property name="dataSource" ref="casDataSource" />  </li>
<li></bean>  </li>
<li>&lt;/list  </li>
<li><p></property>  </p>
<property name="authenticationHandlers"> <list>  <!-- This is the authentication handler that authenticates services by means of callback via SSL, thereby validating a server side SSL certificate. --> <bean class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler" p:httpClient-ref="httpClient" /> <!-- This is the authentication handler declaration that every CAS deployer will need to change before deploying CAS into production. The default SimpleTestUsernamePasswordAuthenticationHandler authenticates UsernamePasswordCredentials where the username equals the password. You will need to replace this with an AuthenticationHandler that implements your local authentication strategy. You might accomplish this by coding a new such handler and declaring edu.someschool.its.cas.MySpecialHandler here, or you might use one of the handlers provided in the adaptors modules. --> <bean class="org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler" /> <bean class="com.goldarmor.live800.cas.Live800CasAuthenticationHandler"> <property name="dataSource" ref="casDataSource" /> </bean> </list </property>

<p>如上，我们定义了3个AuthenticationHandler，这正是CAS的一个<img src="" alt=""> ，通过配置，我们可以实现针对不同的应用提供不同的认证方式，这样可以实现任意的中心认证。再来看看AuthenticationHandler的代码</p>
</li>
</ol>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>//<em>/</em> </li>
<li>/* Method to determine if the credentials supplied are valid. </li>
<li>/*  </li>
<li>/* @param credentials The credentials to validate. </li>
<li>/* @return true if valid, return false otherwise. </li>
<li>/* @throws AuthenticationException An AuthenticationException can contain </li>
<li>/* details about why a particular authentication request failed. </li>
<li>/*/  </li>
<li></li>
<li>boolean authenticate(Credentials credentials)  </li>
<li>throws AuthenticationException;  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* Method to check if the handler knows how to handle the credentials </li>
<li>/* provided. It may be a simple check of the Credentials class or something </li>
<li>/* more complicated such as scanning the information contained in the </li>
<li>/* Credentials object. </li>
<li>/*  </li>
<li>/* @param credentials The credentials to check. </li>
<li>/* @return true if the handler supports the Credentials, false othewrise. </li>
<li>/*/  </li>
<li><p>boolean supports(Credentials credentials);<br>//<em>/</em> /<em> Method to determine if the credentials supplied are valid. /</em> /<em> @param credentials The credentials to validate. /</em> @return true if valid, return false otherwise. /<em> @throws AuthenticationException An AuthenticationException can contain /</em> details about why a particular authentication request failed. /<em>/ boolean authenticate(Credentials credentials) throws AuthenticationException; //</em>/<em> /</em> Method to check if the handler knows how to handle the credentials /<em> provided. It may be a simple check of the Credentials class or something /</em> more complicated such as scanning the information contained in the /<em> Credentials object. /</em> /<em> @param credentials The credentials to check. /</em> @return true if the handler supports the Credentials, false othewrise. /*/ boolean supports(Credentials credentials);</p>
<p>我们要做的就是实现这俩个方法而已，特别提醒：可以在cas-servlet.xml中设置你所使用的Credentials，如下：（其中的p:formObjectClass值，如果不指定默认使用UsernamePasswordCredentials）</p>
</li>
</ol>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>&lt;bean id=&quot;authenticationViaFormAction&quot; class=&quot;org.jasig.cas.web.flow.AuthenticationViaFormAction&quot;  </li>
<li>p:formObjectClass=&quot;com.goldarmor.live800.cas.Live800CasCredentials&quot;  </li>
<li>p:centralAuthenticationService-ref=&quot;centralAuthenticationService&quot;  </li>
<li>p:warnCookieGenerator-ref=&quot;warnCookieGenerator&quot; /&gt;  <bean id="authenticationViaFormAction" class="org.jasig.cas.web.flow.AuthenticationViaFormAction" p:formObjectClass="com.goldarmor.live800.cas.Live800CasCredentials" p:centralAuthenticationService-ref="centralAuthenticationService" p:warnCookieGenerator-ref="warnCookieGenerator" />



</li>
</ol>
<p><strong>定义自己的credentialsToPrincipalResolvers</strong></p>
<p>通过AuthenticationHandler的认证后，会调用在deployerConfigContext.xml中配置的credentialsToPrincipalResolvers来处理Credentials，生成Principal对象：
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><property name="credentialsToPrincipalResolvers">  </li>
<li><list>  </li>
<li>&lt;!--  </li>
<li>UsernamePasswordCredentialsToPrincipalResolver supports the UsernamePasswordCredentials that we use for /login   </li>
<li>by default and produces SimplePrincipal instances conveying the username from the credentials.  </li>
<li>If you&#39;ve changed your LoginFormAction to use credentials other than UsernamePasswordCredentials then you will also  </li>
<li>need to change this bean declaration (or add additional declarations) to declare a CredentialsToPrincipalResolver that supports the  </li>
<li>Credentials you are using.  </li>
<li>--&gt;              &lt;bean  </li>
<li>class=&quot;org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver&quot; /&gt;  </li>
<li>&lt;!--  </li>
<li>HttpBasedServiceCredentialsToPrincipalResolver supports HttpBasedCredentials.  It supports the CAS 2.0 approach of  </li>
<li>authenticating services by SSL callback, extracting the callback URL from the Credentials and representing it as a  </li>
<li>SimpleService identified by that callback URL.  </li>
<li>If you are representing services by something more or other than an HTTPS URL whereat they are able to  </li>
<li>receive a proxy callback, you will need to change this bean declaration (or add additional declarations).  </li>
<li>--&gt;  </li>
<li>&lt;bean  </li>
<li>class=&quot;org.jasig.cas.authentication.principal.HttpBasedServiceCredentialsToPrincipalResolver&quot; /&gt;  </li>
<li><bean class="com.goldarmor.live800.cas.Live800CasCredentialsToPrincipalResolver"/>  </li>
<li></list>  </li>
<li><p></property>  </p>
<property name="credentialsToPrincipalResolvers"> <list> <!-- UsernamePasswordCredentialsToPrincipalResolver supports the UsernamePasswordCredentials that we use for /login by default and produces SimplePrincipal instances conveying the username from the credentials. If you've changed your LoginFormAction to use credentials other than UsernamePasswordCredentials then you will also need to change this bean declaration (or add additional declarations) to declare a CredentialsToPrincipalResolver that supports the Credentials you are using. --> <bean class="org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver" /> <!-- HttpBasedServiceCredentialsToPrincipalResolver supports HttpBasedCredentials. It supports the CAS 2.0 approach of authenticating services by SSL callback, extracting the callback URL from the Credentials and representing it as a SimpleService identified by that callback URL. If you are representing services by something more or other than an HTTPS URL whereat they are able to receive a proxy callback, you will need to change this bean declaration (or add additional declarations). --> <bean class="org.jasig.cas.authentication.principal.HttpBasedServiceCredentialsToPrincipalResolver" /> <bean class="com.goldarmor.live800.cas.Live800CasCredentialsToPrincipalResolver"/> </list> </property>

<p>如上：我们也可以像定义AuthenticationHandler一样，可以定义多个credentialsToPrincipalResolvers来处理Credentials，返回你所需要的Principal对象，下面来看看credentialsToPrincipalResolvers的方法：</p>
</li>
</ol>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>//<em>/</em> </li>
<li>/* Turn Credentials into a Principal object by analyzing the information </li>
<li>/* provided in the Credentials and constructing a Principal object based on </li>
<li>/* that information or information derived from the Credentials object. </li>
<li>/*  </li>
<li>/* @param credentials from which to resolve Principal </li>
<li>/* @return resolved Principal, or null if the principal could not be resolved. </li>
<li>/*/  </li>
<li>Principal resolvePrincipal(Credentials credentials);  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* Determine if a credentials type is supported by this resolver. This is </li>
<li>/* checked before calling resolve principal. </li>
<li>/*  </li>
<li>/* @param credentials The credentials to check if we support. </li>
<li>/* @return true if we support these credentials, false otherwise. </li>
<li>/*/  </li>
<li></li>
<li></li>
<li>boolean supports(Credentials credentials);<br>//<em>/</em> /<em> Turn Credentials into a Principal object by analyzing the information /</em> provided in the Credentials and constructing a Principal object based on /<em> that information or information derived from the Credentials object. /</em> /<em> @param credentials from which to resolve Principal /</em> @return resolved Principal, or null if the principal could not be resolved. /<em>/ Principal resolvePrincipal(Credentials credentials); //</em>/<em> /</em> Determine if a credentials type is supported by this resolver. This is /<em> checked before calling resolve principal. /</em> /<em> @param credentials The credentials to check if we support. /</em> @return true if we support these credentials, false otherwise. /*/ boolean supports(Credentials credentials);  </li>
</ol>
<p>在CAS验证的时候，通过访问/serviceValidate可知：验证成功之后返回的casServiceValidationSuccess.jsp中的数据来源于Assertion，下面来看看它的代码：</p>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>List<Authentication> getChainedAuthentications();  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* True if the validated ticket was granted in the same transaction as that </li>
<li>/* in which its grantor GrantingTicket was originally issued. </li>
<li>/*  </li>
<li>/* @return true if validated ticket was granted simultaneous with its </li>
<li>/* grantor&#39;s issuance </li>
<li>/*/  </li>
<li></li>
<li>boolean isFromNewLogin();  </li>
<li></li>
<li></li>
<li>//<em>/</em> </li>
<li>/* Method to obtain the service for which we are asserting this ticket is </li>
<li>/* valid for. </li>
<li>/*  </li>
<li>/* @return the service for which we are asserting this ticket is valid for. </li>
<li>/*/  </li>
<li></li>
<li><p>Service getService();<br>List<Authentication> getChainedAuthentications(); //<em>/</em> /<em> True if the validated ticket was granted in the same transaction as that /</em> in which its grantor GrantingTicket was originally issued. /<em> /</em> @return true if validated ticket was granted simultaneous with its /<em> grantor&#39;s issuance /</em>/ boolean isFromNewLogin(); //<em>/</em> /<em> Method to obtain the service for which we are asserting this ticket is /</em> valid for. /<em> /</em> @return the service for which we are asserting this ticket is valid for. /*/ Service getService();</p>
<p>通过getChainedAuthentications()方法，我们可以得到Authentication对象列表，再看看Authentication的代码：</p>
</li>
</ol>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>//<em>/</em> </li>
<li>/* Method to obtain the Principal. </li>
<li>/*  </li>
<li>/* @return a Principal implementation </li>
<li>/*/  </li>
<li></li>
<li>Principal getPrincipal();  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* Method to retrieve the timestamp of when this Authentication object was </li>
<li>/* created. </li>
<li>/*  </li>
<li>/* @return the date/time the authentication occurred. </li>
<li>/*/  </li>
<li></li>
<li>Date getAuthenticatedDate();  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* Attributes of the authentication (not the Principal). </li>
<li>/* @return the map of attributes. </li>
<li>/*/  </li>
<li><p>Map<String, Object> getAttributes();<br>//<em>/</em> /<em> Method to obtain the Principal. /</em> /<em> @return a Principal implementation /</em>/ Principal getPrincipal(); //<em>/</em> /<em> Method to retrieve the timestamp of when this Authentication object was /</em> created. /<em> /</em> @return the date/time the authentication occurred. /<em>/ Date getAuthenticatedDate(); //</em>/<em> /</em> Attributes of the authentication (not the Principal). /<em> @return the map of attributes. /</em>/ Map<String, Object> getAttributes();</p>
<p>而这其中的Principal就来源于上面提到的由credentialsToPrincipalResolvers处理得到的Principal对象，最后看一下Principal的代码，我们只要再做一个实现他的代码，整个CAS Server就可以信手拈来了，呵呵</p>
</li>
</ol>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>//<em>/</em> </li>
<li>/* Returns the unique id for the Principal </li>
<li>/* @return the unique id for the Principal. </li>
<li>/*/  </li>
<li></li>
<li>String getId();  </li>
<li></li>
<li></li>
<li>//<em>/</em> </li>
<li>/*  </li>
<li>/* @return </li>
<li>/*/  </li>
<li></li>
<li>Map<String, Object> getAttributes();<br>//<em>/</em> /<em> Returns the unique id for the Principal /</em> @return the unique id for the Principal. /<em>/ String getId(); //</em>/<em> /</em> /<em> @return /</em>/ Map<String, Object> getAttributes();</li>
</ol>
<p>我们还可以自定义自己的casServiceValidationSuccess.jsp和casLoginView.jsp页面等，具体的操作办法也是最简单的办法就是备份以前的页面之后修改成自己需要的页面。</p>
<ul>
<li><a href="http://dl.iteye.com/upload/attachment/0023/8503/ccbda995-b8f2-3cfa-9c4c-f7f841391045.jpg" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></li>
<li><p>大小: 150.5 KB</p>
</li>
<li><p><a href="http://www.iteye.com/topic/650595#" target="_blank">查看图片附件</a></p>
</li>
</ul>
<p>声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。
推荐链接</p>
<ul>
<li><a href="http://www.iteye.com/clicks/609"></a></li>
<li><a href="http://www.iteye.com/clicks/716" target="_blank">想进外企，出国，跳槽，找工作？英语不好,快来充电吧</a></li>
<li><a href="http://www.iteye.com/clicks/770" target="_blank">世界级研发人员汇聚深圳！</a> <a href="http://www.iteye.com/topic/650595#" target="_blank">返回顶楼</a> <a href="http://bolijiang.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://bolijiang.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=boli.jiang" title="发送站内短信" target="_blank"> </a> <a href="http://bolijiang.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=boli.jiang" title="关注作者" target="_blank"> </a></li>
</ul>
<p><a href="http://www.iteye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.iteye.com/forums/board/Java" target="_blank">Java企业应用版</a>
跳转论坛:移动开发技术 Web前端技术 Java企业应用 编程语言技术 综合技术 入门技术 招聘求职 海阔天空</p>
<ul>
<li><a href="http://www.iteye.com/jobs/2344" title="上海:宝尊电商诚聘JAVA高级软件工程师" target="_blank">上海: 宝尊电商诚聘JAVA高级软件工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2137" title="吉林:用友汽车软件诚聘高级Java工程师工作地点：长春、北京" target="_blank">吉林: 用友汽车软件诚聘高级Java工程师工作地点：长</a></li>
<li><a href="http://www.iteye.com/jobs/1628" title="浙江:阿里巴巴诚聘高级Java工程师" target="_blank">浙江: 阿里巴巴诚聘高级Java工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2143" title="上海:用友汽车软件诚聘中级java程序员（工作地点：上海安亭）" target="_blank">上海: 用友汽车软件诚聘中级java程序员（工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/1849" title="浙江:阿里巴巴诚聘C++开发工程师(搜索引擎和广告引擎方向，偏底层)" target="_blank">浙江: 阿里巴巴诚聘C++开发工程师(搜索引擎和广告</a></li>
<li><a href="http://www.iteye.com/jobs/2321" title="云南:云南远信诚聘高级软件工程师(J2EE) " target="_blank">云南: 云南远信诚聘高级软件工程师(J2EE)</a></li>
<li><a href="http://www.iteye.com/jobs/2106" title="上海:爱可生技术诚聘高级JAVA工程师" target="_blank">上海: 爱可生技术诚聘高级JAVA工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2136" title="吉林:用友汽车软件诚聘java开发工程师 工作地点：长春、北京" target="_blank">吉林: 用友汽车软件诚聘java开发工程师 工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2140" title="上海:用友汽车软件诚聘高级java开发工程师（UAP平台）" target="_blank">上海: 用友汽车软件诚聘高级java开发工程师（UAP平</a></li>
<li><a href="http://www.iteye.com/jobs/2427" title="北京:都乐保诚聘Java开发工程师" target="_blank">北京: 都乐保诚聘Java开发工程师</a></li>
<li><a href="http://www.iteye.com/jobs/1144" title="陕西:ThoughtWorks诚聘西安Senior Java Application Developer" target="_blank">陕西: ThoughtWorks诚聘西安Senior Java Applicatio</a></li>
<li><a href="http://www.iteye.com/jobs/2144" title="广东:用友汽车软件诚聘中级JAVA工程师 工作地点：广州" target="_blank">广东: 用友汽车软件诚聘中级JAVA工程师 工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2343" title="上海:宝尊电商诚聘JAVA中级软件工程师" target="_blank">上海: 宝尊电商诚聘JAVA中级软件工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2437" title="广东:★路人甲★诚聘高级Java程序员 广州" target="_blank">广东: ★路人甲★诚聘高级Java程序员 广州</a></li>
<li><a href="http://www.iteye.com/jobs/2064" title="上海:用友汽车软件诚聘高级Java程序员" target="_blank">上海: 用友汽车软件诚聘高级Java程序员</a></li>
<li><a href="http://www.iteye.com/jobs/2358" title="浙江:全麦电子商务诚聘J2EE系统架构师" target="_blank">浙江: 全麦电子商务诚聘J2EE系统架构师</a></li>
<li><a href="http://www.iteye.com/jobs/2141" title="上海:用友汽车软件诚聘初级java开发工程师（UAP平台）" target="_blank">上海: 用友汽车软件诚聘初级java开发工程师（UAP平</a></li>
<li><a href="http://www.iteye.com/jobs/2078" title="上海:用友汽车软件诚聘项目经理" target="_blank">上海: 用友汽车软件诚聘项目经理</a></li>
<li><a href="http://www.iteye.com/jobs/2297" title="云南:云南远信诚聘软件工程师（Java）" target="_blank">云南: 云南远信诚聘软件工程师（Java）</a></li>
<li><p><a href="http://www.iteye.com/jobs/2426" title="北京:都乐保诚聘Java高级开发工程师" target="_blank">北京: 都乐保诚聘Java高级开发工程师</a></p>
</li>
<li><p><a href="http://www.iteye.com/" target="_blank">首页</a></p>
</li>
<li><a href="http://www.iteye.com/news" target="_blank">资讯</a></li>
<li><a href="http://www.iteye.com/magazines" target="_blank">精华</a></li>
<li><a href="http://www.iteye.com/forums" target="_blank">论坛</a></li>
<li><a href="http://www.iteye.com/ask" target="_blank">问答</a></li>
<li><a href="http://www.iteye.com/blogs" target="_blank">博客</a></li>
<li><a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a></li>
<li><a href="http://www.iteye.com/groups" target="_blank">群组</a></li>
<li><a href="http://www.iteye.com/job" target="_blank">招聘</a></li>
<li><a href="http://www.iteye.com/search" target="_blank">搜索</a></li>
<li><a href="http://www.iteye.com/index/service" target="_blank">广告服务</a></li>
<li><a href="http://webmaster.iteye.com/" target="_blank">ITeye黑板报</a></li>
<li><a href="http://www.iteye.com/index/contactus" target="_blank">联系我们</a></li>
<li><a href="http://www.iteye.com/index/friend_links" target="_blank">友情链接</a></li>
</ul>
<p>© 2003-2012 ITeye.com. [ <a href="http://www.miibeian.gov.cn/" target="_blank">京ICP证110151号</a> 京公网安备110105010620 ]
百联优力(北京)投资有限公司 版权所有 <img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--单点登录CASServer介绍-Java综合-Java-ITeye论坛/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--单点登录CASServer介绍-Java综合-Java-ITeye论坛" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-X--Linux密码终极破解之战/">Linux密码终极破解之战</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-X--Linux密码终极破解之战/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="linux-">Linux密码终极破解之战</h1>
<h1 id="linux-">Linux密码终极破解之战</h1>
<p>2013-05-22 10:12 推荐: <a href="http://www.youxia.org/author/youxia/" title="由 网路游侠 发布" target="_blank">网路游侠</a> 浏览: 93 views <a href="http://www.youxia.org/linux-password-crack/#addcomment" target="_blank">我要评论</a><a href="http://www.youxia.org/linux-password-crack/#respond" title="《Linux密码终极破解之战》上的评论" target="_blank"></a> 字号: <a href="">大</a> <a href="">中</a> <a href="">小</a></p>
<p>分享到： <a href="&quot;分享到QQ空间&quot;"></a><a href="&quot;分享到新浪微博&quot;"></a><a href="&quot;分享到腾讯微博&quot;"></a><a href="&quot;分享到人人网&quot;"></a><a href="&quot;分享到开心网&quot;"></a><a href="&quot;分享到豆瓣&quot;"></a><a href="&quot;分享到QQ书签&quot;"></a><a href="&quot;分享到Twitter&quot;"></a><a href="&quot;分享到鲜果&quot;"></a><a href="&quot;分享到Gmail邮箱&quot;"></a><a href=""></a><a href="&quot;分享到豆瓣9点&quot;"></a><a href="&quot;分享到邮件&quot;"></a><a href="&quot;加入收藏夹&quot;"></a><a href="&quot;复制网址&quot;"></a><a href="http://www.jiathis.com/share?uid=899792"></a><a href="">0</a>
<strong>摘要</strong>: 想写linux的相关文章很久了，身为一个运维出身的伪技术，我觉得linux是以后的趋势，所以linux的密码安全第一步要做好至关重要，本文对linux密码攻防作出说明，平台 Red Hat Linux （2.4.20-8） . 破解登录密码 GRUB:在引导装...
想写linux的相关文章很久了，身为一个运维出身的伪技术，我觉得linux是以后的趋势，所以linux的密码安全第一步要做好至关重要，本文对linux密码攻防作出说明，平台 Red Hat Linux （2.4.20-8） .</p>
<p>破解登录密码</p>
<p>GRUB:在引导装载程序菜单上，键入[e] 来进入编辑模式。你会面对一个引导项目列表。查找其中类似以下输出的句行： kernel /vmlinuz-2.4.18-0.4 ro root=/dev/hda2按箭头键直到这一行被突出显示，然后按 [e]。你现在可在文本结尾处空一格再添加 single 来告诉 GRUB 引导单用户 Linux 模式。按 [Enter] 键来使编辑结果生效。你会被带会编辑模式屏幕，从这里，按GRUB 就会引导单用户Linux 模式。结束载入后，你会面对一个与以下相似的shell 提示：sh-2.05/# 现在，你便可以改变根命令，键入：bash/# passwd root 你会被要求重新键入口令来校验。结束后，口令就会被改变，你便可以在提示下键入reboot 来重新引导；然后，象平常一样登录为根用户。LIL当系统启动到出现LILO引导画面时，对于图形引导方式按TAB键进入文本方式，然后在LILO处输入linux single回车即可进入免密码的控制台，进入以后使用passwd命令修改root的密码即可。</p>
<p>方法二：grub-&gt;linux-&gt;选中间一项—E—&gt;在提示符后输入 （/ linux s init 1）–回车–b–&gt;重启后，在提示符后输入（vi /etc/passwd 并将其中用户的密码传输位（x）去掉，强制保存）—-重启即可！</p>
<p>这是最常见也最快捷的方法</p>
<p>防止别人通过单用户模式修改密码。</p>
<p>由于想引导单用户模式需要在grub中进行编辑。因此，我们只要对grub进行加密，不让别人修改grub就可以防止了。</p>
<p>方法如下：</p>
<p>1.grub有一个配置文件，在/etc这个文件夹中。名称是“grub.conf”，找到这个文件，用vi编辑。</p>
<p>2.我们看下文件中的内容：（注释就免了）</p>
<p>default=0</p>
<p>timeout=10</p>
<p>splashimage=（hd0,0）/grub/splash.xpm.gz</p>
<p>title Red Hat Linux （2.4.20-8）</p>
<p>root （hd0,0）</p>
<p>kernel /vmlinuz-2.4.20-8 ro root=LABEL=/</p>
<p>initrd /initrd-2.4.20-8.img</p>
<p>具体含义大家可以查看下grub的相关文档，这里我们要加进密码。</p>
<p>共有两个地方可以添加密码。</p>
<p>3.第一处是“timeout=10”的下面，在这里加上“password=123456”（123456是自己的密码）。保存，退出，重启。我们可以看到，在grub的界面上已经不可以按“e”进行修改了。想修改必须按“p”输入密码后进行修改。</p>
<p>4.第二处是“initrd /initrd-2.4.20-8.img”的下面。在这里加上“password=123456”（123456是自己的密码）。保存，退出，重启。我们可以看到，linux启动前（过了grub界面）又多了一个密码。值得注意的是：这个密码是可以防止单用户模式进入的。也就是说，即使我们通过编辑grub启动单用户模式，还是要输入这个密码的。</p>
<p>如何破解grub密码，进而取得用户权限。</p>
<p>想要取得grub密码，我们就得想办法读取到grub.conf文件。但是没有grub密码，没有root密码……因此我们就不能通过grub引导。</p>
<p>方法如下：</p>
<p>1.首先要修改这个虚拟机的启动方式，我们需要从光盘启动。而虚拟机默认是硬盘为第一启动方式。</p>
<p>在虚拟机刚启动的时候（那个大大的“vmware”的界面）马上按“F2”进入bios。</p>
<p>2.选择到boot那一栏。选中“CD-ROM Drive”一项，按“+”把“CD-ROM Drive”这一项提升到最上面。这样系统就默认光盘启动为第一启动方式了。</p>
<p>3.把linux的第一张安装盘镜像绑定光驱后，保存，重启。系统会直接进入linux的安装界面。在提示符下输入“linux rescue”回车，系统将启动linux救援模式。</p>
<p>4.途中会有几个选项，按照提示选择就好。最后会看到一个说明，大概是说这个救援系统把原来的系统文件（硬盘上的那个）挂载到了“/mnt/sysimage”文件夹下。</p>
<p>5.启动好后，我们就可以寻找grub.conf文件了。这里要注意下文件夹的结构：我们现在在救援系统的根目录下。而我们要找的是原系统的“/etc/grub.conf”，因此完整的路径是：“/mnt/sysimage/etc/grub.conf”。用vi编辑此文件，我们便可以看到，并且修改该文件。从而破解掉grub密码。</p>
<p>防止别人引导到linux救援模式。</p>
<p>我们可以看到，要引导到救援模式必须修改bios。那么我们就可以通过对bios加密来达到防止别人修改bios，从而无法从光盘引导的目的。</p>
<p>方法如下：</p>
<p>这个比较简单。进入bios后选择“Security”项。在“Set Supervisor Password”上回车。设置密码就可以了。这样。我们重新启动系统再次进入bios的时候就需要密码了。</p>
<p>如何破解bios密码。</p>
<p>我们平时清除主机bios密码的时候经常用什么方法呢？拔跳线，抠电池，让bios恢复出厂设置。那么，在虚拟机上有类似的方法么？</p>
<p>方法如下：</p>
<p>找到虚拟机所在的文件夹，里面应该有一个后缀名是“。nvram”的文件。把这个文件删掉。启动系统。我们可以看到。bios被重置了。</p>
<p>原文地址：<a href="http://www.anying.org/thread-3710-1-1.html" target="_blank">http://www.anying.org/thread-3710-1-1.html</a>
来源： &lt;<a href="http://www.youxia.org/linux-password-crack/" target="_blank">Linux密码终极破解之战 - 游侠安全网</a>&gt; </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/X/">X</a></li></span></span> | <span class="tags">Tagged <a href="/tags/X/" class="label label-primary">X</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-X--Linux密码终极破解之战/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-X--Linux密码终极破解之战" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--部署CAS单点登录服务器-萧飒的日志-网易博客/">部署CAS单点登录服务器 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--部署CAS单点登录服务器-萧飒的日志-网易博客/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-cas-">部署CAS单点登录服务器 - 萧飒的日志 - 网易博客</h1>
<p><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://www.163.com/" target="_blank">网易 </a></p>
<p><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://news.163.com/" target="_blank">新闻</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://t.163.com/" target="_blank">微博</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://email.163.com/" target="_blank">邮箱</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://photo.163.com/" target="_blank">相册</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://yuedu.163.com/" target="_blank">阅读</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://www.youdao.com/" target="_blank">有道</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://photo.163.com/pp/square/" target="_blank">摄影</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://aipai.163.com?from=163blog" target="_blank">爱拍</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://note.youdao.com/?vendor=163blog" target="_blank">云笔记</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://fm.163.com/?fmblogzx0628" target="_blank">闪电邮</a><a href="http://m.123.163.com/?frombkcp" target="_blank">手机邮</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://yxp.163.com/" target="_blank">印像派</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://hi.163.com/?from=bkcp" target="_blank">游戏江湖</a> <a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://sitemap.163.com/" target="_blank">更多</a></p>
<p><a href="http://blog.163.com/?frompersonalbloghome" target="_blank">博客 </a></p>
<p><a href="http://blog.163.com/services/wapblog.html?frompersonalbloghome" target="_blank">手机博客</a><a href="http://blog.163.com/clone/clone.html?frompersonalbloghome" target="_blank">博客搬家</a><a href="http://blog.163.com/vip.do?frompersonalbloghome" target="_blank">博客VIP服务</a> <a href="http://blog.163.com/blog_admin/blog/static/721279201082863728829/?frompersonalbloghome" target="_blank">LiveWriter写博</a><a href="http://blog.163.com/blog_admin/blog/static/721279201092713253500/?frompersonalbloghome" target="_blank">word写博</a><a href="http://blog.163.com/services/mailblog.html?frompersonalbloghome" target="_blank">邮件写博</a><a href="http://blog.163.com/services/emsblog.html?frompersonalbloghome" target="_blank">短信写博</a> <a href="http://blog.163.com/showMultiUser.do?frompersonalbloghome" target="_blank">群博客</a><a href="http://blog.163.com/BLOG_YOUCAI/" target="_blank">博客油菜地</a><a href="http://blog.163.com/ht/?frompersonalbloghome" target="_blank">博客话题</a><a href="http://blog.163.com/hot/history/?frompersonalbloghome" target="_blank">博客热点</a><a href="http://q.163.com/#home?frompersonalbloghome" target="_blank">博客圈子</a><a href="http://blog.163.com/findFriend.do?type=5?frompersonalbloghome" target="_blank">找朋友</a>
<a href="http://blog.163.com/public/explore/?frompersonalbloghome" target="_blank">发现</a></p>
<p><a href="http://blog.163.com/g/?frompersonalbloghome" target="_blank">小组</a>
<a href="http://blog.163.com/public/theme/?frompersonalbloghome" target="_blank">风格</a></p>
<p><a href="http://blog.163.com/randomUser.do" title="随便看看"></a></p>
<p><a href="http://istyle.163.com/" target="_blank">网易真人搭配社区iStyle</a></p>
<p><a href="http://www.lofter.com/" target="_blank">网易轻博客LOFTER</a></p>
<p><a href="http://reg.163.com/reg/reg.jsp?product=blog&amp;url=http://blog.163.com/ntesRegBlank.html&amp;loginurl=http://blog.163.com/" target="_blank">创建博客</a> <a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/#" target="_blank">登录</a>  </p>
<p> 加关注</p>
<p><a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/" target="_blank"></a>   <a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/">显示下一条</a>  |  <a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/" target="_blank">关闭</a></p>
<p><a href="http://blog.163.com/public/explore/?fromblogbanner"></a>
<a href="http://www.lofter.com/invite/163blog/?email="></a></p>
<h1 id="-">萧飒的博客</h1>
<p>未来的成功往往是现在无法想象的……
 <a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/#"></a></p>
<h2 id="-">导航</h2>
<ul>
<li><a href="http://slf-1983.blog.163.com/" target="_blank">首页</a></li>
<li><a href="http://slf-1983.blog.163.com/blog/" target="_blank">日志</a></li>
<li><a href="http://slf-1983.blog.163.com/album/" target="_blank">相册</a></li>
<li><a href="http://slf-1983.blog.163.com/music/" target="_blank">音乐</a></li>
<li><a href="http://slf-1983.blog.163.com/collection/" target="_blank">收藏</a></li>
<li><a href="http://slf-1983.blog.163.com/friends/" target="_blank">博友</a></li>
<li><a href="http://slf-1983.blog.163.com/profile/" target="_blank">关于我</a></li>
</ul>
<h2 id="-">日志</h2>
<p><a href="http://slf-1983.blog.163.com/blog/static/299023632012431659898/" target="_blank">cas改造随笔</a></p>
<p><a href="http://slf-1983.blog.163.com/blog/static/29902363201243323076/" target="_blank">jsessionid的困扰</a></p>
<h3 id="-cas-">部署CAS单点登录服务器</h3>
<p>2012-05-03 15:16:28|  分类： <a href="http://slf-1983.blog.163.com/blog/#m=0&amp;t=1&amp;c=fks_082068080083080065083095074065093095081065087080085" title="编程" target="_blank">编程</a> |  标签： |字号大中小 <a href="">订阅</a></p>
<p><strong>第0步：环境配置</strong></p>
<p>操作系统：CentOS 5.5 64位</p>
<p>JDK：1.7</p>
<p>Tomcat：7.0</p>
<p>CAS Server：3.4.11</p>
<p>CAS Client：3.2.1</p>
<p><strong>第1步：安装JAVA并设置环境变量</strong></p>
<p>从<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk-7u3-download-1501626.html" target="_blank"><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk-7u3-download-1501626.html">http://www.oracle.com/technetwork/java/javase/downloads/jdk-7u3-download-1501626.html</a></a></p>
<p>下载并安装Linux x64 RPM包
rpm -i jdk-7u3-linux-x64.rpm</p>
<p>设置环境变量</p>
<p>vi /etc/profile</p>
<p>加入</p>
<p>JAVA_HOME=/usr/java/jdk1.7.0_03 export JAVA_HOME</p>
<p>方便操作将keytool加入/usr/bin/</p>
<p>ln -s /usr/java/jdk1.7.0_03/bin/keytool /usr/bin/keytool</p>
<p><strong>第2步：安装Tomcat</strong></p>
<p>从<a href="http://tomcat.apache.org/download-70.cgi" target="_blank"><a href="http://tomcat.apache.org/download-70.cgi">http://tomcat.apache.org/download-70.cgi</a></a></p>
<p>下载Tomcat并解压</p>
<p>tar -zxvf apache-tomcat-7.0.26.tar.gz</p>
<p>方便操作将启动关闭加入/usr/bin/
ln -s /usr/local/tomcat/bin/startup.sh /usr/bin/tomcat-start ln -s /usr/local/tomcat/bin/shutdown.sh /usr/bin/tomcat-stop</p>
<p><strong>第3步：创建、导出、导入证书</strong></p>
<p>创建一个生成证书的脚本
vi create_https_cert.sh /# 删除原证书库 keytool -delete -keystore /home/cas/cascerts -storepass changeit /# 删除原别名 keytool -delete -alias sgstsso -storepass changeit /# 生成证书，需要注意的是dname需要使用域名或主机名，不能用IP，keystore 为生成的证书库地址，后面TOMCAT会用到 keytool -genkey -keyalg RSA -alias sgstsso -keystore /home/cas/cascerts -dname &quot;CN=cas.sgst.cn&quot; -storepass changeit /# 导出证书，导出的证书用在各客户端的JDK导入 keytool -export -alias sgstsso -keystore /home/cas/cascerts -file /home/cas/sgstsso.crt -storepass changeit /# 导入证书 keytool -import -alias sgstsso -file /home/cas/sgstsso.crt -keystore $JAVA_HOME/jre/lib/security/cacerts -storepass changeit</p>
<p>执行该脚本。</p>
<p><strong>第4步：应用证书到Tomcat</strong></p>
<p>编辑conf/server.xml加入下面这段（如果8443 https已开启使用的则在其基础上修改）</p>
<Connector protocol="org.apache.coyote.http11.Http11Protocol" port="8443" minSpareThreads="5" enableLookups="true" disableUploadTimeout="true" acceptCount="100" maxThreads="200" scheme="https" secure="true" SSLEnabled="true" keystoreFile="/home/cas/cascerts" keystorePass="changeit" truststoreFile="/usr/java/jdk1.7.0_03/jre/lib/security/cacerts" clientAuth="false" sslProtocol="TLS"/>

<p>重启Tomcat，访问<a href="https://localhost:8443，如果能否访问则配置成功。" target="_blank">https://localhost:8443，如果能否访问则配置成功。</a></p>
<p><strong>第5步：配置CAS服务器</strong></p>
<p>从<a href="http://www.jasig.org/cas/download" target="_blank"><a href="http://www.jasig.org/cas/download">http://www.jasig.org/cas/download</a></a>下载<a href="http://www.jasig.org/cas_server_3_4_11_release" target="_blank">CAS Server 3.4.11 Release</a>压缩包</p>
<p>解压后将其中的cas-server-3.4.11.war改名为cas.war放在tomcat下面</p>
<p>此时打开<a href="https://localhost:8443/cas/login即可访问" target="_blank">https://localhost:8443/cas/login即可访问</a></p>
<p>输入sgst/sgst登录成功（默认为简单认证，即用户名密码一样就算通过）</p>
<p>编辑tomcat/conf/server.xml在原Host下面增加以下这段</p>
<Host name="cas.sgst.cn" appBase="/home/cas/webapps" unpackWARs="true" autoDeploy="true"> <Context path='' docBase='cas'/> <Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs" prefix="cas_access_log." suffix=".txt" pattern="%h %l %u %t &quot;%r&quot; %s %b" /> </Host>

<p>这样实现以<a href="https://cas.sgst.cn:8443" target="_blank">https://cas.sgst.cn:8443</a> 访问cas</p>
<p>CAS的认证改为查询数据库用户名密码验证：</p>
<p>编辑cas/WEB-INF/deployerConfigContext.xml</p>
<p>将</p>
<bean class="org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler" />

注释掉，新增下面这段

<bean class="org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler"> <property name="dataSource" ref="casDataSource" /> <property name="sql" value="select userpwd from idsuser where lower(username) = lower(?)" /> <property name="passwordEncoder" ref="myPasswordEncoder"/> </bean>

<p>上面的加密根据个人需求可自行开发，这里用的是MD5 64位加密，以一个独立bean跟在后面</p>
<bean id="myPasswordEncoder"/>

casDataSource则同样以一个独立bean跟在后面

<bean id="casDataSource" class="org.apache.commons.dbcp.BasicDataSource"> <property name="driverClassName"> <value>oracle.jdbc.driver.OracleDriver</value> </property> <property name="url"> <value>jdbc:oracle:thin:@(DESCRIPTION =(ADDRESS = (PROTOCOL = TCP)(HOST = 10.10.29.104)(PORT = 1521))(ADDRESS = (PROTOCOL = TCP)(HOST = 10.10.29.105)(PORT = 1521))(ADDRESS = (PROTOCOL = TCP)(HOST = 10.10.29.106)(PORT = 1521))(LOAD_BALANCE = yes)(CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = genome)))</value> </property> <property name="username"> <value>trs_ids</value> </property> <property name="password"> <value>123456</value> </property> </bean>

<p>保存该文件，复制压缩包中的modules里的cas-server-support-jdbc-3.4.11.jar和ojdbc14.jar到cas/WEB-INF/lib下</p>
<p>重启Tomcat后CAS便以用户名密码进行验证。</p>
<p><strong>第6步：配置CAS客户端</strong></p>
<p>从<a href="http://www.jasig.org/cas/client-integration" target="_blank"><a href="http://www.jasig.org/cas/client-integration">http://www.jasig.org/cas/client-integration</a></a>参考适合的客户端，JAVA的在这里下载<a href="http://downloads.jasig.org/cas-clients/" target="_blank"><a href="http://downloads.jasig.org/cas-clients/">http://downloads.jasig.org/cas-clients/</a></a></p>
<p>客户端中相应的JAR包都有，对应的maven为
<!-- cas --> <dependency> <groupId>org.jasig.cas.client</groupId> <artifactId>cas-client-core</artifactId> <version>3.2.1</version> </dependency></p>
<p>修改web.xml增加以下filter</p>
<!-- ======================== 单点登录开始 ======================== --> <!-- 用于单点退出，该过滤器用于实现单点登出功能，可选配置--> <listener> <listener-class>org.jasig.cas.client.session.SingleSignOutHttpSessionListener</listener-class> </listener> <!-- 该过滤器用于实现单点登出功能，可选配置。 --> <filter> <filter-name>CAS Single Sign Out Filter</filter-name> <filter-class>org.jasig.cas.client.session.SingleSignOutFilter</filter-class> </filter> <filter-mapping> <filter-name>CAS Single Sign Out Filter</filter-name> <url-pattern>/check//<em></url-pattern> </filter-mapping> <!-- 该过滤器负责用户的认证工作，必须启用它 --> <filter> <filter-name>CASFilter</filter-name> <filter-class>org.jasig.cas.client.authentication.AuthenticationFilter</filter-class> <init-param> <param-name>casServerLoginUrl</param-name> <!-- 这里是服务器端地址 --> <param-value><a href="https://cas.sgst.cn:8443/login" target="_blank">https://cas.sgst.cn:8443/login</a></param-value> </init-param> <init-param> <param-name>serverName</param-name> <param-value><a href="http://localhost:8080" target="_blank">http://localhost:8080</a></param-value> </init-param> </filter> <filter-mapping> <filter-name>CASFilter</filter-name> <url-pattern>/check//</em></url-pattern> </filter-mapping> <!-- 该过滤器负责对Ticket的校验工作，必须启用它 --> <filter> <filter-name>CAS Validation Filter</filter-name> <filter-class> org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter </filter-class> <init-param> <param-name>casServerUrlPrefix</param-name> <param-value><a href="https://cas.sgst.cn:8443" target="_blank">https://cas.sgst.cn:8443</a></param-value> </init-param> <init-param> <param-name>serverName</param-name> <param-value><a href="http://localhost:8080" target="_blank">http://localhost:8080</a></param-value> </init-param> </filter> <filter-mapping> <filter-name>CAS Validation Filter</filter-name> <url-pattern>/check//<em></url-pattern> </filter-mapping> <!-- 该过滤器负责实现HttpServletRequest请求的包裹， 比如允许开发者通过HttpServletRequest的getRemoteUser()方法获得SSO登录用户的登录名，可选配置。 --> <filter> <filter-name>CAS HttpServletRequest Wrapper Filter</filter-name> <filter-class>org.jasig.cas.client.util.HttpServletRequestWrapperFilter</filter-class> </filter> <filter-mapping> <filter-name>CAS HttpServletRequest Wrapper Filter</filter-name> <url-pattern>/check//</em></url-pattern> </filter-mapping> <!-- 该过滤器使得开发者可以通过org.jasig.cas.client.util.AssertionHolder来获取用户的登录名。 比如AssertionHolder.getAssertion().getPrincipal().getName()。 --> <filter> <filter-name>CAS Assertion Thread Local Filter</filter-name> <filter-class>org.jasig.cas.client.util.AssertionThreadLocalFilter</filter-class> </filter> <filter-mapping> <filter-name>CAS Assertion Thread Local Filter</filter-name> <url-pattern>/check//*</url-pattern> </filter-mapping> <!-- ======================== 单点登录结束 ======================== -->

<p>2012-03-21更新： CAS filter-mapping一定要放在整个项目的encodingFilter之后，否则会造成中文乱码</p>
<p><strong>第7步：美化服务器界面</strong></p>
<p>具体页面在cas\WEB-INF\view\jsp\default\ui\</p>
<p>登录界面：casLoginView.jsp
登录成功：casGenericSuccess.jsp
登出界面：casLogoutView.jsp
  评论这张</p>
<p><img src="" alt=""> 转发至微博
<img src="" alt=""> 转发至微博</p>
<p><img src="" alt=""> 0人  |  分享到：        </p>
<p>阅读(7)| 评论(0)| 转载 (0) |举报</p>
<p><a href="http://slf-1983.blog.163.com/blog/static/299023632012431659898/" target="_blank">cas改造随笔</a></p>
<p><a href="http://slf-1983.blog.163.com/blog/static/29902363201243323076/" target="_blank">jsessionid的困扰</a></p>
<h3 id="-">历史上的今天</h3>
<h3 id="-">相关文章</h3>
<h3 id="-">最近读者</h3>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<p>this.p={ m:2, b:2, id:&#39;fks_087066086087081064092094095065072084088074084084085069087&#39;, blogTitle:&#39;部署CAS单点登录服务器&#39;, blogAbstract:&#39;<span style=\"color: rgb(51, 51, 51); font-family: \'Segoe UI\', Calibri, \'Myriad Pro\', Myriad, \'Trebuchet MS\', Helvetica, Arial, sans-serif; font-size: 13px; line-height: normal;\" \><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \><strong\>第0步：环境配置</strong\></p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>操作系统：CentOS 5.5 64位</p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>JDK：1.7</p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>Tomcat：7.0</p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>CAS Server：3.4.11</p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>CAS Client：3.2.1</p\></span\>&#39;, blogTag:&#39;编程&#39;, blogUrl:&#39;blog/static/2990236320124331628240&#39;, isPublished:1, istop:false, type:0, modifyTime:0, publishTime:1336029388240, permalink:&#39;blog/static/2990236320124331628240&#39;, commentCount:0, mainCommentCount:0, recommendCount:0, bsrk:-100, publisherId:0, recomBlogHome:false, attachmentsFileIds:[], vote:{}, groupInfo:{}, friendstatus:&#39;none&#39;, followstatus:&#39;unFollow&#39;, pubSucc:&#39;&#39;, visitorProvince:&#39;北京&#39;, visitorCity:&#39;西城区&#39;, postAddInfo:{}, mset:&#39;000&#39;, mcon:&#39;&#39;, srk:-100, remindgoodnightblog:false, isBlackVisitor:false, isShowYodaoAd:true, hostIntro:&#39;我,犯溅一样的猪一样的懒,无语……&#39;, hmcon:&#39;1&#39;, selfRecomBlogCount:&#39;0&#39;, lofter_single:&#39;<a hidefocus="true" target="_blank" href="http://www.lofter.com/reg?act=qbview_20120221_01&from=blog_01"><img onload="var nimg = new Image(); nimg.src=\'http://blog.163.com/newpage/images/analyse.png?lofter_single&t=\'+new Date().getTime()" border="0" src="http://b2.bst.126.net/newpage/images/lofter_single6.jpg"/></a>&#39; }   {list a as x} {if !!x} <div class="iblock nbw-fce nbw-f40"> <a class="fc03 noul" target="_blank" hidefocus="true" href="http://blog.163.com/${x.visitorName}/"> {if x.visitorName==visitor.userName} <img alt="${x.visitorNickname|escape}" onerror="this.src=location.f40" class="cwd bdwa bdc0" src="${fn1(x.visitorName)}&r=${visitor.imageUpdateTime}"/> {else} <img alt="${x.visitorNickname|escape}" onerror="this.src=location.f40" class="cwd bdwa bdc0" src="${fn1(x.visitorName)}"/> {/if} </a> <div class="cwd vname thide"> {if x.moveFrom==&#39;wap&#39;} <a class="noul pnt" target="_blank" href="http://blog.163.com/services/wapblog.html?frompersonalbloghome"><span title="来自网易手机博客" class="iblock wapIcon"> </span></a> {elseif x.moveFrom==&#39;iphone&#39;} <a class="noul pnt" target="_blank"><span title="来自iPhone客户端" class="iblock iphoneIcon"> </span></a> {elseif x.moveFrom==&#39;android&#39;} <a class="noul pnt" target="_blank"><span title="来自Android客户端" class="iblock androidIcon"> </span></a> {elseif x.moveFrom==&#39;mobile&#39;} <a class="noul pnt" target="_blank" href="http://blog.163.com/services/emsblog.html?frompersonalbloghome"><span title="来自网易短信写博" class="iblock wapIcon"> </span></a> {/if} <a class="fc03 m2a" target="_blank" hidefocus="true" href="http://blog.163.com/${x.visitorName}/"> ${fn(x.visitorNickname,8)|escape} </a> </div> </div> {/if} {/list}   {if !!a} <a target="_blank" href="http://blog.163.com/${a.userName}/"><img class="bdwa bdc0 pnt" onerror="this.src=location.f60" src="${fn1(a.userName)}"/></a> <a target="_blank" class="fc03 m2a" href="http://blog.163.com/${a.userName}/">${fn(a.nickname,8)|escape}</a> <div class="intro fc05">${a.selfIntro|escape}{if great260}${suplement}{/if}</div> <div class="acts ztag"></div> <div class="mbga phide xtag"> <div class="mbgai"> </div> <a class="fc03 xtag m2a" href="/#" target="_blank"></a> </div> {/if}  &lt;/#--最新日志，群博日志--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="${furl()}${x.permalink}/?latestBlog">${fn(x.title,26)|escape}</a></li> {/if} {/list}  &lt;/#--推荐日志--&gt;  <p class="fc06">推荐过这篇日志的人：</p> <div> {list a as x} {if !!x} <div class="iblock nbw-fce nbw-f40"> <a class="fc03 noul" target="_blank" hidefocus="true" href="http://blog.163.com/${x.recommenderName}/"> <img alt="${x.recommenderNickname|escape}" onerror="this.src=location.f40" class="cwd bdwa bdc0" src="${fn1(x.recommenderName)}"/> </a> <div class="cwd thide"> <a class="fc03 m2a" target="_blank" hidefocus="true" href="http://blog.163.com/${x.recommenderName}/"> ${fn(x.recommenderNickname,6)|escape} </a> </div> </div> {/if} {/list} </div> {if !!b&amp;&amp;b.length&gt;0} <p class="fc06">他们还推荐了：</p> <ul> {list b as y} {if !!y} <li class="rrb"><span class="iblock">·</span><a class="fc03 m2a" target="_blank" href="http://blog.163.com/${y.recommendBlogPermalink}/?from=blog/static/2990236320124331628240">${y.recommendBlogTitle|escape}</a></li> {/if} {/list} </ul> {/if}  &lt;/#--引用记录--&gt;  <span class="pleft fc07">转载记录：</span> <ul class="tbac"> {list d as x} <li class="clearfix"> <span class="pleft iblock">·</span> <div class="tbl thide pleft"><span><a target="_blank" class="fc07 m2a" href="${x.referBlogUrl}">${x.referBlogTitle|escape}</a></span></div> <div class="tbr pleft"><span><a target="_blank" class="fc07 m2a" href="${x.referHomePage}">${x.referUserName|escape}</a></span></div> </li> {/list} </ul>  &lt;/#--博主推荐--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="http://blog.163.com/${x.userName}/${x.permalink}/?recommendBlog" title="${x.title|default:""|escape}">${x.title|default:&quot;&quot;|escape}</a></li> {/if} {/list}  &lt;/#--随机阅读--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="http://blog.163.com/${x.userName}/${x.permalink}/?personalRecomBlog" title="${x.title|default:""|escape}">${x.title|default:&quot;&quot;|escape}</a></li> {/if} {/list}  &lt;/#--首页推荐--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" target="_blank" href="${x.blogUrl|default:""|escape}?recommendReader" title="${x.blogTile|default:""|escape}">${x.blogTile|default:&quot;&quot;|escape}</a></li> {/if} {/list}  &lt;/#--相关文章--&gt;  <ul> {list a as x} {if x_index&gt;9}{break}{/if} {if !!x} <li class="thide fc03"> <a class="m2a" target="_blank" target="_blank" href="${x.url|default:""}?fromdm&fromSearch&isFromSearchEngine=${isFromSearchEngine|default:"no"}" title="${x.title|default:""|escape}">${x.title|default:&quot;&quot;|escape}</a><span class="fc07">${fn2(parseInt(x.date),&#39;yyyy-MM-dd HH:mm:ss&#39;)}</span> </li> {/if} {/list} </ul>  &lt;/#--历史上的今天--&gt;  <ul> {list a as x} {if x_index&gt;4}{break}{/if} {if !!x} <li class="thide fc03"> <a class="m2a" target="_blank" href="http://blog.163.com/${x.userName}/${x.permalink|default:""}" title="${x.title|default:""|escape}">${fn1(x.title,60)|escape}</a><span class="fc07">${fn2(x.publishTime,&#39;yyyy-MM-dd HH:mm:ss&#39;)}</span> </li> {/if} {/list} </ul>  &lt;/#--被推荐日志--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="${furl()}${x.permalink}/">${fn(x.title,26)|escape}</a></li> {/if} {/list}  &lt;/#--右边模块结构--&gt;  <div class="uinfo ztag"></div> <h4 class="fc07 fs0 ltt phide ztag">被推荐日志</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">最新日志</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">该作者的其他文章</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">博主推荐</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">相关日志</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">随机阅读</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">首页推荐</h4> <ul class="ztag blst"></ul> <div class="more"><a target="_blank" class="fc03 m2a" href="http://blog.163.com">更多&gt;&gt;</a></div> <br/><br/> <div id="yodaoad_r" style="display:none;_zoom:1;"></div> <div id="lofter_single"></div>  &lt;/#--评论模块结构--&gt;  <div class="publish ztag"></div> <div class="bdwt bds2 bdc0 phide" id="yodaoad_2" style="_zoom:1;"></div> <div class="ztag bdwt bds2 bdc0"> <div class="case"></div> <div class="clearfix"></div> </div>  &lt;/#--引用模块结构--&gt;  <div class="close"> <span class="ztag iblock icn0 icn0-57"> </span> </div> <div class="ztag phide"></div>  &lt;/#--博主发起的投票--&gt;  {list a as x} {if !!x} <li> <a href="http://blog.163.com/${x.userName}/" target="_blank" class="m2a fc03">${x.nickName|escape}</a>  投票给 {var first_option = true;} {list x.voteDetailList as voteToOption} {if voteToOption==1} {if first_option==false},{/if}  “${b[voteToOption_index]}”   {/if} {/list} {if (x.role!=&quot;-1&quot;) },“我是${c[x.role]}”  {/if}     <span class="fc07">    ${fn1(x.voteTime)}</span> {if x.userName==&#39;&#39;}{/if} {/if} {/list}</p>
<h2 id="-">页脚</h2>
<p><a href="http://corp.163.com/index_gb.html" target="_blank">公司简介</a> - <a href="http://gb.corp.163.com/gb/contactus.html" target="_blank">联系方法</a> - <a href="http://corp.163.com/gb/job/job.html" target="_blank">招聘信息</a> - <a href="http://help.163.com/?b13abk1" target="_blank">客户服务</a> - <a href="http://corp.163.com/gb/legal/legal.html" target="_blank">隐私政策</a> - <a href="http://blog.163.com/public/theme/" target="_blank">博客风格</a> - <a href="http://blog.163.com/services/wapblog.html" target="_blank">手机博客</a> - <a href="http://blog.163.com/vip.do" target="_blank">VIP博客</a> - <a href="">订阅此博客</a></p>
<p>网易公司版权所有 ©1997-2012</p>
<p><a rel="nofollow" class="pr" target="_blank" href="http://help.163.com/special/007525FT/blog.html?b13aze1">帮助</a> <span class="fr iblock space icn1 icn1-4"> </span> <a class="pr" target="_blank" href="http://blog.163.com/activation.do?host=activation&&username=${u}">${u}</a>   {list wl as x} <div class="grp">${x.g}</div> {list x.l as y} <a class="itm noul" href="/#" hidefocus="true" name="{if typeof(y.v)=='string'}${y.v}{else}${y_index}{/if}">${y.n}</a> {/list} {/list}   {if defined(&#39;wl&#39;)} {list wl as x}<a class="itm noul" href="/#" hidefocus="true" name="${x.v}">${x.n}</a>{/list} {/if}</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--部署CAS单点登录服务器-萧飒的日志-网易博客/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--部署CAS单点登录服务器-萧飒的日志-网易博客" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS-spring-cas--21-JavaAuthenticationandAuthorizationService/">21. Java Authentication and Authorization Service </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS-spring-cas--21-JavaAuthenticationandAuthorizationService/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="21-java-authentication-and-authorization-service-jaas-provider">21. Java Authentication and Authorization Service (JAAS) Provider</h1>
<ol>
<li>Java Authentication and Authorization Service (JAAS) Provider<a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/taglibs.html" target="_blank">Prev</a> Part V. Additional Topics <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/cas.html" target="_blank">Next</a></li>
</ol>
<h1 id="-java-authentication-and-authorization-service-jaas-provider"><a href=""></a>Java Authentication and Authorization Service (JAAS) Provider</h1>
<h2 id="-21-1-overview"><a href=""></a>21.1 Overview</h2>
<p>Spring Security provides a package able to delegate authentication requests to the Java Authentication and Authorization Service (JAAS). This package is discussed in detail below.</p>
<h2 id="-21-2-abstractjaasauthenticationprovider"><a href=""></a>21.2 AbstractJaasAuthenticationProvider</h2>
<p>The</p>
<p>AbstractJaasAuthenticationProvider
is the basis for the provided JAAS</p>
<p>AuthenticationProvider
implementations. Subclasses must implement a method that creates the</p>
<p>LoginContext
. The</p>
<p>AbstractJaasAuthenticationProvider
has a number of dependencies that can be injected into it that are discussed below.</p>
<h3 id="-21-2-1-jaas-callbackhandler"><a href=""></a>21.2.1 JAAS CallbackHandler</h3>
<p>Most JAAS</p>
<p>LoginModule
s require a callback of some sort. These callbacks are usually used to obtain the username and password from the user.</p>
<p>In a Spring Security deployment, Spring Security is responsible for this user interaction (via the authentication mechanism). Thus, by the time the authentication request is delegated through to JAAS, Spring Security&#39;s authentication mechanism will already have fully-populated an</p>
<p>Authentication
object containing all the information required by the JAAS</p>
<p>LoginModule
.</p>
<p>Therefore, the JAAS package for Spring Security provides two default callback handlers,</p>
<p>JaasNameCallbackHandler
and</p>
<p>JaasPasswordCallbackHandler
. Each of these callback handlers implement</p>
<p>JaasAuthenticationCallbackHandler
. In most cases these callback handlers can simply be used without understanding the internal mechanics.</p>
<p>For those needing full control over the callback behavior, internally</p>
<p>AbstractJaasAuthenticationProvider
wraps these</p>
<p>JaasAuthenticationCallbackHandler
s with an</p>
<p>InternalCallbackHandler
. The</p>
<p>InternalCallbackHandler
is the class that actually implements JAAS’ normal</p>
<p>CallbackHandler
interface. Any time that the JAAS</p>
<p>LoginModule
is used, it is passed a list of application context configured</p>
<p>InternalCallbackHandler
s. If the</p>
<p>LoginModule
requests a callback against the</p>
<p>InternalCallbackHandler
s, the callback is in-turn passed to the</p>
<p>JaasAuthenticationCallbackHandler
s being wrapped.</p>
<h3 id="-21-2-2-jaas-authoritygranter"><a href=""></a>21.2.2 JAAS AuthorityGranter</h3>
<p>JAAS works with principals. Even &quot;roles&quot; are represented as principals in JAAS. Spring Security, on the other hand, works with</p>
<p>Authentication
objects. Each</p>
<p>Authentication
object contains a single principal, and multiple</p>
<p>GrantedAuthority
s. To facilitate mapping between these different concepts, Spring Security&#39;s JAAS package includes an</p>
<p>AuthorityGranter
interface.</p>
<p>An</p>
<p>AuthorityGranter
is responsible for inspecting a JAAS principal and returning a set of</p>
<p>String
s, representing the authorities assigned to the principal. For each returned authority string, the</p>
<p>AbstractJaasAuthenticationProvider
creates a</p>
<p>JaasGrantedAuthority
(which implements Spring Security’s</p>
<p>GrantedAuthority
interface) containing the authority string and the JAAS principal that the</p>
<p>AuthorityGranter
was passed. The</p>
<p>AbstractJaasAuthenticationProvider
obtains the JAAS principals by firstly successfully authenticating the user’s credentials using the JAAS</p>
<p>LoginModule
, and then accessing the</p>
<p>LoginContext
it returns. A call to</p>
<p>LoginContext.getSubject().getPrincipals()
is made, with each resulting principal passed to each</p>
<p>AuthorityGranter
defined against the</p>
<p>AbstractJaasAuthenticationProvider.setAuthorityGranters(List)
property.</p>
<p>Spring Security does not include any production</p>
<p>AuthorityGranter
s given that every JAAS principal has an implementation-specific meaning. However, there is a</p>
<p>TestAuthorityGranter
in the unit tests that demonstrates a simple</p>
<p>AuthorityGranter
implementation.</p>
<h2 id="-21-3-defaultjaasauthenticationprovider"><a href=""></a>21.3 DefaultJaasAuthenticationProvider</h2>
<p>The</p>
<p>DefaultJaasAuthenticationProvider
allows a JAAS</p>
<p>Configuration
object to be injected into it as a dependency. It then creates a</p>
<p>LoginContext
using the injected JAAS</p>
<p>Configuration
. This means that</p>
<p>DefaultJaasAuthenticationProvider
is not bound any particular implementation of</p>
<p>Configuration
as</p>
<p>JaasAuthenticationProvider
is.</p>
<h3 id="-21-3-1-inmemoryconfiguration"><a href=""></a>21.3.1 InMemoryConfiguration</h3>
<p>In order to make it easy to inject a</p>
<p>Configuration
into</p>
<p>DefaultJaasAuthenticationProvider
, a default in memory implementation named</p>
<p>InMemoryConfiguration
is provided. The implementation constructor accepts a</p>
<p>Map
where each key represents a login configuration name and the value represents an</p>
<p>Array
of</p>
<p>AppConfigurationEntry
s.</p>
<p>InMemoryConfiguration
also supports a default</p>
<p>Array
of</p>
<p>AppConfigurationEntry
objects that will be used if no mapping is found within the provided</p>
<p>Map
. For details, refer to the class level javadoc of</p>
<p>InMemoryConfiguration
.</p>
<h3 id="-21-3-2-defaultjaasauthenticationprovider-example-configuration"><a href=""></a>21.3.2 DefaultJaasAuthenticationProvider Example Configuration</h3>
<p>While the Spring configuration for</p>
<p>InMemoryConfiguration
can be more verbose than the standarad JAAS configuration files, using it in conjuction with</p>
<p>DefaultJaasAuthenticationProvider
is more flexible than</p>
<p>JaasAuthenticationProvider
since it not dependant on the default</p>
<p>Configuration
implementation.</p>
<p>An example configuration of</p>
<p>DefaultJaasAuthenticationProvider
using</p>
<p>InMemoryConfiguration
is provided below. Note that custom implementations of</p>
<p>Configuration
can easily be injected into</p>
<p>DefaultJaasAuthenticationProvider
as well.</p>
<bean id="jaasAuthProvider" class="org.springframework.security.authentication.jaas.DefaultJaasAuthenticationProvider"> <property name="configuration"> <bean class="org.springframework.security.authentication.jaas.memory.InMemoryConfiguration"> <constructor-arg> <map> <!-- SPRINGSECURITY is the default loginContextName for AbstractJaasAuthenticationProvider --> <entry key="SPRINGSECURITY"> <array> <bean class="javax.security.auth.login.AppConfigurationEntry"> <constructor-arg value="sample.SampleLoginModule" /> <constructor-arg> <util:constant static-field= "javax.security.auth.login.AppConfigurationEntry$LoginModuleControlFlag.REQUIRED"/> </constructor-arg> <constructor-arg> <map></map> </constructor-arg> </bean> </array> </entry> </map> </constructor-arg> </bean> </property> <property name="authorityGranters"> <list> <!-- You will need to write your own implementation of AuthorityGranter --> <bean class="org.springframework.security.authentication.jaas.TestAuthorityGranter"/> </list> </property> </bean>
## <a href=""></a>21.4 JaasAuthenticationProvider

The

JaasAuthenticationProvider
assumes the default

Configuration
is an instance of <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/spec/com/sun/security/auth/login/ConfigFile.html" target="_blank">ConfigFile</a>. This assumption is made in order to attempt to update the

Configuration
. The

JaasAuthenticationProvider
then uses the default

Configuration
to create the

LoginContext
.

Let’s assume we have a JAAS login configuration file,

/WEB-INF/login.conf
, with the following contents:
JAASTest { sample.SampleLoginModule required; };

Like all Spring Security beans, the

JaasAuthenticationProvider
is configured via the application context. The following definitions would correspond to the above JAAS login configuration file:

<bean id="jaasAuthenticationProvider" class="org.springframework.security.authentication.jaas.JaasAuthenticationProvider"> <property name="loginConfig" value="/WEB-INF/login.conf"/> <property name="loginContextName" value="JAASTest"/> <property name="callbackHandlers"> <list> <bean class="org.springframework.security.authentication.jaas.JaasNameCallbackHandler"/> <bean class="org.springframework.security.authentication.jaas.JaasPasswordCallbackHandler"/> </list> </property> <property name="authorityGranters"> <list> <bean class="org.springframework.security.authentication.jaas.TestAuthorityGranter"/> </list> </property> </bean>

<h2 id="-21-5-running-as-a-subject"><a href=""></a>21.5 Running as a Subject</h2>
<p>If configured, the</p>
<p>JaasApiIntegrationFilter
will attempt to run as the</p>
<p>Subject
on the</p>
<p>JaasAuthenticationToken
. This means that the</p>
<p>Subject
can be accessed using:</p>
<p>Subject subject = Subject.getSubject(AccessController.getContext());</p>
<p>This integration can easily be configured using the <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/appendix-namespace.html#nsa-http-jaas-api-provision" title="jaas-api-provision" target="_blank">jaas-api-provision</a> attribute. This feature is useful when integrating with legacy or external API&#39;s that rely on the JAAS Subject being populated.
<a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/taglibs.html" target="_blank">Prev</a> <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/advanced-topics.html" target="_blank">Up</a> <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/cas.html" target="_blank">Next</a>20. JSP Tag Libraries <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/springsecurity.html" target="_blank">Home</a> 22. CAS Authentication    <img src="" alt=""></p>
<p><a href=""><img src="" alt=""></a></p>
<p><a href="http://www.springsource.com/?cid=70180000000wIe4AAE" target="_blank"><img src="" alt=""></a>
allSpringSourceGrailsHypericGemstoneRabbitMQ <img src="&quot;Search Documentation&quot;" alt=""></p>
<p><img src="&quot;click to toggle&quot;" alt="">
<a href="http://www.springsource.com/spring-framework-consulting" target="_blank"><img src="" alt=""></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span><span class="breadcrumb"><li><a href="/categories/CAS/">CAS</a></li><li><a href="/categories/CAS/spring-cas/">spring-cas</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a><a href="/tags/spring-cas/" class="label label-success">spring-cas</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS-spring-cas--21-JavaAuthenticationandAuthorizationService/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS-spring-cas--21-JavaAuthenticationandAuthorizationService" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS-spring-cas--22-CASAuthentication/">22. CAS Authentication</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS-spring-cas--22-CASAuthentication/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="22-cas-authentication">22. CAS Authentication</h1>
<p><img src="" alt=""> Saving Data...
正在保存数据...
正在儲存資料...</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span><span class="breadcrumb"><li><a href="/categories/CAS/">CAS</a></li><li><a href="/categories/CAS/spring-cas/">spring-cas</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a><a href="/tags/spring-cas/" class="label label-success">spring-cas</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS-spring-cas--22-CASAuthentication/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS-spring-cas--22-CASAuthentication" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/84/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/82/">82</a></li><li><a class="page-number" href="/page/83/">83</a></li><li><a class="page-number" href="/page/84/">84</a></li><li class="active"><li><span class="page-number current">85</span></li><li><a class="page-number" href="/page/86/">86</a></li><li><a class="page-number" href="/page/87/">87</a></li><li><a class="page-number" href="/page/88/">88</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/163/">163</a></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="extend next" href="/page/86/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-03-29 22:06:56</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
