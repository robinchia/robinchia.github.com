
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 116 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-hadoop--漫步云中网络/">漫步云中网络</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:36.000Z"> <a href="/2014/02/02/2014-02-02-hadoop--漫步云中网络/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">漫步云中网络</h1>
<p><a href="http://www.ibm.com/developerworks/cn/cloud/library/1209_zhanghua_openstacknetwork/#author1" target="_blank">张 华</a>, 高级软件工程师, IBM</p>
<p><a href="http://www.ibm.com/developerworks/cn/cloud/library/1209_zhanghua_openstacknetwork/#author2" target="_blank">龚 永生</a>, 资深软件工程师, IBM</p>
<p><strong>简介：</strong> 在生产环境中，云中的网络通常被划分为公共网络、管理网络和服务网络。本文首先通过三个小试验向您介绍了如何通过 TAP/TUN、NAT、Linux Bridge、VLAN 等技术实现云中网络的一般原理。有了这些基础，相信您会对接下来介绍的一个具体的 OpenStack 云的示例网络配置倍感亲切。同理，这些基础也将助您在其他云中网络中轻松漫步。
来源： <a href="[http://www.ibm.com/developerworks/cn/cloud/library/1209_zhanghua_openstacknetwork/](http://www.ibm.com/developerworks/cn/cloud/library/1209_zhanghua_openstacknetwork/)">[http://www.ibm.com/developerworks/cn/cloud/library/1209_zhanghua_openstacknetwork/](http://www.ibm.com/developerworks/cn/cloud/library/1209_zhanghua_openstacknetwork/)</a> </p>
<p>阅读本文前，最好能先了解以下的知识：</p>
<ul>
<li>了解 OpenStack 将有助于对本文的理解。本文讲解的是 Linux 虚拟网络中的一般原理方法 , 虽不仅限于应用在 OpenStack 之中 , 但本文的实验是以 OpenStack 为基础的。OpenStack 是一个开源的 IaaS 云 , 您可以从 devstack 脚本 (<a href="http://devstack.org/" target="_blank"><a href="http://devstack.org/">http://devstack.org/</a></a>) 开始熟悉它。</li>
<li>了解 QEMU 也将有助于对本文的理解。QEMU 是一种支持多种 CPU 的机器模拟器 , 本文采用 QEMU 来创建虚拟机验证本文中的试验。</li>
</ul>
<p><a href="">什么是云？</a></p>
<p>什么是云？我的理解是，为多租户提供各层次上的服务（如操作系统层、中间件层、应用软件层等）的可动态水平扩展的服务器集群称之为云。所以云具有大规模、高可扩展性、按需服务、自动化、节能环保、高可靠性等特点。下图１从软件堆栈视角勾画了云的架构：
<a href=""><strong>图 1. 云的架构</strong></a>
<img src="" alt="图 1. 云的架构"> </p>
<ul>
<li><strong>IaaS, Infrastructure as a Service，基础设施即服务：</strong>您可以简单理解为将可伸缩的操作系统（虚机或实机）实例作为基础设施服务卖给多租户，然后按需计算费用。当然，将操作系统作为基础设施服务只是 IaaS 中的一种，且是最主要的一种，我怕大家概念混淆所以就只重点提了这种。实际上，只要是基础设施提供服务了从概念上讲都应该叫 IaaS，比如说关系型数据库，如果是集群部署的话，它也是基础设施提供服务了，也应该叫 IaaS。这类产品如 IBM 的 Smart Cloud Entry，如开源的 OpenStack。</li>
<li><strong>PaaS, Platform as a Service, 平台即服务：</strong>您可以简单理解为将可伸缩的中间件资源作为平台服务卖给多租户，然后按需计算费用。举个例子，如果 SaaS 应用程序的并发瞬间加大的话，PaaS 可以自动实时地启动一个由 IaaS 提供的操作系统实例，然后自动在它上面部署中间件应用服务器（如 IBM 的 WebSphere），最后再部署一套该 SaaS 应用实例，并自动将它们纳入到负载均衡体系之中，从而实现平台服务的自动伸缩，这就是 PaaS。这类产品如 IBM 的 IWD，如 Google 的 App Engine。</li>
<li><strong>SaaS, Software as a Service, 软件即服务：</strong>您可以简单理解为可伸缩的分布式软件作为软件服务为用户提供某种在线服务，如视频服务，地图服务等。</li>
<li><strong>XaaS, X as a Server, 一切即服务：</strong>只要是给多租户按需提供服务都可以叫 XaaS, 像在 OpenStack 中，将网络部分代码单独抽出来组成 Quantum 工程，就可以叫网络即服务（NaaS, Network as a Service)；像使用 xCat 自动部署裸机可以叫裸机即服务（MaaS, Bare-metal as a Service)。</li>
</ul>
<p><a href="http://www.ibm.com/developerworks/cn/cloud/library/1209_zhanghua_openstacknetwork/#ibm-pcon" target="_blank">回页首</a></p>
<p><a href="">什么是云中网络？</a></p>
<p>在传统的数据中心中，每个网口对应唯一一个物理机；有了云，一台物理网卡可能会承载多个虚拟网卡。物理网卡与虚拟网卡之间的关系无外乎就是下列三种情况：</p>
<ol>
<li>一对一，一个物理网卡对应对一个虚拟网卡，是下面一对多情况的一种特例</li>
<li>一对多，一个物理网卡对应多个虚拟网卡，是本文要介绍的情况</li>
<li>多对一，多个物理网对应一个虚拟网卡，即我们常说的 Bonding，用作负载均衡
<a href=""><strong>图 2. 虚拟网络的主要内容</strong></a>
<img src="" alt="图 2. 虚拟网络的主要内容"> </li>
</ol>
<p>上图 2 显示了虚拟网络的主要内容：</p>
<ol>
<li>目前，对网络的虚拟化主要集中在第 2 层和第 3 层</li>
<li>在 Linux 中，第 2 层通常使用 TAP 设备来实现虚拟网卡，使用 Linux Bridge 来实现虚拟交换机</li>
<li>在 Linux 中，第 3 层通常是基于 Iptable 的 NAT，路由及转发</li>
<li>对于网络隔离，可以采用传统的基于 802.1Q 协议的 VLAN 技术，但这受限于 VLAN ID 大小范围的限制，并且需要手动地在各物理交换机上配置 VLAN；也可以采用虚拟交换机软件，如 Openvswitch，它可以自动创建 GRE 隧道来避免手动去为物理交换机配置 VLAN。</li>
</ol>
<p>下面将结合一个生产环境中的网络实例来讲解如何实现一个虚拟网络。</p>
<p><a href="http://www.ibm.com/developerworks/cn/cloud/library/1209_zhanghua_openstacknetwork/#ibm-pcon" target="_blank">回页首</a></p>
<p><a href="">云中网络实验</a></p>
<p>在生产环境中，按通用做法一般将云中网络划分为三大部分，公共网络、管理&amp;存储网络、服务网络。</p>
<p><strong>公共网络：</strong>用于云向外部租户提供 API 调用或者访问</p>
<p><strong>管理网络：</strong>用于云中各物理机之间的通信</p>
<p><strong>存储网络：</strong>用于 iSCSI 服务端与客户端之间的流量，一般与管理网络同</p>
<p><strong>服务网络：</strong>虚机内部使用的网络</p>
<p>为了将上述网络的实现原理讲清楚，我们选择了两台物理机做实验，并将采用 NAT、Linux Bridge、VLAN 技术分步实现一个典型的 OpenStack 云的网络拓扑。当然，这种网络的原理是通用的，并不仅限于 OpenStack 云。</p>
<ol>
<li>台式机 (node1)， 双有线网卡， 将作为控制节点、存储节点及一个计算节点</li>
<li>笔记本 (node2)，一有线网卡，将作为一个计算节点</li>
<li>路由器，家中 ADSL 宽带出口</li>
<li>交换机 , 用于连接各物理机</li>
</ol>
<p>值得一提的是，如果采用了 VLAN 技术进行网络隔离，且想要两台物理机上的虚机能够互访的话，交换机必须是支持 VLAN 的，且需要手动将交换机相应的端口配置成 Trunk 模式。因为我没有支持 VLAN 的物理交换机，在本实验中，我是采用直连线直接连接两台实验机器的。</p>
<p>下图 3 显示了实验网络拓扑：
<a href=""><strong>图 3. OpenStack 实验网络拓扑</strong></a>
<img src="" alt=""> </p>
<p><strong>公共网络：</strong>192.168.99.0/24 网段，外网用户通过公共网络上提供的服务来访问云。注意：在实际的生产环境中，公共网络一般采用外网 IP，因为我没有外网 IP，所以用 192.168.99.0 网段模拟。将台式机的一有线网卡 eth1 与 TP-Link 路由器相连即可。</p>
<p><strong>管理＆存储网络：</strong>172.16.99.0/24 网段，管理网络用于 OpenStack 各组件以及 DB、MQ 之间进行通信；存储网络用于存储节点和需要使用外部存储的计算节点之间的通信。将台式机的另一有线网卡 eth0 和笔记本电脑的有线网卡 eth0 连接到交换机即可。</p>
<p><strong>服务网络：</strong>10.0.0.0/8 网段，用于虚机内部。</p>
<p>两个节点的基本网络配置如下：
<a href=""><strong>清单 1. node1 的基本网络配置</strong></a></p>
<p>root@node1:/home/hua/# cat /etc/network/interfaces
auto lo</p>
<p>iface lo inet loopback
auto eth1</p>
<p>iface eth1 inet dhcp
up iptables -t nat -A POSTROUTING -s 172.16.99.0/24 -o eth1 -j MASQUERADE</p>
<p>auto eth0
iface eth0 inet static</p>
<p>address 172.16.99.108
netmask 255.255.255.0</p>
<p>network 172.16.99.0
broadcast 172.16.99.255</p>
<p><a href=""><strong>清单 2. node2 的基本网络配置</strong></a>
[</p>
<p>cat /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0</p>
<p>HWADDR=00:21:86:94:63:27
ONBOOT=yes</p>
<p>BOOTPROTO=static
USERCTL=yes</p>
<p>PEERDNS=yes
IPV6INIT=no</p>
<p>NM_CONTROLLED=yes
TYPE=Ethernet</p>
<p>NETMASK=255.255.255.0
IPADDR=172.16.99.109</p>
<p>NETWORK=172.16.99.0
GATEWAY=172.16.99.108</p>
<p>DNS1=202.106.195.68
DNS2=202.106.46.151</p>
<p>我虽然只用了两台物理机来模拟实际生产环境的部署模型， 但文中的这种部署结构是典型的，如果是大规模部署的话，只需要将控制节点上的每一个进程（如 DB、MQ、glance、keystone、nova-api、nova-schedule、nova-network 等）分布部署在每一台物理机即可。想要进一步的 HA 的话，可以：</p>
<ul>
<li>将 DB 配置成集群模式</li>
<li>将 MQ 配置成集群模式</li>
<li>采用 multi-host 模式，将 nova-network 同时安装在计算节点 (nova-compute) 上</li>
<li>将 nova-api、nova-schedule 这些无状态的服务也同时部署在计算节点上，再加上负载均衡器分发负载</li>
<li>采用多网卡做 Bonding
]()</li>
</ul>
<p><a href=""></a><a href="">NAT</a></p>
<p>node2 可以通过 NAT 方式访问外网，数据流向如下：</p>
<ol>
<li>node2 中需设置网关指向 node1 的 eth0，例： GATEWAY=172.16.99.108</li>
<li>在 node1 中打开 ipv4 转发功能，这样，node1 会相当于一台路由器，在 eth0 收到来自 node2 的数据之后，会将数据包转发到其他网卡 eth1， sysctl -w net.ipv4.ip_forward=1</li>
<li>在 node1 上设置 NAT 规则，这样，从 node2（172.16.99.0/24 网段）发出的数据包看来起就像从 node1 的 eth1 发出的一样： iptables -t nat -A POSTROUTING -s 172.16.99.0/24 -o eth1 -j MASQUERADE</li>
</ol>
<p><a href="">Linux Bridge</a></p>
<p>网桥 ( Bridge ) 工作在二层，了解链路层协议，按帧转发数据。就是交我们常说的交换机，所以连接到网桥的设备处于同一网段。
<a href=""><strong>图 4. 网桥示例</strong></a>
<img src="" alt="图 4. 网桥示例"> </p>
<p>上图 4 显示了 node1 网桥中的 VM1 与 node2 网桥中的 VM2 是如何通信的。在 openstack 中，这是典型的 multi-host 模式，即每一个计算节点均部署了网络服务来提供网关服务。Linux Bridge 充当了交换机的功能，而将 sysctl -w net.ipv4.ip_forward 设置为 1 也相当于 node1 同时充当了一个路由器（路由器的实质就是一个具有多个网卡的机器，因为它的多网卡同时具有这些不同网段的 IP 地址，所以它能将一个网络的流量路由转发到另一个网络）。</p>
<p>网桥，交换机，是用来连接两个 LAN 的。 是根据 MAC 与端口的映射进行转发的，而在虚机的网卡都是知道的，若从转发数据库知道目的 MAC 地址，以太网帧就只会正确的网桥端口传输，否则，就会扩散到网桥设备的所有端口。</p>
<p>因为网桥工作在第二层，所以 eth0.1, tap0, tap1 这些网卡均不需要设置 IP（因为对于上层路由器来说，它们是同一个子网，只需要将 IP 设置在 br1 上即可）。同时， 对 Linux 而言，网桥是虚拟设备，因此，除非将一个或多个真实设备绑定到网桥设备上，否则它就无法接收或传输任何东西。所以需要将一个真实设备（如 eth0）或者真实设备的 vlan 接口（如 eth0.1) 加入到网桥。对于前一种情况，将 eth0 加入到网桥之后，eth0 便不再具有 IP，这时候它与 tap0 这些虚拟网卡均通过 br1 处于 10.0.1.0/24 网络，当然我们也可以为网桥 br1 设置一个别名让它也具有 172.16.99.0/24 网管网段的 IP 地址。）</p>
<p>下面，我们来实现这个示例网桥，在 node1 与 node2 上分别执行下述脚本（对重要命令的描述请参见注释）：
<a href=""><strong>清单 3. node1 与 node2 的 Linux Bridge 配置脚本</strong></a></p>
<p>/#!/bin/sh
TAP=tap0</p>
<p>BRIDGE=br1
IFACE=eth0</p>
<p><strong>MANAGE_IP=172.16.99.108</strong></p>
<p>SERVICE_IP=10.0.1.1
GATEWAY=10.0.1.1</p>
<p>BROADCAST=10.0.1.255
/# 设置物理网卡为混杂模式</p>
<p>ifdown $IFACE
ifconfig $IFACE 0.0.0.0 promisc up</p>
<p>/# 创建网桥，并物理网卡加入网桥，同时设置网桥的 IP 为服务网络网段
brctl addbr $BRIDGE</p>
<p>brctl addif $BRIDGE $IFACE
brctl stp $BRIDGE on</p>
<p>ifconfig $BRIDGE $SERVICE_IP netmask 255.255.255.0 broadcast $BROADCAST
route add default gw $GATEWAY</p>
<p>/# 在网桥上设置多 IP，让它同时具有管理网段的 IP
ifconfig ${BRIDGE}:0 $MANAGE_IP netmask 255.255.255.0 broadcast 172.16.99.255</p>
<p>注意，上述黑体的一句在 node2 中需要作相应修改，其余不变，如下：
MANAGE_IP=172.16.99.109</p>
<p><a href="">VLAN</a></p>
<p>图 4 同样适用于 VLAN 网络，下面我们来实现它。在 node1 与 node2 上分别执行下述脚本：
<a href=""><strong>清单 4. node1 与 node2 的 VLAN 配置脚本</strong></a></p>
<p><strong>MAC=c8:3a:35:d7:86:da</strong></p>
<p>IP=10.0.1.1/24
ip link add link eth1 name eth1.1 type vlan id 1</p>
<p>ip link set eth1.1 up
brctl addbr br1</p>
<p>brctl setfd br1 0
brctl stp br1 on</p>
<p>ip link set br1 address $MAC
ip link set br1 up</p>
<p>brctl addif br1 eth1.1
ip addr add $IP dev br1</p>
<p>注意，上述黑体的一句在 node2 中需要作相应修改，其余不变，如下：
MAC= c8:3a:35:d7:86:db</p>
<p><a href="">测试</a></p>
<p>我们采用 QEMU 创建虚拟机来进行测试，其中网络部分的配置为：
  <interface type='bridge'></p>
<p>   <mac address='52:54:00:00:01:89'/>
 　　  <source bridge='br1'/></p>
<p> 　　  <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
  </interface></p>
<p>我们使用一个现成的镜像，下载地址：
curl <a href="http://wiki.qemu.org/download/linux-0.2.img.bz2" target="_blank">http://wiki.qemu.org/download/linux-0.2.img.bz2</a> -o /bak/kvmimages/linux-0.2.img</p>
<p>在 node1 与 node2 上分别用下列配置定义两个虚机，注意，下面打粗体的部分（<mac address='52:54:00:00:01:89'/>）在两个节点中请设置不一样的值。</p>
<p>cat /etc/libvirt/qemu/test.xml
<a href=""><strong>清单 5. node1 与 node2 的虚机定义文件</strong></a></p>
<domain type='qemu'>
 <strong><name>VM1</name></strong>

<uuid></uuid>
<memory>393216</memory>

<currentMemory>393216</currentMemory>
<vcpu>1</vcpu>

<os>
<type arch='i686' machine='pc-1.0'>hvm</type>

<boot dev='hd'/>
</os>

<features>
<acpi/>

</features>
<clock offset='utc'/>

<on_poweroff>destroy</on_poweroff>
<on_reboot>restart</on_reboot>

<on_crash>destroy</on_crash>
<devices>

<emulator>/usr/bin/qemu-system-i386</emulator>
<disk type='block' device='disk'>

<driver name='qemu' type='raw'/>
<source dev='/bak/kvmimages/linux-0.2.img'/>

<target dev='hda' bus='ide'/>
<address type='drive' controller='0' bus='0' unit='0'/>

</disk>
<controller type='ide' index='0'>

<address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/>
</controller>

<interface type='bridge'>
 <strong><mac address='52:54:00:00:01:89'/></strong>

<source bridge='br1'/>
<address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>

</interface>
<input type='tablet' bus='usb'/>

<input type='mouse' bus='ps2'/>
<graphics type='vnc' port='-1' autoport='yes' listen='127.0.0.1'>

<listen type='address' address='127.0.0.1'/>
</graphics>

<video>
<model type='cirrus' vram='9216' heads='1'/>

<address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>
</video>

<memballoon model='virtio'>
<address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>

</memballoon>
</devices>

</domain>

<p>然后用上述配置创建虚机（virsh define /etc/libvirt/qemu/test.xml ），接着启动虚机（ virsh start test ），最后设置虚机的 IP 和默认网关， 如下：</p>
<p><strong>VM1：</strong></p>
<p>ifconfig eth0 10.0.1.2 netmask 255.255.255.0 broadcast 10.0.1.255
route add default gw 10.0.1.1</p>
<p><strong>VM3：</strong>
ifconfig eth0 10.0.1.3 netmask 255.255.255.0 broadcast 10.0.1.255</p>
<p>route add default gw 10.0.1.1</p>
<p>这时候在一虚机上 ping 另一虚机 , 如果能够 ping 通，成功。若想要 ping 外网的话，还需在 /etc/resolv.conf 文件中添加域名，如下图 5 所示：
<a href=""><strong>图 5. 验证实验是否成功</strong></a>
<img src="" alt="图 5. 验证实验是否成功"> </p>
<p><a href="http://www.ibm.com/developerworks/cn/cloud/library/1209_zhanghua_openstacknetwork/#ibm-pcon" target="_blank">回页首</a></p>
<p><a href="">OpenStack 云中网络拓扑配置示例</a></p>
<p>在掌握了上述基本原理之后，应该不难理解下面 OpenStack 云中的网络拓扑。</p>
<p>在 OpenStack 中，目前存在着 nova-network 与 quantum 两种网络组件。nova-network 仅支持下列三种网络拓扑：</p>
<ul>
<li>FlatManager, 不支持 VLAN，也不支持 DHCP 的扁平网络</li>
<li>FlatDHCPManager，不支持 VLAN，但支持 DHCP 的扁平网络</li>
<li>VlanManager，支持 VLAN，也支持 DHCP 的 VLAN 隔离网络</li>
</ul>
<p>如今 nova-network 的代码已经全部挪到了 Quantum 工程中，但在网络拓扑方面，二者的原理是一致的，所以下面只给出一个典型的 nova-network 的网络配置，有了上面的基础，现在看这段配置是否会感到很亲切呢？
<a href=""><strong>清单 6. /etc/nova/nova.conf 中的网络配置示例</strong></a></p>
<p>/#/#/#/#/# nova-network /#/#/#/#/#
network_manager=nova.network.manager.VlanManager</p>
<p>public_interface=eth1
vlan_interface=eth0</p>
<p>network_host=node1
fixed_range=10.0.0.0/8</p>
<p>network_size=1024
dhcpbridge_flagfile=/etc/nova/nova.conf</p>
<p>dhcpbridge=/usr/bin/nova-dhcpbridge
force_dhcp_release=True</p>
<p>fixed_ip_disassociate_timeout=30
my_ip=172.16.99.108</p>
<p>routing_source_ip=192.168.99.108</p>
<p>相关参数说明如下：</p>
<ul>
<li>network_manager，目前支持 VlanManager、FlatManager、FlatDHCPManager 三种拓扑</li>
<li>public_interface, 接外网的物理网卡 , floating ip 功能需要用到它</li>
<li>valn_interface, 用于划分 VLAN 的物理网卡</li>
<li>fixed_range, 服务网络，即虚机内部所用的网络地址</li>
<li>my_ip，管理网络，用于安装 Openstack 组件的物理机之间的通信。例如：本实验中的控制节点同时具有外网网络地址 192.168.99.108 与管理网络地址 172.16.99.108，另一计算节点的管理网络地址为 172.16.99.109，所以 my_ip 应该设置为 172.16.99.108</li>
<li>routing_source_ip, NAT 映射后的公共网络 IP，设置了此参数，会自动执行 NAT 命令： iptables -t nat -A POSTROUTING -s 172.16.99.0/24 -o eth1 -j SNAT --to 192.168.99.108</li>
</ul>
<p>显然，如果没有区分公共网络与管理网络，即它们处于同一网段的话，并不需要配置 my_ip 及 routing_source_ip 两个参数。</p>
<p><a href="http://www.ibm.com/developerworks/cn/cloud/library/1209_zhanghua_openstacknetwork/#ibm-pcon" target="_blank">回页首</a></p>
<p><a href="">结论</a></p>
<p>云中网络一般被划分为公共网络、管理网络 &amp; 存储网络与服务网络三大类。虚拟网络拓扑一般有 NAT、Bridge、VLAN 三种情形。我们手工一步一步地通过 NAT、Bridge、VLAN 三个试验简单实现了一个上述典型的云中网络。原理都是相通的，您再看 OpenStack 云中网络或才其他云的网络时都会倍感亲切。</p>
<p><a href="">参考资料</a></p>
<p><strong>学习</strong></p>
<ul>
<li>参考 <a href="http://devstack.org/" target="_blank">Devstack 官网</a>，您可以从 devstack 脚本快速上手 Openstack。 </li>
<li>参考 <a href="http://docs.openstack.org/" target="_blank">Openstack 官网</a>，您可以获得更多关于 Openstack 的知识。 </li>
<li>参考 <a href="http://wiki.openstack.org/Quantum-Linux-Bridge-Plugin/" target="_blank">Quantum Wiki</a>, 您可以获得关于 Linux Bridge 网络的一般原理。 </li>
<li>“<a href="http://www.ibm.com/developerworks/cn/cloud/library/cl-openstack-cloud/" target="_blank">使用 OpenStack 实现云计算和存储</a>”（developerWorks，2012 年 9 月）：Infrastructure as a Service (IaaS) 云平台种类繁多，例如像 Nebula 和 Eucalyptus 这样为人熟知的解决方案。而此领域的一个新来者已展示了其不俗的增长，不仅包括用户数量的增长，还包括支持公司的数量的大量增长。在本文中，我们将了解这个开源平台 OpenStack，发现它是否真的是一种开源云操作系统。</li>
<li><p><a href="https://www.ibm.com/developerworks/cn/cloud/index.html" target="_blank">developerWorks 云计算站点</a> 提供了有关云计算的更新资源，包括</p>
</li>
<li><p>云计算 <a href="http://www.ibm.com/developerworks/cn/cloud/newto.html" target="_blank">简介</a>。</p>
</li>
<li>更新的 <a href="http://www.ibm.com/developerworks/cn/cloud/resources.html" target="_blank">技术文章和教程，以及网络广播</a>，让您的开发变得轻松，<a href="http://www.ibm.com/developerworks/cn/cloud/events.html" target="_blank">专家研讨会和录制会议</a> 帮助您成为高效的云开发人员。</li>
<li>连接转为云计算设计的 <a href="http://www.ibm.com/developerworks/cn/cloud/products.html" target="_blank">IBM 产品下载和信息</a>。</li>
<li>关于 <a href="http://www.ibm.com/developerworks/cn/cloud/collaborate.html" target="_blank">社区最新话题</a> 的活动聚合。</li>
<li>加入<a href="https://www.ibm.com/developerworks/mydeveloperworks/groups/service/html/communityview?communityUuid=e69e9c57-3210-49b0-a603-ca597c736557" target="_blank">云计算讨论组</a>，了解和讨论云计算的最新技术、解决方案、趋势等内容。 </li>
</ul>
<p><strong>讨论</strong></p>
<ul>
<li>加入 <a href="http://www.ibm.com/developerworks/cn/community/" target="_blank">developerWorks 中文社区</a>。查看开发人员推动的博客、论坛、组和维基，并与其他 developerWorks 用户交流。</li>
</ul>
<p><a href="">作者简介</a>
<a href=""></a>张华，IBM 高级软件工程师热衷于技术钻研，拥有丰富的搜索引擎、应用服务器、互联网、云计算领域的行业经验，精通 Java、JavaEE、Linux、Network 等技术，目前正从事 OpenStack 相关的工作。</p>
<p><a href=""></a>龚永生，IBM 资深软件工程师，热衷于开源软件，具有多年的 Linux，Java 和 JavaEE 经验。目前是 OpenStack 项目的积极贡献者。</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/hadoop/">hadoop</a></li></span></span> | <span class="tags">Tagged <a href="/tags/hadoop/" class="label label-primary">hadoop</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:36"datetime="2014-03-07 09:54:36"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-hadoop--漫步云中网络/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-hadoop--漫步云中网络" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-hadoop--mapreduce-osdi04/">mapreduce</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:36.000Z"> <a href="/2014/02/02/2014-02-02-hadoop--mapreduce-osdi04/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="mapreduce-osdi04">mapreduce-osdi04</h1>
<p>MapReduce: Simpliﬁed Data Processing on Large Clusters
Jeffrey Dean and Sanjay Ghemawat
jeff@google.com, sanjay@google.com
Google, Inc.
Abstract
MapReduce is a programming model and an associated implementation for processing and generating large data sets. Users specify a map function that processes a key/value pair to generate a set of intermediate key/value pairs, and a reduce function that merges all intermediate values associated with the same intermediate key. Many real world tasks are expressible in this model, as shown in the paper. Programs written in this functional style are automatically parallelized and executed on a large cluster of commodity machines. The run-time system takes care of the details of partitioning the input data, scheduling the program’s execution across a set of machines, handling machine failures, and managing the required inter-machine communication. This allows programmers without any experience with parallel and distributed systems to easily utilize the resources of a large distributed system. Our implementation of MapReduce runs on a large cluster of commodity machines and is highly scalable: a typical MapReduce computation processes many terabytes of data on thousands of machines. Programmers ﬁnd the system easy to use: hundreds of MapReduce programs have been implemented and upwards of one thousand MapReduce jobs are executed on Google’s clusters every day.
1 Introduction
Over the past ﬁve years, the authors and many others at Google have implemented hundreds of special-purpose computations that process large amounts of raw data, such as crawled documents, web request logs, etc., to compute various kinds of derived data, such as inverted indices, various representations of the graph structure of web documents, summaries of the number of pages crawled per host, the set of most frequent queries in a To appear in OSDI 2004
given day, etc. Most such computations are conceptually straightforward. However, the input data is usually large and the computations have to be distributed across hundreds or thousands of machines in order to ﬁnish in a reasonable amount of time. The issues of how to parallelize the computation, distribute the data, and handle failures conspire to obscure the original simple computation with large amounts of complex code to deal with these issues. As a reaction to this complexity, we designed a new abstraction that allows us to express the simple computations we were trying to perform but hides the messy details of parallelization, fault-tolerance, data distribution and load balancing in a library. Our abstraction is inspired by the map and reduce primitives present in Lisp and many other functional languages. We realized that most of our computations involved applying a map operation to each logical “record” in our input in order to compute a set of intermediate key/value pairs, and then applying a reduce operation to all the values that shared the same key, in order to combine the derived data appropriately. Our use of a functional model with userspeciﬁed map and reduce operations allows us to parallelize large computations easily and to use re-execution as the primary mechanism for fault tolerance. The major contributions of this work are a simple and powerful interface that enables automatic parallelization and distribution of large-scale computations, combined with an implementation of this interface that achieves high performance on large clusters of commodity PCs. Section 2 describes the basic programming model and gives several examples. Section 3 describes an implementation of the MapReduce interface tailored towards our cluster-based computing environment. Section 4 describes several reﬁnements of the programming model that we have found useful. Section 5 has performance measurements of our implementation for a variety of tasks. Section 6 explores the use of MapReduce within Google including our experiences in using it as the basis 1
for a rewrite of our production indexing system. Section 7 discusses related and future work.
2.2 Types
Even though the previous pseudo-code is written in terms of string inputs and outputs, conceptually the map and reduce functions supplied by the user have associated types: map reduce (k1,v1) (k2,list(v2)) → list(k2,v2) → list(v2)
2 Programming Model
The computation takes a set of input key/value pairs, and produces a set of output key/value pairs. The user of the MapReduce library expresses the computation as two functions: Map and Reduce. Map, written by the user, takes an input pair and produces a set of intermediate key/value pairs. The MapReduce library groups together all intermediate values associated with the same intermediate key I and passes them to the Reduce function. The Reduce function, also written by the user, accepts an intermediate key I and a set of values for that key. It merges together these values to form a possibly smaller set of values. Typically just zero or one output value is produced per Reduce invocation. The intermediate values are supplied to the user’s reduce function via an iterator. This allows us to handle lists of values that are too large to ﬁt in memory.
I.e., the input keys and values are drawn from a different domain than the output keys and values. Furthermore, the intermediate keys and values are from the same domain as the output keys and values. Our C++ implementation passes strings to and from the user-deﬁned functions and leaves it to the user code to convert between strings and appropriate types.
2.3 More Examples
Here are a few simple examples of interesting programs that can be easily expressed as MapReduce computations. Distributed Grep: The map function emits a line if it matches a supplied pattern. The reduce function is an identity function that just copies the supplied intermediate data to the output. Count of URL Access Frequency: The map function processes logs of web page requests and outputs URL, 1 . The reduce function adds together all values for the same URL and emits a URL, total count pair. Reverse Web-Link Graph: The map function outputs target, source pairs for each link to a target URL found in a page named source. The reduce function concatenates the list of all source URLs associated with a given target URL and emits the pair: target, list(source) Term-Vector per Host: A term vector summarizes the most important words that occur in a document or a set of documents as a list of word, f requency pairs. The map function emits a hostname, term vector pair for each input document (where the hostname is extracted from the URL of the document). The reduce function is passed all per-document term vectors for a given host. It adds these term vectors together, throwing away infrequent terms, and then emits a ﬁnal hostname, term vector pair. 2
2.1 Example
Consider the problem of counting the number of occurrences of each word in a large collection of documents. The user would write code similar to the following pseudo-code:
map(String key, String value): // key: document name // value: document contents for each word w in value: EmitIntermediate(w, &quot;1&quot;); reduce(String key, Iterator values): // key: a word // values: a list of counts int result = 0; for each v in values: result += ParseInt(v); Emit(AsString(result));
The map function emits each word plus an associated count of occurrences (just ‘1’ in this simple example). The reduce function sums together all counts emitted for a particular word. In addition, the user writes code to ﬁll in a mapreduce speciﬁcation object with the names of the input and output ﬁles, and optional tuning parameters. The user then invokes the MapReduce function, passing it the speciﬁcation object. The user’s code is linked together with the MapReduce library (implemented in C++). Appendix A contains the full program text for this example. To appear in OSDI 2004
User Program
(1) fork (1) fork (1) fork
Master
(2) assign map
(2) assign reduce
worker split 0 split 1 split 2 split 3 split 4 worker Input files Map phase Intermediate files (on local disks) Reduce phase Output files
(3) read (5) remote read
worker worker
(6) write
output file 0 output file 1
worker
(4) local write
Figure 1: Execution overview Inverted Index: The map function parses each document, and emits a sequence of word, document ID pairs. The reduce function accepts all pairs for a given word, sorts the corresponding document IDs and emits a word, list(document ID) pair. The set of all output pairs forms a simple inverted index. It is easy to augment this computation to keep track of word positions. Distributed Sort: The map function extracts the key from each record, and emits a key, record pair. The reduce function emits all pairs unchanged. This computation depends on the partitioning facilities described in Section 4.1 and the ordering properties described in Section 4.2. large clusters of commodity PCs connected together with switched Ethernet [4]. In our environment: (1) Machines are typically dual-processor x86 processors running Linux, with 2-4 GB of memory per machine. (2) Commodity networking hardware is used – typically either 100 megabits/second or 1 gigabit/second at the machine level, but averaging considerably less in overall bisection bandwidth. (3) A cluster consists of hundreds or thousands of machines, and therefore machine failures are common. (4) Storage is provided by inexpensive IDE disks attached directly to individual machines. A distributed ﬁle system [8] developed in-house is used to manage the data stored on these disks. The ﬁle system uses replication to provide availability and reliability on top of unreliable hardware. (5) Users submit jobs to a scheduling system. Each job consists of a set of tasks, and is mapped by the scheduler to a set of available machines within a cluster.
3 Implementation
Many different implementations of the MapReduce interface are possible. The right choice depends on the environment. For example, one implementation may be suitable for a small shared-memory machine, another for a large NUMA multi-processor, and yet another for an even larger collection of networked machines. This section describes an implementation targeted to the computing environment in wide use at Google: To appear in OSDI 2004
3.1 Execution Overview
The Map invocations are distributed across multiple machines by automatically partitioning the input data 3
into a set of M splits. The input splits can be processed in parallel by different machines. Reduce invocations are distributed by partitioning the intermediate key space into R pieces using a partitioning function (e.g., hash(key) mod R). The number of partitions (R) and the partitioning function are speciﬁed by the user. Figure 1 shows the overall ﬂow of a MapReduce operation in our implementation. When the user program calls the MapReduce function, the following sequence of actions occurs (the numbered labels in Figure 1 correspond to the numbers in the list below): 1. The MapReduce library in the user program ﬁrst splits the input ﬁles into M pieces of typically 16 megabytes to 64 megabytes (MB) per piece (controllable by the user via an optional parameter). It then starts up many copies of the program on a cluster of machines. 2. One of the copies of the program is special – the master. The rest are workers that are assigned work by the master. There are M map tasks and R reduce tasks to assign. The master picks idle workers and assigns each one a map task or a reduce task. 3. A worker who is assigned a map task reads the contents of the corresponding input split. It parses key/value pairs out of the input data and passes each pair to the user-deﬁned Map function. The intermediate key/value pairs produced by the Map function are buffered in memory. 4. Periodically, the buffered pairs are written to local disk, partitioned into R regions by the partitioning function. The locations of these buffered pairs on the local disk are passed back to the master, who is responsible for forwarding these locations to the reduce workers. 5. When a reduce worker is notiﬁed by the master about these locations, it uses remote procedure calls to read the buffered data from the local disks of the map workers. When a reduce worker has read all intermediate data, it sorts it by the intermediate keys so that all occurrences of the same key are grouped together. The sorting is needed because typically many different keys map to the same reduce task. If the amount of intermediate data is too large to ﬁt in memory, an external sort is used. 6. The reduce worker iterates over the sorted intermediate data and for each unique intermediate key encountered, it passes the key and the corresponding set of intermediate values to the user’s Reduce function. The output of the Reduce function is appended to a ﬁnal output ﬁle for this reduce partition. To appear in OSDI 2004</p>
<ol>
<li>When all map tasks and reduce tasks have been completed, the master wakes up the user program. At this point, the MapReduce call in the user program returns back to the user code. After successful completion, the output of the mapreduce execution is available in the R output ﬁles (one per reduce task, with ﬁle names as speciﬁed by the user). Typically, users do not need to combine these R output ﬁles into one ﬁle – they often pass these ﬁles as input to another MapReduce call, or use them from another distributed application that is able to deal with input that is partitioned into multiple ﬁles.
3.2 Master Data Structures
The master keeps several data structures. For each map task and reduce task, it stores the state (idle, in-progress, or completed), and the identity of the worker machine (for non-idle tasks). The master is the conduit through which the location of intermediate ﬁle regions is propagated from map tasks to reduce tasks. Therefore, for each completed map task, the master stores the locations and sizes of the R intermediate ﬁle regions produced by the map task. Updates to this location and size information are received as map tasks are completed. The information is pushed incrementally to workers that have in-progress reduce tasks.
3.3 Fault Tolerance
Since the MapReduce library is designed to help process very large amounts of data using hundreds or thousands of machines, the library must tolerate machine failures gracefully. Worker Failure The master pings every worker periodically. If no response is received from a worker in a certain amount of time, the master marks the worker as failed. Any map tasks completed by the worker are reset back to their initial idle state, and therefore become eligible for scheduling on other workers. Similarly, any map task or reduce task in progress on a failed worker is also reset to idle and becomes eligible for rescheduling. Completed map tasks are re-executed on a failure because their output is stored on the local disk(s) of the failed machine and is therefore inaccessible. Completed reduce tasks do not need to be re-executed since their output is stored in a global ﬁle system. When a map task is executed ﬁrst by worker A and then later executed by worker B (because A failed), all 4
workers executing reduce tasks are notiﬁed of the reexecution. Any reduce task that has not already read the data from worker A will read the data from worker B. MapReduce is resilient to large-scale worker failures. For example, during one MapReduce operation, network maintenance on a running cluster was causing groups of 80 machines at a time to become unreachable for several minutes. The MapReduce master simply re-executed the work done by the unreachable worker machines, and continued to make forward progress, eventually completing the MapReduce operation. Master Failure It is easy to make the master write periodic checkpoints of the master data structures described above. If the master task dies, a new copy can be started from the last checkpointed state. However, given that there is only a single master, its failure is unlikely; therefore our current implementation aborts the MapReduce computation if the master fails. Clients can check for this condition and retry the MapReduce operation if they desire. Semantics in the Presence of Failures When the user-supplied map and reduce operators are deterministic functions of their input values, our distributed implementation produces the same output as would have been produced by a non-faulting sequential execution of the entire program. We rely on atomic commits of map and reduce task outputs to achieve this property. Each in-progress task writes its output to private temporary ﬁles. A reduce task produces one such ﬁle, and a map task produces R such ﬁles (one per reduce task). When a map task completes, the worker sends a message to the master and includes the names of the R temporary ﬁles in the message. If the master receives a completion message for an already completed map task, it ignores the message. Otherwise, it records the names of R ﬁles in a master data structure. When a reduce task completes, the reduce worker atomically renames its temporary output ﬁle to the ﬁnal output ﬁle. If the same reduce task is executed on multiple machines, multiple rename calls will be executed for the same ﬁnal output ﬁle. We rely on the atomic rename operation provided by the underlying ﬁle system to guarantee that the ﬁnal ﬁle system state contains just the data produced by one execution of the reduce task. The vast majority of our map and reduce operators are deterministic, and the fact that our semantics are equivalent to a sequential execution in this case makes it very To appear in OSDI 2004
easy for programmers to reason about their program’s behavior. When the map and/or reduce operators are nondeterministic, we provide weaker but still reasonable semantics. In the presence of non-deterministic operators, the output of a particular reduce task R1 is equivalent to the output for R1 produced by a sequential execution of the non-deterministic program. However, the output for a different reduce task R2 may correspond to the output for R2 produced by a different sequential execution of the non-deterministic program. Consider map task M and reduce tasks R1 and R2 . Let e(Ri ) be the execution of Ri that committed (there is exactly one such execution). The weaker semantics arise because e(R1 ) may have read the output produced by one execution of M and e(R2 ) may have read the output produced by a different execution of M .
3.4 Locality
Network bandwidth is a relatively scarce resource in our computing environment. We conserve network bandwidth by taking advantage of the fact that the input data (managed by GFS [8]) is stored on the local disks of the machines that make up our cluster. GFS divides each ﬁle into 64 MB blocks, and stores several copies of each block (typically 3 copies) on different machines. The MapReduce master takes the location information of the input ﬁles into account and attempts to schedule a map task on a machine that contains a replica of the corresponding input data. Failing that, it attempts to schedule a map task near a replica of that task’s input data (e.g., on a worker machine that is on the same network switch as the machine containing the data). When running large MapReduce operations on a signiﬁcant fraction of the workers in a cluster, most input data is read locally and consumes no network bandwidth.
3.5 Task Granularity
We subdivide the map phase into M pieces and the reduce phase into R pieces, as described above. Ideally, M and R should be much larger than the number of worker machines. Having each worker perform many different tasks improves dynamic load balancing, and also speeds up recovery when a worker fails: the many map tasks it has completed can be spread out across all the other worker machines. There are practical bounds on how large M and R can be in our implementation, since the master must make O(M + R) scheduling decisions and keeps O(M ∗ R) state in memory as described above. (The constant factors for memory usage are small however: the O(M ∗ R) piece of the state consists of approximately one byte of data per map task/reduce task pair.) 5
Furthermore, R is often constrained by users because the output of each reduce task ends up in a separate output ﬁle. In practice, we tend to choose M so that each individual task is roughly 16 MB to 64 MB of input data (so that the locality optimization described above is most effective), and we make R a small multiple of the number of worker machines we expect to use. We often perform MapReduce computations with M = 200, 000 and R = 5, 000, using 2,000 worker machines.
3.6 Backup Tasks
One of the common causes that lengthens the total time taken for a MapReduce operation is a “straggler”: a machine that takes an unusually long time to complete one of the last few map or reduce tasks in the computation. Stragglers can arise for a whole host of reasons. For example, a machine with a bad disk may experience frequent correctable errors that slow its read performance from 30 MB/s to 1 MB/s. The cluster scheduling system may have scheduled other tasks on the machine, causing it to execute the MapReduce code more slowly due to competition for CPU, memory, local disk, or network bandwidth. A recent problem we experienced was a bug in machine initialization code that caused processor caches to be disabled: computations on affected machines slowed down by over a factor of one hundred. We have a general mechanism to alleviate the problem of stragglers. When a MapReduce operation is close to completion, the master schedules backup executions of the remaining in-progress tasks. The task is marked as completed whenever either the primary or the backup execution completes. We have tuned this mechanism so that it typically increases the computational resources used by the operation by no more than a few percent. We have found that this signiﬁcantly reduces the time to complete large MapReduce operations. As an example, the sort program described in Section 5.3 takes 44% longer to complete when the backup task mechanism is disabled.
the intermediate key. A default partitioning function is provided that uses hashing (e.g. “hash(key) mod R”). This tends to result in fairly well-balanced partitions. In some cases, however, it is useful to partition data by some other function of the key. For example, sometimes the output keys are URLs, and we want all entries for a single host to end up in the same output ﬁle. To support situations like this, the user of the MapReduce library can provide a special partitioning function. For example, using “hash(Hostname(urlkey)) mod R” as the partitioning function causes all URLs from the same host to end up in the same output ﬁle.
4.2 Ordering Guarantees
We guarantee that within a given partition, the intermediate key/value pairs are processed in increasing key order. This ordering guarantee makes it easy to generate a sorted output ﬁle per partition, which is useful when the output ﬁle format needs to support efﬁcient random access lookups by key, or users of the output ﬁnd it convenient to have the data sorted.
4.3 Combiner Function
In some cases, there is signiﬁcant repetition in the intermediate keys produced by each map task, and the userspeciﬁed Reduce function is commutative and associative. A good example of this is the word counting example in Section 2.1. Since word frequencies tend to follow a Zipf distribution, each map task will produce hundreds or thousands of records of the form <the, 1>. All of these counts will be sent over the network to a single reduce task and then added together by the Reduce function to produce one number. We allow the user to specify an optional Combiner function that does partial merging of this data before it is sent over the network. The Combiner function is executed on each machine that performs a map task. Typically the same code is used to implement both the combiner and the reduce functions. The only difference between a reduce function and a combiner function is how the MapReduce library handles the output of the function. The output of a reduce function is written to the ﬁnal output ﬁle. The output of a combiner function is written to an intermediate ﬁle that will be sent to a reduce task. Partial combining signiﬁcantly speeds up certain classes of MapReduce operations. Appendix A contains an example that uses a combiner.
4 Reﬁnements
Although the basic functionality provided by simply writing Map and Reduce functions is sufﬁcient for most needs, we have found a few extensions useful. These are described in this section.
4.1 Partitioning Function
The users of MapReduce specify the number of reduce tasks/output ﬁles that they desire (R). Data gets partitioned across these tasks using a partitioning function on To appear in OSDI 2004
4.4 Input and Output Types
The MapReduce library provides support for reading input data in several different formats. For example, “text” 6
mode input treats each line as a key/value pair: the key is the offset in the ﬁle and the value is the contents of the line. Another common supported format stores a sequence of key/value pairs sorted by key. Each input type implementation knows how to split itself into meaningful ranges for processing as separate map tasks (e.g. text mode’s range splitting ensures that range splits occur only at line boundaries). Users can add support for a new input type by providing an implementation of a simple reader interface, though most users just use one of a small number of predeﬁned input types. A reader does not necessarily need to provide data read from a ﬁle. For example, it is easy to deﬁne a reader that reads records from a database, or from data structures mapped in memory. In a similar fashion, we support a set of output types for producing data in different formats and it is easy for user code to add support for new output types.
the signal handler sends a “last gasp” UDP packet that contains the sequence number to the MapReduce master. When the master has seen more than one failure on a particular record, it indicates that the record should be skipped when it issues the next re-execution of the corresponding Map or Reduce task.
4.7 Local Execution
Debugging problems in Map or Reduce functions can be tricky, since the actual computation happens in a distributed system, often on several thousand machines, with work assignment decisions made dynamically by the master. To help facilitate debugging, proﬁling, and small-scale testing, we have developed an alternative implementation of the MapReduce library that sequentially executes all of the work for a MapReduce operation on the local machine. Controls are provided to the user so that the computation can be limited to particular map tasks. Users invoke their program with a special ﬂag and can then easily use any debugging or testing tools they ﬁnd useful (e.g. gdb).
4.5 Side-effects
In some cases, users of MapReduce have found it convenient to produce auxiliary ﬁles as additional outputs from their map and/or reduce operators. We rely on the application writer to make such side-effects atomic and idempotent. Typically the application writes to a temporary ﬁle and atomically renames this ﬁle once it has been fully generated. We do not provide support for atomic two-phase commits of multiple output ﬁles produced by a single task. Therefore, tasks that produce multiple output ﬁles with cross-ﬁle consistency requirements should be deterministic. This restriction has never been an issue in practice.
4.8 Status Information
The master runs an internal HTTP server and exports a set of status pages for human consumption. The status pages show the progress of the computation, such as how many tasks have been completed, how many are in progress, bytes of input, bytes of intermediate data, bytes of output, processing rates, etc. The pages also contain links to the standard error and standard output ﬁles generated by each task. The user can use this data to predict how long the computation will take, and whether or not more resources should be added to the computation. These pages can also be used to ﬁgure out when the computation is much slower than expected. In addition, the top-level status page shows which workers have failed, and which map and reduce tasks they were processing when they failed. This information is useful when attempting to diagnose bugs in the user code.
4.6 Skipping Bad Records
Sometimes there are bugs in user code that cause the Map or Reduce functions to crash deterministically on certain records. Such bugs prevent a MapReduce operation from completing. The usual course of action is to ﬁx the bug, but sometimes this is not feasible; perhaps the bug is in a third-party library for which source code is unavailable. Also, sometimes it is acceptable to ignore a few records, for example when doing statistical analysis on a large data set. We provide an optional mode of execution where the MapReduce library detects which records cause deterministic crashes and skips these records in order to make forward progress. Each worker process installs a signal handler that catches segmentation violations and bus errors. Before invoking a user Map or Reduce operation, the MapReduce library stores the sequence number of the argument in a global variable. If the user code generates a signal, To appear in OSDI 2004
4.9 Counters
The MapReduce library provides a counter facility to count occurrences of various events. For example, user code may want to count total number of words processed or the number of German documents indexed, etc. To use this facility, user code creates a named counter object and then increments the counter appropriately in the Map and/or Reduce function. For example: 7
Input (MB/s)
Counter/<em> uppercase; uppercase = GetCounter(&quot;uppercase&quot;); map(String name, String contents): for each word w in contents: if (IsCapitalized(w)): uppercase-&gt;Increment(); EmitIntermediate(w, &quot;1&quot;);
30000 20000 10000 0 20 40 60 80 100
The counter values from individual worker machines are periodically propagated to the master (piggybacked on the ping response). The master aggregates the counter values from successful map and reduce tasks and returns them to the user code when the MapReduce operation is completed. The current counter values are also displayed on the master status page so that a human can watch the progress of the live computation. When aggregating counter values, the master eliminates the effects of duplicate executions of the same map or reduce task to avoid double counting. (Duplicate executions can arise from our use of backup tasks and from re-execution of tasks due to failures.) Some counter values are automatically maintained by the MapReduce library, such as the number of input key/value pairs processed and the number of output key/value pairs produced. Users have found the counter facility useful for sanity checking the behavior of MapReduce operations. For example, in some MapReduce operations, the user code may want to ensure that the number of output pairs produced exactly equals the number of input pairs processed, or that the fraction of German documents processed is within some tolerable fraction of the total number of documents processed.
Seconds
Figure 2: Data transfer rate over time disks, and a gigabit Ethernet link. The machines were arranged in a two-level tree-shaped switched network with approximately 100-200 Gbps of aggregate bandwidth available at the root. All of the machines were in the same hosting facility and therefore the round-trip time between any pair of machines was less than a millisecond. Out of the 4GB of memory, approximately 1-1.5GB was reserved by other tasks running on the cluster. The programs were executed on a weekend afternoon, when the CPUs, disks, and network were mostly idle.
5.2 Grep
The grep program scans through 1010 100-byte records, searching for a relatively rare three-character pattern (the pattern occurs in 92,337 records). The input is split into approximately 64MB pieces (M = 15000), and the entire output is placed in one ﬁle (R = 1). Figure 2 shows the progress of the computation over time. The Y-axis shows the rate at which the input data is scanned. The rate gradually picks up as more machines are assigned to this MapReduce computation, and peaks at over 30 GB/s when 1764 workers have been assigned. As the map tasks ﬁnish, the rate starts dropping and hits zero about 80 seconds into the computation. The entire computation takes approximately 150 seconds from start to ﬁnish. This includes about a minute of startup overhead. The overhead is due to the propagation of the program to all worker machines, and delays interacting with GFS to open the set of 1000 input ﬁles and to get the information needed for the locality optimization.
5 Performance
In this section we measure the performance of MapReduce on two computations running on a large cluster of machines. One computation searches through approximately one terabyte of data looking for a particular pattern. The other computation sorts approximately one terabyte of data. These two programs are representative of a large subset of the real programs written by users of MapReduce – one class of programs shufﬂes data from one representation to another, and another class extracts a small amount of interesting data from a large data set.
5.3 Sort
The sort program sorts 1010 100-byte records (approximately 1 terabyte of data). This program is modeled after the TeraSort benchmark [10]. The sorting program consists of less than 50 lines of user code. A three-line Map function extracts a 10-byte sorting key from a text line and emits the key and the 8
5.1 Cluster Conﬁguration
All of the programs were executed on a cluster that consisted of approximately 1800 machines. Each machine had two 2GHz Intel Xeon processors with HyperThreading enabled, 4GB of memory, two 160GB IDE To appear in OSDI 2004
20000
Input (MB/s)
Input (MB/s)
15000 10000 5000 0 500 1000
Input (MB/s)
Done
20000 15000 10000 5000 0 500 1000
20000
Done
Done
15000 10000 5000 0 500 1000
Shuffle (MB/s)
15000 10000 5000 0 500 1000
Shuffle (MB/s)
500 1000
20000
Shuffle (MB/s)
20000 15000 10000 5000 0
20000 15000 10000 5000 0 500 1000
Output (MB/s)
Output (MB/s)
15000 10000 5000 0 500 1000
15000 10000 5000 0 500 1000
Output (MB/s)
20000
20000
20000 15000 10000 5000 0 500 1000
Seconds
Seconds
Seconds
(a) Normal execution
(b) No backup tasks
(c) 200 tasks killed
Figure 3: Data transfer rates over time for different executions of the sort program original text line as the intermediate key/value pair. We used a built-in Identity function as the Reduce operator. This functions passes the intermediate key/value pair unchanged as the output key/value pair. The ﬁnal sorted output is written to a set of 2-way replicated GFS ﬁles (i.e., 2 terabytes are written as the output of the program). As before, the input data is split into 64MB pieces (M = 15000). We partition the sorted output into 4000 ﬁles (R = 4000). The partitioning function uses the initial bytes of the key to segregate it into one of R pieces. Our partitioning function for this benchmark has builtin knowledge of the distribution of keys. In a general sorting program, we would add a pre-pass MapReduce operation that would collect a sample of the keys and use the distribution of the sampled keys to compute splitpoints for the ﬁnal sorting pass. Figure 3 (a) shows the progress of a normal execution of the sort program. The top-left graph shows the rate at which input is read. The rate peaks at about 13 GB/s and dies off fairly quickly since all map tasks ﬁnish before 200 seconds have elapsed. Note that the input rate is less than for grep. This is because the sort map tasks spend about half their time and I/O bandwidth writing intermediate output to their local disks. The corresponding intermediate output for grep had negligible size. The middle-left graph shows the rate at which data is sent over the network from the map tasks to the reduce tasks. This shufﬂing starts as soon as the ﬁrst map task completes. The ﬁrst hump in the graph is for To appear in OSDI 2004 the ﬁrst batch of approximately 1700 reduce tasks (the entire MapReduce was assigned about 1700 machines, and each machine executes at most one reduce task at a time). Roughly 300 seconds into the computation, some of these ﬁrst batch of reduce tasks ﬁnish and we start shufﬂing data for the remaining reduce tasks. All of the shufﬂing is done about 600 seconds into the computation. The bottom-left graph shows the rate at which sorted data is written to the ﬁnal output ﬁles by the reduce tasks. There is a delay between the end of the ﬁrst shufﬂing period and the start of the writing period because the machines are busy sorting the intermediate data. The writes continue at a rate of about 2-4 GB/s for a while. All of the writes ﬁnish about 850 seconds into the computation. Including startup overhead, the entire computation takes 891 seconds. This is similar to the current best reported result of 1057 seconds for the TeraSort benchmark [18]. A few things to note: the input rate is higher than the shufﬂe rate and the output rate because of our locality optimization – most data is read from a local disk and bypasses our relatively bandwidth constrained network. The shufﬂe rate is higher than the output rate because the output phase writes two copies of the sorted data (we make two replicas of the output for reliability and availability reasons). We write two replicas because that is the mechanism for reliability and availability provided by our underlying ﬁle system. Network bandwidth requirements for writing data would be reduced if the underlying ﬁle system used erasure coding [14] rather than replication. 9
In Figure 3 (b), we show an execution of the sort program with backup tasks disabled. The execution ﬂow is similar to that shown in Figure 3 (a), except that there is a very long tail where hardly any write activity occurs. After 960 seconds, all except 5 of the reduce tasks are completed. However these last few stragglers don’t ﬁnish until 300 seconds later. The entire computation takes 1283 seconds, an increase of 44% in elapsed time.
Number of instances in source tree
5.4 Effect of Backup Tasks
1000 800 600 400 200 0 2003/03 2003/06 2003/09 2003/12 2004/03 2004/06 2004/09
5.5 Machine Failures
In Figure 3 (c), we show an execution of the sort program where we intentionally killed 200 out of 1746 worker processes several minutes into the computation. The underlying cluster scheduler immediately restarted new worker processes on these machines (since only the processes were killed, the machines were still functioning properly). The worker deaths show up as a negative input rate since some previously completed map work disappears (since the corresponding map workers were killed) and needs to be redone. The re-execution of this map work happens relatively quickly. The entire computation ﬁnishes in 933 seconds including startup overhead (just an increase of 5% over the normal execution time).
Figure 4: MapReduce instances over time
Number of jobs Average job completion time Machine days used Input data read Intermediate data produced Output data written Average worker machines per job Average worker deaths per job Average map tasks per job Average reduce tasks per job Unique map implementations Unique reduce implementations Unique map/reduce combinations 29,423 634 secs 79,186 days 3,288 TB 758 TB 193 TB 157 1.2 3,351 55 395 269 426
6 Experience
We wrote the ﬁrst version of the MapReduce library in February of 2003, and made signiﬁcant enhancements to it in August of 2003, including the locality optimization, dynamic load balancing of task execution across worker machines, etc. Since that time, we have been pleasantly surprised at how broadly applicable the MapReduce library has been for the kinds of problems we work on. It has been used across a wide range of domains within Google, including: • large-scale machine learning problems, • clustering problems for the Google News and Froogle products, • extraction of data used to produce reports of popular queries (e.g. Google Zeitgeist), • extraction of properties of web pages for new experiments and products (e.g. extraction of geographical locations from a large corpus of web pages for localized search), and • large-scale graph computations. To appear in OSDI 2004
Table 1: MapReduce jobs run in August 2004 Figure 4 shows the signiﬁcant growth in the number of separate MapReduce programs checked into our primary source code management system over time, from 0 in early 2003 to almost 900 separate instances as of late September 2004. MapReduce has been so successful because it makes it possible to write a simple program and run it efﬁciently on a thousand machines in the course of half an hour, greatly speeding up the development and prototyping cycle. Furthermore, it allows programmers who have no experience with distributed and/or parallel systems to exploit large amounts of resources easily. At the end of each job, the MapReduce library logs statistics about the computational resources used by the job. In Table 1, we show some statistics for a subset of MapReduce jobs run at Google in August 2004.
6.1 Large-Scale Indexing
One of our most signiﬁcant uses of MapReduce to date has been a complete rewrite of the production index10
ing system that produces the data structures used for the Google web search service. The indexing system takes as input a large set of documents that have been retrieved by our crawling system, stored as a set of GFS ﬁles. The raw contents for these documents are more than 20 terabytes of data. The indexing process runs as a sequence of ﬁve to ten MapReduce operations. Using MapReduce (instead of the ad-hoc distributed passes in the prior version of the indexing system) has provided several beneﬁts: • The indexing code is simpler, smaller, and easier to understand, because the code that deals with fault tolerance, distribution and parallelization is hidden within the MapReduce library. For example, the size of one phase of the computation dropped from approximately 3800 lines of C++ code to approximately 700 lines when expressed using MapReduce. • The performance of the MapReduce library is good enough that we can keep conceptually unrelated computations separate, instead of mixing them together to avoid extra passes over the data. This makes it easy to change the indexing process. For example, one change that took a few months to make in our old indexing system took only a few days to implement in the new system. • The indexing process has become much easier to operate, because most of the problems caused by machine failures, slow machines, and networking hiccups are dealt with automatically by the MapReduce library without operator intervention. Furthermore, it is easy to improve the performance of the indexing process by adding new machines to the indexing cluster.
7 Related Work
Many systems have provided restricted programming models and used the restrictions to parallelize the computation automatically. For example, an associative function can be computed over all preﬁxes of an N element array in log N time on N processors using parallel preﬁx computations [6, 9, 13]. MapReduce can be considered a simpliﬁcation and distillation of some of these models based on our experience with large real-world computations. More signiﬁcantly, we provide a fault-tolerant implementation that scales to thousands of processors. In contrast, most of the parallel processing systems have only been implemented on smaller scales and leave the details of handling machine failures to the programmer. Bulk Synchronous Programming [17] and some MPI primitives [11] provide higher-level abstractions that To appear in OSDI 2004
make it easier for programmers to write parallel programs. A key difference between these systems and MapReduce is that MapReduce exploits a restricted programming model to parallelize the user program automatically and to provide transparent fault-tolerance. Our locality optimization draws its inspiration from techniques such as active disks [12, 15], where computation is pushed into processing elements that are close to local disks, to reduce the amount of data sent across I/O subsystems or the network. We run on commodity processors to which a small number of disks are directly connected instead of running directly on disk controller processors, but the general approach is similar. Our backup task mechanism is similar to the eager scheduling mechanism employed in the Charlotte System [3]. One of the shortcomings of simple eager scheduling is that if a given task causes repeated failures, the entire computation fails to complete. We ﬁx some instances of this problem with our mechanism for skipping bad records. The MapReduce implementation relies on an in-house cluster management system that is responsible for distributing and running user tasks on a large collection of shared machines. Though not the focus of this paper, the cluster management system is similar in spirit to other systems such as Condor [16]. The sorting facility that is a part of the MapReduce library is similar in operation to NOW-Sort [1]. Source machines (map workers) partition the data to be sorted and send it to one of R reduce workers. Each reduce worker sorts its data locally (in memory if possible). Of course NOW-Sort does not have the user-deﬁnable Map and Reduce functions that make our library widely applicable. River [2] provides a programming model where processes communicate with each other by sending data over distributed queues. Like MapReduce, the River system tries to provide good average case performance even in the presence of non-uniformities introduced by heterogeneous hardware or system perturbations. River achieves this by careful scheduling of disk and network transfers to achieve balanced completion times. MapReduce has a different approach. By restricting the programming model, the MapReduce framework is able to partition the problem into a large number of ﬁnegrained tasks. These tasks are dynamically scheduled on available workers so that faster workers process more tasks. The restricted programming model also allows us to schedule redundant executions of tasks near the end of the job which greatly reduces completion time in the presence of non-uniformities (such as slow or stuck workers). BAD-FS [5] has a very different programming model from MapReduce, and unlike MapReduce, is targeted to 11
the execution of jobs across a wide-area network. However, there are two fundamental similarities. (1) Both systems use redundant execution to recover from data loss caused by failures. (2) Both use locality-aware scheduling to reduce the amount of data sent across congested network links. TACC [7] is a system designed to simplify construction of highly-available networked services. Like MapReduce, it relies on re-execution as a mechanism for implementing fault-tolerance.
8 Conclusions
The MapReduce programming model has been successfully used at Google for many different purposes. We attribute this success to several reasons. First, the model is easy to use, even for programmers without experience with parallel and distributed systems, since it hides the details of parallelization, fault-tolerance, locality optimization, and load balancing. Second, a large variety of problems are easily expressible as MapReduce computations. For example, MapReduce is used for the generation of data for Google’s production web search service, for sorting, for data mining, for machine learning, and many other systems. Third, we have developed an implementation of MapReduce that scales to large clusters of machines comprising thousands of machines. The implementation makes efﬁcient use of these machine resources and therefore is suitable for use on many of the large computational problems encountered at Google. We have learned several things from this work. First, restricting the programming model makes it easy to parallelize and distribute computations and to make such computations fault-tolerant. Second, network bandwidth is a scarce resource. A number of optimizations in our system are therefore targeted at reducing the amount of data sent across the network: the locality optimization allows us to read data from local disks, and writing a single copy of the intermediate data to local disk saves network bandwidth. Third, redundant execution can be used to reduce the impact of slow machines, and to handle machine failures and data loss.
David Kramer, Shun-Tak Leung, and Josh Redstone for their work in developing GFS. We would also like to thank Percy Liang and Olcan Sercinoglu for their work in developing the cluster management system used by MapReduce. Mike Burrows, Wilson Hsieh, Josh Levenberg, Sharon Perl, Rob Pike, and Debby Wallach provided helpful comments on earlier drafts of this paper. The anonymous OSDI reviewers, and our shepherd, Eric Brewer, provided many useful suggestions of areas where the paper could be improved. Finally, we thank all the users of MapReduce within Google’s engineering organization for providing helpful feedback, suggestions, and bug reports.
References
[1] Andrea C. Arpaci-Dusseau, Remzi H. Arpaci-Dusseau, David E. Culler, Joseph M. Hellerstein, and David A. Patterson. High-performance sorting on networks of workstations. In Proceedings of the 1997 ACM SIGMOD International Conference on Management of Data, Tucson, Arizona, May 1997. [2] Remzi H. Arpaci-Dusseau, Eric Anderson, Noah Treuhaft, David E. Culler, Joseph M. Hellerstein, David Patterson, and Kathy Yelick. Cluster I/O with River: Making the fast case common. In Proceedings of the Sixth Workshop on Input/Output in Parallel and Distributed Systems (IOPADS ’99), pages 10–22, Atlanta, Georgia, May 1999. [3] Arash Baratloo, Mehmet Karaul, Zvi Kedem, and Peter Wyckoff. Charlotte: Metacomputing on the web. In Proceedings of the 9th International Conference on Parallel and Distributed Computing Systems, 1996. [4] Luiz A. Barroso, Jeffrey Dean, and Urs H¨ lzle. Web o search for a planet: The Google cluster architecture. IEEE Micro, 23(2):22–28, April 2003. [5] John Bent, Douglas Thain, Andrea C.Arpaci-Dusseau, Remzi H. Arpaci-Dusseau, and Miron Livny. Explicit control in a batch-aware distributed ﬁle system. In Proceedings of the 1st USENIX Symposium on Networked Systems Design and Implementation NSDI, March 2004. [6] Guy E. Blelloch. Scans as primitive parallel operations. IEEE Transactions on Computers, C-38(11), November 1989. [7] Armando Fox, Steven D. Gribble, Yatin Chawathe, Eric A. Brewer, and Paul Gauthier. Cluster-based scalable network services. In Proceedings of the 16th ACM Symposium on Operating System Principles, pages 78– 91, Saint-Malo, France, 1997. [8] Sanjay Ghemawat, Howard Gobioff, and Shun-Tak Leung. The Google ﬁle system. In 19th Symposium on Operating Systems Principles, pages 29–43, Lake George, New York, 2003.
Acknowledgements
Josh Levenberg has been instrumental in revising and extending the user-level MapReduce API with a number of new features based on his experience with using MapReduce and other people’s suggestions for enhancements. MapReduce reads its input from and writes its output to the Google File System [8]. We would like to thank Mohit Aron, Howard Gobioff, Markus Gutschke, To appear in OSDI 2004
12
[9] S. Gorlatch. Systematic efﬁcient parallelization of scan and other list homomorphisms. In L. Bouge, P. Fraigniaud, A. Mignotte, and Y. Robert, editors, Euro-Par’96. Parallel Processing, Lecture Notes in Computer Science 1124, pages 401–408. Springer-Verlag, 1996. [10] Jim Gray. Sort benchmark home page. <a href="http://research.microsoft.com/barc/SortBenchmark/" target="_blank">http://research.microsoft.com/barc/SortBenchmark/</a>. [11] William Gropp, Ewing Lusk, and Anthony Skjellum. Using MPI: Portable Parallel Programming with the Message-Passing Interface. MIT Press, Cambridge, MA, 1999. [12] L. Huston, R. Sukthankar, R. Wickremesinghe, M. Satyanarayanan, G. R. Ganger, E. Riedel, and A. Ailamaki. Diamond: A storage architecture for early discard in interactive search. In Proceedings of the 2004 USENIX File and Storage Technologies FAST Conference, April 2004. [13] Richard E. Ladner and Michael J. Fischer. Parallel preﬁx computation. Journal of the ACM, 27(4):831–838, 1980. [14] Michael O. Rabin. Efﬁcient dispersal of information for security, load balancing and fault tolerance. Journal of the ACM, 36(2):335–348, 1989. [15] Erik Riedel, Christos Faloutsos, Garth A. Gibson, and David Nagle. Active disks for large-scale data processing. IEEE Computer, pages 68–74, June 2001. [16] Douglas Thain, Todd Tannenbaum, and Miron Livny. Distributed computing in practice: The Condor experience. Concurrency and Computation: Practice and Experience, 2004. [17] L. G. Valiant. A bridging model for parallel computation. Communications of the ACM, 33(8):103–111, 1997. [18] Jim Wyllie. Spsort: How to sort a terabyte quickly. <a href="http://alme1.almaden.ibm.com/cs/spsort.pdf" target="_blank">http://alme1.almaden.ibm.com/cs/spsort.pdf</a>.
if (start &lt; i) Emit(text.substr(start,i-start),&quot;1&quot;); } } }; REGISTER_MAPPER(WordCounter); // User’s reduce function class Adder : public Reducer { virtual void Reduce(ReduceInput/</em> input) { // Iterate over all entries with the // same key and add the values int64 value = 0; while (!input-&gt;done()) { value += StringToInt(input-&gt;value()); input-&gt;NextValue(); } // Emit sum for input-&gt;key() Emit(IntToString(value)); } }; REGISTER_REDUCER(Adder); int main(int argc, char/<em>/</em> argv) { ParseCommandLineFlags(argc, argv); MapReduceSpecification spec; // Store list of input files into &quot;spec&quot; for (int i = 1; i &lt; argc; i++) { MapReduceInput/<em> input = spec.add_input(); input-&gt;set_format(&quot;text&quot;); input-&gt;set_filepattern(argv[i]); input-&gt;set_mapper_class(&quot;WordCounter&quot;); } // Specify the output files: // /gfs/test/freq-00000-of-00100 // /gfs/test/freq-00001-of-00100 // ... MapReduceOutput/</em> out = spec.output(); out-&gt;set_filebase(&quot;/gfs/test/freq&quot;); out-&gt;set_num_tasks(100); out-&gt;set_format(&quot;text&quot;); out-&gt;set_reducer_class(&quot;Adder&quot;); // Optional: do partial sums within map // tasks to save network bandwidth out-&gt;set_combiner_class(&quot;Adder&quot;); // Tuning parameters: use at most 2000 // machines and 100 MB of memory per task spec.set_machines(2000); spec.set_map_megabytes(100); spec.set_reduce_megabytes(100); // Now run it MapReduceResult result; if (!MapReduce(spec, &amp;result)) abort(); // Done: ’result’ structure contains info // about counters, time taken, number of // machines used, etc. return 0; }
A
Word Frequency
This section contains a program that counts the number of occurrences of each unique word in a set of input ﬁles speciﬁed on the command line.
/#include &quot;mapreduce/mapreduce.h&quot; // User’s map function class WordCounter : public Mapper { public: virtual void Map(const MapInput&amp; input) { const string&amp; text = input.value(); const int n = text.size(); for (int i = 0; i &lt; n; ) { // Skip past leading whitespace while ((i &lt; n) &amp;&amp; isspace(text[i])) i++; // Find word end int start = i; while ((i &lt; n) &amp;&amp; !isspace(text[i])) i++;
To appear in OSDI 2004
13</li>
</ol>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/hadoop/">hadoop</a></li></span></span> | <span class="tags">Tagged <a href="/tags/hadoop/" class="label label-primary">hadoop</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:36"datetime="2014-03-07 09:54:36"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-hadoop--mapreduce-osdi04/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-hadoop--mapreduce-osdi04" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-hadoop--NotesforHadoopthedefinitiveguide/">Notes for Hadoop the definitive guide</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:36.000Z"> <a href="/2014/02/02/2014-02-02-hadoop--NotesforHadoopthedefinitiveguide/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="notes-for-hadoop-the-definitive-guide">Notes for Hadoop the definitive guide</h1>
<h1 id="1-introduction-to-hdfs">1. Introduction to HDFS</h1>
<h2 id="1-1-hdfs-concepts">1.1. HDFS Concepts</h2>
<h3 id="1-1-1-blocks">1.1.1. Blocks</h3>
<p>l HDFS too has the concept of a block, but it is a much larger unit 64 MB by default.</p>
<p>l Like in a filesystem for a single disk, files in HDFS are broken into block-sized chunks, which are stored as independent units.</p>
<p>l Unlike a filesystem for a single disk, a file in HDFS that is smaller than a single block does not occupy a full block’s worth of underlying storage.</p>
<h3 id="1-1-2-namenodes-and-datanodes">1.1.2. Namenodes and Datanodes</h3>
<p>l The namenode manages the filesystem namespace.</p>
<p>n It maintains the filesystem tree and the metadata for all the files and directories in the tree.</p>
<p>n This information is stored persistently on the local disk in the form of two files: the namespace image and the edit log.</p>
<p>n The namenode also knows the datanodes on which all the blocks for a given file are located, however, it does not store block locations persistently, since this information is reconstructed from datanodes when the system starts.</p>
<p>l Datanodes are the work horses of the filesystem.</p>
<p>n They store and retrieve blocks when they are told to (by clients or the namenode)</p>
<p>n They report back to the namenode periodically with lists of blocks that they are storing.</p>
<p>l secondary namenode</p>
<p>n It does not act as a namenode.</p>
<p>n Its main role is to periodically merge the namespace image with the edit log to prevent the edit log from becoming too large.</p>
<p>n It keeps a copy of the merged name space image, which can be used in the event of the namenode failing.</p>
<h3 id="namenode-directory-structure">Namenode directory structure</h3>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image002_2.jpg" target="_blank"><img src="&quot;clip_image002&quot;" alt="clip_image002"></a></p>
<p>l The VERSION file is a Java properties file that contains information about the version of HDFS that is running</p>
<p>n The layoutVersion is a negative integer that defines the version of HDFS’s persistent data structures.</p>
<p>n The namespaceID is a unique identifier for the filesystem, which is created when the filesystem is first formatted.</p>
<p>n The cTime property marks the creation time of the namenode’s storage.</p>
<p>n The storageType indicates that this storage directory contains data structures for a namenode.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image004_2.jpg" target="_blank"><img src="&quot;clip_image004&quot;" alt="clip_image004"></a></p>
<h3 id="the-filesystem-image-and-edit-log">The filesystem image and edit log</h3>
<p>l When a filesystem client performs a write operation, it is first recorded in the edit log.</p>
<p>l The namenode also has an in-memory representation of the filesystem metadata, which it updates after the edit log has been modified.</p>
<p>l The edit log is flushed and synced after every write before a success code is returned to the client.</p>
<p>l The fsimage file is a persistent checkpoint of the filesystem metadata. it is not updated for every filesystem write operation.</p>
<p>l If the namenode fails, then the latest state of its metadata can be reconstructed by loading the fsimage from disk into memory, then applying each of the operations in the edit log.</p>
<p>l This is precisely what the namenode does when it starts up.</p>
<p>l The fsimage file contains a serialized form of all the directory and file inodes in the filesystem.</p>
<p>l The secondary namenode is to produce checkpoints of the primary’s in-memory filesystem metadata.</p>
<p>l The checkpointing process proceeds as follows :</p>
<p>n The secondary asks the primary to roll its edits file, so new edits go to a new file.</p>
<p>n The secondary retrieves fsimage and edits from the primary (using HTTP GET).</p>
<p>n The secondary loads fsimage into memory, applies each operation from edits, then creates a new consolidated fsimage file.</p>
<p>n The secondary sends the new fsimage back to the primary (using HTTP POST).</p>
<p>n The primary replaces the old fsimage with the new one from the secondary, and the old edits file with the new one it started in step 1. It also updates the fstime file to record the time that the checkpoint was taken.</p>
<p>n At the end of the process, the primary has an up-to-date fsimage file, and a shorter edits file.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image006_2.jpg" target="_blank"><img src="&quot;clip_image006&quot;" alt="clip_image006"></a></p>
<h3 id="secondary-namenode-directory-structure">Secondary namenode directory structure</h3>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image008_2.jpg" target="_blank"><img src="&quot;clip_image008&quot;" alt="clip_image008"></a></p>
<h3 id="datanode-directory-structure">Datanode directory structure</h3>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image010_2.jpg" target="_blank"><img src="&quot;clip_image010&quot;" alt="clip_image010"></a></p>
<p>l A datanode’s VERSION file</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image012_2.jpg" target="_blank"><img src="&quot;clip_image012&quot;" alt="clip_image012"></a></p>
<p>l The other files in the datanode’s current storage directory are the files with the blk_ prefix.</p>
<p>n There are two types: the HDFS blocks themselves (which just consist of the file’s raw bytes) and the metadata for a block (with a .meta suffix).</p>
<p>n A block file just consists of the raw bytes of a portion of the file being stored;</p>
<p>n the metadata file is made up of a header with version and type information, followed by a series of checksums for sections of the block.</p>
<p>l When the number of blocks in a directory grows to a certain size, the datanode creates a new subdirectory in which to place new blocks and their accompanying metadata.</p>
<h2 id="1-2-data-flow">1.2. Data Flow</h2>
<h3 id="1-2-1-anatomy-of-a-file-read">1.2.1. Anatomy of a File Read</h3>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image014_2.jpg" target="_blank"><img src="&quot;clip_image014&quot;" alt="clip_image014"></a></p>
<p>l The client opens the file it wishes to read by calling open() on the FileSystem object (step 1).</p>
<p>l DistributedFileSystem calls the namenode, using RPC, to determine the locations of the blocks for the first few blocks in the file (step 2).</p>
<p>l For each block, the namenode returns the addresses of the datanodes that have a copy of that block.</p>
<p>l The datanodes are sorted according to their proximity to the client.</p>
<p>l The DistributedFileSystem returns a FSDataInputStream to the client for it to read data from.</p>
<p>l The client then calls read() on the stream (step 3).</p>
<p>l DFSInputStream connects to the first (closest) datanode for the first block in the file.</p>
<p>l Data is streamed from the datanode back to the client (step 4).</p>
<p>l When the end of the block is reached, DFSInputStream will close the connection to the datanode, then find the best datanode for the next block (step 5).</p>
<p>l When the client has finished reading, it calls close() on the FSDataInputStream (step 6).</p>
<p>l During reading, if the client encounters an error while communicating with a datanode, then it will try the next closest one for that block.</p>
<p>l It will also remember datanodes that have failed so that it doesn’t needlessly retry them for later blocks.</p>
<p>l The client also verifies checksums for the data transferred to it from the datanode. If a corrupted block is found, it is reported to the namenode.</p>
<h3 id="1-2-2-anatomy-of-a-file-write">1.2.2. Anatomy of a File Write</h3>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image016_2.jpg" target="_blank"><img src="&quot;clip_image016&quot;" alt="clip_image016"></a></p>
<p>l The client creates the file by calling create() (step 1).</p>
<p>l DistributedFileSystem makes an RPC call to the namenode to create a new file in the filesystem’s namespace, with no blocks associated with it (step 2).</p>
<p>l The namenode performs various checks to make sure the file doesn’t already exist, and that the client has the right permissions to create the file. If these checks pass, the namenode makes a record of the new file; otherwise, file creation fails and the client is thrown an IOException.</p>
<p>l The DistributedFileSystem returns a FSDataOutputStream for the client to start writing data to.</p>
<p>l As the client writes data (step 3), DFSOutputStream splits it into packets, which it writes to an internal queue, called the data queue.</p>
<p>l The data queue is consumed by the Data Streamer, whose responsibility it is to ask the namenode to allocate new blocks by picking a list of suitable datanodes to store the replicas. The list of datanodes forms apipeline.</p>
<p>l The DataStreamer streams the packets to the first datanode in the pipeline, which stores the packet and forwards it to the second datanode in the pipeline. Similarly, the second datanode stores the packet and forwards it to the third (and last) datanode in the pipe line (step 4).</p>
<p>l DFSOutputStream also maintains an internal queue of packets that are waiting to be acknowledged by datanodes, called the ack queue. A packet is removed from the ack queue only when it has been acknowledged by all the datanodes in the pipeline (step 5).</p>
<p>l If a datanode fails while data is being written to it,</p>
<p>n First the pipeline is closed, and any packets in the ack queue are added to the front of the data queue.</p>
<p>n The current block on the good datanodes is given a new identity by the namenode, so that the partial block on the failed datanode will be deleted if the failed data node recovers later on.</p>
<p>n The failed datanode is removed from the pipeline and the remainder of the block’s data is written to the two good datanodes in the pipeline.</p>
<p>n The namenode notices that the block is under-replicated, and it arranges for a further replica to be created on another node.</p>
<p>l When the client has finished writing data it calls close() on the stream (step 6). This action flushes all the remaining packets to the datanode pipeline and waits for acknowledgments before contacting the namenode to signal that the file is complete (step7).</p>
<h1 id="2-meet-map-reduce">2. Meet Map/Reduce</h1>
<p>l MapReduce has two phases: the map phase and the reduce phase.</p>
<p>l Each phase has key-value pairs as input and output (the types can be specified).</p>
<p>n The input key-value types of the map phase is determined by the input format</p>
<p>n The output key-value types of the map phase should match the input key value types of the reduce phase</p>
<p>n The output key-value types of the reduce phase can be set in the JobConf interface.</p>
<p>l The programmer specifies two functions: the map function and the reduce function.</p>
<h2 id="2-1-mapreduce-logical-data-flow">2.1. MapReduce logical data flow</h2>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image018_2.jpg" target="_blank"><img src="&quot;clip_image018&quot;" alt="clip_image018"></a></p>
<h2 id="2-2-mapreduce-code">2.2. MapReduce Code</h2>
<h3 id="2-2-1-the-map-function-is-represented-by-an-implementation-of-the-mapper-interface-which-declares-a-map-method-">2.2.1. The map function is represented by an implementation of the Mapper interface, which declares a map() method.</h3>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image020_2.jpg" target="_blank"><img src="&quot;clip_image020&quot;" alt="clip_image020"></a></p>
<h3 id="2-2-2-the-reduce-function-is-defined-using-a-reducer">2.2.2. The reduce function is defined using a Reducer</h3>
<p>l The input types of the reduce function must match the output type of the map function.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image022_2.jpg" target="_blank"><img src="&quot;clip_image022&quot;" alt="clip_image022"></a></p>
<h3 id="2-2-3-the-code-runs-the-mapreduce-job">2.2.3. The code runs the MapReduce job</h3>
<p>l An input path is specified by calling the static addInputPath() method on FileInputFormat</p>
<p>n It can be a single file, a directory, or a file pattern.</p>
<p>n addInputPath() can be called more than once to use input from multiple paths.</p>
<p>l The output path is specified by the static setOutputPath() method on FileOutputFormat.</p>
<p>n It specifies a directory where the output files from the reducer functions are written.</p>
<p>n The directory shouldn’t exist before running the job</p>
<p>l The map and reduce types can be specified via the setMapperClass() and setReducerClass() methods.</p>
<p>l The setOutputKeyClass() and setOutputValueClass() methods control the output types for the map and the reduce functions, which are often the same.</p>
<p>n If they are different, then the map output types can be set using the methods setMapOutputKeyClass() and setMapOutputValueClass().</p>
<p>l The input types are controlled via the input format, which we have not explicitly set since we are using the default TextInputFormat.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image024_2.jpg" target="_blank"><img src="&quot;clip_image024&quot;" alt="clip_image024"></a></p>
<h2 id="2-3-scaling-out">2.3. Scaling Out</h2>
<h3 id="2-3-1-mapreduce-data-flow-with-a-single-reduce-task">2.3.1. MapReduce data flow with a single reduce task</h3>
<p>l A MapReduce job is a unit of work that the client wants to be performed: it consists of the input data, the MapReduce program, and configuration information.</p>
<p>l Hadoop runs the job by dividing it into tasks, of which there are two types: map tasks and reduce tasks.</p>
<p>l There are two types of nodes that control the job execution process: a jobtracker and a number of tasktrackers.</p>
<p>n The jobtracker coordinates all the jobs run on the system by scheduling tasks to run on tasktrackers.</p>
<p>n Tasktrackers run tasks and send progress reports to the jobtracker, which keeps a record of the overall progress of each job.</p>
<p>n If a tasks fails, the jobtracker can reschedule it on a different tasktracker.</p>
<p>l Hadoop divides the input to a MapReduce job into fixed-size input splits.</p>
<p>l Hadoop creates one map task for each split, which runs the user defined map function for each record in the split.</p>
<p>l Hadoop does its best to run the map task on a node where the input data resides in HDFS.</p>
<p>n This is called the data locality optimization.</p>
<p>n This is why the optimal split size is the same as the block size: it is the largest size of input that can be guaranteed to be stored on a single node.</p>
<p>l Reduce tasks don’t have the advantage of data locality</p>
<p>n The input to a single reduce task is normally the output from all mappers.</p>
<p>n The output of the reduce is normally stored in HDFS for reliability.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image026_2.jpg" target="_blank"><img src="&quot;clip_image026&quot;" alt="clip_image026"></a></p>
<h3 id="2-3-2-mapreduce-data-flow-with-multiple-reduce-tasks">2.3.2. MapReduce data flow with multiple reduce tasks</h3>
<p>The number of reduce tasks is not governed by the size of the input, but is specified independently.</p>
<p>l When there are multiple reducers, the map tasks partition their output, each creating one partition for each reduce task.</p>
<p>l There can be many keys (and their associated values) in each partition, but the records for every key are all in a single partition.</p>
<p>l The partitioning can be controlled by a user-defined partitioning function</p>
<p>n Normally the default partitioner which buckets keys using a hash function.</p>
<p>n conf.setPartitionerClass(HashPartitioner.class);</p>
<p>n conf.setNumReduceTasks(1);</p>
<p>l The data flow between map and reduce tasks is “the shuffle,” as each reduce task is fed by many map tasks.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image028_2.jpg" target="_blank"><img src="&quot;clip_image028&quot;" alt="clip_image028"></a></p>
<p>l It’s also possible to have zero reduce tasks. This can be appropriate when you don’t need the shuffle since the processing can be carried out entirely in parallel</p>
<h1 id="3-mapreduce-types-and-formats">3. MapReduce Types and Formats</h1>
<h2 id="3-1-mapreduce-types">3.1. MapReduce Types</h2>
<p>l The map and reduce functions in Hadoop MapReduce have the following general form:</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image030_2.jpg" target="_blank"><img src="&quot;clip_image030&quot;" alt="clip_image030"></a></p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image032_2.jpg" target="_blank"><img src="&quot;clip_image032&quot;" alt="clip_image032"></a></p>
<p>l The partition function operates on the intermediate key and value types (K2 and V2), and returns the partition index.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image034_2.jpg" target="_blank"><img src="&quot;clip_image034&quot;" alt="clip_image034"></a></p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image036_2.jpg" target="_blank"><img src="&quot;clip_image036&quot;" alt="clip_image036"></a></p>
<h3 id="3-1-1-configuration-of-mapreduce-types">3.1.1. Configuration of MapReduce types</h3>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image038_2.jpg" target="_blank"><img src="&quot;clip_image038&quot;" alt="clip_image038"></a></p>
<p>l Input types are set by the input format.</p>
<p>n For instance, a TextInputFormat generates keys of type LongWritable and values of type Text.</p>
<p>l A minimal MapReduce driver, with the defaults explicitly set</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image040_2.jpg" target="_blank"><img src="&quot;clip_image040&quot;" alt="clip_image040"></a></p>
<p>l The default input format is TextInputFormat, which produces keys of type LongWritable (the offset of the beginning of the line in the file) and values of type Text (the line of text).</p>
<p>l The setNumMapTasks() call does not necessarily set the number of map tasks to one</p>
<p>n The actual number of map tasks depends on the size of the input</p>
<p>l The default mapper is IdentityMapper</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image042_2.jpg" target="_blank"><img src="&quot;clip_image042&quot;" alt="clip_image042"></a></p>
<p>l Map tasks are run by MapRunner, the default implementation of MapRunnable that calls the Mapper’s map() method sequentially with each record.</p>
<p>l The default partitioner is HashPartitioner, which hashes a record’s key to determine which partition the record belongs in.</p>
<p>n Each partition is processed by a reduce task, so the number of partitions is equal to the number of reduce tasks for the job</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image044_2.jpg" target="_blank"><img src="&quot;clip_image044&quot;" alt="clip_image044"></a></p>
<p>l The default reducer is IdentityReducer</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image046_2.jpg" target="_blank"><img src="&quot;clip_image046&quot;" alt="clip_image046"></a></p>
<p>l Records are sorted by the MapReduce system before being presented to the reducer.</p>
<p>l The default output format is TextOutputFormat, which writes out records, one per line, by converting keys and values to strings and separating them with a tab character.</p>
<h2 id="3-2-input-formats">3.2. Input Formats</h2>
<h3 id="3-2-1-input-splits-and-records">3.2.1. Input Splits and Records</h3>
<p>l An input split is a chunk of the input that is processed by a single map.</p>
<p>l Each split is divided into records, and the map processes each record—a key-value pair—in turn.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image048_2.jpg" target="_blank"><img src="&quot;clip_image048&quot;" alt="clip_image048"></a></p>
<p>l An InputSplit has a length in bytes, and a set of storage locations, which are just hostname strings.</p>
<p>l A split doesn’t contain the input data; it is just a reference to the data.</p>
<p>l The storage locations are used by the MapReduce system to place map tasks as close to the split’s data as possible</p>
<p>l The size is used to order the splits so that the largest get processed first</p>
<p>l An InputFormat is responsible for creating the input splits, and dividing them into records.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image050_2.jpg" target="_blank"><img src="&quot;clip_image050&quot;" alt="clip_image050"></a></p>
<p>l The JobClient calls the getSplits() method, passing the desired number of map tasks as the numSplits argument.</p>
<p>l Having calculated the splits, the client sends them to the jobtracker, which uses their storage locations to schedule map tasks to process them on the tasktrackers.</p>
<p>l On a tasktracker, the map task passes the split to the getRecordReader() method on InputFormat to obtain a RecordReader for that split.</p>
<p>l A RecordReader is little more than an iterator over records, and the map task uses one to generate record key-value pairs, which it passes to the map function.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image052_2.jpg" target="_blank"><img src="&quot;clip_image052&quot;" alt="clip_image052"></a></p>
<p>l The same key and value objects are used on each invocation of the map() method—only their contents are changed. If you need to change the value out of map, make a copy of the object you want to hold on to.</p>
<h3 id="3-2-2-fileinputformat">3.2.2. FileInputFormat</h3>
<p>l FileInputFormat is the base class for all implementations of InputFormat that use files as their data source.</p>
<p>l It provides two things: a place to define which files are included as the input to a job, and an implementation for generating splits for the input files.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image054_2.jpg" target="_blank"><img src="&quot;clip_image054&quot;" alt="clip_image054"></a></p>
<p>l FileInputFormat input paths may represent a file, a directory, or, by using a glob, a collection of files and directories.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image056_2.jpg" target="_blank"><img src="&quot;clip_image056&quot;" alt="clip_image056"></a></p>
<p>l To exclude certain files from the input, you can set a filter using the setInputPathFilter() method on FileInputFormat</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image058_2.jpg" target="_blank"><img src="&quot;clip_image058&quot;" alt="clip_image058"></a></p>
<p>l FileInputFormat splits only large files. Here “large” means larger than an HDFS block.</p>
<p>l Properties for controlling split size</p>
<p>n The minimum split size is usually 1 byte, by setting this to a value larger than the block size, they can force splits to be larger than a block.</p>
<p>n The maximum split size defaults to the maximum value that can be represented by a Java long type. It has an effect only when it is less than the block size, forcing splits to be smaller than a block.</p>
<h3 id="small-files-and-combinefileinputformat">Small files and CombineFileInputFormat</h3>
<p>l Hadoop works better with a small number of large files than a large number of small files.</p>
<p>l Where FileInputFormat creates a split per file, CombineFileInputFormat packs many files into each split so that each mapper has more to process.</p>
<p>l One technique for avoiding the many small files case is to merge small files into larger files by using a SequenceFile: the keys can act as filenames and the values as file contents.</p>
<h3 id="3-2-3-text-input">3.2.3. Text Input</h3>
<p>l TextInputFormat is the default InputFormat.</p>
<p>n Each record is a line of input.</p>
<p>n The key, a LongWritable, is the byte offset within the file of the beginning of the line.</p>
<p>n The value is the contents of the line, excluding any line terminators, and is packaged as a Text object.</p>
<p>l The logical records that FileInputFormats define do not usually fit neatly into HDFS blocks.</p>
<p>l A single file is broken into lines, and the line boundaries do not correspond with the HDFS block boundaries.</p>
<p>l Splits honor logical record boundaries</p>
<p>n The first split contains line 5, even though it spans the first and second block.</p>
<p>n The second split starts at line 6.</p>
<p>l Data-local maps will perform some remote reads.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image060_2.jpg" target="_blank"><img src="&quot;clip_image060&quot;" alt="clip_image060"></a></p>
<h3 id="keyvaluetextinputformat">KeyValueTextInputFormat</h3>
<p>l It is common for each line in a file to be a key-value pair, separated by a delimiter such as a tab character.</p>
<p>l You can specify the separator via the key.value.separator.in.input.line property.</p>
<h3 id="nlineinputformat">NLineInputFormat</h3>
<p>l If you want your mappers to receive a fixed number of lines of input, then NLineInputFormat is the InputFormat to use.</p>
<p>l Like TextInputFormat, the keys are the byte offsets within the file and the values are the lines themselves.</p>
<p>l N refers to the number of lines of input that each mapper receives.</p>
<h3 id="3-2-4-binary-input">3.2.4. Binary Input</h3>
<h3 id="sequencefileinputformat">SequenceFileInputFormat</h3>
<p>l Hadoop’s sequence file format stores sequences of binary key-value pairs.</p>
<p>l To use data from sequence files as the input to MapReduce, you use SequenceFileInputFormat.</p>
<p>l The keys and values are determined by the sequence file, and you need to make sure that your map input types correspond.</p>
<p>l For example, if your sequence file has IntWritable keys and Text values, then the map signature would be Mapper<IntWritable, Text, K, V>.</p>
<h3 id="sequencefileastextinputformat">SequenceFileAsTextInputFormat</h3>
<p>l SequenceFileAsTextInputFormat is a variant of SequenceFileInputFormat that converts the sequence file’s keys and values to Text objects.</p>
<h3 id="sequencefileasbinaryinputformat">SequenceFileAsBinaryInputFormat</h3>
<p>l SequenceFileAsBinaryInputFormat is a variant of SequenceFileInputFormat that retrieves the sequence file’s keys and values as opaque binary objects.</p>
<p>l They are encapsulated as BytesWritable objects</p>
<h3 id="sequencefile">SequenceFile</h3>
<p>l Writing a SequenceFile</p>
<p>n To create a SequenceFile, use one of its createWriter() static methods, which returns a SequenceFile.Writer instance.</p>
<p>n specify a stream to write to (either a FSDataOutputStream or a FileSystem and Path pairing), a Configuration object, and the key and value types.</p>
<p>n Once you have a SequenceFile.Writer, you then write key-value pairs, using the append() method.</p>
<p>n Then when you’ve finished you call the close() method</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image062_2.jpg" target="_blank"><img src="&quot;clip_image062&quot;" alt="clip_image062"></a></p>
<p>l Reading a SequenceFile</p>
<p>n Reading sequence files from beginning to end is a matter of creating an instance of SequenceFile.Reader, and iterating over records by repeatedly invoking one of the next() methods.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image064_2.jpg" target="_blank"><img src="&quot;clip_image064&quot;" alt="clip_image064"></a></p>
<p>l The SequenceFile Format</p>
<p>n A sequence file consists of a header followed by one or more records.</p>
<p>n The first three bytes of a sequence file are the bytes SEQ, which acts a magic number, followed by a single byte representing the version number.</p>
<p>n The header contains other fields including the names of the key and value classes, compression details, user-defined metadata, and the sync marker.</p>
<p>n The sync marker is used to allow a reader to synchronize to a record boundary from any position in the file.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image066_2.jpg" target="_blank"><img src="&quot;clip_image066&quot;" alt="clip_image066"></a></p>
<h3 id="3-2-5-multiple-inputs">3.2.5. Multiple Inputs</h3>
<p>l The MultipleInputs class allows you to specify the InputFormat and Mapper to use on a per-path basis.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image068_2.jpg" target="_blank"><img src="&quot;clip_image068&quot;" alt="clip_image068"></a></p>
<h2 id="3-3-output-formats">3.3. Output Formats</h2>
<h3 id="3-3-1-text-output">3.3.1. Text Output</h3>
<p>l The default output format, TextOutputFormat, writes records as lines of text.</p>
<p>l Its keys and values may be of any type, since TextOutputFormat turns them to strings by calling toString() on them.</p>
<p>l Each key-value pair is separated by a tab character, although that may be changed using the mapred.textoutputformat.separator property.</p>
<h3 id="3-3-2-binary-output">3.3.2. Binary Output</h3>
<p>l SequenceFileOutputFormat</p>
<p>l SequenceFileAsBinaryOutputFormat</p>
<p>l MapFileOutputFormat</p>
<h3 id="writing-a-mapfile">Writing a MapFile</h3>
<p>l You create an instance of MapFile.Writer, then call the append() method to add entries in order.</p>
<p>l Keys must be instances of WritableComparable, and values must be Writable</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image070_2.jpg" target="_blank"><img src="&quot;clip_image070&quot;" alt="clip_image070"></a></p>
<p>l If we look at the MapFile, we see it’s actually a directory containing two files called data and index:</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image072_2.jpg" target="_blank"><img src="&quot;clip_image072&quot;" alt="clip_image072"></a></p>
<p>l Both files are SequenceFiles. The data file contains all of the entries, in order:</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image074_2.jpg" target="_blank"><img src="&quot;clip_image074&quot;" alt="clip_image074"></a></p>
<p>l The index file contains a fraction of the keys, and contains a mapping from the key to that key’s offset in the data file:</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image076_2.jpg" target="_blank"><img src="&quot;clip_image076&quot;" alt="clip_image076"></a></p>
<h3 id="reading-a-mapfile">Reading a MapFile</h3>
<p>l you create a MapFile.Reader, then call the next() method until it returns false</p>
<h3 id="3-3-3-multiple-outputs">3.3.3. Multiple Outputs</h3>
<h3 id="multipleoutputformat">MultipleOutputFormat</h3>
<p>l MultipleOutputFormat allows you to write data to multiple files whose names are derived from the output keys and values.</p>
<p>n conf.setOutputFormat(StationNameMultipleTextOutputFormat.class);</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image078_2.jpg" target="_blank"><img src="&quot;clip_image078&quot;" alt="clip_image078"></a></p>
<h3 id="multipleoutputs">MultipleOutputs</h3>
<p>l MultipleOutputs can emit different types for each output.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image080_2.jpg" target="_blank"><img src="&quot;clip_image080&quot;" alt="clip_image080"></a></p>
<h1 id="4-developing-a-mapreduce-application">4. Developing a MapReduce Application</h1>
<h2 id="4-1-the-configuration-api">4.1. The Configuration API</h2>
<p>l An instance of the Configuration class (found in the org.apache.hadoop.conf package) represents a collection of configuration properties and their values.</p>
<p>l Configurations read their properties from resources—XML files</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image082_2.jpg" target="_blank"><img src="&quot;clip_image082&quot;" alt="clip_image082"></a></p>
<p>l we can access its properties using a piece of code like this:</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image084_2.jpg" target="_blank"><img src="&quot;clip_image084&quot;" alt="clip_image084"></a></p>
<h2 id="4-2-configuring-the-development-environment">4.2. Configuring the Development Environment</h2>
<h3 id="4-2-1-managing-configuration">4.2.1. Managing Configuration</h3>
<p>l When developing Hadoop applications, it is common to switch between running the application locally and running it on a cluster.</p>
<p>l hadoop-local.xml</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image086_2.jpg" target="_blank"><img src="&quot;clip_image086&quot;" alt="clip_image086"></a></p>
<p>l hadoop-localhost.xml</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image088_2.jpg" target="_blank"><img src="&quot;clip_image088&quot;" alt="clip_image088"></a></p>
<p>l hadoop-cluster.xml</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image090_2.jpg" target="_blank"><img src="&quot;clip_image090&quot;" alt="clip_image090"></a></p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image092_2.jpg" target="_blank"><img src="&quot;clip_image092&quot;" alt="clip_image092"></a></p>
<p>l With this setup, it is easy to use any configuration with the -conf command-line switch.</p>
<p>l For example, the following command shows a directory listing on the HDFS server running in pseudo-distributed mode on localhost:</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image094_2.jpg" target="_blank"><img src="&quot;clip_image094&quot;" alt="clip_image094"></a></p>
<h3 id="4-2-2-genericoptionsparser-tool-and-toolrunner">4.2.2. GenericOptionsParser, Tool, and ToolRunner</h3>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image096_2.jpg" target="_blank"><img src="&quot;clip_image096&quot;" alt="clip_image096"></a></p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image098_2.jpg" target="_blank"><img src="&quot;clip_image098&quot;" alt="clip_image098"></a></p>
<h1 id="5-how-mapreduce-works">5. How MapReduce Works</h1>
<h2 id="5-1-anatomy-of-a-mapreduce-job-run">5.1. Anatomy of a MapReduce Job Run</h2>
<p>l There are four independent entities:</p>
<p>n The client, which submits the MapReduce job.</p>
<p>n The jobtracker, which coordinates the job run. The jobtracker is a Java application whose main class is JobTracker.</p>
<p>n The tasktrackers, which run the tasks that the job has been split into. Tasktrackers are Java applications whose main class is TaskTracker.</p>
<p>n The distributed filesystem, which is used for sharing job files between the other entities.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image100_2.jpg" target="_blank"><img src="&quot;clip_image100&quot;" alt="clip_image100"></a></p>
<h3 id="5-1-1-job-submission">5.1.1. Job Submission</h3>
<p>l The runJob() method on JobClient creates a new JobClient instance and calls submitJob() on it.</p>
<p>l Having submitted the job, runJob() polls the job’s progress once a second, and reports the progress to the console if it has changed since the last report.</p>
<p>l When the job is complete, if it was successful, the job counters are displayed. Otherwise, the error that caused the job to fail is logged to the console.</p>
<h3 id="the-job-submission-process">The job submission process</h3>
<p>l Asks the jobtracker for a new job ID (by calling getNewJobId() on JobTracker)</p>
<p>l Checks the output specification of the job.</p>
<p>l Computes the input splits for the job.</p>
<p>l Copies the resources needed to run the job, including the job JAR file, the configuration file and the computed input splits, to the jobtracker’s filesystem in a directory named after the job ID.</p>
<p>l Tells the jobtracker that the job is ready for execution (by calling submitJob() on JobTracker)</p>
<h3 id="5-1-2-job-initialization">5.1.2. Job Initialization</h3>
<p>l When the JobTracker receives a call to its submitJob() method, it puts it into an internal queue from where the job scheduler will pick it up and initialize it.</p>
<p>l Initialization involves creating an object to represent the job being run, which encapsulates its tasks, and bookkeeping information to keep track of the tasks’ status and progress.</p>
<p>l To create the list of tasks to run, the job scheduler first retrieves the input splits computed by the JobClient from the shared filesystem.</p>
<p>l It then creates one map task for each split.</p>
<p>l Tasks are given IDs at this point.</p>
<h3 id="5-1-3-task-assignment">5.1.3. Task Assignment</h3>
<p>l Tasktrackers run a simple loop that periodically sends heartbeat method calls to the jobtracker.</p>
<p>l As a part of the heartbeat, a tasktracker will indicate whether it is ready to run a new task, and if it is, the jobtracker will allocate it a task, which it communicates to the tasktracker using the heartbeat return value</p>
<p>l Before it can choose a task for the tasktracker, the jobtracker must choose a job to select the task from according to priority.(setJobPriority() and FIFO)</p>
<p>l Tasktrackers have a fixed number of slots for map tasks and for reduce tasks.</p>
<p>l The default scheduler fills empty map task slots before reduce task slots</p>
<p>l To choose a reduce task the jobtracker simply takes the next in its list of yet-to-be-run reduce tasks, since there are no data locality considerations.</p>
<h3 id="5-1-4-task-execution">5.1.4. Task Execution</h3>
<p>l Now the tasktracker has been assigned a task, the next step is for it to run the task.</p>
<p>l First, it localizes the job JAR by copying it from the shared filesystem to the tasktracker’s filesystem.</p>
<p>l It also copies any files needed from the distributed cache by the application to the local disk</p>
<p>l Second, it creates a local working directory for the task, and un-jars the contents of the JAR into this directory.</p>
<p>l Third, it creates an instance of TaskRunner to run the task.</p>
<p>l TaskRunner launches a new Java Virtual Machine to run each task in</p>
<p>l It is however possible to reuse the JVM between tasks;</p>
<p>l The child process communicates with its parent through the umbilical interface.</p>
<h3 id="5-1-5-job-completion">5.1.5. Job Completion</h3>
<p>l When the jobtracker receives a notification that the last task for a job is complete, it changes the status for the job to “successful.” T</p>
<p>l hen, when the JobClient polls for status, it learns that the job has completed successfully, so it prints a message to tell the user, and then returns from the runJob() method.</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image102_2.jpg" target="_blank"><img src="&quot;clip_image102&quot;" alt="clip_image102"></a></p>
<h2 id="5-2-failures">5.2. Failures</h2>
<h3 id="5-2-1-task-failure">5.2.1. Task Failure</h3>
<p>l The most common way is when user code in the map or reduce task throws a runtime exception.</p>
<p>n the child JVM reports the error back to its parent tasktracker, before it exits.</p>
<p>n The error ultimately makes it into the user logs.</p>
<p>n The tasktracker marks the task attempt as failed, freeing up a slot to run another task.</p>
<p>l Another failure mode is the sudden exit of the child JVM</p>
<p>n the tasktracker notices that the process has exited, and marks the attempt as failed.</p>
<p>l Hanging tasks are dealt with differently.</p>
<p>n The tasktracker notices that it hasn’t received a progress update for a while, and proceeds to mark the task as failed.</p>
<p>n The child JVM process will be automatically killed after this period</p>
<p>l When the jobtracker is notified of a task attempt that has failed (by the tasktracker’s heartbeat call) it will reschedule execution of the task.</p>
<p>n The jobtracker will try to avoid rescheduling the task on a tasktracker where it has previously failed.</p>
<p>n If a task fails more than four times, it will not be retried further.</p>
<h3 id="5-2-2-tasktracker-failure">5.2.2. Tasktracker Failure</h3>
<p>l If a tasktracker fails by crashing, or running very slowly, it will stop sending heartbeats to the jobtracker (or send them very infrequently).</p>
<p>l The jobtracker will notice a tasktracker that has stopped sending heartbeats and remove it from its pool of tasktrackers to schedule tasks on.</p>
<p>l The jobtracker arranges for map tasks that were run and completed successfully on that tasktracker to be rerun if they belong to incomplete jobs, since their intermediate output residing on the failed tasktracker’s local filesystem may not be accessible to the reduce task. Any tasks in progress are also rescheduled.</p>
<h3 id="5-2-3-jobtracker-failure">5.2.3. Jobtracker Failure</h3>
<h2 id="5-3-shuffle-and-sort">5.3. Shuffle and Sort</h2>
<p><a href="http://images.cnblogs.com/cnblogs_com/forfuture1978/WindowsLiveWriter/NotesforHadoopthedefinitiveguide_14109/clip_image104_2.jpg" target="_blank"><img src="&quot;clip_image104&quot;" alt="clip_image104"></a></p>
<h3 id="5-3-1-the-map-side">5.3.1. The Map Side</h3>
<p>l When the map function starts producing output, it is not simply written to disk.</p>
<p>l Each map task has a circular memory buffer that it writes the output to.</p>
<p>l When the contents of the buffer reach a certain threshold size, a background thread will start to spill the contents to disk.</p>
<p>l Spills are written in round-robin fashion to the directories specified by the mapred.local.dir property</p>
<p>l Before it writes to disk, the thread first divides the data into partitions corresponding to the reducers that they will ultimately be sent to.</p>
<p>l Within each partition, the background thread performs an in-memory sort by key.</p>
<p>l Each time the memory buffer reaches the spill threshold, a new spill file is created, so after the map task has written its last output record there could be several spill files.</p>
<p>l Before the task is finished, the spill files are merged into a single partitioned and sorted output file.</p>
<p>l The output file’s partitions are made available to the reducers over HTTP.</p>
<p>l The number of worker threads used to serve the file partitions is controlled by the task tracker.http.threads property</p>
<h3 id="5-3-2-the-reduce-side">5.3.2. The Reduce Side</h3>
<p>l As map tasks complete successfully, they notify their parent tasktracker of the status update, which in turn notifies the jobtracker.</p>
<p>l for a given job, the jobtracker knows the mapping between map outputs and tasktrackers.</p>
<p>l A thread in the reducer periodically asks the jobtracker for map output locations until it has retrieved them all.</p>
<p>l The reduce task needs the map output for its particular partition from several map tasks across the cluster.</p>
<p>l The map tasks may finish at different times, so the reduce task starts copying their outputs as soon as each completes. This is known as the copy phase of the reduce task.</p>
<p>l The reduce task has a small number of copier threads so that it can fetch map outputs in parallel.</p>
<p>l As the copies accumulate on disk, a background thread merges them into larger, sorted files.</p>
<p>l When all the map outputs have been copied, the reduce task moves into the sort phase (which should properly be called the merge phase, as the sorting was carried out on the map side), which merges the map outputs, maintaining their sort ordering.</p>
<p>l During the reduce phase the reduce function is invoked for each key in the sorted output. The output of this phase is written directly to the output filesystem, typically HDFS.
来源： &lt;<a href="http://www.cnblogs.com/forfuture1978/archive/2010/02/27/1674955.html" target="_blank">Notes for Hadoop the definitive guide - 觉先 - 博客园</a>&gt; </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/hadoop/">hadoop</a></li></span></span> | <span class="tags">Tagged <a href="/tags/hadoop/" class="label label-primary">hadoop</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:36"datetime="2014-03-07 09:54:36"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-hadoop--NotesforHadoopthedefinitiveguide/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-hadoop--NotesforHadoopthedefinitiveguide" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-oracle-oracle---如何写这个sql语句_Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区/">如何写这个sql语句 _Oracle数据库管理_ITPUB论坛</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:35.000Z"> <a href="/2014/02/02/2014-02-02-DB-oracle-oracle---如何写这个sql语句_Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-sql-_oracle-_itpub-it168-">如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区</h1>
<ul>
<li>用户名</li>
<li>UID</li>
<li>Email</li>
</ul>
<p>请 <a href=""><strong>登录</strong></a> 后使用快捷导航
没有帐号？<a href="http://www.itpub.net/member.php?mod=register.php" target="_blank">注册</a></p>
<h2 id="-itpub-http-sql-_oracle-_itpub-it168-_files-logo-png-http-www-itpub-net-forum-php-itpub-"><a href="http://www.itpub.net/forum.php" title="ITPUB论坛" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/logo.png" alt="ITPUB论坛"></a></h2>
<p><a href="">用户名</a>  自动登录    <a href="http://sso.itpub.net/ForgotPassword?return_url=http%3A%2F%2Fwww.itpub.net%2Fhome.php%3Fmod%3Dspacecp" target="_blank">找回密码</a> 密码  <em>登录</em>  <a href="http://www.itpub.net/member.php?mod=register.php" target="_blank">注册</a></p>
<p><a href="http://www.itpub.net/connect.php?mod=login&amp;op=init&amp;referer=forum.php%3Fmod%3Dviewthread%26tid%3D96851&amp;statfrom=login_simple" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/qq_login.gif" alt="QQ登录"></a></p>
<p>只需一步，快速开始</p>
<p><a href="">快捷导航</a></p>
<ul>
<li><a href="http://tech.it168.com/" target="_blank">门户</a></li>
<li><a href="http://www.itpub.net/forum.php" title="BBS" target="_blank">论坛BBS</a></li>
<li><a href="http://space.itpub.net/" target="_blank">空间</a></li>
<li><a href="http://www.itpub.net/pubtree/index.htm" target="_blank">索引树</a></li>
<li><a href="http://www.itpub.net/misc.php?mod=mobile" target="_blank">手机版</a></li>
<li><a href="http://book.itpub.net/" target="_blank">读书</a></li>
<li><a href="http://wenku.it168.com/" target="_blank">文库</a></li>
<li><a href="http://www.itpub.net/plugin.php?id=auction" title="Auction" target="_blank">竞拍Auction</a></li>
<li><a href="http://www.itpub.net/plugin.php?id=itpub_medal:medal_shop" target="_blank">商店</a></li>
<li><a href="http://www.itpub.net/misc.php?mod=ranklist" title="Ranklist" target="_blank">排行榜Ranklist</a></li>
<li><a href="http://www.itpub.net/portal.php?mod=topic&amp;topicid=1" target="_blank">版主团</a></li>
<li><p><a href="http://www.itpub.net/itpub2011/" target="_blank">十周年专题</a></p>
</li>
<li><p><a href="http://www.itpub.net/pubtree/?node=1" target="_blank">Oracle索引树</a></p>
</li>
<li><a href="http://www.itpub.net/pubtree/?node=51" target="_blank">DB2索引树</a></li>
<li><a href="http://www.itpub.net/pubtree/?node=95" target="_blank">MS Sql Sever索引树</a></li>
<li><a href="http://www.itpub.net/pubtree/?node=166" target="_blank">Mysql索引树</a></li>
<li><a href="http://www.itpub.net/pubtree/?node=343" target="_blank">Sybase索引树</a></li>
<li><a href="http://www.itpub.net/pubtree/?node=339" target="_blank">BI索引树</a></li>
<li><a href="http://www.itpub.net/pubtree/?node=137" target="_blank">项目管理索引树</a></li>
<li><p><a href="http://www.itpub.net/pubtree/?node=207" target="_blank">Java索引树</a>
<a href="">本版</a> <strong>搜索</strong> <a href="http://www.itpub.net/search.php?mod=forum&amp;adv=yes" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/gj_search.png" alt=""></a> <strong>热搜:</strong><a href="http://www.itpub.net/search.php?mod=forum&amp;srchtxt=ITPUB%CB%F7%D2%FD%CA%F7&amp;formhash=f7e57c72&amp;searchsubmit=true&amp;source=hotsearch" target="_blank">ITPUB索引树</a><a href="http://www.itpub.net/search.php?mod=forum&amp;srchtxt=ITPUB%CA%AE%D6%DC%C4%EA&amp;formhash=f7e57c72&amp;searchsubmit=true&amp;source=hotsearch" target="_blank">ITPUB十周年</a><a href="http://www.itpub.net/search.php?mod=forum&amp;srchtxt=Oracle&amp;formhash=f7e57c72&amp;searchsubmit=true&amp;source=hotsearch" target="_blank">Oracle</a><a href="http://www.itpub.net/search.php?mod=forum&amp;srchtxt=%D0%D4%C4%DC%D3%C5%BB%AF&amp;formhash=f7e57c72&amp;searchsubmit=true&amp;source=hotsearch" target="_blank">性能优化</a></p>
</li>
<li><p><a href="">本版</a></p>
</li>
<li><a href="">帖子</a></li>
<li><a href="">用户</a></li>
</ul>
<p><a href="http://www.itpub.net/forum.php" title="首页" target="_blank">ITPUB论坛</a> <em>›</em> <a href="http://www.itpub.net/forum.php" target="_blank">论坛</a> <em>›</em> <a href="http://www.itpub.net/forum.php?gid=1" target="_blank">≡ 数据库技术 ≡</a> <em>›</em> <a href="http://www.itpub.net/forum-2-1.html" target="_blank">Oracle数据库管理</a> <em>›</em> <a href="http://www.itpub.net/thread-96851-1-1.html" target="_blank">如何写这个sql语句?</a></p>
<ul>
<li><a href="http://www.itpub.net/pubtree/index.htm" target="_blank"><strong>ITPUB知识索引树 隆重上线</strong></a></li>
<li><a href="http://www.itpub.net/thread-1557539-1-1.html" target="_blank"><strong>优中选优，ITPUB精彩技术贴推荐有奖</strong></a></li>
<li><a href="http://www.itpub.net/thread-1505518-1-1.html" target="_blank"><strong>ITPUB十城沙龙巡展演讲PPT下载</strong></a></li>
<li><a href="http://www.xuexizu.com/training_centre/content/77026?nid=30538" target="_blank"><strong>OCM集训营-认证直通车正在招募</strong></a>
<strong>1</strong><a href="http://www.itpub.net/thread-96851-2-1.html" target="_blank">2</a><a href="http://www.itpub.net/thread-96851-3-1.html" target="_blank">3</a><a href="http://www.itpub.net/thread-96851-2-1.html" target="_blank">下一页</a> <a href="http://www.itpub.net/forum-2-1.html" target="_blank">返回列表</a> <a href="&quot;发新帖&quot;"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/pn_post.png" alt="发新帖"></a></li>
</ul>
<p>分享到  <a href="&quot;转发到新浪微博&quot;"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/sina.gif" alt="转发到新浪微博"></a> <a href="&quot;转发到腾讯微博&quot;"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/weiboicon16.png" alt=""></a> <a href="&quot;转贴到开心网&quot;"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/kaixin.gif" alt="转贴到开心网"></a> <a href="&quot;推荐给豆瓣&quot;"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/douban.gif" alt=""></a> <a href="&quot;转贴到淘宝&quot;"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/taobao.gif" alt="转贴到淘宝"></a> <a href=""><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/favicon-rr.gif" alt="转帖到人人网"></a> <a href="&quot;转贴到推特&quot;"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/twiitericon.gif" alt="转贴到推特"></a> <a href=""><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/facebook_share_icon.gif" alt="转贴到Facebook"></a>    </p>
<p>查看: 9463|回复: 26 <a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=favorite&amp;type=thread&amp;id=96851" target="_blank">收藏</a>  <a href="http://www.itpub.net/forum.php?mod=viewthread&amp;action=printable&amp;tid=96851" title="打印" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/print.png" alt="打印"></a> <a href="http://www.itpub.net/forum.php?mod=redirect&amp;goto=nextoldset&amp;tid=96851" title="上一主题" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/thread-prev.png" alt="上一主题"></a> <a href="http://www.itpub.net/forum.php?mod=redirect&amp;goto=nextnewset&amp;tid=96851" title="下一主题" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/thread-next.png" alt="下一主题"></a></p>
<h1 id="-sql-http-www-itpub-net-thread-96851-1-1-html-http-www-itpub-net-thread-96851-1-1-html-"><a href="http://www.itpub.net/thread-96851-1-1.html" target="_blank">如何写这个sql语句?</a>  <a href="http://www.itpub.net/thread-96851-1-1.html" title="您的朋友访问此链接后，您将获得相应的积分奖励" target="_blank">[复制链接]</a></h1>
<p><a href="http://www.itpub.net/space-uid-4218.html" target="_blank">xallan</a></p>
<p><strong><a href="http://www.itpub.net/space-uid-4218.html" target="_blank">xallan</a></strong> <em>当前离线</em> UID4218阅读权限10帖子<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=thread&amp;type=reply&amp;view=me&amp;from=space" target="_blank">79</a>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">0</a>技术排名12897技术积分194社区排名20989社区积分6注册时间2001-12-28</p>
<p><a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=profile" title="查看详细资料" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/userinfo.gif" alt="查看详细资料"></a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=showip&amp;idtype=user&amp;id=xallan" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/showip.small.gif" alt=""> IP卡</a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=checkonline&amp;idtype=user&amp;id=xallan" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/checkonline.small.gif" alt=""> 狗仔卡</a>
<a href="http://www.itpub.net/space-uid-4218.html" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/noavatar_middle.gif" alt=""></a></p>
<p><em><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=usergroup&amp;gid=29" target="_blank">注册会员</a></em></p>
<p>一般会员</p>
<p>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">0</a>技术积分194社区积分6注册时间2001-12-28 论坛徽章:1</p>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/medal_14_small.gif" alt="授权会员
日期:2005-10-30 17:05:33" title="授权会员
日期:2005-10-30 17:05:33"></p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=friend&amp;op=add&amp;uid=4218&amp;handlekey=addfriendhk_4218" title="加好友" target="_blank">加好友</a></li>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=pm&amp;op=showmsg&amp;handlekey=showmsg_4218&amp;touid=4218&amp;pmid=0&amp;daterange=2&amp;pid=538556&amp;tid=96851" title="发消息" target="_blank">发消息</a>
电梯直达  <a href="&quot;跳转到指定楼层&quot;"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/fj_btn.png" alt="跳转到指定楼层"></a> <strong><a href="http://www.itpub.net/thread-96851-1-1.html" target="_blank"><em>1</em>/#</a></strong></li>
</ul>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/online_member.gif" alt=""> <em>发表于 2003-2-20 22:06:25</em> |<a href="http://www.itpub.net/forum.php?mod=viewthread&amp;tid=96851&amp;page=1&amp;authorid=4218" target="_blank">只看该作者</a> |<a href="http://www.itpub.net/forum.php?mod=viewthread&amp;tid=96851&amp;extra=&amp;ordertype=1" target="_blank">倒序浏览</a></p>
<p>表dept, emp
要得到如下结果</p>
<h2 id="deptno-dname-employees">deptno, dname, employees</h2>
<p>10, accounting, clark;king;miller
20, research, smith;adams;ford;scott;jones
30, sales, allen;blake;martin;james;turners
也就是，每个dept的employee串起来作为一条记录返回。
怎么用一条sql语句完成?
3x <a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=favorite&amp;type=thread&amp;id=96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/fav.gif" alt="收藏">收藏0</a> <a href="">使用道具</a> <a href="">举报</a>
**</p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=bump&amp;idtype=tid&amp;id=96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/bump.small.gif" alt="">提升卡</a></li>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=stick&amp;idtype=tid&amp;id=96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/stick.small.gif" alt="">置顶卡</a></li>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=highlight&amp;idtype=tid&amp;id=96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/highlight.small.gif" alt="">变色卡</a></li>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=namepost&amp;idtype=pid&amp;id=538556:96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/namepost.small.gif" alt="">显身卡</a>
*
<a href="http://www.itpub.net/space-uid-7292.html" target="_blank">jaunt</a></li>
</ul>
<p><strong><a href="http://www.itpub.net/space-uid-7292.html" target="_blank">jaunt</a></strong> <em>当前离线</em> UID7292阅读权限100帖子<a href="http://www.itpub.net/home.php?mod=space&amp;uid=7292&amp;do=thread&amp;type=reply&amp;view=me&amp;from=space" target="_blank">12195</a>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=7292&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">4</a>技术排名68技术积分22560社区排名1177社区积分1370注册时间2002-2-27</p>
<p><a href="http://www.itpub.net/home.php?mod=space&amp;uid=7292&amp;do=profile" title="查看详细资料" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/userinfo.gif" alt="查看详细资料"></a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=showip&amp;idtype=user&amp;id=jaunt" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/showip.small.gif" alt=""> IP卡</a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=checkonline&amp;idtype=user&amp;id=jaunt" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/checkonline.small.gif" alt=""> 狗仔卡</a>
<a href="http://www.itpub.net/space-uid-7292.html" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/noavatar_middle.gif" alt=""></a></p>
<p><em><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=usergroup&amp;gid=34" target="_blank">版主</a></em></p>
<p>版主</p>
<p>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=7292&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">4</a>技术积分22560社区积分1370注册时间2002-2-27 论坛徽章:13</p>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/medal_1_small.gif" alt="ITPUB元老
日期:2005-02-28 12:57:00" title="ITPUB元老
日期:2005-02-28 12:57:00"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/2010fu_small.gif" alt="2011新春纪念徽章
日期:2011-01-25 15:42:56" title="2011新春纪念徽章
日期:2011-01-25 15:42:56"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/2010fu_small.gif" alt="2011新春纪念徽章
日期:2011-01-25 15:42:33" title="2011新春纪念徽章
日期:2011-01-25 15:42:33"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/2010fu_small.gif" alt="2011新春纪念徽章
日期:2011-01-25 15:42:15" title="2011新春纪念徽章
日期:2011-01-25 15:42:15"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/2010fu_small.gif" alt="2011新春纪念徽章
日期:2011-01-25 15:41:50" title="2011新春纪念徽章
日期:2011-01-25 15:41:50"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/2010fu_small.gif" alt="2011新春纪念徽章
日期:2011-01-25 15:41:01" title="2011新春纪念徽章
日期:2011-01-25 15:41:01"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/medal_31_small.gif" alt="会员2006贡献徽章
日期:2006-04-17 13:46:34" title="会员2006贡献徽章
日期:2006-04-17 13:46:34"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/medal_30_small.gif" alt="管理团队2006纪念徽章
日期:2006-04-16 22:44:45" title="管理团队2006纪念徽章
日期:2006-04-16 22:44:45"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/medal_14_small.gif" alt="授权会员
日期:2005-10-30 17:05:33" title="授权会员
日期:2005-10-30 17:05:33"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/medal_13_small.gif" alt="管理团队成员
日期:2011-05-07 01:45:08" title="管理团队成员
日期:2011-05-07 01:45:08"></p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=friend&amp;op=add&amp;uid=7292&amp;handlekey=addfriendhk_7292" title="加好友" target="_blank">加好友</a></li>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=pm&amp;op=showmsg&amp;handlekey=showmsg_7292&amp;touid=7292&amp;pmid=0&amp;daterange=2&amp;pid=538776&amp;tid=96851" title="发消息" target="_blank">发消息</a>
<strong><a href="http://www.itpub.net/forum.php?mod=redirect&amp;goto=findpost&amp;ptid=96851&amp;pid=538776" target="_blank"><em>2</em>/#</a></strong></li>
</ul>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/online_moderator.gif" alt=""> <em>发表于 2003-2-21 08:45:37</em> |<a href="http://www.itpub.net/forum.php?mod=viewthread&amp;tid=96851&amp;page=1&amp;authorid=7292" target="_blank">只看该作者</a></p>
<p>Sorry，没看清题目，给了个错答案。:P  <a href="">使用道具</a> <a href="">举报</a>
**</p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=namepost&amp;idtype=pid&amp;id=538776:96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/namepost.small.gif" alt="">显身卡</a>
*</li>
</ul>
<p><a href="http://www.itpub.net/space-uid-4218.html" target="_blank">xallan</a></p>
<p><strong><a href="http://www.itpub.net/space-uid-4218.html" target="_blank">xallan</a></strong> <em>当前离线</em> UID4218阅读权限10帖子<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=thread&amp;type=reply&amp;view=me&amp;from=space" target="_blank">79</a>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">0</a>技术排名12897技术积分194社区排名20989社区积分6注册时间2001-12-28</p>
<p><a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=profile" title="查看详细资料" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/userinfo.gif" alt="查看详细资料"></a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=showip&amp;idtype=user&amp;id=xallan" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/showip.small.gif" alt=""> IP卡</a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=checkonline&amp;idtype=user&amp;id=xallan" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/checkonline.small.gif" alt=""> 狗仔卡</a>
<a href="http://www.itpub.net/space-uid-4218.html" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/noavatar_middle.gif" alt=""></a></p>
<p><em><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=usergroup&amp;gid=29" target="_blank">注册会员</a></em></p>
<p>一般会员</p>
<p>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">0</a>技术积分194社区积分6注册时间2001-12-28 论坛徽章:1</p>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/medal_14_small.gif" alt="授权会员
日期:2005-10-30 17:05:33" title="授权会员
日期:2005-10-30 17:05:33"></p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=friend&amp;op=add&amp;uid=4218&amp;handlekey=addfriendhk_4218" title="加好友" target="_blank">加好友</a></li>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=pm&amp;op=showmsg&amp;handlekey=showmsg_4218&amp;touid=4218&amp;pmid=0&amp;daterange=2&amp;pid=538829&amp;tid=96851" title="发消息" target="_blank">发消息</a>
<strong><a href="http://www.itpub.net/forum.php?mod=redirect&amp;goto=findpost&amp;ptid=96851&amp;pid=538829" target="_blank"><em>3</em>/#</a></strong></li>
</ul>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/online_member.gif" alt=""> <em>发表于 2003-2-21 09:00:29</em> |<a href="http://www.itpub.net/forum.php?mod=viewthread&amp;tid=96851&amp;page=1&amp;authorid=4218" target="_blank">只看该作者</a></p>
<p>我想到了一个办法，用function，可以解决这个问题。但是，如果只用sql，是不是无法实现这种功能?  <a href="">使用道具</a> <a href="">举报</a>
**</p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=namepost&amp;idtype=pid&amp;id=538829:96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/namepost.small.gif" alt="">显身卡</a>
*
<a href="http://www.itpub.net/space-uid-14302.html" target="_blank">riosinph</a></li>
</ul>
<p><strong><a href="http://www.itpub.net/space-uid-14302.html" target="_blank">riosinph</a></strong> <em>当前离线</em> UID14302阅读权限10帖子<a href="http://www.itpub.net/home.php?mod=space&amp;uid=14302&amp;do=thread&amp;type=reply&amp;view=me&amp;from=space" target="_blank">4898</a>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=14302&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">1</a>技术排名1505技术积分1661社区排名519社区积分4324注册时间2002-6-21</p>
<p><a href="http://www.itpub.net/home.php?mod=space&amp;uid=14302&amp;do=profile" title="查看详细资料" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/userinfo.gif" alt="查看详细资料"></a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=showip&amp;idtype=user&amp;id=riosinph" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/showip.small.gif" alt=""> IP卡</a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=checkonline&amp;idtype=user&amp;id=riosinph" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/checkonline.small.gif" alt=""> 狗仔卡</a>
<a href="http://www.itpub.net/space-uid-14302.html" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/02_avatar_middle.jpg" alt=""></a></p>
<p><em><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=usergroup&amp;gid=29" target="_blank">注册会员</a></em></p>
<p>New Human</p>
<p>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=14302&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">1</a>技术积分1661社区积分4324注册时间2002-6-21 论坛徽章:2</p>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/medal_14_small.gif" alt="授权会员
日期:2005-10-30 17:05:33" title="授权会员
日期:2005-10-30 17:05:33"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/medal_31_small.gif" alt="会员2006贡献徽章
日期:2006-04-17 13:46:34" title="会员2006贡献徽章
日期:2006-04-17 13:46:34"></p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=friend&amp;op=add&amp;uid=14302&amp;handlekey=addfriendhk_14302" title="加好友" target="_blank">加好友</a></li>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=pm&amp;op=showmsg&amp;handlekey=showmsg_14302&amp;touid=14302&amp;pmid=0&amp;daterange=2&amp;pid=538914&amp;tid=96851" title="发消息" target="_blank">发消息</a>
<strong><a href="http://www.itpub.net/forum.php?mod=redirect&amp;goto=findpost&amp;ptid=96851&amp;pid=538914" target="_blank"><em>4</em>/#</a></strong></li>
</ul>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/online_member.gif" alt=""> <em>发表于 2003-2-21 09:26:47</em> |<a href="http://www.itpub.net/forum.php?mod=viewthread&amp;tid=96851&amp;page=1&amp;authorid=14302" target="_blank">只看该作者</a></p>
<p>select dept.deptno, dept.dname, emp.employee
from dept,emp
where  instr(dept.employees,emp.employee)&gt;0
.........  <a href="">使用道具</a> <a href="">举报</a>
**</p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=namepost&amp;idtype=pid&amp;id=538914:96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/namepost.small.gif" alt="">显身卡</a>
*</li>
</ul>
<p><a href="http://www.itpub.net/space-uid-4218.html" target="_blank">xallan</a></p>
<p><strong><a href="http://www.itpub.net/space-uid-4218.html" target="_blank">xallan</a></strong> <em>当前离线</em> UID4218阅读权限10帖子<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=thread&amp;type=reply&amp;view=me&amp;from=space" target="_blank">79</a>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">0</a>技术排名12897技术积分194社区排名20989社区积分6注册时间2001-12-28</p>
<p><a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=profile" title="查看详细资料" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/userinfo.gif" alt="查看详细资料"></a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=showip&amp;idtype=user&amp;id=xallan" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/showip.small.gif" alt=""> IP卡</a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=checkonline&amp;idtype=user&amp;id=xallan" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/checkonline.small.gif" alt=""> 狗仔卡</a>
<a href="http://www.itpub.net/space-uid-4218.html" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/noavatar_middle.gif" alt=""></a></p>
<p><em><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=usergroup&amp;gid=29" target="_blank">注册会员</a></em></p>
<p>一般会员</p>
<p>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">0</a>技术积分194社区积分6注册时间2001-12-28 论坛徽章:1</p>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/medal_14_small.gif" alt="授权会员
日期:2005-10-30 17:05:33" title="授权会员
日期:2005-10-30 17:05:33"></p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=friend&amp;op=add&amp;uid=4218&amp;handlekey=addfriendhk_4218" title="加好友" target="_blank">加好友</a></li>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=pm&amp;op=showmsg&amp;handlekey=showmsg_4218&amp;touid=4218&amp;pmid=0&amp;daterange=2&amp;pid=539279&amp;tid=96851" title="发消息" target="_blank">发消息</a>
<strong><a href="http://www.itpub.net/forum.php?mod=redirect&amp;goto=findpost&amp;ptid=96851&amp;pid=539279" target="_blank"><em>5</em>/#</a></strong></li>
</ul>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/online_member.gif" alt=""> <em>发表于 2003-2-21 11:27:20</em> |<a href="http://www.itpub.net/forum.php?mod=viewthread&amp;tid=96851&amp;page=1&amp;authorid=4218" target="_blank">只看该作者</a></p>
<p>不能不承认，还是老外厉害。
我在otn上也问了同样的问题。
很快有人说用plsql写个存储过程，后来我又问纯粹用sql行不行，有个牛人很快回答了：
Well if you have a thoretical maximum, which I would assume you would given the legibility of listing hundreds of employees in the way you describe then yes. But the SQL needs to use the LAG function for each employee, hence a hundred emps a hundred LAGs, so kind of bulky.
This example uses a max of 6, and would need more cut n pasting to do more than that.
SQL&gt; select deptno, dname, emps
  2  from (
  3  select d.deptno, d.dname, rtrim(e.ename ||&#39;, &#39;||
  4     lead(e.ename,1) over (partition by d.deptno
  5             order by e.ename) ||&#39;, &#39;||
  6     lead(e.ename,2) over (partition by d.deptno
  7             order by e.ename) ||&#39;, &#39;||
  8     lead(e.ename,3) over (partition by d.deptno
  9             order by e.ename) ||&#39;, &#39;||
10     lead(e.ename,4) over (partition by d.deptno
11             order by e.ename) ||&#39;, &#39;||
12     lead(e.ename,5) over (partition by d.deptno
13             order by e.ename),&#39;, &#39;) emps,
14     row_number () over (partition by d.deptno
15             order by e.ename) x
16  from emp e, dept d
17  where d.deptno = e.deptno
18  )
19  where x = 1
20  /
DEPTNO DNAME       EMPS</p>
<hr>
<pre><code> 10 ACCOUNTING  CLARK, KING, MILLER
 20 RESEARCH    ADAMS, FORD, JONES, ROONEY, SCOTT, SMITH
 30 SALES       ALLEN, BLAKE, JAMES, MARTIN, TURNER, WARD
</code></pre><hr>
<p>打算踏踏实实看看书.  <a href="">使用道具</a> <a href="">举报</a>
**</p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=namepost&amp;idtype=pid&amp;id=539279:96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/namepost.small.gif" alt="">显身卡</a>
*
<a href="http://www.itpub.net/space-uid-15894.html" target="_blank">rain11er</a></li>
</ul>
<p><strong><a href="http://www.itpub.net/space-uid-15894.html" target="_blank">rain11er</a></strong> <em>当前离线</em> UID15894阅读权限100帖子<a href="http://www.itpub.net/home.php?mod=space&amp;uid=15894&amp;do=thread&amp;type=reply&amp;view=me&amp;from=space" target="_blank">872</a>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=15894&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">4</a>技术排名915技术积分2504社区排名3702社区积分186注册时间2002-7-9</p>
<p><a href="http://www.itpub.net/home.php?mod=space&amp;uid=15894&amp;do=profile" title="查看详细资料" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/userinfo.gif" alt="查看详细资料"></a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=showip&amp;idtype=user&amp;id=rain11er" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/showip.small.gif" alt=""> IP卡</a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=checkonline&amp;idtype=user&amp;id=rain11er" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/checkonline.small.gif" alt=""> 狗仔卡</a>
<a href="http://www.itpub.net/space-uid-15894.html" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/94_avatar_middle.jpg" alt=""></a></p>
<p><em><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=usergroup&amp;gid=34" target="_blank">版主</a></em></p>
<p>无头衔</p>
<p>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=15894&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">4</a>技术积分2504社区积分186注册时间2002-7-9 论坛徽章:44</p>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/cd3s.gif" alt="咸鸭蛋
日期:2011-09-14 08:46:37" title="咸鸭蛋
日期:2011-09-14 08:46:37"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/2010fu_small.gif" alt="2011新春纪念徽章
日期:2011-01-25 15:41:01" title="2011新春纪念徽章
日期:2011-01-25 15:41:01"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/Cycling_small.gif" alt="2010广州亚运会纪念徽章:自行车
日期:2011-01-05 12:55:01" title="2010广州亚运会纪念徽章:自行车
日期:2011-01-05 12:55:01"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/Taekwondo_small.gif" alt="2010广州亚运会纪念徽章:跆拳道
日期:2010-11-16 19:05:23" title="2010广州亚运会纪念徽章:跆拳道
日期:2010-11-16 19:05:23"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/Handball_small.gif" alt="2010广州亚运会纪念徽章:手球
日期:2010-10-19 22:02:34" title="2010广州亚运会纪念徽章:手球
日期:2010-10-19 22:02:34"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/haibao_small.gif" alt="2010世博会纪念徽章
日期:2010-10-05 15:10:58" title="2010世博会纪念徽章
日期:2010-10-05 15:10:58"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/haibao_small.gif" alt="2010世博会纪念徽章
日期:2010-08-08 20:44:57" title="2010世博会纪念徽章
日期:2010-08-08 20:44:57"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/2010Denmark_small.gif" alt="2010年世界杯参赛球队：丹麦
日期:2010-08-05 21:25:40" title="2010年世界杯参赛球队：丹麦
日期:2010-08-05 21:25:40"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/2010Serbia_small.gif" alt="2010年世界杯参赛球队：塞尔维亚
日期:2010-06-11 15:41:58" title="2010年世界杯参赛球队：塞尔维亚
日期:2010-06-11 15:41:58"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/2010Argentina_small.gif" alt="2010年世界杯参赛球队：阿根廷
日期:2010-06-07 12:53:08" title="2010年世界杯参赛球队：阿根廷
日期:2010-06-07 12:53:08"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/2010fu_small.gif" alt="2011新春纪念徽章
日期:2011-01-25 15:41:50" title="2011新春纪念徽章
日期:2011-01-25 15:41:50"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/2010fu_small.gif" alt="2011新春纪念徽章
日期:2011-01-25 15:42:15" title="2011新春纪念徽章
日期:2011-01-25 15:42:15"></p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=friend&amp;op=add&amp;uid=15894&amp;handlekey=addfriendhk_15894" title="加好友" target="_blank">加好友</a></li>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=pm&amp;op=showmsg&amp;handlekey=showmsg_15894&amp;touid=15894&amp;pmid=0&amp;daterange=2&amp;pid=539463&amp;tid=96851" title="发消息" target="_blank">发消息</a>
<strong><a href="http://www.itpub.net/forum.php?mod=redirect&amp;goto=findpost&amp;ptid=96851&amp;pid=539463" target="_blank"><em>6</em>/#</a></strong></li>
</ul>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/online_moderator.gif" alt=""> <em>发表于 2003-2-21 12:38:26</em> |<a href="http://www.itpub.net/forum.php?mod=viewthread&amp;tid=96851&amp;page=1&amp;authorid=15894" target="_blank">只看该作者</a></p>
<p>peifu,peifu  <a href="">使用道具</a> <a href="">举报</a>
**</p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=namepost&amp;idtype=pid&amp;id=539463:96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/namepost.small.gif" alt="">显身卡</a>
*</li>
</ul>
<p><a href="http://www.itpub.net/space-uid-4613.html" target="_blank">nyfor</a></p>
<p><strong><a href="http://www.itpub.net/space-uid-4613.html" target="_blank">nyfor</a></strong> <em>当前离线</em> UID4613阅读权限100帖子<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4613&amp;do=thread&amp;type=reply&amp;view=me&amp;from=space" target="_blank">5403</a>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4613&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">8</a>技术排名168技术积分10935社区排名1592社区积分824注册时间2002-1-6</p>
<p><a href="http://www.itpub.net/home.php?mod=space&amp;uid=4613&amp;do=profile" title="查看详细资料" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/userinfo.gif" alt="查看详细资料"></a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=showip&amp;idtype=user&amp;id=nyfor" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/showip.small.gif" alt=""> IP卡</a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=checkonline&amp;idtype=user&amp;id=nyfor" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/checkonline.small.gif" alt=""> 狗仔卡</a>
<a href="http://www.itpub.net/space-uid-4613.html" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/13_avatar_middle.jpg" alt=""></a></p>
<p><em><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=usergroup&amp;gid=34" target="_blank">版主</a></em></p>
<p>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4613&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">8</a>技术积分10935社区积分824注册时间2002-1-6 论坛徽章:57</p>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/sx2007-08small.gif" alt="生肖徽章2007版:羊
日期:2008-11-14 14:42:19" title="生肖徽章2007版:羊
日期:2008-11-14 14:42:19"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/cd5s.gif" alt="鲜花蛋
日期:2011-05-10 13:02:48" title="鲜花蛋
日期:2011-05-10 13:02:48"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/cd6s.gif" alt="紫蛋头
日期:2011-05-10 13:03:01" title="紫蛋头
日期:2011-05-10 13:03:01"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/cd7s.gif" alt="灰彻蛋
日期:2011-05-10 13:03:12" title="灰彻蛋
日期:2011-05-10 13:03:12"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/cd8s.gif" alt="迷宫蛋
日期:2011-05-10 13:03:40" title="迷宫蛋
日期:2011-05-10 13:03:40"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/cd9s.gif" alt="蛋疼蛋
日期:2011-05-10 13:03:56" title="蛋疼蛋
日期:2011-05-10 13:03:56"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/cd10s.gif" alt="复活蛋
日期:2011-05-10 13:04:09" title="复活蛋
日期:2011-05-10 13:04:09"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/triathlon_small.gif" alt="2010广州亚运会纪念徽章:三项全能
日期:2011-05-19 21:32:30" title="2010广州亚运会纪念徽章:三项全能
日期:2011-05-19 21:32:30"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/cd10s.gif" alt="复活蛋
日期:2011-08-06 08:59:05" title="复活蛋
日期:2011-08-06 08:59:05"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/cd4s.gif" alt="茶鸡蛋
日期:2011-05-10 13:02:38" title="茶鸡蛋
日期:2011-05-10 13:02:38"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/cd3s.gif" alt="咸鸭蛋
日期:2011-05-10 13:02:27" title="咸鸭蛋
日期:2011-05-10 13:02:27"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/sx2007-02small.gif" alt="生肖徽章2007版:牛
日期:2009-03-02 15:43:25" title="生肖徽章2007版:牛
日期:2009-03-02 15:43:25"></p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=friend&amp;op=add&amp;uid=4613&amp;handlekey=addfriendhk_4613" title="加好友" target="_blank">加好友</a></li>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=pm&amp;op=showmsg&amp;handlekey=showmsg_4613&amp;touid=4613&amp;pmid=0&amp;daterange=2&amp;pid=539537&amp;tid=96851" title="发消息" target="_blank">发消息</a>
<strong><a href="http://www.itpub.net/forum.php?mod=redirect&amp;goto=findpost&amp;ptid=96851&amp;pid=539537" target="_blank"><em>7</em>/#</a></strong></li>
</ul>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/online_moderator.gif" alt=""> <em>发表于 2003-2-21 13:01:54</em> |<a href="http://www.itpub.net/forum.php?mod=viewthread&amp;tid=96851&amp;page=1&amp;authorid=4613" target="_blank">只看该作者</a></p>
<p>参见此帖做法，使用PL/SQL代码实现：
<a href="http://www.itpub.net/showthread.php?threadid=96853" target="_blank"><a href="http://www.itpub.net/showthread.php?threadid=96853">http://www.itpub.net/showthread.php?threadid=96853</a></a>  <a href="">使用道具</a> <a href="">举报</a>
**</p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=namepost&amp;idtype=pid&amp;id=539537:96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/namepost.small.gif" alt="">显身卡</a>
*
<a href="http://www.itpub.net/space-uid-4218.html" target="_blank">xallan</a></li>
</ul>
<p><strong><a href="http://www.itpub.net/space-uid-4218.html" target="_blank">xallan</a></strong> <em>当前离线</em> UID4218阅读权限10帖子<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=thread&amp;type=reply&amp;view=me&amp;from=space" target="_blank">79</a>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">0</a>技术排名12897技术积分194社区排名20989社区积分6注册时间2001-12-28</p>
<p><a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=profile" title="查看详细资料" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/userinfo.gif" alt="查看详细资料"></a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=showip&amp;idtype=user&amp;id=xallan" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/showip.small.gif" alt=""> IP卡</a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=checkonline&amp;idtype=user&amp;id=xallan" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/checkonline.small.gif" alt=""> 狗仔卡</a>
<a href="http://www.itpub.net/space-uid-4218.html" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/noavatar_middle.gif" alt=""></a></p>
<p><em><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=usergroup&amp;gid=29" target="_blank">注册会员</a></em></p>
<p>一般会员</p>
<p>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=4218&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">0</a>技术积分194社区积分6注册时间2001-12-28 论坛徽章:1</p>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/medal_14_small.gif" alt="授权会员
日期:2005-10-30 17:05:33" title="授权会员
日期:2005-10-30 17:05:33"></p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=friend&amp;op=add&amp;uid=4218&amp;handlekey=addfriendhk_4218" title="加好友" target="_blank">加好友</a></li>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=pm&amp;op=showmsg&amp;handlekey=showmsg_4218&amp;touid=4218&amp;pmid=0&amp;daterange=2&amp;pid=539603&amp;tid=96851" title="发消息" target="_blank">发消息</a>
<strong><a href="http://www.itpub.net/forum.php?mod=redirect&amp;goto=findpost&amp;ptid=96851&amp;pid=539603" target="_blank"><em>8</em>/#</a></strong></li>
</ul>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/online_member.gif" alt=""> <em>发表于 2003-2-21 13:27:24</em> |<a href="http://www.itpub.net/forum.php?mod=viewthread&amp;tid=96851&amp;page=1&amp;authorid=4218" target="_blank">只看该作者</a></p>
<p>是的，写个function比较简单也挺好用。我最后也是用的function，而没有用那个lead函数，但他们还是挺牛。  <a href="">使用道具</a> <a href="">举报</a>
**</p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=namepost&amp;idtype=pid&amp;id=539603:96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/namepost.small.gif" alt="">显身卡</a>
*</li>
</ul>
<p><a href="http://www.itpub.net/space-uid-33612.html" target="_blank">xizi812</a></p>
<p><strong><a href="http://www.itpub.net/space-uid-33612.html" target="_blank">xizi812</a></strong> <em>当前离线</em> UID33612阅读权限10帖子<a href="http://www.itpub.net/home.php?mod=space&amp;uid=33612&amp;do=thread&amp;type=reply&amp;view=me&amp;from=space" target="_blank">37</a>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=33612&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">0</a>技术排名18274技术积分128社区排名30307社区积分3注册时间2003-1-3</p>
<p><a href="http://www.itpub.net/home.php?mod=space&amp;uid=33612&amp;do=profile" title="查看详细资料" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/userinfo.gif" alt="查看详细资料"></a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=showip&amp;idtype=user&amp;id=xizi812" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/showip.small.gif" alt=""> IP卡</a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=checkonline&amp;idtype=user&amp;id=xizi812" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/checkonline.small.gif" alt=""> 狗仔卡</a>
<a href="http://www.itpub.net/space-uid-33612.html" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/noavatar_middle.gif" alt=""></a></p>
<p><em><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=usergroup&amp;gid=29" target="_blank">注册会员</a></em></p>
<p>一般会员</p>
<p>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=33612&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">0</a>技术积分128社区积分3注册时间2003-1-3 论坛徽章:0</p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=friend&amp;op=add&amp;uid=33612&amp;handlekey=addfriendhk_33612" title="加好友" target="_blank">加好友</a></li>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=pm&amp;op=showmsg&amp;handlekey=showmsg_33612&amp;touid=33612&amp;pmid=0&amp;daterange=2&amp;pid=541053&amp;tid=96851" title="发消息" target="_blank">发消息</a>
<strong><a href="http://www.itpub.net/forum.php?mod=redirect&amp;goto=findpost&amp;ptid=96851&amp;pid=541053" target="_blank"><em>9</em>/#</a></strong></li>
</ul>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/online_member.gif" alt=""> <em>发表于 2003-2-22 10:07:58</em> |<a href="http://www.itpub.net/forum.php?mod=viewthread&amp;tid=96851&amp;page=1&amp;authorid=33612" target="_blank">只看该作者</a></p>
<p>佩服！！牛！！  <a href="">使用道具</a> <a href="">举报</a>
**</p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=namepost&amp;idtype=pid&amp;id=541053:96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/namepost.small.gif" alt="">显身卡</a>
*
<a href="http://www.itpub.net/space-uid-10589.html" target="_blank">snowsun</a></li>
</ul>
<p><strong><a href="http://www.itpub.net/space-uid-10589.html" target="_blank">snowsun</a></strong> <em>当前离线</em> UID10589阅读权限10帖子<a href="http://www.itpub.net/home.php?mod=space&amp;uid=10589&amp;do=thread&amp;type=reply&amp;view=me&amp;from=space" target="_blank">297</a>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=10589&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">0</a>技术排名4121技术积分650社区排名5739社区积分80注册时间2002-4-26</p>
<p><a href="http://www.itpub.net/home.php?mod=space&amp;uid=10589&amp;do=profile" title="查看详细资料" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/userinfo.gif" alt="查看详细资料"></a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=showip&amp;idtype=user&amp;id=snowsun" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/showip.small.gif" alt=""> IP卡</a> <a href="http://www.itpub.net/home.php?mod=magic&amp;mid=checkonline&amp;idtype=user&amp;id=snowsun" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/checkonline.small.gif" alt=""> 狗仔卡</a>
<a href="http://www.itpub.net/space-uid-10589.html" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/noavatar_middle.gif" alt=""></a></p>
<p><em><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=usergroup&amp;gid=29" target="_blank">注册会员</a></em></p>
<p>笨牛</p>
<p>精华贴数<a href="http://www.itpub.net/home.php?mod=space&amp;uid=10589&amp;do=thread&amp;type=digest&amp;view=me&amp;from=space" target="_blank">0</a>技术积分650社区积分80注册时间2002-4-26 论坛徽章:1</p>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/medal_14_small.gif" alt="授权会员
日期:2005-10-30 17:05:33" title="授权会员
日期:2005-10-30 17:05:33"></p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=friend&amp;op=add&amp;uid=10589&amp;handlekey=addfriendhk_10589" title="加好友" target="_blank">加好友</a></li>
<li><a href="http://www.itpub.net/home.php?mod=spacecp&amp;ac=pm&amp;op=showmsg&amp;handlekey=showmsg_10589&amp;touid=10589&amp;pmid=0&amp;daterange=2&amp;pid=541293&amp;tid=96851" title="发消息" target="_blank">发消息</a>
<strong><a href="http://www.itpub.net/forum.php?mod=redirect&amp;goto=findpost&amp;ptid=96851&amp;pid=541293" target="_blank"><em>10</em>/#</a></strong></li>
</ul>
<p><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/online_member.gif" alt=""> <em>发表于 2003-2-22 13:24:11</em> |<a href="http://www.itpub.net/forum.php?mod=viewthread&amp;tid=96851&amp;page=1&amp;authorid=10589" target="_blank">只看该作者</a></p>
<p>谢天谢地，我正在为这个东东老火，没有想到楼主也遇到了.
扎扎实实的学了一招.  <a href="">使用道具</a> <a href="">举报</a>
**</p>
<ul>
<li><a href="http://www.itpub.net/home.php?mod=magic&amp;mid=namepost&amp;idtype=pid&amp;id=541293:96851" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/namepost.small.gif" alt="">显身卡</a>
*
IT168文库精选文档推荐 <a href="http://wenku.it168.com/d_000088434.shtml" title="一条SQL语句的优化过程.doc" target="_blank">一条SQL语句的优化过程.doc</a>    <a href="http://wenku.it168.com/d_000086681.shtml" title="VC++6.0访问Oracle数据库技术.pdf" target="_blank">VC++6.0访问Oracle数据库技术.pdf</a>    <a href="http://wenku.it168.com/d_000090952.shtml" title="oracle新手必备17.ppt" target="_blank">oracle新手必备17.ppt</a>    <a href="http://wenku.it168.com/d_000091415.shtml" title="用DBMSDDL包重新编译PL.doc" target="_blank">用DBMSDDL包重新编译PL.doc</a>    <a href="http://wenku.it168.com/d_000087843.shtml" title="第十四章 数据库管理员.pdf" target="_blank">第十四章 数据库管理员.pdf</a>    </li>
</ul>
<p><strong>1</strong><a href="http://www.itpub.net/thread-96851-2-1.html" target="_blank">2</a><a href="http://www.itpub.net/thread-96851-3-1.html" target="_blank">3</a><a href="http://www.itpub.net/thread-96851-2-1.html" target="_blank">下一页</a><a href="http://www.itpub.net/forum-2-1.html" target="_blank">返回列表</a> <a href="&quot;发新帖&quot;"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/pn_post.png" alt="发新帖"></a>
<a href="http://www.itpub.net/forum.php?mod=post&amp;action=reply&amp;fid=2&amp;tid=96851" target="_blank">高级模式</a></p>
<p><a href="&quot;文字加粗&quot;">B</a> <a href="&quot;设置文字颜色&quot;">Color</a> <a href="&quot;图片&quot;">Image</a> <a href="&quot;添加链接&quot;">Link</a> <a href="&quot;引用&quot;">Quote</a> <a href="&quot;代码&quot;">Code</a> <a href="">Smilies</a></p>
<p>您需要登录后才可以回帖 <a href="http://www.itpub.net/member.php?mod=logging&amp;action=login" target="_blank">登录</a> | <a href="http://www.itpub.net/member.php?mod=register.php" target="_blank">注册</a> <a href="http://www.itpub.net/connect.php?mod=login&amp;op=init&amp;referer=forum.php%3Fmod%3Dviewthread%26tid%3D96851&amp;statfrom=login" target="_blank"><img src="http://./如何写这个sql语句 _Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区_files/qq_login.gif" alt=""></a></p>
<p><strong>发表回复</strong> 回帖后跳转到最后一页</p>
<h3 id="-">浏览过的版块</h3>
<ul>
<li><a href="http://www.itpub.net/forum-3-1.html" target="_blank">Oracle开发</a>
<a href="">TOP</a><a href="http://www.itpub.net/techmatch.php" target="_blank">技术积分榜</a> <a href="http://www.itpub.net/forummatch.php" target="_blank">社区积分榜</a> <a href="http://www.itpub.net/plugin.php?id=itpub_medal:medal_list" target="_blank">徽章</a> <a href="http://epub.itpub.net/" target="_blank">电子杂志</a> <a href="http://www.itpub.net/misc.php?mod=stat&amp;op=team" target="_blank">团队</a> <a href="http://www.itpub.net/misc.php?mod=stat" target="_blank">统计</a> <a href="http://email.itpub.net/" target="_blank">邮箱</a> <a href="http://www.tigerbar.net/" target="_blank">虎吧</a> <a href="http://weblog.itpub.net/" target="_blank">老博客</a> <a href="http://www.itpub.net/archiver/" target="_blank">文本模式</a> <a href="http://www.itpub.net/misc.php?mod=faq" target="_blank">帮助</a></li>
</ul>
<p>CopyRight 1999-2011 itpub.net All Right Reserved. 北京皓辰网域网络信息技术有限公司版权所有　<a href="http://www.itpub.net/contactus.php" target="_blank">联系我们</a>　<a href="http://www.itpub.net/footer_wzls.php" target="_blank">网站律师</a>　<a href="http://www.itpub.net/footer_ys.php" target="_blank">隐私政策</a>　<a href="http://www.itpub.net/footer_zscq.php" target="_blank">知识产权声明</a>
<a href="http://www.it168.com/images/icp.jpg" target="_blank">京ICP证:060528号</a>　北京市公安局海淀分局网监中心备案编号：1101082001　广播电视节目制作经营许可证：编号（京）字第1149号<br>积分 0, 距离下一级还需 积分  回顶部</p>
<p><a href="http://www.itpub.net/forum.php?gid=1" target="_blank">≡ 数据库技术 ≡</a></p>
<ul>
<li><a href="http://www.itpub.net/forum-2-1.html" target="_blank">Oracle数据库管理</a></li>
<li><a href="http://www.itpub.net/forum-205-1.html" target="_blank">Oracle高可用</a></li>
<li><a href="http://www.itpub.net/forum-3-1.html" target="_blank">Oracle开发</a></li>
<li><a href="http://www.itpub.net/forum-4-1.html" target="_blank">Oracle入门与认证</a></li>
<li><a href="http://www.itpub.net/forum-67-1.html" target="_blank">Oracle专题深入讨论</a></li>
<li><a href="http://www.itpub.net/forum-70-1.html" target="_blank">Oracle新技术/11gR2</a></li>
<li><a href="http://www.itpub.net/forum-72-1.html" target="_blank">Oracle电子文档</a></li>
<li><a href="http://www.itpub.net/forum-69-1.html" target="_blank">Oracle Fusion中间件</a></li>
<li><a href="http://www.itpub.net/forum-143-1.html" target="_blank">IBM DB2数据库管理与开发</a></li>
<li><a href="http://www.itpub.net/forum-40-1.html" target="_blank">MS SQL Server</a></li>
<li><a href="http://www.itpub.net/forum-98-1.html" target="_blank">Sybase管理与开发</a></li>
<li><a href="http://www.itpub.net/forum-73-1.html" target="_blank">MySQL及其它开源数据库</a></li>
<li><a href="http://www.itpub.net/forum-237-1.html" target="_blank">国内数据库产品</a></li>
<li><a href="http://www.itpub.net/forum-234-1.html" target="_blank">NoSQL</a></li>
<li><a href="http://www.itpub.net/forum-162-1.html" target="_blank">内存数据库</a></li>
<li><a href="http://www.itpub.net/forum-238-1.html" target="_blank">列式数据库</a></li>
<li><a href="http://www.itpub.net/forum-43-1.html" target="_blank">数据仓库与数据挖掘</a></li>
<li><a href="http://www.itpub.net/forum-148-1.html" target="_blank">移动及嵌入式数据库</a></li>
<li><a href="http://www.itpub.net/forum-239-1.html" target="_blank">Hadoop与分布式数据处理</a><a href="http://www.itpub.net/forum.php?gid=71" target="_blank">≡ 企业信息化 ≡</a></li>
<li><a href="http://www.itpub.net/forum-5-1.html" target="_blank">ERP产品与实践</a></li>
<li><a href="http://www.itpub.net/forum-83-1.html" target="_blank">CRM产品与实践</a></li>
<li><a href="http://www.itpub.net/forum-89-1.html" target="_blank">HR产品与实践</a></li>
<li><a href="http://www.itpub.net/forum-228-1.html" target="_blank">PLM/PDM产品与实践</a></li>
<li><a href="http://www.itpub.net/forum-214-1.html" target="_blank">云计算和SaaS产品与实践</a></li>
<li><a href="http://www.itpub.net/forum-116-1.html" target="_blank">物流</a></li>
<li><a href="http://www.itpub.net/forum-65-1.html" target="_blank">供应链</a></li>
<li><a href="http://www.itpub.net/forum-93-1.html" target="_blank">供应链建模与仿真</a></li>
<li><a href="http://www.itpub.net/forum-106-1.html" target="_blank">物流设备与系统工程</a></li>
<li><a href="http://www.itpub.net/forum-137-1.html" target="_blank">企业管理咨询</a></li>
<li><a href="http://www.itpub.net/forum-138-1.html" target="_blank">管理协同与办公自动化</a></li>
<li><a href="http://www.itpub.net/forum-139-1.html" target="_blank">IT服务管理</a></li>
<li><a href="http://www.itpub.net/forum-169-1.html" target="_blank">数据中心建设与设备采购</a></li>
<li><a href="http://www.itpub.net/forum-56-1.html" target="_blank">ERP二次开发</a></li>
<li><a href="http://www.itpub.net/forum-46-1.html" target="_blank">Oracle ERP</a></li>
<li><a href="http://www.itpub.net/forum-204-1.html" target="_blank">Oracle EBS R12</a></li>
<li><a href="http://www.itpub.net/forum-130-1.html" target="_blank">PeopleSoft与JDE</a></li>
<li><a href="http://www.itpub.net/forum-163-1.html" target="_blank">EBS相关文档</a></li>
<li><a href="http://www.itpub.net/forum-236-1.html" target="_blank">Oracle EBS DBA</a></li>
<li><a href="http://www.itpub.net/forum-45-1.html" target="_blank">SAP R/3</a></li>
<li><a href="http://www.itpub.net/forum-105-1.html" target="_blank">SAP Business One开发与快速实施</a></li>
<li><a href="http://www.itpub.net/forum-155-1.html" target="_blank">SAP财务及CRM</a></li>
<li><a href="http://www.itpub.net/forum-154-1.html" target="_blank">SAP后勤及HR</a></li>
<li><a href="http://www.itpub.net/forum-157-1.html" target="_blank">mySAP ERP</a></li>
<li><a href="http://www.itpub.net/forum-156-1.html" target="_blank">系统开发及跨应用设置</a></li>
<li><a href="http://www.itpub.net/forum-113-1.html" target="_blank">SAP相关文档</a></li>
<li><a href="http://www.itpub.net/forum-166-1.html" target="_blank">国外其它ERP产品</a></li>
<li><a href="http://www.itpub.net/forum-109-1.html" target="_blank">国内ERP产品</a><a href="http://www.itpub.net/forum.php?gid=33" target="_blank">≡ 开发技术 ≡</a></li>
<li><a href="http://www.itpub.net/forum-128-1.html" target="_blank">Java入门与认证版</a></li>
<li><a href="http://www.itpub.net/forum-123-1.html" target="_blank">Java web开发及框架技术</a></li>
<li><a href="http://www.itpub.net/forum-32-1.html" target="_blank">Java企业开发</a></li>
<li><a href="http://www.itpub.net/forum-76-1.html" target="_blank">WEB程序开发</a></li>
<li><a href="http://www.itpub.net/forum-118-1.html" target="_blank">WEB 2.0技术</a></li>
<li><a href="http://www.itpub.net/forum-119-1.html" target="_blank">动态语言</a></li>
<li><a href="http://www.itpub.net/forum-91-1.html" target="_blank">移动与游戏开发</a><a href="http://www.itpub.net/forum.php?gid=170" target="_blank">≡ 微软技术 ≡</a></li>
<li><a href="http://www.itpub.net/forum-176-1.html" target="_blank">微软产品用户交流区</a></li>
<li><a href="http://www.itpub.net/forum-201-1.html" target="_blank">.Net人才交流</a></li>
<li><a href="http://www.itpub.net/forum-200-1.html" target="_blank">.Net电子书籍&amp;&amp;书籍介绍</a></li>
<li><a href="http://www.itpub.net/forum-171-1.html" target="_blank">开发工具和语言</a></li>
<li><a href="http://www.itpub.net/forum-177-1.html" target="_blank">.NET Framework 相关</a></li>
<li><a href="http://www.itpub.net/forum-181-1.html" target="_blank">Visual Basic/VB.net</a></li>
<li><a href="http://www.itpub.net/forum-179-1.html" target="_blank">Visual C/#</a></li>
<li><a href="http://www.itpub.net/forum-180-1.html" target="_blank">Visual C++/vc.net</a></li>
<li><a href="http://www.itpub.net/forum-183-1.html" target="_blank">Visual Studio</a></li>
<li><a href="http://www.itpub.net/forum-108-1.html" target="_blank">.NET软件架构与模式</a></li>
<li><a href="http://www.itpub.net/forum-187-1.html" target="_blank">.NET开发辅助工具及框架</a></li>
<li><a href="http://www.itpub.net/forum-172-1.html" target="_blank">Web开发</a></li>
<li><a href="http://www.itpub.net/forum-135-1.html" target="_blank">ASP.NET与AJAX</a></li>
<li><a href="http://www.itpub.net/forum-190-1.html" target="_blank">Web相关技术讨论(IIS等)</a></li>
<li><a href="http://www.itpub.net/forum-189-1.html" target="_blank">Silverlight 技术</a></li>
<li><a href="http://www.itpub.net/forum-174-1.html" target="_blank">微软企业级产品技术</a></li>
<li><a href="http://www.itpub.net/forum-196-1.html" target="_blank">Exchange Server</a></li>
<li><a href="http://www.itpub.net/forum-202-1.html" target="_blank">windows server</a></li>
<li><a href="http://www.itpub.net/forum-203-1.html" target="_blank">SQL Server</a></li>
<li><a href="http://www.itpub.net/forum-195-1.html" target="_blank">SharePoint</a></li>
<li><a href="http://www.itpub.net/forum-197-1.html" target="_blank">Biztalk</a></li>
<li><a href="http://www.itpub.net/forum-175-1.html" target="_blank">嵌入式及移动开发</a></li>
<li><a href="http://www.itpub.net/forum-198-1.html" target="_blank">Windows Embedded 嵌入式技术</a></li>
<li><a href="http://www.itpub.net/forum-199-1.html" target="_blank">Windows 移动设备</a></li>
<li><a href="http://www.itpub.net/forum-173-1.html" target="_blank">Office开发</a></li>
<li><a href="http://www.itpub.net/forum-191-1.html" target="_blank">Microsoft office system</a></li>
<li><a href="http://www.itpub.net/forum-193-1.html" target="_blank">Office Business Application</a><a href="http://www.itpub.net/forum.php?gid=121" target="_blank">≡ 软件工程与项目管理 ≡</a></li>
<li><a href="http://www.itpub.net/forum-16-1.html" target="_blank">系统设计与建模</a></li>
<li><a href="http://www.itpub.net/forum-20-1.html" target="_blank">数据建模</a></li>
<li><a href="http://www.itpub.net/forum-44-1.html" target="_blank">项目管理</a></li>
<li><a href="http://www.itpub.net/forum-216-1.html" target="_blank">项目管理文档资源</a></li>
<li><a href="http://www.itpub.net/forum-215-1.html" target="_blank">PMP认证</a></li>
<li><a href="http://www.itpub.net/forum-117-1.html" target="_blank">项目过程</a></li>
<li><a href="http://www.itpub.net/forum-160-1.html" target="_blank">软件测试</a></li>
<li><a href="http://www.itpub.net/forum-110-1.html" target="_blank">算法讨论与研究</a><a href="http://www.itpub.net/forum.php?gid=140" target="_blank">≡ IBM软件技术园地 ≡</a></li>
<li><a href="http://www.itpub.net/forum-39-1.html" target="_blank">IBM信息管理</a></li>
<li><a href="http://www.itpub.net/forum-144-1.html" target="_blank">Lotus</a></li>
<li><a href="http://www.itpub.net/forum-232-1.html" target="_blank">Mashup技术</a></li>
<li><a href="http://www.itpub.net/forum-151-1.html" target="_blank">Tivoli</a></li>
<li><a href="http://www.itpub.net/forum-149-1.html" target="_blank">Websphere</a></li>
<li><a href="http://www.itpub.net/forum-150-1.html" target="_blank">Rational</a></li>
<li><a href="http://www.itpub.net/forum-224-1.html" target="_blank">Jazz大赛专区</a></li>
<li><a href="http://www.itpub.net/forum-152-1.html" target="_blank">与SOA相关的IBM产品与技术</a></li>
<li><a href="http://www.itpub.net/forum-213-1.html" target="_blank">IBM蓝色之路</a></li>
<li><a href="http://www.itpub.net/forum-141-1.html" target="_blank">IBM软件技术精英协会</a></li>
<li><a href="http://www.itpub.net/forum-142-1.html" target="_blank">软件技术精英活动专版</a><a href="http://www.itpub.net/forum.php?gid=27" target="_blank">≡ 操作系统与硬件 ≡</a><a href="http://www.itpub.net/forum.php?gid=50" target="_blank">≡ 行业纵向讨论区 ≡</a></li>
<li><a href="http://www.itpub.net/forum-112-1.html" target="_blank">IT业界评论与展望</a></li>
<li><a href="http://www.itpub.net/forum-86-1.html" target="_blank">政府与教育事业</a></li>
<li><a href="http://www.itpub.net/forum-167-1.html" target="_blank">中国政府信息主管联盟</a></li>
<li><a href="http://www.itpub.net/forum-66-1.html" target="_blank">电信行业</a></li>
<li><a href="http://www.itpub.net/forum-68-1.html" target="_blank">金融行业</a></li>
<li><a href="http://www.itpub.net/forum-85-1.html" target="_blank">医卫行业</a></li>
<li><a href="http://www.itpub.net/forum-87-1.html" target="_blank">制造行业</a></li>
<li><a href="http://www.itpub.net/forum-159-1.html" target="_blank">电力行业</a></li>
<li><a href="http://www.itpub.net/forum-51-1.html" target="_blank">信息安全与审计</a><a href="http://www.itpub.net/forum.php?gid=7" target="_blank">≡ 会员交流 ≡</a></li>
<li><a href="http://www.itpub.net/forum-146-1.html" target="_blank">IT职业生涯</a></li>
<li><a href="http://www.itpub.net/forum-11-1.html" target="_blank">招聘求职商务信息</a></li>
<li><a href="http://www.itpub.net/forum-147-1.html" target="_blank">投资理财</a></li>
<li><a href="http://www.itpub.net/forum-41-1.html" target="_blank">体育世界</a></li>
<li><a href="http://www.itpub.net/forum-131-1.html" target="_blank">体育博彩专版</a></li>
<li><a href="http://www.itpub.net/forum-165-1.html" target="_blank">汽车世界</a></li>
<li><a href="http://www.itpub.net/forum-114-1.html" target="_blank">旅游，驴友</a></li>
<li><a href="http://www.itpub.net/forum-82-1.html" target="_blank">外语角</a></li>
<li><a href="http://www.itpub.net/forum-115-1.html" target="_blank">数码摄影</a></li>
<li><a href="http://www.itpub.net/forum-61-1.html" target="_blank">电子图书与IT文档资料</a></li>
<li><a href="http://www.itpub.net/forum-10-1.html" target="_blank">软件交流</a></li>
<li><a href="http://www.itpub.net/forum-22-1.html" target="_blank">软件交流精华区</a><a href="http://www.itpub.net/forum.php?gid=102" target="_blank">≡ ITPUB产品与服务 ≡</a></li>
<li><a href="http://www.itpub.net/forum-134-1.html" target="_blank">ITPUB地面活动专版</a></li>
<li><a href="http://www.itpub.net/forum-84-1.html" target="_blank">BLOG天地</a></li>
<li><a href="http://www.itpub.net/forum-15-1.html" target="_blank">授权用户区</a></li>
<li><a href="http://www.itpub.net/forum-9-1.html" target="_blank">站务管理</a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/oracle/">oracle</a></li><li><a href="/categories/DB/oracle/oracle-/">oracle-</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/oracle/" class="label label-success">oracle</a><a href="/tags/oracle-/" class="label label-info">oracle-</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:35"datetime="2014-03-07 09:54:35"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-oracle-oracle---如何写这个sql语句_Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-oracle-oracle---如何写这个sql语句_Oracle数据库管理_ITPUB论坛-it168旗下专业技术社区" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB--SQL--JOIN之完全用法版本2/">SQL</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:35.000Z"> <a href="/2014/02/02/2014-02-02-DB--SQL--JOIN之完全用法版本2/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="sql-join-2-">SQL--JOIN之完全用法(版本2)</h1>
<h1 id="-zwws-s-blog-http-www-phpweblog-net-zwws-"><a href="http://www.phpweblog.net/zwws/" target="_blank">zwws&#39;s blog</a></h1>
<p>Blog For PHP Learning...</p>
<p>  <a href="http://www.phpweblog.net/" target="_blank">PHP博客</a> :: <a href="http://www.phpweblog.net/zwws/" target="_blank">首页</a> :: <a href="http://www.phpweblog.net/zwws/contact.aspx" target="_blank">联系</a> :: <a href="http://www.phpweblog.net/zwws/Rss.aspx" target="_blank">聚合</a> <a href="http://www.phpweblog.net/zwws/Rss.aspx" target="_blank"><img src="" alt=""></a> :: <a href="http://www.phpweblog.net/zwws/admin/EditPosts.aspx" target="_blank">管理</a>   6 Posts :: 0 Stories :: 15 Comments :: 0 Trackbacks</p>
<h3 id="-1-">留言簿(1)</h3>
<ul>
<li><a href="http://www.phpweblog.net/zwws/Contact.aspx?id=1" target="_blank">给我留言</a></li>
<li><a href="http://www.phpweblog.net/zwws/default.aspx?opt=msg" target="_blank">查看公开留言</a></li>
<li><a href="http://www.phpweblog.net/zwws/admin/MyMessages.aspx" target="_blank">查看私人留言</a></li>
</ul>
<h3 id="-">我参与的团队</h3>
<h3 id="-">随笔分类</h3>
<ul>
<li><a href="http://www.phpweblog.net/zwws/category/174.html" target="_blank">PHP技巧(2)</a> <a href="http://www.phpweblog.net/zwws/category/174.html/rss" title="Subscribe to PHP技巧(2)" target="_blank"><img src="&quot;Subscribe to PHP技巧(2" alt="rss">&quot;)</a></li>
<li><a href="http://www.phpweblog.net/zwws/category/175.html" target="_blank">PHP思路</a> <a href="http://www.phpweblog.net/zwws/category/175.html/rss" title="Subscribe to PHP思路" target="_blank"><img src="&quot;Subscribe to PHP思路&quot;" alt="rss"></a></li>
<li><a href="http://www.phpweblog.net/zwws/category/176.html" target="_blank">PHP游戏(1)</a> <a href="http://www.phpweblog.net/zwws/category/176.html/rss" title="Subscribe to PHP游戏(1)" target="_blank"><img src="&quot;Subscribe to PHP游戏(1" alt="rss">&quot;)</a></li>
<li><a href="http://www.phpweblog.net/zwws/category/177.html" target="_blank">SQL技巧(2)</a> <a href="http://www.phpweblog.net/zwws/category/177.html/rss" title="Subscribe to SQL技巧(2)" target="_blank"><img src="&quot;Subscribe to SQL技巧(2" alt="rss">&quot;)</a></li>
</ul>
<h3 id="-">随笔档案</h3>
<ul>
<li><a href="http://www.phpweblog.net/zwws/archive/2007/02.html" target="_blank">2007年2月 (6)</a></li>
</ul>
<h3 id="-">搜索</h3>
<p>*</p>
<ul>
<li></li>
</ul>
<h3 id="-http-www-phpweblog-net-zwws-commentsrss-aspx-">最新评论 <a href="http://www.phpweblog.net/zwws/CommentsRSS.aspx" target="_blank"><img src="" alt=""></a></h3>
<ul>
<li><a href="http://www.phpweblog.net/zwws/archive/2008/06/04/944.html#4398" target="_blank">1. re: sql的left join 命令详解</a></li>
<li>的确不错啊<del>~很详细</del>谁都能理解 谢谢</li>
<li>--文祥</li>
<li><a href="http://www.phpweblog.net/zwws/archive/2008/04/27/944.html#3277" target="_blank">2. re: sql的left join 命令详解</a></li>
<li>评论内容较长,点击标题查看</li>
<li>--joe</li>
<li><a href="http://www.phpweblog.net/zwws/archive/2008/04/02/921.html#3124" target="_blank">3. re: 顺序输出 123A, 123B,123C... 实现方式。</a></li>
<li>sdfsd</li>
<li>--21312</li>
<li><a href="http://www.phpweblog.net/zwws/archive/2008/03/28/944.html#3074" target="_blank">4. re: sql的left join 命令详解</a></li>
<li>牛人！！！！</li>
<li>--深山狩猎人</li>
<li><a href="http://www.phpweblog.net/zwws/archive/2008/03/17/944.html#2987" target="_blank">5. re: sql的left join 命令详解[未登录]</a></li>
<li>评论内容较长,点击标题查看</li>
<li>--ruderal</li>
</ul>
<h3 id="-">阅读排行榜</h3>
<ul>
<li><a href="http://www.phpweblog.net/zwws/archive/2007/02/23/944.aspx" target="_blank">1. sql的left join 命令详解(23763)</a></li>
<li><a href="http://www.phpweblog.net/zwws/archive/2007/02/23/946.aspx" target="_blank">2. SQL--JOIN之完全用法(版本2)(7393)</a></li>
<li><a href="http://www.phpweblog.net/zwws/archive/2007/02/23/945.aspx" target="_blank">3. SQL--JOIN之完全用法(版本1)(1198)</a></li>
<li><a href="http://www.phpweblog.net/zwws/archive/2007/02/18/921.aspx" target="_blank">4. 顺序输出 123A, 123B,123C... 实现方式。(300)</a></li>
<li><a href="http://www.phpweblog.net/zwws/archive/2007/02/18/920.aspx" target="_blank">5. PHP代码收集<a href="263">标哥版</a></a></li>
</ul>
<h3 id="-">评论排行榜</h3>
<ul>
<li><a href="http://www.phpweblog.net/zwws/archive/2007/02/23/944.aspx" target="_blank">1. sql的left join 命令详解(11)</a></li>
<li><a href="http://www.phpweblog.net/zwws/archive/2007/02/23/946.aspx" target="_blank">2. SQL--JOIN之完全用法(版本2)(2)</a></li>
<li><a href="http://www.phpweblog.net/zwws/archive/2007/02/23/945.aspx" target="_blank">3. SQL--JOIN之完全用法(版本1)(1)</a></li>
<li><a href="http://www.phpweblog.net/zwws/archive/2007/02/18/921.aspx" target="_blank">4. 顺序输出 123A, 123B,123C... 实现方式。(1)</a></li>
<li><a href="http://www.phpweblog.net/zwws/archive/2007/02/19/922.aspx" target="_blank">5. php实现首页自动选择语言转跳(0)</a></li>
</ul>
<p>*
 <a href="http://www.phpweblog.net/zwws/archive/2007/02/23/946.html" target="_blank">SQL--JOIN之完全用法(版本2)</a></p>
<p>在我叙述 JOIN 的用法前，我先引用数据库设计中最常见的范式资料。</p>
<p>第三范式（ 3NF ）：如果关系模式 R （ U ， F ）中的所有非主属性对任何候选关键字都不存在传递信赖，则称关系 R 是属于第三范式的。</p>
<p>例：如 S1 （ SNO ， SNAME ， DNO ， DNAME ， LOCATION ） 各属性分别代表学号，姓名，所在系，系名称，系地址。</p>
<p>关键字 SNO 决定各个属性。由于是单个关键字，没有部分依赖的问题，肯定是 2NF 。但这关系肯定有大量的冗余，有关学生所在的几个属性 DNO ， DNAME ， LOCATION 将重复存储，插入，删除和修改时也将产生类似以上例的情况。</p>
<p>原因：关系中存在传递依赖造成的。由于 SNAME 和 DNO 是依赖 SNO ，而 DNAME 和 LOCATION 是依赖 DNO 的，即通过一个学号可以知道该学生的姓名以及他所在系代码，但无法由学号知道系地址，学号和系地址间是通过学号所对应的学生的所在系关联的， 因此关键字 SNO 对 LOCATION 函数决定是通过传递依赖 DNO -&gt; LOCATION 实现的。也就是说， SNO 不直接决定非主属性 LOCATION 。</p>
<p>解决目地：每个关系模式中不能留有传递依赖。</p>
<p>解决方法：分为两个关系 S （ SNO ， SNAME ， DNO ）， D （ DNO ， DNAME ， LOCATION ）</p>
<p>注意：关系 S 中不能没有外关键字 DNO 。否则两个关系之间失去联系。</p>
<p>在数据库的设计过程中常常按照第三范式来设计数据库，当然在有些场合为优化数据库的性能而增加了相关冗余字段以使表的结构不符合 3NF ，在多数场合中，没有一张表能完整的发挥客户所需要的结果集。这样就需要通过联接多张在逻辑上存在依赖关系的表，选择你所需要的数据。    </p>
<p>在使用 JOIN 前，必须明白是通过联接，根据各个表之间的逻辑关系从相关表中检索数据。通过 SQL Server 自带帮助文件，可以清楚的知道：可在 FROM 或 WHERE 子句中指定联接。</p>
<h2 id="-1-1-where-"><a href="">1.1.         在 WHERE</a>子句中指定联接</h2>
<p>下例使用 WHERE 子句进行表之间的</p>
<p>SELECT A.SYMBOL,A.SNAME,B.TDATE,B.CLOSE</p>
<p>FROM SECURITYCODE A,DAYQUOTE B</p>
<p>WHERE A.SYMBOL =B.SYMBOL</p>
<pre><code>AND  B.TDATE &gt;= A.LISTDATE

AND A.SYMBOL LIKE  &#39;600%&#39;
</code></pre><p>在上例中联接的表 A 与表 B 通过 A.SYMBOL =B.SYMBOL 这个条件联接，筛选条件为 B.TDATE 不小于 A. LISTDATE 。</p>
<p>在 WHERE 子句中指定联接，对于较简单的联接，使用这种方式可能较方便，但综合来说，不推荐使用该语法联接表。</p>
<h2 id="-1-2-from-"><a href="">1.2.         在 FROM</a>子句中指定联接</h2>
<p>拿上面的例子来详细说，表 SECURITYCODE 中主要存放证券代码的基本信息，表中的 SYMBOL 代表股票代码， SNAME 代表股票名称， LISTDATE 代表上市日期；表 DAYQUOTE 中主要存放股票的每日行情。 SYMBOL 代表股票代码， TDATE 代表交易日期， CLOSE 代表收盘价。</p>
<p>我现在的取值逻辑是：取出股票代码以 600 打头的股票自上市日期以来的所有交易日的收盘价。将 SECURITYCODE 与 DAYQUOTE 通过 SYMBOL 联接。</p>
<p>SELECT A.SYMBOL,A.SNAME,B.TDATE,B. CLOSE</p>
<p>FROM SECURITYCODE A</p>
<p>JOIN DAYQUOTE B</p>
<pre><code>ON A.SYMBOL =B.SYMBOL
</code></pre><p>WHERE  B.TDATE &gt;= A.LISTDATE</p>
<pre><code>AND A.SYMBOL LIKE &#39;600%&#39;
</code></pre><p>ORDER BY A.SYMBOL,B.TDATE</p>
<p>对于使用 FROM 子句方式联接表，可以很清楚的看出表之间的联接条件。就可读性以及后续的可修改性与 WHERE 子句相比有较大的优势。</p>
<p>下面就联接的方式引用帮助文件中的具体介绍，联接可以分为以下几种：</p>
<h2 id="-1-3-"><a href="">1.3.         内联接</a></h2>
<p>内联接（典型的联接运算，使用像 = 或 &lt;&gt; 之类的比较运算符）。包括相等联接和自然联接。</p>
<p>内联接使用比较运算符根据每个表共有的列的值匹配两个表中的行。</p>
<p>在 SQL-92 标准中，内联接可在 FROM 或 WHERE 子句中指定。这是 WHERE 子句中唯一一种 SQL-92 支持的联接类型。 WHERE 子句中指定的内联接称为旧式内联接。</p>
<p>内联接一般常见写法：</p>
<p>SELECT A.COLUMN1,[A.COLUMN2],B.COLUMN1,[B.COLUMN2]</p>
<p>FROM  TABLE1 A</p>
<p>[INNER] JOIN TABLE2 B</p>
<pre><code>ON A.COLUMN0 = B.COLUMN0
</code></pre><p>在查询分析器中使用 INNER JOIN 时常常省略 INNER 。</p>
<h2 id="-1-4-"><a href="">1.4.         外联接</a></h2>
<p>外联接可以是左向外联接、右向外联接或完整外部联接。</p>
<p>在 FROM 子句中指定外联接时，可以由下列几组关键字中的一组指定：</p>
<p><strong>LEFT JOIN**</strong>或 LEFT OUTER JOIN**</p>
<p>左向外联接的结果集包括 LEFT OUTER 子句中指定的左表的所有行，而不仅仅是联接列所匹配的行。如果左表的某行在右表中没有匹配行，则在相关联的结果集行中右表的所有选择列表列均为空值。</p>
<p><strong>RIGHT JOIN**</strong>或 RIGHT OUTER JOIN**</p>
<p>右向外联接是左向外联接的反向联接。将返回右表的所有行。如果右表的某行在左表中没有匹配行，则将为左表返回空值。</p>
<p><strong>FULL JOIN**</strong>或 FULL OUTER JOIN**</p>
<p>完整外部联接返回左表和右表中的所有行。当某行在另一个表中没有匹配行时，则另一个表的选择列表列包含空值。如果表之间有匹配行，则整个结果集行包含基表的数据值。</p>
<p>仅当至少有一个同属于两表的行符合联接条件时，内联接才返回行。内联接消除与另一个表中的任何行不匹配的行。而外联接会返回 FROM 子句中提到的至少一个表或视图的所有行，只要这些行符合任何 WHERE 或 HAVING 搜索条件。将检索通过左向外联接引用的左表的所有行，以及通过右向外联接引用的右表的所有行。完整外部联接中两个表的所有行都将返回。</p>
<p>外联接的中常见的是 LEFT JOIN ，将 LEFT JOIN 用熟已经可以解决大半问题了。</p>
<p>外联接的一般写法：</p>
<p>SELECT A.COLUMN1,[A.COLUMN2],B.COLUMN1,[B.COLUMN2]</p>
<p>FROM  TABLE1 A</p>
<p>LEFT|RIGHT|FULL [OUTER] JOIN TABLE2 B</p>
<pre><code>ON A.COLUMN0 = B.COLUMN0
</code></pre><p>在查询分析器中使用 OUTER JOIN 时常常省略 OUTER 。 LEFT 和 RIGHT 只是方向问题，在特定场合下， FULL OUTER JOIN 相当于 LEFT OUTER JOIN 和 RIGHT OUTER JOIN 的消除重复行的合集。</p>
<h2 id="-1-5-"><a href="">1.5.         交叉联接</a></h2>
<p>交叉联接返回左表中的所有行，左表中的每一行与右表中的所有行组合。交叉联接也称作笛卡尔积。</p>
<p>没有 WHERE 子句的交叉联接将产生联接所涉及的表的笛卡尔积。第一个表的行数乘以第二个表的行数等于笛卡尔积结果集的大小。也就是说在没有 WHERE 子句的情况下，若表 A 有 3 行记录，表 B 有 6 行记录 : ：</p>
<p>SELECT  A./<em>,B./</em>  FROM 表A  CROSS  JOIN 表B</p>
<p>那以上语句会返回 18 行记录。</p>
<p>posted on 2007-02-23 20:58 <a href="http://www.phpweblog.net/zwws/" target="_blank">zwws</a> 阅读(7393) <a href="http://www.phpweblog.net/zwws/archive/2007/02/23/946.html#Post" target="_blank">评论(2)</a>  <a href="http://www.phpweblog.net/zwws/admin/EditPosts.aspx?postid=946" target="_blank">编辑</a> <a href="http://www.phpweblog.net/zwws/AddToFavorite.aspx?id=946" target="_blank">收藏</a> <a href="http://www.phpweblog.net/zwws/services/trackbacks/946.aspx" target="_blank">引用</a> <a href="">网摘</a><img src="" alt=""></p>
<p><a href=""></a><a href=""></a></p>
<h3 id="feedback">Feedback</h3>
<p><a href="http://www.phpweblog.net/zwws/archive/2007/02/23/946.html#1617" title="permalink: re: SQL--JOIN之完全用法(版本2)" target="_blank">/#</a> <a href=""></a>re: SQL--JOIN之完全用法(版本2) 2007-07-29 15:02 <a href="http://www.hoopower.com/">翡翠</a></p>
<p>全联怎么写
[<a href="http://www.hoopower.com/" target="_blank"><a href="http://www.hoopower.com/">http://www.hoopower.com/</a></a>]  <a href="http://www.phpweblog.net/zwws/archive/2007/02/23/946.html#post" target="_blank">回复</a>  <a href="http://www.phpweblog.net/comment?author=%e7%bf%a1%e7%bf%a0" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.phpweblog.net/zwws/archive/2007/02/23/946.html#2801" title="permalink: re: SQL--JOIN之完全用法(版本2)" target="_blank">/#</a> <a href=""></a>re: SQL--JOIN之完全用法(版本2)<a href=""></a> 2008-02-20 16:08 <a href="">hasiy</a></p>
<p>内容不错  <a href="http://www.phpweblog.net/zwws/archive/2007/02/23/946.html#post" target="_blank">回复</a>  <a href="http://www.phpweblog.net/comment?author=hasiy" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="">刷新评论列表</a></p>
<p><a href=""></a> 只有注册用户<a href="http://www.phpweblog.net/login.aspx?ReturnUrl=/zwws/archive/2007/02/23/946.html">登录</a>后才能发表评论, 未注册用户请先<a href="http://www.phpweblog.net/RequireRegister.aspx" target="_blank">注册</a>。  相关链接:  网站导航:</p>
<p><a href="http://www.cnblogs.com/" target="_blank">博客园</a>      <a href="http://www.blogjava.net/" target="_blank">BlogJava</a>   <a href="http://www.cnweblog.com/" target="_blank">博客生活</a>   <a href="http://www.cnitblog.com/" target="_blank">IT博客网</a>   <a href="http://www.cppblog.com/" target="_blank">C++博客</a>   <a href="http://www.phpweblog.net/" target="_blank">PHP博客</a>   <a href="http://space.cnblogs.com/" target="_blank">博客园社区</a>
<a href="http://www.manageblog.net/" target="_blank">管理博客</a>   <a href="http://www.teachblog.net/" target="_blank">教师博客</a>     <a href="http://www.astroblog.cn/" target="_blank">天文博客</a>   <a href="http://www.cnautoblog.com/" target="_blank">汽车博客</a>   <a href="http://www.zuqiublog.com/" target="_blank">足球博客</a>   <a href="http://www.gupiaoblog.com/" target="_blank">股票博客</a>   <a href="http://www.etronblog.com/" target="_blank">电子博客</a></p>
<p>Copyright @ zwws
Powered by: <a href="http://scottwater.com/blog" target="_blank">.Text</a> and <a href="http://asp.net/" target="_blank">ASP.NET</a>
Theme by: <a href="http://www.dotnetmonster.com/" target="_blank">.NET Monster</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:35"datetime="2014-03-07 09:54:35"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB--SQL--JOIN之完全用法版本2/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB--SQL--JOIN之完全用法版本2" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/115/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/113/">113</a></li><li><a class="page-number" href="/page/114/">114</a></li><li><a class="page-number" href="/page/115/">115</a></li><li class="active"><li><span class="page-number current">116</span></li><li><a class="page-number" href="/page/117/">117</a></li><li><a class="page-number" href="/page/118/">118</a></li><li><a class="page-number" href="/page/119/">119</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/163/">163</a></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="extend next" href="/page/117/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-03-29 22:06:56</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
