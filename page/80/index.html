
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 80 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--cas_presentation/">cas_presentation</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--cas_presentation/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas_presentation">cas_presentation</h1>
<p><img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Welcome! First of all, what is CAS?
●
●
Web single sign on Uses “federated” authentication, where all authentication is done by the CAS server, instead of individual application servers The implementation is an open source protocol, open source Java server, and several open source clients Purdue runs a CAS server, configured to authenticate with Purdue Career Account (<a href="https://www.purdue.edu/apps/account/cas" target="_blank">https://www.purdue.edu/apps/account/cas</a>) As of 4/5/2011, 349 application servers are authorized to check CAS tickets More can be found at:
– –
●
●
●
●
●
<a href="http://www.jasig.org/cas" target="_blank">http://www.jasig.org/cas</a> <a href="https://www.purdue.edu/apps/account/docs/CAS/CAS_information.jsp" target="_blank">https://www.purdue.edu/apps/account/docs/CAS/CAS_information.jsp</a>
Purdue University Identity and Access Management 1
4/7/2011
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
There are three machines in this game
●
a) Browser b) Application server
–
●
Configured with a CAS client to require authentication for certain urls Serves CAS login web page and authenticates users Issues TGT cookie (ticket granting ticket) so user does not have to login every redirect to CAS server Redirects back to application server with ticket=ST-xxx service ticket in url for CAS client to check Validates CAS service tickets for application servers
●
c) CAS server (<a href="http://www.jasig.org/cas" target="_blank">http://www.jasig.org/cas</a>)
– –
–
–
4/7/2011
Purdue University Identity and Access Management
2
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
Browser
1) initial request 2) redirect to CAS login page with service=url_back_to_sampleapp_page
sampleapp
CAS server
3) request CAS login page 4) html for CAS login page 5) POST login and password 6) set CASTGC cookie and redirect to sampleapp with ticket=ST-xxx 7) back to initial request, with ticket=ST-xxx (the service ticket) 10) sampleapp responds with application page 9)ticket validation response 8) validate ST-xxx service ticket
4/7/2011
Purdue University Identity and Access Management
3
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 1 – initial request
●
“sampleapp” application server is configured with a CAS client to require authentication for certain urls (in this example /test) User with browser accesses /test on sampleapp If browser does not already have session on sampleapp, sampleapp transfers control to the CAS client If the CAS client does not see a ticket parameter in the request, user is redirected back to the CAS login page with service=url_to_return_to, in this example <a href="http://localhost:8080/sampleapp/test" target="_blank">http://localhost:8080/sampleapp/test</a>
●
●
●
4/7/2011
Purdue University Identity and Access Management
4
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 2 – redirect to CAS login page
●
User is redirected back to CAS server for authentication Application server (sampleapp) logs
●
2011­03­29 09:16:46,843 DEBUG  [org.jasig.cas.client.authentication.AuthenticationFilter] ­ <no ticket and no  assertion found> 2011­03­29 09:16:46,843 DEBUG  [org.jasig.cas.client.authentication.AuthenticationFilter] ­ <Constructed service  url: http://localhost:8080/sampleapp/test/> 2011­03­29 09:16:46,844 DEBUG  [org.jasig.cas.client.authentication.AuthenticationFilter] ­ <redirecting to  "https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/login?service= 2F%2Flocalhost%3A8080%2Fsampleapp%2Ftest%2F"> application server access log: 0:0:0:0:0:0:0:1 ­ ­ [29/Mar/2011:09:16:46 ­0400] &quot;GET /sampleapp/test/ HTTP/1.1&quot;  302 ­
4/7/2011
Purdue University Identity and Access Management
5
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 3 – browser requests CAS login page
●
CAS server checks for its CASTGC cookie (ticket granting ticket), if it&#39;s there, user is already authenticated via CAS, skip to step 6 and redirect back to sampleapp with a service ticket If no CASTGC is present, serve browser the CAS login page CAS server access log:
●
●
0:0:0:0:0:0:0:1 ­ ­ [29/Mar/2011:09:16:47 ­0400] &quot;GET /cas­server­uber­webapp­ 3.4.6/login?service=http%3A%2F%2Flocalhost%3A8080%2Fsampleapp%2Ftest%2F HTTP/1.1&quot;  200 6935
4/7/2011
Purdue University Identity and Access Management
6
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 4 – CAS server sends login page to browser
●
This is nice because application servers do not need to
– – –
maintain their own login page maintain login/password credentials to do the actual authentication even see the password, it&#39;s between the browser and CAS server
4/7/2011
Purdue University Identity and Access Management
7
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 5 – browser POSTs login/password to CAS server
●
CAS server checks login and password, if authentication fails serve another login page to browser Too many unsuccessful authentication attempts in a short period of time will result in a “lockout”, where authentication will always fail for a 15 minute lockout period CAS server access log:
●
●
0:0:0:0:0:0:0:1 ­ ­ [29/Mar/2011:09:16:52 ­0400] &quot;POST /cas­server­uber­webapp­ 3.4.6/login?service=http%3A%2F%2Flocalhost%3A8080%2Fsampleapp%2Ftest%2F HTTP/1.1&quot;  302 ­
4/7/2011
Purdue University Identity and Access Management
8
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 6 – CAS server redirects back to application server
●
A ticket granting ticket TGT-xxx is stored on the CAS server, and set as a CASTGC cookie A service ticket is issued for the application (<a href="http://localhost:8080/sampleapp/test/" target="_blank">http://localhost:8080/sampleapp/test/</a>) and sent as a parameter back to the application server
●
2011­03­29 09:16:52,208 DEBUG  [org.jasig.cas.web.support.CookieRetrievingCookieGenerator] ­ <Added cookie with  name [CASTGC] and value [TGT­1­wKQjkOhweJE6MMTNCqTwv6WojMDBL61GISejnyCfigrMFCumYu­ cas]> 2011­03­29 09:16:52,214 DEBUG [org.jasig.cas.ticket.registry.DefaultTicketRegistry]  ­ <Added ticket [ST­1­bdgbwHIReBonmaudvxJl­cas] to registry.> 2011­03­29 09:16:52,214 INFO [org.jasig.cas.CentralAuthenticationServiceImpl] ­  <Granted service ticket [ST­1­bdgbwHIReBonmaudvxJl­cas] for service  [http://localhost:8080/sampleapp/test/] for user [jott]>
4/7/2011
Purdue University Identity and Access Management
9
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 7 – browser re-requests url from application server, with a CAS service ticket
●
Application server still has not yet established a session, so CAS client takes control CAS client sees a ticket parameter in the url, that can be checked with the CAS server CAS service ticket is only valid one time, and the CAS client needs to use it within 90 seconds or it will expire
●
●
4/7/2011
Purdue University Identity and Access Management
10
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 8 – application server checks CAS service ticket sent by browser in url
●
CAS client preparing to check service ticket:
2011­03­29 09:16:52,231 DEBUG  [org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter] ­  <Attempting to validate ticket: ST­1­bdgbwHIReBonmaudvxJl­cas> 2011­03­29 09:16:52,232 DEBUG  [org.jasig.cas.client.validation.Cas20ServiceTicketValidator] ­ <Constructing  validation url: https://www.purdue.edu/apps/account/cas­server­uber­webapp­ 3.4.6/serviceValidate?ticket=ST­1­bdgbwHIReBonmaudvxJl­cas&service=http%3A%2F %2Flocalhost%3A8080%2Fsampleapp%2Ftest%2F>
●
CAS server access log:
127.0.0.1 ­ ­ [29/Mar/2011:09:16:52 ­0400] &quot;GET /cas­server­uber­webapp­ 3.4.6/serviceValidate?ticket=ST­1­bdgbwHIReBonmaudvxJl­cas&amp;service=http%3A%2F %2Flocalhost%3A8080%2Fsampleapp%2Ftest%2F HTTP/1.1&quot; 200 281
4/7/2011
Purdue University Identity and Access Management
11
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 9 – CAS server responds to ticket check
●
CAS server response (notice the NEW attributes!):
2011­03­29 09:16:52,327 DEBUG  [org.jasig.cas.client.validation.Cas20ServiceTicketValidator] ­ <Server response:  <cas:serviceResponse xmlns:cas='http://www.yale.edu/tp/cas'> <cas:authenticationSuccess> <cas:user>jott</cas:user> <cas:attributes> <cas:email>jott@purdue.edu</cas:email> <cas:i2a2characteristics>0,3592,2000</cas:i2a2characteristics> <cas:lastname>Ott</cas:lastname> <cas:firstname>Jeffrey A</cas:firstname> <cas:fullname>Jeffrey A Ott</cas:fullname> <cas:puid>0012345678</cas:puid> </cas:attributes> </cas:authenticationSuccess> </cas:serviceResponse> &gt;
●
You can test this now yourself against the new CAS server version 3.4.6 (which will become production in May 2011):
<a href="https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/login" target="_blank">https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/login</a> <a href="https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/serviceValidate" target="_blank">https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/serviceValidate</a>
4/7/2011
Purdue University Identity and Access Management
12
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Step 10 – application server sends requested page
●
Some CAS clients (including the Java CAS client) can be configured to redirect the browser to the same url, but without the ticket parameter Application server access log:
●
0:0:0:0:0:0:0:1 ­ ­ [29/Mar/2011:09:16:52 ­0400] &quot;GET /sampleapp/test/?ticket=ST­1­ bdgbwHIReBonmaudvxJl­cas HTTP/1.1&quot; 302 ­ 0:0:0:0:0:0:0:1 ­ ­ [29/Mar/2011:09:16:52 ­0400] &quot;GET /sampleapp/test/ HTTP/1.1&quot;  200 202
4/7/2011
Purdue University Identity and Access Management
13
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Java CAS client
●
<a href="https://wiki.jasig.org/display/CASC/CAS+Client+for+Java+3.1" target="_blank">https://wiki.jasig.org/display/CASC/CAS+Client+for+Java+3.1</a> Previous example used version 3.1.10 Looking at one CAS client will help understand how any of them will need configured Next two slides show the web.xml to configure the Java CAS client for the previous example:
●
●
●
4/7/2011
Purdue University Identity and Access Management
14
<img src="" alt=""> A detailed walk through a CAS authentication</p>
<p><filter> <filter­name>CAS Authentication Filter</filter­name> <filter­class>org.jasig.cas.client.authentication.AuthenticationFilter</filter­class> <init­param> <param­name>casServerLoginUrl</param­name> <param­value><a href="https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/login" target="_blank">https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6/login</a></param­value> </init­param> <init­param> <param­name>serverName</param­name> <param­value><a href="http://localhost:8080" target="_blank">http://localhost:8080</a></param­value> </init­param> </filter> <filter> <filter­name>CAS Validation Filter</filter­name> <filter­class>org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter</filter­class> <init­param> <param­name>casServerUrlPrefix</param­name> <param­value><a href="https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6" target="_blank">https://www.purdue.edu/apps/account/cas­server­uber­webapp­3.4.6</a></param­value> </init­param> <init­param> <param­name>serverName</param­name> <param­value><a href="http://localhost:8080" target="_blank">http://localhost:8080</a></param­value> </init­param> <init­param> <param­name>redirectAfterValidation</param­name> <param­value>true</param­value> </init­param> <init­param> <param­name>exceptionOnValidationFailure</param­name> <param­value>false</param­value> </init­param> </filter> 4/7/2011 Purdue University Identity and Access Management 15
(and how to get your mits on the authenticated user)
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Continued web.xml for Java CAS client configuration:</p>
<p><filter> <filter­name>CAS HttpServletRequest Wrapper Filter</filter­name> <filter­class>org.jasig.cas.client.util.HttpServletRequestWrapperFilter</filter­class> </filter> <filter­mapping> <filter­name>CAS Authentication Filter</filter­name> <url­pattern>/test//<em></url­pattern> </filter­mapping> <filter­mapping> <filter­name>CAS Validation Filter</filter­name> <url­pattern>/test//</em></url­pattern> </filter­mapping> <filter­mapping> <filter­name>CAS HttpServletRequest Wrapper Filter</filter­name> <url­pattern>/test//*</url­pattern> </filter­mapping>
4/7/2011
Purdue University Identity and Access Management
16
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
CAS is not just for web applications
●
Browsers hold CAS state with a cookie (called CASTGC that holds a CAS ticket granting ticket – TGT), but any client, such as a mobile app, can obtain and store a TGT See <a href="https://wiki.jasig.org/display/CASUM/RESTful+API" target="_blank">https://wiki.jasig.org/display/CASUM/RESTful+API</a> Example:
●
●
POST a username and password to <a href="https://CAS_SERVER_URL/v1/tickets" target="_blank">https://CAS_SERVER_URL/v1/tickets</a> (with “Accept: text/plain” as a header) And if the login/password check out, the server sends back 201 Created Location: <a href="https://CAS_SERVER_URL/v1/tickets/{TGT" target="_blank">https://CAS_SERVER_URL/v1/tickets/{TGT</a> id} If authentication fails, the server returns back a 400 code
4/7/2011
Purdue University Identity and Access Management
17
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Initiatives for later this year:
●
Ability to use Boilerkey for CAS authentication:
–
If Boilerkey is used, CAS server will expose an extra attribute returned by the ticket check that indicates that the authentication was a Boilerkey authentication
<a href="https://www.purdue.edu/apps/account/IAMO/Purdue_CareerAccount_BoilerKey.jsp" target="_blank">https://www.purdue.edu/apps/account/IAMO/Purdue_CareerAccount_BoilerKey.jsp</a>
●
Separate mobile app CAS login page Application server administrators will be able to manage CAS ticket check server lists via web page Check for more at:
–
●
●
<a href="https://www.purdue.edu/apps/account/docs/CAS/CAS_information.jsp" target="_blank">https://www.purdue.edu/apps/account/docs/CAS/CAS_information.jsp</a>
4/7/2011
Purdue University Identity and Access Management
18
<img src="" alt=""> A detailed walk through a CAS authentication
(and how to get your mits on the authenticated user)
●
Thanks for your attention! Questions? Purdue Identity and Access Management can be reached at accounts@purdue.edu Please fill out an evaluation at <a href="http://www.itap.purdue.edu/boilerweb/survey" target="_blank">http://www.itap.purdue.edu/boilerweb/survey</a>
●
●
●
4/7/2011
Purdue University Identity and Access Management
19</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--cas_presentation/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--cas_presentation" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--GatewayJasigCommunity/">Gateway   Jasig Community</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--GatewayJasigCommunity/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="gateway-jasig-community">Gateway Jasig Community</h1>
<p><a href="http://www.jasig.org/cas/client-integration/gateway#content" target="_blank">Skip to Content</a></p>
<p><a href="http://www.jasig.org/" title="Home" target="_blank"><img src="" alt="Home"></a></p>
<ul>
<li><a href="http://www.jasig.org/uportal" title="uPortal" target="_blank"><img src="" alt="uPortal logo"></a></li>
<li><a href="http://www.jasig.org/cas" title="CAS" target="_blank"><img src="" alt="CAS logo"></a></li>
<li><a href="http://www.jasig.org/bedework" title="Bedework" target="_blank"><img src="" alt="Bedework logo"></a></li>
<li><a href="http://www.jasig.org/2-3-98" title="2-3-98" target="_blank"><img src="" alt="2-3-98 logo"></a></li>
<li><a href="http://www.jasig.org/portlets" title="uPortal" target="_blank"><img src="" alt="Portlets logo"></a></li>
<li><a href="http://www.jasig.org/umobile" title="uMobile" target="_blank"><img src="" alt="uMobile logo"></a></li>
<li><a href="http://www.jasig.org/jasig-project-incubation" title="Jasig Incubator" target="_blank"><img src="" alt="Jasig Incubator logo"></a></li>
</ul>
<p>Search this site:</p>
<h3 id="primary-links">Primary links</h3>
<ul>
<li><a href="http://www.jasig.org/" title="Jasig Home" target="_blank">Home</a></li>
<li><p><a href="http://www.jasig.org/projects" title="Projects" target="_blank">Projects</a></p>
</li>
<li><p><a href="http://www.jasig.org/umobile" title="Overview" target="_blank">uMobile</a></p>
</li>
<li><p><a href="http://www.jasig.org/umobile" title="uMoible" target="_blank">Overview</a></p>
</li>
<li><p><a href="http://www.jasig.org/node/828" title="uMobile FAQ" target="_blank">uMobile FAQ</a></p>
</li>
<li><a href="http://www.jasig.org/umobile/see-it" title="See It" target="_blank">See It</a></li>
<li><p><a href="http://www.jasig.org/umobile/download" title="Download uMobile" target="_blank">Get It</a></p>
</li>
<li><p><a href="http://www.jasig.org/umobile/about/license" title="License" target="_blank">License</a></p>
</li>
<li><p><a href="http://www.jasig.org/umobile/support" title="Support" target="_blank">Support</a></p>
</li>
<li><p><a href="http://www.jasig.org/umobile/support/documentation" title="Documentation" target="_blank">Documentation</a></p>
</li>
<li><a href="http://www.jasig.org/umobile/support/solutions-providers" title="Solutions Providers" target="_blank">Solutions Providers</a></li>
<li><p><a href="http://www.jasig.org/umobile/community" title="Community" target="_blank">Community</a></p>
</li>
<li><p><a href="http://www.jasig.org/umobile/mailing-lists" title="uMobile Mailing Lists" target="_blank">Mailing Lists</a></p>
</li>
<li><p><a href="http://www.jasig.org/uportal" title="Overview" target="_blank">uPortal</a></p>
</li>
<li><p><a href="http://www.jasig.org/uportal" title="uPortal" target="_blank">Overview</a></p>
</li>
<li><a href="http://www.jasig.org/uportal/see-it" title="See It" target="_blank">See It</a></li>
<li><p><a href="http://www.jasig.org/uportal/download" title="Download uPortal" target="_blank">Get It</a></p>
</li>
<li><p><a href="http://www.jasig.org/uportal/download/all" title="All uPortal Releases" target="_blank">All Releases</a></p>
</li>
<li><a href="http://www.jasig.org/uportal/about/license" title="License" target="_blank">License</a></li>
<li><p><a href="http://www.jasig.org/uportal/support" title="Support" target="_blank">Support</a></p>
</li>
<li><p><a href="http://www.jasig.org/uportal/documentation" title="Documentation" target="_blank">Documentation</a></p>
</li>
<li><a href="http://www.jasig.org/uportal/support/solutions-providers" title="Solutions Providers" target="_blank">Solutions Providers</a></li>
<li><a href="http://www.jasig.org/uportal/documentation/faq" title="uPortal FAQ" target="_blank">uPortal FAQ</a></li>
<li><p><a href="http://www.jasig.org/uportal/community" title="Community" target="_blank">Community</a></p>
</li>
<li><p><a href="http://www.jasig.org/uportal/mailing-lists" title="uPortal Mailing Lists" target="_blank">Mailing lists</a></p>
</li>
<li><a href="http://www.jasig.org/uportal/steering-committee" title="uPortal steering committee" target="_blank">Steering Committee</a></li>
<li><a href="http://www.jasig.org/uportal/deployments" target="_blank">Deployments</a></li>
<li><a href="http://www.jasig.org/uportal/community/uportal-screencasts" title="uPortal Screencasts" target="_blank">Screencasts</a></li>
<li><a href="http://www.jasig.org/uportal/features" title="Features" target="_blank">Features</a></li>
<li><a href="http://www.jasig.org/uportal/benefits" title="Benefits" target="_blank">Benefits</a></li>
<li><a href="http://www.jasig.org/uportal/news" target="_blank">News</a></li>
<li><a href="http://www.jasig.org/uportal/events" target="_blank">Events</a></li>
<li><a href="http://www.jasig.org/uportal/about" title="About" target="_blank">About</a></li>
<li><p><a href="http://www.jasig.org/cas" title="CAS" target="_blank">CAS</a></p>
</li>
<li><p><a href="http://www.jasig.org/cas/community" title="Community" target="_blank">Community</a></p>
</li>
<li><p><a href="http://www.jasig.org/cas/mailing-lists" title="CAS Mailing Lists" target="_blank">Mailing Lists</a></p>
</li>
<li><a href="http://www.jasig.org/cas/deployments" target="_blank">Deployments</a></li>
<li><a href="http://www.jasig.org/cas/documentation" title="Documentation" target="_blank">CAS In Print</a></li>
<li><a href="http://www.jasig.org/cas/integrators" title="CAS Integrators" target="_blank">Integrators</a></li>
<li><a href="http://www.jasig.org/cas/download" title="Download CAS Server" target="_blank">Download</a></li>
<li><a href="http://www.jasig.org/cas/news" target="_blank">News &amp; Events</a></li>
<li><p><a href="http://www.jasig.org/cas/client-integration" title="CAS Client Integration" target="_blank">Client integration</a></p>
</li>
<li><p><a href="http://www.jasig.org/cas/client-integration/faq" title="FAQ" target="_blank">FAQ</a></p>
</li>
<li><a href="&quot;Gateway&quot;">Gateway</a></li>
<li><a href="http://www.jasig.org/cas/client-integration/renew" title="Renew: Opting out of SSO" target="_blank">Renew</a></li>
<li><p><a href="http://www.jasig.org/cas/server-deployment" title="Server Deployment" target="_blank">Server Deployment</a></p>
</li>
<li><p><a href="http://www.jasig.org/cas/server-deployment/faq" title="FAQ" target="_blank">FAQ</a></p>
</li>
<li><p><a href="http://www.jasig.org/cas/developers" title="Developers" target="_blank">Developers</a></p>
</li>
<li><p><a href="http://www.jasig.org/cas/roadmap" title="CAS Roadmap" target="_blank">Roadmap</a></p>
</li>
<li><a href="http://www.jasig.org/cas/source-repository" title="CAS Source Repository" target="_blank">Source Repository</a></li>
<li><a href="http://www.jasig.org/cas/public-api" title="Public APIs" target="_blank">Public APIs</a></li>
<li><a href="http://www.jasig.org/cas/using-maven" title="Building the CAS Project Using Maven" target="_blank">Using Maven</a></li>
<li><a href="http://www.jasig.org/cas/protocol" title="CAS Protocol" target="_blank">Protocol</a></li>
<li><p><a href="http://www.jasig.org/cas/support" title="Support" target="_blank">Support</a></p>
</li>
<li><p><a href="http://www.jasig.org/cas/support/solutions-providers" title="Solutions Providers" target="_blank">Solutions Providers</a></p>
</li>
<li><p><a href="http://www.jasig.org/cas/about" title="About" target="_blank">About</a></p>
</li>
<li><p><a href="http://www.jasig.org/cas/cas1-architecture" title="CAS 1 Architecture" target="_blank">CAS 1 Architecture</a></p>
</li>
<li><a href="http://www.jasig.org/cas/cas2-architecture" title="CAS 2 Architecture" target="_blank">CAS 2 Architecture</a></li>
<li><a href="http://www.jasig.org/cas/proxy-authentication" title="Why do we need proxy authentication?" target="_blank">Proxy Authentication</a></li>
<li><a href="http://www.jasig.org/cas/steering-committee" title="CAS Steering Committee" target="_blank">Steering Committee</a></li>
<li><a href="http://www.jasig.org/cas/license" title="License" target="_blank">License</a></li>
<li><a href="http://www.jasig.org/cas/team" title="The CAS Team" target="_blank">The Team</a></li>
<li><p><a href="http://www.jasig.org/bedework" title="Bedework" target="_blank">Bedework</a></p>
</li>
<li><p><a href="http://www.jasig.org/bedework/overview" title="Bedework Overview" target="_blank">Overview</a></p>
</li>
<li><p><a href="http://www.jasig.org/bedework/features" title="Bedework Features" target="_blank">Features</a></p>
</li>
<li><a href="http://www.jasig.org/bedework/news" title="Bedework News and Events" target="_blank">News &amp; Events</a></li>
<li><a href="http://www.jasig.org/bedework/whosusing" title="Who&#39;s Using Bedework" target="_blank">Who&#39;s Using Bedework</a></li>
<li><a href="http://www.jasig.org/bedework/standards" title="Calendar Standards" target="_blank">Calendar Standards</a></li>
<li><a href="http://www.jasig.org/bedework/publications" title="Bedework Publications" target="_blank">Publications</a></li>
<li><a href="http://www.jasig.org/bedework/support/solutions-providers" title="Solutions Providers" target="_blank">Solutions Providers</a></li>
<li><p><a href="http://www.jasig.org/bedework/download" title="Download Bedework" target="_blank">Download</a></p>
</li>
<li><p><a href="http://www.jasig.org/bedework/license" title="Bedework License" target="_blank">License</a></p>
</li>
<li><a href="http://www.jasig.org/bedework/download/coderepository" title="Bedework Code Repository" target="_blank">Code Repository</a></li>
<li><a href="http://www.jasig.org/bedework/download/archives" title="Bedework Release Archives" target="_blank">Archives</a></li>
<li><a href="http://www.jasig.org/bedework/download/changelog" title="Bedework Change Log" target="_blank">Change Log</a></li>
<li><a href="http://www.jasig.org/bedework/documentation" title="Bedework Documentation" target="_blank">Documentation</a></li>
<li><p><a href="http://www.jasig.org/bedework/community" title="Community" target="_blank">Community</a></p>
</li>
<li><p><a href="http://www.jasig.org/bedework/deployments" title="Bedework Deployments" target="_blank">Deployments</a></p>
</li>
<li><a href="http://www.jasig.org/bedework/steering-committee" title="Bedework Steering Committee" target="_blank">Steering Committee</a></li>
<li><a href="http://www.jasig.org/bedework/development" title="Bedework Development &amp; Roadmap" target="_blank">Development</a></li>
<li><a href="http://www.jasig.org/bedework/contributors" title="Bedework Contributors" target="_blank">Contributors</a></li>
<li><a href="http://www.jasig.org/bedework/mailing-lists" target="_blank">Mailing Lists</a></li>
<li><a href="http://www.jasig.org/bedework/ticketing" title="Bug Database" target="_blank">Bug Database</a></li>
<li><p><a href="http://www.jasig.org/bedework/about" title="About" target="_blank">About</a></p>
</li>
<li><p><a href="http://www.jasig.org/bedework/about/timeline" title="Bedework Timeline" target="_blank">Timeline</a></p>
</li>
<li><a href="http://www.jasig.org/bedework/about/libraries" title="Library usage" target="_blank">Library Usage</a></li>
<li><a href="http://www.jasig.org/bedework/about/bede" title="Bede" target="_blank">Bede</a></li>
<li><a href="http://www.jasig.org/bedework/mailing-lists" title="Contacting Bedework" target="_blank">Contact Us</a></li>
<li><a href="http://www.jasig.org/2-3-98" title="2/3/98 Project" target="_blank">2-3-98 Project</a></li>
<li><p><a href="http://www.jasig.org/portlets" title="Portlets" target="_blank">Portlets</a></p>
</li>
<li><p><a href="http://www.jasig.org/portlets/mailing-lists" title="Portlet Mailing Lists" target="_blank">Mailing lists</a></p>
</li>
<li><a href="http://www.jasig.org/jasig-project-incubation" title="Project Incubation" target="_blank">Project Incubation</a></li>
<li><p><a href="http://www.jasig.org/jasig-community" title="Community" target="_blank">Community</a></p>
</li>
<li><p><a href="http://www.jasig.org/jasig-membership" title="Membership" target="_blank">Membership</a></p>
</li>
<li><p><a href="http://www.jasig.org/jasig-membership-institutional-members" title="Jasig Institutional Members" target="_blank">Institutional members</a></p>
</li>
<li><a href="http://www.jasig.org/jasig-membership-partners" title="Jasig Partners" target="_blank">Partners</a></li>
<li><a href="http://www.jasig.org/jasig-membership-affiliates" title="Jasig Affiliates" target="_blank">Affiliates</a></li>
<li><a href="http://www.jasig.org/jasig-membership-types" title="Membership Comparison" target="_blank">Membership Comparison</a></li>
<li><p><a href="http://www.jasig.org/jasig-support" title="Support" target="_blank">Support</a></p>
</li>
<li><p><a href="http://www.jasig.org/jasig-support/solutions-providers" title="Solution Providers" target="_blank">Solutions Providers</a></p>
</li>
<li><p><a href="http://www.jasig.org/jasig-conferences-events" title="Conferences &amp; Events" target="_blank">Conferences &amp; Events</a></p>
</li>
<li><p><a href="http://www.jasig.org/jasig-conferences-events-archives" title="Archives" target="_blank">Archives</a></p>
</li>
<li><a href="http://www.jasig.org/conf/2010/spring" target="_blank">Videos</a></li>
<li><a href="http://www.jasig.org/jasig-news-events" target="_blank">News</a></li>
<li><a href="http://www.jasig.org/jasig/blogs" title="Jasig Blogs" target="_blank">Blogs</a></li>
<li><p><a href="http://www.jasig.org/jasig-newsletters" title="Jasig Newsletters" target="_blank">Newsletters</a></p>
</li>
<li><p><a href="http://www.jasig.org/jasig-newsletters/july-2010" title="JASIG NEWSLETTER - JULY 2010" target="_blank">201007 - July 2010</a></p>
</li>
<li><a href="http://www.jasig.org/jasig-newsletters/august-2010" title="JASIG NEWSLETTER - AUGUST 2010" target="_blank">201008 - August 2010</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/september-2010" title="JASIG NEWSLETTER - SEPTEMBER 2010" target="_blank">201009 - September 2010</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/october-2010" title="JASIG NEWSLETTER - OCTOBER 2010" target="_blank">201010 - October 2010</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/november-2010" title="JASIG NEWSLETTER - NOVEMBER 2010" target="_blank">201011 - November 2010</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/december-2010" title="JASIG NEWSLETTER - DECEMBER 2010" target="_blank">201012 - December 2010</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/jasig-newsletter-janua" title="JASIG NEWSLETTER - JANUARY 2011" target="_blank">201101 - January 2011</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/march-2011" title="JASIG NEWSLETTER - MARCH 2011" target="_blank">201103 - March 2011</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/june-2011" title="JASIG NEWSLETTER - JUNE 2011" target="_blank">201106 - June 2011</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/september-2011" title="JASIG NEWSLETTER - SEPTEMBER 2011" target="_blank">201109 - September 2011</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/october-2011" title="JASIG NEWSLETTER - OCTOBER 2011" target="_blank">201110 - October 2011</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/november-2011" title="JASIG NEWSLETTER - NOVEMBER 2011" target="_blank">201111 - November 2011</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/january-2012" title="JASIG NEWSLETTER - JANUARY 2012" target="_blank">201201 - January 2012</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/february-2012" title="JASIG NEWSLETTER - FEBRUARY 2012" target="_blank">201202 - February 2012</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/march-2012" title="JASIG NEWSLETTER - MARCH 2012" target="_blank">201203 - March 2012</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/april-2012" title="JASIG NEWSLETTER - APRIL 2012" target="_blank">201204 - April 2012</a></li>
<li><a href="http://www.jasig.org/jasig-newsletters/may-2012" title="JASIG NEWSLETTER - MAY 2012" target="_blank">201205 - May 2012</a></li>
<li><p><a href="http://www.jasig.org/mailing-lists" title="Jasig Community Mailing Lists" target="_blank">Mailing Lists</a></p>
</li>
<li><p><a href="http://www.jasig.org/mailing-lists/jasig" title="Jasig Mailing Lists" target="_blank">Jasig</a></p>
</li>
<li><a href="http://www.jasig.org/mailing-lists/gaps" title="Groups &amp; Permissions Mailing Lists" target="_blank">Groups &amp; Permissions</a></li>
<li><a href="http://www.jasig.org/mailing-lists/jira" title="JIRA Notifications Mailing Lists" target="_blank">JIRA</a></li>
<li><a href="http://www.jasig.org/mailing-lists/person-directory" title="Person Directory Mailing Lists" target="_blank">Person Directory</a></li>
<li><p><a href="http://www.jasig.org/jasig/contribute" title="Contribute to Jasig" target="_blank">Contribute</a></p>
</li>
<li><p><a href="http://www.jasig.org/jasig/contribute" target="_blank">How to Contribute to Jasig</a></p>
</li>
<li><a href="http://www.jasig.org/jasig/contribute/donations" title="Donations" target="_blank">Donate</a></li>
<li><a href="http://www.jasig.org/jasig/contribute/sponsorship" title="Sponsorship" target="_blank">Sponsor</a></li>
<li><p><a href="http://www.jasig.org/about" title="About" target="_blank">About</a></p>
</li>
<li><p><a href="http://www.jasig.org/jasig-governance" title="Governance" target="_blank">Governance</a></p>
</li>
<li><a href="http://www.jasig.org/jasig-steering-committees" title="Steering Committees" target="_blank">Steering Committees</a></li>
<li><a href="http://www.jasig.org/about/acknowledgements" title="Acknowledgements" target="_blank">Acknowledgements</a></li>
<li><a href="http://www.jasig.org/why-open-source" title="Why Open Source" target="_blank">Why Open Source</a></li>
<li><a href="http://www.jasig.org/licensing" title="Jasig Licensing Policy" target="_blank">Licensing Policy</a></li>
<li><a href="http://www.jasig.org/jasig-contact-us" title="Contact Us" target="_blank">Contact</a></li>
</ul>
<h3 id="cas">CAS</h3>
<ul>
<li><a href="http://www.jasig.org/cas/community" title="Community" target="_blank">Community</a></li>
<li><a href="http://www.jasig.org/cas/download" title="Download CAS Server" target="_blank">Download</a></li>
<li><a href="http://www.jasig.org/cas/news" target="_blank">News &amp; Events</a></li>
<li><p><a href="http://www.jasig.org/cas/client-integration" title="CAS Client Integration" target="_blank">Client integration</a></p>
</li>
<li><p><a href="http://www.jasig.org/cas/client-integration/faq" title="FAQ" target="_blank">FAQ</a></p>
</li>
<li><a href="&quot;Gateway&quot;">Gateway</a></li>
<li><a href="http://www.jasig.org/cas/client-integration/renew" title="Renew: Opting out of SSO" target="_blank">Renew</a></li>
<li><a href="http://www.jasig.org/cas/server-deployment" title="Server Deployment" target="_blank">Server Deployment</a></li>
<li><a href="http://www.jasig.org/cas/developers" title="Developers" target="_blank">Developers</a></li>
<li><a href="http://www.jasig.org/cas/support" title="Support" target="_blank">Support</a></li>
<li><a href="http://www.jasig.org/cas/about" title="About" target="_blank">About</a></li>
</ul>
<h3 id="join-the-discussion">Join the Discussion</h3>
<ul>
<li><a href="http://www.jasig.org/mailing-lists" target="_blank">All lists</a></li>
<li><a href="http://www.jasig.org/mailing-lists/jasig" target="_blank">Jasig lists</a></li>
<li><a href="http://www.jasig.org/uportal/mailing-lists" target="_blank">uPortal lists</a></li>
<li><a href="http://www.jasig.org/cas/mailing-lists" target="_blank">CAS lists</a></li>
<li><a href="http://www.jasig.org/portlets/mailing-lists" target="_blank">Portlet lists</a></li>
<li><a href="http://www.jasig.org/bedework/mailing-lists" target="_blank">Bedework lists</a></li>
</ul>
<p><a href="http://www.addtoany.com/share_save?linkurl=http%3A%2F%2Fwww.clearinghouse.ja-sig.org%2Fnode%2F&amp;linkname=" target="_blank"><img src="" alt="Share/Save"></a></p>
<p><a href="http://www.jasig.org/" target="_blank">Home</a> » <a href="http://www.jasig.org/projects" target="_blank">Projects</a> » <a href="http://www.jasig.org/cas" target="_blank">CAS</a> » <a href="http://www.jasig.org/cas/client-integration" target="_blank">Client integration</a> » <a href="">Gateway</a></p>
<h1 id="gateway">Gateway</h1>
<p>This page documents the Gateway feature of the CAS protocol and the protocol-implementing CAS Server.</p>
<h3 id="what-is-the-gateway-feature-">What is the Gateway feature?</h3>
<p>CAS Server includes a feature whereby you can set the request parameter &quot;gateway&quot; to &quot;true&quot; on the request for CAS login. If &quot;gateway&quot; is &quot;true&quot;, then CAS will not paint the user login screen. If it can accomplish authentication by single sign on - that is, by detecting the CAS ticket granting cookie - then it will redirect to the URL specified by the &quot;service&quot; parameter with a valid service ticket. If it cannot accomplish single sign on, then it will redirect to the &quot;service&quot; URL without painting any login screen.</p>
<p>This allows your application to detect and take advantage of user single sign on without bothering the user with a login screen in the case where he or she is not yet logged on. This is useful for main pages and is probably a &quot;best practice&quot;, since it allows the user to learn about the service to which he might authenticate before being abruptly presented with the CAS login screen out of context.</p>
<h3 id="what-is-required-of-a-cas-client-to-support-this-feature-">What is required of a CAS Client to support this feature?</h3>
<p>A gateway-supporting CAS client should:</p>
<ol>
<li>provide a mechanism for the application developer/deployer/htaccess writer to elect the gateway behavior</li>
<li><p>when gateway is elected:</p>
</li>
<li><p>set the request parameter &quot;gateway&quot; to be &quot;true&quot; on the CAS login request</p>
</li>
<li>provide a way to indentify the request when it is redirected back from CAS as one that has already been gatewayed (e.g., a special parameter on the URL-encoded &quot;service&quot;, setting a cookie, using already-present session support from your environment, etc.)</li>
<li>receive requests redirected back from CAS. These may have the &quot;ticket&quot; parameter set, in which case validate the ticket, etc. If gatewaying failed to pick up a single sign on session, the request will be for the URL specified as the &quot;service&quot; parameter &quot;bare&quot; - the &quot;ticket&quot; parameter will not be set, and CAS does not set any other parameter to indicate that it had gatewayed. The client needs to recognize the request as having already come through gateway. The client should not redirect already-gatewayed requests back to CAS for more gatewaying, because this will lead to an infinite loop of redirecting back and forth between server and client.</li>
</ol>
<p>CAS is authentication, not authorization. The standard use case for CAS is that the client application wants to consume the authenticated username. Under gateway, when there is no authenticated username because we came back from CAS ticketless, the client should do something like returning &quot;null&quot; when the client application asks for the authenticated username, or fail to set the remote user header, or put null into the session where the application expected to lookup the authenticated user, etc., as applicable to the CAS client implementation.</p>
<p>In the case where one is using CAS for authorization (probably a bad idea in the first place) - users able to authenticate are authorized to access the resource, and users unable to authenticate are not authorized - then GATEWAY should not be used.
© 2009 Jasig. All rights reserved.  |  Design and hosting by <a href="http://www.webchuckweb.com/" target="_blank">WebChuck Web</a>.</p>
<p><img src="" alt=""></p>
<p><a href="http://www.jasig.org/cas/client-integration/gateway#" target="_blank"></a><a href="http://www.jasig.org/cas/client-integration/gateway#"></a></p>
<p><a href="http://www.jasig.org/cas/client-integration/gateway#"></a></p>
<p><a href="http://www.jasig.org/cas/client-integration/gateway#" target="_blank"></a><a href="http://www.jasig.org/cas/client-integration/gateway#"></a></p>
<p><a href="http://www.jasig.org/cas/client-integration/gateway#" target="_blank"></a><a href="http://www.jasig.org/cas/client-integration/gateway#"></a><a href="http://www.jasig.org/cas/client-integration/gateway#" target="_blank"></a><a href="http://www.jasig.org/cas/client-integration/gateway#"></a><a href="http://www.jasig.org/cas/client-integration/gateway#"></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--GatewayJasigCommunity/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--GatewayJasigCommunity" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--UseJavascriptRedirection-CASUserManual-Jas/">Use Javascript Redirection </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--UseJavascriptRedirection-CASUserManual-Jas/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="use-javascript-redirection-cas-user-manual-jasig-wiki">Use Javascript Redirection - CAS User Manual - Jasig Wiki</h1>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#title-heading" target="_blank">Skip to content</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#breadcrumbs" target="_blank">Skip to breadcrumbs</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#header-menu-bar" target="_blank">Skip to header menu</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#navigation" target="_blank">Skip to action menu</a></li>
<li><p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#quick-search-query" target="_blank">Skip to quick search</a>
Quick Search</p>
</li>
<li><p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">Browse</a></p>
</li>
<li><p><a href="https://wiki.jasig.org/pages/listpages.action?key=CASUM" title="Browse pages in the CAS User Manual space ( Type &#39;g&#39; then &#39;s" target="_blank">Pages</a>&quot;)</p>
</li>
<li><a href="https://wiki.jasig.org/pages/viewrecentblogposts.action?key=CASUM" title="Browse blogs in the CAS User Manual space" target="_blank">Blog</a></li>
<li><a href="https://wiki.jasig.org/labels/listlabels-heatmap.action?key=CASUM" title="Browse labels in the CAS User Manual space" target="_blank">Labels</a></li>
<li><a href="https://wiki.jasig.org/spaces/listattachmentsforspace.action?key=CASUM" title="Browse attachments in the CAS User Manual space" target="_blank">Attachments</a></li>
<li><a href="https://wiki.jasig.org/mail/archive/viewmailarchive.action?key=CASUM" title="Browse mail in the CAS User Manual space" target="_blank">Mail</a></li>
<li><a href="https://wiki.jasig.org/spaces/viewspacesummary.action?key=CASUM" title="Browse additional space functions in the CAS User Manual space" target="_blank">Advanced</a></li>
<li><p><a href="https://wiki.jasig.org/spaces/usage/report.action?key=CASUM" target="_blank">Activity</a></p>
</li>
<li><p><a href="http://docs.atlassian.com/confluence/docs-41/whatsnew/iframe" target="_blank">What’s New</a></p>
</li>
<li><a href="https://wiki.jasig.org/spacedirectory/view.action" title="Browse the Confluence space directory" target="_blank">Space Directory</a></li>
<li><a href="https://wiki.jasig.org/dashboard/configurerssfeed.action" title="Create your custom RSS feed." target="_blank">Feed Builder</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" title="View available keyboard shortcuts ( Type &#39;?" target="_blank">Keyboard Shortcuts</a>&quot;)</li>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" title="Browse gadgets provided by Confluence" target="_blank">Confluence Gadgets</a></li>
<li><a href="https://wiki.jasig.org/login.action?os_destination=%2Fdisplay%2FCASUM%2FUse%2BJavascript%2BRedirection" target="_blank">Log In</a></li>
<li><a href="https://wiki.jasig.org/signup.action" target="_blank">Sign Up</a></li>
</ul>
<ol>
<li><a href="https://wiki.jasig.org/dashboard.action" title="Go to Dashboard ( Type &#39;g&#39; then &#39;d" target="_blank">Dashboard</a>&quot;)</li>
<li><a href="https://wiki.jasig.org/display/CASUM" target="_blank">CAS User Manual</a></li>
<li><strong>…</strong></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Navigation" target="_blank">Navigation</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Advanced+Topics" target="_blank">Advanced Topics</a></li>
<li><a href="">Use Javascript Redirection</a></li>
</ol>
<ul>
<li><p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">Tools</a></p>
</li>
<li><p><a href="https://wiki.jasig.org/pages/viewpageattachments.action?pageId=12157004" title="View Attachments ( Type &#39;t" target="_blank">Attachments (0)</a>&quot;)</p>
</li>
<li><a href="https://wiki.jasig.org/pages/viewpreviousversions.action?pageId=12157004" target="_blank">Page History</a></li>
<li><p><a href="https://wiki.jasig.org/pages/viewinfo.action?pageId=12157004" title="Edit restrictions" target="_blank">Restrictions</a></p>
</li>
<li><p><a href="https://wiki.jasig.org/pages/viewinfo.action?pageId=12157004" target="_blank">Info</a></p>
</li>
<li><a href="https://wiki.jasig.org/pages/viewinfo.action?pageId=12157004" title="Link to this Page ( Type &#39;k" target="_blank">Link to this Page…</a>&quot;)</li>
<li><a href="https://wiki.jasig.org/pages/listpages-dirview.action?key=CASUM&amp;openId=12157004#selectedPageInHierarchy" target="_blank">View in Hierarchy</a></li>
<li><a href="https://wiki.jasig.org/plugins/viewsource/viewpagesrc.action?pageId=12157004" target="_blank">View Source</a></li>
</ul>
<h1 id="-use-javascript-redirection-"><a href="">Use Javascript Redirection</a></h1>
<p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#page-metadata-end" target="_blank">Skip to end of metadata</a></p>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" title="Page restrictions apply. Click the lock icon to view or edit the restriction." target="_blank">Page restrictions apply</a></li>
<li>Added by <a href="https://wiki.jasig.org/display/~dale77" target="_blank">Dale Ogilvie</a>, last edited by <a href="https://wiki.jasig.org/display/~dale77" target="_blank">Dale Ogilvie</a> on Apr 30, 2008  (<a href="https://wiki.jasig.org/pages/diffpages.action?pageId=12157004&amp;originalId=52495846" target="_blank">view change</a>)</li>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">show comment</a> <a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">hide comment</a>
<strong>Comment:</strong> Corrected links that should have been relative instead of absolute.
<a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#page-metadata-start" target="_blank">Go to start of metadata</a>   Table of Contents</li>
</ul>
<h3 id="-home-https-wiki-jasig-org-display-casum-home-"><a href="https://wiki.jasig.org/display/CASUM/Home" target="_blank">Home</a></h3>
<h3 id="-overall-architecture-https-wiki-jasig-org-display-casum-overall-architecture-"><a href="https://wiki.jasig.org/display/CASUM/Overall+Architecture" target="_blank">Overall Architecture</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Building+and+Deploying" target="_blank">Building and Deploying</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Development" target="_blank">Development</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Introduction" target="_blank">Introduction</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Java+Versions" target="_blank">Java Versions</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Releasing" target="_blank">Releasing</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Spring+Configuration" target="_blank">Spring Configuration</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Technical+Overview" target="_blank">Technical Overview</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Upgrading" target="_blank">Upgrading</a></li>
</ul>
<h3 id="-authentication-https-wiki-jasig-org-display-casum-authentication-"><a href="https://wiki.jasig.org/display/CASUM/Authentication" target="_blank">Authentication</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Active+Directory" target="_blank">Active Directory</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Generic" target="_blank">Generic</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/JAAS" target="_blank">JAAS</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/JDBC" target="_blank">JDBC</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/LDAP" target="_blank">LDAP</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Legacy" target="_blank">Legacy</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/RADIUS" target="_blank">RADIUS</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/SPNEGO" target="_blank">SPNEGO</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Trusted" target="_blank">Trusted</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/X.509+Certificates" target="_blank">X.509 Certificates</a></li>
</ul>
<h3 id="-authentication-managers-https-wiki-jasig-org-display-casum-authentication-managers-"><a href="https://wiki.jasig.org/display/CASUM/Authentication+Managers" target="_blank">Authentication Managers</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Default+AuthenticationManager" target="_blank">Default AuthenticationManager</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Direct+Mapping+AuthenticationManager" target="_blank">Direct Mapping AuthenticationManager</a></li>
</ul>
<h3 id="-security-policy-https-wiki-jasig-org-display-casum-security-policy-"><a href="https://wiki.jasig.org/display/CASUM/Security+Policy" target="_blank">Security Policy</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Ticket+Expiration+Policy" target="_blank">Ticket Expiration Policy</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Remember+Me" target="_blank">Remember Me</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Throttling+Login+Attempts" target="_blank">Throttling Login Attempts</a></li>
</ul>
<h3 id="-ticketregistry-https-wiki-jasig-org-display-casum-ticketregistry-"><a href="https://wiki.jasig.org/display/CASUM/TicketRegistry" target="_blank">TicketRegistry</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/BerkleyDB" target="_blank">BerkleyDB</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Default" target="_blank">Default</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/EhcacheTicketRegistry" target="_blank">EhcacheTicketRegistry</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/JBOSS+TreeCache" target="_blank">JBOSS TreeCache</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/JDBCTicketRegistry" target="_blank">JDBCTicketRegistry</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/JpaTicketRegistry" target="_blank">JpaTicketRegistry</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/MemcacheTicketRegistry" target="_blank">MemcacheTicketRegistry</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/TicketRegistry+Cleaner" target="_blank">TicketRegistry Cleaner</a></li>
</ul>
<h3 id="-testing-https-wiki-jasig-org-display-casum-testing-"><a href="https://wiki.jasig.org/display/CASUM/Testing" target="_blank">Testing</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Apache+JMeter" target="_blank">Apache JMeter</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Java+HttpComponents+Based+Test+Class" target="_blank">Java HttpComponents Based Test Class</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Nagios+plugins" target="_blank">Nagios plugins</a></li>
</ul>
<h3 id="-protocols-https-wiki-jasig-org-display-casum-protocols-"><a href="https://wiki.jasig.org/display/CASUM/Protocols" target="_blank">Protocols</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Add+Your+Custom+Protocol" target="_blank">Add Your Custom Protocol</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Applications+that+Require+POST+Responses" target="_blank">Applications that Require POST Responses</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/CAS" target="_blank">CAS</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/OAuth" target="_blank">OAuth</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/OpenID" target="_blank">OpenID</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/RESTful+API" target="_blank">RESTful API</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/SAML+1.1" target="_blank">SAML 1.1</a></li>
<li><a href="https://wiki.jasig.org/pages/viewpage.action?pageId=6063484" target="_blank">SAML 2.0 (Google Accounts Integration)</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Single+Sign+Out" target="_blank">Single Sign Out</a></li>
</ul>
<h3 id="-advanced-topics-https-wiki-jasig-org-display-casum-advanced-topics-"><a href="https://wiki.jasig.org/display/CASUM/Advanced+Topics" target="_blank">Advanced Topics</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/pages/viewpage.action?pageId=13570204" target="_blank">Adding &quot;Public Workstation&quot; vs. &quot;Private Workstation&quot; Timeouts</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Auditing+and+Statistics+Via+Inspektr" target="_blank">Auditing and Statistics Via Inspektr</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Internationalization" target="_blank">Internationalization</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/LDAP+Password+Policy+Enforcement" target="_blank">LDAP Password Policy Enforcement</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Second-Level+CAS+Server" target="_blank">Second-Level CAS Server</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Terracotta" target="_blank">Terracotta</a></li>
<li><a href="">Use Javascript Redirection</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Deployment+Scenarios" target="_blank">Deployment Scenarios</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Acceptable+Use+interface+for+Login+Webflow" target="_blank">Acceptable Use interface for Login Webflow</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Change+Password+Integration+With+Jasig+CAS+3.4.7" target="_blank">Change Password Integration With Jasig CAS 3.4.7</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Localization" target="_blank">Localization</a></li>
</ul>
<h3 id="-tutorials-and-howtos-https-wiki-jasig-org-display-casum-tutorials-and-howtos-"><a href="https://wiki.jasig.org/display/CASUM/Tutorials+and+HOWTOs" target="_blank">Tutorials and HOWTOs</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/CAS+on+Windows+Quick+Setup+Guide" target="_blank">CAS on Windows Quick Setup Guide</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Clustering+CAS" target="_blank">Clustering CAS</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Demo" target="_blank">Demo</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Configure+JBoss+for+HTTPS" target="_blank">HOWTO Configure JBoss for HTTPS</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Configure+Single+Sign+On+Session+Timeout" target="_blank">HOWTO Configure Single Sign On Session Timeout</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Setup+Dual+Authentication+in+CAS+-+SSL+Client+Auth+and+LDAP" target="_blank">HOWTO Setup Dual Authentication in CAS - SSL Client Auth and LDAP</a></li>
<li><a href="https://wiki.jasig.org/pages/viewpage.action?pageId=10650669" target="_blank">HOWTO Setup LDAP GSSAPI+Kerberos Authentication in CAS</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Switch+to+Sun+JVM+in+RHEL" target="_blank">HOWTO Switch to Sun JVM in RHEL</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/End-to-end+Windows+Example" target="_blank">End-to-end Windows Example</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Use+Jasypt+to+encrypt+passwords+in+configuration+files" target="_blank">HOWTO Use Jasypt to encrypt passwords in configuration files</a></li>
<li><a href="https://wiki.jasig.org/pages/viewpage.action?pageId=47874068" target="_blank">HOWTO utilize javax.servlet.http.HttpServletRequest isUserInRole( java.lang.String role )</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Migrating+an+existing+CAS+server+installation" target="_blank">Migrating an existing CAS server installation</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Best+Practice+-+Setting+Up+CAS+Locally+using+the+Maven2+WAR+Overlay+Method" target="_blank">Best Practice - Setting Up CAS Locally using the Maven2 WAR Overlay Method</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Deploying+CAS+3.0.x+in+RHEL+5+with+Sun+Java" target="_blank">Deploying CAS 3.0.x in RHEL 5 with Sun Java</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+CASifying+ASP.NET+WebApp+-+ExampleWebsite" target="_blank">HOWTO CASifying ASP.NET WebApp - ExampleWebsite</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Configure+CAS+for+LDAP+DIGEST-MD5" target="_blank">HOWTO Configure CAS for LDAP DIGEST-MD5</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Run+Canoo+Web+Tests" target="_blank">HOWTO Run Canoo Web Tests</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Shibboleth-CAS+Integration" target="_blank">Shibboleth-CAS Integration</a></li>
</ul>
<h3 id="-troubleshooting-https-wiki-jasig-org-display-casum-troubleshooting-"><a href="https://wiki.jasig.org/display/CASUM/Troubleshooting" target="_blank">Troubleshooting</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Logging" target="_blank">Logging</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/SSL+Troubleshooting+and+Reference+Guide" target="_blank">SSL Troubleshooting and Reference Guide</a></li>
</ul>
<h3 id="-services-management-https-wiki-jasig-org-display-casum-services-management-"><a href="https://wiki.jasig.org/display/CASUM/Services+Management" target="_blank">Services Management</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Adding+a+New+Service" target="_blank">Adding a New Service</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Attributes" target="_blank">Attributes</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Configuring" target="_blank">Configuring</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Deleting" target="_blank">Deleting</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Editing" target="_blank">Editing</a></li>
</ul>
<h3 id="-extensions-https-wiki-jasig-org-display-casum-extensions-"><a href="https://wiki.jasig.org/display/CASUM/Extensions" target="_blank">Extensions</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/ClearPass" target="_blank">ClearPass</a>
When redirecting from the https CAS application back to an http service after authenticating successfully, IE6 presents the user with a security dialog saying &quot;you are about to be redirected to a connection that is not secure, do you really want to do this?&quot;. We can avoid this by using javascript to perform the redirection in the client browser, instead of a server side redirect. This approach works fine for web pages, but does not work for protected image content, which will not execute the returned javascript, so we revert to a serverside redirect for this type of content.</li>
</ul>
<ol>
<li>Create WEB-INF/view/jsp/default/ui/redirect.jsp to perform the redirection using javascript
<a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">?</a>&lt;%</li>
</ol>
<p>@page</p>
<p>import</p>
<p>=</p>
<p>&quot;org.jasig.cas.authentication.principal.WebApplicationService&quot;</p>
<p>%&gt;</p>
<p>&lt;%</p>
<p>@page</p>
<p>import</p>
<p>=</p>
<p>&quot;org.jasig.cas.web.support.WebUtils&quot;</p>
<p>%&gt;
&lt;%</p>
<p>@page</p>
<p>import</p>
<p>=</p>
<p>&quot;java.net.URL&quot;</p>
<p>%&gt;</p>
<p>&lt;%
WebApplicationService service = (WebApplicationService) request.getAttribute(</p>
<p>&quot;service&quot;</p>
<p>);</p>
<p>String ticket  = (String) request.getAttribute(</p>
<p>&quot;serviceTicketId&quot;</p>
<p>);
String redirectURL = service.getResponse(ticket).getUrl();</p>
<p>boolean</p>
<p>serverSideRedirect =</p>
<p>false</p>
<p>;
// if redirect is for an image, js or css file</p>
<p>URL url =</p>
<p>new</p>
<p>URL(redirectURL);
String path = url.getPath();</p>
<p>int</p>
<p>dotPos = path.lastIndexOf(</p>
<p>&quot;.&quot;</p>
<p>);</p>
<p>// returns -1 if not found
if</p>
<p>( dotPos != -</p>
<p>1</p>
<p>)</p>
<p>{</p>
<p>String ext = path.substring(dotPos).toLowerCase();</p>
<p>serverSideRedirect =</p>
<p>&quot;.gif&quot;</p>
<p>.equals(ext) ||</p>
<p>&quot;.jpg&quot;</p>
<p>.equals(ext) ||</p>
<p>&quot;.png&quot;</p>
<p>.equals(ext) ||</p>
<p>&quot;.js&quot;</p>
<p>.equals(ext) ||</p>
<p>&quot;.css&quot;</p>
<p>.equals(ext);
}</p>
<p>if</p>
<p>( serverSideRedirect )
{</p>
<p>// Serverside redirect using HTTP 302</p>
<p>response.sendRedirect(redirectURL);</p>
<p>}
else</p>
<p>{</p>
<p>// Client side redirect using javascript</p>
<p>%&gt;
&lt;!DOCTYPE html PUBLIC</p>
<p>&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</p>
<p>&quot;<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" target="_blank"><a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>&quot;</a></p>
<p>&gt;</p>
<html xmlns=

"[http://www.w3.org/1999/xhtml"](http://www.w3.org/1999/xhtml)

>


<head>



<script type=

"text/javascript"

language=

"javascript"

>


<!--



window.location.replace (

"<%=redirectURL%>"

);


-->



</script>


<title>Redirect</title>



</head>


<body></body>

<p></html>
&lt;%</p>
<p>}
%&gt;</p>
<ol>
<li>Make a redirect view available to CAS by adding it to WEB-INF/classes/default_view.properties</li>
</ol>
<p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">?</a>/#/#/# Redirect view (logged in, javascript redirect to service)</p>
<p>redirectView.(</p>
<p>class</p>
<p>)=org.springframework.web.servlet.view.JstlView
redirectView.url=/WEB-INF/view/jsp/</p>
<p>default</p>
<p>/ui/redirect.jsp</p>
<ol>
<li>Modify WEB-INF/login-webflow.xml to make the redirect end state use the new view</li>
</ol>
<p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">?</a>&lt;end-state id=</p>
<p>&quot;redirect&quot;</p>
<p>view=</p>
<p>&quot;redirectView&quot;</p>
<p>/&gt;</p>
<p>Labels:</p>
<p>None</p>
<p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" title="Edit Labels ( Type &#39;l" target="_blank">Edit Labels</a>&quot;)
Powered by a free <strong>Atlassian Confluence Open Source Project License</strong> granted to Java Architectures Special Interest Group. <a href="http://www.atlassian.com/c/conf/11461" target="_blank">Evaluate Confluence today</a>.
This Confluence installation runs a Free Gliffy License - <a href="http://www.gliffy.com/products/confluence-plugin/" target="_blank">Evaluate Gliffy</a> for your Wiki!</p>
<ul>
<li>Powered by <a href="http://www.atlassian.com/software/confluence" target="_blank">Atlassian Confluence</a> 4.1.5, the <a href="http://www.atlassian.com/software/confluence/tour/enterprise-wiki.jsp" target="_blank">Enterprise Wiki</a></li>
<li>Printed by Atlassian Confluence 4.1.5, the Enterprise Wiki.</li>
<li>·  <a href="http://jira.atlassian.com/secure/BrowseProject.jspa?id=10470" target="_blank">Report a bug</a></li>
<li>·  <a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" target="_blank">Atlassian News</a></li>
</ul>
<p><a href=""></a><a href=""></a><a href=""></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--UseJavascriptRedirection-CASUserManual-Jas/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--UseJavascriptRedirection-CASUserManual-Jas" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--关于cas-server-webappforldap的principal其他属性返回的问题-/">关于cas</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--关于cas-server-webappforldap的principal其他属性返回的问题-/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-cas-server-webapp-for-ldap-principal-blogjava">关于cas-server-webapp for ldap的principal其他属性返回的问题 - 贝贝爸爸的程序人生 - BlogJava</h1>
<h1 id="-http-www-blogjava-net-yuanqixun-"><a href="http://www.blogjava.net/yuanqixun/" target="_blank">贝贝爸爸的程序人生</a></h1>
<p>关注Seam、BPM</p>
<p>posts - 23, comments - 6, trackbacks - 0, articles - 32   <a href="http://www.blogjava.net/" target="_blank">BlogJava</a> :: <a href="http://www.blogjava.net/yuanqixun/" target="_blank">首页</a> :: <a href="http://www.blogjava.net/yuanqixun/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a> :: <a href="http://www.blogjava.net/yuanqixun/contact.aspx?id=1" target="_blank">联系</a> :: <a href="http://www.blogjava.net/yuanqixun/rss" target="_blank">聚合</a> <a href="http://www.blogjava.net/yuanqixun/rss" target="_blank"><img src="" alt=""></a> :: <a href="http://www.blogjava.net/yuanqixun/admin/EditPosts.aspx" target="_blank">管理</a> <img src="" alt=""></p>
<h3 id="-">日历</h3>
<p><a href="&quot;Go to the previous month&quot;">&lt;</a>2012年4月<a href="&quot;Go to the next month&quot;">&gt;</a>日一二三四五六25262728293031123<a href="http://www.blogjava.net/yuanqixun/archive/2012/04/04.html" target="_blank">4</a>5678910111213141516171819<a href="http://www.blogjava.net/yuanqixun/archive/2012/04/20.html" target="_blank">20</a>21222324<a href="http://www.blogjava.net/yuanqixun/archive/2012/04/25.html" target="_blank">25</a><a href="http://www.blogjava.net/yuanqixun/archive/2012/04/26.html" target="_blank">26</a>2728293012345</p>
<p><img src="" alt=""></p>
<h3 id="-">常用链接</h3>
<ul>
<li><a href="http://www.blogjava.net/yuanqixun/MyPosts.html" target="_blank">我的随笔</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/MyComments.html" target="_blank">我的评论</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/OtherPosts.html" target="_blank">我的参与</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/RecentComments.html" target="_blank">最新评论</a>
<img src="" alt=""></li>
</ul>
<h3 id="-1-">留言簿(1)</h3>
<ul>
<li><a href="http://www.blogjava.net/yuanqixun/Contact.aspx?id=1" target="_blank">给我留言</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/default.aspx?opt=msg" target="_blank">查看公开留言</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/admin/MyMessages.aspx" target="_blank">查看私人留言</a></li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-19-">随笔分类(19)</h3>
<ul>
<li><a href="http://www.blogjava.net/yuanqixun/category/51531.html/rss" title="Subscribe to CAS(1)" target="_blank"><img src="&quot;Subscribe to CAS(1" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/category/51531.html" target="_blank">CAS(1)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/category/48487.html/rss" title="Subscribe to 我的儿子(1)" target="_blank"><img src="&quot;Subscribe to 我的儿子(1" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/category/48487.html" target="_blank">我的儿子(1)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/category/48486.html/rss" title="Subscribe to 生活感悟(1)" target="_blank"><img src="&quot;Subscribe to 生活感悟(1" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/category/48486.html" target="_blank">生活感悟(1)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/category/48485.html/rss" title="Subscribe to 程序人生(16)" target="_blank"><img src="&quot;Subscribe to 程序人生(16" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/category/48485.html" target="_blank">程序人生(16)</a>
<img src="" alt=""></li>
</ul>
<h3 id="-40-">随笔档案(40)</h3>
<ul>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2012/05.html" target="_blank">2012年5月 (2)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2012/04.html" target="_blank">2012年4月 (4)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2012/03.html" target="_blank">2012年3月 (7)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2012/02.html" target="_blank">2012年2月 (2)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/08.html" target="_blank">2011年8月 (1)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/07.html" target="_blank">2011年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/06.html" target="_blank">2011年6月 (1)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/05.html" target="_blank">2011年5月 (21)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2008/07.html" target="_blank">2008年7月 (1)</a></li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-17-">文章分类(17)</h3>
<ul>
<li><a href="http://www.blogjava.net/yuanqixun/category/48484.html/rss" title="Subscribe to BPM(1)" target="_blank"><img src="&quot;Subscribe to BPM(1" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/category/48484.html" target="_blank">BPM(1)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/category/48754.html/rss" title="Subscribe to GIT(2)" target="_blank"><img src="&quot;Subscribe to GIT(2" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/category/48754.html" target="_blank">GIT(2)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/category/49452.html/rss" title="Subscribe to J2EE(2)" target="_blank"><img src="&quot;Subscribe to J2EE(2" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/category/49452.html" target="_blank">J2EE(2)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/category/48483.html/rss" title="Subscribe to Linux(9)" target="_blank"><img src="&quot;Subscribe to Linux(9" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/category/48483.html" target="_blank">Linux(9)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/category/48482.html/rss" title="Subscribe to Seam2" target="_blank"><img src="&quot;Subscribe to Seam2&quot;" alt=""></a><a href="http://www.blogjava.net/yuanqixun/category/48482.html" target="_blank">Seam2</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/category/48545.html/rss" title="Subscribe to Seam3(1)" target="_blank"><img src="&quot;Subscribe to Seam3(1" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/category/48545.html" target="_blank">Seam3(1)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/category/48715.html/rss" title="Subscribe to 数据库(2)" target="_blank"><img src="&quot;Subscribe to 数据库(2" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/category/48715.html" target="_blank">数据库(2)</a>
<img src="" alt=""></li>
</ul>
<h3 id="-12-">文章档案(12)</h3>
<ul>
<li><a href="http://www.blogjava.net/yuanqixun/archives/2011/11.html" target="_blank">2011年11月 (6)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archives/2011/10.html" target="_blank">2011年10月 (2)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archives/2011/08.html" target="_blank">2011年8月 (3)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archives/2011/07.html" target="_blank">2011年7月 (1)</a></li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-25-">收藏夹(25)</h3>
<ul>
<li><a href="http://www.blogjava.net/yuanqixun/favorite/48642.html/rss" title="Subscribe to git(15)" target="_blank"><img src="&quot;Subscribe to git(15" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/favorite/48642.html" target="_blank">git(15)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/favorite/48644.html/rss" title="Subscribe to HttpComponent(2)" target="_blank"><img src="&quot;Subscribe to HttpComponent(2" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/favorite/48644.html" target="_blank">HttpComponent(2)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/favorite/49099.html/rss" title="Subscribe to JBOSS(1)" target="_blank"><img src="&quot;Subscribe to JBOSS(1" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/favorite/49099.html" target="_blank">JBOSS(1)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/favorite/51142.html/rss" title="Subscribe to linux" target="_blank"><img src="&quot;Subscribe to linux&quot;" alt=""></a><a href="http://www.blogjava.net/yuanqixun/favorite/51142.html" target="_blank">linux</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/favorite/48645.html/rss" title="Subscribe to seam3(7)" target="_blank"><img src="&quot;Subscribe to seam3(7" alt="">&quot;)</a><a href="http://www.blogjava.net/yuanqixun/favorite/48645.html" target="_blank">seam3(7)</a>
<img src="" alt=""></li>
</ul>
<h3 id="-">常用链接</h3>
<ul>
<li><a href="http://wiki.nginx.org/Chs" target="_blank">Nginx中文</a></li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-">搜索</h3>
<ul>
<li><img src="" alt=""></li>
</ul>
<h3 id="-http-www-blogjava-net-yuanqixun-commentsrss-aspx-">最新评论 <a href="http://www.blogjava.net/yuanqixun/CommentsRSS.aspx" target="_blank"><img src="" alt=""></a></h3>
<ul>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2012/03/15/364865.html#371970" target="_blank">1. re: Fedora16下安装mysql[未登录]</a></li>
<li>评论内容较长,点击标题查看</li>
<li>--fg</li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2012/01/04/364865.html#367842" target="_blank">2. re: Fedora16下安装mysql[未登录]</a></li>
<li>评论内容较长,点击标题查看</li>
<li>--fedora</li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/08/12/351379.html#356402" target="_blank">3. re: 关于GIT Flow的学习理解[未登录]</a></li>
<li>嘿嘿，被我发现了吧
我告诉你的喽。。。</li>
<li>--dd</li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/08/12/349819.html#356362" target="_blank">4. re: centos下samba的安装配置</a></li>
<li>谢谢楼主，简单明了</li>
<li>--里一方</li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/05/08/349765.html#349789" target="_blank">5. re: 正在安装Fedora操作系统</a></li>
<li>嗯，自己开发倒没问题，问题就是不好和公司其他同事沟通，例如公司的oa系统就只能ie，唉。linux应用还是很多阻力。</li>
<li>--贝贝爸爸</li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-">阅读排行榜</h3>
<ul>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/05/18/350525.html" target="_blank">1. CentOS下安装postgresql(369)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/05/26/351057.html" target="_blank">2. 在centos下配置gitosis(364)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/05/11/349988.html" target="_blank">3. 【转】centos卸载系统与环境部署(340)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/05/09/349819.html" target="_blank">4. centos下samba的安装配置(263)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/05/10/349909.html" target="_blank">5. 在CentOS下安装配置git(167)</a>
<img src="" alt=""></li>
</ul>
<h3 id="-">评论排行榜</h3>
<ul>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/05/08/349765.html" target="_blank">1. 正在安装Fedora操作系统(2)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/05/09/349819.html" target="_blank">2. centos下samba的安装配置(1)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/05/31/351379.html" target="_blank">3. 关于GIT Flow的学习理解(1)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/05/27/351210.html" target="_blank">4. 【转】在CentOS下安装配置postgresql8.3(0)</a></li>
<li><a href="http://www.blogjava.net/yuanqixun/archive/2011/05/26/351129.html" target="_blank">5. Mysql常用命令(0)</a> ## <a href="">关于cas-server-webapp for ldap的principal其他属性返回的问题</a></li>
</ul>
<p>Posted on 2012-04-25 23:12 <a href="http://www.blogjava.net/yuanqixun/" target="_blank">贝贝爸爸</a> 阅读(44) <a href="http://www.blogjava.net/yuanqixun/archive/2012/04/25/376638.html#Post" target="_blank">评论(0)</a>  <a href="http://www.blogjava.net/yuanqixun/admin/EditPosts.aspx?postid=376638" target="_blank">编辑</a>  <a href="http://www.blogjava.net/yuanqixun/AddToFavorite.aspx?id=376638" target="_blank">收藏</a> 所属分类: <a href="http://www.blogjava.net/yuanqixun/category/51531.html" target="_blank">CAS</a> <img src="" alt=""></p>
<p>nnd，今天搞了快2个小时，总是无法解决ldap支持的其他属性返回问题，因为之前配置的是3.3.5版本，现在最新的版本是3.4.11，原来的配置竟然无法使用了，原来是因为增加服务：</p>
<p><bean id="serviceRegistryDao" class="org.jasig.cas.services.InMemoryServiceRegistryDaoImpl">
导致无法返回principal的其他属性到客户端，其实象这样配置即可：<bean id="attributeRepository"
  class="org.jasig.services.persondir.support.ldap.LdapPersonAttributeDao">
  <property name="contextSource" ref="contextSource" />
  <property name="baseDN" value="ou=users,${ldap.basePath}" />
  <property name="requireAllQueryAttributes" value="true" />
  <!--
  Attribute mapping beetween principal (key) and LDAP (value) names
  used to perform the LDAP search.  By default, multiple search criteria
  are ANDed together.  Set the queryType property to change to OR.
  -->
  <property name="queryAttributeMapping">
    <map>
      <entry key="username" value="uid" />
    </map>
  </property></p>
  <property name="resultAttributeMapping">
    <map>
    <!-- Mapping beetween LDAP entry attributes (key) and Principal's (value) -->
    <entry key="name" value="userName"/>
    <entry key="uid" value="userId"/>
    </map>
  </property>
</bean>
    <bean id="serviceRegistryDao" class="org.jasig.cas.services.InMemoryServiceRegistryDaoImpl">
        <property name="registeredServices">
            <list>
                <bean class="org.jasig.cas.services.RegisteredServiceImpl">
                    <property name="id" value="0" />
                    <property name="name" value="HTTP" />
                    <property name="description" value="Only Allows HTTP Urls" />
                    <property name="serviceId" value="http:///*/*" />
                    <property name="evaluationOrder" value="10000001" />
                    <property name="ignoreAttributes" value="true" />
                </bean>
                                ………………
                        </list>
                </property>
        </bean> 如上所示，其中注册的服务registeredServices
默认是不允许返回其他属性到客户端的！！！！！，真的是很坑爹啊，不过，配置一下ignoreAttributes即可，也可以指定allowedAttributes
如下：
<property name="allowedAttributes">
    <list>
            <value><!-- your attribute key --></value>
    </list>
</property>

<p><a href="http://www.blogjava.net/RequireRegister.aspx" target="_blank">新用户注册</a>  <a href="">刷新评论列表</a>  </p>
<p><a href=""></a> <a href="http://q.cnblogs.com/">博问 - 解决您的IT难题</a>   <a href="http://www.cnblogs.com/" target="_blank">博客园</a>  <a href="http://q.cnblogs.com/" target="_blank">博问</a>  <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>  <a href="http://job.cnblogs.com/cate-java_programmer/" target="_blank">Java程序员招聘</a> 标题  请输入标题 姓名  请输入你的姓名 主页 请输入验证码 验证码 /*  <img src="" alt=""> 内容(请不要发表任何与政治相关的内容) 请输入评论内容 Remember Me?   <a href="http://www.blogjava.net/login.aspx?ReturnURL=http://www.blogjava.net/yuanqixun/archive/2012/04/25/376638.html&amp;SourceURL=/yuanqixun/archive/2012/04/25/376638.html" target="_blank">登录</a>       [使用Ctrl+Enter键可以直接提交]    IT新闻：
· <a href="http://news.cnblogs.com/n/149144/" target="_blank">指尖上的体验：从可折叠iPhone物理键盘Spike说起</a>
· <a href="http://news.cnblogs.com/n/149143/" target="_blank">解密腾讯星云</a>
· <a href="http://news.cnblogs.com/n/149142/" target="_blank">图书出版业如何应对数字盗版</a>
· <a href="http://news.cnblogs.com/n/149141/" target="_blank">资本局中局：成也萧何败也萧何</a>
· <a href="http://news.cnblogs.com/n/149138/" target="_blank">微软本周发布9个补丁 影响所有Windows/Office</a></p>
<p>博客园首页随笔：
· <a href="http://www.cnblogs.com/wangjq/archive/2012/07/09/2582485.html" target="_blank">设计模式学习笔记-适配器模式</a>
· <a href="http://www.cnblogs.com/liusy1988/archive/2012/07/09/2570438.html" target="_blank">[原创]一起来做网页游戏---第一章 巧妇难为无米之炊</a>
· <a href="http://www.cnblogs.com/kaitao/archive/2012/07/09/2582571.html" target="_blank">Spring3开发实战 之 第二章：IoC/DI开发（1）</a>
· <a href="http://www.cnblogs.com/HuiTai/archive/2012/07/09/MVC-7.html" target="_blank">第七话 Asp.Net Mvc 3.0【MVC项目实战の三】</a>
· <a href="http://www.cnblogs.com/respawn/archive/2012/07/09/2582548.html" target="_blank">GNU C - Using GNU GCC <strong>attribute</strong> mechanism 01</a>
知识库：
· <a href="http://kb.cnblogs.com/page/148238/" target="_blank">Web前端：11个让你代码整洁的原则</a>
· <a href="http://kb.cnblogs.com/page/143279/" target="_blank">页面前端的水有多深？再议页面开发</a>
· <a href="http://kb.cnblogs.com/page/130367/" target="_blank">Fiddler 教程</a>
· <a href="http://kb.cnblogs.com/page/148772/" target="_blank">关于编程学习的七点思索</a>
· <a href="http://kb.cnblogs.com/page/115175/" target="_blank">一地鸡毛 — 软件项目中的人际困局</a>  网站导航:</p>
<p><a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园</a>   <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>   <a href="http://kb.cnblogs.com/" target="_blank">知识库</a>   <a href="http://www.cppblog.com/" target="_blank">C++博客</a>   <a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a>   <a href="http://www.blogjava.net/yuanqixun/archive/2012/04/25/376638.html?opt=admin" target="_blank">管理</a>    Powered by:
<a href="http://www.blogjava.net/" target="_blank">BlogJava</a>
Copyright © 贝贝爸爸</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--关于cas-server-webappforldap的principal其他属性返回的问题-/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--关于cas-server-webappforldap的principal其他属性返回的问题-" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/">cas改造随笔 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas-horus-">cas改造随笔 - horus - 博客园</h1>
<p><a href=""></a></p>
<p><a href="http://www.cnblogs.com/hellowood/" target="_blank">hello wood</a>
<a href="http://www.cnblogs.com/" target="_blank">博客园</a>   <a href="http://www.cnblogs.com/hellowood/" target="_blank">首页</a>   <a href="http://space.cnblogs.com/" target="_blank">社区</a>   <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a>   <a href="http://space.cnblogs.com/msg/send/horus" target="_blank">联系</a>   <a href="http://www.cnblogs.com/hellowood/rss" target="_blank">订阅</a><a href="http://www.cnblogs.com/hellowood/rss" target="_blank"><img src="" alt="订阅"></a>   <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx" target="_blank">管理</a></p>
<p>随笔-9  评论-5  文章-1  trackbacks-0</p>
<h1 id="-cas-http-www-cnblogs-com-hellowood-archive-2010-08-05-1793364-html-"><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html" target="_blank">cas改造随笔</a></h1>
<p>Sso doc</p>
<p>关键字：</p>
<p>sso域名：cas.server.com</p>
<p>登陆地址（spring web flow）：<a href="https://cas.800jit.com/cas/login" target="_blank"><a href="https://cas.800jit.com/cas/login">https://cas.800jit.com/cas/login</a></a></p>
<p>登陆地址（直接）：<a href="https://cas.800jit.com/cas/directLogin" target="_blank"><a href="https://cas.800jit.com/cas/directLogin">https://cas.800jit.com/cas/directLogin</a></a></p>
<p>退出地址：<a href="https://cas.800jit.com/cas/logout" target="_blank"><a href="https://cas.800jit.com/cas/logout">https://cas.800jit.com/cas/logout</a></a></p>
<p>语言参数：locale=zh_CN，locale=en</p>
<h1 id="-">环境篇</h1>
<p> <img src="" alt=""></p>
<h2 id="-">一、所需软件</h2>
<p>Jdk：jdk1.6.0_13</p>
<p>Apache：httpd-2.2.15-win32-x86-openssl-0.9.8m-r2</p>
<p>Tomcat：apache-tomcat-6.0.10</p>
<p>jks2pfx：证书导出工具<a href="http://www.myssl.cn/download/jks2pfx.zip" target="_blank"><a href="http://www.myssl.cn/download/jks2pfx.zip">http://www.myssl.cn/download/jks2pfx.zip</a></a></p>
<p>memcache：memcached-1.2.1-win32（需要memcache集群环境）</p>
<h2 id="-">二、安全证书生成</h2>
<p>1、<strong>keytool</strong></p>
<p>Apache、tomcat、jdk需要使用安全证书，进windows command窗口生成证书，命令如下：</p>
<p>--生成证书库</p>
<p>keytool -genkey -alias 800jit -keyalg RSA -keystore d:/cert/800jitkey</p>
<p>--从证书库中到处证书</p>
<p>keytool -export -file d:/cert/800jit.crt -alias 800jit -keystore d:/cert/800jitkey</p>
<p>--把证书导入jdk的证书库</p>
<p>keytool -import -keystore d: /jdk1.6.0_13/jre/lib/security/cacerts -file d:/cert/800jit.crt -alias 800jit</p>
<p>--生成Apache服务器的SSL连接需要配置私钥文件和证书文件</p>
<p>D:\casex\jks2pfx&gt;JKS2PFX.bat .keystore 800jitkey tomcat server_dev00</p>
<p>生成的server_dev00.crt，server_dev00.key放到D:/work/Apache2.2/conf/</p>
<p><strong>2**</strong>、openssl**</p>
<p>openssl req -config ..\conf\openssl.cnf -new -out olymtech.csr</p>
<p>openssl rsa -in privkey.pem -out olymtech.key</p>
<p>openssl x509 -in olymtech.csr -out olymtech.cert -req -signkey olymtech.key -days 3650</p>
<p>openssl x509 -in olymtech.cert -out olymtech.der.crt -outform DER</p>
<p>keytool -import -keystore d:/work/jdk1.6.0_13/jre/lib/security/cacerts -file d:/casex/ssl/olymtech.crt -alias olymtech</p>
<p>keytool -import -keystore D:/casex/800jitkey -file D:/casex/cas-doc/ssl/olymtech.crt -alias olymtech</p>
<h2 id="-apache-">三、Apache配置</h2>
<p>Apache+ssl+虚拟机</p>
<p>--修改http.conf文件</p>
<p>取消注释 LoadModule ssl_module modules/mod_ssl.so</p>
<p>取消注释 Include conf/extra/httpd-ssl.conf</p>
<p>取消注释 Include conf/extra/httpd-vhosts.conf</p>
<p>ProxyPass /cas  balancer://cas lbmethod=bytraffic stickysession=jsessionid</p>
<proxy balancer://cas/>

    BalancerMember ajp://192.168.1.190:10009/cas  loadfactor=1 route=jvm1

    BalancerMember ajp://192.168.1.190:8009/cas  loadfactor=1 route=jvm2

</proxy>



<p>--修改httpd-ssl.conf</p>
<p>在<VirtualHost _default_:443>下增加</p>
<p>ProxyPass /cas  balancer://cas/ lbmethod=bytraffic stickysession=jsessionid</p>
<p>ProxyPassReverse /cas balancer://cas/</p>
<p>SSLProxyEngine On</p>
<p>修改</p>
<p>SSLCertificateFile &quot;D:/work/Apache2.2/conf/server_dev00.crt&quot;</p>
<p>SSLCertificateKeyFile &quot;D:/work/Apache2.2/conf/server_dev00.key&quot;</p>
<p>--修改httpd-vhosts.conf</p>
<p>在<VirtualHost /*:80>下增加</p>
<p>ProxyPass /cas  balancer://cas/ lbmethod=bytraffic stickysession=jsessionid</p>
<p>ProxyPassReverse /cas balancer://cas/</p>
<h2 id="-tomcat-">四、Tomcat配置</h2>
<p>修改server.xml</p>
<p>--配置ssl</p>
<Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"

               maxThreads="150" scheme="https" secure="true"

               clientAuth="false" sslProtocol="TLS"

                        keystoreFile="d:/work/apache-tomcat-6.0.10/conf/800jitkey"

                        keystorePass="111111" />



<h2 id="-session-tomcat-">五、session共享（Tomcat）</h2>
<h2 id="-memcache-">六、memcache集群</h2>
<h1 id="cas-server-">CAS SERVER篇</h1>
<h2 id="-cas-">一、CAS 原理介绍</h2>
<p> <img src="" alt=""></p>
<p>访问流程图</p>
<p><strong>主要原理：</strong>用户第一次访问一个CAS 服务的客户web 应用时（访问URL ：<a href="http://192.168.1.90:8081/web1" target="_blank"><a href="http://192.168.1.90:8081/web1">http://192.168.1.90:8081/web1</a></a> ），部署在客户web 应用的cas AuthenticationFilter ，会截获此请求，生成service 参数，然后redirect 到CAS 服务的login 接口，url为<a href="https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F" target="_blank"><a href="https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F">https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F</a></a> ，认证成功后，CAS 服务器会生成认证cookie ，写入浏览器，同时将cookie 缓存到服务器本地，CAS 服务器还会根据service 参数生成ticket,ticket 会保存到服务器，也会加在url 后面，然后将请求redirect 回客户web 应用，url 为<a href="http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20" target="_blank"><a href="http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20">http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20</a></a> 。这时客户端的AuthenticationFilter 看到ticket 参数后，会跳过，由其后面的TicketValidationFilter 处理，TicketValidationFilter 会利用httpclient 工具访问cas 服务的/serviceValidate 接口, 将ticket 、service 都传到此接口，由此接口验证ticket 的有效性，TicketValidationFilter 如果得到验证成功的消息，就会把用户信息写入web 应用的session里。至此为止，SSO 会话就建立起来了，以后用户在同一浏览器里访问此web 应用时，AuthenticationFilter 会在session 里读取到用户信息，所以就不会去CAS 认证，如果在此浏览器里访问别的web 应用时，AuthenticationFilter 在session 里读取不到用户信息，会去CAS 的login 接口认证，但这时CAS 会读取到浏览器传来的cookie ，所以CAS 不会要求用户去登录页面登录，只是会根据service 参数生成一个ticket ，然后再和web 应用做一个验证ticket 的交互。</p>
<h2 id="-cas-">二、CAS 服务端的处理逻辑</h2>
<p>CAS 服务端总共对外定义了9 个接口，客户端通过访问这9 个接口与服务端交互，这9个接口为：
接口</p>
<p>说明</p>
<p>备注 /login</p>
<p>认证接口</p>
<p>  /logout</p>
<p>退出接口，负责销毁认证cookie</p>
<p>  /validate</p>
<p>验证ticket 用的接口，CAS1.0 定义</p>
<p>  /serviceValidate</p>
<p>验证ticket 用的接口，CAS2.0 定义，返回xml 格式的数据</p>
<p>  /proxy</p>
<p>支持代理认证功能的接口</p>
<p>  /proxyValidate</p>
<p>支持代理认证功能的接口</p>
<p>  /CentralAuthenticationService</p>
<p>用于和远程的web services 交互</p>
<p>  /remoteLogin（新增）</p>
<p>认证接口</p>
<p>  /directLogin（新增）</p>
<p>认证接口</p>
<p>详细说明：</p>
<p> <strong>/login:</strong></p>
<p>登录流程这部分要考虑到不同种类用户凭证的获取方案，以及客户应用传来的service 、gateway 、renew 参数的不同取值组合，CAS 为了实现流程的高度可配置性，采用了Spring Web Flow 技术。通过CAS 发布包里的login-webflow.xml 、cas-servlet.xml 、applicationContext.xml 这3 个文件，找出 了登录有关的所有组件，画出处理流程图。</p>
<p> <img src="" alt=""></p>
<p>CAS 默认的登录处理流程</p>
<p> <img src="" alt=""></p>
<p>第一次访问Web 应用的流程走向</p>
<p> <img src="" alt=""></p>
<p>已经登录web1 后，访问web1 的资源（web1 没有启动session ），或访问web2 的资源</p>
<p>注：</p>
<p>1 ： InitialFlowSetupAction: 是流程的入口。用 request.getContextPath() 的值来设置 cookie 的 Path 值， Cookie 的 path 值是在配置文件里定义的，但这个 Action 负责将 request.getContextPath() 的值设置为 Cookie 的 path 值，这是在 cas 部署环境改变的情况下，灵活地设置 cookie path 的方式；把 cookie 的值以及 service 参数的值放入 requestContext 的 flowscope 里。</p>
<p>2 ： GenerateServiceTicketAction 此 Action 负责根据 service 、 GTC cookie 值生成 ServiceTicket 对象， ServiceTicket 的 ID 就是返回给客户应用的 ticket 参数，如果成功创建 ServiceTicket ，则转发到 WarnAction ，如果创建失败，且 gateway 参数为 true ，则直接redirect 到客户应用， 否则则需要重新认证。</p>
<p>3 ： viewLoginForm 这是登录页面， CAS 在此收集用户凭证。 CAS 提供的默认实现是 /WEB-INF/view/jsp/simple/ui/casLoginView.jsp 。</p>
<p>4 ： bindAndValidate 对应 AuthenticationViaFormAction 的 doBind 方法，该方法负责搜集登录页面上用户录入的凭证信息（用户名、密码等），然后把这些信息封装到 CAS 内部的 Credentials 对象中。用户在 casLoginView.jsp 页面上点击提交后，会触发此方法。</p>
<p>5:submit   对应 AuthenticationViaFormAction 的 submit 方法 , 如果 doBind 方法成功执行完， 则触发 submit 方法，此方法负责调用centralAuthenticationService 的      grantServiceTicket 方法，完成认证工作，如果认证成功，则生成 TicketGrantingTicket 对象，放在缓存里， TicketGrantingTicket 的 ID 就是 TGC Cookie 的 value 值。</p>
<p>6 ： warn  CAS 提供了一个功能：用户在一个 web 应用中跳到另一个 web 应用时， CAS 可以跳转到一个提示页面，该页面提示用户要离开一个应用进入另一个应用，可以让用户自己选择。用户在登录页面 viewLoginForm 上选中了 id=”warn” 的复选框，才能开启这个功能。</p>
<p>WarnAction 就检查用户有没有开启这个功能，如果开启了，则转发到showWarnView, 如果没开启，则直接redirect 到客户应用。</p>
<p>7 ：SendTicketGrantingTicketAction 此Action 负责为response 生成TGC Cookie ，cookie 的值就是 AuthenticationViaFormAction 的submit 方法生成的 TicketGrantingTicket 对象的 ID 。</p>
<p>8 ： viewGenerateLoginSuccess 这是 CAS 的认证成功页面。</p>
<p><strong>/logout:</strong> （ 对应实现类 org.jasig.cas.web.LogoutController ）</p>
<p>处理逻辑：   </p>
<pre><code>    1) removeCookie

   2) 在服务端删除TicketGrantingTicket 对象（此对象封装了cookie 的value 值）

   3 ）redirect 到退出页面，有2 种选择：

      if(LogoutController 的followServiceRedirects 属性为true 值，且url 里的service 参数非空){

            redirect 到 sevice 参数标识的url

         }

      else{

         redirect 到内置的casLogoutView （cas/WEB-INF/view/jsp/default/ui/casLogoutView.jsp ），如果url 里有url 参数，则此url 参数标识的链接会显示在casLogoutView 页面上。

       }
</code></pre><p><strong>/serviceValidate: </strong>（对应实现类 org.jasig.cas.web.ServiceValidateController ）</p>
<p> 处理逻辑：  </p>
<p>  如果service 参数为空或ticket 参数为空，则转发到failureView （/WEB-INF/view/jsp/default/protocol/2.0/casServiceValidationFailure.jsp ）</p>
<pre><code>验证ticket 。以ticket 为参数，去缓存里找ServiceTicketImpl 对象，如果能找到，且没有过期，且ServiceTicketImpl 对象对应的service 属性和service 参数对应，则验证通过，验证通过后，请求转发至casServiceSuccessView （cas/WEB-INF/view/jsp/default/protocol/2.0/casServiceValidationSuccess.jsp ），验证不通过，则转发到failureView 。
</code></pre><h2 id="-">三、认证相关的概念及流程</h2>
<p>概念</p>
<ul>
<li><strong>Credentials**</strong> **用户提供的用于登录用的凭据信息，如用户名/ 密码、证书、IP 地址、Cookie 值等。比如 UsernamePasswordCredentials ，封装的是用户名和密码。CAS 进行认证的第一步，就是把从UI 或request 对象里取到的用户凭据封装成Credentials 对象，然后交给认证管理器去认证。</li>
<li><strong>AuthenticationHandler**</strong> **认证Handler, 每种AuthenticationHandler 只能处理一种Credentials ，如AbstractUsernamePasswordAuthenticationHandler 只负责处理 U sernamePasswordCredentials 。</li>
<li><strong>Principal</strong> 封装用户标识，比如 SimplePrincipal, 只是封装了用户名。认证成功后， credentialsToPrincipalResolvers 负责由Credentials 生成 Principal 对象。</li>
<li><strong>CredentialsToPrincipalResolvers**</strong> **负责由 Credentials 生成 Principal 对象，每种 CredentialsToPrincipalResolvers 只处理 一种Credentials ，比如 UsernamePasswordCredentialsToPrincipalResolver 负责从 U sernamePasswordCredentials 中取出用户名，然后将其赋给生成的 SimplePrincipal 的 ID 属性。</li>
<li><strong>AuthenticationMetaDataPopulators</strong> 负责将 Credentials 的一些属性赋值给 Authentication 的 attributes 属性。</li>
<li><strong>Authentication</strong>   Authentication是认证管理器的最终处理结果， Authentication 封装了 Principal ，认证时间，及其他一些属性（可能来自 Credentials ）。</li>
<li><strong>AuthenticationManager</strong> 认证管理器得到 Credentials 对象后，负责调度AuthenticationHandler 去完成认证工作，最后返回的结果是 Authentication 对象。</li>
<li><strong>CentralAuthenticationService**</strong> <strong> CAS 的服务类，对 Web 层提供了一些方法。该类还负责调用 AuthenticationManager 完成认证逻辑</strong>。**</li>
</ul>
<p>序列图</p>
<p> <img src="" alt=""></p>
<p>类图</p>
<p> <img src="" alt=""></p>
<h2 id="-ticket-http-zhenkm0507-javaeye-com-blog-546805-">四、<a href="http://zhenkm0507.javaeye.com/blog/546805" target="_blank">Ticket介绍</a></h2>
<p>CAS的核心就是其Ticket，及其在Ticket之上的一系列处理操作。CAS的主要票据有TGT、ST、PGT、PGTIOU、PT，其中TGT、ST是CAS1.0协议中就有的票据，PGT、PGTIOU、PT是CAS2.0协议中有的票据。</p>
<h3 id="-">一 名词解释</h3>
<ul>
<li>TGT（Ticket Grangting Ticket）</li>
</ul>
<p>TGT是CAS为用户签发的登录票据，拥有了TGT，用户就可以证明自己在CAS成功登录过。TGT封装了Cookie值以及此Cookie值对应的用户信息。用户在CAS认证成功后，CAS生成cookie，写入浏览器，同时生成一个TGT对象，放入自己的缓存，TGT对象的ID就是cookie的值。当HTTP再次请求到来时，如果传过来的有CAS生成的cookie，则CAS以此cookie值为key查询缓存中有无TGT ，如果有的话，则说明用户之前登录过，如果没有，则用户需要重新登录。</p>
<ul>
<li>ST（Service Ticket）</li>
</ul>
<p>ST是CAS为用户签发的访问某一service的票据。用户访问service时，service发现用户没有ST，则要求用户去CAS获取ST。用户向CAS发出获取ST的请求，如果用户的请求中包含cookie，则CAS会以此cookie值为key查询缓存中有无TGT，如果存在TGT，则用此TGT签发一个ST，返回给用户。用户凭借ST去访问service，service拿ST去CAS验证，验证通过后，允许用户访问资源。</p>
<ul>
<li>PGT（Proxy Granting Ticket）</li>
</ul>
<p>Proxy Service的代理凭据。用户通过CAS成功登录某一Proxy Service后，CAS生成一个PGT对象，缓存在CAS本地，同时将PGT的值（一个UUID字符串）回传给Proxy Service，并保存在Proxy Service里。Proxy Service拿到PGT后，就可以为Target Service（back-end service）做代理，为其申请PT。</p>
<ul>
<li>PGTIOU（Proxy Granting Ticket IOU）</li>
</ul>
<p>PGTIOU是CAS协议中定义的一种附加票据，它增强了传输、获取PGT的安全性。
PGT的传输与获取的过程：Proxy Service调用CAS的serviceValidate接口验证ST成功后，CAS首先会访问pgtUrl指向的https url，将生成的 PGT及PGTIOU传输给proxy service，proxy service会以PGTIOU为key，PGT为value，将其存储在Map中；然后CAS会生成验证ST成功的xml消息，返回给Proxy Service，xml消息中含有PGTIOU，proxy service收到Xml消息后，会从中解析出PGTIOU的值，然后以其为key，在map中找出PGT的值，赋值给代表用户信息的Assertion对象的pgtId，同时在map中将其删除。</p>
<ul>
<li>PT（Proxy Ticket）</li>
</ul>
<p>PT是用户访问Target Service（back-end service）的票据。如果用户访问的是一个Web应用，则Web应用会要求浏览器提供ST，浏览器就会用cookie去CAS获取一个ST，然后就可以访问这个Web应用了。如果用户访问的不是一个Web应用，而是一个C/S结构的应用，因为C/S结构的应用得不到cookie，所以用户不能自己去CAS获取ST，而是通过访问proxy service的接口，凭借proxy service的PGT去获取一个PT，然后才能访问到此应用。</p>
<h3 id="-">二 代码解析</h3>
<p> <img src="" alt=""></p>
<p>CAS Ticket类图</p>
<ul>
<li>TicketGrantingTicket 的 grantServiceTicket方法</li>
</ul>
<p>方法声明：public synchronized ServiceTicket grantServiceTicket(final String id,final Service service, final ExpirationPolicy expirationPolicy, final boolean credentialsProvided)</p>
<p>方法描述:</p>
<p> 1：生成SerivceTicketImpl</p>
<p> 2：更新属性：</p>
<p>this.previousLastTimeUsed = this.lastTimeUsed;</p>
<p>   this.lastTimeUsed = System.currentTimeMillis();</p>
<p>   this.countOfUses++;</p>
<p> 3：给service对象的principal属性赋值</p>
<p> 4：将service对象放入map services</p>
<ul>
<li>ServiceTicket 的 grantTicketGrantingTicket方法</li>
</ul>
<p>方法声明：</p>
<p>public TicketGrantingTicket grantTicketGrantingTicket(final String id, final Authentication authentication,final ExpirationPolicy expirationPolicy)</p>
<p>方法描述：在CAS3.3对CAS2.0协议的实现中，PGT是由ST签发的，调用的就是ServiceTicket的grantTicketGrantingTicket方法。方法返回的TicketGrantingTicket对象，表征的是一个PGT对象，其中的ticketGrantingTicket属性的值是签发ST的TGT对象。</p>
<ul>
<li>TicketGrantingTicket 的 expire方法</li>
</ul>
<p>方法声明：void expire()</p>
<p>方法描述：</p>
<p>在CAS的logout接口实现中，要调用TGT对象的expire方法，然后会在缓存中清除此TGT对象。</p>
<p>expire方法的内容：循环遍历 services 中的Service对象，调用其logoutOfService方法。具体Service实现类中的logoutOfService方法的实现，要通知具体的应用，客户要退出。</p>
<h3 id="-tgt-st-pgt-pt-">三、TGT、ST、PGT、PT关系</h3>
<p>1：ST是TGT签发的。用户在CAS上认证成功后，CAS生成TGT，用TGT签发一个ST，ST的ticketGrantingTicket属性值是TGT对象，然后把ST的值redirect到客户应用。</p>
<p>2：PGT是ST签发的。用户凭借ST去访问Proxy service，Proxy service去CAS验证ST（同时传递PgtUrl参数给CAS），如果ST验证成功，则CAS用ST签发一个PGT，PGT对象里的ticketGrantingTicket是签发ST的TGT对象。</p>
<p>3：PT是PGT签发的。Proxy service代理back-end service去CAS获取PT的时候，CAS根据传来的pgt参数，获取到PGT对象，然后调用其grantServiceTicket方法，生成一个PT对象。</p>
<p> <img src="" alt=""></p>
<p>TGT、ST、PGT、PT之间的关联关系</p>
<h1 id="cas-client-">CAS CLIENT篇</h1>
<h2 id="casfilter-">CASFilter 参数说明：</h2>
<p>参数</p>
<p>是否必须</p>
<p>说明 com.olymtech.cas.client.filter.loginUrl</p>
<p>是</p>
<p>指定 CAS 提供登录页面的 URL com.olymtech.cas.client.filter.validateUrl</p>
<p>是</p>
<p>指定 CAS 提供 service ticket 或 proxy ticket 验证服务的 URL com.olymtech.cas.client.filter.serverName</p>
<p>是</p>
<p>指定客户端的域名和端口，是指客户端应用所在机器而不是 CAS Server 所在机器，该参数或 serviceUrl 至少有一个必须指定 com.olymtech.cas.client.filter.serviceUrl</p>
<p>否</p>
<p>该参数指定过后将覆盖 serverName 参数，成为登录成功过后重定向的目的地址 com.olymtech.cas.client.filter.wrapRequest</p>
<p>否</p>
<p>如果指定为 true，那么 CASFilter 将重新包装 HttpRequest,并且使 getRemoteUser() 方法返回当前登录用户的用户名 com.olymtech.cas.client.filter.noFilter</p>
<p>否</p>
<p>设置不过滤的路径，语法如下：/name1/,/name2, com.olymtech.cas.client.filter.proxyCallbackUrl</p>
<p>否</p>
<p>用于当前应用需要作为其他服务的代理(proxy)时获取 Proxy Granting Ticket 的地址 com.olymtech.cas.client.filter.authorizedProxy</p>
<p>否</p>
<p>用于允许当前应用从代理处获取 proxy tickets，该参数接受以空格分隔开的多个 proxy URLs，但实际使用只需要一个成功即可。当指定该参数过后，需要修改 validateUrl 到 proxyValidate，而不再是 serviceValidate com.olymtech.cas.client.filter.renew</p>
<p>否</p>
<p>如果指定为 true，那么受保护的资源每次被访问时均要求用户重新进行验证，而不管之前是否已经通过 com.olymtech.cas.client.filter.gateway</p>
<p>否</p>
<p>指定 gateway 属性</p>
<h1 id="-">应用整合篇</h1>
<h2 id="-java-">一、JAVA程序整合</h2>
<p><strong>1、**</strong>应用配置说明（结合cas client<strong>**）</strong></p>
<p>导入key到本地jdk（tomcat使用的jdk必须）</p>
<p>keytool -import -keystore d:/work/jdk1.6.0_13/jre/lib/security/cacerts -file d:/casex/800jit.crt -alias 800jit</p>
<p>在ie中导入证书800jit.crt</p>
<p>修改web程序的web.xml添加</p>
<pre><code>&lt;!-- 用于单点退出 --&gt;

&lt;listener&gt;

    &lt;listener-class&gt;org.jasig.cas.client.session.SingleSignOutHttpSessionListener&lt;/listener-class&gt;

&lt;/listener&gt;



&lt;filter&gt;

&lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;

&lt;filter-class&gt;org.jasig.cas.client.session.SingleSignOutFilter&lt;/filter-class&gt;

&lt;/filter&gt;



&lt;!-- 用于单点登录 --&gt;



&lt;filter&gt;

   &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;

   &lt;filter-class&gt;com.olymtech.cas.client.filter.CASFilter&lt;/filter-class&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.loginUrl&lt;/param-name&gt;

       &lt;param-value&gt;https://cas.server.com/cas/login&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.validateUrl&lt;/param-name&gt;

       &lt;param-value&gt;https://cas.server.com/cas/serviceValidate&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.serverName&lt;/param-name&gt;

       &lt;param-value&gt;saas.server.com&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.wrapRequest&lt;/param-name&gt;

       &lt;param-value&gt;true&lt;/param-value&gt;

   &lt;/init-param&gt;

&lt;/filter&gt;



&lt;filter-mapping&gt;

   &lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;

   &lt;url-pattern&gt;//*&lt;/url-pattern&gt;

&lt;/filter-mapping&gt;



&lt;filter-mapping&gt;

   &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;

   &lt;url-pattern&gt;//*&lt;/url-pattern&gt;

&lt;/filter-mapping&gt;
</code></pre><p>在jsp/servlet中得到登陆数据：</p>
<p>&lt;%@ page language=&quot;java&quot; import=&quot;com.olymtech.cas.client.filter.CASFilterRequestWrapper&quot;%&gt;</p>
<p>&lt;%</p>
<p>CASFilterRequestWrapper  reqWrapper=<strong>new</strong> CASFilterRequestWrapper(request);</p>
<p>String username = reqWrapper.getRemoteUser();</p>
<p>%&gt;</p>
<h2 id="-net-">二、.NET程序整合</h2>
<h1 id="-">附件</h1>
<p>ssl.rar（证书）</p>
<p>http.conf（apache配置文件）</p>
<p>httpd-ssl.conf（apache配置文件）</p>
<p>httpd-vhosts.conf（apache配置文件）</p>
<p>server.xml（tomcat配置文件）</p>
<p>AppSsoDemo-java.rar（java整合例子，包含所需jar包）</p>
<p>posted on 2010-08-05 17:23 <a href="http://www.cnblogs.com/hellowood/" target="_blank">horus</a> 阅读(2394) 评论(2) <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx?postid=1793364" target="_blank">编辑</a> <a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#" target="_blank">收藏</a>
<img src="" alt=""></p>
<p><a href="">刷新评论</a><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#" target="_blank">刷新页面</a><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#top" target="_blank">返回顶部</a></p>
<p><a href="http://q.cnblogs.com/" target="_blank">程序员问答社区，解决您的技术难题</a>
<a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园首页</a><a href="http://q.cnblogs.com/" title="程序员问答社区" target="_blank">博问</a><a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a>
Powered by: <a href="http://www.cnblogs.com/" target="_blank">博客园</a> 模板提供：<a href="http://blog.hjenglish.com/" target="_blank">沪江博客</a> Copyright ©2012 horus</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--cas改造随笔-horus-博客园" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/79/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/77/">77</a></li><li><a class="page-number" href="/page/78/">78</a></li><li><a class="page-number" href="/page/79/">79</a></li><li class="active"><li><span class="page-number current">80</span></li><li><a class="page-number" href="/page/81/">81</a></li><li><a class="page-number" href="/page/82/">82</a></li><li><a class="page-number" href="/page/83/">83</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/81/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 16:01:37</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
