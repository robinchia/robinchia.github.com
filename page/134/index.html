
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 134 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-mysql--使用java实现自动备份mysql数据库-苳眠的牧场-ITeye技术网站/">使用java实现自动备份mysql数据库 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:33.000Z"> <a href="/2014/02/02/2014-02-02-DB-mysql--使用java实现自动备份mysql数据库-苳眠的牧场-ITeye技术网站/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-java-mysql-iteye-">使用java实现自动备份mysql数据库 - 苳眠的牧场 - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">资讯</a> <a href="http://www.iteye.com/magazines" target="_blank">精华</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a> <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://wangjie2013.iteye.com/blog/1858541#" target="_blank">更多 ▼</a></p>
<p><a href="http://job.iteye.com/iteye" target="_blank">招聘</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://wangjie2013.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://wangjie2013.iteye.com/login" target="_blank">登录</a> <a href="http://wangjie2013.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-http-wangjie2013-iteye-com-"><a href="http://wangjie2013.iteye.com/" target="_blank">苳眠的牧场</a></h1>
<ul>
<li><a href="http://wangjie2013.iteye.com/" target="_blank"><strong>博客</strong></a></li>
<li><a href="http://wangjie2013.iteye.com/weibo" target="_blank">微博</a></li>
<li><a href="http://wangjie2013.iteye.com/album" target="_blank">相册</a></li>
<li><a href="http://wangjie2013.iteye.com/link" target="_blank">收藏</a></li>
<li><a href="http://wangjie2013.iteye.com/blog/guest_book" target="_blank">留言</a></li>
<li><a href="http://wangjie2013.iteye.com/blog/profile" target="_blank">关于我</a></li>
</ul>
<h3 id="-java-mysql-"><a href="">使用java实现自动备份mysql数据库</a> **</h3>
<p><strong>博客分类：</strong></p>
<ul>
<li><p><a href="http://wangjie2013.iteye.com/category/276804" target="_blank">mysql</a>
<a href="http://www.iteye.com/blogs/tag/mysql" target="_blank">mysql</a><a href="http://www.iteye.com/blogs/tag/%E6%95%B0%E6%8D%AE%E5%BA%93" target="_blank">数据库</a><a href="http://www.iteye.com/blogs/tag/%E5%A4%87%E4%BB%BD" target="_blank">备份</a><a href="http://www.iteye.com/blogs/tag/java" target="_blank">java</a> </p>
<pre><code> Last modified：2013-05-02 16:55:01

/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*

 在实际应用中，定时备份数据库是一件非常重要的工作，下面是关于利用java程序实现数据库自动调用的方法，其实也不一定非要用java语言了，只要原理会了，大家大可使用其他语言来实现。话不多说，下面就来演示一下如何**自动备份mysql下的abc数据库**：
</code></pre></li>
</ul>
<p>1，在java API中为我们提供了一个Runtime类，它可以用来调用一些程序，比如notepad.exe,cmd.exe...</p>
<p>具体怎么回事，想了解的同学去看API吧，下面是实现代码：Backup.java</p>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>import java.util.Calendar;  </li>
<li>import java.util.Date;  </li>
<li>import java.text.SimpleDateFormat;  </li>
<li>import java.io.IOException;  </li>
<li>import java.io.PrintStream;  </li>
<li></li>
<li>public class Backup   </li>
<li>{  </li>
<li>public static void main(String[] args)   </li>
<li>{  </li>
<li>Runtime runtime = Runtime.getRuntime();  </li>
<li>Calendar calendar = Calendar.getInstance();  </li>
<li>SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyyMMdd_HHmmss&quot;);  </li>
<li>String currentTime = dateFormat.format(calendar.getTime());  </li>
<li>Process p = null;  </li>
<li>PrintStream print = null;  </li>
<li>StringBuilder buf = new StringBuilder();  </li>
<li>for(String a : args){  </li>
<li>buf.append(a);  </li>
<li>buf.append(&quot; &quot;);  </li>
<li>}  </li>
<li>String databases = buf.toString();  </li>
<li>System.out.println(databases);  </li>
<li>try{  </li>
<li>p = runtime.exec(&quot;cmd /c mysqldump -uroot -p1234 -B &quot;+databases+&quot;&gt;&quot;+currentTime+&quot;.sql.bak&quot;);  </li>
<li>}catch (IOException e){  </li>
<li>if( p != null ){  </li>
<li>p.destroy();  </li>
<li>}  </li>
<li>try{  </li>
<li>print = new PrintStream(currentTime+&quot;_backup_err.log&quot;);  </li>
<li>dateFormat.applyPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;);  </li>
<li>currentTime = dateFormat.format(calendar.getTime());  </li>
<li>print.println(currentTime+&quot;  backup failed.&quot;);  </li>
<li>e.printStackTrace(print);  </li>
<li>print.flush();  </li>
<li>}catch (IOException e2){  </li>
<li></li>
<li>}finally{  </li>
<li>if(print!=null){  </li>
<li>print.close();  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li>}<br>import java.util.Calendar; import java.util.Date; import java.text.SimpleDateFormat; import java.io.IOException; import java.io.PrintStream; public class Backup { public static void main(String[] args) { Runtime runtime = Runtime.getRuntime(); Calendar calendar = Calendar.getInstance(); SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyyMMdd_HHmmss&quot;); String currentTime = dateFormat.format(calendar.getTime()); Process p = null; PrintStream print = null; StringBuilder buf = new StringBuilder(); for(String a : args){ buf.append(a); buf.append(&quot; &quot;); } String databases = buf.toString(); System.out.println(databases); try{ p = runtime.exec(&quot;cmd /c mysqldump -uroot -p1234 -B &quot;+databases+&quot;&gt;&quot;+currentTime+&quot;.sql.bak&quot;); }catch (IOException e){ if( p != null ){ p.destroy(); } try{ print = new PrintStream(currentTime+&quot;_backup_err.log&quot;); dateFormat.applyPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;); currentTime = dateFormat.format(calendar.getTime()); print.println(currentTime+&quot; backup failed.&quot;); e.printStackTrace(print); print.flush(); }catch (IOException e2){ }finally{ if(print!=null){ print.close(); } } } } }</li>
</ol>
<p>2，将以上java程序编译后得到Backup.class文件；</p>
<p> 3，创建批处理文件mytask.bat: 
Bat代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>@echo off  </li>
<li>cd c:\backup_wj  </li>
<li>rem 这里提倡使用绝度路径，并且如果绝度路径中有空格，记得用  </li>
<li>rem 引号将路径括起来！  </li>
<li>rem 可以将abc替换为其他数据库，多多个数据库，并用空格隔开  </li>
<li>&quot;D:\Program Files\Java\jdk1.6.0_31\bin\java.exe&quot; Backup abc<br>@echo off cd c:\backup_wj rem 这里提倡使用绝度路径，并且如果绝度路径中有空格，记得用 rem 引号将路径括起来！ rem 可以将abc替换为其他数据库，多多个数据库，并用空格隔开 &quot;D:\Program Files\Java\jdk1.6.0_31\bin\java.exe&quot; Backup abc</li>
</ol>
<p> 3.1：根据评论我又发现了一个新的方法，不需要使用java，直接写一个批处理文件就可以实现自动备份功能，读者可以直接使用下面的批处理文件代替原来的批处理文件，不需要在使用java了，然后按照下面的步骤制订计划任务就可以了，代码如下：
Bat代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>mysqldump -uroot -p1234 -B abc &gt; %date:~0,4%%date:~5,2%%date:~8,2%<em>%time:~0,2%%time:~3,2%%time:~6,2%.sql.bak<br>mysqldump -uroot -p1234 -B abc &gt; %date:~0,4%%date:~5,2%%date:~8,2%</em>%time:~0,2%%time:~3,2%%time:~6,2%.sql.bak</li>
</ol>
<p>4，将Backup.class、mytask.bat放到同一个目录下，比如我就放在了c:\backup_wj目录下</p>
<p>5，在win7下配置任务计划，下面照着步骤一步一步走就行了：</p>
<p>5.1：在控制面板下找到“管理工具”——》“任务计划程序”</p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt=""></p>
<p><img src="" alt=""></p>
<p>5.2：选择“任务计划程序库”——》“创建基本任务”</p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt=""></p>
<p>5.3：填写任务名称和描述</p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt=""></p>
<p>5.4：下面根据向导的描述操作就可以了；</p>
<p><img src="" alt=""></p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt=""></p>
<p><img src="" alt=""></p>
<p>5.5：点击“浏览”选择批处理文件“mytask.bat”；</p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt=""></p>
<p><img src="" alt=""></p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt=""></p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt=""></p>
<p>5.6：点击“完成”后，选中autoBackup，点击“运行”测试一下：</p>
<p><img src="" alt=""></p>
<p>是不是有一个黑窗口一闪而过，好的那么打开你存放backup.bat的目录看一看，是不是生成了一个备份文件呢？</p>
<p>下面是我的，不过我们的备份文件已经生成了4次，从文件名就可以看出生成的时间。</p>
<p><img src="" alt=""></p>
<p>那么其中的原理大家都会了吧，其实就是让我们的操作系统定时去执行一个批处理文件“Backup.bat”,而这个批处理文件会去执行一个.class文件，这是一个java可执行文件，它会调用runtime.exec()方法，在命令行下执行一段命令，这段命令就是备份数据库的命令。</p>
<p>注意：对于备份的时间，我们可以设置得更加精细，通过“编辑触发器”中的“重复任务间隔”我们可以精确到每5分钟重复执行一次。具体怎么设置大家可以根据实际情况来设置。</p>
<p><img src="&quot;点击查看原始大小图片&quot;" alt=""></p>
<ul>
<li><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></li>
<li><p>大小: 65.5 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 53.9 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 79.5 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 39 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 34.2 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 30.9 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 31.8 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 34.1 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 52.6 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 36.3 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 48.2 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 64.3 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 44.2 KB</p>
</li>
<li><p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 83.7 KB</p>
</li>
<li><p><a href="http://wangjie2013.iteye.com/blog/1858541#" target="_blank">查看图片附件</a></p>
</li>
</ul>
<p><strong>7</strong>
顶</p>
<p><strong>5</strong>
踩</p>
<p>分享到： <a href="&quot;分享到新浪微博&quot;"><img src="" alt=""></a> <a href="&quot;分享到腾讯微博&quot;"><img src="" alt=""></a>
<a href="http://wangjie2013.iteye.com/blog/1856897" title="关于工资的三个秘密" target="_blank">关于工资的三个秘密</a></p>
<ul>
<li>23 小时前</li>
<li>浏览 1571</li>
<li><a href="http://wangjie2013.iteye.com/blog/1858541#comments" target="_blank">评论(7)</a></li>
<li>分类:<a href="http://www.iteye.com/blogs/category/database" target="_blank">数据库</a></li>
<li><a href="http://www.iteye.com/wiki/blog/1858541" target="_blank">相关推荐</a><h3 id="-">评论</h3>
</li>
</ul>
<p><a href=""></a></p>
<p>7 楼 <a href="http://docs.iteye.com/" title="kjj" target="_blank">kjj</a> 4 小时前  </p>
<p>如果是java，我以为你要一条条读取，原来回头来调用mysqldump ，直接at搞定算了！
6 楼 <a href="http://wangjie2013.iteye.com/" title="wangjie2013" target="_blank">wangjie2013</a> 16 小时前  </p>
<p>freezingsky 写道</p>
<p>mysql自身就可以实现了，实在没必要用其他的任何语言来附加，有种多余的感觉 。
mysql提供指令自动备份了吗？怎么做呀？？</p>
<p>5 楼 <a href="http://freezingsky.iteye.com/" title="freezingsky" target="_blank">freezingsky</a> 16 小时前  </p>
<p>mysql自身就可以实现了，实在没必要用其他的任何语言来附加，有种多余的感觉 。
4 楼 <a href="http://wangjie2013.iteye.com/" title="wangjie2013" target="_blank">wangjie2013</a> 19 小时前  </p>
<p>RamosLi 写道</p>
<p>一行命令就能搞定： at xx:xx /every:date mysqldump xxx
命令格式自己查吧 at/?
那么如果要实现每天多次备份是不是执行多次at命令，更改为不同的时间就可以了呀？
还有，，，，怎么停止呢？</p>
<p>3 楼 <a href="http://ramosli.iteye.com/" title="RamosLi" target="_blank">RamosLi</a> 19 小时前  </p>
<p>一行命令就能搞定： at xx:xx /every:date mysqldump xxx
命令格式自己查吧 at/?
2 楼 <a href="http://wangjie2013.iteye.com/" title="wangjie2013" target="_blank">wangjie2013</a> 20 小时前  </p>
<p>cgs1999 写道</p>
<p>使用java有点多余，其实可以新建一个批处理文件backup.bat，内容如下：
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>mysqldump -uroot -p1234 -B abc&gt;%date:~0,4%%date:~5,2%%date:~8,2%<em>%time:~0,2%%time:~3,2%%time:~6,2%.sql.bak<br>mysqldump -uroot -p1234 -B abc&gt;%date:~0,4%%date:~5,2%%date:~8,2%</em>%time:~0,2%%time:~3,2%%time:~6,2%.sql.bak
同样使用系统的“计划任务”实现定时备份
哈哈 你还真想的出来！哈哈 我本来也想过看看有系统有没有提供获取完整时间的方法，就查到date和time，不过没想到你拼出来了，哈哈。</li>
</ol>
<p>1 楼 <a href="http://cgs1999.iteye.com/" title="cgs1999" target="_blank">cgs1999</a> 22 小时前  </p>
<p>使用java有点多余，其实可以新建一个批处理文件backup.bat，内容如下：
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>mysqldump -uroot -p1234 -B abc&gt;%date:~0,4%%date:~5,2%%date:~8,2%<em>%time:~0,2%%time:~3,2%%time:~6,2%.sql.bak<br>mysqldump -uroot -p1234 -B abc&gt;%date:~0,4%%date:~5,2%%date:~8,2%</em>%time:~0,2%%time:~3,2%%time:~6,2%.sql.bak
同样使用系统的“计划任务”实现定时备份</li>
</ol>
<h3 id="-">发表评论</h3>
<p><a href="http://wangjie2013.iteye.com/login" target="_blank"><img src="" alt=""></a><a href="http://wangjie2013.iteye.com/login" target="_blank">您还没有登录,请您登录后再发表评论</a></p>
<p><a href="http://wangjie2013.iteye.com/" target="_blank"><img src="&quot;wangjie2013的博客: 苳眠的牧场&quot;" alt="wangjie2013的博客"></a></p>
<p>wangjie2013</p>
<ul>
<li>浏览: 5001 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li><img src="" alt=""><h3 id="-http-wangjie2013-iteye-com-blog-user_visits-">最近访客 <a href="http://wangjie2013.iteye.com/blog/user_visits" target="_blank">更多访客&gt;&gt;</a></h3>
</li>
</ul>
<p><a href="http://smallnetvisitor.iteye.com/" target="_blank"><img src="&quot;小网客的博客: 小网客&quot;" alt="小网客的博客"></a></p>
<p><a href="http://smallnetvisitor.iteye.com/" title="小网客" target="_blank">小网客</a></p>
<p><a href="http://goodwell.iteye.com/" target="_blank"><img src="&quot;GoodWell的博客: GoodWell&quot;" alt="GoodWell的博客"></a></p>
<p><a href="http://goodwell.iteye.com/" title="GoodWell" target="_blank">GoodWell</a>
<a href="http://haiwuyanlzh.iteye.com/" target="_blank"><img src="&quot;haiwuyanlzh的博客: haiwuyanlzh&quot;" alt="haiwuyanlzh的博客"></a></p>
<p><a href="http://haiwuyanlzh.iteye.com/" title="haiwuyanlzh" target="_blank">haiwuyanlzh</a></p>
<p><a href="http://hubert-bubert.iteye.com/" target="_blank"><img src="&quot;hubert_bubert的博客: &quot;" alt="hubert_bubert的博客"></a></p>
<p><a href="http://hubert-bubert.iteye.com/" title="hubert_bubert" target="_blank">hubert_bubert</a></p>
<h3 id="-">文章分类</h3>
<ul>
<li><a href="http://wangjie2013.iteye.com/" target="_blank">全部博客 (21)</a></li>
<li><a href="http://wangjie2013.iteye.com/category/252443" target="_blank">JAVA (14)</a></li>
<li><a href="http://wangjie2013.iteye.com/category/273482" target="_blank">C (1)</a></li>
<li><a href="http://wangjie2013.iteye.com/category/273484" target="_blank">数据结构和算法 (0)</a></li>
<li><a href="http://wangjie2013.iteye.com/category/275854" target="_blank">jQuery (0)</a></li>
<li><a href="http://wangjie2013.iteye.com/category/271730" target="_blank">系统 (1)</a></li>
<li><a href="http://wangjie2013.iteye.com/category/255333" target="_blank">读书 (3)</a></li>
<li><a href="http://wangjie2013.iteye.com/category/276592" target="_blank">转载 (1)</a></li>
<li><p><a href="http://wangjie2013.iteye.com/category/276804" target="_blank">mysql (1)</a></p>
<h3 id="-">社区版块</h3>
</li>
<li><p><a href="http://wangjie2013.iteye.com/blog/news" target="_blank">我的资讯</a> (0)</p>
</li>
<li><a href="http://wangjie2013.iteye.com/blog/post" target="_blank">我的论坛</a> (6)</li>
<li><a href="http://wangjie2013.iteye.com/blog/answered_problems" target="_blank">我的问答</a> (0)</li>
</ul>
<h3 id="-">存档分类</h3>
<ul>
<li><a href="http://wangjie2013.iteye.com/blog/monthblog/2013-05" target="_blank">2013-05</a> (1)</li>
<li><a href="http://wangjie2013.iteye.com/blog/monthblog/2013-04" target="_blank">2013-04</a> (18)</li>
<li><a href="http://wangjie2013.iteye.com/blog/monthblog/2013-03" target="_blank">2013-03</a> (1)</li>
<li><p><a href="http://wangjie2013.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://wangjie2013.iteye.com/blog/1842689" title="试读《征服C指针》" target="_blank">试读《征服C指针》</a></p>
</li>
<li><a href="http://wangjie2013.iteye.com/blog/1844815" title="单例设计模式" target="_blank">单例设计模式</a></li>
</ul>
<h3 id="-">最新评论</h3>
<ul>
<li><a href="http://wangjie2013.iteye.com/" title="wangjie2013" target="_blank">wangjie2013</a>： s1318601 写道讲下优点和适用范围及实际情况呗建议不错， ...
<a href="http://wangjie2013.iteye.com/blog/1844815#bc2307168" target="_blank">单例设计模式</a></li>
<li><a href="http://s1318601.iteye.com/" title="s1318601" target="_blank">s1318601</a>： 讲下优点和适用范围及实际情况呗
<a href="http://wangjie2013.iteye.com/blog/1844815#bc2307049" target="_blank">单例设计模式</a></li>
<li><a href="http://wangjie2013.iteye.com/" title="wangjie2013" target="_blank">wangjie2013</a>： yekui 写道买就不用了 ，直接去CSDN上去下就好了。地址 ...
<a href="http://wangjie2013.iteye.com/blog/1842689#bc2307034" target="_blank">试读《征服C指针》</a></li>
<li><a href="http://wangjie2013.iteye.com/" title="wangjie2013" target="_blank">wangjie2013</a>： yekui 写道只是只有存在你脑子里才是有价值的，并不是说买来 ...
<a href="http://wangjie2013.iteye.com/blog/1842689#bc2307033" target="_blank">试读《征服C指针》</a></li>
<li><a href="http://yekui.iteye.com/" title="yekui" target="_blank">yekui</a>： 只是只有存在你脑子里才是有价值的，并不是说买来的书，知识就能自 ...
<a href="http://wangjie2013.iteye.com/blog/1842689#bc2306899" target="_blank">试读《征服C指针》</a>
声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2012 ITeye.com. All rights reserved. [ 京ICP证110151号 京公网安备110105010620 ]
<img src="" alt=""></li>
</ul>
<p>This ad is supporting your extension Allow Right-Click: <a href="">More info</a> | <a href="">Privacy Policy</a> | <a href="http://wangjie2013.iteye.com/blog/1858541#" target="_blank">Hide on this page</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/mysql/">mysql</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/mysql/" class="label label-success">mysql</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:33"datetime="2014-03-07 09:54:33"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-mysql--使用java实现自动备份mysql数据库-苳眠的牧场-ITeye技术网站/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-mysql--使用java实现自动备份mysql数据库-苳眠的牧场-ITeye技术网站" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-mysql--为MySQL选择合适的备份方式/">为MySQL选择合适的备份方式</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:33.000Z"> <a href="/2014/02/02/2014-02-02-DB-mysql--为MySQL选择合适的备份方式/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-mysql-">为MySQL选择合适的备份方式</h1>
<p>[<img src="" alt=""></p>
<p>mysql 5.1同步到5.5卡库问题一则
](<a href="http://nettedfish.sinaapp.com/blog/2013/02/22/51-55-slave-sql-thread-error/" target="_blank">http://nettedfish.sinaapp.com/blog/2013/02/22/51-55-slave-sql-thread-error/</a> &quot;mysql 5.1同步到5.5卡库问题一则&quot;)[<img src="" alt=""></p>
<p>一键搭建blackhole从库
](<a href="http://nettedfish.sinaapp.com/blog/2012/10/19/auto-build-blackhole-slave" target="_blank">http://nettedfish.sinaapp.com/blog/2012/10/19/auto-build-blackhole-slave</a> &quot;一键搭建blackhole从库&quot;)[<img src="" alt=""></p>
<p>如何产生唯一的server id
](<a href="http://nettedfish.sinaapp.com/blog/2013/07/24/how-to-generate-unique-server_id/" target="_blank">http://nettedfish.sinaapp.com/blog/2013/07/24/how-to-generate-unique-server_id/</a> &quot;如何产生唯一的server id&quot;)[<img src="" alt=""></p>
<p>如何生成唯一的server id
](<a href="http://nettedfish.sinaapp.com//blog/2013/07/24/how-to-generate-unique-server_id/" target="_blank">http://nettedfish.sinaapp.com//blog/2013/07/24/how-to-generate-unique-server_id/</a> &quot;如何生成唯一的server id&quot;)</p>
<p><a href="http://www.ujian.cc/index2" title="友荐是什么？" target="_blank">友荐[?]</a></p>
<p><a href="&quot;返回顶部&quot;">返回顶部</a><a href="&quot;猜你喜欢&quot;">猜你喜欢</a>
[<img src="" alt=""></p>
<p>mysql 5.1同步到5.5卡库问题一则
](<a href="http://nettedfish.sinaapp.com/blog/2013/02/22/51-55-slave-sql-thread-error/" target="_blank">http://nettedfish.sinaapp.com/blog/2013/02/22/51-55-slave-sql-thread-error/</a> &quot;mysql 5.1同步到5.5卡库问题一则&quot;)[<img src="" alt=""></p>
<p>金泫雅清新素颜照
](<a href="http://www.cmsbs.com/pic/zp/4993.html" target="_blank">http://www.cmsbs.com/pic/zp/4993.html</a> &quot;金泫雅清新素颜照&quot;)[<img src="" alt=""></p>
<p>学生办理签证重要的标准
](<a href="http://www.cmsbs.com/eut/luixue/5105.html" target="_blank">http://www.cmsbs.com/eut/luixue/5105.html</a> &quot;学生办理签证重要的标准&quot;)[<img src="" alt=""></p>
<p>深田恭子艳丽沙滩迷情写真
](<a href="http://www.cmsbs.com/pic/hot/5228.html" target="_blank">http://www.cmsbs.com/pic/hot/5228.html</a> &quot;深田恭子艳丽沙滩迷情写真&quot;)[<img src="" alt=""></p>
<p>李颖芝穿金色比基尼与保时捷亲密接触
](<a href="http://www.cmsbs.com/pic/xg/5166.html" target="_blank">http://www.cmsbs.com/pic/xg/5166.html</a> &quot;李颖芝穿金色比基尼与保时捷亲密接触&quot;)</p>
<p><a href="http://www.ujian.cc/index2" title="友荐是什么？" target="_blank">友荐[?]</a></p>
<p><a href="&quot;返回顶部&quot;">返回顶部</a><a href="&quot;猜你喜欢&quot;">猜你喜欢</a></p>
<h1 id="-learn-and-share-http-nettedfish-sinaapp-com-"><a href="http://nettedfish.sinaapp.com/" target="_blank">Learn and Share</a></h1>
<h2 id="-">陌上发花，可以缓缓醉矣， 忍把浮名，换了浅酌低唱</h2>
<ul>
<li><p><a href="http://nettedfish.sinaapp.com/atom.xml" title="RSS订阅" target="_blank">RSS</a>
Navigate…» 首页» 文章归档» 资料分享» 去哪儿招聘» 关于我» RSS</p>
</li>
<li><p><a href="http://nettedfish.sinaapp.com/" target="_blank">首页</a></p>
</li>
<li><a href="http://nettedfish.sinaapp.com/blog/archives" target="_blank">文章归档</a></li>
<li><a href="http://nettedfish.sinaapp.com/my_share.html" target="_blank">资料分享</a></li>
<li><a href="http://nettedfish.sinaapp.com/enroll.html" target="_blank">去哪儿招聘</a></li>
<li><a href="http://nettedfish.sinaapp.com/about.html" target="_blank">关于我</a><h1 id="-mysql-">为MySQL选择合适的备份方式</h1>
</li>
</ul>
<p>2013年-05月-31日 16:01:00
数据库的备份是极其重要的事情。如果没有备份，遇到下列情况就会抓狂：</p>
<h3 id="update-or-delete-whitout-where-">UPDATE or DELETE whitout where…</h3>
<h3 id="table-was-dropped-accidentally-">table was DROPPed accidentally…</h3>
<h3 id="innodb-was-corrupt-">INNODB was corrupt…</h3>
<h3 id="entire-datacenter-loses-power-">entire datacenter loses power…</h3>
<p>从数据安全的角度来说，服务器磁盘都会做raid，MySQL本身也有主从、drbd等容灾机制，但它们都无法完全取代备份。容灾和高可用能帮我们有效的应对物理的、硬件的、机械的故障，而对我们犯下的逻辑错误却无能为力。每一种逻辑错误发生的概率都极低，但是当多种可能性叠加的时候，小概率事件就放大成很大的安全隐患，这时候备份的必要性就凸显了。那么在众多的MySQL备份方式中，哪一种才是适合我们的呢？</p>
<h2 id="-">常见的备份方式</h2>
<p>MySQL本身为我们提供了mysqldump、mysqlbinlog远程备份工具，percona也为我们提供了强大的Xtrabackup，加上开源的mydumper，还有基于主从同步的延迟备份、从库冷备等方式，以及基于文件系统快照的备份，其实选择已经多到眼花缭乱。而备份本身是为了恢复，所以能够让我们在出现故障后迅速、准确恢复的备份方式，就是最适合我们的，当然，同时能够省钱、省事，那就非常完美。下面就我理解的几种备份工具进行一些比较，探讨下它们各自的适用场景。</p>
<h3 id="1-mysqldump-mydumper">1. mysqldump &amp; mydumper</h3>
<p>mysqldump是最简单的逻辑备份方式。在备份myisam表的时候，如果要得到一致的数据，就需要锁表，简单而粗暴。而在备份innodb表的时候，加上–master-data=1 –single-transaction 选项，在事务开始时刻，记录下binlog pos点，然后利用mvcc来获取一致的数据，由于是一个长事务，在写入和更新量很大的数据库上，将产生非常多的undo，显著影响性能，所以要慎用。 <img src="" alt=""></p>
<ul>
<li>优点：简单，可针对单表备份，在全量导出表结构的时候尤其有用。</li>
<li>缺点：简单粗暴，单线程，备份慢而且恢复慢，跨IDC有可能遇到时区问题。
mydumper是mysqldump的加强版。相比mysqldump：</li>
<li>内置支持压缩，可以节省2-4倍的存储空间。</li>
<li>支持并行备份和恢复，因此速度比mysqldump快很多，但是由于是逻辑备份，仍不是很快。</li>
</ul>
<h3 id="2-">2. 基于文件系统的快照</h3>
<p>基于文件系统的快照，是物理备份的一种。在备份前需要进行一些复杂的设置，在备份开始时刻获得快照并记录下binlog pos点，然后采用类似copy-on-write的方式，把快照进行转储。转储快照本身会消耗一定的IO资源，而且在写入压力较大的实例上，保存被更改数据块的前印象也会消耗IO，最终表现为整体性能的下降。而且服务器还要为copy-on-write快照预留较多的磁盘空间，这本身对资源也是一种浪费。因此这种备份方式我们使用的不多。 <img src="" alt=""></p>
<h3 id="3-xtrabackup">3. Xtrabackup</h3>
<p>这或许是最为广泛的备份方式。percona之所以家喻户晓，Xtrabackup应该功不可没。它实际上是物理备份+逻辑备份的组合。在备份innodb表的时候，它拷贝ibd文件，并一刻不停的监视redo log的变化，append到自己的事务日志文件。在拷贝ibd文件过程中，ibd文件本身可能被写”花”，这都不是问题，因为在拷贝完成后的第一个prepare阶段，Xtrabackup采用类似于innodb崩溃恢复的方法，把数据文件恢复到与日志文件一致的状态，并把未提交的事务回滚。如果同时需要备份myisam表以及innodb表结构等文件，那么就需要用flush tables with lock来获得全局锁，开始拷贝这些不再变化的文件，同时获得binlog位置，拷贝结束后释放锁，也停止对redo log的监视。
它的工作原理如下：
<img src="" alt="">
由于mysql中不可避免的含有myisam表，同时innobackup并不备份表结构等文件，因此想要完整的备份mysql实例，就少不了要执行flush tables with read lock，而这个语句会被任何查询(包括select)阻塞，在阻塞过程中，它又反过来阻塞任何查询(包括select)。如果碰巧备份实例上有长查询先于flush tables with read lock执行，数据库就会hang住。而当flush tables with read lock获得全局锁后，虽然查询可以执行，但是仍会阻塞更新，所以，我们希望flush tables with read lock从发起到结束，持续的时间越短越好。
为了解决这个问题，有两种比较有效的方法：</p>
<h3 id="1-myisam-">1. 尽量不用myisam表。</h3>
<h3 id="2-xtrabackup-rsync-rsync-">2. Xtrabackup增加了–rsync选项，通过两次rsync来减少持有全局锁的时间。</h3>
<p>优化后的备份过程如下：
<img src="" alt=""></p>
<ul>
<li>优点：在线热备，全备+增备+流备，支持限速，支持压缩，支持加密。</li>
<li>缺点：需要获取全局锁，如果遇到长查询，等待时间将不可控，因此要做好监控，必要时杀死长查询或自杀；遇到超大的实例，备份过程较长，redo log太大会影响恢复速度，这种情况下最好采用延迟备份。</li>
</ul>
<h3 id="4-mysqlbinlog-5-6">4. mysqlbinlog 5.6</h3>
<p>上述所有的备份方式，都只能把数据库恢复到备份的某个时间点：mysqldump和mydumper，以及snapshot是备份开始的时间点；Xtrabackup是备份结束的时间点。要想实现point in time的恢复，还必须备份binlog。同时binlog也是实现增备的宝贵资源。
幸运的是，mysql 5.6为我们提供了远程备份binlog的选项：</p>
<p>mysqlbinlog --raw --read-from-remote-server --stop-never
它会伪装成mysql从库，从远程获取binlog然后进行转储。这对线上主库容量不够无法保存较多binlog的场景非常有用。但是，它毕竟不像真正的mysql从库实例，状态监控和同步都需要单独部署。因此个人觉得采用blackhole来备份全量的binlog是更好的选择。笔者曾经实现过一个<a href="https://github.com/nettedfish/create_blackhole_slave" target="_blank">自动搭建blackhole从库的工具</a>，稍加修改，就可以完美搭建出blackhole从库。一旦同步起来，基本一劳永逸，很少出问题，主从切换的时候跟着切了就行。</p>
<h3 id="-">提示：</h3>
<ul>
<li>不要小看binlog的备份。当5.6的多线程复制大规模使用后，从库追赶主库命令点的耗时将被极大缩短，这样我们把每天一次的全量备份改为每3天一次、甚至每周一次的全量备份，和持续的binlog增量备份。遇到故障需要恢复数据的时候，重放3、5天的binlog也是极快的。降低备份频率最直接的好处是，省钱、省事。</li>
<li>blackhole对于备份binlog是极好的。一方面可以长久的备份binlog用于恢复数据库，另一方面，在其上配置半同步复制，可以有效防止主库的binlog丢失。</li>
</ul>
<h2 id="-">总结</h2>
<p>备份方式各有千秋，而对我们来说，面对数千实例，选择合适的备份工具来实现统一配置、统一规划，构建智能调度的备份云平台才是王道。毕竟，多种备份方式共存的运维成本是不容忽视的。
从使用经验来看，用Xtrabackup全备数据，用blackhole增备binlog，并定期对备份数据的有效性进行验证，是当下比较好的选择。</p>
<p>Posted by nettedfish 2013年-05月-31日 16:01:00  <a href="http://nettedfish.sinaapp.com/blog/categories/mysql/" target="_blank">mysql</a></p>
<p><a href="http://nettedfish.sinaapp.com/blog/2013/02/22/51-55-slave-sql-thread-error/" title="Previous Post: mysql 5.1同步到5.5卡库问题一则" target="_blank">« mysql 5.1同步到5.5卡库问题一则</a> <a href="http://nettedfish.sinaapp.com/blog/2013/06/04/check-replication-consistency-by-pt-table-checksum/" title="Next Post: 用pt-table-checksum校验数据一致性" target="_blank">用pt-table-checksum校验数据一致性 »</a>
<a href="http://www.ujian.cc/" target="_blank"><img src="" alt="友荐云推荐"></a></p>
<p><a href=""><img src="" alt=""></a><a href=""><img src="" alt=""></a></p>
<p>共有1人喜欢  共3条评论
<a href="">登录</a><a href="">社区</a></p>
<p><a href=""></a></p>
<p>头衔:<a href="">确定</a><a href="">取消</a></p>
<p><a href="">编辑头衔</a>
邮箱:<a href="">确定</a><a href="">取消</a></p>
<p><a href="">跟踪回复</a></p>
<p>0条评论</p>
<p>0次被喜欢
发表评论</p>
<p><a href=""></a><a href=""></a><a href=""></a><a href=""></a><a href=""></a>
<a href=""></a><a href=""></a><a href=""></a><a href=""></a><a href=""></a></p>
<p><img src="" alt=""></p>
<p>请输入你的评论
        表情</p>
<ul>
<li>默认表情</li>
<li>阿狸</li>
</ul>
<p>140
<a href="">发  布</a></p>
<p><img src="" alt=""></p>
<p><img src="" alt="">
<img src="" alt="">
<a href="">按时间排序</a></p>
<p>排序方式:<a href="">按时间排序</a><a href="">按热度排序</a>
<a href="http://s.uyan.cc/?u=http%3A%2F%2Fweibo.com%2F1774036133" target="_blank"><img src="" alt=""></a>  <a href="http://s.uyan.cc/?u=http%3A%2F%2Fweibo.com%2F1774036133" title="新浪微博"></a></p>
<p><a href="http://s.uyan.cc/?u=http%3A%2F%2Fweibo.com%2F1774036133" target="_blank">jianfengye110</a> (<a href="http://s.uyan.cc/?u=http%3A%2F%2Fweibo.com%2F1774036133" target="_blank">新浪微博</a>)</p>
<p>推荐～～<img src="" alt="">
<a href="">回复</a><a href=""></a> <a href="">踩</a> <a href=""></a> <a href="">顶</a> <a href=""></a></p>
<p>22小时前</p>
<p><a href="http://s.uyan.cc/?u=http%3A%2F%2Fweibo.com%2F1642647770" target="_blank"><img src="" alt=""></a>  <a href="http://s.uyan.cc/?u=http%3A%2F%2Fweibo.com%2F1642647770" title="新浪微博"></a></p>
<p><a href="http://s.uyan.cc/?u=http%3A%2F%2Fweibo.com%2F1642647770" target="_blank">sin30_net</a> (<a href="http://s.uyan.cc/?u=http%3A%2F%2Fweibo.com%2F1642647770" target="_blank">新浪微博</a>)</p>
<p>微博转发：转发微博
<a href="">回复</a><a href=""></a> <a href="">踩</a> <a href=""></a> <a href="">顶</a> <a href=""></a></p>
<p>22小时前
<a href="http://s.uyan.cc/?u=http%3A%2F%2Fweibo.com%2F2000702247" target="_blank"><img src="" alt=""></a>  <a href="http://s.uyan.cc/?u=http%3A%2F%2Fweibo.com%2F2000702247" title="新浪微博"></a></p>
<p><a href="http://s.uyan.cc/?u=http%3A%2F%2Fweibo.com%2F2000702247" target="_blank">vvsherry</a> (<a href="http://s.uyan.cc/?u=http%3A%2F%2Fweibo.com%2F2000702247" target="_blank">新浪微博</a>)</p>
<p><img src="" alt="">
<a href="">回复</a><a href=""></a> <a href="">踩</a> <a href=""></a> <a href="">顶1</a> <a href=""></a></p>
<p>6月1日 00:44</p>
<p>更多热评文章</p>
<p>[* <img src="" alt=""></p>
<p>mysql 5.1同步到5.5卡库问题一则](<a href="http://nettedfish.sinaapp.com/blog/2013/02/22/51-55-slave-sql-thread-error/" target="_blank">http://nettedfish.sinaapp.com/blog/2013/02/22/51-55-slave-sql-thread-error/</a> &quot;mysql 5.1同步到5.5卡库问题一则&quot;)</p>
<p>[* <img src="" alt=""></p>
<p>一键搭建blackhole从库](<a href="http://nettedfish.sinaapp.com/blog/2012/10/19/auto-build-blackhole-slave" target="_blank">http://nettedfish.sinaapp.com/blog/2012/10/19/auto-build-blackhole-slave</a> &quot;一键搭建blackhole从库&quot;)
[* <img src="" alt=""></p>
<p>如何产生唯一的server id](<a href="http://nettedfish.sinaapp.com/blog/2013/07/24/how-to-generate-unique-server_id/" target="_blank">http://nettedfish.sinaapp.com/blog/2013/07/24/how-to-generate-unique-server_id/</a> &quot;如何产生唯一的server id&quot;)</p>
<p>[* <img src="" alt=""></p>
<p>如何生成唯一的server id](<a href="http://nettedfish.sinaapp.com//blog/2013/07/24/how-to-generate-unique-server_id/" target="_blank">http://nettedfish.sinaapp.com//blog/2013/07/24/how-to-generate-unique-server_id/</a> &quot;如何生成唯一的server id&quot;)
<a href="http://www.uyan.cc/" title="社会化评论是什么？" target="_blank">友言[?]</a></p>
<p><img src="" alt=""></p>
<p>请输入你的评论
        表情</p>
<ul>
<li>默认表情</li>
<li>阿狸
140</li>
</ul>
<p><a href="">回  复</a>
<img src="" alt=""></p>
<p><img src="" alt="">
<img src="" alt="">
nettedfish.sinaapp.com</p>
<p>43
评论数</p>
<p>8
喜欢数
21
用户数
数据正在加载中...</p>
<p><a href="http://www.uyan.cc/" target="_blank">友言</a></p>
<p>社会化帐号登录</p>
<h2 id="-">点击按钮，使用社交帐号评论</h2>
<p><a href="&quot;用新浪微博账号登陆&quot;"><img src="&quot;用新浪微博账号登陆&quot;" alt="">  新浪微博</a><a href="&quot;用腾讯微博账号登陆&quot;"><img src="&quot;用腾讯微博账号登陆&quot;" alt="">  腾讯微博</a><a href="&quot;用人人网账号登陆&quot;"><img src="&quot;用人人网账号登陆&quot;" alt="">  人人网</a><a href="&quot;用网易微博账号登陆&quot;"><img src="&quot;用网易微博账号登陆&quot;" alt="">  网易微博</a><a href="&quot;用搜狐微博账号登陆&quot;"><img src="&quot;用搜狐微博账号登陆&quot;" alt="">  搜狐微博</a><a href="&quot;用开心网账号登陆&quot;"><img src="&quot;用开心网账号登陆&quot;" alt="">  开心网</a></p>
<h2 id="-">作为游客留言</h2>
<p>Email /*</p>
<p>昵  称
顶并分享到:</p>
<p>新浪微博
新浪微博</p>
<p>新浪微博
<a href="">顶</a><a href="">取消</a></p>
<h2 id="-qunar-mysql-dba-http-nettedfish-sinaapp-com-enroll-html-"><a href="http://nettedfish.sinaapp.com/enroll.html" target="_blank">qunar诚招MySQL DBA</a></h2>
<h1 id="-">最新发表</h1>
<ul>
<li><a href="http://nettedfish.sinaapp.com/blog/2013/08/05/deep-into-git-with-diagrams/" target="_blank">图解GIT</a></li>
<li><a href="http://nettedfish.sinaapp.com/blog/2013/07/24/how-to-generate-unique-server_id/" target="_blank">如何生成唯一的server id</a></li>
<li><a href="http://nettedfish.sinaapp.com/blog/2013/06/05/synchronizes-data-efficiently-by-pt-table-sync/" target="_blank">用pt-table-sync修复不一致的数据</a></li>
<li><a href="http://nettedfish.sinaapp.com/blog/2013/06/04/check-replication-consistency-by-pt-table-checksum/" target="_blank">用pt-table-checksum校验数据一致性</a></li>
<li><a href="">为MySQL选择合适的备份方式</a></li>
<li><a href="http://nettedfish.sinaapp.com/blog/2013/02/22/51-55-slave-sql-thread-error/" target="_blank">mysql 5.1同步到5.5卡库问题一则</a></li>
<li><a href="http://nettedfish.sinaapp.com/blog/2013/01/30/python-encode-decode/" target="_blank">python 字符串编解码研究</a></li>
<li><a href="http://nettedfish.sinaapp.com/blog/2013/01/07/disk-throughtput/" target="_blank">test disk throughtput with dd</a></li>
</ul>
<h1 id="-">分类目录</h1>
<ul>
<li><a href="http://nettedfish.sinaapp.com/blog/categories/linux" target="_blank">linux (1)</a></li>
<li><a href="http://nettedfish.sinaapp.com/blog/categories/mysql" target="_blank">mysql (7)</a></li>
<li><a href="http://nettedfish.sinaapp.com/blog/categories/python" target="_blank">python (1)</a></li>
<li><a href="http://nettedfish.sinaapp.com/blog/categories/tools" target="_blank">tools (3)</a></li>
<li><a href="http://nettedfish.sinaapp.com/blog/categories/生活札记" target="_blank">生活札记 (1)</a></li>
</ul>
<h1 id="github-repos">GitHub Repos</h1>
<ul>
<li><a href="https://github.com/nettedfish/dzpk" target="_blank">dzpk</a></li>
</ul>
<p>德州扑克筹码计算工具</p>
<ul>
<li><a href="https://github.com/nettedfish/gnuplot" target="_blank">gnuplot</a></li>
</ul>
<p>gnuplot作图的一些例子</p>
<ul>
<li><a href="https://github.com/nettedfish/create_blackhole_slave" target="_blank">create_blackhole_slave</a></li>
</ul>
<p>一键搭建blackhole从库</p>
<ul>
<li><a href="https://github.com/nettedfish/psutil" target="_blank">psutil</a></li>
</ul>
<p>psutil</p>
<ul>
<li><a href="https://github.com/nettedfish/codernitydb" target="_blank">codernitydb</a></li>
</ul>
<p>开源的纯python写的nosql数据库,学习
<a href="https://github.com/nettedfish" target="_blank">@nettedfish</a> on GitHub</p>
<h1 id="-">友情链接</h1>
<ul>
<li><a href="http://www.orczhou.com/" target="_blank">淘宝周振兴</a></li>
<li><a href="http://papaisadba.puyu.me/" target="_blank">去哪儿周彦伟</a></li>
<li><a href="https://blogs.oracle.com/MySQL/" target="_blank">oracle innodb 官方</a></li>
<li><a href="http://www.cnblogs.com/shenguanpu/" target="_blank">坚毅的刀刀</a></li>
<li><a href="http://blog.csdn.net/liuben" target="_blank">存储专栏</a></li>
<li><a href="http://huoding.com/" target="_blank">火丁笔记</a></li>
<li><a href="http://blog.yufeng.info/" target="_blank">淘宝褚霸</a></li>
<li><a href="http://dinglin.iteye.com/" target="_blank">淘宝丁奇</a></li>
<li><a href="http://www.mysqlops.com/" target="_blank">mysql ops</a></li>
<li><a href="http://www.penglixun.com/" target="_blank">plinux</a></li>
<li><a href="http://www.hellodb.net/" target="_blank">hellodba</a></li>
<li><a href="http://timyang.net/" target="_blank">timyang</a></li>
<li><a href="http://www.ningoo.net/" target="_blank">ningoo</a></li>
<li><a href="http://www.mysqlperformanceblog.com/" target="_blank">performanceblog</a></li>
<li><a href="http://www.xaprb.com/blog/" target="_blank">Xaprb</a></li>
<li><a href="http://hedengcheng.com/" target="_blank">登博</a></li>
<li><a href="http://dom.as/" target="_blank">Domas Mituzas</a></li>
<li><a href="http://hackmysql.com/" target="_blank">hack mysql</a></li>
<li><a href="http://www.dbsnake.com/" target="_blank">dbsnake</a></li>
<li><a href="http://blog.cydu.net/" target="_blank">dcy</a></li>
<li><a href="http://code.openark.org/blog/" target="_blank">Shlomi Noach</a></li>
<li><a href="http://www.yankay.com/" target="_blank">yankay</a></li>
<li><a href="http://www.mysqlsupport.cn/" target="_blank">吴炳锡</a></li>
<li><a href="http://coolshell.cn/" target="_blank">左耳朵耗子</a></li>
<li><a href="http://www.realzyy.com/" target="_blank">张云杨</a></li>
<li><a href="http://www.iamcjd.com/" target="_blank">最醉红楼</a></li>
<li><a href="http://dbahacker.com/" target="_blank">杨德华</a></li>
<li><a href="http://huoding.com/" target="_blank">火丁笔记</a></li>
<li><a href="http://isky000.com/" target="_blank">简朝阳</a></li>
<li><a href="http://www.mysqlab.net/" target="_blank">谭俊青</a></li>
<li><a href="http://blog.csdn.net/lanphaday" target="_blank">赖永浩</a></li>
<li><a href="http://www.alidba.net/" target="_blank">阿里巴巴DBA</a></li>
</ul>
<p>Copyright © 2013 - nettedfish - Powered by <a href="http://octopress.org/" target="_blank">Octopress</a>   <a href="http://tongji.baidu.com/hm-web/welcome/ico?s=e0f5d44e4da361e95c65c951fc44fec6" target="_blank"><img src="" alt=""></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/mysql/">mysql</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/mysql/" class="label label-success">mysql</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:34"datetime="2014-03-07 09:54:34"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-mysql--为MySQL选择合适的备份方式/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-mysql--为MySQL选择合适的备份方式" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-mysql--一个备份MySQL数据库的简单Shell脚本/">一个备份MySQL数据库的简单Shell脚本</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:33.000Z"> <a href="/2014/02/02/2014-02-02-DB-mysql--一个备份MySQL数据库的简单Shell脚本/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-mysql-shell-">一个备份MySQL数据库的简单Shell脚本</h1>
<p>本文翻译自 <a href="http://isystemadmin.com/" target="_blank">iSystemAdmin</a> 的 《<a href="http://isystemadmin.com/a-simple-shell-script-to-backup-mysql-database" target="_blank">A Simple Shell Script to Backup MySQL Database</a>》</p>
<p>Shell脚本是我们写不同类型命令的一种脚本，这些命令在这一个文件中就可以执行。我们也可以逐一敲入命令手动执行。如果我们要使用shell脚本就必须在一开始把这些命令写到一个文本文件中，以后就可以随意反复运行这些命令了。</p>
<p>我首先要在本文带给你的是完整脚本。后面会对该脚本做说明。我假定你已经知道<strong>shell scripting、</strong> <strong>mysqldump和**</strong>crontab。**</p>
<p>适用操作系统：任何Linux或UNIX。</p>
<p><a href="http://cdn2.jobbole.com/2012/04/a-simple-shell-script-to-backup-mysql-database.jpg" title="a-simple-shell-script-to-backup-mysql-database" target="_blank"><img src="&quot;a-simple-shell-script-to-backup-mysql-database&quot;" alt="a-simple-shell-script-to-backup-mysql-database"></a></p>
<p><strong>主脚本（用于备份mysql数据库）：</strong></p>
<p>该Shell脚本可以自动备份数据库。只要复制粘贴本脚本到文本编辑器中，输入数据库用户名、密码以及数据库名即可。我备份数据库使用的是<strong>mysqlump</strong> 命令。后面会对每行脚本命令进行说明。</p>
<p><strong>1. 分别建立目录“backup”和“oldbackup”</strong>
1</p>
<p>2
 /#mkdir /backup</p>
<p>/#mkdir /oldbackup</p>
<p><strong>2. 现在使用你喜欢的编辑软件创建并编辑“backup.sh”</strong></p>
<p>这里我用的是 vi
1 /# vi /backup/backup.sh</p>
<p>现在把以下几行命令输入到 backup.sh 文件中：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9 /#!bin/bash</p>
<p>cd</p>
<p>/backup
echo</p>
<p>“You are In Backup Directory”</p>
<p>mv</p>
<p>backup/*</p>
<p>/oldbackup
echo</p>
<p>“Old Databases are Moved to oldbackup folder”</p>
<p>Now=$(</p>
<p>date</p>
<p>+”%d-%m-%Y--%H:%M:%S”)
File=backup-$Now.sql</p>
<p>mysqldump –u user-name  –p ‘password’ database-name &gt; $File
echo</p>
<p>“Your Database Backup Successfully Completed”</p>
<p><strong>脚本说明：</strong></p>
<p>切记，在第8行命令中，在mysqldump命令后要输入自己的数据库用户名、密码及数据库名。</p>
<p>执行该脚本，首先会进入 <em>/backup</em> 目录，然后该脚本会把原有的旧数据库备份移动到 <em>/oldbackup</em> 文件夹中，接着根据系统的日期及时间生成一个文件名，在最后 <strong>mysqldump</strong> 命令会生成一个“.sql”格式的数据库备份文件。</p>
<p><strong>3. 设置 backup.sh 脚本文件的可执行许可</strong>
1 /# chmod +x /backup/backup.sh</p>
<p><strong>4. 执行脚本</strong></p>
<p>1 /#./backup.sh</p>
<p>脚本运行结束后会得到以下输入。</p>
<p>1</p>
<p>2
3</p>
<p>4
5 root@Server1:</p>
<p>/download</p>
<p>/#./backup.sh</p>
<p>You areinDownload Directory
Old Backup DatabaseisMoved to oldbackup folder</p>
<p>database backup successful completed
root@Server1:</p>
<p>/download</p>
<p>/#</p>
<p>注：首次执行该脚本会有一个“no such file”的提示信息，这是由于旧备份文件还不存在。只要再次执行该脚本就没有问题了，这个问题已经不存在了。</p>
<p><strong>5. 使用cron制订备份计划</strong></p>
<p>使用Cron可以定时执行该脚本，备份会自动完成。使用 <strong>crontab</strong> 命令编辑cron 执行的计划任务。
1 /#crontab –e</p>
<p>只要在编辑器上加入下面这一行代码保存即可。</p>
<p>1 013/<em> /</em> /<em> /</em></p>
<p>/backup/backup</p>
<p>.sh</p>
<p>本任务表示的是在每天下午1点钟把数据库备份到指定的文件夹。有关cron任务设置的详细内容可以查阅crontab手册。</p>
<p>对初学者而言，这是非常基础的脚本。希望你能举一反三写出更复杂的备份脚本。我们会努力提供更自动化的新脚本。请大家不吝赐教，我们会尽力解决你们的问题。感谢与我们相伴。
来源： <a href="[http://blog.jobbole.com/18005/](http://blog.jobbole.com/18005/)">[http://blog.jobbole.com/18005/](http://blog.jobbole.com/18005/)</a> </p>
<p>A Simple Shell Script to Backup MySQL DataBase</p>
<p>The Shell script is a script where we are writing different types of commands and executing those commands from a single file.  We can execute that command manually, by entering command one by one. But if we use shell script we have to write those commands into a text file for the first time and then we can run those commands as many times as required.</p>
<p>In this article first I will show you, Complete Script. Later on, you will get a description of that script.  I assumed that you know about <strong>shell scripting</strong>, <strong>mysqldump</strong> and <strong>crontab</strong>.</p>
<p>Operating System: Any Linux or UNIX.</p>
<p><strong>Main Script (for backup your <a href="http://resources.isystemadmin.com/mysql/" title="MySQL Introduction" target="_blank">MySQL</a> database):</strong></p>
<p>This shell script will make the backup process of a database automatic. Just copy and paste this script in a text editor, put database user name, password, and database name. I will use <strong>mysqlump</strong> command to backup the database. Later on you will get description of each line.
<strong>1. Make a directory name “backup” and “oldbackup”</strong></p>
<p>1</p>
<p>2
 /#mkdir /backup</p>
<p>/#mkdir /oldbackup
<strong>2. Now make file name “backup.sh” and edit with any editor you like</strong></p>
<p>I’m using vi here-</p>
<p>1 /# vi /backup/backup.sh</p>
<p>Now write these lines into backup.sh file:</p>
<p>/#!bin/bash</p>
<p>cd /backup
echo “You are In Backup Directory”</p>
<p>mv backup/* /oldbackup
echo “Old Databases are Moved to oldbackup folder”</p>
<p>Now=$(date +”%d-%m-%Y--%H:%M:%S”)
File=backup-$Now.sql</p>
<p>mysqldump –u user-name  –p ‘password’ database-name &gt; $File
echo “Your Database Backup Successfully Completed”</p>
<p><strong>Script Description:</strong></p>
<p>Remember, in line number 8: Put your Database username, Password, database name after mysqldump command.</p>
<p>When we run this script, first it goes to a <em>/backup</em> directory. Then it will move old database backup files to <em>/oldbackup</em> folder. Next it generates a file name from system date and time. And finally <strong>mysqldump</strong> command will generate a database backup file with “.sql” format
<strong>3. Set permission to backup.sh file executable</strong></p>
<p>1 /# chmod +x /backup/backup.sh
<strong>4. Running the Script</strong></p>
<p>1 /#./backup.sh</p>
<p>You will get following output after executing the script.
root@Server1:/download/#./backup.sh</p>
<p>You are in Download Directory
Old Backup Database is Moved to oldbackup folder</p>
<p>database backup successful completed
root@Server1:/download/#</p>
<p>NB: first time when you run this script you will get a message “no such file”, because you don’t have old backup file. No problem just runs again this script, problem will be solved.</p>
<p><strong>5. Schedule the Backup using cron</strong></p>
<p>Using Cron job you can execute this script in a certain time, and all works will be done automatically. Use <strong>crontab</strong> command to edit editing cron schedules.</p>
<p>/#crontab –e</p>
<p>Just add below line in the editor and save it.
0 13 /<em> /</em> /<em> /</em> /backup/backup.sh</p>
<p>In this way every day 1PM your database will back up in your desired folder. Please visit crontab manuals for more details about setting the cron jobs.</p>
<p>This is a very basic script for the beginners. Hope you can use the same idea for more complex backup. We will try to come up with new scripts to automate further. Please ask any question you have. We will try our best to address your questions. Thanks for staying with us.</p>
<p><strong>No Related Posts</strong></p>
<h2 id="-">#</h2>
<p>Sifat is a veteran System Administrator who still loves to make his hand dirty with text consoles. Sifat has 14 years of Operations and Management experience in IT and telecommunication industries.He has proven record of IT planning, Policy Development, IT Process Management, Cost Control and successful leadership for effective and efficient IT organization. He is effective in reducing Capital and Operation Expense by H/W &amp; Software consolidation and virtualization. Sifat is a certified ITIL and VMWare Professional.</p>
<p><a href="http://isystemadmin.com/author/sifat" target="_blank">View all posts by Sifat →</a></p>
<p>来源： <a href="[http://isystemadmin.com/a-simple-shell-script-to-backup-mysql-database](http://isystemadmin.com/a-simple-shell-script-to-backup-mysql-database)">[http://isystemadmin.com/a-simple-shell-script-to-backup-mysql-database](http://isystemadmin.com/a-simple-shell-script-to-backup-mysql-database)</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/mysql/">mysql</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/mysql/" class="label label-success">mysql</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:33"datetime="2014-03-07 09:54:33"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-mysql--一个备份MySQL数据库的简单Shell脚本/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-mysql--一个备份MySQL数据库的简单Shell脚本" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-mysql--mysql性能的检查和调优方法-sudonecom服务器系统架构分析日志/">mysql性能的检查和调优方法 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:33.000Z"> <a href="/2014/02/02/2014-02-02-DB-mysql--mysql性能的检查和调优方法-sudonecom服务器系统架构分析日志/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="mysql-sudone-com-">mysql性能的检查和调优方法 - sudone.com服务器系统架构分析日志</h1>
<h1 id="-sudone-com-http-www-sudone-com-"><a href="http://www.sudone.com/" target="_blank">sudone.com</a> 服务器系统架构分析日志</h1>
<h1 id="mysql-">mysql性能的检查和调优方法</h1>
<p>[2012-08-02 15:22:04]</p>
<p>我一直是使用mysql这个数据库软件，它工作比较稳定，效率也很高。在遇到严重性能问题时，一般都有这么几种可能：
1、索引没有建好；
2、sql写法过于复杂；
3、配置错误；
4、机器实在负荷不了；
1、索引没有建好
如果看到mysql消耗的cpu很大，可以用mysql的client工具来检查。
在linux下执行
/usr/local/mysql/bin/mysql -hlocalhost -uroot -p
输入密码，如果没有密码，则不用-p参数就可以进到客户端界面中。
看看当前的运行情况
show full processlist
可以多运行几次
这个命令可以看到当前正在执行的sql语句，它会告知执行的sql、数据库名、执行的状态、来自的客户端ip、所使用的帐号、运行时间等信息
在我的cache后端，这里面大部分时间是看不到显示任何sql语句的，我认为这样才算比较正常。如果看到有很多sql语句，那么这台mysql就一定会有性能问题
如果出现了性能问题，则可以进行分析：
1、是不是有sql语句卡住了？
这是出现比较多的情况，如果数据库是采用myisam，那么有可能有一个写入的线程会把数据表给锁定了，如果这条语句不结束，则其它语句也无法运行。
查看processlist里的time这一项，看看有没有执行时间很长的语句，要留意这些语句。
2、大量相同的sql语句正在执行
如果出现这种情况，则有可能是该sql语句执行的效率低下，同样要留意这些语句。
然后把你所怀疑的语句统统集合一下，用desc（explain）来检查这些语句。
首先看看一个正常的desc输出：
mysql&gt; desc select /<em> from imgs where imgid=1651768337;
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+
| id | select_type | table | type  | possible_keys | key     | key_len | ref   | rows | Extra |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+
|  1 | SIMPLE      | imgs  | const | PRIMARY       | PRIMARY | 8       | const |    1 |       |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+
1 row in set (0.00 sec)
注意key、rows和Extra这三项，这条语句返回的结果说明了该sql会使用PRIMARY主键索引来查询，结果集数量为1条，Extra没有显示，证明没有用到排序或其他操作。由此结果可以推断，mysql会从索引中查询imgid=1651768337这条记录，然后再到真实表中取出所有字段，是很简单的操作。
key是指明当前sql会使用的索引，mysql执行一条简单语句时只能使用到一条索引，注意这个限制；rows是返回的结果集大小，结果集就是使用该索引进行一次搜索的所有匹配结果；Extra一般会显示查询和排序的方式，。
如果没有使用到key，或者rows很大而用到了filesort排序，一般都会影响到效率，例如：
mysql&gt; desc select /</em> from imgs where userid=&quot;7mini&quot; order by clicks desc limit 10;
+----+-------------+-------+------+---------------+------+---------+------+-------+-----------------------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows  | Extra                       |
+----+-------------+-------+------+---------------+------+---------+------+-------+-----------------------------+
|  1 | SIMPLE      | imgs  | ALL  | NULL          | NULL | NULL    | NULL | 12506 | Using where; Using filesort |
+----+-------------+-------+------+---------------+------+---------+------+-------+-----------------------------+
1 row in set (0.00 sec)
这条sql结果集会有12506条，用到了filesort，所以执行起来会非常消耗效率的。这时mysql执行时会把整个表扫描一遍，一条一条去找到匹配userid=&quot;7mini&quot;的记录，然后还要对这些记录的clicks进行一次排序，效率可想而知。真实执行时如果发现还比较快的话，那是因为服务器内存还足够将12506条比较短小的记录全部读入内存，所以还比较快，但是并发多起来或者表大起来的话，效率问题就严重了。
这时我把userid加入索引：
create index userid on imgs (userid);
然后再检查：
mysql&gt; desc select /<em> from imgs where userid=&quot;7mini&quot; order by clicks desc limit 10;
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
| id | select_type | table | type | possible_keys | key    | key_len | ref   | rows | Extra                       |
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
|  1 | SIMPLE      | imgs  | ref  | userid        | userid | 51      | const |    8 | Using where; Using filesort |
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
1 row in set (0.00 sec)
嗯，这时可以看到mysql使用了userid这个索引搜索了，用userid索引一次搜索后，结果集有8条。然后虽然使用了filesort一条一条排序，但是因为结果集只有区区8条，效率问题得以缓解。
但是，如果我用别的userid查询，结果又会有所不同：
mysql&gt; desc select /</em> from imgs where userid=&quot;admin&quot; order by clicks desc limit 10;
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
| id | select_type | table | type | possible_keys | key    | key_len | ref   | rows | Extra                       |
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
|  1 | SIMPLE      | imgs  | ref  | userid        | userid | 51      | const | 2944 | Using where; Using filesort |
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
1 row in set (0.00 sec)
这个结果和userid=&quot;7mini&quot;的结果基本相同，但是mysql用userid索引一次搜索后结果集的大小达到2944条，这2944条记录都会加入内存进行filesort，效率比起7mini那次来说就差很多了。这时可以有两种办法可以解决，第一种办法是再加一个索引和判断条件，因为我只需要根据点击量取最大的10条数据，所以有很多数据我根本不需要加进来排序，比如点击量小于10的，这些数据可能占了很大部分。
我对clicks加一个索引，然后加入一个where条件再查询：
create index clicks on imgs(clicks);
mysql&gt; desc select /<em> from imgs where userid=&quot;admin&quot; order by clicks desc limit 10;
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
| id | select_type | table | type | possible_keys | key    | key_len | ref   | rows | Extra                       |
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
|  1 | SIMPLE      | imgs  | ref  | userid,clicks | userid | 51      | const | 2944 | Using where; Using filesort |
+----+-------------+-------+------+---------------+--------+---------+-------+------+-----------------------------+
1 row in set (0.00 sec)
这时可以看到possible_keys变成了userid,clicks，possible_keys是可以匹配的所有索引，mysql会从possible_keys中自己判断并取用其中一个索引来执行语句，值得注意的是，mysql取用的这个索引未必是最优化的。这次查询mysql还是使用userid这个索引来查询的，并没有按照我的意愿，所以结果还是没有什么变化。改一下sql加上use index强制mysql使用clicks索引：
mysql&gt; desc select /</em> from imgs use index (clicks) where userid=&#39;admin&#39; and clicks&gt;10 order by clicks desc limit 10
+----+-------------+-------+-------+---------------+--------+---------+------+------+-------------+
| id | select_type | table | type  | possible_keys | key    | key_len | ref  | rows | Extra       |
+----+-------------+-------+-------+---------------+--------+---------+------+------+-------------+
|  1 | SIMPLE      | imgs  | range | clicks        | clicks | 4       | NULL | 5455 | Using where |
+----+-------------+-------+-------+---------------+--------+---------+------+------+-------------+
1 row in set (0.00 sec)
这时mysql用到了clicks索引进行查询，但是结果集比userid还要大！看来还要再进行限制：
mysql&gt; desc select /<em> from imgs use index (clicks) where userid=&#39;admin&#39; and clicks&gt;1000 order by clicks desc limit 10
+----+-------------+-------+-------+---------------+--------+---------+------+------+-------------+
| id | select_type | table | type  | possible_keys | key    | key_len | ref  | rows | Extra       |
+----+-------------+-------+-------+---------------+--------+---------+------+------+-------------+
|  1 | SIMPLE      | imgs  | range | clicks        | clicks | 4       | NULL |  312 | Using where |
+----+-------------+-------+-------+---------------+--------+---------+------+------+-------------+
1 row in set (0.00 sec)
加到1000的时候结果集变成了312条，排序效率应该是可以接受。
不过，采用换索引这种优化方式需要取一个采样点，比如这个例子中的1000这个数字，这样，对userid的每个数值，都要去找一个采样点，这样对程序来说是很难办的。如果按1000取样的话，那么userid=&#39;7mini&#39;这个例子中，取到的结果将不会是8条，而是2条，给用户造成了困惑。
当然还有另一种办法，加入双索引：
create index userid_clicks on imgs (userid, clicks)
mysql&gt; desc select /</em> from imgs where userid=&quot;admin&quot; order by clicks desc limit 10;
+----+-------------+-------+------+----------------------+---------------+---------+-------+------+-------------+
| id | select_type | table | type | possible_keys        | key           | key_len | ref   | rows | Extra       |
+----+-------------+-------+------+----------------------+---------------+---------+-------+------+-------------+
|  1 | SIMPLE      | imgs  | ref  | userid,userid_clicks | userid_clicks | 51      | const | 2944 | Using where |
+----+-------------+-------+------+----------------------+---------------+---------+-------+------+-------------+
1 row in set (0.00 sec)
这时可以看到，结果集还是2944条，但是Extra中的filesort不见了。这时mysql使用userid_clicks这个索引去查询，这不但能快速查询到userid=&quot;admin&quot;的所有记录，并且结果是根据clicks排好序的！所以不用再把这个结果集读入内存一条一条排序了，效率上会高很多。
但是用多字段索引这种方式有个问题，如果查询的sql种类很多的话，就得好好规划一下了，否则索引会建得非常多，不但会影响到数据insert和update的效率，而且数据表也容易损坏。
以上是对索引优化的办法，因为原因可能会比较复杂，所以写得比较的长，一般好好优化了索引之后，mysql的效率会提升n个档次，从而也不需要考虑增加机器来解决问题了。
但是，mysql甚至所有数据库，可能都不好解决limit的问题。在mysql中，limit 0,10只要索引合适，是没有问题的，但是limit 100000,10就会很慢了，因为mysql会扫描排好序的结果，然后找到100000这个点，取出10条返回。要找到100000这个点，就要扫描100000条记录，这个循环是比较耗时的。不知道会不会有什么好的算法可以优化这个扫描引擎，我冥思苦想也想不出有什么好办法。对于limit，目前直至比较久远的将来，我想只能通过业务、程序和数据表的规划来优化，我想到的这些优化办法也都还没有一个是万全之策，往后再讨论。
2、sql写法过于复杂
sql写法假如用到一些特殊的功能，比如groupby、或者多表联合查询的话，mysql用到什么方式来查询也可以用desc来分析，我这边用复杂sql的情况还不算多，所以不常分析，暂时就没有好的建议。
3、配置错误
配置里主要参数是key_buffer、sort_buffer_size/myisam_sort_buffer_size，这两个参数意思是：
key_buffer=128M：全部表的索引都会尽可能放在这块内存区域内，索引比较大的话就开稍大点都可以，我一般设为128M，有个好的建议是把很少用到并且比较大的表想办法移到别的地方去，这样可以显著减少mysql的内存占用。
sort_buffer_size=1M：单个线程使用的用于排序的内存，查询结果集都会放进这内存里，如果比较小，mysql会多放几次，所以稍微开大一点就可以了，重要是优化好索引和查询语句，让他们不要生成太大的结果集。
另外一些配置：
thread_concurrency=8：这个配置标配=cpu数量x2
interactive_timeout=30
wait_timeout=30：这两个配置使用10-30秒就可以了，这样会尽快地释放内存资源，注意：一直在使用的连接是不会断掉的，这个配置只是断掉了长时间不动的连接。
query_cache：这个功能不要使用，现在很多人看到cache这几个字母就像看到了宝贝，这是不唯物主义的。mysql的query_cache在每次表数据有变化的时候都会重新清理连至该表的所有缓存，如果更新比较频繁，query_cache不但帮不上忙，而且还会对效率影响很大。这个参数只适合只读型的数据库，如果非要用，也只能用query_cache_type=2自行用SQL_CACHE指定一些sql进行缓存。
max_connections：默认为100，一般情况下是足够用的，但是一般要开大一点，开到400-600就可以了，能超过600的话一般就有效率问题，得另找对策，光靠增加这个数字不是办法。
其它配置可以按默认就可以了，个人觉得问题还不是那么的大，提醒一下：1、配置虽然很重要，但是在绝大部分情况下都不是效率问题的罪魁祸首。2、mysql是一个数据库，对于数据库最重要考究的不应是效率，而是稳定性和数据准确性。
4、机器实在负荷不了
如果做了以上调整，服务器还是不能承受，那就只能通过架构级调整来优化了。
1、mysql同步。
通过mysql同步功能将数据同步到数台从数据库，由主数据库写入，从数据库提供读取。
我个人不是那么乐意使用mysql同步，因为这个办法会增加程序的复杂性，并常常会引起数据方面的错误。在高负荷的服务中，死机了还可以快速重启，但数据错误的话要恢复就比较麻烦。
2、加入缓存
加入缓存之后，就可以解决并发的问题，效果很明显。如果是实时系统，可以考虑用刷新缓存方式使缓存保持最新。
在前端加入squid的架构比较提倡使用，在命中率比较高的应用中，基本上可以解决问题。
如果是在程序逻辑层里面进行缓存，会增加很多复杂性，问题会比较多而且难解决，不建议在这一层面进行调整。
3、程序架构调整，支持同时连接多个数据库
如果web加入缓存后问题还是比较严重，只能通过程序架构调整，把应用拆散，用多台的机器同时提供服务。
如果拆散的话，对业务是有少许影响，如果业务当中有部分功能必须使用所有的数据，可以用一个完整库+n个分散库这样的架构，每次修改都在完整库和分散库各操作一次，或定期整理完整库。
当然，还有一种最笨的，把数据库整个完完整整的做拷贝，然后程序每次都把完整的sql在这些库执行一遍，访问时轮询访问，我认为这样要比mysql同步的方式安全。
4、使用 mysql proxy 代理
mysql proxy 可以通过代理把数据库中的各个表分散到数台服务器，但是它的问题是没有能解决热门表的问题，如果热门内容散在多个表中，用这个办法是比较轻松就能解决问题。
我没有用过这个软件也没有认真查过，不过我对它的功能有一点点怀疑，就是它怎么实现多个表之间的联合查询？如果能实现，那么效率如何呢？
5、使用memcachedb
数据库换用支持mysql的memcachedb，是可以一试的想法，从memcachedb的实现方式和层面来看对数据没有什么影响，不会对用户有什么困扰。
为我现在因为数据库方面问题不多，没有试验过这个玩意。不过，只要它支持mysql的大部分主要的语法，而且本身稳定，可用性是无需置疑的。
  站名：<a href="http://www.sudone.com/" target="_blank">sudone.com</a>; 站长：<a href="http://www.sudone.com/ayou.html" target="_blank">Ayou</a>; 服务器：ubuntu+nginx+squid+php</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/mysql/">mysql</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/mysql/" class="label label-success">mysql</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:33"datetime="2014-03-07 09:54:33"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-mysql--mysql性能的检查和调优方法-sudonecom服务器系统架构分析日志/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-mysql--mysql性能的检查和调优方法-sudonecom服务器系统架构分析日志" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-mysql--MySQL运维笔记（一）——终止高负载SQL/">MySQL 运维笔记（一）—— 终止高负载SQL</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:33.000Z"> <a href="/2014/02/02/2014-02-02-DB-mysql--MySQL运维笔记（一）——终止高负载SQL/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="mysql-sql">MySQL 运维笔记（一）—— 终止高负载SQL</h1>
<p>数据库表体积大了，负载高了，难免一个sql出去耗时延长。半个月前，一个凌晨定时任务跑了8小时，突然手足无措。最后找DBA协助，直接干掉了这个sql进程。
其实，这并不复杂。
首先，找出占用CPU时间过长的SQL
Sql代码 <a href="&quot;复制代码&quot;"><img src="" alt="复制代码"></a> <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>show processlist;  </li>
</ol>
<p>show processlist;</p>
<p><img src="" alt="">
 假定最后一条sql处于Query状态，且Time时间过长，就锁定它的ID，直接干掉即可。</p>
<p>然后，杀死进程：</p>
<p>Sql代码 <a href="&quot;复制代码&quot;"><img src="" alt="复制代码"></a> <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>kill QUERY  4487855;  </li>
</ol>
<p>kill QUERY  4487855;</p>
<p> 这就大功告成了！</p>
<p> 参考</p>
<p>KILL [CONNECTION | QUERY] thread_id</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/mysql/">mysql</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/mysql/" class="label label-success">mysql</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:33"datetime="2014-03-07 09:54:33"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-mysql--MySQL运维笔记（一）——终止高负载SQL/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-mysql--MySQL运维笔记（一）——终止高负载SQL" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/133/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/131/">131</a></li><li><a class="page-number" href="/page/132/">132</a></li><li><a class="page-number" href="/page/133/">133</a></li><li class="active"><li><span class="page-number current">134</span></li><li><a class="page-number" href="/page/135/">135</a></li><li><a class="page-number" href="/page/136/">136</a></li><li><a class="page-number" href="/page/137/">137</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/135/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-26 21:21:33</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
