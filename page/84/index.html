
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 84 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--部署CAS单点登录服务器-萧飒的日志-网易博客/">部署CAS单点登录服务器 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--部署CAS单点登录服务器-萧飒的日志-网易博客/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-cas-">部署CAS单点登录服务器 - 萧飒的日志 - 网易博客</h1>
<p><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://www.163.com/" target="_blank">网易 </a></p>
<p><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://news.163.com/" target="_blank">新闻</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://t.163.com/" target="_blank">微博</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://email.163.com/" target="_blank">邮箱</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://photo.163.com/" target="_blank">相册</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://yuedu.163.com/" target="_blank">阅读</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://www.youdao.com/" target="_blank">有道</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://photo.163.com/pp/square/" target="_blank">摄影</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://aipai.163.com?from=163blog" target="_blank">爱拍</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://note.youdao.com/?vendor=163blog" target="_blank">云笔记</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://fm.163.com/?fmblogzx0628" target="_blank">闪电邮</a><a href="http://m.123.163.com/?frombkcp" target="_blank">手机邮</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://yxp.163.com/" target="_blank">印像派</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://hi.163.com/?from=bkcp" target="_blank">游戏江湖</a> <a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://sitemap.163.com/" target="_blank">更多</a></p>
<p><a href="http://blog.163.com/?frompersonalbloghome" target="_blank">博客 </a></p>
<p><a href="http://blog.163.com/services/wapblog.html?frompersonalbloghome" target="_blank">手机博客</a><a href="http://blog.163.com/clone/clone.html?frompersonalbloghome" target="_blank">博客搬家</a><a href="http://blog.163.com/vip.do?frompersonalbloghome" target="_blank">博客VIP服务</a> <a href="http://blog.163.com/blog_admin/blog/static/721279201082863728829/?frompersonalbloghome" target="_blank">LiveWriter写博</a><a href="http://blog.163.com/blog_admin/blog/static/721279201092713253500/?frompersonalbloghome" target="_blank">word写博</a><a href="http://blog.163.com/services/mailblog.html?frompersonalbloghome" target="_blank">邮件写博</a><a href="http://blog.163.com/services/emsblog.html?frompersonalbloghome" target="_blank">短信写博</a> <a href="http://blog.163.com/showMultiUser.do?frompersonalbloghome" target="_blank">群博客</a><a href="http://blog.163.com/BLOG_YOUCAI/" target="_blank">博客油菜地</a><a href="http://blog.163.com/ht/?frompersonalbloghome" target="_blank">博客话题</a><a href="http://blog.163.com/hot/history/?frompersonalbloghome" target="_blank">博客热点</a><a href="http://q.163.com/#home?frompersonalbloghome" target="_blank">博客圈子</a><a href="http://blog.163.com/findFriend.do?type=5?frompersonalbloghome" target="_blank">找朋友</a>
<a href="http://blog.163.com/public/explore/?frompersonalbloghome" target="_blank">发现</a></p>
<p><a href="http://blog.163.com/g/?frompersonalbloghome" target="_blank">小组</a>
<a href="http://blog.163.com/public/theme/?frompersonalbloghome" target="_blank">风格</a></p>
<p><a href="http://blog.163.com/randomUser.do" title="随便看看"></a></p>
<p><a href="http://istyle.163.com/" target="_blank">网易真人搭配社区iStyle</a></p>
<p><a href="http://www.lofter.com/" target="_blank">网易轻博客LOFTER</a></p>
<p><a href="http://reg.163.com/reg/reg.jsp?product=blog&amp;url=http://blog.163.com/ntesRegBlank.html&amp;loginurl=http://blog.163.com/" target="_blank">创建博客</a> <a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/#" target="_blank">登录</a>  </p>
<p> 加关注</p>
<p><a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/" target="_blank"></a>   <a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/">显示下一条</a>  |  <a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/" target="_blank">关闭</a></p>
<p><a href="http://blog.163.com/public/explore/?fromblogbanner"></a>
<a href="http://www.lofter.com/invite/163blog/?email="></a></p>
<h1 id="-">萧飒的博客</h1>
<p>未来的成功往往是现在无法想象的……
 <a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/#"></a></p>
<h2 id="-">导航</h2>
<ul>
<li><a href="http://slf-1983.blog.163.com/" target="_blank">首页</a></li>
<li><a href="http://slf-1983.blog.163.com/blog/" target="_blank">日志</a></li>
<li><a href="http://slf-1983.blog.163.com/album/" target="_blank">相册</a></li>
<li><a href="http://slf-1983.blog.163.com/music/" target="_blank">音乐</a></li>
<li><a href="http://slf-1983.blog.163.com/collection/" target="_blank">收藏</a></li>
<li><a href="http://slf-1983.blog.163.com/friends/" target="_blank">博友</a></li>
<li><a href="http://slf-1983.blog.163.com/profile/" target="_blank">关于我</a></li>
</ul>
<h2 id="-">日志</h2>
<p><a href="http://slf-1983.blog.163.com/blog/static/299023632012431659898/" target="_blank">cas改造随笔</a></p>
<p><a href="http://slf-1983.blog.163.com/blog/static/29902363201243323076/" target="_blank">jsessionid的困扰</a></p>
<h3 id="-cas-">部署CAS单点登录服务器</h3>
<p>2012-05-03 15:16:28|  分类： <a href="http://slf-1983.blog.163.com/blog/#m=0&amp;t=1&amp;c=fks_082068080083080065083095074065093095081065087080085" title="编程" target="_blank">编程</a> |  标签： |字号大中小 <a href="">订阅</a></p>
<p><strong>第0步：环境配置</strong></p>
<p>操作系统：CentOS 5.5 64位</p>
<p>JDK：1.7</p>
<p>Tomcat：7.0</p>
<p>CAS Server：3.4.11</p>
<p>CAS Client：3.2.1</p>
<p><strong>第1步：安装JAVA并设置环境变量</strong></p>
<p>从<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk-7u3-download-1501626.html" target="_blank"><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk-7u3-download-1501626.html">http://www.oracle.com/technetwork/java/javase/downloads/jdk-7u3-download-1501626.html</a></a></p>
<p>下载并安装Linux x64 RPM包
rpm -i jdk-7u3-linux-x64.rpm</p>
<p>设置环境变量</p>
<p>vi /etc/profile</p>
<p>加入</p>
<p>JAVA_HOME=/usr/java/jdk1.7.0_03 export JAVA_HOME</p>
<p>方便操作将keytool加入/usr/bin/</p>
<p>ln -s /usr/java/jdk1.7.0_03/bin/keytool /usr/bin/keytool</p>
<p><strong>第2步：安装Tomcat</strong></p>
<p>从<a href="http://tomcat.apache.org/download-70.cgi" target="_blank"><a href="http://tomcat.apache.org/download-70.cgi">http://tomcat.apache.org/download-70.cgi</a></a></p>
<p>下载Tomcat并解压</p>
<p>tar -zxvf apache-tomcat-7.0.26.tar.gz</p>
<p>方便操作将启动关闭加入/usr/bin/
ln -s /usr/local/tomcat/bin/startup.sh /usr/bin/tomcat-start ln -s /usr/local/tomcat/bin/shutdown.sh /usr/bin/tomcat-stop</p>
<p><strong>第3步：创建、导出、导入证书</strong></p>
<p>创建一个生成证书的脚本
vi create_https_cert.sh /# 删除原证书库 keytool -delete -keystore /home/cas/cascerts -storepass changeit /# 删除原别名 keytool -delete -alias sgstsso -storepass changeit /# 生成证书，需要注意的是dname需要使用域名或主机名，不能用IP，keystore 为生成的证书库地址，后面TOMCAT会用到 keytool -genkey -keyalg RSA -alias sgstsso -keystore /home/cas/cascerts -dname &quot;CN=cas.sgst.cn&quot; -storepass changeit /# 导出证书，导出的证书用在各客户端的JDK导入 keytool -export -alias sgstsso -keystore /home/cas/cascerts -file /home/cas/sgstsso.crt -storepass changeit /# 导入证书 keytool -import -alias sgstsso -file /home/cas/sgstsso.crt -keystore $JAVA_HOME/jre/lib/security/cacerts -storepass changeit</p>
<p>执行该脚本。</p>
<p><strong>第4步：应用证书到Tomcat</strong></p>
<p>编辑conf/server.xml加入下面这段（如果8443 https已开启使用的则在其基础上修改）</p>
<Connector protocol="org.apache.coyote.http11.Http11Protocol" port="8443" minSpareThreads="5" enableLookups="true" disableUploadTimeout="true" acceptCount="100" maxThreads="200" scheme="https" secure="true" SSLEnabled="true" keystoreFile="/home/cas/cascerts" keystorePass="changeit" truststoreFile="/usr/java/jdk1.7.0_03/jre/lib/security/cacerts" clientAuth="false" sslProtocol="TLS"/>

<p>重启Tomcat，访问<a href="https://localhost:8443，如果能否访问则配置成功。" target="_blank">https://localhost:8443，如果能否访问则配置成功。</a></p>
<p><strong>第5步：配置CAS服务器</strong></p>
<p>从<a href="http://www.jasig.org/cas/download" target="_blank"><a href="http://www.jasig.org/cas/download">http://www.jasig.org/cas/download</a></a>下载<a href="http://www.jasig.org/cas_server_3_4_11_release" target="_blank">CAS Server 3.4.11 Release</a>压缩包</p>
<p>解压后将其中的cas-server-3.4.11.war改名为cas.war放在tomcat下面</p>
<p>此时打开<a href="https://localhost:8443/cas/login即可访问" target="_blank">https://localhost:8443/cas/login即可访问</a></p>
<p>输入sgst/sgst登录成功（默认为简单认证，即用户名密码一样就算通过）</p>
<p>编辑tomcat/conf/server.xml在原Host下面增加以下这段</p>
<Host name="cas.sgst.cn" appBase="/home/cas/webapps" unpackWARs="true" autoDeploy="true"> <Context path='' docBase='cas'/> <Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs" prefix="cas_access_log." suffix=".txt" pattern="%h %l %u %t &quot;%r&quot; %s %b" /> </Host>

<p>这样实现以<a href="https://cas.sgst.cn:8443" target="_blank">https://cas.sgst.cn:8443</a> 访问cas</p>
<p>CAS的认证改为查询数据库用户名密码验证：</p>
<p>编辑cas/WEB-INF/deployerConfigContext.xml</p>
<p>将</p>
<bean class="org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler" />

注释掉，新增下面这段

<bean class="org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler"> <property name="dataSource" ref="casDataSource" /> <property name="sql" value="select userpwd from idsuser where lower(username) = lower(?)" /> <property name="passwordEncoder" ref="myPasswordEncoder"/> </bean>

<p>上面的加密根据个人需求可自行开发，这里用的是MD5 64位加密，以一个独立bean跟在后面</p>
<bean id="myPasswordEncoder"/>

casDataSource则同样以一个独立bean跟在后面

<bean id="casDataSource" class="org.apache.commons.dbcp.BasicDataSource"> <property name="driverClassName"> <value>oracle.jdbc.driver.OracleDriver</value> </property> <property name="url"> <value>jdbc:oracle:thin:@(DESCRIPTION =(ADDRESS = (PROTOCOL = TCP)(HOST = 10.10.29.104)(PORT = 1521))(ADDRESS = (PROTOCOL = TCP)(HOST = 10.10.29.105)(PORT = 1521))(ADDRESS = (PROTOCOL = TCP)(HOST = 10.10.29.106)(PORT = 1521))(LOAD_BALANCE = yes)(CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = genome)))</value> </property> <property name="username"> <value>trs_ids</value> </property> <property name="password"> <value>123456</value> </property> </bean>

<p>保存该文件，复制压缩包中的modules里的cas-server-support-jdbc-3.4.11.jar和ojdbc14.jar到cas/WEB-INF/lib下</p>
<p>重启Tomcat后CAS便以用户名密码进行验证。</p>
<p><strong>第6步：配置CAS客户端</strong></p>
<p>从<a href="http://www.jasig.org/cas/client-integration" target="_blank"><a href="http://www.jasig.org/cas/client-integration">http://www.jasig.org/cas/client-integration</a></a>参考适合的客户端，JAVA的在这里下载<a href="http://downloads.jasig.org/cas-clients/" target="_blank"><a href="http://downloads.jasig.org/cas-clients/">http://downloads.jasig.org/cas-clients/</a></a></p>
<p>客户端中相应的JAR包都有，对应的maven为
<!-- cas --> <dependency> <groupId>org.jasig.cas.client</groupId> <artifactId>cas-client-core</artifactId> <version>3.2.1</version> </dependency></p>
<p>修改web.xml增加以下filter</p>
<!-- ======================== 单点登录开始 ======================== --> <!-- 用于单点退出，该过滤器用于实现单点登出功能，可选配置--> <listener> <listener-class>org.jasig.cas.client.session.SingleSignOutHttpSessionListener</listener-class> </listener> <!-- 该过滤器用于实现单点登出功能，可选配置。 --> <filter> <filter-name>CAS Single Sign Out Filter</filter-name> <filter-class>org.jasig.cas.client.session.SingleSignOutFilter</filter-class> </filter> <filter-mapping> <filter-name>CAS Single Sign Out Filter</filter-name> <url-pattern>/check//<em></url-pattern> </filter-mapping> <!-- 该过滤器负责用户的认证工作，必须启用它 --> <filter> <filter-name>CASFilter</filter-name> <filter-class>org.jasig.cas.client.authentication.AuthenticationFilter</filter-class> <init-param> <param-name>casServerLoginUrl</param-name> <!-- 这里是服务器端地址 --> <param-value><a href="https://cas.sgst.cn:8443/login" target="_blank">https://cas.sgst.cn:8443/login</a></param-value> </init-param> <init-param> <param-name>serverName</param-name> <param-value><a href="http://localhost:8080" target="_blank">http://localhost:8080</a></param-value> </init-param> </filter> <filter-mapping> <filter-name>CASFilter</filter-name> <url-pattern>/check//</em></url-pattern> </filter-mapping> <!-- 该过滤器负责对Ticket的校验工作，必须启用它 --> <filter> <filter-name>CAS Validation Filter</filter-name> <filter-class> org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter </filter-class> <init-param> <param-name>casServerUrlPrefix</param-name> <param-value><a href="https://cas.sgst.cn:8443" target="_blank">https://cas.sgst.cn:8443</a></param-value> </init-param> <init-param> <param-name>serverName</param-name> <param-value><a href="http://localhost:8080" target="_blank">http://localhost:8080</a></param-value> </init-param> </filter> <filter-mapping> <filter-name>CAS Validation Filter</filter-name> <url-pattern>/check//<em></url-pattern> </filter-mapping> <!-- 该过滤器负责实现HttpServletRequest请求的包裹， 比如允许开发者通过HttpServletRequest的getRemoteUser()方法获得SSO登录用户的登录名，可选配置。 --> <filter> <filter-name>CAS HttpServletRequest Wrapper Filter</filter-name> <filter-class>org.jasig.cas.client.util.HttpServletRequestWrapperFilter</filter-class> </filter> <filter-mapping> <filter-name>CAS HttpServletRequest Wrapper Filter</filter-name> <url-pattern>/check//</em></url-pattern> </filter-mapping> <!-- 该过滤器使得开发者可以通过org.jasig.cas.client.util.AssertionHolder来获取用户的登录名。 比如AssertionHolder.getAssertion().getPrincipal().getName()。 --> <filter> <filter-name>CAS Assertion Thread Local Filter</filter-name> <filter-class>org.jasig.cas.client.util.AssertionThreadLocalFilter</filter-class> </filter> <filter-mapping> <filter-name>CAS Assertion Thread Local Filter</filter-name> <url-pattern>/check//*</url-pattern> </filter-mapping> <!-- ======================== 单点登录结束 ======================== -->

<p>2012-03-21更新： CAS filter-mapping一定要放在整个项目的encodingFilter之后，否则会造成中文乱码</p>
<p><strong>第7步：美化服务器界面</strong></p>
<p>具体页面在cas\WEB-INF\view\jsp\default\ui\</p>
<p>登录界面：casLoginView.jsp
登录成功：casGenericSuccess.jsp
登出界面：casLogoutView.jsp
  评论这张</p>
<p><img src="" alt=""> 转发至微博
<img src="" alt=""> 转发至微博</p>
<p><img src="" alt=""> 0人  |  分享到：        </p>
<p>阅读(7)| 评论(0)| 转载 (0) |举报</p>
<p><a href="http://slf-1983.blog.163.com/blog/static/299023632012431659898/" target="_blank">cas改造随笔</a></p>
<p><a href="http://slf-1983.blog.163.com/blog/static/29902363201243323076/" target="_blank">jsessionid的困扰</a></p>
<h3 id="-">历史上的今天</h3>
<h3 id="-">相关文章</h3>
<h3 id="-">最近读者</h3>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<p>this.p={ m:2, b:2, id:&#39;fks_087066086087081064092094095065072084088074084084085069087&#39;, blogTitle:&#39;部署CAS单点登录服务器&#39;, blogAbstract:&#39;<span style=\"color: rgb(51, 51, 51); font-family: \'Segoe UI\', Calibri, \'Myriad Pro\', Myriad, \'Trebuchet MS\', Helvetica, Arial, sans-serif; font-size: 13px; line-height: normal;\" \><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \><strong\>第0步：环境配置</strong\></p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>操作系统：CentOS 5.5 64位</p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>JDK：1.7</p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>Tomcat：7.0</p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>CAS Server：3.4.11</p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>CAS Client：3.2.1</p\></span\>&#39;, blogTag:&#39;编程&#39;, blogUrl:&#39;blog/static/2990236320124331628240&#39;, isPublished:1, istop:false, type:0, modifyTime:0, publishTime:1336029388240, permalink:&#39;blog/static/2990236320124331628240&#39;, commentCount:0, mainCommentCount:0, recommendCount:0, bsrk:-100, publisherId:0, recomBlogHome:false, attachmentsFileIds:[], vote:{}, groupInfo:{}, friendstatus:&#39;none&#39;, followstatus:&#39;unFollow&#39;, pubSucc:&#39;&#39;, visitorProvince:&#39;北京&#39;, visitorCity:&#39;西城区&#39;, postAddInfo:{}, mset:&#39;000&#39;, mcon:&#39;&#39;, srk:-100, remindgoodnightblog:false, isBlackVisitor:false, isShowYodaoAd:true, hostIntro:&#39;我,犯溅一样的猪一样的懒,无语……&#39;, hmcon:&#39;1&#39;, selfRecomBlogCount:&#39;0&#39;, lofter_single:&#39;<a hidefocus="true" target="_blank" href="http://www.lofter.com/reg?act=qbview_20120221_01&from=blog_01"><img onload="var nimg = new Image(); nimg.src=\'http://blog.163.com/newpage/images/analyse.png?lofter_single&t=\'+new Date().getTime()" border="0" src="http://b2.bst.126.net/newpage/images/lofter_single6.jpg"/></a>&#39; }   {list a as x} {if !!x} <div class="iblock nbw-fce nbw-f40"> <a class="fc03 noul" target="_blank" hidefocus="true" href="http://blog.163.com/${x.visitorName}/"> {if x.visitorName==visitor.userName} <img alt="${x.visitorNickname|escape}" onerror="this.src=location.f40" class="cwd bdwa bdc0" src="${fn1(x.visitorName)}&r=${visitor.imageUpdateTime}"/> {else} <img alt="${x.visitorNickname|escape}" onerror="this.src=location.f40" class="cwd bdwa bdc0" src="${fn1(x.visitorName)}"/> {/if} </a> <div class="cwd vname thide"> {if x.moveFrom==&#39;wap&#39;} <a class="noul pnt" target="_blank" href="http://blog.163.com/services/wapblog.html?frompersonalbloghome"><span title="来自网易手机博客" class="iblock wapIcon"> </span></a> {elseif x.moveFrom==&#39;iphone&#39;} <a class="noul pnt" target="_blank"><span title="来自iPhone客户端" class="iblock iphoneIcon"> </span></a> {elseif x.moveFrom==&#39;android&#39;} <a class="noul pnt" target="_blank"><span title="来自Android客户端" class="iblock androidIcon"> </span></a> {elseif x.moveFrom==&#39;mobile&#39;} <a class="noul pnt" target="_blank" href="http://blog.163.com/services/emsblog.html?frompersonalbloghome"><span title="来自网易短信写博" class="iblock wapIcon"> </span></a> {/if} <a class="fc03 m2a" target="_blank" hidefocus="true" href="http://blog.163.com/${x.visitorName}/"> ${fn(x.visitorNickname,8)|escape} </a> </div> </div> {/if} {/list}   {if !!a} <a target="_blank" href="http://blog.163.com/${a.userName}/"><img class="bdwa bdc0 pnt" onerror="this.src=location.f60" src="${fn1(a.userName)}"/></a> <a target="_blank" class="fc03 m2a" href="http://blog.163.com/${a.userName}/">${fn(a.nickname,8)|escape}</a> <div class="intro fc05">${a.selfIntro|escape}{if great260}${suplement}{/if}</div> <div class="acts ztag"></div> <div class="mbga phide xtag"> <div class="mbgai"> </div> <a class="fc03 xtag m2a" href="/#" target="_blank"></a> </div> {/if}  &lt;/#--最新日志，群博日志--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="${furl()}${x.permalink}/?latestBlog">${fn(x.title,26)|escape}</a></li> {/if} {/list}  &lt;/#--推荐日志--&gt;  <p class="fc06">推荐过这篇日志的人：</p> <div> {list a as x} {if !!x} <div class="iblock nbw-fce nbw-f40"> <a class="fc03 noul" target="_blank" hidefocus="true" href="http://blog.163.com/${x.recommenderName}/"> <img alt="${x.recommenderNickname|escape}" onerror="this.src=location.f40" class="cwd bdwa bdc0" src="${fn1(x.recommenderName)}"/> </a> <div class="cwd thide"> <a class="fc03 m2a" target="_blank" hidefocus="true" href="http://blog.163.com/${x.recommenderName}/"> ${fn(x.recommenderNickname,6)|escape} </a> </div> </div> {/if} {/list} </div> {if !!b&amp;&amp;b.length&gt;0} <p class="fc06">他们还推荐了：</p> <ul> {list b as y} {if !!y} <li class="rrb"><span class="iblock">·</span><a class="fc03 m2a" target="_blank" href="http://blog.163.com/${y.recommendBlogPermalink}/?from=blog/static/2990236320124331628240">${y.recommendBlogTitle|escape}</a></li> {/if} {/list} </ul> {/if}  &lt;/#--引用记录--&gt;  <span class="pleft fc07">转载记录：</span> <ul class="tbac"> {list d as x} <li class="clearfix"> <span class="pleft iblock">·</span> <div class="tbl thide pleft"><span><a target="_blank" class="fc07 m2a" href="${x.referBlogUrl}">${x.referBlogTitle|escape}</a></span></div> <div class="tbr pleft"><span><a target="_blank" class="fc07 m2a" href="${x.referHomePage}">${x.referUserName|escape}</a></span></div> </li> {/list} </ul>  &lt;/#--博主推荐--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="http://blog.163.com/${x.userName}/${x.permalink}/?recommendBlog" title="${x.title|default:""|escape}">${x.title|default:&quot;&quot;|escape}</a></li> {/if} {/list}  &lt;/#--随机阅读--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="http://blog.163.com/${x.userName}/${x.permalink}/?personalRecomBlog" title="${x.title|default:""|escape}">${x.title|default:&quot;&quot;|escape}</a></li> {/if} {/list}  &lt;/#--首页推荐--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" target="_blank" href="${x.blogUrl|default:""|escape}?recommendReader" title="${x.blogTile|default:""|escape}">${x.blogTile|default:&quot;&quot;|escape}</a></li> {/if} {/list}  &lt;/#--相关文章--&gt;  <ul> {list a as x} {if x_index&gt;9}{break}{/if} {if !!x} <li class="thide fc03"> <a class="m2a" target="_blank" target="_blank" href="${x.url|default:""}?fromdm&fromSearch&isFromSearchEngine=${isFromSearchEngine|default:"no"}" title="${x.title|default:""|escape}">${x.title|default:&quot;&quot;|escape}</a><span class="fc07">${fn2(parseInt(x.date),&#39;yyyy-MM-dd HH:mm:ss&#39;)}</span> </li> {/if} {/list} </ul>  &lt;/#--历史上的今天--&gt;  <ul> {list a as x} {if x_index&gt;4}{break}{/if} {if !!x} <li class="thide fc03"> <a class="m2a" target="_blank" href="http://blog.163.com/${x.userName}/${x.permalink|default:""}" title="${x.title|default:""|escape}">${fn1(x.title,60)|escape}</a><span class="fc07">${fn2(x.publishTime,&#39;yyyy-MM-dd HH:mm:ss&#39;)}</span> </li> {/if} {/list} </ul>  &lt;/#--被推荐日志--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="${furl()}${x.permalink}/">${fn(x.title,26)|escape}</a></li> {/if} {/list}  &lt;/#--右边模块结构--&gt;  <div class="uinfo ztag"></div> <h4 class="fc07 fs0 ltt phide ztag">被推荐日志</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">最新日志</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">该作者的其他文章</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">博主推荐</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">相关日志</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">随机阅读</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">首页推荐</h4> <ul class="ztag blst"></ul> <div class="more"><a target="_blank" class="fc03 m2a" href="http://blog.163.com">更多&gt;&gt;</a></div> <br/><br/> <div id="yodaoad_r" style="display:none;_zoom:1;"></div> <div id="lofter_single"></div>  &lt;/#--评论模块结构--&gt;  <div class="publish ztag"></div> <div class="bdwt bds2 bdc0 phide" id="yodaoad_2" style="_zoom:1;"></div> <div class="ztag bdwt bds2 bdc0"> <div class="case"></div> <div class="clearfix"></div> </div>  &lt;/#--引用模块结构--&gt;  <div class="close"> <span class="ztag iblock icn0 icn0-57"> </span> </div> <div class="ztag phide"></div>  &lt;/#--博主发起的投票--&gt;  {list a as x} {if !!x} <li> <a href="http://blog.163.com/${x.userName}/" target="_blank" class="m2a fc03">${x.nickName|escape}</a>  投票给 {var first_option = true;} {list x.voteDetailList as voteToOption} {if voteToOption==1} {if first_option==false},{/if}  “${b[voteToOption_index]}”   {/if} {/list} {if (x.role!=&quot;-1&quot;) },“我是${c[x.role]}”  {/if}     <span class="fc07">    ${fn1(x.voteTime)}</span> {if x.userName==&#39;&#39;}{/if} {/if} {/list}</p>
<h2 id="-">页脚</h2>
<p><a href="http://corp.163.com/index_gb.html" target="_blank">公司简介</a> - <a href="http://gb.corp.163.com/gb/contactus.html" target="_blank">联系方法</a> - <a href="http://corp.163.com/gb/job/job.html" target="_blank">招聘信息</a> - <a href="http://help.163.com/?b13abk1" target="_blank">客户服务</a> - <a href="http://corp.163.com/gb/legal/legal.html" target="_blank">隐私政策</a> - <a href="http://blog.163.com/public/theme/" target="_blank">博客风格</a> - <a href="http://blog.163.com/services/wapblog.html" target="_blank">手机博客</a> - <a href="http://blog.163.com/vip.do" target="_blank">VIP博客</a> - <a href="">订阅此博客</a></p>
<p>网易公司版权所有 ©1997-2012</p>
<p><a rel="nofollow" class="pr" target="_blank" href="http://help.163.com/special/007525FT/blog.html?b13aze1">帮助</a> <span class="fr iblock space icn1 icn1-4"> </span> <a class="pr" target="_blank" href="http://blog.163.com/activation.do?host=activation&&username=${u}">${u}</a>   {list wl as x} <div class="grp">${x.g}</div> {list x.l as y} <a class="itm noul" href="/#" hidefocus="true" name="{if typeof(y.v)=='string'}${y.v}{else}${y_index}{/if}">${y.n}</a> {/list} {/list}   {if defined(&#39;wl&#39;)} {list wl as x}<a class="itm noul" href="/#" hidefocus="true" name="${x.v}">${x.n}</a>{/list} {/if}</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--部署CAS单点登录服务器-萧飒的日志-网易博客/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--部署CAS单点登录服务器-萧飒的日志-网易博客" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--新浪微博如何实现SSO的分析-企业应用-Java-ITeye论坛/">新浪微博如何实现 SSO 的分析 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--新浪微博如何实现SSO的分析-企业应用-Java-ITeye论坛/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-sso-java-iteye-">新浪微博如何实现 SSO 的分析 - 企业应用 - Java - ITeye论坛</h1>
<p><a href="http://www.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/login" target="_blank">登录</a> <a href="http://www.iteye.com/signup" target="_blank">注册</a></p>
<p><a href="http://www.iteye.com/" target="_blank"><img src="&quot;ITeye-最棒的软件开发交流社区&quot;" alt="ITeye-最棒的软件开发交流社区"></a></p>
<p><a href="http://www.iteye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.iteye.com/forums/board/Java" target="_blank">Java企业应用论坛</a> →</p>
<h1 id="-sso-">新浪微博如何实现 SSO 的分析</h1>
<p><a href="http://www.iteye.com/forums/board/Java" target="_blank">全部</a> <a href="http://www.iteye.com/forums/tag/Hibernate" target="_blank">Hibernate</a> <a href="http://www.iteye.com/forums/tag/Spring" target="_blank">Spring</a> <a href="http://www.iteye.com/forums/tag/Struts" target="_blank">Struts</a> <a href="http://www.iteye.com/forums/tag/iBATIS" target="_blank">iBATIS</a> <a href="http://www.iteye.com/forums/tag/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8" target="_blank">企业应用</a> <a href="http://www.iteye.com/forums/tag/Lucene" target="_blank">Lucene</a> <a href="http://www.iteye.com/forums/tag/SOA" target="_blank">SOA</a> <a href="http://www.iteye.com/forums/tag/Java%E7%BB%BC%E5%90%88" target="_blank">Java综合</a> <a href="http://www.iteye.com/forums/tag/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" target="_blank">设计模式</a> <a href="http://www.iteye.com/forums/tag/Tomcat" target="_blank">Tomcat</a> <a href="http://www.iteye.com/forums/tag/OO" target="_blank">OO</a> <a href="http://www.iteye.com/forums/tag/JBoss" target="_blank">JBoss</a>
« 上一页 1 <a href="http://www.iteye.com/topic/1039052?page=2" target="_blank">2</a> <a href="http://www.iteye.com/topic/1039052?page=3" target="_blank">3</a> <a href="http://www.iteye.com/topic/1039052?page=2" target="_blank">下一页 »</a></p>
<p>浏览 14772 次 锁定老帖子 <a href="">主题：新浪微博如何实现 SSO 的分析</a></p>
<p><strong>该帖已经被评为精华帖</strong> 作者 正文 * denger</p>
<ul>
<li>等级: <img src="&quot;四星会员&quot;" alt="四星会员"></li>
<li><a href="http://denger.iteye.com/" target="_blank"><img src="&quot;denger的博客: Coding for fun.      &quot;" alt="denger的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 176</li>
<li>积分: 400</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-10   最后修改：2011-06-25</li>
</ul>
<p><a href="http://www.iteye.com/topic/1039052#" target="_blank">&lt;</a> <a href="http://www.iteye.com/topic/1039052#" target="_blank">&gt;</a>  猎头职位: <a href="http://www.iteye.com/jobs/2245" target="_blank">上海:  【上海】外资企业高新诚聘web开发工程师</a></p>
<p>相关文章: <a href="http://www.iteye.com/topic/1039052#" title="关闭" target="_blank"> </a></p>
<ul>
<li><a href="http://www.iteye.com/topic/1111931" title="CAS 之 跨域 Ajax 登录实践" target="_blank">CAS 之 跨域 Ajax 登录实践</a></li>
<li><a href="http://www.iteye.com/topic/21770" title="跨域的单点登录" target="_blank">跨域的单点登录</a></li>
<li><p><a href="http://www.iteye.com/topic/544899" title="【原创】CAS调研总结" target="_blank">【原创】CAS调研总结</a>
推荐群组: <a href="http://liferay.group.iteye.com/" target="_blank">liferay</a>
<a href="http://www.iteye.com/wiki/topic/1039052" target="_blank">更多相关推荐</a>
<a href="http://www.iteye.com/forums/tag/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8" target="_blank">企业应用</a>      最近在使用sina微博时，经常性交替使用　weibo.com 和 t.sina.cm.cn进入我的微博。发现当我在 t.sina.com.cn中登录之后，直接切换至weibo.com，这时候在 weibo.com是已经登录的，当我在 weibo.com进行注销之后，再切换至 t.sina.com.cn，这时候在 t.sina.com.cn也已经是注销的状态了。
   对于SSO的实现方案及其机制，早已经不是什么新鲜的技术了，从微软为.net提供的passport机制到java中开源的JBoss SSO、Oracle OpenSSO及经典的 Yale CAS等等之类的开源或一些商业SSO中间件都不失为作为单点登录实现的选择。当然一些企业也会选择自己实现一套适合自己轻量级方案，如采用SESSIONID转递或SESSION同步复制之类的。　可以看得出SSO的价值也是具大的，就拿sina来说吧，增加 weibo.com域名之后，对于用户来说来说没有任何影响，即使你在 t.sina.com.cn中进行登录，可以无缝在两域名之间随意切换，对于它推广weibo.com无非是大大的益处。
  由于近年来一直在使用 Yale的CAS作为SSO的方案，觉得 SINA的SSO与Yale-CAS有很多异曲同工之妙，于是便对SINA的SSO进行分析，其中的细节处理还是很值的学习的。当然，由于分析看到的SINA SSO处理都只是一些表现或表面上的东西，再加上其大部分关键的sso js都已经被压缩，及SERVER端的实现机制也只是靠自己的经验及结合CAS的的一些原理进行猜测。其实本文应该叫　<CAS SSO与SINA SSO的实现对比分析>更比较贴切。</p>
<p>  好吧，进入正题。</p>
</li>
<li><p>Sina SSO之分析篇
  首先是进入 t.sina.com.cn，提交用户名及密码进行登录，通过 Firebug可以看到它通过类似Aajx POST到了 <a href="http://login.sina.com.cn/sso/login.php?client=ssologin.js(v1.3.12)，如下图所示：" target="_blank">http://login.sina.com.cn/sso/login.php?client=ssologin.js(v1.3.12)，如下图所示：</a>
  <img src="" alt="">
  不难看出，其 <a href="http://login.sina.com.cn/sso/login.php" target="_blank">http://login.sina.com.cn/sso/login.php</a> 就是类似是 CAS 中的 Server，对sina的所有应用系统提供的统一登录入口。上面的参数中有一个service参数，了解 CAS的GG应该知道 cas 在登录的时候除了username 和 password同样也有一个 service 参数，其CAS该参数含义是子应用系统的服务名标识及登录成功之后所跳转的地址。当然，sina这里使用了 &quot;miniblog&quot;作为微博的服务名，估计他在sso-server端对 miniblog 与登录成功之后的地址进行映射，如 miniblog=<a href="http://t.sina.com.cn/，这样就避免了CAS-client中转入service=" target="_blank">http://t.sina.com.cn/，这样就避免了CAS-client中转入service=</a> decodeURIComponent(&#39;<a href="http://t.sina.com.cn&#39;)之类的做法了。" target="_blank">http://t.sina.com.cn&#39;)之类的做法了。</a>
  这里的登录与CAS做法一致，将登录验证提交至统一的认证中心进行验证处理，从而避免了跨子域和全域的问题。　验证成功之后路转的路径就是service所向的地址，验证失败之后则返回至当前登录页。下面就SSO中的一些登录方面的核心问题做一些分析，看看SINA和CAS分别是如何处理的：
   　<strong>1.如何授权某个子系统允许其在sso-server进行登录验证呢，类似cas-server中的login-ticket;</strong></p>
<pre><code>  对于cas来说，在首次进入  /cas/login页时， [会产生一个一次性的login-ticket](http://denger.iteye.com/blog/809170)，也就是说在提交登录验证前必须向服务器请求一个login-ticket，在登录提交时，需要将用户名及密码以及login-ticket进行提交至 cas-server端，cas-server端确定login-ticket有效后才会对用户名及密码进行认证。
  看看sina如何处理的吧，继续看firebug:
  ![]()       以上截图是当我首次进行 t.sina.com.cn时，通过 ajax/jsonp的方式发起的一个请求，可以看到返回的callback函数中的 json 串中包含了 nonce:&quot;SXK19N&quot;的属性，参数名的汉译是“一次”或“一次性”的意思，估计这里的 nonce就是login-ticket，为再一次确实，我再试着提交登录看看，看它是否将该参数POST过去：
 ![]()
 果然不出所料， nonce:&quot;SXK19N&quot;作为参数提交过去了，证明所猜测的应该是正确的。
</code></pre><p><strong>2.比如验证码跨域跨服务器导致从session无法获取的问题，我们曾经遇到过;</strong></p>
<pre><code>  貌似sina登录没有涉及到验证码之类的东西，当你多次登录失败之后，它采用的是“您的登录过于频繁，请稍后再试吧”，这种方案确实比验证码要好的多，而且还避免了上面的说的问题。
</code></pre><p>   <strong>3. 当我登录失败了，/sso/login.php 如何将登录的错误信息返回给 t.sina.com.cn并让它进行显示呢，如果我登录成功了/sso/login.php 通过什么方式通知t.sina.com.cn呢，因为它这里使用的是ajax方式登录？</strong></p>
<pre><code> 对于这方面，cas的处理是将错误信息以参数的方式返回给 client-login，如登录失败，重定向地址： http://cas-client.com?errocode=0，如果登录成功，则直接 重定向至 service 中的url，并生成ST给客户端，表示其已经在cas-server登录成功了。
 看看sina如何处理的吧，随便输入一个用户名密码，提交登录，继续通过firebug看看它的处理过程:
</code></pre><p><img src="&quot;点击查看原始大小图片&quot;" alt=""></p>
<pre><code>  再看看t.sina.com.cn 中的html内容的变化：
  ![]()
</code></pre><p>以上图1中发生了两次请求，第一次登录验证是访问 sso认证中心，它所返回response是一个html内容，第二次请求的地址：　<a href="http://t.sina.com.cn/ajaxlogin.php" target="_blank">http://t.sina.com.cn/ajaxlogin.php</a>　framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2）
再结合以上图2信息，看到 html 中发生了变化，创建了一个　id=ssoLoginFrame 的iframe，于是便可以得出，sina 的登录并非原生的ajax方式，而是通过创建iframe来模拟提交不刷新的登录。也就是说，当用户点击登录提交时，这时候它会通过js创建iframe，将登录提效至该iframe中。</p>
<pre><code>   既然已经知道它登录是提交到iframe中，而非ajax方式，那么对于以上截图1中两个请求为什么返回的都是HTML内容就很容易解释了。再回到上面的问题，/sso/login是如何通知t.sina.com.cn登录失败了呢? 首先在以上第一个截图中返回的 HTML包含了一段 javascript:
</code></pre></li>
</ul>
<p>Javascript代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>location.replace(&quot;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2%BC%B3%A%BC%B3%A2%CA%D4%B4%CE%CA%FD%B9%FD%D3%DA%C6%B5%B7%B1%A3%AC%C7%EB%C9%D4%BA%F3%D4%D9%B5%C7%C2%BC" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2%BC%B3%A%BC%B3%A2%CA%D4%B4%CE%CA%FD%B9%FD%D3%DA%C6%B5%B7%B1%A3%AC%C7%EB%C9%D4%BA%F3%D4%D9%B5%C7%C2%BC</a>&quot;);<br>location.replace(&quot;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2%BC%B3%A%BC%B3%A2%CA%D4%B4%CE%CA%FD%B9%FD%D3%DA%C6%B5%B7%B1%A3%AC%C7%EB%C9%D4%BA%F3%D4%D9%B5%C7%C2%BC" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2%BC%B3%A%BC%B3%A2%CA%D4%B4%CE%CA%FD%B9%FD%D3%DA%C6%B5%B7%B1%A3%AC%C7%EB%C9%D4%BA%F3%D4%D9%B5%C7%C2%BC</a>&quot;);<pre><code>  location.replace的意思与location.href类似，同样都是改变当前的URL地址,具体区别及做法可以参考[这里](http://blog.csdn.net/fangxinggood/archive/2006/02/21/604916.aspx)及[这里](http://developer.apple.com/internet/webcontent/iframe.html)。需要注意的这里所说的通过location.replace改变当前的URL其它并非改变t.sina.com.cn的地址，而是第二个截图里iframe中src的地址，因为这段HTML是在iframe中输出的。
在  locaiton.replace 的地址中包含了一个 retcode 及 reason参数，估计这就是当前登录的错误信息。在上面第一个截图的第二个请求实际就是在iframe 中进行的 location.replace操作后的跳转地址。关键看它输出的html内容：
</code></pre></li>
</ol>
<p>Html代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><html><head>  </li>
<li><script language='javascript'>  </li>
<li>parent.sinaSSOController.feedBackUrlCallBack({&quot;result&quot;:false,&quot;errno&quot;:&quot;4038&quot;,&quot;reason&quot;:&quot;\u767b\u5f55\u5c1d\u8bd5\u6b21\u6570\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u540e\u518d\u767b\u5f55&quot;});</script></head><body></body></html>null<br><html><head> <script language='javascript'> parent.sinaSSOController.feedBackUrlCallBack({&quot;result&quot;:false,&quot;errno&quot;:&quot;4038&quot;,&quot;reason&quot;:&quot;\u767b\u5f55\u5c1d\u8bd5\u6b21\u6570\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u540e\u518d\u767b\u5f55&quot;});</script></head><body></body></html>null
  这段js是在 iframe中执行的，所以可以通过 parent 进行访问 t.sina.com.cn中的js，可以肯定 parent.sinaSSOController.feedBackUrlCallBack 就是告诉 t.sina.com.cn 当前已经登录失败了，并且将错误信息传至该入该callback了。至此，已经完成了 /sso/login.php 对 t.sina.com.cn的信息传送。　新浪果然是有一手呀，在CAS中AJAX登录一直都是一个问题，而sina它巧妙的通过iframe+callback 进行实现了。
  接着，再看看它对于登录成功之后如何通知 t.sina.com.cn的吧，先看看登录成功之后 sina-sso-server 会做什么，看firebug截图：
   <img src="&quot;点击查看原始大小图片&quot;" alt="">
   重点在于 set-Cookie: tgc=TGT-MTc4NTc0NzM0Mw==-1305003116-ja-D51B2EB107B79FC50D8CA424BFE08907;  哈哈，熟悉CAS的应该会很熟悉这个，没想到SINA的TGT与CAS的TGT不但参数命名，居然连生成的规则也一模一样，估计sina肯定是参考了 cas 的实现机制。关于TGT是什么或其作用可以参考：<a href="http://zhenkm0507.iteye.com/blog/546805" target="_blank">CAS总结之Ticket篇</a>。另外还有一个就是当登录成功之后，sina-sso-server会将用户登陆名等等放在sina.com.cn根域的cookie中。
   然后再看看登录成功之后 sina-sso-server所返回的response内容：
   <img src="" alt="">
   以下是从以上摘取JS部分：</li>
</ol>
<p>Javascript代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><script>  </li>
<li>try{sinaSSOController.setCrossDomainUrlList({&quot;retcode&quot;:0,&quot;arrURL&quot;:[&quot;http:\/\/weibo.com\/sso\/crosdom?action=login&amp;savestate=1305607916&quot;]});}catch(e){}try{sinaSSOController.crossDomainAction(&#39;login&#39;,function(){location.replace(&#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0&#39;);});}catch(e){}" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0&#39;);});}catch(e){}</a>  </li>
<li></script><br><script> try{sinaSSOController.setCrossDomainUrlList({&quot;retcode&quot;:0,&quot;arrURL&quot;:[&quot;http:\/\/weibo.com\/sso\/crosdom?action=login&amp;savestate=1305607916&quot;]});}catch(e){}try{sinaSSOController.crossDomainAction(&#39;login&#39;,function(){location.replace(&#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0&#39;);});}catch(e){}" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0&#39;);});}catch(e){}</a> </script>
   首先再次声明，以上firebug截图中的请求处理，并非 AJAX，而是在 t.sina.com.cn中放了一个iframe，输出的 reponse都会至iframe当中.<br>   以上的js主要重点在于:</li>
</ol>
<p>Javascript代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>location.replace(&#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0</a>&#39;)<br>location.replace(&#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0</a>&#39;)
   还是通过设置当前iframe中src地址，再看看跳转至<a href="http://t.sina.com.cn/ajaxlogin.php后的response内容吧：" target="_blank">http://t.sina.com.cn/ajaxlogin.php后的response内容吧：</a>
   <img src="" alt="">
   返回用户信息(从cookie中获取的)，并且还是类似上面的做法，通过　parent.sinaSSOController.feedBackUrlCallBack回调t.sina.com.cn中的js，告诉它这个用户已经登录成功了。
   于是t.sina.com.cn便进行跳转至　t.sina.com.cn/dengers 中，从而实现登录。
   <img src="" alt="">
   整体的处理流程如下：
   <img src="" alt="">
   <strong>4. 当我在t.sina.com.cn中登录后，切换至weibo.com，weibo.com我应该也是已经登录的，如何做到呢？</strong><pre><code>对于这个问题，CAS中的处理就是，当我进入 weibo.com的时候，马上跳转至  /cas/login，然后在login中判断cookie是否存在TGT，如果存在，并确定其有效性后，则认为你已经登录，并为你生成一个ST，将ST作为ticket参数使其重定向至 weibo.com?ticket=TG-xxxx 并登录。
</code></pre>   看看sina怎么处理的吧，首先我直接在t.sina.com.cn登录成功。然后再新建一个选项卡，输入 weibo.com：
   <img src="&quot;点击查看原始大小图片&quot;" alt="">
   可以看得出，当我进入　weibo.com之后，sina并没有直接进入 weibo.com的主页，而是马上重定向至:  <a href="http://login.sina.com.cn/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;_rand=1305008634.5127&amp;gateway=1&amp;service=miniblog&amp;useticket=1&amp;returntype=META" target="_blank">http://login.sina.com.cn/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;_rand=1305008634.5127&amp;gateway=1&amp;service=miniblog&amp;useticket=1&amp;returntype=META</a> 　与cas的做法确实一致。　再看看该 login.php的Response 信息，主要是JS：</li>
</ol>
<p>Js代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><script type="text/javascript" language="javascript">  </li>
<li>location.replace(&quot;<a href="http://weibo.com/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;ticket=ST-MTc4NTc0NzM0Mw==-1305008634-ja-694BA43623A3F72999AE7129A0572048&amp;retcode=0" target="_blank">http://weibo.com/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;ticket=ST-MTc4NTc0NzM0Mw==-1305008634-ja-694BA43623A3F72999AE7129A0572048&amp;retcode=0</a>&quot;);  </li>
<li><p></script><br><script type="text/javascript" language="javascript"> location.replace(&quot;<a href="http://weibo.com/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;ticket=ST-MTc4NTc0NzM0Mw==-1305008634-ja-694BA43623A3F72999AE7129A0572048&amp;retcode=0" target="_blank">http://weibo.com/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;ticket=ST-MTc4NTc0NzM0Mw==-1305008634-ja-694BA43623A3F72999AE7129A0572048&amp;retcode=0</a>&quot;); </script>
   看到这里之后，不得不怀疑 SINA　的 SSO　是不是用的就是 CAS　啊！！不但连 TGT 参数名一样，连ST规则及参数名也一模一样，其处理机制也十分相似。
   到这里之后就与 CAS　的处理一样了，就不详细写了，可以参考 CAS相关文章。
──────────
PS:由于在分析过程中里面的很多SSO关键JS都压缩了，所以难免会存在误差。　不过SINA的SSO很多细节方面确实处理的很好，作为互联网应用的话，如果单纯的只是把 CAS　DOWNLOAD　下来，然后直接配配就用的话很多方面的处理还是很不到位的。　有时间我把我们CAS参考 SINA　调整一下。
  到这里，不得不说的一个事情就是，之前在<a href="http://www.iteye.com/topic/1000776" target="_blank">分析淘宝cookie如何跨域获取</a>时，大家都说出了一个taobao的jsonp实际存在一定的安全隐患。后面那个淘宝的GG看到之后加入Refer的判断。而现在，在分析的过程中发现新浪也有这样的问题，可以尝试一下，随便在本地建立一个html，引入jquery，然后使用下面的JS，就可以获取到sina中的登录邮箱名等信息，前提是你需要先在sina中登录：
Js代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
</li>
<li><p>$.ajax({url: &#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=0&amp;callback=?&amp;retcode=0" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=0&amp;callback=?&amp;retcode=0</a>&#39;, dataType:&#39;jsonp&#39;,  </p>
</li>
<li>success:function(data){  </li>
<li>alert(data.userinfo.userid);  </li>
<li>}});<br>$.ajax({url: &#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=0&amp;callback=?&amp;retcode=0" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=0&amp;callback=?&amp;retcode=0</a>&#39;, dataType:&#39;jsonp&#39;, success:function(data){ alert(data.userinfo.userid); }});</li>
</ol>
<ul>
<li><a href="http://dl.iteye.com/upload/attachment/0047/8286/31cd9585-6269-3a37-b8f4-2b8d02e4729a.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></li>
<li><p>大小: 50.6 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8303/e1584505-a33b-31f0-bd37-45d01091e95e.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 26.4 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8305/d4482ff9-9dc3-3ac5-ad7d-c7f994f30ed3.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 37.5 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8580/77c647c4-5c36-3dcd-910f-c90a201cfe71.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 40 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8597/7f3a898c-6211-3cdd-acfe-f940615a73e8.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 134.6 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8602/966dd896-d63f-3622-b78c-ee23370baaed.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 56 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8608/30cd2444-e47c-3b5c-876f-e357a5a617f3.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 29 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8615/ddda1c2e-b441-3e66-930f-6c06a2d2bfa1.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 35.9 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8620/f660b8c0-67b0-31c0-ae8c-27fa88491198.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 103.5 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8636/77438b2b-c573-3bba-8853-682ecdd3380d.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 110.8 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/9000/e43d4e20-665b-342e-a693-62bd388c9597.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 134.6 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/9002/61d8dccb-90d7-3c8e-b9c0-d58bd48c902e.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 85.2 KB</p>
</li>
<li><p><a href="http://www.iteye.com/topic/1039052#" target="_blank">查看图片附件</a></p>
</li>
</ul>
<p>声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。
推荐链接</p>
<ul>
<li><a href="http://www.iteye.com/clicks/716" target="_blank">想进外企，出国，跳槽，找工作？英语不好,快来充电吧</a></li>
<li><a href="http://www.iteye.com/clicks/609"></a></li>
<li><a href="http://www.iteye.com/clicks/770" target="_blank">世界级研发人员汇聚深圳！</a> <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://denger.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://denger.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=denger" title="发送站内短信" target="_blank"> </a> <a href="http://denger.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=denger" title="关注作者" target="_blank"> </a>  * 苍山洱海</li>
<li>等级: 初级会员</li>
<li><a href="http://yangkun0318-126-com.iteye.com/" target="_blank"><img src="&quot;苍山洱海的博客: &quot;" alt="苍山洱海的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 95</li>
<li>积分: 0</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-10  </li>
</ul>
<p>好文章。分析的很详实。慢慢看。 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://yangkun0318-126-com.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://yangkun0318-126-com.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=%E8%8B%8D%E5%B1%B1%E6%B4%B1%E6%B5%B7" title="发送站内短信" target="_blank"> </a> <a href="http://yangkun0318-126-com.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=%E8%8B%8D%E5%B1%B1%E6%B4%B1%E6%B5%B7" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2095803" title="苍山洱海回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * ln1058</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://ln1058.iteye.com/" target="_blank"><img src="&quot;ln1058的博客: 这是一段很长很长的旅程,流尽所有的泪水永无止境,我奋力地穿越苦惘和迷墙,在我的路上寻找生命的意义... &quot;" alt="ln1058的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 43</li>
<li>积分: 40</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>我怎么觉得没必要这么麻烦呢。
如果是我来做，直接通过cookie来判断用户是否为登录状态，然后在进行相关的URL跳转。
这种网站对于用户的安全性都不高，真有必要这么麻烦吗？ <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://ln1058.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://ln1058.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=ln1058" title="发送站内短信" target="_blank"> </a> <a href="http://ln1058.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=ln1058" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096212" title="ln1058回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * denger</p>
<ul>
<li>等级: <img src="&quot;四星会员&quot;" alt="四星会员"></li>
<li><a href="http://denger.iteye.com/" target="_blank"><img src="&quot;denger的博客: Coding for fun.      &quot;" alt="denger的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 176</li>
<li>积分: 400</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-11   最后修改：2011-05-11</li>
</ul>
<p>ln1058 写道</p>
<p>我怎么觉得没必要这么麻烦呢。
如果是我来做，直接通过cookie来判断用户是否为登录状态，然后在进行相关的URL跳转。
实际上说起来确实是这样，CAS和SINA也是这样的，直接从cookie判断用户是否已经登录，如果已经登录进行相关 URL的跳转。但是，cookie只会存储在一个域名下(login.sina.com.cn) ， sina很多方面都采用 AJAX/JSONP　或 iframe　的方式，因为基本上全部都是跨全域的&quot;AJAX&quot;方式登录的，所以很多地方处理起来并不是那么方便。
另外一个还要考虑的SSO的灵活和通用信，一个的系统或新的域名整合过来，增加或修改达到最少，这些在设计SSO中都是需要考虑、封装的，而sina这方面确实封装的还可以，整个SSO的处理逻辑也很清楚。他参考了CAS的设计方案或者说直接使用的就是CAS然后进行二次开发的。
引用</p>
<p>这种网站对于用户的安全性都不高，真有必要这么麻烦吗？
新浪有着上亿的微博用户噢....　就你一句话说他安全性不高，他就不高了？ <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://denger.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://denger.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=denger" title="发送站内短信" target="_blank"> </a> <a href="http://denger.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=denger" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096237" title="denger回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * fangin</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://fangin.iteye.com/" target="_blank"><img src="&quot;fangin的博客: &quot;" alt="fangin的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 52</li>
<li>积分: 30</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>ln1058 写道</p>
<p>我怎么觉得没必要这么麻烦呢。
如果是我来做，直接通过cookie来判断用户是否为登录状态，然后在进行相关的URL跳转。
这种网站对于用户的安全性都不高，真有必要这么麻烦吗？
你不能因为用户禁用cookie就登陆不上去啊 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://fangin.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://fangin.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=fangin" title="发送站内短信" target="_blank"> </a> <a href="http://fangin.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=fangin" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096261" title="fangin回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * denger</p>
<ul>
<li>等级: <img src="&quot;四星会员&quot;" alt="四星会员"></li>
<li><a href="http://denger.iteye.com/" target="_blank"><img src="&quot;denger的博客: Coding for fun.      &quot;" alt="denger的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 176</li>
<li>积分: 400</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-11   最后修改：2011-05-11</li>
</ul>
<p>fangin 写道</p>
<p>ln1058 写道</p>
<p>我怎么觉得没必要这么麻烦呢。
如果是我来做，直接通过cookie来判断用户是否为登录状态，然后在进行相关的URL跳转。
这种网站对于用户的安全性都不高，真有必要这么麻烦吗？
你不能因为用户禁用cookie就登陆不上去啊
你说的没错，不过遗憾的是 sina当你禁用了cookie你确实登录不上去。貌似连iteye也是这样。 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://denger.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://denger.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=denger" title="发送站内短信" target="_blank"> </a> <a href="http://denger.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=denger" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096274" title="denger回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * aweber</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://aweber.iteye.com/" target="_blank"><img src="&quot;aweber的博客: &quot;" alt="aweber的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 3</li>
<li>积分: 30</li>
<li>来自: 福建</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>亮点是 iframe调用父窗口js函数的解决方法。居然在当前域名下整了一个跳转页面，在跳转页面里面调用父窗口地址。NB。
我之前都是 在子iframe里面再包含一个iframe，简称孙iframe，孙iframe和父窗口同域名，也就是跳转页面，在孙iframe里面调用父窗口的函数 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://aweber.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://aweber.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=aweber" title="发送站内短信" target="_blank"> </a> <a href="http://aweber.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=aweber" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096367" title="aweber回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * xiang37</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://xiva.iteye.com/" target="_blank"><img src="&quot;xiang37的博客: 一步既出，无需罣碍，前行便是&quot;" alt="xiang37的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 22</li>
<li>积分: 40</li>
<li>来自: 南京</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>支持一个，最近在研究sso，现在想先做个cas的实例出来。 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://xiva.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://xiva.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=xiang37" title="发送站内短信" target="_blank"> </a> <a href="http://xiva.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=xiang37" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096404" title="xiang37回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * tengfei3003</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://tengfei3003.iteye.com/" target="_blank"><img src="&quot;tengfei3003的博客: tengfei3003&quot;" alt="tengfei3003的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 9</li>
<li>积分: 40</li>
<li>来自: 南京</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>分析透彻，好好研究研究 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://tengfei3003.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://tengfei3003.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=tengfei3003" title="发送站内短信" target="_blank"> </a> <a href="http://tengfei3003.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=tengfei3003" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096616" title="tengfei3003回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * jeho0815</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://jeho0815.iteye.com/" target="_blank"><img src="&quot;jeho0815的博客: &quot;" alt="jeho0815的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 21</li>
<li>积分: 30</li>
<li>来自: 深圳</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>看的有点困难啊，实力太差了！ <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://jeho0815.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://jeho0815.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=jeho0815" title="发送站内短信" target="_blank"> </a> <a href="http://jeho0815.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=jeho0815" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2097028" title="jeho0815回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票</p>
<p>« 上一页 1 <a href="http://www.iteye.com/topic/1039052?page=2" target="_blank">2</a> <a href="http://www.iteye.com/topic/1039052?page=3" target="_blank">3</a> <a href="http://www.iteye.com/topic/1039052?page=2" target="_blank">下一页 »</a>
<a href="http://www.iteye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.iteye.com/forums/board/Java" target="_blank">Java企业应用版</a>
跳转论坛:移动开发技术 Web前端技术 Java企业应用 编程语言技术 综合技术 入门技术 招聘求职 海阔天空</p>
<ul>
<li><a href="http://www.iteye.com/jobs/2137" title="吉林:用友汽车软件诚聘高级Java工程师工作地点：长春、北京" target="_blank">吉林: 用友汽车软件诚聘高级Java工程师工作地点：长</a></li>
<li><a href="http://www.iteye.com/jobs/2144" title="广东:用友汽车软件诚聘中级JAVA工程师 工作地点：广州" target="_blank">广东: 用友汽车软件诚聘中级JAVA工程师 工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2343" title="上海:宝尊电商诚聘JAVA中级软件工程师" target="_blank">上海: 宝尊电商诚聘JAVA中级软件工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2426" title="北京:都乐保诚聘Java高级开发工程师" target="_blank">北京: 都乐保诚聘Java高级开发工程师</a></li>
<li><a href="http://www.iteye.com/jobs/1144" title="陕西:ThoughtWorks诚聘西安Senior Java Application Developer" target="_blank">陕西: ThoughtWorks诚聘西安Senior Java Applicatio</a></li>
<li><a href="http://www.iteye.com/jobs/2078" title="上海:用友汽车软件诚聘项目经理" target="_blank">上海: 用友汽车软件诚聘项目经理</a></li>
<li><a href="http://www.iteye.com/jobs/2106" title="上海:爱可生技术诚聘高级JAVA工程师" target="_blank">上海: 爱可生技术诚聘高级JAVA工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2141" title="上海:用友汽车软件诚聘初级java开发工程师（UAP平台）" target="_blank">上海: 用友汽车软件诚聘初级java开发工程师（UAP平</a></li>
<li><a href="http://www.iteye.com/jobs/2344" title="上海:宝尊电商诚聘JAVA高级软件工程师" target="_blank">上海: 宝尊电商诚聘JAVA高级软件工程师</a></li>
<li><a href="http://www.iteye.com/jobs/1628" title="浙江:阿里巴巴诚聘高级Java工程师" target="_blank">浙江: 阿里巴巴诚聘高级Java工程师</a></li>
<li><a href="http://www.iteye.com/jobs/1849" title="浙江:阿里巴巴诚聘C++开发工程师(搜索引擎和广告引擎方向，偏底层)" target="_blank">浙江: 阿里巴巴诚聘C++开发工程师(搜索引擎和广告</a></li>
<li><a href="http://www.iteye.com/jobs/2136" title="吉林:用友汽车软件诚聘java开发工程师 工作地点：长春、北京" target="_blank">吉林: 用友汽车软件诚聘java开发工程师 工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2143" title="上海:用友汽车软件诚聘中级java程序员（工作地点：上海安亭）" target="_blank">上海: 用友汽车软件诚聘中级java程序员（工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2064" title="上海:用友汽车软件诚聘高级Java程序员" target="_blank">上海: 用友汽车软件诚聘高级Java程序员</a></li>
<li><a href="http://www.iteye.com/jobs/2427" title="北京:都乐保诚聘Java开发工程师" target="_blank">北京: 都乐保诚聘Java开发工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2321" title="云南:云南远信诚聘高级软件工程师(J2EE) " target="_blank">云南: 云南远信诚聘高级软件工程师(J2EE)</a></li>
<li><a href="http://www.iteye.com/jobs/2140" title="上海:用友汽车软件诚聘高级java开发工程师（UAP平台）" target="_blank">上海: 用友汽车软件诚聘高级java开发工程师（UAP平</a></li>
<li><a href="http://www.iteye.com/jobs/2437" title="广东:★路人甲★诚聘高级Java程序员 广州" target="_blank">广东: ★路人甲★诚聘高级Java程序员 广州</a></li>
<li><a href="http://www.iteye.com/jobs/2297" title="云南:云南远信诚聘软件工程师（Java）" target="_blank">云南: 云南远信诚聘软件工程师（Java）</a></li>
<li><p><a href="http://www.iteye.com/jobs/2358" title="浙江:全麦电子商务诚聘J2EE系统架构师" target="_blank">浙江: 全麦电子商务诚聘J2EE系统架构师</a></p>
</li>
<li><p><a href="http://www.iteye.com/" target="_blank">首页</a></p>
</li>
<li><a href="http://www.iteye.com/news" target="_blank">资讯</a></li>
<li><a href="http://www.iteye.com/magazines" target="_blank">精华</a></li>
<li><a href="http://www.iteye.com/forums" target="_blank">论坛</a></li>
<li><a href="http://www.iteye.com/ask" target="_blank">问答</a></li>
<li><a href="http://www.iteye.com/blogs" target="_blank">博客</a></li>
<li><a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a></li>
<li><a href="http://www.iteye.com/groups" target="_blank">群组</a></li>
<li><a href="http://www.iteye.com/job" target="_blank">招聘</a></li>
<li><a href="http://www.iteye.com/search" target="_blank">搜索</a></li>
<li><a href="http://www.iteye.com/index/service" target="_blank">广告服务</a></li>
<li><a href="http://webmaster.iteye.com/" target="_blank">ITeye黑板报</a></li>
<li><a href="http://www.iteye.com/index/contactus" target="_blank">联系我们</a></li>
<li><a href="http://www.iteye.com/index/friend_links" target="_blank">友情链接</a></li>
</ul>
<p>© 2003-2012 ITeye.com. [ <a href="http://www.miibeian.gov.cn/" target="_blank">京ICP证110151号</a> 京公网安备110105010620 ]
百联优力(北京)投资有限公司 版权所有 <img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--新浪微博如何实现SSO的分析-企业应用-Java-ITeye论坛/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--新浪微博如何实现SSO的分析-企业应用-Java-ITeye论坛" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--单点登录CASServer介绍-Java综合-Java-ITeye论坛/">单点登录CAS Server 介绍 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--单点登录CASServer介绍-Java综合-Java-ITeye论坛/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-cas-server-java-java-iteye-">单点登录CAS Server 介绍 - Java综合 - Java - ITeye论坛</h1>
<p><a href="http://www.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/login" target="_blank">登录</a> <a href="http://www.iteye.com/signup" target="_blank">注册</a></p>
<p><a href="http://www.iteye.com/" target="_blank"><img src="&quot;ITeye-最棒的软件开发交流社区&quot;" alt="ITeye-最棒的软件开发交流社区"></a></p>
<p><a href="http://www.iteye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.iteye.com/forums/board/Java" target="_blank">Java企业应用论坛</a> →</p>
<h1 id="-cas-server-">单点登录CAS Server 介绍</h1>
<p><a href="http://www.iteye.com/forums/board/Java" target="_blank">全部</a> <a href="http://www.iteye.com/forums/tag/Hibernate" target="_blank">Hibernate</a> <a href="http://www.iteye.com/forums/tag/Spring" target="_blank">Spring</a> <a href="http://www.iteye.com/forums/tag/Struts" target="_blank">Struts</a> <a href="http://www.iteye.com/forums/tag/iBATIS" target="_blank">iBATIS</a> <a href="http://www.iteye.com/forums/tag/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8" target="_blank">企业应用</a> <a href="http://www.iteye.com/forums/tag/Lucene" target="_blank">Lucene</a> <a href="http://www.iteye.com/forums/tag/SOA" target="_blank">SOA</a> <a href="http://www.iteye.com/forums/tag/Java%E7%BB%BC%E5%90%88" target="_blank">Java综合</a> <a href="http://www.iteye.com/forums/tag/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" target="_blank">设计模式</a> <a href="http://www.iteye.com/forums/tag/Tomcat" target="_blank">Tomcat</a> <a href="http://www.iteye.com/forums/tag/OO" target="_blank">OO</a> <a href="http://www.iteye.com/forums/tag/JBoss" target="_blank">JBoss</a>
浏览 3057 次 锁定老帖子 <a href="">主题：单点登录CAS Server 介绍</a></p>
<p>精华帖 (0) :: 良好帖 (0) :: 新手帖 (2) :: 隐藏帖 (0) 作者 正文 * boli.jiang</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://bolijiang.iteye.com/" target="_blank"><img src="&quot;boli.jiang的博客: 天天向上&quot;" alt="boli.jiang的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 3</li>
<li>积分: 40</li>
<li>来自: 成都</li>
<li><img src="" alt="">
  发表时间：2010-04-22   最后修改：2010-04-23</li>
</ul>
<p><a href="http://www.iteye.com/topic/650595#" target="_blank">&lt;</a> <a href="http://www.iteye.com/topic/650595#" target="_blank">&gt;</a>  猎头职位: <a href="http://www.iteye.com/jobs/2245" target="_blank">上海:  【上海】外资企业高新诚聘web开发工程师</a></p>
<p>相关文章: <a href="http://www.iteye.com/topic/650595#" title="关闭" target="_blank"> </a></p>
<ul>
<li><a href="http://www.iteye.com/topic/257036" title="CAS与LDAP整合的实现" target="_blank">CAS与LDAP整合的实现</a></li>
<li><a href="http://www.iteye.com/topic/87654" title="扩展cas验证系统自己又一些小小的疑问请教大家!" target="_blank">扩展cas验证系统自己又一些小小的疑问请教大家!</a></li>
<li><a href="http://www.iteye.com/topic/544899" title="【原创】CAS调研总结" target="_blank">【原创】CAS调研总结</a>
推荐群组: <a href="http://liferay.group.iteye.com/" target="_blank">liferay</a>
<a href="http://www.iteye.com/wiki/topic/650595" target="_blank">更多相关推荐</a>
<a href="http://www.iteye.com/forums/tag/Java%E7%BB%BC%E5%90%88" target="_blank">Java综合</a></li>
</ul>
<p>下面的讲解基于CAS Server 3.3.5版本。</p>
<p>CAS Server 配置文件</p>
<p>login-webflow.xml：其中内容指定了当访问cas/login时的程序流程，初始“initialFlowSetup”</p>
<p>cas-servlet.xml：servlet与class对应关系</p>
<p>deployerConfigContext.xml：认证管理器相关</p>
<p>cas.properties：系统属性设置</p>
<p>applicationContext.xml：系统属性相关</p>
<p>argumentExtractorsConfiguration.xml：不是很了解它的用途</p>
<p>ticketExpirationPolicies.xml：ticket过期时间设置</p>
<p>ticketGrantingTicketCookieGenerator.xml：TGT cookie属性相关，是否支持http也在这儿修改</p>
<p>ticketRegistry.xml：保存ticket的类相关设置</p>
<p>uniqueIdGenerators.xml：ticket自动生成类设置</p>
<p>warnCookieGenerator.xml：同ticketGrantingTicketCookieGenerator.xml，生成的 cookie名为CASPRIVACY</p>
<p><strong>/login</strong> ：</p>
<p>当访问/login时，会调用login-webflow.xml中的流程图：</p>
<p><a href=""><img src="&quot;点击查看原始大小图片&quot;" alt="">
 </a></p>
<p><strong>/serviceValidate:</strong></p>
<p>对应的处理类是org.jasig.cas.web.ServiceValidateController，主要负责对service ticket的验证，失败返回casServiceValidationFailure.jsp，成功返回casServiceValidationSuccess.jsp</p>
<p>对service ticket的验证是通过client端向server端发送http（或https）实现的</p>
<p>逻辑：</p>
<p>1.通过由client端传来的ticket到DefaultTicketRegistry中获取缓存的ServiceTicketImpl对象，并判断其是否已经过期（ST过期时间默认是5分钟，TGT默认是2个小时，可以在ticketExpirationPolicies.xml中进行修改）以及与当前service的id是否相一，以上都满足则表示验证通过。</p>
<p>2.通过ServiceTicketImpl对象获取到登录之后的Authentication对象，借助于它生成ImmutableAssertionImpl对象并返回</p>
<p>3.成功返回</p>
<p><strong>CAS数据流程</strong></p>
<p>Credentials--&gt;Principal--&gt;Authentication</p>
<p><strong>定义自己的AuthenticationHandler</strong></p>
<p>在中心认证进行认证的过程中会调用deployerConfigContext.xml中设置的AuthenticationHandler来进行认证工作。
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><property name="authenticationHandlers">  </li>
<li><list>  </li>
<li>&lt;!--  </li>
<li></li>
<li>This is the authentication handler that authenticates services by means of callback via SSL, thereby validating  </li>
<li></li>
<li>a server side SSL certificate.  </li>
<li>--&gt;  </li>
<li>&lt;bean class=&quot;org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler&quot;  </li>
<li>p:httpClient-ref=&quot;httpClient&quot; /&gt;  </li>
<li>&lt;!--  </li>
<li>This is the authentication handler declaration that every CAS deployer will need to change before deploying CAS   </li>
<li>into production.  The default SimpleTestUsernamePasswordAuthenticationHandler authenticates UsernamePasswordCredentials  </li>
<li>where the username equals the password.  You will need to replace this with an AuthenticationHandler that implements your  </li>
<li>local authentication strategy.  You might accomplish this by coding a new such handler and declaring  </li>
<li>edu.someschool.its.cas.MySpecialHandler here, or you might use one of the handlers provided in the adaptors modules.  </li>
<li>--&gt;  </li>
<li>&lt;bean  </li>
<li>class=&quot;org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler&quot; /&gt;  </li>
<li><bean class="com.goldarmor.live800.cas.Live800CasAuthenticationHandler">  </li>
<li><property name="dataSource" ref="casDataSource" />  </li>
<li></bean>  </li>
<li>&lt;/list  </li>
<li><p></property>  </p>
<property name="authenticationHandlers"> <list>  <!-- This is the authentication handler that authenticates services by means of callback via SSL, thereby validating a server side SSL certificate. --> <bean class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler" p:httpClient-ref="httpClient" /> <!-- This is the authentication handler declaration that every CAS deployer will need to change before deploying CAS into production. The default SimpleTestUsernamePasswordAuthenticationHandler authenticates UsernamePasswordCredentials where the username equals the password. You will need to replace this with an AuthenticationHandler that implements your local authentication strategy. You might accomplish this by coding a new such handler and declaring edu.someschool.its.cas.MySpecialHandler here, or you might use one of the handlers provided in the adaptors modules. --> <bean class="org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler" /> <bean class="com.goldarmor.live800.cas.Live800CasAuthenticationHandler"> <property name="dataSource" ref="casDataSource" /> </bean> </list </property>

<p>如上，我们定义了3个AuthenticationHandler，这正是CAS的一个<img src="" alt=""> ，通过配置，我们可以实现针对不同的应用提供不同的认证方式，这样可以实现任意的中心认证。再来看看AuthenticationHandler的代码</p>
</li>
</ol>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>//<em>/</em> </li>
<li>/* Method to determine if the credentials supplied are valid. </li>
<li>/*  </li>
<li>/* @param credentials The credentials to validate. </li>
<li>/* @return true if valid, return false otherwise. </li>
<li>/* @throws AuthenticationException An AuthenticationException can contain </li>
<li>/* details about why a particular authentication request failed. </li>
<li>/*/  </li>
<li></li>
<li>boolean authenticate(Credentials credentials)  </li>
<li>throws AuthenticationException;  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* Method to check if the handler knows how to handle the credentials </li>
<li>/* provided. It may be a simple check of the Credentials class or something </li>
<li>/* more complicated such as scanning the information contained in the </li>
<li>/* Credentials object. </li>
<li>/*  </li>
<li>/* @param credentials The credentials to check. </li>
<li>/* @return true if the handler supports the Credentials, false othewrise. </li>
<li>/*/  </li>
<li><p>boolean supports(Credentials credentials);<br>//<em>/</em> /<em> Method to determine if the credentials supplied are valid. /</em> /<em> @param credentials The credentials to validate. /</em> @return true if valid, return false otherwise. /<em> @throws AuthenticationException An AuthenticationException can contain /</em> details about why a particular authentication request failed. /<em>/ boolean authenticate(Credentials credentials) throws AuthenticationException; //</em>/<em> /</em> Method to check if the handler knows how to handle the credentials /<em> provided. It may be a simple check of the Credentials class or something /</em> more complicated such as scanning the information contained in the /<em> Credentials object. /</em> /<em> @param credentials The credentials to check. /</em> @return true if the handler supports the Credentials, false othewrise. /*/ boolean supports(Credentials credentials);</p>
<p>我们要做的就是实现这俩个方法而已，特别提醒：可以在cas-servlet.xml中设置你所使用的Credentials，如下：（其中的p:formObjectClass值，如果不指定默认使用UsernamePasswordCredentials）</p>
</li>
</ol>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>&lt;bean id=&quot;authenticationViaFormAction&quot; class=&quot;org.jasig.cas.web.flow.AuthenticationViaFormAction&quot;  </li>
<li>p:formObjectClass=&quot;com.goldarmor.live800.cas.Live800CasCredentials&quot;  </li>
<li>p:centralAuthenticationService-ref=&quot;centralAuthenticationService&quot;  </li>
<li>p:warnCookieGenerator-ref=&quot;warnCookieGenerator&quot; /&gt;  <bean id="authenticationViaFormAction" class="org.jasig.cas.web.flow.AuthenticationViaFormAction" p:formObjectClass="com.goldarmor.live800.cas.Live800CasCredentials" p:centralAuthenticationService-ref="centralAuthenticationService" p:warnCookieGenerator-ref="warnCookieGenerator" />



</li>
</ol>
<p><strong>定义自己的credentialsToPrincipalResolvers</strong></p>
<p>通过AuthenticationHandler的认证后，会调用在deployerConfigContext.xml中配置的credentialsToPrincipalResolvers来处理Credentials，生成Principal对象：
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><property name="credentialsToPrincipalResolvers">  </li>
<li><list>  </li>
<li>&lt;!--  </li>
<li>UsernamePasswordCredentialsToPrincipalResolver supports the UsernamePasswordCredentials that we use for /login   </li>
<li>by default and produces SimplePrincipal instances conveying the username from the credentials.  </li>
<li>If you&#39;ve changed your LoginFormAction to use credentials other than UsernamePasswordCredentials then you will also  </li>
<li>need to change this bean declaration (or add additional declarations) to declare a CredentialsToPrincipalResolver that supports the  </li>
<li>Credentials you are using.  </li>
<li>--&gt;              &lt;bean  </li>
<li>class=&quot;org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver&quot; /&gt;  </li>
<li>&lt;!--  </li>
<li>HttpBasedServiceCredentialsToPrincipalResolver supports HttpBasedCredentials.  It supports the CAS 2.0 approach of  </li>
<li>authenticating services by SSL callback, extracting the callback URL from the Credentials and representing it as a  </li>
<li>SimpleService identified by that callback URL.  </li>
<li>If you are representing services by something more or other than an HTTPS URL whereat they are able to  </li>
<li>receive a proxy callback, you will need to change this bean declaration (or add additional declarations).  </li>
<li>--&gt;  </li>
<li>&lt;bean  </li>
<li>class=&quot;org.jasig.cas.authentication.principal.HttpBasedServiceCredentialsToPrincipalResolver&quot; /&gt;  </li>
<li><bean class="com.goldarmor.live800.cas.Live800CasCredentialsToPrincipalResolver"/>  </li>
<li></list>  </li>
<li><p></property>  </p>
<property name="credentialsToPrincipalResolvers"> <list> <!-- UsernamePasswordCredentialsToPrincipalResolver supports the UsernamePasswordCredentials that we use for /login by default and produces SimplePrincipal instances conveying the username from the credentials. If you've changed your LoginFormAction to use credentials other than UsernamePasswordCredentials then you will also need to change this bean declaration (or add additional declarations) to declare a CredentialsToPrincipalResolver that supports the Credentials you are using. --> <bean class="org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver" /> <!-- HttpBasedServiceCredentialsToPrincipalResolver supports HttpBasedCredentials. It supports the CAS 2.0 approach of authenticating services by SSL callback, extracting the callback URL from the Credentials and representing it as a SimpleService identified by that callback URL. If you are representing services by something more or other than an HTTPS URL whereat they are able to receive a proxy callback, you will need to change this bean declaration (or add additional declarations). --> <bean class="org.jasig.cas.authentication.principal.HttpBasedServiceCredentialsToPrincipalResolver" /> <bean class="com.goldarmor.live800.cas.Live800CasCredentialsToPrincipalResolver"/> </list> </property>

<p>如上：我们也可以像定义AuthenticationHandler一样，可以定义多个credentialsToPrincipalResolvers来处理Credentials，返回你所需要的Principal对象，下面来看看credentialsToPrincipalResolvers的方法：</p>
</li>
</ol>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>//<em>/</em> </li>
<li>/* Turn Credentials into a Principal object by analyzing the information </li>
<li>/* provided in the Credentials and constructing a Principal object based on </li>
<li>/* that information or information derived from the Credentials object. </li>
<li>/*  </li>
<li>/* @param credentials from which to resolve Principal </li>
<li>/* @return resolved Principal, or null if the principal could not be resolved. </li>
<li>/*/  </li>
<li>Principal resolvePrincipal(Credentials credentials);  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* Determine if a credentials type is supported by this resolver. This is </li>
<li>/* checked before calling resolve principal. </li>
<li>/*  </li>
<li>/* @param credentials The credentials to check if we support. </li>
<li>/* @return true if we support these credentials, false otherwise. </li>
<li>/*/  </li>
<li></li>
<li></li>
<li>boolean supports(Credentials credentials);<br>//<em>/</em> /<em> Turn Credentials into a Principal object by analyzing the information /</em> provided in the Credentials and constructing a Principal object based on /<em> that information or information derived from the Credentials object. /</em> /<em> @param credentials from which to resolve Principal /</em> @return resolved Principal, or null if the principal could not be resolved. /<em>/ Principal resolvePrincipal(Credentials credentials); //</em>/<em> /</em> Determine if a credentials type is supported by this resolver. This is /<em> checked before calling resolve principal. /</em> /<em> @param credentials The credentials to check if we support. /</em> @return true if we support these credentials, false otherwise. /*/ boolean supports(Credentials credentials);  </li>
</ol>
<p>在CAS验证的时候，通过访问/serviceValidate可知：验证成功之后返回的casServiceValidationSuccess.jsp中的数据来源于Assertion，下面来看看它的代码：</p>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>List<Authentication> getChainedAuthentications();  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* True if the validated ticket was granted in the same transaction as that </li>
<li>/* in which its grantor GrantingTicket was originally issued. </li>
<li>/*  </li>
<li>/* @return true if validated ticket was granted simultaneous with its </li>
<li>/* grantor&#39;s issuance </li>
<li>/*/  </li>
<li></li>
<li>boolean isFromNewLogin();  </li>
<li></li>
<li></li>
<li>//<em>/</em> </li>
<li>/* Method to obtain the service for which we are asserting this ticket is </li>
<li>/* valid for. </li>
<li>/*  </li>
<li>/* @return the service for which we are asserting this ticket is valid for. </li>
<li>/*/  </li>
<li></li>
<li><p>Service getService();<br>List<Authentication> getChainedAuthentications(); //<em>/</em> /<em> True if the validated ticket was granted in the same transaction as that /</em> in which its grantor GrantingTicket was originally issued. /<em> /</em> @return true if validated ticket was granted simultaneous with its /<em> grantor&#39;s issuance /</em>/ boolean isFromNewLogin(); //<em>/</em> /<em> Method to obtain the service for which we are asserting this ticket is /</em> valid for. /<em> /</em> @return the service for which we are asserting this ticket is valid for. /*/ Service getService();</p>
<p>通过getChainedAuthentications()方法，我们可以得到Authentication对象列表，再看看Authentication的代码：</p>
</li>
</ol>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>//<em>/</em> </li>
<li>/* Method to obtain the Principal. </li>
<li>/*  </li>
<li>/* @return a Principal implementation </li>
<li>/*/  </li>
<li></li>
<li>Principal getPrincipal();  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* Method to retrieve the timestamp of when this Authentication object was </li>
<li>/* created. </li>
<li>/*  </li>
<li>/* @return the date/time the authentication occurred. </li>
<li>/*/  </li>
<li></li>
<li>Date getAuthenticatedDate();  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* Attributes of the authentication (not the Principal). </li>
<li>/* @return the map of attributes. </li>
<li>/*/  </li>
<li><p>Map<String, Object> getAttributes();<br>//<em>/</em> /<em> Method to obtain the Principal. /</em> /<em> @return a Principal implementation /</em>/ Principal getPrincipal(); //<em>/</em> /<em> Method to retrieve the timestamp of when this Authentication object was /</em> created. /<em> /</em> @return the date/time the authentication occurred. /<em>/ Date getAuthenticatedDate(); //</em>/<em> /</em> Attributes of the authentication (not the Principal). /<em> @return the map of attributes. /</em>/ Map<String, Object> getAttributes();</p>
<p>而这其中的Principal就来源于上面提到的由credentialsToPrincipalResolvers处理得到的Principal对象，最后看一下Principal的代码，我们只要再做一个实现他的代码，整个CAS Server就可以信手拈来了，呵呵</p>
</li>
</ol>
<p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>//<em>/</em> </li>
<li>/* Returns the unique id for the Principal </li>
<li>/* @return the unique id for the Principal. </li>
<li>/*/  </li>
<li></li>
<li>String getId();  </li>
<li></li>
<li></li>
<li>//<em>/</em> </li>
<li>/*  </li>
<li>/* @return </li>
<li>/*/  </li>
<li></li>
<li>Map<String, Object> getAttributes();<br>//<em>/</em> /<em> Returns the unique id for the Principal /</em> @return the unique id for the Principal. /<em>/ String getId(); //</em>/<em> /</em> /<em> @return /</em>/ Map<String, Object> getAttributes();</li>
</ol>
<p>我们还可以自定义自己的casServiceValidationSuccess.jsp和casLoginView.jsp页面等，具体的操作办法也是最简单的办法就是备份以前的页面之后修改成自己需要的页面。</p>
<ul>
<li><a href="http://dl.iteye.com/upload/attachment/0023/8503/ccbda995-b8f2-3cfa-9c4c-f7f841391045.jpg" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></li>
<li><p>大小: 150.5 KB</p>
</li>
<li><p><a href="http://www.iteye.com/topic/650595#" target="_blank">查看图片附件</a></p>
</li>
</ul>
<p>声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。
推荐链接</p>
<ul>
<li><a href="http://www.iteye.com/clicks/609"></a></li>
<li><a href="http://www.iteye.com/clicks/716" target="_blank">想进外企，出国，跳槽，找工作？英语不好,快来充电吧</a></li>
<li><a href="http://www.iteye.com/clicks/770" target="_blank">世界级研发人员汇聚深圳！</a> <a href="http://www.iteye.com/topic/650595#" target="_blank">返回顶楼</a> <a href="http://bolijiang.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://bolijiang.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=boli.jiang" title="发送站内短信" target="_blank"> </a> <a href="http://bolijiang.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=boli.jiang" title="关注作者" target="_blank"> </a></li>
</ul>
<p><a href="http://www.iteye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.iteye.com/forums/board/Java" target="_blank">Java企业应用版</a>
跳转论坛:移动开发技术 Web前端技术 Java企业应用 编程语言技术 综合技术 入门技术 招聘求职 海阔天空</p>
<ul>
<li><a href="http://www.iteye.com/jobs/2344" title="上海:宝尊电商诚聘JAVA高级软件工程师" target="_blank">上海: 宝尊电商诚聘JAVA高级软件工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2137" title="吉林:用友汽车软件诚聘高级Java工程师工作地点：长春、北京" target="_blank">吉林: 用友汽车软件诚聘高级Java工程师工作地点：长</a></li>
<li><a href="http://www.iteye.com/jobs/1628" title="浙江:阿里巴巴诚聘高级Java工程师" target="_blank">浙江: 阿里巴巴诚聘高级Java工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2143" title="上海:用友汽车软件诚聘中级java程序员（工作地点：上海安亭）" target="_blank">上海: 用友汽车软件诚聘中级java程序员（工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/1849" title="浙江:阿里巴巴诚聘C++开发工程师(搜索引擎和广告引擎方向，偏底层)" target="_blank">浙江: 阿里巴巴诚聘C++开发工程师(搜索引擎和广告</a></li>
<li><a href="http://www.iteye.com/jobs/2321" title="云南:云南远信诚聘高级软件工程师(J2EE) " target="_blank">云南: 云南远信诚聘高级软件工程师(J2EE)</a></li>
<li><a href="http://www.iteye.com/jobs/2106" title="上海:爱可生技术诚聘高级JAVA工程师" target="_blank">上海: 爱可生技术诚聘高级JAVA工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2136" title="吉林:用友汽车软件诚聘java开发工程师 工作地点：长春、北京" target="_blank">吉林: 用友汽车软件诚聘java开发工程师 工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2140" title="上海:用友汽车软件诚聘高级java开发工程师（UAP平台）" target="_blank">上海: 用友汽车软件诚聘高级java开发工程师（UAP平</a></li>
<li><a href="http://www.iteye.com/jobs/2427" title="北京:都乐保诚聘Java开发工程师" target="_blank">北京: 都乐保诚聘Java开发工程师</a></li>
<li><a href="http://www.iteye.com/jobs/1144" title="陕西:ThoughtWorks诚聘西安Senior Java Application Developer" target="_blank">陕西: ThoughtWorks诚聘西安Senior Java Applicatio</a></li>
<li><a href="http://www.iteye.com/jobs/2144" title="广东:用友汽车软件诚聘中级JAVA工程师 工作地点：广州" target="_blank">广东: 用友汽车软件诚聘中级JAVA工程师 工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2343" title="上海:宝尊电商诚聘JAVA中级软件工程师" target="_blank">上海: 宝尊电商诚聘JAVA中级软件工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2437" title="广东:★路人甲★诚聘高级Java程序员 广州" target="_blank">广东: ★路人甲★诚聘高级Java程序员 广州</a></li>
<li><a href="http://www.iteye.com/jobs/2064" title="上海:用友汽车软件诚聘高级Java程序员" target="_blank">上海: 用友汽车软件诚聘高级Java程序员</a></li>
<li><a href="http://www.iteye.com/jobs/2358" title="浙江:全麦电子商务诚聘J2EE系统架构师" target="_blank">浙江: 全麦电子商务诚聘J2EE系统架构师</a></li>
<li><a href="http://www.iteye.com/jobs/2141" title="上海:用友汽车软件诚聘初级java开发工程师（UAP平台）" target="_blank">上海: 用友汽车软件诚聘初级java开发工程师（UAP平</a></li>
<li><a href="http://www.iteye.com/jobs/2078" title="上海:用友汽车软件诚聘项目经理" target="_blank">上海: 用友汽车软件诚聘项目经理</a></li>
<li><a href="http://www.iteye.com/jobs/2297" title="云南:云南远信诚聘软件工程师（Java）" target="_blank">云南: 云南远信诚聘软件工程师（Java）</a></li>
<li><p><a href="http://www.iteye.com/jobs/2426" title="北京:都乐保诚聘Java高级开发工程师" target="_blank">北京: 都乐保诚聘Java高级开发工程师</a></p>
</li>
<li><p><a href="http://www.iteye.com/" target="_blank">首页</a></p>
</li>
<li><a href="http://www.iteye.com/news" target="_blank">资讯</a></li>
<li><a href="http://www.iteye.com/magazines" target="_blank">精华</a></li>
<li><a href="http://www.iteye.com/forums" target="_blank">论坛</a></li>
<li><a href="http://www.iteye.com/ask" target="_blank">问答</a></li>
<li><a href="http://www.iteye.com/blogs" target="_blank">博客</a></li>
<li><a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a></li>
<li><a href="http://www.iteye.com/groups" target="_blank">群组</a></li>
<li><a href="http://www.iteye.com/job" target="_blank">招聘</a></li>
<li><a href="http://www.iteye.com/search" target="_blank">搜索</a></li>
<li><a href="http://www.iteye.com/index/service" target="_blank">广告服务</a></li>
<li><a href="http://webmaster.iteye.com/" target="_blank">ITeye黑板报</a></li>
<li><a href="http://www.iteye.com/index/contactus" target="_blank">联系我们</a></li>
<li><a href="http://www.iteye.com/index/friend_links" target="_blank">友情链接</a></li>
</ul>
<p>© 2003-2012 ITeye.com. [ <a href="http://www.miibeian.gov.cn/" target="_blank">京ICP证110151号</a> 京公网安备110105010620 ]
百联优力(北京)投资有限公司 版权所有 <img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--单点登录CASServer介绍-Java综合-Java-ITeye论坛/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--单点登录CASServer介绍-Java综合-Java-ITeye论坛" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-绿盟--利用SNMP实现remoteping/">利用SNMP实现remote ping</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-绿盟--利用SNMP实现remoteping/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-snmp-remote-ping">利用SNMP实现remote ping</h1>
<p><a href=""></a> <a href="http://www.nsfocus.com/"><img src="" alt="Logo of NSFOCUS"></a> <a href="http://www.nsfocus.com/en/index.html" target="_blank"><img src="" alt="English Version"></a>  <a href="http://www.nsfocus.com/index.html" target="_blank"><img src="" alt="Chinese Version"></a>  <a href="http://www.nsfocus.com/jp/index.html" target="_blank"><img src="" alt="Japanese Version"></a> <a href="http://weibo.com/nsfocus" target="_blank"><img src="" alt=""></a> <img src="" alt=""> <a href="http://www.nsfocus.com/" target="_blank"><img src="" alt=""></a> <a href="http://www.nsfocus.com/1_solution/" target="_blank"><img src="" alt="产品与解决方案"></a> <a href="http://www.nsfocus.com/2_services/" target="_blank"><img src="" alt="专业服务"></a> <a href="http://support.nsfocus.com/" target="_blank"><img src="" alt="客户支持"></a> <a href="http://www.nsfocus.net/" target="_blank"><img src="" alt="安全研究"></a> <a href="http://www.nsfocus.com/5_careers/" target="_blank"><img src="" alt="工作机会"></a> <a href="http://www.nsfocus.com/6_about/" target="_blank"><img src="" alt="关于我们"></a> <img src="" alt="">   <img src="" alt="">  <a href="http://www.nsfocus.net/index.php?act=sec_bug" target="_blank">安全漏洞</a>    <a href="http://www.nsfocus.net/index.php?act=sec_news" target="_blank">业界动态</a>    <a href="http://www.nsfocus.net/index.php?act=alert" target="_blank">紧急通告</a>    <a href="http://www.nsfocus.net/index.php?act=advisory" target="_blank">研究成果</a>    <a href="http://www.nsfocus.com/4_research/4_5.html" target="_blank">研究机构</a>  <a href="http://www.nsfocus.com/4_research/4_6.html" target="_blank">安全视角</a>  <img src="" alt=""> <img src="" alt="">   绿盟安全月刊-&gt;<a href="http://www.nsfocus.net/index.php?act=magazine&amp;do=one&amp;periodical=56" target="_blank">第56期</a>-&gt;<a href="http://www.nsfocus.net/index.php?act=magazine&amp;do=search&amp;periodical=56&amp;kind_id=4" target="_blank">技术专题</a> 期刊号：  --全部--第57期第56期第55期第54期第53期第52期第51期第50期第49期第48期第47期第46期第45期第44期第43期第42期第41期第40期第39期第38期第37期第36期第35期第34期第33期第32期第31期第30期第29期第28期第27期第26期第25期第24期第23期第22期第21期第20期第19期第18期第17期第16期第15期第14期第13期第12期第11期第10期第9期第8期第7期第6期第5期第4期第3期第2期第1期  类型：  --全部--业界动态安全新闻最新漏洞技术专题工具介绍安全文摘专题报道安全资源  关键词：  <strong>利用snmp实现remote ping</strong>
作者：Yiming Gong
出处：<a href="http://www.nsfocus.com" target="_blank">http://www.nsfocus.com</a>
主页：<a href="http://security.zz.ha.cn" target="_blank">http://security.zz.ha.cn</a>
日期：2005-02-04
声明:摘抄请保留上述作者和http地址
CNNOG1上我的ppt稿子中第18页的snmp部分引来了几封邮件，问该页的内容是什么意思，一次次的回答比较麻烦，干脆写个小东西说明一下。
先把ppt中该页内容引用如下（有细微改动）：
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.16.333 integer 6 //<em>ciscoPingEntryStatus
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.16.333 integer 5
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.15.333 s &quot;yiming&quot;
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.2.333 integer 1 / /</em>ciscoPingProtocol
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.3.333 x &quot;DB 96 20 C5&quot;
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.6.333 integer 1000 //<em>ciscoPingPacketTimeout
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.4.333 integer 10 //</em>&quot;ciscoPingPacketCount
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.5.333 integer 111 //<em>ciscoPingPacketSize
? snmpset -v 1 -c 100wxs9dj 219.150.128.1 .1.3.6.1.4.1.9.9.16.1.1.1.16.333 i 1
? snmpwalk -v 1 -c private 192.168.1.1 1.3.6.1.4.1.9.9.16.1.1.1.12.333  //</em>ciscoPingAvgRtt
上述snmp命令实际上最终实现的是remote ping功能，ping我们都很熟悉，但什么是remote ping?
在拥有自己网络的企业内，尤其是大型的ISP，网络维护的工作中一般都有一项固定任务：“测算几台路由器之间时延和丢包率”。通常是每天定时登录到路由器，在路由器而非管理终端（此即remote）上面执行ping（或扩展ping）命令测量到其它router或指定地址的时延和丢包并将结果记录，进行后期的各种分析比较工作。
为完成上述需求，如果不使用这个ppt里面谈到的方法，有3种选择：
/<em>一种是笨办法，管理员每天定时从管理终端挨个telnet/ssh到路由器上，手工执行ping（或扩展ping）命令，并copy回结果，这个法子比较麻烦。
/</em>方法2是通过expect之类的东西来写脚本，并设置cron等代替管理员定时登录路由器执行命令并取回数据，这个法子也不错，就是对管理员的编程有一些要求。
/*方法3最简单，就是买商用的hpopenview之类支持remote ping的工具，不过感觉这个有点夸张。
实际上除了这三种方法以外，对于国内广泛使用的cisco的设备来说，还有不花钱又简单的方法，就是利用它自己的ping mib。
除了这个MIB外，我们还需要snmp的工具，当然可以选择商用的solarwind之类的东西，但是对于看此文的读者来说开源的NETSNMP应该是方便自己定制的不二选择。
然后就是snmp 通讯字串了，本例子里面以private表示。
最后是router的ip,本例子中以192.168.1.1表示。
打个茬，我之所以突然对这个remote ping感兴趣，就是因为前一段一个电信的朋友问有没有HP openview，他需要里面的rping模块来对他们省内的routers做remote ping，我手头自然是不会有这个了，但是感觉不至于非要商用的产品才能搞这个事情吧。好奇之下就在cisco的网站狂扒了一阵，先是找到了一篇cisco的Ping MIB Implementation文档，可惜如法炮制后发现不好使，后来发现是cisco的文档写错了，这是后话不提。不过这个文档中提到了cisco自己的私有mib, CISCO-PING-MIB-V1SMI  (参见2)，知道了需要用到这个mib，这个任务就简单了（p.s. SNMP的相关概念请参阅其他文档）
首先要仔细查看CISCO-PING-MIB-V1SMI这个mib文件，搞清楚mib中每个分支的意思，其次为了方便使用命令时快速查找，我们还需要找到对应oid表 (参见3)
在CISCO-PING-MIB-V1SMI.my的开头部分我们看到如下内容：
-- snip --    </p>
<pre><code>    A management station wishing to create an entry should
    first generate a pseudo-random serial number to be used
    as the index to this sparse table.  The station should
    then create the associated instance of the row status
    and row owner objects.  It must also, either in the same
    or in successive PDUs, create the associated instance of
    the protocol and address objects.  It should also modify
    the default values for the other configuration objects
    if the defaults are not appropriate.
</code></pre><p>-- end snip --<br>读懂了这个mib文件，剩下的工作就简单得很了，我们按照对上面ppt的内容逐行解释一下大家立刻就能明白：
首先ciscoPingEntry的oid是1.3.6.1.4.1.9.9.16.1.1.1，如上面所引用内容，我们要先给它建立一个实例，这里随便选一个，333</p>
<ol>
<li>&quot;ciscoPingEntryStatus&quot;    &quot;1.3.6.1.4.1.9.9.16.1.1.1.16&quot;
第一步需要设置ping entry的状态，在mib文件中ciscoPingEntryStatus描述如下
--snip--
ciscoPingEntryStatus OBJECT-TYPE
SYNTAX RowStatus
--    Rsyntax INTEGER {
--        active(1),
--        notInService(2),
--        notReady(3),
--        createAndGo(4),
--        createAndWait(5),
--        destroy(6)
--        }
-- end snip --<br>为了保险起见，我们先destroy(6)以前可能有的实例，这就是ppt中的第一行：
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.16.333 integer 6</li>
<li>然后我们要create这个实例，并等待后面的动作，设置 createAndWait(5), 这就是ppt中的第二行
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.16.333 integer 5</li>
<li>设置一个ciscoPingEntryOwner，这就是ppt中的第三行：
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.15.333 s &quot;yiming&quot;</li>
<li>设置使用IP协议来执行Ping动作，这就是ppt中的第四行：
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.2.333 integer 1</li>
<li>设置ping的destination IP地址，注意目的IP是16进制表示，这就是ppt中的第五行：
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.3.333 x &quot;DB 96 20 C5&quot;</li>
<li>设置超时时间，ppt中的第6行
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.6.333 integer 1000</li>
<li>设置要发出的ping packets数目，ppt中的第7行
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.4.333 integer 10</li>
<li>设置ping包的大小，ppt中的第8行
? snmpset -v 1 -c private 192.168.1.1 .1.3.6.1.4.1.9.9.16.1.1.1.5.333 integer 111</li>
<li>将PingEntryStatus设置为1，激活开始执行命令动作，ppt中的第9行
? snmpset -v 1 -c 100wxs9dj 219.150.128.1 .1.3.6.1.4.1.9.9.16.1.1.1.16.333 i 1</li>
<li>取结果的平均RTT值，ppt中的第10行
? snmpwalk -v 1 -c private 192.168.1.1 1.3.6.1.4.1.9.9.16.1.1.1.12.333
1到9的输出结果不必要copy出来了，这里单把第10个命令的输出结果copy如下：
Yiming/# snmpwalk -v 1 -c private 192.168.1.1 1.3.6.1.4.1.9.9.16.1.1.1.12.333
SNMPv2-SMI::enterprises.9.9.16.1.1.1.12.333 = INTEGER: 28
也就是说从此次测算的router到dst IP的平均RTT是28毫秒。
同样，我们可以对照MIB表查询本次动作的其他各个指标，常见的如
.1.3.6.1.4.1.9.9.16.1.1.1.10.333
.1.3.6.1.4.1.9.9.16.1.1.1.12.333
.1.3.6.1.4.1.9.9.16.1.1.1.14.333 等等等等，
通过这些分支，我们可以得知执行每个实例的最小最大RTT, 接收，发送的报文数等等项目，具体内容大家可以查看这些mib文件的说明，此外我们可以改动实例值和目的IP，同时起n个remote ping的实例，对多个目的地址remote ping，然后将结果导入rrdtools之类的软件，这里就不废话了。<h2 id="-snmp-remote-ping-">本小文只是简单的举了个利用snmp实现remote ping的例子，其实在我们的日常工作中，还有非常多的技术问题等待挖掘，管理员利用开源的东西，自己动手搞一些东西出来，可能会比商用产品起到更好的效果。</h2>
链接：
NETSNMP        <a href="http://www.net-snmp.org/" target="_blank">http://www.net-snmp.org/</a>
CISCO-PING-MIB-V1SMI    ftp://ftp.cisco.com/pub/mibs/v1/CISCO-PING-MIB-V1SMI.my
CISCO-PING-MIB.oid         ftp://ftp-sj.cisco.com/pub/mibs/oid/CISCO-PING-MIB.oid 版权所有，未经许可，不得转载  <a href="http://www.nsfocus.com/7_law/index.html" target="_blank"><img src="" alt="法律声明"></a> <img src="" alt=""> <a href="http://www.nsfocus.com/8_contact/index.html" target="_blank"><img src="" alt="联系我们"></a> <img src="" alt=""> <a href="http://www.nsfocus.net/index.php?act=magazine&amp;do=view&amp;mid=2550#" target="_blank"><img src="" alt="在线客服"></a>   <img src="" alt="©2011 绿盟科技"><a href="http://www.miibeian.gov.cn/" target="_blank"><img src="" alt="京ICP证110355号"></a>      </li>
</ol>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/绿盟/">绿盟</a></li></span></span> | <span class="tags">Tagged <a href="/tags/安全/" class="label label-primary">安全</a><a href="/tags/绿盟/" class="label label-success">绿盟</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-绿盟--利用SNMP实现remoteping/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-绿盟--利用SNMP实现remoteping" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-无线--浅析无线网络数据窥探技术-FreebuFCOM/">浅析无线网络数据窥探技术</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全-无线--浅析无线网络数据窥探技术-FreebuFCOM/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-freebuf-com">浅析无线网络数据窥探技术- FreebuF.COM</h1>
<ul>
<li><a href="http://www.freebuf.com/" target="_blank">首页</a></li>
<li><a href="http://www.freebuf.com/category/news" target="_blank">资讯</a></li>
<li><a href="http://www.freebuf.com/category/tools" target="_blank">工具</a></li>
<li><p><a href="http://www.freebuf.com/category/articles" target="_blank">文章</a></p>
</li>
<li><p><a href="http://www.freebuf.com/category/articles/web" target="_blank">WEB安全</a></p>
</li>
<li><a href="http://www.freebuf.com/category/articles/wireless" target="_blank">无线安全</a></li>
<li><a href="http://www.freebuf.com/category/articles/system" target="_blank">系统安全</a></li>
<li><a href="http://www.freebuf.com/category/articles/database" target="_blank">数据库安全</a></li>
<li><a href="http://www.freebuf.com/category/articles/terminal" target="_blank">终端安全</a></li>
<li><a href="http://www.freebuf.com/category/articles/others-articles" target="_blank">其他</a></li>
<li><a href="http://www.freebuf.com/category/vuls" target="_blank">漏洞</a></li>
<li><a href="http://www.freebuf.com/category/jobs" target="_blank">招聘</a></li>
<li><a href="http://www.freebuf.com/category/others" target="_blank">周边</a></li>
<li><a href="http://plant.freebuf.com/" target="_blank">聚合</a></li>
<li><a href="http://club.freebuf.com/" target="_blank">社区</a></li>
<li><img src="" alt=""><a href="http://www.freebuf.com/newsend" target="_blank">投稿</a></li>
</ul>
<p><a href="http://www.freebuf.com/wp-login.php?redirect_to=http%3A%2F%2Fwww.freebuf.com%2Farticles%2Fwireless%2F5351.html" title="登陆" target="_blank">登陆</a><a href="http://www.freebuf.com/wp-login.php?action=register" target="_blank">注册</a></p>
<p><a href="http://www.freebuf.com/" target="_blank"><img src="" alt="freebuf"></a></p>
<p><a href="http://www.weibo.com/freebuf" title="收听新浪微博" target="_blank">新浪微博</a> <a href="http://t.qq.com/freebuf" title="收听腾讯微博" target="_blank">腾讯微博</a><a href="http://www.freebuf.com/feed" title="订阅我们" target="_blank">订阅我们</a></p>
<p>关于本文作者</p>
<p><img src="" alt=""></p>
<p><a href="http://www.freebuf.com/author/crow" title="由 Crow 发布" target="_blank">Crow</a> <img src="&quot;核心成员&quot;" alt=""> </p>
<p>这家伙很懒，还未填写个人简介</p>
<h3 id="-">浅析无线网络数据窥探技术 <img src="&quot;原创精品&quot;" alt=""></h3>
<p><a href="http://www.freebuf.com/articles/wireless/5351.html#" target="_blank"></a><a href="http://www.freebuf.com/author/crow" title="由 Crow 发布">Crow</a> @ <a href="http://www.freebuf.com/category/articles/wireless" title="查看 无线安全 中的全部文章" target="_blank">无线安全</a> 2012-08-14 共 <strong>976</strong> 人围观 </p>
<p><strong><strong>Author:Crow<em>**</em></strong></strong>Site:<a href="http://www.freebuf.com" target="_blank">http://www.freebuf.com</a> <strong>
</strong></p>
<p><strong>记得几年前,蓝牙一时兴起,当时在十几米的范围内,就可覆盖了很多个蓝牙接入点,那个时候还在上学,上课时无聊,就会找一些蓝牙接入点来恶作剧,后来蓝牙这个东西慢慢的在人们的眼中变得不重要,取而代之的是覆盖到各处的wi-fi网络,各处餐厅,地铁,公司,大街小巷随处可以搜索到不知道从何而来的wi-fi信号,而hacking wifi技术也犹然而生。</strong></p>
<p>这部分的技术大多来自国外翻译文章，技术出处大致相同，但是关于原理问题有些人并不了解，今天就和大家一起分享下hacking wi-fi技术。</p>
<p>Let’s go!!</p>
<p>无线网络可分为<strong>广义无线网络</strong>和<strong>狭义无线网络</strong></p>
<p>广义无线网络包含了大家所熟知的wlan，wpan，wwan</p>
<p>wlan
无线局域网络(Wireless Local Area Networks；WLAN)是相当便利的数据传输系统，它利用射频(Radio Frequency；RF)的技术，取代旧式碍手碍脚的双绞铜线(Coaxial)所构成的局域网络，使得无线局域网络能利用简单的存取架构让用户透过它，达到「信息随身化、便利走天下」的理想境界。</p>
<p>wpan</p>
<p>无线个人局域网通讯技术（WPAN：Wireless Personal Area Network Communication Technologies）其中最典型且被大家熟知的技术包括:Bluetooth(蓝牙)，IrDa(红外)另外还包括ZigBee，UWB，HomeRF等，基于IEEE 802.15.(1-4)。</p>
<p>狭义无线网络既大家常用的IEEE 802.11标准的无线网络，关于802.11的标准及发展，大家可以再百度百科中查询。</p>
<p><strong>无线网络的工作原理</strong></p>
<p>无线网络至少要有一个无线接入点，即AP（Access Point）和一个client（无线客户端）组成，其中AP会将SSID由beacons(信号台)封装并广播，1Mbit/s的速率为1次/100ms。而无线clinet即为可接收这个SSID广播封包的设备，此处可由无线client来决定是否要与此AP发出的信号连接，所以可以选择任意的SSID进行连接。</p>
<p>记得上次，写了一个有关企业内网的文章，其中技术细节并不是很明确，所以今天可以给大家提供一个无线方面的思路，示意图如下：</p>
<p><a href="&quot;FreebuF.COM&quot;"><img src="&quot;20120813011346_15444&quot;" alt="20120813011346_15444"></a></p>
<p>图画的不算太好，大家凑合着看吧</p>
<p>无线安全对于企业安全来说也是尤为重要的一处，现在大多数企业都会采用笔记本作为工作电脑，便携而且对于网络上的分配极为方便。</p>
<p><strong>利用</strong></p>
<p>对于无线上的入侵推荐使用BT5，或者自己使用ubuntu集成aircreak也好。
此处演示基于虚拟机BT5，及USB外置网卡
WEP方式加密现在已经很少了，就此略过，WPA的演示，可参见<a href="http://www.freebuf.com/articles/5012.html" target="_blank"><a href="http://www.freebuf.com/articles/5012.html">http://www.freebuf.com/articles/5012.html</a></a></p>
<p>首先我们先来看下BT5下集成的无线工具，输入air，TAB键</p>
<p><img src="" alt=""></p>
<p>可见aircreak系列的软件已经集成很多，这些足够我们在日常破解使用
Aircreak-ng既集成了破解功能，另外大家还可以使用cowpatty</p>
<p><img src="&quot;3333&quot;" alt=""></p>
<p>OK，现在我们载入无线网卡，iwconfig</p>
<p><img src="&quot;4444&quot;" alt=""></p>
<p>由于网卡类型及驱动的原因，外置载入网卡不一定就是wlan0，当然名字也可以自定义配置。
在使用之前，建议大家先update一下</p>
<p>Airodump-ng-oui-update</p>
<p><img src="" alt=""></p>
<p>下面启动无线网卡</p>
<p>ifconfig ra0 up</p>
<p>激活无线网卡至monitor</p>
<p>airmon-ng start ra0</p>
<p>然后开始一系列的密码破解，由于之前thanks写过此类文章（<a href="http://www.freebuf.com/articles/5012.html" target="_blank">《Wifi Hacking</a><a href="http://www.freebuf.com/articles/5012.html" target="_blank">》</a>），所以这里就不在写了</p>
<p>那么我们要做什么呢？</p>
<p>刚在前面的图中画了了一下AP欺骗的问题
那么下面我们就来抓取数据包，并加以分析</p>
<p>Airodump-ng –c 6 –w crowlog mon0</p>
<p>这里-c是选择接收频道，-w是保存截获数据包名称，后面是网卡</p>
<p>我们也可以对airodump-ng中所示的ssid进行抓包，我这里由于链接无线网的人很少，已经半夜了，所以就不演示了
等抓取了足够的无线网络数据后，就可以Ctrl+C停止了。接下来我们可以使用Cain或者Wireshark来查看数据包了</p>
<p>打开Cain，选择Creaker，点击左侧分类栏的802.11Captures。</p>
<p><img src="&quot;22222&quot;" alt="22222"></p>
<p>右键空白处，Add to list</p>
<p><img src="" alt=""></p>
<p>然后Decode开始解密</p>
<p><img src="" alt=""></p>
<p>此处需要强调一下，破解数据包是需要在破解了无线密码的前提下才可以的</p>
<p><img src="" alt=""></p>
<p><strong>下面输入无线密码即可开始破解</strong></p>
<p>解密完成后，会出现同文件名+dec.cap的文件，将此文件放入wireshark中打开，</p>
<p>然后我们就可以开始分析不过的无线数据破解后的报文啦！</p>
<p>由于我这边抓取来的数据只有几十K，半夜1点钟了，所以就不截图抓取的数据了，感兴趣的朋友可以自己试试。</p>
<p>其中的QQ,MSN,email，登陆用的账号密码都可以看到，这块就要看大家是否细心了。多看看数据包，里面或许有很多有用的东西，如杀毒软件版本，输入法版本等。</p>
<p>这里凡是公开了密码的免费上网区，都是很容易下手的，比如在某咖啡厅，或者某机场，看到有漂亮MM在用笔记本上QQ或者MSN，这个密码基本上都是可知的，不需要费力去破解，然而当知道了密码后，所有弥漫在空中的，看不见的无线信号，便都在自己的掌控之下。抓取他们，得到他们以后。所有的数据便都是自己的了。在或者在公司，密码可知，权限开放，那么无线网段的数据便全部在自己的掌控之中。然而，捕获无线数据的方法有很多种。如固定mac地址捕获数据</p>
<p>aireplay-ng -0 3 –a ap的mac地址–c client的mac地址ra0</p>
<p>deauth攻击模式，来将现有的（指定mac）的无线客户端强制断开，这样客户端就需要重新连接网络，这样我们就会抓到完整的wpa-psk握手验证的数据包了。</p>
<p>Aircrack-ng –w dic cap文件</p>
<p>可以用来破解抓取到的wpa-psk数据报文。</p>
<p>入侵是可以多种多样的，不必拘于一个教程，或者一个工具。</p>
<p>最后，无线网络正大面积覆盖着全世界，并走向各家各户，小到自建的无线基站，大到移动联通的CMCC和WLAN，使越来越多的人处于同一个局域网，而与大家同在一个局域网内的黑客们，便成为了隐秘在无线网络中窥探所有人的幽灵。</p>
<p>(YY一下，刚看完幽灵那个电视剧，穿帮镜头挺多的，引用下这两个字儿吧)</p>
<h3 id="-freebuf-com-http-www-freebuf-com-"><img src="" alt=""> <strong>版权声明：转载请注明出自:</strong> <a href="http://www.freebuf.com/" target="_blank">FreebuF.COM</a></h3>
<ul>
<li><a href="">赞: 3</a></li>
<li><p><a href="">踩: 0</a>
您已评价！</p>
<p>分享到： <a href="http://v.t.sina.com.cn/share/share.php?url=http://www.freebuf.com/articles/wireless/5351.html&amp;title=%E6%B5%85%E6%9E%90%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E7%AA%A5%E6%8E%A2%E6%8A%80%E6%9C%AF" title="分享到新浪微博" target="_blank">新浪微博</a> <a href="http://v.t.qq.com/share/share.php?url=http://www.freebuf.com/articles/wireless/5351.html&amp;title=%E6%B5%85%E6%9E%90%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E7%AA%A5%E6%8E%A2%E6%8A%80%E6%9C%AF" title="分享到腾讯微博" target="_blank">腾讯微博</a> <a href="&quot;分享到豆瓣&quot;">豆瓣</a> <a href="http://share.renren.com/share/buttonshare.do?link=http://www.freebuf.com/articles/wireless/5351.html&amp;title=%E6%B5%85%E6%9E%90%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E7%AA%A5%E6%8E%A2%E6%8A%80%E6%9C%AF" title="分享到人人网" target="_blank">人人网</a> <a href="http://www.kaixin001.com/repaste/share.php?rtitle=%E6%B5%85%E6%9E%90%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E7%AA%A5%E6%8E%A2%E6%8A%80%E6%9C%AF&amp;rurl=http://www.freebuf.com/articles/wireless/5351.html%20title=" target="_blank">开心网</a> <a href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.freebuf.com/articles/wireless/5351.html&amp;title=%E6%B5%85%E6%9E%90%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E7%AA%A5%E6%8E%A2%E6%8A%80%E6%9C%AF" title="分享到QQ空间" target="_blank">QZone</a> <a href="http://facebook.com/share.php?u=http://www.freebuf.com/articles/wireless/5351.html&amp;title=%E6%B5%85%E6%9E%90%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E7%AA%A5%E6%8E%A2%E6%8A%80%E6%9C%AF" title="分享到facebook" target="_blank">facebook</a> <a href="http://twitter.com/share?url==http://www.freebuf.com/articles/wireless/5351.html&amp;title=%E6%B5%85%E6%9E%90%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E7%AA%A5%E6%8E%A2%E6%8A%80%E6%9C%AF" title="分享到twitter" target="_blank">twitter</a></p>
<h3 id="-">相关文章</h3>
</li>
<li><p><a href="">浅析无线网络数据窥探技术</a></p>
</li>
</ul>
<p><strong>9</strong>条评论 <strong>978</strong>人已围观</p>
<ul>
<li><a href="http://www.freebuf.com/tools/5335.html" target="_blank">渗透测试系统 – NETSECLOS V4.0发布</a></li>
</ul>
<p><strong>8</strong>条评论 <strong>1608</strong>人已围观</p>
<ul>
<li><a href="http://www.freebuf.com/articles/system/5265.html" target="_blank">中间人攻击-DNS欺骗</a></li>
</ul>
<p><strong>4</strong>条评论 <strong>1821</strong>人已围观</p>
<ul>
<li><a href="http://www.freebuf.com/articles/5108.html" target="_blank">攻击SharePoint</a></li>
</ul>
<p><strong>5</strong>条评论 <strong>1198</strong>人已围观</p>
<ul>
<li><a href="http://www.freebuf.com/news/5002.html" target="_blank">Skype源代码泄露（附下载地址）</a></li>
</ul>
<p><strong>16</strong>条评论 <strong>12707</strong>人已围观
 ﻿</p>
<h2 id="9-comments-http-www-freebuf-com-articles-wireless-5351-html-respond-">9 Comments <a href="http://www.freebuf.com/articles/wireless/5351.html#respond" target="_blank">发表评论</a></h2>
<ol>
<li><a href="http://www.freebuf.com/?author=4" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/?author=4" target="_blank">thanks </a><img src="&quot;核心成员&quot;" alt=""> (6级) 手提酱油瓶从天而降 <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1916"></a> 2012-08-14</li>
</ol>
<p>nice！
<a href="">支持</a>(2)<a href="">反对</a> (0)
<a href="http://www.freebuf.com/articles/wireless/5351.html?replytocom=1916#respond" target="_blank">回复</a></p>
<ol>
<li><a href="http://www.freebuf.com/?author=252" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/?author=252" target="_blank">Tobe </a> (2级)  <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1917"></a> 2012-08-14</li>
</ol>
<p>请问一下，BT5我之前遇到的问题就是驱动，似乎虚拟机里很多时候会由于HOST主机的网卡驱动问题，导致无法抓到无线包，有实验过在PC/ Mac上安装虚拟机么？
<a href="">支持</a>(0)<a href="">反对</a> (0)
<a href="http://www.freebuf.com/articles/wireless/5351.html?replytocom=1917#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""> Coda <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1919"></a> 2012-08-14</li>
</ul>
<p><a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1917" target="_blank">@Tobe </a>pc/mac上虚拟机里装更麻烦了，需要外置无线网卡。
<a href="">支持</a>(1)<a href="">反对</a> (0)
<a href="http://www.freebuf.com/articles/wireless/5351.html?replytocom=1919#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=252" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/?author=252" target="_blank">Tobe </a> (2级)  <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1922"></a> 2012-08-14</li>
</ul>
<p><a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1919" target="_blank">@Coda</a> 比如什么类型的外置网卡，有推荐么？
<a href="">支持</a>(0)<a href="">反对</a> (0)</p>
<ul>
<li><img src="" alt=""> sunshineg <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1925"></a> 2012-08-14</li>
</ul>
<p><a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1919" target="_blank">@Tobe</a> 跑Pin还是8187L的卡。稳定连接用3070的卡。建议上无线城的卡，做工和质量绝非杂牌山寨可比拟。地址如下：
<a href="http://www.wifly-city.com.tw/" target="_blank"><a href="http://www.wifly-city.com.tw/">http://www.wifly-city.com.tw/</a></a></p>
<p><a href="">支持</a>(1)<a href="">反对</a> (0)</p>
<ul>
<li><a href="http://www.freebuf.com/?author=131" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/?author=131" target="_blank">Crow </a><img src="&quot;核心成员&quot;" alt=""> (5级)  <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1930"></a> 2012-08-14</li>
</ul>
<p><a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1919" target="_blank">@Coda</a>@sunshineg 正解
一般都是用外置的usb无线网卡，我是双无线在做，一个8187，一个rt3072，可以说下，双网卡无线网卡的好处，当你在无线局域网内进行D.O.S攻击后，把另一张网卡加入白名单，然后做无线AP，名字与链接的网络名一样，被攻击人链接不上原有网络，就会来链接伪造的AP，这样的话所有数据都是通过自己的机器走的，想干什么，自己说了算。
<a href="">支持</a>(3)<a href="">反对</a> (0)</p>
<ul>
<li><a href="http://www.freebuf.com/?author=48" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/?author=48" target="_blank">zeracker </a> (1级)  <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1918"></a> 2012-08-14</li>
</ul>
<p>够淫荡，期待超哥的户外渗透 <img src="" alt=":mrgreen:">
<a href="">支持</a>(1)<a href="">反对</a> (0)
<a href="http://www.freebuf.com/articles/wireless/5351.html?replytocom=1918#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""> aaa <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1928"></a> 2012-08-14</li>
</ul>
<p>又是破解无线。。。。
<a href="">支持</a>(0)<a href="">反对</a> (0)
<a href="http://www.freebuf.com/articles/wireless/5351.html?replytocom=1928#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=131" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/?author=131" target="_blank">Crow </a><img src="&quot;核心成员&quot;" alt=""> (5级)  <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1929"></a> 2012-08-14</li>
</ul>
<p><a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1928" target="_blank">@aaa</a>破解无线中的加密数据
<a href="">支持</a>(3)<a href="">反对</a> (0)
<a href="http://www.freebuf.com/articles/wireless/5351.html?replytocom=1929#respond" target="_blank">回复</a>
昵称
(必须)您当前尚未登录。<a href="http://www.freebuf.com/wp-login.php?redirect_to=http%3A%2F%2Fwww.freebuf.com%2Farticles%2Fwireless%2F5351.html" title="登陆" target="_blank">登陆</a>？注册</p>
<p>邮箱
必须(保密)
网址</p>
<p>发表言论前，请滑动滚动条解锁
<a href="">表情</a><a href="">插代码</a><a href="">粗体</a><a href="">斜体</a><a href="">删除线</a><a href="">下划线</a><a href="">引用</a><a href="">链接</a><a href="">插图</a></p>
<p><a href="&quot;mrgreen&quot;"><img src="" alt=""></a><a href="&quot;razz&quot;"><img src="" alt=""></a><a href="&quot;sad&quot;"><img src="" alt=""></a><a href="&quot;smile&quot;"><img src="" alt=""></a><a href="&quot;oops&quot;"><img src="" alt=""></a><a href="&quot;grin&quot;"><img src="" alt=""></a><a href="&quot;eek&quot;"><img src="" alt=""></a><a href="&quot;???&quot;"><img src="" alt=""></a><a href="&quot;cool&quot;"><img src="" alt=""></a><a href="&quot;lol&quot;"><img src="" alt=""></a><a href="&quot;mad&quot;"><img src="" alt=""></a><a href="&quot;twisted&quot;"><img src="" alt=""></a><a href="&quot;roll&quot;"><img src="" alt=""></a><a href="&quot;wink&quot;"><img src="" alt=""></a><a href="&quot;idea&quot;"><img src="" alt=""></a><a href="&quot;arrow&quot;"><img src="" alt=""></a><a href="&quot;neutral&quot;"><img src="" alt=""></a><a href="&quot;cry&quot;"><img src="" alt=""></a><a href="&quot;?&quot;"><img src="" alt=""></a><a href="&quot;evil&quot;"><img src="" alt=""></a><a href="&quot;shock&quot;"><img src="" alt=""></a><a href="&quot;!&quot;"><img src="" alt=""></a>
正在提交, 请稍候...</p>
<p>/#</p>
<p><a href="">取消</a>   有人回复时邮件通知我</p>
<h3 id="-hot-comments-"><strong>热门评论**</strong>Hot Comments**</h3>
<p><a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1929" target="_blank">Crow</a> @ 2012-08-14 11:05:37</p>
<p><a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1928" target="_blank">@aaa</a>破解无线中的加密数据
<a href="">支持</a> (3) <a href="">反对</a> (0) <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1930" target="_blank">Crow</a> @ 2012-08-14 11:09:36</p>
<p><a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1919" target="_blank">@Coda</a>@sunshineg 正解 一般都是用外置的usb无线网卡，我是双无线在做，一个8187，一个rt3072，可以说下，双网卡无线网卡的好处，当你在无线局域网内进行D.O.S攻击后，把另一张网卡加入白名单，然后做无线AP，名字与链接的网络名一样，被攻击人链接不上原有网络，就会来链接伪造的AP，这样的话所有数据都是通过自己的机器走的，想干什么，自己说了算。
<a href="">支持</a> (3) <a href="">反对</a> (0) <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1916" target="_blank">thanks</a> @ 2012-08-14 09:44:29</p>
<p>nice！
<a href="">支持</a> (2) <a href="">反对</a> (0) <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1918" target="_blank">zeracker</a> @ 2012-08-14 10:16:50</p>
<p>够淫荡，期待超哥的户外渗透 <img src="" alt=":mrgreen:">
<a href="">支持</a> (1) <a href="">反对</a> (0) <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1919" target="_blank">Coda</a> @ 2012-08-14 10:20:24</p>
<p><a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1917" target="_blank">@Tobe </a>pc/mac上虚拟机里装更麻烦了，需要外置无线网卡。
<a href="">支持</a> (1) <a href="">反对</a> (0) <a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1925" target="_blank">sunshineg</a> @ 2012-08-14 10:43:02</p>
<p><a href="http://www.freebuf.com/articles/wireless/5351.html#comment-1919" target="_blank">@Tobe</a> 跑Pin还是8187L的卡。稳定连接用3070的卡。建议上无线城的卡，做工和质量绝非杂牌山寨可比拟。地址如下： <a href="http://www.wifly-city.com.tw/" target="_blank">http://www.wifly-city.com.tw/</a>
<a href="">支持</a> (1) <a href="">反对</a> (0)</p>
<h3 id="-new-posts-"><strong>最新发布**</strong>New Posts**</h3>
<ul>
<li><a href="http://www.freebuf.com/news/5378.html" title="卡巴斯基寻民间牛人帮助破解高斯(Gauss)神秘Payload" target="_blank">卡巴斯基寻民间牛人帮助破解高斯(Gauss)神秘Payload</a></li>
<li><a href="http://www.freebuf.com/tools/5369.html" title="盲注（Blind SQL Injection）工具—BBQSQL v1.0.0" target="_blank">盲注（Blind SQL Injection）工具—BBQSQL v1.0.0</a></li>
<li><a href="http://www.freebuf.com/news/5364.html" title="计算机内存在关机后仍会泄露信息" target="_blank">计算机内存在关机后仍会泄露信息</a></li>
<li><a href="http://www.freebuf.com/tools/5361.html" title="34款Firefox渗透测试插件" target="_blank">34款Firefox渗透测试插件</a></li>
<li><a href="http://www.freebuf.com/tools/5363.html" title="BackTrack5 R3发布" target="_blank">BackTrack5 R3发布</a></li>
<li><a href="&quot;浅析无线网络数据窥探技术&quot;">浅析无线网络数据窥探技术</a></li>
<li><a href="http://www.freebuf.com/news/5358.html" title="性骚扰是黑客文化的一部分？" target="_blank">性骚扰是黑客文化的一部分？</a></li>
<li><a href="http://www.freebuf.com/others/5357.html" title="freebuf安全周刊8月6日-8月12日" target="_blank">freebuf安全周刊8月6日-8月12日</a></li>
<li><a href="http://www.freebuf.com/tools/5352.html" title="一个“神奇”的工具：把 JavaScript 代码转为 ()[]{}!+ 字符" target="_blank">一个“神奇”的工具：把 JavaScript 代码转为 ()[]{}!+ 字符</a></li>
<li><a href="http://www.freebuf.com/articles/web/5349.html" title="POST/GET参数名称注射" target="_blank">POST/GET参数名称注射</a>
All of the material and the informations available on freebuf. com is for informative purpose. freebuf.com declines all responsibilities from the damage that may be done of it, consequently it does not encourage who might use it for illegal purposes.</li>
</ul>
<h3 id="freebuf-com">FREEBUF.COM</h3>
<p><a href="http://www.freebuf.com/dis" target="_blank">免责声明</a> <a href="http://www.freebuf.com/others/864.html" target="_blank">关于我们</a> <a href="mailto:freebuf@gmail.com">建议反馈</a> <a href="http://www.freebuf.com/contact" target="_blank">联系我们</a> <a href="http://www.freebuf.com/newsend" target="_blank">我要投稿</a></p>
<p>Copyright @ 2012 WWW.FREEBUF.COM All Rights Reserved <a href=""></a></p>
<p>FreebuF.COM</p>
<p>用户名</p>
<p>密码</p>
<p>Remember Me</p>
<p><a href="http://www.freebuf.com/wp-login.php?action=register" target="_blank">Register</a> | <a href="http://www.freebuf.com/wp-login.php?action=lostpassword" title="Password Lost and Found" target="_blank">Lost your password?</a>
Register</p>
<p>用户名</p>
<p>邮箱</p>
<p>密码(至少6位)</p>
<p>验证码:
看不清？<a href="">点击更换</a></p>
<p><img src="&quot;看不清?点击更换&quot;" alt="看不清?点击更换"></p>
<p><a href="http://www.freebuf.com/wp-login.php" target="_blank">登陆</a> | <a href="http://www.freebuf.com/wp-login.php?action=lostpassword" title="Password Lost and Found" target="_blank">忘记密码？</a>
Reset Password</p>
<p>Username or E-mail:</p>
<p><a href="http://www.freebuf.com/wp-login.php" target="_blank">登陆</a>| <a href="http://www.freebuf.com/wp-login.php?action=register" target="_blank">注册</a>
<a href="http://www.freebuf.com/articles/wireless/5351.html#prev" title="previous" target="_blank"></a><a href="http://www.freebuf.com/articles/wireless/5351.html#next" title="next"></a></p>
<p>prev
next</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/无线/">无线</a></li></span></span> | <span class="tags">Tagged <a href="/tags/安全/" class="label label-primary">安全</a><a href="/tags/无线/" class="label label-success">无线</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-无线--浅析无线网络数据窥探技术-FreebuFCOM/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-无线--浅析无线网络数据窥探技术-FreebuFCOM" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/83/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/81/">81</a></li><li><a class="page-number" href="/page/82/">82</a></li><li><a class="page-number" href="/page/83/">83</a></li><li class="active"><li><span class="page-number current">84</span></li><li><a class="page-number" href="/page/85/">85</a></li><li><a class="page-number" href="/page/86/">86</a></li><li><a class="page-number" href="/page/87/">87</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/85/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 17:47:11</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
