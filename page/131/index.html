
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 131 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-mysql--MYSQL不能从远程连接的一个解决方法/">MYSQL不能从远程连接的一个解决方法</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:34.000Z"> <a href="/2014/02/02/2014-02-02-DB-mysql--MYSQL不能从远程连接的一个解决方法/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="mysql-">MYSQL不能从远程连接的一个解决方法</h1>
<p>所有栏目 服务器 社交网络 电子商务 注册破解 网络资讯 本站作品 搜索引擎 酷站欣赏 安全防护 精品美文 整站程序 入侵检测 精品美图 ASP程序 精美整站 常用技巧 免费空间 架站技术 搜索引擎 PHP程序 新闻文章 免费电影 精美音乐 平面设计 站长心得 .NET程序 精品MV 社区论坛 DIV+CSS 有奖活动 数据库技术 网络常识 其他免费 JSP程序 服务器安全 JavaScript 生活常识 Vbscript VB程序 其他程序  标题 作者 内容</p>
<ul>
<li><a href="http://www.haishui.net/index.php" target="_blank">首页</a></li>
<li><a href="http://www.haishui.net/list.php?tid=53" target="_blank">热点资讯</a></li>
<li><a href="http://www.haishui.net/list.php?tid=12" target="_blank">免费资源</a></li>
<li><a href="http://www.haishui.net/list.php?tid=11" target="_blank">网络编程</a></li>
<li><a href="http://www.haishui.net/list.php?tid=10" target="_blank">站长天地</a></li>
<li><a href="http://www.haishui.net/list.php?tid=16" target="_blank">网页设计</a></li>
<li><a href="http://www.haishui.net/list.php?tid=15" target="_blank">网络安全</a></li>
<li><a href="http://www.haishui.net/list.php?tid=13" target="_blank">精品赏析</a></li>
<li><a href="http://www.haishui.net/list.php?tid=17" target="_blank">程序下载</a></li>
<li><a href="http://www.haishui.net/proxy/index.php" target="_blank">代理IP</a>
<a href="http://www.haishui.net/list.php" target="_blank">死灰复燃那天才会有更新改版！ [08-05-19 14:49:51]</a></li>
</ul>
<p>当前位置：<a href="http://www.haishui.net/index.php" target="_blank">首 页</a> &gt;&gt; <a href="http://www.haishui.net/list.php?tid=10" target="_blank">站长天地</a> &gt;&gt; <a href="http://www.haishui.net/list.php?tid=30" target="_blank">数据库技术</a> &gt;&gt; <a href="http://www.haishui.net/view.php?tid=30&amp;id=483" target="_blank">MYSQL不能从远程连接的一个解决方法</a> <strong>MYSQL不能从远程连接的一个解决方法</strong> 搜集者：海水 发布时间：06-03-13 浏览次数：12483 [<a href="">大</a> <a href="">中</a> <a href="">小</a>] 如果你想连接你的mysql的时候发生这个错误：
以下是引用内容：
ERROR 1130: Host &#39;192.168.1.3&#39; is not allowed to connect to this MySQL server
解决方法：
1。 改表法。可能是你的帐号不允许从远程登陆，只能在localhost。这个时候只要在localhost的那台电脑，登入mysql后，更改 &quot;mysql&quot; 数据库里的 &quot;user&quot; 表里的 &quot;host&quot; 项，从&quot;localhost&quot;改称&quot;%&quot;
mysql -u root -pvmwaremysql&gt;use mysql;mysql&gt;update user set host = &#39;%&#39; where user = &#39;root&#39;;mysql&gt;select host, user from user;</p>
<ol>
<li>授权法。例如，你想myuser使用mypassword从任何主机连接到mysql服务器的话。
GRANT ALL PRIVILEGES ON /<em>./</em> TO &#39;myuser&#39;@&#39;%&#39; IDENTIFIED BY &#39;mypassword&#39; WITH GRANT OPTION;
如果你想允许用户myuser从ip为192.168.1.3的主机连接到mysql服务器，并使用mypassword作为密码
GRANT ALL PRIVILEGES ON /<em>./</em> TO &#39;myuser&#39;@&#39;192.168.1.3&#39; IDENTIFIED BY &#39;mypassword&#39; WITH GRANT OPTION;    相关附件：无  相关文章[MYSQL]：</li>
</ol>
<ul>
<li>[05-10-09] <a href="http://www.haishui.net/view.php?tid=30&amp;id=13" title=" MYSQL 5.0.13 RC发布" target="_blank">MYSQL 5.0.13 RC发布</a></li>
<li>[05-11-23] <a href="http://www.haishui.net/view.php?tid=1&amp;id=165" title="配置最新的PHP加MYSQL服务器" target="_blank">配置最新的PHP加MYSQL服务器</a></li>
<li>[05-12-03] <a href="http://www.haishui.net/view.php?tid=30&amp;id=184" title="MYSQL出错代码列表" target="_blank">MYSQL出错代码列表</a></li>
<li>[06-01-27] <a href="http://www.haishui.net/view.php?tid=39&amp;id=326" title="免费200MB，PHP，MYSQL，CGI，FTP空间" target="_blank">免费200MB，PHP，MYSQL，CGI，FTP空间</a></li>
<li>[06-09-29] <a href="http://www.haishui.net/view.php?tid=30&amp;id=893" title="MYSQL常见出错代码" target="_blank">MYSQL常见出错代码</a> 下一篇：[06-03-13] <a href="http://www.haishui.net/view.php?tid=58&amp;id=484" title="一个馒头引发的血案" target="_blank">一个馒头引发的血案</a> 上一篇：[06-03-13] <a href="http://www.haishui.net/view.php?tid=5&amp;id=482" title="女生教你怎么追MM--送给没有女朋友的朋友" target="_blank">女生教你怎么追MM--送给没有女朋友的朋友</a> 相关评论： 添加评论:  Email: 验证码: <img src="" alt=""> 评论[最多255字节]:</li>
</ul>
<h2 id="-">广告时间</h2>
<h2 id="-">搜索信息</h2>
<p>输入您的搜索字词 站内搜索 网络搜索
提交搜索表单</p>
<h2 id="-">置顶文章</h2>
<h2 id="-">推荐文章</h2>
<h2 id="-">点击排行</h2>
<ul>
<li><a href="http://www.haishui.net/view.php?tid=30&amp;id=719" title="MySQL开发中的外键与参照完整性" target="_blank">MySQL开发中的外键与参照完整性</a></li>
<li><a href="http://www.haishui.net/view.php?tid=30&amp;id=483" title="MYSQL不能从远程连接的一个解决方法" target="_blank">MYSQL不能从远程连接的一个解决方法</a></li>
<li><a href="http://www.haishui.net/view.php?tid=30&amp;id=150" title="SQL Server 2000安装图解" target="_blank">SQL Server 2000安装图解</a></li>
<li><a href="http://www.haishui.net/view.php?tid=30&amp;id=215" title="忘记MySQL密码的更改方法" target="_blank">忘记MySQL密码的更改方法</a></li>
<li><a href="http://www.haishui.net/view.php?tid=30&amp;id=419" title="远程连接sql server 2000服务器的解决方案" target="_blank">远程连接sql server 2000服务器的解决方案..</a></li>
<li><a href="http://www.haishui.net/view.php?tid=30&amp;id=720" title="MySQL字段类型说明" target="_blank">MySQL字段类型说明</a></li>
<li><a href="http://www.haishui.net/view.php?tid=30&amp;id=13" title=" MYSQL 5.0.13 RC发布" target="_blank">MYSQL 5.0.13 RC发布</a>
版权所有 海水工作室 程序支持 海水 &amp; Spring 界面风格 MacroLong    <a href="http://www.miibeian.gov.cn/" target="_blank">晋ICP备05007933号</a></li>
</ul>
<p>本站所有信息均转载自网络，供大家阅读、使用，不负责任何侵权行为。</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/mysql/">mysql</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/mysql/" class="label label-success">mysql</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:34"datetime="2014-03-07 09:54:34"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-mysql--MYSQL不能从远程连接的一个解决方法/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-mysql--MYSQL不能从远程连接的一个解决方法" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-mysql--MySQL索引背后的数据结构及算法原理/">MySQL索引背后的数据结构及算法原理</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:33.000Z"> <a href="/2014/02/02/2014-02-02-DB-mysql--MySQL索引背后的数据结构及算法原理/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="mysql-">MySQL索引背后的数据结构及算法原理</h1>
<p>来源：<a href="http://www.codinglabs.org/html/theory-of-mysql-index.html" target="_blank">张洋</a></p>
<p><strong>摘要</strong></p>
<p>本文以MySQL数据库为研究对象，讨论与数据库索引相关的一些话题。特别需要说明的是，MySQL支持诸多存储引擎，而各种存储引擎对索引的支持也各不相同，因此MySQL数据库支持多种索引类型，如BTree索引，哈希索引，全文索引等等。为了避免混乱，本文将只关注于BTree索引，因为这是平常使用MySQL时主要打交道的索引，至于哈希索引和全文索引本文暂不讨论。</p>
<p>文章主要内容分为三个部分。</p>
<p>第一部分主要从数据结构及算法理论层面讨论MySQL数据库索引的数理基础。</p>
<p>第二部分结合MySQL数据库中MyISAM和InnoDB数据存储引擎中索引的架构实现讨论聚集索引、非聚集索引及覆盖索引等话题。</p>
<p>第三部分根据上面的理论基础，讨论MySQL中高性能使用索引的策略。</p>
<p><a href=""></a><strong>数据结构及算法基础</strong></p>
<p><strong><a href=""></a>索引的本质</strong></p>
<p>MySQL官方对索引的定义为：<strong>索引（Index）是帮助MySQL高效获取数据的数据结构。</strong>提取句子主干，就可以得到索引的本质：索引是数据结构。</p>
<p>我们知道，数据库查询是数据库的最主要功能之一。我们都希望查询数据的速度能尽可能的快，因此数据库系统的设计者会从查询算法的角度进行优化。最基本的查询算法当然是<a href="http://en.wikipedia.org/wiki/Linear_search" target="_blank">顺序查找</a>（linear search），这种复杂度为O(n)的算法在数据量很大时显然是糟糕的，好在计算机科学的发展提供了很多更优秀的查找算法，例如<a href="http://en.wikipedia.org/wiki/Binary_search_algorithm" target="_blank">二分查找</a>（binary search）、<a href="http://en.wikipedia.org/wiki/Binary_search_tree" target="_blank">二叉树查找</a>（binary tree search）等。如果稍微分析一下会发现，每种查找算法都只能应用于特定的数据结构之上，例如二分查找要求被检索数据有序，而二叉树查找只能应用于<a href="http://en.wikipedia.org/wiki/Binary_search_tree" target="_blank">二叉查找树</a>上，但是数据本身的组织结构不可能完全满足各种数据结构（例如，理论上不可能同时将两列都按顺序进行组织），所以，<strong>在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法。这种数据结构，就是索引</strong>。</p>
<p>看一个例子：</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image2.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图1</strong></p>
<p>图1展示了一种可能的索引方式。左边是数据表，一共有两列七条记录，最左边的是数据记录的物理地址（注意逻辑上相邻的记录在磁盘上也并不是一定物理相邻的）。为了加快Col2的查找，可以维护一个右边所示的二叉查找树，每个节点分别包含索引键值和一个指向对应数据记录物理地址的指针，这样就可以运用二叉查找在O(log2n)的复杂度内获取到相应数据。</p>
<p>虽然这是一个货真价实的索引，但是实际的数据库系统几乎没有使用二叉查找树或其进化品种<a href="http://en.wikipedia.org/wiki/Red-black_tree" target="_blank">红黑树</a>（red-black tree）实现的，原因会在下文介绍。</p>
<p><strong><a href=""></a>B-Tree和B+Tree</strong></p>
<p>目前大部分数据库系统及文件系统都采用B-Tree或其变种B+Tree作为索引结构，在本文的下一节会结合存储器原理及计算机存取原理讨论为什么B-Tree和B+Tree在被如此广泛用于索引，这一节先单纯从数据结构角度描述它们。</p>
<p><strong>B-Tree</strong></p>
<p>为了描述B-Tree，首先定义一条数据记录为一个二元组[key, data]，key为记录的键值，对于不同数据记录，key是互不相同的；data为数据记录除key外的数据。那么B-Tree是满足下列条件的数据结构：</p>
<ol>
<li><p>d为大于1的一个正整数，称为B-Tree的度。</p>
</li>
<li><p>h为一个正整数，称为B-Tree的高度。</p>
</li>
<li><p>每个非叶子节点由n-1个key和n个指针组成，其中d&lt;=n&lt;=2d。</p>
</li>
<li><p>每个叶子节点最少包含一个key和两个指针，最多包含2d-1个key和2d个指针，叶节点的指针均为null 。</p>
</li>
<li><p>所有叶节点具有相同的深度，等于树高h。</p>
</li>
<li><p>key和指针互相间隔，节点两端是指针。</p>
</li>
<li><p>一个节点中的key从左到右非递减排列。</p>
</li>
<li><p>所有节点组成树结构。</p>
</li>
<li><p>每个指针要么为null，要么指向另外一个节点。</p>
</li>
<li><p>如果某个指针在节点node最左边且不为null，则其指向节点的所有key小于v(key1)，其中v(key1)为node的第一个key的值。</p>
</li>
<li><p>如果某个指针在节点node最右边且不为null，则其指向节点的所有key大于v(keym)，其中v(keym)为node的最后一个key的值。</p>
</li>
<li><p>如果某个指针在节点node的左右相邻key分别是keyi和keyi+1且不为null，则其指向节点的所有key小于v(keyi+1)且大于v(keyi)。</p>
</li>
</ol>
<p>图2是一个d=2的B-Tree示意图。</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image281.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图2</strong></p>
<p>由于B-Tree的特性，在B-Tree中按key检索数据的算法非常直观：首先从根节点进行二分查找，如果找到则返回对应节点的data，否则对相应区间的指针指向的节点递归进行查找，直到找到节点或找到null指针，前者查找成功，后者查找失败。B-Tree上查找算法的伪代码如下：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
BTree_Search(node, key)</p>
<p>{</p>
<p>if</p>
<p>(node == null)</p>
<p>return</p>
<p>null;</p>
<p>foreach(node.key)</p>
<p>{</p>
<p>if</p>
<p>(node.key[i] == key)</p>
<p>return</p>
<p>node.data[i];</p>
<p>if</p>
<p>(node.key[i] &gt; key)</p>
<p>return</p>
<p>BTree_Search(point[i]-&gt;node);</p>
<p>}</p>
<p>return</p>
<p>BTree_Search(point[i+1]-&gt;node);</p>
<p>}</p>
<p>data = BTree_Search(root, my_key);</p>
<p>关于B-Tree有一系列有趣的性质，例如<strong>一个度为d的B-Tree，设其索引N个key，则其树高h的上限为logd((N+1)/2)，检索一个key，其查找节点个数的渐进复杂度为O(logdN)。</strong>从这点可以看出，B-Tree是一个非常有效率的索引数据结构。</p>
<p>另外，由于插入删除新的数据记录会破坏B-Tree的性质，因此在插入删除时，需要对树进行一个分裂、合并、转移等操作以保持B-Tree性质，本文不打算完整讨论B-Tree这些内容，因为已经有许多资料详细说明了B-Tree的数学性质及插入删除算法，有兴趣的朋友可以在本文末的参考文献一栏找到相应的资料进行阅读。</p>
<p><strong>B+Tree</strong></p>
<p>B-Tree有许多变种，其中最常见的是B+Tree，例如MySQL就普遍使用B+Tree实现其索引结构。</p>
<p>与B-Tree相比，B+Tree有以下不同点：</p>
<ol>
<li><p>每个节点的指针上限为2d而不是2d+1。</p>
</li>
<li><p>内节点不存储data，只存储key；叶子节点不存储指针。</p>
</li>
</ol>
<p>图3是一个简单的B+Tree示意。</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image4.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图3</strong></p>
<p>由于并不是所有节点都具有相同的域，因此B+Tree中叶节点和内节点一般大小不同。这点与B-Tree不同，虽然B-Tree中不同节点存放的key和指针可能数量不一致，但是每个节点的域和上限是一致的，所以在实现中B-Tree往往对每个节点申请同等大小的空间。</p>
<p>一般来说，B+Tree比B-Tree更适合实现外存储索引结构，具体原因与外存储器原理及计算机存取原理有关，将在下面讨论。</p>
<p><strong>带有顺序访问指针的B+Tree</strong></p>
<p>一般在数据库系统或文件系统中使用的B+Tree结构都在经典B+Tree的基础上进行了优化，增加了顺序访问指针。</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image381.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图4</strong></p>
<p>如图4所示，在B+Tree的每个叶子节点增加一个指向相邻叶子节点的指针，就形成了带有顺序访问指针的B+Tree。做这个优化的目的是为了提高区间访问的性能，例如图4中如果要查询key为从18到49的所有数据记录，当找到18后，只需顺着节点和指针顺序遍历就可以一次性访问到所有数据节点，极大提到了区间查询效率。</p>
<p>这一节对B-Tree和B+Tree进行了一个简单的介绍，下一节结合存储器存取原理介绍为什么目前B+Tree是数据库系统实现索引的首选数据结构。</p>
<p><strong><a href=""></a>为什么使用B-Tree（B+Tree）</strong></p>
<p>上文说过，红黑树等数据结构也可以用来实现索引，但是文件系统及数据库系统普遍采用B-/+Tree作为索引结构，这一节将结合计算机组成原理相关知识讨论B-/+Tree作为索引的理论基础。</p>
<p>一般来说，索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储的磁盘上。这样的话，索引查找过程中就要产生磁盘I/O消耗，相对于内存存取，I/O存取的消耗要高几个数量级，所以评价一个数据结构作为索引的优劣最重要的指标就是在查找过程中磁盘I/O操作次数的渐进复杂度。换句话说，索引的结构组织要尽量减少查找过程中磁盘I/O的存取次数。下面先介绍内存和磁盘存取原理，然后再结合这些原理分析B-/+Tree作为索引的效率。</p>
<p><strong>主存存取原理</strong></p>
<p>目前计算机使用的主存基本都是随机读写存储器（RAM），现代RAM的结构和存取原理比较复杂，这里本文抛却具体差别，抽象出一个十分简单的存取模型来说明RAM的工作原理。</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image4_thumb.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图5</strong></p>
<p>从抽象角度看，主存是一系列的存储单元组成的矩阵，每个存储单元存储固定大小的数据。每个存储单元有唯一的地址，现代主存的编址规则比较复杂，这里将其简化成一个二维地址：通过一个行地址和一个列地址可以唯一定位到一个存储单元。图5展示了一个4 x 4的主存模型。</p>
<p>主存的存取过程如下：</p>
<p>当系统需要读取主存时，则将地址信号放到地址总线上传给主存，主存读到地址信号后，解析信号并定位到指定存储单元，然后将此存储单元数据放到数据总线上，供其它部件读取。</p>
<p>写主存的过程类似，系统将要写入单元地址和数据分别放在地址总线和数据总线上，主存读取两个总线的内容，做相应的写操作。</p>
<p>这里可以看出，主存存取的时间仅与存取次数呈线性关系，因为不存在机械操作，两次存取的数据的“距离”不会对时间有任何影响，例如，先取A0再取A1和先取A0再取D3的时间消耗是一样的。</p>
<p><strong>磁盘存取原理</strong></p>
<p>上文说过，索引一般以文件形式存储在磁盘上，索引检索需要磁盘I/O操作。与主存不同，磁盘I/O存在机械运动耗费，因此磁盘I/O的时间消耗是巨大的。</p>
<p>图6是磁盘的整体结构示意图。</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image6111.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图6</strong></p>
<p>一个磁盘由大小相同且同轴的圆形盘片组成，磁盘可以转动（各个磁盘必须同步转动）。在磁盘的一侧有磁头支架，磁头支架固定了一组磁头，每个磁头负责存取一个磁盘的内容。磁头不能转动，但是可以沿磁盘半径方向运动（实际是斜切向运动），每个磁头同一时刻也必须是同轴的，即从正上方向下看，所有磁头任何时候都是重叠的（不过目前已经有多磁头独立技术，可不受此限制）。</p>
<p>图7是磁盘结构的示意图。</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image1111.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图7</strong></p>
<p>盘片被划分成一系列同心环，圆心是盘片中心，每个同心环叫做一个磁道，所有半径相同的磁道组成一个柱面。磁道被沿半径线划分成一个个小的段，每个段叫做一个扇区，每个扇区是磁盘的最小存储单元。为了简单起见，我们下面假设磁盘只有一个盘片和一个磁头。</p>
<p>当需要从磁盘读取数据时，系统会将数据逻辑地址传给磁盘，磁盘的控制电路按照寻址逻辑将逻辑地址翻译成物理地址，即确定要读的数据在哪个磁道，哪个扇区。为了读取这个扇区的数据，需要将磁头放到这个扇区上方，为了实现这一点，磁头需要移动对准相应磁道，这个过程叫做寻道，所耗费时间叫做寻道时间，然后磁盘旋转将目标扇区旋转到磁头下，这个过程耗费的时间叫做旋转时间。</p>
<p><strong>局部性原理与磁盘预读</strong></p>
<p>由于存储介质的特性，磁盘本身存取就比主存慢很多，再加上机械运动耗费，磁盘的存取速度往往是主存的几百分分之一，因此为了提高效率，要尽量减少磁盘I/O。为了达到这个目的，磁盘往往不是严格按需读取，而是每次都会预读，即使只需要一个字节，磁盘也会从这个位置开始，顺序向后读取一定长度的数据放入内存。这样做的理论依据是计算机科学中著名的局部性原理：</p>
<p>当一个数据被用到时，其附近的数据也通常会马上被使用。</p>
<p>程序运行期间所需要的数据通常比较集中。</p>
<p>由于磁盘顺序读取的效率很高（不需要寻道时间，只需很少的旋转时间），因此对于具有局部性的程序来说，预读可以提高I/O效率。</p>
<p>预读的长度一般为页（page）的整倍数。页是计算机管理存储器的逻辑块，硬件及操作系统往往将主存和磁盘存储区分割为连续的大小相等的块，每个存储块称为一页（在许多操作系统中，页得大小通常为4k），主存和磁盘以页为单位交换数据。当程序要读取的数据不在主存中时，会触发一个缺页异常，此时系统会向磁盘发出读盘信号，磁盘会找到数据的起始位置并向后连续读取一页或几页载入内存中，然后异常返回，程序继续运行。</p>
<p><strong>B-/+Tree索引的性能分析</strong></p>
<p>到这里终于可以分析B-/+Tree索引的性能了。</p>
<p>上文说过一般使用磁盘I/O次数评价索引结构的优劣。先从B-Tree分析，根据B-Tree的定义，可知检索一次最多需要访问h个节点。数据库系统的设计者巧妙利用了磁盘预读原理，将一个节点的大小设为等于一个页，这样每个节点只需要一次I/O就可以完全载入。为了达到这个目的，在实际实现B-Tree还需要使用如下技巧：</p>
<p>每次新建节点时，直接申请一个页的空间，这样就保证一个节点物理上也存储在一个页里，加之计算机存储分配都是按页对齐的，就实现了一个node只需一次I/O。</p>
<p><strong>B-Tree中一次检索最多需要h-1次I/O（根节点常驻内存），渐进复杂度为O(h)=O(logdN)。</strong>一般实际应用中，出度d是非常大的数字，通常超过100，因此h非常小（通常不超过3）。</p>
<p>综上所述，用B-Tree作为索引结构效率是非常高的。</p>
<p>而红黑树这种结构，h明显要深的多。由于逻辑上很近的节点（父子）物理上可能很远，无法利用局部性，所以红黑树的I/O渐进复杂度也为O(h)，效率明显比B-Tree差很多。</p>
<p>上文还说过，B+Tree更适合外存索引，原因和内节点出度d有关。从上面分析可以看到，d越大索引的性能越好，而出度的上限取决于节点内key和data的大小：</p>
<p>dmax = <strong><em>floor</em></strong>(pagesize / (keysize + datasize + pointsize))   <em>(pagesize – dmax &gt;= pointsize)</em></p>
<p>或</p>
<p>dmax = <strong><em>floor</em></strong>(pagesize / (keysize + datasize + pointsize)) – 1   <em>(pagesize – dmax &lt; pointsize)</em></p>
<p>floor表示向下取整。由于B+Tree内节点去掉了data域，因此可以拥有更大的出度，拥有更好的性能。</p>
<p>这一章从理论角度讨论了与索引相关的数据结构与算法问题，下一章将讨论B+Tree是如何具体实现为MySQL中索引，同时将结合MyISAM和InnDB存储引擎介绍非聚集索引和聚集索引两种不同的索引实现形式。</p>
<p><strong><a href=""></a>MySQL索引实现</strong></p>
<p>在MySQL中，索引属于存储引擎级别的概念，不同存储引擎对索引的实现方式是不同的，本文主要讨论MyISAM和InnoDB两个存储引擎的索引实现方式。</p>
<p><strong><a href=""></a>MyISAM索引实现</strong></p>
<p>MyISAM引擎使用B+Tree作为索引结构，叶节点的data域存放的是数据记录的地址。下图是MyISAM索引的原理图：</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image11111.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图8</strong></p>
<p>这里设表一共有三列，假设我们以Col1为主键，则图8是一个MyISAM表的主索引（Primary key）示意。可以看出MyISAM的索引文件仅仅保存数据记录的地址。<strong>在MyISAM中，主索引和辅助索引（Secondary key）在结构上没有任何区别，只是主索引要求key是唯一的，而辅助索引的key可以重复。</strong>如果我们在Col2上建立一个辅助索引，则此索引的结构如下图所示：</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image61.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图9</strong></p>
<p>同样也是一颗B+Tree，data域保存数据记录的地址。因此，<strong>MyISAM中索引检索的算法为首先按照B+Tree搜索算法搜索索引，如果指定的Key存在，则取出其data域的值，然后以data域的值为地址，读取相应数据记录。</strong></p>
<p>MyISAM的索引方式也叫做“非聚集”的，之所以这么称呼是为了与InnoDB的聚集索引区分。</p>
<p><strong><a href=""></a>InnoDB索引实现</strong></p>
<p>虽然InnoDB也使用B+Tree作为索引结构，但具体实现方式却与MyISAM截然不同。</p>
<p><strong>第一个重大区别是InnoDB的数据文件本身就是索引文件。</strong>从上文知道，MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。而在InnoDB中，表数据文件本身就是按B+Tree组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是主索引。</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image111.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图10</strong></p>
<p>图10是InnoDB主索引（同时也是数据文件）的示意图，可以看到叶节点包含了完整的数据记录。这种索引叫做聚集索引。因为InnoDB的数据文件本身要按主键聚集，所以InnoDB要求表必须有主键（MyISAM可以没有），如果没有显式指定，则MySQL系统会自动选择一个可以唯一标识数据记录的列作为主键，如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整形。</p>
<p><strong>第二个与MyISAM索引的不同是InnoDB的辅助索引data域存储相应记录主键的值而不是地址。</strong>换句话说，InnoDB的所有辅助索引都引用主键作为data域。例如，图11为定义在Col3上的一个辅助索引：</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image5.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图11</strong></p>
<p>这里以英文字符的ASCII码作为比较准则。<strong>聚集索引这种实现方式使得按主键的搜索十分高效，但是辅助索引搜索需要检索两遍索引：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录。</strong></p>
<p>了解不同存储引擎的索引实现方式对于正确使用和优化索引都非常有帮助，例如知道了InnoDB的索引实现后，就很容易明白为什么不建议使用过长的字段作为主键，因为所有辅助索引都引用主索引，过长的主索引会令辅助索引变得过大。再例如，用非单调的字段作为主键在InnoDB中不是个好主意，因为InnoDB数据文件本身是一颗B+Tree，非单调的主键会造成在插入新记录时数据文件为了维持B+Tree的特性而频繁的分裂调整，十分低效，而使用自增字段作为主键则是一个很好的选择。</p>
<p>下一章将具体讨论这些与索引有关的优化策略。</p>
<p><strong><a href=""></a>索引使用策略及优化</strong></p>
<p>MySQL的优化主要分为结构优化（Scheme optimization）和查询优化（Query optimization）。本章讨论的高性能索引策略主要属于结构优化范畴。本章的内容完全基于上文的理论基础，实际上一旦理解了索引背后的机制，那么选择高性能的策略就变成了纯粹的推理，并且可以理解这些策略背后的逻辑。</p>
<p><strong><a href=""></a>示例数据库</strong></p>
<p>为了讨论索引策略，需要一个数据量不算小的数据库作为示例。本文选用MySQL官方文档中提供的示例数据库之一：employees。这个数据库关系复杂度适中，且数据量较大。下图是这个数据库的E-R关系图（引用自MySQL官方手册）：</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image112.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图12</strong></p>
<p>MySQL官方文档中关于此数据库的页面为<a href="http://dev.mysql.com/doc/employee/en/employee.html" title="http://dev.mysql.com/doc/employee/en/employee.html" target="_blank"><a href="http://dev.mysql.com/doc/employee/en/employee.html">http://dev.mysql.com/doc/employee/en/employee.html</a></a>。里面详细介绍了此数据库，并提供了下载地址和导入方法，如果有兴趣导入此数据库到自己的MySQL可以参考文中内容。</p>
<p><strong><a href=""></a>最左前缀原理与相关优化</strong></p>
<p>高效使用索引的首要条件是知道什么样的查询会使用到索引，这个问题和B+Tree中的“最左前缀原理”有关，下面通过例子说明最左前缀原理。</p>
<p>这里先说一下联合索引的概念。在上文中，我们都是假设索引只引用了单个的列，实际上，MySQL中的索引可以以一定顺序引用多个列，这种索引叫做联合索引，一般的，一个联合索引是一个有序元组<a1, a2, …, an>，其中各个元素均为数据表的一列，实际上要严格定义索引需要用到关系代数，但是这里我不想讨论太多关系代数的话题，因为那样会显得很枯燥，所以这里就不再做严格定义。另外，单列索引可以看成联合索引元素数为1的特例。</p>
<p>以employees.titles表为例，下面先查看其上都有哪些索引：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9SHOW</p>
<p>INDEX</p>
<p>FROM</p>
<p>employees.titles;</p>
<p>+</p>
<p>--------+------------+----------+--------------+-------------+-----------+-------------+------+------------+
|</p>
<p>Table</p>
<p>| Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality |</p>
<p>Null</p>
<p>| Index_type |</p>
<p>+</p>
<p>--------+------------+----------+--------------+-------------+-----------+-------------+------+------------+
| titles |          0 |</p>
<p>PRIMARY</p>
<p>|            1 | emp_no      | A         |       </p>
<p>NULL</p>
<p>|      | BTREE      |</p>
<p>| titles |          0 |</p>
<p>PRIMARY</p>
<p>|            2 | title       | A         |       </p>
<p>NULL</p>
<p>|      | BTREE      |
| titles |          0 |</p>
<p>PRIMARY</p>
<p>|            3 | from_date   | A         |      443308 |      | BTREE      |</p>
<p>| titles |          1 | emp_no   |            1 | emp_no      | A         |      443308 |      | BTREE      |
+</p>
<p>--------+------------+----------+--------------+-------------+-----------+-------------+------+------------+</p>
<p>从结果中可以到titles表的主索引为<emp_no, title, from_date>，还有一个辅助索引<emp_no>。为了避免多个索引使事情变复杂（MySQL的SQL优化器在多索引时行为比较复杂），这里我们将辅助索引drop掉：</p>
<p>1ALTER</p>
<p>TABLE</p>
<p>employees.titles</p>
<p>DROP</p>
<p>INDEX</p>
<p>emp_no;</p>
<p>这样就可以专心分析索引PRIMARY的行为了。</p>
<p><strong>情况一：全列匹配。</strong>
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>emp_no=</p>
<p>&#39;10001&#39;</p>
<p>AND</p>
<p>title=</p>
<p>&#39;Senior Engineer&#39;</p>
<p>AND</p>
<p>from_date=</p>
<p>&#39;1986-06-26&#39;</p>
<p>;</p>
<p>+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+
| id | select_type |</p>
<p>table</p>
<p>| type  | possible_keys |</p>
<p>key</p>
<p>| key_len | ref               |</p>
<p>rows</p>
<p>| Extra |</p>
<p>+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+
|  1 | SIMPLE      | titles | const |</p>
<p>PRIMARY</p>
<p>|</p>
<p>PRIMARY</p>
<p>| 59      | const,const,const |    1 |       |</p>
<p>+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</p>
<p>很明显，当按照索引中所有列进行精确匹配（这里精确匹配指“=”或“IN”匹配）时，索引可以被用到。这里有一点需要注意，理论上索引对顺序是敏感的，但是由于MySQL的查询优化器会自动调整where子句的条件顺序以使用适合的索引，例如我们将where中的条件顺序颠倒：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>from_date=</p>
<p>&#39;1986-06-26&#39;</p>
<p>AND</p>
<p>emp_no=</p>
<p>&#39;10001&#39;</p>
<p>AND</p>
<p>title=</p>
<p>&#39;Senior Engineer&#39;</p>
<p>;</p>
<p>+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+
| id | select_type |</p>
<p>table</p>
<p>| type  | possible_keys |</p>
<p>key</p>
<p>| key_len | ref               |</p>
<p>rows</p>
<p>| Extra |</p>
<p>+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+
|  1 | SIMPLE      | titles | const |</p>
<p>PRIMARY</p>
<p>|</p>
<p>PRIMARY</p>
<p>| 59      | const,const,const |    1 |       |</p>
<p>+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</p>
<p>效果是一样的。</p>
<p><strong>情况二：最左前缀匹配。</strong>
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>emp_no=</p>
<p>&#39;10001&#39;</p>
<p>;</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+---------+---------+-------+------+-------+
| id | select_type |</p>
<p>table</p>
<p>| type | possible_keys |</p>
<p>key</p>
<p>| key_len | ref   |</p>
<p>rows</p>
<p>| Extra |</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+---------+---------+-------+------+-------+
|  1 | SIMPLE      | titles | ref  |</p>
<p>PRIMARY</p>
<p>|</p>
<p>PRIMARY</p>
<p>| 4       | const |    1 |       |</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+---------+---------+-------+------+-------+</p>
<p>当查询条件精确匹配索引的左边连续一个或几个列时，如<emp_no>或<emp_no, title>，所以可以被用到，但是只能用到一部分，即条件所组成的最左前缀。上面的查询从分析结果看用到了PRIMARY索引，但是key_len为4，说明只用到了索引的第一列前缀。</p>
<p><strong>情况三：查询条件用到了索引中列的精确匹配，但是中间某个条件未提供。</strong>
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>emp_no=</p>
<p>&#39;10001&#39;</p>
<p>AND</p>
<p>from_date=</p>
<p>&#39;1986-06-26&#39;</p>
<p>;</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+
| id | select_type |</p>
<p>table</p>
<p>| type | possible_keys |</p>
<p>key</p>
<p>| key_len | ref   |</p>
<p>rows</p>
<p>| Extra       |</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+
|  1 | SIMPLE      | titles | ref  |</p>
<p>PRIMARY</p>
<p>|</p>
<p>PRIMARY</p>
<p>| 4       | const |    1 | Using</p>
<p>where</p>
<p>|</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</p>
<p>此时索引使用情况和情况二相同，因为title未提供，所以查询只用到了索引的第一列，而后面的from_date虽然也在索引中，但是由于title不存在而无法和左前缀连接，因此需要对结果进行扫描过滤from_date（这里由于emp_no唯一，所以不存在扫描）。如果想让from_date也使用索引而不是where过滤，可以增加一个辅助索引<emp_no, from_date>，此时上面的查询会使用这个索引。除此之外，还可以使用一种称之为“隔离列”的优化方法，将emp_no与from_date之间的“坑”填上。</p>
<p>首先我们看下title一共有几种不同的值：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
SELECT</p>
<p>DISTINCT</p>
<p>(title)</p>
<p>FROM</p>
<p>employees.titles;</p>
<p>+</p>
<p>--------------------+
| title              |</p>
<p>+</p>
<p>--------------------+
| Senior Engineer    |</p>
<p>| Staff              |
| Engineer           |</p>
<p>| Senior Staff       |
| Assistant Engineer |</p>
<p>| Technique Leader   |
| Manager            |</p>
<p>+</p>
<p>--------------------+</p>
<p>只有7种。在这种成为“坑”的列值比较少的情况下，可以考虑用“IN”来填补这个“坑”从而形成最左前缀：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>emp_no=</p>
<p>&#39;10001&#39;
AND</p>
<p>title</p>
<p>IN</p>
<p>(</p>
<p>&#39;Senior Engineer&#39;</p>
<p>,</p>
<p>&#39;Staff&#39;</p>
<p>,</p>
<p>&#39;Engineer&#39;</p>
<p>,</p>
<p>&#39;Senior Staff&#39;</p>
<p>,</p>
<p>&#39;Assistant Engineer&#39;</p>
<p>,</p>
<p>&#39;Technique Leader&#39;</p>
<p>,</p>
<p>&#39;Manager&#39;</p>
<p>)</p>
<p>AND</p>
<p>from_date=</p>
<p>&#39;1986-06-26&#39;</p>
<p>;
+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</p>
<p>| id | select_type |</p>
<p>table</p>
<p>| type  | possible_keys |</p>
<p>key</p>
<p>| key_len | ref  |</p>
<p>rows</p>
<p>| Extra       |
+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</p>
<p>|  1 | SIMPLE      | titles | range |</p>
<p>PRIMARY</p>
<p>|</p>
<p>PRIMARY</p>
<p>| 59      |</p>
<p>NULL</p>
<p>|    7 | Using</p>
<p>where</p>
<p>|
+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</p>
<p>这次key_len为59，说明索引被用全了，但是从type和rows看出IN实际上执行了一个range查询，这里检查了7个key。看下两种查询的性能比较：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7SHOW PROFILES;</p>
<p>+</p>
<p>----------+------------+-------------------------------------------------------------------------------+
| Query_ID | Duration   | Query                                                                         |</p>
<p>+</p>
<p>----------+------------+-------------------------------------------------------------------------------+
|       10 | 0.00058000 |</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>emp_no=</p>
<p>&#39;10001&#39;</p>
<p>AND</p>
<p>from_date=</p>
<p>&#39;1986-06-26&#39;</p>
<p>|</p>
<p>|       11 | 0.00052500 |</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>emp_no=</p>
<p>&#39;10001&#39;</p>
<p>AND</p>
<p>title</p>
<p>IN</p>
<p>...          |
+</p>
<p>----------+------------+-------------------------------------------------------------------------------+</p>
<p>“填坑”后性能提升了一点。如果经过emp_no筛选后余下很多数据，则后者性能优势会更加明显。当然，如果title的值很多，用填坑就不合适了，必须建立辅助索引。</p>
<p><strong>情况四：查询条件没有指定索引第一列。</strong>
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>from_date=</p>
<p>&#39;1986-06-26&#39;</p>
<p>;</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+------+---------+------+--------+-------------+
| id | select_type |</p>
<p>table</p>
<p>| type | possible_keys |</p>
<p>key</p>
<p>| key_len | ref  |</p>
<p>rows</p>
<p>| Extra       |</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+------+---------+------+--------+-------------+
|  1 | SIMPLE      | titles |</p>
<p>ALL</p>
<p>|</p>
<p>NULL</p>
<p>|</p>
<p>NULL</p>
<p>|</p>
<p>NULL</p>
<p>|</p>
<p>NULL</p>
<p>| 443308 | Using</p>
<p>where</p>
<p>|</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</p>
<p>由于不是最左前缀，索引这样的查询显然用不到索引。</p>
<p><strong>情况五：匹配某列的前缀字符串。</strong>
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>emp_no=</p>
<p>&#39;10001&#39;</p>
<p>AND</p>
<p>title</p>
<p>LIKE</p>
<p>&#39;Senior%&#39;</p>
<p>;</p>
<p>+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+
| id | select_type |</p>
<p>table</p>
<p>| type  | possible_keys |</p>
<p>key</p>
<p>| key_len | ref  |</p>
<p>rows</p>
<p>| Extra       |</p>
<p>+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+
|  1 | SIMPLE      | titles | range |</p>
<p>PRIMARY</p>
<p>|</p>
<p>PRIMARY</p>
<p>| 56      |</p>
<p>NULL</p>
<p>|    1 | Using</p>
<p>where</p>
<p>|</p>
<p>+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</p>
<p>此时可以用到索引，但是如果通配符不是只出现在末尾，则无法使用索引。（原文表述有误，如果通配符%不出现在开头，则可以用到索引，但根据具体情况不同可能只会用其中一个前缀）</p>
<p><strong>情况六：范围查询。</strong>
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>emp_no &lt;</p>
<p>&#39;10010&#39;</p>
<p>and</p>
<p>title=</p>
<p>&#39;Senior Engineer&#39;</p>
<p>;</p>
<p>+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+
| id | select_type |</p>
<p>table</p>
<p>| type  | possible_keys |</p>
<p>key</p>
<p>| key_len | ref  |</p>
<p>rows</p>
<p>| Extra       |</p>
<p>+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+
|  1 | SIMPLE      | titles | range |</p>
<p>PRIMARY</p>
<p>|</p>
<p>PRIMARY</p>
<p>| 4       |</p>
<p>NULL</p>
<p>|   16 | Using</p>
<p>where</p>
<p>|</p>
<p>+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</p>
<p>范围列可以用到索引（必须是最左前缀），但是范围列后面的列无法用到索引。同时，索引最多用于一个范围列，因此如果查询条件中有两个范围列则无法全用到索引。</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>emp_no &lt; 10010</p>
<p>&#39;
AND title=&#39;</p>
<p>Senior Engineer</p>
<p>&#39;</p>
<p>AND from_date BETWEEN &#39;</p>
<p>1986-01-01</p>
<p>&#39; AND &#39;</p>
<p>1986-12-31&#39;;
+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</p>
<p>| id | select_type |</p>
<p>table</p>
<p>| type  | possible_keys |</p>
<p>key</p>
<p>| key_len | ref  |</p>
<p>rows</p>
<p>| Extra       |
+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</p>
<p>|  1 | SIMPLE      | titles | range |</p>
<p>PRIMARY</p>
<p>|</p>
<p>PRIMARY</p>
<p>| 4       |</p>
<p>NULL</p>
<p>|   16 | Using</p>
<p>where</p>
<p>|
+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</p>
<p>可以看到索引对第二个范围索引无能为力。这里特别要说明MySQL一个有意思的地方，那就是仅用explain可能无法区分范围索引和多值匹配，因为在type中这两者都显示为range。同时，用了“between”并不意味着就是范围查询，例如下面的查询：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>emp_no</p>
<p>BETWEEN</p>
<p>&#39;10001&#39;</p>
<p>AND</p>
<p>&#39;10010&#39;
AND</p>
<p>title=</p>
<p>&#39;Senior Engineer&#39;</p>
<p>AND</p>
<p>from_date</p>
<p>BETWEEN</p>
<p>&#39;1986-01-01&#39;</p>
<p>AND</p>
<p>&#39;1986-12-31&#39;</p>
<p>;
+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</p>
<p>| id | select_type |</p>
<p>table</p>
<p>| type  | possible_keys |</p>
<p>key</p>
<p>| key_len | ref  |</p>
<p>rows</p>
<p>| Extra       |
+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</p>
<p>|  1 | SIMPLE      | titles | range |</p>
<p>PRIMARY</p>
<p>|</p>
<p>PRIMARY</p>
<p>| 59      |</p>
<p>NULL</p>
<p>|   16 | Using</p>
<p>where</p>
<p>|
+</p>
<p>----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</p>
<p>看起来是用了两个范围查询，但作用于emp_no上的“BETWEEN”实际上相当于“IN”，也就是说emp_no实际是多值精确匹配。可以看到这个查询用到了索引全部三个列。因此在MySQL中要谨慎地区分多值匹配和范围匹配，否则会对MySQL的行为产生困惑。</p>
<p>情况七：查询条件中含有函数或表达式。</p>
<p>很不幸，如果查询条件中含有函数或表达式，则MySQL不会为这列使用索引（虽然某些在数学意义上可以使用）。例如：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>emp_no=</p>
<p>&#39;10001&#39;</p>
<p>AND</p>
<p>left</p>
<p>(title, 6)=</p>
<p>&#39;Senior&#39;</p>
<p>;</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+
| id | select_type |</p>
<p>table</p>
<p>| type | possible_keys |</p>
<p>key</p>
<p>| key_len | ref   |</p>
<p>rows</p>
<p>| Extra       |</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+
|  1 | SIMPLE      | titles | ref  |</p>
<p>PRIMARY</p>
<p>|</p>
<p>PRIMARY</p>
<p>| 4       | const |    1 | Using</p>
<p>where</p>
<p>|</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</p>
<p>虽然这个查询和情况五中功能相同，但是由于使用了函数left，则无法为title列应用索引，而情况五中用LIKE则可以。再如：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.titles</p>
<p>WHERE</p>
<p>emp_no - 1=</p>
<p>&#39;10000&#39;</p>
<p>;</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+------+---------+------+--------+-------------+
| id | select_type |</p>
<p>table</p>
<p>| type | possible_keys |</p>
<p>key</p>
<p>| key_len | ref  |</p>
<p>rows</p>
<p>| Extra       |</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+------+---------+------+--------+-------------+
|  1 | SIMPLE      | titles |</p>
<p>ALL</p>
<p>|</p>
<p>NULL</p>
<p>|</p>
<p>NULL</p>
<p>|</p>
<p>NULL</p>
<p>|</p>
<p>NULL</p>
<p>| 443308 | Using</p>
<p>where</p>
<p>|</p>
<p>+</p>
<p>----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</p>
<p>显然这个查询等价于查询emp_no为10001的函数，但是由于查询条件是一个表达式，MySQL无法为其使用索引。看来MySQL还没有智能到自动优化常量表达式的程度，因此在写查询语句时尽量避免表达式出现在查询中，而是先手工私下代数运算，转换为无表达式的查询语句。</p>
<p><strong><a href=""></a>索引选择性与前缀索引</strong></p>
<p>既然索引可以加快查询速度，那么是不是只要是查询语句需要，就建上索引？答案是否定的。因为索引虽然加快了查询速度，但索引也是有代价的：索引文件本身要消耗存储空间，同时索引会加重插入、删除和修改记录时的负担，另外，MySQL在运行时也要消耗资源维护索引，因此索引并不是越多越好。一般两种情况下不建议建索引。</p>
<p>第一种情况是表记录比较少，例如一两千条甚至只有几百条记录的表，没必要建索引，让查询做全表扫描就好了。至于多少条记录才算多，这个个人有个人的看法，我个人的经验是以2000作为分界线，记录数不超过 2000可以考虑不建索引，超过2000条可以酌情考虑索引。</p>
<p>另一种不建议建索引的情况是索引的选择性较低。所谓索引的选择性（Selectivity），是指不重复的索引值（也叫基数，Cardinality）与表记录数（/#T）的比值：</p>
<p>Index Selectivity = Cardinality / /#T</p>
<p>显然选择性的取值范围为(0, 1]，选择性越高的索引价值越大，这是由B+Tree的性质决定的。例如，上文用到的employees.titles表，如果title字段经常被单独查询，是否需要建索引，我们看一下它的选择性：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
SELECT</p>
<p>count</p>
<p>(</p>
<p>DISTINCT</p>
<p>(title))/</p>
<p>count</p>
<p>(/*)</p>
<p>AS</p>
<p>Selectivity</p>
<p>FROM</p>
<p>employees.titles;</p>
<p>+</p>
<p>-------------+
| Selectivity |</p>
<p>+</p>
<p>-------------+
|      0.0000 |</p>
<p>+</p>
<p>-------------+</p>
<p>title的选择性不足0.0001（精确值为0.00001579），所以实在没有什么必要为其单独建索引。</p>
<p>有一种与索引选择性有关的索引优化策略叫做前缀索引，就是用列的前缀代替整个列作为索引key，当前缀长度合适时，可以做到既使得前缀索引的选择性接近全列索引，同时因为索引key变短而减少了索引文件的大小和维护开销。下面以employees.employees表为例介绍前缀索引的选择和使用。</p>
<p>从图12可以看到employees表只有一个索引<emp_no>，那么如果我们想按名字搜索一个人，就只能全表扫描了：
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
EXPLAIN</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.employees</p>
<p>WHERE</p>
<p>first_name=</p>
<p>&#39;Eric&#39;</p>
<p>AND</p>
<p>last_name=</p>
<p>&#39;Anido&#39;</p>
<p>;</p>
<p>+</p>
<p>----+-------------+-----------+------+---------------+------+---------+------+--------+-------------+
| id | select_type |</p>
<p>table</p>
<p>| type | possible_keys |</p>
<p>key</p>
<p>| key_len | ref  |</p>
<p>rows</p>
<p>| Extra       |</p>
<p>+</p>
<p>----+-------------+-----------+------+---------------+------+---------+------+--------+-------------+
|  1 | SIMPLE      | employees |</p>
<p>ALL</p>
<p>|</p>
<p>NULL</p>
<p>|</p>
<p>NULL</p>
<p>|</p>
<p>NULL</p>
<p>|</p>
<p>NULL</p>
<p>| 300024 | Using</p>
<p>where</p>
<p>|</p>
<p>+</p>
<p>----+-------------+-----------+------+---------------+------+---------+------+--------+-------------+</p>
<p>如果频繁按名字搜索员工，这样显然效率很低，因此我们可以考虑建索引。有两种选择，建<first_name>或<first_name, last_name>，看下两个索引的选择性：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13SELECT</p>
<p>count</p>
<p>(</p>
<p>DISTINCT</p>
<p>(first_name))/</p>
<p>count</p>
<p>(/*)</p>
<p>AS</p>
<p>Selectivity</p>
<p>FROM</p>
<p>employees.employees;</p>
<p>+</p>
<p>-------------+
| Selectivity |</p>
<p>+</p>
<p>-------------+
|      0.0042 |</p>
<p>+</p>
<p>-------------+</p>
<p>SELECT</p>
<p>count</p>
<p>(</p>
<p>DISTINCT</p>
<p>(concat(first_name, last_name)))/</p>
<p>count</p>
<p>(/*)</p>
<p>AS</p>
<p>Selectivity</p>
<p>FROM</p>
<p>employees.employees;
+</p>
<p>-------------+</p>
<p>| Selectivity |
+</p>
<p>-------------+</p>
<p>|      0.9313 |
+</p>
<p>-------------+</p>
<p><first_name>显然选择性太低，<first_name, last_name>选择性很好，但是first_name和last_name加起来长度为30，有没有兼顾长度和选择性的办法？可以考虑用first_name和last_name的前几个字符建立索引，例如<first_name, left(last_name, 3)>，看看其选择性：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
SELECT</p>
<p>count</p>
<p>(</p>
<p>DISTINCT</p>
<p>(concat(first_name,</p>
<p>left</p>
<p>(last_name, 3))))/</p>
<p>count</p>
<p>(/*)</p>
<p>AS</p>
<p>Selectivity</p>
<p>FROM</p>
<p>employees.employees;</p>
<p>+</p>
<p>-------------+
| Selectivity |</p>
<p>+</p>
<p>-------------+
|      0.7879 |</p>
<p>+</p>
<p>-------------+</p>
<p>选择性还不错，但离0.9313还是有点距离，那么把last_name前缀加到4：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
SELECT</p>
<p>count</p>
<p>(</p>
<p>DISTINCT</p>
<p>(concat(first_name,</p>
<p>left</p>
<p>(last_name, 4))))/</p>
<p>count</p>
<p>(/*)</p>
<p>AS</p>
<p>Selectivity</p>
<p>FROM</p>
<p>employees.employees;</p>
<p>+</p>
<p>-------------+
| Selectivity |</p>
<p>+</p>
<p>-------------+
|      0.9007 |</p>
<p>+</p>
<p>-------------+</p>
<p>这时选择性已经很理想了，而这个索引的长度只有18，比<first_name, last_name>短了接近一半，我们把这个前缀索引 建上：</p>
<p>1</p>
<p>2
ALTER</p>
<p>TABLE</p>
<p>employees.employees</p>
<p>ADD</p>
<p>INDEX</p>
<p><code>first_name_last_name4</code> (first_name, last_name(4));</p>
<p>此时再执行一遍按名字查询，比较分析一下与建索引前的结果：</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7SHOW PROFILES;</p>
<p>+</p>
<p>----------+------------+---------------------------------------------------------------------------------+
| Query_ID | Duration   | Query                                                                           |</p>
<p>+</p>
<p>----------+------------+---------------------------------------------------------------------------------+
|       87 | 0.11941700 |</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.employees</p>
<p>WHERE</p>
<p>first_name=</p>
<p>&#39;Eric&#39;</p>
<p>AND</p>
<p>last_name=</p>
<p>&#39;Anido&#39;</p>
<p>|</p>
<p>|       90 | 0.00092400 |</p>
<p>SELECT</p>
<p>/*</p>
<p>FROM</p>
<p>employees.employees</p>
<p>WHERE</p>
<p>first_name=</p>
<p>&#39;Eric&#39;</p>
<p>AND</p>
<p>last_name=</p>
<p>&#39;Anido&#39;</p>
<p>|
+</p>
<p>----------+------------+---------------------------------------------------------------------------------+</p>
<p>性能的提升是显著的，查询速度提高了120多倍。</p>
<p>前缀索引兼顾索引大小和查询速度，但是其缺点是不能用于ORDER BY和GROUP BY操作，也不能用于Covering index（即当索引本身包含查询所需全部数据时，不再访问数据文件本身）。</p>
<p><strong><a href=""></a>InnoDB的主键选择与插入优化</strong></p>
<p>在使用InnoDB存储引擎时，如果没有特别的需要，请永远使用一个与业务无关的自增字段作为主键。</p>
<p>经常看到有帖子或博客讨论主键选择问题，有人建议使用业务无关的自增主键，有人觉得没有必要，完全可以使用如学号或身份证号这种唯一字段作为主键。不论支持哪种论点，大多数论据都是业务层面的。如果从数据库索引优化角度看，使用InnoDB引擎而不使用自增主键绝对是一个糟糕的主意。</p>
<p>上文讨论过InnoDB的索引实现，InnoDB使用聚集索引，数据记录本身被存于主索引（一颗B+Tree）的叶子节点上。这就要求同一个叶子节点内（大小为一个内存页或磁盘页）的各条数据记录按主键顺序存放，因此每当有一条新的记录插入时，MySQL会根据其主键将其插入适当的节点和位置，如果页面达到装载因子（InnoDB默认为15/16），则开辟一个新的页（节点）。</p>
<p>如果表使用自增主键，那么每次插入新的记录，记录就会顺序添加到当前索引节点的后续位置，当一页写满，就会自动开辟一个新的页。如下图所示：</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image121.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图13</strong></p>
<p>这样就会形成一个紧凑的索引结构，近似顺序填满。由于每次插入时也不需要移动已有数据，因此效率很高，也不会增加很多开销在维护索引上。</p>
<p>如果使用非自增主键（如果身份证号或学号等），由于每次插入主键的值近似于随机，因此每次新纪录都要被插到现有索引页得中间某个位置：</p>
<p><a href="http://cdn2.jobbole.com/2012/07/image6.png" title="MySQL索引背后的数据结构及算法原理" target="_blank"><img src="&quot;MySQL索引背后的数据结构及算法原理&quot;" alt="MySQL索引背后的数据结构及算法原理"></a></p>
<p><strong>图14</strong></p>
<p>此时MySQL不得不为了将新记录插到合适位置而移动数据，甚至目标页面可能已经被回写到磁盘上而从缓存中清掉，此时又要从磁盘上读回来，这增加了很多开销，同时频繁的移动、分页操作造成了大量的碎片，得到了不够紧凑的索引结构，后续不得不通过OPTIMIZE TABLE来重建表并优化填充页面。</p>
<p>因此，只要可以，请尽量在InnoDB上采用自增字段做主键。</p>
<p><strong><a href=""></a>后记</strong></p>
<p>这篇文章断断续续写了半个月，主要内容就是上面这些了。不可否认，这篇文章在一定程度上有纸上谈兵之嫌，因为我本人对MySQL的使用属于菜鸟级别，更没有太多数据库调优的经验，在这里大谈数据库索引调优有点大言不惭。就当是我个人的一篇学习笔记了。</p>
<p>其实数据库索引调优是一项技术活，不能仅仅靠理论，因为实际情况千变万化，而且MySQL本身存在很复杂的机制，如查询优化策略和各种引擎的实现差异等都会使情况变得更加复杂。但同时这些理论是索引调优的基础，只有在明白理论的基础上，才能对调优策略进行合理推断并了解其背后的机制，然后结合实践中不断的实验和摸索，从而真正达到高效使用MySQL索引的目的。</p>
<p>另外，MySQL索引及其优化涵盖范围非常广，本文只是涉及到其中一部分。如与排序（ORDER BY）相关的索引优化及覆盖索引（Covering index）的话题本文并未涉及，同时除B-Tree索引外MySQL还根据不同引擎支持的哈希索引、全文索引等等本文也并未涉及。如果有机会，希望再对本文未涉及的部分进行补充吧。</p>
<p><strong><a href=""></a>参考文献</strong></p>
<p>[1] Baron Scbwartz等 著，王小东等 译；高性能MySQL（High Performance MySQL）；电子工业出版社，2010</p>
<p>[2] Michael Kofler 著，杨晓云等 译；MySQL5权威指南（The Definitive Guide to MySQL5）；人民邮电出版社，2006</p>
<p>[3] 姜承尧 著；MySQL技术内幕-InnoDB存储引擎；机械工业出版社，2011</p>
<p>[4] D Comer, Ubiquitous B-tree; ACM Computing Surveys (CSUR), 1979</p>
<p>[5] Codd, E. F. (1970). “A relational model of data for large shared data banks”. Communications of the ACM, , Vol. 13, No. 6, pp. 377-387</p>
<p>[6] MySQL5.1参考手册 – <a href="http://dev.mysql.com/doc/refman/5.1/zh/index.html" title="http://dev.mysql.com/doc/refman/5.1/zh/index.html" target="_blank"><a href="http://dev.mysql.com/doc/refman/5.1/zh/index.html">http://dev.mysql.com/doc/refman/5.1/zh/index.html</a></a></p>
<p><img src="&quot;3 votes, average: 5.00 out of 5&quot;" alt="3 votes, average: 5.00 out of 5"><img src="&quot;3 votes, average: 5.00 out of 5&quot;" alt="3 votes, average: 5.00 out of 5"><img src="&quot;3 votes, average: 5.00 out of 5&quot;" alt="3 votes, average: 5.00 out of 5"><img src="&quot;3 votes, average: 5.00 out of 5&quot;" alt="3 votes, average: 5.00 out of 5"><img src="&quot;3 votes, average: 5.00 out of 5&quot;" alt="3 votes, average: 5.00 out of 5"> (<strong>*3</strong> 个评分，平均: <strong>5.00*</strong>)</p>
<p><img src="&quot;Loading ...&quot;" alt="Loading ..."> Loading ...</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/mysql/">mysql</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/mysql/" class="label label-success">mysql</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:33"datetime="2014-03-07 09:54:33"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-mysql--MySQL索引背后的数据结构及算法原理/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-mysql--MySQL索引背后的数据结构及算法原理" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-mysql--MySQL报错：TheMySQLserverisrunningwiththe--ski/">MySQL报错：The MySQL server is running with the </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:33.000Z"> <a href="/2014/02/02/2014-02-02-DB-mysql--MySQL报错：TheMySQLserverisrunningwiththe--ski/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="mysql-the-mysql-server-is-running-with-the-skip-grant-tables-option-so-it-cannot-execute-this">MySQL报错：The MySQL server is running with the --skip-grant-tables option so it cannot execute this</h1>
<p><a href=""></a></p>
<h1 id="-_-http-www-cnblogs-com-xionghui-"><a href="http://www.cnblogs.com/xionghui/" target="_blank">_安静</a></h1>
<h2 id="-mysql-the-mysql-server-is-running-with-the-skip-grant-tables-option-so-it-cannot-execute-this-statement-http-www-cnblogs-com-xionghui-archive-2013-03-01-2939342-html-"><a href="http://www.cnblogs.com/xionghui/archive/2013/03/01/2939342.html" target="_blank">MySQL报错：The MySQL server is running with the --skip-grant-tables option so it cannot execute this statement</a></h2>
<p>The MySQL server is running with the --skip-grant-tables option so it cannot execute this statement</p>
<p>解决办法：</p>
<p>mysql&gt; set global read_only=0;
（关掉新主库的只读属性）</p>
<p> flush privileges;</p>
<p>set global read_only=1;(读写属相)</p>
<p> flush privileges;</p>
<p>Cannot execute statement: impossible to write to binary log since BINLOG_FORMAT = STATEMENT and at least one table uses a storage engine limited to row-based logging. InnoDB is limited to row-logging when transaction isolation level is READ COMMITTED or READ UNCOMMITTED.</p>
<p>  mysql&gt; SET SESSION binlog_format = &#39;ROW&#39;;
   mysql&gt; SET GLOBAL binlog_format = &#39;ROW&#39;;</p>
<h2 id="mysql5-1-binlogformat">MYSQL5.1复制参数binlogformat</h2>
<p>MySQL 5.1 中，在复制方面的改进即便引进了新的复制技巧：基于行的复制。简言之，这种新技巧即便关怀表中发生改变的登记，而非过去的照抄 binlog 形式。从 MySQL 5.1.12 开始，能够用以下三种形式来告终：基于SQL语句的复制(statement-based replication, SBR)，基于行的复制(row-based replication, RBR)，混杂形式复制(mixed-based replication, MBR)。相应地，binlog的款式也有三种：STATEMENT，ROW，MIXED。MBR 形式中，SBR 形式是默认的。
在运行时能够动态低改换binlog的款式，除非以下几种情形：</p>
<ol>
<li>存储过程可能引发器其中</li>
<li>启用了NDB</li>
<li>目前会话试用 RBR 形式，并且已敞开了临时表
万一binlog批准了 MIXED 形式，那么在以下几种情形下会积极将binlog的形式由 SBR 形式改成 RBR 形式。</li>
<li>当DML语句更新一个NDB表时</li>
<li>当函数中包括 UUID() 时</li>
<li>2个及以上包括 AUTO_INCREMENT 字段的表被更新时</li>
<li>行任何 INSERT DELAYED 语句时</li>
<li>用 UDF 时</li>
<li>视图中定然要求利用 RBR 时，例如创立视图是利用了 UUID() 函数
设定主从复制形式的措施极其容易，凡是在过去设定复制搭配的基础上，再加一个参数：
binlog_format=&quot;STATEMENT&quot;
/#binlog_format=&quot;ROW&quot;
/#binlog_format=&quot;MIXED&quot;
当然了，也能够在运行时动态修正binlog的款式。例如
mysql&gt; SET SESSION binlog_format = &#39;STATEMENT&#39;;
mysql&gt; SET SESSION binlog_format = &#39;ROW&#39;;
mysql&gt; SET SESSION binlog_format = &#39;MIXED&#39;;
mysql&gt; SET GLOBAL binlog_format = &#39;STATEMENT&#39;;
mysql&gt; SET GLOBAL binlog_format = &#39;ROW&#39;;
mysql&gt; SET GLOBAL binlog_format = &#39;MIXED&#39;;
目前来比拟以下 SBR 和 RBR 2中形式各自的优缺点
SBR 的优点：</li>
<li>历史悠久，技巧成熟</li>
<li>binlog文件较小</li>
<li>binlog中包括了所有数据库改动消息，能够据此来核实数据库的平安等情形</li>
<li>binlog能够用于实时的还原，而不但仅用于复制</li>
<li>主从版本能够不一样，从服务器版本能够比主服务器版本高
SBR 的缺点：</li>
<li>不是所有的UPDATE语句都能被复制，尤其是包括不确定垄断的时候。</li>
<li>调用具有不确定因素的 UDF 时复制也可能出问题</li>
<li>利用以下函数的语句也无法被复制：
/<em> LOAD_FILE()
/</em> UUID()
/<em> USER()
/</em> FOUND_ROWS()
/* SYSDATE() (除非启用时启用了 --sysdate-is-now 选项)</li>
<li>INSERT ... SELECT 会发生比 RBR 更多的行级锁</li>
<li>复制必需举行全表扫描(WHERE 语句中没利于用到索引)的 UPDATE 时，必需比 RBR 哀求更多的行级锁</li>
<li>对于有 AUTO_INCREMENT 字段的 InnoDB表而言，INSERT 语句会阻塞其他 INSERT 语句</li>
<li>对于一些混杂的语句，在从服务器上的耗资源情形会更严重，而 RBR 形式下，只会对那个发生改变的登记发生波及</li>
<li>存储函数(不是存储过程)在被调用的同时也会厉行顺次 NOW() 函数，这个能够说是坏事也可能是好事</li>
<li>确定了的 UDF 也必需在从服务器上厉行</li>
<li>数据表定然几乎和主服务器坚持统一才行，否则可能会导致复制出错</li>
<li>厉行混杂语句万一出错的话，会花费更多资源
RBR 的优点：</li>
<li>任何情形都能够被复制，这对复制来说是最平安可靠的</li>
<li>和其他大多数数据库系统的复制技巧一样</li>
<li>多数情形下，从服务器上的表万一有主键的话，复制就会快了许多</li>
<li>复制以下几种语句时的行锁更少：
/<em> INSERT ... SELECT
/</em> 包括 AUTO_INCREMENT 字段的 INSERT
/* 未曾附带条件可能并未曾修正许多登记的 UPDATE 或 DELETE 语句</li>
<li>厉行 INSERT，UPDATE，DELETE 语句时锁更少</li>
<li>从服务器上批准多线程来厉行复制成为可能
RBR 的缺点：</li>
<li>binlog 大了许多</li>
<li>混杂的回滚时 binlog 中会包括许多的数据</li>
<li>主服务器上厉行 UPDATE 语句时，所有发生改变的登记都会写到 binlog 中，而 SBR 只会写顺次，这会导致频繁发生
binlog 的并发写问题</li>
<li>UDF 发生的大 BLOB 值会导致复制变慢</li>
<li>无法从 binlog 中看到都复制了写什么语句</li>
<li>当在非事务表上厉行一段堆积的SQL语句时，良好批准 SBR 形式，否则很轻率导致主从服务器的数据不统一情形发生
另外，针对系统库 mysql 里面的表发生改变时的处理法定如下：</li>
<li>万一是批准 INSERT，UPDATE，DELETE 直接垄断表的情形，则日志款式依据 binlog_format 的设定而登记</li>
<li>万一是批准 GRANT，REVOKE，SET PASSWORD 等管教语句来做的话，那么无论如何都批准 SBR 形式登记
注：批准 RBR 形式后，能处理许多本来揭示的主键重复问题例如Pro Publica，SunlightFoundation和维基解密，开始添补鞭策媒体滑坡留下的空白。</li>
</ol>
<h2 id="mysql5-5mysql-5-5-binlog-3-mixed-statement-row-statement-">MYSQL5.5MySQL 5.5 中对于二进制日志 (binlog) 有 3 种不同的格式可选：Mixed,Statement,Row，默认格式是 Statement。总结一下这三种格式日志的优缺点。</h2>
<p>MySQL Replication 复制可以是基于一条语句 (Statement Level) ，也可以是基于一条记录 (Row Level)，可以在 MySQL 的配置参数中设定这个复制级别，不同复制级别的设置会影响到 Master 端的 bin-log 日志格式。</p>
<p><strong>1. Row</strong>
日志中会记录成每一行数据被修改的形式，然后在 slave 端再对相同的数据进行修改。</p>
<p><strong>优点</strong>： 在 row 模式下，bin-log 中可以不记录执行的 SQL 语句的上下文相关的信息，仅仅只需要记录那一条记录被修改了，修改成什么样了。所以 row 的日志内容会非常清楚的记录下每一行数据修改的细节，非常容易理解。而且不会出现某些特定情况下的存储过程或 function ，以及 trigger 的调用和触发无法被正确复制的问题。</p>
<p><strong>缺点</strong>：在 row 模式下，所有的执行的语句当记录到日志中的时候，都将以每行记录的修改来记录，这样可能会产生大量的日志内容，比如有这样一条 update 语句：
1 UPDATE product SET owner_member_id = &#39;b&#39; WHERE owner_member_id = &#39;a&#39;</p>
<p>执 行之后，日志中记录的不是这条 update 语句所对应的事件 (MySQL 以事件的形式来记录 bin-log 日志) ，而是这条语句所更新的每一条记录的变化情况，这样就记录成很多条记录被更新的很多个事件。自然，bin-log 日志的量就会很大。尤其是当执行 alter table 之类的语句的时候，产生的日志量是惊人的。因为 MySQL 对于 alter table 之类的表结构变更语句的处理方式是整个表的每一条记录都需要变动，实际上就是重建了整个表。那么该表的每一条记录都会被记录到日志中。</p>
<p><strong>2. Statement</strong>
每一条会修改数据的 SQL 都会记录到 master 的 bin-log 中。slave 在复制的时候 SQL 进程会解析成和原来 master 端执行过的相同的 SQL 再次执行。</p>
<p><strong>优点</strong>：在 statement 模式下，首先就是解决了 row 模式的缺点，不需要记录每一行数据的变化，减少了 bin-log 日志量，节省 I/O 以及存储资源，提高性能。因为他只需要记录在 master 上所执行的语句的细节，以及执行语句时候的上下文的信息。</p>
<p><strong>缺点</strong>： 在 statement 模式下，由于他是记录的执行语句，所以，为了让这些语句在 slave 端也能正确执行，那么他还必须记录每条语句在执行的时候的一些相关信息，也就是上下文信息，以保证所有语句在 slave 端杯执行的时候能够得到和在 master 端执行时候相同的结果。另外就是，由于 MySQL 现在发展比较快，很多的新功能不断的加入，使 MySQL 的复制遇到了不小的挑战，自然复制的时候涉及到越复杂的内容，bug 也就越容易出现。在 statement 中，目前已经发现的就有不少情况会造成 MySQL 的复制出现问题，主要是修改数据的时候使用了某些特定的函数或者功能的时候会出现，比如：sleep() 函数在有些版本中就不能被正确复制，在存储过程中使用了 last_insert_id() 函数，可能会使 slave 和 master 上得到不一致的 id 等等。由于 row 是基于每一行来记录的变化，所以不会出现类似的问题。</p>
<p><strong>3. Mixed</strong>
从 官方文档中看到，之前的 MySQL 一直都只有基于 statement 的复制模式，直到 5.1.5 版本的 MySQL 才开始支持 row 复制。从 5.0 开始，MySQL 的复制已经解决了大量老版本中出现的无法正确复制的问题。但是由于存储过程的出现，给 MySQL Replication 又带来了更大的新挑战。另外，看到官方文档说，从 5.1.8 版本开始，MySQL 提供了除 Statement 和 Row 之外的第三种复制模式：Mixed，实际上就是前两种模式的结合。在 Mixed 模式下，MySQL 会根据执行的每一条具体的 SQL 语句来区分对待记录的日志形式，也就是在 statement 和 row 之间选择一种。新版本中的 statment 还是和以前一样，仅仅记录执行的语句。而新版本的 MySQL 中对 row 模式也被做了优化，并不是所有的修改都会以 row 模式来记录，比如遇到表结构变更的时候就会以 statement 模式来记录，如果 SQL 语句确实就是 update 或者 delete 等修改数据的语句，那么还是会记录所有行的变更。</p>
<p><strong>其他参考信息</strong></p>
<p><strong>除以下几种情况外，在运行时可以动态改变 binlog 的格式</strong>：
. 存储流程或者触发器中间；
. 启用了 NDB；
. 当前会话使用 row 模式，并且已打开了临时表；</p>
<p><strong>如果 binlog 采用了 Mixed 模式，那么在以下几种情况下会自动将 binlog 的模式由 statement 模式变为 row 模式</strong>：
. 当 DML 语句更新一个 NDB 表时；
. 当函数中包含 UUID() 时；
. 2 个及以上包含 AUTO_INCREMENT 字段的表被更新时；
. 执行 INSERT DELAYED 语句时；
. 用 UDF 时；
. 视图中必须要求运用 row 时，例如建立视图时使用了 UUID() 函数；</p>
<p><strong>设定主从复制模式</strong>：
1 2 3 4 log-bin=mysql-bin /#binlog_format=&quot;STATEMENT&quot; /#binlog_format=&quot;ROW&quot; binlog_format=&quot;MIXED&quot;</p>
<p><strong>也可以在运行时动态修改 binlog 的格式。例如</strong>：</p>
<p>1 2 3 4 5 6 mysql&gt; SET SESSION binlog_format = &#39;STATEMENT&#39;; mysql&gt; SET SESSION binlog_format = &#39;ROW&#39;; mysql&gt; SET SESSION binlog_format = &#39;MIXED&#39;; mysql&gt; SET GLOBAL binlog_format = &#39;STATEMENT&#39;; mysql&gt; SET GLOBAL binlog_format = &#39;ROW&#39;; mysql&gt; SET GLOBAL binlog_format = &#39;MIXED&#39;;</p>
<p><strong>两种模式的对比</strong>：
<strong>Statement 优点</strong>
历史悠久，技术成熟；
产生的 binlog 文件较小；
binlog 中包含了所有数据库修改信息，可以据此来审核数据库的安全等情况；
binlog 可以用于实时的还原，而不仅仅用于复制；
主从版本可以不一样，从服务器版本可以比主服务器版本高；</p>
<p><strong>Statement 缺点</strong>：
不是所有的 UPDATE 语句都能被复制，尤其是包含不确定操作的时候；
调用具有不确定因素的 UDF 时复制也可能出现问题；
运用以下函数的语句也不能被复制：
/<em> LOAD_FILE()
/</em> UUID()
/<em> USER()
/</em> FOUND_ROWS()
/* SYSDATE() (除非启动时启用了 –sysdate-is-now 选项)
INSERT … SELECT 会产生比 RBR 更多的行级锁；
复制须要执行全表扫描 (WHERE 语句中没有运用到索引) 的 UPDATE 时，须要比 row 请求更多的行级锁；
对于有 AUTO_INCREMENT 字段的 InnoDB 表而言，INSERT 语句会阻塞其他 INSERT 语句；
对于一些复杂的语句，在从服务器上的耗资源情况会更严重，而 row 模式下，只会对那个发生变化的记录产生影响；
存储函数(不是存储流程 )在被调用的同时也会执行一次 NOW() 函数，这个可以说是坏事也可能是好事；
确定了的 UDF 也须要在从服务器上执行；
数据表必须几乎和主服务器保持一致才行，否则可能会导致复制出错；
执行复杂语句如果出错的话，会消耗更多资源；</p>
<p><strong>Row 优点</strong>
任何情况都可以被复制，这对复制来说是最安全可靠的；
和其他大多数数据库系统的复制技能一样；
多数情况下，从服务器上的表如果有主键的话，复制就会快了很多；
复制以下几种语句时的行锁更少：
/<em> INSERT … SELECT
/</em> 包含 AUTO_INCREMENT 字段的 INSERT
/* 没有附带条件或者并没有修改很多记录的 UPDATE 或 DELETE 语句
执行 INSERT，UPDATE，DELETE 语句时锁更少；
从服务器上采用多线程来执行复制成为可能；</p>
<p><strong>Row 缺点</strong>
生成的 binlog 日志体积大了很多；
复杂的回滚时 binlog 中会包含大量的数据；
主服务器上执行 UPDATE 语句时，所有发生变化的记录都会写到 binlog 中，而 statement 只会写一次，这会导致频繁发生 binlog 的写并发请求；
UDF 产生的大 BLOB 值会导致复制变慢；
不能从 binlog 中看到都复制了写什么语句(加密过的)；
当在非事务表上执行一段堆积的 SQL 语句时，最好采用 statement 模式，否则很容易导致主从服务器的数据不一致情况发生；
另外，针对系统库 MySQL 里面的表发生变化时的处理准则如下：
如果是采用 INSERT，UPDATE，DELETE 直接操作表的情况，则日志格式根据 binlog_format 的设定而记录；
如果是采用 GRANT，REVOKE，SET PASSWORD 等管理语句来做的话，那么无论如何都要使用 statement 模式记录；
使用 statement 模式后，能处理很多原先出现的主键重复问题；</p>
<p>分类: <a href="http://www.cnblogs.com/xionghui/category/341683.html" target="_blank">mysql</a></p>
<p>绿色通道： <a href="">好文要顶</a> <a href="">关注我</a> <a href="">收藏该文</a><a href="http://space.cnblogs.com/msg/send/_%e5%ae%89%e9%9d%99" target="_blank">与我联系</a> <a href="&quot;分享至新浪微博&quot;"><img src="" alt=""></a>
<a href="http://home.cnblogs.com/u/xionghui/" target="_blank">_安静</a>
<a href="http://home.cnblogs.com/u/xionghui/followees" target="_blank">关注 - 5</a>
<a href="http://home.cnblogs.com/u/xionghui/followers" target="_blank">粉丝 - 8</a></p>
<p><a href="">+加关注</a></p>
<p>0</p>
<p>0
(请您对文章做出评价)</p>
<p><a href="http://www.cnblogs.com/xionghui/archive/2012/07/15/2592876.html" target="_blank">«</a> 上一篇：<a href="http://www.cnblogs.com/xionghui/archive/2012/07/15/2592876.html" title="发布于2012-07-15 23:50" target="_blank">vs2005下配置OGRE</a>
<a href="http://www.cnblogs.com/xionghui/archive/2013/03/07/2947384.html" target="_blank">»</a> 下一篇：<a href="http://www.cnblogs.com/xionghui/archive/2013/03/07/2947384.html" title="发布于2013-03-07 09:13" target="_blank">Cubic Spline三次样条曲线</a></p>
<p>posted on 2013-03-01 19:37 <a href="http://www.cnblogs.com/xionghui/" target="_blank">_安静</a> 阅读(641) 评论(0) <a href="http://www.cnblogs.com/xionghui/admin/EditPosts.aspx?postid=2939342" target="_blank">编辑</a> <a href="">收藏</a></p>
<p><a href="">刷新评论</a><a href="">刷新页面</a><a href="">返回顶部</a></p>
<p>注册用户登录后才能发表评论，请 <a href="">登录</a> 或 <a href="">注册</a>，<a href="http://www.cnblogs.com/" target="_blank">访问</a>网站首页。
<a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园首页</a><a href="http://q.cnblogs.com/" title="程序员问答社区" target="_blank">博问</a><a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a></p>
<p><strong>最新IT新闻</strong>:
· <a href="http://news.cnblogs.com/n/185243/" target="_blank">烧钱不断的Ubuntu——一个理想主义者的故事</a>
· <a href="http://news.cnblogs.com/n/185242/" target="_blank">配4100万像素摄像头 Hyetis Crossbow智能手表</a>
· <a href="http://news.cnblogs.com/n/185241/" target="_blank">金正恩都说好的朝鲜手机是国产山寨？</a>
· <a href="http://news.cnblogs.com/n/185240/" target="_blank">3D视差效果：23张iOS 7壁纸免费下载</a>
· <a href="http://news.cnblogs.com/n/185239/" target="_blank">免费！广告屏蔽插件Adblock正式发布IE版</a>
» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></p>
<p><strong>最新知识库文章</strong>:
· <a href="http://kb.cnblogs.com/page/180323/" target="_blank">我现在是这样编程的</a>
· <a href="http://kb.cnblogs.com/page/178891/" target="_blank">如何做到 jQuery-free？</a>
· <a href="http://kb.cnblogs.com/page/185000/" target="_blank">如何成为一位优秀的创业CEO</a>
· <a href="http://kb.cnblogs.com/page/184977/" target="_blank">十年前的Java企业应用开发世界</a>
· <a href="http://kb.cnblogs.com/page/184935/" target="_blank">专注做好一件事</a>
» <a href="http://kb.cnblogs.com/" target="_blank">更多知识库文章...</a>
<strong>历史上的今天:</strong>
2012-03-01 <a href="http://www.cnblogs.com/xionghui/archive/2012/03/01/2375513.html" target="_blank">Eclipse中web-inf和meta-inf文件夹的信息</a>
2012-03-01 <a href="http://www.cnblogs.com/xionghui/archive/2012/03/01/2375503.html" target="_blank">在Eclipse中创建WEB工程步骤</a></p>
<h3 id="-">公告</h3>
<p>昵称：<a href="http://home.cnblogs.com/u/xionghui/" target="_blank">_安静</a>
园龄：<a href="http://home.cnblogs.com/u/xionghui/" title="入园时间：2011-12-07" target="_blank">1年8个月</a>
粉丝：<a href="http://home.cnblogs.com/u/xionghui/followers/" target="_blank">8</a>
关注：<a href="http://home.cnblogs.com/u/xionghui/followees/" target="_blank">5</a></p>
<p><a href="">+加关注</a></p>
<h3 id="-">导航</h3>
<ul>
<li><a href="http://www.cnblogs.com/" target="_blank">博客园</a></li>
<li><a href="http://www.cnblogs.com/xionghui/" target="_blank">首页</a></li>
<li><a href="http://www.cnblogs.com/xionghui/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a></li>
<li><a href="http://space.cnblogs.com/msg/send/_%e5%ae%89%e9%9d%99" target="_blank">联系</a></li>
<li><a href="http://www.cnblogs.com/xionghui/rss" target="_blank">订阅</a><a href="http://www.cnblogs.com/xionghui/rss" target="_blank"><img src="" alt="订阅"></a></li>
<li><a href="http://www.cnblogs.com/xionghui/admin/EditPosts.aspx" target="_blank">管理</a>
<a href="">&lt;</a>2013年3月<a href="">&gt;</a>日一二三四五六2425262728<a href="http://www.cnblogs.com/xionghui/archive/2013/03/01.html" target="_blank">1</a>23456<a href="http://www.cnblogs.com/xionghui/archive/2013/03/07.html" target="_blank">7</a>8910111213141516171819202122232425262728293031123456</li>
</ul>
<h3 id="-">统计</h3>
<ul>
<li>随笔 - 63</li>
<li>文章 - 0</li>
<li>评论 - 2</li>
<li>引用 - 0<h3 id="-">搜索</h3>
</li>
</ul>
<h3 id="-">常用链接</h3>
<ul>
<li><a href="http://www.cnblogs.com/xionghui/MyPosts.html" target="_blank">我的随笔</a></li>
<li><a href="http://www.cnblogs.com/xionghui/MyComments.html" target="_blank">我的评论</a></li>
<li><a href="http://www.cnblogs.com/xionghui/OtherPosts.html" title="我发表过评论的随笔" target="_blank">我的参与</a></li>
<li><a href="http://www.cnblogs.com/xionghui/RecentComments.html" target="_blank">最新评论</a></li>
<li><a href="http://www.cnblogs.com/xionghui/tag/" target="_blank">我的标签</a></li>
</ul>
<h3 id="-">我的标签</h3>
<ul>
<li><a href="http://www.cnblogs.com/xionghui/tag/redmine1.2.2%E5%AE%89%E8%A3%85    ruby1.8.7   rubygem1.6.2/" target="_blank">redmine1.2.2安装 ruby1.8.7 rubygem1.6.2</a>(5)</li>
<li><a href="http://www.cnblogs.com/xionghui/tag/eclipse/" target="_blank">eclipse</a>(3)</li>
<li><a href="http://www.cnblogs.com/xionghui/tag/html css javascript jquery easyui/" target="_blank">html css javascript jquery easyui</a>(3)</li>
<li><a href="http://www.cnblogs.com/xionghui/tag/tomcat%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/" target="_blank">tomcat安装和配置</a>(2)</li>
<li><a href="http://www.cnblogs.com/xionghui/tag/xhEditor/" target="_blank">xhEditor</a>(1)</li>
<li><a href="http://www.cnblogs.com/xionghui/tag/HTML5/" target="_blank">HTML5</a>(1)</li>
<li><a href="http://www.cnblogs.com/xionghui/tag/jdk%E9%85%8D%E7%BD%AE/" target="_blank">jdk配置</a>(1)</li>
<li><a href="http://www.cnblogs.com/xionghui/tag/ogre/" target="_blank">ogre</a>(1)</li>
<li><a href="http://www.cnblogs.com/xionghui/tag/php%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/" target="_blank">php安装和配置</a>(1)</li>
<li><a href="http://www.cnblogs.com/xionghui/tag/serv-u%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/" target="_blank">serv-u安装配置</a>(1)</li>
<li><a href="http://www.cnblogs.com/xionghui/tag/" target="_blank">更多</a></li>
</ul>
<h3 id="-46-">随笔分类(46)</h3>
<ul>
<li><a href="http://www.cnblogs.com/xionghui/category/362695.html" target="_blank">ant(1)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/362804.html" target="_blank">c c++</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/341738.html" target="_blank">Coldfusion(6)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/367982.html" target="_blank">discuz(3)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/361900.html" target="_blank">easyUI</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/361898.html" target="_blank">html(1)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/367981.html" target="_blank">inno setup(2)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/362803.html" target="_blank">java(2)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/361899.html" target="_blank">javascript(4)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/361897.html" target="_blank">jquery(2)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/341683.html" target="_blank">mysql(9)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/396246.html" target="_blank">Ogre(1)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/341014.html" target="_blank">ruby redmine(4)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/357315.html" target="_blank">struts2(3)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/366403.html" target="_blank">study(2)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/361984.html" target="_blank">tomcat(1)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/362028.html" target="_blank">web(4)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/category/457545.html" target="_blank">数值分析(1)</a></li>
</ul>
<h3 id="-63-">随笔档案(63)</h3>
<ul>
<li><a href="http://www.cnblogs.com/xionghui/archive/2013/03.html" target="_blank">2013年3月 (2)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/07.html" target="_blank">2012年7月 (2)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/05.html" target="_blank">2012年5月 (8)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/04.html" target="_blank">2012年4月 (5)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/03.html" target="_blank">2012年3月 (28)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/02.html" target="_blank">2012年2月 (9)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2011/12.html" target="_blank">2011年12月 (9)</a></li>
</ul>
<h3 id="mysql-">mysql下载</h3>
<h3 id="-">最新评论</h3>
<h3 id="-">阅读排行榜</h3>
<ul>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/03/01/2375503.html" target="_blank">1. 在Eclipse中创建WEB工程步骤(11416)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2011/12/09/2281827.html" target="_blank">2. redmine-1.2.2安装截图粘贴插件(7722)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2011/12/08/2281229.html" target="_blank">3. redmine-1.2.2安装代码评审插件(6289)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/03/11/2390258.html" target="_blank">4. tomcat配置文件web.xml与server.xml解析--重要(6112)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2011/12/08/2280518.html" target="_blank">5. redmine-1.2.2安装服务（附图）(6089)</a></li>
</ul>
<h3 id="-">评论排行榜</h3>
<ul>
<li><a href="http://www.cnblogs.com/xionghui/archive/2011/12/10/2283229.html" target="_blank">1. Mysql安装配置(2)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2011/12/09/2281827.html" target="_blank">2. redmine-1.2.2安装截图粘贴插件(0)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/03/11/2389927.html" target="_blank">3. jQuery 数据表： 将单个列导出到 Excel(0)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/03/11/2389792.html" target="_blank">4. MYSQL启用日志，查看日志，利用mysqlbinlog工具恢复MySQL数据库(0)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/03/11/2389790.html" target="_blank">5. mysql数据库my.ini配置文件中文详解(0)</a></li>
</ul>
<h3 id="-">推荐排行榜</h3>
<ul>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/03/11/2389791.html" target="_blank">1. mysqldump 常用备份选项,只备份数据或结构的方法(3)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2011/12/10/2283229.html" target="_blank">2. Mysql安装配置(2)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/03/12/2392555.html" target="_blank">3. web绿色环境搭建(2)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2012/03/11/2390258.html" target="_blank">4. tomcat配置文件web.xml与server.xml解析--重要(2)</a></li>
<li><a href="http://www.cnblogs.com/xionghui/archive/2011/12/10/2283556.html" target="_blank">5. Coldfusion 7 生成验证码实例(CF验证码)(1)</a></li>
</ul>
<p>Powered by: <a href="http://www.cnblogs.com/" target="_blank">博客园</a> Copyright © _安静</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/mysql/">mysql</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/mysql/" class="label label-success">mysql</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:33"datetime="2014-03-07 09:54:33"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-mysql--MySQL报错：TheMySQLserverisrunningwiththe--ski/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-mysql--MySQL报错：TheMySQLserverisrunningwiththe--ski" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-mysql--MySQL运维笔记（一）——终止高负载SQL/">MySQL 运维笔记（一）—— 终止高负载SQL</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:33.000Z"> <a href="/2014/02/02/2014-02-02-DB-mysql--MySQL运维笔记（一）——终止高负载SQL/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="mysql-sql">MySQL 运维笔记（一）—— 终止高负载SQL</h1>
<p>数据库表体积大了，负载高了，难免一个sql出去耗时延长。半个月前，一个凌晨定时任务跑了8小时，突然手足无措。最后找DBA协助，直接干掉了这个sql进程。
其实，这并不复杂。
首先，找出占用CPU时间过长的SQL
Sql代码 <a href="&quot;复制代码&quot;"><img src="" alt="复制代码"></a> <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>show processlist;  </li>
</ol>
<p>show processlist;</p>
<p><img src="" alt="">
 假定最后一条sql处于Query状态，且Time时间过长，就锁定它的ID，直接干掉即可。</p>
<p>然后，杀死进程：</p>
<p>Sql代码 <a href="&quot;复制代码&quot;"><img src="" alt="复制代码"></a> <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>kill QUERY  4487855;  </li>
</ol>
<p>kill QUERY  4487855;</p>
<p> 这就大功告成了！</p>
<p> 参考</p>
<p>KILL [CONNECTION | QUERY] thread_id</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/mysql/">mysql</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/mysql/" class="label label-success">mysql</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:33"datetime="2014-03-07 09:54:33"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-mysql--MySQL运维笔记（一）——终止高负载SQL/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-mysql--MySQL运维笔记（一）——终止高负载SQL" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-DB-mariadb--超越MySQL：三个流行MySQL分支的对比摘录-Speeddsy的专栏-博客频道-/">超越MySQL：三个流行MySQL分支的对比(摘录) </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:33.000Z"> <a href="/2014/02/02/2014-02-02-DB-mariadb--超越MySQL：三个流行MySQL分支的对比摘录-Speeddsy的专栏-博客频道-/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-mysql-mysql-speeddsy-csdn-net">超越MySQL：三个流行MySQL分支的对比(摘录) - Speeddsy的专栏 - 博客频道 - CSDN.NET</h1>
<p>您还未登录！|<a href="https://passport.csdn.net/account/login" target="_blank">登录</a>|<a href="https://passport.csdn.net/account/register" target="_blank">注册</a>|<a href="https://passport.csdn.net/help/faq" target="_blank">帮助</a></p>
<ul>
<li><a href="http://www.csdn.net/" target="_blank">首页</a></li>
<li><a href="http://news.csdn.net/" target="_blank">业界</a></li>
<li><a href="http://mobile.csdn.net/" target="_blank">移动</a></li>
<li><a href="http://cloud.csdn.net/" target="_blank">云计算</a></li>
<li><a href="http://sd.csdn.net/" target="_blank">研发</a></li>
<li><a href="http://bbs.csdn.net/" target="_blank">论坛</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">博客</a></li>
<li><a href="http://download.csdn.net/" target="_blank">下载</a></li>
<li><h2 id="-"><a href="">更多</a></h2>
</li>
</ul>
<h1 id="-speeddsy-http-blog-csdn-net-speeddsy-"><a href="http://blog.csdn.net/Speeddsy" target="_blank">Speeddsy的专栏</a></h1>
<h2 id="-">我的博客我说行！</h2>
<ul>
<li><a href="http://blog.csdn.net/Speeddsy?viewmode=contents" target="_blank"><img src="" alt="">目录视图</a></li>
<li><a href="http://blog.csdn.net/Speeddsy?viewmode=list" target="_blank"><img src="" alt="">摘要视图</a></li>
<li><a href="http://blog.csdn.net/Speeddsy/rss/list" target="_blank"><img src="" alt="">订阅</a>
<a href="http://surveies.csdn.net/survey/comein/532" target="_blank">博客专家信息更新登记表</a>        <a href="http://blog.csdn.net/blogdevteam/article/details/8572108" target="_blank">社区专家谈 12306</a>      <a href="http://bbs.csdn.net/topics/390373496" target="_blank">CSDN社区程序员回乡见闻活动火爆开始！</a>
<a href="http://www.csdn.net/article/2013-02-26/2814263" target="_blank">专访周家安：我的十年编程自学之路</a>        <a href="http://blog.csdn.net/csdnstudent/article/details/8077932" target="_blank">2013年全国百所高校巡讲讲师招募</a></li>
</ul>
<h3 id="-mysql-mysql-"><a href="">超越MySQL：三个流行MySQL分支的对比(摘录)</a></h3>
<p>分类： <a href="http://blog.csdn.net/Speeddsy/article/category/1166947" target="_blank">数据库</a>  2012-06-16 16:32 178人阅读 <a href="http://blog.csdn.net/speeddsy/article/details/7669150#comments" target="_blank">评论</a>(0) <a href="&quot;收藏&quot;">收藏</a> <a href="http://blog.csdn.net/speeddsy/article/details/7669150#report" title="举报" target="_blank">举报</a>
<a href="http://blog.csdn.net/tag/details.html?tag=mysql" target="_blank">mysql</a><a href="http://blog.csdn.net/tag/details.html?tag=%e5%bc%95%e6%93%8e" target="_blank">引擎</a><a href="http://blog.csdn.net/tag/details.html?tag=%e4%ba%a7%e5%93%81" target="_blank">产品</a><a href="http://blog.csdn.net/tag/details.html?tag=server" target="_blank">server</a><a href="http://blog.csdn.net/tag/details.html?tag=%e5%ad%98%e5%82%a8" target="_blank">存储</a><a href="http://blog.csdn.net/tag/details.html?tag=%e6%89%a9%e5%b1%95" target="_blank">扩展</a></p>
<p><strong>三个流行MySQL分支：Drizzle、MariaDB和Percona Server（包括XtraDB引擎）</strong></p>
<p><strong>XtraDB</strong></p>
<p>XtraDB是一款独立的产品，但它仍被认为是MySQL的一个分支。XtraDB实际上是基于MySQL的数据库的一个存储引擎。XtraDB被认为是已成为MySQL一部分的标准MyISAM和InnoDB的一个额外存储引擎。</p>
<p>XtraDB分支有另一个目标，即成为InnoDB存储引擎的简单替代，这样用户就可以轻松地切换其存储引擎，无需更改任何现有的应用程序代码。XtraDB必须能够向后兼容InnoDB，以提供它们想要添加的所有新功能和改进。它们实现了此目标。</p>
<p>XtraDB的速度有多快？我找到的一个性能测试表明：与内置的MySQL 5.1 InnoDB 引擎相比，它每分钟可处理2.7倍的事务。（请参见参考资料）。速度显然是一个不可以忽略的因素，在考虑替代产品时更是如此。</p>
<p><strong>Percona</strong></p>
<p>与内置的MySQL存储引擎相比，XtraDB提供了一些极大的改进，但它不是一款独立产品，也无法轻松放入现有MySQL安装。因此，如果您想使用这款新引擎，则必须使用提供它的产品。采用Percona Server的一个很好的理由是，利用XtraDB引擎来尽可能地减少代码更改。</p>
<p>下面是Percona Server的声明，该声明来自它们自己的网站：</p>
<ul>
<li>可扩展性：处理更多事务；在强大的服务器上进行扩展</li>
<li>性能：使用了XtraDB的Percona Server速度非常快</li>
<li>可靠性：避免损坏，提供崩溃安全(crash-safe)复制</li>
<li>管理：在线备份，在线表格导入/导出</li>
<li>诊断：高级分析和检测</li>
<li>灵活性：可变的页面大小，改进的缓冲池管理</li>
</ul>
<p>Percona Server的一个缺点是他们自己管理代码，不接受外部开发人员的贡献，以这种方式确保他们对产品中所包含功能的控制。</p>
<p><strong>MariaDB</strong></p>
<p>另一款提供了XtraDB存储引擎的产品是MariaDB产品。它与Percona产品非常类似，但是提供了更多底层代码更改，试图提供比标准MySQL更多的性能改进</p>
<p>MariaDB提供了MySQL提供的标准存储引擎，即MyISAM和InnoDB。因此，实际上，可以将它视为MySQL的扩展集，它不仅提供MySQL提供的所有功能，还提供其他功能。MariaDB还声称自己是MySQL的替代，因此从MySQL切换到MariaDB时，无需更改任何基本代码即可安装它。</p>
<p><strong>Drizzle</strong></p>
<p>本文介绍的最后一款产品是Drizzle。与之前介绍的两款产品不同，Drizzle与MySQL有很大差别，甚至声称它们不是MySQL的替代产品。他们期望对MySQL进行一些重大更改，想要提供一种出色的解决方案来解决高可用性问题，即使这意味着要更改我们已经习惯了的MySQL的各个方面。</p>
<p>是不是所有人都应该使用Drizzle呢？等等，正如Drizzle反复指出的那样，它与MySQL不兼容。因此，如果您现在使用的是MySQL平台，那么需要重写大量代码，才能使Drizzle在您的环境中正常工作</p>
<p>尽管需要额外的工作才能让它运行，但它并不像Percona或MariaDB那样快速且易于使用。我之所以介绍Drizzle，是因为尽管目前它可能不是您的选择，但几年之后，它很可能会成为一些人的选择。因为本文的目标是提高您对未来使用的工具的认识，所以这是向您介绍此产品的好机会。许多领先的DB专家相信Drizzle将成为未来5年内高可用性数据库安装的选择。
分享到： <a href="&quot;分享到新浪微博&quot;"></a><a href="&quot;分享到腾讯微博&quot;"></a></p>
<ul>
<li>上一篇：<a href="http://blog.csdn.net/speeddsy/article/details/7667621" target="_blank">Windows7下MySQL5.5.20免安装版的配置</a></li>
<li><p>下一篇：<a href="http://blog.csdn.net/speeddsy/article/details/7669425" target="_blank">eclipse 配置知识</a>
查看评论<a href=""></a></p>
<p>暂无评论
您还没有登录,请<a href="">[登录]</a>或<a href="http://passport.csdn.net/account/register?from=http%3A%2F%2Fblog.csdn.net%2Fspeeddsy%2Farticle%2Fdetails%2F7669150" target="_blank">[注册]</a></p>
</li>
</ul>
<p>/* 以上用户言论只代表其个人观点，不代表CSDN网站的观点或立场<a href=""></a><a href=""></a>
<a href="http://blog.csdn.net/speeddsy/article/details/7669150#" title="回到顶部" target="_blank"><img src="" alt="TOP"></a></p>
<p>个人资料</p>
<p><a href="http://my.csdn.net/Speeddsy" target="_blank"><img src="&quot;访问我的空间&quot;" alt=""></a>
<a href="http://my.csdn.net/Speeddsy" target="_blank">Speeddsy</a></p>
<p><a href="&quot;[加关注]&quot;"></a> <a href="&quot;[发私信]&quot;"></a></p>
<ul>
<li>访问：2619次</li>
<li>积分：58分</li>
<li><p>排名：千里之外</p>
</li>
<li><p>原创：1篇</p>
</li>
<li>转载：13篇</li>
<li>译文：0篇</li>
<li>评论：2条</li>
</ul>
<p>文章分类</p>
<ul>
<li><a href="http://blog.csdn.net/speeddsy/article/category/1277200" target="_blank">互联网</a>(0)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/category/1166947" target="_blank">数据库</a>(6)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/category/1167373" target="_blank">java</a>(5)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/category/1167164" target="_blank">c/c++</a>(3)</li>
<li><p><a href="http://blog.csdn.net/speeddsy/article/category/1187660" target="_blank">其它</a>(1)
文章存档</p>
</li>
<li><p><a href="http://blog.csdn.net/speeddsy/article/month/2012/11" target="_blank">2012年11月</a>(1)</p>
</li>
<li><a href="http://blog.csdn.net/speeddsy/article/month/2012/07" target="_blank">2012年07月</a>(1)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/month/2012/06" target="_blank">2012年06月</a>(12)</li>
</ul>
<p>文章搜索</p>
<p><a href=""></a>
阅读排行</p>
<ul>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7751270" title="福昕pdf套件注册码激活" target="_blank">福昕pdf套件注册码激活</a>(640)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7661602" title="codeblocks 使用汇总" target="_blank">codeblocks 使用汇总</a>(418)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7667611" title="MySQL5.5 配置文件 my.ini" target="_blank">MySQL5.5 配置文件 my.ini</a>(327)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7677726" title="30 Best Eclipse Plugins" target="_blank">30 Best Eclipse Plugins</a>(248)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7662626" title="eclipse保存个人设置preference" target="_blank">eclipse保存个人设置preference</a>(200)</li>
<li><a href="&quot;超越MySQL：三个流行MySQL分支的对比(摘录">超越MySQL：三个流行MySQL分支的对比(摘录)</a>&quot;)(177)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7667621" title="Windows7下MySQL5.5.20免安装版的配置" target="_blank">Windows7下MySQL5.5.20免安装版的配置</a>(110)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7660647" title="MySQL Workbench的使用教程" target="_blank">MySQL Workbench的使用教程</a>(105)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7694735" title="You can&#39;t specify target table &#39;sc1&#39; for update in FROM clause" target="_blank">You can&#39;t specify target table &#39;sc1&#39; for update in FROM clause</a>(93)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7669425" title="eclipse 配置知识" target="_blank">eclipse 配置知识</a>(79)</li>
</ul>
<p>评论排行</p>
<ul>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7660647" title="MySQL Workbench的使用教程" target="_blank">MySQL Workbench的使用教程</a>(1)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7662626" title="eclipse保存个人设置preference" target="_blank">eclipse保存个人设置preference</a>(1)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7751270" title="福昕pdf套件注册码激活" target="_blank">福昕pdf套件注册码激活</a>(0)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7694735" title="You can&#39;t specify target table &#39;sc1&#39; for update in FROM clause" target="_blank">You can&#39;t specify target table &#39;sc1&#39; for update in FROM clause</a>(0)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7677726" title="30 Best Eclipse Plugins" target="_blank">30 Best Eclipse Plugins</a>(0)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7677667" title="10款常用Java测试工具" target="_blank">10款常用Java测试工具</a>(0)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7669609" title="jdk与jre的区别" target="_blank">jdk与jre的区别</a>(0)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7669425" title="eclipse 配置知识" target="_blank">eclipse 配置知识</a>(0)</li>
<li><a href="&quot;超越MySQL：三个流行MySQL分支的对比(摘录">超越MySQL：三个流行MySQL分支的对比(摘录)</a>&quot;)(0)</li>
<li><a href="http://blog.csdn.net/speeddsy/article/details/7667621" title="Windows7下MySQL5.5.20免安装版的配置" target="_blank">Windows7下MySQL5.5.20免安装版的配置</a>(0)
推荐文章</li>
</ul>
<p>最新评论</p>
<ul>
<li><a href="http://blog.csdn.net/Speeddsy/article/details/7660647#comments" target="_blank">MySQL Workbench的使用教程</a></li>
</ul>
<p><a href="http://blog.csdn.net/lnas01" target="_blank">随便啦</a>: 请问这篇文章怎么转载啊。。。</p>
<ul>
<li><a href="http://blog.csdn.net/Speeddsy/article/details/7662626#comments" target="_blank">eclipse保存个人设置preference</a></li>
</ul>
<p><a href="http://blog.csdn.net/greateryang" target="_blank">greateryang</a>: 好用，此文章推荐寻找此方法的同志都看看</p>
<p><a href="http://www.csdn.net/company/about.html" target="_blank">公司简介</a>|<a href="http://www.csdn.net/company/recruit.html" target="_blank">招贤纳士</a>|<a href="http://www.csdn.net/company/marketing.html" target="_blank">广告服务</a>|<a href="http://www.csdn.net/company/account.html" target="_blank">银行汇款帐号</a>|<a href="http://www.csdn.net/company/contact.html" target="_blank">联系方式</a>|<a href="http://www.csdn.net/company/statement.html" target="_blank">版权声明</a>|<a href="http://www.csdn.net/company/layer.html" target="_blank">法律顾问</a>|<a href="mailto:webmaster@csdn.net">问题报告</a>京 ICP 证 070598 号北京创新乐知信息技术有限公司 版权所有世纪乐知(北京)网络技术有限公司 提供技术支持江苏乐知网络技术有限公司 提供商务支持<img src="" alt=""> 联系邮箱：webmaster(at)csdn.netCopyright © 1999-2012, CSDN.NET, All Rights Reserved <a href="http://www.hd315.gov.cn/beian/view.asp?bianhao=010202001032100010" target="_blank"><img src="" alt="GongshangLogo"></a>
<img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/DB/">DB</a></li></span><span class="breadcrumb"><li><a href="/categories/DB/">DB</a></li><li><a href="/categories/DB/mariadb/">mariadb</a></li></span></span> | <span class="tags">Tagged <a href="/tags/DB/" class="label label-primary">DB</a><a href="/tags/mariadb/" class="label label-success">mariadb</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:33"datetime="2014-03-07 09:54:33"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-DB-mariadb--超越MySQL：三个流行MySQL分支的对比摘录-Speeddsy的专栏-博客频道-/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-DB-mariadb--超越MySQL：三个流行MySQL分支的对比摘录-Speeddsy的专栏-博客频道-" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/130/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/128/">128</a></li><li><a class="page-number" href="/page/129/">129</a></li><li><a class="page-number" href="/page/130/">130</a></li><li class="active"><li><span class="page-number current">131</span></li><li><a class="page-number" href="/page/132/">132</a></li><li><a class="page-number" href="/page/133/">133</a></li><li><a class="page-number" href="/page/134/">134</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="page-number" href="/page/163/">163</a></li><li><a class="extend next" href="/page/132/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-03-30 14:30:16</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
