
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 22 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-xml-xstream--使用XStream序列化、反序列化XML数据时遇到的各种问题/">使用XStream序列化、反序列化XML数据时遇到的各种问题</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-xml-xstream--使用XStream序列化、反序列化XML数据时遇到的各种问题/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-xstream-xml-">使用XStream序列化、反序列化XML数据时遇到的各种问题</h1>
<p>现在参与的项目是一个纯Application Server，整个Server都是自己搭建的，使用JMS消息实现客户端和服务器的交互，交互的数据格式采用XML。说来惭愧，开始为了赶进度，所有XML消息都是使用字符串拼接的，而XML的解析则是使用DOM方式查找的。我很早就看这些代码不爽了，可惜一直没有时间去重构，最近项目加了几个人，而且美国那边也开始渐渐的把这个项目开发的控制权交给我们了，所以我开始有一些按自己的方式开发的机会了。因而最近动手开始重构这些字符串拼接的代码。</p>
<p>对XML到Java Bean的解析框架，熟悉一点的只有Digester和XStream，Digester貌似只能从XML文件解析成Java Bean对象，所以只能选择XStream来做了，而且同组的其他项目也有在用XStream。一直听说XStream的使用比较简单，而且我对ThoughtWorks这家公司一直比较有好感，所以还以为引入XStream不会花太多时间，然而使用以后才发现XStream并没有想象的你那么简单。不过这个也有可能是因为我不想改变原来的XML数据格式，而之前的XML数据格式的设计自然不会考虑到如何便利的使用XStream。因而记录在使用过程中遇到的问题，供后来人参考，也为自己以后如果打算开其源码提供参考。废话就到这里了，接下来步入正题。</p>
<p>首先对于简单的引用，XStream使用起来确实比较简单，比如自定义标签的属性、使用属性和使用子标签的定义等：
@XStreamAlias(&quot;request&quot;)
public class XmlRequest1 {
    private static XStream xstream;
    static {
        xstream = new XStream();
        xstream.autodetectAnnotations(true);
    }</p>
<pre><code>@XStreamAsAttribute
private String from;

@XStreamAsAttribute
@XStreamAlias(&quot;calculate-method&quot;)
private String calculateMethod;

@XStreamAlias(&quot;request-time&quot;)
private Date requestTime;

@XStreamAlias(&quot;input-files&quot;)
private List&lt;InputFileInfo&gt; inputFiles;

public static String toXml(XmlRequest1 request) {
    StringWriter writer = new StringWriter();
    writer.append(Constants.XML_HEADER);
    xstream.toXML(request, writer);
    return writer.toString();
}
public static XmlRequest1 toInstance(String xmlContent) {
    return (XmlRequest1)xstream.fromXML(xmlContent);
</code></pre><p>}
<img src="" alt="">
    @XStreamAlias(&quot;input-file&quot;)
    public static class InputFileInfo {
        private String type;
        private String fileName;
        <img src="" alt="">
    }
    public static void main(String[] args) {
        XmlRequest1 request = buildXmlRequest();
        System.out.println(XmlRequest1.toXml(request));
    }
    private static XmlRequest1 buildXmlRequest() {
        <img src="" alt="">
    }
}</p>
<p> 对以上Request定义，我们可以得到如下结果：</p>
<p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</p>
<request from="levin@host" calculate-method="advanced">
 <request-time>2012-11-28 17:11:54.664 UTC</request-time>
 <input-files>
    <input-file>
      <type>DATA</type>
      <fileName>data.2012.11.29.dat</fileName>
    </input-file>
    <input-file>
      <type>CALENDAR</type>
      <fileName>calendar.2012.11.29.dat</fileName>
    </input-file>
 </input-files>
</request>

<p>可惜这个世界不会那么清净，这个格式有些时候貌似并不符合要求，比如request-time的格式、input-files的格式，我们实际需要的格式是这样的：</p>
<p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</p>
<request from="levin@host" calculate-method="advanced">
 <request-time>20121128T17:51:05</request-time>
 <input-file type="DATA">data.2012.11.29.dat</input-file>
 <input-file type="CALENDAR">calendar.2012.11.29.dat</input-file>
</request>

<p>对不同Date格式的支持可以是用Converter实现，在XStream中默认使用自己实现的DateConverter，它支持的格式是：yyyy-MM-dd HH:mm:ss.S &#39;UTC&#39;，然而我们现在需要的格式是yyyy-MM-dd’T’HH:mm:ss，如果使用XStream直接注册DateConverter，可以使用配置自己的DateConverter，但是由于DateConverter的构造函数的定义以及@XStreamConverter的构造函数参数的支持方式的限制，貌似DateConverter不能很好的支持注解方式的注册，因而我时间了一个自己的DateConverter以支持注解：</p>
<p>public class LevinDateConverter extends DateConverter {
    public LevinDateConverter(String dateFormat) {
        super(dateFormat, new String[] { dateFormat });
    }
}</p>
<p>在requestTime字段中需要加入以下注解定义：</p>
<p>@XStreamConverter(value=LevinDateConverter.class, strings={&quot;yyyyMMdd&#39;T&#39;HH:mm:ss&quot;})
@XStreamAlias(&quot;request-time&quot;)
private Date requestTime;</p>
<p>对集合类，XStream提供了@XStreamImplicit注解，以将集合中的内容摊平到上一层XML元素中，其中itemFieldName的值为其使用的标签名，此时InputFileInfo类中不需要@XStreamAlias标签的定义：</p>
<p>@XStreamImplicit(itemFieldName=&quot;input-file&quot;)
private List<InputFileInfo> inputFiles;</p>
<p>对InputFileInfo中的字段，type作为属性很容易，只要为它加上@XStreamAsAttribute注解即可，而将fileName作为input-file标签的一个内容字符串，则需要使用ToAttributedValueConverter，其中Converter的参数为需要作为字符串内容的字段名：</p>
<p>@XStreamConverter(value=ToAttributedValueConverter.class, strings={&quot;fileName&quot;})
public static class InputFileInfo {
    @XStreamAsAttribute
    private String type;
private String fileName;
<img src="" alt="">
}</p>
<p>XStream对枚举类型的支持貌似不怎么好，默认注册的EnumSingleValueConverter只是使用了Enum提供的name()和静态的valueOf()方法将enum转换成String或将String转换回enum。然而有些时候XML的字符串和类定义的enum值并不完全匹配，最常见的就是大小写的不匹配，此时需要写自己的Converter。在这种情况下，我一般会在enum中定义一个name属性，这样就可以自定义enum的字符串表示。比如有TimePeriod的enum：</p>
<p>public enum TimePeriod {
    MONTHLY(&quot;monthly&quot;), WEEKLY(&quot;weekly&quot;), DAILY(&quot;daily&quot;);</p>
<pre><code>private String name;

public String getName() {
    return name;
}

private TimePeriod(String name) {
    this.name = name;
}

public static TimePeriod toEnum(String timePeriod) {
    try {
        return Enum.valueOf(TimePeriod.class, timePeriod);
    } catch(Exception ex) {
        for(TimePeriod period : TimePeriod.values()) {
            if(period.getName().equalsIgnoreCase(timePeriod)) {
                return period;
            }
        }
        throw new IllegalArgumentException(&quot;Cannot convert &lt;&quot; + timePeriod + &quot;&gt; to TimePeriod enum&quot;);
    }
}
</code></pre><p>}</p>
<p>我们可以编写以下Converter以实现对枚举类型的更宽的容错性：</p>
<p>public class LevinEnumSingleNameConverter extends EnumSingleValueConverter {
    private static final String CUSTOM_ENUM_NAME_METHOD = &quot;getName&quot;;
    private static final String CUSTOM_ENUM_VALUE_OF_METHOD = &quot;toEnum&quot;;</p>
<pre><code>private Class&lt;? extends Enum&lt;?&gt;&gt; enumType;

public LevinEnumSingleNameConverter(Class&lt;? extends Enum&lt;?&gt;&gt; type) {
    super(type);
    this.enumType = type;
}

@Override
public String toString(Object obj) {
    Method method = getCustomEnumNameMethod();
    if(method == null) {
        return super.toString(obj);
    } else {
        try {
            return (String)method.invoke(obj, (Object[])null);
        } catch(Exception ex) {
            return super.toString(obj);
        }
    }
}

@Override
public Object fromString(String str) {
    Method method = getCustomEnumStaticValueOfMethod();
    if(method == null) {
        return enhancedFromString(str);
    }
    try {
        return method.invoke(null, str);
    } catch(Exception ex) {
        return enhancedFromString(str);
    }
}

private Method getCustomEnumNameMethod() {
    try {
        return enumType.getMethod(CUSTOM_ENUM_NAME_METHOD, (Class&lt;?&gt;[])null);
    } catch(Exception ex) {
        return null;
    }
}

private Method getCustomEnumStaticValueOfMethod() {
    try {
        Method method = enumType.getMethod(CUSTOM_ENUM_VALUE_OF_METHOD, (Class&lt;?&gt;[])null);
        if(method.getModifiers() == Modifier.STATIC) {
            return method;
        }
        return null;
    } catch(Exception ex) {
        return null;
    }
}

private Object enhancedFromString(String str) {
    try {
        return super.fromString(str);
    } catch(Exception ex) {
        for(Enum&lt;?&gt; item : enumType.getEnumConstants()) {
            if(item.name().equalsIgnoreCase(str)) {
                return item;
            }
        }
        throw new IllegalStateException(&quot;Cannot converter &lt;&quot; + str + &quot;&gt; to enum &lt;&quot; + enumType + &quot;&gt;&quot;);
    }
}
</code></pre><p>}</p>
<p>如下方式使用即可：</p>
<p>@XStreamAsAttribute
@XStreamAlias(&quot;time-period&quot;)
@XStreamConverter(value=LevinEnumSingleNameConverter.class)
private TimePeriod timePeriod;</p>
<p>对double类型，貌似默认的DoubleConverter实现依然不给力，它不支持自定义的格式，比如我们想在序列化的时候用一下格式：” /#/#/#,/#/#0.0/#/#/#/#/#/#/#/#”，此时又需要编写自己的Converter：</p>
<p>public class FormatableDoubleConverter extends DoubleConverter {
    private String pattern;
    private DecimalFormat formatter;</p>
<pre><code>public FormatableDoubleConverter(String pattern) {
    this.pattern = pattern;
    this.formatter = new DecimalFormat(pattern);
}

@Override
public String toString(Object obj) {
    if(formatter == null) {
        return super.toString(obj);
    } else {
        return formatter.format(obj);
    }
}

@Override
public Object fromString(String str) {
    try {
        return super.fromString(str);
    } catch(Exception ex) {
        if(formatter != null) {
            try {
                return formatter.parse(str);
            } catch(Exception e) {
                throw new IllegalArgumentException(&quot;Cannot parse &lt;&quot; + str + &quot;&gt; to double value&quot;, e);
            }
        }
        throw new IllegalArgumentException(&quot;Cannot parse &lt;&quot; + str + &quot;&gt; to double value&quot;, ex);
    }
}

public String getPattern() {
    return pattern;
}
</code></pre><p>}</p>
<p>使用方式和之前的Converter类似：</p>
<p>@XStreamAsAttribute
@XStreamConverter(value=FormatableDoubleConverter.class, strings={&quot;/#/#/#,/#/#0.0/#/#/#/#/#/#/#/#&quot;})
private double value;</p>
<p>最后，还有两个XStream没法实现的，或者说我没有找到一个更好的实现方式的场景。<strong>第一种场景是**</strong>XStream<strong>**不能很好的处理对象组合问题：</strong></p>
<p>在面向对象编程中，一般尽量的倾向于抽取相同的数据成一个类，而通过组合的方式构建整个数据结构。比如Student类中有name、address，Address是一个类，它包含city、code、street等信息，此时如果要对Student对象做如下格式序列化：</p>
<student name=”Levin”>
 <city>shanghai</city>
 <street>zhangjiang</street>
 <code>201203</code>
</student>

<p>貌似我没有找到可以实现的方式，XStream能做是在中间加一层address标签。对这种场景的解决方案，一种是将Address中的属性平摊到Student类中，另一种是让Student继承自Address类。不过貌似这两种都不是比较理想的办法。</p>
<p><strong>第二种场景是XStream**</strong>不能很好的处理多态问题：**</p>
<p>比如我们有一个Trade类，它可能表示不同的产品：
public class Trade {
    private String tradeId;
    private Product product;
<img src="" alt="">
}
abstract class Product {
    private String name;
    public Product(String name) {
        this.name = name;
}
<img src="" alt="">
}
class FX extends Product {
    private double ratio;
    public FX() {
        super(&quot;fx&quot;);
    }
    <img src="" alt="">
}
class Future extends Product {
    private double maturity;
    public Future() {
        super(&quot;future&quot;);
    }
    <img src="" alt="">
}</p>
<p>通过一些简单的设置，我们能得到如下XML格式：</p>
<trades>
 <trade trade-id="001">
    <product class="levin.xstream.blog.FX" name="fx" ratio="0.59"/>
 </trade>
 <trade trade-id="002">
    <product class="levin.xstream.blog.Future" name="future" maturity="2.123"/>
 </trade>
</trades>

<p>作为数据文件，对Java类的定义显然是不合理的，因而简单一些，我们可以编写自己的Converter将class属性从product中去除：</p>
<p>xstream.registerConverter(new ProductConverter(
        xstream.getMapper(), xstream.getReflectionProvider()));</p>
<pre><code>public ProductConverter(Mapper mapper, ReflectionProvider reflectionProvider) {
    super(mapper, reflectionProvider);
}

@Override
public boolean canConvert(@SuppressWarnings(&quot;rawtypes&quot;) Class type) {
    return Product.class.isAssignableFrom(type);
}

@Override
protected Object instantiateNewInstance(HierarchicalStreamReader reader, UnmarshallingContext context) {
    Object currentObject = context.currentObject();
    if(currentObject != null) {
        return currentObject;
    }

    String name = reader.getAttribute(&quot;name&quot;);
    if(&quot;fx&quot;.equals(name)) {
        return reflectionProvider.newInstance(FX.class);
    } else if(&quot;future&quot;.equals(name)) {
        return reflectionProvider.newInstance(Future.class);
    }
    throw new IllegalStateException(&quot;Cannot convert &lt;&quot; + name + &quot;&gt; product&quot;);
}
</code></pre><p>}</p>
<p>在所有Production上定义@XStreamAlias(“product”)注解。这时的XML输出结果为：</p>
<trades>
 <trade trade-id="001">
    <product name="fx" ratio="0.59"/>
 </trade>
 <trade trade-id="002">
    <product name="future" maturity="2.123"/>
 </trade>
</trades>

<p>然而如果有人希望XML的输出结果如下呢?</p>
<trades>
 <trade trade-id="001">
    <fx ratio="0.59"/>
 </trade>
 <trade trade-id="002">
    <future maturity="2.123"/>
 </trade>
</trades>

<p>大概找了一下，可能可以定义自己的Mapper来解决，不过XStream的源码貌似比较复杂，没有时间深究这个问题，留着以后慢慢解决吧。</p>
<p><strong>补充：</strong></p>
<p>对Map类型数据，XStream默认使用以下格式显示：</p>
<map class="linked-hash-map">
    <entry>
      <string>key1</string>
      <string>value1</string>
    </entry>
    <entry>
      <string>key2</string>
      <string>value2</string>
    </entry>
 </map>



<p>但是对一些简单的Map，我们希望如下显示：
 <map>
    <entry key="key1" value="value1"/>
    <entry key="key2" value="value2"/>
 </map></p>
<p>对这种需求需要通过编写Converter解决，继承自MapConverter，覆盖以下函数，这里的Map默认key和value都是String类型，如果他们不是String类型，需要另外添加逻辑：
@SuppressWarnings(&quot;rawtypes&quot;)
@Override
public void marshal(Object source, HierarchicalStreamWriter writer,
        MarshallingContext context) {
    Map map = (Map) source;
    for (Iterator iterator = map.entrySet().iterator(); iterator.hasNext();) {
        Entry entry = (Entry) iterator.next();
        ExtendedHierarchicalStreamWriterHelper.startNode(writer, mapper()
                .serializedClass(Map.Entry.class), entry.getClass());</p>
<pre><code>    writer.addAttribute(&quot;key&quot;, entry.getKey().toString());
    writer.addAttribute(&quot;value&quot;, entry.getValue().toString());
    writer.endNode();
}
</code></pre><p>}</p>
<p>@Override
@SuppressWarnings({ &quot;unchecked&quot;, &quot;rawtypes&quot; })
protected void putCurrentEntryIntoMap(HierarchicalStreamReader reader,
        UnmarshallingContext context, Map map, Map target) {
    Object key = reader.getAttribute(&quot;key&quot;);
    Object value = reader.getAttribute(&quot;value&quot;);</p>
<pre><code>target.put(key, value);
</code></pre><p>}</p>
<p>但是只是使用Converter，得到的结果多了一个class属性：
 <map class="linked-hash-map">
    <entry key="key1" value="value1"/>
    <entry key="key2" value="value2"/>
 </map></p>
<p>在XStream中，如果定义的字段是一个父类或接口，在序列化是会默认加入class属性以确定反序列化时用的类，为了去掉这个class属性，可以定义默认的实现类来解决（虽然感觉这种解决方案不太好，但是目前还没有找到更好的解决方案）。</p>
<p><em>*
</em>xstream.addDefaultImplementation(LinkedHashMap.class, Map.class);*</p>
<p>来源： <a href="[http://www.blogjava.net/DLevin/archive/2012/11/30/392240.html](http://www.blogjava.net/DLevin/archive/2012/11/30/392240.html)">[http://www.blogjava.net/DLevin/archive/2012/11/30/392240.html](http://www.blogjava.net/DLevin/archive/2012/11/30/392240.html)</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/xml/">xml</a></li></span><span class="breadcrumb"><li><a href="/categories/xml/">xml</a></li><li><a href="/categories/xml/xstream/">xstream</a></li></span></span> | <span class="tags">Tagged <a href="/tags/xml/" class="label label-primary">xml</a><a href="/tags/xstream/" class="label label-success">xstream</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-xml-xstream--使用XStream序列化、反序列化XML数据时遇到的各种问题/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-xml-xstream--使用XStream序列化、反序列化XML数据时遇到的各种问题" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-服务器--HowDoesGoogleWorkLearnHowGoogleWorksSear/">How Does Google Work  Learn How Google Works  Sear</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-服务器--HowDoesGoogleWorkLearnHowGoogleWorksSear/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="how-does-google-work-learn-how-google-works-search-engine-adwords">How Does Google Work Learn How Google Works Search Engine + AdWords</h1>
<ul>
<li><a href="http://ppcblog.com/blog" target="_blank">Blog</a></li>
<li><a href="http://ppcblog.com/ppc-assets" target="_blank">Free PPC Assets</a></li>
<li><a href="http://ppcblog.com/about" target="_blank">About Us</a></li>
<li><a href="http://ppcblog.com/member-tour-new-users-1" target="_blank">PPC Training Tour</a></li>
<li><a href="https://ppcblog.com/amember/member.php" target="_blank">Member Login »</a></li>
</ul>
<h1 id="-ppc-blog-http-ppcblog-com-"><a href="http://ppcblog.com/" target="_blank">PPC Blog</a></h1>
<h1 id="learn-how-google-works-in-gory-detail">Learn How Google Works: in Gory Detail</h1>
<p><a href="http://pinterest.com/pin/create/button/?url=http%3A%2F%2Fppcblog.com%2Fhow-google-works%2F&amp;media=http%3A%2F%2Fppcblog.com%2Fhow-google-works%2Fhow-google-works.jpg&amp;description=How%20Google%20Works" target="_blank">888</a>  <a href="http://twitter.com/share" target="_blank">Tweet</a> 388
<a href="">inShare</a>  <a href="">digg</a></p>
<p><img src="" alt="How Google Works."></p>
<p><a href="http://news.ycombinator.com/item?id=1472981" target="_blank">Vote on Hacker News</a>, or <img src="http://static.delicious.com/img/delicious.small.gif" alt="Delicious"> <a href="http://delicious.com/save" target="_blank">Bookmark this on Delicious</a></p>
<h2 id="free-add-this-infographic-to-your-website-">FREE: add this infographic to your website!</h2>
<h3 id="600-pixel-wide-version">600 Pixel Wide Version</h3>
<p><a href="http://www.ppcblog.com/how-google-works/" target="_blank"><img src="http://ppcblog.com/how-google-works/600.jpg" border="0" alt="How Google Works." /></a></p><p>Infographic by the <a href="http://ppcblog.com/" target="_blank">Pay Per Click Blog</a></p>

<h3 id="large-version">Large Version</h3>
<p><p><a href="http://www.ppcblog.com/how-google-works/" target="_blank"><img src="http://ppcblog.com/how-google-works/how-google-works.jpg" border="0" alt="How Does Google Work?" /></a></p><p>Infographic by <a href="http://ppcblog.com/" target="_blank">PPCBlog</a></p>
Copyright 2011 - 2013 PPC Training Inc. - All Rights Reserved</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/服务器/">服务器</a></li></span></span> | <span class="tags">Tagged <a href="/tags/服务器/" class="label label-primary">服务器</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-服务器--HowDoesGoogleWorkLearnHowGoogleWorksSear/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-服务器--HowDoesGoogleWorkLearnHowGoogleWorksSear" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-服务器--基于tomcat7web开发中的一点小东西/">基于tomcat7 web开发中的一点小东西</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-服务器--基于tomcat7web开发中的一点小东西/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-tomcat7-web-">基于tomcat7 web开发中的一点小东西</h1>
<p><a href="http://blog.csdn.net/benyuxy/article/details/7568386" target="_blank">基于tomcat7 web开发中的一点小东西</a></p>
<h3 id="-">控制台：</h3>
<p>org.apache.jasper.compiler.TldLocationsCache tldScanJar</p>
<p>信息: At least one JAR was scanned for TLDs yet contained no TLDs. Enable debug logging for this logger for a complete list of JARs that were scanned but no TLDs were found in them. Skipping unneeded JARs during scanning can improve startup time and JSP compilation time.
这样的问题是你的页面中含有<!---->的注释 去掉就好了，tomcat7.0.20.</p>
<p>tomcat 7对EL表达式的语法要求比较严格，例如&quot;${owner.new}&quot;因包含关键字new就会导致解析出错。 
问题是出来了，怎么解决呢？有三种，如下： 
第一种：严格遵守java规范，修改对象的属性名称，要求不包含java关键字; 
第二种：修改EL表达式，例如&quot;${owner.new}&quot;可以修改为&quot;${owner[&#39;new&#39;]}&quot;; 
第三种：修改tomcat属性，忽略对EL表达式的关键字检查。修改$CATALINA_BASE/conf/catalina.properties文件，添加org.apache.el.parser.SKIP_IDENTIFIER_CHECK=true选项。</p>
<p>来源： <a href="[http://blog.csdn.net/benyuxy/article/details/7568386](http://blog.csdn.net/benyuxy/article/details/7568386)">[http://blog.csdn.net/benyuxy/article/details/7568386](http://blog.csdn.net/benyuxy/article/details/7568386)</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/服务器/">服务器</a></li></span></span> | <span class="tags">Tagged <a href="/tags/服务器/" class="label label-primary">服务器</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-服务器--基于tomcat7web开发中的一点小东西/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-服务器--基于tomcat7web开发中的一点小东西" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-服务器--tomcat中的contextxml元素详解-pasha-BlogJava/">tomcat中的context.xml元素详解 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-服务器--tomcat中的contextxml元素详解-pasha-BlogJava/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="tomcat-context-xml-pasha-blogjava">tomcat中的context.xml元素详解 - pasha - BlogJava</h1>
<h1 id="-pasha-http-www-blogjava-net-pasha-"><a href="http://www.blogjava.net/pasha/" target="_blank">pasha</a></h1>
<h2 id="-tomcat-context-xml-"><a href="">tomcat中的context.xml元素详解</a></h2>
<p><strong>tomcat中的context.xml元素详解小人物，大博客 Q&#39;e ^ L0J/*J4h
</strong> <strong>元素名</strong> <strong>属性</strong> <strong>解释</strong> server port 指定一个端口，这个端口负责监听关闭tomcat的请求 shutdown 指定向端口发送的命令字符串 service name 指定service的名字 Connector(表示客户端和service之间的连接) port 指定服务器端要创建的端口号，并在这个端口监听来自客户端的请求 minProcessors 服务器启动时创建的处理请求的线程数 maxProcessors 最大可以创建的处理请求的线程数 enableLookups 如果为true，则可以通过调用request.getRemoteHost()进行DNS查询来得到远程客户端的实际主机名，若为false则不进行DNS查询，而是返回其ip地址 redirectPort 指定服务器正在处理http请求时收到了一个SSL传输请求后重定向的端口号 acceptCount 指定当所有可以使用的处理请求的线程数都被使用时，可以放到处理队列中的请求数，超过这个数的请求将不予处理 connectionTimeout 指定超时的时间数(以毫秒为单位) Engine(表示指定service中的请求处理机，接收和处理来自Connector的请求) defaultHost 指定缺省的处理请求的主机名，它至少与其中的一个host元素的name属性值是一样的 Context(表示一个web应用程序，通常为WAR文件，关于WAR的具体信息见servlet规范) docBase 应用程序的路径或者是WAR文件存放的路径 path 表示此web应用程序的url的前缀，这样请求的url为<a href="http://localhost:8080/path//*/*/*/*" target="_blank">http://localhost:8080/path//*/*/*/*</a> reloadable 这个属性非常重要，如果为true，则tomcat会自动检测应用程序的/WEB-INF/lib 和/WEB-INF/classes目录的变化，自动装载新的应用程序，我们可以在不重起tomcat的情况下改变应用程序 host(表示一个虚拟主机) name 指定主机名 appBase 应用程序基本目录，即存放应用程序的目录 unpackWARs 如果为true，则tomcat会自动将WAR文件解压，否则不解压，直接从WAR文件中运行应用程序 Logger(表示日志，调试和错误信息) className 指定logger使用的类名，此类必须实现org.apache.catalina.Logger 接口 prefix 指定log文件的前缀 suffix 指定log文件的后缀 timestamp 如果为true，则log文件名中要加入时间，如下例:localhost_log.2001-10-04.txt Realm(表示存放用户名，密码及role的数据库) className 指定Realm使用的类名，此类必须实现org.apache.catalina.Realm接口 Valve(功能与Logger差不多，其prefix和suffix属性解释和Logger 中的一样) className 指定Valve使用的类名，如用org.apache.catalina.valves.AccessLogValve类可以记录应用程序的访问信息 directory 指定log文件存放的位置 pattern 有两个值，common方式记录远程主机名或ip地址，用户名，日期，第一行请求的字符串，HTTP响应代码，发送的字节数。combined方式比common方式记录的值更多</p>
<p>posted on 2008-09-21 11:14 <a href="http://www.blogjava.net/pasha/" target="_blank">pasha</a> 阅读(2524) <a href="http://www.blogjava.net/pasha/articles/230241.html#Post" target="_blank">评论(0)</a>  <a href="http://www.blogjava.net/pasha/admin/EditArticles.aspx?postid=230241" target="_blank">编辑</a>  <a href="http://www.blogjava.net/pasha/AddToFavorite.aspx?id=230241" target="_blank">收藏</a></p>
<p> <img src="" alt=""></p>
<p><a href="http://www.blogjava.net/RequireRegister.aspx" target="_blank">新用户注册</a>  <a href="">刷新评论列表</a>  </p>
<p><a href=""></a> <a href="http://www.cnblogs.com/cmt/archive/2012/10/31/vmware_vforum_2012.html">开发者的云计算盛会，期待您的参与（11月20日~21日，北京，免费）</a>   <a href="http://www.cnblogs.com/" target="_blank">博客园</a>  <a href="http://q.cnblogs.com/" target="_blank">博问</a>  <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>  <a href="http://job.cnblogs.com/cate-java_programmer/" target="_blank">Java程序员招聘</a> 标题  请输入标题 姓名  请输入你的姓名 主页 请输入验证码 验证码 /*  <img src="" alt=""> 内容(请不要发表任何与政治相关的内容) 请输入评论内容 Remember Me?   <a href="http://www.blogjava.net/login.aspx?ReturnURL=http://www.blogjava.net/pasha/articles/230241.html&amp;SourceURL=/pasha/articles/230241.html" target="_blank">登录</a>       [使用Ctrl+Enter键可以直接提交]    IT新闻：
· <a href="http://news.cnblogs.com/n/163329/" target="_blank">让你的iPhone 5变身小电视</a>
· <a href="http://news.cnblogs.com/n/163348/" target="_blank">流言终结者 /#19 –「我只要专心把产品做好…」</a>
· <a href="http://news.cnblogs.com/n/163347/" target="_blank">来看看1399元的Lumia究竟如何</a>
· <a href="http://news.cnblogs.com/n/163346/" target="_blank">周鸿祎给李彦宏一个支点</a>
· <a href="http://news.cnblogs.com/n/163345/" target="_blank">Twitter HOLD 住大选：少点 Ruby，多些 Java</a></p>
<p>博客园首页随笔：
· <a href="http://www.cnblogs.com/bjzhanghao/archive/2012/11/09/2762550.html" target="_blank">[Android问答] 如何实现“退出应用”功能？</a>
· <a href="http://www.cnblogs.com/vamei/archive/2012/11/09/2762224.html" target="_blank">Python内置函数清单</a>
· <a href="http://www.cnblogs.com/manuosex/archive/2012/11/09/2762405.html" target="_blank">C/#数据结构与算法揭秘13</a>
· <a href="http://www.cnblogs.com/ldcsaa/archive/2012/11/09/2762373.html" target="_blank">Portal-Basic Java Web 应用开发框架：应用篇（八） —— Freemarker 整合</a>
· <a href="http://www.cnblogs.com/nnhy/archive/2012/11/09/Money.html" target="_blank">如何找到并完成兼职项目</a>
知识库：
· <a href="http://kb.cnblogs.com/page/157087/" target="_blank">项目管理心得：一个项目经理的个人体会、经验总结</a>
· <a href="http://kb.cnblogs.com/page/162480/" target="_blank">十天内掌握线性代数：惊人的超速学习实验</a>
· <a href="http://kb.cnblogs.com/page/157745/" target="_blank">可伸缩性最佳实践：来自eBay的经验</a>
· <a href="http://kb.cnblogs.com/page/160526/" target="_blank">一堂如何提高代码质量的培训课</a>
· <a href="http://kb.cnblogs.com/page/161182/" target="_blank">程序江湖</a>  网站导航:</p>
<p><a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园</a>   <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>   <a href="http://kb.cnblogs.com/" target="_blank">知识库</a>   <a href="http://www.cppblog.com/" target="_blank">C++博客</a>   <a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a>   <a href="http://www.blogjava.net/pasha/articles/230241.html?opt=admin" target="_blank">管理</a>   </p>
<h3 id="-">导航</h3>
<ul>
<li><a href="http://www.blogjava.net/" target="_blank">BlogJava</a></li>
<li><a href="http://www.blogjava.net/pasha/" target="_blank">首页</a></li>
<li><a href="http://www.blogjava.net/pasha/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a></li>
<li><a href="http://www.blogjava.net/pasha/contact.aspx?id=1" target="_blank">联系</a></li>
<li><a href="http://www.blogjava.net/pasha/rss" target="_blank">聚合</a><a href="http://www.blogjava.net/pasha/rss" target="_blank"><img src="" alt=""></a></li>
<li><a href="http://www.blogjava.net/pasha/admin/EditPosts.aspx" target="_blank">管理</a></li>
</ul>
<h3 id="-">统计</h3>
<ul>
<li>随笔 - 7</li>
<li>文章 - 10</li>
<li>评论 - 1</li>
<li>引用 - 0</li>
</ul>
<h3 id="-">常用链接</h3>
<ul>
<li><a href="http://www.blogjava.net/pasha/MyPosts.html" target="_blank">我的随笔</a></li>
<li><a href="http://www.blogjava.net/pasha/MyArticles.html" target="_blank">我的文章</a></li>
<li><a href="http://www.blogjava.net/pasha/MyComments.html" target="_blank">我的评论</a></li>
<li><a href="http://www.blogjava.net/pasha/OtherPosts.html" target="_blank">我的参与</a></li>
<li><a href="http://www.blogjava.net/pasha/RecentComments.html" target="_blank">最新评论</a></li>
</ul>
<h3 id="-2-">留言簿(2)</h3>
<ul>
<li><a href="http://www.blogjava.net/pasha/Contact.aspx?id=1" target="_blank">给我留言</a></li>
<li><a href="http://www.blogjava.net/pasha/default.aspx?opt=msg" target="_blank">查看公开留言</a></li>
<li><a href="http://www.blogjava.net/pasha/admin/MyMessages.aspx" target="_blank">查看私人留言</a></li>
</ul>
<h3 id="-">随笔分类</h3>
<ul>
<li><a href="http://www.blogjava.net/pasha/category/33818.html" target="_blank">ajax</a> <a href="http://www.blogjava.net/pasha/category/33818.html/rss" title="Subscribe to ajax" target="_blank">(rss)</a></li>
<li><a href="http://www.blogjava.net/pasha/category/34754.html" target="_blank">database</a> <a href="http://www.blogjava.net/pasha/category/34754.html/rss" title="Subscribe to database" target="_blank">(rss)</a></li>
<li><a href="http://www.blogjava.net/pasha/category/33817.html" target="_blank">struts2(1)</a> <a href="http://www.blogjava.net/pasha/category/33817.html/rss" title="Subscribe to struts2(1)" target="_blank">(rss)</a></li>
<li><a href="http://www.blogjava.net/pasha/category/34753.html" target="_blank">tomcat(2)</a> <a href="http://www.blogjava.net/pasha/category/34753.html/rss" title="Subscribe to tomcat(2)" target="_blank">(rss)</a></li>
<li><a href="http://www.blogjava.net/pasha/category/35370.html" target="_blank">其他(2)</a> <a href="http://www.blogjava.net/pasha/category/35370.html/rss" title="Subscribe to 其他(2)" target="_blank">(rss)</a></li>
</ul>
<h3 id="-">随笔档案</h3>
<ul>
<li><a href="http://www.blogjava.net/pasha/archive/2008/10.html" target="_blank">2008年10月 (2)</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/09.html" target="_blank">2008年9月 (3)</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/06.html" target="_blank">2008年6月 (1)</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/04.html" target="_blank">2008年4月 (1)</a></li>
</ul>
<h3 id="-">文章分类</h3>
<ul>
<li><a href="http://www.blogjava.net/pasha/category/35369.html" target="_blank">其它</a> <a href="http://www.blogjava.net/pasha/category/35369.html/rss" title="Subscribe to 其它" target="_blank">(rss)</a></li>
</ul>
<h3 id="-">文章档案</h3>
<ul>
<li><a href="http://www.blogjava.net/pasha/archives/2008/09.html" target="_blank">2008年9月 (4)</a></li>
<li><a href="http://www.blogjava.net/pasha/archives/2008/08.html" target="_blank">2008年8月 (2)</a></li>
<li><a href="http://www.blogjava.net/pasha/archives/2008/07.html" target="_blank">2008年7月 (1)</a></li>
<li><a href="http://www.blogjava.net/pasha/archives/2008/06.html" target="_blank">2008年6月 (2)</a></li>
</ul>
<h3 id="-css-">最常用和实用的CSS技巧</h3>
<h3 id="-">最新随笔</h3>
<ul>
<li><a href="http://www.blogjava.net/pasha/archive/2008/10/21/235638.html" target="_blank">1. Ubuntu Linux与Windows系统多启动的配置(Webmaster )</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/10/21/235617.html" target="_blank">2. Bcdedit命令详解</a></li>
<li><a href="http://www.blogjava.net/pasha/articles/230555.html" target="_blank">3. JQuery Ajax 方法说明</a></li>
<li><a href="http://www.blogjava.net/pasha/articles/230458.html" target="_blank">4. EditPlus技巧(Liangjhrn)</a></li>
<li><a href="http://www.blogjava.net/pasha/articles/230372.html" target="_blank">5. 转载：《关于JSP页面中的pageEncoding和contentType两种属性的区别》</a></li>
<li><a href="">6. tomcat中的context.xml元素详解</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/09/21/230237.html" target="_blank">7. Tomcat6数据源配置（转）</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/09/21/230227.html" target="_blank">8. tomcat 6.18 设置</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/09/09/227881.html" target="_blank">9. struts2UI td 的问题</a></li>
<li><a href="http://www.blogjava.net/pasha/articles/222926.html" target="_blank">10. 几款MYSQL管理工具</a></li>
</ul>
<h3 id="-">搜索</h3>
<p>*</p>
<ul>
<li></li>
</ul>
<h3 id="-http-www-blogjava-net-pasha-commentsrss-aspx-">最新评论 <a href="http://www.blogjava.net/pasha/CommentsRSS.aspx" target="_blank"><img src="" alt=""></a></h3>
<ul>
<li><a href="http://www.blogjava.net/pasha/archive/2008/09/24/208536.html#230938" target="_blank">1. re: SESSION</a></li>
<li>啊！！原来是这样啊 终于明白了 谢了！！</li>
<li>--ndj</li>
</ul>
<h3 id="-">阅读排行榜</h3>
<ul>
<li><a href="http://www.blogjava.net/pasha/archive/2008/09/21/230227.html" target="_blank">1. tomcat 6.18 设置(711)</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/04/08/191507.html" target="_blank">2. SSO (转)(613)</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/10/21/235617.html" target="_blank">3. Bcdedit命令详解(407)</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/09/21/230237.html" target="_blank">4. Tomcat6数据源配置（转）(338)</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/06/17/208536.html" target="_blank">5. SESSION(181)</a></li>
</ul>
<h3 id="-">评论排行榜</h3>
<ul>
<li><a href="http://www.blogjava.net/pasha/archive/2008/06/17/208536.html" target="_blank">1. SESSION(1)</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/04/08/191507.html" target="_blank">2. SSO (转)(0)</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/10/21/235638.html" target="_blank">3. Ubuntu Linux与Windows系统多启动的配置(Webmaster )(0)</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/10/21/235617.html" target="_blank">4. Bcdedit命令详解(0)</a></li>
<li><a href="http://www.blogjava.net/pasha/archive/2008/09/21/230237.html" target="_blank">5. Tomcat6数据源配置（转）(0)</a></li>
</ul>
<p>Powered by:
<a href="http://www.blogjava.net/" target="_blank">BlogJava</a>
Copyright © pasha</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/服务器/">服务器</a></li></span></span> | <span class="tags">Tagged <a href="/tags/服务器/" class="label label-primary">服务器</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-服务器--tomcat中的contextxml元素详解-pasha-BlogJava/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-服务器--tomcat中的contextxml元素详解-pasha-BlogJava" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--HeapSort/">HeapSort</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--HeapSort/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="heapsort">HeapSort</h1>
<h1 id="-algorithm-gossip-heap-"><a href="">Algorithm Gossip: Heap 排序法 - 改良的选择排序</a></h1>
<h2 id="-">说明</h2>
<p>选择排序法的概念简单，每次从未排序部份选一最小值，插入已排序部份的后端，其时间主要花费于在整个未排序部份寻找最小值，如果能让搜寻最小值的方式加 快，选择排序法的速率也就可以加快，Heap排序法让搜寻的路径由树根至最后一个树叶，而不是整个未排序部份，因而称之为改良的选择排序法。</p>
<h2 id="-">解法</h2>
<p>Heap排序法使用Heap Tree（堆积树），树是一种资料结构，而堆积树是一个二元树，也就是每一个父节点最多只有两个子节点（关于树的详细定义还请见资料结构书籍），堆积树的 父节点若小于子节点，则称之为最小堆积（Min Heap），父节点若大于子节点，则称之为最大堆积（Max Heap），而同一层的子节点则无需理会其大小关系，例如下面就是一个堆积树：
<img src="&quot;Heap 排序&quot;" alt="Heap 排序">
可以使用一维阵列来储存堆积树的所有元素与其顺序，为了计算方便，使用的起始索引是1而不是0，索引1是树根位置，如果左子节点储存在阵列中的索引为s，则其父节点的索引为s/2，而右子节点为s+1，就如上图所示，将上图的堆积树转换为一维阵列之后如下所示：
<img src="&quot;Heap 排序&quot;" alt="Heap 排序">
首先必须知道如何建立堆积树，加至堆积树的元素会先放置在最后一个树叶节点位置，然后检查父节点是否小于子节点（最小堆积），将小的元素不断与父节点交换，直到满足堆积树的条件为止，例如在上图的堆积加入一个元素12，则堆积树的调整方式如下所示：
<img src="&quot;Heap 排序&quot;" alt="Heap 排序">
建立好堆积树之后，树根一定是所有元素的最小值，您的目的就是：</p>
<ol>
<li>将最小值取出</li>
<li>然后调整树为堆积树
不断重复以上的步骤，就可以达到排序的效果，最小值的取出方式是将树根与最后一个树叶节点交换，然后切下树叶节点，重新调整树为堆积树，如下所示：
<img src="&quot;Heap 排序&quot;" alt="Heap 排序">
调整完毕后，树根节点又是最小值了，于是我们可以重覆这个步骤，再取出最小值，并调整树为堆积树，如下所示：
<img src="&quot;Heap 排序&quot;" alt="Heap 排序">
如此重覆步骤之后，由于使用一维阵列来储存堆积树，每一次将树叶与树根交换的动作就是将最小值放至后端的阵列，所以最后阵列就是变为已排序的状态。
其实堆积在调整的过程中，就是一个选择的行为，每次将最小值选至树根，而选择的路径并不是所有的元素，而是由树根至树叶的路径，因而可以加快选择的过程， 所以Heap排序法才会被称之为改良的选择排序法。</li>
</ol>
<h2 id="-">实作</h2>
<ul>
<li><p>C
/#include <stdio.h>
/#include <stdlib.h>
/#include <time.h>
/#define MAX 10
/#define SWAP(x,y) {int t; t = x; x = y; y = t;}
void createheap(int[]);
void heapsort(int[]);
int main(void) {
int number[MAX+1] = {-1};
int i, num;
srand(time(NULL));
printf(&quot;排序前：&quot;);
for(i = 1; i &lt;= MAX; i++) {
number[i] = rand() % 100;
printf(&quot;%d &quot;, number[i]);
}
printf(&quot;\n建立堆积树：&quot;);
createheap(number);
for(i = 1; i &lt;= MAX; i++)
printf(&quot;%d &quot;, number[i]);
printf(&quot;\n&quot;);
heapsort(number);
printf(&quot;\n&quot;);
return 0;
}
void createheap(int number[]) {
int i, s, p;
int heap[MAX+1] = {-1};
for(i = 1; i &lt;= MAX; i++) {
heap[i] = number[i];
s = i;
p = i / 2;
while(s &gt;= 2 &amp;&amp; heap[p] &gt; heap[s]) {
SWAP(heap[p], heap[s]);
s = p;
p = s / 2;
}
}
for(i = 1; i &lt;= MAX; i++)
number[i] = heap[i];
}
void heapsort(int number[]) {
int i, m, p, s;
m = MAX;
while(m &gt; 1) {
SWAP(number[1], number[m]);
m--;
p = 1;
s = 2 /<em> p;
while(s &lt;= m) {
if(s &lt; m &amp;&amp; number[s+1] &lt; number[s])
s++;
if(number[p] &lt;= number[s])
break;
SWAP(number[p], number[s]);
p = s;
s = 2 /</em> p;
}
printf(&quot;\n排序中：&quot;);
for(i = MAX; i &gt; 0; i--)
printf(&quot;%d &quot;, number[i]);
}
}</p>
</li>
<li><p>Java
public class HeapSort {
public static void sort(int[] number) {
int[] tmp = new int[number.length + 1];
// 配合说明，使用一个有遍移的暂存阵列
for(int i = 1; i &lt; tmp.length; i++) {
tmp[i] = number[i-1];
}
createHeap(tmp);
int m = number.length;
while(m &gt; 1) {
swap(tmp, 1, m);
m--;
int p = 1;
int s = 2 /<em> p;
while(s &lt;= m) {
if(s &lt; m &amp;&amp; tmp[s+1] &lt; tmp[s])
s++;
if(tmp[p] &lt;= tmp[s])
break;
swap(tmp, p, s);
p = s;
s = 2 /</em> p;
}
}
// 这边将排序好的暂存阵列设定回原阵列
for(int i = 0; i &lt; number.length; i++) {
number[i] = tmp[i+1];
}
}
private static void createHeap(int[] tmp) {
int[] heap = new int[tmp.length];
for(int i = 0; i &lt; heap.length; i++)
heap[i] = -1;
for(int i = 1; i &lt; heap.length; i++) {
heap[i] = tmp[i];
int s = i;
int p = i / 2;
while(s &gt;= 2 &amp;&amp; heap[p] &gt; heap[s]) {
swap(heap, p, s);
s = p;
p = s / 2;
}
}
for(int i = 1; i &lt; tmp.length; i++)
tmp[i] = heap[i];
}
private static void swap(int[] number, int i, int j) {
int t;
t = number[i];
number[i] = number[j];
number[j] = t;
}
}</p>
</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/AlgorithmGossip/">AlgorithmGossip</a></li></span></span> | <span class="tags">Tagged <a href="/tags/AlgorithmGossip/" class="label label-primary">AlgorithmGossip</a></span> | <span class="time">recent updated:<time title="2014-03-07 10:37:38"datetime="2014-03-07 10:37:38"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--HeapSort/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-AlgorithmGossip-AlgorithmGossip--HeapSort" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/21/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/19/">19</a></li><li><a class="page-number" href="/page/20/">20</a></li><li><a class="page-number" href="/page/21/">21</a></li><li class="active"><li><span class="page-number current">22</span></li><li><a class="page-number" href="/page/23/">23</a></li><li><a class="page-number" href="/page/24/">24</a></li><li><a class="page-number" href="/page/25/">25</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/23/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 16:47:45</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
