
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 60 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--探索java多线程（连载）1守护线程-ikon-BlogJava/">探索java多线程（连载）1 守护线程 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--探索java多线程（连载）1守护线程-ikon-BlogJava/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-java-1-ikon-blogjava">探索java多线程（连载）1 守护线程 - ikon - BlogJava</h1>
<h1 id="-ikon-http-www-blogjava-net-ikon-"><a href="http://www.blogjava.net/ikon/" target="_blank">ikon</a></h1>
<p>posts - 1, comments - 0, trackbacks - 0, articles - 1   <a href="http://www.blogjava.net/" target="_blank">BlogJava</a> :: <a href="http://www.blogjava.net/ikon/" target="_blank">首页</a> :: <a href="http://www.blogjava.net/ikon/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a> :: <a href="http://www.blogjava.net/ikon/contact.aspx?id=1" target="_blank">联系</a> :: <a href="http://www.blogjava.net/ikon/rss" target="_blank">聚合</a> <a href="http://www.blogjava.net/ikon/rss" target="_blank"><img src="" alt=""></a> :: <a href="http://www.blogjava.net/ikon/admin/EditPosts.aspx" target="_blank">管理</a> <img src="" alt=""></p>
<h3 id="-">日历</h3>
<p><a href="&quot;Go to the previous month&quot;">&lt;</a>2011年3月<a href="&quot;Go to the next month&quot;">&gt;</a>日一二三四五六2728123456789101112131415161718192021<a href="http://www.blogjava.net/ikon/archive/2011/03/22.html" target="_blank">22</a>232425262728293031123456789</p>
<p><img src="" alt=""></p>
<h3 id="-">常用链接</h3>
<ul>
<li><a href="http://www.blogjava.net/ikon/MyPosts.html" target="_blank">我的随笔</a></li>
<li><a href="http://www.blogjava.net/ikon/MyComments.html" target="_blank">我的评论</a></li>
<li><a href="http://www.blogjava.net/ikon/OtherPosts.html" target="_blank">我的参与</a>
<img src="" alt=""></li>
</ul>
<h3 id="-">留言簿</h3>
<ul>
<li><a href="http://www.blogjava.net/ikon/Contact.aspx?id=1" target="_blank">给我留言</a></li>
<li><a href="http://www.blogjava.net/ikon/default.aspx?opt=msg" target="_blank">查看公开留言</a></li>
<li><a href="http://www.blogjava.net/ikon/admin/MyMessages.aspx" target="_blank">查看私人留言</a></li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-">随笔档案</h3>
<ul>
<li><a href="http://www.blogjava.net/ikon/archive/2011/03.html" target="_blank">2011年3月 (1)</a>
<img src="" alt=""></li>
</ul>
<h3 id="-">搜索</h3>
<ul>
<li></li>
</ul>
<p><img src="" alt=""></p>
<h3 id="-http-www-blogjava-net-ikon-commentsrss-aspx-java-1-">最新评论 <a href="http://www.blogjava.net/ikon/CommentsRSS.aspx" target="_blank"><img src="" alt=""></a> ## <a href="">探索java多线程（连载）1 守护线程</a></h3>
<p>Posted on 2011-03-22 19:25 <a href="http://www.blogjava.net/ikon/" target="_blank">ikon</a> 阅读(1692) <a href="http://www.blogjava.net/ikon/archive/2011/03/22/346738.html#Post" target="_blank">评论(0)</a>  <a href="http://www.blogjava.net/ikon/admin/EditPosts.aspx?postid=346738" target="_blank">编辑</a>  <a href="http://www.blogjava.net/ikon/AddToFavorite.aspx?id=346738" target="_blank">收藏</a> <img src="" alt=""></p>
<pre><code>  在java中有一类线程，专门在后台提供服务，此类线程无需显式关闭，当程序结束了，它也就结束了，这就是守护线程 daemon thread。如果还有非守护线程的线程在执行，它就不会结束。      守护线程有何用处呢？让我们来看个实践中的例子。

  在我们的系统中经常应用各种配置文件（黑名单，禁用词汇），当修改配置文件后，一般要重启服务，系统才能够加载；当重启服务的代价比较高的情况下，这种加载方式不能满足我们的要求，这个时候守护线程该发挥它的作用了，它可以实时加载你的配置文件，无需重启。（当然，相当重要的配置文件，不推荐实时加载）
</code></pre><p><img src="" alt="">package com.ikon.thread.daemon;
<img src="" alt="">
<img src="" alt="">import java.io.File;
<img src="" alt="">import java.util./<em>;
<img src="" alt="">
<img src="" alt=""><img src="" alt="">//</em>/<em> /</em>///<em>/</em>
<img src="" alt=""> /<em> 文件监测
<img src="" alt=""> /</em> @author ikon99999
<img src="" alt=""> /<em> 
<img src="" alt=""> /</em>/
<img src="" alt=""><img src="" alt="">public abstract class FileWatchdog extends Thread <img src="" alt="">{
<img src="" alt="">
<img src="" alt=""> 
<img src="" alt="">  static final public long DEFAULT_DELAY = 20/*1000; 
<img src="" alt=""> 
<img src="" alt=""><br><img src="" alt="">  protected HashMap fileList;
<img src="" alt=""> 
<img src="" alt="">  protected long delay = DEFAULT_DELAY; 
<img src="" alt=""><br><img src="" alt="">  boolean warnedAlready = false;
<img src="" alt=""><br><img src="" alt="">  boolean interrupted = false;
<img src="" alt="">
<img src="" alt="">  public static class Entity
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{
<img src="" alt="">        File file;
<img src="" alt="">        long lastModify;
<img src="" alt="">        Entity(File file,long lastModify)
<img src="" alt=""><img src="" alt="">        <img src="" alt="">{
<img src="" alt="">            this.file = file;
<img src="" alt="">            this.lastModify = lastModify;
<img src="" alt="">        }
<img src="" alt="">  }
<img src="" alt=""><br><img src="" alt=""><img src="" alt="">  protected  FileWatchdog() <img src="" alt="">{
<img src="" alt="">      fileList = new HashMap ();
<img src="" alt="">    setDaemon(true);
<img src="" alt="">  }
<img src="" alt="">
<img src="" alt=""> 
<img src="" alt=""><img src="" alt="">  public  void setDelay(long delay) <img src="" alt="">{
<img src="" alt="">    this.delay = delay;
<img src="" alt="">  }
<img src="" alt="">
<img src="" alt="">  public void addFile(File file)
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{
<img src="" alt="">        fileList.put(file.getAbsolutePath(),new Entity(file,file.lastModified()));<br><img src="" alt="">  }
<img src="" alt=""><br><img src="" alt="">  public boolean contains(File file)
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{
<img src="" alt="">        if( fileList.get(file.getAbsolutePath()) != null) return true;
<img src="" alt="">        else return false;
<img src="" alt="">  }
<img src="" alt=""><br><img src="" alt="">  abstract   protected   void doOnChange(File file);
<img src="" alt="">
<img src="" alt=""><img src="" alt="">  protected  void checkAndConfigure() <img src="" alt="">{
<img src="" alt="">      HashMap map = (HashMap)fileList.clone(); 
<img src="" alt="">      Iterator it = map.values().iterator();
<img src="" alt=""><br><img src="" alt="">      while( it.hasNext())
<img src="" alt=""><img src="" alt="">      <img src="" alt="">{
<img src="" alt=""><br><img src="" alt="">            Entity entity = (Entity)it.next();
<img src="" alt=""><br><img src="" alt="">            boolean fileExists;
<img src="" alt=""><img src="" alt="">            try <img src="" alt="">{
<img src="" alt="">              fileExists = entity.file.exists();
<img src="" alt="">            } catch(SecurityException  e) 
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt="">              System.err.println (&quot;Was not allowed to read check file existance, file:[&quot;+ entity.file .getAbsolutePath() +&quot;].&quot;);
<img src="" alt="">              interrupted = true; 
<img src="" alt="">              return;
<img src="" alt="">            }
<img src="" alt="">
<img src="" alt="">            if(fileExists) 
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt=""><br><img src="" alt="">              long l = entity.file.lastModified(); // this can also throw a SecurityException
<img src="" alt=""><img src="" alt="">              if(l &gt; entity.lastModify) <img src="" alt="">{           // however, if we reached this point this
<img src="" alt="">                    entity.lastModify = l;              // is very unlikely.
<img src="" alt="">                    newThread(entity.file);
<img src="" alt="">              }
<img src="" alt="">            }
<img src="" alt="">            else 
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt="">                System.err.println (&quot;[&quot;+entity.file .getAbsolutePath()+&quot;] does not exist.&quot;);
<img src="" alt="">            }
<img src="" alt="">      }
<img src="" alt="">  }
<img src="" alt=""><br><img src="" alt="">  private void newThread(File file)
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{
<img src="" alt="">      class MyThread extends Thread
<img src="" alt=""><img src="" alt="">      <img src="" alt="">{
<img src="" alt="">            File f;
<img src="" alt="">            public MyThread(File f)
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt="">                this.f = f;
<img src="" alt="">            }
<img src="" alt=""><br><img src="" alt="">            public void run()
<img src="" alt=""><img src="" alt="">            <img src="" alt="">{
<img src="" alt="">                doOnChange(f);
<img src="" alt="">            }
<img src="" alt="">      }
<img src="" alt=""><br><img src="" alt="">      MyThread mt = new MyThread(file);
<img src="" alt="">      mt.start();
<img src="" alt="">  }
<img src="" alt="">
<img src="" alt="">  public  void run() 
<img src="" alt=""><img src="" alt="">  <img src="" alt="">{<br><img src="" alt=""><img src="" alt="">    while(!interrupted) <img src="" alt="">{
<img src="" alt=""><img src="" alt="">      try <img src="" alt="">{
<img src="" alt="">        Thread.currentThread().sleep(delay);
<img src="" alt=""><img src="" alt="">      } catch(InterruptedException e) <img src="" alt="">{
<img src="" alt="">    // no interruption expected
<img src="" alt="">      }
<img src="" alt="">      checkAndConfigure();
<img src="" alt="">    }
<img src="" alt="">  }
<img src="" alt="">}
<img src="" alt=""></p>
<pre><code>FileWatchdog是个抽象类，本身是线程的子类；在构造函数中设置为守护线程；
此类用hashmap维护着一个文件和最新修改时间值对，checkAndConfigure()方法用来检测哪些文件的修改时间更新了，如果发现文件更新了则调用doOnChange方法来完成监测逻辑；doOnChange方法是我们需要实现的；看下面关于一个黑名单服务的监测服务：
</code></pre><p> 1<img src="" alt="">package com.ikon.thread.daemon;
 2<img src="" alt="">
 3<img src="" alt="">import java.io.File;
 4<img src="" alt="">
 5<img src="" alt=""><img src="" alt="">//<em>/</em> /<em>///</em>/<em>
 6<img src="" alt=""> /</em> 黑名单服务
 7<img src="" alt=""> /<em> @author ikon99999
 8<img src="" alt=""> /</em> 2011-3-21
 9<img src="" alt=""> /<em>/
10<img src="" alt=""><img src="" alt="">public class BlacklistService <img src="" alt="">{
11<img src="" alt="">    private File configFile = new File(&quot;c:/blacklist.txt&quot;);
12<img src="" alt=""><br>13<img src="" alt=""><img src="" alt="">    public void init() throws Exception<img src="" alt="">{
14<img src="" alt="">        loadConfig();
15<img src="" alt="">        ConfigWatchDog dog = new ConfigWatchDog();
16<img src="" alt="">        dog.setName(&quot;daemon_demo_config_watchdog&quot;);//a
17<img src="" alt="">        dog.addFile(configFile);//b
18<img src="" alt="">        dog.start();//c
19<img src="" alt="">    }
20<img src="" alt=""><br>21<img src="" alt=""><img src="" alt="">    public void loadConfig()<img src="" alt="">{
22<img src="" alt=""><img src="" alt="">        try<img src="" alt="">{
23<img src="" alt="">            Thread.sleep(1/</em>1000);//d
24<img src="" alt=""><br>25<img src="" alt="">            System.out.println(&quot;加载黑名单&quot;);
26<img src="" alt=""><img src="" alt="">        }catch(InterruptedException ex)<img src="" alt="">{
27<img src="" alt="">            System.out.println(&quot;加载配置文件失败！&quot;);
28<img src="" alt="">        }
29<img src="" alt="">    }
30<img src="" alt=""><br>31<img src="" alt=""><img src="" alt="">    public File getConfigFile() <img src="" alt="">{
32<img src="" alt="">        return configFile;
33<img src="" alt="">    }
34<img src="" alt="">
35<img src="" alt=""><img src="" alt="">    public void setConfigFile(File configFile) <img src="" alt="">{
36<img src="" alt="">        this.configFile = configFile;
37<img src="" alt="">    }
38<img src="" alt="">
39<img src="" alt="">
40<img src="" alt=""><img src="" alt="">    private class ConfigWatchDog extends FileWatchdog<img src="" alt="">{
41<img src="" alt=""><br>42<img src="" alt="">        @Override
43<img src="" alt=""><img src="" alt="">        protected void doOnChange(File file) <img src="" alt="">{
44<img src="" alt="">            System.out.println(&quot;文件&quot;+file.getName()+&quot;发生改变，重新加载&quot;);
45<img src="" alt="">            loadConfig();
46<img src="" alt="">        }
47<img src="" alt=""><br>48<img src="" alt="">    }
49<img src="" alt=""><br>50<img src="" alt=""><img src="" alt="">    public static void main(String[] args) throws Exception <img src="" alt="">{
51<img src="" alt="">        BlacklistService service = new BlacklistService();
52<img src="" alt="">        service.init();
53<img src="" alt=""><br>54<img src="" alt="">        Thread.sleep(60/<em>60/</em>1000);//e
55<img src="" alt="">    }
56<img src="" alt="">}
57<img src="" alt="">
        ConfigWatchDog内部类实现了doOnChange(File file)方法，当文件被修改后，watchdog调用doOnChange方法完成重新加载操作；
        在blackservice的init方法中初始化watchdog线程；
        d：模拟文件加载耗时
        e：主要是防止主线程退出；
        其实上面的FileWatchdog就是取自log4j；</p>
<p><a href="http://www.blogjava.net/RequireRegister.aspx" target="_blank">新用户注册</a>  <a href="">刷新评论列表</a>  </p>
<p><a href=""></a> <a href="http://job.cnblogs.com/">找优秀程序员，就在博客园</a>
<a href="http://job.cnblogs.com/offer/12368/" target="_blank">网易有道诚聘CRM研发工程师</a>
<a href="http://job.cnblogs.com/offer/11576/" target="_blank">锦江国际诚聘Java高级软件工程师</a>
<a href="http://job.cnblogs.com/offer/12493/" target="_blank">福州几维网络诚聘Java服务端程序员</a>
IT新闻：
· <a href="http://news.cnblogs.com/n/101664/" target="_blank">开放，开放，开放 —— 垄断</a>
· <a href="http://news.cnblogs.com/n/101663/" target="_blank">GNOME讨论放弃支持非Linux操作系统</a>
· <a href="http://news.cnblogs.com/n/101662/" target="_blank">Chrome 13将隐藏地址栏</a>
· <a href="http://news.cnblogs.com/n/101661/" target="_blank">联想：USB 3.0将在2012年成为主流</a>
· <a href="http://news.cnblogs.com/n/101659/" target="_blank">意法半导体 CEO ：诺基亚 Windows Phone 将采用 U8500 双核芯片</a>   <a href="http://www.cnblogs.com/" target="_blank">博客园</a>  <a href="http://home.cnblogs.com/q/" target="_blank">博问</a>  <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>  <a href="http://job.cnblogs.com/cate-java_programmer/" target="_blank">Java程序员招聘</a> 标题  请输入标题 姓名  请输入你的姓名 主页 请输入验证码 验证码 /*  <img src="" alt=""> 内容(请不要发表任何与政治相关的内容) 请输入评论内容 Remember Me?   <a href="http://www.blogjava.net/login.aspx?ReturnURL=http://www.blogjava.net/ikon/archive/2011/03/22/346738.html&amp;SourceURL=/ikon/archive/2011/03/22/346738.html" target="_blank">登录</a>       [使用Ctrl+Enter键可以直接提交]    推荐职位：
· <a href="http://job.cnblogs.com/offer/5914/" target="_blank">北京.NET 研发工程师 (北京捷报数据)</a>
· <a href="http://job.cnblogs.com/offer/12527/" target="_blank">(北京).NET软件开发工程师(北京龙达)</a>
· <a href="http://job.cnblogs.com/offer/11584/" target="_blank">厦门高级.NET软件工程师(服务于美国Amazon)</a>
· <a href="http://job.cnblogs.com/offer/10723/" target="_blank">高级Web页面前端开发工程师(新蛋中国)</a>
· <a href="http://job.cnblogs.com/offer/12493/" target="_blank">厦门Java服务端程序员(福州几维网络)</a>
· <a href="http://job.cnblogs.com/offer/9051/" target="_blank">.NET 高级软件开发工程师 (新蛋中国)</a>
· <a href="http://job.cnblogs.com/offer/12439/" target="_blank">北京ASP.NET 工程师（月薪12k）(北京盛安德)</a>
· <a href="http://job.cnblogs.com/offer/12492/" target="_blank">厦门C/#游戏客户端程序员 (福州几维网络)</a></p>
<p>博客园首页随笔：
· <a href="http://www.cnblogs.com/kqingchao/archive/2011/05/20/character-encoding-2.html" target="_blank">字符编码浅谈（二）</a>
· <a href="http://www.cnblogs.com/xuesong/archive/2011/05/20/2051892.html" target="_blank">Windows Phone 7编程实践—必应地图导航</a>
· <a href="http://www.cnblogs.com/ini_always/archive/2011/05/20/2050517.html" target="_blank">绕死你不偿命的UNICODE、_UNICODE、<strong>TEXT、</strong>T、_T、_TEXT、TEXT宏</a>
· <a href="http://www.cnblogs.com/leslies2/archive/2011/05/20/2051844.html" target="_blank">学习笔记：JAVA RMI远程方法调用简单实例</a>
· <a href="http://www.cnblogs.com/bobomouse/archive/2011/05/20/2051846.html" target="_blank">关于CellSet转DataTable的改进方案</a>
知识库：
· <a href="http://kb.cnblogs.com/page/101423/" target="_blank">程序员的本质</a>
· <a href="http://kb.cnblogs.com/page/101345/" target="_blank">Scrum之成败——从自身案例说起</a>
· <a href="http://kb.cnblogs.com/page/101321/" target="_blank">清除代码异味</a>
· <a href="http://kb.cnblogs.com/page/101198/" target="_blank">详解.NET程序集的加载规则</a>
· <a href="http://kb.cnblogs.com/page/101162/" target="_blank">如何通过ildasm/ilasm修改assembly的IL代码</a> 最简洁阅读版式：
<a href="http://archive.cnblogs.com/b/346738/" target="_blank">探索java多线程（连载）1 守护线程</a> 网站导航:</p>
<p><a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园</a>   <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>   <a href="http://kb.cnblogs.com/" target="_blank">知识库</a>   <a href="http://www.cnweblog.com/" target="_blank">博客生活</a>   <a href="http://www.cnitblog.com/" target="_blank">IT博客网</a>   <a href="http://www.cppblog.com/" target="_blank">C++博客</a>   <a href="http://space.cnblogs.com/q/" title="IT问答" target="_blank">博问</a>   <a href="http://www.blogjava.net/ikon/archive/2011/03/22/346738.html?opt=admin" target="_blank">管理</a>    Powered by:
<a href="http://www.blogjava.net/" target="_blank">BlogJava</a>
Copyright © ikon</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_多线程/">Java_多线程</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_多线程/" class="label label-success">Java_多线程</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--探索java多线程（连载）1守护线程-ikon-BlogJava/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_多线程--探索java多线程（连载）1守护线程-ikon-BlogJava" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--用apache的configuration实现实时配置-steven_cheng-ITeye/">用apache的configuration实现实时配置 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--用apache的configuration实现实时配置-steven_cheng-ITeye/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-apache-configuration-steven_cheng-iteye-">用apache的configuration实现实时配置 - steven_cheng - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">新闻</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://steven-cheng.iteye.com/blog/70634#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/wiki" target="_blank">专栏</a>  <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://steven-cheng.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/all" target="_blank">我的应用</a> <a href="http://steven-cheng.iteye.com/login" target="_blank">登录</a> <a href="http://steven-cheng.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-steven_cheng-http-steven-cheng-iteye-com-"><a href="http://steven-cheng.iteye.com/" target="_blank">steven_cheng</a></h1>
<p>永久域名 <a href="http://steven-cheng.iteye.com/" target="_blank"><a href="http://steven-cheng.iteye.com">http://steven-cheng.iteye.com</a></a></p>
<p><a href="http://steven-cheng.iteye.com/blog/87667" title="异常处理" target="_blank">异常处理</a></p>
<p>2006-03-24</p>
<h3 id="-apache-configuration-"><a href="">用apache的configuration实现实时配置</a></h3>
<p>关键字: java 开源
apache下commons有一个configeration包，对于做配置很方便，尤其是实时热配置。可以自动监测到配置文件的更改而reload配置文件。在项目中使用所以进行了一下封装。
java 代码</p>
<ol>
<li>public class DefaultRealTimeXMLConfiger {   </li>
<li></li>
<li>private static Log logger = LogFactory.getLog(DefaultRealTimeXMLConfiger.class);   </li>
<li></li>
<li>private String fileName;   </li>
<li></li>
<li>private long reloadPeriod;   </li>
<li></li>
<li>private XMLConfiguration config;   </li>
<li></li>
<li>public void init()   </li>
<li>{   </li>
<li>String filePath = GlobalConfigerImpl.getConfDir()+&quot;/&quot;+fileName;   </li>
<li>logger.debug(&quot;will config with XML file[&quot;+filePath+&quot;]&quot;);   </li>
<li></li>
<li>File file = new File(filePath);   </li>
<li>if (!file.exists() || !file.isFile()) {   </li>
<li>logger.error(&quot; can&#39;t find file[&quot; + filePath + &quot;]&quot;);   </li>
<li>throw new IllegalArgumentException(&quot;config error! can&#39;t find file[&quot; + filePath + &quot;]&quot;);   </li>
<li>}   </li>
<li>this.init(file);   </li>
<li>}   </li>
<li></li>
<li>public void init(File file) {   </li>
<li>try {   </li>
<li>config = new XMLConfiguration(file);   </li>
<li>FileChangedReloadingStrategy fs = new FileChangedReloadingStrategy();   </li>
<li>fs.setConfiguration(config);   </li>
<li></li>
<li>if(this.reloadPeriod&gt;0)   </li>
<li>{   </li>
<li>fs.setRefreshDelay(this.reloadPeriod);   </li>
<li>}   </li>
<li>config.setReloadingStrategy(fs);   </li>
<li></li>
<li>} catch (ConfigurationException e) {   </li>
<li>logger.error(&quot;error! configer error[&quot;+file.getPath()+&quot;]&quot;);   </li>
<li>logger.error(e);   </li>
<li>e.printStackTrace();   </li>
<li>}   </li>
<li>}   </li>
<li></li>
<li>public Object getProperty(String name) {   </li>
<li>Object s = this.config.getProperty(name);   </li>
<li>return s;   </li>
<li>}   </li>
<li></li>
<li>public String getString(String name) {   </li>
<li>Object s = this.config.getProperty(name);   </li>
<li>String result = null;   </li>
<li>if (s != null)   </li>
<li>result = (String) s;   </li>
<li></li>
<li>return result;   </li>
<li>}   </li>
<li></li>
<li>public String[] getStringArray(String name) {   </li>
<li>String[] target = this.config.getStringArray(name);   </li>
<li></li>
<li>return target;   </li>
<li>}   </li>
<li></li>
<li></li>
<li>//<em>/</em>  </li>
<li>/* @return Returns the fileName.  </li>
<li>/*/  </li>
<li>public String getFileName() {   </li>
<li>return fileName;   </li>
<li>}   </li>
<li></li>
<li>//<em>/</em>  </li>
<li>/* @param fileName The fileName to set.  </li>
<li>/*/  </li>
<li>public void setFileName(String fileName) {   </li>
<li>this.fileName = fileName;   </li>
<li>}   </li>
<li></li>
<li>//<em>/</em>  </li>
<li>/* @return Returns the reloadPeriod.  </li>
<li>/*/  </li>
<li>public long getReloadPeriod() {   </li>
<li>return reloadPeriod;   </li>
<li>}   </li>
<li></li>
<li>//<em>/</em>  </li>
<li>/* @param reloadPeriod The reloadPeriod to set.  </li>
<li>/*/  </li>
<li>public void setReloadPeriod(long reloadPeriod) {   </li>
<li>this.reloadPeriod = reloadPeriod;   </li>
<li>}   </li>
<li>}<br><a href="http://steven-cheng.iteye.com/blog/87667" title="异常处理" target="_blank">异常处理</a></li>
</ol>
<ul>
<li>06:34</li>
<li>浏览 (988)</li>
<li><a href="http://steven-cheng.iteye.com/blog/70634#comments" target="_blank">评论</a> (0)</li>
<li>分类: <a href="http://steven-cheng.iteye.com/category/12345" target="_blank">java</a></li>
<li><a href="http://www.iteye.com/wiki/topic/70634" target="_blank">相关推荐</a><h3 id="-">评论</h3>
</li>
</ul>
<p><a href=""></a></p>
<h3 id="-">发表评论</h3>
<h3 id="-">表情图标</h3>
<p><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""></p>
<p>字体颜色: 标准深红红色橙色棕色黄色绿色橄榄青色蓝色深蓝靛蓝紫色灰色白色黑色 字体大小: 标准1 (xx-small)2 (x-small)3 (small)4 (medium)5 (large)6 (x-large)7 (xx-large) 对齐: 标准居左居中居右</p>
<p>提示：选择您需要装饰的文字, 按上列按钮即可添加上相应的标签</p>
<p>您还没有登录，请<a href="http://steven-cheng.iteye.com/login" target="_blank">登录</a>后发表评论(快捷键 Alt+S / Ctrl+Enter)</p>
<p><a href="http://steven-cheng.iteye.com/" target="_blank"><img src="&quot;steven_cheng的博客: steven_cheng&quot;" alt="steven_cheng的博客"></a></p>
<p>steven_cheng</p>
<ul>
<li>浏览: 6938 次</li>
<li>来自: 北京</li>
<li><img src="" alt=""></li>
<li><a href="http://steven-cheng.iteye.com/blog/profile" target="_blank">详细资料</a> <a href="http://steven-cheng.iteye.com/blog/guest_book" target="_blank">留言簿</a></li>
</ul>
<h3 id="-">搜索本博客</h3>
<h3 id="-http-steven-cheng-iteye-com-blog-user_visits-">最近访客 <a href="http://steven-cheng.iteye.com/blog/user_visits" target="_blank">&gt;&gt;更多访客</a></h3>
<p><a href="http://loudyn.iteye.com/" target="_blank"><img src="&quot;Loudyn的博客: &quot;" alt="Loudyn的博客"></a></p>
<p><a href="http://loudyn.iteye.com/" target="_blank">Loudyn</a></p>
<p><a href="http://hepeng19861212.iteye.com/" target="_blank"><img src="&quot;hepeng19861212的博客: 火柴天堂&quot;" alt="hepeng19861212的博客"></a></p>
<p><a href="http://hepeng19861212.iteye.com/" target="_blank">hepeng19861212</a>
<a href="http://osacar.iteye.com/" target="_blank"><img src="&quot;osacar的博客: &quot;" alt="osacar的博客"></a></p>
<p><a href="http://osacar.iteye.com/" target="_blank">osacar</a></p>
<p><a href="http://kevin-gzhz.iteye.com/" target="_blank"><img src="&quot;kevin_gzhz的博客: kevin_gzhz&quot;" alt="kevin_gzhz的博客"></a></p>
<p><a href="http://kevin-gzhz.iteye.com/" target="_blank">kevin_gzhz</a></p>
<h3 id="-">博客分类</h3>
<ul>
<li><a href="http://steven-cheng.iteye.com/" target="_blank">全部博客 (8)</a></li>
<li><a href="http://steven-cheng.iteye.com/category/4287" target="_blank">默认类别 (0)</a></li>
<li><a href="http://steven-cheng.iteye.com/category/12345" target="_blank">java (6)</a></li>
<li><a href="http://steven-cheng.iteye.com/category/24850" target="_blank">单元测试和TDD (0)</a></li>
<li><a href="http://steven-cheng.iteye.com/category/48191" target="_blank">freemarker (1)</a></li>
<li><a href="http://steven-cheng.iteye.com/category/73657" target="_blank">linux (1)</a></li>
<li><p><a href="http://steven-cheng.iteye.com/category/75601" target="_blank">restlet (1)</a></p>
<h3 id="-http-steven-cheng-iteye-com-blog-guest_book-">我的留言簿 <a href="http://steven-cheng.iteye.com/blog/guest_book" target="_blank">&gt;&gt;更多留言</a></h3>
</li>
<li><p>steven_cheng 写道restlet那片原文是你的吗，如果是给个原文连接。 ...
-- by <a href="http://steven-cheng.iteye.com/blog/guest_book#6151" target="_blank">whaosoft</a></p>
</li>
</ul>
<h3 id="-">其他分类</h3>
<ul>
<li><a href="http://steven-cheng.iteye.com/blog/favorite" target="_blank">我的收藏</a> (15)</li>
<li><a href="http://steven-cheng.iteye.com/blog/code_favorite" target="_blank">我的代码</a> (0)</li>
<li><a href="http://steven-cheng.iteye.com/blog/topic" target="_blank">我的论坛主题帖</a> (1)</li>
<li><a href="http://steven-cheng.iteye.com/blog/post" target="_blank">我的所有论坛帖</a> (8)</li>
<li><a href="http://steven-cheng.iteye.com/blog/article" target="_blank">我的精华良好帖</a> (0)</li>
<li><p><a href="http://steven-cheng.iteye.com/blog/solution" target="_blank">我解决的问题</a> (1)</p>
<h3 id="-">最近加入群组</h3>
</li>
<li><p><a href="http://restlet.group.iteye.com/" target="_blank">Restlet</a></p>
</li>
<li><a href="http://freemarker.group.iteye.com/" target="_blank">FreeMarker</a></li>
</ul>
<h3 id="-">存档</h3>
<ul>
<li><a href="http://steven-cheng.iteye.com/blog/monthblog/2010-02" target="_blank">2010-02</a> (1)</li>
<li><a href="http://steven-cheng.iteye.com/blog/monthblog/2009-09" target="_blank">2009-09</a> (2)</li>
<li><a href="http://steven-cheng.iteye.com/blog/monthblog/2009-07" target="_blank">2009-07</a> (1)</li>
<li><p><a href="http://steven-cheng.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://steven-cheng.iteye.com/rss" target="_blank"><img src="" alt="Rss"></a></p>
</li>
<li><a href="http://fusion.google.com/add?feedurl=http://steven-cheng.iteye.com/rss" target="_blank"><img src="" alt="Rss_google"></a></li>
</ul>
<p>声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2011 ITeye.com. All rights reserved. [ 京ICP证110151号 ]
<img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_多线程/">Java_多线程</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_多线程/" class="label label-success">Java_多线程</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程--用apache的configuration实现实时配置-steven_cheng-ITeye/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_多线程--用apache的configuration实现实时配置-steven_cheng-ITeye" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程-内存--深入理解Java内存模型（七）——总结/">深入理解Java内存模型（七）——总结</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程-内存--深入理解Java内存模型（七）——总结/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-java-">深入理解Java内存模型（七）——总结</h1>
<h3 id="-">分享到</h3>
<ul>
<li><a href="">一键分享</a></li>
<li><a href="">QQ空间</a></li>
<li><a href="">新浪微博</a></li>
<li><a href="">百度搜藏</a></li>
<li><a href="">人人网</a></li>
<li><a href="">腾讯微博</a></li>
<li><a href="">百度相册</a></li>
<li><a href="">开心网</a></li>
<li><a href="">腾讯朋友</a></li>
<li><a href="">百度贴吧</a></li>
<li><a href="">豆瓣网</a></li>
<li><a href="">搜狐微博</a></li>
<li><a href="">百度新首页</a></li>
<li><a href="">QQ好友</a></li>
<li><a href="">和讯微博</a></li>
<li><a href="">更多...</a></li>
</ul>
<p><a href="">百度分享</a></p>
<ul>
<li><a href="http://www.infoq.com/cn/aboutus" title="关于我们" target="_blank">关于我们</a></li>
<li><p><a href="http://www.infoq.com/cn/contribute" title="让大家在InfoQ上听见你的声音" target="_blank">让大家在InfoQ上听见你的声音</a></p>
</li>
<li><p>欢迎关注我们的：</p>
</li>
<li><a href="http://e.weibo.com/infoqchina" target="_blank"><img src="" alt=""></a></li>
<li><a href="http://www.infoq.com/cn/news/2013/02/infoq-wechat" target="_blank"><img src="" alt=""></a></li>
<li><a href="http://www.infoq.com/cn/rss/rss.action?token=AjlwmaWcwi5ejkcT6GcRk1pCqJ4K7ocs" target="_blank"><img src="" alt=""></a></li>
</ul>
<p>促进软件开发领域知识与创新的传播</p>
<p><a href="&quot;Login&quot;">登录</a>
<a href="http://www.infoq.com/cn/" target="_blank"><img src="" alt=""></a></p>
<ul>
<li><a href="http://www.infoq.com/" target="_blank">En</a> |</li>
<li><a href="&quot;InfoQ China&quot;">中文</a> |</li>
<li><a href="http://www.infoq.com/jp/" target="_blank">日本</a> |</li>
<li><a href="http://www.infoq.com/fr/" target="_blank">Fr</a> |</li>
<li><a href="http://www.infoq.com/br/" target="_blank">Br</a></li>
</ul>
<p>164,153 六月 独立访问用户</p>
<ul>
<li><p><a href="http://www.infoq.com/cn/development/" title="Development" target="_blank">语言 &amp; 开发</a></p>
</li>
<li><p><a href="http://www.infoq.com/cn/java/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="Java" target="_blank">Java</a></p>
</li>
<li><a href="http://www.infoq.com/cn/dotnet/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title=".Net" target="_blank">.Net</a></li>
<li><a href="http://www.infoq.com/cn/cloud-computing/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="云计算" target="_blank">云计算</a></li>
<li><a href="http://www.infoq.com/cn/mobile/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="移动" target="_blank">移动</a></li>
<li><a href="http://www.infoq.com/cn/HTML5Topic/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="HTML 5" target="_blank">HTML 5</a></li>
<li><a href="http://www.infoq.com/cn/javascript/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="JavaScript" target="_blank">JavaScript</a></li>
<li><a href="http://www.infoq.com/cn/ruby/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="Ruby" target="_blank">Ruby</a></li>
<li><a href="http://www.infoq.com/cn/dsl/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="DSLs" target="_blank">DSLs</a></li>
<li><a href="http://www.infoq.com/cn/python/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="Python" target="_blank">Python</a></li>
<li><a href="http://www.infoq.com/cn/Topic_PHP/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="PHP" target="_blank">PHP</a></li>
<li><a href="http://www.infoq.com/cn/PaaS/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="PaaS" target="_blank">PaaS</a></li>
</ul>
<h2 id="-">特别专题语言 &amp; 开发</h2>
<h3 id="-juergen-fesslmeier-javascript-http-www-infoq-com-cn-interviews-end-to-end-javascript-"><a href="http://www.infoq.com/cn/interviews/end-to-end-javascript" target="_blank">Juergen Fesslmeier谈端到端的JavaScript开发</a></h3>
<p><img src="" alt=""> Juergen谈论了使用JavaScript进行端对端开发的好处和开发团队可能遇见的挑战。他还谈到了Wakanda Studio以及如何仅用JavaScript通过它来开发复杂的应用程序。
<a href="http://www.infoq.com/cn/development/" target="_blank">浏览所有<strong>语言 &amp; 开发</strong></a></p>
<ul>
<li><p><a href="http://www.infoq.com/cn/architecture-design/" title="Architecture &amp; Design" target="_blank">架构 &amp; 设计</a></p>
</li>
<li><p><a href="http://www.infoq.com/cn/Modeling/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="建模" target="_blank">建模</a></p>
</li>
<li><a href="http://www.infoq.com/cn/performance-scalability/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="性能和可伸缩性" target="_blank">性能和可伸缩性</a></li>
<li><a href="http://www.infoq.com/cn/domain-driven-design/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="领域驱动设计" target="_blank">领域驱动设计</a></li>
<li><a href="http://www.infoq.com/cn/AOP/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="AOP" target="_blank">AOP</a></li>
<li><a href="http://www.infoq.com/cn/DesignPattern/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="设计模式" target="_blank">设计模式</a></li>
<li><a href="http://www.infoq.com/cn/Security/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="安全" target="_blank">安全</a></li>
<li><a href="http://www.infoq.com/cn/cloud-computing/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="云计算" target="_blank">云计算</a></li>
<li><a href="http://www.infoq.com/cn/soa_platforms/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="SOA" target="_blank">SOA</a></li>
</ul>
<h2 id="-">特别专题架构 &amp; 设计</h2>
<h3 id="-http-www-infoq-com-cn-articles-design-pattern-automation-"><a href="http://www.infoq.com/cn/articles/Design-Pattern-Automation" target="_blank">设计模式自动化</a></h3>
<p><img src="" alt=""> 尽管维护每行代码的成本如此高昂，但我们仍然每天都在编写着大量的样板代码。如果我们有更智能的编译器，那其中很大一部分是可以避免的。实际上，多数模板代码只是重复地实现那些我们已理解透彻的设计模式，只要我们教会编译器一些技巧，有一些设计模式完全是可以自动实现的。
<a href="http://www.infoq.com/cn/architecture-design/" target="_blank">浏览所有<strong>架构 &amp; 设计</strong></a></p>
<ul>
<li><p><a href="http://www.infoq.com/cn/process-practices/" title="Process &amp; Practices" target="_blank">过程 &amp; 实践</a></p>
</li>
<li><p><a href="http://www.infoq.com/cn/agile/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="Agile" target="_blank">Agile</a></p>
</li>
<li><a href="http://www.infoq.com/cn/Leadership/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="领导能力" target="_blank">领导能力</a></li>
<li><a href="http://www.infoq.com/cn/team-collaboration/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="团队协作" target="_blank">团队协作</a></li>
<li><a href="http://www.infoq.com/cn/agile_techniques/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="敏捷技术" target="_blank">敏捷技术</a></li>
<li><a href="http://www.infoq.com/cn/methodologies/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="方法论" target="_blank">方法论</a></li>
<li><a href="http://www.infoq.com/cn/continuous_integration/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="持续集成" target="_blank">持续集成</a></li>
<li><a href="http://www.infoq.com/cn/lean/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="精益" target="_blank">精益</a></li>
<li><a href="http://www.infoq.com/cn/cust_requirements/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="客户及需求" target="_blank">客户及需求</a></li>
</ul>
<h2 id="-">特别专题过程 &amp; 实践</h2>
<h3 id="-alm-http-www-infoq-com-cn-articles-integrated-alm-"><a href="http://www.infoq.com/cn/articles/Integrated-ALM" target="_blank">成功的根本—集成的ALM工具</a></h3>
<p><img src="" alt=""> 典型的软件交付项目会无数次地去获取需求，并在多个地方描述测试，但它们却与某一特定的构建里的具体内容并不相符合，因此项目往往需要大量分析来获知谁在做什么以及为什么做。Dave West深入研究造成该问题的原因，并致力研究一个整体的、集成的ALM方法。
<a href="http://www.infoq.com/cn/process-practices/" target="_blank">浏览所有<strong>过程 &amp; 实践</strong></a></p>
<ul>
<li><p><a href="http://www.infoq.com/cn/operations-infrastructure/" title="Operations &amp; Infrastructure" target="_blank">运维 &amp; 基础架构</a></p>
</li>
<li><p><a href="http://www.infoq.com/cn/performance-scalability/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="性能和可伸缩性" target="_blank">性能和可伸缩性</a></p>
</li>
<li><a href="http://www.infoq.com/cn/bigdata/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="大数据" target="_blank">大数据</a></li>
<li><a href="http://www.infoq.com/cn/devops/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="DevOps" target="_blank">DevOps</a></li>
<li><a href="http://www.infoq.com/cn/cloud-computing/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="云计算" target="_blank">云计算</a></li>
<li><a href="http://www.infoq.com/cn/virtualization/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="虚拟化" target="_blank">虚拟化</a></li>
<li><a href="http://www.infoq.com/cn/NoSQL/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="NoSQL" target="_blank">NoSQL</a></li>
<li><a href="http://www.infoq.com/cn/ApplicationServers/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="应用服务器" target="_blank">应用服务器</a></li>
<li><a href="http://www.infoq.com/cn/operations/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="运维" target="_blank">运维</a></li>
</ul>
<h2 id="-">特别专题运维 &amp; 基础架构</h2>
<h3 id="-http-www-infoq-com-cn-articles-atdd-by-example-book-"><a href="http://www.infoq.com/cn/articles/atdd-by-example-book" target="_blank">书评：验收测试驱动开发实践指南</a></h3>
<p><img src="" alt=""> 《验收测试驱动开发实践指南》一书的目的是作为一个介绍性使用指南指导那些从零开始的团队成功执行和应用验收测试驱动开发（ATDD）。尽管该书在指出及总结了成功敏捷测试人员应该掌握的多个测试相关实践上做了有效的工作，但该书最终并没有为它的各层读者提供他们所需要的信息。By Manuel Pais
<a href="http://www.infoq.com/cn/operations-infrastructure/" target="_blank">浏览所有<strong>运维 &amp; 基础架构</strong></a></p>
<ul>
<li><p><a href="http://www.infoq.com/cn/enterprise-architect/" title="Enterprise Architecture" target="_blank">企业架构</a></p>
</li>
<li><p><a href="http://www.infoq.com/cn/enterprise-architecture/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="企业架构" target="_blank">企业架构</a></p>
</li>
<li><a href="http://www.infoq.com/cn/bpm/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="业务流程建模" target="_blank">业务流程建模</a></li>
<li><a href="http://www.infoq.com/cn/business_it_alignment/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="业务/IT整合" target="_blank">业务/IT整合</a></li>
<li><a href="http://www.infoq.com/cn/EAI/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="Integration (EAI)" target="_blank">Integration (EAI)</a></li>
<li><a href="http://www.infoq.com/cn/Governance/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="治理" target="_blank">治理</a></li>
<li><a href="http://www.infoq.com/cn/web20/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="Web 2.0" target="_blank">Web 2.0</a></li>
<li><a href="http://www.infoq.com/cn/soa/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="SOA" target="_blank">SOA</a></li>
</ul>
<h2 id="-">特别专题企业架构</h2>
<h3 id="-http-www-infoq-com-cn-articles-designing-a-world-at-your-fingertips-mobile-user-interfaces-"><a href="http://www.infoq.com/cn/articles/designing-a-world-at-your-fingertips-mobile-user-interfaces" target="_blank">设计指尖上的世界：移动用户界面一瞥</a></h3>
<p><img src="" alt=""> 对任何成功的移动应用来说，用户界面（UI）是至关重要的组成部分。在这篇文章中，Forrest Skull展示了他与人机交互（HCI）研究者们进行的访谈与讨论，他们探讨了移动设备UI方面的原则，以及其它一些正在研究的领域，包括多设备、隐私、安全和语音。这篇文章还描述了开发移动设备用户界面过程中会面临的挑战。
<a href="http://www.infoq.com/cn/enterprise-architect/" target="_blank">浏览所有<strong>企业架构</strong></a>
<a href="http://www.qconshanghai.com/" title="New York 2013"><strong>QCon上海2013</strong>
11月1-3日
上海光大会展中心</a></p>
<ul>
<li><a href="http://www.infoq.com/cn/mobile/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="移动" target="_blank">移动</a></li>
<li><a href="http://www.infoq.com/cn/html-5/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="HTML 5" target="_blank">HTML 5</a></li>
<li><a href="http://www.infoq.com/cn/nodejs/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="Node.js" target="_blank">Node.js</a></li>
<li><a href="http://www.infoq.com/cn/cloud-computing/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="云计算" target="_blank">云计算</a></li>
<li><a href="http://www.infoq.com/cn/bigdata/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="大数据" target="_blank">大数据</a></li>
<li><a href="http://www.infoq.com/cn/operations/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="运维" target="_blank">运维</a></li>
<li><a href="http://www.infoq.com/cn/architect/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="架构师" target="_blank">架构师</a></li>
<li><a href="http://www.infoq.com/cn/baidu_cloud/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk" title="百度云" target="_blank">百度云</a>
<a href="http://www.infoq.com/cn/topics" target="_blank">全部话题</a></li>
</ul>
<p><a href="http://www.infoq.com/news/2013/04/infoq-redesign" target="_blank">New UI</a>
您目前处于： <a href="http://www.infoq.com/cn" title="InfoQ首页" target="_blank">InfoQ首页</a> <a href="http://www.infoq.com/cn/articles" title="文章" target="_blank">文章</a> 深入理解Java内存模型（七）——总结</p>
<h1 id="-java-">深入理解Java内存模型（七）——总结</h1>
<p>作者 <a href="http://www.infoq.com/cn/author/%E7%A8%8B%E6%99%93%E6%98%8E" target="_blank">程晓明</a> 发布于 三月 15, 2013 <em>|</em> <a href="">4 评论</a></p>
<ul>
<li><a href="&quot;分享到新浪微博&quot;">新浪微博</a> <a href="&quot;分享到腾讯微博&quot;">腾讯微博</a> <a href="&quot;分享到豆瓣网&quot;">豆瓣网</a> <a href="&quot;分享到Twitter&quot;">Twitter</a> <a href="&quot;分享到Facebook&quot;">Facebook</a> <a href="&quot;分享到linkedin&quot;">linkedin</a> <a href="&quot;分享到邮件分享&quot;">邮件分享</a> 更多 <a href="&quot;累计分享23次&quot;">23</a></li>
<li><a href="">稍后阅读</a></li>
<li><a href="http://www.infoq.com/cn/showbookmarks.action" target="_blank">我的阅读清单</a><h2 id="-">处理器内存模型</h2>
</li>
</ul>
<p>顺序一致性内存模型是一个理论参考模型，JMM和处理器内存模型在设计时通常会把顺序一致性内存模型作为参照。JMM和处理器内存模型在设计时会对顺序一致性模型做一些放松，因为如果完全按照顺序一致性模型来实现处理器和JMM，那么很多的处理器和编译器优化都要被禁止，这对执行性能将会有很大的影响。</p>
<p>根据对不同类型读/写操作组合的执行顺序的放松，可以把常见处理器的内存模型划分为下面几种类型：</p>
<ol>
<li>放松程序中写-读操作的顺序，由此产生了total store ordering内存模型（简称为TSO）。</li>
<li>在前面1的基础上，继续放松程序中写-写操作的顺序，由此产生了partial store order 内存模型（简称为PSO）。</li>
<li>在前面1和2的基础上，继续放松程序中读-写和读-读操作的顺序，由此产生了relaxed memory order内存模型（简称为RMO）和PowerPC内存模型。</li>
</ol>
<p>注意，这里处理器对读/写操作的放松，是以两个操作之间不存在数据依赖性为前提的（因为处理器要遵守as-if-serial语义，处理器不会对存在数据依赖性的两个内存操作做重排序）。</p>
<p>下面的表格展示了常见处理器内存模型的细节特征：
内存模型名称</p>
<p>对应的处理器
相关厂商内容</p>
<h3 id="-javaone-spring-java-ee-6-http-www-infoq-com-infoq-url-action-i-3379-t-f-"><a href="http://www.infoq.com/infoq/url.action?i=3379&amp;t=f" target="_blank">JavaOne上海：迁移Spring应用到Java EE 6</a></h3>
<h3 id="-javaone-http-www-infoq-com-infoq-url-action-i-3380-t-f-"><a href="http://www.infoq.com/infoq/url.action?i=3380&amp;t=f" target="_blank">JavaOne上海：淘宝的鹰眼分布式日志系统</a></h3>
<h3 id="-qcon-2013-http-www-infoq-com-cn-vendorcontent-show-action-vcr-2272-utm_source-infoq-utm_medium-vcr-utm_campaign-vcr_articles_click-"><a href="http://www.infoq.com/cn/vendorcontent/show.action?vcr=2272&amp;utm_source=infoq&amp;utm_medium=VCR&amp;utm_campaign=vcr_articles_click" target="_blank">豆瓣工程副总裁段念确认参与QCon上海2013，担任团队文化专题出品人</a></h3>
<h3 id="-html5-builder-web-http-www-infoq-com-cn-vendorcontent-show-action-vcr-2308-utm_source-infoq-utm_medium-vcr-utm_campaign-vcr_articles_click-"><a href="http://www.infoq.com/cn/vendorcontent/show.action?vcr=2308&amp;utm_source=infoq&amp;utm_medium=VCR&amp;utm_campaign=vcr_articles_click" target="_blank">白皮书下载：用HTML5 Builder构建单一代码库的Web/移动应用</a></h3>
<h3 id="-qcon-20-80-http-www-infoq-com-cn-vendorcontent-show-action-vcr-2311-utm_source-infoq-utm_medium-vcr-utm_campaign-vcr_articles_click-"><a href="http://www.infoq.com/cn/vendorcontent/show.action?vcr=2311&amp;utm_source=infoq&amp;utm_medium=VCR&amp;utm_campaign=vcr_articles_click" target="_blank">首届QCon上海20个专题确认，80余场分享，全面征集演讲主题</a></h3>
<p>相关赞助商
<a href="http://www.infoq.com/infoq/url.action?i=3367&amp;t=f" target="_blank"><img src="" alt=""></a></p>
<p>JavaOne大会独家社区合作，<a href="http://www.infoq.com/infoq/url.action?i=3511&amp;t=f" target="_blank">InfoQ用户享75折购票</a>。 
Store-Load 重排序</p>
<p>Store-Store重排序</p>
<p>Load-Load 和Load-Store重排序</p>
<p>可以更早读取到其它处理器的写</p>
<p>可以更早读取到当前处理器的写 TSO</p>
<p>sparc-TSO</p>
<p>X64</p>
<p>Y</p>
<p>Y PSO</p>
<p>sparc-PSO</p>
<p>Y</p>
<p>Y</p>
<p>Y RMO</p>
<p>ia64</p>
<p>Y</p>
<p>Y</p>
<p>Y</p>
<p>Y PowerPC</p>
<p>PowerPC</p>
<p>Y</p>
<p>Y</p>
<p>Y</p>
<p>Y</p>
<p>Y</p>
<p>在这个表格中，我们可以看到所有处理器内存模型都允许写-读重排序，原因在第一章以说明过：它们都使用了写缓存区，写缓存区可能导致写-读操作重排序。同时，我们可以看到这些处理器内存模型都允许更早读到当前处理器的写，原因同样是因为写缓存区：由于写缓存区仅对当前处理器可见，这个特性导致当前处理器可以比其他处理器先看到临时保存在自己的写缓存区中的写。</p>
<p>上面表格中的各种处理器内存模型，从上到下，模型由强变弱。越是追求性能的处理器，内存模型设计的会越弱。因为这些处理器希望内存模型对它们的束缚越少越好，这样它们就可以做尽可能多的优化来提高性能。</p>
<p>由于常见的处理器内存模型比JMM要弱，java编译器在生成字节码时，会在执行指令序列的适当位置插入内存屏障来限制处理器的重排序。同时，由于各种处理器内存模型的强弱并不相同，为了在不同的处理器平台向程序员展示一个一致的内存模型，JMM在不同的处理器中需要插入的内存屏障的数量和种类也不相同。下图展示了JMM在不同处理器内存模型中需要插入的内存屏障的示意图：</p>
<p><img src="" alt=""></p>
<p>如上图所示，JMM屏蔽了不同处理器内存模型的差异，它在不同的处理器平台之上为java程序员呈现了一个一致的内存模型。</p>
<h2 id="jmm-">JMM，处理器内存模型与顺序一致性内存模型之间的关系</h2>
<p>JMM是一个语言级的内存模型，处理器内存模型是硬件级的内存模型，顺序一致性内存模型是一个理论参考模型。下面是语言内存模型，处理器内存模型和顺序一致性内存模型的强弱对比示意图：</p>
<p><img src="" alt=""></p>
<p>从上图我们可以看出：常见的4种处理器内存模型比常用的3中语言内存模型要弱，处理器内存模型和语言内存模型都比顺序一致性内存模型要弱。同处理器内存模型一样，越是追求执行性能的语言，内存模型设计的会越弱。</p>
<h2 id="jmm-">JMM的设计</h2>
<p>从JMM设计者的角度来说，在设计JMM时，需要考虑两个关键因素：</p>
<ul>
<li>程序员对内存模型的使用。程序员希望内存模型易于理解，易于编程。程序员希望基于一个强内存模型来编写代码。</li>
<li>编译器和处理器对内存模型的实现。编译器和处理器希望内存模型对它们的束缚越少越好，这样它们就可以做尽可能多的优化来提高性能。编译器和处理器希望实现一个弱内存模型。</li>
</ul>
<p>由于这两个因素互相矛盾，所以JSR-133专家组在设计JMM时的核心目标就是找到一个好的平衡点：一方面要为程序员提供足够强的内存可见性保证；另一方面，对编译器和处理器的限制要尽可能的放松。下面让我们看看JSR-133是如何实现这一目标的。</p>
<p>为了具体说明，请看前面提到过的计算圆面积的示例代码：
double pi = 3.14; //A double r = 1.0; //B double area = pi /<em> r /</em> r; //C</p>
<p>上面计算圆的面积的示例代码存在三个happens- before关系：</p>
<ol>
<li>A happens- before B；</li>
<li>B happens- before C；</li>
<li>A happens- before C；</li>
</ol>
<p>由于A happens- before B，happens- before的定义会要求：A操作执行的结果要对B可见，且A操作的执行顺序排在B操作之前。 但是从程序语义的角度来说，对A和B做重排序即不会改变程序的执行结果，也还能提高程序的执行性能（允许这种重排序减少了对编译器和处理器优化的束缚）。也就是说，上面这3个happens- before关系中，虽然2和3是必需要的，但1是不必要的。因此，JMM把happens- before要求禁止的重排序分为了下面两类：</p>
<ul>
<li>会改变程序执行结果的重排序。</li>
<li>不会改变程序执行结果的重排序。</li>
</ul>
<p>JMM对这两种不同性质的重排序，采取了不同的策略：</p>
<ul>
<li>对于会改变程序执行结果的重排序，JMM要求编译器和处理器必须禁止这种重排序。</li>
<li>对于不会改变程序执行结果的重排序，JMM对编译器和处理器不作要求（JMM允许这种重排序）。</li>
</ul>
<p>下面是JMM的设计示意图：</p>
<p><img src="" alt=""></p>
<p>从上图可以看出两点：</p>
<ul>
<li>JMM向程序员提供的happens- before规则能满足程序员的需求。JMM的happens- before规则不但简单易懂，而且也向程序员提供了足够强的内存可见性保证（有些内存可见性保证其实并不一定真实存在，比如上面的A happens- before B）。</li>
<li>JMM对编译器和处理器的束缚已经尽可能的少。从上面的分析我们可以看出，JMM其实是在遵循一个基本原则：只要不改变程序的执行结果（指的是单线程程序和正确同步的多线程程序），编译器和处理器怎么优化都行。比如，如果编译器经过细致的分析后，认定一个锁只会被单个线程访问，那么这个锁可以被消除。再比如，如果编译器经过细致的分析后，认定一个volatile变量仅仅只会被单个线程访问，那么编译器可以把这个volatile变量当作一个普通变量来对待。这些优化既不会改变程序的执行结果，又能提高程序的执行效率。</li>
</ul>
<h2 id="jmm-">JMM的内存可见性保证</h2>
<p>Java程序的内存可见性保证按程序类型可以分为下列三类：</p>
<ol>
<li>单线程程序。单线程程序不会出现内存可见性问题。编译器，runtime和处理器会共同确保单线程程序的执行结果与该程序在顺序一致性模型中的执行结果相同。</li>
<li>正确同步的多线程程序。正确同步的多线程程序的执行将具有顺序一致性（程序的执行结果与该程序在顺序一致性内存模型中的执行结果相同）。这是JMM关注的重点，JMM通过限制编译器和处理器的重排序来为程序员提供内存可见性保证。</li>
<li>未同步/未正确同步的多线程程序。JMM为它们提供了最小安全性保障：线程执行时读取到的值，要么是之前某个线程写入的值，要么是默认值（0，null，false）。</li>
</ol>
<p>下图展示了这三类程序在JMM中与在顺序一致性内存模型中的执行结果的异同：</p>
<p><img src="" alt=""></p>
<p>只要多线程程序是正确同步的，JMM保证该程序在任意的处理器平台上的执行结果，与该程序在顺序一致性内存模型中的执行结果一致。</p>
<h2 id="jsr-133-">JSR-133对旧内存模型的修补</h2>
<p>JSR-133对JDK5之前的旧内存模型的修补主要有两个：</p>
<ul>
<li>增强volatile的内存语义。旧内存模型允许volatile变量与普通变量重排序。JSR-133严格限制volatile变量与普通变量的重排序，使volatile的写-读和锁的释放-获取具有相同的内存语义。</li>
<li>增强final的内存语义。在旧内存模型中，多次读取同一个final变量的值可能会不相同。为此，JSR-133为final增加了两个重排序规则。现在，final具有了初始化安全性。</li>
</ul>
<h2 id="-">参考文献</h2>
<ol>
<li><a href="http://www.amazon.com/Computer-Architecture-Fourth-Quantitative-Approach/dp/0123704901/ref=sr_1_10/102-0116773-7214567?ie=UTF8&amp;s=books&amp;qid=1188797467&amp;sr=1-10" target="_blank">Computer Architecture: A Quantitative Approach, 4th Edition</a></li>
<li><a href="http://www.hpl.hp.com/techreports/Compaq-DEC/WRL-95-7.pdf" target="_blank">Shared memory consistency models: A tutorial</a></li>
<li><a href="http://www.intel.com/content/dam/www/public/us/en/documents/manuals/itanium-architecture-software-developer-rev-2-3-vol-2-manual.pdf" target="_blank">Intel® Itanium® Architecture Software Developer’s Manual Volume 2: System Architecture</a></li>
<li><a href="http://www.amazon.com/Concurrent-Programming-Windows-Joe-Duffy/dp/032143482X/ref=sr_1_1?ie=UTF8&amp;s=books&amp;qid=1262571776&amp;sr=1-1" target="_blank">Concurrent Programming on Windows</a></li>
<li><a href="http://www.cs.umd.edu/users/pugh/java/memoryModel/jsr-133-faq.html" target="_blank">JSR 133 (Java Memory Model) FAQ</a></li>
<li><a href="http://gee.cs.oswego.edu/dl/jmm/cookbook.html" target="_blank">The JSR-133 Cookbook for Compiler Writers</a></li>
<li><a href="http://www.ibm.com/developerworks/java/library/j-jtp03304/index.html" target="_blank">Java theory and practice: Fixing the Java Memory Model, Part 2</a></li>
</ol>
<h2 id="-">关于作者</h2>
<p><strong>程晓明</strong>，Java软件工程师，国家认证的系统分析师、信息项目管理师。专注于并发编程，就职于富士通南大。个人邮箱：<a href="mailto:asst2003@163.com">asst2003@163.com</a>。</p>
<ul>
<li><a href="">Sections</a></li>
<li><a href="http://www.infoq.com/cn/architecture-design" target="_blank"><strong>架构 &amp; 设计</strong></a></li>
<li><a href="http://www.infoq.com/cn/development" target="_blank"><strong>语言 &amp; 开发</strong></a></li>
<li><a href="">Topics</a></li>
<li><a href="http://www.infoq.com/cn/Multi-threading" target="_blank">多线程</a></li>
<li><a href="http://www.infoq.com/cn/memory-model" target="_blank">内存模型</a></li>
<li><a href="http://www.infoq.com/cn/concurrency" target="_blank">并发</a></li>
<li><a href="http://www.infoq.com/cn/java" target="_blank">Java</a></li>
<li><a href="http://www.infoq.com/cn/special-column" target="_blank">专栏</a></li>
</ul>
<p>相关内容</p>
<h3 id="-java-final-http-www-infoq-com-cn-articles-java-memory-model-6-utm_source-infoq-utm_medium-related_content_link-utm_campaign-relatedcontent_articles_clk-"><a href="http://www.infoq.com/cn/articles/java-memory-model-6?utm_source=infoq&amp;utm_medium=related_content_link&amp;utm_campaign=relatedContent_articles_clk" target="_blank">深入理解Java内存模型（六）——final</a></h3>
<h3 id="-java-http-www-infoq-com-cn-articles-java-memory-model-5-utm_source-infoq-utm_medium-related_content_link-utm_campaign-relatedcontent_articles_clk-"><a href="http://www.infoq.com/cn/articles/java-memory-model-5?utm_source=infoq&amp;utm_medium=related_content_link&amp;utm_campaign=relatedContent_articles_clk" target="_blank">深入理解Java内存模型（五）——锁</a></h3>
<h3 id="-java-volatile-http-www-infoq-com-cn-articles-java-memory-model-4-utm_source-infoq-utm_medium-related_content_link-utm_campaign-relatedcontent_articles_clk-"><a href="http://www.infoq.com/cn/articles/java-memory-model-4?utm_source=infoq&amp;utm_medium=related_content_link&amp;utm_campaign=relatedContent_articles_clk" target="_blank">深入理解Java内存模型（四）——volatile</a></h3>
<h3 id="-java-http-www-infoq-com-cn-articles-java-memory-model-3-utm_source-infoq-utm_medium-related_content_link-utm_campaign-relatedcontent_articles_clk-"><a href="http://www.infoq.com/cn/articles/java-memory-model-3?utm_source=infoq&amp;utm_medium=related_content_link&amp;utm_campaign=relatedContent_articles_clk" target="_blank">深入理解Java内存模型（三）——顺序一致性</a></h3>
<h3 id="-java-http-www-infoq-com-cn-articles-java-memory-model-2-utm_source-infoq-utm_medium-related_content_link-utm_campaign-relatedcontent_articles_clk-"><a href="http://www.infoq.com/cn/articles/java-memory-model-2?utm_source=infoq&amp;utm_medium=related_content_link&amp;utm_campaign=relatedContent_articles_clk" target="_blank">深入理解Java内存模型（二）——重排序</a></h3>
<h2 id="-">您好，陌生人！</h2>
<p>您需要 <a href="http://www.infoq.com/reginit.action" target="_blank">注册一个InfoQ账号</a> 或者 <a href="">登录</a> 才能进行评论。在您完成注册后还需要进行一些设置。</p>
<h2 id="-infoq-">获得来自InfoQ的更多体验。 <a href=""></a></h2>
<h3 id="-">告诉我们您的想法</h3>
<p>允许的HTML标签: a,b,br,blockquote,i,li,pre,u,ul,p
当有人回复此评论时请E-mail通知我</p>
<p>社区评论  <a href="">Watch Thread</a></p>
<p><a href=""><strong>看完后有两点疑问，请教一下：</strong>  by Z CS Posted 21/03/2013 07:37</a>
<a href=""><strong>Re: 看完后有两点疑问，请教一下：</strong>  by 程 晓明 Posted 23/03/2013 12:50</a></p>
<p><a href=""><strong>编译器什么时候插入内存屏障？</strong>  by 黄 春 Posted 10/04/2013 12:49</a>
<a href=""><strong>Re: 编译器什么时候插入内存屏障？</strong>  by 程 晓明 Posted 14/04/2013 11:01</a>
<a href=""></a></p>
<p><strong>看完后有两点疑问，请教一下：</strong>  21/03/2013 07:37 by Z CS</p>
<ol>
<li>文中所写的 “未同步/未正确同步的多线程程序。JMM为它们提供了最小安全性保障：线程执行时读取到的值，要么是之前某个线程写入的值，要么是默认值（0，null，false）。”，JSR-133 真的做到这样了么? 那 么 long和double的 读写 的非原子性是怎么回事啊？是不是矛盾啊？</li>
<li>关于本文中最后“JSR-133为final增加了两个重排序规则。现在，final具有了初始化安全性。”，这句话，是不是也还要加上那个 前提“保证final引用不从构造函数内逸出”，final才能具有“初始化安全性”啊？</li>
</ol>
<ul>
<li><a href="">回复</a></li>
<li><a href="">回到顶部</a></li>
</ul>
<p><a href=""></a></p>
<p><strong>Re: 看完后有两点疑问，请教一下：</strong>  23/03/2013 12:50 by 程 晓明</p>
<p>谢谢您的关注。
/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>
问题1
最小安全性与64位数据的非原子性读/写并不矛盾。
它们是两个不同的概念，它们“发生”的时间点也不同。
最小安全性保证对象默认初始化之后（设置成员域为0，null或false），才会被任意线程使用。
最小安全性“发生”在对象被任意线程使用之前。
64位数据的非原子性读/写“发生”在对象被多个线程使用的过程中（读/写共享变量）。
当发生《本文三》末尾的那种问题时（处理器B看到仅仅被处理器A“写了一半“的无效值），
这里虽然处理器B读取到一个被写了一半的无效值，但这个值任然是处理器A写入的，只不过处理器A还没有写完而已。
最小安全性保证线程读取到的值，要么是之前某个线程写入的值，要么是默认值（0，null，false）。
但最小安全性并不保证线程读取到的共享变量的值，一定是某个线程写完后的值。
最小安全性保证线程读取到的值不会无中生有的冒出来，但并不保证线程读取到的值一定是正确的。
/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/*
问题2
是的，你的理解是对的。
这句话也要加上那个前提：“保证final引用不从构造函数内逸出”，final才能具有“初始化安全性”。</p>
<ul>
<li><a href="">回复</a></li>
<li><a href="">回到顶部</a>
<a href=""></a></li>
</ul>
<p><strong>编译器什么时候插入内存屏障？</strong>  10/04/2013 12:49 by 黄 春</p>
<p>厚积薄发之做。 明白了很多不解的地方。 这里有个问题想问下。 文中说“java编译器在生成字节码时，会在执行指令序列的适当位置插入内存屏障来限制处理器的重排序”。 这里有个问题请教。
插入内存屏障， 是在编译成字节码的时候完成， 还是在JIT执行的时候重新调整指令生成的？ 或者JIT只生产本地代码， 跟插入内存屏障之类的没关系？</p>
<ul>
<li><a href="">回复</a></li>
<li><a href="">回到顶部</a></li>
</ul>
<p><a href=""></a></p>
<p><strong>Re: 编译器什么时候插入内存屏障？</strong>  14/04/2013 11:01 by 程 晓明</p>
<p>Doug Lea在《The JSR-133 Cookbook for Compiler Writers》中，并没有明确指定插入内存屏障的时机。
个人估计，应该是取决于具体的JVM实现。</p>
<ul>
<li><a href="">回复</a></li>
<li><a href="">回到顶部</a></li>
</ul>
<p><a href="">关闭</a></p>
<h3 id="-by"><em>**</em> by</h3>
<p>发布于</p>
<ul>
<li><a href="">查看</a></li>
<li><a href="">回复</a></li>
<li><a href="">回到顶部</a>
<a href="">关闭</a>  主题   您的回复 <a href="">引用原消息</a></li>
</ul>
<p>允许的HTML标签: a,b,br,blockquote,i,li,pre,u,ul,p
当有人回复此评论时请E-mail通知我</p>
<p><a href="">关闭</a>  主题  您的回复</p>
<p>允许的HTML标签: a,b,br,blockquote,i,li,pre,u,ul,p
当有人回复此评论时请E-mail通知我
<a href="">关闭</a></p>
<ul>
<li>热点内容</li>
<li><a href="">本周</a></li>
<li><a href="">本月</a></li>
<li><a href="">近6个月</a><h3 id="-32-http-www-infoq-com-cn-news-2012-08-32-most-important-algorithms-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/news/2012/08/32-most-important-algorithms?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">计算机科学中最重要的32个算法</a></h3>
</li>
</ul>
<h3 id="-thoughtworks-2013-5-http-www-infoq-com-cn-articles-thoughtworks-technology-radar-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/articles/thoughtWorks-technology-radar?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">ThoughtWorks技术雷达（2013年5月）</a></h3>
<h3 id="-1-5-http-www-infoq-com-cn-articles-iqiyi-cloud-push-practices-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/articles/iqiyi-cloud-push-practices?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">让1.5亿移动端用户第一时间获取消息</a></h3>
<h3 id="-thoughtworks-ceo-http-www-infoq-com-cn-news-2013-06-tw-guoxiao-on-talents-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/news/2013/06/tw-guoxiao-on-talents?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">ThoughtWorks全球CEO郭晓谈软件人才的招聘与培养</a></h3>
<h3 id="-http-www-infoq-com-cn-news-2013-06-10-sins-for-scalability-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/news/2013/06/10-sins-for-scalability?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">影响可扩展性的十宗罪</a></h3>
<h3 id="-6-http-www-infoq-com-cn-minibooks-architect-jun-10-2013-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/minibooks/architect-jun-10-2013?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">架构师（6月刊）</a></h3>
<h3 id="-http-www-infoq-com-cn-articles-function-switch-realize-better-continuous-implementations-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/articles/function-switch-realize-better-continuous-implementations?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">使用功能开关更好地实现持续部署</a></h3>
<h3 id="-eclipse-github-http-www-infoq-com-cn-news-2013-06-eclipse-github-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/news/2013/06/eclipse-github?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">Eclipse迁移到GitHub</a></h3>
<h3 id="-newegg-com-http-www-infoq-com-cn-presentations-newegg-big-data-practice-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/presentations/newegg-big-data-practice?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">Newegg.com大数据实践</a></h3>
<h3 id="-http-www-infoq-com-cn-minibooks-software-sys-architect-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/minibooks/software-sys-architect?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">软件系统架构：使用视点和视角与利益相关者合作</a></h3>
<h3 id="-32-http-www-infoq-com-cn-news-2012-08-32-most-important-algorithms-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/news/2012/08/32-most-important-algorithms?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">计算机科学中最重要的32个算法</a></h3>
<h3 id="-6-http-www-infoq-com-cn-minibooks-architect-jun-10-2013-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/minibooks/architect-jun-10-2013?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">架构师（6月刊）</a></h3>
<h3 id="-rest-http-www-infoq-com-cn-news-2013-06-rest-drawbacks-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/news/2013/06/rest-drawbacks?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">REST的缺点是什么？</a></h3>
<h3 id="-google-web-ui-polymer-http-www-infoq-com-cn-news-2013-06-webcomponents-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/news/2013/06/webcomponents?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">Google 发布新一代Web UI库Polymer</a></h3>
<h3 id="-http-www-infoq-com-cn-news-2013-06-dianping-xinnet-hacked-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/news/2013/06/dianping-xinnet-hacked?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">大众点评网域名劫持事件概述</a></h3>
<h3 id="-node-js-grunt-js-http-www-infoq-com-cn-articles-gruntjs-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/articles/GruntJs?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">基于Node.js的自动化构建工具Grunt.js</a></h3>
<h3 id="-node-js-node-js-http-www-infoq-com-cn-articles-what-is-nodejs-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/articles/what-is-nodejs?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">深入浅出Node.js（一）：什么是Node.js</a></h3>
<h3 id="-http-www-infoq-com-cn-minibooks-i-m-wrights-hard-code-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/minibooks/i-m-wrights-hard-code?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">代码之殇·第二版</a></h3>
<h3 id="-http-www-infoq-com-cn-minibooks-software-sys-architect-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/minibooks/software-sys-architect?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">软件系统架构：使用视点和视角与利益相关者合作</a></h3>
<h3 id="-18-java-http-www-infoq-com-cn-news-2013-06-zhuhong-on-java-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/news/2013/06/zhuhong-on-java?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">大家谈18岁的Java——朱鸿：开过跑车后再去开大巴车总是有点不爽的</a></h3>
<h3 id="-32-http-www-infoq-com-cn-news-2012-08-32-most-important-algorithms-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/news/2012/08/32-most-important-algorithms?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">计算机科学中最重要的32个算法</a></h3>
<h3 id="-java-http-www-infoq-com-cn-articles-java-memory-model-1-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/articles/java-memory-model-1?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">深入理解Java内存模型（一）——基础</a></h3>
<h3 id="-node-js-node-js-http-www-infoq-com-cn-articles-what-is-nodejs-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/articles/what-is-nodejs?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">深入浅出Node.js（一）：什么是Node.js</a></h3>
<h3 id="-node-js-node-js-npm-http-www-infoq-com-cn-articles-nodejs-npm-install-config-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/articles/nodejs-npm-install-config?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">深入浅出Node.js（二）：Node.js&amp;NPM的安装与配置</a></h3>
<h3 id="-3-http-www-infoq-com-cn-minibooks-architect-mar-10-2013-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/minibooks/architect-mar-10-2013?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">架构师（3月刊）</a></h3>
<h3 id="-1-http-www-infoq-com-cn-minibooks-architect-jan-10-2013-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/minibooks/architect-jan-10-2013?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">架构师（1月刊）</a></h3>
<h3 id="-4-http-www-infoq-com-cn-minibooks-architect-apr-10-2013-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/minibooks/architect-apr-10-2013?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">架构师（4月刊）</a></h3>
<h3 id="-java-http-www-infoq-com-cn-articles-java-threadpool-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/articles/java-threadPool?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">聊聊并发（三）——JAVA线程池的分析和使用</a></h3>
<h3 id="-2-http-www-infoq-com-cn-minibooks-architect-feb-10-2013-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/minibooks/architect-feb-10-2013?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">架构师（2月刊）</a></h3>
<h3 id="-12306-github-http-www-infoq-com-cn-news-2013-01-12306-plugin-ddos-github-utm_source-infoq-utm_medium-popular_links_homepage-"><a href="http://www.infoq.com/cn/news/2013/01/12306-plugin-ddos-github?utm_source=infoq&amp;utm_medium=popular_links_homepage" target="_blank">12306订票助手插件拖垮GitHub事件原因始末</a></h3>
<h2 id="-">深度内容</h2>
<ul>
<li><a href="">全部</a></li>
<li><a href="">文章</a></li>
<li><a href="">演讲</a></li>
<li><a href="">访谈</a></li>
<li><a href="">迷你书</a><h2 id="-juergen-fesslmeier-javascript-http-www-infoq-com-cn-interviews-end-to-end-javascript-juergen-fesslmeier-javascript-"><a href="http://www.infoq.com/cn/interviews/end-to-end-javascript" title="Juergen Fesslmeier谈端到端的JavaScript开发" target="_blank">Juergen Fesslmeier谈端到端的JavaScript开发</a></h2>
</li>
</ul>
<p><a href="http://www.infoq.com/cn/author/Juergen-Fesslmeier" title="Juergen Fesslmeier" target="_blank">Juergen Fesslmeier</a> 七月 02, 2013</p>
<p><a href="http://www.infoq.com/cn/interviews/end-to-end-javascript" title="Juergen Fesslmeier谈端到端的JavaScript开发" target="_blank"><img src="" alt=""></a></p>
<h2 id="-http-www-infoq-com-cn-articles-design-pattern-automation-"><a href="http://www.infoq.com/cn/articles/Design-Pattern-Automation" title="设计模式自动化" target="_blank">设计模式自动化</a></h2>
<p><a href="http://www.infoq.com/cn/author/Gael-Fraiteur-and-Yan-Cui" title="Gael Fraiteur and Yan Cui" target="_blank">Gael Fraiteur and Yan Cui</a> 七月 01, 2013</p>
<p><a href="http://www.infoq.com/cn/articles/Design-Pattern-Automation" title="设计模式自动化" target="_blank"><img src="" alt=""></a></p>
<h2 id="-http-www-infoq-com-cn-articles-designing-a-world-at-your-fingertips-mobile-user-interfaces-"><a href="http://www.infoq.com/cn/articles/designing-a-world-at-your-fingertips-mobile-user-interfaces" title="设计指尖上的世界：移动用户界面一瞥" target="_blank">设计指尖上的世界：移动用户界面一瞥</a></h2>
<p><a href="http://www.infoq.com/cn/author/Forrest-Shull" title="Forrest Shull" target="_blank">Forrest Shull</a> 六月 28, 2013</p>
<p><a href="http://www.infoq.com/cn/articles/designing-a-world-at-your-fingertips-mobile-user-interfaces" title="设计指尖上的世界：移动用户界面一瞥" target="_blank"><img src="" alt=""></a></p>
<h2 id="-alm-http-www-infoq-com-cn-articles-integrated-alm-alm-"><a href="http://www.infoq.com/cn/articles/Integrated-ALM" title="成功的根本—集成的ALM工具" target="_blank">成功的根本—集成的ALM工具</a></h2>
<p><a href="http://www.infoq.com/cn/author/Dave-West" title="Dave West" target="_blank">Dave West</a> 六月 28, 2013</p>
<p><a href="http://www.infoq.com/cn/articles/Integrated-ALM" title="成功的根本—集成的ALM工具" target="_blank"><img src="" alt=""></a></p>
<h2 id="-http-www-infoq-com-cn-articles-atdd-by-example-book-"><a href="http://www.infoq.com/cn/articles/atdd-by-example-book" title="书评：验收测试驱动开发实践指南" target="_blank">书评：验收测试驱动开发实践指南</a></h2>
<p><a href="http://www.infoq.com/cn/author/Manuel-Pais" title="Manuel Pais" target="_blank">Manuel Pais</a> 六月 26, 2013</p>
<p><a href="http://www.infoq.com/cn/articles/atdd-by-example-book" title="书评：验收测试驱动开发实践指南" target="_blank"><img src="" alt=""></a></p>
<h2 id="-web-http-www-infoq-com-cn-presentations-across-device-web-web-"><a href="http://www.infoq.com/cn/presentations/across-device-web" title="跨终端的web" target="_blank">跨终端的web</a></h2>
<p><a href="http://www.infoq.com/cn/author/%E8%88%92%E6%96%87%E4%BA%AE" title="舒文亮" target="_blank">舒文亮</a> 六月 26, 2013</p>
<p><a href="http://www.infoq.com/cn/presentations/across-device-web" title="跨终端的web" target="_blank"><img src="" alt=""></a></p>
<ul>
<li><a href="">更早的 &gt;</a></li>
</ul>
<p>赞助商链接</p>
<h3 id="infoq-">InfoQ每周精要</h3>
<p>通过个性化定制的新闻邮件、RSS Feeds和InfoQ业界邮件通知，保持您对感兴趣的社区内容的时刻关注。
<a href="http://www.infoq.com/cn/newsletter_sample.html" target="_blank"><img src="" alt=""></a></p>
<p>语言 &amp; 开发</p>
<p><a href="http://www.infoq.com/cn/interviews/end-to-end-javascript" title="Juergen Fesslmeier谈端到端的JavaScript开发" target="_blank">Juergen Fesslmeier谈端到端的JavaScript开发</a></p>
<p><a href="http://www.infoq.com/cn/news/2013/07/mobilecloud-tfs" title="MobileCloud for TFS支持测试Windows Phone,Android,iOS及BlackBerry应用" target="_blank">MobileCloud for TFS支持测试Windows Phone,Android,iOS及BlackBerry应用</a></p>
<p><a href="http://www.infoq.com/cn/news/2013/07/baidu-salon39-summary" title="百度技术沙龙第39期回顾：前端快速开发实践（含资料下载）" target="_blank">百度技术沙龙第39期回顾：前端快速开发实践（含资料下载）</a></p>
<p>架构 &amp; 设计</p>
<p><a href="http://www.infoq.com/cn/news/2013/07/Native-Performance" title="内存与本机代码的性能" target="_blank">内存与本机代码的性能</a></p>
<p><a href="http://www.infoq.com/cn/articles/Design-Pattern-Automation" title="设计模式自动化" target="_blank">设计模式自动化</a></p>
<p><a href="http://www.infoq.com/cn/news/2013/07/WinRT-Devices" title="连接设备编程" target="_blank">连接设备编程</a>
过程 &amp; 实践</p>
<p><a href="http://www.infoq.com/cn/articles/Integrated-ALM" title="成功的根本—集成的ALM工具" target="_blank">成功的根本—集成的ALM工具</a></p>
<p><a href="http://www.infoq.com/cn/news/2013/06/tw-guoxiao-on-talents" title="ThoughtWorks全球CEO郭晓谈软件人才的招聘与培养" target="_blank">ThoughtWorks全球CEO郭晓谈软件人才的招聘与培养</a></p>
<p><a href="http://www.infoq.com/cn/articles/atdd-by-example-book" title="书评：验收测试驱动开发实践指南" target="_blank">书评：验收测试驱动开发实践指南</a></p>
<p>运维 &amp; 基础架构</p>
<p><a href="http://www.infoq.com/cn/news/2013/06/devops-in-traditional-enterprise" title="在传统企业中引入DevOps" target="_blank">在传统企业中引入DevOps</a></p>
<p><a href="http://www.infoq.com/cn/news/2013/06/dod-ams-day1-s-is-for-security" title="安全性——“DevOpS”中的S" target="_blank">安全性——“DevOpS”中的S</a></p>
<p><a href="http://www.infoq.com/cn/articles/atdd-by-example-book" title="书评：验收测试驱动开发实践指南" target="_blank">书评：验收测试驱动开发实践指南</a>
企业架构</p>
<p><a href="http://www.infoq.com/cn/articles/designing-a-world-at-your-fingertips-mobile-user-interfaces" title="设计指尖上的世界：移动用户界面一瞥" target="_blank">设计指尖上的世界：移动用户界面一瞥</a></p>
<p><a href="http://www.infoq.com/cn/news/2013/06/stratos-2" title="Stratos 2.0已发布，支持所有运行时环境和30个IaaS" target="_blank">Stratos 2.0已发布，支持所有运行时环境和30个IaaS</a></p>
<p><a href="http://www.infoq.com/cn/articles/iqiyi-cloud-push-practices" title="让1.5亿移动端用户第一时间获取消息" target="_blank">让1.5亿移动端用户第一时间获取消息</a></p>
<ul>
<li><a href="http://www.infoq.com/cn/" title="首页" target="_blank">首页</a></li>
<li><a href="http://www.infoq.com/cn/topics" title="全部话题" target="_blank">全部话题</a></li>
<li><a href="http://www.qconferences.com/" title="QCon全球软件开发大会" target="_blank">QCon全球软件开发大会</a></li>
<li><a href="http://www.infoq.com/cn/aboutus" title="关于我们" target="_blank">关于我们</a></li>
<li><a href="http://www.infoq.com/cn/contribute" title="让大家在InfoQ上听见你的声音" target="_blank">让大家在InfoQ上听见你的声音</a></li>
<li><a href="http://www.infoq.com/cn/reginit.action" title="创建账号" target="_blank">创建账号</a></li>
<li><p><a href="&quot;登录&quot;">登录</a></p>
</li>
<li><p><strong>会议</strong></p>
</li>
<li><a href="http://www.qconshanghai.com/" title="技术大会：QCon上海2013，11月1-3日 " target="_blank">QCon全球软件开发大会（上海站）2013，11月1-3日</a><h3 id="infoq-">InfoQ每周精要</h3>
</li>
</ul>
<p>通过个性化定制的新闻邮件、RSS Feeds和InfoQ业界邮件通知，保持您对感兴趣的社区内容的时刻关注。</p>
<p><a href="http://www.infoq.com/cn/newsletter_sample.html" target="_blank"><img src="" alt=""></a></p>
<ul>
<li><a href="http://www.infoq.com/cn/rss/rss.action?token=AjlwmaWcwi5ejkcT6GcRk1pCqJ4K7ocs" target="_blank">属于您的个性化RSS</a></li>
<li><a href="http://weibo.com/infoqchina" target="_blank">新浪微博</a></li>
<li><a href="http://www.facebook.com/InfoQ" target="_blank">社区新闻和热点</a></li>
</ul>
<p>特别专题</p>
<ul>
<li><a href="http://www.infoq.com/cn/chinaitevents" target="_blank"><strong>技术社区活动日历</strong></a></li>
<li><a href="http://www.infoq.com/cn/zones/baidu-salon/" target="_blank"><strong>百度技术沙龙</strong></a></li>
<li><a href="http://www.infoq.com/cn/scrum/" target="_blank"><strong>Scrum开发</strong></a></li>
<li><a href="http://www.infoq.com/cn/architect/" target="_blank"><strong>月刊：《架构师》</strong></a></li>
<li><a href="http://www.infoq.com/cn/qclub/" target="_blank"><strong>线下活动：QClub</strong></a>
定制您感兴趣的技术领域</li>
</ul>
<p>语言 &amp; 开发 架构 &amp; 设计 过程 &amp; 实践 运维 &amp; 基础架构 企业架构
提供反馈</p>
<p><a href="mailto:feedback@cn.infoq.com">feedback@cn.infoq.com</a>
 错误报告</p>
<p><a href="mailto:bugs@cn.infoq.com">bugs@cn.infoq.com</a>
 商务合作</p>
<p><a href="mailto:sales@cn.infoq.com">sales@cn.infoq.com</a>
 内容合作</p>
<p><a href="mailto:editors@cn.infoq.com">editors@cn.infoq.com</a>
 InfoQ.com及所有内容，版权所有 © 2006-2013 C4Media Inc. InfoQ.com 服务器由 <a href="http://www.contegix.com/" target="_blank">Contegix</a>提供, 我们最信赖的ISP合作伙伴。
<a href="http://www.infoq.com/cn/privacypolicy" target="_blank">隐私政策</a></p>
<p><a href="">Close</a>  E-mail  密码</p>
<p><a href="http://www.infoq.com/cn/social/googleLogin.action?fl=login" title="使用Google账号登录" target="_blank">使用Google账号登录</a>  <a href="http://www.infoq.com/cn/social/liveLogin.action?fl=login" title="使用Microsoft账号登录" target="_blank">使用Microsoft账号登录</a>
<a href="">忘记密码？</a>
   InfoQ账号使用的E-mail  发送邮件</p>
<p><a href="">重新登录</a>
重新发送激活信息  重新发送</p>
<p><a href="">重新登录</a>
<a href="http://www.infoq.com/cn/reginit.action" target="_blank">没有用户名？</a></p>
<p><a href="http://www.infoq.com/cn/reginit.action" target="_blank">点击注册</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_多线程/">Java_多线程</a></li><li><a href="/categories/Java&J2EE/Java_多线程/内存/">内存</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_多线程/" class="label label-success">Java_多线程</a><a href="/tags/内存/" class="label label-info">内存</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程-内存--深入理解Java内存模型（七）——总结/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_多线程-内存--深入理解Java内存模型（七）——总结" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-JVM--GC悲观策略之ParallelGC篇/">GC悲观策略之Parallel GC篇</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-JVM--GC悲观策略之ParallelGC篇/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="gc-parallel-gc-">GC悲观策略之Parallel GC篇</h1>
<h1 id="-bluedavy-blog-https-blog-bluedavy-com-"><a href="https://blog.bluedavy.com/" target="_blank">BlueDavy之技术blog</a></h1>
<p>{互联网，OSGi，Java, High Scalability, High Performance,HA}</p>
<ul>
<li><a href="https://blog.bluedavy.com/" target="_blank">Home</a></li>
<li><a href="https://blog.bluedavy.com/?page_id=2" target="_blank">About</a></li>
<li><a href="https://blog.bluedavy.com/?page_id=81" target="_blank">Photos</a></li>
</ul>
<h2 id="-gc-parallel-gc-https-blog-bluedavy-com-p-166-gc-parallel-gc-"><a href="https://blog.bluedavy.com/?p=166" title="GC悲观策略之Parallel GC篇" target="_blank">GC悲观策略之Parallel GC篇</a></h2>
<p>Nov 07</p>
<p><a href="http://bluedavy.com/" title="Visit bluedavy’s website" target="_blank">bluedavy</a><a href="https://blog.bluedavy.com/?cat=13" title="View all posts in jvm" target="_blank">jvm</a> <a href="https://blog.bluedavy.com/?tag=gc" target="_blank">gc</a>, <a href="https://blog.bluedavy.com/?tag=jvm" target="_blank">jvm</a>, <a href="https://blog.bluedavy.com/?tag=pessimism-policy" target="_blank">pessimism policy</a>, <a href="https://blog.bluedavy.com/?tag=%e6%82%b2%e8%a7%82%e7%ad%96%e7%95%a5" target="_blank">悲观策略</a> <a href="&quot;Comment on GC悲观策略之Parallel GC篇&quot;">12 Comments</a>
先来看段代码：
<a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
import</p>
<p>java.util./*;</p>
<p>public</p>
<p>class</p>
<p>SummaryCase{</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>main(String[] args)</p>
<p>throws</p>
<p>Exception{</p>
<p>List<Object> caches=</p>
<p>new</p>
<p>ArrayList<Object>();</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>i=</p>
<p>0</p>
<p>;i&lt;</p>
<p>7</p>
<p>;i++){</p>
<p>caches.add(</p>
<p>new</p>
<p>byte</p>
<p>[</p>
<p>1024</p>
<p>/*</p>
<p>1024</p>
<p>/*</p>
<p>3</p>
<p>]);</p>
<p>}</p>
<p>caches.clear();</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>i=</p>
<p>0</p>
<p>;i&lt;</p>
<p>2</p>
<p>;i++){</p>
<p>caches.add(</p>
<p>new</p>
<p>byte</p>
<p>[</p>
<p>1024</p>
<p>/*</p>
<p>1024</p>
<p>/*</p>
<p>3</p>
<p>]);</p>
<p>}</p>
<p>Thread.sleep(</p>
<p>10000</p>
<p>);</p>
<p>}</p>
<p>}</p>
<p>当用-Xms30m -Xmx30m -Xmn10m -XX:+UseParallelGC执行上面的代码时会执行几次Minor GC和几次Full GC呢？
按照eden空间不足时触发minor gc的规则，上面代码执行后的GC应为：M、M、M、M，但实际上上面代码执行后GC则为：M、M、M、F、F。
这里的原因就在于Parallel Scavenge GC时的悲观策略，当在eden上分配内存失败时且对象的大小尚不需要直接在old上分配时，会触发YGC，代码片段如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24
25</p>
<p>26
27</p>
<p>28
29</p>
<p>30
31</p>
<p>32
33</p>
<p>34
35</p>
<p>36
37void</p>
<p>PSScavenge::invoke(){</p>
<p>...
bool</p>
<p>scavenge_was_done = PSScavenge::invoke_no_policy();</p>
<p>PSGCAdaptivePolicyCounters/* counters = heap-&gt;gc_policy_counters();
if</p>
<p>(UsePerfData)</p>
<p>counters-&gt;update_full_follows_scavenge(0);
if</p>
<p>(!scavenge_was_done ||</p>
<p>policy-&gt;should_full_GC(heap-&gt;old_gen()-&gt;free_in_bytes())) {
if</p>
<p>(UsePerfData)</p>
<p>counters-&gt;update_full_follows_scavenge(full_follows_scavenge);&lt;</p>
<p>GCCauseSetter gccs(heap, GCCause::_adaptive_size_policy);
if</p>
<p>(UseParallelOldGC) {</p>
<p>PSParallelCompact::invoke_no_policy(</p>
<p>false</p>
<p>);
}</p>
<p>else</p>
<p>{</p>
<p>PSMarkSweep::invoke_no_policy(</p>
<p>false</p>
<p>);
}</p>
<p>}
...</p>
<p>}
PSScavenge::invoke_no_policy{</p>
<p>...
if</p>
<p>(!should_attempt_scavenge()) {</p>
<p>return</p>
<p>false</p>
<p>;
}</p>
<p>...
}</p>
<p>bool</p>
<p>PSScavenge::should_attempt_scavenge() {
...</p>
<p>PSAdaptiveSizePolicy/* policy = heap-&gt;size_policy();</p>
<p>size_t</p>
<p>avg_promoted = (</p>
<p>size_t</p>
<p>) policy-&gt;padded_average_promoted_in_bytes();
size_t</p>
<p>promotion_estimate = MIN2(avg_promoted, young_gen-&gt;used_in_bytes());</p>
<p>bool</p>
<p>result = promotion_estimate &lt; old_gen-&gt;free_in_bytes();
...</p>
<p>return</p>
<p>result;
}</p>
<p>在上面should_attempt_scavenge代码片段中，可以看到会比较之前YGC晋升到Old中的平均大小与当前新生代中已被使用的字节数大小，取更小的值与旧生代目前剩余空间大小对比，如更大，则返回false，就终止了YGC的执行了，当返回false时，PSScavenge::invoke就将触发Full GC了。
在PSScavenge:invoke中还有一个条件为：policy-&gt;should_full_GC(heap-&gt;old_gen()-&gt;free_in_bytes()，来看看这段代码片段：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5bool</p>
<p>PSAdaptiveSizePolicy::should_full_GC(</p>
<p>size_t</p>
<p>old_free_in_bytes) {</p>
<p>bool</p>
<p>result = padded_average_promoted_in_bytes() &gt; (</p>
<p>float</p>
<p>) old_free_in_bytes;
...</p>
<p>return</p>
<p>result;
}</p>
<p>可看到，这段代码检查的也是之前YGC时晋升到old的平均大小是否大于了旧生代的剩余空间，如大于，则触发full gc。
总结上面分析的策略，可以看到采用Parallel GC的情况下，当YGC触发时，会有两个检查：
1、在YGC执行前，min(目前新生代已使用的大小,之前平均晋升到old的大小中的较小值) &gt; 旧生代剩余空间大小 ? 不执行YGC，直接执行Full GC : 执行YGC；
2、在YGC执行后，平均晋升到old的大小 &gt; 旧生代剩余空间大小 ? 触发Full GC ： 什么都不做。</p>
<p>按照这样的说明，再来看看上面代码的执行过程中eden和old大小的变化状况：
代码 eden old YGC FGC
第一次循环 3 0 0 0
第二次循环 6 0 0 0
第三次循环 3 6 1 0
第四次循环 6 6 1 0
第五次循环 3 12 2 0
第六次循环 6 12 2 0
第七次循环 3 18 3 1
第八次循环 6 18 3 1
第九次循环 3 3 3 2
在第7次循环时，YGC后旧生代剩余空间为2m，而之前平均晋级到old的对象大小为6m，因此在YGC后会触发一次FGC。
而第9次循环时，在YGC执行前，此时新生代已使用的大小为6m，之前晋级到old的平均大小为6m，这两者去最小值为6m，这个值已大于old的剩余空间，因此就不执行YGC，直接执行FGC了。</p>
<p>Sun JDK之所以要有悲观策略，我猜想理由是程序最终是会以一个较为稳态的状况执行的，此时每次YGC后晋升到old的对象大小应该是差不多的，在YGC时做好检查，避免等YGC后晋升到Old的对象导致old空间不足，因此还不如干脆就直接执行FGC，正因为悲观策略的存在，大家有些时候可能会看到old空间没满但full gc执行的状况。
埋个伏笔，大家将上面的执行参数换为-XX:+UseSerialGC执行看看，会发生什么呢？ <img src="" alt=":)"></p>
<p><a href="https://blog.bluedavy.com/?p=114" target="_blank">JavaOne美国之行–硅谷公司交流篇</a> <a href="https://blog.bluedavy.com/?p=170" target="_blank">GC悲观策略之Serial GC篇</a></p>
<h3 id="12-comments-add-yours-">12 Comments <em>(<a href="">+add yours?</a>)</em></h3>
<ol>
<li><img src="" alt=""> xan
<strong>Nov 08, 2010</strong> @ 11:58:44
代码布局不怎么给力啊 <img src="" alt=":)"></li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Nov 08, 2010</strong> @ 12:23:52
确实不给力，我折腾下。</li>
<li><img src="https://secure.gravatar.com/avatar/3ed95d835a4c573899a9be257428c69f?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://twitter.com/imbeneo" target="_blank">imbeneo</a>
<strong>Nov 08, 2010</strong> @ 13:12:45
我忘记了clean，结果总是OOM。</li>
<li><img src="https://secure.gravatar.com/avatar/03ec79001b70a7dc41d51c1db4db4baa?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> oliver
<strong>Apr 26, 2011</strong> @ 11:34:35
我的疑问是为什么第一次full gc时old里面使用空间没有被回收掉，第二次full gc时old里面才回收？</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Apr 26, 2011</strong> @ 13:32:18
因为caches.clear是后来才调的…</li>
<li><img src="https://secure.gravatar.com/avatar/3cc9849504cb6c7c78b5533df02043ac?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://www.dosmile.net/" target="_blank">yinhex</a>
<strong>Jul 09, 2011</strong> @ 22:38:20
这里我有个问题啊：我看你的分布式基础看到你能举例出很多大网站的设计。不知道你是从哪里可以看到这些信息的呢？可以细数一下你经常上去获取信息国外网站吗？</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Jul 11, 2011</strong> @ 10:01:48
@yinhex
一般来说，例如highscalability.com，还有各种国外的技术大会，各家著名公司的engineer的blog，都会有这些信息，:)</li>
<li><img src="https://secure.gravatar.com/avatar/f2ec9eb448e778dc947957c779fdd735?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> Gary
<strong>Sep 29, 2011</strong> @ 11:09:58
-XX:+UseSerialGC gc.log发现是MMMMF,符合预期啊</li>
<li><img src="https://secure.gravatar.com/avatar/e9ef6892fbac714e6678cd30f4a212f4?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> yangxuesong
<strong>Nov 29, 2011</strong> @ 17:31:49
一次full gc的执行流程是怎么用的呢？</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Dec 03, 2011</strong> @ 11:10:22
@yangxuesong
这个…要看是什么垃圾收集器…<h3 id="leave-a-reply">Leave a Reply</h3>
</li>
</ol>
<p><a href="">Cancel</a></p>
<p>Name (required)</p>
<p>Mail (required)</p>
<p>Website</p>
<p><img src="&quot;CAPTCHA Image&quot;" alt="CAPTCHA Image"></p>
<p><a href="&quot;Refresh Image&quot;"><img src="" alt="Refresh Image"></a></p>
<p>CAPTCHA Code /*</p>
<p><style type='text/css'>/#submit {display:none;}</style><br /> <input name="submit" type="submit" id="submit-alt" tabindex="6" value="Submit Comment" /></p>
<p>July 2013 M T W T F S S <a href="https://blog.bluedavy.com/?m=201303" title="View posts for March 2013" target="_blank">« Mar</a>     1234567 891011121314 15161718192021 22232425262728 293031  </p>
<h3 id="categories">Categories</h3>
<ul>
<li><a href="https://blog.bluedavy.com/?cat=63" title="View all posts filed under Java" target="_blank">Java</a> (10)</li>
<li><a href="https://blog.bluedavy.com/?cat=13" title="View all posts filed under jvm" target="_blank">jvm</a> (19)</li>
<li><a href="https://blog.bluedavy.com/?cat=56" title="View all posts filed under NoSQL" target="_blank">NoSQL</a> (7)</li>
<li><a href="https://blog.bluedavy.com/?cat=4" title="View all posts filed under SOA" target="_blank">SOA</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=11" title="关于《分布式Java应用：基础与实践》书部分章节的公开、书内容的纠错以及补充完善。" target="_blank">书:分布式Java应用</a> (5)</li>
<li><a href="https://blog.bluedavy.com/?cat=6" title="View all posts filed under 互联网" target="_blank">互联网</a> (5)</li>
<li><a href="https://blog.bluedavy.com/?cat=46" title="View all posts filed under 产品总结" target="_blank">产品总结</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=18" title="View all posts filed under 优化案例" target="_blank">优化案例</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=12" title="View all posts filed under 圆桌交流" target="_blank">圆桌交流</a> (2)</li>
<li><a href="https://blog.bluedavy.com/?cat=8" title="View all posts filed under 容量规划" target="_blank">容量规划</a> (2)</li>
<li><a href="https://blog.bluedavy.com/?cat=97" title="View all posts filed under 迁户口" target="_blank">迁户口</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=52" title="View all posts filed under 高可用" target="_blank">高可用</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=3" title="View all posts filed under 高并发" target="_blank">高并发</a> (3)</li>
<li><p><a href="https://blog.bluedavy.com/?cat=1" title="关于性能优化方面的一些东西。" target="_blank">高性能</a> (2)</p>
<h3 id="recent-comments">Recent Comments</h3>
</li>
<li><p><a href="http://code1.riaos.com/?p=5030138" target="_blank">JVM调优 | code1（code1.riaos.com）</a> on <a href="https://blog.bluedavy.com/?p=70&amp;cpage=1#comment-16520" target="_blank">说说MaxTenuringThreshold这个参数</a></p>
</li>
<li><a href="http://architecture1.riaos.com/?p=3063358" target="_blank">JVM调优 | architecture（riaos.com）</a> on <a href="https://blog.bluedavy.com/?p=70&amp;cpage=1#comment-16519" target="_blank">说说MaxTenuringThreshold这个参数</a></li>
<li><a href="http://bluedavy.com/" target="_blank">bluedavy</a> on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16462" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
<li>xiaobo on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16460" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
<li><a href="http://bluedavy.com/" target="_blank">bluedavy</a> on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16459" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
</ul>
<h3 id="tags">Tags</h3>
<p><a href="https://blog.bluedavy.com/?tag=btrace" title="2 topics" target="_blank">btrace</a> <a href="https://blog.bluedavy.com/?tag=c1" title="1 topic" target="_blank">c1</a> <a href="https://blog.bluedavy.com/?tag=c2" title="1 topic" target="_blank">c2</a> <a href="https://blog.bluedavy.com/?tag=deflater" title="1 topic" target="_blank">Deflater</a> <a href="https://blog.bluedavy.com/?tag=facebook" title="2 topics" target="_blank">facebook</a> <a href="https://blog.bluedavy.com/?tag=gc" title="4 topics" target="_blank">gc</a> <a href="https://blog.bluedavy.com/?tag=gc-tuning" title="2 topics" target="_blank">gc tuning</a> <a href="https://blog.bluedavy.com/?tag=grizzly" title="2 topics" target="_blank">Grizzly</a> <a href="https://blog.bluedavy.com/?tag=hbase" title="6 topics" target="_blank">HBase</a> <a href="https://blog.bluedavy.com/?tag=hotspot" title="1 topic" target="_blank">hotspot</a> <a href="https://blog.bluedavy.com/?tag=inflater" title="1 topic" target="_blank">Inflater</a> <a href="https://blog.bluedavy.com/?tag=interpreter" title="1 topic" target="_blank">interpreter</a> <a href="https://blog.bluedavy.com/?tag=javac" title="1 topic" target="_blank">javac</a> <a href="https://blog.bluedavy.com/?tag=java-code-generation" title="1 topic" target="_blank">java code generation</a> <a href="https://blog.bluedavy.com/?tag=javaone" title="4 topics" target="_blank">JavaOne</a> <a href="https://blog.bluedavy.com/?tag=javaone-general-technical-session" title="1 topic" target="_blank">javaone general technical session</a> <a href="https://blog.bluedavy.com/?tag=java%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c" title="1 topic" target="_blank">java代码执行</a> <a href="https://blog.bluedavy.com/?tag=java-%e5%b9%b6%e5%8f%91" title="1 topic" target="_blank">Java 并发</a> <a href="https://blog.bluedavy.com/?tag=jit" title="1 topic" target="_blank">jit</a> <a href="https://blog.bluedavy.com/?tag=jvm" title="12 topics" target="_blank">jvm</a> <a href="https://blog.bluedavy.com/?tag=memory-management" title="1 topic" target="_blank">memory management</a> <a href="https://blog.bluedavy.com/?tag=native-memory-leak" title="1 topic" target="_blank">Native Memory Leak</a> <a href="https://blog.bluedavy.com/?tag=nosql" title="2 topics" target="_blank">NoSQL</a> <a href="https://blog.bluedavy.com/?tag=oom" title="1 topic" target="_blank">oom</a> <a href="https://blog.bluedavy.com/?tag=oracle-keynote" title="1 topic" target="_blank">oracle keynote</a> <a href="https://blog.bluedavy.com/?tag=pessimism-policy" title="1 topic" target="_blank">pessimism policy</a> <a href="https://blog.bluedavy.com/?tag=references" title="1 topic" target="_blank">references</a> <a href="https://blog.bluedavy.com/?tag=rpc" title="2 topics" target="_blank">RPC</a> <a href="https://blog.bluedavy.com/?tag=serial-gc" title="1 topic" target="_blank">serial gc</a> <a href="https://blog.bluedavy.com/?tag=soa" title="2 topics" target="_blank">SOA</a> <a href="https://blog.bluedavy.com/?tag=sun-jdk" title="1 topic" target="_blank">sun jdk</a> <a href="https://blog.bluedavy.com/?tag=sun-jdk-oom" title="1 topic" target="_blank">sun jdk oom</a> <a href="https://blog.bluedavy.com/?tag=web%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92%e7%9a%84%e8%89%ba%e6%9c%af" title="1 topic" target="_blank">Web容量规划的艺术</a> <a href="https://blog.bluedavy.com/?tag=yuanzhuo" title="1 topic" target="_blank">yuanzhuo</a> <a href="https://blog.bluedavy.com/?tag=%e4%b9%a6" title="1 topic" target="_blank">书:分布式Java应用</a> <a href="https://blog.bluedavy.com/?tag=%e4%b9%a6%e8%af%84" title="1 topic" target="_blank">书评</a> <a href="https://blog.bluedavy.com/?tag=%e4%ba%92%e8%81%94%e7%bd%91%e6%8a%80%e6%9c%af" title="1 topic" target="_blank">互联网技术</a> <a href="https://blog.bluedavy.com/?tag=%e4%ba%a4%e6%b5%81" title="1 topic" target="_blank">交流</a> <a href="https://blog.bluedavy.com/?tag=%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86" title="1 topic" target="_blank">内存管理</a> <a href="https://blog.bluedavy.com/?tag=%e5%88%86%e5%b8%83%e5%bc%8fjava%e5%ba%94%e7%94%a8" title="2 topics" target="_blank">分布式Java应用</a> <a href="https://blog.bluedavy.com/?tag=%e5%9c%86%e6%a1%8c%e4%ba%a4%e6%b5%81" title="1 topic" target="_blank">圆桌交流</a> <a href="https://blog.bluedavy.com/?tag=%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92" title="2 topics" target="_blank">容量规划</a> <a href="https://blog.bluedavy.com/?tag=%e6%82%b2%e8%a7%82%e7%ad%96%e7%95%a5" title="3 topics" target="_blank">悲观策略</a> <a href="https://blog.bluedavy.com/?tag=%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6" title="1 topic" target="_blank">服务框架</a> <a href="https://blog.bluedavy.com/?tag=%e7%a1%85%e8%b0%b7%e5%85%ac%e5%8f%b8" title="1 topic" target="_blank">硅谷公司</a></p>
<h3 id="-">订阅</h3>
<h3 id="-">推荐书籍</h3>
<h3 id="my-book">My Book</h3>
<p><a href="http://book.douban.com/subject/4848587/" title="分布式Java应用：基础与实践" target="_blank"><img src="" alt=""></a> <a href="http://book.douban.com/subject/3843896/" title="OSGi原理与最佳实践" target="_blank"><img src="" alt=""></a>
© <a href="https://blog.bluedavy.com/" target="_blank">BlueDavy之技术blog</a> 2013</p>
<p><a href="http://icondock.com/" target="_blank">Icons</a> &amp; <a href="http://www.ndesign-studio.com/wp-themes" target="_blank">Wordpress Theme</a> by <a href="http://www.ndesign-studio.com/" target="_blank">N.Design</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/JVM/">JVM</a></li></span></span> | <span class="tags">Tagged <a href="/tags/JVM/" class="label label-primary">JVM</a><a href="/tags/Java&J2EE/" class="label label-success">Java&J2EE</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:42"datetime="2014-03-07 09:54:42"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-JVM--GC悲观策略之ParallelGC篇/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-JVM--GC悲观策略之ParallelGC篇" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-JVM--BTrace使用简介/">BTrace使用简介</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-JVM--BTrace使用简介/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="btrace-">BTrace使用简介</h1>
<h1 id="-bluedavy-blog-https-blog-bluedavy-com-"><a href="https://blog.bluedavy.com/" target="_blank">BlueDavy之技术blog</a></h1>
<p>{互联网，OSGi，Java, High Scalability, High Performance,HA}</p>
<ul>
<li><a href="https://blog.bluedavy.com/" target="_blank">Home</a></li>
<li><a href="https://blog.bluedavy.com/?page_id=2" target="_blank">About</a></li>
<li><a href="https://blog.bluedavy.com/?page_id=81" target="_blank">Photos</a></li>
</ul>
<h2 id="-btrace-https-blog-bluedavy-com-p-185-btrace-"><a href="https://blog.bluedavy.com/?p=185" title="BTrace使用简介" target="_blank">BTrace使用简介</a></h2>
<p>Nov 11</p>
<p><a href="http://bluedavy.com/" title="Visit bluedavy’s website" target="_blank">bluedavy</a><a href="https://blog.bluedavy.com/?cat=13" title="View all posts in jvm" target="_blank">jvm</a> <a href="https://blog.bluedavy.com/?tag=btrace" target="_blank">btrace</a> <a href="&quot;Comment on BTrace使用简介&quot;">13 Comments</a>
很多时候在online的应用出现问题时，很多时候我们需要知道更多的程序的运行细节，但又不可能在开发的时候就把程序中所有的运行细节都打印到日志上，通常这个时候能采取的就是修改代码，重新部署，然后再观察，但这种方法对于online应用来说不是很好，另外一方面如果碰到不好改的代码，例如引用的其他的外部的包什么的，就很麻烦了，BTrace就是一个可以在不改代码、不重启应用的情况下，动态的查看程序运行细节的工具，其官方网站在此：<a href="http://kenai.com/projects/btrace/" target="_blank"><a href="http://kenai.com/projects/btrace/">http://kenai.com/projects/btrace/</a></a>，在这篇blog中，就来看看如何用BTrace来动态的监测方法的一些运行细节状况。
BTrace通过动态的挂接用java写的代码到运行时上来获取到一些运行细节，例如典型的使用btrace的方法为：
btrace -cp [btrace的jar所在的路径，默认为btrace/build下] [pid] [需要运行的java代码]
例如一段这样的代码：
<a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24
25</p>
<p>26
import</p>
<p>java.util.Random;</p>
<p>public</p>
<p>class</p>
<p>Case1{</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>main(String[] args)</p>
<p>throws</p>
<p>Exception{</p>
<p>Random random=</p>
<p>new</p>
<p>Random();</p>
<p>CaseObject object=</p>
<p>new</p>
<p>CaseObject();</p>
<p>boolean</p>
<p>result=</p>
<p>true</p>
<p>;</p>
<p>while</p>
<p>(result){</p>
<p>result=object.execute(random.nextInt(</p>
<p>1000</p>
<p>));</p>
<p>Thread.sleep(</p>
<p>1000</p>
<p>);</p>
<p>}</p>
<p>}</p>
<p>}
public</p>
<p>class</p>
<p>CaseObject{</p>
<p>private</p>
<p>static</p>
<p>int</p>
<p>sleepTotalTime=</p>
<p>0</p>
<p>;  </p>
<p>public</p>
<p>boolean</p>
<p>execute(</p>
<p>int</p>
<p>sleepTime)</p>
<p>throws</p>
<p>Exception{</p>
<p>System.out.println(</p>
<p>&quot;sleep: &quot;</p>
<p>+sleepTime);</p>
<p>sleepTotalTime+=sleepTime;</p>
<p>Thread.sleep(sleepTime);</p>
<p>return</p>
<p>true</p>
<p>;</p>
<p>}</p>
<p>}</p>
<p>如在程序运行的情况下，想知道调用CaseObject的execute方法的以下几种情况，在BTrace中可以这么做：
1、调用此方法时传入的是什么参数，返回的是什么值，当时sleepTotalTime是多少？
BTrace脚本如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16</p>
<p>import</p>
<p>static</p>
<p>com.sun.btrace.BTraceUtils./*;</p>
<p>import</p>
<p>com.sun.btrace.annotations./*;</p>
<p>@BTrace</p>
<p>public</p>
<p>class</p>
<p>TraceMethodArgsAndReturn{</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>method=</p>
<p>&quot;execute&quot;</p>
<p>,</p>
<p>location=</p>
<p>@Location</p>
<p>(Kind.RETURN)</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecute(</p>
<p>@Self</p>
<p>CaseObject instance,</p>
<p>int</p>
<p>sleepTime,</p>
<p>@Return</p>
<p>boolean</p>
<p>result){</p>
<p>println(</p>
<p>&quot;call CaseObject.execute&quot;</p>
<p>);</p>
<p>println(strcat(</p>
<p>&quot;sleepTime is:&quot;</p>
<p>,str(sleepTime)));</p>
<p>println(strcat(</p>
<p>&quot;sleepTotalTime is:&quot;</p>
<p>,str(get(field(</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>&quot;sleepTotalTime&quot;</p>
<p>),instance))));</p>
<p>println(strcat(</p>
<p>&quot;return value is:&quot;</p>
<p>,str(result)));</p>
<p>}</p>
<p>}</p>
<p>然后直接执行btrace -cp btrace/build [pid] TraceMethodArgsAndReturn.java就可以了。
当程序中调用到caseobject的execute方法时，就会在btrace的console中输出相应的信息。
2、execute方法执行耗时是多久？
BTrace脚本如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24</p>
<p>import</p>
<p>static</p>
<p>com.sun.btrace.BTraceUtils./*;</p>
<p>import</p>
<p>com.sun.btrace.annotations./*;</p>
<p>@BTrace</p>
<p>public</p>
<p>class</p>
<p>TraceMethodExecuteTime{</p>
<p>@TLS</p>
<p>static</p>
<p>long</p>
<p>beginTime;</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>method=</p>
<p>&quot;execute&quot;</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecuteBegin(){</p>
<p>beginTime=timeMillis();</p>
<p>}</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>method=</p>
<p>&quot;execute&quot;</p>
<p>,</p>
<p>location=</p>
<p>@Location</p>
<p>(Kind.RETURN)</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecute(</p>
<p>int</p>
<p>sleepTime,</p>
<p>@Return</p>
<p>boolean</p>
<p>result){</p>
<p>println(strcat(strcat(</p>
<p>&quot;CaseObject.execute time is:&quot;</p>
<p>,str(timeMillis()-beginTime)),</p>
<p>&quot;ms&quot;</p>
<p>));</p>
<p>}</p>
<p>}</p>
<p>3、谁调用了execute方法？
BTrace脚本如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13     </p>
<p>import</p>
<p>static</p>
<p>com.sun.btrace.BTraceUtils./*;</p>
<p>import</p>
<p>com.sun.btrace.annotations./*;</p>
<p>@BTrace</p>
<p>public</p>
<p>class</p>
<p>TraceMethodCallee{</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>method=</p>
<p>&quot;execute&quot;</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecute(){</p>
<p>println(</p>
<p>&quot;who call CaseObject.execute :&quot;</p>
<p>);</p>
<p>jstack();</p>
<p>}
}</p>
<p>4、有没有人调用CaseObject中的哪一行代码？
BTrace脚本如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12</p>
<p>import</p>
<p>static</p>
<p>com.sun.btrace.BTraceUtils./*;</p>
<p>import</p>
<p>com.sun.btrace.annotations./*;</p>
<p>@BTrace</p>
<p>public</p>
<p>class</p>
<p>TraceMethodLine{</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>location=</p>
<p>@Location</p>
<p>(value=Kind.LINE,line=</p>
<p>5</p>
<p>)</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecute(</p>
<p>@ProbeClassName</p>
<p>String pcn,</p>
<p>@ProbeMethodName</p>
<p>String pmn,</p>
<p>int</p>
<p>line){</p>
<p>println(strcat(strcat(strcat(</p>
<p>&quot;call &quot;</p>
<p>,pcn),</p>
<p>&quot;.&quot;</p>
<p>),pmn));</p>
<p>}</p>
<p>}</p>
<p>从上面可看出，在有了BTrace后，要动态的跟踪代码的运行细节还是非常爽的，更多的细节的操作请大家查看BTrace的<a href="http://kenai.com/projects/btrace/pages/UserGuide" target="_blank">User Guide</a>。</p>
<p><a href="https://blog.bluedavy.com/?p=170" target="_blank">GC悲观策略之Serial GC篇</a> <a href="https://blog.bluedavy.com/?p=187" target="_blank">学习JVM的References</a></p>
<h3 id="13-comments-add-yours-">13 Comments <em>(<a href="">+add yours?</a>)</em></h3>
<ol>
<li><img src="" alt=""> <a href="http://www.helishi.net/" target="_blank">ikbear</a>
<strong>Nov 11, 2010</strong> @ 17:41:12
收藏了。</li>
<li><img src="https://secure.gravatar.com/avatar/4a2de3195dfd282b2f0ea420dc7a6a7a?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> pandonix
<strong>Nov 11, 2010</strong> @ 20:58:54
关于方法的执行时间和返回值，有个问题请教，如果调用量非常大的方法，有没有类似染色日志这样的功能：只需要打印参数符合某种条件的调用情况？</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Nov 12, 2010</strong> @ 11:42:06
<img src="" alt=":)"> ，这个自己可以在脚本里判断下…</li>
<li><img src="https://secure.gravatar.com/avatar/bd17360b1eb0b26b89a19de9cebed4f9?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> vitty
<strong>Nov 14, 2010</strong> @ 14:09:22
不知道这个对被监测程序的性能影响有多大？不过真的很爽呢。</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Nov 14, 2010</strong> @ 19:53:38
据使用来看，影响很小。</li>
<li><img src="https://secure.gravatar.com/avatar/baad2156c4a21abc487fb92bbd53a174?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> bobo
<strong>Nov 16, 2010</strong> @ 10:16:58
学习,哈哈</li>
<li><img src="https://secure.gravatar.com/avatar/5ef11dda80e7ce522810093bd8a791eb?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> xuanyuanzhiyuan
<strong>Dec 21, 2010</strong> @ 15:37:22
学习了 ：）</li>
<li><img src="https://secure.gravatar.com/avatar/4a2de3195dfd282b2f0ea420dc7a6a7a?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> pandonix
<strong>Dec 27, 2010</strong> @ 23:07:55
运行第一个例子：TraceMethodArgsAndReturn.java报错：
TraceMethodArgsAndReturn.java:10: 找不到符号
符号： 类 CaseObject
位置： 类 TraceMethodArgsAndReturn
把@Self CaseObject instance修改成为@Self Object self，并且去掉println(strcat(“sleepTotalTime is:”,str(get(field(“CaseObject”,”sleepTotalTime”),instance))));
就可以了，但是楼主希望获取sleepTotalTime的需求就满足不鸟了。还不太明白@Self的含义，再看看纠结的文档吧</li>
<li><img src="https://secure.gravatar.com/avatar/4a2de3195dfd282b2f0ea420dc7a6a7a?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> pandonix
<strong>Dec 27, 2010</strong> @ 23:44:37
找到原因了，是CaseObject不在classthpath中，如果用到了@Self CaseObject ，编译TraceMethodArgsAndReturn.java时会去找CaseObject类。
简单的将CaseObject.java放到跟TraceMethodArgsAndReturn.java同一目录即可</li>
<li><img src="https://secure.gravatar.com/avatar/6a8f8285a42a76f5e47159c9f09a7c4f?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> 光夏
<strong>Jan 23, 2011</strong> @ 11:34:36
使用TLS得注意递归调用的情况吧</li>
<li><img src="" alt=""> victorcai
<strong>Jul 19, 2011</strong> @ 15:03:18
请问各位大侠btrace能否在windows xp上使用,是否需要设置环境变量,我在windows xp上每次使用都失败<h3 id="leave-a-reply">Leave a Reply</h3>
</li>
</ol>
<p><a href="">Cancel</a></p>
<p>Name (required)</p>
<p>Mail (required)</p>
<p>Website</p>
<p><img src="https://blog.bluedavy.com/wp-content/plugins/si-captcha-for-wordpress/captcha/securimage_show.php?si_form_id=com&amp;prefix=2KNUhEvWsRaEKSqu" alt="CAPTCHA Image" title="CAPTCHA Image"></p>
<p><a href="&quot;Refresh Image&quot;"><img src="" alt="Refresh Image"></a></p>
<p>CAPTCHA Code /*</p>
<p><style type='text/css'>/#submit {display:none;}</style><br /> <input name="submit" type="submit" id="submit-alt" tabindex="6" value="Submit Comment" /></p>
<p>July 2013 M T W T F S S <a href="https://blog.bluedavy.com/?m=201303" title="View posts for March 2013" target="_blank">« Mar</a>     1234567 891011121314 15161718192021 22232425262728 293031  </p>
<h3 id="categories">Categories</h3>
<ul>
<li><a href="https://blog.bluedavy.com/?cat=63" title="View all posts filed under Java" target="_blank">Java</a> (10)</li>
<li><a href="https://blog.bluedavy.com/?cat=13" title="View all posts filed under jvm" target="_blank">jvm</a> (19)</li>
<li><a href="https://blog.bluedavy.com/?cat=56" title="View all posts filed under NoSQL" target="_blank">NoSQL</a> (7)</li>
<li><a href="https://blog.bluedavy.com/?cat=4" title="View all posts filed under SOA" target="_blank">SOA</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=11" title="关于《分布式Java应用：基础与实践》书部分章节的公开、书内容的纠错以及补充完善。" target="_blank">书:分布式Java应用</a> (5)</li>
<li><a href="https://blog.bluedavy.com/?cat=6" title="View all posts filed under 互联网" target="_blank">互联网</a> (5)</li>
<li><a href="https://blog.bluedavy.com/?cat=46" title="View all posts filed under 产品总结" target="_blank">产品总结</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=18" title="View all posts filed under 优化案例" target="_blank">优化案例</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=12" title="View all posts filed under 圆桌交流" target="_blank">圆桌交流</a> (2)</li>
<li><a href="https://blog.bluedavy.com/?cat=8" title="View all posts filed under 容量规划" target="_blank">容量规划</a> (2)</li>
<li><a href="https://blog.bluedavy.com/?cat=97" title="View all posts filed under 迁户口" target="_blank">迁户口</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=52" title="View all posts filed under 高可用" target="_blank">高可用</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=3" title="View all posts filed under 高并发" target="_blank">高并发</a> (3)</li>
<li><p><a href="https://blog.bluedavy.com/?cat=1" title="关于性能优化方面的一些东西。" target="_blank">高性能</a> (2)</p>
<h3 id="recent-comments">Recent Comments</h3>
</li>
<li><p><a href="http://code1.riaos.com/?p=5030138" target="_blank">JVM调优 | code1（code1.riaos.com）</a> on <a href="https://blog.bluedavy.com/?p=70&amp;cpage=1#comment-16520" target="_blank">说说MaxTenuringThreshold这个参数</a></p>
</li>
<li><a href="http://architecture1.riaos.com/?p=3063358" target="_blank">JVM调优 | architecture（riaos.com）</a> on <a href="https://blog.bluedavy.com/?p=70&amp;cpage=1#comment-16519" target="_blank">说说MaxTenuringThreshold这个参数</a></li>
<li><a href="http://bluedavy.com/" target="_blank">bluedavy</a> on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16462" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
<li>xiaobo on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16460" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
<li><a href="http://bluedavy.com/" target="_blank">bluedavy</a> on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16459" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
</ul>
<h3 id="tags">Tags</h3>
<p><a href="https://blog.bluedavy.com/?tag=btrace" title="2 topics" target="_blank">btrace</a> <a href="https://blog.bluedavy.com/?tag=c1" title="1 topic" target="_blank">c1</a> <a href="https://blog.bluedavy.com/?tag=c2" title="1 topic" target="_blank">c2</a> <a href="https://blog.bluedavy.com/?tag=deflater" title="1 topic" target="_blank">Deflater</a> <a href="https://blog.bluedavy.com/?tag=facebook" title="2 topics" target="_blank">facebook</a> <a href="https://blog.bluedavy.com/?tag=gc" title="4 topics" target="_blank">gc</a> <a href="https://blog.bluedavy.com/?tag=gc-tuning" title="2 topics" target="_blank">gc tuning</a> <a href="https://blog.bluedavy.com/?tag=grizzly" title="2 topics" target="_blank">Grizzly</a> <a href="https://blog.bluedavy.com/?tag=hbase" title="6 topics" target="_blank">HBase</a> <a href="https://blog.bluedavy.com/?tag=hotspot" title="1 topic" target="_blank">hotspot</a> <a href="https://blog.bluedavy.com/?tag=inflater" title="1 topic" target="_blank">Inflater</a> <a href="https://blog.bluedavy.com/?tag=interpreter" title="1 topic" target="_blank">interpreter</a> <a href="https://blog.bluedavy.com/?tag=javac" title="1 topic" target="_blank">javac</a> <a href="https://blog.bluedavy.com/?tag=java-code-generation" title="1 topic" target="_blank">java code generation</a> <a href="https://blog.bluedavy.com/?tag=javaone" title="4 topics" target="_blank">JavaOne</a> <a href="https://blog.bluedavy.com/?tag=javaone-general-technical-session" title="1 topic" target="_blank">javaone general technical session</a> <a href="https://blog.bluedavy.com/?tag=java%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c" title="1 topic" target="_blank">java代码执行</a> <a href="https://blog.bluedavy.com/?tag=java-%e5%b9%b6%e5%8f%91" title="1 topic" target="_blank">Java 并发</a> <a href="https://blog.bluedavy.com/?tag=jit" title="1 topic" target="_blank">jit</a> <a href="https://blog.bluedavy.com/?tag=jvm" title="12 topics" target="_blank">jvm</a> <a href="https://blog.bluedavy.com/?tag=memory-management" title="1 topic" target="_blank">memory management</a> <a href="https://blog.bluedavy.com/?tag=native-memory-leak" title="1 topic" target="_blank">Native Memory Leak</a> <a href="https://blog.bluedavy.com/?tag=nosql" title="2 topics" target="_blank">NoSQL</a> <a href="https://blog.bluedavy.com/?tag=oom" title="1 topic" target="_blank">oom</a> <a href="https://blog.bluedavy.com/?tag=oracle-keynote" title="1 topic" target="_blank">oracle keynote</a> <a href="https://blog.bluedavy.com/?tag=pessimism-policy" title="1 topic" target="_blank">pessimism policy</a> <a href="https://blog.bluedavy.com/?tag=references" title="1 topic" target="_blank">references</a> <a href="https://blog.bluedavy.com/?tag=rpc" title="2 topics" target="_blank">RPC</a> <a href="https://blog.bluedavy.com/?tag=serial-gc" title="1 topic" target="_blank">serial gc</a> <a href="https://blog.bluedavy.com/?tag=soa" title="2 topics" target="_blank">SOA</a> <a href="https://blog.bluedavy.com/?tag=sun-jdk" title="1 topic" target="_blank">sun jdk</a> <a href="https://blog.bluedavy.com/?tag=sun-jdk-oom" title="1 topic" target="_blank">sun jdk oom</a> <a href="https://blog.bluedavy.com/?tag=web%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92%e7%9a%84%e8%89%ba%e6%9c%af" title="1 topic" target="_blank">Web容量规划的艺术</a> <a href="https://blog.bluedavy.com/?tag=yuanzhuo" title="1 topic" target="_blank">yuanzhuo</a> <a href="https://blog.bluedavy.com/?tag=%e4%b9%a6" title="1 topic" target="_blank">书:分布式Java应用</a> <a href="https://blog.bluedavy.com/?tag=%e4%b9%a6%e8%af%84" title="1 topic" target="_blank">书评</a> <a href="https://blog.bluedavy.com/?tag=%e4%ba%92%e8%81%94%e7%bd%91%e6%8a%80%e6%9c%af" title="1 topic" target="_blank">互联网技术</a> <a href="https://blog.bluedavy.com/?tag=%e4%ba%a4%e6%b5%81" title="1 topic" target="_blank">交流</a> <a href="https://blog.bluedavy.com/?tag=%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86" title="1 topic" target="_blank">内存管理</a> <a href="https://blog.bluedavy.com/?tag=%e5%88%86%e5%b8%83%e5%bc%8fjava%e5%ba%94%e7%94%a8" title="2 topics" target="_blank">分布式Java应用</a> <a href="https://blog.bluedavy.com/?tag=%e5%9c%86%e6%a1%8c%e4%ba%a4%e6%b5%81" title="1 topic" target="_blank">圆桌交流</a> <a href="https://blog.bluedavy.com/?tag=%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92" title="2 topics" target="_blank">容量规划</a> <a href="https://blog.bluedavy.com/?tag=%e6%82%b2%e8%a7%82%e7%ad%96%e7%95%a5" title="3 topics" target="_blank">悲观策略</a> <a href="https://blog.bluedavy.com/?tag=%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6" title="1 topic" target="_blank">服务框架</a> <a href="https://blog.bluedavy.com/?tag=%e7%a1%85%e8%b0%b7%e5%85%ac%e5%8f%b8" title="1 topic" target="_blank">硅谷公司</a></p>
<h3 id="-">订阅</h3>
<h3 id="-">推荐书籍</h3>
<h3 id="my-book">My Book</h3>
<p><a href="http://book.douban.com/subject/4848587/" title="分布式Java应用：基础与实践" target="_blank"><img src="" alt=""></a> <a href="http://book.douban.com/subject/3843896/" title="OSGi原理与最佳实践" target="_blank"><img src="" alt=""></a>
© <a href="https://blog.bluedavy.com/" target="_blank">BlueDavy之技术blog</a> 2013</p>
<p><a href="http://icondock.com/" target="_blank">Icons</a> &amp; <a href="http://www.ndesign-studio.com/wp-themes" target="_blank">Wordpress Theme</a> by <a href="http://www.ndesign-studio.com/" target="_blank">N.Design</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/JVM/">JVM</a></li></span></span> | <span class="tags">Tagged <a href="/tags/JVM/" class="label label-primary">JVM</a><a href="/tags/Java&J2EE/" class="label label-success">Java&J2EE</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-JVM--BTrace使用简介/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-JVM--BTrace使用简介" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/59/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/57/">57</a></li><li><a class="page-number" href="/page/58/">58</a></li><li><a class="page-number" href="/page/59/">59</a></li><li class="active"><li><span class="page-number current">60</span></li><li><a class="page-number" href="/page/61/">61</a></li><li><a class="page-number" href="/page/62/">62</a></li><li><a class="page-number" href="/page/63/">63</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/61/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-26 21:21:33</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
