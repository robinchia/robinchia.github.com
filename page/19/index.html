
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 19 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-TCPIP--TCPIP网络层谜云之ICMP--ITeye技术网站/">TCP IP网络层谜云之ICMP </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-TCPIP--TCPIP网络层谜云之ICMP--ITeye技术网站/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="tcp-ip-icmp-iteye-">TCP IP网络层谜云之ICMP - - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">新闻</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://java-mzd.iteye.com/blog/1019089#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/wiki" target="_blank">专栏</a>  <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://java-mzd.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/all" target="_blank">我的应用</a> <a href="http://java-mzd.iteye.com/login" target="_blank">登录</a> <a href="http://java-mzd.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-java-mzd-http-java-mzd-iteye-com-"><a href="http://java-mzd.iteye.com/" target="_blank">java-mzd</a></h1>
<p>永久域名 <a href="http://java-mzd.iteye.com/" target="_blank"><a href="http://java-mzd.iteye.com">http://java-mzd.iteye.com</a></a></p>
<p><a href="http://java-mzd.iteye.com/blog/1019089#" target="_blank">2顶</a>
<a href="http://java-mzd.iteye.com/blog/1019089#" target="_blank">4踩</a></p>
<p><a href="http://java-mzd.iteye.com/blog/1050043" title="腾讯、淘宝、金山网络，实习生我该何去何从" target="_blank">腾讯、淘宝、金山网络，实习生我该何去何从</a> | <a href="http://java-mzd.iteye.com/blog/1019088" title="TCP/IP网络层谜云" target="_blank">TCP/IP网络层谜云</a></p>
<p>2011-04-27</p>
<h3 id="-tcp-ip-icmp-"><a href="">TCP/IP网络层谜云之ICMP</a></h3>
<p><strong>文章分类:<a href="http://www.iteye.com/blogs/category/java" target="_blank">Java编程</a></strong>
本文上接《<a href="http://java-mzd.iteye.com/blog/1019088" target="_blank">TCP/IP网络层谜云</a>》 <a href="http://java-mzd.iteye.com/blog/1019088" target="_blank"><a href="http://java-mzd.iteye.com/blog/1019088">http://java-mzd.iteye.com/blog/1019088</a></a></p>
<p><strong>十四。为什么需要ICMP？</strong></p>
<p><strong>因为IP协议不提供可靠性且不能保证信息传递，因此发生问题时，通知发送人是很重要的。</strong>（IP协议是一种不可靠的协议，无法进行差错控制。但IP协议可以借助其他协议来实现这一功能，如ICMP）</p>
<p><strong>十五。什么是ICMP？</strong> </p>
<p>ICMP： Internet Control Message Protocol 即Internet消息控制协议。</p>
<p>ICMP定义了一套<strong>差错报文</strong>和<strong>控制报文</strong>，用于用户主机与路由之间交换不可到达地址、网络拥塞、重定向到更好的路径、报文生命周期超时等信息。</p>
<p><strong>ICMP协议是一种提供</strong>（有关阻止数据包传递的）<strong>网络故障问题反馈信息的机制</strong>。（针对阻止数据包传递或者网络故障。）它让TCP等上层协议能够意识到数据包没有送达目的地。
<strong>关于ICMP与TCP的差错控制对比？</strong></p>
<p>比如主机A到主机B的通信，中间Router  r1 到Router  r2 的网络连接断了。</p>
<p>通过ICMP，则<strong>可以快速诊断出出错原因</strong>，并且报告主机。（差错诊断）</p>
<p>TCP的差错控制，主要是体现在，网络断了，收不到确认回复，TCP会一直再次发送数据包，直到收到确认回复。（差错处理）</p>
<p>ICMP提供一组易懂的出错报告信息。发送的出错报文返回到发送原数据的设备，因为<strong>只有发送设备才是出错报文的逻辑接受者</strong>。<strong>发送设备随后可根据ICMP报文确定发生错误的类型，确定如何才能更好地重发失败的数据报</strong>。但是<strong>ICMP唯一的功能是报告问题而不是纠正错误，纠正错误的任务由发送方完成。</strong></p>
<p><strong>十六。ICMP协议有哪些数据包？</strong></p>
<p><strong>**</strong>一个ICMP数据包实际上就是一个（数据部分为ICMP协议数据的）<strong>**IP数据包。</strong> </p>
<p>IP头</p>
<p>ICMP头
Type</p>
<p>Code</p>
<p>Checksum 
ICMP数据</p>
<p>如前所述，ICMP主要分为<strong>差错报文</strong>和<strong>控制报文</strong>。</p>
<p><strong>差错报文包括</strong>：目标不可到达（网络、协议、主机、端口不可到达；禁止分割、目标网络不认识、目标主机不认识等等）、超时、参数问题、重定向（网络重定向、主机重定向等）等等</p>
<p><strong>控制报文包括</strong>：请求回显（ping请求）、回显应答（ping应答）、地址掩码请求、地址掩码应答等等</p>
<p>如上，我们可以发现，同一类型的错误（不可到达）可能有不同种类（网络不可到达、主机不可到达），因此，<strong>我们使用type来code两个标志来确定一个具体的错误。</strong></p>
<p><strong>因为需要指出具体是哪个主机上的哪个程序发出的信息没有到达。</strong></p>
<p><strong>因此，每一个ICMP的错误消息，应该包含：</strong></p>
<p>1.具体的错误类型（Type/code 决定）</p>
<p>2.引发ICMP错误消息的数据包的完全IP包头（哪个主机的数据）</p>
<p>3.数据报的前8个字节----UDP报头或者TCP中的port部分(主机上的哪个程序)</p>
<p>因此，<strong>ICMP错误消息的格式应该为如下</strong>：
Type(8)</p>
<p>Code(8)</p>
<p>Checksum(16) Unused(32) Internet Header +64 Bits of Original Data Datagram</p>
<p>控制报文因为控制的消息各不相同，所以有所差异。下面分析下请求回显（ping）和回显应答，其他的消息，大家可以触类旁通。</p>
<hr>
<p>Type</p>
<p>Code</p>
<p>Checksum Identifier</p>
<p>Sequence Number Data</p>
<p><strong>当主机**</strong>A<strong><strong>需要知道和主机</strong></strong>B<strong><strong>通信的状况</strong></strong>(<strong><strong>信息传递延时、丢包率</strong></strong>)<strong><strong>时，我们该怎么办呢？**</strong></strong>
我们可以参考声纳和雷达的原理：主机A发送一个ICMP回显请求（type=8,code=0）报文,数据域中存放当前时间T1，目的IP为主机B。主机B收到该ICMP回显请求报文后，将目的IP和源IP调换位置，其他信息都不变（Indentifier，Sequence Number）,回复一个ICMP回显应答（type=0,code=0）。主机A收到改ICMP回显应答的时间为T2。则，到主机B的通信时间为：T2-T1。</p>
<p>又因为，要考虑丢包，所以我们向主机B发送多个回显请求，用Sequence Number来区分各个请求，根据Sequence Number，即可知道应答对应的请求数据包。</p>
<p>Ping命令就是这样的一个实现，其实我们在命令行下输入ping ip命令时，就是调用Ping程序。Ping程序根据输入的IP（域名）封装ICMP请求应答，发送出去，并且接受ICMP回显应答，进行解析，输出。</p>
<p><strong>关于超时</strong>：IP报头中的生存期（TTL）属性，用来控制报文段在网络中的生存期。</p>
<p>试想一下，当网络中的某些路由出现问题，Router A将IP a 的下一跳路由为Router B。同时在Router B中，又将IP a 的下一跳路由为 Router A。那么显然，两个路由器之将会间形成回路，通往网段a的数据包，将会一直在两个路由之间发送，导致网络流量爆炸，同时，数据包也无法正确的到达网络a。</p>
<p>因此，当IP数据包每经过一个路由器时，路由器将IP数据包中的TTL值减一。当TTL值为0时，路由器判断数据包超时，发送ICMP超时信息给源主机。</p>
<p><strong>当我们想知道：从主机**</strong>A<strong><strong>发送到主机</strong></strong>B<strong><strong>的数据包在网络中都经过了哪些路由器的时候，我们有什么办法呢？**</strong></strong>
我们知道，当IP数据包在路由中出错时，路由器会向发送源发送一个ICMP错误报文，发送端从该ICMP错误报文中，可以得到该路由的IP。</p>
<p>我们可以利用此原理。要得到从主机A到目标主机B之间的所有路由的IP，那么我们必须让IP数据包在每个路由器中都出错一次。</p>
<p>又因此，TTL值在经过的每个路由器中都会减1。因此，我们可以利用TTL的超时信息，在每个路由中都发生一次。即可得到从从主机A到主机B之间的所有路由的IP。</p>
<p>PS.怎么判断数据包正确到达了目标主机B？</p>
<p>当IP数据包到达了目标主机，将不会再发送TTL超时错误。而且在目标主机B中，没有运行相对应的应用层程序，因此，将没有程序会回应我们发送的IP数据包。那么，我们将如何知道IP数据包已经到达了目标主机呢？</p>
<p>我们可以为数据包分配一个目标主机几乎不可能监听的端口，从而，当IP数据包到达目标主机后，目标主机会回复相应的”不可到达、端口不可到达”的ICMP错误信息，从而，我们可以确认IP数据包已经到达了目标主机。</p>
<p>综上，我们可以：源主机A发送IP数据包，IP为目标主机B，port几乎不可能监听的port，TTL从一开始一直往上增加，直道收到来自主机B的ICMP 不可到达（端口不可到达）信息。</p>
<p>Tracerouter 命令就是实现这样功能的一个程序。我们可以通过tracerouter ip来调用此功能。</p>
<p>PS.因为每次路由时的路由路径可能不一样，那么在tracerouter过程中，我们又如何解决这个问题？</p>
<p>而且，如果目标主机正好监听了这一我们认为不可能监听的端口呢？</p>
<p>针对这些问题，欢迎各位读者回答。</p>
<p>PS。这是第四次更改了。。希望JE别抽风了。。让他们正常显示吧。。</p>
<p>这年头，每个用心写总结的人。。你们都伤不起啊。。。</p>
<p>好不容易写了一周啊。。</p>
<p>从2000写到8000啊。。又从8000改到4000啊。。又从4000改到6600啊</p>
<p>写了改</p>
<p>改了啊。。</p>
<p>伤不起啊。。</p>
<p>好不容易写好了。。</p>
<p>JE还不给力。。显示不正常啊。。</p>
<p>又重新写了后面两个大问题好几遍啊。。好几遍啊</p>
<p>伤不起啊。。。</p>
<p><a href="http://java-mzd.iteye.com/blog/1019089#"><strong>2</strong>
顶</a><a href="http://java-mzd.iteye.com/blog/1019089#"><strong>4</strong>
踩</a>
<a href="http://java-mzd.iteye.com/blog/1050043" title="腾讯、淘宝、金山网络，实习生我该何去何从" target="_blank">腾讯、淘宝、金山网络，实习生我该何去何从</a> | <a href="http://java-mzd.iteye.com/blog/1019088" title="TCP/IP网络层谜云" target="_blank">TCP/IP网络层谜云</a></p>
<ul>
<li>00:39</li>
<li>浏览 (277)</li>
<li><a href="http://java-mzd.iteye.com/blog/1019089#comments" target="_blank">评论</a> (2)</li>
<li>分类: <a href="http://java-mzd.iteye.com/category/153171" target="_blank">TCP/IP</a></li>
<li><a href="http://www.iteye.com/wiki/topic/1019089" target="_blank">相关推荐</a><h3 id="-">评论</h3>
</li>
</ul>
<p><a href=""></a></p>
<p>2 楼 <a href="http://leelege.iteye.com/" target="_blank">leelege</a> 2011-05-04   <a href="http://java-mzd.iteye.com/blog/1019089#" target="_blank">引用</a></p>
<p>感谢楼主分享 期待更多内容～～
1 楼 <a href="http://cosina.iteye.com/" target="_blank">cosina</a> 2011-04-28   <a href="http://java-mzd.iteye.com/blog/1019089#" target="_blank">引用</a></p>
<p><img src="" alt="">   学倒不少！ 继续写哈哈</p>
<h3 id="-">发表评论</h3>
<h3 id="-">表情图标</h3>
<p><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""><img src="" alt=""></p>
<p>字体颜色: 标准深红红色橙色棕色黄色绿色橄榄青色蓝色深蓝靛蓝紫色灰色白色黑色 字体大小: 标准1 (xx-small)2 (x-small)3 (small)4 (medium)5 (large)6 (x-large)7 (xx-large) 对齐: 标准居左居中居右</p>
<p>提示：选择您需要装饰的文字, 按上列按钮即可添加上相应的标签</p>
<p>您还没有登录，请<a href="http://java-mzd.iteye.com/login" target="_blank">登录</a>后发表评论(快捷键 Alt+S / Ctrl+Enter)</p>
<p><a href="http://java-mzd.iteye.com/" target="_blank"><img src="&quot;java_mzd的博客: &quot;" alt="java_mzd的博客"></a></p>
<p>java_mzd</p>
<ul>
<li>浏览: 70753 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 长沙</li>
<li><img src="" alt=""></li>
<li><a href="http://java-mzd.iteye.com/blog/profile" target="_blank">详细资料</a> <a href="http://java-mzd.iteye.com/blog/guest_book" target="_blank">留言簿</a></li>
</ul>
<h3 id="-">搜索本博客</h3>
<h3 id="-http-java-mzd-iteye-com-blog-user_visits-">最近访客 <a href="http://java-mzd.iteye.com/blog/user_visits" target="_blank">&gt;&gt;更多访客</a></h3>
<p><a href="http://aria.iteye.com/" target="_blank"><img src="&quot;aria的博客: &quot;" alt="aria的博客"></a></p>
<p><a href="http://aria.iteye.com/" target="_blank">aria</a></p>
<p><a href="http://zhxing.iteye.com/" target="_blank"><img src="&quot;zhxing的博客: ヾ孤星随缘ツ  http://t.sina.com.cn/samzhxing&quot;" alt="zhxing的博客"></a></p>
<p><a href="http://zhxing.iteye.com/" target="_blank">zhxing</a>
<a href="http://java-suddy.iteye.com/" target="_blank"><img src="&quot;java_suddy的博客: “平凡”的思想&quot;" alt="java_suddy的博客"></a></p>
<p><a href="http://java-suddy.iteye.com/" target="_blank">java_suddy</a></p>
<p><a href="http://liuxinglanyue.iteye.com/" target="_blank"><img src="&quot;liuxinglanyue的博客: liuxinglanyue&quot;" alt="liuxinglanyue的博客"></a></p>
<p><a href="http://liuxinglanyue.iteye.com/" target="_blank">liuxinglanyue</a></p>
<h3 id="-">博客分类</h3>
<ul>
<li><a href="http://java-mzd.iteye.com/" target="_blank">全部博客 (43)</a></li>
<li><a href="http://java-mzd.iteye.com/category/133623" target="_blank">数据结构----------JAVA类集 (5)</a></li>
<li><p><a href="http://java-mzd.iteye.com/category/153171" target="_blank">TCP/IP (7)</a></p>
<h3 id="-http-java-mzd-iteye-com-blog-guest_book-">我的留言簿 <a href="http://java-mzd.iteye.com/blog/guest_book" target="_blank">&gt;&gt;更多留言</a></h3>
</li>
<li><p>楼主 你工作多久了。。。。
-- by <a href="http://java-mzd.iteye.com/blog/guest_book#39913" target="_blank">fanmingxing</a></p>
</li>
<li>写的不错，学习，谢谢！
-- by <a href="http://java-mzd.iteye.com/blog/guest_book#39693" target="_blank">chenge2k</a></li>
<li>看了LZ的文章，发现工作快两年的我，就像是一块浮起来的木头，真的很惭愧！也不怪我拿 ...
-- by <a href="http://java-mzd.iteye.com/blog/guest_book#39618" target="_blank">GoTiger</a></li>
</ul>
<h3 id="-">其他分类</h3>
<ul>
<li><a href="http://java-mzd.iteye.com/blog/favorite" target="_blank">我的收藏</a> (23)</li>
<li><a href="http://java-mzd.iteye.com/blog/code_favorite" target="_blank">我的代码</a> (0)</li>
<li><a href="http://java-mzd.iteye.com/blog/topic" target="_blank">我的论坛主题帖</a> (3)</li>
<li><a href="http://java-mzd.iteye.com/blog/post" target="_blank">我的所有论坛帖</a> (37)</li>
<li><p><a href="http://java-mzd.iteye.com/blog/article" target="_blank">我的精华良好帖</a> (0)</p>
<h3 id="-">最近加入群组</h3>
</li>
<li><p><a href="http://android.group.iteye.com/" target="_blank">Android</a></p>
</li>
</ul>
<h3 id="-">存档</h3>
<ul>
<li><a href="http://java-mzd.iteye.com/blog/monthblog/2011-05" target="_blank">2011-05</a> (2)</li>
<li><a href="http://java-mzd.iteye.com/blog/monthblog/2011-04" target="_blank">2011-04</a> (7)</li>
<li><a href="http://java-mzd.iteye.com/blog/monthblog/2011-03" target="_blank">2011-03</a> (2)</li>
<li><p><a href="http://java-mzd.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://java-mzd.iteye.com/blog/1050043" title="腾讯、淘宝、金山网络，实习生我该何去何从" target="_blank">腾讯、淘宝、金山网络，实习生我该何去何从</a></p>
</li>
<li><a href="http://java-mzd.iteye.com/blog/1050926" title="淘宝、金山网络，百感交集" target="_blank">淘宝、金山网络，百感交集</a></li>
<li><a href="http://java-mzd.iteye.com/blog/1007577" title="TCP/IP传输层，你懂多少？" target="_blank">TCP/IP传输层，你懂多少？</a></li>
<li><a href="http://java-mzd.iteye.com/blog/1004784" title="淘宝武汉*面试归来" target="_blank">淘宝武汉/*面试归来</a></li>
<li><p><a href="http://java-mzd.iteye.com/blog/862787" title="开源软件？自由软件？免费软件？你了解多少？" target="_blank">开源软件？自由软件？免费软件？你了解多少 ...</a></p>
</li>
<li><p><a href="http://java-mzd.iteye.com/rss" target="_blank"><img src="" alt="Rss"></a></p>
</li>
<li><a href="http://fusion.google.com/add?feedurl=http://java-mzd.iteye.com/rss" target="_blank"><img src="" alt="Rss_google"></a>
声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2011 ITeye.com. All rights reserved. [ 京ICP证110151号 ]
<img src="" alt=""></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/TCPIP/">TCPIP</a></li></span></span> | <span class="tags">Tagged <a href="/tags/TCPIP/" class="label label-primary">TCPIP</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-TCPIP--TCPIP网络层谜云之ICMP--ITeye技术网站/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-TCPIP--TCPIP网络层谜云之ICMP--ITeye技术网站" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-xml-xstream--JAVA中Stringformat的用法-xytop-博客园/">JAVA中String.format的用法 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-xml-xstream--JAVA中Stringformat的用法-xytop-博客园/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-string-format-xytop-">JAVA中String.format的用法 - xytop - 博客园</h1>
<p><a href=""></a>    <img src="" alt=""></p>
<p><a href="http://www.cnblogs.com/xytop/" target="_blank">xytop</a>
随笔- 2  文章- 0  评论- 0 </p>
<p><a href="http://www.cnblogs.com/" target="_blank">博客园</a>  <a href="http://www.cnblogs.com/xytop/" target="_blank">首页</a>  <a href="http://www.cnblogs.com/xytop/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a>  <a href="http://space.cnblogs.com/msg/send/xytop" target="_blank">联系</a>  <a href="http://www.cnblogs.com/xytop/admin/EditPosts.aspx" target="_blank">管理</a>  <a href="http://www.cnblogs.com/xytop/rss" target="_blank">订阅</a> <a href="http://www.cnblogs.com/xytop/rss" target="_blank"><img src="" alt="订阅"></a></p>
<h1 id="-java-string-format-"><a href="">JAVA中String.format的用法</a></h1>
<h2 id="java-string-format-">JAVA String.format 方法使用介绍</h2>
<p>1.对整数进行格式化：%[index$][标识][最小宽度]转换方式
        我们可以看到，格式化字符串由4部分组成，其中%[index$]的含义我们上面已经讲过，[最小宽度]的含义也很好理解，就是最终该整数转化的字符串最少包含多少位数字。我们来看看剩下2个部分的含义吧：
<img src="" alt="">标识： 
<img src="" alt="">&#39;-&#39;    在最小宽度内左对齐，不可以与“用0填充”同时使用
<img src="" alt="">&#39;/#&#39;    只适用于8进制和16进制，8进制时在结果前面增加一个0，16进制时在结果前面增加0x
<img src="" alt="">&#39;+&#39;    结果总是包括一个符号（一般情况下只适用于10进制，若对象为BigInteger才可以用于8进制和16进制）
<img src="" alt="">&#39;  &#39;    正值前加空格，负值前加负号（一般情况下只适用于10进制，若对象为BigInteger才可以用于8进制和16进制）
<img src="" alt="">&#39;0&#39;    结果将用零来填充
<img src="" alt="">&#39;,&#39;    只适用于10进制，每3位数字之间用“，”分隔
<img src="" alt="">&#39;(&#39;    若参数是负数，则结果中不添加负号而是用圆括号把数字括起来（同‘+’具有同样的限制）
<img src="" alt="">
<img src="" alt="">转换方式：
<img src="" alt="">d-十进制   o-八进制   x或X-十六进制</p>
<pre><code>    上面的说明过于枯燥，我们来看几个具体的例子。需要特别注意的一点是：大部分标识字符可以同时使用。
</code></pre><p><img src="" alt="">        System.out.println(String.format(&quot;%1$,09d&quot;, -3123));
<img src="" alt="">        System.out.println(String.format(&quot;%1$9d&quot;, -31));
<img src="" alt="">        System.out.println(String.format(&quot;%1$-9d&quot;, -31));
<img src="" alt="">        System.out.println(String.format(&quot;%1$(9d&quot;, -31));
<img src="" alt="">        System.out.println(String.format(&quot;%1$/#9x&quot;, 5689));
<img src="" alt="">
<img src="" alt="">//结果为：
<img src="" alt="">//-0003,123
<img src="" alt="">//      -31
<img src="" alt="">//-31<br><img src="" alt="">//     (31)
<img src="" alt="">//   0x1639</p>
<p>2.对浮点数进行格式化：%[index$][标识][最少宽度][.精度]转换方式
        我们可以看到，浮点数的转换多了一个“精度”选项，可以控制小数点后面的位数。</p>
<p><img src="" alt="">标识： 
<img src="" alt="">&#39;-&#39;    在最小宽度内左对齐，不可以与“用0填充”同时使用
<img src="" alt="">&#39;+&#39;    结果总是包括一个符号
<img src="" alt="">&#39;  &#39;    正值前加空格，负值前加负号
<img src="" alt="">&#39;0&#39;    结果将用零来填充
<img src="" alt="">&#39;,&#39;    每3位数字之间用“，”分隔（只适用于fgG的转换）
<img src="" alt="">&#39;(&#39;    若参数是负数，则结果中不添加负号而是用圆括号把数字括起来（只适用于eEfgG的转换）
<img src="" alt="">
<img src="" alt="">转换方式：
<img src="" alt="">&#39;e&#39;, &#39;E&#39;  --  结果被格式化为用计算机科学记数法表示的十进制数
<img src="" alt="">&#39;f&#39;          --  结果被格式化为十进制普通表示方式
<img src="" alt="">&#39;g&#39;, &#39;G&#39;    --  根据具体情况，自动选择用普通表示方式还是科学计数法方式
<img src="" alt="">&#39;a&#39;, &#39;A&#39;    --   结果被格式化为带有效位数和指数的十六进制浮点数</p>
<p>3.对字符进行格式化：
        对字符进行格式化是非常简单的，c表示字符，标识中&#39;-&#39;表示左对齐，其他就没什么了。
4.对百分比符号进行格式化：
        看了上面的说明，大家会发现百分比符号“%”是特殊格式的一个前缀。那么我们要输入一个百分比符号该怎么办呢？肯定是需要转义字符的,但是要注意的是，在这里转义字符不是“\”，而是“%”。换句话说，下面这条语句可以输出一个“12%”：
System.out.println(String.format(&quot;%1$d%%&quot;, 12));
5.取得平台独立的行分隔符：
        System.getProperty(&quot;line.separator&quot;)可以取得平台独立的行分隔符，但是用在format中间未免显得过于烦琐了。于是format函数自带了一个平台独立的行分隔符那就是String.format(&quot;%n&quot;)。
6.对日期类型进行格式化：
         以下日期和时间转换的后缀字符是为 &#39;t&#39; 和 &#39;T&#39; 转换定义的。这些类型相似于但不完全等同于那些由 GNU date 和 POSIX strftime(3c) 定义的类型。提供其他转换类型是为了访问特定于 Java 的功能（如将 &#39;L&#39; 用作秒中的毫秒）。
以下转换字符用来格式化时间：
&#39;H&#39;     24 小时制的小时，被格式化为必要时带前导零的两位数，即 00 - 23。
&#39;I&#39;     12 小时制的小时，被格式化为必要时带前导零的两位数，即 01 - 12。
&#39;k&#39;     24 小时制的小时，即 0 - 23。
&#39;l&#39;     12 小时制的小时，即 1 - 12。
&#39;M&#39;     小时中的分钟，被格式化为必要时带前导零的两位数，即 00 - 59。
&#39;S&#39;     分钟中的秒，被格式化为必要时带前导零的两位数，即 00 - 60 （&quot;60&quot; 是支持闰秒所需的一个特殊值）。
&#39;L&#39;     秒中的毫秒，被格式化为必要时带前导零的三位数，即 000 - 999。
&#39;N&#39;     秒中的毫微秒，被格式化为必要时带前导零的九位数，即 000000000 - 999999999。
&#39;p&#39;     特定于语言环境的 上午或下午 标记以小写形式表示，例如 &quot;am&quot; 或 &quot;pm&quot;。使用转换前缀 &#39;T&#39; 可以强行将此输出转换为大写形式。
&#39;z&#39;     相对于 GMT 的 RFC 822 格式的数字时区偏移量，例如 -0800。
&#39;Z&#39;     表示时区缩写形式的字符串。Formatter 的语言环境将取代参数的语言环境（如果有）。
&#39;s&#39;     自协调世界时 (UTC) 1970 年 1 月 1 日 00:00:00 至现在所经过的秒数，即 Long.MIN_VALUE/1000 与 Long.MAX_VALUE/1000 之间的差值。
&#39;Q&#39;     自协调世界时 (UTC) 1970 年 1 月 1 日 00:00:00 至现在所经过的毫秒数，即 Long.MIN_VALUE 与 Long.MAX_VALUE 之间的差值。
以下转换字符用来格式化日期：
&#39;B&#39;     特定于语言环境的月份全称，例如 &quot;January&quot; 和 &quot;February&quot;。
&#39;b&#39;     特定于语言环境的月份简称，例如 &quot;Jan&quot; 和 &quot;Feb&quot;。
&#39;h&#39;     与 &#39;b&#39; 相同。
&#39;A&#39;     特定于语言环境的星期几全称，例如 &quot;Sunday&quot; 和 &quot;Monday&quot;
&#39;a&#39;     特定于语言环境的星期几简称，例如 &quot;Sun&quot; 和 &quot;Mon&quot;
&#39;C&#39;     除以 100 的四位数表示的年份，被格式化为必要时带前导零的两位数，即 00 - 99
&#39;Y&#39;     年份，被格式化为必要时带前导零的四位数（至少），例如，0092 等于格里高利历的 92 CE。
&#39;y&#39;     年份的最后两位数，被格式化为必要时带前导零的两位数，即 00 - 99。
&#39;j&#39;     一年中的天数，被格式化为必要时带前导零的三位数，例如，对于格里高利历是 001 - 366。
&#39;m&#39;     月份，被格式化为必要时带前导零的两位数，即 01 - 13。
&#39;d&#39;     一个月中的天数，被格式化为必要时带前导零两位数，即 01 - 31
&#39;e&#39;     一个月中的天数，被格式化为两位数，即 1 - 31。
以下转换字符用于格式化常见的日期/时间组合。
&#39;R&#39;     24 小时制的时间，被格式化为 &quot;%tH:%tM&quot;
&#39;T&#39;     24 小时制的时间，被格式化为 &quot;%tH:%tM:%tS&quot;。
&#39;r&#39;     12 小时制的时间，被格式化为 &quot;%tI:%tM:%tS %Tp&quot;。上午或下午标记 (&#39;%Tp&#39;) 的位置可能与语言环境有关。
&#39;D&#39;     日期，被格式化为 &quot;%tm/%td/%ty&quot;。
&#39;F&#39;     ISO 8601 格式的完整日期，被格式化为 &quot;%tY-%tm-%td&quot;。
&#39;c&#39;     日期和时间，被格式化为 &quot;%ta %tb %td %tT %tZ %tY&quot;，例如 &quot;Sun Jul 20 16:17:00 EDT 1969&quot;。</p>
<p>分类: <a href="http://www.cnblogs.com/xytop/category/152381.html" target="_blank">JAVA</a></p>
<p>绿色通道：<a href="">好文要顶</a><a href="">关注我</a><a href="">收藏该文</a><a href="http://space.cnblogs.com/msg/send/xytop" target="_blank">与我联系</a>
<a href="http://home.cnblogs.com/u/xytop/" target="_blank">xytop</a>
<a href="http://home.cnblogs.com/u/xytop/followees" target="_blank">关注 - 3</a>
<a href="http://home.cnblogs.com/u/xytop/followers" target="_blank">粉丝 - 0</a></p>
<p><a href="">+加关注</a></p>
<p>0</p>
<p>0
(请您对文章做出评价)</p>
<p><a href="http://www.cnblogs.com/xytop/archive/2010/09/16/1827865.html" target="_blank">»</a> 下一篇：<a href="http://www.cnblogs.com/xytop/archive/2010/09/16/1827865.html" title="发布于2010-09-16 10:30" target="_blank">IIS无法启动</a></p>
<p>posted @ 2008-08-26 23:57 <a href="http://www.cnblogs.com/xytop/" target="_blank">xytop</a> 阅读(1680) <a href="http://www.cnblogs.com/xytop/archive/2008/08/26/1277125.html#commentform" target="_blank">评论(0)</a> <a href="http://www.cnblogs.com/xytop/archive/2008/08/26/1277125.html#" target="_blank">编辑</a> <a href="http://www.cnblogs.com/xytop/archive/2008/08/26/1277125.html#" target="_blank">收藏</a>
 <img src="" alt=""></p>
<p>注册用户登录后才能发表评论，请 <a href="http://passport.cnblogs.com/login.aspx?ReturnUrl=http%3a%2f%2fwww.cnblogs.com%2fxytop%2farchive%2f2008%2f08%2f26%2f1277125.html%3flogin%3d1%23commentform" target="_blank">登录</a> 或 <a href="http://passport.cnblogs.com/register.aspx?ReturnUrl=http%3a%2f%2fwww.cnblogs.com%2fxytop%2farchive%2f2008%2f08%2f26%2f1277125.html%23Bottom2" target="_blank">注册</a>，<a href="http://www.cnblogs.com/" target="_blank">返回博客园首页</a>。</p>
<p><strong>最新IT新闻</strong>:
· <a href="http://news.cnblogs.com/n/103808/" target="_blank">MSN 中文网大改版，附介绍</a>
· <a href="http://news.cnblogs.com/n/103807/" target="_blank">英特尔宣布Ultrabook</a>
· <a href="http://news.cnblogs.com/n/103806/" target="_blank">Win8集成Xbox 360传言再起 或采用会员制</a>
· <a href="http://news.cnblogs.com/n/103805/" target="_blank">京东自种大米上市销售 刘强东称绝对无毒</a>
· <a href="http://news.cnblogs.com/n/103804/" target="_blank">2011上半年电商务10大事件盘点</a>
» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a>
<strong>知识库最新文章</strong>:
<a href="http://kb.cnblogs.com/page/100785/" target="_blank">从一个职校走出来的高级程序员</a>
<a href="http://kb.cnblogs.com/page/100521/" target="_blank">MySQL与NoSQL - SQL与NoSQL的融合</a>
<a href="http://kb.cnblogs.com/page/100594/" target="_blank">分布式系统部署、监控与进程管理的几重境界</a>
<a href="http://kb.cnblogs.com/page/100991/" target="_blank">谁做了程序员眼中的程序员</a>
<a href="http://kb.cnblogs.com/page/100468/" target="_blank">复杂是大敌</a>
 » <a href="http://news.cnblogs.com/" target="_blank">更多知识库文章...</a></p>
<p>网站导航: <a href="http://www.cnblogs.com/" target="_blank">博客园首页</a>  <a href="http://news.cnblogs.com/" target="_blank">IT新闻</a>  <a href="http://home.cnblogs.com/" target="_blank">我的园子</a>  <a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a>  <a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a>  <a href="http://home.cnblogs.com/q/" target="_blank">博问</a>
<a href="http://www.china-pub.com/STATIC07/1104/jsj_bangding_110421.asp?ref=bky" target="_blank"><img src="" alt=""></a>
<a href="http://www.china-pub.com/itbook/" target="_blank">China-pub 计算机图书网上专卖店！6.5万品种2-8折！</a>
<a href="http://www.china-pub.com/static07/0901/zh_jueba_090121.asp" target="_blank">China-Pub 计算机绝版图书按需印刷服务</a></p>
<p>简洁版式：<a href="http://archive.cnblogs.com/a/1277125/" target="_blank">JAVA中String.format的用法</a></p>
<p>Copyright ©2011 xytop</p>
<p>昵称：<a href="http://www.cnblogs.com/xytop/" target="_blank">xytop</a>
粉丝：<a href="http://home.cnblogs.com/u/xytop/followers/" target="_blank">0</a>
关注：<a href="http://home.cnblogs.com/u/xytop/followees/" target="_blank">3</a>
<a href="">+加关注</a></p>
<p><a href="&quot;Go to the previous month&quot;">&lt;</a>2008年8月<a href="&quot;Go to the next month&quot;">&gt;</a>日一二三四五六272829303112345678910111213141516171819202122232425<a href="http://www.cnblogs.com/xytop/archive/2008/8/26.html" target="_blank">26</a>2728293031123456</p>
<h3 id="-">搜索</h3>
<h3 id="-">常用链接</h3>
<ul>
<li><a href="http://www.cnblogs.com/xytop/MyPosts.html" target="_blank">我的随笔</a></li>
<li><a href="http://home.cnblogs.com/xytop/" target="_blank">我的空间</a></li>
<li><a href="http://space.cnblogs.com/msg/recent" target="_blank">我的短信</a></li>
<li><a href="http://www.cnblogs.com/xytop/MyComments.html" target="_blank">我的评论</a></li>
<li><a href="http://www.cnblogs.com/xytop/archive/2008/08/26/1277125.html#" target="_blank">更多链接</a></li>
<li><a href="http://www.cnblogs.com/xytop/OtherPosts.html" title="我发表过评论的随笔" target="_blank">我的参与</a></li>
<li><a href="http://www.cnblogs.com/xytop/MyNews.html" target="_blank">我的新闻</a></li>
<li><p><a href="http://www.cnblogs.com/xytop/tag/" target="_blank">我的标签</a></p>
<h3 id="-">我的标签</h3>
</li>
<li><p><a href="http://www.cnblogs.com/xytop/tag/iis%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8/" target="_blank">iis无法启动</a>(1)</p>
</li>
<li><a href="http://www.cnblogs.com/xytop/tag/IIS%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99/" target="_blank">IIS启动报错</a>(1)</li>
</ul>
<h1 id="-">随笔分类</h1>
<ul>
<li><a href="http://www.cnblogs.com/xytop/category/152382.html" target="_blank">C/#(1)</a><a href="http://www.cnblogs.com/xytop/archive/2008/08/26/1277125.html#" target="_blank"><img src="" alt=""></a></li>
<li><a href="http://www.cnblogs.com/xytop/category/152381.html" target="_blank">JAVA(1)</a><a href="http://www.cnblogs.com/xytop/archive/2008/08/26/1277125.html#" target="_blank"><img src="" alt=""></a></li>
<li><a href="http://www.cnblogs.com/xytop/category/152383.html" target="_blank">JSP</a><a href="http://www.cnblogs.com/xytop/archive/2008/08/26/1277125.html#" target="_blank"><img src="" alt=""></a></li>
</ul>
<h1 id="-">随笔档案</h1>
<ul>
<li><a href="http://www.cnblogs.com/xytop/archive/2010/09.html" target="_blank">2010年9月 (1)</a></li>
<li><a href="http://www.cnblogs.com/xytop/archive/2008/08.html" target="_blank">2008年8月 (1)</a><h3 id="-rss-http-www-cnblogs-com-xytop-commentsrss-aspx-rss-">最新评论<a href="http://www.cnblogs.com/xytop/CommentsRSS.aspx" title="RSS订阅最最新评论" target="_blank"><img src="&quot;RSS订阅最最新评论&quot;" alt=""></a></h3>
</li>
</ul>
<h3 id="-">阅读排行榜</h3>
<ul>
<li><a href="">1. JAVA中String.format的用法(1680)</a></li>
<li><p><a href="http://www.cnblogs.com/xytop/archive/2010/09/16/1827865.html" target="_blank">2. IIS无法启动(64)</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://www.cnblogs.com/xytop/archive/2010/09/16/1827865.html" target="_blank">1. IIS无法启动(0)</a></p>
</li>
<li><a href="">2. JAVA中String.format的用法(0)</a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/xml/">xml</a></li></span><span class="breadcrumb"><li><a href="/categories/xml/">xml</a></li><li><a href="/categories/xml/xstream/">xstream</a></li></span></span> | <span class="tags">Tagged <a href="/tags/xml/" class="label label-primary">xml</a><a href="/tags/xstream/" class="label label-success">xstream</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-xml-xstream--JAVA中Stringformat的用法-xytop-博客园/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-xml-xstream--JAVA中Stringformat的用法-xytop-博客园" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-压缩-解压--java打tar/">java打tar</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-压缩-解压--java打tar/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-tar">java打tar</h1>
<p><strong>java**</strong>打tar.gz包**</p>
<p>2011-01-26 00:36</p>
<p>package src.com.snow.test;</p>
<p>import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.zip.GZIPOutputStream;</p>
<p>import org.apache.tools.tar.TarEntry;
import org.apache.tools.tar.TarOutputStream;
import org.apache.tools.zip.ZipOutputStream;</p>
<p>//<em> 
 /</em> 功能：压缩文件成tar.gz格式 
 /<em>/
public class TarUtils {
 private static int BUFFER = 1024 /</em> 4; // 缓冲大小
 private static byte[] B_ARRAY = new byte[BUFFER];</p>
<p> //<em>
  /</em> 方法功能：打包单个文件或文件夹 参数：inputFileName 要打包的文件夹或文件的路径 targetFileName 打包后的文件路径
  /*/
 public void execute(String inputFileName, String targetFileName) {
  File inputFile = new File(inputFileName);
  String base = inputFileName
    .substring(inputFileName.lastIndexOf(&quot;/&quot;) + 1);
  TarOutputStream out = getTarOutputStream(targetFileName);
  tarPack(out, inputFile, base);
  try {
   if (null != out) {
    out.close();
   }
  } catch (IOException e) {
   e.printStackTrace();
  }
  compress(new File(targetFileName));
 }</p>
<p> //<em>
  /</em> 方法功能：打包多个文件或文件夹 参数：inputFileNameList 要打包的文件夹或文件的路径的列表 targetFileName
  /<em> 打包后的文件路径
  /</em>/
 public void execute(List<String> inputFileNameList, String targetFileName) {
  TarOutputStream out = getTarOutputStream(targetFileName);</p>
<p>  for (String inputFileName : inputFileNameList) {
   File inputFile = new File(inputFileName);
   String base = inputFileName.substring(inputFileName
     .lastIndexOf(&quot;/&quot;) + 1);
   tarPack(out, inputFile, base);
  }</p>
<p>  try {
   if (null != out) {
    out.close();
   }
  } catch (IOException e) {
   e.printStackTrace();
  }
  compress(new File(targetFileName));
 }</p>
<p> //<em>
  /</em> 方法功能：打包成tar文件 参数：out 打包后生成文件的流 inputFile 要压缩的文件夹或文件 base 打包文件中的路径
  /*/</p>
<p> private void tarPack(TarOutputStream out, File inputFile, String base) {
  if (inputFile.isDirectory()) // 打包文件夹
  {
   packFolder(out, inputFile, base);
  } else // 打包文件
  {
   packFile(out, inputFile, base);
  }
 }</p>
<p> //<em>
  /</em> 方法功能：遍历文件夹下的内容，如果有子文件夹，就调用tarPack方法 参数：out 打包后生成文件的流 inputFile 要压缩的文件夹或文件
  /<em> base 打包文件中的路径
  /</em>/
 private void packFolder(TarOutputStream out, File inputFile, String base) {
  File[] fileList = inputFile.listFiles();
  try {
   // 在打包文件中添加路径
   out.putNextEntry(new TarEntry(base + &quot;/&quot;));
  } catch (IOException e) {
   e.printStackTrace();
  }
  base = base.length() == 0 ? &quot;&quot; : base + &quot;/&quot;;
  for (File file : fileList) {
   tarPack(out, file, base + file.getName());
  }
 }</p>
<p> //<em>
  /</em> 方法功能：打包文件 参数：out 压缩后生成文件的流 inputFile 要压缩的文件夹或文件 base 打包文件中的路径
  /*/
 private void packFile(TarOutputStream out, File inputFile, String base) {
  TarEntry tarEntry = new TarEntry(base);</p>
<p>  // 设置打包文件的大小，如果不设置，打包有内容的文件时，会报错
  tarEntry.setSize(inputFile.length());
  try {
   out.putNextEntry(tarEntry);
  } catch (IOException e) {
   e.printStackTrace();
  }
  FileInputStream in = null;
  try {
   in = new FileInputStream(inputFile);
  } catch (FileNotFoundException e) {
   e.printStackTrace();
  }
  int b = 0;</p>
<p>  try {
   while ((b = in.read(B_ARRAY, 0, BUFFER)) != -1) {
    out.write(B_ARRAY, 0, b);
   }
  } catch (IOException e) {
   e.printStackTrace();
  } catch (NullPointerException e) {
   System.err
     .println(&quot;NullPointerException info ======= [FileInputStream is null]&quot;);
  } finally {
   try {
    if (null != in) {
     in.close();
    }
    if (null != out) {
     out.closeEntry();
    }
   } catch (IOException e) {</p>
<p>   }
  }
 }</p>
<p> //<em>
  /</em> 方法功能：把打包的tar文件压缩成gz格式 参数：srcFile 要压缩的tar文件路径
  /*/
 private void compress(File srcFile) {
  File target = new File(srcFile.getAbsolutePath() + &quot;.gz&quot;);
  FileInputStream in = null;
  GZIPOutputStream out = null;
  try {
   in = new FileInputStream(srcFile);
   out = new GZIPOutputStream(new FileOutputStream(target));
   int number = 0;
   while ((number = in.read(B_ARRAY, 0, BUFFER)) != -1) {
    out.write(B_ARRAY, 0, number);
   }
  } catch (FileNotFoundException e) {
   e.printStackTrace();
  } catch (IOException e) {
   e.printStackTrace();
  } finally {
   try {
    if (in != null) {
     in.close();
    }</p>
<pre><code>if (out != null) {
 out.close();
}
</code></pre><p>   } catch (IOException e) {
    e.printStackTrace();
   }
  }
 }</p>
<p> //<em>
  /</em> 方法功能：获得打包后文件的流 参数：targetFileName 打包后文件的路径
  /*/
 private TarOutputStream getTarOutputStream(String targetFileName) {
  // 如果打包文件没有.tar后缀名，就自动加上
  targetFileName = targetFileName.endsWith(&quot;.tar&quot;) ? targetFileName
    : targetFileName + &quot;.tar&quot;;
  FileOutputStream fileOutputStream = null;
  try {
   fileOutputStream = new FileOutputStream(targetFileName);
  } catch (FileNotFoundException e) {
   e.printStackTrace();
  }
  BufferedOutputStream bufferedOutputStream = new BufferedOutputStream(
    fileOutputStream);
  TarOutputStream out = new TarOutputStream(bufferedOutputStream);</p>
<p>  // 如果不加下面这段，当压缩包中的路径字节数超过100 byte时，就会报错
  out.setLongFileMode(TarOutputStream.LONGFILE_GNU);
  return out;
 }</p>
<p>}</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/压缩-解压/">压缩-解压</a></li></span></span> | <span class="tags">Tagged <a href="/tags/压缩-解压/" class="label label-primary">压缩-解压</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-压缩-解压--java打tar/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-压缩-解压--java打tar" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-压缩-解压--Java实现将多个文件打包压缩成tar_gz文件-易锐的日志-网易博客/">Java实现将多个文件打包压缩成tar_gz文件 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-压缩-解压--Java实现将多个文件打包压缩成tar_gz文件-易锐的日志-网易博客/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-tar_gz-">Java实现将多个文件打包压缩成tar_gz文件 - 易锐的日志 - 网易博客</h1>
<p><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://www.163.com/" target="_blank">网易 </a></p>
<p><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://news.163.com/" target="_blank">新闻</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://t.163.com/" target="_blank">微博</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://email.163.com/" target="_blank">邮箱</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://photo.163.com/" target="_blank">相册</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://yuedu.163.com/" target="_blank">阅读</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://www.youdao.com/" target="_blank">有道</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://photo.163.com/pp/square/" target="_blank">摄影</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://aipai.163.com?from=163blog" target="_blank">爱拍</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://fm.163.com/?fmblogzx0628" target="_blank">闪电邮</a><a href="http://m.123.163.com/?frombkcp" target="_blank">手机邮</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://yxp.163.com/" target="_blank">印像派</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://dream.163.com/?from=bkcp" target="_blank">梦幻人生</a> <a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://sitemap.163.com/" target="_blank">更多</a></p>
<p><a href="http://blog.163.com/?frompersonalbloghome" target="_blank">博客 </a></p>
<p><a href="http://blog.163.com/services/wapblog.html?frompersonalbloghome" target="_blank">手机博客</a><a href="http://blog.163.com/clone/clone.html?frompersonalbloghome" target="_blank">博客搬家</a><a href="http://blog.163.com/vip.do?frompersonalbloghome" target="_blank">博客VIP服务</a> <a href="http://blog.163.com/blog_admin/blog/static/721279201082863728829/?frompersonalbloghome" target="_blank">LiveWriter写博</a><a href="http://blog.163.com/blog_admin/blog/static/721279201092713253500/?frompersonalbloghome" target="_blank">word写博</a><a href="http://blog.163.com/services/mailblog.html?frompersonalbloghome" target="_blank">邮件写博</a><a href="http://blog.163.com/services/emsblog.html?frompersonalbloghome" target="_blank">短信写博</a> <a href="http://blog.163.com/showMultiUser.do?frompersonalbloghome" target="_blank">群博客</a><a href="http://blog.163.com/BLOG_YOUCAI/" target="_blank">博客油菜地</a><a href="http://blog.163.com/ht/?frompersonalbloghome" target="_blank">博客话题</a><a href="http://blog.163.com/hot/history/?frompersonalbloghome" target="_blank">博客热点</a><a href="http://q.163.com/#home?frompersonalbloghome" target="_blank">博客圈子</a><a href="http://blog.163.com/findFriend.do?type=5?frompersonalbloghome" target="_blank">找朋友</a>
<a href="http://blog.163.com/public/explore/?frompersonalbloghome" target="_blank">发现</a></p>
<p><a href="http://blog.163.com/g/?frompersonalbloghome" target="_blank">小组</a>
<a href="http://blog.163.com/public/theme/?frompersonalbloghome" target="_blank">风格</a></p>
<p><a href="http://blog.163.com/randomUser.do" title="随便看看"></a></p>
<p><a href="http://blog.163.com/vip.do" target="_blank">博客VIP服务</a></p>
<p><a href="http://reg.163.com/reg/reg.jsp?product=blog&amp;url=http://blog.163.com/ntesRegBlank.html&amp;loginurl=http://blog.163.com/" target="_blank">创建博客</a> <a href="http://blog.163.com/kliumin@126/blog/static/8165118520091063306587/#" target="_blank">登录</a>  </p>
<p> 关注</p>
<p>重要提醒：系统检测到您的帐号可能存在被盗风险，请尽快<a href="http://reg.163.com/Main.jsp?username=kliumin@126.com" target="_blank">查看风险提示</a>，并立即<a href="http://blog.163.com/kliumin@126/settings/?fromnewcenter#m=0&amp;t=7" target="_blank">修改密码</a>。  |  <a href="http://blog.163.com/kliumin@126/blog/static/8165118520091063306587/" target="_blank">关闭</a></p>
<p>网易博客安全提醒：系统检测到您当前密码的安全性较低，为了您的账号安全，建议您适时修改密码    <a href="http://blog.163.com/kliumin@126/settings/?fromnewcenter#m=0&amp;t=7" target="_blank">立即修改</a>  |  <a href="http://blog.163.com/kliumin@126/blog/static/8165118520091063306587/" target="_blank">关闭</a>
<a href="http://blog.163.com/kliumin@126/blog/static/8165118520091063306587/" target="_blank"></a>   <a href="http://blog.163.com/kliumin@126/blog/static/8165118520091063306587/">显示下一条</a>  |  <a href="http://blog.163.com/kliumin@126/blog/static/8165118520091063306587/" target="_blank">关闭</a></p>
<p><a href="http://blog.163.com/public/explore/?fromblogbanner"></a>
<a href="http://www.lofter.com/invite/163blog/?email="></a></p>
<h1 id="-">易锐的博客</h1>
<p>我的博客
 <a href="http://blog.163.com/kliumin@126/blog/static/8165118520091063306587/#"></a></p>
<h2 id="-">导航</h2>
<ul>
<li><a href="http://blog.163.com/kliumin@126/" target="_blank">首页</a></li>
<li><a href="http://blog.163.com/kliumin@126/blog/" target="_blank">日志</a></li>
<li><a href="http://blog.163.com/kliumin@126/album/" target="_blank">相册</a></li>
<li><a href="http://blog.163.com/kliumin@126/music/" target="_blank">音乐</a></li>
<li><a href="http://blog.163.com/kliumin@126/collection/" target="_blank">收藏</a></li>
<li><a href="http://blog.163.com/kliumin@126/friends/" target="_blank">博友</a></li>
<li><a href="http://blog.163.com/kliumin@126/profile/" target="_blank">关于我</a></li>
</ul>
<h2 id="-">日志</h2>
<p><a href="http://blog.163.com/kliumin@126/blog/static/81651185200910413622503/" target="_blank">eclipse注释规范设置</a></p>
<h3 id="java-tar-gz-">Java实现将多个文件打包压缩成tar.gz文件</h3>
<p>2009-11-06 15:30:06|  分类： <a href="http://blog.163.com/kliumin@126/blog/#m=0&amp;t=1&amp;c=fks_087067087087088066084083085095092087087070085087094070" title="默认分类" target="_blank">默认分类</a> |  标签： |字号大中小 <a href="">订阅</a></p>
<p>后缀为tar.gz的文件实际上时先将文件（单个或多个）打包成后缀为tar的（tar包）文件，再用gzip压缩成gz文件，如此来说我们便可以用两步来实现此功能，请看代码：</p>
<p>import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.zip.GZIPOutputStream;</p>
<p>import org.apache.commons.compress.archivers.tar.TarArchiveEntry;
import org.apache.commons.compress.archivers.tar.TarArchiveOutputStream;
import org.apache.commons.compress.utils.IOUtils;</p>
<p>//<em>/</em>
 /<em> @Title: GZIPUtil.java
 /</em> @Description: gzip文件压缩和解压缩工具类
 /<em> @author LM
 /</em> @date 2009-11-4 下午06:23:29
 /<em> @version V1.0
 /</em>/
public class GZIPUtil {</p>
<p> //<em>/</em>
  /<em>
  /</em> @Title: pack
  /<em> @Description: 将一组文件打成tar包
  /</em> @param sources 要打包的原文件数组
  /<em> @param target 打包后的文件
  /</em> @return File    返回打包后的文件
  /<em> @throws
  /</em>/
 public static File pack(File[] sources, File target){
  FileOutputStream out = null;
  try {
   out = new FileOutputStream(target);
  } catch (FileNotFoundException e1) {
   e1.printStackTrace();
  }
  TarArchiveOutputStream os = new TarArchiveOutputStream(out);
  for (File file : sources) {
   try {
    os.putArchiveEntry(new TarArchiveEntry(file));
    IOUtils.copy(new FileInputStream(file), os);
    os.closeArchiveEntry();</p>
<p>   } catch (FileNotFoundException e) {
    e.printStackTrace();
   } catch (IOException e) {
    e.printStackTrace();
   }
  }
  if(os != null) {
   try {
    os.flush();
    os.close();
   } catch (IOException e) {
    e.printStackTrace();
   }
  }</p>
<p>  return target;
 }</p>
<p> //<em>/</em>
  /<em>
  /</em> @Title: compress
  /<em> @Description: 将文件用gzip压缩
  /</em> @param  source 需要压缩的文件
  /<em> @return File    返回压缩后的文件
  /</em> @throws
  /*/
 public static File compress(File source) {
  File target = new File(source.getName() + &quot;.gz&quot;);
  FileInputStream in = null;
  GZIPOutputStream out = null;
  try {
   in = new FileInputStream(source);
   out = new GZIPOutputStream(new FileOutputStream(target));
   byte[] array = new byte[1024];
   int number = -1;
   while((number = in.read(array, 0, array.length)) != -1) {
    out.write(array, 0, number);
   }
  } catch (FileNotFoundException e) {
   e.printStackTrace();
   return null;
  } catch (IOException e) {
   e.printStackTrace();
   return null;
  } finally {
   if(in != null) {
    try {
     in.close();
    } catch (IOException e) {
     e.printStackTrace();
     return null;
    }
   }</p>
<p>   if(out != null) {
    try {
     out.close();
    } catch (IOException e) {
     e.printStackTrace();
     return null;
    }
   }
  }
  return target;
 }</p>
<p> public static void main(String[] args) {
  File[] sources = new File[] {new File(&quot;task.xml&quot;), new File(&quot;app.properties&quot;)};
  File target = new File(&quot;release_package.tar&quot;);
  compress(pack(sources, target));
 }
}</p>
<p>可以打包压缩，那么解压缩就是反其道而行，有时间再来写一篇解压缩的。
  评论这张</p>
<p><img src="" alt=""> 转发至微博
<img src="" alt=""> 转发至微博</p>
<p><img src="" alt=""> 0人  |  分享到：         </p>
<p>阅读(674)| 评论(0)| 引用 (0) |举报</p>
<p><a href="http://blog.163.com/kliumin@126/blog/static/81651185200910413622503/" target="_blank">eclipse注释规范设置</a></p>
<h3 id="-">历史上的今天</h3>
<h3 id="-">相关文章</h3>
<h3 id="-">最近读者</h3>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<p>this.p={ m:2, b:2, id:&#39;fks_083066081080089069080083087095092087087070085087094070&#39;, blogTitle:&#39;Java实现将多个文件打包压缩成tar.gz文件&#39;, blogAbstract:&#39;<P\>后缀为tar.gz的文件实际上时先将文件（单个或多个）打包成后缀为tar的（tar包）文件，再用gzip压缩成gz文件，如此来说我们便可以用两步来实现此功能，请看代码：</P\>\r\n<P\>imp<wbr\>ort java.io.File;<BR\>imp<wbr\>ort java.io.FileInputStream;<BR\>imp<wbr\>ort java.io.FileNotFoundException;<BR\>imp<wbr\>ort java.io.FileOutputStream;<BR\>imp<wbr\>ort java.io.IOException;<BR\>imp<wbr\>ort java.util.zip.GZIPOutputStream;</P\>\r\n<P\>imp<wbr\>ort org.apache.commons.compress.archivers.tar.TarArchiveEntry;</P\>&#39;, blogTag:&#39;&#39;, blogUrl:&#39;blog/static/8165118520091063306587&#39;, isPublished:1, istop:false, type:0, modifyTime:0, publishTime:1257492606587, permalink:&#39;blog/static/8165118520091063306587&#39;, commentCount:0, mainCommentCount:0, recommendCount:0, bsrk:-100, publisherId:0, recomBlogHome:false, attachmentsFileIds:[], vote:{}, groupInfo:{}, friendstatus:&#39;none&#39;, followstatus:&#39;unFollow&#39;, pubSucc:&#39;&#39;, visitorProvince:&#39;广东&#39;, visitorCity:&#39;深圳&#39;, postAddInfo:{}, mset:&#39;000&#39;, mcon:&#39;&#39;, srk:-100, remindgoodnightblog:false, isBlackVisitor:false, isShowYodaoAd:false, hostIntro:&#39;&#39;, hmcon:&#39;&#39; }   {list a as x} {if !!x} <div class="iblock nbw-fce nbw-f40"> <a class="fc03 noul" target="_blank" hidefocus="true" href="http://blog.163.com/${x.visitorName}/"> {if x.visitorName==visitor.userName} <img alt="${x.visitorNickname|escape}" onerror="location.f40" class="cwd bdwa bdc0" src="${fn1(x.visitorName)}&r=${visitor.imageUpdateTime}"/> {else} <img alt="${x.visitorNickname|escape}" onerror="location.f40" class="cwd bdwa bdc0" src="${fn1(x.visitorName)}"/> {/if} </a> <div class="cwd vname thide"> {if x.moveFrom==&#39;wap&#39;} <a class="noul pnt" target="_blank" href="http://blog.163.com/services/wapblog.html?frompersonalbloghome"><span title="来自网易手机博客" class="iblock wapIcon"> </span></a> {elseif x.moveFrom==&#39;iphone&#39;} <a class="noul pnt" target="_blank"><span title="来自iPhone客户端" class="iblock iphoneIcon"> </span></a> {elseif x.moveFrom==&#39;android&#39;} <a class="noul pnt" target="_blank"><span title="来自Android客户端" class="iblock androidIcon"> </span></a> {elseif x.moveFrom==&#39;mobile&#39;} <a class="noul pnt" target="_blank" href="http://blog.163.com/services/emsblog.html?frompersonalbloghome"><span title="来自网易短信写博" class="iblock wapIcon"> </span></a> {/if} <a class="fc03 m2a" target="_blank" hidefocus="true" href="http://blog.163.com/${x.visitorName}/"> ${fn(x.visitorNickname,8)|escape} </a> </div> </div> {/if} {/list}   {if !!a} <a target="_blank" href="http://blog.163.com/${a.userName}/"><img class="bdwa bdc0 pnt" onerror="location.f60" src="${fn1(a.userName)}"/></a> <a target="_blank" class="fc03 m2a" href="http://blog.163.com/${a.userName}/">${fn(a.nickname,8)|escape}</a> <div class="intro fc05">${a.selfIntro|escape}{if great260}${suplement}{/if}</div> <div class="acts ztag"></div> <div class="mbga phide xtag"> <div class="mbgai"> </div> <a class="fc03 xtag m2a" href="/#" target="_blank"></a> </div> {/if}  &lt;/#--最新日志，群博日志--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="${furl()}${x.permalink}/?latestBlog">${fn(x.title,26)|escape}</a></li> {/if} {/list}  &lt;/#--推荐日志--&gt;  <p class="fc06">推荐过这篇日志的人：</p> <div> {list a as x} {if !!x} <div class="iblock nbw-fce nbw-f40"> <a class="fc03 noul" target="_blank" hidefocus="true" href="http://blog.163.com/${x.recommenderName}/"> <img alt="${x.recommenderNickname}" onerror="location.f40" class="cwd bdwa bdc0" src="${fn1(x.recommenderName)}"/> </a> <div class="cwd thide"> <a class="fc03 m2a" target="_blank" hidefocus="true" href="http://blog.163.com/${x.recommenderName}/"> ${fn(x.recommenderNickname,6)|escape} </a> </div> </div> {/if} {/list} </div> {if !!b&amp;&amp;b.length&gt;0} <p class="fc06">他们还推荐了：</p> <ul> {list b as y} {if !!y} <li class="rrb"><span class="iblock">·</span><a class="fc03 m2a" target="_blank" href="http://blog.163.com/${y.recommendBlogPermalink}/?from=blog/static/8165118520091063306587">${y.recommendBlogTitle}</a></li> {/if} {/list} </ul> {/if}  &lt;/#--引用记录--&gt;  <span class="pleft fc07">引用记录：</span> <ul class="tbac"> {list d as x} <li class="clearfix"> <span class="pleft iblock">·</span> <div class="tbl thide pleft"><span><a target="_blank" class="fc07 m2a" href="${x.referBlogUrl}">${x.referBlogTitle}</a></span></div> <div class="tbr pleft"><span><a target="_blank" class="fc07 m2a" href="${x.referHomePage}">${x.referUserName}</a></span></div> </li> {/list} </ul>  &lt;/#--博主推荐--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="http://blog.163.com/${x.userName}/${x.permalink}/?recommendBlog" title="${x.title|default:""|escape}">${x.title|default:&quot;&quot;|escape}</a></li> {/if} {/list}  &lt;/#--随机阅读--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="http://blog.163.com/${x.userName}/${x.permalink}/?personalRecomBlog" title="${x.title|default:""|escape}">${x.title|default:&quot;&quot;|escape}</a></li> {/if} {/list}  &lt;/#--首页推荐--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" target="_blank" href="${x.blogUrl|default:""|escape}?recommendReader" title="${x.blogTile|default:""|escape}">${x.blogTile|default:&quot;&quot;|escape}</a></li> {/if} {/list}  &lt;/#--相关文章--&gt;  <ul> {list a as x} {if x_index&gt;9}{break}{/if} {if !!x} <li class="thide fc03"> <a class="m2a" target="_blank" target="_blank" href="${x.url|default:""}?fromdm&fromSearch&isFromSearchEngine=${isFromSearchEngine|default:"no"}" title="${x.title|default:""|escape}">${x.title|default:&quot;&quot;|escape}</a><span class="fc07">${fn2(parseInt(x.date),&#39;yyyy-MM-dd HH:mm:ss&#39;)}</span> </li> {/if} {/list} </ul>  &lt;/#--历史上的今天--&gt;  <ul> {list a as x} {if x_index&gt;4}{break}{/if} {if !!x} <li class="thide fc03"> <a class="m2a" target="_blank" href="http://blog.163.com/${x.userName}/${x.permalink|default:""}" title="${x.title|default:""|escape}">${fn1(x.title,60)|escape}</a><span class="fc07">${fn2(x.publishTime,&#39;yyyy-MM-dd HH:mm:ss&#39;)}</span> </li> {/if} {/list} </ul>  &lt;/#--右边模块结构--&gt;  <div class="uinfo ztag"></div> <h4 class="fc07 fs0 ltt">最新日志</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">该作者的其他文章</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">博主推荐</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">相关日志</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">随机阅读</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">首页推荐</h4> <ul class="ztag blst"></ul> <div class="more"><a target="_blank" class="fc03 m2a" href="http://blog.163.com">更多&gt;&gt;</a></div> <br/><a id="yodaoad_suggest" target="_blank" href="http://fankui.163.com/ft/comment.fb?pid=12004&fid=16023" class="fc05 m2a phide">对“推广广告”提建议</a> <br/><br/> <div id="yodaoad_r" style="display:none;_zoom:1;"></div>  &lt;/#--评论模块结构--&gt;  <div class="publish ztag"></div> <div class="bdwt bds2 bdc0 phide" id="yodaoad_2" style="_zoom:1;"></div> <div class="ztag bdwt bds2 bdc0"> <div class="case"></div> <div class="clearfix"></div> </div>  &lt;/#--引用模块结构--&gt;  <div class="close"> <span class="ztag iblock icn0 icn0-57"> </span> </div> <div class="ztag phide"></div>  &lt;/#--博主发起的投票--&gt;  {list a as x} {if !!x} <li> <a href="http://blog.163.com/${x.userName}/" target="_blank" class="m2a fc03">${x.nickName|escape}</a>  投票给 {var first_option = true;} {list x.voteDetailList as voteToOption} {if voteToOption==1} {if first_option==false},{/if}  “${b[voteToOption_index]}”   {/if} {/list} {if (x.role!=&quot;-1&quot;) },“我是${c[x.role]}”  {/if}     <span class="fc07">    ${fn1(x.voteTime)}</span> {if x.userName==&#39;&#39;}{/if} {/if} {/list}</p>
<h2 id="-">页脚</h2>
<p><a href="http://corp.163.com/index_gb.html" target="_blank">公司简介</a> - <a href="http://gb.corp.163.com/gb/contactus.html" target="_blank">联系方法</a> - <a href="http://corp.163.com/gb/job/job.html" target="_blank">招聘信息</a> - <a href="http://help.163.com/?b13abk1" target="_blank">客户服务</a> - <a href="http://corp.163.com/gb/legal/legal.html" target="_blank">隐私政策</a> - <a href="http://blog.163.com/public/theme/" target="_blank">博客风格</a> - <a href="http://blog.163.com/services/wapblog.html" target="_blank">手机博客</a> - <a href="http://blog.163.com/vip.do" target="_blank">VIP博客</a> - <a href="">订阅此博客</a></p>
<p>网易公司版权所有 ©1997-2011</p>
<p><a rel="nofollow" class="pr" target="_blank" href="http://help.163.com/special/007525FT/blog.html?b13aze1">帮助</a> <span class="fr iblock space icn1 icn1-4"> </span> <a class="pr" target="_blank" href="http://blog.163.com/activation.do?host=activation&&username=${u}">${u}</a>   {list wl as x} <div class="grp">${x.g}</div> {list x.l as y} <a class="itm noul" href="/#" hidefocus="true" name="{if typeof(y.v)=='string'}${y.v}{else}${y_index}{/if}">${y.n}</a> {/list} {/list}   {if defined(&#39;wl&#39;)} {list wl as x}<a class="itm noul" href="/#" hidefocus="true" name="${x.v}">${x.n}</a>{/list} {/if}</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/压缩-解压/">压缩-解压</a></li></span></span> | <span class="tags">Tagged <a href="/tags/压缩-解压/" class="label label-primary">压缩-解压</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-压缩-解压--Java实现将多个文件打包压缩成tar_gz文件-易锐的日志-网易博客/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-压缩-解压--Java实现将多个文件打包压缩成tar_gz文件-易锐的日志-网易博客" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-xml-xstream--xStream完美转换XML、JSON-hoojo-博客园/">xStream完美转换XML、JSON </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-xml-xstream--xStream完美转换XML、JSON-hoojo-博客园/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="xstream-xml-json-hoojo-">xStream完美转换XML、JSON - hoojo - 博客园</h1>
<h1 id="-xstream-xml-json-"><a href="">xStream完美转换XML、JSON</a></h1>
<p><strong>xStream**</strong>框架<strong>**</strong></p>
<p>xStream可以轻易的将Java对象和xml文档相互转换，而且可以修改某个特定的属性和节点名称，而且也支持json的转换；</p>
<p>前面有介绍过json-lib这个框架，在线博文：<a href="http://www.cnblogs.com/hoojo/archive/2011/04/21/2023805.html" target="_blank"><a href="http://www.cnblogs.com/hoojo/archive/2011/04/21/2023805.html">http://www.cnblogs.com/hoojo/archive/2011/04/21/2023805.html</a></a></p>
<p>以及Jackson这个框架，在线博文：<a href="http://www.cnblogs.com/hoojo/archive/2011/04/22/2024628.html" target="_blank"><a href="http://www.cnblogs.com/hoojo/archive/2011/04/22/2024628.html">http://www.cnblogs.com/hoojo/archive/2011/04/22/2024628.html</a></a></p>
<p>它们都完美支持JSON，但是对xml的支持还不是很好。一定程度上限制了对Java对象的描述，不能让xml完全体现到对Java对象的描述。这里将会介绍xStream对JSON、XML的完美支持。xStream不仅对XML的转换非常友好，而且提供annotation注解，可以在JavaBean中完成对xml节点、属性的描述。以及对JSON也支持，只需要提供相关的JSONDriver就可以完成转换。</p>
<p><strong>一、**</strong>准备工作<strong>**</strong></p>
<p>1、 下载jar包、及官方资源</p>
<p>xStream的jar下载地址：</p>
<p><a href="https://nexus.codehaus.org/content/repositories/releases/com/thoughtworks/xstream/xstream-distribution/1.3.1/xstream-distribution-1.3.1-bin.zip" target="_blank"><a href="https://nexus.codehaus.org/content/repositories/releases/com/thoughtworks/xstream/xstream-distribution/1.3.1/xstream-distribution-1.3.1-bin.zip">https://nexus.codehaus.org/content/repositories/releases/com/thoughtworks/xstream/xstream-distribution/1.3.1/xstream-distribution-1.3.1-bin.zip</a></a></p>
<p>官方的示例很全，官方参考示例：<a href="http://xstream.codehaus.org/tutorial.html" target="_blank"><a href="http://xstream.codehaus.org/tutorial.html">http://xstream.codehaus.org/tutorial.html</a></a></p>
<p>添加xstream-1.3.1.jar文件到工程中，就可以开始下面的工作；需要的jar如下：</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/hoojo/201104/201104221846024160.jpg" target="_blank"><img src="&quot;clip_image002&quot;" alt="clip_image002"></a></p>
<p>2、 测试用例代码
package com.hoo.test;</p>
<p>import java.io.IOException;
import java.io.ObjectInputStream;</p>
<p>import java.io.ObjectOutputStream;
import java.io.StringReader;</p>
<p>import java.io.Writer;
import java.util.ArrayList;</p>
<p>import java.util.HashMap;
import java.util.Iterator;</p>
<p>import java.util.List;
import java.util.Map;</p>
<p>import java.util.Set;
import org.codehaus.jettison.json.JSONException;</p>
<p>import org.junit.After;
import org.junit.Before;</p>
<p>import org.junit.Test;
import com.hoo.entity.Birthday;</p>
<p>import com.hoo.entity.Classes;
import com.hoo.entity.ListBean;</p>
<p>import com.hoo.entity.Student;
import com.thoughtworks.xstream.XStream;</p>
<p>import com.thoughtworks.xstream.io.HierarchicalStreamWriter;
import com.thoughtworks.xstream.io.json.JettisonMappedXmlDriver;</p>
<p>import com.thoughtworks.xstream.io.json.JsonHierarchicalStreamDriver;
import com.thoughtworks.xstream.io.json.JsonWriter;</p>
<p>//<em>/</em>
/* <b>function:</b>Java对象和XML字符串的相互转换</p>
<p>/<em> jar-lib-version: xstream-1.3.1
/</em> @author hoojo</p>
<p>/<em> @createDate Nov 27, 2010 12:15:15 PM
/</em> @file XStreamTest.java</p>
<p>/<em> @package com.hoo.test
/</em> @project WebHttpUtils</p>
<p>/<em> @blog <a href="http://blog.csdn.net/IBM_hoojo" target="_blank">http://blog.csdn.net/IBM_hoojo</a>
/</em> @email hoojo_@126.com</p>
<p>/<em> @version 1.0
/</em>/</p>
<p>@SuppressWarnings(&quot;unchecked&quot;)
public class XStreamTest {</p>
<p>private XStream xstream = null;
private ObjectOutputStream out = null;</p>
<p>private ObjectInputStream in = null;
private Student bean = null;</p>
<p>//<em>/</em>
/* <b>function:</b>初始化资源准备</p>
<p>/<em> @author hoojo
/</em> @createDate Nov 27, 2010 12:16:28 PM</p>
<p>/*/
@Before</p>
<p>public void init() {
try {</p>
<p>xstream = new XStream();
//xstream = new XStream(new DomDriver()); // 需要xpp3 jar</p>
<p>} catch (Exception e) {
e.printStackTrace();</p>
<p>}
bean = new Student();</p>
<p>bean.setAddress(&quot;china&quot;);
bean.setEmail(&quot;jack@email.com&quot;);</p>
<p>bean.setId(1);
bean.setName(&quot;jack&quot;);</p>
<p>Birthday day = new Birthday();
day.setBirthday(&quot;2010-11-22&quot;);</p>
<p>bean.setBirthday(day);
}</p>
<p>//<em>/</em>
/* <b>function:</b>释放对象资源</p>
<p>/<em> @author hoojo
/</em> @createDate Nov 27, 2010 12:16:38 PM</p>
<p>/*/
@After</p>
<p>public void destory() {
xstream = null;</p>
<p>bean = null;
try {</p>
<p>if (out != null) {
out.flush();</p>
<p>out.close();
}</p>
<p>if (in != null) {
in.close();</p>
<p>}
} catch (IOException e) {</p>
<p>e.printStackTrace();
}</p>
<p>System.gc();
}</p>
<p>public final void fail(String string) {
System.out.println(string);</p>
<p>}
public final void failRed(String string) {</p>
<p>System.err.println(string);
}</p>
<p>}</p>
<p>通过XStream对象的toXML方法就可以完成Java对象到XML的转换，toXML方法还有2个相同签名的方法，需要传递一个流。然后通过流来完成xml信息的输出。</p>
<p>3、 需要的JavaBean
package com.hoo.entity;</p>
<p>public class Student {
private int id;</p>
<p>private String name;
private String email;</p>
<p>private String address;
private Birthday birthday;</p>
<p>//getter、setter
public String toString() {</p>
<p>return this.name + &quot;/#&quot; + this.id + &quot;/#&quot; + this.address + &quot;/#&quot; + this.birthday + &quot;/#&quot; + this.email;
}</p>
<p>}</p>
<hr>
<p><strong>二、**</strong>Java<strong><strong>转换成</strong></strong>XML**</p>
<p>1、 JavaBean转换XM
//<em>/</em></p>
<p>/<em> <b>function:</b>Java对象转换成XML字符串
/</em> @author hoojo</p>
<p>/<em> @createDate Nov 27, 2010 12:19:01 PM
/</em>/</p>
<p>@Test
public void writeBean2XML() {</p>
<p>try {
fail(&quot;------------Bean-&gt;XML------------&quot;);</p>
<p>fail(xstream.toXML(bean));
fail(&quot;重命名后的XML&quot;);</p>
<p>//类重命名
//xstream.alias(&quot;account&quot;, Student.class);</p>
<p>//xstream.alias(&quot;生日&quot;, Birthday.class);
//xstream.aliasField(&quot;生日&quot;, Student.class, &quot;birthday&quot;);</p>
<p>//xstream.aliasField(&quot;生日&quot;, Birthday.class, &quot;birthday&quot;);
//fail(xstream.toXML(bean));</p>
<p>//属性重命名
xstream.aliasField(&quot;邮件&quot;, Student.class, &quot;email&quot;);</p>
<p>//包重命名
xstream.aliasPackage(&quot;hoo&quot;, &quot;com.hoo.entity&quot;);</p>
<p>fail(xstream.toXML(bean));
} catch (Exception e) {</p>
<p>e.printStackTrace();
}</p>
<p>}</p>
<p>看结果中的第一份xml内容，是没有经过然后修改或重命名的文档，按照原样输出。文档中的第二份文档的package经过重命名，email属性也经过重命名以及类名也可以进行重命名的。</p>
<p>运行后结果如下：
------------Bean-&gt;XML------------</p>
<p><com.hoo.entity.Student></p>
<id>1</id>

<name>jack</name>
<email>jack@email.com</email>

<address>china</address>
<birthday>

<birthday>2010-11-22</birthday>
</birthday>

</com.hoo.entity.Student>
重命名后的XML

<hoo.Student>
<id>1</id>

<name>jack</name>
&lt;邮件&gt;jack@email.com&lt;/邮件&gt;

<address>china</address>
<birthday>

<birthday>2010-11-22</birthday>
</birthday>

</hoo.Student>

2、 将List集合转换成xml文档

//<em>/</em>

/<em> <b>function:</b>将Java的List集合转换成XML对象
/</em> @author hoojo

/<em> @createDate Nov 27, 2010 12:20:07 PM
/</em>/

@Test
public void writeList2XML() {

try {
//修改元素名称

xstream.alias(&quot;beans&quot;, ListBean.class);
xstream.alias(&quot;student&quot;, Student.class);

fail(&quot;----------List--&gt;XML----------&quot;);
ListBean listBean = new ListBean();

listBean.setName(&quot;this is a List Collection&quot;);
List<Object> list = new ArrayList<Object>();

list.add(bean);
list.add(bean);//引用bean

//list.add(listBean);//引用listBean，父元素
bean = new Student();

bean.setAddress(&quot;china&quot;);
bean.setEmail(&quot;tom@125.com&quot;);

bean.setId(2);
bean.setName(&quot;tom&quot;);

Birthday day = new Birthday(&quot;2010-11-22&quot;);
bean.setBirthday(day);

list.add(bean);
listBean.setList(list);

//将ListBean中的集合设置空元素，即不显示集合元素标签
//xstream.addImplicitCollection(ListBean.class, &quot;list&quot;);

//设置reference模型
//xstream.setMode(XStream.NO_REFERENCES);//不引用

xstream.setMode(XStream.ID_REFERENCES);//id引用
//xstream.setMode(XStream.XPATH_ABSOLUTE_REFERENCES);//绝对路径引用

//将name设置为父类（Student）的元素的属性
xstream.useAttributeFor(Student.class, &quot;name&quot;);

xstream.useAttributeFor(Birthday.class, &quot;birthday&quot;);
//修改属性的name

xstream.aliasAttribute(&quot;姓名&quot;, &quot;name&quot;);
xstream.aliasField(&quot;生日&quot;, Birthday.class, &quot;birthday&quot;);

fail(xstream.toXML(listBean));
} catch (Exception e) {

e.printStackTrace();
}

}

上面的代码运行后，结果如下：

----------List--&gt;XML----------

<beans id="1">
<name>this is a List Collection</name>

<p><list id="2"></p>
<student id="3" 姓名="jack">

<id>1</id>
<email>jack@email.com</email>

<address>china</address>
<birthday id="4" 生日="2010-11-22"/>

</student>
<student reference="3"/>

<student id="5" 姓名="tom">
<id>2</id>

<email>tom@125.com</email>
<address>china</address>

<birthday id="6" 生日="2010-11-22"/>
</student>

<p></list>
</beans></p>
<p>如果不加xstream.addImplicitCollection(ListBean.<strong>class</strong>, &quot;list&quot;);</p>
<p>这个设置的话，会出现一个List节点包裹着Student节点元素。添加addImplicitCollection可以忽略这个list节点元素。那么上面的list节点就不存在，只会在beans元素中出现name、student这2个xml元素标签；</p>
<p>setMode是设置相同的对象的引用方式，如果设置XStream.NO_REFERENCES就是不引用，会输出2分相同的Student元素。如果是XStream.ID_REFERENCES会引用相同的那个对象的id属性，如果是XStream.XPATH_ABSOLUTE_REFERENCES引用，那么它将显示xpath路径。上面采用的id引用，<student reference="3"/>这个引用了id=3的那个student标签元素；</p>
<p>useAttributeFor是设置某个节点显示到父节点的属性中，也就是将指定class中的指定属性，在这个class元素节点的属性中显示。</p>
<p>如：<student><name>hoojo</name></student></p>
<p>设置好后就是这样的结果：<student name=”hoojo”></student></p>
<p>aliasAttribute是修改属性名称。</p>
<p>3、 在JavaBean中添加Annotation注解进行重命名设置</p>
<p>先看看JavaBean的代码
package com.hoo.entity;</p>
<p>import java.util.Arrays;
import java.util.Calendar;</p>
<p>import java.util.GregorianCalendar;
import java.util.List;</p>
<p>import com.thoughtworks.xstream.annotations.XStreamAlias;
import com.thoughtworks.xstream.annotations.XStreamAsAttribute;</p>
<p>import com.thoughtworks.xstream.annotations.XStreamConverter;
import com.thoughtworks.xstream.annotations.XStreamImplicit;</p>
<p>import com.thoughtworks.xstream.annotations.XStreamOmitField;
@XStreamAlias(&quot;class&quot;)</p>
<p>public class Classes {
//*</p>
<p>/<em> 设置属性显示
/</em>/</p>
<p>@XStreamAsAttribute
@XStreamAlias(&quot;名称&quot;)</p>
<p>private String name;
//*</p>
<p>/<em> 忽略
/</em>/</p>
<p>@XStreamOmitField
private int number;</p>
<p>@XStreamImplicit(itemFieldName = &quot;Students&quot;)
private List<Student> students;</p>
<p>@SuppressWarnings(&quot;unused&quot;)
@XStreamConverter(SingleValueCalendarConverter.class)</p>
<p>private Calendar created = new GregorianCalendar();
public Classes(){}</p>
<p>public Classes(String name, Student... stu) {
this.name = name;</p>
<p>this.students = Arrays.asList(stu);
}</p>
<p>//getter、setter
}</p>
<p>SingleValueCalendarConverter.java这个是一个类型转换器</p>
<p>package com.hoo.entity;</p>
<p>import java.util.Calendar;
import java.util.Date;</p>
<p>import java.util.GregorianCalendar;
import com.thoughtworks.xstream.converters.Converter;</p>
<p>import com.thoughtworks.xstream.converters.MarshallingContext;
import com.thoughtworks.xstream.converters.UnmarshallingContext;</p>
<p>import com.thoughtworks.xstream.io.HierarchicalStreamReader;
import com.thoughtworks.xstream.io.HierarchicalStreamWriter;</p>
<p>public class SingleValueCalendarConverter implements Converter {
public void marshal(Object source, HierarchicalStreamWriter writer,</p>
<p>MarshallingContext context) {
Calendar calendar = (Calendar) source;</p>
<p>writer.setValue(String.valueOf(calendar.getTime().getTime()));
}</p>
<p>public Object unmarshal(HierarchicalStreamReader reader,
UnmarshallingContext context) {</p>
<p>GregorianCalendar calendar = new GregorianCalendar();
calendar.setTime(new Date(Long.parseLong(reader.getValue())));</p>
<p>return calendar;
}</p>
<p>@SuppressWarnings(&quot;unchecked&quot;)
public boolean canConvert(Class type) {</p>
<p>return type.equals(GregorianCalendar.class);
}</p>
<p>}</p>
<p>再看看测试用例代码</p>
<p>@Test</p>
<p>public void writeList2XML4Annotation() {
try {</p>
<p>failRed(&quot;---------annotation Bean --&gt; XML---------&quot;);
Student stu = new Student();</p>
<p>stu.setName(&quot;jack&quot;);
Classes c = new Classes(&quot;一班&quot;, bean, stu);</p>
<p>c.setNumber(2);
//对指定的类使用Annotation</p>
<p>//xstream.processAnnotations(Classes.class);
//启用Annotation</p>
<p>//xstream.autodetectAnnotations(true);
xstream.alias(&quot;student&quot;, Student.class);</p>
<p>fail(xstream.toXML(c));
} catch (Exception e) {</p>
<p>e.printStackTrace();
}</p>
<p>}</p>
<p>当启用annotation或是对某个特定的类启用annotation时，上面的classes这个类才有效果。如果不启用annotation，运行后结果如下：</p>
<p>---------annotation Bean --&gt; XML---------</p>
<p><com.hoo.entity.Classes></p>
<name>一班</name>

<p><number>2</number></p>
<students class="java.util.Arrays$ArrayList">

<a class="student-array">
<student>

<id>1</id>
<name>jack</name>

<email>jack@email.com</email>
<address>china</address>

<birthday>
<birthday>2010-11-22</birthday>

</birthday>
</student>

<student>
<id>0</id>

<name>jack</name>
</student>

</a>
</students>

<created>
<time>1303292056718</time>

<timezone>Asia/Shanghai</timezone>
</created>

<p></com.hoo.entity.Classes></p>
<p>当启用annotation后xstream.processAnnotations(Classes.class)，结果如下：</p>
<p>---------annotation Bean --&gt; XML---------</p>
<class 名称="一班">
<Students>

<id>1</id>
<name>jack</name>

<email>jack@email.com</email>
<address>china</address>

<birthday>
<birthday>2010-11-22</birthday>

</birthday>
</Students>

<Students>
<id>0</id>

<name>jack</name>
</Students>

<created>1303292242937</created>
</class>

<p>4、 Map集合转换xml文档</p>
<p>//<em>/</em></p>
<p>/<em> <b>function:</b>Java Map集合转XML
/</em> @author hoojo</p>
<p>/<em> @createDate Nov 27, 2010 1:13:26 PM
/</em>/</p>
<p>@Test
public void writeMap2XML() {</p>
<p>try {
failRed(&quot;---------Map --&gt; XML---------&quot;);</p>
<p>Map<String, Student> map = new HashMap<String, Student>();
map.put(&quot;No.1&quot;, bean);//put</p>
<p>bean = new Student();
bean.setAddress(&quot;china&quot;);</p>
<p>bean.setEmail(&quot;tom@125.com&quot;);
bean.setId(2);</p>
<p>bean.setName(&quot;tom&quot;);
Birthday day = new Birthday(&quot;2010-11-22&quot;);</p>
<p>bean.setBirthday(day);
map.put(&quot;No.2&quot;, bean);//put</p>
<p>bean = new Student();
bean.setName(&quot;jack&quot;);</p>
<p>map.put(&quot;No.3&quot;, bean);//put
xstream.alias(&quot;student&quot;, Student.class);</p>
<p>xstream.alias(&quot;key&quot;, String.class);
xstream.useAttributeFor(Student.class, &quot;id&quot;);</p>
<p>xstream.useAttributeFor(&quot;birthday&quot;, String.class);
fail(xstream.toXML(map));</p>
<p>} catch (Exception e) {
e.printStackTrace();</p>
<p>}
}</p>
<p>运行后结果如下：</p>
<p>---------Map --&gt; XML---------</p>
<map>
<entry>

<key>No.3</key>
<student id="0">

<name>jack</name>
</student>

</entry>
<entry>

<key>No.1</key>
<student id="1">

<name>jack</name>
<email>jack@email.com</email>

<address>china</address>
<birthday birthday="2010-11-22"/>

</student>
</entry>

<entry>
<key>No.2</key>

<student id="2">
<name>tom</name>

<email>tom@125.com</email>
<address>china</address>

<birthday birthday="2010-11-22"/>
</student>

</entry>
</map>

<p>5、 用OutStream输出流写XML</p>
<p>//<em>/</em></p>
<p>/<em> <b>function:</b>用OutStream输出流写XML
/</em> @author hoojo</p>
<p>/<em> @createDate Nov 27, 2010 1:13:48 PM
/</em>/</p>
<p>@Test
public void writeXML4OutStream() {</p>
<p>try {
out = xstream.createObjectOutputStream(System.out);</p>
<p>Student stu = new Student();
stu.setName(&quot;jack&quot;);</p>
<p>Classes c = new Classes(&quot;一班&quot;, bean, stu);
c.setNumber(2);</p>
<p>failRed(&quot;---------ObjectOutputStream /# JavaObject--&gt; XML---------&quot;);
out.writeObject(stu);</p>
<p>out.writeObject(new Birthday(&quot;2010-05-33&quot;));
out.write(22);//byte</p>
<p>out.writeBoolean(true);
out.writeFloat(22.f);</p>
<p>out.writeUTF(&quot;hello&quot;);
} catch (Exception e) {</p>
<p>e.printStackTrace();
}</p>
<p>}</p>
<p>使用输出流后，可以通过流对象完成xml的构建，即使没有JavaBean对象，你可以用流来构建一个复杂的xml文档，运行后结果如下：</p>
<p>---------ObjectOutputStream /# JavaObject--&gt; XML---------</p>
<p><object-stream></p>
<com.hoo.entity.Student>

<p><id>0</id></p>
<name>jack</name>

<p></com.hoo.entity.Student></p>
<com.hoo.entity.Birthday>

<p><birthday>2010-05-33</birthday>
</com.hoo.entity.Birthday></p>
<p><byte>22</byte></p>
<boolean>true</boolean>

<p><float>22.0</float></p>
<string>hello</string>

<p></object-stream></p>
<hr>
<p><strong>三、**</strong>XML<strong><strong>内容转换</strong></strong>Java<strong><strong>对象**</strong></strong></p>
<p>1、 用InputStream将XML文档转换成java对象
//<em>/</em></p>
<p>/<em> <b>function:</b>用InputStream将XML文档转换成java对象
/</em> 需要额外的jar xpp3-main.jar</p>
<p>/<em> @author hoojo
/</em> @createDate Nov 27, 2010 1:14:52 PM</p>
<p>/*/
@Test</p>
<p>public void readXML4InputStream() {
try {</p>
<p>String s = &quot;<object-stream><com.hoo.entity.Student><id>0</id><name>jack</name>&quot; +
&quot;</com.hoo.entity.Student><com.hoo.entity.Birthday><birthday>2010-05-33</birthday>&quot; +</p>
<p>&quot;</com.hoo.entity.Birthday><byte>22</byte><boolean>true</boolean><float>22.0</float>&quot; +
&quot;<string>hello</string></object-stream>&quot;;</p>
<p>failRed(&quot;---------ObjectInputStream/#/# XML --&gt; javaObject---------&quot;);
StringReader reader = new StringReader(s);</p>
<p>in = xstream.createObjectInputStream(reader);
Student stu = (Student) in.readObject();</p>
<p>Birthday b = (Birthday) in.readObject();
byte i = in.readByte();</p>
<p>boolean bo = in.readBoolean();
float f = in.readFloat();</p>
<p>String str = in.readUTF();
System.out.println(stu);</p>
<p>System.out.println(b);
System.out.println(i);</p>
<p>System.out.println(bo);
System.out.println(f);</p>
<p>System.out.println(str);
} catch (Exception e) {</p>
<p>e.printStackTrace();
}</p>
<p>}</p>
<p>读取后，转换的Java对象，结果如下：</p>
<p>---------ObjectInputStream/#/# XML --&gt; javaObject---------</p>
<p>jack/#0/#null/#null/#null
2010-05-33</p>
<p>22
true</p>
<p>22.0
hello</p>
<p>2、 将xml文档转换成Java对象</p>
<p>//<em>/</em></p>
<p>/<em> <b>function:</b>将XML字符串转换成Java对象
/</em> @author hoojo</p>
<p>/<em> @createDate Nov 27, 2010 2:39:06 PM
/</em>/</p>
<p>@Test
public void readXml2Object() {</p>
<p>try {
failRed(&quot;-----------Xml &gt;&gt;&gt; Bean--------------&quot;);</p>
<p>Student stu = (Student) xstream.fromXML(xstream.toXML(bean));
fail(stu.toString());</p>
<p>List<Student> list = new ArrayList<Student>();
list.add(bean);//add</p>
<p>Map<String, Student> map = new HashMap<String, Student>();
map.put(&quot;No.1&quot;, bean);//put</p>
<p>bean = new Student();
bean.setAddress(&quot;china&quot;);</p>
<p>bean.setEmail(&quot;tom@125.com&quot;);
bean.setId(2);</p>
<p>bean.setName(&quot;tom&quot;);
Birthday day = new Birthday(&quot;2010-11-22&quot;);</p>
<p>bean.setBirthday(day);
list.add(bean);//add</p>
<p>map.put(&quot;No.2&quot;, bean);//put
bean = new Student();</p>
<p>bean.setName(&quot;jack&quot;);
list.add(bean);//add</p>
<p>map.put(&quot;No.3&quot;, bean);//put
failRed(&quot;==========XML &gt;&gt;&gt; List===========&quot;);</p>
<p>List<Student> studetns = (List<Student>) xstream.fromXML(xstream.toXML(list));
fail(&quot;size:&quot; + studetns.size());//3</p>
<p>for (Student s : studetns) {
fail(s.toString());</p>
<p>}
failRed(&quot;==========XML &gt;&gt;&gt; Map===========&quot;);</p>
<p>Map<String, Student> maps = (Map<String, Student>) xstream.fromXML(xstream.toXML(map));
fail(&quot;size:&quot; + maps.size());//3</p>
<p>Set<String> key = maps.keySet();
Iterator<String> iter = key.iterator();</p>
<p>while (iter.hasNext()) {
String k = iter.next();</p>
<p>fail(k + &quot;:&quot; + map.get(k));
}</p>
<p>} catch (Exception e) {
e.printStackTrace();</p>
<p>}
}</p>
<p>运行后结果如下：</p>
<p>-----------Xml &gt;&gt;&gt; Bean--------------</p>
<p>jack/#1/#china/#2010-11-22/#jack@email.com
==========XML &gt;&gt;&gt; List===========</p>
<p>size:3
jack/#1/#china/#2010-11-22/#jack@email.com</p>
<p>tom/#2/#china/#2010-11-22/#tom@125.com
jack/#0/#null/#null/#null</p>
<p>==========XML &gt;&gt;&gt; Map===========
size:3</p>
<p>No.3:jack/#0/#null/#null/#null
No.1:jack/#1/#china/#2010-11-22/#jack@email.com</p>
<p>No.2:tom/#2/#china/#2010-11-22/#tom@125.com</p>
<p>怎么样，成功的完成XML到JavaBean、List、Map的转换，更多对象转换还需要大家一一尝试。用法类似~这里就不一样赘述。</p>
<p><strong>四、**</strong>XStream<strong><strong>对</strong></strong>JSON<strong><strong>的支持**</strong></strong></p>
<p>xStream对JSON也有非常好的支持，它提供了2个模型驱动。用这2个驱动可以完成Java对象到JSON的相互转换。使用JettisonMappedXmlDriver驱动，将Java对象转换成json，需要添加jettison.jar</p>
<p>1、 用JettisonMappedXmlDriver完成Java对象到JSON的转换
//<em>/</em></p>
<p>/<em> <b>function:</b>XStream结合JettisonMappedXmlDriver驱动，转换Java对象到JSON
/</em> 需要添加jettison jar</p>
<p>/<em> @author hoojo
/</em> @createDate Nov 27, 2010 1:23:18 PM</p>
<p>/*/
@Test</p>
<p>public void writeEntity2JETTSON() {
failRed(&quot;=======JettisonMappedXmlDriver===JavaObject &gt;&gt;&gt;&gt; JaonString=========&quot;);</p>
<p>xstream = new XStream(new JettisonMappedXmlDriver());
xstream.setMode(XStream.NO_REFERENCES);</p>
<p>xstream.alias(&quot;student&quot;, Student.class);
fail(xstream.toXML(bean));</p>
<p>}</p>
<p>运行后结果如下：</p>
<p>=======JettisonMappedXmlDriver===JavaObject &gt;&gt;&gt;&gt; JaonString=========</p>
<p>{&quot;student&quot;:{&quot;id&quot;:1,&quot;name&quot;:&quot;jack&quot;,&quot;email&quot;:&quot;jack@email.com&quot;,&quot;address&quot;:&quot;china&quot;,&quot;birthday&quot;:[{},&quot;2010-11-22&quot;]}}</p>
<p>JSON的转换和XML的转换用法一样，只是创建XStream需要传递一个参数，这个参数就是xml到JSON映射转换的驱动。这里会降到两个驱动，分别是JettisonMappedXmlDriver、JsonHierarchicalStreamDriver。</p>
<p>2、 JsonHierarchicalStreamDriver完成Java对象到JSON的转换
//<em>/</em></p>
<p>/<em> <b>function:</b>用XStream结合JsonHierarchicalStreamDriver驱动
/</em> 转换java对象为JSON字符串</p>
<p>/<em> @author hoojo
/</em> @createDate Nov 27, 2010 1:16:46 PM</p>
<p>/*/
@Test</p>
<p>public void writeEntiry2JSON() {
failRed(&quot;======JsonHierarchicalStreamDriver====JavaObject &gt;&gt;&gt;&gt; JaonString=========&quot;);</p>
<p>xstream = new XStream(new JsonHierarchicalStreamDriver());
//xstream.setMode(XStream.NO_REFERENCES);</p>
<p>xstream.alias(&quot;student&quot;, Student.class);
failRed(&quot;-------Object &gt;&gt;&gt;&gt; JSON---------&quot;);</p>
<p>fail(xstream.toXML(bean));
//failRed(&quot;========JsonHierarchicalStreamDriver==删除根节点=========&quot;);</p>
<p>//删除根节点
xstream = new XStream(new JsonHierarchicalStreamDriver() {</p>
<p>public HierarchicalStreamWriter createWriter(Writer out) {
return new JsonWriter(out, JsonWriter.DROP_ROOT_MODE);</p>
<p>}
});</p>
<p>//xstream.setMode(XStream.NO_REFERENCES);
xstream.alias(&quot;student&quot;, Student.class);</p>
<p>fail(xstream.toXML(bean));
}</p>
<p>运行后结果如下：</p>
<p>======JsonHierarchicalStreamDriver====JavaObject &gt;&gt;&gt;&gt; JaonString=========</p>
<p>-------Object &gt;&gt;&gt;&gt; JSON---------
{&quot;student&quot;: {</p>
<p>&quot;id&quot;: 1,
&quot;name&quot;: &quot;jack&quot;,</p>
<p>&quot;email&quot;: &quot;jack@email.com&quot;,
&quot;address&quot;: &quot;china&quot;,</p>
<p>&quot;birthday&quot;: {
&quot;birthday&quot;: &quot;2010-11-22&quot;</p>
<p>}
}}</p>
<p>{
&quot;id&quot;: 1,</p>
<p>&quot;name&quot;: &quot;jack&quot;,
&quot;email&quot;: &quot;jack@email.com&quot;,</p>
<p>&quot;address&quot;: &quot;china&quot;,
&quot;birthday&quot;: {</p>
<p>&quot;birthday&quot;: &quot;2010-11-22&quot;
}</p>
<p>}</p>
<p>使用JsonHierarchicalStreamDriver转换默认会给转换后的对象添加一个根节点，但是在构建JsonHierarchicalStreamDriver驱动的时候，你可以重写createWriter方法，删掉根节点。</p>
<p>看上面的结果，一个是默认带根节点的JSON对象，它只是将类名作为一个属性，将对象作为该属性的一个值。而另一个没有带根属性的JSON就是通过重写createWriter方法完成的。</p>
<p>3、 将List集合转换成JSON字符串
@Test</p>
<p>public void writeList2JSON() {
failRed(&quot;======JsonHierarchicalStreamDriver====JavaObject &gt;&gt;&gt;&gt; JaonString=========&quot;);</p>
<p>JsonHierarchicalStreamDriver driver = new JsonHierarchicalStreamDriver();
xstream = new XStream(driver);</p>
<p>//xstream = new XStream(new JettisonMappedXmlDriver());//转换错误
//xstream.setMode(XStream.NO_REFERENCES);</p>
<p>xstream.alias(&quot;student&quot;, Student.class);
List<Student> list = new ArrayList<Student>();</p>
<p>list.add(bean);//add
bean = new Student();</p>
<p>bean.setAddress(&quot;china&quot;);
bean.setEmail(&quot;tom@125.com&quot;);</p>
<p>bean.setId(2);
bean.setName(&quot;tom&quot;);</p>
<p>Birthday day = new Birthday(&quot;2010-11-22&quot;);
bean.setBirthday(day);</p>
<p>list.add(bean);//add
bean = new Student();</p>
<p>bean.setName(&quot;jack&quot;);
list.add(bean);//add</p>
<p>fail(xstream.toXML(list));
//failRed(&quot;========JsonHierarchicalStreamDriver==删除根节点=========&quot;);</p>
<p>//删除根节点
xstream = new XStream(new JsonHierarchicalStreamDriver() {</p>
<p>public HierarchicalStreamWriter createWriter(Writer out) {
return new JsonWriter(out, JsonWriter.DROP_ROOT_MODE);</p>
<p>}
});</p>
<p>xstream.alias(&quot;student&quot;, Student.class);
fail(xstream.toXML(list));</p>
<p>}</p>
<p>运行后结果如下</p>
<p>======JsonHierarchicalStreamDriver====JavaObject &gt;&gt;&gt;&gt; JaonString=========</p>
<p>/#/#{&quot;list&quot;: [
{</p>
<p>&quot;id&quot;: 1,
&quot;name&quot;: &quot;jack&quot;,</p>
<p>&quot;email&quot;: &quot;jack@email.com&quot;,
&quot;address&quot;: &quot;china&quot;,</p>
<p>&quot;birthday&quot;: {
&quot;birthday&quot;: &quot;2010-11-22&quot;</p>
<p>}
},</p>
<p>{
&quot;id&quot;: 2,</p>
<p>&quot;name&quot;: &quot;tom&quot;,
&quot;email&quot;: &quot;tom@125.com&quot;,</p>
<p>&quot;address&quot;: &quot;china&quot;,
&quot;birthday&quot;: {</p>
<p>&quot;birthday&quot;: &quot;2010-11-22&quot;
}</p>
<p>},
{</p>
<p>&quot;id&quot;: 0,
&quot;name&quot;: &quot;jack&quot;</p>
<p>}
]}</p>
<p>/#[
{</p>
<p>&quot;id&quot;: 1,
&quot;name&quot;: &quot;jack&quot;,</p>
<p>&quot;email&quot;: &quot;jack@email.com&quot;,
&quot;address&quot;: &quot;china&quot;,</p>
<p>&quot;birthday&quot;: {
&quot;birthday&quot;: &quot;2010-11-22&quot;</p>
<p>}
},</p>
<p>{
&quot;id&quot;: 2,</p>
<p>&quot;name&quot;: &quot;tom&quot;,
&quot;email&quot;: &quot;tom@125.com&quot;,</p>
<p>&quot;address&quot;: &quot;china&quot;,
&quot;birthday&quot;: {</p>
<p>&quot;birthday&quot;: &quot;2010-11-22&quot;
}</p>
<p>},
{</p>
<p>&quot;id&quot;: 0,
&quot;name&quot;: &quot;jack&quot;</p>
<p>}
]</p>
<p>上面的list1是使用JsonHierarchicalStreamDriver 转换的，当然你也可以使用JettisonMappedXmlDriver驱动进行转换；用JettisonMappedXmlDriver转换后，你会发现格式不同而且没有根属性。</p>
<p>4、 Map转换json
@Test</p>
<p>public void writeMap2JSON() {
failRed(&quot;======JsonHierarchicalStreamDriver==== Map &gt;&gt;&gt;&gt; JaonString=========&quot;);</p>
<p>xstream = new XStream(new JsonHierarchicalStreamDriver());
//xstream = new XStream(new JettisonMappedXmlDriver());</p>
<p>xstream.alias(&quot;student&quot;, Student.class);
Map<String, Student> map = new HashMap<String, Student>();</p>
<p>map.put(&quot;No.1&quot;, bean);//put
bean = new Student();</p>
<p>bean.setAddress(&quot;china&quot;);
bean.setEmail(&quot;tom@125.com&quot;);</p>
<p>bean.setId(2);
bean.setName(&quot;tom&quot;);</p>
<p>bean.setBirthday(new Birthday(&quot;2010-11-21&quot;));
map.put(&quot;No.2&quot;, bean);//put</p>
<p>bean = new Student();
bean.setName(&quot;jack&quot;);</p>
<p>map.put(&quot;No.3&quot;, bean);//put
fail(xstream.toXML(map));</p>
<p>//failRed(&quot;========JsonHierarchicalStreamDriver==删除根节点=========&quot;);
//删除根节点</p>
<p>xstream = new XStream(new JsonHierarchicalStreamDriver() {
public HierarchicalStreamWriter createWriter(Writer out) {</p>
<p>return new JsonWriter(out, JsonWriter.DROP_ROOT_MODE);
}</p>
<p>});
xstream.alias(&quot;student&quot;, Student.class);</p>
<p>fail(xstream.toXML(map));
}</p>
<p>运行后结果如下：</p>
<p>======JsonHierarchicalStreamDriver==== Map &gt;&gt;&gt;&gt; JaonString=========</p>
<p>{&quot;map&quot;: [
[</p>
<p>&quot;No.3&quot;,
{</p>
<p>&quot;id&quot;: 0,
&quot;name&quot;: &quot;jack&quot;</p>
<p>}
],</p>
<p>[
&quot;No.1&quot;,</p>
<p>{
&quot;id&quot;: 1,</p>
<p>&quot;name&quot;: &quot;jack&quot;,
&quot;email&quot;: &quot;jack@email.com&quot;,</p>
<p>&quot;address&quot;: &quot;china&quot;,
&quot;birthday&quot;: {</p>
<p>&quot;birthday&quot;: &quot;2010-11-22&quot;
}</p>
<p>}
],</p>
<p>[
&quot;No.2&quot;,</p>
<p>{
&quot;id&quot;: 2,</p>
<p>&quot;name&quot;: &quot;tom&quot;,
&quot;email&quot;: &quot;tom@125.com&quot;,</p>
<p>&quot;address&quot;: &quot;china&quot;,
&quot;birthday&quot;: {</p>
<p>&quot;birthday&quot;: &quot;2010-11-21&quot;
}</p>
<p>}
]</p>
<p>]}
[</p>
<p>[
&quot;No.3&quot;,</p>
<p>{
&quot;id&quot;: 0,</p>
<p>&quot;name&quot;: &quot;jack&quot;
}</p>
<p>],
[</p>
<p>&quot;No.1&quot;,
{</p>
<p>&quot;id&quot;: 1,
&quot;name&quot;: &quot;jack&quot;,</p>
<p>&quot;email&quot;: &quot;jack@email.com&quot;,
&quot;address&quot;: &quot;china&quot;,</p>
<p>&quot;birthday&quot;: {
&quot;birthday&quot;: &quot;2010-11-22&quot;</p>
<p>}
}</p>
<p>],
[</p>
<p>&quot;No.2&quot;,
{</p>
<p>&quot;id&quot;: 2,
&quot;name&quot;: &quot;tom&quot;,</p>
<p>&quot;email&quot;: &quot;tom@125.com&quot;,
&quot;address&quot;: &quot;china&quot;,</p>
<p>&quot;birthday&quot;: {
&quot;birthday&quot;: &quot;2010-11-21&quot;</p>
<p>}
}</p>
<p>]
]</p>
<p>5、 将JSON转换java对象</p>
<p>//<em>/</em></p>
<p>/<em> <b>function:</b>JsonHierarchicalStreamDriver可以将简单的json字符串转换成java对象，list、map转换不成功；
/</em> JsonHierarchicalStreamDriver读取JSON字符串到java对象出错</p>
<p>/<em> @author hoojo
/</em> @createDate Nov 27, 2010 1:22:26 PM</p>
<p>/<em> @throws JSONException
/</em>/</p>
<p>@Test
public void readJSON2Object() throws JSONException {</p>
<p>String json = &quot;{\&quot;student\&quot;: {&quot; +
&quot;\&quot;id\&quot;: 1,&quot; +</p>
<p>&quot;\&quot;name\&quot;: \&quot;haha\&quot;,&quot; +
&quot;\&quot;email\&quot;: \&quot;email\&quot;,&quot; +</p>
<p>&quot;\&quot;address\&quot;: \&quot;address\&quot;,&quot; +
&quot;\&quot;birthday\&quot;: {&quot; +</p>
<p>&quot;\&quot;birthday\&quot;: \&quot;2010-11-22\&quot;&quot; +
&quot;}&quot; +</p>
<p>&quot;}}&quot;;
//JsonHierarchicalStreamDriver读取JSON字符串到java对象出错，但JettisonMappedXmlDriver可以</p>
<p>xstream = new XStream(new JettisonMappedXmlDriver());
xstream.alias(&quot;student&quot;, Student.class);</p>
<p>fail(xstream.fromXML(json).toString());
//JettisonMappedXmlDriver转换List集合出错，但JsonHierarchicalStreamDriver可以转换正确</p>
<p>//JettisonMappedXmlDriver 转换的字符串 {&quot;list&quot;:{&quot;student&quot;:[{&quot;id&quot;:1,&quot;name&quot;:&quot;haha&quot;,&quot;email&quot;:&quot;email&quot;,&quot;address&quot;:&quot;address&quot;,&quot;birthday&quot;:[{},&quot;2010-11-22&quot;]}]},&quot;student&quot;:{&quot;id&quot;:2,&quot;name&quot;:&quot;tom&quot;,&quot;email&quot;:&quot;tom@125.com&quot;,&quot;address&quot;:&quot;china&quot;,&quot;birthday&quot;:[{},&quot;2010-11-22&quot;]}}
json = &quot;{\&quot;list\&quot;: [{&quot; +</p>
<p>&quot;\&quot;id\&quot;: 1,&quot; +
&quot;\&quot;name\&quot;: \&quot;haha\&quot;,&quot; +</p>
<p>&quot;\&quot;email\&quot;: \&quot;email\&quot;,&quot; +
&quot;\&quot;address\&quot;: \&quot;address\&quot;,&quot; +</p>
<p>&quot;\&quot;birthday\&quot;: {&quot; +
&quot;\&quot;birthday\&quot;: \&quot;2010-11-22\&quot;&quot; +</p>
<p>&quot;}&quot; +
&quot;},{&quot; +</p>
<p>&quot;\&quot;id\&quot;: 2,&quot; +
&quot;\&quot;name\&quot;: \&quot;tom\&quot;,&quot; +</p>
<p>&quot;\&quot;email\&quot;: \&quot;tom@125.com\&quot;,&quot; +
&quot;\&quot;address\&quot;: \&quot;china\&quot;,&quot; +</p>
<p>&quot;\&quot;birthday\&quot;: {&quot; +
&quot;\&quot;birthday\&quot;: \&quot;2010-11-22\&quot;&quot; +</p>
<p>&quot;}&quot; +
&quot;}]}&quot;;</p>
<p>System.out.println(json);//用js转换成功
List list = (List) xstream.fromXML(json);</p>
<p>System.out.println(list.size());//0好像转换失败
}</p>
<p>运行后结果如下：</p>
<p>haha/#1/#address/#2010-11-22/#email</p>
<p>{&quot;list&quot;: [{&quot;id&quot;: 1,&quot;name&quot;: &quot;haha&quot;,&quot;email&quot;: &quot;email&quot;,&quot;address&quot;: &quot;address&quot;,&quot;birthday&quot;: {&quot;birthday&quot;: &quot;2010-11-22&quot;}},
{&quot;id&quot;: 2,&quot;name&quot;: &quot;tom&quot;,&quot;email&quot;: &quot;tom@125.com&quot;,&quot;address&quot;: &quot;china&quot;,&quot;birthday&quot;: {&quot;birthday&quot;: &quot;2010-11-22&quot;}}]}</p>
<p>0</p>
<p>JSON到Java的转换是fromXML方法。</p>
<p>作者：<a href="http://hoojo.cnblogs.com/" target="_blank">hoojo</a>
出处：<a href="http://hoojo.cnblogs.com/" target="_blank"><a href="http://www.cnblogs.com/hoojo/archive/2011/04/22/2025197.html">http://www.cnblogs.com/hoojo/archive/2011/04/22/2025197.html</a></a>
blog：<a href="http://blog.csdn.net/IBM_hoojo/" target="_blank"><a href="http://blog.csdn.net/IBM_hoojo">http://blog.csdn.net/IBM_hoojo</a></a>
本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。
<a href="http://hoojo.cnblogs.com/" target="_blank">版权所有，转载请注明出处</a> <a href="http://hoojo.cnblogs.com/" target="_blank">本文出自：  <a href="http://www.cnblogs.com/hoojo/archive/2011/04/22/2025197.html">http://www.cnblogs.com/hoojo/archive/2011/04/22/2025197.html</a></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/xml/">xml</a></li></span><span class="breadcrumb"><li><a href="/categories/xml/">xml</a></li><li><a href="/categories/xml/xstream/">xstream</a></li></span></span> | <span class="tags">Tagged <a href="/tags/xml/" class="label label-primary">xml</a><a href="/tags/xstream/" class="label label-success">xstream</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:44"datetime="2014-03-07 09:54:44"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-xml-xstream--xStream完美转换XML、JSON-hoojo-博客园/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-xml-xstream--xStream完美转换XML、JSON-hoojo-博客园" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/18/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/16/">16</a></li><li><a class="page-number" href="/page/17/">17</a></li><li><a class="page-number" href="/page/18/">18</a></li><li class="active"><li><span class="page-number current">19</span></li><li><a class="page-number" href="/page/20/">20</a></li><li><a class="page-number" href="/page/21/">21</a></li><li><a class="page-number" href="/page/22/">22</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/20/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 13:06:28</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
