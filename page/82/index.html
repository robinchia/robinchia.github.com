
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 82 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-缓存--Web开发人员需知的Web缓存知识/">Web开发人员需知的Web缓存知识</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-缓存--Web开发人员需知的Web缓存知识/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="web-web-">Web开发人员需知的Web缓存知识</h1>
<p>原文出处： <a href="http://www.mnot.net/cache_docs/" target="_blank">mnot</a>   译文出处： <a href="http://www.zhangxinxu.com/wordpress/2013/05/caching-tutorial-for-web-authors-and-webmasters/" target="_blank">张鑫旭</a></p>
<p>最近的译文距今已有4年之久，原文有一定的更新。今天踩着前辈们的肩膀，再次把这篇文章翻译整理下。一来让自己对web缓存的理解更深刻些，二来让大家注意力稍稍转移下，不要整天HTML5, 面试题啊叨啊叨的~~</p>
<h3 id="-web-">什么是Web缓存，为什么要使用它？</h3>
<p><em>Web缓存</em>游走于服务器和客户端之间。这个服务器可能是源服务器（资源所驻留的服务器Add），数量可能是1个或多个；这个客户端也可能是1个或多个。<em>Web缓存</em>就在服务器-客户端之间搞监控，监控请求，并且把请求输出的内容（例如html页面、 图片和文件）（统称为<em>副本</em>）另存一份；然后，如果下一个请求是相同的URL，则直接请求保存的副本，而不是再次麻烦源服务器。</p>
<p>使用缓存的2个主要原因：</p>
<ul>
<li><strong>降低延迟：</strong>缓存离客户端更近，因此，从缓存请求内容比从源服务器所用时间更少，呈现速度更快，网站就显得更灵敏。</li>
<li><strong>降低网络传输：</strong>副本被重复使用，大大降低了用户的带宽使用，其实也是一种变相的省钱（如果流量要付费的话），同时保证了带宽请求在一个低水平上，更容易维护了。</li>
</ul>
<h3 id="web-">Web缓存的类型</h3>
<p><strong>1. <a href="http://blog.jobbole.com/12749/" title="浏览器" target="_blank">浏览器</a>缓存</strong>
在任何<a href="http://blog.jobbole.com/12749/" title="现代浏览器" target="_blank">现代浏览器</a>上(如IE, FireFox, Chrome)折腾清除隐私数据（//zxx: 原文说的是首选项，显然out了，这里有改动）的对话框，你很可能会注意到“缓存”这个设置项。</p>
<p><a href="http://cdn2.jobbole.com/2013/06/cache-for-web-master-01.png" title="web制作、开发人员需知的Web缓存知识" target="_blank"><img src="&quot;web制作、开发人员需知的Web缓存知识&quot;" alt="web制作、开发人员需知的Web缓存知识"></a></p>
<p>浏览器会在你的硬盘上专门开辟一个空间专门为你存储资源副本。浏览器缓存的工作规则很简单：检查以确保副本是最新的，通常只要一次会话（就是当前浏览器调用的这次N）。</p>
<p>浏览器缓存在用户触发“后退”操作或点击一个之前看过的链接的时候很管用。同样，如果你在网站上访问同一张图片，该图片可以从浏览器缓存中调出并几乎立即显现出来。</p>
<p><strong>2. 代理服务器缓存</strong>
Web代理服务器使用同样的缓存原理，只是规模更大。代理以同样的方式服务千万用户，大公司和ISP(Internet Server Provider, Internet服务提供商Add)经常在他们的防火墙或者单独的设备（也被称为<em>中介(intermediaries)</em>）上架设代理缓存。</p>
<p>由于代理服务器缓存并非客户端或者源服务器的一部分，而是处于网络中，请求需要以某种方式路由到它们。一种方法是手动设置，告诉浏览器的你常用的代理服务器(//zxx: 翻墙的时候常用的)，另外就是使用拦截。<em>拦截代理(Interception proxies)</em>把Web请求根据自己的底层网络重定向，因此，客户端无需配置，甚至都不需要知道它们。//zxx: 维基百科上提供的几种检测拦截代理服务器存在的方法add，您若有兴趣，可以<a href="http://en.wikipedia.org/wiki/Proxy_server#Detection" target="_blank">点击这里</a>查看。</p>
<p>代理缓存属于一种<em>共享缓存</em>；往往有大量的用户使用，因此，其在降低延时和网络流量上很有用，毕竟每个副本都被大量重用。//zxx: 这里我有疑问：就算是放在代理服务器上，每次获取还是要通过网络的啊，如何降低了网络流量呢？希望谁可以帮忙解惑下。</p>
<p><strong>3. 网关缓存</strong>
也被称为“反向代理缓存”或“替代缓存”。网关缓存同样是起中介作用的，不过不是（素不相识、不曾谋面的Add）网络管理员部署的，而多半是网站管理员（公司专门的运维工程师、或UED或程序组某人Add）他们自己部署，这样更容易扩展与维护。</p>
<p>可以有多种方法把请求路由到网关缓存，但通常使用某种形式的负载均衡器①，使它们中的一个或多个看起来像是源服务器。<em>内容分发网络</em>②(CDNs)为整个网络（或部分）分配网关缓存，然后把这些缓存卖给需要的网站。<a href="http://www.speedera.com/" target="_blank">Speedera</a>③和<a href="http://www.akamai.com/" target="_blank">Akamai</a>④就是代表性的网络内容发布商。
①负载均衡器：是一种采用各种分配算法把网络请求分散到一个服务器集群中的可用服务器上去，通过管理进入的Web数据流量和增加有效的网络带宽，从而使网络访问者获得尽可能最佳的联网体验的硬件设备。</p>
<p>②内容分发网络：即CDN, 基本思路是尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输的更快、更稳定。通过在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络，CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。其目的是使用户可就近取得所需内容，解决 Internet网络拥挤的状况，提高用户访问网站的响应速度。</p>
<p>③Speedera：是一家全球性的内容服务提供商，它与北美、欧洲以及亚太地区的1000多家大型运营商都有联系，并为那些不想在自己服务器上寄存内容的公司提供软件下载、媒体及其它服务管理等业务。05年的时候被下面要介绍的Akamai以$130m的价格给收购了。</p>
<p>④Akamai：美国Akamai是国际上最大的CDN服务商，它巨大的网络分发能力在峰值时可达到15Tbps。Akamai公司是为数不多的旨在消除Internet瓶颈和提高下载速度的几家新公司之一，是一个致力于网络交通提速的”内容发布”公司，是波士顿高技术区最卓越的新兴企业之一。Akamai公司向全球企业提供发送互联网内容，汇流媒体和应用程序的服务（目前，该公司为15个国家的企业管理着8000多台服务器）。1998年，丹尼尔。L和麻省理工学院的一些研究人员一起创立了这家公司，他在麻省理工学院的硕士论文构成了Akamai公司最初的”自由流”（Freeflow）技术的核心。</p>
<p>本教程重点在浏览器和代理缓存，尽管有些信息对网关缓存感兴趣的人也适用。</p>
<h3 id="web-">Web缓存无害吗？为什么要鼓励缓存？</h3>
<p>Web缓存是互联网中最容易被误解的技术之一。网站管理员特别希望知道网站的一举一动，比方说多少人访问啦，访问时间啊什么的，而缓存会“隐藏”他们的用户，他们就无从得知到底谁访问了这个站点。</p>
<p>捡了芝麻丢西瓜，自认为放弃缓存可以精确跟踪用户，实际上，互联网中有太多的变数，想精确得到一张用户查看网站的图片？没那么简单的，亲！如果你很重视这个问题，恭喜你，本文正好提供了解决之道，即保证缓存友好，同时又能获得统计。</p>
<p>另外需要注意的是，缓存的内容都是旧的过时的。因此，如何准确更新就成了一个问题。不过不要担心，本文会向你展示如何配置服务器，让缓存就像你的女仆——随便调教。</p>
<p><a href="http://cdn2.jobbole.com/2013/06/cache-for-web-master-02.jpg" title="web制作、开发人员需知的Web缓存知识" target="_blank"><img src="&quot;web制作、开发人员需知的Web缓存知识&quot;" alt="web制作、开发人员需知的Web缓存知识"></a></p>
<p>CDN算是个挺有意思的技术，不同于代理缓存，CDN的网关缓存和被缓存的Web站点的利益是一致的，因此，上面提到的问题对于CDN而言是没有的。不过，即使你使用了CDN，你仍要顾虑下游的代理和浏览器缓存。</p>
<p>以上为缓存可能的“糟粕”，那他好的地方呢？缓存可以让你的Web站点加载更快，让你的服务器和互联网链接间负担更小。这种差异会导致一些类似质的变化，一个网站要几秒钟才能加载出来，而另外一个充分发挥缓存的优势，几乎瞬间显示。用户自然更喜欢那个加载迅速的站点，访问也更多。</p>
<p>再说个现实示例，许多大型互联网公司花费了数百万美元，在世界各地设立服务器集群来复制他们的内容，以使其尽可能快被他们的用户访问。缓存为你做同样的事情，而且他们更接近最终用户。最重要的是，你不要花银子。<img src="" alt=""></p>
<p>实际上呢，无论你喜欢与否，代理和浏览器缓存都会被使用。如果你站点的缓存配置不正确，你只能听天由命了。</p>
<h3 id="web-">Web缓存如何工作</h3>
<p>所以的缓存都有一套自己的规则，可以用来决定何时跟缓存暧昧往来。其中部分规则设定在协议中(HTTP 1.0 以及 1.1)，部分由缓存管理员⑤设置。
⑤缓存管理员：如果指的是浏览器缓存，则有可能就是我们服务器专家同事，在服务器上配置一些缓存规则；如果是代理缓存，则指的就是处理代理服务器这块的管理人员。</p>
<p>一般而言有如下常用规则N：</p>
<ol>
<li>响应头明确说明，偶不想被缓存，则不会被缓存；</li>
<li>如果请求信息是需要认证或者安全加密的(如, HTTPS)，相应内容也不会被缓存；</li>
<li>缓存如果有以下表现，则认为是<em>fresh</em>新鲜的（无需检查源服务器，直接发送给客户端）：</li>
</ol>
<ul>
<li>含有完整的过期时间和寿命控制头信息，并且内容仍在保鲜期内，或者</li>
<li>缓存最近已展现，并且在不久前修改。</li>
</ul>
<p>则内容缓存直取，绕过源服务器。</p>
<ul>
<li>若内容陈旧，则会要求源服务器做验证<em> validate </em>，或者告诉缓存其拷贝副本是否是OK的。</li>
<li>特定情况下——例如，断网了，之前有过的响应缓存直取而不检查源服务器。</li>
</ul>
<p>响应如果没有类似<em>ETag</em>或<em>Last-Modified</em>头这样的校验器，也没有明确的更新信息，通常（并不绝对）认为是不可缓存的。</p>
<p>总而言之，<strong>*新鲜度</strong>freshness<em>和**</em>校验<em>*validation</em>是确定缓存内容是否可用的最重要途径。如果要展示的足够新，直接缓存取；如果检测发现展示内容并未变化，则不会再来一次完整的传输。</p>
<h3 id="-">如何控制缓存和不缓存</h3>
<p>有很多工具可以帮助设计师和网站管理员调整服务器缓存网站的方式，这也许需要你亲自动手对服务器的配置进行一些调整，但绝对值得。了解如何使用这些工具请参考本文后面的章节。</p>
<p><strong>HTML Meta标签 vs. HTTP头信息</strong>
HTML<a href="http://www.amazon.cn/gp/product/B003BY6PLK/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;tag=vastwork-23&amp;linkCode=as2&amp;camp=536&amp;creative=3200&amp;creativeASIN=B003BY6PLK" title="重构:改善既有代码的设计" target="_blank">重构</a>人员可以在文档的</p>
<p><head>
中添加标签进行描述。这些<em>meta</em>标签通常用来标记不可缓存或过期时间。</p>
<p>Meta标签使用简单，但效果一般。因为只被少数几个浏览器宠幸，而代理缓存基本上就不访问HTML文档。尽管我们可以在页面上试图添加</p>
<p>no-cache
 meta标签让页面一直是最新的，但其实没必要。</p>
<p>如果你的网站托管在ISP或者主机托管商那里，并且他们没有赋予您任意设置HTTP头信息的能力(比如Expires和Cache-Control)，你要投诉争取，因为在你的工作中这些是必须的。</p>
<p>另外一方面： <em>HTTP头</em>信息可以让你对浏览器和代理服务器如何处理你的副本进行更多的控制。他们在HTML代码中是看不见的，一般由Web服务器自动生成。但是，根据你使用的服务器，你可以在某种程度上进行控制。在下文中：你将看到一些有趣的HTTP头信息，以及如何在你的站点上应用部署这些特性。</p>
<p>HTTP头信息发送在HTML代码之前，只能被浏览器和一些中间缓存能看到，一个典型的HTTP 1.1协议返回的头信息看上去像这样：
HTTP/1.1 200 OK</p>
<p>Date: Fri, 30 Oct 1998 13:19:41 GMT
Server: Apache/1.3.3 (Unix)</p>
<p>Cache-Control: max-age=3600, must-revalidate
Expires: Fri, 30 Oct 1998 14:19:41 GMT</p>
<p>Last-Modified: Mon, 29 Jun 1998 02:28:12 GMT
ETag: &quot;3e86-410-3596fbbc&quot;</p>
<p>Content-Length: 1040
Content-Type: text/html</p>
<p>头信息空一行后是HTML代码的输出，关于如何设置HTTP头信息请参考对应章节。</p>
<p><strong>Pragma HTTP头信息（以及为什么不起作用）</strong>
很多人认为在HTTP头信息中设置了</p>
<p>Pragma: no-cache
后会让内容无法被缓存。但事实并非如此：HTTP的规范中，响应型头信息没有任何关于Pragma属性的说明，只说明了请求头信息（浏览器发送给服务器的头信息）中的Pragma属性。虽然有少部分缓存会买账，但大部分无视，使用Pragma没作用。若要使用，试试下面的头信息。</p>
<p><strong>使用Expires HTTP头信息控制不过期</strong>
Expires HTTP头是控制缓存的基本手段，Expires的中文意思是“有效期”，显然，就是告诉浏览器缓存的有效期。如果过期，缓存会检查源服务器以确定文件是否改变了。Expires头几乎每个缓存都支持。</p>
<p>大部分的服务器允许你以多种方式设置Expires响应头。通常，他们允许设置一个绝对过期时间，然后对比最后一次访问的时候或者最后一次文档修改的时候决定客户端内容的获取方式。</p>
<p>对于静态图片（如导航或按钮的图片）而言，Expires头信息是相当有用的，因为图片不怎么修改，您可以给图片设置一个相当长的过期时间，这回让你的用户感觉网站变快了。Expires对于控制有改变规律的网页也很有用，例如：你有一个新闻聚合页面，每天早上6点钟准时更新，您可以设置缓存的过期时间也是这个点，于是缓存就可以很聪明地知道什么时候该去重载新的内容，什么时候睡大觉。</p>
<p>Expires头唯一的有效值是HTTP时间，其他值都会被认为是“前男友前女友”之类，不会去缓存的。注意：时间是格林威治时间（GMT），而不是本地时间。如下所示：
Expires: Fri, 30 Oct 1998 14:19:41 GMT</p>
<p>显然，如果你要使用Expires头，确保你的Web服务器时间的准备就非常重要了。使用网络时间协议⑥(Network Time Protocol – NTP)不失为一个号方法。如果你的身边有本地系统管理员，可以向他咨询，或者查看下面的百科Add 。</p>
<p>尽管Expires头很有用，但它有一定的局限性。首先，因为牵扯到时间，Web服务器端的时钟必须和缓存的同步，否则很可能实现不了预期的结果——缓存把前女友当初现女友，把现女友当作过去式——那就悲剧了。</p>
<p>另外一个问题是，你很容易忘记给某内容设置了一个特定时间，如果返回内容的时候没有更新这个过期时间，则每个请求都是上访到服务器，反而增加了负载和响应时间。
⑥网络时间协议(NTP): 以封包交换把两台电脑的时钟同步化的网络协议。NTP使用UDP端口123作为传输层。它是用作抵销可变延迟的影响。NTP是仍在使用中的最古老的网络协议之一（在1985年前开始）。NTP最初由德拉瓦州大学的Dave Mills设计，他与一群志愿者仍在维护NTP。</p>
<p><strong>Cache-Control（缓存控制）HTTP头信息</strong>
HTTP 1.1引入了新的头信息：</p>
<p>Cache-Control
响应头信息，让网站的发布者可以更全面的控制他们的内容，更好地处理Expires的些限制。</p>
<p>Cache-Control
有用的响应头包括：</p>
<ul>
<li><strong>max-age=[秒]</strong>：表示在这个时间范围内缓存是新鲜的无需更新。类似Expires时间，不过这个时间是相对的，而不是绝对的。也就是某次请求成功后多少秒内缓存是新鲜的。</li>
<li><strong>s-maxage=[秒]</strong>：类似</li>
</ul>
<p>max-age
, 除了仅应用于共享缓存（如代理）。</p>
<ul>
<li><strong>public</strong>：标记认证的响应才能够被缓存。一般而言，需要认证HTTP请求内容会自动私有化（不会被缓存Add）。</li>
<li><strong>private</strong>N：允许缓存专门为某一个用户存储响应，比方说在浏览器中；共享缓存一般不会，例如在代理中。</li>
<li><strong>no-cache</strong>：每次在释放缓存副本之前都强制发送请求给源服务器进行验证，这在确保认证有效性上很管用（和</li>
</ul>
<p>public
结合使用）或者保证内容必须是即时的，不得无视缓存的所有优点，如国内的微博、twitter等的刷新显示Add。</p>
<ul>
<li><strong>no-store</strong>：强制缓存在任何情况下都不要保留任何副本。</li>
<li><strong>must-revalidate</strong>：告诉缓存，我给你准备了一些关于新鲜度的信息，在表现的时候要严格遵循之。HTTP允许缓存在某些特定情况下返回过期数据，指定了这个属性，相对于告诉缓存，你丫必须严格遵循我的规则。</li>
<li><strong>proxy-revalidate</strong>：类似</li>
</ul>
<p>must-revalidate
，除了只能应用于代理缓存。</p>
<p>举个板栗：
Cache-Control: max-age=3600, must-revalidate</p>
<p>如果</p>
<p>Cache-Control
和</p>
<p>Expires
同时存在，</p>
<p>Cache-Control
说了算N。如果你打算使用</p>
<p>Cache-Control
头，你应该好好看看”<a href="http://www.ietf.org/rfc/rfc2616.txt" target="_blank">HTTP 1.1 规范</a>“, 详见参考文章以及拓展阅读。</p>
<p><strong>验证器和验证</strong>
在缓存如何工作这段译文中，我们说过，服务器以及缓存通过验证来判断内容是否改变，在不确定内容是否过期的时候，可以避免本地已经存在副本的时候下载整个内容。</p>
<p>验证器是很重要的，如果一个都没有，同时没有可用的新鲜度信息(</p>
<p>Expires
或</p>
<p>Cache-Control
)，缓存一点儿都不会存储内容。</p>
<p>最常见的验证是通过</p>
<p>Last-Modified
头信息通信确定文档最后的修改时间，如果缓存有内容存储，会包含</p>
<p>Last-Modified
信息的，辅助</p>
<p>If-Modified-Since
请求，我们可以询问服务器内容是否改变了。</p>
<p>HTTP 1.1引入了一个新的验证器，称为</p>
<p><em>Etag</em>
⑦. </p>
<p>Etag
是每次展现内容改变时候由服务器生成的唯一标识符，由于服务器控制</p>
<p>ETag
如何生成，当缓存发起</p>
<p>If-None-Match
请求的时候，如果</p>
<p>Etag
匹配，就可以确定展示内容其实是一样的。
⑦Etag: HTTP协议规格说明定义ETag为”被请求变量的实体值”。另一种说法是，ETag是一个可以与Web资源关联的记号（token）。典型的Web资源可以一个Web页，但也可能是JSON或XML文档。服务器单独负责判断记号是什么及其含义，并在HTTP响应头中将其传送到客户端，以下是服务器端返回的格式：ETag:”50b1c1d4f775c61:df3″客户端的查询更新格式是这样的：If-None-Match : W / “50b1c1d4f775c61:df3″如果ETag没改变，则返回状态304然后不返回，这也和Last-Modified一样。测试Etag主要在断点下载时比较有用。</p>
<p>几乎所有的缓存使用</p>
<p>Last-Modified
时间作为验证器，</p>
<p>Etag
验证也开始变得流行。</p>
<p>所有新一代的Web服务器都对静态内容（如：文件）自动生成</p>
<p>ETag
和</p>
<p>Last-Modified
头信息，而你不必做任何设置。但是，服务器对于动态内容（例如：CGI, ASP或数据库生成的网站）并不知道如何生成这些信息，参考一下编写支持缓存的脚本章节；</p>
<h3 id="-">创建支持缓存网站的小技巧</h3>
<p>除了使用新鲜度信息以及验证，还有其他一些技巧可以让你网站的缓存更加友好：</p>
<ul>
<li><strong>保持URL稳定</strong>：这是缓存的金科玉律，如果你为不同页面，不同用户或不同网站提供相同的内容，他们应该使用相同的URL. 这是简单却非常行之有效的方法。例如，你的HTML中的某个引用地址是</li>
</ul>
<p>&quot;/index.html&quot;
, 则要一直使用这个地址。</p>
<ul>
<li>不同地方的图片和其他元素<strong>使用同一库</strong>。</li>
<li><strong>对于不经常改变的图片/页面启用缓存</strong>，通过将</li>
</ul>
<p>Cache-Control: max-age
头信息的值设大一点。</p>
<ul>
<li><strong>对于定期更新的内容</strong>通过指定</li>
</ul>
<p>max-age
或过期时间实现缓存。</p>
<ul>
<li><strong>如果资源改变了（尤其下载文件），改变其名字</strong>。由于一般这种资源会有很长的过期时间，而服务器上一直是正确的版本；因此，链接这个下载资源的页面需要要比较短的过期时间（//zxx: 我司页面5分钟过期）。否则，会出现服务器的资源是新的，但页面被缓存了，其中的链接地址还是旧的，就会出现新旧版本冲突的可能Add。</li>
<li><strong>万不得已不要变动文件</strong>：否则你要设置一个新的</li>
</ul>
<p>Last-Modified
值。另外，当你更新站点的时候，只要上传改动的那些文件，而不要把整个站点都覆盖过去。</p>
<ul>
<li><strong>Cookie能不用就不用</strong>：Cookie难以被缓存，且大多情境下是没有必要的。如果你非得使用Cookie，建议用在动态页面上。</li>
<li><strong>减少SSL⑧的使用</strong>：因为共享缓存不能存储认证页面，只在必要的时候使用，并且在SSL页面上减少图片的使用。</li>
<li><strong>使用<a href="http://redbot.org/" target="_blank">REDbot</a>⑨检查你的网站</strong>：可以帮助你应用本文所介绍的一些概念。
⑧ SSL：全称Secure Socket Layer – 安全套接层，为Netscape所研发，用以保障在Internet上数据传输之安全，利用数据加密(Encryption)技术，可确保数据在网络上之传输过程中不会被截取及窃听。目前一般通用之规格为40 bit之安全标准，美国则已推出128 bit之更高安全标准，但限制出境。只要3.0版本以上之I.E.或Netscape浏览器即可支持SSL。</li>
</ul>
<p>⑨ REDbot：REDbot = RED + robot，是个机器人，检查HTTP资源，看他们如何会表现，指出常见的问题，并提出改进建议。虽然它属于HTTP一致性测试仪，但却可以找到不少HTTP相关问题。</p>
<h3 id="-">编写支持缓存的脚本</h3>
<p>默认情况下，大多数的脚本不会返回验证器（</p>
<p>Last-Modified
或</p>
<p>Etag
响应头）或新鲜度信息（</p>
<p>Expires
或</p>
<p>Cache-Control
）。尽管有些脚本的确是动态的（意味着每次请求都有不同的响应），还是有很多（如搜索引擎或数据库驱动的）网站可以从缓存中受益。</p>
<p>一般来讲，对于同一个请求（无论是几分钟还是几天之后），如果脚本产生的内容是可重复的，则可以缓存。脚本内容的改变仅仅依赖于URL，则可以缓存。如果是依赖于Cookie，认证信息或其他外部条件，很可能不缓存。</p>
<ul>
<li>最利于缓存的脚本就是在内容改变时导出成静态文件，服务器会想对待其他Web一样对待它的，生成以及使用验证器，于是你可以好好地喝杯咖啡了。记住，只有文件更改的时候才写入，这样Last-Modified时间就会被保存下来。</li>
<li>另外的脚本缓存之道就是使用</li>
</ul>
<p>age
相关的头部，相比</p>
<p>Expires
, </p>
<p>Cache-Control: max-age
更容易些，因为是相对时间，每次新请求完成后重新设置，时间到了，再重新请求，再设置新的相对过期时间。</p>
<ul>
<li>如果上面的做法你搞不定，你还可以试试通过脚本生成一个校验器, 然后回应</li>
</ul>
<p>If-Modified-Since
和/或</p>
<p>If-None-Match
请求。通过分析HTTP头信息，在适合的时候回应</p>
<p>304 Not Modified
. 不幸的是，这不是个打打酱油就能<a href="http://www.amazon.cn/gp/product/B007XPTAIS/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;tag=vastwork-23&amp;linkCode=as2&amp;camp=536&amp;creative=3200&amp;creativeASIN=B007XPTAIS" title="搞定(套装共3册) " target="_blank">搞定</a>的任务。</p>
<p><strong>其他一些技巧</strong></p>
<ul>
<li><strong>不要使用POST</strong>：若是获取数据，尽量不使用POST模式，因为POST方式返回内容大部分不会被缓存，相对的，通过GET以路径和查询发送的信息被缓存存储下来供后续使用。</li>
<li><strong>URL地址中不要嵌入特定的用户信息</strong>，除非生成的内容对于用户而言是唯一的。</li>
<li><strong>不要指望同一用户的所有请求来自同一主机</strong>，因为缓存经常协同工作。//zxx: 嘛意思？</li>
<li><strong>生成Content-Length⑩头信息</strong>。实现不难，可让你的脚本以持久连接(<em>persistent connection</em>)形式响应。这允许客户端在一个TCP/IP请求上请求多个内容，而不是为每次请求单独建立连接，这样你的网站相应会快很多。</li>
</ul>
<p>详见实现注意事项。
⑩Content-Length：指明实体正文的长度，以字节方式存储的十进制数字来表示。在数据下行的过程中，Content-Length的方式要预先在服务器中缓存所有数据，然后所有数据再一股脑儿地发给客户端。</p>
<h3 id="-">常见问题解答</h3>
<p><strong>缓存可用的最重要事情是？</strong>
其中一个不错的策略是找出常用的、规模较大的内容（尤其图片），然后优先处理之。</p>
<p><strong>我该如何利用缓存让我的页面尽可能的快？</strong>
最应该缓存的内容设置一个较长的过期时间。验证有助于减少查看内容的时间，不过缓存仍会连接源服务器查看是不是过期了。如果缓存已经知道内容是新鲜的，直接返回。</p>
<p><strong>我知道缓存是个好东西，但是我想随时知道多少人访问了我的网页！</strong>
如果你必须知道每一次页面被访问的情况，可以选择页面上的一个小元素(或页面本身)，然后给这个元素一个适当的头信息使它是不可缓存。比如，你可以在每一个页面上引用一个<em>1像素×1像素</em>的不可缓存（如scr地址后面加个随机数Add）的透明图片。Referer头信息将会包含调用它的页面信息。</p>
<p>请注意，即使这样也不能给出你用户的精确统计，并且对通过互联网访问的用户也不是很友好：产生不必要的流量，并强迫用户等待未被缓存的内容从网络上下载回来。更多的信息可参见拓展阅读中的“<a href="http://www.goldmark.org/netrants/webstats/" target="_blank">解读访问统计</a>”对应内容。</p>
<p><strong>我该如何查看HTTP头？</strong>
许多浏览器可以查看</p>
<p>Expires
和</p>
<p>Last-Modified
头信息，如右键→查看页面信息或类似面板。例如，在Firefox浏览器下Add：</p>
<p><a href="http://cdn2.jobbole.com/2013/06/cache-for-web-master-025.png" title="web制作、开发人员需知的Web缓存知识" target="_blank"><img src="&quot;web制作、开发人员需知的Web缓存知识&quot;" alt="web制作、开发人员需知的Web缓存知识"></a><a href="http://cdn2.jobbole.com/2013/06/cache-for-web-master-03.png" title="web制作、开发人员需知的Web缓存知识" target="_blank"><img src="&quot;web制作、开发人员需知的Web缓存知识&quot;" alt="web制作、开发人员需知的Web缓存知识"></a></p>
<p>表示要看到完整的头，您可以使用Telnet⑪客户端手动连接到Web服务器上。</p>
<p>为此，你可能需要用一个字段指定端口（默认是80），或者连接到</p>
<p>www.example.com:80
或者</p>
<p>www.example.com 80
(注意是空格)，更多设置请参考一下telnet客户端的文档。</p>
<p>一旦连接到该网站，输入请求。比如，你想查看</p>
<p><a href="http://www.example.com/foo.html" target="_blank">http://www.example.com/foo.html</a>
的头信息，首先连接到</p>
<p>www.example.com
, 使用80端口，并输入：
GET /foo.html HTTP/1.1 [return]</p>
<p>Host: www.example.com [return][return]</p>
<p>[return]
等同敲回车键，最后输入两次确认。这样就会输出头信息，然后跟着实际内容。如果只想看到头信息，使用</p>
<p>HEAD
来替换</p>
<p>GET
.</p>
<p>⑪Telnet：Telnet协议是<a href="http://www.amazon.cn/gp/product/B004JZY9BI/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;tag=vastwork-23&amp;linkCode=as2&amp;camp=536&amp;creative=3200&amp;creativeASIN=B004JZY9BI" title="TCP/IP协议族" target="_blank">TCP/IP协议族</a>中的一员，是Internet远程登陆服务的标准协议和主要方式。它为用户提供了在本地计算机上完成远程主机工作的能力。在终端使用者的电脑上使用telnet程序，用它连接到服务器。终端使用者可以在telnet程序中输入命令，这些命令会在服务器上运行，就像直接在服务器的控制台上输入一样。可以在本地就能控制服务器。要开始一个telnet会话，必须输入用户名和密码来登录服务器。Telnet是常用的远程控制Web服务器的方法。</p>
<p><strong>我的页面是密码保护的，代理缓存是怎么处理的？</strong>
默认情况下，HTTP验证保护的页面是私有的，共享缓存是不能保存的。然而，你可以通过</p>
<p>Cache-Control: public
头的设置使其公有。HTTP 1.1标准兼容的缓存服务器可以使之缓存。</p>
<p>如果你希望这些缓存的页面在用户查看之前还要验证一下，可以组合使用</p>
<p>Cache-Control: public
和</p>
<p>no-cache
头，这相对于告诉缓存器它从缓存中送出内容前必须递交客户端的验证给原始服务器。这个头信息如下所示：
Cache-Control: public, no-cache</p>
<p>不管怎么，这是最小化验证最好的方法；例如，你的图片不敏感，你可以把它放在分离的目录中，并配置你的服务对它们不做强制验证。这样，那些图片就会很自然的被缓存了。</p>
<p><strong>如果人们通过缓存访问我的网站，我应该担心安全吗？</strong>
SSL页面不会被代理服务器缓存，所以这个你不需要担心。但是，代理服务器就好非SSL页面请求以及URL抓取这口，你懂的，这是不安全的。无良的管理员可能就会收集网站用户的信息，尤其在URL中。</p>
<p>事实上，任何网络管理员都可以收集你的客户端和服务器端之间的这类信息。CGI ⑫脚本有个漏洞，会把用户名和密码放在自身的URL地址中，这很容易让其他人发现用户的登陆信息。</p>
<p>如果你懂得互联网安全的些基本机制，就不会对代理缓存感到任何惊讶。
⑫CGI：通用网关接口(Common Gateway Interface). 用于初始化软件服务的服务器方接口。这套接口描述了Web服务器与同一计算机上的软件的通信方式。</p>
<p>通用网关接口，它是一段程序，运行在服务器上，提供同客户端HTML页面的接口，通俗的讲CGI就像是一座桥，把网页和WEB服务器中的执行程序连接起来，它把HTML接收的指令传递给服务器，再把服务器执行的结果返还给HTML页；用CGI可以实现处理表格，数据库查询，发送电子邮件等许多操作，最常见的CGI程序就是计数器。CGI使网页变得不是静态的，而是交互式的。</p>
<p><strong>我在寻找一个集成的Web发布解决方案。哪些是可缓存的？</strong>
这个是不确定的。一般来说，越复杂的系统越难缓存。最差的情况就是所有的内容都是动态生成，并且不提供校验器，与缓存压根无缘。你可以和你供应商的技术人员沟通获取更多信息，并参考下面实现注意事项。</p>
<p><strong>我的图片缓存一个月后才到期，我现在就想变动！</strong></p>
<p>Expires
头是绕不过去的，除非缓存（浏览器或者代理）空间不足才会删除副本，缓存副本会一直使用。</p>
<p>最有效的方法是修改链接，这样会从源服务器获取完整的新内容。请记住，调用图片的这个页面也会被缓存的，正因如此，我们需要让图片以及其他类似的静态资源易缓存，而页面呢可以随着自身的改变（例如改变了一个图片的URL地址Add）即时更新。</p>
<p>如果你想摆脱特定缓存，重载内容，可以试试强制刷新（在FireFox中，shift键+reload按钮等同于处理</p>
<p>Pragma: no-cache
请求头）或者让缓存管理员使用某些接口删除内容。</p>
<p><strong>我运行一个Web Hosting服务。我怎样才能让我的用户发布缓存友好的网页？</strong>
如果你使用apahe，可以考虑允许他们使用</p>
<p>.htaccess
文件并提供相应的文档。</p>
<p>否则你需要在每一个虚拟主机上为各种缓存属性建立预定的区域。比如：你可以指定一个叫</p>
<p>/cache-1m
的目录用来放读取后要缓存一个月的内容，然后再建一个</p>
<p>/no-cache
的目录，并在头信息中指定这么目录中的内容不被缓存。</p>
<p>不管上面你做的如何，总之最好优先给用户量大的客户做缓存处理。大部分服务器节约的流量以及负载都是来自高容量的网站。</p>
<p><strong>我明明告诉网页要好好缓存，但它老是去请求，怎么破？</strong>
缓存服务器并不总是要求内容要保持并重用，某些条件下，他们是不保存不重用的，所有的缓存服务器都回基于文件的大小、类型（图片、页面…），或者服务器空间的剩余来确定如何缓存。如果你的文件比较大或很热门，可能就不会被缓存。有些缓存服务器允许管理员决定哪些内容要存储，有些缓存服务器允许内容长存缓存中，所以，它们总是可用的。</p>
<h3 id="-web-">实现需注意的：Web服务器端</h3>
<p>一般说来，应该选择最新版本的Web服务器程序来部署。不仅因为它们包含更多利于缓存的功能，新版本往往在性能和安全性方面都有很多的改善。</p>
<p><strong>Apache HTTP服务器</strong>
<a href="http://www.apache.org/" target="_blank">Apache</a>使用可选模块包含头信息，头信息</p>
<p>Expires
和</p>
<p>Cache-Control
一并包含。这些模块在1.2版本以上都支持。</p>
<p>这些模块需要编译到Apache中，虽然包含，但是默认并未开启。为了确定相应模块已经被启用，找到httpd⑬程序，运行</p>
<p>httpd -l
, 它会列出可用的模块（注意，仅有内部编译的模块列表才会显示，在较新版本的Apache中，使用</p>
<p>httpd -M
可以包含动态加载的模块N），我们需要关注的是expires模块(</p>
<p>expires_module
)和headers模块(</p>
<p>headers_module
)。
⑬httpd：httpd是Apache超文本传输协议(HTTP)服务器的主程序。被设计为一个独立运行的后台进程，它会建立一个处理请求的子进程或线程的池。</p>
<ul>
<li>如果这些模块不可用，你需要联系管理员，重新编译以包含这些模块。这些模块可以通过取消配置文件中的注释掉启用，或者在编译的时候增加</li>
</ul>
<p>-enable -module=expires
和</p>
<p>-enable-module=headers
参数(apache 1.3+). 参开Apache中的INSTALL文件。</p>
<p>一旦你的Apache有了相应的模块，你可以使用</p>
<p>mod_expires
指定过期的时间，要么在</p>
<p>.htaccess
文件，要么在服务器的</p>
<p>access.conf
文件。你可以设置过期时间是从访问时间开始还是文件修改时间开始，并应用到特定类型文件上或设为默认配置。查看官方<a href="http://www.apache.org/docs/mod/mod_expires.html" target="_blank">该模块文档</a>获得更多信息，或者遇到问题的时候向你身边的apache专家讨教。</p>
<p>为应用</p>
<p>Cache-Control
头，你需要使用</p>
<p>mod_headers
模块，其允许你为资源指定任意的头信息。可参考<a href="http://www.apache.org/docs/mod/mod_headers.html" target="_blank">mod_headers官方文档</a>。</p>
<p>下面是</p>
<p>.htaccess
文件展示了如何使用头信息：</p>
<ul>
<li>.htaccess
文件允许Web发布者使用配置文件中的指定。可以影响目录以及子目录内容。和你的服务器管理员沟通下，看看它们是否可用。</li>
</ul>
<p>/#/#/# activate mod_expires</p>
<p>ExpiresActive On
/#/#/# Expire .gif&#39;s 1 month from when they&#39;re accessed</p>
<p>ExpiresByType image/gif A2592000
/#/#/# Expire everything else 1 day from when it&#39;s last modified</p>
<p>/#/#/# (this uses the Alternative syntax)
ExpiresDefault &quot;modification plus 1 day&quot;</p>
<p>/#/#/# Apply a Cache-Control header to index.html</p>
<Files index.html>

<p>Header append Cache-Control &quot;public, must-revalidate&quot;
</Files></p>
<ul>
<li>注意，在有些情况下，</li>
</ul>
<p>mod_expires
会自动计算并插入</p>
<p>Cache-Control:max-age
头信息。</p>
<p>Apache 2′s的配置和1.3类似，更多信息可以参考2.2N的<a href="http://httpd.apache.org/docs/2.2/mod/mod_expires.html" target="_blank">mod_expires</a>和<a href="http://httpd.apache.org/docs/2.2/mod/mod_headers.html" target="_blank">mod_headers</a>文档。</p>
<p><strong>微软IIS</strong>
微软的IIS有一些灵活的方式可以很容易得设置头信息，不过似乎只针对IIS 4.0服务器，并且只能在NT服务器上运行。</p>
<p>为了给网站某区域指定头信息，需要进入</p>
<p>Administration
(管理员)工具面板，然后再设置属性。选择</p>
<p>HTTP Headers
选项卡后，你会看到两个有意思的区域：</p>
<p>Enable Content Expiration
和</p>
<p>Custom HTTP headers
, 第一个含义一目了然，第二个用来应用</p>
<p>Cache-Control
头。//zxx: 此处的操作描述很过时了，看看window7下，操作界面早就大变样了！</p>
<p><a href="http://cdn2.jobbole.com/2013/06/cache-for-web-master-035.png" title="web制作、开发人员需知的Web缓存知识" target="_blank"><img src="&quot;web制作、开发人员需知的Web缓存知识&quot;" alt="web制作、开发人员需知的Web缓存知识"></a><a href="http://cdn2.jobbole.com/2013/06/cache-for-web-master-04.png" title="web制作、开发人员需知的Web缓存知识" target="_blank"><img src="&quot;web制作、开发人员需知的Web缓存知识&quot;" alt="web制作、开发人员需知的Web缓存知识"></a></p>
<p>设置ASP页面(Active Server Pages)的头信息可以参考后面的ASP章节，也可以通过ISAPI模块设置头信息，细节请参考MSDN。</p>
<p><strong>Netscape/iPlanet企业服务器</strong>
3.6版本以后，企业版服务器已经不能以任何方式设置</p>
<p>Expires
头信息了。然而，其从3.0版本开始支持HTTP 1.1的功能。这意味着HTTP 1.1的缓存（代理服务器/浏览器）利用你对</p>
<p>Cache-Control
的设置来获得。</p>
<p>为了使用</p>
<p>Cache-Control
头，在管理员服务器中选择</p>
<p>Content Management | Cache Control Directives
（内容管理|缓存控制指令）。然后，使用资源选择器(Resource Picker)，选择你希望设置头信息的目录。设置完头信息后，点击”确定”。更多信息请参考<a href="http://www.redhat.com/docs/manuals/ent-server/" target="_blank">NES手册</a>。</p>
<h3 id="-">实现需注意的：服务端脚本</h3>
<p>时刻谨记，在Web服务器上设置HTTP要比通过脚本设置轻松些。你可以两者都试试。</p>
<p>因为服务器端的脚本主要是为了动态内容，所以即使实际上内容可以被缓存的，其也不会生成缓存很强的页面。如果你的页面内容经常变动，但不是每个页面都中枪，可以考虑设置</p>
<p>Cache-Control: max-age
头信息，大部分用户是在相对端的时间内再次访问这个页面。例如：用户点击“后退”按钮，如果没有任何验证或新鲜度信息，他们将不得不等待，直到从服务器页面重新下载才能看到它。</p>
<p><strong>CGI</strong>
CGI脚本是生成内容最常用的技术之一。你可以轻轻松松在请求发送给主体之前添加HTTP请求信息。大部分CGI实现都需要添加</p>
<p>Content-Type
头信息，例如这个Perl脚本：//zxx: 还是挺好懂的
&lt;/#!/usr/bin/perl</p>
<p>print &quot;Content-type: text/htmln&quot;;
print &quot;Expires: Thu, 29 Oct 1998 17:04:19 GMTn&quot;;</p>
<p>print &quot;n&quot;;
/#/#/# the content body follows.../pre&gt;</p>
<p>由于都是文本，你可以很容易通过内置函数生成</p>
<p>Expires
和其他日期相关的头信息。如果你使用</p>
<p>Cache-Control: max-age
会更简单：</p>
<p>print &quot;Cache-Control: max-age=600n&quot;;</p>
<p>上面脚本可以让请求完成后缓存10分钟，因此，当用户点击“后退”按钮的时候，就不会重新涂胶请求了。</p>
<p>CGI的规范同时也允许在脚本环境中，客户端发送请求头信息，每个头信息都有一个’HTTP_’的前缀。于是乎，如果一个客户端发送一个</p>
<p>If-Modified-Since
请求，就是这样的：
HTTP_IF_MODIFIED_SINCE</p>
<p>可观摩<a href="http://www.mnot.net/cgi_buffer/" target="_blank">cgi_buffer</a>库，其可以自动实现</p>
<p>Etag
生成和验证，</p>
<p>Content-Length
生成及gzip内容，而所有这些实现，只需要一行include，就可以为Perl和Python写CGI脚本。Python版本还可以包装任意的CGI脚本。</p>
<p><strong>服务器端包含</strong>
SSI（扩展名通常是</p>
<p>.shtml
）最早可以生成动态内容的网站发布方案。通过在页面中使用特定的标签，有一定限制的内HTML脚本就可以使用了。大部分的SSI实现不设置验证器，故无法缓存。不过Apache服务器允许通过设置让SSI文件可缓存，通过适当的文件并结合</p>
<p>XbitHack full
指令设置组执行权限。欲了解更多信息，请参阅<a href="http://www.apache.org/docs/mod/mod_include.html" target="_blank">mod_include文档</a>。</p>
<p><strong>PHP</strong>
PHP为服务器端脚本语言，在服务器内置的时候，可以在HTML页面中内嵌使用，很像SSL，不过有更多的可选项。PHP可以在任何Web服务器(Unix或Windows)或Apache模块上作为CGI使用。</p>
<p>默认情况下，PHP生成的内容没有分配验证器，因此，不能缓存。不过，开发人员可以通过</p>
<p>Header()
函数设置HTTP头信息。例如，创建</p>
<p>Cache-Control
头，过期时间为3天：
&lt;?php</p>
<p>Header(&quot;Cache-Control: must-revalidate&quot;);</p>
<p>$offset = 60 /<em> 60 /</em> 24 /* 3;
$ExpStr = &quot;Expires: &quot; . gmdate(&quot;D, d M Y H:i:s&quot;, time() + $offset) . &quot; GMT&quot;;</p>
<p>Header($ExpStr);
?&gt;</p>
<p>记住</p>
<p>Header()
需要在所有的输出之前。</p>
<p>正如你看到的，你可以手工创建HTTP日期。PHP没有专门的函数（新版本已改进，请参考<a href="http://php.net/date" target="_blank">PHP的日期相关函数文档</a>）。当然，最简单的还是设置</p>
<p>Cache-Control: max-age
头信息，适用于大部分情况。</p>
<p>更多内容，请参阅<a href="http://www.php.net/manual/function.header.php3" target="_blank">header手册</a>。</p>
<p>还是<a href="http://www.mnot.net/cgi_buffer/" target="_blank">cgi_buffer</a>库，只要一行包含，就能以PHP脚本形式自动实现</p>
<p>Etag
生成和验证，</p>
<p>Content-Length
生成及gzip内容。</p>
<p><strong>Cold Fusion</strong>
<a href="http://www.adobe.com/products/coldfusion/" target="_blank">Cold Fusion</a>是Macromedia的商业服务器端脚本引擎，并且支持多种Windows平台，Linux平台和多种Unix平台。//zxx: 看到Macromedia心亮了半截，几百年前就被收购的公司……此文未免太过时了点了~~大家这段可以跳过了，几乎没有任何价值……</p>
<p>Cold Fusion通过CFHEADER标记设置HTTP头信息相对容易。可惜的是，以下的Expires头信息的设置有些容易误导：</p>
<CFHEADER NAME="Expires" VALUE="/#Now()/#">

<p>它并不像你想像的那样工作，因为时间（本例中为请求发起的时间）并不会被转换成一个符合HTTP时间，而且打印出副本的Cold fusion的日期/时间对象，大部分客户端会忽略或者将其转换成1970年1月1日。</p>
<p>但是：Cold Fusion另外提供了一套日期格式化函数-<a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00000483.htm" target="_blank">GetHttpTimeSTring</a>. 结合<a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00000437.htm" target="_blank">DateAdd</a>函数，就很容易设置过期时间了，这里我们设置一个头信息，声明内容在1个月以后过期：</p>
<cfheader name="Expires"

  value="/#GetHttpTimeString(DateAdd('m', 1, Now()))/#">

<p>你也可以使用</p>
<p>CFHEADER
标签设置</p>
<p>Cache-Control: max-age
以及其他头信息。</p>
<p>记住，Web服务器也会将头信息设置转给Cold Fusion(做为CGI运行的时候)，检查你的服务器设置并确定你是否可以利用服务器设置代替Cold Fusion.</p>
<p><strong>ASP和ASP.NET</strong></p>
<p>在asp中设置HTTP头信息时，确保</p>
<p>Response
方法调用在HTML内容输出之前，或者使用</p>
<p>Response.Buffer
暂存输出。同时，注意某些版本的IIS默认设置会输出</p>
<p>Cache-Control: private
头信息，必须声明成</p>
<p>public
才能被共享缓存服务器缓存。</p>
<p>ASP(Active Server Pages)，IIS内置，也可用于其他Web服务器，同样允许你设置HTTP头。例如设置过期时间，你可以使用</p>
<p>Response
自带属性：
&lt;% Response.Expires=1440 %&gt;</p>
<p>指定内容过期的分钟数。</p>
<p>Cache-Control
头添加如下：</p>
<p>&lt;% Response.CacheControl=&quot;public&quot; %&gt;</p>
<p>在ASP.NET中，</p>
<p>Response.Expires
已经不推荐使用了，正确的方法是通过</p>
<p>Response.Cache
设置缓存相关的头信息，如下：</p>
<p>Response.Cache.SetExpires ( DateTime.Now.AddMinutes ( 60 ) ) ;</p>
<p>Response.Cache.SetCacheability ( HttpCacheability.Public ) ;</p>
<h3 id="-">参考文档和拓展阅读</h3>
<p><a href="http://www.ietf.org/rfc/rfc2616.txt" target="_blank"><strong>HTTP 1.1规范</strong></a>
HTTP 1.1的规范对页面缓存以及权威的接口实现指南有了大量的扩展，参考章节：13, 14.9, 14.21以及14.25 .</p>
<p><strong><a href="http://www.web-caching.com/" target="_blank">Web-Caching.com</a></strong>
对缓存概念有很好的介绍，并且有很多其他在线资源的链接。</p>
<p><a href="http://www.goldmark.org/netrants/webstats/" target="_blank"><strong>解读访问统计</strong></a>
Jeff Goldberg这篇内容丰富叙述会告诉你为什么不应该过度依赖访问统计和计数器。//zxx 上世纪的复古页面…</p>
<p><a href="http://www.zhangxinxu.com/wordpress/2013/05/caching-tutorial-for-web-authors-and-webmasters/" target="_blank"><strong>REDbot</strong></a>
检查HTTP资源，以确定它们如何与Web缓存交互，以及通常如何使用该协议。</p>
<p><a href="http://www.mnot.net/cgi_buffer/" target="_blank"><strong>cgi_buffer库</strong></a>
只要包含一行Perl CGI, Python CGI以及PHP脚本，就能自动实现</p>
<p>Etag
生成以及验证，</p>
<p>Content-Length
生成以及Gzip内容的正确编码。Python版本还可以包装任意的CGI脚本。</p>
<h3 id="-">关于本文档</h3>
<p>本文版权属于Mark Nottingham © 1998-2013 邮箱为</p>
<p>mnot@pobox.com
.</p>
<p>本作品遵循<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/" target="_blank">知识共享署名 – 非商业性使用 – 禁止演绎3.0声明页面许可证</a>N。</p>
<p>所有的商标版权为其持有人所有。</p>
<p>内容在发布时是可以确保其正确性，但是，随着时间推移，就不能保证正确无误了。因此，如有链接404，描述错误或其他需要纠正的问题请尽快告知作者。</p>
<p>本文最新版本可以从<a href="http://www.mnot.net/cache_docs/" target="_blank"><a href="http://www.mnot.net/cache_docs/">http://www.mnot.net/cache_docs/</a></a>获得</p>
<p>可用翻译：<a href="http://www.fatcow.com/edu/cache-docs-be/" target="_blank">白俄罗斯</a>，<a href="http://www.zhangxinxu.com/wordpress/?p=3338" target="_blank">中国</a>，<a href="http://www.jakpsatweb.cz/clanky/caching-tutorial-czech-translation.html" target="_blank">捷克</a>，<a href="http://thomas-huehn.de/web/caching-tutorial" target="_blank">德国</a>和<a href="http://www.mnot.net/cache_docs/index.fr.html" target="_blank">法国</a>。</p>
<p><strong>文档说明：</strong>含有上标N的表示与前辈翻译时候相比新增的；上标Add表示作为译者的我为了便于理解自己添加的；上标数字(①-⑬)是对一些可能不熟悉的名词的百科解释。</p>
<p>虽然原作语言不生动，教科书般一板一眼⑭；有些可能过时了。不过，还是学到了很多东西。还是很值的！欢迎分享，欢迎传播，以后面试之前来这里看看，可能会有帮助哦！
⑭ 如果我介绍缓存，我可能就这么讲：缓存是什么？顾名思意，就是缓慢的存钱。为什么要缓慢的存钱，因为工资卡都上交老婆了，为了攒点零花钱又不能被老婆发现，只能慢慢存了。那缓存有什么用呢？你想啊，自己有点小钱，做事情就方便快捷了，比方说我想买个鱼竿，就不要去向老婆要（给不给先不谈），自己从自己这边取，大大提高了执行的速度。</p>
<p>那什么时候可以存什么时候不能存呢？老婆给零花钱的时候，可能会有过期时间头，例如，周一甩了100块钱，拿去，这是一周的伙食！这个一周就是过期时间头(Expires Header)，在这个时间内，你的钱可以从缓存，也就是自己这里取……</p>
<p><img src="&quot;1 vote, average: 5.00 out of 5&quot;" alt="1 vote, average: 5.00 out of 5"><img src="&quot;1 vote, average: 5.00 out of 5&quot;" alt="1 vote, average: 5.00 out of 5"><img src="&quot;1 vote, average: 5.00 out of 5&quot;" alt="1 vote, average: 5.00 out of 5"><img src="&quot;1 vote, average: 5.00 out of 5&quot;" alt="1 vote, average: 5.00 out of 5"><img src="&quot;1 vote, average: 5.00 out of 5&quot;" alt="1 vote, average: 5.00 out of 5"> (<strong>*1</strong> 个评分，平均: <strong>5.00*</strong>)</p>
<p><img src="&quot;Loading ...&quot;" alt="Loading ..."> Loading ...</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/缓存/">缓存</a></li></span></span> | <span class="tags">Tagged <a href="/tags/缓存/" class="label label-primary">缓存</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-缓存--Web开发人员需知的Web缓存知识/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-缓存--Web开发人员需知的Web缓存知识" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-缓存-ehcache--EHCache分布式缓存集群环境配置-七郎-博客园/">EHCache分布式缓存集群环境配置 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-缓存-ehcache--EHCache分布式缓存集群环境配置-七郎-博客园/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="ehcache-">EHCache分布式缓存集群环境配置 - 七郎 - 博客园</h1>
<p><a href=""></a></p>
<p><a href="http://www.cnblogs.com/yangy608/" target="_blank"><img src="" alt="返回主页"></a></p>
<h1 id="-s-blog-http-www-cnblogs-com-yangy608-"><a href="http://www.cnblogs.com/yangy608/" target="_blank">七郎&#39;s Blog</a></h1>
<h2 id="-">草木竹石皆可為劒。至人之用人若鏡，不將不迎，應而不藏，故能勝物而不傷。</h2>
<ul>
<li><a href="http://www.cnblogs.com/" target="_blank">博客园</a></li>
<li><a href="http://www.cnblogs.com/yangy608/" target="_blank">首页</a></li>
<li><a href="http://news.cnblogs.com/" target="_blank">新闻</a></li>
<li><a href="http://www.cnblogs.com/yangy608/admin/EditPosts.aspx?opt=1" target="_blank">新随笔</a></li>
<li><a href="http://space.cnblogs.com/msg/send/%e4%b8%83%e9%83%8e" target="_blank">联系</a></li>
<li><a href="http://www.cnblogs.com/yangy608/admin/EditPosts.aspx" target="_blank">管理</a></li>
<li><a href="http://www.cnblogs.com/yangy608/rss" target="_blank">订阅</a><a href="http://www.cnblogs.com/yangy608/rss" target="_blank"><img src="" alt="订阅"></a>
随笔- 144 文章- 1 评论- 1 </li>
</ul>
<h1 id="-ehcache-http-www-cnblogs-com-yangy608-archive-2011-10-07-2200669-html-"><a href="http://www.cnblogs.com/yangy608/archive/2011/10/07/2200669.html" target="_blank">EHCache分布式缓存集群环境配置</a></h1>
<p>ehcache提供三种网络连接策略来实现集群，rmi,jgroup还有jms。同时ehcache可以可以实现多播的方式实现集群,也可以手动指定集群主机序列实现集群。</p>
<p>Ehcache支持的分布式缓存支持有三种RMI，JGroups，JMS，这里介绍下MRI和JGrpups两种方式，Ehcache使用版本为1.5.0，关于ehcache的其他信息请参考<a href="http://ehcache.sourceforge.net/EhcacheUserGuide.html" target="_blank"><a href="http://ehcache.sourceforge.net/EhcacheUserGuide.html">http://ehcache.sourceforge.net/EhcacheUserGuide.html</a></a>，</p>
<p>关于jgroups的信息请参考<a href="http://www.jgroups.org/manual/html_single/index.html。" target="_blank">http://www.jgroups.org/manual/html_single/index.html。</a></p>
<p>环境为两台机器 server1 ip：192.168.2.154，server2 ip：192.168.2.23</p>
<h3 id="1-rmi-">1. RMI方式：</h3>
<p>rmi的方式配置要点（下面均是server1上的配置，server2上的只需要把ip兑换即可）</p>
<p><strong>a. 配置PeerProvider：</strong></p>
<p>Xml代码</p>
<cacheManagerPeerProviderFactory class="net.sf.ehcache.distribution.RMICacheManagerPeerProviderFactory"

properties="peerDiscovery=manual,rmiUrls=//192.168.2.23:40001/userCache|//192.168.2.23:40001/resourceCache" /> 

<p>配置中通过手动方式同步sever2中的userCache和resourceCache。</p>
<p><strong>b. 配置CacheManagerPeerListener：</strong></p>
<p>Xml代码</p>
<cacheManagerPeerListenerFactory class="net.sf.ehcache.distribution.RMICacheManagerPeerListenerFactory"

properties="hostName=192.168.2.154, port=40001,socketTimeoutMillis=2000" /> 

<p>配置中server1监听本机40001端口。</p>
<p><strong>c. 在每一个cache中添加cacheEventListener，例子如下：</strong></p>
<p>Xml代码</p>
<cache name="userCache" maxElementsInMemory="10000" eternal="true" overflowToDisk="true" timeToIdleSeconds="0" timeToLiveSeconds="0"diskPersistent="false" diskExpiryThreadIntervalSeconds="120">

<cacheEventListenerFactory class="net.sf.ehcache.distribution.RMICacheReplicatorFactory" properties="replicateAsynchronously=true, replicatePuts=true, replicateUpdates=true,replicateUpdatesViaCopy= false, replicateRemovals= true " />

</cache>

<p><strong>属性解释：</strong></p>
<p>必须属性：</p>
<pre><code>    name:设置缓存的名称，用于标志缓存,惟一

    maxElementsInMemory:在内存中最大的对象数量

    maxElementsOnDisk：在DiskStore中的最大对象数量，如为0，则没有限制

    eternal：设置元素是否永久的，如果为永久，则timeout忽略

    overflowToDisk：是否当memory中的数量达到限制后，保存到Disk
</code></pre><p>可选的属性：</p>
<pre><code>    timeToIdleSeconds：设置元素过期前的空闲时间

    timeToLiveSeconds：设置元素过期前的活动时间

    diskPersistent：是否disk store在虚拟机启动时持久化。默认为false
</code></pre><p>   diskExpiryThreadIntervalSeconds:运行disk终结线程的时间，默认为120秒</p>
<pre><code>    memoryStoreEvictionPolicy：策略关于Eviction
</code></pre><p>缓存子元素：</p>
<pre><code>cacheEventListenerFactory：注册相应的的缓存监听类，用于处理缓存事件，如put,remove,update,和expire

bootstrapCacheLoaderFactory:指定相应的BootstrapCacheLoader，用于在初始化缓存，以及自动设置。
</code></pre><p>参考另外一篇学习笔记<a href="http://wozailongyou.javaeye.com/blog/230252" title="http://wozailongyou.javaeye.com/blog/230252" target="_blank"><a href="http://wozailongyou.javaeye.com/blog/230252">http://wozailongyou.javaeye.com/blog/230252</a></a>，也有集群的说明</p>
<h3 id="2-jgroups-">2. JGroups方式：</h3>
<p>ehcache 1.5.0之后版本支持的一种方式，配置起来比较简单，要点：</p>
<p><strong>a. 配置PeerProvider，使用tcp的方式，例子如下：</strong></p>
<p>Xml代码</p>
<cacheManagerPeerProviderFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheManagerPeerProviderFactory"

properties="connect=TCP(start_port=7800):

TCPPING(initial_hosts=192.168.2.154[7800],192.168.2.23[7800];port_range=10;timeout=3000;

num_initial_members=3;up_thread=true;down_thread=true):

VERIFY_SUSPECT(timeout=1500;down_thread=false;up_thread=false):

pbcast.NAKACK(down_thread=true;up_thread=true;gc_lag=100;retransmit_timeout=3000):

pbcast.GMS(join_timeout=5000;join_retry_timeout=2000;shun=false;

print_local_addr=false;down_thread=true;up_thread=true)"

propertySeparator="::" />

<hr>
<p><strong>b.为每个cache添加cacheEventListener：</strong></p>
<p>Xml代码</p>
<cache name="userCache" maxElementsInMemory="10000" eternal="true"

overflowToDisk="true" timeToIdleSeconds="0" timeToLiveSeconds="0"

diskPersistent="false" diskExpiryThreadIntervalSeconds="120">

<cacheEventListenerFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"

properties="replicateAsynchronously=true, replicatePuts=true,

replicateUpdates=true, replicateUpdatesViaCopy=false, replicateRemovals=true"/>

</cache>

<p>JGroup方式配置的两个server上的配置文件一样，若有多个server，在initial_hosts中将server ip加上即可。</p>
<p>一个完整的ehcache.xml文件：</p>
<p>Xml代码
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</p>
<ehcache xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"

xsi:noNamespaceSchemaLocation="http://ehcache.sf.net/ehcache.xsd">

<diskStore path="java.io.tmpdir" />



<cacheManagerPeerProviderFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheManagerPeerProviderFactory"

properties="connect=TCP(start_port=7800):

TCPPING(initial_hosts=192.168.2.154[7800],192.168.2.23[7800];port_range=10;timeout=3000;

num_initial_members=3;up_thread=true;down_thread=true):

VERIFY_SUSPECT(timeout=1500;down_thread=false;up_thread=false):

pbcast.NAKACK(down_thread=true;up_thread=true;gc_lag=100;retransmit_timeout=3000):

pbcast.GMS(join_timeout=5000;join_retry_timeout=2000;shun=false;

print_local_addr=false;down_thread=true;up_thread=true)"

propertySeparator="::" />



<defaultCache maxElementsInMemory="10000" eternal="true"

overflowToDisk="true" timeToIdleSeconds="0" timeToLiveSeconds="0"

diskPersistent="false" diskExpiryThreadIntervalSeconds="120">

<cacheEventListenerFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"

properties="replicateAsynchronously=true, replicatePuts=true,

replicateUpdates=true, replicateUpdatesViaCopy=false, replicateRemovals=true"/>

</defaultCache>



<cache name="velcroCache" maxElementsInMemory="10000" eternal="true"

overflowToDisk="true" timeToIdleSeconds="0" timeToLiveSeconds="0"

diskPersistent="false" diskExpiryThreadIntervalSeconds="120">

<cacheEventListenerFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"

properties="replicateAsynchronously=true, replicatePuts=true,

replicateUpdates=true, replicateUpdatesViaCopy=false, replicateRemovals=true"/>

</cache>

<cache name="userCache" maxElementsInMemory="10000" eternal="true"

overflowToDisk="true" timeToIdleSeconds="0" timeToLiveSeconds="0"

diskPersistent="false" diskExpiryThreadIntervalSeconds="120">

<cacheEventListenerFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"

properties="replicateAsynchronously=true, replicatePuts=true,

replicateUpdates=true, replicateUpdatesViaCopy=false, replicateRemovals=true"/>

</cache>

<cache name="resourceCache" maxElementsInMemory="10000"

eternal="true" overflowToDisk="true" timeToIdleSeconds="0"

timeToLiveSeconds="0" diskPersistent="false"

diskExpiryThreadIntervalSeconds="120">

<cacheEventListenerFactory class="net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicatorFactory"

properties="replicateAsynchronously=true, replicatePuts=true,

replicateUpdates=true, replicateUpdatesViaCopy=false, replicateRemovals=true"/>

</cache>

</ehcache>

<p>posted @ 2011-10-07 17:30 <a href="http://www.cnblogs.com/yangy608/" target="_blank">七郎</a> 阅读(1963) 评论(0) <a href="http://www.cnblogs.com/yangy608/admin/EditPosts.aspx?postid=2200669" target="_blank">编辑</a> <a href="http://www.cnblogs.com/yangy608/archive/2011/10/07/2200669.html#" target="_blank">收藏</a>
<img src="" alt=""></p>
<p><a href="http://www.cnblogs.com/yangy608/archive/2011/10/07/2200669.html#" target="_blank">刷新页面</a><a href="http://www.cnblogs.com/yangy608/archive/2011/10/07/2200669.html#top" target="_blank">返回顶部</a></p>
<p>（评论功能已被博主禁用）
<a href="http://q.cnblogs.com/" target="_blank">程序员问答社区，解决您的技术难题</a></p>
<p><a href="http://www.cnblogs.com/" title="程序员的网上家园" target="_blank">博客园首页</a><a href="http://q.cnblogs.com/" title="程序员问答社区" target="_blank">博问</a><a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a></p>
<h3 id="-">公告</h3>
<p>Copyright ©2012 七郎</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/缓存/">缓存</a></li></span><span class="breadcrumb"><li><a href="/categories/缓存/">缓存</a></li><li><a href="/categories/缓存/ehcache/">ehcache</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ehcache/" class="label label-primary">ehcache</a><a href="/tags/缓存/" class="label label-success">缓存</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-缓存-ehcache--EHCache分布式缓存集群环境配置-七郎-博客园/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-缓存-ehcache--EHCache分布式缓存集群环境配置-七郎-博客园" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--UseJavascriptRedirection-CASUserManual-Jas/">Use Javascript Redirection </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--UseJavascriptRedirection-CASUserManual-Jas/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="use-javascript-redirection-cas-user-manual-jasig-wiki">Use Javascript Redirection - CAS User Manual - Jasig Wiki</h1>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#title-heading" target="_blank">Skip to content</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#breadcrumbs" target="_blank">Skip to breadcrumbs</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#header-menu-bar" target="_blank">Skip to header menu</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#navigation" target="_blank">Skip to action menu</a></li>
<li><p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#quick-search-query" target="_blank">Skip to quick search</a>
Quick Search</p>
</li>
<li><p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">Browse</a></p>
</li>
<li><p><a href="https://wiki.jasig.org/pages/listpages.action?key=CASUM" title="Browse pages in the CAS User Manual space ( Type &#39;g&#39; then &#39;s" target="_blank">Pages</a>&quot;)</p>
</li>
<li><a href="https://wiki.jasig.org/pages/viewrecentblogposts.action?key=CASUM" title="Browse blogs in the CAS User Manual space" target="_blank">Blog</a></li>
<li><a href="https://wiki.jasig.org/labels/listlabels-heatmap.action?key=CASUM" title="Browse labels in the CAS User Manual space" target="_blank">Labels</a></li>
<li><a href="https://wiki.jasig.org/spaces/listattachmentsforspace.action?key=CASUM" title="Browse attachments in the CAS User Manual space" target="_blank">Attachments</a></li>
<li><a href="https://wiki.jasig.org/mail/archive/viewmailarchive.action?key=CASUM" title="Browse mail in the CAS User Manual space" target="_blank">Mail</a></li>
<li><a href="https://wiki.jasig.org/spaces/viewspacesummary.action?key=CASUM" title="Browse additional space functions in the CAS User Manual space" target="_blank">Advanced</a></li>
<li><p><a href="https://wiki.jasig.org/spaces/usage/report.action?key=CASUM" target="_blank">Activity</a></p>
</li>
<li><p><a href="http://docs.atlassian.com/confluence/docs-41/whatsnew/iframe" target="_blank">What’s New</a></p>
</li>
<li><a href="https://wiki.jasig.org/spacedirectory/view.action" title="Browse the Confluence space directory" target="_blank">Space Directory</a></li>
<li><a href="https://wiki.jasig.org/dashboard/configurerssfeed.action" title="Create your custom RSS feed." target="_blank">Feed Builder</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" title="View available keyboard shortcuts ( Type &#39;?" target="_blank">Keyboard Shortcuts</a>&quot;)</li>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" title="Browse gadgets provided by Confluence" target="_blank">Confluence Gadgets</a></li>
<li><a href="https://wiki.jasig.org/login.action?os_destination=%2Fdisplay%2FCASUM%2FUse%2BJavascript%2BRedirection" target="_blank">Log In</a></li>
<li><a href="https://wiki.jasig.org/signup.action" target="_blank">Sign Up</a></li>
</ul>
<ol>
<li><a href="https://wiki.jasig.org/dashboard.action" title="Go to Dashboard ( Type &#39;g&#39; then &#39;d" target="_blank">Dashboard</a>&quot;)</li>
<li><a href="https://wiki.jasig.org/display/CASUM" target="_blank">CAS User Manual</a></li>
<li><strong>…</strong></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Navigation" target="_blank">Navigation</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Advanced+Topics" target="_blank">Advanced Topics</a></li>
<li><a href="">Use Javascript Redirection</a></li>
</ol>
<ul>
<li><p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">Tools</a></p>
</li>
<li><p><a href="https://wiki.jasig.org/pages/viewpageattachments.action?pageId=12157004" title="View Attachments ( Type &#39;t" target="_blank">Attachments (0)</a>&quot;)</p>
</li>
<li><a href="https://wiki.jasig.org/pages/viewpreviousversions.action?pageId=12157004" target="_blank">Page History</a></li>
<li><p><a href="https://wiki.jasig.org/pages/viewinfo.action?pageId=12157004" title="Edit restrictions" target="_blank">Restrictions</a></p>
</li>
<li><p><a href="https://wiki.jasig.org/pages/viewinfo.action?pageId=12157004" target="_blank">Info</a></p>
</li>
<li><a href="https://wiki.jasig.org/pages/viewinfo.action?pageId=12157004" title="Link to this Page ( Type &#39;k" target="_blank">Link to this Page…</a>&quot;)</li>
<li><a href="https://wiki.jasig.org/pages/listpages-dirview.action?key=CASUM&amp;openId=12157004#selectedPageInHierarchy" target="_blank">View in Hierarchy</a></li>
<li><a href="https://wiki.jasig.org/plugins/viewsource/viewpagesrc.action?pageId=12157004" target="_blank">View Source</a></li>
</ul>
<h1 id="-use-javascript-redirection-"><a href="">Use Javascript Redirection</a></h1>
<p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#page-metadata-end" target="_blank">Skip to end of metadata</a></p>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" title="Page restrictions apply. Click the lock icon to view or edit the restriction." target="_blank">Page restrictions apply</a></li>
<li>Added by <a href="https://wiki.jasig.org/display/~dale77" target="_blank">Dale Ogilvie</a>, last edited by <a href="https://wiki.jasig.org/display/~dale77" target="_blank">Dale Ogilvie</a> on Apr 30, 2008  (<a href="https://wiki.jasig.org/pages/diffpages.action?pageId=12157004&amp;originalId=52495846" target="_blank">view change</a>)</li>
<li><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">show comment</a> <a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">hide comment</a>
<strong>Comment:</strong> Corrected links that should have been relative instead of absolute.
<a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#page-metadata-start" target="_blank">Go to start of metadata</a>   Table of Contents</li>
</ul>
<h3 id="-home-https-wiki-jasig-org-display-casum-home-"><a href="https://wiki.jasig.org/display/CASUM/Home" target="_blank">Home</a></h3>
<h3 id="-overall-architecture-https-wiki-jasig-org-display-casum-overall-architecture-"><a href="https://wiki.jasig.org/display/CASUM/Overall+Architecture" target="_blank">Overall Architecture</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Building+and+Deploying" target="_blank">Building and Deploying</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Development" target="_blank">Development</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Introduction" target="_blank">Introduction</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Java+Versions" target="_blank">Java Versions</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Releasing" target="_blank">Releasing</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Spring+Configuration" target="_blank">Spring Configuration</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Technical+Overview" target="_blank">Technical Overview</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Upgrading" target="_blank">Upgrading</a></li>
</ul>
<h3 id="-authentication-https-wiki-jasig-org-display-casum-authentication-"><a href="https://wiki.jasig.org/display/CASUM/Authentication" target="_blank">Authentication</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Active+Directory" target="_blank">Active Directory</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Generic" target="_blank">Generic</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/JAAS" target="_blank">JAAS</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/JDBC" target="_blank">JDBC</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/LDAP" target="_blank">LDAP</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Legacy" target="_blank">Legacy</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/RADIUS" target="_blank">RADIUS</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/SPNEGO" target="_blank">SPNEGO</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Trusted" target="_blank">Trusted</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/X.509+Certificates" target="_blank">X.509 Certificates</a></li>
</ul>
<h3 id="-authentication-managers-https-wiki-jasig-org-display-casum-authentication-managers-"><a href="https://wiki.jasig.org/display/CASUM/Authentication+Managers" target="_blank">Authentication Managers</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Default+AuthenticationManager" target="_blank">Default AuthenticationManager</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Direct+Mapping+AuthenticationManager" target="_blank">Direct Mapping AuthenticationManager</a></li>
</ul>
<h3 id="-security-policy-https-wiki-jasig-org-display-casum-security-policy-"><a href="https://wiki.jasig.org/display/CASUM/Security+Policy" target="_blank">Security Policy</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Ticket+Expiration+Policy" target="_blank">Ticket Expiration Policy</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Remember+Me" target="_blank">Remember Me</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Throttling+Login+Attempts" target="_blank">Throttling Login Attempts</a></li>
</ul>
<h3 id="-ticketregistry-https-wiki-jasig-org-display-casum-ticketregistry-"><a href="https://wiki.jasig.org/display/CASUM/TicketRegistry" target="_blank">TicketRegistry</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/BerkleyDB" target="_blank">BerkleyDB</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Default" target="_blank">Default</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/EhcacheTicketRegistry" target="_blank">EhcacheTicketRegistry</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/JBOSS+TreeCache" target="_blank">JBOSS TreeCache</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/JDBCTicketRegistry" target="_blank">JDBCTicketRegistry</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/JpaTicketRegistry" target="_blank">JpaTicketRegistry</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/MemcacheTicketRegistry" target="_blank">MemcacheTicketRegistry</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/TicketRegistry+Cleaner" target="_blank">TicketRegistry Cleaner</a></li>
</ul>
<h3 id="-testing-https-wiki-jasig-org-display-casum-testing-"><a href="https://wiki.jasig.org/display/CASUM/Testing" target="_blank">Testing</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Apache+JMeter" target="_blank">Apache JMeter</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Java+HttpComponents+Based+Test+Class" target="_blank">Java HttpComponents Based Test Class</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Nagios+plugins" target="_blank">Nagios plugins</a></li>
</ul>
<h3 id="-protocols-https-wiki-jasig-org-display-casum-protocols-"><a href="https://wiki.jasig.org/display/CASUM/Protocols" target="_blank">Protocols</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Add+Your+Custom+Protocol" target="_blank">Add Your Custom Protocol</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Applications+that+Require+POST+Responses" target="_blank">Applications that Require POST Responses</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/CAS" target="_blank">CAS</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/OAuth" target="_blank">OAuth</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/OpenID" target="_blank">OpenID</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/RESTful+API" target="_blank">RESTful API</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/SAML+1.1" target="_blank">SAML 1.1</a></li>
<li><a href="https://wiki.jasig.org/pages/viewpage.action?pageId=6063484" target="_blank">SAML 2.0 (Google Accounts Integration)</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Single+Sign+Out" target="_blank">Single Sign Out</a></li>
</ul>
<h3 id="-advanced-topics-https-wiki-jasig-org-display-casum-advanced-topics-"><a href="https://wiki.jasig.org/display/CASUM/Advanced+Topics" target="_blank">Advanced Topics</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/pages/viewpage.action?pageId=13570204" target="_blank">Adding &quot;Public Workstation&quot; vs. &quot;Private Workstation&quot; Timeouts</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Auditing+and+Statistics+Via+Inspektr" target="_blank">Auditing and Statistics Via Inspektr</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Internationalization" target="_blank">Internationalization</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/LDAP+Password+Policy+Enforcement" target="_blank">LDAP Password Policy Enforcement</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Second-Level+CAS+Server" target="_blank">Second-Level CAS Server</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Terracotta" target="_blank">Terracotta</a></li>
<li><a href="">Use Javascript Redirection</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Deployment+Scenarios" target="_blank">Deployment Scenarios</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Acceptable+Use+interface+for+Login+Webflow" target="_blank">Acceptable Use interface for Login Webflow</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Change+Password+Integration+With+Jasig+CAS+3.4.7" target="_blank">Change Password Integration With Jasig CAS 3.4.7</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Localization" target="_blank">Localization</a></li>
</ul>
<h3 id="-tutorials-and-howtos-https-wiki-jasig-org-display-casum-tutorials-and-howtos-"><a href="https://wiki.jasig.org/display/CASUM/Tutorials+and+HOWTOs" target="_blank">Tutorials and HOWTOs</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/CAS+on+Windows+Quick+Setup+Guide" target="_blank">CAS on Windows Quick Setup Guide</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Clustering+CAS" target="_blank">Clustering CAS</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Demo" target="_blank">Demo</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Configure+JBoss+for+HTTPS" target="_blank">HOWTO Configure JBoss for HTTPS</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Configure+Single+Sign+On+Session+Timeout" target="_blank">HOWTO Configure Single Sign On Session Timeout</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Setup+Dual+Authentication+in+CAS+-+SSL+Client+Auth+and+LDAP" target="_blank">HOWTO Setup Dual Authentication in CAS - SSL Client Auth and LDAP</a></li>
<li><a href="https://wiki.jasig.org/pages/viewpage.action?pageId=10650669" target="_blank">HOWTO Setup LDAP GSSAPI+Kerberos Authentication in CAS</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Switch+to+Sun+JVM+in+RHEL" target="_blank">HOWTO Switch to Sun JVM in RHEL</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/End-to-end+Windows+Example" target="_blank">End-to-end Windows Example</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Use+Jasypt+to+encrypt+passwords+in+configuration+files" target="_blank">HOWTO Use Jasypt to encrypt passwords in configuration files</a></li>
<li><a href="https://wiki.jasig.org/pages/viewpage.action?pageId=47874068" target="_blank">HOWTO utilize javax.servlet.http.HttpServletRequest isUserInRole( java.lang.String role )</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Migrating+an+existing+CAS+server+installation" target="_blank">Migrating an existing CAS server installation</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Best+Practice+-+Setting+Up+CAS+Locally+using+the+Maven2+WAR+Overlay+Method" target="_blank">Best Practice - Setting Up CAS Locally using the Maven2 WAR Overlay Method</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Deploying+CAS+3.0.x+in+RHEL+5+with+Sun+Java" target="_blank">Deploying CAS 3.0.x in RHEL 5 with Sun Java</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+CASifying+ASP.NET+WebApp+-+ExampleWebsite" target="_blank">HOWTO CASifying ASP.NET WebApp - ExampleWebsite</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Configure+CAS+for+LDAP+DIGEST-MD5" target="_blank">HOWTO Configure CAS for LDAP DIGEST-MD5</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/HOWTO+Run+Canoo+Web+Tests" target="_blank">HOWTO Run Canoo Web Tests</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Shibboleth-CAS+Integration" target="_blank">Shibboleth-CAS Integration</a></li>
</ul>
<h3 id="-troubleshooting-https-wiki-jasig-org-display-casum-troubleshooting-"><a href="https://wiki.jasig.org/display/CASUM/Troubleshooting" target="_blank">Troubleshooting</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Logging" target="_blank">Logging</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/SSL+Troubleshooting+and+Reference+Guide" target="_blank">SSL Troubleshooting and Reference Guide</a></li>
</ul>
<h3 id="-services-management-https-wiki-jasig-org-display-casum-services-management-"><a href="https://wiki.jasig.org/display/CASUM/Services+Management" target="_blank">Services Management</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/Adding+a+New+Service" target="_blank">Adding a New Service</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Attributes" target="_blank">Attributes</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Configuring" target="_blank">Configuring</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Deleting" target="_blank">Deleting</a></li>
<li><a href="https://wiki.jasig.org/display/CASUM/Editing" target="_blank">Editing</a></li>
</ul>
<h3 id="-extensions-https-wiki-jasig-org-display-casum-extensions-"><a href="https://wiki.jasig.org/display/CASUM/Extensions" target="_blank">Extensions</a></h3>
<ul>
<li><a href="https://wiki.jasig.org/display/CASUM/ClearPass" target="_blank">ClearPass</a>
When redirecting from the https CAS application back to an http service after authenticating successfully, IE6 presents the user with a security dialog saying &quot;you are about to be redirected to a connection that is not secure, do you really want to do this?&quot;. We can avoid this by using javascript to perform the redirection in the client browser, instead of a server side redirect. This approach works fine for web pages, but does not work for protected image content, which will not execute the returned javascript, so we revert to a serverside redirect for this type of content.</li>
</ul>
<ol>
<li>Create WEB-INF/view/jsp/default/ui/redirect.jsp to perform the redirection using javascript
<a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">?</a>&lt;%</li>
</ol>
<p>@page</p>
<p>import</p>
<p>=</p>
<p>&quot;org.jasig.cas.authentication.principal.WebApplicationService&quot;</p>
<p>%&gt;</p>
<p>&lt;%</p>
<p>@page</p>
<p>import</p>
<p>=</p>
<p>&quot;org.jasig.cas.web.support.WebUtils&quot;</p>
<p>%&gt;
&lt;%</p>
<p>@page</p>
<p>import</p>
<p>=</p>
<p>&quot;java.net.URL&quot;</p>
<p>%&gt;</p>
<p>&lt;%
WebApplicationService service = (WebApplicationService) request.getAttribute(</p>
<p>&quot;service&quot;</p>
<p>);</p>
<p>String ticket  = (String) request.getAttribute(</p>
<p>&quot;serviceTicketId&quot;</p>
<p>);
String redirectURL = service.getResponse(ticket).getUrl();</p>
<p>boolean</p>
<p>serverSideRedirect =</p>
<p>false</p>
<p>;
// if redirect is for an image, js or css file</p>
<p>URL url =</p>
<p>new</p>
<p>URL(redirectURL);
String path = url.getPath();</p>
<p>int</p>
<p>dotPos = path.lastIndexOf(</p>
<p>&quot;.&quot;</p>
<p>);</p>
<p>// returns -1 if not found
if</p>
<p>( dotPos != -</p>
<p>1</p>
<p>)</p>
<p>{</p>
<p>String ext = path.substring(dotPos).toLowerCase();</p>
<p>serverSideRedirect =</p>
<p>&quot;.gif&quot;</p>
<p>.equals(ext) ||</p>
<p>&quot;.jpg&quot;</p>
<p>.equals(ext) ||</p>
<p>&quot;.png&quot;</p>
<p>.equals(ext) ||</p>
<p>&quot;.js&quot;</p>
<p>.equals(ext) ||</p>
<p>&quot;.css&quot;</p>
<p>.equals(ext);
}</p>
<p>if</p>
<p>( serverSideRedirect )
{</p>
<p>// Serverside redirect using HTTP 302</p>
<p>response.sendRedirect(redirectURL);</p>
<p>}
else</p>
<p>{</p>
<p>// Client side redirect using javascript</p>
<p>%&gt;
&lt;!DOCTYPE html PUBLIC</p>
<p>&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</p>
<p>&quot;<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" target="_blank"><a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>&quot;</a></p>
<p>&gt;</p>
<html xmlns=

"[http://www.w3.org/1999/xhtml"](http://www.w3.org/1999/xhtml)

>


<head>



<script type=

"text/javascript"

language=

"javascript"

>


<!--



window.location.replace (

"<%=redirectURL%>"

);


-->



</script>


<title>Redirect</title>



</head>


<body></body>

<p></html>
&lt;%</p>
<p>}
%&gt;</p>
<ol>
<li>Make a redirect view available to CAS by adding it to WEB-INF/classes/default_view.properties</li>
</ol>
<p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">?</a>/#/#/# Redirect view (logged in, javascript redirect to service)</p>
<p>redirectView.(</p>
<p>class</p>
<p>)=org.springframework.web.servlet.view.JstlView
redirectView.url=/WEB-INF/view/jsp/</p>
<p>default</p>
<p>/ui/redirect.jsp</p>
<ol>
<li>Modify WEB-INF/login-webflow.xml to make the redirect end state use the new view</li>
</ol>
<p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" target="_blank">?</a>&lt;end-state id=</p>
<p>&quot;redirect&quot;</p>
<p>view=</p>
<p>&quot;redirectView&quot;</p>
<p>/&gt;</p>
<p>Labels:</p>
<p>None</p>
<p><a href="https://wiki.jasig.org/display/CASUM/Use+Javascript+Redirection#" title="Edit Labels ( Type &#39;l" target="_blank">Edit Labels</a>&quot;)
Powered by a free <strong>Atlassian Confluence Open Source Project License</strong> granted to Java Architectures Special Interest Group. <a href="http://www.atlassian.com/c/conf/11461" target="_blank">Evaluate Confluence today</a>.
This Confluence installation runs a Free Gliffy License - <a href="http://www.gliffy.com/products/confluence-plugin/" target="_blank">Evaluate Gliffy</a> for your Wiki!</p>
<ul>
<li>Powered by <a href="http://www.atlassian.com/software/confluence" target="_blank">Atlassian Confluence</a> 4.1.5, the <a href="http://www.atlassian.com/software/confluence/tour/enterprise-wiki.jsp" target="_blank">Enterprise Wiki</a></li>
<li>Printed by Atlassian Confluence 4.1.5, the Enterprise Wiki.</li>
<li>·  <a href="http://jira.atlassian.com/secure/BrowseProject.jspa?id=10470" target="_blank">Report a bug</a></li>
<li>·  <a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" target="_blank">Atlassian News</a></li>
</ul>
<p><a href=""></a><a href=""></a><a href=""></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--UseJavascriptRedirection-CASUserManual-Jas/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--UseJavascriptRedirection-CASUserManual-Jas" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--CAS返回多个信息为空--ITeye技术网站/">CAS 返回多个信息为空 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--CAS返回多个信息为空--ITeye技术网站/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="cas-iteye-">CAS 返回多个信息为空 - - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">资讯</a> <a href="http://www.iteye.com/magazines" target="_blank">精华</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a> <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://liuzhiyi7288.iteye.com/blog/1135001#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://liuzhiyi7288.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://liuzhiyi7288.iteye.com/login" target="_blank">登录</a> <a href="http://liuzhiyi7288.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-liuzhiyi7288-http-liuzhiyi7288-iteye-com-"><a href="http://liuzhiyi7288.iteye.com/" target="_blank">liuzhiyi7288</a></h1>
<ul>
<li><a href="http://liuzhiyi7288.iteye.com/" target="_blank"><strong>博客</strong></a></li>
<li><a href="http://liuzhiyi7288.iteye.com/weibo" target="_blank">微博</a></li>
<li><a href="http://liuzhiyi7288.iteye.com/album" target="_blank">相册</a></li>
<li><a href="http://liuzhiyi7288.iteye.com/link" target="_blank">收藏</a></li>
<li><a href="http://liuzhiyi7288.iteye.com/blog/guest_book" target="_blank">留言</a></li>
<li><a href="http://liuzhiyi7288.iteye.com/blog/profile" target="_blank">关于我</a></li>
</ul>
<h3 id="-cas-"><a href="">CAS 返回多个信息为空</a> **</h3>
<p>CAS client 端使用Filter 获得server端传回的信息，如果多个信息使用：
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><p>assertion.getPrincipal().getAttributes()<br>assertion.getPrincipal().getAttributes()来获得一个Map，但是有的时候Map中没有数据为null；
解决方案：配置deployerConfigContext.xml中名称为serviceRegistryDao的bean，如下
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
</li>
<li><bean id="serviceRegistryDao" class="org.jasig.cas.services.InMemoryServiceRegistryDaoImpl">  </li>
<li><property name="registeredServices">  </li>
<li><list>  </li>
<li>&lt;bean class=&quot;org.jasig.cas.services.RegisteredServiceImpl&quot;   </li>
<li>p:id=&quot;1&quot;  </li>
<li>p:description=&quot;test&quot;  </li>
<li>p:serviceId=&quot;<a href="http://192.168.104.101:8080//*" target="_blank">http://192.168.104.101:8080//*</a>&quot;  </li>
<li>p:enabled=&quot;true&quot;   </li>
<li>p:ssoEnabled=&quot;true&quot;   </li>
<li>p:anonymousAccess=&quot;false&quot;&gt;  </li>
<li><property name="allowedAttributes" value="key1,key2,key3"/>  </li>
<li></bean>                    </list>  </li>
<li><p></property><br><bean id="serviceRegistryDao" class="org.jasig.cas.services.InMemoryServiceRegistryDaoImpl"> <property name="registeredServices"> <list> <bean class="org.jasig.cas.services.RegisteredServiceImpl" p:id="1" p:description="test" p:serviceId="http://192.168.104.101:8080//*" p:enabled="true" p:ssoEnabled="true" p:anonymousAccess="false"> <property name="allowedAttributes" value="key1,key2,key3"/> </bean> </list> </property>，其中最重要的配置为：<property name="allowedAttributes" value="key1,key2,key3"/>
这个属性决定了我们在client端获得map是否为null，如果不配置该属性则为null，该属性配置我们返回多个信息对应的key；
此处对应CAS SERVER端源码如下 CentralAuthenticationServiceImpl.java：
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
</li>
<li><p>// 获得deployerConfigContext.xml中serviceRegistryDao配置的registeredServices  </p>
</li>
<li>final RegisteredService registeredService = this.servicesManager  </li>
<li><p>.findServiceBy(service);<br>// 获得deployerConfigContext.xml中serviceRegistryDao配置的registeredServices final RegisteredService registeredService = this.servicesManager .findServiceBy(service);
allowwedAttributes配置对应的代码如下：
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
</li>
<li><p>//<em>/</em> </p>
</li>
<li>/* 从principal.getAttributes()获得map后，获取registeredService的allowedAttributes属性， </li>
<li>/* 可以对应的key存入返回客户端信息的中map中 </li>
<li>/*/  </li>
<li>for (final String attribute : registeredService  </li>
<li>.getAllowedAttributes()) {  </li>
<li>final Object value = principal.getAttributes().get(  </li>
<li>attribute);  </li>
<li>if (value != null) {  </li>
<li>attributes.put(attribute, value);  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>final Principal modifiedPrincipal = new SimplePrincipal(  </li>
<li>principalId, attributes);  </li>
<li></li>
<li>final MutableAuthentication mutableAuthentication = new MutableAuthentication(  </li>
<li>modifiedPrincipal);<br>//<em>/</em> /<em> 从principal.getAttributes()获得map后，获取registeredService的allowedAttributes属性， /</em> 可以对应的key存入返回客户端信息的中map中 /*/ for (final String attribute : registeredService .getAllowedAttributes()) { final Object value = principal.getAttributes().get( attribute); if (value != null) { attributes.put(attribute, value); } } final Principal modifiedPrincipal = new SimplePrincipal( principalId, attributes); final MutableAuthentication mutableAuthentication = new MutableAuthentication( modifiedPrincipal);；
希望对大家有所帮助
分享到： <a href="&quot;分享到新浪微博&quot;"><img src="" alt=""></a> <a href="&quot;分享到腾讯微博&quot;"><img src="" alt=""></a></li>
</ol>
<p><a href="http://liuzhiyi7288.iteye.com/blog/1135037" title="CAS client 端添加初始化参数传到server端" target="_blank">CAS client 端添加初始化参数传到server端</a> | <a href="http://liuzhiyi7288.iteye.com/blog/1132260" title="CAS 集成java 登录成功后空白页面" target="_blank">CAS 集成java 登录成功后空白页面</a></p>
<ul>
<li>2011-07-28 17:21</li>
<li>浏览 389</li>
<li><a href="http://liuzhiyi7288.iteye.com/blog/1135001#comments" target="_blank">评论(1)</a></li>
<li>分类:<a href="http://www.iteye.com/blogs/category/opensource" target="_blank">开源软件</a></li>
<li><a href="http://www.iteye.com/wiki/blog/1135001" target="_blank">相关推荐</a></li>
</ul>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<p>1 楼 <a href="http://solomon.iteye.com/" title="solomon" target="_blank">solomon</a> 2011-10-31  </p>
<p>  不错，雪中送炭。　<img src="" alt=""></p>
<h3 id="-">发表评论</h3>
<p><a href="http://liuzhiyi7288.iteye.com/login" target="_blank"><img src="" alt=""></a><a href="http://liuzhiyi7288.iteye.com/login" target="_blank">您还没有登录,请您登录后再发表评论</a></p>
<p><a href="http://liuzhiyi7288.iteye.com/" target="_blank"><img src="&quot;liuzhiyi7288的博客: &quot;" alt="liuzhiyi7288的博客"></a></p>
<p>liuzhiyi7288</p>
<ul>
<li>浏览: 2639 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 北京</li>
<li><img src="" alt=""><h3 id="-http-liuzhiyi7288-iteye-com-blog-user_visits-">最近访客 <a href="http://liuzhiyi7288.iteye.com/blog/user_visits" target="_blank">更多访客&gt;&gt;</a></h3>
</li>
</ul>
<p><a href="http://mzmingly.iteye.com/" target="_blank"><img src="&quot;mzmingly的博客: &quot;" alt="mzmingly的博客"></a></p>
<p><a href="http://mzmingly.iteye.com/" title="mzmingly" target="_blank">mzmingly</a></p>
<p><a href="http://hasker.iteye.com/" target="_blank"><img src="&quot;hasker的博客: &quot;" alt="hasker的博客"></a></p>
<p><a href="http://hasker.iteye.com/" title="hasker" target="_blank">hasker</a>
<a href="http://ninisui.iteye.com/" target="_blank"><img src="&quot;ninisui的博客: &quot;" alt="ninisui的博客"></a></p>
<p><a href="http://ninisui.iteye.com/" title="ninisui" target="_blank">ninisui</a></p>
<p><a href="http://dawnstars.iteye.com/" target="_blank"><img src="&quot;dawnstars的博客: dawnstars&quot;" alt="dawnstars的博客"></a></p>
<p><a href="http://dawnstars.iteye.com/" title="dawnstars" target="_blank">dawnstars</a></p>
<h3 id="-">文章分类</h3>
<ul>
<li><a href="http://liuzhiyi7288.iteye.com/" target="_blank">全部博客 (9)</a></li>
<li><p><a href="http://liuzhiyi7288.iteye.com/category/199341" target="_blank">svn branch merge trunk (1)</a></p>
<h3 id="-">社区版块</h3>
</li>
<li><p><a href="http://liuzhiyi7288.iteye.com/blog/news" target="_blank">我的资讯</a> (0)</p>
</li>
<li><a href="http://liuzhiyi7288.iteye.com/blog/post" target="_blank">我的论坛</a> (0)</li>
<li><a href="http://liuzhiyi7288.iteye.com/blog/answered_problems" target="_blank">我的问答</a> (1)</li>
</ul>
<h3 id="-">存档分类</h3>
<ul>
<li><a href="http://liuzhiyi7288.iteye.com/blog/monthblog/2012-01" target="_blank">2012-01</a> (1)</li>
<li><a href="http://liuzhiyi7288.iteye.com/blog/monthblog/2011-12" target="_blank">2011-12</a> (1)</li>
<li><a href="http://liuzhiyi7288.iteye.com/blog/monthblog/2011-10" target="_blank">2011-10</a> (1)</li>
<li><p><a href="http://liuzhiyi7288.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://liuzhiyi7288.iteye.com/blog/1290155" title="openOffice  conversion failed: could not load input document" target="_blank">openOffice conversion failed: could not ...</a></p>
</li>
<li><a href="http://liuzhiyi7288.iteye.com/blog/1334978" title="from branch merge to trunk" target="_blank">from branch merge to trunk</a></li>
<li><a href="&quot;CAS 返回多个信息为空&quot;">CAS 返回多个信息为空</a></li>
<li><a href="http://liuzhiyi7288.iteye.com/blog/1132260" title="CAS 集成java 登录成功后空白页面" target="_blank">CAS 集成java 登录成功后空白页面</a></li>
</ul>
<h3 id="-">最新评论</h3>
<ul>
<li><a href="http://muqingren.iteye.com/" title="muqingren" target="_blank">muqingren</a>： 我没用过这个组件，抱歉
<a href="http://liuzhiyi7288.iteye.com/blog/1290155#bc2252321" target="_blank">openOffice conversion failed: could not load input document</a></li>
<li><a href="http://muqingren.iteye.com/" title="muqingren" target="_blank">muqingren</a>： 辛苦
<a href="http://liuzhiyi7288.iteye.com/blog/1334978#bc2252320" target="_blank">from branch merge to trunk</a></li>
<li><a href="http://muqingren.iteye.com/" title="muqingren" target="_blank">muqingren</a>： ...
<a href="http://liuzhiyi7288.iteye.com/blog/1334978#bc2252317" target="_blank">from branch merge to trunk</a></li>
<li><a href="http://chinacq.iteye.com/" title="chinacq" target="_blank">chinacq</a>： 我没有用到 XComponent document，但是上传有 ...
<a href="http://liuzhiyi7288.iteye.com/blog/1290155#bc2248988" target="_blank">openOffice conversion failed: could not load input document</a></li>
<li><a href="http://solomon.iteye.com/" title="solomon" target="_blank">solomon</a>：   不错，雪中送炭。　
<a href="http://liuzhiyi7288.iteye.com/blog/1135001#bc2225743" target="_blank">CAS 返回多个信息为空</a>
声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2011 ITeye.com. All rights reserved. [ 京ICP证110151号 京公网安备110105010620 ]
<img src="" alt=""></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--CAS返回多个信息为空--ITeye技术网站/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--CAS返回多个信息为空--ITeye技术网站" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全--企业网络信息安全保护措施的探讨与实践/">企业网络信息安全保护措施的探讨与实践</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全--企业网络信息安全保护措施的探讨与实践/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">企业网络信息安全保护措施的探讨与实践</h1>
<p>企业网络信息安全保护措施的探讨与实践</p>
<p>原文链接：<a href="http://www.securitycn.net/html/research/service/2337.html" target="_blank"><a href="http://www.securitycn.net/html/research/service/2337.html">http://www.securitycn.net/html/research/service/2337.html</a></a></p>
<p>随着企业网络的普及和网络开放性，共享性，互连程度的扩大，网络的信息安全问题也越来越引起人们的重视。一个安全的计算机网络应该具有可靠性、可用性、完整性、保密性和真实性等特点。计算机网络不仅要保护计算机网络设备安全和计算机网络系统安全，还要保护数据安全。</p>
<pre><code>网络安全风险分析



计算机系统本身的脆弱性和通信设施的脆弱性共同构成了计算机网络的潜在威胁。信息网络化使信息公开化、信息利用自由化，其结果是信息资源的共享和互动，任何人都可以在网上发布信息和获取信息。



这样，网络信息安全问题就成为危害网络发展的核心问题，与外界的因特网连接使信息受侵害的问题尤其严重。目前企业网络信息的不安全因素来自病毒、黑客、木马、垃圾邮件等几个方面。



计算机病毒是一种危害计算机系统和网络安全的破坏性程序。它可以直接破坏计算机数据信息，也可以大量占用磁盘空间、抢占系统资源从而干扰了系统的正常运行。



随着Internet技术的发展、企业网络环境的日趋成熟和企业网络应用的增多，病毒的感染、传播的能力和途径也由原来的单一、简单变得复杂、隐蔽，尤其是Internet环境和企业网络环境为病毒传播、生存提供了环境。



黑客攻击已经成为近年来经常发生的事情，网络中服务器被攻击的事件层出不穷。黑客利用计算机系统、网络协议及数据库等方面的漏洞和缺陷，采用破解口令(password cracking)、天窗(trapdoor)、后门(backdoor)、特洛伊木马(Trojan horse)等手段侵入计算机系统，进行信息破坏或占用系统资源，使得用户无法使用自己的机器。



一般大型企业的网络都拥有Internet连接，同时对外提供的WWW和EMAIL等服务。因此企业内部网络通过Internet连接外部进行大量的信息交换，而其中大约80%信息是电子邮件，邮件中又有一半以上的邮件是垃圾邮件，这一比例还在逐年上升。



企业局域网内部的信息安全更是不容忽视的。网络内部各节点之间通过网络共享网络资源，就可能因无意中把重要的涉密信息或个人隐私信息存放在共享目录下，因此造成信息泄漏；甚至存在内部人员编写程序通过网络进行传播，或者利用黑客程序入侵他人主机的现象。因此，网络安全不仅要防范外部网，同时更防范内部网。



网络安全措施



由此可见，有众多的网络安全风险需要考虑，因此，企业必须采取统一的安全策略来保证网络的安全性。一个完整的安全技术和产品包括：身份认证、访问控制、流量监测、网络加密技术、防火墙、入侵检测、防病毒、漏洞扫描等；而造成安全事件的原因则包括技术因素、管理因素以及安全架构设计上的疏漏等问题。



1.外部入侵的防范措施



(1)网络加密(Ipsec)



IP层是TCP/IP网络中最关键的一层，IP作为网络层协议，其安全机制可对其上层的各种应用服务提供透明的覆盖式安全保护。因此，IP安全是整个TCP/IP安全的基础，是网络安全的核心。IPSec是目前唯一一种能为任何形式的Internet通信提供安全保障的协议。IPSec允许提供逐个数据流或者逐个连接的安全，所以能实现非常细致的安全控制。对于用户来说，便可以对于不同的需要定义不同级别地安全保护(即不同保护强度的IPSec通道)。IPSec为网络数据传输提供了数据机密性、数据完整性、数据来源认证、抗重播等安全服务，使得数据在通过公共网络传输时，不用担心被监视、篡改和伪造。



IPSec是通过使用各种加密算法、验证算法、封装协议和一些特殊的安全保护机制来实现这些目的，而这些算法及其参数是保存在进行IPSec通信两端的SA(Security Association，安全联盟)，当两端的SA中的设置匹配时，两端就可以进行IPSec通信了。



在虚拟专用网(VPN)中主要采用了IPSec技术。



(2)防火墙



防火墙是一种网络安全保障手段，是网络通信时执行的一种访问控制尺度，其主要目标就是通过控制进、出一个网络的权限，在内部和外部两个网络之间建立一个安全控制点，对进、出内部网络的服务和访问进行控制和审计，防止外部网络用户以非法手段通过外部网络进入内部网络，访问、干扰和破坏内部网络资源。在逻辑上，防火墙是一个分离器，一个限制器，也是一个分析器，有效地监视了内部网络和Internet之间的任何活动，保证了内部网络的安全。



防火墙有软、硬件之分，实现防火墙功能的软件，称为软件防火墙。软件防火墙运行于特定的计算机上，它需要计算机操作系统的支持。基于专用的硬件平台的防火墙系统，称为硬件防火墙。它们也是基于PC架构，运行一些经过裁剪和简化的操作系统，承载防火墙软件。



(3)入侵检测



部署入侵检测产品，并与防火墙联动，以监视局域网外部绕过或透过防火墙的攻击，并及时触发联动的防火墙及时关闭该连接；同时监视主服务器网段的异常行为，以防止来自局域网内部的攻击或无意的误用及滥用行为。入侵检测是防火墙的合理补充，帮助系统对付网络攻击，扩展了系统管理员的安全管理能力。



2.内部非法活动的防范措施



(1)身份认证



网络安全身份认证是指登录计算机网络时系统对用户身份的确认技术。是网络安全的第一道防线，也是最重要的一道防线。用户在访问安全系统之前，首先经过身份认证系统识别身份，然后访问监控器根据用户的身份和授权数据库决定用户是否能够访问某个资源。授权数据库由安全管理员按照需要进行配置。



审计系统根据审计设置记录用户的请求和行为，同时入侵检测系统实时或非实时地检测是否有入侵行为。访问控制和审计系统都要依赖于身份认证系统提供的用户的身份。身份认证在安全系统中的地位极其重要，是最基本的安全服务，其它的安全服务都要依赖于它。一旦身份认证系统被攻破，那么系统的所有安全措施将形同虚设。黑客攻击的目标往往就是身份认证系统，因此身份认证实在是网络安全的关键。



(2)访问控制



访问控制决定了用户可以访问的网络范围、使用的协议、端口；能访问系统的何种资源以及如何使用这些资源。



在路由器上可以建立访问控制列表，它是应用在路由器接口的指令列表，这些指令列表用来告诉路由器哪些数据包可以接收、哪些数据包需要拒绝。至于数据包是被接收还是被拒绝，可以由类似于源地址、目的地址、端口号、协议等特定指示条件来决定。



建立访问控制列表后，可以限制网络流量，提高网络性能，对通信流量起到控制的手段，这也是对网络访问的基本安全手段。由于访问控制列表ACL(Access Control List)的表项可以灵活地增加，所以可以把ACL当作一种网络控制的有力工具，用来过滤流入和流出路由器接口的数据包。



在应用系统中，访问控制的手段包括用户识别代码、口令、登录控制、资源授权(例如用户配置文件、资源配置文件和控制列表)、授权核查、日志和审计。适当的访问控制能够阻止未经允许的用户有意或无意地获取数据，根据授予的权限限制其对资源的利用范围和程度。



(3)流量监测



目前有很多因素造成网络的流量异常，如拒绝服务攻击(DoS)、网络蠕虫病毒的传播、一些网络扫描工具产生的大量TCP连接请求等，很容易使网络设备瘫痪。这些网络攻击，都是利用系统服务的漏洞或利用网络资源的有限性，在短时间内发动大规模网络攻击，消耗特定资源，造成网络或计算机系统瘫痪。因此监控网络的异常流量非常重要。



流量监测技术主要有基于SNMP的流量监测和基于Netflow的流量监测。基于SNMP的流量信息采集，是通过提取网络设备Agent提供的MIB(管理对象信息库)中收集一些具体设备及流量信息有关的变量。



基于SNMP收集的网络流量信息包括：输入字节数、输入非广播包数、输入广播包数、输入包丢弃数、输入包错误数、输入未知协议包数、输出字节数、输出非广播包数、输出广播包数、输出包丢弃数、输出包错误数、输出队长等。基于Netflow流量信息采集是基于网络设备提供的Netflow机制实现的网络流量信息采集，在此基础上实现的流量信息采集效率和效果均能够满足网络流量异常监测的需求。



基于以上的流量检测技术，目前有很多流量监控管理软件，此类软件是判断异常流量流向的有效工具，通过流量大小变化的监控，可以帮助网管人员发现异常流量，特别是大流量异常流量的流向，从而进一步查找异常流量的源、目的地址。



处理异常流量最直接的解决办法是切断异常流量源设备的物理连接，也可以采用访问控制列表进行包过滤或在路由器上进行流量限定的方法控制异常流量。



(4)漏洞扫描



对一个网络系统而言，存在不安全隐患，将是黑客攻击得手的关键因素。就目前的网络系统来说，在硬件、软件、协议的具体实现或系统安全策略方面都可能存在一定的安全缺陷即安全漏洞。及时检测出网络中每个系统的安全漏洞是至关重要的。



安全扫描是增强系统安全性的重要措施之一，它能够有效地预先评估和分析系统中的安全问题。漏洞扫描系统是用来自动检测远程或本地主机安全漏洞的程序，按功能可分为：操作系统漏洞扫描、网络漏洞扫描和数据库漏洞扫描。网络漏洞扫描系统，是指通过网络远程检测目标网络和主机系统漏洞的程序，它对网络系统和设备进行安全漏洞检测和分析，从而发现可能被入侵者非法利用的漏洞。



定期对网络系统进行漏洞扫描，可以主动发现安全问题并在第一时间完成有效防护，让攻击者无隙可钻。



(5)防病毒



企业防病毒系统应该具有系统性与主动性的特点，能够实现全方位多级防护。 考虑到病毒在网络中存储、传播、感染的方式各异且途径多种多样，相应地在构建网络防病毒系统时，应利用全方位的企业防毒产品，实施集中控制、以防为主、防杀结合的策略。具体而言，就是针对网络中所有可能的病毒攻击设置对应的防毒软件，通过全方位、多层次的防毒系统配置，使网络没有薄弱环节成为病毒入侵的缺口。



实例分析



大庆石化局域网是企业网络，覆盖大庆石化机关、各生产厂和其他的二级单位，网络上运行着各种信息管理系统，保存着大量的重要数据。为了保证网络的安全，针对计算机网络本身可能存在的安全问题，在网络安全管理上我们采取了以下技术措施：



1.利用PPPOE拨号上网的方式登录局域网



我们对网络用户实施了身份认证技术管理。用户采用 PPPOE拨号方式上局域网，即用户在网络物理线路连通的情况下，需要通过拨号获得IP地址才能上局域网。我们选用华为ISN8850智能IP业务交换机作为宽带接入服务器(BAS)，RADIUS服务器作用户认证系统，每个用户都以实名注册，这样我们就可以管理用户的网上行为，实现了对以太网接入用户的管理。



2.设置访问控制列表



在我们的网络中有几十台路由交换机，在交换机上我们配置了访问控制列表，根据信息流的源和目的 IP 地址或网段，使用允许或拒绝列表，更准确地控制流量方向，并确保 IP 网络免遭网络侵入。



3.划分虚拟子网



在局域网中，我们把不同的单位划分成不同的虚拟子网(VLAN)。对于网络安全要求特别高的应用，如医疗保险和财务等，划分独立的虚拟子网，并使其与局域网隔离，限制其他VLAN成员的访问，确保了信息的保密安全。



4.在网络出口设置防火墙



在局域网的出口，我们设置了防火墙设备，并对防火墙制定安全策略，对一些不安全的端口和协议进行限制，使所有的服务器、工作站及网络设备都在防火墙的保护之下，同时配置一台日志服务器记录、保存防火墙日志，详细记录了进、出网络的活动。



5.部署Symantec防病毒系统



我们在大庆石化局域网内部署了Symantec防病毒系统。Symantec系统具有跨平台的技术及强大功能，系统中心是中央管理控制台。通过该管理控制台集中管理运行Symantec AntiVirus 企业版的服务器和客户端；可以启动和调度扫描，以及设置实时防护，从而建立并实施病毒防护策略，管理病毒定义文件的更新，控制活动病毒，管理计算机组的病毒防护、查看扫描、病毒检测和事件历史记录等功能。



6.利用高效的网络管理软件管理全网



大庆石化局域网的网络环境比较复杂，含有多种cisco交换设备、华为交换设备、路由设备以及其他一些接入设备，为了能够有效地网络，我们采用了BT_NM网络资源管理系统。



该系统基于SNMP管理协议，可以实现跨厂商、跨平台的管理。系统采用物理拓扑的方法来自动生成网络的拓扑图，能够准确和直观地反映网络的实际连接情况，包括设备间的冗余连接、备份连接、均衡负载连接等，对拓扑结构进行层次化管理。



通过网络软件的IP地址定位功能可以定位IP地址所在交换机的端口，有效解决了IP地址盗用、查找病毒主机网络黑客等问题。



通过网络软件还可实现对网络故障的监视、流量检测和管理，使网管人员能够对故障预警，以便及时采取措施，保证了整个网络能够坚持长时间的安全无故障运行。



7.建立了VPN系统



虚拟专用网是对企业内部网的扩展。它可以帮助远程用户、公司分支机构、商业伙伴及供应商同公司的内部网建立可信的安全连接，并保证数据的安全传输。虚拟专用网可用于实现企业网站之间安全通信的虚拟专用线路，用于经济有效地连接到商业伙伴和用户的安全外联网虚拟专用网。



为了满足企业用户远程办公需求，同时为了满足网络安全的要求，我们在石化局域网中建立了VPN系统。VPN的核心设备为Cisco的3825路由器，远端子公司采用Cisco的2621路由器，动态接入设备采用Cisco的1700路由器。



8.启动应用服务器的审计功能



在局域网的各应用中我们都启用了审计功能，对用户的操作进行审核和记录，保证了系统的安全。
</code></pre><p><img src="" alt=""></p>
<p>大庆石化局域网结构简图</p>
<pre><code>网络信息系统安全问题的解决依赖于技术和管理两方面，在采取技术措施保障网络安全的同时，我们还建立健全网络信息系统安全管理体系，将各种安全技术与运行管理机制、人员思想教育与技术培训、安全规章制度建设相结合。



通过以上管理机制和技术措施的实施，提高了网络安全性，降低了网络安全事故的风险，保证了网络长期平稳的运行。
</code></pre><p>本篇文章来源于 中国安全网-安全您的网络 原文链接：<a href="http://www.securitycn.net/html/research/service/2337.html" target="_blank">http://www.securitycn.net/html/research/service/2337.html</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span></span> | <span class="tags">Tagged <a href="/tags/安全/" class="label label-primary">安全</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全--企业网络信息安全保护措施的探讨与实践/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全--企业网络信息安全保护措施的探讨与实践" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/81/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/79/">79</a></li><li><a class="page-number" href="/page/80/">80</a></li><li><a class="page-number" href="/page/81/">81</a></li><li class="active"><li><span class="page-number current">82</span></li><li><a class="page-number" href="/page/83/">83</a></li><li><a class="page-number" href="/page/84/">84</a></li><li><a class="page-number" href="/page/85/">85</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/83/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 17:28:49</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
