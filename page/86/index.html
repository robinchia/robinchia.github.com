
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 86 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--部署CAS单点登录服务器-萧飒的日志-网易博客/">部署CAS单点登录服务器 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--部署CAS单点登录服务器-萧飒的日志-网易博客/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-cas-">部署CAS单点登录服务器 - 萧飒的日志 - 网易博客</h1>
<p><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://www.163.com/" target="_blank">网易 </a></p>
<p><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://news.163.com/" target="_blank">新闻</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://t.163.com/" target="_blank">微博</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://email.163.com/" target="_blank">邮箱</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://photo.163.com/" target="_blank">相册</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://yuedu.163.com/" target="_blank">阅读</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://www.youdao.com/" target="_blank">有道</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://photo.163.com/pp/square/" target="_blank">摄影</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://aipai.163.com?from=163blog" target="_blank">爱拍</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://note.youdao.com/?vendor=163blog" target="_blank">云笔记</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://fm.163.com/?fmblogzx0628" target="_blank">闪电邮</a><a href="http://m.123.163.com/?frombkcp" target="_blank">手机邮</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://yxp.163.com/" target="_blank">印像派</a><a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://hi.163.com/?from=bkcp" target="_blank">游戏江湖</a> <a href="http://blog.163.com/redirect.html?frompersonalbloghome&amp;url=http://sitemap.163.com/" target="_blank">更多</a></p>
<p><a href="http://blog.163.com/?frompersonalbloghome" target="_blank">博客 </a></p>
<p><a href="http://blog.163.com/services/wapblog.html?frompersonalbloghome" target="_blank">手机博客</a><a href="http://blog.163.com/clone/clone.html?frompersonalbloghome" target="_blank">博客搬家</a><a href="http://blog.163.com/vip.do?frompersonalbloghome" target="_blank">博客VIP服务</a> <a href="http://blog.163.com/blog_admin/blog/static/721279201082863728829/?frompersonalbloghome" target="_blank">LiveWriter写博</a><a href="http://blog.163.com/blog_admin/blog/static/721279201092713253500/?frompersonalbloghome" target="_blank">word写博</a><a href="http://blog.163.com/services/mailblog.html?frompersonalbloghome" target="_blank">邮件写博</a><a href="http://blog.163.com/services/emsblog.html?frompersonalbloghome" target="_blank">短信写博</a> <a href="http://blog.163.com/showMultiUser.do?frompersonalbloghome" target="_blank">群博客</a><a href="http://blog.163.com/BLOG_YOUCAI/" target="_blank">博客油菜地</a><a href="http://blog.163.com/ht/?frompersonalbloghome" target="_blank">博客话题</a><a href="http://blog.163.com/hot/history/?frompersonalbloghome" target="_blank">博客热点</a><a href="http://q.163.com/#home?frompersonalbloghome" target="_blank">博客圈子</a><a href="http://blog.163.com/findFriend.do?type=5?frompersonalbloghome" target="_blank">找朋友</a>
<a href="http://blog.163.com/public/explore/?frompersonalbloghome" target="_blank">发现</a></p>
<p><a href="http://blog.163.com/g/?frompersonalbloghome" target="_blank">小组</a>
<a href="http://blog.163.com/public/theme/?frompersonalbloghome" target="_blank">风格</a></p>
<p><a href="http://blog.163.com/randomUser.do" title="随便看看"></a></p>
<p><a href="http://istyle.163.com/" target="_blank">网易真人搭配社区iStyle</a></p>
<p><a href="http://www.lofter.com/" target="_blank">网易轻博客LOFTER</a></p>
<p><a href="http://reg.163.com/reg/reg.jsp?product=blog&amp;url=http://blog.163.com/ntesRegBlank.html&amp;loginurl=http://blog.163.com/" target="_blank">创建博客</a> <a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/#" target="_blank">登录</a>  </p>
<p> 加关注</p>
<p><a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/" target="_blank"></a>   <a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/">显示下一条</a>  |  <a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/" target="_blank">关闭</a></p>
<p><a href="http://blog.163.com/public/explore/?fromblogbanner"></a>
<a href="http://www.lofter.com/invite/163blog/?email="></a></p>
<h1 id="-">萧飒的博客</h1>
<p>未来的成功往往是现在无法想象的……
 <a href="http://slf-1983.blog.163.com/blog/static/2990236320124331628240/#"></a></p>
<h2 id="-">导航</h2>
<ul>
<li><a href="http://slf-1983.blog.163.com/" target="_blank">首页</a></li>
<li><a href="http://slf-1983.blog.163.com/blog/" target="_blank">日志</a></li>
<li><a href="http://slf-1983.blog.163.com/album/" target="_blank">相册</a></li>
<li><a href="http://slf-1983.blog.163.com/music/" target="_blank">音乐</a></li>
<li><a href="http://slf-1983.blog.163.com/collection/" target="_blank">收藏</a></li>
<li><a href="http://slf-1983.blog.163.com/friends/" target="_blank">博友</a></li>
<li><a href="http://slf-1983.blog.163.com/profile/" target="_blank">关于我</a></li>
</ul>
<h2 id="-">日志</h2>
<p><a href="http://slf-1983.blog.163.com/blog/static/299023632012431659898/" target="_blank">cas改造随笔</a></p>
<p><a href="http://slf-1983.blog.163.com/blog/static/29902363201243323076/" target="_blank">jsessionid的困扰</a></p>
<h3 id="-cas-">部署CAS单点登录服务器</h3>
<p>2012-05-03 15:16:28|  分类： <a href="http://slf-1983.blog.163.com/blog/#m=0&amp;t=1&amp;c=fks_082068080083080065083095074065093095081065087080085" title="编程" target="_blank">编程</a> |  标签： |字号大中小 <a href="">订阅</a></p>
<p><strong>第0步：环境配置</strong></p>
<p>操作系统：CentOS 5.5 64位</p>
<p>JDK：1.7</p>
<p>Tomcat：7.0</p>
<p>CAS Server：3.4.11</p>
<p>CAS Client：3.2.1</p>
<p><strong>第1步：安装JAVA并设置环境变量</strong></p>
<p>从<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk-7u3-download-1501626.html" target="_blank"><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk-7u3-download-1501626.html">http://www.oracle.com/technetwork/java/javase/downloads/jdk-7u3-download-1501626.html</a></a></p>
<p>下载并安装Linux x64 RPM包
rpm -i jdk-7u3-linux-x64.rpm</p>
<p>设置环境变量</p>
<p>vi /etc/profile</p>
<p>加入</p>
<p>JAVA_HOME=/usr/java/jdk1.7.0_03 export JAVA_HOME</p>
<p>方便操作将keytool加入/usr/bin/</p>
<p>ln -s /usr/java/jdk1.7.0_03/bin/keytool /usr/bin/keytool</p>
<p><strong>第2步：安装Tomcat</strong></p>
<p>从<a href="http://tomcat.apache.org/download-70.cgi" target="_blank"><a href="http://tomcat.apache.org/download-70.cgi">http://tomcat.apache.org/download-70.cgi</a></a></p>
<p>下载Tomcat并解压</p>
<p>tar -zxvf apache-tomcat-7.0.26.tar.gz</p>
<p>方便操作将启动关闭加入/usr/bin/
ln -s /usr/local/tomcat/bin/startup.sh /usr/bin/tomcat-start ln -s /usr/local/tomcat/bin/shutdown.sh /usr/bin/tomcat-stop</p>
<p><strong>第3步：创建、导出、导入证书</strong></p>
<p>创建一个生成证书的脚本
vi create_https_cert.sh /# 删除原证书库 keytool -delete -keystore /home/cas/cascerts -storepass changeit /# 删除原别名 keytool -delete -alias sgstsso -storepass changeit /# 生成证书，需要注意的是dname需要使用域名或主机名，不能用IP，keystore 为生成的证书库地址，后面TOMCAT会用到 keytool -genkey -keyalg RSA -alias sgstsso -keystore /home/cas/cascerts -dname &quot;CN=cas.sgst.cn&quot; -storepass changeit /# 导出证书，导出的证书用在各客户端的JDK导入 keytool -export -alias sgstsso -keystore /home/cas/cascerts -file /home/cas/sgstsso.crt -storepass changeit /# 导入证书 keytool -import -alias sgstsso -file /home/cas/sgstsso.crt -keystore $JAVA_HOME/jre/lib/security/cacerts -storepass changeit</p>
<p>执行该脚本。</p>
<p><strong>第4步：应用证书到Tomcat</strong></p>
<p>编辑conf/server.xml加入下面这段（如果8443 https已开启使用的则在其基础上修改）</p>
<Connector protocol="org.apache.coyote.http11.Http11Protocol" port="8443" minSpareThreads="5" enableLookups="true" disableUploadTimeout="true" acceptCount="100" maxThreads="200" scheme="https" secure="true" SSLEnabled="true" keystoreFile="/home/cas/cascerts" keystorePass="changeit" truststoreFile="/usr/java/jdk1.7.0_03/jre/lib/security/cacerts" clientAuth="false" sslProtocol="TLS"/>

<p>重启Tomcat，访问<a href="https://localhost:8443，如果能否访问则配置成功。" target="_blank">https://localhost:8443，如果能否访问则配置成功。</a></p>
<p><strong>第5步：配置CAS服务器</strong></p>
<p>从<a href="http://www.jasig.org/cas/download" target="_blank"><a href="http://www.jasig.org/cas/download">http://www.jasig.org/cas/download</a></a>下载<a href="http://www.jasig.org/cas_server_3_4_11_release" target="_blank">CAS Server 3.4.11 Release</a>压缩包</p>
<p>解压后将其中的cas-server-3.4.11.war改名为cas.war放在tomcat下面</p>
<p>此时打开<a href="https://localhost:8443/cas/login即可访问" target="_blank">https://localhost:8443/cas/login即可访问</a></p>
<p>输入sgst/sgst登录成功（默认为简单认证，即用户名密码一样就算通过）</p>
<p>编辑tomcat/conf/server.xml在原Host下面增加以下这段</p>
<Host name="cas.sgst.cn" appBase="/home/cas/webapps" unpackWARs="true" autoDeploy="true"> <Context path='' docBase='cas'/> <Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs" prefix="cas_access_log." suffix=".txt" pattern="%h %l %u %t &quot;%r&quot; %s %b" /> </Host>

<p>这样实现以<a href="https://cas.sgst.cn:8443" target="_blank">https://cas.sgst.cn:8443</a> 访问cas</p>
<p>CAS的认证改为查询数据库用户名密码验证：</p>
<p>编辑cas/WEB-INF/deployerConfigContext.xml</p>
<p>将</p>
<bean class="org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler" />

注释掉，新增下面这段

<bean class="org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler"> <property name="dataSource" ref="casDataSource" /> <property name="sql" value="select userpwd from idsuser where lower(username) = lower(?)" /> <property name="passwordEncoder" ref="myPasswordEncoder"/> </bean>

<p>上面的加密根据个人需求可自行开发，这里用的是MD5 64位加密，以一个独立bean跟在后面</p>
<bean id="myPasswordEncoder"/>

casDataSource则同样以一个独立bean跟在后面

<bean id="casDataSource" class="org.apache.commons.dbcp.BasicDataSource"> <property name="driverClassName"> <value>oracle.jdbc.driver.OracleDriver</value> </property> <property name="url"> <value>jdbc:oracle:thin:@(DESCRIPTION =(ADDRESS = (PROTOCOL = TCP)(HOST = 10.10.29.104)(PORT = 1521))(ADDRESS = (PROTOCOL = TCP)(HOST = 10.10.29.105)(PORT = 1521))(ADDRESS = (PROTOCOL = TCP)(HOST = 10.10.29.106)(PORT = 1521))(LOAD_BALANCE = yes)(CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = genome)))</value> </property> <property name="username"> <value>trs_ids</value> </property> <property name="password"> <value>123456</value> </property> </bean>

<p>保存该文件，复制压缩包中的modules里的cas-server-support-jdbc-3.4.11.jar和ojdbc14.jar到cas/WEB-INF/lib下</p>
<p>重启Tomcat后CAS便以用户名密码进行验证。</p>
<p><strong>第6步：配置CAS客户端</strong></p>
<p>从<a href="http://www.jasig.org/cas/client-integration" target="_blank"><a href="http://www.jasig.org/cas/client-integration">http://www.jasig.org/cas/client-integration</a></a>参考适合的客户端，JAVA的在这里下载<a href="http://downloads.jasig.org/cas-clients/" target="_blank"><a href="http://downloads.jasig.org/cas-clients/">http://downloads.jasig.org/cas-clients/</a></a></p>
<p>客户端中相应的JAR包都有，对应的maven为
<!-- cas --> <dependency> <groupId>org.jasig.cas.client</groupId> <artifactId>cas-client-core</artifactId> <version>3.2.1</version> </dependency></p>
<p>修改web.xml增加以下filter</p>
<!-- ======================== 单点登录开始 ======================== --> <!-- 用于单点退出，该过滤器用于实现单点登出功能，可选配置--> <listener> <listener-class>org.jasig.cas.client.session.SingleSignOutHttpSessionListener</listener-class> </listener> <!-- 该过滤器用于实现单点登出功能，可选配置。 --> <filter> <filter-name>CAS Single Sign Out Filter</filter-name> <filter-class>org.jasig.cas.client.session.SingleSignOutFilter</filter-class> </filter> <filter-mapping> <filter-name>CAS Single Sign Out Filter</filter-name> <url-pattern>/check//<em></url-pattern> </filter-mapping> <!-- 该过滤器负责用户的认证工作，必须启用它 --> <filter> <filter-name>CASFilter</filter-name> <filter-class>org.jasig.cas.client.authentication.AuthenticationFilter</filter-class> <init-param> <param-name>casServerLoginUrl</param-name> <!-- 这里是服务器端地址 --> <param-value><a href="https://cas.sgst.cn:8443/login" target="_blank">https://cas.sgst.cn:8443/login</a></param-value> </init-param> <init-param> <param-name>serverName</param-name> <param-value><a href="http://localhost:8080" target="_blank">http://localhost:8080</a></param-value> </init-param> </filter> <filter-mapping> <filter-name>CASFilter</filter-name> <url-pattern>/check//</em></url-pattern> </filter-mapping> <!-- 该过滤器负责对Ticket的校验工作，必须启用它 --> <filter> <filter-name>CAS Validation Filter</filter-name> <filter-class> org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter </filter-class> <init-param> <param-name>casServerUrlPrefix</param-name> <param-value><a href="https://cas.sgst.cn:8443" target="_blank">https://cas.sgst.cn:8443</a></param-value> </init-param> <init-param> <param-name>serverName</param-name> <param-value><a href="http://localhost:8080" target="_blank">http://localhost:8080</a></param-value> </init-param> </filter> <filter-mapping> <filter-name>CAS Validation Filter</filter-name> <url-pattern>/check//<em></url-pattern> </filter-mapping> <!-- 该过滤器负责实现HttpServletRequest请求的包裹， 比如允许开发者通过HttpServletRequest的getRemoteUser()方法获得SSO登录用户的登录名，可选配置。 --> <filter> <filter-name>CAS HttpServletRequest Wrapper Filter</filter-name> <filter-class>org.jasig.cas.client.util.HttpServletRequestWrapperFilter</filter-class> </filter> <filter-mapping> <filter-name>CAS HttpServletRequest Wrapper Filter</filter-name> <url-pattern>/check//</em></url-pattern> </filter-mapping> <!-- 该过滤器使得开发者可以通过org.jasig.cas.client.util.AssertionHolder来获取用户的登录名。 比如AssertionHolder.getAssertion().getPrincipal().getName()。 --> <filter> <filter-name>CAS Assertion Thread Local Filter</filter-name> <filter-class>org.jasig.cas.client.util.AssertionThreadLocalFilter</filter-class> </filter> <filter-mapping> <filter-name>CAS Assertion Thread Local Filter</filter-name> <url-pattern>/check//*</url-pattern> </filter-mapping> <!-- ======================== 单点登录结束 ======================== -->

<p>2012-03-21更新： CAS filter-mapping一定要放在整个项目的encodingFilter之后，否则会造成中文乱码</p>
<p><strong>第7步：美化服务器界面</strong></p>
<p>具体页面在cas\WEB-INF\view\jsp\default\ui\</p>
<p>登录界面：casLoginView.jsp
登录成功：casGenericSuccess.jsp
登出界面：casLogoutView.jsp
  评论这张</p>
<p><img src="" alt=""> 转发至微博
<img src="" alt=""> 转发至微博</p>
<p><img src="" alt=""> 0人  |  分享到：        </p>
<p>阅读(7)| 评论(0)| 转载 (0) |举报</p>
<p><a href="http://slf-1983.blog.163.com/blog/static/299023632012431659898/" target="_blank">cas改造随笔</a></p>
<p><a href="http://slf-1983.blog.163.com/blog/static/29902363201243323076/" target="_blank">jsessionid的困扰</a></p>
<h3 id="-">历史上的今天</h3>
<h3 id="-">相关文章</h3>
<h3 id="-">最近读者</h3>
<h3 id="-">评论</h3>
<p><a href=""></a></p>
<p>this.p={ m:2, b:2, id:&#39;fks_087066086087081064092094095065072084088074084084085069087&#39;, blogTitle:&#39;部署CAS单点登录服务器&#39;, blogAbstract:&#39;<span style=\"color: rgb(51, 51, 51); font-family: \'Segoe UI\', Calibri, \'Myriad Pro\', Myriad, \'Trebuchet MS\', Helvetica, Arial, sans-serif; font-size: 13px; line-height: normal;\" \><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \><strong\>第0步：环境配置</strong\></p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>操作系统：CentOS 5.5 64位</p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>JDK：1.7</p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>Tomcat：7.0</p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>CAS Server：3.4.11</p\><p style=\"margin-top: 0.25em; margin-bottom: 0.75em; line-height: 19px;\" \>CAS Client：3.2.1</p\></span\>&#39;, blogTag:&#39;编程&#39;, blogUrl:&#39;blog/static/2990236320124331628240&#39;, isPublished:1, istop:false, type:0, modifyTime:0, publishTime:1336029388240, permalink:&#39;blog/static/2990236320124331628240&#39;, commentCount:0, mainCommentCount:0, recommendCount:0, bsrk:-100, publisherId:0, recomBlogHome:false, attachmentsFileIds:[], vote:{}, groupInfo:{}, friendstatus:&#39;none&#39;, followstatus:&#39;unFollow&#39;, pubSucc:&#39;&#39;, visitorProvince:&#39;北京&#39;, visitorCity:&#39;西城区&#39;, postAddInfo:{}, mset:&#39;000&#39;, mcon:&#39;&#39;, srk:-100, remindgoodnightblog:false, isBlackVisitor:false, isShowYodaoAd:true, hostIntro:&#39;我,犯溅一样的猪一样的懒,无语……&#39;, hmcon:&#39;1&#39;, selfRecomBlogCount:&#39;0&#39;, lofter_single:&#39;<a hidefocus="true" target="_blank" href="http://www.lofter.com/reg?act=qbview_20120221_01&from=blog_01"><img onload="var nimg = new Image(); nimg.src=\'http://blog.163.com/newpage/images/analyse.png?lofter_single&t=\'+new Date().getTime()" border="0" src="http://b2.bst.126.net/newpage/images/lofter_single6.jpg"/></a>&#39; }   {list a as x} {if !!x} <div class="iblock nbw-fce nbw-f40"> <a class="fc03 noul" target="_blank" hidefocus="true" href="http://blog.163.com/${x.visitorName}/"> {if x.visitorName==visitor.userName} <img alt="${x.visitorNickname|escape}" onerror="this.src=location.f40" class="cwd bdwa bdc0" src="${fn1(x.visitorName)}&r=${visitor.imageUpdateTime}"/> {else} <img alt="${x.visitorNickname|escape}" onerror="this.src=location.f40" class="cwd bdwa bdc0" src="${fn1(x.visitorName)}"/> {/if} </a> <div class="cwd vname thide"> {if x.moveFrom==&#39;wap&#39;} <a class="noul pnt" target="_blank" href="http://blog.163.com/services/wapblog.html?frompersonalbloghome"><span title="来自网易手机博客" class="iblock wapIcon"> </span></a> {elseif x.moveFrom==&#39;iphone&#39;} <a class="noul pnt" target="_blank"><span title="来自iPhone客户端" class="iblock iphoneIcon"> </span></a> {elseif x.moveFrom==&#39;android&#39;} <a class="noul pnt" target="_blank"><span title="来自Android客户端" class="iblock androidIcon"> </span></a> {elseif x.moveFrom==&#39;mobile&#39;} <a class="noul pnt" target="_blank" href="http://blog.163.com/services/emsblog.html?frompersonalbloghome"><span title="来自网易短信写博" class="iblock wapIcon"> </span></a> {/if} <a class="fc03 m2a" target="_blank" hidefocus="true" href="http://blog.163.com/${x.visitorName}/"> ${fn(x.visitorNickname,8)|escape} </a> </div> </div> {/if} {/list}   {if !!a} <a target="_blank" href="http://blog.163.com/${a.userName}/"><img class="bdwa bdc0 pnt" onerror="this.src=location.f60" src="${fn1(a.userName)}"/></a> <a target="_blank" class="fc03 m2a" href="http://blog.163.com/${a.userName}/">${fn(a.nickname,8)|escape}</a> <div class="intro fc05">${a.selfIntro|escape}{if great260}${suplement}{/if}</div> <div class="acts ztag"></div> <div class="mbga phide xtag"> <div class="mbgai"> </div> <a class="fc03 xtag m2a" href="/#" target="_blank"></a> </div> {/if}  &lt;/#--最新日志，群博日志--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="${furl()}${x.permalink}/?latestBlog">${fn(x.title,26)|escape}</a></li> {/if} {/list}  &lt;/#--推荐日志--&gt;  <p class="fc06">推荐过这篇日志的人：</p> <div> {list a as x} {if !!x} <div class="iblock nbw-fce nbw-f40"> <a class="fc03 noul" target="_blank" hidefocus="true" href="http://blog.163.com/${x.recommenderName}/"> <img alt="${x.recommenderNickname|escape}" onerror="this.src=location.f40" class="cwd bdwa bdc0" src="${fn1(x.recommenderName)}"/> </a> <div class="cwd thide"> <a class="fc03 m2a" target="_blank" hidefocus="true" href="http://blog.163.com/${x.recommenderName}/"> ${fn(x.recommenderNickname,6)|escape} </a> </div> </div> {/if} {/list} </div> {if !!b&amp;&amp;b.length&gt;0} <p class="fc06">他们还推荐了：</p> <ul> {list b as y} {if !!y} <li class="rrb"><span class="iblock">·</span><a class="fc03 m2a" target="_blank" href="http://blog.163.com/${y.recommendBlogPermalink}/?from=blog/static/2990236320124331628240">${y.recommendBlogTitle|escape}</a></li> {/if} {/list} </ul> {/if}  &lt;/#--引用记录--&gt;  <span class="pleft fc07">转载记录：</span> <ul class="tbac"> {list d as x} <li class="clearfix"> <span class="pleft iblock">·</span> <div class="tbl thide pleft"><span><a target="_blank" class="fc07 m2a" href="${x.referBlogUrl}">${x.referBlogTitle|escape}</a></span></div> <div class="tbr pleft"><span><a target="_blank" class="fc07 m2a" href="${x.referHomePage}">${x.referUserName|escape}</a></span></div> </li> {/list} </ul>  &lt;/#--博主推荐--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="http://blog.163.com/${x.userName}/${x.permalink}/?recommendBlog" title="${x.title|default:""|escape}">${x.title|default:&quot;&quot;|escape}</a></li> {/if} {/list}  &lt;/#--随机阅读--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="http://blog.163.com/${x.userName}/${x.permalink}/?personalRecomBlog" title="${x.title|default:""|escape}">${x.title|default:&quot;&quot;|escape}</a></li> {/if} {/list}  &lt;/#--首页推荐--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" target="_blank" href="${x.blogUrl|default:""|escape}?recommendReader" title="${x.blogTile|default:""|escape}">${x.blogTile|default:&quot;&quot;|escape}</a></li> {/if} {/list}  &lt;/#--相关文章--&gt;  <ul> {list a as x} {if x_index&gt;9}{break}{/if} {if !!x} <li class="thide fc03"> <a class="m2a" target="_blank" target="_blank" href="${x.url|default:""}?fromdm&fromSearch&isFromSearchEngine=${isFromSearchEngine|default:"no"}" title="${x.title|default:""|escape}">${x.title|default:&quot;&quot;|escape}</a><span class="fc07">${fn2(parseInt(x.date),&#39;yyyy-MM-dd HH:mm:ss&#39;)}</span> </li> {/if} {/list} </ul>  &lt;/#--历史上的今天--&gt;  <ul> {list a as x} {if x_index&gt;4}{break}{/if} {if !!x} <li class="thide fc03"> <a class="m2a" target="_blank" href="http://blog.163.com/${x.userName}/${x.permalink|default:""}" title="${x.title|default:""|escape}">${fn1(x.title,60)|escape}</a><span class="fc07">${fn2(x.publishTime,&#39;yyyy-MM-dd HH:mm:ss&#39;)}</span> </li> {/if} {/list} </ul>  &lt;/#--被推荐日志--&gt;  {list a as x} {if !!x} <li class="thide"><a target="_blank" class="fc03 m2a" href="${furl()}${x.permalink}/">${fn(x.title,26)|escape}</a></li> {/if} {/list}  &lt;/#--右边模块结构--&gt;  <div class="uinfo ztag"></div> <h4 class="fc07 fs0 ltt phide ztag">被推荐日志</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">最新日志</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">该作者的其他文章</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">博主推荐</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">相关日志</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">随机阅读</h4> <ul class="ztag blst"></ul> <h4 class="fc07 fs0 ltt phide ztag">首页推荐</h4> <ul class="ztag blst"></ul> <div class="more"><a target="_blank" class="fc03 m2a" href="http://blog.163.com">更多&gt;&gt;</a></div> <br/><br/> <div id="yodaoad_r" style="display:none;_zoom:1;"></div> <div id="lofter_single"></div>  &lt;/#--评论模块结构--&gt;  <div class="publish ztag"></div> <div class="bdwt bds2 bdc0 phide" id="yodaoad_2" style="_zoom:1;"></div> <div class="ztag bdwt bds2 bdc0"> <div class="case"></div> <div class="clearfix"></div> </div>  &lt;/#--引用模块结构--&gt;  <div class="close"> <span class="ztag iblock icn0 icn0-57"> </span> </div> <div class="ztag phide"></div>  &lt;/#--博主发起的投票--&gt;  {list a as x} {if !!x} <li> <a href="http://blog.163.com/${x.userName}/" target="_blank" class="m2a fc03">${x.nickName|escape}</a>  投票给 {var first_option = true;} {list x.voteDetailList as voteToOption} {if voteToOption==1} {if first_option==false},{/if}  “${b[voteToOption_index]}”   {/if} {/list} {if (x.role!=&quot;-1&quot;) },“我是${c[x.role]}”  {/if}     <span class="fc07">    ${fn1(x.voteTime)}</span> {if x.userName==&#39;&#39;}{/if} {/if} {/list}</p>
<h2 id="-">页脚</h2>
<p><a href="http://corp.163.com/index_gb.html" target="_blank">公司简介</a> - <a href="http://gb.corp.163.com/gb/contactus.html" target="_blank">联系方法</a> - <a href="http://corp.163.com/gb/job/job.html" target="_blank">招聘信息</a> - <a href="http://help.163.com/?b13abk1" target="_blank">客户服务</a> - <a href="http://corp.163.com/gb/legal/legal.html" target="_blank">隐私政策</a> - <a href="http://blog.163.com/public/theme/" target="_blank">博客风格</a> - <a href="http://blog.163.com/services/wapblog.html" target="_blank">手机博客</a> - <a href="http://blog.163.com/vip.do" target="_blank">VIP博客</a> - <a href="">订阅此博客</a></p>
<p>网易公司版权所有 ©1997-2012</p>
<p><a rel="nofollow" class="pr" target="_blank" href="http://help.163.com/special/007525FT/blog.html?b13aze1">帮助</a> <span class="fr iblock space icn1 icn1-4"> </span> <a class="pr" target="_blank" href="http://blog.163.com/activation.do?host=activation&&username=${u}">${u}</a>   {list wl as x} <div class="grp">${x.g}</div> {list x.l as y} <a class="itm noul" href="/#" hidefocus="true" name="{if typeof(y.v)=='string'}${y.v}{else}${y_index}{/if}">${y.n}</a> {/list} {/list}   {if defined(&#39;wl&#39;)} {list wl as x}<a class="itm noul" href="/#" hidefocus="true" name="${x.v}">${x.n}</a>{/list} {/if}</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--部署CAS单点登录服务器-萧飒的日志-网易博客/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--部署CAS单点登录服务器-萧飒的日志-网易博客" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS-spring-cas--21-JavaAuthenticationandAuthorizationService/">21. Java Authentication and Authorization Service </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS-spring-cas--21-JavaAuthenticationandAuthorizationService/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="21-java-authentication-and-authorization-service-jaas-provider">21. Java Authentication and Authorization Service (JAAS) Provider</h1>
<ol>
<li>Java Authentication and Authorization Service (JAAS) Provider<a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/taglibs.html" target="_blank">Prev</a> Part V. Additional Topics <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/cas.html" target="_blank">Next</a></li>
</ol>
<h1 id="-java-authentication-and-authorization-service-jaas-provider"><a href=""></a>Java Authentication and Authorization Service (JAAS) Provider</h1>
<h2 id="-21-1-overview"><a href=""></a>21.1 Overview</h2>
<p>Spring Security provides a package able to delegate authentication requests to the Java Authentication and Authorization Service (JAAS). This package is discussed in detail below.</p>
<h2 id="-21-2-abstractjaasauthenticationprovider"><a href=""></a>21.2 AbstractJaasAuthenticationProvider</h2>
<p>The</p>
<p>AbstractJaasAuthenticationProvider
is the basis for the provided JAAS</p>
<p>AuthenticationProvider
implementations. Subclasses must implement a method that creates the</p>
<p>LoginContext
. The</p>
<p>AbstractJaasAuthenticationProvider
has a number of dependencies that can be injected into it that are discussed below.</p>
<h3 id="-21-2-1-jaas-callbackhandler"><a href=""></a>21.2.1 JAAS CallbackHandler</h3>
<p>Most JAAS</p>
<p>LoginModule
s require a callback of some sort. These callbacks are usually used to obtain the username and password from the user.</p>
<p>In a Spring Security deployment, Spring Security is responsible for this user interaction (via the authentication mechanism). Thus, by the time the authentication request is delegated through to JAAS, Spring Security&#39;s authentication mechanism will already have fully-populated an</p>
<p>Authentication
object containing all the information required by the JAAS</p>
<p>LoginModule
.</p>
<p>Therefore, the JAAS package for Spring Security provides two default callback handlers,</p>
<p>JaasNameCallbackHandler
and</p>
<p>JaasPasswordCallbackHandler
. Each of these callback handlers implement</p>
<p>JaasAuthenticationCallbackHandler
. In most cases these callback handlers can simply be used without understanding the internal mechanics.</p>
<p>For those needing full control over the callback behavior, internally</p>
<p>AbstractJaasAuthenticationProvider
wraps these</p>
<p>JaasAuthenticationCallbackHandler
s with an</p>
<p>InternalCallbackHandler
. The</p>
<p>InternalCallbackHandler
is the class that actually implements JAAS’ normal</p>
<p>CallbackHandler
interface. Any time that the JAAS</p>
<p>LoginModule
is used, it is passed a list of application context configured</p>
<p>InternalCallbackHandler
s. If the</p>
<p>LoginModule
requests a callback against the</p>
<p>InternalCallbackHandler
s, the callback is in-turn passed to the</p>
<p>JaasAuthenticationCallbackHandler
s being wrapped.</p>
<h3 id="-21-2-2-jaas-authoritygranter"><a href=""></a>21.2.2 JAAS AuthorityGranter</h3>
<p>JAAS works with principals. Even &quot;roles&quot; are represented as principals in JAAS. Spring Security, on the other hand, works with</p>
<p>Authentication
objects. Each</p>
<p>Authentication
object contains a single principal, and multiple</p>
<p>GrantedAuthority
s. To facilitate mapping between these different concepts, Spring Security&#39;s JAAS package includes an</p>
<p>AuthorityGranter
interface.</p>
<p>An</p>
<p>AuthorityGranter
is responsible for inspecting a JAAS principal and returning a set of</p>
<p>String
s, representing the authorities assigned to the principal. For each returned authority string, the</p>
<p>AbstractJaasAuthenticationProvider
creates a</p>
<p>JaasGrantedAuthority
(which implements Spring Security’s</p>
<p>GrantedAuthority
interface) containing the authority string and the JAAS principal that the</p>
<p>AuthorityGranter
was passed. The</p>
<p>AbstractJaasAuthenticationProvider
obtains the JAAS principals by firstly successfully authenticating the user’s credentials using the JAAS</p>
<p>LoginModule
, and then accessing the</p>
<p>LoginContext
it returns. A call to</p>
<p>LoginContext.getSubject().getPrincipals()
is made, with each resulting principal passed to each</p>
<p>AuthorityGranter
defined against the</p>
<p>AbstractJaasAuthenticationProvider.setAuthorityGranters(List)
property.</p>
<p>Spring Security does not include any production</p>
<p>AuthorityGranter
s given that every JAAS principal has an implementation-specific meaning. However, there is a</p>
<p>TestAuthorityGranter
in the unit tests that demonstrates a simple</p>
<p>AuthorityGranter
implementation.</p>
<h2 id="-21-3-defaultjaasauthenticationprovider"><a href=""></a>21.3 DefaultJaasAuthenticationProvider</h2>
<p>The</p>
<p>DefaultJaasAuthenticationProvider
allows a JAAS</p>
<p>Configuration
object to be injected into it as a dependency. It then creates a</p>
<p>LoginContext
using the injected JAAS</p>
<p>Configuration
. This means that</p>
<p>DefaultJaasAuthenticationProvider
is not bound any particular implementation of</p>
<p>Configuration
as</p>
<p>JaasAuthenticationProvider
is.</p>
<h3 id="-21-3-1-inmemoryconfiguration"><a href=""></a>21.3.1 InMemoryConfiguration</h3>
<p>In order to make it easy to inject a</p>
<p>Configuration
into</p>
<p>DefaultJaasAuthenticationProvider
, a default in memory implementation named</p>
<p>InMemoryConfiguration
is provided. The implementation constructor accepts a</p>
<p>Map
where each key represents a login configuration name and the value represents an</p>
<p>Array
of</p>
<p>AppConfigurationEntry
s.</p>
<p>InMemoryConfiguration
also supports a default</p>
<p>Array
of</p>
<p>AppConfigurationEntry
objects that will be used if no mapping is found within the provided</p>
<p>Map
. For details, refer to the class level javadoc of</p>
<p>InMemoryConfiguration
.</p>
<h3 id="-21-3-2-defaultjaasauthenticationprovider-example-configuration"><a href=""></a>21.3.2 DefaultJaasAuthenticationProvider Example Configuration</h3>
<p>While the Spring configuration for</p>
<p>InMemoryConfiguration
can be more verbose than the standarad JAAS configuration files, using it in conjuction with</p>
<p>DefaultJaasAuthenticationProvider
is more flexible than</p>
<p>JaasAuthenticationProvider
since it not dependant on the default</p>
<p>Configuration
implementation.</p>
<p>An example configuration of</p>
<p>DefaultJaasAuthenticationProvider
using</p>
<p>InMemoryConfiguration
is provided below. Note that custom implementations of</p>
<p>Configuration
can easily be injected into</p>
<p>DefaultJaasAuthenticationProvider
as well.</p>
<bean id="jaasAuthProvider" class="org.springframework.security.authentication.jaas.DefaultJaasAuthenticationProvider"> <property name="configuration"> <bean class="org.springframework.security.authentication.jaas.memory.InMemoryConfiguration"> <constructor-arg> <map> <!-- SPRINGSECURITY is the default loginContextName for AbstractJaasAuthenticationProvider --> <entry key="SPRINGSECURITY"> <array> <bean class="javax.security.auth.login.AppConfigurationEntry"> <constructor-arg value="sample.SampleLoginModule" /> <constructor-arg> <util:constant static-field= "javax.security.auth.login.AppConfigurationEntry$LoginModuleControlFlag.REQUIRED"/> </constructor-arg> <constructor-arg> <map></map> </constructor-arg> </bean> </array> </entry> </map> </constructor-arg> </bean> </property> <property name="authorityGranters"> <list> <!-- You will need to write your own implementation of AuthorityGranter --> <bean class="org.springframework.security.authentication.jaas.TestAuthorityGranter"/> </list> </property> </bean>
## <a href=""></a>21.4 JaasAuthenticationProvider

The

JaasAuthenticationProvider
assumes the default

Configuration
is an instance of <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/spec/com/sun/security/auth/login/ConfigFile.html" target="_blank">ConfigFile</a>. This assumption is made in order to attempt to update the

Configuration
. The

JaasAuthenticationProvider
then uses the default

Configuration
to create the

LoginContext
.

Let’s assume we have a JAAS login configuration file,

/WEB-INF/login.conf
, with the following contents:
JAASTest { sample.SampleLoginModule required; };

Like all Spring Security beans, the

JaasAuthenticationProvider
is configured via the application context. The following definitions would correspond to the above JAAS login configuration file:

<bean id="jaasAuthenticationProvider" class="org.springframework.security.authentication.jaas.JaasAuthenticationProvider"> <property name="loginConfig" value="/WEB-INF/login.conf"/> <property name="loginContextName" value="JAASTest"/> <property name="callbackHandlers"> <list> <bean class="org.springframework.security.authentication.jaas.JaasNameCallbackHandler"/> <bean class="org.springframework.security.authentication.jaas.JaasPasswordCallbackHandler"/> </list> </property> <property name="authorityGranters"> <list> <bean class="org.springframework.security.authentication.jaas.TestAuthorityGranter"/> </list> </property> </bean>

<h2 id="-21-5-running-as-a-subject"><a href=""></a>21.5 Running as a Subject</h2>
<p>If configured, the</p>
<p>JaasApiIntegrationFilter
will attempt to run as the</p>
<p>Subject
on the</p>
<p>JaasAuthenticationToken
. This means that the</p>
<p>Subject
can be accessed using:</p>
<p>Subject subject = Subject.getSubject(AccessController.getContext());</p>
<p>This integration can easily be configured using the <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/appendix-namespace.html#nsa-http-jaas-api-provision" title="jaas-api-provision" target="_blank">jaas-api-provision</a> attribute. This feature is useful when integrating with legacy or external API&#39;s that rely on the JAAS Subject being populated.
<a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/taglibs.html" target="_blank">Prev</a> <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/advanced-topics.html" target="_blank">Up</a> <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/cas.html" target="_blank">Next</a>20. JSP Tag Libraries <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/springsecurity.html" target="_blank">Home</a> 22. CAS Authentication    <img src="" alt=""></p>
<p><a href=""><img src="" alt=""></a></p>
<p><a href="http://www.springsource.com/?cid=70180000000wIe4AAE" target="_blank"><img src="" alt=""></a>
allSpringSourceGrailsHypericGemstoneRabbitMQ <img src="&quot;Search Documentation&quot;" alt=""></p>
<p><img src="&quot;click to toggle&quot;" alt="">
<a href="http://www.springsource.com/spring-framework-consulting" target="_blank"><img src="" alt=""></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span><span class="breadcrumb"><li><a href="/categories/CAS/">CAS</a></li><li><a href="/categories/CAS/spring-cas/">spring-cas</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a><a href="/tags/spring-cas/" class="label label-success">spring-cas</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS-spring-cas--21-JavaAuthenticationandAuthorizationService/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS-spring-cas--21-JavaAuthenticationandAuthorizationService" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS-withoutcasloginscreen--UsingCASwithouttheCASloginscreen-CentralA/">Using CAS without the CAS login screen </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS-withoutcasloginscreen--UsingCASwithouttheCASloginscreen-CentralA/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="using-cas-without-the-cas-login-screen-central-authentication-service-jasig-wiki">Using CAS without the CAS login screen - Central Authentication Service - Jasig Wiki</h1>
<ul>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#title-heading" target="_blank">Skip to content</a></li>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#breadcrumbs" target="_blank">Skip to breadcrumbs</a></li>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#header-menu-bar" target="_blank">Skip to header menu</a></li>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#navigation" target="_blank">Skip to action menu</a></li>
<li><p><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#quick-search-query" target="_blank">Skip to quick search</a>
Quick Search</p>
</li>
<li><p><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" target="_blank">Browse</a></p>
</li>
<li><p><a href="https://wiki.jasig.org/pages/listpages.action?key=CAS" title="Browse pages in the Central Authentication Service space ( Type &#39;g&#39; then &#39;s" target="_blank">Pages</a>&quot;)</p>
</li>
<li><a href="https://wiki.jasig.org/pages/viewrecentblogposts.action?key=CAS" title="Browse blogs in the Central Authentication Service space" target="_blank">Blog</a></li>
<li><a href="https://wiki.jasig.org/labels/listlabels-heatmap.action?key=CAS" title="Browse labels in the Central Authentication Service space" target="_blank">Labels</a></li>
<li><a href="https://wiki.jasig.org/spaces/listattachmentsforspace.action?key=CAS" title="Browse attachments in the Central Authentication Service space" target="_blank">Attachments</a></li>
<li><a href="https://wiki.jasig.org/mail/archive/viewmailarchive.action?key=CAS" title="Browse mail in the Central Authentication Service space" target="_blank">Mail</a></li>
<li><a href="https://wiki.jasig.org/spaces/viewspacesummary.action?key=CAS" title="Browse additional space functions in the Central Authentication Service space" target="_blank">Advanced</a></li>
<li><p><a href="https://wiki.jasig.org/spaces/usage/report.action?key=CAS" target="_blank">Activity</a></p>
</li>
<li><p><a href="http://docs.atlassian.com/confluence/docs-41/whatsnew/iframe" target="_blank">What’s New</a></p>
</li>
<li><a href="https://wiki.jasig.org/spacedirectory/view.action" title="Browse the Confluence space directory" target="_blank">Space Directory</a></li>
<li><a href="https://wiki.jasig.org/dashboard/configurerssfeed.action" title="Create your custom RSS feed." target="_blank">Feed Builder</a></li>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" title="View available keyboard shortcuts ( Type &#39;?" target="_blank">Keyboard Shortcuts</a>&quot;)</li>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" title="Browse gadgets provided by Confluence" target="_blank">Confluence Gadgets</a></li>
<li><a href="https://wiki.jasig.org/login.action?os_destination=%2Fdisplay%2FCAS%2FUsing%2BCAS%2Bwithout%2Bthe%2BCAS%2Blogin%2Bscreen" target="_blank">Log In</a></li>
<li><a href="https://wiki.jasig.org/signup.action" target="_blank">Sign Up</a></li>
</ul>
<ol>
<li><a href="https://wiki.jasig.org/dashboard.action" title="Go to Dashboard ( Type &#39;g&#39; then &#39;d" target="_blank">Dashboard</a>&quot;)</li>
<li><a href="https://wiki.jasig.org/display/CAS" target="_blank">Central Authentication Service</a></li>
<li><strong>…</strong></li>
<li><a href="https://wiki.jasig.org/display/CAS/CASifying+Applications" target="_blank">CASifying Applications</a></li>
<li><a href="">Using CAS without the CAS login screen</a></li>
</ol>
<ul>
<li><p><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" target="_blank">Tools</a></p>
</li>
<li><p><a href="https://wiki.jasig.org/pages/viewpageattachments.action?pageId=5225" title="View Attachments ( Type &#39;t" target="_blank">Attachments (0)</a>&quot;)</p>
</li>
<li><a href="https://wiki.jasig.org/pages/viewpreviousversions.action?pageId=5225" target="_blank">Page History</a></li>
<li><p><a href="https://wiki.jasig.org/pages/viewinfo.action?pageId=5225" title="Edit restrictions" target="_blank">Restrictions</a></p>
</li>
<li><p><a href="https://wiki.jasig.org/pages/viewinfo.action?pageId=5225" target="_blank">Info</a></p>
</li>
<li><a href="https://wiki.jasig.org/pages/viewinfo.action?pageId=5225" title="Link to this Page ( Type &#39;k" target="_blank">Link to this Page…</a>&quot;)</li>
<li><a href="https://wiki.jasig.org/pages/listpages-dirview.action?key=CAS&amp;openId=5225#selectedPageInHierarchy" target="_blank">View in Hierarchy</a></li>
<li><a href="https://wiki.jasig.org/plugins/viewsource/viewpagesrc.action?pageId=5225" target="_blank">View Source</a></li>
</ul>
<h1 id="-https-wiki-jasig-org-display-cas-using-cas-without-the-cas-login-screen-"><a href="https://wiki.jasig.org/display/CAS" target="_blank"><img src="" alt=""></a>  <a href="">Using CAS without the CAS login screen</a></h1>
<p><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#page-metadata-end" target="_blank">Skip to end of metadata</a></p>
<ul>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" title="Page restrictions apply. Click the lock icon to view or edit the restriction." target="_blank">Page restrictions apply</a></li>
<li>Added by <a href="https://wiki.jasig.org/display/~awp9" target="_blank">Andrew Petro</a>, last edited by <a href="https://wiki.jasig.org/display/~brummermann" target="_blank">Hendrik Brummermann</a> on Jul 26, 2011  (<a href="https://wiki.jasig.org/pages/diffpages.action?pageId=5225&amp;originalId=52495191" target="_blank">view change</a>)</li>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" target="_blank">show comment</a> <a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" target="_blank">hide comment</a>
<strong>Comment:</strong> Corrected links that should have been relative instead of absolute.
<a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#page-metadata-start" target="_blank">Go to start of metadata</a></li>
</ul>
<p>This page is for documenting how to use CAS without using the CAS login screen.</p>
<h2 id="why-not-to-do-this">Why not to do this</h2>
<p>One of the advantages CAS brings to the table is a single authentication user experience across all applications using CAS. The user doesn&#39;t have to wonder whether he should be giving his password to any particular application, because no applications other than CAS receive the password.</p>
<p>Implementing this hack results in applications other than CAS having access to actual usernames and passwords. This is a bad thing. It reduces the security value CAS is trying to give you.</p>
<h2 id="existing-features">Existing features</h2>
<p>The CAS gateway feature allows your application to attempt to use CAS single sign on to authenticate the user without interrupting the user experience to display a CAS login screen. If no SSO session already exists, CAS simply redirects back to your service without displaying the login screen.</p>
<h2 id="alternative-approaches">Alternative approaches</h2>
<p>An alternative to your application rendering its own login screen is to get CAS Server to render the login screen you would have wanted to render. <a href="https://wiki.jasig.org/display/CAS/Columbia" target="_blank">WIND</a> goes this route. This is on the feature list for CAS 3.</p>
<p>A relatively easy option (for portals, at least) is to proxy the HTML of the CAS login page and display it inline in the portal page.  The proxied form should still submit to CAS itself.  You can tweak the CAS jsps to use different CSS styles depending on the User Agent or Remote Host, to provide a modified (e.g. smaller) login screen.</p>
<h2 id="using-cas-without-the-login-screen">Using CAS without the login screen</h2>
<p>Suppose you really do want your service to be handling the user&#39;s username and password.</p>
<p>First, produce your custom form. When your custom form submits, the recipient of the submit needs to do the following:</p>
<h3 id="validate-the-username-and-password">Validate the username and password</h3>
<p>Somehow, you need to figure out whether this username and password are correct.</p>
<p>One thing to do would be to generate an HTTP request for CAS login, parse out a valid login ticket, then issue a request for CAS login posting the login ticket, username, and password. Parse the response. If it indicates a success, the username and password are valid. Otherwise not.</p>
<p>Another thing to do would be to go directly against whatever it is that CAS is using to validate usernames and passwords.</p>
<p>If the username and password didn&#39;t match, redisplay your form. If they did match, then either 1) you&#39;re done because all you wanted to do was authenticate the user, or 2) now you need to establish the CAS SSO session in the web browser and obtain a Service ticket.</p>
<h3 id="establish-the-sso-session-and-possibly-get-a-proxy-ticket">Establish the SSO session and possibly get a Proxy Ticket</h3>
<p>Again, get a login ticket and the jsessionid. Then, generate a redirect to the browser placing the sesisonid, login ticket, the username, and the password on the CAS login URL to which you&#39;re redirecting:
<a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" target="_blank">?</a>https:</p>
<p>//cas.example.com/cas/login;jsessionid=XXXXXXXX?username=XXXXXXX&amp;password=XXXXXXX&amp;lt=XXXXXX</p>
<p>Specify the service to be your application where you want to receive the service ticket.</p>
<p>CAS will set the Single Sign On cookie so the user will have a CAS SSO session established.</p>
<p>Since the username, password, and login ticket are good, CAS will redirect back to your service with the service ticket. Grab the service ticket and validate it in the normal way (presumably using a CAS client). This is your opportunity to obtain a Proxy Ticket.</p>
<p>Note: This only works as long as the user has not visited the CAS webpage before. Otherwise he or she got a different sessionid cookie which has priority over the sessionid in the url.</p>
<h2 id="experience-reports">Experience Reports</h2>
<p><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+Login+Screen" target="_blank">Here is an experience report</a> on how an UI-less mode for CAS has been achieved using javascript only on the client side. Passwords are only handed over to the SSL secured CAS service, not to a third party.
Labels:</p>
<p>None</p>
<p><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" title="Edit Labels ( Type &#39;l" target="_blank">Edit Labels</a>&quot;)
Powered by a free <strong>Atlassian Confluence Open Source Project License</strong> granted to Java Architectures Special Interest Group. <a href="http://www.atlassian.com/c/conf/11461" target="_blank">Evaluate Confluence today</a>.
This Confluence installation runs a Free Gliffy License - <a href="http://www.gliffy.com/products/confluence-plugin/" target="_blank">Evaluate Gliffy</a> for your Wiki!</p>
<ul>
<li>Powered by <a href="http://www.atlassian.com/software/confluence" target="_blank">Atlassian Confluence</a> 4.1.5, the <a href="http://www.atlassian.com/software/confluence/tour/enterprise-wiki.jsp" target="_blank">Enterprise Wiki</a></li>
<li>Printed by Atlassian Confluence 4.1.5, the Enterprise Wiki.</li>
<li>·  <a href="http://jira.atlassian.com/secure/BrowseProject.jspa?id=10470" target="_blank">Report a bug</a></li>
<li>·  <a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" target="_blank">Atlassian News</a></li>
</ul>
<p><a href=""></a><a href=""></a><a href=""></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span><span class="breadcrumb"><li><a href="/categories/CAS/">CAS</a></li><li><a href="/categories/CAS/without+cas+login+screen/">without+cas+login+screen</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a><a href="/tags/without+cas+login+screen/" class="label label-success">without+cas+login+screen</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS-withoutcasloginscreen--UsingCASwithouttheCASloginscreen-CentralA/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS-withoutcasloginscreen--UsingCASwithouttheCASloginscreen-CentralA" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全--黑客经典之恶意SSH登录企图分析/">黑客经典之恶意SSH登录企图分析</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全--黑客经典之恶意SSH登录企图分析/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-ssh-">黑客经典之恶意SSH登录企图分析</h1>
<p>黑客经典之恶意SSH登录企图分析</p>
<p>原文链接：<a href="http://www.securitycn.net/html/research/service/1395.html" target="_blank">http://www.securitycn.net/html/research/service/1395.html</a></p>
<p>恶意SSH登录企图出现在一些管理者的日志中已经有几年的时间了。本文回顾了使用&quot;蜜罐&quot;（honeypot）对恶意SSH登录企图进行分析的方法，并提出了我们可以从这一活动中学到的东西。接着本文给出了关于如何使自己的系统安全面对这些攻击的建议。</p>
<p>使用honeypots进行研究</p>
<p>新西兰Honeynet（蜜罐网络）联盟是Honeynet联盟的一个成员研究机构，它致力于通过使用蜜罐技术研究黑帽子黑客（black hat hackers，指那些恶意入侵计算机或计算机网络并尽其所能进行破坏的黑客）的行为、策略和工具来提升计算机系统和网络安全。蜜罐的价值在于它们是可以公开接受攻击并被攻入的开放计算机系统，这使得研究者可以分析该系统上的恶意行为。</p>
<p>我们已经在惠灵顿的维多利亚大学建立起这样的系统来研究发生于新西兰大学网络上的恶意行为。该系统是一个高度互联的蜜罐，一个攻击者可以像在网络的任何其他系统上一样与之联系。在攻击者可知的范围内，蜜罐与其他计算机系统应该没有可分辨的差别。然而，所有流入和流出蜜罐的网络流量都通过Honeynet联盟的Roo honeywall严密监控。此外，系统事件也被蜜罐自身通过其日志功能进行记录。</p>
<p>蜜罐上运行的是标准RedHad 9服务器配置版本，带有可以通过公共互联网访问的安全外壳（Secure Shell，简称SSH）服务器。SSH是可以使得一个用户在网上通过加密通道登录到另一台电脑的程序。在过去的配置下遭遇到恶意SSH登录企图后，我们重新编配了我们的蜜罐以使其可以收集更多的数据。我们对SSH服务器打了补丁以同时记录在登录企图中使用的帐户名和密码。该蜜罐在2006年7月11日上线，在22天后的2006年8月1日下线。在这期间，该蜜罐受到了无数次的SSH登录企图攻击。我们进一步观察这些数据以确定攻击者的策略并提出提高 SSH安全水平的建议。
。</p>
<p>在该蜜罐在6月28日到7月4日运行的另一个配置上，我们增加了可以在系统被攻入后记录攻击者键盘操作的Sebek模块。我们设置了若干具有常用密码的用户帐户。几天后，一个攻击者成功进入了这一系统。在本文中给出了对这一攻击及后续攻击的分析，并提供了对恶意SSH登录企图如何被用于攻入系统的进一步分析。</p>
<p>对SSH登录企图的分析</p>
<p>这一部分分析了7月11日到8月1日我们的蜜罐捕获的数据。该分析完全基于蜜罐的系统日志文件，尤其是&quot;messages&quot;日志。&quot;messages&quot;日志记录了对SSH服务器的验证请求。它记录了日期、时间、登录企图发生的IP地址、请求的结果（失败或成功）以及验证使用的帐户名和密码。下面是两个&quot;messages&quot;的日志示例条目：</p>
<p><code> 
Jul 13 09:37:59 basta sshd[22308]: PW-ATTEMPT: fritz<br>Jul 13 09:37:59 basta sshd[22308]: Failed password for  root from 10.0.160.14<br> port 39529 ssh2<br>Jul 13 09:38:02 basta sshd[22310]: Illegal user   fatacunike from 10.0.160.14<br>Jul 13 09:38:02 basta sshd[22310]: PW-ATTEMPT: fatacunike<br>Jul 13 09:38:02 basta sshd[22310]: Failed password for illegal user fatacunike<br> from 10.0.160.14 port 40444 ssh2
</code></p>
<p>首先，我们分析了用于登录企图的用户名。在取样时间内，系统日志总共记录到2741 个不同的帐户名，包括从常见的姓氏、系统帐户名和常用帐户名到短的字符串。在这些帐户名中，15个使用频率最高的帐户名被列于表1。该表格显示有一个系统上通常存在的帐户（root，mysql）、可能存在的帐户（guest、test）以及常见的姓氏（paul）。随后图1给出了所使用过的有效与无效帐户名的分布。</p>
<p>所使用的无效帐户名远多于有效帐户名并不奇怪，但是我们注意到在蜜罐上存在的所有默认帐户名中96.30%都被攻击利用。</p>
<p><img src="http://www.securitycn.net/img/uploadimg/20060915/1052550.jpg" alt=""></p>
<p>表1 2741次攻击中出现最多的15个帐户名</p>
<p><img src="http://www.securitycn.net/img/uploadimg/20060915/1052551.jpg" alt=""></p>
<p>（Number of Account Names Used in Attack：攻击中使用的帐户名数量；</p>
<p>Number of Account Names on System：系统中的帐户名数量</p>
<p>Existing Account：有效帐户</p>
<p>Invalid Account：无效帐户）</p>
<center>图1 有效与无效帐户名数量</center>  

<p>&quot;成功&quot;的恶意SSH登录企图</p>
<p>在上面的部分中，我们分析了对于没有成功的恶意SSH登录企图数据的记录。这些数据可以使我们进一步理解这些攻击者如何操作，但是还有很多问题没有解决，其中之一是这些攻击中是否使用了工具软件。</p>
<p>7月2日，有一名攻击者通过猜测出一个SSH上的有效帐户名/密码成功地侵入了蜜罐。在这一事件中捕获的数据揭示了这些问题的答案。</p>
<p>首先我们观察了该黑客成功入侵蜜罐后进行的操作。确定了有效的帐户名/密码后，该黑客通过SSH登入蜜罐并继而下载了一个SSH扫描工具。在下面一节将更详细地介绍该工具，这里我们先将其总结为一个可以允许其使用者通过猜测密码的尝试识别并入侵其它SSH服务器的工具。这一工具安装后立刻被用来从我们的蜜罐中扫描B类网络。由于Roo honeywall对于向网络外部的连接施加的限制，该SSH扫描工具并未发现任何SSH服务器。</p>
<p>在最初的扫描后，攻击者继续下载并安装一个IRC僵尸（IRC Bot）。IRC僵尸是可以在远程通过IRC聊天通道控制一个被入侵的系统的工具，其中被入侵的系统被设定为可以通过该通道被监听。使用IRC来控制一个被入侵的系统比直接使用SSH要隐蔽得多，因为此时攻击者不再需要直接登入系统。此外，它还使得攻击者可以同时控制多个这样的系统（它们被称为 Zombies，还魂尸)。</p>
<p>IRC通道中的会话表明，Zombies被用于使用类似于被下载到我们的蜜罐上那样的SSH扫描工具扫描B类网络。在几个小时的时间里，有4个B类网络被来自不同IRC僵尸的SSH扫描工具扫描。一次扫描大约需要700秒的时间完成。此外，我们还目睹了一个帐户名/密码列表与160,324个不同的帐户名/密码组合之间的信息交换。这些帐户名与密码的结构与对我们的蜜罐系统进行攻击时使用的那些非常相似，但比它们范围更广。</p>
<p>分析总结</p>
<p>从这些被我们的蜜罐记录的数据中我们可以得到什么？SSH是一种可以通过安全、加密的方式在网络中访问一台电脑的方法，已经被广泛接受。然而，尽管其在安全方面名誉很好，在一台电脑上操作SSH仍然会面临威胁。如我们在本文中所示的那样，密码猜测显然是威胁之一。仅SSH服务器正在运行并可经互联网连接这一事实就吸引了23次来自独立IP的攻击，在22天内我们的蜜罐共受到6,899 次登录企图。这相当于大约平均每天1次攻击、约300次登录尝试。一些攻击者的攻击非常执着，在每次攻击中执行了上百次登录尝试。</p>
<p>扫描工具的数据记录显示有非常强有力的工具被使用。它们十分灵活并且可以使用用户定制的帐户名/密码列表进行攻击。如果一个攻击者想攻击一个特定的域，他们或许可以通过社会工程获取帐户名，然而将这些帐户名于将在攻击中使用的标准密码组合。通过观察一个IRC僵尸通道，我们发现攻击者们将扫描工具与IRC僵尸计数结合来通过Zombies（攻击者通过远程通道控制的被入侵的系统）进行扫描。</p>
<p>与一系列IRC僵尸结合后，一个攻击者只需要525个Zombies就可以在1天内扫描当今公共互联网的整个IP4。如果你有一个可以被公开访问的SSH服务器，你很可能就会成为这些攻击的目标。</p>
<p>安全建议</p>
<p>有很多简单的方法可以防范这些攻击。最显而易见的方式就是关闭在很多系统中被默认安装的daemon服务。如果一个计算机系统被作为桌面电脑，很可能没有必要用通过SSH的远程访问登入该电脑。如果该方式对你不适用，还有很多其他的选择：</p>
<p>·使用大多数Unix和Linux系统中的/etc/hosts.allow和/etc/hosts.deny文件限制对特定主机的daemon访问。</p>
<p>·安装一个防火墙以限制只允许指定的电脑与网络访问SSH服务器。这在来自内部网络一台电脑的管理员必须对该电脑远程操作时尤其适用。</p>
<p>·限制SSH服务器只允许经过验证的特定用户和组登录。</p>
<p>·将SSH服务器监听端口从22调整到其他未被使用的端口。尽管这样做不会阻止攻击者连接到服务器并开始猜测密码，但它会显著降低发现你的SSH daemon的可能性，因为黑客使用的是标准SSH客户端而且假定SSH服务器的攻击工具是运行于标准的22端口上的。</p>
<p>·除了简单的密码外使用其他验证方法。下面有关于这点的更多介绍。如果你无法选择这一方法，确保正在使用的密码或验证短语安全程度高而且是比较复杂的。</p>
<p>SSH提供了另一种可以成功地减少密码猜测攻击的验证方法。这一验证方法是基于密钥的，或者说是所谓的私钥与公钥。公钥被置于服务器端作为访问你的帐户的用户锁。该锁只能被对应的私钥开启。一旦你提供了该私钥，你就可以获得访问权限。由于攻击者无法猜测或生成这一私钥，密码猜测攻击将失败。所有流行的SSH服务器默认状态下都被设置为支持这一验证方法。然而，它们通常在提供的私钥错误时重新回到基于密码的验证过程，这再次为密码猜测攻击提供了方便。为使这一降低风险的策略成功，这些服务器需要被重新设定为只接受基于密钥的验证。</p>
<p>建立使用密钥的SSH十分简单，只需要几分钟的时间。先前Brian Hatch的文章已经谈及了关于个人用户和SSH服务器间安全访问的SSH用户身份。SSH主机密钥保护一文中提供了关于每台服务器所生成的主机密钥的更多信息。如果使用SSH密钥，读者可能希望获得更多SSH于ssh-agent的例子以便更快更容易地通过SSH登录。</p>
<p>在一些例子中，对一个SSH服务器基于密码的验证或访问无法被禁用。在这种情况下，需要采用其他措施。我们已经看到攻击者猜测帐户名并且对现有系统的帐户以及在通常的计算机系统中的帐户了如指掌。如果该攻击者可以猜到系统中存在的一个帐户名——对于我们的蜜罐，在Redhat蜜罐系统中96.30%的默认帐户名被猜到——则该攻击者已经在该电脑的门口踏入了一步。因此，我们建议不要使用很容易被猜到的帐户名，例如那些常见的姓氏。不要使用&quot;Peter&quot;、&quot;Ian&quot;、或&quot;Mark&quot;，而是建立包括有姓和名的组合的帐户名，例如 &quot;seifer_chr&quot;。这可以通过控制帐户名分配的管理员做到。</p>
<p>此外，我们已经看到&quot;root&quot;帐户是在攻击中使用最多的帐户名，因为它通常都存在于计算机系统中。我们建议禁用该帐户的远程访问权限，取而代之的是管理员应该先通过一般用户帐户再使用&quot;su&quot;（超级用户指令）获得该root帐户的权限。</p>
<p>攻击者经常试图猜测在大多数系统上默认存在的长湖，例如ftp和mysql。如果 shell外壳与这些帐户关联，那么只有通过这些帐户才能访问外壳。对于ftp或mysql这样其存在只为运行电脑上某服务的帐户，外壳是不需要的并且应该被禁用，这可以有效地阻止通过SSH使用这些帐户远程登录。</p>
<p>除了使用无法被猜到的帐户名外，使用安全性强的用户密码也是很重要的。我们已经看到在攻击中使用的密码通常与帐户名相同或者是帐户名加上一些数列。我们推测攻击者们选择这些密码因为它们在恶意登录企图中是最&quot;成功&quot;的。这表明至少有些用户将他们的密码设置为这些很容易被猜到的字符串。系统管理员阻止用户选用这样的密码的唯一方法是通过安装各种工具软件（例如passwd+）强制用户使用安全性高的密码。</p>
<p>攻击者们正在使用工具进行密码猜测和登录尝试，例如被记录的扫描工具、QT和 55hb。然而，尽管有这些工具存在，由于SSH服务器端内置的对于失败登录企图的故意延迟以及各种网络延迟，登录尝试的最短平均时间也需要约2秒。尽管这提供了对于暴力攻击的防范，对于安全性差的帐户名和密码只需要少数几次尝试与猜测就可以侵入系统。以上所描述的安全措施应该被安装以保证安全工作的广泛与深入。</p>
<p>未来的工作</p>
<p>我们的分析是基于我们的蜜罐捕获的数据进行的。我们无法确定这些攻击对于网络上可以找到的系统成功的概率有多大。为了确定成功率，我们需要将这些攻击中使用的帐户名/密码组合与在真实系统中存在的帐户名/密码组合进行比较。此外，我们提出了将SSH服务器监听端口改到其他未占用的端口。我们需要建立这样配置的系统以评估其有效性。</p>
<p>关于作者</p>
<p>Christian Seifert是新西兰Honeynet联盟的成员。</p>
<p>致谢</p>
<p>感谢Jamie Riden提供降低密码猜测风险的策略以及对实际SSH密码猜测工具的参考。</p>
<p>本篇文章来源于 中国安全网-安全您的网络 原文链接：<a href="http://www.securitycn.net/html/research/service/1395.html" target="_blank">http://www.securitycn.net/html/research/service/1395.html</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span></span> | <span class="tags">Tagged <a href="/tags/安全/" class="label label-primary">安全</a></span> | <span class="time">recent updated:<time title="2014-03-29 21:31:05"datetime="2014-03-29 21:31:05"> mar. 29 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全--黑客经典之恶意SSH登录企图分析/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全--黑客经典之恶意SSH登录企图分析" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS--新浪微博如何实现SSO的分析-企业应用-Java-ITeye论坛/">新浪微博如何实现 SSO 的分析 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS--新浪微博如何实现SSO的分析-企业应用-Java-ITeye论坛/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-sso-java-iteye-">新浪微博如何实现 SSO 的分析 - 企业应用 - Java - ITeye论坛</h1>
<p><a href="http://www.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/login" target="_blank">登录</a> <a href="http://www.iteye.com/signup" target="_blank">注册</a></p>
<p><a href="http://www.iteye.com/" target="_blank"><img src="&quot;ITeye-最棒的软件开发交流社区&quot;" alt="ITeye-最棒的软件开发交流社区"></a></p>
<p><a href="http://www.iteye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.iteye.com/forums/board/Java" target="_blank">Java企业应用论坛</a> →</p>
<h1 id="-sso-">新浪微博如何实现 SSO 的分析</h1>
<p><a href="http://www.iteye.com/forums/board/Java" target="_blank">全部</a> <a href="http://www.iteye.com/forums/tag/Hibernate" target="_blank">Hibernate</a> <a href="http://www.iteye.com/forums/tag/Spring" target="_blank">Spring</a> <a href="http://www.iteye.com/forums/tag/Struts" target="_blank">Struts</a> <a href="http://www.iteye.com/forums/tag/iBATIS" target="_blank">iBATIS</a> <a href="http://www.iteye.com/forums/tag/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8" target="_blank">企业应用</a> <a href="http://www.iteye.com/forums/tag/Lucene" target="_blank">Lucene</a> <a href="http://www.iteye.com/forums/tag/SOA" target="_blank">SOA</a> <a href="http://www.iteye.com/forums/tag/Java%E7%BB%BC%E5%90%88" target="_blank">Java综合</a> <a href="http://www.iteye.com/forums/tag/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" target="_blank">设计模式</a> <a href="http://www.iteye.com/forums/tag/Tomcat" target="_blank">Tomcat</a> <a href="http://www.iteye.com/forums/tag/OO" target="_blank">OO</a> <a href="http://www.iteye.com/forums/tag/JBoss" target="_blank">JBoss</a>
« 上一页 1 <a href="http://www.iteye.com/topic/1039052?page=2" target="_blank">2</a> <a href="http://www.iteye.com/topic/1039052?page=3" target="_blank">3</a> <a href="http://www.iteye.com/topic/1039052?page=2" target="_blank">下一页 »</a></p>
<p>浏览 14772 次 锁定老帖子 <a href="">主题：新浪微博如何实现 SSO 的分析</a></p>
<p><strong>该帖已经被评为精华帖</strong> 作者 正文 * denger</p>
<ul>
<li>等级: <img src="&quot;四星会员&quot;" alt="四星会员"></li>
<li><a href="http://denger.iteye.com/" target="_blank"><img src="&quot;denger的博客: Coding for fun.      &quot;" alt="denger的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 176</li>
<li>积分: 400</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-10   最后修改：2011-06-25</li>
</ul>
<p><a href="http://www.iteye.com/topic/1039052#" target="_blank">&lt;</a> <a href="http://www.iteye.com/topic/1039052#" target="_blank">&gt;</a>  猎头职位: <a href="http://www.iteye.com/jobs/2245" target="_blank">上海:  【上海】外资企业高新诚聘web开发工程师</a></p>
<p>相关文章: <a href="http://www.iteye.com/topic/1039052#" title="关闭" target="_blank"> </a></p>
<ul>
<li><a href="http://www.iteye.com/topic/1111931" title="CAS 之 跨域 Ajax 登录实践" target="_blank">CAS 之 跨域 Ajax 登录实践</a></li>
<li><a href="http://www.iteye.com/topic/21770" title="跨域的单点登录" target="_blank">跨域的单点登录</a></li>
<li><p><a href="http://www.iteye.com/topic/544899" title="【原创】CAS调研总结" target="_blank">【原创】CAS调研总结</a>
推荐群组: <a href="http://liferay.group.iteye.com/" target="_blank">liferay</a>
<a href="http://www.iteye.com/wiki/topic/1039052" target="_blank">更多相关推荐</a>
<a href="http://www.iteye.com/forums/tag/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8" target="_blank">企业应用</a>      最近在使用sina微博时，经常性交替使用　weibo.com 和 t.sina.cm.cn进入我的微博。发现当我在 t.sina.com.cn中登录之后，直接切换至weibo.com，这时候在 weibo.com是已经登录的，当我在 weibo.com进行注销之后，再切换至 t.sina.com.cn，这时候在 t.sina.com.cn也已经是注销的状态了。
   对于SSO的实现方案及其机制，早已经不是什么新鲜的技术了，从微软为.net提供的passport机制到java中开源的JBoss SSO、Oracle OpenSSO及经典的 Yale CAS等等之类的开源或一些商业SSO中间件都不失为作为单点登录实现的选择。当然一些企业也会选择自己实现一套适合自己轻量级方案，如采用SESSIONID转递或SESSION同步复制之类的。　可以看得出SSO的价值也是具大的，就拿sina来说吧，增加 weibo.com域名之后，对于用户来说来说没有任何影响，即使你在 t.sina.com.cn中进行登录，可以无缝在两域名之间随意切换，对于它推广weibo.com无非是大大的益处。
  由于近年来一直在使用 Yale的CAS作为SSO的方案，觉得 SINA的SSO与Yale-CAS有很多异曲同工之妙，于是便对SINA的SSO进行分析，其中的细节处理还是很值的学习的。当然，由于分析看到的SINA SSO处理都只是一些表现或表面上的东西，再加上其大部分关键的sso js都已经被压缩，及SERVER端的实现机制也只是靠自己的经验及结合CAS的的一些原理进行猜测。其实本文应该叫　<CAS SSO与SINA SSO的实现对比分析>更比较贴切。</p>
<p>  好吧，进入正题。</p>
</li>
<li><p>Sina SSO之分析篇
  首先是进入 t.sina.com.cn，提交用户名及密码进行登录，通过 Firebug可以看到它通过类似Aajx POST到了 <a href="http://login.sina.com.cn/sso/login.php?client=ssologin.js(v1.3.12)，如下图所示：" target="_blank">http://login.sina.com.cn/sso/login.php?client=ssologin.js(v1.3.12)，如下图所示：</a>
  <img src="" alt="">
  不难看出，其 <a href="http://login.sina.com.cn/sso/login.php" target="_blank">http://login.sina.com.cn/sso/login.php</a> 就是类似是 CAS 中的 Server，对sina的所有应用系统提供的统一登录入口。上面的参数中有一个service参数，了解 CAS的GG应该知道 cas 在登录的时候除了username 和 password同样也有一个 service 参数，其CAS该参数含义是子应用系统的服务名标识及登录成功之后所跳转的地址。当然，sina这里使用了 &quot;miniblog&quot;作为微博的服务名，估计他在sso-server端对 miniblog 与登录成功之后的地址进行映射，如 miniblog=<a href="http://t.sina.com.cn/，这样就避免了CAS-client中转入service=" target="_blank">http://t.sina.com.cn/，这样就避免了CAS-client中转入service=</a> decodeURIComponent(&#39;<a href="http://t.sina.com.cn&#39;)之类的做法了。" target="_blank">http://t.sina.com.cn&#39;)之类的做法了。</a>
  这里的登录与CAS做法一致，将登录验证提交至统一的认证中心进行验证处理，从而避免了跨子域和全域的问题。　验证成功之后路转的路径就是service所向的地址，验证失败之后则返回至当前登录页。下面就SSO中的一些登录方面的核心问题做一些分析，看看SINA和CAS分别是如何处理的：
   　<strong>1.如何授权某个子系统允许其在sso-server进行登录验证呢，类似cas-server中的login-ticket;</strong></p>
<pre><code>  对于cas来说，在首次进入  /cas/login页时， [会产生一个一次性的login-ticket](http://denger.iteye.com/blog/809170)，也就是说在提交登录验证前必须向服务器请求一个login-ticket，在登录提交时，需要将用户名及密码以及login-ticket进行提交至 cas-server端，cas-server端确定login-ticket有效后才会对用户名及密码进行认证。
  看看sina如何处理的吧，继续看firebug:
  ![]()       以上截图是当我首次进行 t.sina.com.cn时，通过 ajax/jsonp的方式发起的一个请求，可以看到返回的callback函数中的 json 串中包含了 nonce:&quot;SXK19N&quot;的属性，参数名的汉译是“一次”或“一次性”的意思，估计这里的 nonce就是login-ticket，为再一次确实，我再试着提交登录看看，看它是否将该参数POST过去：
 ![]()
 果然不出所料， nonce:&quot;SXK19N&quot;作为参数提交过去了，证明所猜测的应该是正确的。
</code></pre><p><strong>2.比如验证码跨域跨服务器导致从session无法获取的问题，我们曾经遇到过;</strong></p>
<pre><code>  貌似sina登录没有涉及到验证码之类的东西，当你多次登录失败之后，它采用的是“您的登录过于频繁，请稍后再试吧”，这种方案确实比验证码要好的多，而且还避免了上面的说的问题。
</code></pre><p>   <strong>3. 当我登录失败了，/sso/login.php 如何将登录的错误信息返回给 t.sina.com.cn并让它进行显示呢，如果我登录成功了/sso/login.php 通过什么方式通知t.sina.com.cn呢，因为它这里使用的是ajax方式登录？</strong></p>
<pre><code> 对于这方面，cas的处理是将错误信息以参数的方式返回给 client-login，如登录失败，重定向地址： http://cas-client.com?errocode=0，如果登录成功，则直接 重定向至 service 中的url，并生成ST给客户端，表示其已经在cas-server登录成功了。
 看看sina如何处理的吧，随便输入一个用户名密码，提交登录，继续通过firebug看看它的处理过程:
</code></pre><p><img src="&quot;点击查看原始大小图片&quot;" alt=""></p>
<pre><code>  再看看t.sina.com.cn 中的html内容的变化：
  ![]()
</code></pre><p>以上图1中发生了两次请求，第一次登录验证是访问 sso认证中心，它所返回response是一个html内容，第二次请求的地址：　<a href="http://t.sina.com.cn/ajaxlogin.php" target="_blank">http://t.sina.com.cn/ajaxlogin.php</a>　framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2）
再结合以上图2信息，看到 html 中发生了变化，创建了一个　id=ssoLoginFrame 的iframe，于是便可以得出，sina 的登录并非原生的ajax方式，而是通过创建iframe来模拟提交不刷新的登录。也就是说，当用户点击登录提交时，这时候它会通过js创建iframe，将登录提效至该iframe中。</p>
<pre><code>   既然已经知道它登录是提交到iframe中，而非ajax方式，那么对于以上截图1中两个请求为什么返回的都是HTML内容就很容易解释了。再回到上面的问题，/sso/login是如何通知t.sina.com.cn登录失败了呢? 首先在以上第一个截图中返回的 HTML包含了一段 javascript:
</code></pre></li>
</ul>
<p>Javascript代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>location.replace(&quot;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2%BC%B3%A%BC%B3%A2%CA%D4%B4%CE%CA%FD%B9%FD%D3%DA%C6%B5%B7%B1%A3%AC%C7%EB%C9%D4%BA%F3%D4%D9%B5%C7%C2%BC" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2%BC%B3%A%BC%B3%A2%CA%D4%B4%CE%CA%FD%B9%FD%D3%DA%C6%B5%B7%B1%A3%AC%C7%EB%C9%D4%BA%F3%D4%D9%B5%C7%C2%BC</a>&quot;);<br>location.replace(&quot;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2%BC%B3%A%BC%B3%A2%CA%D4%B4%CE%CA%FD%B9%FD%D3%DA%C6%B5%B7%B1%A3%AC%C7%EB%C9%D4%BA%F3%D4%D9%B5%C7%C2%BC" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=4038&amp;reason=%B5%C7%C2%BC%B3%A%BC%B3%A2%CA%D4%B4%CE%CA%FD%B9%FD%D3%DA%C6%B5%B7%B1%A3%AC%C7%EB%C9%D4%BA%F3%D4%D9%B5%C7%C2%BC</a>&quot;);<pre><code>  location.replace的意思与location.href类似，同样都是改变当前的URL地址,具体区别及做法可以参考[这里](http://blog.csdn.net/fangxinggood/archive/2006/02/21/604916.aspx)及[这里](http://developer.apple.com/internet/webcontent/iframe.html)。需要注意的这里所说的通过location.replace改变当前的URL其它并非改变t.sina.com.cn的地址，而是第二个截图里iframe中src的地址，因为这段HTML是在iframe中输出的。
在  locaiton.replace 的地址中包含了一个 retcode 及 reason参数，估计这就是当前登录的错误信息。在上面第一个截图的第二个请求实际就是在iframe 中进行的 location.replace操作后的跳转地址。关键看它输出的html内容：
</code></pre></li>
</ol>
<p>Html代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><html><head>  </li>
<li><script language='javascript'>  </li>
<li>parent.sinaSSOController.feedBackUrlCallBack({&quot;result&quot;:false,&quot;errno&quot;:&quot;4038&quot;,&quot;reason&quot;:&quot;\u767b\u5f55\u5c1d\u8bd5\u6b21\u6570\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u540e\u518d\u767b\u5f55&quot;});</script></head><body></body></html>null<br><html><head> <script language='javascript'> parent.sinaSSOController.feedBackUrlCallBack({&quot;result&quot;:false,&quot;errno&quot;:&quot;4038&quot;,&quot;reason&quot;:&quot;\u767b\u5f55\u5c1d\u8bd5\u6b21\u6570\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u540e\u518d\u767b\u5f55&quot;});</script></head><body></body></html>null
  这段js是在 iframe中执行的，所以可以通过 parent 进行访问 t.sina.com.cn中的js，可以肯定 parent.sinaSSOController.feedBackUrlCallBack 就是告诉 t.sina.com.cn 当前已经登录失败了，并且将错误信息传至该入该callback了。至此，已经完成了 /sso/login.php 对 t.sina.com.cn的信息传送。　新浪果然是有一手呀，在CAS中AJAX登录一直都是一个问题，而sina它巧妙的通过iframe+callback 进行实现了。
  接着，再看看它对于登录成功之后如何通知 t.sina.com.cn的吧，先看看登录成功之后 sina-sso-server 会做什么，看firebug截图：
   <img src="&quot;点击查看原始大小图片&quot;" alt="">
   重点在于 set-Cookie: tgc=TGT-MTc4NTc0NzM0Mw==-1305003116-ja-D51B2EB107B79FC50D8CA424BFE08907;  哈哈，熟悉CAS的应该会很熟悉这个，没想到SINA的TGT与CAS的TGT不但参数命名，居然连生成的规则也一模一样，估计sina肯定是参考了 cas 的实现机制。关于TGT是什么或其作用可以参考：<a href="http://zhenkm0507.iteye.com/blog/546805" target="_blank">CAS总结之Ticket篇</a>。另外还有一个就是当登录成功之后，sina-sso-server会将用户登陆名等等放在sina.com.cn根域的cookie中。
   然后再看看登录成功之后 sina-sso-server所返回的response内容：
   <img src="" alt="">
   以下是从以上摘取JS部分：</li>
</ol>
<p>Javascript代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><script>  </li>
<li>try{sinaSSOController.setCrossDomainUrlList({&quot;retcode&quot;:0,&quot;arrURL&quot;:[&quot;http:\/\/weibo.com\/sso\/crosdom?action=login&amp;savestate=1305607916&quot;]});}catch(e){}try{sinaSSOController.crossDomainAction(&#39;login&#39;,function(){location.replace(&#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0&#39;);});}catch(e){}" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0&#39;);});}catch(e){}</a>  </li>
<li></script><br><script> try{sinaSSOController.setCrossDomainUrlList({&quot;retcode&quot;:0,&quot;arrURL&quot;:[&quot;http:\/\/weibo.com\/sso\/crosdom?action=login&amp;savestate=1305607916&quot;]});}catch(e){}try{sinaSSOController.crossDomainAction(&#39;login&#39;,function(){location.replace(&#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0&#39;);});}catch(e){}" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0&#39;);});}catch(e){}</a> </script>
   首先再次声明，以上firebug截图中的请求处理，并非 AJAX，而是在 t.sina.com.cn中放了一个iframe，输出的 reponse都会至iframe当中.<br>   以上的js主要重点在于:</li>
</ol>
<p>Javascript代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>location.replace(&#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0</a>&#39;)<br>location.replace(&#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;retcode=0</a>&#39;)
   还是通过设置当前iframe中src地址，再看看跳转至<a href="http://t.sina.com.cn/ajaxlogin.php后的response内容吧：" target="_blank">http://t.sina.com.cn/ajaxlogin.php后的response内容吧：</a>
   <img src="" alt="">
   返回用户信息(从cookie中获取的)，并且还是类似上面的做法，通过　parent.sinaSSOController.feedBackUrlCallBack回调t.sina.com.cn中的js，告诉它这个用户已经登录成功了。
   于是t.sina.com.cn便进行跳转至　t.sina.com.cn/dengers 中，从而实现登录。
   <img src="" alt="">
   整体的处理流程如下：
   <img src="" alt="">
   <strong>4. 当我在t.sina.com.cn中登录后，切换至weibo.com，weibo.com我应该也是已经登录的，如何做到呢？</strong><pre><code>对于这个问题，CAS中的处理就是，当我进入 weibo.com的时候，马上跳转至  /cas/login，然后在login中判断cookie是否存在TGT，如果存在，并确定其有效性后，则认为你已经登录，并为你生成一个ST，将ST作为ticket参数使其重定向至 weibo.com?ticket=TG-xxxx 并登录。
</code></pre>   看看sina怎么处理的吧，首先我直接在t.sina.com.cn登录成功。然后再新建一个选项卡，输入 weibo.com：
   <img src="&quot;点击查看原始大小图片&quot;" alt="">
   可以看得出，当我进入　weibo.com之后，sina并没有直接进入 weibo.com的主页，而是马上重定向至:  <a href="http://login.sina.com.cn/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;_rand=1305008634.5127&amp;gateway=1&amp;service=miniblog&amp;useticket=1&amp;returntype=META" target="_blank">http://login.sina.com.cn/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;_rand=1305008634.5127&amp;gateway=1&amp;service=miniblog&amp;useticket=1&amp;returntype=META</a> 　与cas的做法确实一致。　再看看该 login.php的Response 信息，主要是JS：</li>
</ol>
<p>Js代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li><script type="text/javascript" language="javascript">  </li>
<li>location.replace(&quot;<a href="http://weibo.com/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;ticket=ST-MTc4NTc0NzM0Mw==-1305008634-ja-694BA43623A3F72999AE7129A0572048&amp;retcode=0" target="_blank">http://weibo.com/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;ticket=ST-MTc4NTc0NzM0Mw==-1305008634-ja-694BA43623A3F72999AE7129A0572048&amp;retcode=0</a>&quot;);  </li>
<li><p></script><br><script type="text/javascript" language="javascript"> location.replace(&quot;<a href="http://weibo.com/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;ticket=ST-MTc4NTc0NzM0Mw==-1305008634-ja-694BA43623A3F72999AE7129A0572048&amp;retcode=0" target="_blank">http://weibo.com/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&amp;ticket=ST-MTc4NTc0NzM0Mw==-1305008634-ja-694BA43623A3F72999AE7129A0572048&amp;retcode=0</a>&quot;); </script>
   看到这里之后，不得不怀疑 SINA　的 SSO　是不是用的就是 CAS　啊！！不但连 TGT 参数名一样，连ST规则及参数名也一模一样，其处理机制也十分相似。
   到这里之后就与 CAS　的处理一样了，就不详细写了，可以参考 CAS相关文章。
──────────
PS:由于在分析过程中里面的很多SSO关键JS都压缩了，所以难免会存在误差。　不过SINA的SSO很多细节方面确实处理的很好，作为互联网应用的话，如果单纯的只是把 CAS　DOWNLOAD　下来，然后直接配配就用的话很多方面的处理还是很不到位的。　有时间我把我们CAS参考 SINA　调整一下。
  到这里，不得不说的一个事情就是，之前在<a href="http://www.iteye.com/topic/1000776" target="_blank">分析淘宝cookie如何跨域获取</a>时，大家都说出了一个taobao的jsonp实际存在一定的安全隐患。后面那个淘宝的GG看到之后加入Refer的判断。而现在，在分析的过程中发现新浪也有这样的问题，可以尝试一下，随便在本地建立一个html，引入jquery，然后使用下面的JS，就可以获取到sina中的登录邮箱名等信息，前提是你需要先在sina中登录：
Js代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
</li>
<li><p>$.ajax({url: &#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=0&amp;callback=?&amp;retcode=0" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=0&amp;callback=?&amp;retcode=0</a>&#39;, dataType:&#39;jsonp&#39;,  </p>
</li>
<li>success:function(data){  </li>
<li>alert(data.userinfo.userid);  </li>
<li>}});<br>$.ajax({url: &#39;<a href="http://t.sina.com.cn/ajaxlogin.php?framelogin=0&amp;callback=?&amp;retcode=0" target="_blank">http://t.sina.com.cn/ajaxlogin.php?framelogin=0&amp;callback=?&amp;retcode=0</a>&#39;, dataType:&#39;jsonp&#39;, success:function(data){ alert(data.userinfo.userid); }});</li>
</ol>
<ul>
<li><a href="http://dl.iteye.com/upload/attachment/0047/8286/31cd9585-6269-3a37-b8f4-2b8d02e4729a.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></li>
<li><p>大小: 50.6 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8303/e1584505-a33b-31f0-bd37-45d01091e95e.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 26.4 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8305/d4482ff9-9dc3-3ac5-ad7d-c7f994f30ed3.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 37.5 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8580/77c647c4-5c36-3dcd-910f-c90a201cfe71.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 40 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8597/7f3a898c-6211-3cdd-acfe-f940615a73e8.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 134.6 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8602/966dd896-d63f-3622-b78c-ee23370baaed.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 56 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8608/30cd2444-e47c-3b5c-876f-e357a5a617f3.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 29 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8615/ddda1c2e-b441-3e66-930f-6c06a2d2bfa1.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 35.9 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8620/f660b8c0-67b0-31c0-ae8c-27fa88491198.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 103.5 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/8636/77438b2b-c573-3bba-8853-682ecdd3380d.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 110.8 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/9000/e43d4e20-665b-342e-a693-62bd388c9597.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 134.6 KB</p>
</li>
<li><p><a href="http://dl.iteye.com/upload/attachment/0047/9002/61d8dccb-90d7-3c8e-b9c0-d58bd48c902e.png" target="_blank"><img src="&quot;点击查看原始大小图片&quot;" alt=""></a></p>
</li>
<li><p>大小: 85.2 KB</p>
</li>
<li><p><a href="http://www.iteye.com/topic/1039052#" target="_blank">查看图片附件</a></p>
</li>
</ul>
<p>声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。
推荐链接</p>
<ul>
<li><a href="http://www.iteye.com/clicks/716" target="_blank">想进外企，出国，跳槽，找工作？英语不好,快来充电吧</a></li>
<li><a href="http://www.iteye.com/clicks/609"></a></li>
<li><a href="http://www.iteye.com/clicks/770" target="_blank">世界级研发人员汇聚深圳！</a> <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://denger.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://denger.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=denger" title="发送站内短信" target="_blank"> </a> <a href="http://denger.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=denger" title="关注作者" target="_blank"> </a>  * 苍山洱海</li>
<li>等级: 初级会员</li>
<li><a href="http://yangkun0318-126-com.iteye.com/" target="_blank"><img src="&quot;苍山洱海的博客: &quot;" alt="苍山洱海的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 95</li>
<li>积分: 0</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-10  </li>
</ul>
<p>好文章。分析的很详实。慢慢看。 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://yangkun0318-126-com.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://yangkun0318-126-com.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=%E8%8B%8D%E5%B1%B1%E6%B4%B1%E6%B5%B7" title="发送站内短信" target="_blank"> </a> <a href="http://yangkun0318-126-com.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=%E8%8B%8D%E5%B1%B1%E6%B4%B1%E6%B5%B7" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2095803" title="苍山洱海回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * ln1058</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://ln1058.iteye.com/" target="_blank"><img src="&quot;ln1058的博客: 这是一段很长很长的旅程,流尽所有的泪水永无止境,我奋力地穿越苦惘和迷墙,在我的路上寻找生命的意义... &quot;" alt="ln1058的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 43</li>
<li>积分: 40</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>我怎么觉得没必要这么麻烦呢。
如果是我来做，直接通过cookie来判断用户是否为登录状态，然后在进行相关的URL跳转。
这种网站对于用户的安全性都不高，真有必要这么麻烦吗？ <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://ln1058.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://ln1058.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=ln1058" title="发送站内短信" target="_blank"> </a> <a href="http://ln1058.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=ln1058" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096212" title="ln1058回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * denger</p>
<ul>
<li>等级: <img src="&quot;四星会员&quot;" alt="四星会员"></li>
<li><a href="http://denger.iteye.com/" target="_blank"><img src="&quot;denger的博客: Coding for fun.      &quot;" alt="denger的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 176</li>
<li>积分: 400</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-11   最后修改：2011-05-11</li>
</ul>
<p>ln1058 写道</p>
<p>我怎么觉得没必要这么麻烦呢。
如果是我来做，直接通过cookie来判断用户是否为登录状态，然后在进行相关的URL跳转。
实际上说起来确实是这样，CAS和SINA也是这样的，直接从cookie判断用户是否已经登录，如果已经登录进行相关 URL的跳转。但是，cookie只会存储在一个域名下(login.sina.com.cn) ， sina很多方面都采用 AJAX/JSONP　或 iframe　的方式，因为基本上全部都是跨全域的&quot;AJAX&quot;方式登录的，所以很多地方处理起来并不是那么方便。
另外一个还要考虑的SSO的灵活和通用信，一个的系统或新的域名整合过来，增加或修改达到最少，这些在设计SSO中都是需要考虑、封装的，而sina这方面确实封装的还可以，整个SSO的处理逻辑也很清楚。他参考了CAS的设计方案或者说直接使用的就是CAS然后进行二次开发的。
引用</p>
<p>这种网站对于用户的安全性都不高，真有必要这么麻烦吗？
新浪有着上亿的微博用户噢....　就你一句话说他安全性不高，他就不高了？ <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://denger.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://denger.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=denger" title="发送站内短信" target="_blank"> </a> <a href="http://denger.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=denger" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096237" title="denger回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * fangin</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://fangin.iteye.com/" target="_blank"><img src="&quot;fangin的博客: &quot;" alt="fangin的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 52</li>
<li>积分: 30</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>ln1058 写道</p>
<p>我怎么觉得没必要这么麻烦呢。
如果是我来做，直接通过cookie来判断用户是否为登录状态，然后在进行相关的URL跳转。
这种网站对于用户的安全性都不高，真有必要这么麻烦吗？
你不能因为用户禁用cookie就登陆不上去啊 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://fangin.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://fangin.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=fangin" title="发送站内短信" target="_blank"> </a> <a href="http://fangin.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=fangin" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096261" title="fangin回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * denger</p>
<ul>
<li>等级: <img src="&quot;四星会员&quot;" alt="四星会员"></li>
<li><a href="http://denger.iteye.com/" target="_blank"><img src="&quot;denger的博客: Coding for fun.      &quot;" alt="denger的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 176</li>
<li>积分: 400</li>
<li>来自: 北京</li>
<li><img src="" alt="">
  发表时间：2011-05-11   最后修改：2011-05-11</li>
</ul>
<p>fangin 写道</p>
<p>ln1058 写道</p>
<p>我怎么觉得没必要这么麻烦呢。
如果是我来做，直接通过cookie来判断用户是否为登录状态，然后在进行相关的URL跳转。
这种网站对于用户的安全性都不高，真有必要这么麻烦吗？
你不能因为用户禁用cookie就登陆不上去啊
你说的没错，不过遗憾的是 sina当你禁用了cookie你确实登录不上去。貌似连iteye也是这样。 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://denger.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://denger.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=denger" title="发送站内短信" target="_blank"> </a> <a href="http://denger.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=denger" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096274" title="denger回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * aweber</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://aweber.iteye.com/" target="_blank"><img src="&quot;aweber的博客: &quot;" alt="aweber的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 3</li>
<li>积分: 30</li>
<li>来自: 福建</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>亮点是 iframe调用父窗口js函数的解决方法。居然在当前域名下整了一个跳转页面，在跳转页面里面调用父窗口地址。NB。
我之前都是 在子iframe里面再包含一个iframe，简称孙iframe，孙iframe和父窗口同域名，也就是跳转页面，在孙iframe里面调用父窗口的函数 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://aweber.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://aweber.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=aweber" title="发送站内短信" target="_blank"> </a> <a href="http://aweber.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=aweber" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096367" title="aweber回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * xiang37</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://xiva.iteye.com/" target="_blank"><img src="&quot;xiang37的博客: 一步既出，无需罣碍，前行便是&quot;" alt="xiang37的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 22</li>
<li>积分: 40</li>
<li>来自: 南京</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>支持一个，最近在研究sso，现在想先做个cas的实例出来。 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://xiva.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://xiva.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=xiang37" title="发送站内短信" target="_blank"> </a> <a href="http://xiva.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=xiang37" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096404" title="xiang37回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * tengfei3003</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://tengfei3003.iteye.com/" target="_blank"><img src="&quot;tengfei3003的博客: tengfei3003&quot;" alt="tengfei3003的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 9</li>
<li>积分: 40</li>
<li>来自: 南京</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>分析透彻，好好研究研究 <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://tengfei3003.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://tengfei3003.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=tengfei3003" title="发送站内短信" target="_blank"> </a> <a href="http://tengfei3003.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=tengfei3003" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2096616" title="tengfei3003回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票  * jeho0815</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://jeho0815.iteye.com/" target="_blank"><img src="&quot;jeho0815的博客: &quot;" alt="jeho0815的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 21</li>
<li>积分: 30</li>
<li>来自: 深圳</li>
<li><img src="" alt="">
  发表时间：2011-05-11  </li>
</ul>
<p>看的有点困难啊，实力太差了！ <a href="http://www.iteye.com/topic/1039052#" target="_blank">返回顶楼</a> <a href="http://jeho0815.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://jeho0815.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=jeho0815" title="发送站内短信" target="_blank"> </a> <a href="http://jeho0815.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=jeho0815" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/1039052#2097028" title="jeho0815回帖:新浪微博如何实现 SSO 的分析" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/1039052#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/1039052#" title="差" target="_blank">0</a> 请登录后投票</p>
<p>« 上一页 1 <a href="http://www.iteye.com/topic/1039052?page=2" target="_blank">2</a> <a href="http://www.iteye.com/topic/1039052?page=3" target="_blank">3</a> <a href="http://www.iteye.com/topic/1039052?page=2" target="_blank">下一页 »</a>
<a href="http://www.iteye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.iteye.com/forums/board/Java" target="_blank">Java企业应用版</a>
跳转论坛:移动开发技术 Web前端技术 Java企业应用 编程语言技术 综合技术 入门技术 招聘求职 海阔天空</p>
<ul>
<li><a href="http://www.iteye.com/jobs/2137" title="吉林:用友汽车软件诚聘高级Java工程师工作地点：长春、北京" target="_blank">吉林: 用友汽车软件诚聘高级Java工程师工作地点：长</a></li>
<li><a href="http://www.iteye.com/jobs/2144" title="广东:用友汽车软件诚聘中级JAVA工程师 工作地点：广州" target="_blank">广东: 用友汽车软件诚聘中级JAVA工程师 工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2343" title="上海:宝尊电商诚聘JAVA中级软件工程师" target="_blank">上海: 宝尊电商诚聘JAVA中级软件工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2426" title="北京:都乐保诚聘Java高级开发工程师" target="_blank">北京: 都乐保诚聘Java高级开发工程师</a></li>
<li><a href="http://www.iteye.com/jobs/1144" title="陕西:ThoughtWorks诚聘西安Senior Java Application Developer" target="_blank">陕西: ThoughtWorks诚聘西安Senior Java Applicatio</a></li>
<li><a href="http://www.iteye.com/jobs/2078" title="上海:用友汽车软件诚聘项目经理" target="_blank">上海: 用友汽车软件诚聘项目经理</a></li>
<li><a href="http://www.iteye.com/jobs/2106" title="上海:爱可生技术诚聘高级JAVA工程师" target="_blank">上海: 爱可生技术诚聘高级JAVA工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2141" title="上海:用友汽车软件诚聘初级java开发工程师（UAP平台）" target="_blank">上海: 用友汽车软件诚聘初级java开发工程师（UAP平</a></li>
<li><a href="http://www.iteye.com/jobs/2344" title="上海:宝尊电商诚聘JAVA高级软件工程师" target="_blank">上海: 宝尊电商诚聘JAVA高级软件工程师</a></li>
<li><a href="http://www.iteye.com/jobs/1628" title="浙江:阿里巴巴诚聘高级Java工程师" target="_blank">浙江: 阿里巴巴诚聘高级Java工程师</a></li>
<li><a href="http://www.iteye.com/jobs/1849" title="浙江:阿里巴巴诚聘C++开发工程师(搜索引擎和广告引擎方向，偏底层)" target="_blank">浙江: 阿里巴巴诚聘C++开发工程师(搜索引擎和广告</a></li>
<li><a href="http://www.iteye.com/jobs/2136" title="吉林:用友汽车软件诚聘java开发工程师 工作地点：长春、北京" target="_blank">吉林: 用友汽车软件诚聘java开发工程师 工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2143" title="上海:用友汽车软件诚聘中级java程序员（工作地点：上海安亭）" target="_blank">上海: 用友汽车软件诚聘中级java程序员（工作地点：</a></li>
<li><a href="http://www.iteye.com/jobs/2064" title="上海:用友汽车软件诚聘高级Java程序员" target="_blank">上海: 用友汽车软件诚聘高级Java程序员</a></li>
<li><a href="http://www.iteye.com/jobs/2427" title="北京:都乐保诚聘Java开发工程师" target="_blank">北京: 都乐保诚聘Java开发工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2321" title="云南:云南远信诚聘高级软件工程师(J2EE) " target="_blank">云南: 云南远信诚聘高级软件工程师(J2EE)</a></li>
<li><a href="http://www.iteye.com/jobs/2140" title="上海:用友汽车软件诚聘高级java开发工程师（UAP平台）" target="_blank">上海: 用友汽车软件诚聘高级java开发工程师（UAP平</a></li>
<li><a href="http://www.iteye.com/jobs/2437" title="广东:★路人甲★诚聘高级Java程序员 广州" target="_blank">广东: ★路人甲★诚聘高级Java程序员 广州</a></li>
<li><a href="http://www.iteye.com/jobs/2297" title="云南:云南远信诚聘软件工程师（Java）" target="_blank">云南: 云南远信诚聘软件工程师（Java）</a></li>
<li><p><a href="http://www.iteye.com/jobs/2358" title="浙江:全麦电子商务诚聘J2EE系统架构师" target="_blank">浙江: 全麦电子商务诚聘J2EE系统架构师</a></p>
</li>
<li><p><a href="http://www.iteye.com/" target="_blank">首页</a></p>
</li>
<li><a href="http://www.iteye.com/news" target="_blank">资讯</a></li>
<li><a href="http://www.iteye.com/magazines" target="_blank">精华</a></li>
<li><a href="http://www.iteye.com/forums" target="_blank">论坛</a></li>
<li><a href="http://www.iteye.com/ask" target="_blank">问答</a></li>
<li><a href="http://www.iteye.com/blogs" target="_blank">博客</a></li>
<li><a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a></li>
<li><a href="http://www.iteye.com/groups" target="_blank">群组</a></li>
<li><a href="http://www.iteye.com/job" target="_blank">招聘</a></li>
<li><a href="http://www.iteye.com/search" target="_blank">搜索</a></li>
<li><a href="http://www.iteye.com/index/service" target="_blank">广告服务</a></li>
<li><a href="http://webmaster.iteye.com/" target="_blank">ITeye黑板报</a></li>
<li><a href="http://www.iteye.com/index/contactus" target="_blank">联系我们</a></li>
<li><a href="http://www.iteye.com/index/friend_links" target="_blank">友情链接</a></li>
</ul>
<p>© 2003-2012 ITeye.com. [ <a href="http://www.miibeian.gov.cn/" target="_blank">京ICP证110151号</a> 京公网安备110105010620 ]
百联优力(北京)投资有限公司 版权所有 <img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS--新浪微博如何实现SSO的分析-企业应用-Java-ITeye论坛/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS--新浪微博如何实现SSO的分析-企业应用-Java-ITeye论坛" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/85/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/83/">83</a></li><li><a class="page-number" href="/page/84/">84</a></li><li><a class="page-number" href="/page/85/">85</a></li><li class="active"><li><span class="page-number current">86</span></li><li><a class="page-number" href="/page/87/">87</a></li><li><a class="page-number" href="/page/88/">88</a></li><li><a class="page-number" href="/page/89/">89</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/87/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 19:25:39</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
