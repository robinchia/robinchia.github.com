
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 86 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS-withoutcasloginscreen--UsingCASwithouttheCASloginscreen-CentralA/">Using CAS without the CAS login screen </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS-withoutcasloginscreen--UsingCASwithouttheCASloginscreen-CentralA/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="using-cas-without-the-cas-login-screen-central-authentication-service-jasig-wiki">Using CAS without the CAS login screen - Central Authentication Service - Jasig Wiki</h1>
<ul>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#title-heading" target="_blank">Skip to content</a></li>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#breadcrumbs" target="_blank">Skip to breadcrumbs</a></li>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#header-menu-bar" target="_blank">Skip to header menu</a></li>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#navigation" target="_blank">Skip to action menu</a></li>
<li><p><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#quick-search-query" target="_blank">Skip to quick search</a>
Quick Search</p>
</li>
<li><p><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" target="_blank">Browse</a></p>
</li>
<li><p><a href="https://wiki.jasig.org/pages/listpages.action?key=CAS" title="Browse pages in the Central Authentication Service space ( Type &#39;g&#39; then &#39;s" target="_blank">Pages</a>&quot;)</p>
</li>
<li><a href="https://wiki.jasig.org/pages/viewrecentblogposts.action?key=CAS" title="Browse blogs in the Central Authentication Service space" target="_blank">Blog</a></li>
<li><a href="https://wiki.jasig.org/labels/listlabels-heatmap.action?key=CAS" title="Browse labels in the Central Authentication Service space" target="_blank">Labels</a></li>
<li><a href="https://wiki.jasig.org/spaces/listattachmentsforspace.action?key=CAS" title="Browse attachments in the Central Authentication Service space" target="_blank">Attachments</a></li>
<li><a href="https://wiki.jasig.org/mail/archive/viewmailarchive.action?key=CAS" title="Browse mail in the Central Authentication Service space" target="_blank">Mail</a></li>
<li><a href="https://wiki.jasig.org/spaces/viewspacesummary.action?key=CAS" title="Browse additional space functions in the Central Authentication Service space" target="_blank">Advanced</a></li>
<li><p><a href="https://wiki.jasig.org/spaces/usage/report.action?key=CAS" target="_blank">Activity</a></p>
</li>
<li><p><a href="http://docs.atlassian.com/confluence/docs-41/whatsnew/iframe" target="_blank">What’s New</a></p>
</li>
<li><a href="https://wiki.jasig.org/spacedirectory/view.action" title="Browse the Confluence space directory" target="_blank">Space Directory</a></li>
<li><a href="https://wiki.jasig.org/dashboard/configurerssfeed.action" title="Create your custom RSS feed." target="_blank">Feed Builder</a></li>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" title="View available keyboard shortcuts ( Type &#39;?" target="_blank">Keyboard Shortcuts</a>&quot;)</li>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" title="Browse gadgets provided by Confluence" target="_blank">Confluence Gadgets</a></li>
<li><a href="https://wiki.jasig.org/login.action?os_destination=%2Fdisplay%2FCAS%2FUsing%2BCAS%2Bwithout%2Bthe%2BCAS%2Blogin%2Bscreen" target="_blank">Log In</a></li>
<li><a href="https://wiki.jasig.org/signup.action" target="_blank">Sign Up</a></li>
</ul>
<ol>
<li><a href="https://wiki.jasig.org/dashboard.action" title="Go to Dashboard ( Type &#39;g&#39; then &#39;d" target="_blank">Dashboard</a>&quot;)</li>
<li><a href="https://wiki.jasig.org/display/CAS" target="_blank">Central Authentication Service</a></li>
<li><strong>…</strong></li>
<li><a href="https://wiki.jasig.org/display/CAS/CASifying+Applications" target="_blank">CASifying Applications</a></li>
<li><a href="">Using CAS without the CAS login screen</a></li>
</ol>
<ul>
<li><p><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" target="_blank">Tools</a></p>
</li>
<li><p><a href="https://wiki.jasig.org/pages/viewpageattachments.action?pageId=5225" title="View Attachments ( Type &#39;t" target="_blank">Attachments (0)</a>&quot;)</p>
</li>
<li><a href="https://wiki.jasig.org/pages/viewpreviousversions.action?pageId=5225" target="_blank">Page History</a></li>
<li><p><a href="https://wiki.jasig.org/pages/viewinfo.action?pageId=5225" title="Edit restrictions" target="_blank">Restrictions</a></p>
</li>
<li><p><a href="https://wiki.jasig.org/pages/viewinfo.action?pageId=5225" target="_blank">Info</a></p>
</li>
<li><a href="https://wiki.jasig.org/pages/viewinfo.action?pageId=5225" title="Link to this Page ( Type &#39;k" target="_blank">Link to this Page…</a>&quot;)</li>
<li><a href="https://wiki.jasig.org/pages/listpages-dirview.action?key=CAS&amp;openId=5225#selectedPageInHierarchy" target="_blank">View in Hierarchy</a></li>
<li><a href="https://wiki.jasig.org/plugins/viewsource/viewpagesrc.action?pageId=5225" target="_blank">View Source</a></li>
</ul>
<h1 id="-https-wiki-jasig-org-display-cas-using-cas-without-the-cas-login-screen-"><a href="https://wiki.jasig.org/display/CAS" target="_blank"><img src="" alt=""></a>  <a href="">Using CAS without the CAS login screen</a></h1>
<p><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#page-metadata-end" target="_blank">Skip to end of metadata</a></p>
<ul>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" title="Page restrictions apply. Click the lock icon to view or edit the restriction." target="_blank">Page restrictions apply</a></li>
<li>Added by <a href="https://wiki.jasig.org/display/~awp9" target="_blank">Andrew Petro</a>, last edited by <a href="https://wiki.jasig.org/display/~brummermann" target="_blank">Hendrik Brummermann</a> on Jul 26, 2011  (<a href="https://wiki.jasig.org/pages/diffpages.action?pageId=5225&amp;originalId=52495191" target="_blank">view change</a>)</li>
<li><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" target="_blank">show comment</a> <a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" target="_blank">hide comment</a>
<strong>Comment:</strong> Corrected links that should have been relative instead of absolute.
<a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#page-metadata-start" target="_blank">Go to start of metadata</a></li>
</ul>
<p>This page is for documenting how to use CAS without using the CAS login screen.</p>
<h2 id="why-not-to-do-this">Why not to do this</h2>
<p>One of the advantages CAS brings to the table is a single authentication user experience across all applications using CAS. The user doesn&#39;t have to wonder whether he should be giving his password to any particular application, because no applications other than CAS receive the password.</p>
<p>Implementing this hack results in applications other than CAS having access to actual usernames and passwords. This is a bad thing. It reduces the security value CAS is trying to give you.</p>
<h2 id="existing-features">Existing features</h2>
<p>The CAS gateway feature allows your application to attempt to use CAS single sign on to authenticate the user without interrupting the user experience to display a CAS login screen. If no SSO session already exists, CAS simply redirects back to your service without displaying the login screen.</p>
<h2 id="alternative-approaches">Alternative approaches</h2>
<p>An alternative to your application rendering its own login screen is to get CAS Server to render the login screen you would have wanted to render. <a href="https://wiki.jasig.org/display/CAS/Columbia" target="_blank">WIND</a> goes this route. This is on the feature list for CAS 3.</p>
<p>A relatively easy option (for portals, at least) is to proxy the HTML of the CAS login page and display it inline in the portal page.  The proxied form should still submit to CAS itself.  You can tweak the CAS jsps to use different CSS styles depending on the User Agent or Remote Host, to provide a modified (e.g. smaller) login screen.</p>
<h2 id="using-cas-without-the-login-screen">Using CAS without the login screen</h2>
<p>Suppose you really do want your service to be handling the user&#39;s username and password.</p>
<p>First, produce your custom form. When your custom form submits, the recipient of the submit needs to do the following:</p>
<h3 id="validate-the-username-and-password">Validate the username and password</h3>
<p>Somehow, you need to figure out whether this username and password are correct.</p>
<p>One thing to do would be to generate an HTTP request for CAS login, parse out a valid login ticket, then issue a request for CAS login posting the login ticket, username, and password. Parse the response. If it indicates a success, the username and password are valid. Otherwise not.</p>
<p>Another thing to do would be to go directly against whatever it is that CAS is using to validate usernames and passwords.</p>
<p>If the username and password didn&#39;t match, redisplay your form. If they did match, then either 1) you&#39;re done because all you wanted to do was authenticate the user, or 2) now you need to establish the CAS SSO session in the web browser and obtain a Service ticket.</p>
<h3 id="establish-the-sso-session-and-possibly-get-a-proxy-ticket">Establish the SSO session and possibly get a Proxy Ticket</h3>
<p>Again, get a login ticket and the jsessionid. Then, generate a redirect to the browser placing the sesisonid, login ticket, the username, and the password on the CAS login URL to which you&#39;re redirecting:
<a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" target="_blank">?</a>https:</p>
<p>//cas.example.com/cas/login;jsessionid=XXXXXXXX?username=XXXXXXX&amp;password=XXXXXXX&amp;lt=XXXXXX</p>
<p>Specify the service to be your application where you want to receive the service ticket.</p>
<p>CAS will set the Single Sign On cookie so the user will have a CAS SSO session established.</p>
<p>Since the username, password, and login ticket are good, CAS will redirect back to your service with the service ticket. Grab the service ticket and validate it in the normal way (presumably using a CAS client). This is your opportunity to obtain a Proxy Ticket.</p>
<p>Note: This only works as long as the user has not visited the CAS webpage before. Otherwise he or she got a different sessionid cookie which has priority over the sessionid in the url.</p>
<h2 id="experience-reports">Experience Reports</h2>
<p><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+Login+Screen" target="_blank">Here is an experience report</a> on how an UI-less mode for CAS has been achieved using javascript only on the client side. Passwords are only handed over to the SSL secured CAS service, not to a third party.
Labels:</p>
<p>None</p>
<p><a href="https://wiki.jasig.org/display/CAS/Using+CAS+without+the+CAS+login+screen#" title="Edit Labels ( Type &#39;l" target="_blank">Edit Labels</a>&quot;)
Powered by a free <strong>Atlassian Confluence Open Source Project License</strong> granted to Java Architectures Special Interest Group. <a href="http://www.atlassian.com/c/conf/11461" target="_blank">Evaluate Confluence today</a>.
This Confluence installation runs a Free Gliffy License - <a href="http://www.gliffy.com/products/confluence-plugin/" target="_blank">Evaluate Gliffy</a> for your Wiki!</p>
<ul>
<li>Powered by <a href="http://www.atlassian.com/software/confluence" target="_blank">Atlassian Confluence</a> 4.1.5, the <a href="http://www.atlassian.com/software/confluence/tour/enterprise-wiki.jsp" target="_blank">Enterprise Wiki</a></li>
<li>Printed by Atlassian Confluence 4.1.5, the Enterprise Wiki.</li>
<li>·  <a href="http://jira.atlassian.com/secure/BrowseProject.jspa?id=10470" target="_blank">Report a bug</a></li>
<li>·  <a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" target="_blank">Atlassian News</a></li>
</ul>
<p><a href=""></a><a href=""></a><a href=""></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span><span class="breadcrumb"><li><a href="/categories/CAS/">CAS</a></li><li><a href="/categories/CAS/without+cas+login+screen/">without+cas+login+screen</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a><a href="/tags/without+cas+login+screen/" class="label label-success">without+cas+login+screen</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS-withoutcasloginscreen--UsingCASwithouttheCASloginscreen-CentralA/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS-withoutcasloginscreen--UsingCASwithouttheCASloginscreen-CentralA" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全--黑客经典之恶意SSH登录企图分析/">黑客经典之恶意SSH登录企图分析</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-安全--黑客经典之恶意SSH登录企图分析/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-ssh-">黑客经典之恶意SSH登录企图分析</h1>
<p>黑客经典之恶意SSH登录企图分析</p>
<p>原文链接：<a href="http://www.securitycn.net/html/research/service/1395.html" target="_blank">http://www.securitycn.net/html/research/service/1395.html</a></p>
<p>恶意SSH登录企图出现在一些管理者的日志中已经有几年的时间了。本文回顾了使用&quot;蜜罐&quot;（honeypot）对恶意SSH登录企图进行分析的方法，并提出了我们可以从这一活动中学到的东西。接着本文给出了关于如何使自己的系统安全面对这些攻击的建议。</p>
<p>使用honeypots进行研究</p>
<p>新西兰Honeynet（蜜罐网络）联盟是Honeynet联盟的一个成员研究机构，它致力于通过使用蜜罐技术研究黑帽子黑客（black hat hackers，指那些恶意入侵计算机或计算机网络并尽其所能进行破坏的黑客）的行为、策略和工具来提升计算机系统和网络安全。蜜罐的价值在于它们是可以公开接受攻击并被攻入的开放计算机系统，这使得研究者可以分析该系统上的恶意行为。</p>
<p>我们已经在惠灵顿的维多利亚大学建立起这样的系统来研究发生于新西兰大学网络上的恶意行为。该系统是一个高度互联的蜜罐，一个攻击者可以像在网络的任何其他系统上一样与之联系。在攻击者可知的范围内，蜜罐与其他计算机系统应该没有可分辨的差别。然而，所有流入和流出蜜罐的网络流量都通过Honeynet联盟的Roo honeywall严密监控。此外，系统事件也被蜜罐自身通过其日志功能进行记录。</p>
<p>蜜罐上运行的是标准RedHad 9服务器配置版本，带有可以通过公共互联网访问的安全外壳（Secure Shell，简称SSH）服务器。SSH是可以使得一个用户在网上通过加密通道登录到另一台电脑的程序。在过去的配置下遭遇到恶意SSH登录企图后，我们重新编配了我们的蜜罐以使其可以收集更多的数据。我们对SSH服务器打了补丁以同时记录在登录企图中使用的帐户名和密码。该蜜罐在2006年7月11日上线，在22天后的2006年8月1日下线。在这期间，该蜜罐受到了无数次的SSH登录企图攻击。我们进一步观察这些数据以确定攻击者的策略并提出提高 SSH安全水平的建议。
。</p>
<p>在该蜜罐在6月28日到7月4日运行的另一个配置上，我们增加了可以在系统被攻入后记录攻击者键盘操作的Sebek模块。我们设置了若干具有常用密码的用户帐户。几天后，一个攻击者成功进入了这一系统。在本文中给出了对这一攻击及后续攻击的分析，并提供了对恶意SSH登录企图如何被用于攻入系统的进一步分析。</p>
<p>对SSH登录企图的分析</p>
<p>这一部分分析了7月11日到8月1日我们的蜜罐捕获的数据。该分析完全基于蜜罐的系统日志文件，尤其是&quot;messages&quot;日志。&quot;messages&quot;日志记录了对SSH服务器的验证请求。它记录了日期、时间、登录企图发生的IP地址、请求的结果（失败或成功）以及验证使用的帐户名和密码。下面是两个&quot;messages&quot;的日志示例条目：</p>
<p><code> 
Jul 13 09:37:59 basta sshd[22308]: PW-ATTEMPT: fritz<br>Jul 13 09:37:59 basta sshd[22308]: Failed password for  root from 10.0.160.14<br> port 39529 ssh2<br>Jul 13 09:38:02 basta sshd[22310]: Illegal user   fatacunike from 10.0.160.14<br>Jul 13 09:38:02 basta sshd[22310]: PW-ATTEMPT: fatacunike<br>Jul 13 09:38:02 basta sshd[22310]: Failed password for illegal user fatacunike<br> from 10.0.160.14 port 40444 ssh2
</code></p>
<p>首先，我们分析了用于登录企图的用户名。在取样时间内，系统日志总共记录到2741 个不同的帐户名，包括从常见的姓氏、系统帐户名和常用帐户名到短的字符串。在这些帐户名中，15个使用频率最高的帐户名被列于表1。该表格显示有一个系统上通常存在的帐户（root，mysql）、可能存在的帐户（guest、test）以及常见的姓氏（paul）。随后图1给出了所使用过的有效与无效帐户名的分布。</p>
<p>所使用的无效帐户名远多于有效帐户名并不奇怪，但是我们注意到在蜜罐上存在的所有默认帐户名中96.30%都被攻击利用。</p>
<p><img src="http://www.securitycn.net/img/uploadimg/20060915/1052550.jpg" alt=""></p>
<p>表1 2741次攻击中出现最多的15个帐户名</p>
<p><img src="http://www.securitycn.net/img/uploadimg/20060915/1052551.jpg" alt=""></p>
<p>（Number of Account Names Used in Attack：攻击中使用的帐户名数量；</p>
<p>Number of Account Names on System：系统中的帐户名数量</p>
<p>Existing Account：有效帐户</p>
<p>Invalid Account：无效帐户）</p>
<center>图1 有效与无效帐户名数量</center>  

<p>&quot;成功&quot;的恶意SSH登录企图</p>
<p>在上面的部分中，我们分析了对于没有成功的恶意SSH登录企图数据的记录。这些数据可以使我们进一步理解这些攻击者如何操作，但是还有很多问题没有解决，其中之一是这些攻击中是否使用了工具软件。</p>
<p>7月2日，有一名攻击者通过猜测出一个SSH上的有效帐户名/密码成功地侵入了蜜罐。在这一事件中捕获的数据揭示了这些问题的答案。</p>
<p>首先我们观察了该黑客成功入侵蜜罐后进行的操作。确定了有效的帐户名/密码后，该黑客通过SSH登入蜜罐并继而下载了一个SSH扫描工具。在下面一节将更详细地介绍该工具，这里我们先将其总结为一个可以允许其使用者通过猜测密码的尝试识别并入侵其它SSH服务器的工具。这一工具安装后立刻被用来从我们的蜜罐中扫描B类网络。由于Roo honeywall对于向网络外部的连接施加的限制，该SSH扫描工具并未发现任何SSH服务器。</p>
<p>在最初的扫描后，攻击者继续下载并安装一个IRC僵尸（IRC Bot）。IRC僵尸是可以在远程通过IRC聊天通道控制一个被入侵的系统的工具，其中被入侵的系统被设定为可以通过该通道被监听。使用IRC来控制一个被入侵的系统比直接使用SSH要隐蔽得多，因为此时攻击者不再需要直接登入系统。此外，它还使得攻击者可以同时控制多个这样的系统（它们被称为 Zombies，还魂尸)。</p>
<p>IRC通道中的会话表明，Zombies被用于使用类似于被下载到我们的蜜罐上那样的SSH扫描工具扫描B类网络。在几个小时的时间里，有4个B类网络被来自不同IRC僵尸的SSH扫描工具扫描。一次扫描大约需要700秒的时间完成。此外，我们还目睹了一个帐户名/密码列表与160,324个不同的帐户名/密码组合之间的信息交换。这些帐户名与密码的结构与对我们的蜜罐系统进行攻击时使用的那些非常相似，但比它们范围更广。</p>
<p>分析总结</p>
<p>从这些被我们的蜜罐记录的数据中我们可以得到什么？SSH是一种可以通过安全、加密的方式在网络中访问一台电脑的方法，已经被广泛接受。然而，尽管其在安全方面名誉很好，在一台电脑上操作SSH仍然会面临威胁。如我们在本文中所示的那样，密码猜测显然是威胁之一。仅SSH服务器正在运行并可经互联网连接这一事实就吸引了23次来自独立IP的攻击，在22天内我们的蜜罐共受到6,899 次登录企图。这相当于大约平均每天1次攻击、约300次登录尝试。一些攻击者的攻击非常执着，在每次攻击中执行了上百次登录尝试。</p>
<p>扫描工具的数据记录显示有非常强有力的工具被使用。它们十分灵活并且可以使用用户定制的帐户名/密码列表进行攻击。如果一个攻击者想攻击一个特定的域，他们或许可以通过社会工程获取帐户名，然而将这些帐户名于将在攻击中使用的标准密码组合。通过观察一个IRC僵尸通道，我们发现攻击者们将扫描工具与IRC僵尸计数结合来通过Zombies（攻击者通过远程通道控制的被入侵的系统）进行扫描。</p>
<p>与一系列IRC僵尸结合后，一个攻击者只需要525个Zombies就可以在1天内扫描当今公共互联网的整个IP4。如果你有一个可以被公开访问的SSH服务器，你很可能就会成为这些攻击的目标。</p>
<p>安全建议</p>
<p>有很多简单的方法可以防范这些攻击。最显而易见的方式就是关闭在很多系统中被默认安装的daemon服务。如果一个计算机系统被作为桌面电脑，很可能没有必要用通过SSH的远程访问登入该电脑。如果该方式对你不适用，还有很多其他的选择：</p>
<p>·使用大多数Unix和Linux系统中的/etc/hosts.allow和/etc/hosts.deny文件限制对特定主机的daemon访问。</p>
<p>·安装一个防火墙以限制只允许指定的电脑与网络访问SSH服务器。这在来自内部网络一台电脑的管理员必须对该电脑远程操作时尤其适用。</p>
<p>·限制SSH服务器只允许经过验证的特定用户和组登录。</p>
<p>·将SSH服务器监听端口从22调整到其他未被使用的端口。尽管这样做不会阻止攻击者连接到服务器并开始猜测密码，但它会显著降低发现你的SSH daemon的可能性，因为黑客使用的是标准SSH客户端而且假定SSH服务器的攻击工具是运行于标准的22端口上的。</p>
<p>·除了简单的密码外使用其他验证方法。下面有关于这点的更多介绍。如果你无法选择这一方法，确保正在使用的密码或验证短语安全程度高而且是比较复杂的。</p>
<p>SSH提供了另一种可以成功地减少密码猜测攻击的验证方法。这一验证方法是基于密钥的，或者说是所谓的私钥与公钥。公钥被置于服务器端作为访问你的帐户的用户锁。该锁只能被对应的私钥开启。一旦你提供了该私钥，你就可以获得访问权限。由于攻击者无法猜测或生成这一私钥，密码猜测攻击将失败。所有流行的SSH服务器默认状态下都被设置为支持这一验证方法。然而，它们通常在提供的私钥错误时重新回到基于密码的验证过程，这再次为密码猜测攻击提供了方便。为使这一降低风险的策略成功，这些服务器需要被重新设定为只接受基于密钥的验证。</p>
<p>建立使用密钥的SSH十分简单，只需要几分钟的时间。先前Brian Hatch的文章已经谈及了关于个人用户和SSH服务器间安全访问的SSH用户身份。SSH主机密钥保护一文中提供了关于每台服务器所生成的主机密钥的更多信息。如果使用SSH密钥，读者可能希望获得更多SSH于ssh-agent的例子以便更快更容易地通过SSH登录。</p>
<p>在一些例子中，对一个SSH服务器基于密码的验证或访问无法被禁用。在这种情况下，需要采用其他措施。我们已经看到攻击者猜测帐户名并且对现有系统的帐户以及在通常的计算机系统中的帐户了如指掌。如果该攻击者可以猜到系统中存在的一个帐户名——对于我们的蜜罐，在Redhat蜜罐系统中96.30%的默认帐户名被猜到——则该攻击者已经在该电脑的门口踏入了一步。因此，我们建议不要使用很容易被猜到的帐户名，例如那些常见的姓氏。不要使用&quot;Peter&quot;、&quot;Ian&quot;、或&quot;Mark&quot;，而是建立包括有姓和名的组合的帐户名，例如 &quot;seifer_chr&quot;。这可以通过控制帐户名分配的管理员做到。</p>
<p>此外，我们已经看到&quot;root&quot;帐户是在攻击中使用最多的帐户名，因为它通常都存在于计算机系统中。我们建议禁用该帐户的远程访问权限，取而代之的是管理员应该先通过一般用户帐户再使用&quot;su&quot;（超级用户指令）获得该root帐户的权限。</p>
<p>攻击者经常试图猜测在大多数系统上默认存在的长湖，例如ftp和mysql。如果 shell外壳与这些帐户关联，那么只有通过这些帐户才能访问外壳。对于ftp或mysql这样其存在只为运行电脑上某服务的帐户，外壳是不需要的并且应该被禁用，这可以有效地阻止通过SSH使用这些帐户远程登录。</p>
<p>除了使用无法被猜到的帐户名外，使用安全性强的用户密码也是很重要的。我们已经看到在攻击中使用的密码通常与帐户名相同或者是帐户名加上一些数列。我们推测攻击者们选择这些密码因为它们在恶意登录企图中是最&quot;成功&quot;的。这表明至少有些用户将他们的密码设置为这些很容易被猜到的字符串。系统管理员阻止用户选用这样的密码的唯一方法是通过安装各种工具软件（例如passwd+）强制用户使用安全性高的密码。</p>
<p>攻击者们正在使用工具进行密码猜测和登录尝试，例如被记录的扫描工具、QT和 55hb。然而，尽管有这些工具存在，由于SSH服务器端内置的对于失败登录企图的故意延迟以及各种网络延迟，登录尝试的最短平均时间也需要约2秒。尽管这提供了对于暴力攻击的防范，对于安全性差的帐户名和密码只需要少数几次尝试与猜测就可以侵入系统。以上所描述的安全措施应该被安装以保证安全工作的广泛与深入。</p>
<p>未来的工作</p>
<p>我们的分析是基于我们的蜜罐捕获的数据进行的。我们无法确定这些攻击对于网络上可以找到的系统成功的概率有多大。为了确定成功率，我们需要将这些攻击中使用的帐户名/密码组合与在真实系统中存在的帐户名/密码组合进行比较。此外，我们提出了将SSH服务器监听端口改到其他未占用的端口。我们需要建立这样配置的系统以评估其有效性。</p>
<p>关于作者</p>
<p>Christian Seifert是新西兰Honeynet联盟的成员。</p>
<p>致谢</p>
<p>感谢Jamie Riden提供降低密码猜测风险的策略以及对实际SSH密码猜测工具的参考。</p>
<p>本篇文章来源于 中国安全网-安全您的网络 原文链接：<a href="http://www.securitycn.net/html/research/service/1395.html" target="_blank">http://www.securitycn.net/html/research/service/1395.html</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span></span> | <span class="tags">Tagged <a href="/tags/安全/" class="label label-primary">安全</a></span> | <span class="time">recent updated:<time title="2014-03-29 21:31:05"datetime="2014-03-29 21:31:05"> mar. 29 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全--黑客经典之恶意SSH登录企图分析/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全--黑客经典之恶意SSH登录企图分析" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS-spring-cas--23-X509Authentication/">23. X.509 Authentication</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS-spring-cas--23-X509Authentication/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="23-x-509-authentication">23. X.509 Authentication</h1>
<ol>
<li>X.509 Authentication<a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/cas.html" target="_blank">Prev</a> Part V. Additional Topics <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/runas.html" target="_blank">Next</a></li>
</ol>
<h1 id="-x-509-authentication"><a href=""></a>X.509 Authentication</h1>
<h2 id="-23-1-overview"><a href=""></a>23.1 Overview</h2>
<p>The most common use of X.509 certificate authentication is in verifying the identity of a server when using SSL, most commonly when using HTTPS from a browser. The browser will automatically check that the certificate presented by a server has been issued (ie digitally signed) by one of a list of trusted certificate authorities which it maintains.</p>
<p>You can also use SSL with “mutual authentication”; the server will then request a valid certificate from the client as part of the SSL handshake. The server will authenticate the client by checking that its certificate is signed by an acceptable authority. If a valid certificate has been provided, it can be obtained through the servlet API in an application. Spring Security X.509 module extracts the certificate using a filter. It maps the certificate to an application user and loads that user&#39;s set of granted authorities for use with the standard Spring Security infrastructure.</p>
<p>You should be familiar with using certificates and setting up client authentication for your servlet container before attempting to use it with Spring Security. Most of the work is in creating and installing suitable certificates and keys. For example, if you&#39;re using Tomcat then read the instructions here</p>
<p><a href="http://tomcat.apache.org/tomcat-6.0-doc/ssl-howto.html" target="_blank"><a href="http://tomcat.apache.org/tomcat-6.0-doc/ssl-howto.html">http://tomcat.apache.org/tomcat-6.0-doc/ssl-howto.html</a></a>
. It&#39;s important that you get this working before trying it out with Spring Security</p>
<h2 id="-23-2-adding-x-509-authentication-to-your-web-application"><a href=""></a>23.2 Adding X.509 Authentication to Your Web Application</h2>
<p>Enabling X.509 client authentication is very straightforward. Just add the</p>
<p><x509/>
element to your http security namespace configuration.</p>
<http> ... <x509 subject-principal-regex="CN=(./*?)," user-service-ref="userService"/>; ... </http>

<p>The element has two optional attributes:</p>
<ul>
<li>subject-principal-regex
. The regular expression used to extract a username from the certificate&#39;s subject name. The default value is shown above. This is the username which will be passed to the</li>
</ul>
<p>UserDetailsService
to load the authorities for the user.</p>
<ul>
<li>user-service-ref
. This is the bean Id of the</li>
</ul>
<p>UserDetailsService
to be used with X.509. It isn&#39;t needed if there is only one defined in your application context.</p>
<p>The</p>
<p>subject-principal-regex
should contain a single group. For example the default expression &quot;CN=(./*?),&quot; matches the common name field. So if the subject name in the certificate is &quot;CN=Jimi Hendrix, OU=...&quot;, this will give a user name of &quot;Jimi Hendrix&quot;. The matches are case insensitive. So &quot;emailAddress=(.?),&quot; will match &quot;EMAILADDRESS=jimi@hendrix.org,CN=...&quot; giving a user name &quot;jimi@hendrix.org&quot;. If the client presents a certificate and a valid username is successfully extracted, then there should be a valid</p>
<p>Authentication
object in the security context. If no certificate is found, or no corresponding user could be found then the security context will remain empty. This means that you can easily use X.509 authentication with other options such as a form-based login.</p>
<h2 id="-23-3-setting-up-ssl-in-tomcat"><a href=""></a>23.3 Setting up SSL in Tomcat</h2>
<p>There are some pre-generated certificates in the</p>
<p>samples/certificate
directory in the Spring Security project. You can use these to enable SSL for testing if you don&#39;t want to generate your own. The file</p>
<p>server.jks
contains the server certificate, private key and the issuing certificate authority certificate. There are also some client certificate files for the users from the sample applications. You can install these in your browser to enable SSL client authentication.</p>
<p>To run tomcat with SSL support, drop the</p>
<p>server.jks
file into the tomcat</p>
<p>conf
directory and add the following connector to the</p>
<p>server.xml
file</p>
<Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true" scheme="https" secure="true" clientAuth="true" sslProtocol="TLS" keystoreFile="${catalina.home}/conf/server.jks" keystoreType="JKS" keystorePass="password" truststoreFile="${catalina.home}/conf/server.jks" truststoreType="JKS" truststorePass="password" />

<p>*
clientAuth</p>
<ul>
<li>can also be set to *
want</li>
<li>if you still want SSL connections to succeed even if the client doesn&#39;t provide a certificate. Clients which don&#39;t present a certificate won&#39;t be able to access any objects secured by Spring Security unless you use a non-X.509 authentication mechanism, such as form authentication.
<a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/cas.html" target="_blank">Prev</a> <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/advanced-topics.html" target="_blank">Up</a> <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/runas.html" target="_blank">Next</a>22. CAS Authentication <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/springsecurity.html" target="_blank">Home</a> 24. Run-As Authentication Replacement    <img src="" alt=""></li>
</ul>
<p><a href=""><img src="" alt=""></a></p>
<p><a href="http://www.springsource.com/?cid=70180000000wIe4AAE" target="_blank"><img src="" alt=""></a>
allSpringSourceGrailsHypericGemstoneRabbitMQ <img src="&quot;Search Documentation&quot;" alt=""></p>
<p><img src="&quot;click to toggle&quot;" alt="">
<a href="http://www.springsource.com/spring-framework-consulting" target="_blank"><img src="" alt=""></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span><span class="breadcrumb"><li><a href="/categories/CAS/">CAS</a></li><li><a href="/categories/CAS/spring-cas/">spring-cas</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a><a href="/tags/spring-cas/" class="label label-success">spring-cas</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS-spring-cas--23-X509Authentication/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS-spring-cas--23-X509Authentication" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS-spring-cas--22-CASAuthentication/">22. CAS Authentication</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS-spring-cas--22-CASAuthentication/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="22-cas-authentication">22. CAS Authentication</h1>
<p><img src="" alt=""> Saving Data...
正在保存数据...
正在儲存資料...</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span><span class="breadcrumb"><li><a href="/categories/CAS/">CAS</a></li><li><a href="/categories/CAS/spring-cas/">spring-cas</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a><a href="/tags/spring-cas/" class="label label-success">spring-cas</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS-spring-cas--22-CASAuthentication/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS-spring-cas--22-CASAuthentication" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-CAS-spring-cas--21-JavaAuthenticationandAuthorizationService/">21. Java Authentication and Authorization Service </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:39.000Z"> <a href="/2014/02/02/2014-02-02-CAS-spring-cas--21-JavaAuthenticationandAuthorizationService/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="21-java-authentication-and-authorization-service-jaas-provider">21. Java Authentication and Authorization Service (JAAS) Provider</h1>
<ol>
<li>Java Authentication and Authorization Service (JAAS) Provider<a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/taglibs.html" target="_blank">Prev</a> Part V. Additional Topics <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/cas.html" target="_blank">Next</a></li>
</ol>
<h1 id="-java-authentication-and-authorization-service-jaas-provider"><a href=""></a>Java Authentication and Authorization Service (JAAS) Provider</h1>
<h2 id="-21-1-overview"><a href=""></a>21.1 Overview</h2>
<p>Spring Security provides a package able to delegate authentication requests to the Java Authentication and Authorization Service (JAAS). This package is discussed in detail below.</p>
<h2 id="-21-2-abstractjaasauthenticationprovider"><a href=""></a>21.2 AbstractJaasAuthenticationProvider</h2>
<p>The</p>
<p>AbstractJaasAuthenticationProvider
is the basis for the provided JAAS</p>
<p>AuthenticationProvider
implementations. Subclasses must implement a method that creates the</p>
<p>LoginContext
. The</p>
<p>AbstractJaasAuthenticationProvider
has a number of dependencies that can be injected into it that are discussed below.</p>
<h3 id="-21-2-1-jaas-callbackhandler"><a href=""></a>21.2.1 JAAS CallbackHandler</h3>
<p>Most JAAS</p>
<p>LoginModule
s require a callback of some sort. These callbacks are usually used to obtain the username and password from the user.</p>
<p>In a Spring Security deployment, Spring Security is responsible for this user interaction (via the authentication mechanism). Thus, by the time the authentication request is delegated through to JAAS, Spring Security&#39;s authentication mechanism will already have fully-populated an</p>
<p>Authentication
object containing all the information required by the JAAS</p>
<p>LoginModule
.</p>
<p>Therefore, the JAAS package for Spring Security provides two default callback handlers,</p>
<p>JaasNameCallbackHandler
and</p>
<p>JaasPasswordCallbackHandler
. Each of these callback handlers implement</p>
<p>JaasAuthenticationCallbackHandler
. In most cases these callback handlers can simply be used without understanding the internal mechanics.</p>
<p>For those needing full control over the callback behavior, internally</p>
<p>AbstractJaasAuthenticationProvider
wraps these</p>
<p>JaasAuthenticationCallbackHandler
s with an</p>
<p>InternalCallbackHandler
. The</p>
<p>InternalCallbackHandler
is the class that actually implements JAAS’ normal</p>
<p>CallbackHandler
interface. Any time that the JAAS</p>
<p>LoginModule
is used, it is passed a list of application context configured</p>
<p>InternalCallbackHandler
s. If the</p>
<p>LoginModule
requests a callback against the</p>
<p>InternalCallbackHandler
s, the callback is in-turn passed to the</p>
<p>JaasAuthenticationCallbackHandler
s being wrapped.</p>
<h3 id="-21-2-2-jaas-authoritygranter"><a href=""></a>21.2.2 JAAS AuthorityGranter</h3>
<p>JAAS works with principals. Even &quot;roles&quot; are represented as principals in JAAS. Spring Security, on the other hand, works with</p>
<p>Authentication
objects. Each</p>
<p>Authentication
object contains a single principal, and multiple</p>
<p>GrantedAuthority
s. To facilitate mapping between these different concepts, Spring Security&#39;s JAAS package includes an</p>
<p>AuthorityGranter
interface.</p>
<p>An</p>
<p>AuthorityGranter
is responsible for inspecting a JAAS principal and returning a set of</p>
<p>String
s, representing the authorities assigned to the principal. For each returned authority string, the</p>
<p>AbstractJaasAuthenticationProvider
creates a</p>
<p>JaasGrantedAuthority
(which implements Spring Security’s</p>
<p>GrantedAuthority
interface) containing the authority string and the JAAS principal that the</p>
<p>AuthorityGranter
was passed. The</p>
<p>AbstractJaasAuthenticationProvider
obtains the JAAS principals by firstly successfully authenticating the user’s credentials using the JAAS</p>
<p>LoginModule
, and then accessing the</p>
<p>LoginContext
it returns. A call to</p>
<p>LoginContext.getSubject().getPrincipals()
is made, with each resulting principal passed to each</p>
<p>AuthorityGranter
defined against the</p>
<p>AbstractJaasAuthenticationProvider.setAuthorityGranters(List)
property.</p>
<p>Spring Security does not include any production</p>
<p>AuthorityGranter
s given that every JAAS principal has an implementation-specific meaning. However, there is a</p>
<p>TestAuthorityGranter
in the unit tests that demonstrates a simple</p>
<p>AuthorityGranter
implementation.</p>
<h2 id="-21-3-defaultjaasauthenticationprovider"><a href=""></a>21.3 DefaultJaasAuthenticationProvider</h2>
<p>The</p>
<p>DefaultJaasAuthenticationProvider
allows a JAAS</p>
<p>Configuration
object to be injected into it as a dependency. It then creates a</p>
<p>LoginContext
using the injected JAAS</p>
<p>Configuration
. This means that</p>
<p>DefaultJaasAuthenticationProvider
is not bound any particular implementation of</p>
<p>Configuration
as</p>
<p>JaasAuthenticationProvider
is.</p>
<h3 id="-21-3-1-inmemoryconfiguration"><a href=""></a>21.3.1 InMemoryConfiguration</h3>
<p>In order to make it easy to inject a</p>
<p>Configuration
into</p>
<p>DefaultJaasAuthenticationProvider
, a default in memory implementation named</p>
<p>InMemoryConfiguration
is provided. The implementation constructor accepts a</p>
<p>Map
where each key represents a login configuration name and the value represents an</p>
<p>Array
of</p>
<p>AppConfigurationEntry
s.</p>
<p>InMemoryConfiguration
also supports a default</p>
<p>Array
of</p>
<p>AppConfigurationEntry
objects that will be used if no mapping is found within the provided</p>
<p>Map
. For details, refer to the class level javadoc of</p>
<p>InMemoryConfiguration
.</p>
<h3 id="-21-3-2-defaultjaasauthenticationprovider-example-configuration"><a href=""></a>21.3.2 DefaultJaasAuthenticationProvider Example Configuration</h3>
<p>While the Spring configuration for</p>
<p>InMemoryConfiguration
can be more verbose than the standarad JAAS configuration files, using it in conjuction with</p>
<p>DefaultJaasAuthenticationProvider
is more flexible than</p>
<p>JaasAuthenticationProvider
since it not dependant on the default</p>
<p>Configuration
implementation.</p>
<p>An example configuration of</p>
<p>DefaultJaasAuthenticationProvider
using</p>
<p>InMemoryConfiguration
is provided below. Note that custom implementations of</p>
<p>Configuration
can easily be injected into</p>
<p>DefaultJaasAuthenticationProvider
as well.</p>
<bean id="jaasAuthProvider" class="org.springframework.security.authentication.jaas.DefaultJaasAuthenticationProvider"> <property name="configuration"> <bean class="org.springframework.security.authentication.jaas.memory.InMemoryConfiguration"> <constructor-arg> <map> <!-- SPRINGSECURITY is the default loginContextName for AbstractJaasAuthenticationProvider --> <entry key="SPRINGSECURITY"> <array> <bean class="javax.security.auth.login.AppConfigurationEntry"> <constructor-arg value="sample.SampleLoginModule" /> <constructor-arg> <util:constant static-field= "javax.security.auth.login.AppConfigurationEntry$LoginModuleControlFlag.REQUIRED"/> </constructor-arg> <constructor-arg> <map></map> </constructor-arg> </bean> </array> </entry> </map> </constructor-arg> </bean> </property> <property name="authorityGranters"> <list> <!-- You will need to write your own implementation of AuthorityGranter --> <bean class="org.springframework.security.authentication.jaas.TestAuthorityGranter"/> </list> </property> </bean>
## <a href=""></a>21.4 JaasAuthenticationProvider

The

JaasAuthenticationProvider
assumes the default

Configuration
is an instance of <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/spec/com/sun/security/auth/login/ConfigFile.html" target="_blank">ConfigFile</a>. This assumption is made in order to attempt to update the

Configuration
. The

JaasAuthenticationProvider
then uses the default

Configuration
to create the

LoginContext
.

Let’s assume we have a JAAS login configuration file,

/WEB-INF/login.conf
, with the following contents:
JAASTest { sample.SampleLoginModule required; };

Like all Spring Security beans, the

JaasAuthenticationProvider
is configured via the application context. The following definitions would correspond to the above JAAS login configuration file:

<bean id="jaasAuthenticationProvider" class="org.springframework.security.authentication.jaas.JaasAuthenticationProvider"> <property name="loginConfig" value="/WEB-INF/login.conf"/> <property name="loginContextName" value="JAASTest"/> <property name="callbackHandlers"> <list> <bean class="org.springframework.security.authentication.jaas.JaasNameCallbackHandler"/> <bean class="org.springframework.security.authentication.jaas.JaasPasswordCallbackHandler"/> </list> </property> <property name="authorityGranters"> <list> <bean class="org.springframework.security.authentication.jaas.TestAuthorityGranter"/> </list> </property> </bean>

<h2 id="-21-5-running-as-a-subject"><a href=""></a>21.5 Running as a Subject</h2>
<p>If configured, the</p>
<p>JaasApiIntegrationFilter
will attempt to run as the</p>
<p>Subject
on the</p>
<p>JaasAuthenticationToken
. This means that the</p>
<p>Subject
can be accessed using:</p>
<p>Subject subject = Subject.getSubject(AccessController.getContext());</p>
<p>This integration can easily be configured using the <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/appendix-namespace.html#nsa-http-jaas-api-provision" title="jaas-api-provision" target="_blank">jaas-api-provision</a> attribute. This feature is useful when integrating with legacy or external API&#39;s that rely on the JAAS Subject being populated.
<a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/taglibs.html" target="_blank">Prev</a> <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/advanced-topics.html" target="_blank">Up</a> <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/cas.html" target="_blank">Next</a>20. JSP Tag Libraries <a href="http://static.springsource.org/spring-security/site/docs/3.1.x/reference/springsecurity.html" target="_blank">Home</a> 22. CAS Authentication    <img src="" alt=""></p>
<p><a href=""><img src="" alt=""></a></p>
<p><a href="http://www.springsource.com/?cid=70180000000wIe4AAE" target="_blank"><img src="" alt=""></a>
allSpringSourceGrailsHypericGemstoneRabbitMQ <img src="&quot;Search Documentation&quot;" alt=""></p>
<p><img src="&quot;click to toggle&quot;" alt="">
<a href="http://www.springsource.com/spring-framework-consulting" target="_blank"><img src="" alt=""></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/CAS/">CAS</a></li></span><span class="breadcrumb"><li><a href="/categories/CAS/">CAS</a></li><li><a href="/categories/CAS/spring-cas/">spring-cas</a></li></span></span> | <span class="tags">Tagged <a href="/tags/CAS/" class="label label-primary">CAS</a><a href="/tags/spring-cas/" class="label label-success">spring-cas</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:39"datetime="2014-03-07 09:54:39"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-CAS-spring-cas--21-JavaAuthenticationandAuthorizationService/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-CAS-spring-cas--21-JavaAuthenticationandAuthorizationService" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/85/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/83/">83</a></li><li><a class="page-number" href="/page/84/">84</a></li><li><a class="page-number" href="/page/85/">85</a></li><li class="active"><li><span class="page-number current">86</span></li><li><a class="page-number" href="/page/87/">87</a></li><li><a class="page-number" href="/page/88/">88</a></li><li><a class="page-number" href="/page/89/">89</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/87/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 18:24:57</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
