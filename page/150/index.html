
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 150 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-架构师--MemcacheDB-TokyoTyrant-Redisperformancetest–/">MemcacheDB</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:28.000Z"> <a href="/2014/02/02/2014-02-02-架构师--MemcacheDB-TokyoTyrant-Redisperformancetest–/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="memcachedb-tokyo-tyrant-redis-performance-test-tim-">MemcacheDB, Tokyo Tyrant, Redis performance test – Tim[后端技术]</h1>
<h1 id="-tim-http-timyang-net-home-"><a href="http://timyang.net/" title="Home" target="_blank">Tim[后端技术]</a></h1>
<p>Tim&#39;s blog, 关于后端架构、互联网技术、分布式、大型网络应用、NoSQL、技术感悟等</p>
<p><a href="http://timyang.net/" target="_blank">Home</a> | <a href="http://timyang.net/about/" target="_blank">About</a> | <a href="http://timyang.net/tag/English/" target="_blank">English version</a> | <a href="http://timyang.net/about/#comment" target="_blank">留言(Guestbook)</a> | <a href="http://timyang.net/feed/" target="_blank"><img src="" alt=""></a><a href="http://timyang.net/feed/" target="_blank">订阅RSS</a> <a href="http://fusion.google.com/add?source=atgs&amp;feedurl=http%3A//timyang.net/feed/" target="_blank"><img src="" alt="Add to Google"></a></p>
<ul>
<li></li>
<li><p>Email: <img src="" alt=""></p>
</li>
<li><h3 id="similar-posts">Similar Posts</h3>
</li>
<li><p><a href="http://timyang.net/programming/thrift-protocol-buffers-performance-2/" title="April 17, 2009" target="_blank">Thrift and Protocol Buffers performance in Java Round 2</a></p>
</li>
<li><a href="http://timyang.net/programming/thrift-protocol-buffers-performance-java/" title="April 2, 2009" target="_blank">Thrift and Protocol Buffers performance in Java</a></li>
<li><a href="http://timyang.net/programming/c-erlang-java-performance/" title="November 11, 2009" target="_blank">C, Erlang, Java and Go Web Server performance test</a></li>
<li><a href="http://timyang.net/architecture/friendfeed-like-aggregator/" title="April 3, 2009" target="_blank">Ideas for creating a friendfeed like feed aggregator system</a></li>
<li><p><a href="http://timyang.net/python/python-thread-socket-server/" title="March 8, 2009" target="_blank">Python thread socket server</a></p>
</li>
<li><h3 id="most-commented">Most Commented</h3>
</li>
<li><p><a href="http://timyang.net/data/mcdb-tt-redis/" title="MemcacheDB, Tokyo Tyrant, Redis performance test" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a> (101)</p>
</li>
<li><a href="http://timyang.net/programming/c-erlang-java-performance/" title="C, Erlang, Java and Go Web Server performance test" target="_blank">C, Erlang, Java and Go Web Server performance test</a> (85)</li>
<li><a href="http://timyang.net/about/" title="About Tim Yang" target="_blank">About Tim Yang</a> (83)</li>
<li><a href="http://timyang.net/data/redis-misunderstanding/" title="Redis几个认识误区" target="_blank">Redis几个认识误区</a> (62)</li>
<li><a href="http://timyang.net/programming/memcache-mutex/" title="Memcache mutex设计模式" target="_blank">Memcache mutex设计模式</a> (47)</li>
<li><a href="http://timyang.net/architecture/microblog-design-qcon-beijing/" title="构建可扩展的微博架构(qcon beijing 2010演讲)" target="_blank">构建可扩展的微博架构(qcon beijing 2010演讲)</a> (39)</li>
<li><a href="http://timyang.net/architecture/consistent-hashing-practice/" title="某分布式应用实践一致性哈希的一些问题" target="_blank">某分布式应用实践一致性哈希的一些问题</a> (38)</li>
<li><a href="http://timyang.net/google/open-source/" title="为什么优秀开发者进入Google后就不参与开源了" target="_blank">为什么优秀开发者进入Google后就不参与开源了</a> (33)</li>
<li><a href="http://timyang.net/misc/macbook-air-productive/" title="MacBook Air与工作效率" target="_blank">MacBook Air与工作效率</a> (32)</li>
<li><p><a href="http://timyang.net/data/memcached-lru-evictions/" title="Memcached数据被踢(evictions&gt;0)现象分析" target="_blank">Memcached数据被踢(evictions&gt;0)现象分析</a> (30)</p>
</li>
<li><h3 id="recent-posts">Recent Posts</h3>
</li>
<li><p><a href="http://timyang.net/tao/speech-practice/" title="演讲小组的第一次活动" target="_blank">演讲小组的第一次活动</a></p>
</li>
<li><a href="http://timyang.net/tao/connect-the-dots/" title="“connect the dots” 随想" target="_blank">“connect the dots” 随想</a></li>
<li><a href="http://timyang.net/tao/talents/" title="跨领域人才" target="_blank">跨领域人才</a></li>
<li><a href="http://timyang.net/product/discontinued-servic/" title="产品下线杂谈" target="_blank">产品下线杂谈</a></li>
<li><a href="http://timyang.net/misc/speech/" title="当我谈演讲时候，我谈些什么" target="_blank">当我谈演讲时候，我谈些什么</a></li>
<li><a href="http://timyang.net/architecture/k/" title="案例与故障的知识库" target="_blank">案例与故障的知识库</a></li>
<li><a href="http://timyang.net/management/learning-tao/" title="团队中的为师之道" target="_blank">团队中的为师之道</a></li>
<li><a href="http://timyang.net/google/hybrid-research/" title="有感Google的混合研究方法" target="_blank">有感Google的混合研究方法</a></li>
<li><a href="http://timyang.net/management/probation/" title="谈技术人员“转正”" target="_blank">谈技术人员“转正”</a></li>
<li><a href="http://timyang.net/architecture/notes-weixin/" title="微信架构的启示" target="_blank">微信架构的启示</a></li>
<li><a href="http://timyang.net/misc/macbook-air-productive/" title="MacBook Air与工作效率" target="_blank">MacBook Air与工作效率</a></li>
<li><a href="http://timyang.net/architecture/notes-timelines-twitter/" title="Notes about Timelines @ Twitter" target="_blank">Notes about Timelines @ Twitter</a></li>
<li><a href="http://timyang.net/management/engineer-performance/" title="技术工程师的能力与目标" target="_blank">技术工程师的能力与目标</a></li>
<li><a href="http://timyang.net/management/design-review/" title="技术方案评审" target="_blank">技术方案评审</a></li>
<li><p><a href="http://timyang.net/management/planning/" title="谈技术团队目标" target="_blank">谈技术团队目标</a></p>
</li>
<li><h3 id="recent-comments">Recent Comments</h3>
</li>
<li><p><a href="http://emake.info/the-redis-several-misunderstandings.html" target="_blank">Redis几个认识误区 | 创造</a> on <a href="http://timyang.net/data/redis-misunderstanding/comment-page-2/#comment-224409" target="_blank">Redis几个认识误区</a></p>
</li>
<li><a href="http://emake.info/the-redis-several-misunderstandings.html" target="_blank">Redis几个认识误区 | 创造</a> on <a href="http://timyang.net/data/mcdb-tt-redis/comment-page-3/#comment-224408" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a></li>
<li><a href="http://outofmemory.cn/" target="_blank">甄码农</a> on <a href="http://timyang.net/management/learning-tao/comment-page-1/#comment-224161" target="_blank">团队中的为师之道</a></li>
<li><a href="http://outofmemory.cn/" target="_blank">甄码农</a> on <a href="http://timyang.net/tao/talents/comment-page-1/#comment-224158" target="_blank">跨领域人才</a></li>
<li><p>阿秀 on <a href="http://timyang.net/about/comment-page-2/#comment-223584" target="_blank">About Tim Yang</a></p>
</li>
<li><h3 id="categories">Categories</h3>
</li>
<li><p><a href="http://timyang.net/category/data/" title="View all posts filed under data" target="_blank">data</a></p>
</li>
<li><a href="http://timyang.net/category/erlang/" title="Erlang语言" target="_blank">Erlang</a></li>
<li><a href="http://timyang.net/category/google/" title="View all posts filed under Google" target="_blank">Google</a></li>
<li><a href="http://timyang.net/category/java/" title="View all posts filed under Java" target="_blank">Java</a></li>
<li><a href="http://timyang.net/category/linux/" title="View all posts filed under Linux" target="_blank">Linux</a></li>
<li><a href="http://timyang.net/category/lua/" title="View all posts filed under Lua" target="_blank">Lua</a></li>
<li><a href="http://timyang.net/category/python/" title="View all posts filed under Python" target="_blank">Python</a></li>
<li><a href="http://timyang.net/category/sns/" title="View all posts filed under SNS" target="_blank">SNS</a></li>
<li><a href="http://timyang.net/category/tech/" title="View all posts filed under tech" target="_blank">tech</a></li>
<li><a href="http://timyang.net/category/web/" title="View all posts filed under Web" target="_blank">Web</a></li>
<li><a href="http://timyang.net/category/product/" title="View all posts filed under 产品" target="_blank">产品</a></li>
<li><a href="http://timyang.net/category/distributed/" title="分布式算法及思想" target="_blank">分布式</a></li>
<li><a href="http://timyang.net/category/management/" title="View all posts filed under 技术管理" target="_blank">技术管理</a></li>
<li><a href="http://timyang.net/category/architecture/" title="后端架构" target="_blank">架构</a></li>
<li><a href="http://timyang.net/category/programming/" title="View all posts filed under 编程" target="_blank">编程</a></li>
<li><a href="http://timyang.net/category/tao/" title="View all posts filed under 随想" target="_blank">随想</a></li>
<li><p><a href="http://timyang.net/category/misc/" title="非技术话题" target="_blank">非技术</a></p>
</li>
<li><h3 id="archives">Archives</h3>
</li>
<li><p><a href="http://timyang.net/2012/10/" title="October 2012" target="_blank">October 2012</a> (5)</p>
</li>
<li><a href="http://timyang.net/2012/09/" title="September 2012" target="_blank">September 2012</a> (4)</li>
<li><a href="http://timyang.net/2012/05/" title="May 2012" target="_blank">May 2012</a> (3)</li>
<li><a href="http://timyang.net/2012/02/" title="February 2012" target="_blank">February 2012</a> (3)</li>
<li><a href="http://timyang.net/2012/01/" title="January 2012" target="_blank">January 2012</a> (2)</li>
<li><a href="http://timyang.net/2011/12/" title="December 2011" target="_blank">December 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/08/" title="August 2011" target="_blank">August 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/07/" title="July 2011" target="_blank">July 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/04/" title="April 2011" target="_blank">April 2011</a> (2)</li>
<li><a href="http://timyang.net/2011/02/" title="February 2011" target="_blank">February 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/01/" title="January 2011" target="_blank">January 2011</a> (2)</li>
<li><a href="http://timyang.net/2010/12/" title="December 2010" target="_blank">December 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/11/" title="November 2010" target="_blank">November 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/09/" title="September 2010" target="_blank">September 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/08/" title="August 2010" target="_blank">August 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/07/" title="July 2010" target="_blank">July 2010</a> (3)</li>
<li><a href="http://timyang.net/2010/06/" title="June 2010" target="_blank">June 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/05/" title="May 2010" target="_blank">May 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/04/" title="April 2010" target="_blank">April 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/03/" title="March 2010" target="_blank">March 2010</a> (4)</li>
<li><a href="http://timyang.net/2010/02/" title="February 2010" target="_blank">February 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/01/" title="January 2010" target="_blank">January 2010</a> (1)</li>
<li><a href="http://timyang.net/2009/12/" title="December 2009" target="_blank">December 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/11/" title="November 2009" target="_blank">November 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/10/" title="October 2009" target="_blank">October 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/09/" title="September 2009" target="_blank">September 2009</a> (4)</li>
<li><a href="http://timyang.net/2009/08/" title="August 2009" target="_blank">August 2009</a> (5)</li>
<li><a href="http://timyang.net/2009/07/" title="July 2009" target="_blank">July 2009</a> (6)</li>
<li><a href="http://timyang.net/2009/06/" title="June 2009" target="_blank">June 2009</a> (5)</li>
<li><a href="http://timyang.net/2009/05/" title="May 2009" target="_blank">May 2009</a> (11)</li>
<li><a href="http://timyang.net/2009/04/" title="April 2009" target="_blank">April 2009</a> (7)</li>
<li><a href="http://timyang.net/2009/03/" title="March 2009" target="_blank">March 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/02/" title="February 2009" target="_blank">February 2009</a> (2)</li>
<li><a href="http://timyang.net/2009/01/" title="January 2009" target="_blank">January 2009</a> (2)</li>
<li><a href="http://timyang.net/2008/12/" title="December 2008" target="_blank">December 2008</a> (2)</li>
<li><h3 id="feeds">Feeds</h3>
</li>
<li><p><a href="http://timyang.net/feed/" target="_blank">Entries (RSS)</a></p>
</li>
<li><a href="http://timyang.net/comments/feed/" target="_blank">Comments (RSS)</a>
*</li>
</ul>
<h2 id="-memcachedb-tokyo-tyrant-redis-performance-test-http-timyang-net-data-mcdb-tt-redis-permanent-link-to-memcachedb-tokyo-tyrant-redis-performance-test-"><a href="http://timyang.net/data/mcdb-tt-redis/" title="Permanent Link to MemcacheDB, Tokyo Tyrant, Redis performance test" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a></h2>
<p>Tuesday, Aug 11th, 2009 by Tim | Tags: <a href="http://timyang.net/tag/english/" target="_blank">English</a>, <a href="http://timyang.net/tag/memcachedb/" target="_blank">memcachedb</a>, <a href="http://timyang.net/tag/redis/" target="_blank">redis</a>, <a href="http://timyang.net/tag/tokyo-cabinet/" target="_blank">tokyo cabinet</a>, <a href="http://timyang.net/tag/tokyo-tyrant/" target="_blank">tokyo tyrant</a></p>
<p>I had tested the following key-value store for set() and get()</p>
<ul>
<li><a href="http://memcachedb.org/" target="_blank">MemcacheDB</a>, use memcached client protocol.</li>
<li><a href="http://tokyocabinet.sourceforge.net/tyrantdoc/" target="_blank">Tokyo Tyrant</a> (<a href="http://tokyocabinet.sourceforge.net/" target="_blank">Tokyo Cabinet</a>), use memcached client protocol</li>
<li><a href="http://code.google.com/p/redis/" target="_blank">Redis</a>, use <a href="http://code.google.com/p/jredis/" target="_blank">JRedis</a> Java client</li>
</ul>
<h2 id="1-test-environment">1. Test environment</h2>
<h3 id="1-1-hardware-os">1.1 Hardware/OS</h3>
<p>2 Linux boxes in a LAN, 1 server and 1 test client
Linux Centos 5.2 64bit
Intel(R) Xeon(R) CPU E5410  @ 2.33GHz (L2 cache: 6M), Quad-Core /* 2
8G memory
SCSI disk (standalone disk, no other access)</p>
<h3 id="1-2-software-version">1.2 Software version</h3>
<p>db-4.7.25.tar.gz
libevent-1.4.11-stable.tar.gz
memcached-1.2.8.tar.gz
memcachedb-1.2.1-beta.tar.gz
redis-0.900_2.tar.gz
tokyocabinet-1.4.9.tar.gz
tokyotyrant-1.1.9.tar.gz</p>
<h3 id="1-3-configuration">1.3 Configuration</h3>
<p><strong>Memcachedb startup parameter</strong>
Test 100 bytes
./memcachedb -H /data5/kvtest/bdb/data -d -p 11212 -m 2048 <strong>-N -L 8192</strong>
(Update: As mentioned by <a href="http://stvchu.org/" target="_blank">Steve</a>, the 100-byte-test missed the -N paramter, so I added it and updated the data)
Test 20k bytes
./memcachedb -H /data5/kvtest/mcdb/data -d -p 11212 -b 21000 -N -m 2048</p>
<p><strong>Tokyo Tyrant (Tokyo Cabinet) configuration</strong>
Use default Tokyo Tyrant sbin/ttservctl
use .tch database, hashtable database</p>
<p>ulimsiz=”256m”
sid=1
dbname=”$basedir/casket.tch/#bnum=50000000″ /# default 1M is not enough!
maxcon=”65536″
retval=0</p>
<p><strong>Redis configuration</strong>
timeout 300
save 900 1
save 300 10
save 60 10000
/# no maxmemory settings</p>
<h3 id="1-4-test-client">1.4 Test client</h3>
<p>Client in Java, JDK1.6.0, 16 threads
Use Memcached client java_memcached-release_2.0.1.jar
<a href="http://code.google.com/p/jredis/" target="_blank">JRedis</a> client for Redis test, another <a href="http://code.google.com/p/jdbc-redis/" target="_blank">JDBC-Redis</a> has poor performance.</p>
<h2 id="2-small-data-size-test-result">2. Small data size test result</h2>
<p>Test 1, 1-5,000,000 as key, 100 bytes string value, do set, then get test, all get test has result.
Request per second(mean)<img src="&quot;key-value-performance-1(Update" alt="key-value-performance-1(Update)">&quot;)
<strong>Store</strong> <strong>Write</strong> <strong>Read</strong> Memcached 55,989 50,974 Memcachedb 25,583 35,260 Tokyo Tyrant 42,988 46,238 Redis 85,765 71,708</p>
<p><strong>Server Load Average</strong></p>
<p><strong>Store</strong> <strong>Write</strong> <strong>Read</strong> Memcached 1.80, 1.53, 0.87 1.17, 1.16, 0.83 MemcacheDB 1.44, 0.93, 0.64 4.35, 1.94, 1.05 Tokyo Tyrant 3.70, 1.71, 1.14 2.98, 1.81, 1.26 Redis 1.06, 0.32, 0.18 1.56, 1.00, 0.54</p>
<h2 id="3-larger-data-size-test-result">3. Larger data size test result</h2>
<p>Test 2, 1-500,000 as key, 20k bytes string value, do set, then get test, all get test has result.
Request per second(mean)
<strong>(Aug 13 Update: fixed a bug on get() that read non-exist key)</strong>
<img src="&quot;key-value-performance-2(update" alt="key-value-performance-2(update)">&quot;)
<strong>Store</strong> <strong>Write</strong> <strong>Read</strong> Memcachedb 357 327 Tokyo Tyrant 3,501 257 Redis 1,542 957</p>
<h2 id="4-some-notes-about-the-test">4. Some notes about the test</h2>
<p>When test Redis server, the memory goes up steadily, consumed all 8G and then use swap(and write speed slow down), after all memory and swap space is used, the client will get exceptions. So use Redis in a productive environment should limit to a small data size. It is another cache solution rather than a persistent storage. <strong>So compare Redis together with MemcacheDB/TC may not fair because Redis actually does not save data to disk during the test</strong>.</p>
<p>Tokyo cabinet and memcachedb are very stable during heavy load, use very little memory in set test and less than physical memory in get test.</p>
<p>MemcacheDB peformance is poor for write large data size(20k).</p>
<p>The call response time was not monitored in this test.</p>
<h3 id="101-comments-http-timyang-net-data-mcdb-tt-redis-postcomment-jump-to-the-comments-form-">101 Comments <a href="http://timyang.net/data/mcdb-tt-redis/#postcomment" title="Jump to the comments form" target="_blank">»</a></h3>
<ol>
<li><img src="" alt=""><a href="http://leechael.org/" target="_blank">Leechael</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1102" target="_blank">Aug 12th 2009 at 04:47</a></p>
<p>这次的测试结果显然更新了，虽然还是不敌，不过这次 TT/TC write 的性能显然提高了。 <img src="" alt=":D"></p>
<ol>
<li><img src="" alt=""><a href="http://anyall.org/" target="_blank">Brendan O&#39;Connor</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1107" target="_blank">Aug 12th 2009 at 11:32</a></p>
<p>very interesting, thanks!</p>
<ol>
<li><img src="" alt=""><a href="http://shellshadow.com/" target="_blank">Jon Hancock</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1115" target="_blank">Aug 13th 2009 at 00:46</a></p>
<p>good info. One thing missing in these types of comparisons is a baseline against an RDB. Adding postgres 8.4 to this comparison might help.</p>
<ol>
<li><img src="" alt=""><a href="http://hypertable.org/" target="_blank">vicaya</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1117" target="_blank">Aug 13th 2009 at 03:28</a></p>
<p>You should really test memcached 1.4.0, which actually can use multi-cores.</p>
<ol>
<li><img src="" alt=""><a href="http://www.dapper.net/" target="_blank">Asaf</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1119" target="_blank">Aug 13th 2009 at 03:51</a></p>
<p>Thanks for the info,
Can you please detail the ratio of read / write operations and the order of the operations?</p>
<p>did you first write all the data than read all the data or was it intermittent?</p>
<ol>
<li><img src="" alt="">Tim says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1132" target="_blank">Aug 13th 2009 at 14:39</a></p>
<p>@asaf
I do read test after finish all writes.</p>
<p>Write test:
key: 1-5,000,000
value: 100-byte-string</p>
<p>After write all, then do read test
client.get(random(5,000,000));</p>
<ol>
<li><img src="" alt=""><a href="http://www.zhuzhaoyuan.com/" target="_blank">Joshua Zhu</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1137" target="_blank">Aug 13th 2009 at 16:51</a></p>
<p>This benchmark is very helpful to me in evaluating those K/V stores. Thanks a lot.</p>
<ol>
<li><img src="" alt=""><a href="http://duguo.com/" target="_blank">Guo Du</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1138" target="_blank">Aug 13th 2009 at 19:31</a></p>
<p>Very interesting result. Any significant cpu usage difference between those stores?</p>
<ol>
<li><img src="" alt="">Joubin says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1148" target="_blank">Aug 14th 2009 at 10:08</a></p>
<p>Hi Tim,</p>
<p>Thanks for the test! Just curious:</p>
<p>1)
Try changing the tcp buffer sizes in class org.jredis.ri.alphazero.connection.ConnectionBase$DefaultConnectionBase. On my mac, the default values are always fairly quite large so perhaps this is something that was missed:</p>
<p>change the tcp rcv and snd buffer size values:</p>
<p>public static final class DefaultConnectionSpec implements ConnectionSpec {</p>
<p>…</p>
<p>//<em>/</em> /<em>/
private static final int DEFAULT_RCV_BUFF_SIZE = 1024 /</em> 48; // &lt;&lt; increased
//<em>/</em> /<em>/
private static final int DEFAULT_SND_BUFF_SIZE = 1024 /</em> 48; // &lt;&lt; increased</p>
<p>…</p>
<p>2) May also try changing the tcp socket prefs (same inner class):</p>
<p>Try this:</p>
<p>public static final class DefaultConnectionSpec implements ConnectionSpec {
…</p>
<p>@Override
public Integer getSocketProperty(SocketProperty property) {
int value = 0;
switch (property){
case SO_PREF_BANDWIDTH:
value = 0; // changed
break;
case SO_PREF_CONN_TIME:
value = 2;
break;
case SO_PREF_LATENCY:
value = 1; // changed
break;
case SO_RCVBUF:
value = DEFAULT_RCV_BUFF_SIZE;
break;
case SO_SNDBUF:
value = DEFAULT_SND_BUFF_SIZE;
break;
case SO_TIMEOUT:
value = DEFAULT_READ_TIMEOUT_MSEC;
break;
}
return value;
}
…
}</p>
<p>I assume you’ve downloaded the full distribution from github. “mvn install” to build and run the test again. Curious to see if it makes any diffs. That fails we’ll try switching to buffered io streams.</p>
<p>/R</p>
<ol>
<li><img src="" alt="">Gabriel says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1157" target="_blank">Aug 15th 2009 at 02:30</a></p>
<p>Can you post the actual model/# for the Xeon CPU along with operating frequency?</p>
<ol>
<li><img src="" alt="">Tim says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1192" target="_blank">Aug 17th 2009 at 16:45</a></p>
<p>@Joubin
I’ve changed DEFAULT_RCV_BUFF_SIZE/DEFAULT_SND_BUFF_SIZE from 48k to 256k, both for small data size and larger data size, but there is not significant improvement. The bottleneck here may not on the client side.</p>
<p>@Gabriel added.</p>
<ol>
<li><img src="" alt="">mongofan says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1219" target="_blank">Aug 19th 2009 at 07:47</a></p>
<p>hi Tim
very nice!</p>
<p>can you add mongodb to the benchmark? I would love to see how it performs against redis</p>
<ol>
<li><img src="" alt="">Joubin says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1283" target="_blank">Aug 23rd 2009 at 22:04</a></p>
<p>Tim,</p>
<p>Thanks. That confirms my owns tests that stressed on just one key to isolate the client overhead.</p>
<p>A cursory look at the TT’s Java client seems to indicate that payloads are gzip’d (which JRedis does not, given that the baseline assumption is that you may be using a variety of clients for your db, in which case client specific optimizations are not viable unless the compression algorithm is shared by all client types.)</p>
<p>I’ll update when I have something to add here, but safe assumption here is that compressing the 20K payload has a significant positive impact on the performance of the TT setup.</p>
<ol>
<li><img src="" alt=""><a href="http://www.caojianghua.com/" target="_blank">arden</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1468" target="_blank">Sep 3rd 2009 at 11:44</a></p>
<p>redis有没有象memcached这样的过期时间设置？</p>
<ol>
<li><img src="" alt="">Jonathan says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1583" target="_blank">Sep 11th 2009 at 04:37</a></p>
<p>I assume this tests write once?</p>
<p>You may see something interesting from Tokyo Tyrant if you test modification in random order. Write performance should drop to match read performance.</p>
<ol>
<li><img src="" alt=""><a href="http://www.exozet.com/" target="_blank">Henry</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-1847" target="_blank">Oct 3rd 2009 at 06:10</a></p>
<p>Thanks for the Test, we will test Redis in one of the next Projects</p>
<ol>
<li><img src="" alt=""><a href="http://oracle.com/" target="_blank">Gregory Burd</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-2189" target="_blank">Nov 19th 2009 at 03:12</a></p>
<p>To match Redis’s durability (“D” in ACID) using Berkeley DB simply set the DB_TXN flags to DB_TXN_NOSYNC. A transaction will be consider “durable” when the data is flushed from the log-buffers in-memory to the operating system’s filesystem buffers rather than waiting for the disk to actually write the data (which is much slower). There are many other configuration parameters that can be tuned, you don’t list them in your description so I can’t say if they were optimal or not (really, “auto-tuning” a database is something that BDB should do for you, but we’re not there yet). If these tests run entirely in cache (can load the entire dataset into memory) then this isn’t a realistic scenario, increase the dataset until the data is 10x the cache size. Also, as someone mentioned you may want to test under a highly concurrent, and highly contentious workload as that will push the locking systems and create very different results. Finally, update to Berkeley DB 4.8. In 4.8 we’ve dramatically improved our locking subsystem for modern multi-core CPU architectures.</p>
<p>Benchmarks are always tricky. <img src="" alt=":-)"> Apples-to-apples tests are rare because they are hard to design and harder to run. There is almost always some degree of bias or some overlooked element. It’s unavoidable. That said, benchmarks do serve a purpose so thank you for doing the tests. We hope that you do more. We’re always looking for ways to improve performance.</p>
<p>-greg</p>
<p>Berkeley DB Product Manager, Oracle Corp</p>
<ol>
<li><img src="" alt="">Tim says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-2191" target="_blank">Nov 20th 2009 at 11:16</a></p>
<p>Greg, already enable DB_TXN_NOSYNC by add -N to memcachedb in this test.
Will evaluated bdb 4.8</p>
<ol>
<li><img src="" alt="">Tim says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-2201" target="_blank">Nov 25th 2009 at 09:47</a></p>
<p>Greg, tested bdb 4.8, there is significant improvent. Great!
but after I compare with TC(tokyocabinet-1.4.39.tar.gz) and TT(tokyotyrant-1.1.37.tar.gz) new version, they also had improvement, so the result doesn’t changed much.</p>
<p>FYI, I’ve tested read/write 100 byte with 50 threads, the request per second result are,
Tokyo Tyrant(Tokyo Cabinet) Write 54,189, Read 73,384
Memcachedb(Berkekey DB 4.8) Write 32,985 Read 59,178
Memcached Write 103,242, Read 106,102</p>
<p>Because the new test donen’t change the situation, the test in blog post still make sense.</p>
<ol>
<li><img src="" alt="">eric says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-2517" target="_blank">Jan 6th 2010 at 13:45</a></p>
<p>感觉还是不错。</p>
<ol>
<li><img src="" alt=""><a href="http://focusheart.cn/" target="_blank">focusheart</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-3268" target="_blank">Feb 26th 2010 at 10:25</a></p>
<p>Redis应用在一个多层的存储结构中用来处理经常发生变化的数据部分很合适，存储结构的层次不同，适用不同的解决方案。</p>
<ol>
<li><img src="" alt="">faryang says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-4388" target="_blank">Jul 2nd 2010 at 00:15</a></p>
<p>对我来说，REDIS是亮点，相见恨晚啊：）</p>
<ol>
<li><img src="" alt="">jtong11 says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-16562" target="_blank">Mar 17th 2011 at 16:36</a></p>
<p>事实上，对于500万的小数据量而言，所有写入数据都有可能被文件系统buffer住，这时再进行查询操作，显然都是直接命中。所以真正有效的测试应该是写入超过内存2倍以上的数据，然后查询最先写入的那些数据。</p>
<ol>
<li><img src="" alt="">Louis says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-147890" target="_blank">Mar 23rd 2012 at 17:20</a></p>
<p>I am a newer for Redis.Can I just ask a primary question?How did you get the value of Request per second?</p>
<ol>
<li><img src="" alt="">hunter says:</li>
</ol>
<p><a href="http://timyang.net/data/mcdb-tt-redis/comment-page-1/#comment-212945" target="_blank">Oct 11th 2012 at 20:42</a></p>
<p>我们测试data &gt; 100k时，性能会急剧下降(100次/s)，不知道是不是我们的测试配置有问题，你能否帮忙测试一下？</p>
<p><a href="http://timyang.net/data/mcdb-tt-redis/feed/" target="_blank">RSS feed for comments on this post</a>, <a href="http://timyang.net/data/mcdb-tt-redis/trackback/" target="_blank">TrackBack URI</a>
<a href="http://timyang.net/data/mcdb-tt-redis/#respond" target="_blank">Cancel Reply</a></p>
<h3 id="leave-a-comment">Leave a Comment</h3>
<p>Name (required)</p>
<p>E-mail (required, never displayed)</p>
<p>URI</p>
<p>Except where otherwise noted, content on this site is licensed under a <a href="http://creativecommons.org/licenses/by/3.0/" target="_blank">Creative Commons Attribution 3.0</a> License</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/架构师/">架构师</a></li></span></span> | <span class="tags">Tagged <a href="/tags/架构师/" class="label label-primary">架构师</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:28"datetime="2014-03-07 09:54:28"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-架构师--MemcacheDB-TokyoTyrant-Redisperformancetest–/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-架构师--MemcacheDB-TokyoTyrant-Redisperformancetest–" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-架构师--Redis容量及使用规划–Tim后端技术/">Redis容量及使用规划 – Tim[后端技术]</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:28.000Z"> <a href="/2014/02/02/2014-02-02-架构师--Redis容量及使用规划–Tim后端技术/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="redis-tim-">Redis容量及使用规划 – Tim[后端技术]</h1>
<h1 id="-tim-http-timyang-net-home-"><a href="http://timyang.net/" title="Home" target="_blank">Tim[后端技术]</a></h1>
<p>Tim&#39;s blog, 关于后端架构、互联网技术、分布式、大型网络应用、NoSQL、技术感悟等</p>
<p><a href="http://timyang.net/" target="_blank">Home</a> | <a href="http://timyang.net/about/" target="_blank">About</a> | <a href="http://timyang.net/tag/English/" target="_blank">English version</a> | <a href="http://timyang.net/about/#comment" target="_blank">留言(Guestbook)</a> | <a href="http://timyang.net/feed/" target="_blank"><img src="" alt=""></a><a href="http://timyang.net/feed/" target="_blank">订阅RSS</a> <a href="http://fusion.google.com/add?source=atgs&amp;feedurl=http%3A//timyang.net/feed/" target="_blank"><img src="" alt="Add to Google"></a></p>
<ul>
<li></li>
<li><p>Email: <img src="" alt=""></p>
</li>
<li><h3 id="similar-posts">Similar Posts</h3>
</li>
<li><p><a href="http://timyang.net/data/mcdb-tt-redis/" title="August 11, 2009" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a></p>
</li>
<li><a href="http://timyang.net/data/friendfeed-mysql-schema-less/" title="October 29, 2009" target="_blank">Friendfeed的MySQL key/value存储</a></li>
<li><a href="http://timyang.net/architecture/friendfeed-like-aggregator/" title="April 3, 2009" target="_blank">Ideas for creating a friendfeed like feed aggregator system</a></li>
<li><a href="http://timyang.net/architecture/notes-timelines-twitter/" title="May 3, 2012" target="_blank">Notes about Timelines @ Twitter</a></li>
<li><p><a href="http://timyang.net/data/twitter-cassandra/" title="July 12, 2010" target="_blank">Twitter停用Cassandra原因分析</a></p>
</li>
<li><h3 id="most-commented">Most Commented</h3>
</li>
<li><p><a href="http://timyang.net/data/mcdb-tt-redis/" title="MemcacheDB, Tokyo Tyrant, Redis performance test" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a> (101)</p>
</li>
<li><a href="http://timyang.net/programming/c-erlang-java-performance/" title="C, Erlang, Java and Go Web Server performance test" target="_blank">C, Erlang, Java and Go Web Server performance test</a> (85)</li>
<li><a href="http://timyang.net/about/" title="About Tim Yang" target="_blank">About Tim Yang</a> (83)</li>
<li><a href="http://timyang.net/data/redis-misunderstanding/" title="Redis几个认识误区" target="_blank">Redis几个认识误区</a> (62)</li>
<li><a href="http://timyang.net/programming/memcache-mutex/" title="Memcache mutex设计模式" target="_blank">Memcache mutex设计模式</a> (47)</li>
<li><a href="http://timyang.net/architecture/microblog-design-qcon-beijing/" title="构建可扩展的微博架构(qcon beijing 2010演讲)" target="_blank">构建可扩展的微博架构(qcon beijing 2010演讲)</a> (39)</li>
<li><a href="http://timyang.net/architecture/consistent-hashing-practice/" title="某分布式应用实践一致性哈希的一些问题" target="_blank">某分布式应用实践一致性哈希的一些问题</a> (38)</li>
<li><a href="http://timyang.net/google/open-source/" title="为什么优秀开发者进入Google后就不参与开源了" target="_blank">为什么优秀开发者进入Google后就不参与开源了</a> (33)</li>
<li><a href="http://timyang.net/misc/macbook-air-productive/" title="MacBook Air与工作效率" target="_blank">MacBook Air与工作效率</a> (32)</li>
<li><p><a href="http://timyang.net/data/memcached-lru-evictions/" title="Memcached数据被踢(evictions&gt;0)现象分析" target="_blank">Memcached数据被踢(evictions&gt;0)现象分析</a> (30)</p>
</li>
<li><h3 id="recent-posts">Recent Posts</h3>
</li>
<li><p><a href="http://timyang.net/tao/speech-practice/" title="演讲小组的第一次活动" target="_blank">演讲小组的第一次活动</a></p>
</li>
<li><a href="http://timyang.net/tao/connect-the-dots/" title="“connect the dots” 随想" target="_blank">“connect the dots” 随想</a></li>
<li><a href="http://timyang.net/tao/talents/" title="跨领域人才" target="_blank">跨领域人才</a></li>
<li><a href="http://timyang.net/product/discontinued-servic/" title="产品下线杂谈" target="_blank">产品下线杂谈</a></li>
<li><a href="http://timyang.net/misc/speech/" title="当我谈演讲时候，我谈些什么" target="_blank">当我谈演讲时候，我谈些什么</a></li>
<li><a href="http://timyang.net/architecture/k/" title="案例与故障的知识库" target="_blank">案例与故障的知识库</a></li>
<li><a href="http://timyang.net/management/learning-tao/" title="团队中的为师之道" target="_blank">团队中的为师之道</a></li>
<li><a href="http://timyang.net/google/hybrid-research/" title="有感Google的混合研究方法" target="_blank">有感Google的混合研究方法</a></li>
<li><a href="http://timyang.net/management/probation/" title="谈技术人员“转正”" target="_blank">谈技术人员“转正”</a></li>
<li><a href="http://timyang.net/architecture/notes-weixin/" title="微信架构的启示" target="_blank">微信架构的启示</a></li>
<li><a href="http://timyang.net/misc/macbook-air-productive/" title="MacBook Air与工作效率" target="_blank">MacBook Air与工作效率</a></li>
<li><a href="http://timyang.net/architecture/notes-timelines-twitter/" title="Notes about Timelines @ Twitter" target="_blank">Notes about Timelines @ Twitter</a></li>
<li><a href="http://timyang.net/management/engineer-performance/" title="技术工程师的能力与目标" target="_blank">技术工程师的能力与目标</a></li>
<li><a href="http://timyang.net/management/design-review/" title="技术方案评审" target="_blank">技术方案评审</a></li>
<li><p><a href="http://timyang.net/management/planning/" title="谈技术团队目标" target="_blank">谈技术团队目标</a></p>
</li>
<li><h3 id="recent-comments">Recent Comments</h3>
</li>
<li><p><a href="http://emake.info/the-redis-several-misunderstandings.html" target="_blank">Redis几个认识误区 | 创造</a> on <a href="http://timyang.net/data/redis-misunderstanding/comment-page-2/#comment-224409" target="_blank">Redis几个认识误区</a></p>
</li>
<li><a href="http://emake.info/the-redis-several-misunderstandings.html" target="_blank">Redis几个认识误区 | 创造</a> on <a href="http://timyang.net/data/mcdb-tt-redis/comment-page-3/#comment-224408" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a></li>
<li><a href="http://outofmemory.cn/" target="_blank">甄码农</a> on <a href="http://timyang.net/management/learning-tao/comment-page-1/#comment-224161" target="_blank">团队中的为师之道</a></li>
<li><a href="http://outofmemory.cn/" target="_blank">甄码农</a> on <a href="http://timyang.net/tao/talents/comment-page-1/#comment-224158" target="_blank">跨领域人才</a></li>
<li><p>阿秀 on <a href="http://timyang.net/about/comment-page-2/#comment-223584" target="_blank">About Tim Yang</a></p>
</li>
<li><h3 id="categories">Categories</h3>
</li>
<li><p><a href="http://timyang.net/category/data/" title="View all posts filed under data" target="_blank">data</a></p>
</li>
<li><a href="http://timyang.net/category/erlang/" title="Erlang语言" target="_blank">Erlang</a></li>
<li><a href="http://timyang.net/category/google/" title="View all posts filed under Google" target="_blank">Google</a></li>
<li><a href="http://timyang.net/category/java/" title="View all posts filed under Java" target="_blank">Java</a></li>
<li><a href="http://timyang.net/category/linux/" title="View all posts filed under Linux" target="_blank">Linux</a></li>
<li><a href="http://timyang.net/category/lua/" title="View all posts filed under Lua" target="_blank">Lua</a></li>
<li><a href="http://timyang.net/category/python/" title="View all posts filed under Python" target="_blank">Python</a></li>
<li><a href="http://timyang.net/category/sns/" title="View all posts filed under SNS" target="_blank">SNS</a></li>
<li><a href="http://timyang.net/category/tech/" title="View all posts filed under tech" target="_blank">tech</a></li>
<li><a href="http://timyang.net/category/web/" title="View all posts filed under Web" target="_blank">Web</a></li>
<li><a href="http://timyang.net/category/product/" title="View all posts filed under 产品" target="_blank">产品</a></li>
<li><a href="http://timyang.net/category/distributed/" title="分布式算法及思想" target="_blank">分布式</a></li>
<li><a href="http://timyang.net/category/management/" title="View all posts filed under 技术管理" target="_blank">技术管理</a></li>
<li><a href="http://timyang.net/category/architecture/" title="后端架构" target="_blank">架构</a></li>
<li><a href="http://timyang.net/category/programming/" title="View all posts filed under 编程" target="_blank">编程</a></li>
<li><a href="http://timyang.net/category/tao/" title="View all posts filed under 随想" target="_blank">随想</a></li>
<li><p><a href="http://timyang.net/category/misc/" title="非技术话题" target="_blank">非技术</a></p>
</li>
<li><h3 id="archives">Archives</h3>
</li>
<li><p><a href="http://timyang.net/2012/10/" title="October 2012" target="_blank">October 2012</a> (5)</p>
</li>
<li><a href="http://timyang.net/2012/09/" title="September 2012" target="_blank">September 2012</a> (4)</li>
<li><a href="http://timyang.net/2012/05/" title="May 2012" target="_blank">May 2012</a> (3)</li>
<li><a href="http://timyang.net/2012/02/" title="February 2012" target="_blank">February 2012</a> (3)</li>
<li><a href="http://timyang.net/2012/01/" title="January 2012" target="_blank">January 2012</a> (2)</li>
<li><a href="http://timyang.net/2011/12/" title="December 2011" target="_blank">December 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/08/" title="August 2011" target="_blank">August 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/07/" title="July 2011" target="_blank">July 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/04/" title="April 2011" target="_blank">April 2011</a> (2)</li>
<li><a href="http://timyang.net/2011/02/" title="February 2011" target="_blank">February 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/01/" title="January 2011" target="_blank">January 2011</a> (2)</li>
<li><a href="http://timyang.net/2010/12/" title="December 2010" target="_blank">December 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/11/" title="November 2010" target="_blank">November 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/09/" title="September 2010" target="_blank">September 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/08/" title="August 2010" target="_blank">August 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/07/" title="July 2010" target="_blank">July 2010</a> (3)</li>
<li><a href="http://timyang.net/2010/06/" title="June 2010" target="_blank">June 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/05/" title="May 2010" target="_blank">May 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/04/" title="April 2010" target="_blank">April 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/03/" title="March 2010" target="_blank">March 2010</a> (4)</li>
<li><a href="http://timyang.net/2010/02/" title="February 2010" target="_blank">February 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/01/" title="January 2010" target="_blank">January 2010</a> (1)</li>
<li><a href="http://timyang.net/2009/12/" title="December 2009" target="_blank">December 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/11/" title="November 2009" target="_blank">November 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/10/" title="October 2009" target="_blank">October 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/09/" title="September 2009" target="_blank">September 2009</a> (4)</li>
<li><a href="http://timyang.net/2009/08/" title="August 2009" target="_blank">August 2009</a> (5)</li>
<li><a href="http://timyang.net/2009/07/" title="July 2009" target="_blank">July 2009</a> (6)</li>
<li><a href="http://timyang.net/2009/06/" title="June 2009" target="_blank">June 2009</a> (5)</li>
<li><a href="http://timyang.net/2009/05/" title="May 2009" target="_blank">May 2009</a> (11)</li>
<li><a href="http://timyang.net/2009/04/" title="April 2009" target="_blank">April 2009</a> (7)</li>
<li><a href="http://timyang.net/2009/03/" title="March 2009" target="_blank">March 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/02/" title="February 2009" target="_blank">February 2009</a> (2)</li>
<li><a href="http://timyang.net/2009/01/" title="January 2009" target="_blank">January 2009</a> (2)</li>
<li><a href="http://timyang.net/2008/12/" title="December 2008" target="_blank">December 2008</a> (2)</li>
<li><h3 id="feeds">Feeds</h3>
</li>
<li><p><a href="http://timyang.net/feed/" target="_blank">Entries (RSS)</a></p>
</li>
<li><a href="http://timyang.net/comments/feed/" target="_blank">Comments (RSS)</a>
*</li>
</ul>
<h2 id="-redis-http-timyang-net-data-redis-capacity-permanent-link-to-redis-"><a href="http://timyang.net/data/redis-capacity/" title="Permanent Link to Redis容量及使用规划" target="_blank">Redis容量及使用规划</a></h2>
<p>Wednesday, Jan 5th, 2011 by Tim | Tags: <a href="http://timyang.net/tag/memcache/" target="_blank">memcache</a>, <a href="http://timyang.net/tag/memcached/" target="_blank">memcached</a>, <a href="http://timyang.net/tag/mysql/" target="_blank">mysql</a>, <a href="http://timyang.net/tag/redis/" target="_blank">redis</a></p>
<p>在使用Redis过程中，我们发现了不少Redis不同于Memcached，也不同于MySQL的特征。
(本文主要讨论Redis未启用VM支持情况)</p>
<h3 id="1-schema">1. Schema</h3>
<p>MySQL: 需事先设计
Memcached: 无需设计
Redis: 小型系统可以不用，但是如果要合理的规划及使用Redis，需要事先进行类似如下一些规划</p>
<ul>
<li>数据项: value保存的内容是什么，如用户资料</li>
<li>Redis数据类型: 如String, List</li>
<li>数据大小: 如100字节</li>
<li>记录数: 如100万条(决定是否需要拆分)</li>
<li>⋯⋯</li>
</ul>
<p>上面的规划就是一种schema，为什么Redis在大型项目需要事先设计schema？因为Redis服务器有容量限制，数据容量不能超出物理内存大小，同时考虑到业务数据的可扩充性，记录数会持续增多、单条记录的内容也都会增长，因此需要提前规划好容量，数据架构师就是通过schema来判断当前业务的Redis是否需要“分库分表”以满足可扩展需求。</p>
<h3 id="2-">2. 容量及带宽规划</h3>
<p><strong>容量规划</strong>
MySQL: &lt; 硬盘大小
Memcached: &lt; RAM
Redis: &lt; RAM</p>
<p><strong>带宽规划</strong>
由于Redis比MySQL快10倍以上，因此带宽也是需要事先规划，避免带宽跑满而出现瓶颈。</p>
<h3 id="3-qps-">3. 性能规划(QPS)</h3>
<p>当系统读写出现瓶颈，通常如何解决？
MySQL
写: 拆分到多服务器
读: (1) 拆分 (2) 写少也可以通过增加Slave来解决</p>
<p>Memcached
读写: 都通过hash拆分到更多节点。</p>
<p>Redis:
写：拆分
读: (1) 拆分 (2) 写少也可以通过增加Slave来解决</p>
<h3 id="4-">4. 可扩展性</h3>
<p>MySQL: 分库分表
Memcached: hash分布
Redis：也可以分库，也可以hash分布</p>
<h3 id="-">小结</h3>
<p>通过以上分析，Redis在很多方面同时具备MySQL及Memcached使用特征，在某些方面则更像MySQL。
由于Redis数据不能超过内存大小，一方面需要进行事先容量规划，保证容量足够；另外一方面设计上需要防止数据规模无限制增加，进而导致Redis不可扩展。
Redis需要象MySQL一样预先设计好拆分方案。</p>
<h3 id="-">小问题</h3>
<p>在MySQL中，通过预先建立多表或者库可以在业务增长时候将这些表或库一分为二部署到更多服务器上。
在Redis中，“分库分表”应当如何实现？有什么好的设计模式？</p>
<h3 id="16-comments-http-timyang-net-data-redis-capacity-postcomment-jump-to-the-comments-form-">16 Comments <a href="http://timyang.net/data/redis-capacity/#postcomment" title="Jump to the comments form" target="_blank">»</a></h3>
<ol>
<li><img src="" alt="">ciel says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-6878" target="_blank">Jan 5th 2011 at 03:41</a></p>
<p>因为自己的项目可能会用到redis, 有个小问题想问问blog主.
java+redis这样的组合有没有问题, jedis适合用到生产环境去了么?</p>
<ol>
<li><img src="" alt="">gyf19 says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-6884" target="_blank">Jan 5th 2011 at 09:27</a></p>
<p>目前看来 redis VM 还不靠谱。</p>
<ol>
<li><img src="" alt=""><a href="http://www.cnblogs.com/sunli" target="_blank">孙立</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-6885" target="_blank">Jan 5th 2011 at 09:31</a></p>
<p>由于redis使用内存，不方便事先建立，我觉得可以才行采用虚拟node的模式来实现拆分。</p>
<ol>
<li><img src="" alt=""><a href="http://twitter.com/empyreaner" target="_blank">empyreaner</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-6886" target="_blank">Jan 5th 2011 at 10:06</a></p>
<p>redis的发展非常快，现在的这些问题可能等到几个月后就都不是问题了。
redis最近几天又加了个diskstorage分支，正在测试完全使用硬盘存储全部数据，内存只作为缓存。VM也许将在未来的版本中废弃。（作者的效率太高了）
redis cluster也快要出来了，可以减少人工分库分hash的麻烦。</p>
<ol>
<li><img src="" alt=""><a href="http://mr.mayday.net.cn/" target="_blank">王道中强流</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-6887" target="_blank">Jan 5th 2011 at 10:10</a></p>
<p>我喜欢MongoDB多一点</p>
<ol>
<li><img src="" alt=""><a href="http://syre.blogbus.com/" target="_blank">神仙</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-6888" target="_blank">Jan 5th 2011 at 10:34</a></p>
<p>redis 2.0 已经可以只把部分数据放内存了，不知道效果怎样</p>
<ol>
<li><img src="" alt=""><a href="http://zoomquiet.org/" target="_blank">Zoom.Quiet</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-6891" target="_blank">Jan 5th 2011 at 11:17</a></p>
<p>嗯嗯嗯,我们在大规模使用 Redis时,没有深入,直接在超过1kw 时就放棄了,</p>
<ul>
<li>内存不足</li>
<li>速度成比例下降
直接使用自定义的内存结构体,速度提高30倍…
但凡是通用的 DB类服务,都内置了N多稳定性保证的机制,
整体上就无法满足极限状态中的响应…
只要业务稳定不变,及时替换成专用内存结构很靠谱;</li>
<li>但是,无法兼顾所有意外情况,内存泄漏问题将逐步爆发</li>
<li>慢慢追加各种保守措施后就发觉,其实又在实现另外一个 Redis 而已…</li>
</ul>
<ol>
<li><img src="" alt="">yuping322 says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-6892" target="_blank">Jan 5th 2011 at 13:24</a></p>
<p>在MySQL中，通过预先建立多表或者库可以在业务增长时候将这些表或库一分为二部署到更多服务器上。
在Redis中，“分库分表”应当如何实现？有什么好的设计模式？</p>
<p>个人看法.
redis+zookeeper。
维持一致性在zookeeper里。</p>
<ol>
<li><img src="" alt=""><a href="http://hi.baidu.com/stodbx2002/" target="_blank">tony</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-6914" target="_blank">Jan 6th 2011 at 11:27</a></p>
<p>redis 消耗内存很严重，用不起。</p>
<ol>
<li><img src="" alt="">KnightE says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-6916" target="_blank">Jan 6th 2011 at 17:50</a></p>
<p>用HASH把绝大部分GET/SET替换后，内存节约了很多。
性能上目前还没有遇到什么问题，目前有30多个节点在线上跑。
不过通过分片（节点）存储后，sort就无法很好的使用了，这是一个目前还需要从DB走的问题，不知道Tim有什么建议。</p>
<ol>
<li><img src="" alt=""><a href="http://redcreen.com/" target="_blank">redcreen</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-13137" target="_blank">Feb 27th 2011 at 17:07</a></p>
<p>@KnightE:
数据分片后无法通过规则将需要sort的数据分布到同一个节点上么?</p>
<ol>
<li><img src="" alt="">eyu says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-30502" target="_blank">May 26th 2011 at 10:50</a></p>
<p>把redis原型改造成了一个消息队列服务器，但是在释放大数据量的时候出现了速度严重下滑，替换成tcmalloc后恢复正常。另外貌似存在内存泄漏的问题。。。</p>
<ol>
<li><img src="" alt=""><a href="http://www.geelou.com/article/119.html" target="_blank">rjgcs123</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-30812" target="_blank">May 27th 2011 at 17:13</a></p>
<p>云集国内redis大佬的QQ群正在招募各路redis朋友，不管你是正在使用redis，还是在研究redis，或者是对redis感兴趣，你都可以加入到我们的阵营。大家一起讨论redis各类用法，key-value、list、set、map使用，redis优化、内存监控、主从配置等等问题，这里都会有高手给你解决。</p>
<p>注意啦，国内顶尖级别的redisQQ群是 43016055</p>
<ol>
<li><img src="" alt="">Sean says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-39764" target="_blank">Jun 30th 2011 at 00:24</a></p>
<p>请问现在有没有人考虑用MemBase,貌似也支持持久化缓存的.</p>
<ol>
<li><img src="" alt=""><a href="http://www.leric.info/" target="_blank">Leric</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-capacity/comment-page-1/#comment-97290" target="_blank">Nov 30th 2011 at 10:41</a></p>
<p>Redis本来就不是设计作为通用数据库用的，想把所有数据都放在redis里的企图从一开始就是错误的。个人觉得Redis用纵向扩展就行了，空间不够加内存，性能不够换机器（估计性能问题会出现在网络IO上），能遇到更庞大的数据访问问题的地方，也就得人工shard数据了。Redis的主从的主要作用在高可用性上，性能上感觉意义不大。</p>
<p><a href="http://timyang.net/data/redis-capacity/feed/" target="_blank">RSS feed for comments on this post</a>, <a href="http://timyang.net/data/redis-capacity/trackback/" target="_blank">TrackBack URI</a>
<a href="http://timyang.net/data/redis-capacity/#respond" target="_blank">Cancel Reply</a></p>
<h3 id="leave-a-comment">Leave a Comment</h3>
<p>Name (required)</p>
<p>E-mail (required, never displayed)</p>
<p>URI</p>
<p>Except where otherwise noted, content on this site is licensed under a <a href="http://creativecommons.org/licenses/by/3.0/" target="_blank">Creative Commons Attribution 3.0</a> License</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/架构师/">架构师</a></li></span></span> | <span class="tags">Tagged <a href="/tags/架构师/" class="label label-primary">架构师</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:28"datetime="2014-03-07 09:54:28"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-架构师--Redis容量及使用规划–Tim后端技术/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-架构师--Redis容量及使用规划–Tim后端技术" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-架构师--Twitter的跨数据中心图片存储系统Blobstore/">Twitter的跨数据中心图片存储系统Blobstore</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:28.000Z"> <a href="/2014/02/02/2014-02-02-架构师--Twitter的跨数据中心图片存储系统Blobstore/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="twitter-blobstore">Twitter的跨数据中心图片存储系统Blobstore</h1>
<p><strong>Twitter**</strong>的跨数据中心图片存储系统Blobstore**</p>
<p><strong>发表于**</strong>3<strong><strong>小时前</strong></strong>| 962<strong><strong>次阅读</strong></strong>|<strong><strong>来源</strong></strong>CSDN<strong><strong>编译</strong></strong>|<strong><strong>6<em>**</em></strong></strong>条评论<strong><strong>|</strong></strong>作者王鹏<strong>**</strong></p>
<p><a href="http://www.csdn.net/article/tag/twitter" target="_blank">Twitter</a><a href="http://www.csdn.net/article/tag/blobstore" target="_blank">Blobstore</a><a href="http://www.csdn.net/article/tag/kestrel" target="_blank">Kestrel</a></p>
<p>  <strong>摘要：</strong>Google、Facebook以及Twitter这些网络巨头都面临着同样的问题：如何构建跨数据中心服务？现在数以百万计的用户开始使用Twitter来分享照片，这些都离不开Twitter图片存储系统Blobstore的支持，该系统不仅引入了新的特性和功能，而且不断提升了用户体验，本文主要解析了该跨数据中心的图片存储系统。</p>
<p><strong>【CSDN报道】Twitter一直没有自己的图片存储系统，此前系统从2011年6月开始内置采用Photobucket的服务，另外，也支持Instagram等第三方图片应用上传到Twitter系统中。随着Twitter整体由开放转向封闭，切断第三方图片上传，同时自行提供图片系统是势所必然的。</strong></p>
<p><strong>12**</strong>月11日，Twitter工程博客发表<strong>[</strong>文章<strong>](<a href="http://engineering.twitter.com/2012/12/blobstore-twitters-in-house-photo.html" target="_blank">http://engineering.twitter.com/2012/12/blobstore-twitters-in-house-photo.html</a>)</strong>，介绍了9月份已经上线使用的图片存储系统Blobstore的底层架构。其中比较引人注目的是，Blobstore支持多数据中心同步。<a href="http://gigaom.com/data/twitter-and-google-offer-case-studies-in-spanning-distributed-systems/" target="_blank">GigaOM的文章</a>指出，这与<strong>[</strong>Google Spanner<strong>](<a href="http://www.csdn.net/article/2012-09-19/2810132-google-spanner-next-database-datacenter" target="_blank">http://www.csdn.net/article/2012-09-19/2810132-google-spanner-next-database-datacenter</a>)</strong>是异曲同工的。**</p>
<p><strong>CSDN**</strong>进行了编译整理，文章如下：**</p>
<p><strong>Blobstore**</strong>的设计目标<strong>**</strong></p>
<p>Blobstore是由Twitter开发的一个低成本和可扩展的的存储系统，可以用来存储图片以及其他的二进制对象（称为“blob”）。在开始构建Blobstore时，Twitter有三个设计目标：</p>
<p>·         低成本：可以大大减少花费在添加图片到Tweet中的时间和成本。</p>
<p>·         高性能：图片延迟保持在几十毫秒之内，同时保证每秒上千万张吞吐量的图片请求。</p>
<p>·         易于操作：随着Twitter基础设施的不断增长，能够扩展操作开销。</p>
<p><strong>Blobstore**</strong>是如何进行工作的？<strong>**</strong></p>
<p>当用户推送一张照片，我们把照片发送到一组Blobstore前端的服务器。前端服务器解析后会给该照片一个特定的写地址，接下来将其转发到具体的服务器进行实际的数据存储。我们可以把这些存储服务器称之为存储节点，它们把照片信息存储到一个磁盘上，然后通知元数据存储——图像已经存储完毕并记录所需要的信息以便进行照片检索。元数据存储库，这是一个非关系型键/值存储集群，它可以自动的进行多数据中心（multi-data-center）的同步功能，更重要的是可以跨所有的Twitter的数据中心，进而在Blobstore上提供的一致性的视图数据。</p>
<p>Blobstore核心是Blob Manager，它运行在前端，用于存储节点以及索引集群。Blob Manager充当系统中心“协调员”的角色，对集群进行管理。它是所有前端信息（决定应该把文件存储到哪个地方）的源。不仅如此，它还负责更新映射，在增加存储节点或者由于添加失败节点被移除时，协调数据的迁移。</p>
<p>还有一点比较重要，就是依靠Kestrel。这是Twitter现有的异步队列服务器，主要用来处理任务，比如说复制图像以及确保数据中心中数据的完整性。</p>
<p>Twitter确保一旦图像上传成功，用户就可以立即从数据中心中进行读取，而且绝对是最原始的图像。而且在如此之短的时间内，图像已经复制到Twitter所有其他的数据中心之内，并且可以从这些数据中心进行读取。此功能主要依赖于Blobstore内的多数据中心元数据存储对文件的中央索引。Twitter高度关注短时间内一个图像是否被已经被写入它最初的数据中心，他们使用路由请求，确保该Kestrel队列能够进行数据复制。</p>
<p><strong>Blobstore**</strong>的组成<strong>**</strong></p>
<p><img src="" alt="http://articles.csdn.net/uploads/allimg/121217/145_121217171537_1.jpg"></p>
<p><strong>如何进行数据的创建工作？<em>**</em></strong></p>
<p>当Blobstore收到一个图像请求时，我们需要先确定其位置再进行访问数据。虽然有一些方法可以解决这个问题，但是每一种都有自己的优点和缺点。其中有一个途径就是通过映射或者Hash每个图像，通过一些特有的方法分配到一个给定的服务器之上，不过这种方法有一个相当大的缺点，就是在管理图像的流动时要复杂得多。例如，要从Blobstore中添加或删除一个服务器，那么就需要为受到变更影响的每个独立的图像再计算一个新的位置。很显然，这大大增加了运营的复杂性，因为数据的移动会产生大量的记录。</p>
<p>另一个方法，我们可以为个人的数据块创建了一个固定大小的容器称之为“virtual bucket”，第一步我们先把这些图像映射到该容器之上，然后我们再把容器映射到独立的存储节点上，这样我们就保持virtual bucket的总数量不变（对整个集群的寿命来说这是很好的方法）。那么为了确定一张给定的图像应该存储在哪个virtual bucket之上，我们就需要对图像的唯一ID执行一个简单的Hash标记。只要virtual bucket的数量保持不变，这个Hashing也将保持稳定。这种方式稳定的原因在于：我们把对数据的移动放在一个更粗粒度的级别上，而不再是针对于单个图像。</p>
<p><strong>如何安置数据？<em>**</em></strong></p>
<p>当我们把virtual bucket映射到物理存储节点上时，我们的头脑应该保持清醒，必须保留一些规则以确保当我们丢失服务器或硬盘设备时，不能同时把数据丢失。如果我们把所有给定的图像副本都放在单一机架的服务器之上，一旦服务器出了问题，那就意味着图像将不可能再次使用。</p>
<p>如果我们把数据从一个给定的存储节点完全镜像到另一个存储节点之上，我们不太可能会出现不可用的数据，因为同时失去两个节点的可能性极低。然而，每当我们失去一个节点，我们会从另一个节点重新复制数据到源节点。当然我们必须缓慢的进行恢复，以便不影响单一剩余节点的性能。</p>
<p>如果我们采取相反的方法，让集群中的任何服务器都共享所有服务器中的数据，当我们恢复失去的副本时，从本质上说，为了恢复数据我们就需要读取整个集群。然而，我们也会有一个非常高的数据丢失的可能性（因为任何两个节点分享一个块数据块，丢失几率会很高）。所以，最优方法是两种办法的折中：对于一个给定的数据片段，会有限定数量的机器分享的数据的副本——肯定是超过一个，但是绝对用不到整个集群。</p>
<p>当我们确定映射数据到存储节点上时，我们把所有的这些因素都纳入考虑之中。那么产生的结果就是：我们构建了一个库，它被称为“libcrunch”，它非常了解各种数据的存储规则，比如说rack-awareness；它了解复制数据的方式，以便最大限度地减少数据丢失的风险，同时最大化数据恢复时的吞吐量；并且在集群中的任何拓扑(如添加节点或删除节点)改变时，试图最小化数据迁移的数量。最重要的一点，它让我们能够映射整个数据中心的网络拓扑结构，所以存储节点已经有更好的数据位置，我们只需要考虑rack-awareness以及通过PDU zones和路由器来确定副本的存储位置。</p>
<p><img src="" alt="http://articles.csdn.net/uploads/allimg/121217/145_121217171912_1.jpg"></p>
<p>图：Blobstore 数据存储方式</p>
<p><strong>拓扑管理<em>**</em></strong></p>
<p>随着磁盘和节点数量的不断增加，存储失败的机率也在不断升高。存储能力需要增强，磁盘和节点在出问题以后需要被立即取代，服务器也需要移动。为了使Blobstore更易于操作，我们投入了大量的时间和精力到libcrunch之上，还且随着集群的改变也开发了相关的工具。</p>
<p><img src="" alt="http://articles.csdn.net/uploads/allimg/121217/145_121217172315_1.jpg"></p>
<p>当一个存储节点失败之后，驻留在这个节点上的数据需要从现存的节点拷贝到正确的复制因子之上。失败的节点被标记为不可用的集群拓扑，因此libcrunch需要计算从virtual buckets映射到存储节点的改变。随着该映射的变更，就会指示存储节点复制和迁移virtual buckets到一个新的位置。</p>
<p><strong>Zookeeper<em>**</em></strong></p>
<p>拓扑和放置规则存储在Zookeeper集群中。Blob Manager处理这种交互，当一个操作符对系统进行变更时，它就会调用存储在Zookeeper中的这个信息。拓扑的改变包括复制因子的调整、添加或删除节点失败以及调整其他的libcrunch输入参数等等。</p>
<p><strong>跨数据中心复制<em>**</em></strong></p>
<p>Kestrel主要用于跨数据中心复制，这是因为kestrel是一个持久性的队列，可以用它来实现跨数据中心图像数据的异步复制。</p>
<p><strong>确认数据中心路由（Data center-aware Routing）<em>**</em></strong></p>
<p>TFE(Twitter的前端)是一个Twitter的核心组件。我们为TFE编写了一个定制的插件，这样就扩展了默认的路由规则。我们的元数据存储跨越多个数据中心，因为元数据存储（每blob）都很小(仅有几个字节)，我们复制这个信息通常比blob数据要快得多。如果一个用户试图访问一个blob，但是数据还没有复制到最近的数据中心中，那么我们就会查找这个元数据信息以及请求代理到最近的存储blob数据的数据中心。但是如果复制被延迟，我们仍然可以发送路由请求到最初存储blob的数据中心，这样它就能把数据复制到最近的数据中心，即使读取用户图像的成本有一点的延迟，但是“无伤大雅”。</p>
<p><strong>未来的工作<em>**</em></strong></p>
<p>我们已经发布了第一个Blobstore的内部版本，尽管Blobstore开始仅仅只能处理一些图片相关的信息，但是我们正在往其中添加其他的功能和需要blob storage的用例。而且我们也不断对其进行迭代，让它更健壮、更具扩展性而且更易于进行维护。（编译/<a href="http://weibo.com/1615203572/profile?topnav=1&amp;wvr=3.6" target="_blank">@CSDN王鹏</a>，审校/包研）</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/架构师/">架构师</a></li></span></span> | <span class="tags">Tagged <a href="/tags/架构师/" class="label label-primary">架构师</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:28"datetime="2014-03-07 09:54:28"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-架构师--Twitter的跨数据中心图片存储系统Blobstore/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-架构师--Twitter的跨数据中心图片存储系统Blobstore" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-架构师--Redis几个认识误区–Tim后端技术/">Redis几个认识误区 – Tim[后端技术]</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:28.000Z"> <a href="/2014/02/02/2014-02-02-架构师--Redis几个认识误区–Tim后端技术/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="redis-tim-">Redis几个认识误区 – Tim[后端技术]</h1>
<h1 id="-tim-http-timyang-net-home-"><a href="http://timyang.net/" title="Home" target="_blank">Tim[后端技术]</a></h1>
<p>Tim&#39;s blog, 关于后端架构、互联网技术、分布式、大型网络应用、NoSQL、技术感悟等</p>
<p><a href="http://timyang.net/" target="_blank">Home</a> | <a href="http://timyang.net/about/" target="_blank">About</a> | <a href="http://timyang.net/tag/English/" target="_blank">English version</a> | <a href="http://timyang.net/about/#comment" target="_blank">留言(Guestbook)</a> | <a href="http://timyang.net/feed/" target="_blank"><img src="" alt=""></a><a href="http://timyang.net/feed/" target="_blank">订阅RSS</a> <a href="http://fusion.google.com/add?source=atgs&amp;feedurl=http%3A//timyang.net/feed/" target="_blank"><img src="" alt="Add to Google"></a></p>
<ol>
<li></li>
</ol>
<ul>
<li><p>Email: <img src="" alt=""></p>
</li>
<li><h3 id="similar-posts">Similar Posts</h3>
</li>
<li><p><a href="http://timyang.net/architecture/notes-timelines-twitter/" title="May 3, 2012" target="_blank">Notes about Timelines @ Twitter</a></p>
</li>
<li><a href="http://timyang.net/data/redis-diskstore/" title="January 6, 2011" target="_blank">Redis新的存储模式diskstore</a></li>
<li><a href="http://timyang.net/data/redis-capacity/" title="January 5, 2011" target="_blank">Redis容量及使用规划</a></li>
<li><a href="http://timyang.net/data/mcdb-tt-redis/" title="August 11, 2009" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a></li>
<li><p><a href="http://timyang.net/programming/linux-synchronization-lock/" title="May 10, 2009" target="_blank">了解Linux的锁与同步</a></p>
</li>
<li><h3 id="most-commented">Most Commented</h3>
</li>
<li><p><a href="http://timyang.net/data/mcdb-tt-redis/" title="MemcacheDB, Tokyo Tyrant, Redis performance test" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a> (101)</p>
</li>
<li><a href="http://timyang.net/programming/c-erlang-java-performance/" title="C, Erlang, Java and Go Web Server performance test" target="_blank">C, Erlang, Java and Go Web Server performance test</a> (85)</li>
<li><a href="http://timyang.net/about/" title="About Tim Yang" target="_blank">About Tim Yang</a> (83)</li>
<li><a href="http://timyang.net/data/redis-misunderstanding/" title="Redis几个认识误区" target="_blank">Redis几个认识误区</a> (62)</li>
<li><a href="http://timyang.net/programming/memcache-mutex/" title="Memcache mutex设计模式" target="_blank">Memcache mutex设计模式</a> (47)</li>
<li><a href="http://timyang.net/architecture/microblog-design-qcon-beijing/" title="构建可扩展的微博架构(qcon beijing 2010演讲)" target="_blank">构建可扩展的微博架构(qcon beijing 2010演讲)</a> (39)</li>
<li><a href="http://timyang.net/architecture/consistent-hashing-practice/" title="某分布式应用实践一致性哈希的一些问题" target="_blank">某分布式应用实践一致性哈希的一些问题</a> (38)</li>
<li><a href="http://timyang.net/google/open-source/" title="为什么优秀开发者进入Google后就不参与开源了" target="_blank">为什么优秀开发者进入Google后就不参与开源了</a> (33)</li>
<li><a href="http://timyang.net/misc/macbook-air-productive/" title="MacBook Air与工作效率" target="_blank">MacBook Air与工作效率</a> (32)</li>
<li><p><a href="http://timyang.net/data/memcached-lru-evictions/" title="Memcached数据被踢(evictions&gt;0)现象分析" target="_blank">Memcached数据被踢(evictions&gt;0)现象分析</a> (30)</p>
</li>
<li><h3 id="recent-posts">Recent Posts</h3>
</li>
<li><p><a href="http://timyang.net/tao/speech-practice/" title="演讲小组的第一次活动" target="_blank">演讲小组的第一次活动</a></p>
</li>
<li><a href="http://timyang.net/tao/connect-the-dots/" title="“connect the dots” 随想" target="_blank">“connect the dots” 随想</a></li>
<li><a href="http://timyang.net/tao/talents/" title="跨领域人才" target="_blank">跨领域人才</a></li>
<li><a href="http://timyang.net/product/discontinued-servic/" title="产品下线杂谈" target="_blank">产品下线杂谈</a></li>
<li><a href="http://timyang.net/misc/speech/" title="当我谈演讲时候，我谈些什么" target="_blank">当我谈演讲时候，我谈些什么</a></li>
<li><a href="http://timyang.net/architecture/k/" title="案例与故障的知识库" target="_blank">案例与故障的知识库</a></li>
<li><a href="http://timyang.net/management/learning-tao/" title="团队中的为师之道" target="_blank">团队中的为师之道</a></li>
<li><a href="http://timyang.net/google/hybrid-research/" title="有感Google的混合研究方法" target="_blank">有感Google的混合研究方法</a></li>
<li><a href="http://timyang.net/management/probation/" title="谈技术人员“转正”" target="_blank">谈技术人员“转正”</a></li>
<li><a href="http://timyang.net/architecture/notes-weixin/" title="微信架构的启示" target="_blank">微信架构的启示</a></li>
<li><a href="http://timyang.net/misc/macbook-air-productive/" title="MacBook Air与工作效率" target="_blank">MacBook Air与工作效率</a></li>
<li><a href="http://timyang.net/architecture/notes-timelines-twitter/" title="Notes about Timelines @ Twitter" target="_blank">Notes about Timelines @ Twitter</a></li>
<li><a href="http://timyang.net/management/engineer-performance/" title="技术工程师的能力与目标" target="_blank">技术工程师的能力与目标</a></li>
<li><a href="http://timyang.net/management/design-review/" title="技术方案评审" target="_blank">技术方案评审</a></li>
<li><p><a href="http://timyang.net/management/planning/" title="谈技术团队目标" target="_blank">谈技术团队目标</a></p>
</li>
<li><h3 id="recent-comments">Recent Comments</h3>
</li>
<li><p><a href="http://emake.info/the-redis-several-misunderstandings.html" target="_blank">Redis几个认识误区 | 创造</a> on <a href="http://timyang.net/data/redis-misunderstanding/comment-page-2/#comment-224409" target="_blank">Redis几个认识误区</a></p>
</li>
<li><a href="http://emake.info/the-redis-several-misunderstandings.html" target="_blank">Redis几个认识误区 | 创造</a> on <a href="http://timyang.net/data/mcdb-tt-redis/comment-page-3/#comment-224408" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a></li>
<li><a href="http://outofmemory.cn/" target="_blank">甄码农</a> on <a href="http://timyang.net/management/learning-tao/comment-page-1/#comment-224161" target="_blank">团队中的为师之道</a></li>
<li><a href="http://outofmemory.cn/" target="_blank">甄码农</a> on <a href="http://timyang.net/tao/talents/comment-page-1/#comment-224158" target="_blank">跨领域人才</a></li>
<li><p>阿秀 on <a href="http://timyang.net/about/comment-page-2/#comment-223584" target="_blank">About Tim Yang</a></p>
</li>
<li><h3 id="categories">Categories</h3>
</li>
<li><p><a href="http://timyang.net/category/data/" title="View all posts filed under data" target="_blank">data</a></p>
</li>
<li><a href="http://timyang.net/category/erlang/" title="Erlang语言" target="_blank">Erlang</a></li>
<li><a href="http://timyang.net/category/google/" title="View all posts filed under Google" target="_blank">Google</a></li>
<li><a href="http://timyang.net/category/java/" title="View all posts filed under Java" target="_blank">Java</a></li>
<li><a href="http://timyang.net/category/linux/" title="View all posts filed under Linux" target="_blank">Linux</a></li>
<li><a href="http://timyang.net/category/lua/" title="View all posts filed under Lua" target="_blank">Lua</a></li>
<li><a href="http://timyang.net/category/python/" title="View all posts filed under Python" target="_blank">Python</a></li>
<li><a href="http://timyang.net/category/sns/" title="View all posts filed under SNS" target="_blank">SNS</a></li>
<li><a href="http://timyang.net/category/tech/" title="View all posts filed under tech" target="_blank">tech</a></li>
<li><a href="http://timyang.net/category/web/" title="View all posts filed under Web" target="_blank">Web</a></li>
<li><a href="http://timyang.net/category/product/" title="View all posts filed under 产品" target="_blank">产品</a></li>
<li><a href="http://timyang.net/category/distributed/" title="分布式算法及思想" target="_blank">分布式</a></li>
<li><a href="http://timyang.net/category/management/" title="View all posts filed under 技术管理" target="_blank">技术管理</a></li>
<li><a href="http://timyang.net/category/architecture/" title="后端架构" target="_blank">架构</a></li>
<li><a href="http://timyang.net/category/programming/" title="View all posts filed under 编程" target="_blank">编程</a></li>
<li><a href="http://timyang.net/category/tao/" title="View all posts filed under 随想" target="_blank">随想</a></li>
<li><p><a href="http://timyang.net/category/misc/" title="非技术话题" target="_blank">非技术</a></p>
</li>
<li><h3 id="archives">Archives</h3>
</li>
<li><p><a href="http://timyang.net/2012/10/" title="October 2012" target="_blank">October 2012</a> (5)</p>
</li>
<li><a href="http://timyang.net/2012/09/" title="September 2012" target="_blank">September 2012</a> (4)</li>
<li><a href="http://timyang.net/2012/05/" title="May 2012" target="_blank">May 2012</a> (3)</li>
<li><a href="http://timyang.net/2012/02/" title="February 2012" target="_blank">February 2012</a> (3)</li>
<li><a href="http://timyang.net/2012/01/" title="January 2012" target="_blank">January 2012</a> (2)</li>
<li><a href="http://timyang.net/2011/12/" title="December 2011" target="_blank">December 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/08/" title="August 2011" target="_blank">August 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/07/" title="July 2011" target="_blank">July 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/04/" title="April 2011" target="_blank">April 2011</a> (2)</li>
<li><a href="http://timyang.net/2011/02/" title="February 2011" target="_blank">February 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/01/" title="January 2011" target="_blank">January 2011</a> (2)</li>
<li><a href="http://timyang.net/2010/12/" title="December 2010" target="_blank">December 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/11/" title="November 2010" target="_blank">November 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/09/" title="September 2010" target="_blank">September 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/08/" title="August 2010" target="_blank">August 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/07/" title="July 2010" target="_blank">July 2010</a> (3)</li>
<li><a href="http://timyang.net/2010/06/" title="June 2010" target="_blank">June 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/05/" title="May 2010" target="_blank">May 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/04/" title="April 2010" target="_blank">April 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/03/" title="March 2010" target="_blank">March 2010</a> (4)</li>
<li><a href="http://timyang.net/2010/02/" title="February 2010" target="_blank">February 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/01/" title="January 2010" target="_blank">January 2010</a> (1)</li>
<li><a href="http://timyang.net/2009/12/" title="December 2009" target="_blank">December 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/11/" title="November 2009" target="_blank">November 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/10/" title="October 2009" target="_blank">October 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/09/" title="September 2009" target="_blank">September 2009</a> (4)</li>
<li><a href="http://timyang.net/2009/08/" title="August 2009" target="_blank">August 2009</a> (5)</li>
<li><a href="http://timyang.net/2009/07/" title="July 2009" target="_blank">July 2009</a> (6)</li>
<li><a href="http://timyang.net/2009/06/" title="June 2009" target="_blank">June 2009</a> (5)</li>
<li><a href="http://timyang.net/2009/05/" title="May 2009" target="_blank">May 2009</a> (11)</li>
<li><a href="http://timyang.net/2009/04/" title="April 2009" target="_blank">April 2009</a> (7)</li>
<li><a href="http://timyang.net/2009/03/" title="March 2009" target="_blank">March 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/02/" title="February 2009" target="_blank">February 2009</a> (2)</li>
<li><a href="http://timyang.net/2009/01/" title="January 2009" target="_blank">January 2009</a> (2)</li>
<li><a href="http://timyang.net/2008/12/" title="December 2008" target="_blank">December 2008</a> (2)</li>
<li><h3 id="feeds">Feeds</h3>
</li>
<li><p><a href="http://timyang.net/feed/" target="_blank">Entries (RSS)</a></p>
</li>
<li><a href="http://timyang.net/comments/feed/" target="_blank">Comments (RSS)</a>
*</li>
</ul>
<h2 id="-redis-http-timyang-net-data-redis-misunderstanding-permanent-link-to-redis-"><a href="http://timyang.net/data/redis-misunderstanding/" title="Permanent Link to Redis几个认识误区" target="_blank">Redis几个认识误区</a></h2>
<p>Saturday, Dec 4th, 2010 by Tim | Tags: <a href="http://timyang.net/tag/key-value-store/" target="_blank">key value store</a>, <a href="http://timyang.net/tag/redis/" target="_blank">redis</a></p>
<p>前几天微博发生了一起大的<a href="http://tech.sina.com.cn/i/2010-12-01/15324930344.shtml" target="_blank">系统故障</a>，很多技术的朋友都比较关心，其中的原因不会超出James Hamilton在On Designing and Deploying Internet-Scale Service(1)概括的那几个范围，James第一条经验“Design for failure”是所有互联网架构成功的一个关键。互联网系统的工程理论其实非常简单，James paper中内容几乎称不上理论，而是多条实践经验分享，每个公司对这些经验的理解及执行力决定了架构成败。</p>
<p>题外话说完，最近又研究了<a href="http://code.google.com/p/redis/" target="_blank">Redis</a>。去年曾做过一个<a href="http://timyang.net/data/mcdb-tt-redis/" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a>，到目前为止，这个benchmark结果依然有效。这1年我们经历了很多眼花缭乱的key value存储产品的诱惑，从Cassandra的淡出(Twitter暂停在主业务使用)到HBase的兴起(Facebook新的邮箱业务选用HBase(2))，当再回头再去看Redis，发现这个只有1万多行源代码的程序充满了神奇及大量未经挖掘的特性。Redis性能惊人，国内前十大网站的子产品估计用1台Redis就可以满足存储及Cache的需求。除了性能印象之外，业界其实普遍对Redis的认识存在一定误区。本文提出一些观点供大家探讨。</p>
<h3 id="1-redis-">1. Redis是什么</h3>
<p>这个问题的结果影响了我们怎么用Redis。如果你认为Redis是一个key value store, 那可能会用它来代替MySQL；如果认为它是一个可以持久化的cache, 可能只是它保存一些频繁访问的临时数据。Redis是REmote DIctionary Server的缩写，在Redis在官方网站的的副标题是A persistent key-value database with built-in net interface written in ANSI-C for Posix systems，这个定义偏向key value store。还有一些看法则认为Redis是一个memory database，因为它的高性能都是基于内存操作的基础。另外一些人则认为Redis是一个data structure server，因为Redis支持复杂的数据特性，比如List, Set等。对Redis的作用的不同解读决定了你对Redis的使用方式。</p>
<p>互联网数据目前基本使用两种方式来存储，关系数据库或者key value。但是这些互联网业务本身并不属于这两种数据类型，比如用户在社会化平台中的关系，它是一个list，如果要用关系数据库存储就需要转换成一种多行记录的形式，这种形式存在很多冗余数据，每一行需要存储一些重复信息。如果用key value存储则修改和删除比较麻烦，需要将全部数据读出再写入。Redis在内存中设计了各种数据类型，让业务能够高速原子的访问这些数据结构，并且不需要关心持久存储的问题，从架构上解决了前面两种存储需要走一些弯路的问题。</p>
<h3 id="2-redis-memcache-">2. Redis不可能比Memcache快</h3>
<p>很多开发者都认为Redis不可能比Memcached快，Memcached完全基于内存，而Redis具有持久化保存特性，即使是异步的，Redis也不可能比Memcached快。但是测试结果基本是Redis占绝对优势。一直在思考这个原因，目前想到的原因有这几方面。</p>
<ul>
<li><a href="http://monkey.org/~provos/libevent/" target="_blank">Libevent</a>。和Memcached不同，Redis并没有选择libevent。Libevent为了迎合通用性造成代码庞大(目前Redis代码还不到libevent的1/3)及牺牲了在特定平台的不少性能。Redis用libevent中两个文件修改实现了自己的epoll event loop(4)。业界不少开发者也建议Redis使用另外一个libevent高性能替代libev，但是作者还是坚持Redis应该小巧并去依赖的思路。一个印象深刻的细节是编译Redis之前并不需要执行./configure。</li>
<li>CAS问题。CAS是Memcached中比较方便的一种防止竞争修改资源的方法。CAS实现需要为每个cache key设置一个隐藏的cas token，cas相当value版本号，每次set会token需要递增，因此带来CPU和内存的双重开销，虽然这些开销很小，但是到单机10G+ cache以及QPS上万之后这些开销就会给双方相对带来一些细微性能差别(5)。</li>
</ul>
<h3 id="3-redis-">3. 单台Redis的存放数据必须比物理内存小</h3>
<p>Redis的数据全部放在内存带来了高速的性能，但是也带来一些不合理之处。比如一个中型网站有100万注册用户，如果这些资料要用Redis来存储，内存的容量必须能够容纳这100万用户。但是业务实际情况是100万用户只有5万活跃用户，1周来访问过1次的也只有15万用户，因此全部100万用户的数据都放在内存有不合理之处，RAM需要为冷数据买单。</p>
<p>这跟操作系统非常相似，操作系统所有应用访问的数据都在内存，但是如果物理内存容纳不下新的数据，操作系统会智能将部分长期没有访问的数据交换到磁盘，为新的应用留出空间。现代操作系统给应用提供的并不是物理内存，而是虚拟内存(Virtual Memory)的概念。</p>
<p>基于相同的考虑，Redis 2.0也增加了VM特性。让Redis数据容量突破了物理内存的限制。并实现了数据冷热分离。</p>
<h3 id="4-redis-vm-">4. Redis的VM实现是重复造轮子</h3>
<p>Redis的VM依照之前的epoll实现思路依旧是自己实现。但是在前面操作系统的介绍提到OS也可以自动帮程序实现冷热数据分离，Redis只需要OS申请一块大内存，OS会自动将热数据放入物理内存，冷数据交换到硬盘，另外一个知名的“理解了现代操作系统(3)”的Varnish就是这样实现，也取得了非常成功的效果。</p>
<p>作者antirez在解释为什么要自己实现VM中提到几个原因(6)。主要OS的VM换入换出是基于Page概念，比如OS VM1个Page是4K, 4K中只要还有一个元素即使只有1个字节被访问，这个页也不会被SWAP, 换入也同样道理，读到一个字节可能会换入4K无用的内存。而Redis自己实现则可以达到控制换入的粒度。另外访问操作系统SWAP内存区域时block进程，也是导致Redis要自己实现VM原因之一。</p>
<h3 id="5-get-set-redis">5. 用get/set方式使用Redis</h3>
<p>作为一个key value存在，很多开发者自然的使用set/get方式来使用Redis，实际上这并不是最优化的使用方法。尤其在未启用VM情况下，Redis全部数据需要放入内存，节约内存尤其重要。</p>
<p>假如一个key-value单元需要最小占用512字节，即使只存一个字节也占了512字节。这时候就有一个设计模式，可以把key复用，几个key-value放入一个key中，value再作为一个set存入，这样同样512字节就会存放10-100倍的容量。</p>
<p>这就是为了节约内存，建议使用hashset而不是set/get的方式来使用Redis，详细方法见参考文献(7)。</p>
<h3 id="6-aof-snapshot">6. 使用aof代替snapshot</h3>
<p>Redis有两种存储方式，默认是snapshot方式，实现方法是定时将内存的快照(snapshot)持久化到硬盘，这种方法缺点是持久化之后如果出现crash则会丢失一段数据。因此在完美主义者的推动下作者增加了aof方式。aof即append only mode，在写入内存数据的同时将操作命令保存到日志文件，在一个并发更改上万的系统中，命令日志是一个非常庞大的数据，管理维护成本非常高，恢复重建时间会非常长，这样导致失去aof高可用性本意。另外更重要的是Redis是一个内存数据结构模型，所有的优势都是建立在对内存复杂数据结构高效的原子操作上，这样就看出aof是一个非常不协调的部分。</p>
<p>其实aof目的主要是数据可靠性及高可用性，在Redis中有另外一种方法来达到目的：Replication。由于Redis的高性能，复制基本没有延迟。这样达到了防止单点故障及实现了高可用。</p>
<h3 id="-">小结</h3>
<p>要想成功使用一种产品，我们需要深入了解它的特性。Redis性能突出，如果能够熟练的驾驭，对国内很多大型应用具有很大帮助。希望更多同行加入到Redis使用及代码研究行列。</p>
<h3 id="-">参考文献</h3>
<ol>
<li><a href="http://www.mvdirona.com/jrh/talksAndPapers/JamesRH_Lisa.pdf" target="_blank">On Designing and Deploying Internet-Scale Service(PDF)</a></li>
<li><a href="http://highscalability.com/blog/2010/11/16/facebooks-new-real-time-messaging-system-hbase-to-store-135.html" target="_blank">Facebook’s New Real-Time Messaging System: HBase To Store 135+ Billion Messages A Month</a></li>
<li><a href="http://www.varnish-cache.org/trac/wiki/ArchitectNotes" target="_blank">What’s wrong with 1975 programming</a></li>
<li><a href="http://groups.google.com/group/redis-db/browse_thread/thread/b52814e9ef15b8d0/b9de497c6a73614f" target="_blank">Linux epoll is now supported</a>(Google Groups)</li>
<li><a href="http://groups.google.com/group/redis-db/browse_thread/thread/6b8ccada4d4b79fa" target="_blank">CAS and why I don’t want to add it to Redis</a>(Google Groups)</li>
<li><a href="http://groups.google.com/group/redis-db/browse_thread/thread/f1c641c07cc0346c" target="_blank">Plans for Virtual Memory</a>(Google Groups)</li>
<li><a href="http://antirez.com/post/redis-weekly-update-7.html" target="_blank">Full of keys</a>(Salvatore antirez Sanfilippo)</li>
</ol>
<p>-EOF-
上一篇博文<a href="http://timyang.net/architecture/method/" target="_blank">多IDC数据时序问题及方法论</a>在新浪微博上面有更多讨论及留言，有兴趣可以去围观。<a href="http://t.sina.com.cn/10503/zF0tex7z7b" target="_blank"><a href="http://t.sina.com.cn/10503/zF0tex7z7b">http://t.sina.com.cn/10503/zF0tex7z7b</a></a>(需登录)</p>
<h3 id="62-comments-http-timyang-net-data-redis-misunderstanding-postcomment-jump-to-the-comments-form-">62 Comments <a href="http://timyang.net/data/redis-misunderstanding/#postcomment" title="Jump to the comments form" target="_blank">»</a></h3>
<ol>
<li><img src="" alt="">Eguo Wang says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6135" target="_blank">Dec 4th 2010 at 03:09</a></p>
<p>我之前项目选用的是mongodb，相对于常规kv数据库提供了更多实用的查询操作。我有一个问题想请教你：redis中高效的条件搜索如何做呢？难道真的要自己解数据后构建吗？或使用附加的搜索引擎？</p>
<ol>
<li><img src="" alt="">Eguo Wang says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6137" target="_blank">Dec 4th 2010 at 03:25</a></p>
<p>看到wiki中有几个指令大概是做搜索操作。</p>
<ol>
<li><img src="" alt="">kula says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6145" target="_blank">Dec 4th 2010 at 09:25</a></p>
<p>redis的vm模式在实践中存在一些问题.</p>
<p>我使用过redis2.0.2, 发现当vm模式打开的时候, 并发连接数在1500以上时, redis latency会大大增加.平均每个请求的latency会超过4000ms, 观察redis的进程cpu占用率, 会超过100%. 最后迫于无奈,关掉了redis的vm功能. 此时并发连接不变的情况下,redis的latency下降到2ms以下. cpu占用率下降到1%.</p>
<p>没有深入研究过这个症状,但初步怀疑是redis的vm实现有点不靠谱.</p>
<ol>
<li><img src="" alt="">kula says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6146" target="_blank">Dec 4th 2010 at 09:26</a></p>
<p>redis的vm模式在实践中存在一些问题.
我使用过redis2.0.2, 发现当vm模式打开的时候, 并发连接数在1500以上时, redis latency会大大增加.平均每个请求的latency会超过4000ms, 观察redis的进程cpu占用率, 会超过100%. 最后迫于无奈,关掉了redis的vm功能. 此时并发连接不变的情况下,redis的latency下降到2ms以下. cpu占用率下降到1%.
没有深入研究过这个症状,但初步怀疑是redis的vm实现有点不靠谱.</p>
<ol>
<li><img src="" alt=""><a href="http://kasicass.blog.163.com/" target="_blank">kasicass</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6147" target="_blank">Dec 4th 2010 at 10:09</a></p>
<p>是不是笔误，呵呵。</p>
<p>“没一行需要存储一些重复信息” ==&gt; “每一行需要存储一些重复信息”</p>
<ol>
<li><img src="" alt="">empyreaner says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6149" target="_blank">Dec 4th 2010 at 12:07</a></p>
<p>@Eguo Wang
redis的搜索都需要自己做索引。使用keys指令做搜索消耗比较大，不能作为常用指令。</p>
<ol>
<li><img src="" alt=""><a href="http://www.yiihsia.com/" target="_blank">yiihsia</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6157" target="_blank">Dec 4th 2010 at 17:19</a></p>
<p>VM还是不好用，频繁访问老会报错，
hashset更适合像cache这样一对一的存储，批量get的方法只能针对一个具体的hash值</p>
<ol>
<li><img src="" alt="">fzuslide says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6169" target="_blank">Dec 5th 2010 at 00:36</a></p>
<p>Redis在写snapshot的时候CPU使用率很高，数据库本身很大的情况下，回写磁盘过程持续的时间会比较久。这种情况下AOF开销相对较小，然后定时的BGrewriteAOF来减小aof大小，replication还是必须要做的。</p>
<ol>
<li><img src="" alt="">davies says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6198" target="_blank">Dec 6th 2010 at 17:35</a></p>
<p>Redis 并不是神奇, 它有点像个拥有十八般武艺的四不像, 想要解决所有问题, 却没有完全好地解决掉任何一个问题.</p>
<ol>
<li><img src="" alt="">Hanson Lu says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6238" target="_blank">Dec 10th 2010 at 09:17</a></p>
<p>以后有个开源哦项目Prevayler，也是使用snapshot + 日志的方式实现持久化，也是挺不错的，不过由于开启了fsync操作，导致效率很低，不知redis是否使用了fsync</p>
<ol>
<li><img src="" alt="">Bob says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6291" target="_blank">Dec 13th 2010 at 10:01</a></p>
<p>最近也在关注这方面的资料，有在InfoQ上看到天涯团队的一篇文章：
<a href="http://www.infoq.com/cn/news/2010/11/tianya-memlink" target="_blank"><a href="http://www.infoq.com/cn/news/2010/11/tianya-memlink">http://www.infoq.com/cn/news/2010/11/tianya-memlink</a></a></p>
<p>里面提到了2点，</p>
<ol>
<li>Redis的复制机制不完善，失步之后要重新同步所有数据。</li>
<li>Redis的操作时单线程的，没有办法利用多核的优势。</li>
</ol>
<p>不知Tim怎么看这两个问题？对实际应用的影响大吗？</p>
<ol>
<li><img src="" alt="">Tim says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6292" target="_blank">Dec 13th 2010 at 10:29</a></p>
<p>@bob</p>
<ol>
<li>可以架两级slave解决</li>
<li>通过单服务器多端口刚好发挥这种优势，我上次微博公开演讲也介绍过。</li>
<li><img src="" alt="">test says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-6293" target="_blank">Dec 13th 2010 at 10:30</a></p>
<p>我觉得你的很多想法都非常奇怪。</p>
<ol>
<li><img src="" alt=""><a href="http://www.zhangpeng.me/" target="_blank">kefeng</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-7628" target="_blank">Jan 26th 2011 at 09:41</a></p>
<p>支持作者的观点，深有体会。</p>
<ol>
<li><img src="" alt=""><a href="http://redcreen.com/" target="_blank">chao.liu</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-12782" target="_blank">Feb 25th 2011 at 17:27</a></p>
<p>用get/set方式使用Redis：
最好不要在redis client上封装get set的方式使用hash的方式，否则sort操作的时候可能会有问题。</p>
<ol>
<li><img src="" alt=""><a href="http://redcreen.com/" target="_blank">chao.liu</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-12794" target="_blank">Feb 25th 2011 at 19:54</a></p>
<p>补充：
sort支持根据hashs filed进行排序 例如：
SORT mylist BY weight<em>/*-&gt;fieldname GET object</em>/*-&gt;fieldname
如果client上封装了set方法使其使用hashes的方式存储以节省内存，此时hashes的key是根据一定的算法确定的，假如是sha1，那么set方法的key会分布到不同的hashes的key中，此时如果做排序会导致 需要遍历hashes。</p>
<ol>
<li><img src="" alt=""><a href="http://redcreen.com/" target="_blank">chao.liu</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-12802" target="_blank">Feb 25th 2011 at 20:33</a></p>
<p>接上：
在启用vm的情况下 如果按照参文献7中所说 ，通过sha1算法将key value放入到不同的hashes中，这时会出现一个问题：vm的换出是根据age/*log asize 来选出最适合的key，将对应的value放入swap中，由于hashes的key是通过算法算出来的，有可能导致部分的冷filed因为与hot fileld使用同一个key 而无法被交换出去。内存开销是小了，但可能无法换出了。</p>
<ol>
<li><img src="" alt="">domiguo says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-25818" target="_blank">Apr 29th 2011 at 15:47</a></p>
<p>我们也打算使用redis，但是对他的persistence有一些担心，
请问你们使用redis的方法后端还有其它设备的备份吗，比如Mysql之类的，还是完全靠redis本身的persistence加上一些业务级别的保证？</p>
<ol>
<li><img src="" alt=""><a href="http://www.geelou.com/article/119.html" target="_blank">rjgcs123</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-30811" target="_blank">May 27th 2011 at 17:11</a></p>
<p>云集国内redis大佬的QQ群正在招募各路redis朋友，不管你是正在使用redis，还是在研究redis，或者是对redis感兴趣，你都可以加入到我们的阵营。大家一起讨论redis各类用法，key-value、list、set、map使用，redis优化、内存监控、主从配置等等问题，这里都会有高手给你解决。</p>
<p>注意啦，国内顶尖级别的redisQQ群是 43016055</p>
<ol>
<li><img src="" alt=""><a href="http://simaliu.com/" target="_blank">simonliu</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-34084" target="_blank">Jun 9th 2011 at 11:44</a></p>
<p>访问操作系统的 SWAP 需要 block 进程。实际上自己实现 VM，访问存在磁盘上的冷数据时肯定是要 block 进程的。所以这点理由有点牵强。</p>
<ol>
<li><img src="" alt="">geelou says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-40826" target="_blank">Jul 5th 2011 at 13:11</a></p>
<p>redis java分群 163264749 是java的
Redis PHP分群 163265386 是php的
redis c,c++,c/#分群 163269313 是.net的
redis shell,python群 69287882 是shell,python，prel脚本类的</p>
<ol>
<li><img src="" alt=""><a href="http://kyozhou.com/" target="_blank">kyozhou</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-42886" target="_blank">Jul 11th 2011 at 17:23</a></p>
<p>非常好，尤其是对于redis的性能超过memcached的描述。</p>
<ol>
<li><img src="" alt=""><a href="http://school.renren.it/" target="_blank">fenglibin2010</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-49718" target="_blank">Aug 16th 2011 at 16:26</a></p>
<p>写得非常好，我们也准备使用REDIS，对一些概念又更加清晰</p>
<ol>
<li><img src="" alt="">pally says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-50967" target="_blank">Aug 22nd 2011 at 13:37</a></p>
<p>very good!
happy to see it!</p>
<ol>
<li><img src="" alt=""><a href="http://www.iroowe.com/" target="_blank">Roowe</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-65586" target="_blank">Oct 13th 2011 at 00:04</a></p>
<p>看了评论，我都不怎么敢用了，本身出于用缓存来减少服务器的压力，而不是用NoSQL，这货貌似是NoSQL。。</p>
<ol>
<li><img src="" alt=""><a href="http://www.the5fire.net/" target="_blank">the5fire</a> says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-195693" target="_blank">Jul 30th 2012 at 11:08</a></p>
<p>学习了，刚开始看redis。</p>
<ol>
<li><img src="" alt="">GF says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-198583" target="_blank">Aug 9th 2012 at 13:17</a></p>
<p>MySQL 最新开发版 5.6.6 目前尚未发布，但从官网给出的 CHANGES 文档可得知，该版本将内嵌 memcached 的支持，以后可以用No SQL的方式使用mysql，在数据库中充分利用memcached的优点。缓存和数据的一致性问题不再是个问题。</p>
<ol>
<li><img src="" alt="">Eguo Wang says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-218019" target="_blank">Oct 30th 2012 at 11:43</a></p>
<p>DDDDD!！</p>
<ol>
<li><img src="" alt="">julie says:</li>
</ol>
<p><a href="http://timyang.net/data/redis-misunderstanding/comment-page-1/#comment-221614" target="_blank">Nov 12th 2012 at 15:37</a></p>
<p>大家有没有在广域网中使用过redis？master和slave的同步性能情况怎样，有人知道吗？</p>
<p><a href="http://timyang.net/data/redis-misunderstanding/feed/" target="_blank">RSS feed for comments on this post</a>, <a href="http://timyang.net/data/redis-misunderstanding/trackback/" target="_blank">TrackBack URI</a>
<a href="http://timyang.net/data/redis-misunderstanding/#respond" target="_blank">Cancel Reply</a></p>
<h3 id="leave-a-comment">Leave a Comment</h3>
<p>Name (required)</p>
<p>E-mail (required, never displayed)</p>
<p>URI</p>
<p>Except where otherwise noted, content on this site is licensed under a <a href="http://creativecommons.org/licenses/by/3.0/" target="_blank">Creative Commons Attribution 3.0</a> License</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/架构师/">架构师</a></li></span></span> | <span class="tags">Tagged <a href="/tags/架构师/" class="label label-primary">架构师</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:28"datetime="2014-03-07 09:54:28"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-架构师--Redis几个认识误区–Tim后端技术/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-架构师--Redis几个认识误区–Tim后端技术" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-架构师--YouTube架构学习体会-开源中国OSChinaNET/">YouTube 架构学习体会 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:28.000Z"> <a href="/2014/02/02/2014-02-02-架构师--YouTube架构学习体会-开源中国OSChinaNET/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="youtube-oschina-net">YouTube 架构学习体会 - 开源中国 OSChina.NET</h1>
<ul>
<li><a href="http://www.oschina.net/" target="_blank">首页</a></li>
<li><a href="http://www.oschina.net/project" target="_blank">开源软件</a></li>
<li><p><a href="http://www.oschina.net/question" target="_blank">讨论区</a></p>
</li>
<li><p><a href="http://www.oschina.net/question?catalog=1" target="_blank">技术问答 »</a></p>
</li>
<li><a href="http://www.oschina.net/question?catalog=2" target="_blank">技术分享 »</a></li>
<li><a href="http://www.oschina.net/question?catalog=3" target="_blank">IT大杂烩 »</a></li>
<li><a href="http://www.oschina.net/question?catalog=100" target="_blank">职业生涯 »</a></li>
<li><a href="http://www.oschina.net/question?catalog=4" target="_blank">站务/建议 »</a></li>
<li><a href="http://www.oschina.net/alipay" target="_blank">支付宝专区 »</a></li>
<li><a href="http://www.oschina.net/code/list" target="_blank">代码分享</a></li>
<li><a href="http://www.oschina.net/blog" target="_blank">博客</a></li>
<li><a href="http://www.oschina.net/translate" target="_blank">翻译</a></li>
<li><a href="http://www.oschina.net/news" target="_blank">资讯</a></li>
<li><p><a href="http://www.oschina.net/android" target="_blank">移动开发</a></p>
</li>
<li><p><a href="http://www.oschina.net/android" target="_blank">Android开发专区</a></p>
</li>
<li><a href="http://www.oschina.net/ios/home" target="_blank">iOS开发专区</a></li>
<li><a href="http://www.oschina.net/ios/codingList" target="_blank">iOS代码库</a></li>
<li><a href="http://www.oschina.net/wp7" target="_blank">WP7开发专区</a></li>
<li><a href="http://www.oschina.net/job" target="_blank">招聘</a></li>
</ul>
<p>当前访客身份：游客 [ <a href="http://www.oschina.net/home/login?goto_page=http%3A%2F%2Fwww.oschina.net%2Fquestion%2F12_32459" target="_blank">登录</a> | <a href="http://www.oschina.net/home/reg" target="_blank">加入开源中国</a> ]</p>
<p><a href="http://www.oschina.net/" title="OSChina 开源中国" target="_blank">开源中国</a></p>
<h1 id="-http-www-oschina-net-question-"><a href="http://www.oschina.net/question" target="_blank">讨论区</a></h1>
<p>当前位置： <a href="http://www.oschina.net/question" target="_blank">讨论区</a> » <a href="http://www.oschina.net/question?catalog=2" target="_blank">技术分享</a> » <a href="http://www.oschina.net/p/mysql" target="_blank">MySQL</a>    搜 索
<a href="http://my.oschina.net/javayou" target="_blank"><img src="&quot;红薯&quot;" alt="红薯"></a></p>
<h1 id="-youtube-"><a href="">YouTube 架构学习体会</a></h1>
<p><a href="http://my.oschina.net/javayou" target="_blank">红薯</a> 发表于 2011-11-21 23:20 1年前, <a href="http://www.oschina.net/question/12_32459#answers" target="_blank">19</a>回/7508阅, 最后回答: 5个月前</p>
<p>Java、PHP、Ruby、iOS、Python 等 JetBrains 开发工具低至 99 元（3折），<a href="http://www.oschina.net/shop/jetbrains" target="_blank">详情»</a></p>
<p>这几天一直在关注和学习一些大型网站的架构，希望有一天自己也能设计一个高并发、高容错的系统并能应用在实践上。今天在网上找架构相关的资料时，看到一个被和谐的视频网站YouTube的架构分析，看了以后觉得自己又向架构走近了一步，于是赶快拿出来与大家一起分享。
YouTube发展迅速，每天超过1亿的视频点击量，但只有很少人在维护站点和确保伸缩性。这点和PlentyOfFish类似，少数人维护庞大系统。是什么原因呢？放心绝对不是靠人品，也不是靠寂寞，下面就来看看YouTube的整体技术架构吧。
平台</p>
<p>Apache
Python
Linux(SuSe)
MySQL
psyco，一个动态的Python到C的编译器
lighttpd代替Apache做视频查看</strong>
状态
支持每天超过1亿的视频点击量
成立于2005年2月
于2006年3月达到每天3千万的视频点击量
于2006年7月达到每天1亿的视频点击量
2个系统管理员，2个伸缩性软件架构师
2个软件开发工程师，2个网络工程师，1个DBA</strong>
Web服务器
1，NetScaler用于负载均衡和静态内容缓存
2，使用mod_fast_cgi运行Apache
3，使用一个Python应用服务器来处理请求的路由
4，应用服务器与多个数据库和其他信息源交互来获取数据和格式化html页面
5，一般可以通过添加更多的机器来在Web层提高伸缩性
6，Python的Web层代码通常不是性能瓶颈，大部分时间阻塞在RPC
7，Python允许快速而灵活的开发和部署
8，通常每个页面服务少于100毫秒的时间
9，使用psyco(一个类似于JIT编译器的动态的Python到C的编译器)来优化内部循环
10，对于像加密等密集型CPU活动，使用C扩展
11，对于一些开销昂贵的块使用预先生成并缓存的html
12，数据库里使用行级缓存
13，缓存完整的Python对象</p>
<p>14，有些数据被计算出来并发送给各个程序，所以这些值缓存在本地内存中。这是个使用不当的策略。</p>
<p>应用服务器里最快的缓存将预先计算的值发送给所有服务器也花不了多少时间。只需弄一个代理来监听更改，预计算，然后发送。
视频服务
1，花费包括带宽，硬件和能源消耗
2，每个视频由一个迷你集群来host，每个视频被超过一台机器持有
3，使用一个集群意味着：
   -更多的硬盘来持有内容意味着更快的速度
   -failover。如果一台机器出故障了，另外的机器可以继续服务
   -在线备份
4，使用lighttpd作为Web服务器来提供视频服务：
   -Apache开销太大
   -使用epoll来等待多个fds
   -从单进程配置转变为多进程配置来处理更多的连接
5，大部分流行的内容移到CDN：
  -CDN在多个地方备份内容，这样内容离用户更近的机会就会更高
  -CDN机器经常内存不足，因为内容太流行以致很少有内容进出内存的颠簸
6，不太流行的内容(每天1-20浏览次数)在许多colo站点使用YouTube服务器
  -长尾效应。一个视频可以有多个播放，但是许多视频正在播放。随机硬盘块被访问
  -在这种情况下缓存不会很好，所以花钱在更多的缓存上可能没太大意义。
  -调节RAID控制并注意其他低级问题
  -调节每台机器上的内存，不要太多也不要太少 </strong>
视频服务关键点</p>
<p>1，保持简单和廉价
2，保持简单网络路径，在内容和用户间不要有太多设备
3，使用常用硬件，昂贵的硬件很难找到帮助文档
4，使用简单而常见的工具，使用构建在Linux里或之上的大部分工具</p>
<p>5，很好的处理随机查找(SATA，tweaks)</p>
<p>缩略图服务
1，做到高效令人惊奇的难
2，每个视频大概4张缩略图，所以缩略图比视频多很多
3，缩略图仅仅host在几个机器上
4，持有一些小东西所遇到的问题：
   -OS级别的大量的硬盘查找和inode和页面缓存问题
   -单目录文件限制，特别是Ext3，后来移到多分层的结构。内核2.6的最近改进可能让 Ext3允许大目录，但在一个文件系统里存储大量文件不是个好主意
   -每秒大量的请求，因为Web页面可能在页面上显示60个缩略图
   -在这种高负载下Apache表现的非常糟糕
   -在Apache前端使用squid，这种方式工作了一段时间，但是由于负载继续增加而以失败告终。它让每秒300个请求变为20个
   -尝试使用lighttpd但是由于使用单线程它陷于困境。遇到多进程的问题，因为它们各自保持自己单独的缓存
   -如此多的图片以致一台新机器只能接管24小时
   -重启机器需要6-10小时来缓存
5，为了解决所有这些问题YouTube开始使用Google的BigTable，一个分布式数据存储：
   -避免小文件问题，因为它将文件收集到一起
   -快，错误容忍
   -更低的延迟，因为它使用分布式多级缓存，该缓存与多个不同collocation站点工作
   -更多信息参考Google Architecture，GoogleTalk Architecture和BigTable
数据库</p>
<p>1，早期
   -使用MySQL来存储元数据，如用户，tags和描述
   -使用一整个10硬盘的RAID 10来存储数据
   -依赖于信用卡所以YouTube租用硬件
   -YouTube经过一个常见的革命：单服务器，然后单master和多read slaves，然后数据库分区，然后sharding方式
   -痛苦与备份延迟。master数据库是多线程的并且运行在一个大机器上所以它可以处理许多工作，slaves是单线程的并且通常运行在小一些的服务器上并且备份是异步的，所以slaves会远远落后于master
   -更新引起缓存失效，硬盘的慢I/O导致慢备份
   -使用备份架构需要花费大量的money来获得增加的写性能
   -YouTube的一个解决方案是通过把数据分成两个集群来将传输分出优先次序：一个视频查看池和一个一般的集群
2，后期
   -数据库分区
   -分成shards，不同的用户指定到不同的shards
   -扩散读写
   -更好的缓存位置意味着更少的IO
   -导致硬件减少30%
   -备份延迟降低到0</p>
<p>   -现在可以任意提升数据库的伸缩性</p>
<p>数据中心策略
1，依赖于信用卡，所以最初只能使用受管主机提供商
2，受管主机提供商不能提供伸缩性，不能控制硬件或使用良好的网络协议
3，YouTube改为使用colocation arrangement。现在YouTube可以自定义所有东西并且协定自己的契约
4，使用5到6个数据中心加CDN
5，视频来自任意的数据中心，不是最近的匹配或其他什么。如果一个视频足够流行则移到CDN
6，依赖于视频带宽而不是真正的延迟。可以来自任何colo
7，图片延迟很严重，特别是当一个页面有60张图片时</p>
<p>8，使用BigTable将图片备份到不同的数据中心，代码查看谁是最近的</p>
<p>学到的东西
1，Stall for time。创造性和风险性的技巧让你在短期内解决问题而同时你会发现长期的解决方案
2，Proioritize。找出你的服务中核心的东西并对你的资源分出优先级别
3，Pick your battles。别怕将你的核心服务分出去。YouTube使用CDN来分布它们最流行的内容。创建自己的网络将花费太多时间和太多money
4，Keep it simple！简单允许你更快的重新架构来回应问题
5，Shard。Sharding帮助隔离存储，CPU，内存和IO，不仅仅是获得更多的写性能
6，Constant iteration on bottlenecks：
   -软件：DB，缓存
   -OS：硬盘I/O
   -硬件：内存，RAID
7，You succeed as a team。拥有一个跨越条律的了解整个系统并知道系统内部是什么样的团队，如安装打印机，安装机器，安装网络等等的人。</p>
<p>   With a good team all things are possible。</p>
<p>文章出处：<a href="http://www.itivy.com/ivy/archive/2011/3/6/634350416046298451.html" target="_blank"><a href="http://www.itivy.com/ivy/archive/2011/3/6/634350416046298451.html">http://www.itivy.com/ivy/archive/2011/3/6/634350416046298451.html</a></a></p>
<p><strong>标签：</strong> <a href="http://www.oschina.net/question/tag/mysql" title="数据库服务器 MySQL" target="_blank">MySQL</a> <a href="http://www.oschina.net/question/tag/nginx" title="高性能Web服务器 Nginx" target="_blank">Nginx</a> <a href="http://www.oschina.net/question/tag/lighttpd" title="高性能Web服务器 Lighttpd" target="_blank">Lighttpd</a> <a href="http://www.oschina.net/question/tag/apache+http+server" title="HTTP服务器 Apache" target="_blank">Apache</a> <a href="http://www.oschina.net/question/tag/Youtube" target="_blank">Youtube</a>
<a href="">补充话题说明»</a></p>
<p><strong>分享到</strong> <a href="&quot;分享到新浪微博&quot;"></a><a href="&quot;分享到腾讯微博&quot;"></a>**</p>
<p><a href="&quot;收藏此话题&quot;">收藏</a>
**</p>
<p>134
**</p>
<p><a href="">举报</a>
**</p>
<p><a href="&quot;踩：这问题不知道在说什么，或者没什么用&quot;">踩</a> 0 | <a href="&quot;顶：这问题很有用或者很清晰明了&quot;">顶</a> 3
**</p>
<h2 id="-http-www-oschina-net-question-12_32459-answers-http-www-oschina-net-question-12_32459-sort-time-answers-http-www-oschina-net-question-12_32459-top-19-http-www-oschina-net-question-12_32459-answerform-"><a href="http://www.oschina.net/question/12_32459#answers" target="_blank">按默认排序</a> | <a href="http://www.oschina.net/question/12_32459?sort=time#answers" target="_blank">显示最新评论</a> | <a href="http://www.oschina.net/question/12_32459#top" target="_blank">回页面顶部</a>  <a href=""></a>共有<em>19</em>个评论 <a href="http://www.oschina.net/question/12_32459#answerform">发表评论»</a></h2>
<ul>
<li><a href="http://my.oschina.net/hil2010" target="_blank"><img src="&quot;FoxHu&quot;" alt="FoxHu"></a></li>
</ul>
<p><a href="http://my.oschina.net/hil2010" target="_blank">FoxHu</a> 回答于 2011-11-22 18:05</p>
<p><a href="">举报</a>
学习了！
<a href="&quot;这是一个好评论，能解决问题&quot;">有帮助</a><em>(0)</em> | <a href="&quot;这评论无法解决问题，或者模糊不清&quot;">没帮助</a><em>(0)</em> | <a href="">评论</a><em>(0)</em> | <a href="http://www.oschina.net/question/answer?question=32459&amp;answer=132838" target="_blank">引用此评论</a></p>
<ul>
<li><a href="http://my.oschina.net/davidjianl" target="_blank"><img src="&quot;沈健&quot;" alt="沈健"></a></li>
</ul>
<p><a href="http://my.oschina.net/davidjianl" target="_blank">沈健</a> 回答于 2011-11-22 18:25</p>
<p><a href="">举报</a>
真是只有这么点人？9个人？
<a href="&quot;这是一个好评论，能解决问题&quot;">有帮助</a><em>(0)</em> | <a href="&quot;这评论无法解决问题，或者模糊不清&quot;">没帮助</a><em>(0)</em> | <a href="">评论</a><em>(0)</em> | <a href="http://www.oschina.net/question/answer?question=32459&amp;answer=132845" target="_blank">引用此评论</a></p>
<ul>
<li><a href="http://my.oschina.net/u/208276" target="_blank"><img src="&quot;timo&quot;" alt="timo"></a></li>
</ul>
<p><a href="http://my.oschina.net/u/208276" target="_blank">timo</a> 回答于 2011-11-22 18:52</p>
<p><a href="">举报</a>
果然都是精兵强将
<a href="&quot;这是一个好评论，能解决问题&quot;">有帮助</a><em>(0)</em> | <a href="&quot;这评论无法解决问题，或者模糊不清&quot;">没帮助</a><em>(0)</em> | <a href="">评论</a><em>(0)</em> | <a href="http://www.oschina.net/question/answer?question=32459&amp;answer=132853" target="_blank">引用此评论</a></p>
<ul>
<li><a href="http://my.oschina.net/richardx" target="_blank"><img src="&quot;Richardx&quot;" alt="Richardx"></a></li>
</ul>
<p><a href="http://my.oschina.net/richardx" target="_blank">Richardx</a> 回答于 2011-11-22 21:58</p>
<p><a href="">举报</a>
最近也在学习大型网站的架构
<a href="&quot;这是一个好评论，能解决问题&quot;">有帮助</a><em>(0)</em> | <a href="&quot;这评论无法解决问题，或者模糊不清&quot;">没帮助</a><em>(0)</em> | <a href="">评论</a><em>(0)</em> | <a href="http://www.oschina.net/question/answer?question=32459&amp;answer=132882" target="_blank">引用此评论</a></p>
<ul>
<li><a href="http://my.oschina.net/pizigou" target="_blank"><img src="&quot;pizigou&quot;" alt="pizigou"></a></li>
</ul>
<p><a href="http://my.oschina.net/pizigou" target="_blank">pizigou</a> 回答于 2011-11-23 09:29</p>
<p><a href="">举报</a>
2，后期 -数据库分区 -分成shards，不同的用户指定到不同的shards -扩散读写 -更好的缓存位置意味着更少的IO -导致硬件减少30% -备份延迟降低到0 -现在可以任意提升数据库的伸缩性 这块红薯老大可否解说下？这里说得太笼统，看起来跟初期的结构没什么差别，貌似还增加了管理维护成本。
<a href="&quot;这是一个好评论，能解决问题&quot;">有帮助</a><em>(0)</em> | <a href="&quot;这评论无法解决问题，或者模糊不清&quot;">没帮助</a><em>(0)</em> | <a href="">评论</a><em>(0)</em> | <a href="http://www.oschina.net/question/answer?question=32459&amp;answer=132940" target="_blank">引用此评论</a></p>
<ul>
<li><a href="http://my.oschina.net/onlyoutman" target="_blank"><img src="&quot;该用户已被和谐&quot;" alt="该用户已被和谐"></a></li>
</ul>
<p><a href="http://my.oschina.net/onlyoutman" target="_blank">该用户已被和谐</a> 回答于 2011-11-23 09:37</p>
<p><a href="">举报</a>
不错！ <img src="" alt="">
<a href="&quot;这是一个好评论，能解决问题&quot;">有帮助</a><em>(0)</em> | <a href="&quot;这评论无法解决问题，或者模糊不清&quot;">没帮助</a><em>(0)</em> | <a href="">评论</a><em>(0)</em> | <a href="http://www.oschina.net/question/answer?question=32459&amp;answer=132945" target="_blank">引用此评论</a></p>
<ul>
<li><a href="http://my.oschina.net/u/179641" target="_blank"><img src="&quot;javaspace&quot;" alt="javaspace"></a></li>
</ul>
<p><a href="http://my.oschina.net/u/179641" target="_blank">javaspace</a> 回答于 2011-11-23 21:11</p>
<p><a href="">举报</a>
有受益 <img src="" alt="">
<a href="&quot;这是一个好评论，能解决问题&quot;">有帮助</a><em>(0)</em> | <a href="&quot;这评论无法解决问题，或者模糊不清&quot;">没帮助</a><em>(0)</em> | <a href="">评论</a><em>(0)</em> | <a href="http://www.oschina.net/question/answer?question=32459&amp;answer=133248" target="_blank">引用此评论</a></p>
<ul>
<li><a href="http://my.oschina.net/sylar066" target="_blank"><img src="&quot;黑曜石&quot;" alt="黑曜石"></a></li>
</ul>
<p><a href="http://my.oschina.net/sylar066" target="_blank">黑曜石</a> 回答于 2011-11-23 21:37</p>
<p><a href="">举报</a>
我1年前爬到一本youtube的构架PDF 貌似是在sohu的书库  当时我就震精了  偌大一个项目 只有4个engineer 其中哥们 活着只做两件事 一是写代码 二就是烂醉 醒来继续写代码
<a href="&quot;这是一个好评论，能解决问题&quot;">有帮助</a><em>(0)</em> | <a href="&quot;这评论无法解决问题，或者模糊不清&quot;">没帮助</a><em>(0)</em> | <a href="">评论</a><em>(0)</em> | <a href="http://www.oschina.net/question/answer?question=32459&amp;answer=133259" target="_blank">引用此评论</a></p>
<ul>
<li><a href="http://my.oschina.net/cool2010" target="_blank"><img src="&quot;我是常萎&quot;" alt="我是常萎"></a></li>
</ul>
<p><a href="http://my.oschina.net/cool2010" target="_blank">我是常萎</a> 回答于 2011-11-23 21:49</p>
<p><a href="">举报</a>
太牛掰了，仅仅一年多就 每天1亿的视频点击，视频是从哪来的，都是网友上传的吗？
<strong>--- 共有 2 条评论 ---</strong></p>
<ul>
<li><a href="http://my.oschina.net/mousai" target="_blank"><img src="&quot;缪斯的情人&quot;" alt="缪斯的情人"></a>  回复 <a href="http://my.oschina.net/yasenagat" target="_blank">@专业打酱油</a> : 我来打假：此人非嫡系，实乃“李鬼” (3个月前 by 缪斯的情人) <a href="">回复</a></li>
<li><a href="http://my.oschina.net/yasenagat" target="_blank"><img src="&quot;专业打酱油&quot;" alt="专业打酱油"></a>  <a href="http://my.oschina.net/mousai" target="_blank">@缪斯的情人</a>  (3个月前 by 专业打酱油) <a href="">回复</a></li>
</ul>
<p><a href="&quot;这是一个好评论，能解决问题&quot;">有帮助</a><em>(0)</em> | <a href="&quot;这评论无法解决问题，或者模糊不清&quot;">没帮助</a><em>(0)</em> | <a href="">评论</a><em>(2)</em> | <a href="http://www.oschina.net/question/answer?question=32459&amp;answer=133267" target="_blank">引用此评论</a></p>
<ul>
<li><a href="http://my.oschina.net/lyncn" target="_blank"><img src="&quot;笨笨熊&quot;" alt="笨笨熊"></a></li>
</ul>
<p><a href="http://my.oschina.net/lyncn" target="_blank">笨笨熊</a> 回答于 2011-12-08 16:15</p>
<p><a href="">举报</a>
牛人基本在国外
<a href="&quot;这是一个好评论，能解决问题&quot;">有帮助</a><em>(0)</em> | <a href="&quot;这评论无法解决问题，或者模糊不清&quot;">没帮助</a><em>(0)</em> | <a href="">评论</a><em>(0)</em> | <a href="http://www.oschina.net/question/answer?question=32459&amp;answer=137942" target="_blank">引用此评论</a></p>
<ul>
<li><a href="http://www.oschina.net/question/12_32459?sort=default&amp;p=1" target="_blank">1</a></li>
<li><a href="http://www.oschina.net/question/12_32459?sort=default&amp;p=2#answers" target="_blank">2</a></li>
<li><a href="http://www.oschina.net/question/12_32459?sort=default&amp;p=2#answers" target="_blank">&gt;</a></li>
</ul>
<p><a href=""><img src="&quot;非会员用户&quot;" alt="非会员用户"></a>
<a href="http://www.oschina.net/question/12_32459#answers" target="_blank">回评论顶部</a> | <a href="http://www.oschina.net/question/12_32459#top" target="_blank">回页面顶部</a></p>
<p><a href="http://www.oschina.net/action/visit/ad?id=1033" title="JPush——极光推送" target="_blank"><img src="" alt=""></a></p>
<p>有什么技术问题吗？ <a href="http://www.oschina.net/question/ask" target="_blank">我要提问</a>
<strong><a href="http://my.oschina.net/javayou/?ft=bbs&amp;scope=2&amp;showme=1" target="_blank">全部(4926)...</a><em>红薯</em>的其他问题</strong></p>
<ul>
<li><a href="http://www.oschina.net/question/12_106724" title="类似 DNSPod 智能 DNS 解析无效的一种情形" target="_blank">类似 DNSPod 智能 DNS 解析无效的一种情形</a>(3回/198阅,7天前)</li>
<li><a href="http://www.oschina.net/question/12_106555" title="Ruby 2.0 中未被提及的特性" target="_blank">Ruby 2.0 中未被提及的特性</a>(0回/129阅,8天前)</li>
<li><a href="http://www.oschina.net/question/12_106453" title="2013 第一期：OSC 深圳源创会高清无码大片放映" target="_blank">2013 第一期：OSC 深圳源创会高清无码大片放映</a>(106回/7138阅,9天前)</li>
<li><a href="http://www.oschina.net/question/12_106368" title="PostgreSQL 9.3 新特性预览 —— JSON 操作" target="_blank">PostgreSQL 9.3 新特性预览 —— JSON 操作</a>(18回/4393阅,10天前)</li>
<li><a href="http://www.oschina.net/question/12_106012" title="号召大家给 @滔哥 和 @走在路上 送上祝福" target="_blank">号召大家给 @滔哥 和 @走在路上 送上祝福</a>(35回/2014阅,12天前)</li>
</ul>
<p><strong>类似的话题</strong></p>
<ul>
<li><a href="http://www.oschina.net/question/12_1538" title="Android手机如何在国内看Youtube" target="_blank">Android手机如何在国内看Youtube</a>(9回/7770阅,3年前)</li>
</ul>
<p>© 开源中国(OsChina.NET) | <a href="http://www.oschina.net/home/about" target="_blank">关于我们</a> | <a href="mailto:oschina.net@gmail.com">广告联系</a> | <a href="http://weibo.com/oschina2010" target="_blank">@新浪微博</a> | <a href="http://m.oschina.net/" target="_blank">开源中国手机版</a> | <a href="http://www.miitbeian.gov.cn/" target="_blank">粤ICP备12009483号-3</a> 开源中国手机客户端： <a href="http://www.oschina.net/app" title="Android客户端" target="_blank">Android</a> <a href="http://www.oschina.net/app" title="iPhone 客户端" target="_blank">iPhone</a> <a href="http://www.oschina.net/app" title="Windows Phone 客户端" target="_blank">WP7</a></p>
<p><a href=""></a><a href=""></a><a href=""></a>
<img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/架构师/">架构师</a></li></span></span> | <span class="tags">Tagged <a href="/tags/架构师/" class="label label-primary">架构师</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:28"datetime="2014-03-07 09:54:28"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-架构师--YouTube架构学习体会-开源中国OSChinaNET/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-架构师--YouTube架构学习体会-开源中国OSChinaNET" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/149/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/147/">147</a></li><li><a class="page-number" href="/page/148/">148</a></li><li><a class="page-number" href="/page/149/">149</a></li><li class="active"><li><span class="page-number current">150</span></li><li><a class="page-number" href="/page/151/">151</a></li><li><a class="page-number" href="/page/152/">152</a></li><li><a class="page-number" href="/page/153/">153</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/161/">161</a></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="extend next" href="/page/151/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-04-07 19:05:47</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
