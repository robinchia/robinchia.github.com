
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 150 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-架构师-架构--Twitter架构图cache篇–Tim后端技术/">Twitter架构图(cache篇) – Tim[后端技术]</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-架构师-架构--Twitter架构图cache篇–Tim后端技术/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="twitter-cache-tim-">Twitter架构图(cache篇) – Tim[后端技术]</h1>
<h1 id="-tim-http-timyang-net-home-"><a href="http://timyang.net/" title="Home" target="_blank">Tim[后端技术]</a></h1>
<p>Tim&#39;s blog, 关于后端架构、互联网技术、分布式、大型网络应用、NoSQL、技术感悟等</p>
<p><a href="http://timyang.net/" target="_blank">Home</a> | <a href="http://timyang.net/about/" target="_blank">About</a> | <a href="http://timyang.net/tag/English/" target="_blank">English version</a> | <a href="http://timyang.net/about/#comment" target="_blank">留言(Guestbook)</a> | <a href="http://timyang.net/feed/" target="_blank"><img src="" alt=""></a><a href="http://timyang.net/feed/" target="_blank">订阅RSS</a> <a href="http://fusion.google.com/add?source=atgs&amp;feedurl=http%3A//timyang.net/feed/" target="_blank"><img src="" alt="Add to Google"></a></p>
<ul>
<li></li>
<li><p>Email: <img src="" alt=""></p>
</li>
<li><h3 id="similar-posts">Similar Posts</h3>
</li>
<li><p><a href="http://timyang.net/architecture/notes-timelines-twitter/" title="May 3, 2012" target="_blank">Notes about Timelines @ Twitter</a></p>
</li>
<li><a href="http://timyang.net/tech/twitter-whale/" title="March 8, 2010" target="_blank">Twitter“鲸鱼”故障技术剖析</a></li>
<li><a href="http://timyang.net/data/mcdb-tt-redis/" title="August 11, 2009" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a></li>
<li><a href="http://timyang.net/architecture/farmville/" title="March 8, 2010" target="_blank">FarmVille(美版开心农场)谈架构:所有模块都是一个可降级的服务</a></li>
<li><p><a href="http://timyang.net/tech/twitter-operations/" title="November 2, 2009" target="_blank">Twitter系统运维经验</a></p>
</li>
<li><h3 id="most-commented">Most Commented</h3>
</li>
<li><p><a href="http://timyang.net/data/mcdb-tt-redis/" title="MemcacheDB, Tokyo Tyrant, Redis performance test" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a> (101)</p>
</li>
<li><a href="http://timyang.net/programming/c-erlang-java-performance/" title="C, Erlang, Java and Go Web Server performance test" target="_blank">C, Erlang, Java and Go Web Server performance test</a> (85)</li>
<li><a href="http://timyang.net/about/" title="About Tim Yang" target="_blank">About Tim Yang</a> (83)</li>
<li><a href="http://timyang.net/data/redis-misunderstanding/" title="Redis几个认识误区" target="_blank">Redis几个认识误区</a> (62)</li>
<li><a href="http://timyang.net/programming/memcache-mutex/" title="Memcache mutex设计模式" target="_blank">Memcache mutex设计模式</a> (47)</li>
<li><a href="http://timyang.net/architecture/microblog-design-qcon-beijing/" title="构建可扩展的微博架构(qcon beijing 2010演讲)" target="_blank">构建可扩展的微博架构(qcon beijing 2010演讲)</a> (39)</li>
<li><a href="http://timyang.net/architecture/consistent-hashing-practice/" title="某分布式应用实践一致性哈希的一些问题" target="_blank">某分布式应用实践一致性哈希的一些问题</a> (38)</li>
<li><a href="http://timyang.net/google/open-source/" title="为什么优秀开发者进入Google后就不参与开源了" target="_blank">为什么优秀开发者进入Google后就不参与开源了</a> (33)</li>
<li><a href="http://timyang.net/misc/macbook-air-productive/" title="MacBook Air与工作效率" target="_blank">MacBook Air与工作效率</a> (32)</li>
<li><p><a href="http://timyang.net/data/memcached-lru-evictions/" title="Memcached数据被踢(evictions&gt;0)现象分析" target="_blank">Memcached数据被踢(evictions&gt;0)现象分析</a> (30)</p>
</li>
<li><h3 id="recent-posts">Recent Posts</h3>
</li>
<li><p><a href="http://timyang.net/tao/speech-practice/" title="演讲小组的第一次活动" target="_blank">演讲小组的第一次活动</a></p>
</li>
<li><a href="http://timyang.net/tao/connect-the-dots/" title="“connect the dots” 随想" target="_blank">“connect the dots” 随想</a></li>
<li><a href="http://timyang.net/tao/talents/" title="跨领域人才" target="_blank">跨领域人才</a></li>
<li><a href="http://timyang.net/product/discontinued-servic/" title="产品下线杂谈" target="_blank">产品下线杂谈</a></li>
<li><a href="http://timyang.net/misc/speech/" title="当我谈演讲时候，我谈些什么" target="_blank">当我谈演讲时候，我谈些什么</a></li>
<li><a href="http://timyang.net/architecture/k/" title="案例与故障的知识库" target="_blank">案例与故障的知识库</a></li>
<li><a href="http://timyang.net/management/learning-tao/" title="团队中的为师之道" target="_blank">团队中的为师之道</a></li>
<li><a href="http://timyang.net/google/hybrid-research/" title="有感Google的混合研究方法" target="_blank">有感Google的混合研究方法</a></li>
<li><a href="http://timyang.net/management/probation/" title="谈技术人员“转正”" target="_blank">谈技术人员“转正”</a></li>
<li><a href="http://timyang.net/architecture/notes-weixin/" title="微信架构的启示" target="_blank">微信架构的启示</a></li>
<li><a href="http://timyang.net/misc/macbook-air-productive/" title="MacBook Air与工作效率" target="_blank">MacBook Air与工作效率</a></li>
<li><a href="http://timyang.net/architecture/notes-timelines-twitter/" title="Notes about Timelines @ Twitter" target="_blank">Notes about Timelines @ Twitter</a></li>
<li><a href="http://timyang.net/management/engineer-performance/" title="技术工程师的能力与目标" target="_blank">技术工程师的能力与目标</a></li>
<li><a href="http://timyang.net/management/design-review/" title="技术方案评审" target="_blank">技术方案评审</a></li>
<li><p><a href="http://timyang.net/management/planning/" title="谈技术团队目标" target="_blank">谈技术团队目标</a></p>
</li>
<li><h3 id="recent-comments">Recent Comments</h3>
</li>
<li><p><a href="http://emake.info/the-redis-several-misunderstandings.html" target="_blank">Redis几个认识误区 | 创造</a> on <a href="http://timyang.net/data/redis-misunderstanding/comment-page-2/#comment-224409" target="_blank">Redis几个认识误区</a></p>
</li>
<li><a href="http://emake.info/the-redis-several-misunderstandings.html" target="_blank">Redis几个认识误区 | 创造</a> on <a href="http://timyang.net/data/mcdb-tt-redis/comment-page-3/#comment-224408" target="_blank">MemcacheDB, Tokyo Tyrant, Redis performance test</a></li>
<li><a href="http://outofmemory.cn/" target="_blank">甄码农</a> on <a href="http://timyang.net/management/learning-tao/comment-page-1/#comment-224161" target="_blank">团队中的为师之道</a></li>
<li><a href="http://outofmemory.cn/" target="_blank">甄码农</a> on <a href="http://timyang.net/tao/talents/comment-page-1/#comment-224158" target="_blank">跨领域人才</a></li>
<li><p>阿秀 on <a href="http://timyang.net/about/comment-page-2/#comment-223584" target="_blank">About Tim Yang</a></p>
</li>
<li><h3 id="categories">Categories</h3>
</li>
<li><p><a href="http://timyang.net/category/data/" title="View all posts filed under data" target="_blank">data</a></p>
</li>
<li><a href="http://timyang.net/category/erlang/" title="Erlang语言" target="_blank">Erlang</a></li>
<li><a href="http://timyang.net/category/google/" title="View all posts filed under Google" target="_blank">Google</a></li>
<li><a href="http://timyang.net/category/java/" title="View all posts filed under Java" target="_blank">Java</a></li>
<li><a href="http://timyang.net/category/linux/" title="View all posts filed under Linux" target="_blank">Linux</a></li>
<li><a href="http://timyang.net/category/lua/" title="View all posts filed under Lua" target="_blank">Lua</a></li>
<li><a href="http://timyang.net/category/python/" title="View all posts filed under Python" target="_blank">Python</a></li>
<li><a href="http://timyang.net/category/sns/" title="View all posts filed under SNS" target="_blank">SNS</a></li>
<li><a href="http://timyang.net/category/tech/" title="View all posts filed under tech" target="_blank">tech</a></li>
<li><a href="http://timyang.net/category/web/" title="View all posts filed under Web" target="_blank">Web</a></li>
<li><a href="http://timyang.net/category/product/" title="View all posts filed under 产品" target="_blank">产品</a></li>
<li><a href="http://timyang.net/category/distributed/" title="分布式算法及思想" target="_blank">分布式</a></li>
<li><a href="http://timyang.net/category/management/" title="View all posts filed under 技术管理" target="_blank">技术管理</a></li>
<li><a href="http://timyang.net/category/architecture/" title="后端架构" target="_blank">架构</a></li>
<li><a href="http://timyang.net/category/programming/" title="View all posts filed under 编程" target="_blank">编程</a></li>
<li><a href="http://timyang.net/category/tao/" title="View all posts filed under 随想" target="_blank">随想</a></li>
<li><p><a href="http://timyang.net/category/misc/" title="非技术话题" target="_blank">非技术</a></p>
</li>
<li><h3 id="archives">Archives</h3>
</li>
<li><p><a href="http://timyang.net/2012/10/" title="October 2012" target="_blank">October 2012</a> (5)</p>
</li>
<li><a href="http://timyang.net/2012/09/" title="September 2012" target="_blank">September 2012</a> (4)</li>
<li><a href="http://timyang.net/2012/05/" title="May 2012" target="_blank">May 2012</a> (3)</li>
<li><a href="http://timyang.net/2012/02/" title="February 2012" target="_blank">February 2012</a> (3)</li>
<li><a href="http://timyang.net/2012/01/" title="January 2012" target="_blank">January 2012</a> (2)</li>
<li><a href="http://timyang.net/2011/12/" title="December 2011" target="_blank">December 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/08/" title="August 2011" target="_blank">August 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/07/" title="July 2011" target="_blank">July 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/04/" title="April 2011" target="_blank">April 2011</a> (2)</li>
<li><a href="http://timyang.net/2011/02/" title="February 2011" target="_blank">February 2011</a> (1)</li>
<li><a href="http://timyang.net/2011/01/" title="January 2011" target="_blank">January 2011</a> (2)</li>
<li><a href="http://timyang.net/2010/12/" title="December 2010" target="_blank">December 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/11/" title="November 2010" target="_blank">November 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/09/" title="September 2010" target="_blank">September 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/08/" title="August 2010" target="_blank">August 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/07/" title="July 2010" target="_blank">July 2010</a> (3)</li>
<li><a href="http://timyang.net/2010/06/" title="June 2010" target="_blank">June 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/05/" title="May 2010" target="_blank">May 2010</a> (2)</li>
<li><a href="http://timyang.net/2010/04/" title="April 2010" target="_blank">April 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/03/" title="March 2010" target="_blank">March 2010</a> (4)</li>
<li><a href="http://timyang.net/2010/02/" title="February 2010" target="_blank">February 2010</a> (1)</li>
<li><a href="http://timyang.net/2010/01/" title="January 2010" target="_blank">January 2010</a> (1)</li>
<li><a href="http://timyang.net/2009/12/" title="December 2009" target="_blank">December 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/11/" title="November 2009" target="_blank">November 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/10/" title="October 2009" target="_blank">October 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/09/" title="September 2009" target="_blank">September 2009</a> (4)</li>
<li><a href="http://timyang.net/2009/08/" title="August 2009" target="_blank">August 2009</a> (5)</li>
<li><a href="http://timyang.net/2009/07/" title="July 2009" target="_blank">July 2009</a> (6)</li>
<li><a href="http://timyang.net/2009/06/" title="June 2009" target="_blank">June 2009</a> (5)</li>
<li><a href="http://timyang.net/2009/05/" title="May 2009" target="_blank">May 2009</a> (11)</li>
<li><a href="http://timyang.net/2009/04/" title="April 2009" target="_blank">April 2009</a> (7)</li>
<li><a href="http://timyang.net/2009/03/" title="March 2009" target="_blank">March 2009</a> (3)</li>
<li><a href="http://timyang.net/2009/02/" title="February 2009" target="_blank">February 2009</a> (2)</li>
<li><a href="http://timyang.net/2009/01/" title="January 2009" target="_blank">January 2009</a> (2)</li>
<li><a href="http://timyang.net/2008/12/" title="December 2008" target="_blank">December 2008</a> (2)</li>
<li><h3 id="feeds">Feeds</h3>
</li>
<li><p><a href="http://timyang.net/feed/" target="_blank">Entries (RSS)</a></p>
</li>
<li><a href="http://timyang.net/comments/feed/" target="_blank">Comments (RSS)</a>
*</li>
</ul>
<h2 id="-twitter-cache-http-timyang-net-architecture-twitter-cache-architecture-permanent-link-to-twitter-cache-"><a href="http://timyang.net/architecture/twitter-cache-architecture/" title="Permanent Link to Twitter架构图(cache篇)" target="_blank">Twitter架构图(cache篇)</a></h2>
<p>Wednesday, Oct 28th, 2009 by Tim | Tags: <a href="http://timyang.net/tag/twitter/" target="_blank">twitter</a></p>
<p>根据网上公开资料整理的Twitter架构，主要是cache方面，加了作者自己的补充，跟实际的架构未必完全一致。
<img src="&quot;twitter cache&quot;" alt="twitter cache">
一些数据：</p>
<ul>
<li>Cache分Page cache, fragment cache, row cache, vector Cache, cache命中率见图。</li>
<li>Fragment cache存放了API各种请求格式的数据，包括XML, JSON, RSS, ATOM。</li>
<li>发表Tweets是先放入Kestrel, 再异步处理，Kestrel用的也是memcached协议。</li>
<li>API requests: 550 r/s。</li>
<li>POST tweets: 峰值：平时 80tweets/s, 奥巴马就任时达到 350tweets/s。</li>
<li>Aggregator模块需要访问memcached multi get  数百个/s。</li>
<li>Ruby on Rails前面还用了Varnish作前端反向代理。</li>
</ul>
<p>参考资料：</p>
<ul>
<li><a href="http://gojko.net/2009/03/16/qcon-london-2009-upgrading-twitter-without-service-disruptions/" target="_blank">QCon London 2009: Upgrading Twitter without service disruptions</a></li>
<li><a href="http://qconlondon.com/london-2009/file?path=/qcon-london-2009/slides/EvanWeaver_ImprovingRunningComponentsAtTwitter.pdf" target="_blank">Improving Running Components at Twitter</a> (PDF slide)</li>
</ul>
<h3 id="9-comments-http-timyang-net-architecture-twitter-cache-architecture-postcomment-jump-to-the-comments-form-">9 Comments <a href="http://timyang.net/architecture/twitter-cache-architecture/#postcomment" title="Jump to the comments form" target="_blank">»</a></h3>
<ol>
<li><img src="" alt="">Lee Su Min says:</li>
</ol>
<p><a href="http://timyang.net/architecture/twitter-cache-architecture/comment-page-1/#comment-2070" target="_blank">Nov 1st 2009 at 17:15</a></p>
<p>Is a blue print same as a jia gou tu?</p>
<ol>
<li><img src="" alt=""><a href="http://hi.baidu.com/crazy_computer" target="_blank">王潇</a> says:</li>
</ol>
<p><a href="http://timyang.net/architecture/twitter-cache-architecture/comment-page-1/#comment-3405" target="_blank">Mar 8th 2010 at 18:10</a></p>
<p>我是一个大三的学生，现在在学习PHP！看了您的博客，学习一下，也就只是看看表面，现在对整个的WEB体系有了一定的了解了，但是我还是不太清晰！请您指点一下，我还不清楚现在所做的东西处于什么地方，对整个系统有什么影响？我开发网站时也都没用到您所做的东西啊，究竟何时用！还有就是究竟应该按照什么线路来学习技术，请您务必指教！！！</p>
<ol>
<li><img src="" alt=""><a href="http://blog.chinaunix.net/u2/84280" target="_blank">遥方</a> says:</li>
</ol>
<p><a href="http://timyang.net/architecture/twitter-cache-architecture/comment-page-1/#comment-4367" target="_blank">Jun 25th 2010 at 16:42</a></p>
<p>博主能力很强。向你学习</p>
<ol>
<li><img src="" alt=""><a href="http://www.wangdacuo.com/" target="_blank">小黑</a> says:</li>
</ol>
<p><a href="http://timyang.net/architecture/twitter-cache-architecture/comment-page-1/#comment-4940" target="_blank">Sep 11th 2010 at 22:25</a></p>
<p>请问像这样实时性强、数据量巨大的数据库应该做哪些优化和处理？</p>
<ol>
<li><img src="" alt=""><a href="http://apan.me/" target="_blank">Pan</a> says:</li>
</ol>
<p><a href="http://timyang.net/architecture/twitter-cache-architecture/comment-page-1/#comment-29611" target="_blank">May 21st 2011 at 12:50</a></p>
<p>Row Cache是否有些出入？图中Row Cache似乎是用来存储关系链的，而Evan Weaver在2009 London Qcon上的ppt中，显示Row Cache应该是用来缓存tweet正文内容的吧。<a href="http://qconlondon.com/dl/qcon-london-2009/slides/EvanWeaver_ImprovingRunningComponentsAtTwitter.pdf" target="_blank">http://qconlondon.com/dl/qcon-london-2009/slides/EvanWeaver_ImprovingRunningComponentsAtTwitter.pdf</a></p>
<ol>
<li><img src="" alt=""><a href="http://tsingroo.sinaapp.com/" target="_blank">罗青</a> says:</li>
</ol>
<p><a href="http://timyang.net/architecture/twitter-cache-architecture/comment-page-1/#comment-124260" target="_blank">Jan 17th 2012 at 12:53</a></p>
<p>我觉得除了缓存之外，数据库的表设计是最关键的部分。架构这些什么的都要依据数据库结构来设计。</p>
<ol>
<li><img src="" alt="">段见尼宜 says:</li>
</ol>
<p><a href="http://timyang.net/architecture/twitter-cache-architecture/comment-page-1/#comment-220186" target="_blank">Nov 7th 2012 at 06:43</a></p>
<p>(网站打不开请点百度快照}手机号码任意显示|号码任意显示|去电号码任意显示|来电号码任意显示|号码随意显|电话号码任意显示|手机号码随意显|电话号码随意显|
手机号码任意显示 (可以免费测试一次)
鹏诚通讯科技有限公司
24小时客服QQ：13417527</p>
<p>24小时免费咨询电话：18268787444</p>
<p>公司网址：<a href="http://www.pcwltx.com/" target="_blank">http://www.pcwltx.com/</a>
朋友,想不想让你的手机很有个性? 明明你在深圳,而你跟朋友聊天的时候,你朋友的电话上显示你在广州(上 海/天津/武汉/兰州等)以至香港. 明明你在跟朋友玩,而你打电话给你家人,让家人以为你在外地出差. 明天你不是刘德华,而你总是你用刘德华的电话号在打电话 明明你现在在内地,而你非要在你朋友面前说你在香港. 想不想拥有了?</p>
<p>专业手机，座机，小灵通等打电话发短信可以任意显示电话号码的, 此产品不需要下载任何软件,只需要绑定您的号码即可实现显示.您要对方显示什么号码!我这里免费给您测试,让您亲眼所见！不想让别人知道自己在哪里的时候，被人追踪讨债不接您电话的时候很有用出的！您只需花上几百元钱就能买到您想要的任何靓号，吉祥号！以及港澳台和国际号码，任意显示您的电话号码，随时隐藏您的号码！
本业务不会影响你本手机的使用，想使用改号业务时就拨一下我们系统的预约号码，不想使用时就直接用你手机打出还是原来的号，不会改变你手机原来的实际号码，互不干扰.</p>
<p>为防止各种违法乱纪,本软件特定设置号码规范如下：
1、出于安全考虑国家特殊号码 110 120 119等号码，不可以随意设置，
一经发现删除该帐户！
2、不可以设置各种银行，移动的客服号码（95599 10086等）一经发现删除该帐户！</p>
<p>交易方式：支持各大银行和淘宝交易.</p>
<p>1， 无须在电话（手机，小灵通，座机）上下载任何软件
2， 无月租，无长途漫游费，全国号码任意设置，任意拨打，任意显示。0.2元/分钟
3， 绑定号码无次数限制，设置显示号码无次数限制。自行操作，自己做主，
4， 开通后没有时效限制，有话费即可使用。
5， 话费没了，续费继续使用。
6， 不影响你本机号码的话费，和正常使用，两者互不干扰。
7， 双方都为接电话型式，不扣通话双方的电话（手机，小灵通，座机）话费。
8，不想使用时就直接用你手机打出还是原来的号，不会改变你手机原来的实际号码，互不干扰.
显示号码自己设置，操作方法可以手机直接操作也可以网页上操作最后都是通过自己的手机打出，
让对方显示你要的号码，本机是接回拨所以免费,显示号码自由设置
可以让你亲自测试，自己打出一个任意显示的电话。
交易方式：支持各大银行和淘宝交易.</p>
<p>24小时客服QQ：13417527</p>
<p>24小时免费咨询电话：18268781444</p>
<p>公司网址：<a href="http://www.pcwltx.com/" target="_blank">http://www.pcwltx.com/</a>
骗子各种手法介绍：不允许测试，让你直接汇款，汇款后开通。</p>
<p><a href="http://timyang.net/architecture/twitter-cache-architecture/feed/" target="_blank">RSS feed for comments on this post</a>, <a href="http://timyang.net/architecture/twitter-cache-architecture/trackback/" target="_blank">TrackBack URI</a>
<a href="http://timyang.net/architecture/twitter-cache-architecture/#respond" target="_blank">Cancel Reply</a></p>
<h3 id="leave-a-comment">Leave a Comment</h3>
<p>Name (required)</p>
<p>E-mail (required, never displayed)</p>
<p>URI</p>
<p>Except where otherwise noted, content on this site is licensed under a <a href="http://creativecommons.org/licenses/by/3.0/" target="_blank">Creative Commons Attribution 3.0</a> License</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/架构师/">架构师</a></li></span><span class="breadcrumb"><li><a href="/categories/架构师/">架构师</a></li><li><a href="/categories/架构师/架构/">架构</a></li></span></span> | <span class="tags">Tagged <a href="/tags/架构/" class="label label-primary">架构</a><a href="/tags/架构师/" class="label label-success">架构师</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-架构师-架构--Twitter架构图cache篇–Tim后端技术/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-架构师-架构--Twitter架构图cache篇–Tim后端技术" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-架构师-架构--YouTube架构学习体会-IT青藤屋-青藤园/">YouTube架构学习体会 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-架构师-架构--YouTube架构学习体会-IT青藤屋-青藤园/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="youtube-it-">YouTube架构学习体会 - IT青藤屋 - 青藤园</h1>
<p><a href="http://www.itivy.com/ivy/archive/2011/3/6/634350416046298451.html#main-copy" target="_blank">Skip to main content.</a></p>
<h1 id="-it-http-www-itivy-com-ivy-"><a href="http://www.itivy.com/ivy" target="_blank">IT青藤屋</a></h1>
<p>Article date: 关注架构、关注前端、关注生活，愿天下的程序员像常青藤一样绿意盎然、自强不息
Navigation:</p>
<ul>
<li><a href="http://www.itivy.com/" target="_blank">青藤园首页</a></li>
<li><a href="http://www.itivy.com/ivy" target="_blank">首页</a></li>
<li><a href="http://www.itivy.com/ivy/Rss" target="_blank">订阅</a></li>
<li><a href="http://www.itivy.com/MyAdmin/Post" target="_blank">写博客</a><h1 id="-">公告</h1>
</li>
</ul>
<p>今天让我感到了知识产权对作者的重要性，博客中的文章如果没有特殊说明，均为原创或者翻译，转载请注明原文出处。另外，在我博客中的一些文章，或许有意无意侵犯了您的知识产权，如果您发现了，请及时发邮件联系我，我将立即作出处理。我的邮箱：</p>
<p>sxwgf.com@gmail.com</p>
<p>谢谢！</p>
<p><a href="http://feed.feedsky.com/wangguofeng" target="_blank"><img src="" alt="feedsky"></a>
<a href="http://www.zhuaxia.com/add_channel.php?url=http://feed.feedsky.com/wangguofeng" target="_blank"><img src="" alt="抓虾"></a> <a href="http://fusion.google.com/add?feedurl=http://feed.feedsky.com/wangguofeng" target="_blank"><img src="" alt="google reader"></a> <a href="http://www.netvibes.com/subscribe.php?url=http://feed.feedsky.com/wangguofeng" target="_blank"><img src="" alt="netvibes"></a> <a href="http://www.xianguo.com/subscribe.php?url=http://feed.feedsky.com/wangguofeng" target="_blank"><img src="" alt="鲜果"></a> <a href="http://reader.youdao.com/b.do?keyfrom=feedsky&amp;url=http://feed.feedsky.com/wangguofeng" target="_blank"><img src="" alt="有道"></a> <a href="http://mail.qq.com/cgi-bin/feed?u=http://feed.feedsky.com/wangguofeng" target="_blank"><img src="" alt="QQ邮箱"></a></p>
<p>如果能成为巨人，我愿意献出肩膀
<a href="http://www.itivy.com/ivy" target="_blank">王国峰</a>       2011年毕业于     <a href="http://www.cjlu.edu.cn/">中国计量学院
</a></p>
<p><a href="http://www.cnblogs.com/sxwgf" target="_blank">我的博客园</a>     <a href="mailto:sxwgf.com@gmail.com">Email联系我</a></p>
<h1 id="-">文章分类</h1>
<ul>
<li><a href="http://www.itivy.com/ivy/rss/634334857626039072" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634334857626039072" target="_blank">网站架构 (57)</a></li>
<li><a href="http://www.itivy.com/ivy/rss/634341473485624363" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634341473485624363" target="_blank">程序人生 (46)</a></li>
<li><a href="http://www.itivy.com/ivy/rss/634344865065808132" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634344865065808132" target="_blank">Web前端 (64)</a></li>
<li><a href="http://www.itivy.com/ivy/rss/634373775058504208" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634373775058504208" target="_blank">云计算 (5)</a></li>
<li><a href="http://www.itivy.com/ivy/rss/634420334988588647" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634420334988588647" target="_blank">交互设计 (36)</a></li>
<li><a href="http://www.itivy.com/ivy/rss/634676846231486688" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634676846231486688" target="_blank">其他 (13)</a></li>
<li><a href="http://www.itivy.com/ivy/rss/634676846436695587" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634676846436695587" target="_blank">个人日记 (5)</a></li>
<li><a href="http://www.itivy.com/ivy/rss/634412348539180312" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634412348539180312" target="_blank">互联网资讯 (54)</a></li>
<li><a href="http://www.itivy.com/ivy/rss/634395014757871203" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634395014757871203" target="_blank">数据库 (5)</a></li>
<li><a href="http://www.itivy.com/ivy/rss/634428901658822055" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634428901658822055" target="_blank">Javascript游戏 (22)</a></li>
<li><a href="http://www.itivy.com/ivy/rss/634329522769715132" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634329522769715132" target="_blank">.NET技术 (23)</a></li>
<li><a href="http://www.itivy.com/ivy/rss/634329522944214971" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634329522944214971" target="_blank">jQuery插件 (35)</a></li>
<li><a href="http://www.itivy.com/ivy/rss/634331340966127746" target="_blank">(rss)</a><a href="http://www.itivy.com/ivy/category/634331340966127746" target="_blank">设计模式 (4)</a><h1 id="-">搜索</h1>
</li>
</ul>
<h1 id="-">文章归档</h1>
<ul>
<li><a href="http://www.itivy.com/ivy/archive/2012/4" target="_blank">2012年4月 (1)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/3" target="_blank">2012年3月 (6)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/2" target="_blank">2012年2月 (12)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/1" target="_blank">2012年1月 (21)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/12" target="_blank">2011年12月 (19)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/11" target="_blank">2011年11月 (38)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/10" target="_blank">2011年10月 (29)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/9" target="_blank">2011年9月 (18)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/8" target="_blank">2011年8月 (36)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/7" target="_blank">2011年7月 (38)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/6" target="_blank">2011年6月 (69)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/5" target="_blank">2011年5月 (28)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/4" target="_blank">2011年4月 (14)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/3" target="_blank">2011年3月 (36)</a></li>
<li><p><a href="http://www.itivy.com/ivy/archive/2011/2" target="_blank">2011年2月 (26)</a></p>
<h1 id="-">最新评论</h1>
</li>
<li><p><a href="http://www.itivy.com/ivy/archive/2012/3/21/talk-about-cookie-security.html#635024174735802860" target="_blank">COOKIES如今很多浏览器都比较讨厌。</a></p>
</li>
<li><a href="http://www.itivy.com/ivy/archive/2012/3/29/jquery-rotate3di-3d-rotate.html#635024172890545000" target="_blank">这个效果还是不错的，比较适合一些大的文章站。</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/6/4/jquery-flot-chinese-doc.html#635019834501840539" target="_blank">很好的东西，正在看</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/1/16/css-shape.html#635013628113327522" target="_blank">果断收藏</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/3/29/jquery-rotate3di-3d-rotate.html#635005778757226060" target="_blank">我以为你说的是rotate3Di的原理呢。。。</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/2/18/image-storage-cache-1.html#635005777013789343" target="_blank">还有就是用又拍云存储或者阿里云的话可以提升各地用户访问的速度</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/2/18/image-storage-cache-1.html#635005775941923653" target="_blank">图片服务器和web服务器分离还有一个好处就是用户上传的带有代...</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/6/4/jquery-flot-chinese-doc.html#635005773508750000" target="_blank">博主翻译的真辛苦！</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/1/4/flash-js-css-nav.html#635000165409091711" target="_blank">这个滑动菜单有个BUG，index.html中&lt;ahe...</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/3/18/gogo6-ipv6.html#634980862642912518" target="_blank">我怎么连接失败呢  </a></li>
</ul>
<h1 id="-">阅读排行</h1>
<ul>
<li><a href="http://www.itivy.com/ivy/archive/2011/3/7/634351294385186067.html" target="_blank">Flickr 网站架构分析(12957)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/3/18/gogo6-ipv6.html" target="_blank">我是如何用IPV6快速“翻墙”的(12156)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/3/7/634351257301504864.html" target="_blank">回顾MySpace架构的坎坷之路(11723)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/8/13/the-architecture-of-youku.html" target="_blank">优酷网架构学习笔记(10581)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/3/5/634349627089221280.html" target="_blank">PlentyOfFish.com .NET网站的又一传奇(8971)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/6/4/best-10-flash-website-of-2011.html" target="_blank">分享10个2011最佳flash网站(8533)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/2/26/634343492754434530.html" target="_blank">30个基于jQuery的日期时间选择插件(8475)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/2/24/634341508379645903.html" target="_blank">45个非常漂亮的jQuery导航插件(7540)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/6/4/jquery-flot-chinese-doc.html" target="_blank">jQuery图表插件Flot中文文档(7136)</a></li>
<li><p><a href="http://www.itivy.com/ivy/archive/2012/1/16/css-shape.html" target="_blank">纯CSS画的基本图形（矩形、圆形、三角形、多边形、爱心、八卦等），NB么(6932)</a></p>
<h1 id="-">评论排行</h1>
</li>
<li><p><a href="http://www.itivy.com/ivy/archive/2011/11/25/how-i-become-a-programmer-in-12-weeks.html" target="_blank">我是如何在12周内由零基础成为一名程序员的(22)</a></p>
</li>
<li><a href="http://www.itivy.com/ivy/archive/2011/3/1/634345857534732714.html" target="_blank">漫画：为什么搞计算机工作的人总是看上去很清闲(10)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/3/7/634351294385186067.html" target="_blank">Flickr 网站架构分析(8)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/12/25/just-love-you.html" target="_blank">因为喜欢，仅此而已(8)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/8/13/the-architecture-of-youku.html" target="_blank">优酷网架构学习笔记(7)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/12/21/let-us-fk-csdn-together.html" target="_blank">我们是该告CSDN还是FK了CSDN？(7)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/3/12/where-is-our-copyright-in-china.html" target="_blank">在中国，我们的知识产权真的陨落了吗？(7)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/2/16/image-storage-1.html" target="_blank">图片存储架构学习：独立的图片服务器，给爱一个独立的空间(6)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2011/8/17/the-20-jquery-table-plugins.html" target="_blank">20个jquery表格插件(5)</a></li>
<li><a href="http://www.itivy.com/ivy/archive/2012/1/16/css-shape.html" target="_blank">纯CSS画的基本图形（矩形、圆形、三角形、多边形、爱心、八卦等），NB么(5)</a></li>
</ul>
<h1 id="-">我的书屋</h1>
<p><a href="http://www.ppurl.com/2010/02/clr-via-csharp-third-edition.html" target="_blank"><img src="" alt=""></a>        <a href="http://www.ppurl.com/2010/08/rework.html" target="_blank"><img src="" alt=""></a></p>
<h1 id="-">友情链接</h1>
<ul>
<li><a href="http://www.itivy.com/klvoek" target="_blank">klvoek（温金鹿）</a></li>
<li><a href="http://ninofocus.com/" target="_blank">NinoFocus（倪朱国）</a></li>
<li><a href="http://www.itivy.com/android" target="_blank">Android Studio</a></li>
<li><a href="http://www.itivy.com/jquery" target="_blank">jQuery资源宝库</a></li>
<li><a href="http://www.itivy.com/php" target="_blank">php开发园地</a></li>
<li><a href="http://www.ppurl.com/" target="_blank">皮皮书屋（一个很好的电子书网站）</a></li>
<li><a href="http://zazhi.itivy.com/android" target="_blank">Android开发者</a></li>
</ul>
<h1 id="-youtube-"><a href="">YouTube架构学习体会</a></h1>
<p>这几天一直在关注和学习一些大型网站的架构，希望有一天自己也能设计一个高并发、高容错的系统并能应用在实践上。今天在网上找架构相关的资料时，看到一个被和谐的视频网站YouTube的架构分析，看了以后觉得自己又向架构走近了一步，于是赶快拿出来与大家一起分享。</p>
<p>YouTube发展迅速，每天超过1亿的视频点击量，但只有很少人在维护站点和确保伸缩性。这点和PlentyOfFish类似，少数人维护庞大系统。是什么原因呢？放心绝对不是靠人品，也不是靠寂寞，下面就来看看YouTube的整体技术架构吧。</p>
<p><strong>平台</strong></p>
<hr>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
<strong>Apache</p>
<p>Python
Linux(SuSe)</p>
<p>MySQL
psyco，一个动态的Python到C的编译器</p>
<p>lighttpd代替Apache做视频查看</strong></p>
<p><strong>状态</strong></p>
<hr>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
<strong>支持每天超过1亿的视频点击量</p>
<p>成立于2005年2月
于2006年3月达到每天3千万的视频点击量</p>
<p>于2006年7月达到每天1亿的视频点击量
2个系统管理员，2个伸缩性软件架构师</p>
<p>2个软件开发工程师，2个网络工程师，1个DBA</strong></p>
<p><strong>Web服务器</strong></p>
<hr>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15<strong>1，NetScaler用于负载均衡和静态内容缓存</p>
<p>2，使用mod_fast_cgi运行Apache
3，使用一个Python应用服务器来处理请求的路由</p>
<p>4，应用服务器与多个数据库和其他信息源交互来获取数据和格式化html页面
5，一般可以通过添加更多的机器来在Web层提高伸缩性</p>
<p>6，Python的Web层代码通常不是性能瓶颈，大部分时间阻塞在RPC
7，Python允许快速而灵活的开发和部署</p>
<p>8，通常每个页面服务少于100毫秒的时间
9，使用psyco(一个类似于JIT编译器的动态的Python到C的编译器)来优化内部循环</p>
<p>10，对于像加密等密集型CPU活动，使用C扩展
11，对于一些开销昂贵的块使用预先生成并缓存的html</p>
<p>12，数据库里使用行级缓存
13，缓存完整的Python对象</p>
<p>14，有些数据被计算出来并发送给各个程序，所以这些值缓存在本地内存中。这是个使用不当的策略。</p>
<p>应用服务器里最快的缓存将预先计算的值发送给所有服务器也花不了多少时间。只需弄一个代理来监听更改，预计算，然后发送。</strong></p>
<p><strong>视频服务</strong></p>
<hr>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
<strong>1，花费包括带宽，硬件和能源消耗</p>
<p>2，每个视频由一个迷你集群来host，每个视频被超过一台机器持有
3，使用一个集群意味着：</p>
<p>-更多的硬盘来持有内容意味着更快的速度</p>
<p>-failover。如果一台机器出故障了，另外的机器可以继续服务</p>
<p>-在线备份
4，使用lighttpd作为Web服务器来提供视频服务：</p>
<p>-Apache开销太大</p>
<p>-使用epoll来等待多个fds</p>
<p>-从单进程配置转变为多进程配置来处理更多的连接
5，大部分流行的内容移到CDN：</p>
<p>-CDN在多个地方备份内容，这样内容离用户更近的机会就会更高</p>
<p>-CDN机器经常内存不足，因为内容太流行以致很少有内容进出内存的颠簸</p>
<p>6，不太流行的内容(每天1-20浏览次数)在许多colo站点使用YouTube服务器</p>
<p>-长尾效应。一个视频可以有多个播放，但是许多视频正在播放。随机硬盘块被访问</p>
<p>-在这种情况下缓存不会很好，所以花钱在更多的缓存上可能没太大意义。</p>
<p>-调节RAID控制并注意其他低级问题</p>
<p>-调节每台机器上的内存，不要太多也不要太少 </strong></p>
<p><strong>视频服务关键点</strong></p>
<p>1</p>
<p>2
3</p>
<p>4
51，保持简单和廉价</p>
<p>2，保持简单网络路径，在内容和用户间不要有太多设备
3，使用常用硬件，昂贵的硬件很难找到帮助文档</p>
<p>4，使用简单而常见的工具，使用构建在Linux里或之上的大部分工具
5，很好的处理随机查找(SATA，tweaks)缩略图服务</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
171，做到高效令人惊奇的难</p>
<p>2，每个视频大概4张缩略图，所以缩略图比视频多很多
3，缩略图仅仅host在几个机器上</p>
<p>4，持有一些小东西所遇到的问题：</p>
<p>-OS级别的大量的硬盘查找和inode和页面缓存问题</p>
<p>-单目录文件限制，特别是Ext3，后来移到多分层的结构。内核2.6的最近改进可能让 Ext3允许大目录，但在一个文件系统里存储大量文件不是个好主意</p>
<p>-每秒大量的请求，因为Web页面可能在页面上显示60个缩略图</p>
<p>-在这种高负载下Apache表现的非常糟糕</p>
<p>-在Apache前端使用squid，这种方式工作了一段时间，但是由于负载继续增加而以失败告终。它让每秒300个请求变为20个</p>
<p>-尝试使用lighttpd但是由于使用单线程它陷于困境。遇到多进程的问题，因为它们各自保持自己单独的缓存</p>
<p>-如此多的图片以致一台新机器只能接管24小时</p>
<p>-重启机器需要6-10小时来缓存
5，为了解决所有这些问题YouTube开始使用Google的BigTable，一个分布式数据存储：</p>
<p>-避免小文件问题，因为它将文件收集到一起</p>
<p>-快，错误容忍</p>
<p>-更低的延迟，因为它使用分布式多级缓存，该缓存与多个不同collocation站点工作</p>
<p>-更多信息参考Google Architecture，GoogleTalk Architecture和BigTable</p>
<p>数据库</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
171，早期</p>
<p>-使用MySQL来存储元数据，如用户，tags和描述</p>
<p>-使用一整个10硬盘的RAID 10来存储数据</p>
<p>-依赖于信用卡所以YouTube租用硬件</p>
<p>-YouTube经过一个常见的革命：单服务器，然后单master和多read slaves，然后数据库分区，然后sharding方式</p>
<p>-痛苦与备份延迟。master数据库是多线程的并且运行在一个大机器上所以它可以处理许多工作，slaves是单线程的并且通常运行在小一些的服务器上并且备份是异步的，所以slaves会远远落后于master</p>
<p>-更新引起缓存失效，硬盘的慢I/O导致慢备份</p>
<p>-使用备份架构需要花费大量的money来获得增加的写性能</p>
<p>-YouTube的一个解决方案是通过把数据分成两个集群来将传输分出优先次序：一个视频查看池和一个一般的集群</p>
<p>2，后期</p>
<p>-数据库分区</p>
<p>-分成shards，不同的用户指定到不同的shards</p>
<p>-扩散读写</p>
<p>-更好的缓存位置意味着更少的IO</p>
<p>-导致硬件减少30%</p>
<p>-备份延迟降低到0</p>
<p>-现在可以任意提升数据库的伸缩性数据中心策略</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
1，依赖于信用卡，所以最初只能使用受管主机提供商</p>
<p>2，受管主机提供商不能提供伸缩性，不能控制硬件或使用良好的网络协议
3，YouTube改为使用colocation arrangement。现在YouTube可以自定义所有东西并且协定自己的契约</p>
<p>4，使用5到6个数据中心加CDN
5，视频来自任意的数据中心，不是最近的匹配或其他什么。如果一个视频足够流行则移到CDN</p>
<p>6，依赖于视频带宽而不是真正的延迟。可以来自任何colo
7，图片延迟很严重，特别是当一个页面有60张图片时</p>
<p>8，使用BigTable将图片备份到不同的数据中心，代码查看谁是最近的学到的东西</p>
<p>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
111，Stall for time。创造性和风险性的技巧让你在短期内解决问题而同时你会发现长期的解决方案</p>
<p>2，Proioritize。找出你的服务中核心的东西并对你的资源分出优先级别
3，Pick your battles。别怕将你的核心服务分出去。YouTube使用CDN来分布它们最流行的内容。创建自己的网络将花费太多时间和太多money</p>
<p>4，Keep it simple！简单允许你更快的重新架构来回应问题
5，Shard。Sharding帮助隔离存储，CPU，内存和IO，不仅仅是获得更多的写性能</p>
<p>6，Constant iteration on bottlenecks：</p>
<p>-软件：DB，缓存</p>
<p>-OS：硬盘I/O</p>
<p>-硬件：内存，RAID</p>
<p>7，You succeed as a team。拥有一个跨越条律的了解整个系统并知道系统内部是什么样的团队，如安装打印机，安装机器，安装网络等等的人。</p>
<p>With a good team all things are possible。</p>
<p>分享到： <a href="&quot;分享到QQ空间&quot;">QQ空间</a> <a href="&quot;分享到新浪微博&quot;">新浪微博</a> <a href="&quot;分享到人人网&quot;">人人网</a> <a href="http://www.jiathis.com/share/" target="_blank">更多</a> <a href="">6</a>
标签： <a href="http://www.itivy.com/ivy/search?keyword=%e9%ab%98%e6%80%a7%e8%83%bd" target="_blank">高性能</a>, <a href="http://www.itivy.com/ivy/search?keyword=%e6%9e%b6%e6%9e%84" target="_blank">架构</a>, <a href="http://www.itivy.com/ivy/search?keyword=YouTube" target="_blank">YouTube</a>, <a href="http://www.itivy.com/ivy/search?keyword=%e8%a7%86%e9%a2%91" target="_blank">视频</a></p>
<p>Posted by <a href="http://www.itivy.com/ivy" target="_blank">ivy</a> @ 2011-3-6 20:53:24 <a href="">阅读</a>(6410) <a href="http://www.itivy.com/ivy/archive/2011/3/6/634350416046298451.html#comment" target="_blank">评论</a>(2)
上一篇：<a href="http://www.itivy.com/ivy/archive/2011/3/6/634350387821952102.html" target="_blank">【IE6.0 Bug总结之二】双倍边距(margin)的bug</a>
下一篇：<a href="http://www.itivy.com/ivy/archive/2011/3/7/634351127072679482.html" target="_blank">WikiPedia技术架构学习笔记</a></p>
<h3 id="feedback">Feedback</h3>
<ol>
<li><a href="">回复</a>  2011-10-28 14:45:36 by <a href="http://www.oustudy.com/" target="_blank">pc</a>
牛</li>
<li><a href="">回复</a>  2013-1-24 14:43:45 by <a href="http://www.bbkongs.com/" target="_blank">Godaddy 优惠码</a>
没图片看不懂啊
你还可以输入<em>600</em>/600个字符  发表评论</li>
</ol>
<p>称呼： (必填) <a href="http://passport.itivy.com/common/login?ReturnUrl=http%3a%2f%2fwww.itivy.com%2fivy%2farchive%2f2011%2f3%2f6%2f634350416046298451.html" target="_blank">登录</a> | <a href="http://passport.itivy.com/common/register" target="_blank">开通博客</a>
邮箱： (选填) 你的邮箱地址不会被公开</p>
<p>网站： (选填)
<a href="&quot;字体&quot;"></a><a href="&quot;文字大小&quot;"></a><a href="&quot;文字颜色&quot;"></a><a href="&quot;文字背景&quot;"></a><a href="&quot;粗体(Ctrl+B"></a>&quot;)<a href="&quot;斜体(Ctrl+I"></a>&quot;)<a href="&quot;下划线(Ctrl+U"></a>&quot;)<a href="&quot;删除格式&quot;"></a><a href="&quot;左对齐&quot;"></a><a href="&quot;居中&quot;"></a><a href="&quot;右对齐&quot;"></a><a href="&quot;编号&quot;"></a><a href="&quot;项目符号&quot;"></a><a href="&quot;插入表情&quot;"></a><a href="&quot;图片&quot;"></a><a href="&quot;超级链接&quot;"></a><a href="&quot;取消超级链接&quot;"></a></p>
<p>验证码： (必填)
<img src="" alt="看不清换一张"> <a href="">看不清楚换一张</a></p>
<p>Copyright © <a href="http://www.itivy.com/ivy" target="_blank">ivy</a> 2011 . Powered by 青藤园
Courtesy of <a href="http://www.openwebdesign.org/" target="_blank">Open Web Design</a> &amp; <a href="http://www.dubaiapartments.biz/hotels/" target="_blank">Hotels - Dubai</a>
<a href="http://tongji.baidu.com/hm-web/welcome/ico?s=add0db9dee36c7a9b64141788e26de72" target="_blank"><img src="" alt=""></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/架构师/">架构师</a></li></span><span class="breadcrumb"><li><a href="/categories/架构师/">架构师</a></li><li><a href="/categories/架构师/架构/">架构</a></li></span></span> | <span class="tags">Tagged <a href="/tags/架构/" class="label label-primary">架构</a><a href="/tags/架构师/" class="label label-success">架构师</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-架构师-架构--YouTube架构学习体会-IT青藤屋-青藤园/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-架构师-架构--YouTube架构学习体会-IT青藤屋-青藤园" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--IbatisSqlExecutorexecuteQuery/">Ibatis SqlExecutor.executeQuery</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--IbatisSqlExecutorexecuteQuery/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="ibatis-sqlexecutor-executequery">Ibatis SqlExecutor.executeQuery</h1>
<h1 id="-"><a href="">小猫的窝棚</a></h1>
<h1 id="-">#</h1>
<ul>
<li><a href=""><img src="" alt="">目录视图</a></li>
<li><a href=""><img src="" alt="">摘要视图</a></li>
<li><a href=""><img src="" alt="">订阅</a>
<a href="http://blog.csdn.net/csdnproduct/article/details/6692206" target="_blank">公告：新版下载频道介绍之二——上传和下载资源页面介绍</a>                 <a href="http://g.csdn.net/5193964" target="_blank">bShare分享，迅速提升10倍流量</a></li>
</ul>
<h3 id="-ibatis-sqlexecutor-executequery-zz-ibatis-sqlexecutor-executequery-zz-"><a href="&quot;Ibatis SqlExecutor.executeQuery(ZZ">Ibatis SqlExecutor.executeQuery(ZZ)</a>&quot;)</h3>
<p>分类： <a href="">Java</a>  2008-07-28 10:37 688人阅读 <a href="">评论</a>(1) <a href="&quot;收藏&quot;">收藏</a> <a href="&quot;举报&quot;">举报</a></p>
<p>一直以来ibatis的分页都是通过滚动ResultSet实现的，应该算是逻辑分页吧。逻辑分页虽然能很干净地独立于特定数据库，但效率在多数情况下不及特定数据库支持的物理分页，而hibernate的分页则是直接组装sql，充分利用了特定数据库的分页机制，效率相对较高。本文讲述的就是如何在不重新编译ibatis源码的前提下，为ibatis引入hibernate式的物理分页机制。 基本思路就是找到ibatis执行sql的地方，截获sql并重新组装sql。通过分析ibatis源码知道，最终负责执行sql的类是com.ibatis.sqlmap.engine.execution.SqlExecutor，此类没有实现任何接口，这多少有点遗憾，因为接口是相对稳定契约，非大的版本更新，接口一般是不会变的，而类就相对易变一些，所以这里的代码只能保证对当前版本（2.1.7）的ibatis有效。下面是SqlExecutor执行查询的方法： //<em>/</em> /<em> Long form of the method to execute a query /</em> /<em> @param request - the request scope /</em> @param conn - the database connection /<em> @param sql - the SQL statement to execute /</em> @param parameters - the parameters for the statement /<em> @param skipResults - the number of results to skip /</em> @param maxResults - the maximum number of results to return /<em> @param callback - the row handler for the query /</em> /<em> @throws SQLException - if the query fails /</em>/ public void executeQuery(RequestScope request, Connection conn, String sql, Object[] parameters, int skipResults, int maxResults, RowHandlerCallback callback) throws SQLException { ErrorContext errorContext = request.getErrorContext(); errorContext.setActivity(&quot;executing query&quot;); errorContext.setObjectId(sql); PreparedStatement ps = null; ResultSet rs = null; try { errorContext.setMoreInfo(&quot;Check the SQL Statement (preparation failed).&quot;); Integer rsType = request.getStatement().getResultSetType(); if (rsType != null) { ps = conn.prepareStatement(sql, rsType.intValue(), ResultSet.CONCUR_READ_ONLY); } else { ps = conn.prepareStatement(sql); } Integer fetchSize = request.getStatement().getFetchSize(); if (fetchSize != null) { ps.setFetchSize(fetchSize.intValue()); } errorContext.setMoreInfo(&quot;Check the parameters (set parameters failed).&quot;); request.getParameterMap().setParameters(request, ps, parameters); errorContext.setMoreInfo(&quot;Check the statement (query failed).&quot;); ps.execute(); rs = getFirstResultSet(ps); if (rs != null) { errorContext.setMoreInfo(&quot;Check the results (failed to retrieve results).&quot;); handleResults(request, rs, skipResults, maxResults, callback); } // clear out remaining results while (ps.getMoreResults()); } finally { try { closeResultSet(rs); } finally { closeStatement(ps); } } } 其中handleResults(request, rs, skipResults, maxResults, callback)一句用于处理分页，其实此时查询已经执行完毕，可以不必关心handleResults方法，但为清楚起见，下面来看看handleResults的实现： private void handleResults(RequestScope request, ResultSet rs, int skipResults, int maxResults, RowHandlerCallback callback) throws SQLException { try { request.setResultSet(rs); ResultMap resultMap = request.getResultMap(); if (resultMap != null) { // Skip Results if (rs.getType() != ResultSet.TYPE_FORWARD_ONLY) { if (skipResults &gt; 0) { rs.absolute(skipResults); } } else { for (int i = 0; i &lt; skipResults; i++) { if (!rs.next()) { break; } } } // Get Results int resultsFetched = 0; while ((maxResults == SqlExecutor.NO_MAXIMUM_RESULTS || resultsFetched &lt; maxResults) &amp;&amp; rs.next()) { Object[] columnValues = resultMap.resolveSubMap(request, rs).getResults(request, rs); callback.handleResultObject(request, columnValues, rs); resultsFetched++; } } } finally { request.setResultSet(null); } } 此处优先使用的是ResultSet的absolute方法定位记录，是否支持absolute取决于具体数据库驱动，但一般当前版本的数据库都支持该方法，如果不支持则逐条跳过前面的记录。由此可以看出如果数据库支持absolute，则ibatis内置的分页策略与特定数据库的物理分页效率差距就在于物理分页查询与不分页查询在数据库中的执行效率的差距了。因为查询执行后读取数据前数据库并未把结果全部返回到内存，所以本身在存储占用上应该差距不大，如果都使用索引，估计执行速度也差不太多。 继续我们的话题。其实只要在executeQuery执行前组装sql，然后将其传给executeQuery，并告诉handleResults我们不需要逻辑分页即可。拦截executeQuery可以采用aop动态实现，也可直接继承SqlExecutor覆盖executeQuery来静态地实现，相比之下后者要简单许多，而且由于SqlExecutor没有实现任何接口，比较易变，动态拦截反到增加了维护的工作量，所以我们下面来覆盖executeQuery： package com.aladdin.dao.ibatis.ext; import java.sql.Connection; import java.sql.SQLException; import org.apache.commons.logging.Log; import org.apache.commons.logging.LogFactory; import com.aladdin.dao.dialect.Dialect; import com.ibatis.sqlmap.engine.execution.SqlExecutor; import com.ibatis.sqlmap.engine.mapping.statement.RowHandlerCallback; import com.ibatis.sqlmap.engine.scope.RequestScope; public class LimitSqlExecutor extends SqlExecutor { private static final Log logger = LogFactory.getLog(LimitSqlExecutor.class); private Dialect dialect; private boolean enableLimit = true; public Dialect getDialect() { return dialect; } public void setDialect(Dialect dialect) { this.dialect = dialect; } public boolean isEnableLimit() { return enableLimit; } public void setEnableLimit(boolean enableLimit) { this.enableLimit = enableLimit; } @Override public void executeQuery(RequestScope request, Connection conn, String sql, Object[] parameters, int skipResults, int maxResults, RowHandlerCallback callback) throws SQLException { if ((skipResults != NO_SKIPPED_RESULTS || maxResults != NO_MAXIMUM_RESULTS) &amp;&amp; supportsLimit()) { sql = dialect.getLimitString(sql, skipResults, maxResults); if(logger.isDebugEnabled()){ logger.debug(sql); } skipResults = NO_SKIPPED_RESULTS; maxResults = NO_MAXIMUM_RESULTS; } super.executeQuery(request, conn, sql, parameters, skipResults, maxResults, callback); } public boolean supportsLimit() { if (enableLimit &amp;&amp; dialect != null) { return dialect.supportsLimit(); } return false; } } 其中： skipResults = NO_SKIPPED_RESULTS; maxResults = NO_MAXIMUM_RESULTS; 告诉handleResults不分页（我们组装的sql已经使查询结果是分页后的结果了），此处引入了类似hibenate中的数据库方言接口Dialect，其代码如下： package com.aladdin.dao.dialect; public interface Dialect { public boolean supportsLimit(); public String getLimitString(String sql, boolean hasOffset); public String getLimitString(String sql, int offset, int limit); } 下面为Dialect接口的MySQL实现： package com.aladdin.dao.dialect; public class MySQLDialect implements Dialect { protected static final String SQL_END_DELIMITER = &quot;;&quot;; public String getLimitString(String sql, boolean hasOffset) { return new StringBuffer(sql.length() + 20).append(trim(sql)).append( hasOffset ? &quot; limit ?,?&quot; : &quot; limit ?&quot;) .append(SQL_END_DELIMITER).toString(); } public String getLimitString(String sql, int offset, int limit) { sql = trim(sql); StringBuffer sb = new StringBuffer(sql.length() + 20); sb.append(sql); if (offset &gt; 0) { sb.append(&quot; limit &quot;).append(offset).append(&#39;,&#39;).append(limit) .append(SQL_END_DELIMITER); } else { sb.append(&quot; limit &quot;).append(limit).append(SQL_END_DELIMITER); } return sb.toString(); } public boolean supportsLimit() { return true; } private String trim(String sql) { sql = sql.trim(); if (sql.endsWith(SQL_END_DELIMITER)) { sql = sql.substring(0, sql.length() - 1 - SQL_END_DELIMITER.length()); } return sql; } } 接下来的工作就是把LimitSqlExecutor注入ibatis中。我们是通过spring来使用ibatis的，所以在我们的dao基类中执行注入，代码如下： package com.aladdin.dao.ibatis; import java.io.Serializable; import java.util.List; import org.springframework.orm.ObjectRetrievalFailureException; import org.springframework.orm.ibatis.support.SqlMapClientDaoSupport; import com.aladdin.dao.ibatis.ext.LimitSqlExecutor; import com.aladdin.domain.BaseObject; import com.aladdin.util.ReflectUtil; import com.ibatis.sqlmap.client.SqlMapClient; import com.ibatis.sqlmap.engine.execution.SqlExecutor; import com.ibatis.sqlmap.engine.impl.ExtendedSqlMapClient; public abstract class BaseDaoiBatis extends SqlMapClientDaoSupport { private SqlExecutor sqlExecutor; public SqlExecutor getSqlExecutor() { return sqlExecutor; } public void setSqlExecutor(SqlExecutor sqlExecutor) { this.sqlExecutor = sqlExecutor; } public void setEnableLimit(boolean enableLimit) { if (sqlExecutor instanceof LimitSqlExecutor) { ((LimitSqlExecutor) sqlExecutor).setEnableLimit(enableLimit); } } public void initialize() throws Exception { if (sqlExecutor != null) { SqlMapClient sqlMapClient = getSqlMapClientTemplate() .getSqlMapClient(); if (sqlMapClient instanceof ExtendedSqlMapClient) { ReflectUtil.setFieldValue(((ExtendedSqlMapClient) sqlMapClient) .getDelegate(), &quot;sqlExecutor&quot;, SqlExecutor.class, sqlExecutor); } } } ... } 其中的initialize方法执行注入，稍后会看到此方法在spring Beans 配置中指定为init-method。由于sqlExecutor是com.ibatis.sqlmap.engine.impl.ExtendedSqlMapClient的私有成员，且没有公开的set方法，所以此处通过反射绕过java的访问控制，下面是ReflectUtil的实现代码： package com.aladdin.util; import java.lang.reflect.Field; import java.lang.reflect.Method; import java.lang.reflect.Modifier; import org.apache.commons.logging.Log; import org.apache.commons.logging.LogFactory; public class ReflectUtil { private static final Log logger = LogFactory.getLog(ReflectUtil.class); public static void setFieldValue(Object target, String fname, Class ftype, Object fvalue) { if (target == null || fname == null || &quot;&quot;.equals(fname) || (fvalue != null &amp;&amp; !ftype.isAssignableFrom(fvalue.getClass()))) { return; } Class clazz = target.getClass(); try { Method method = clazz.getDeclaredMethod(&quot;set&quot; + Character.toUpperCase(fname.charAt(0)) + fname.substring(1), ftype); if (!Modifier.isPublic(method.getModifiers())) { method.setAccessible(true); } method.invoke(target, fvalue); } catch (Exception me) { if (logger.isDebugEnabled()) { logger.debug(me); } try { Field field = clazz.getDeclaredField(fname); if (!Modifier.isPublic(field.getModifiers())) { field.setAccessible(true); } field.set(target, fvalue); } catch (Exception fe) { if (logger.isDebugEnabled()) { logger.debug(fe); } } } } }<PRE></p>
<p>到此剩下的就是通过Spring将sqlExecutor注入BaseDaoiBatis中了，下面是Spring Beans配置文件： &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; <BEANS> <!-- Transaction manager for a single JDBC DataSource --> <BEAN class=org.springframework.jdbc.datasource.DataSourceTransactionManager id=transactionManager> <property name="dataSource"> <REF bean="dataSource" /> </property> </bEAN> <!-- SqlMap setup for iBATIS Database Layer --> <BEAN class=org.springframework.orm.ibatis.SqlMapClientFactoryBean id=sqlMapClient> <property name="configLocation"> <VALUE>classpath:/com/aladdin/dao/ibatis/sql-map-config.xml</vALUE> </property> <property name="dataSource"> <REF bean="dataSource" /> </property> </bEAN> <BEAN class=com.aladdin.dao.ibatis.ext.LimitSqlExecutor id=sqlExecutor> <property name="dialect"> <BEAN class=com.aladdin.dao.dialect.MySQLDialect /> </property> </bEAN> <BEAN class=com.aladdin.dao.ibatis.BaseDaoiBatis id=baseDao init-method="initialize" abstract="true"> <property name="dataSource"> <REF bean="dataSource" /> </property> <property name="sqlMapClient"> <REF bean="sqlMapClient" /> </property> <property name="sqlExecutor"> <REF bean="sqlExecutor" /> </property> </bEAN> <BEAN class=com.aladdin.dao.ibatis.UserDaoiBatis id=userDao parent="baseDao" /> <BEAN class=com.aladdin.dao.ibatis.RoleDaoiBatis id=roleDao parent="baseDao" /> <BEAN class=com.aladdin.dao.ibatis.ResourceDaoiBatis id=resourceDao parent="baseDao" /> </bEANS><PRE></p>
<p>此后就可以通过调用org.springframework.orm.ibatis.SqlMapClientTemplate的 public List queryForList(final String statementName, final Object parameterObject, final int skipResults, final int maxResults) throws DataAccessException 或 public PaginatedList queryForPaginatedList(final String statementName, final Object parameterObject, final int pageSize) throws DataAccessException 得到分页结果了。建议使用第一个方法，第二个方法返回的是PaginatedList，虽然使用简单，但是其获得指定页的数据是跨过我们的dao直接访问ibatis的，不方便统一管理。 <PRE></p>
<ul>
<li>上一篇：<a href="http://blog.csdn.net/fulianglove/article/details/2708480" target="_blank">Table的一些不常用的属性(ZZ)</a></li>
<li>下一篇：<a href="http://blog.csdn.net/fulianglove/article/details/2722784" target="_blank">海量数据库的查询优化(ZZ)</a>
查看评论<a href=""></a></li>
</ul>
<p>/* 以上用户言论只代表其个人观点，不代表CSDN网站的观点或立场</p>
<p>个人资料</p>
<p><a href="&quot;我的博客主页&quot;"><img src="" alt=""></a>
fulianglove</p>
<ul>
<li>访问：19467次</li>
<li>积分：496分</li>
<li><p>排名：第13741名</p>
</li>
<li><p>原创：22篇</p>
</li>
<li>转载：32篇</li>
<li>译文：0篇</li>
<li>评论：24条</li>
</ul>
<p>文章搜索</p>
<p><a href=""></a>
文章分类</p>
<ul>
<li><a href="http://blog.csdn.net/fulianglove/article/category/404780" target="_blank">.NET</a>(3)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/category/400749" target="_blank">Java</a>(24)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/category/417945" target="_blank">JavaScript</a>(9)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/category/403582" target="_blank">Rails/Ruby</a>(0)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/category/403569" target="_blank">Spring</a>(1)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/category/400748" target="_blank">sql</a>(5)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/category/440985" target="_blank">数据库</a>(1)</li>
</ul>
<p>文章存档</p>
<ul>
<li><a href="http://blog.csdn.net/fulianglove/article/month/2009/02" target="_blank">2009年02月</a>(1)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/month/2009/01" target="_blank">2009年01月</a>(2)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/month/2008/12" target="_blank">2008年12月</a>(2)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/month/2008/10" target="_blank">2008年10月</a>(6)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/month/2008/09" target="_blank">2008年09月</a>(5)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/month/2008/08" target="_blank">2008年08月</a>(9)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/month/2008/07" target="_blank">2008年07月</a>(10)</li>
<li><a href="http://blog.csdn.net/fulianglove/article/month/2008/06" target="_blank">2008年06月</a>(14)</li>
<li><p><a href="http://blog.csdn.net/fulianglove/article/month/2008/05" target="_blank">2008年05月</a>(5)
阅读排行</p>
</li>
<li><p><a href="&quot;sqlserver中判断表是否存在&quot;">sqlserver中判断表是否存在</a> (2489)</p>
</li>
<li><a href="&quot;js获取鼠标点击位置(很旧很旧。。。">js获取鼠标点击位置(很旧很旧。。。)</a>&quot;) (1487)</li>
<li><a href="&quot;Response下载Content－type：HTTP相应的Content类型(转贴">Response下载Content－ty...</a>&quot;) (1330)</li>
<li><a href="&quot;js利用object标签显示动态图片&quot;">js利用object标签显示动态图片</a> (1089)</li>
<li><a href="&quot;Spring+Ibatis集成 &quot;">Spring+Ibatis集成</a> (910)</li>
<li><a href="&quot;EHCache使用(收集ZZ">EHCache使用(收集ZZ)</a>&quot;) (894)</li>
<li><a href="&quot;window.print(">window.print()使用</a>使用&quot;) (808)</li>
<li><a href="&quot;JSP中文件下载(转贴">JSP中文件下载(转贴)</a> &quot;) (745)</li>
<li><a href="&quot;java LinkedList分析(ZZ">java LinkedList分析(ZZ...</a>&quot;) (690)</li>
<li><a href="&quot;Ibatis SqlExecutor.executeQuery(ZZ">Ibatis SqlExecutor.e...</a>&quot;) (687)</li>
</ul>
<p>评论排行</p>
<ul>
<li><a href="&quot;如何正确的使用Java序列化技术(转贴">如何正确的使用Java序列化技术(转贴)</a>&quot;) (5)</li>
<li><a href="&quot;Oracle,Sql Server, MySql, DB2使用sql分页(ZZ">Oracle,Sql Server, M...</a>&quot;) (4)</li>
<li><a href="&quot;js获取鼠标点击位置(很旧很旧。。。">js获取鼠标点击位置(很旧很旧。。。)</a>&quot;) (3)</li>
<li><a href="&quot;js利用object标签显示动态图片&quot;">js利用object标签显示动态图片</a> (2)</li>
<li><a href="&quot;sqlserver中判断表是否存在&quot;">sqlserver中判断表是否存在</a> (2)</li>
<li><a href="&quot;JSP中文件下载(转贴">JSP中文件下载(转贴)</a> &quot;) (2)</li>
<li><a href="&quot;重复提交解决办法&quot;">重复提交解决办法</a> (1)</li>
<li><a href="&quot;动态为表格添加行&quot;">动态为表格添加行</a> (1)</li>
<li><a href="&quot;JS 事件注册&quot;">JS 事件注册</a> (1)</li>
<li><p><a href="&quot;EHCache使用(收集ZZ">EHCache使用(收集ZZ)</a>&quot;) (1)
最新评论</p>
</li>
<li><p><a href=""></a></p>
</li>
<li><a href=""></a></li>
<li><a href=""></a></li>
<li><a href=""></a></li>
<li><a href="">不错，</a></li>
<li><a href=""></a></li>
<li><a href=""></a></li>
<li><a href=""></a></li>
<li><a href="">怎么不写了？</a></li>
<li><a href="&quot;SELECT *FROM person WHERE uid LIKE ? OR name LIKE ? limit" title=" (currentPage-1)*lineSize &quot;,&quot; lineSizemysql这样，sql2005该怎样表示啊？？？">SELECT /*FROM pe...</a></li>
</ul>
<p>.NET</p>
<ul>
<li><p><a href="http://www.cnblogs.com/abei108/archive/2006/09/12/422125.html" target="_blank">AjaxPage--Asp.Net2.0中的Callback机制</a>
JavaScript</p>
</li>
<li><p><a href="http://www.ajaxjs.com/docs/docs/" target="_blank">ExtJs</a></p>
</li>
</ul>
<p>java技术链接</p>
<ul>
<li><a href="http://scottding.blog.chinajavaworld.com/entry.jspa?id=2992" target="_blank">[Java原型数据类型在分布式Cache中的同步处理]</a></li>
<li><a href="https://www6.software.ibm.com/developerworks/cn/education/java/j-nio/tutorial/index.html" target="_blank">JAVA NIO入门</a></li>
<li><a href="http://www.w3school.com.cn/htmldom/dom_obj_object.asp" target="_blank">HTML DOM Object 对象</a></li>
<li><a href="http://dotnet.aspx.cc/ShowList.aspx?id=1&amp;page=1" target="_blank">孟宪会之精彩世界[.Net版]</a></li>
<li><a href="http://hbcui1984.javaeye.com/blog/56496" target="_blank">java读取配置文件的几种方法</a></li>
<li><a href="http://hi.baidu.com/fanyouan/blog/item/b1743e2e2e2bc5504fc226dd.html" target="_blank">HTML DOM Object 对象(2)</a></li>
<li><a href="http://www.infomall.cn/cgi-bin/mallgate/20040514/http://hedong.3322.org/archives/000333.html" target="_blank">Digester学习笔记(一)BY竹笋炒肉</a></li>
<li><a href="http://www.infomall.cn/cgi-bin/mallgate/20040514/http://hedong.3322.org/archives/000336.html" target="_blank">Digester学习笔记(二)BY竹笋炒肉</a></li>
<li><a href="http://www.infomall.cn/cgi-bin/mallgate/20040514/http://hedong.3322.org/archives/000337.html" target="_blank">Digester学习笔记(三)BY竹笋炒肉</a></li>
<li><a href="http://www.infomall.cn/cgi-bin/mallgate/20040514/http://hedong.3322.org/archives.html" target="_blank">博客文章BY竹笋炒肉</a></li>
<li><a href="http://gemini.javaeye.com/blog/163747" target="_blank">Struts处理请求全过程</a></li>
<li><a href="http://www-128.ibm.com/developerworks/cn/" target="_blank">IBM developerWorks 中国</a></li>
<li><a href="http://www.javaeye.com/topic/55844" target="_blank">利用java操作Excel文件</a></li>
<li><a href="http://www.blogjava.net/i369/articles/182041.html" target="_blank">获取Java文件路径</a></li>
<li><p><a href="http://blog.csdn.net/apicescn/archive/2007/12/04/1916551.aspx" target="_blank">Spring+Ibatis集成开发实例</a>
Protocol Buffers</p>
</li>
<li><p><a href="http://hellobmw.com/archives/protocol-buffers-based-addressbook.html" target="_blank">北极冰仔部落格--[第一个 Protocol Buffers 小程序：电话本]</a></p>
</li>
<li><a href="http://code.google.com/apis/protocolbuffers/docs/javatutorial.html" target="_blank">Protocol Buffer Basics: Java</a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/框架汇总/">框架汇总</a></li></span><span class="breadcrumb"><li><a href="/categories/框架汇总/">框架汇总</a></li><li><a href="/categories/框架汇总/ORM/">ORM</a></li><li><a href="/categories/框架汇总/ORM/ibatis/">ibatis</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ORM/" class="label label-primary">ORM</a><a href="/tags/ibatis/" class="label label-success">ibatis</a><a href="/tags/框架汇总/" class="label label-info">框架汇总</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-框架汇总-ORM-ibatis--IbatisSqlExecutorexecuteQuery/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-框架汇总-ORM-ibatis--IbatisSqlExecutorexecuteQuery" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-框架汇总-ORM-hibernate--Hibernate性能调优（转载--作者：RobbinFan）/">Hibernate性能调优（转载</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:29.000Z"> <a href="/2014/02/02/2014-02-02-框架汇总-ORM-hibernate--Hibernate性能调优（转载--作者：RobbinFan）/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="hibernate-robbin-fan-">Hibernate性能调优（转载--作者：Robbin Fan）</h1>
<hr>
<p><strong>一。**</strong>inverse = ?**</p>
<pre><code>      inverse=false(default)

                  用于单向one-to-many关联

                  parent.getChildren().add(child) // insert child

                  parent.getChildren().delete(child) // delete child

       inverse=true

                  用于双向one-to-many关联

                  child.setParent(parent); session.save(child) // insert child

                   session.delete(child)

        在分层结构的体系中

         parentDao, childDao对于CRUD的封装导致往往直接通过session接口持久化对象，而很少通过关联对象可达性
</code></pre><p><strong>二。**</strong>one-to-many<strong>**关系</strong></p>
<pre><code>            单向关系还是双向关系？

                 parent.getChildren().add(child)对集合的触及操作会导致lazy的集合初始化，在没有对集合配置二级缓存的情况下，应避免此类操作

               select /* from child where parent_id = xxx;

      性能口诀：

              1. 一般情况下避免使用单向关联，尽量使用双向关联

              2. 使用双向关联，inverse=“true”

              3. 在分层结构中通过DAO接口用session直接持久化对象，避免通过关联关系进行可达性持久化
</code></pre><p><strong>三。**</strong>many-to-one<strong>**关系</strong></p>
<pre><code>     单向many-to-one表达了外键存储方

     灵活运用many-to-one可以避免一些不必要的性能问题

     many-to-one表达的含义是：0..n : 1，many可以是0，可以是1，也可以是n，也就是说many-to-one可以表达一对多，一对一，多对一关系

      因此可以配置双向many-to-one关系，例如：

            1.   一桌四人打麻将，麻将席位和打麻将的人是什么关系？是双向many-to-one的关系
</code></pre><p><strong>四。**</strong>one-to-one**</p>
<pre><code>        通过主键进行关联

        相当于把大表拆分为多个小表

        例如把大字段单独拆分出来，以提高数据库操作的性能

        Hibernate的one-to-one似乎无法lazy，必须通过bytecode enhancement
</code></pre><p><strong>五。集合**</strong>List/Bag/Set**</p>
<pre><code>        one-to-many

           1.    List需要维护index column，不能被用于双向关联，必须inverse=“false”，被谨慎的使用在某些稀有的场合

           2.      Bag/Set语义上没有区别

           3.       我个人比较喜欢使用Bag

       many-to-many

           1.      Bag和Set语义有区别

           2。   建议使用Set
</code></pre><p><strong>六。集合的过滤</strong></p>
<pre><code>         1. children = session.createFilter(parent.getChildren(), “where this.age &gt; 5 and   this.age &lt; 10”).list()

     针对一对多关联当中的集合元素非常庞大的情况，特别适合于庞大集合的分页：

               session.createFilter(parent.getChildren(),“”).setFirstResult(0).setMaxResults(10).list();
</code></pre><p>在hibernate 中用 super.getSession().createFilter( , )</p>
<p><strong>七。继承关系当中的隐式多态</strong></p>
<pre><code>       HQL: from Object

         1.     把所有数据库表全部查询出来

          2.     polymorphism=“implicit”(default)将当前对象，和对象所有继承子类全部一次性取出

          3.      polymorphism=“explicit”，只取出当前查询对象
</code></pre><p><strong>八。**</strong>Hibernate<strong>**二级缓存</strong></p>
<pre><code>          著名的n+1问题：from Child，然后在页面上面显示每个子类的父类信息，就会导致n条对parent表的查询：

               select /* from parent where id = ?

               .......................

               select /* from parent where id = ?

          解决方案

                    1.      eager fetch

                     2.      二级缓存
</code></pre><p><strong>九。**</strong>inverse<strong>**和二级缓存的关系</strong></p>
<pre><code>        当使用集合缓存的情况下：

             1.     inverse=“false”，通过parent.getChildren()来操作，Hibernate维护集合缓存

              2.    inverse=“true”，直接对child进行操作，未能维护集合缓存！导致缓存脏数据

              3.    双向关联，inverse=“true”的情况下应避免使用集合缓存
</code></pre><p><strong>十。**</strong>Hibernate<strong><strong>二级缓存是提升</strong></strong>web<strong>**应用性能的法宝</strong></p>
<pre><code>          OLTP类型的web应用，由于应用服务器端可以进行群集水平扩展，最终的系统瓶颈总是逃不开数据库访问；

       哪个框架能够最大限度减少数据库访问，降低数据库访问压力， 哪个框架提供的性能就更高；针对数据库的缓存策略：

                1.        对象缓存：细颗粒度，针对表的记录级别，透明化访问，在不改变程序代码的情况下可以极大提升web应用的性能。对象缓存是ORM的制胜法宝。

                2.       对象缓存的优劣取决于框架实现的水平，Hibernate是目前已知对象缓存最强大的开源ORM

                3.        查询缓存：粗颗粒度，针对查询结果集，应用于数据实时化要求不高的场合
</code></pre><p><strong>十一。应用场合决定了系统架构</strong></p>
<p>一、是否需要ORM</p>
<p>Hibernate or iBATIS？</p>
<p>二、采用ORM决定了数据库设计</p>
<pre><code>        Hibernate：

                倾向于细颗粒度的设计，面向对象，将大表拆分为多个关联关系的小表，消除冗余column，通过二级缓存提升性能（DBA比较忌讳关联关系的出现，但是ORM的缓存将突破关联关系的性能瓶颈）；Hibernate的性能瓶颈不在于关联关系，而在于大表的操作

        iBATIS：

                倾向于粗颗粒度设计，面向关系，尽量把表合并，通过表column冗余，消除关联关系。无有效缓存手段。iBATIS的性能瓶颈不在于大表操作，而在于关联关系。
</code></pre><p>总结：</p>
<pre><code> 性能口诀

           1、使用双向一对多关联，不使用单向一对多

           2、灵活使用单向多对一关联

           3、不用一对一，用多对一取代

           4、配置对象缓存，不使用集合缓存

           5、一对多集合使用Bag，多对多集合使用Set

           6、继承类使用显式多态

           7、表字段要少，表关联不要怕多，有二级缓存撑腰
</code></pre><p>最近开始留意项目中的Hibernate的性能问题，希望可以抽出时间学习一下hiberante的性能优化。主要是对数据库连接池技术、hibernate二级缓存、hibernate的配置优化等问题进行学习！</p>
<p>1.关联关系：</p>
<p>普通的关联关系：是不包括一个连接表，也就是中间表如：</p>
<p>create table Person(personId bigint not null primary key,addressId bigint not null)</p>
<p>create table Address(addressId bigint not null primary key)</p>
<p>也就是不会还有一个关系表如：</p>
<p>create table Person(personId bigint not null primary key)</p>
<p>create table Address(addressId bigint not null primary key)</p>
<p>create table PersonAddress(personId bigint not null,ddressId bigint not null primary key)</p>
<p>单向many-to-one关联是最常见的，而单向one-to-many是不常见的</p>
<ol>
<li>inner join(内连接)</li>
</ol>
<p>left (outer) join（左外连接）</p>
<p>right (outer) join (右外连接)</p>
<p>full join (全连接，并不常用)</p>
<p>3.小技巧：</p>
<p>统计结果数目：</p>
<p>(Integer)session.iterator(&quot;select count(/*) from ..&quot;).next()).intValue();</p>
<p>根据一个集合大小来排序：</p>
<p>select user.id,user.name</p>
<p>from User as user.name</p>
<pre><code>left join user.messages msg
</code></pre><p>group by user.id,user.name</p>
<p>having count(msg)&gt;=1</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/框架汇总/">框架汇总</a></li></span><span class="breadcrumb"><li><a href="/categories/框架汇总/">框架汇总</a></li><li><a href="/categories/框架汇总/ORM/">ORM</a></li><li><a href="/categories/框架汇总/ORM/hibernate/">hibernate</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ORM/" class="label label-primary">ORM</a><a href="/tags/hibernate/" class="label label-success">hibernate</a><a href="/tags/框架汇总/" class="label label-info">框架汇总</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:29"datetime="2014-03-07 09:54:29"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-框架汇总-ORM-hibernate--Hibernate性能调优（转载--作者：RobbinFan）/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-框架汇总-ORM-hibernate--Hibernate性能调优（转载--作者：RobbinFan）" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JS用法-Jquery--弹窗检测使用百度搜索代码/">弹窗检测使用百度搜索代码</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:28.000Z"> <a href="/2014/02/02/2014-02-02-JS用法-Jquery--弹窗检测使用百度搜索代码/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">弹窗检测使用百度搜索代码</h1>
<h3 id="-coolshell-cn-referrer-baidu-jquery-bpopup-http-dinbror-dk-bpopup-no-baidu-http-www-douban-com-online-10132155-ninja_lu-http-weibo-com-n-ninja_lu-github-https-github-com-lurongkai-anti-baidu-https-github-com-lurongkai-anti-baidu-">弹窗代码        大家问我那个弹窗是怎么做的，很简单的，可以看看coolshell.cn的源代码。就是从referrer中匹配baidu。我用了jquery的一个插件：<a href="http://dinbror.dk/bpopup/" target="_blank">bPopup</a>，关于那个no baidu插图来自：<a href="http://www.douban.com/online/10132155/" target="_blank">豆瓣的拒绝百度的兴趣小组</a>。        源码如下：<strong><a href="http://weibo.com/n/Ninja_Lu" target="_blank">@Ninja_Lu</a> 做了一个github的：<a href="https://github.com/lurongkai/anti-baidu" target="_blank"><a href="https://github.com/lurongkai/anti-baidu">https://github.com/lurongkai/anti-baidu</a></a></strong></h3>
<p>&lt;</p>
<p>script</p>
<p>src</p>
<p>=</p>
<p>&quot;<a href="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" target="_blank"><a href="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js">http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js</a></a>&quot;</p>
<blockquote>
<p>&lt;/</p>
</blockquote>
<p>script</p>
<p>&gt;
&lt;</p>
<p>script</p>
<p>src</p>
<p>=</p>
<p>&quot;<a href="http://coolshell.cn/wp-content/themes/inove/js/jquery.bpopup-0.8.0.min.js" target="_blank"><a href="http://coolshell.cn/wp-content/themes/inove/js/jquery.bpopup-0.8.0.min.js">http://coolshell.cn/wp-content/themes/inove/js/jquery.bpopup-0.8.0.min.js</a></a>&quot;</p>
<blockquote>
<p>&lt;/</p>
</blockquote>
<p>script</p>
<p>&gt;</p>
<p>&lt;</p>
<p>script</p>
<p>type</p>
<p>=</p>
<p>&quot;text/javascript&quot;</p>
<p>&gt;</p>
<p>;(function($) {</p>
<p>$(function() {</p>
<p>var url=document.referrer;</p>
<p>if ( url &amp;&amp; url.search(&quot;<a href="http:">http://</a>&quot;)&gt;-1) {</p>
<p>var refurl =  url.match(/:\/\/(.[^/]+)/)[1];</p>
<p>if(refurl.indexOf(&quot;baidu.com&quot;)&gt;-1){</p>
<p>$(&#39;/#nobaidu_dlg&#39;).bPopup();</p>
<p>}</p>
<p>}</p>
<p>});</p>
<p>})(jQuery);</p>
<p>&lt;/</p>
<p>script</p>
<p>&gt;</p>
<p>&lt;</p>
<p>div</p>
<p>id</p>
<p>=</p>
<p>&quot;nobaidu_dlg&quot;</p>
<p>style</p>
<p>=</p>
<p>&quot;background-color:/#fff; border-radius:15px;color:/#000;display:none;padding:20px;min-width:450px;min-height:180px;&quot;</p>
<p>&gt;</p>
<p>&lt;</p>
<p>img</p>
<p>src</p>
<p>=</p>
<p>&quot;<a href="http://coolshell.cn/wp-content/themes/inove/img/nobaidu.jpg" target="_blank"><a href="http://coolshell.cn/wp-content/themes/inove/img/nobaidu.jpg">http://coolshell.cn/wp-content/themes/inove/img/nobaidu.jpg</a></a>&quot;</p>
<p>align</p>
<p>=</p>
<p>&quot;left&quot;</p>
<p>&gt;</p>
<p>&lt;</p>
<p>p</p>
<p>style</p>
<p>=</p>
<p>&quot;margin-left:200px;margin-top: 20px; line-height: 30px;&quot;</p>
<p>&gt;</p>
<p>检测到你还在使用百度这个搜索引擎，&lt;</p>
<p>br</p>
<p>/&gt;</p>
<p>做为一个程序员，这是一种自暴自弃！&lt;</p>
<p>br</p>
<p>/&gt;</p>
<p>&lt;</p>
<p>br</p>
<p>/&gt;</p>
<p>&lt;/</p>
<p>p</p>
<p>&gt;</p>
<p>&lt;</p>
<p>p</p>
<p>align</p>
<p>=</p>
<p>&quot;center&quot;</p>
<p>style</p>
<p>=</p>
<p>&quot;margin-top:20px;&quot;</p>
<p>&gt;</p>
<p>&lt;</p>
<p>b</p>
<blockquote>
<p>&lt;</p>
</blockquote>
<p>a</p>
<p>href</p>
<p>=</p>
<p>&quot;<a href="http://coolshell.cn/articles/7186.html" target="_blank"><a href="http://coolshell.cn/articles/7186.html">http://coolshell.cn/articles/7186.html</a></a>&quot;</p>
<blockquote>
<p>作环保的程序员，从不用百度开始！&lt;/</p>
</blockquote>
<p>a</p>
<blockquote>
<p>&lt;/</p>
</blockquote>
<p>b</p>
<p>&gt;</p>
<p>&lt;/</p>
<p>p</p>
<p>&gt;</p>
<p>&lt;/</p>
<p>div</p>
<blockquote>
<pre><code>   来源： &lt;[http://coolshell.cn/articles/9308.html](http://coolshell.cn/articles/9308.html)&gt;     
</code></pre></blockquote>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/JS用法/">JS用法</a></li></span><span class="breadcrumb"><li><a href="/categories/JS用法/">JS用法</a></li><li><a href="/categories/JS用法/Jquery/">Jquery</a></li></span></span> | <span class="tags">Tagged <a href="/tags/JS用法/" class="label label-primary">JS用法</a><a href="/tags/Jquery/" class="label label-success">Jquery</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:28"datetime="2014-03-07 09:54:28"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JS用法-Jquery--弹窗检测使用百度搜索代码/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JS用法-Jquery--弹窗检测使用百度搜索代码" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/149/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/147/">147</a></li><li><a class="page-number" href="/page/148/">148</a></li><li><a class="page-number" href="/page/149/">149</a></li><li class="active"><li><span class="page-number current">150</span></li><li><a class="page-number" href="/page/151/">151</a></li><li><a class="page-number" href="/page/152/">152</a></li><li><a class="page-number" href="/page/153/">153</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/151/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 20:45:44</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
