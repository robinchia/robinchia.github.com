
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 10 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-wrapper--使用JavaServiceWrapper设置tomcat作为linux服务并且开机自动启动-/">使用Java Service Wrapper设置tomcat作为linux服务并且开机自动启动 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-wrapper--使用JavaServiceWrapper设置tomcat作为linux服务并且开机自动启动-/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-java-service-wrapper-tomcat-linux-tomcat-java-iteye-">使用Java Service Wrapper设置tomcat作为linux服务并且开机自动启动 - Tomcat - Java - ITeye论坛</h1>
<p><a href="http://www.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://www.iteye.com/login" target="_blank">登录</a> <a href="http://www.iteye.com/signup" target="_blank">注册</a></p>
<p><a href="http://www.iteye.com/" target="_blank"><img src="&quot;ITeye-最棒的软件开发交流社区&quot;" alt="ITeye-最棒的软件开发交流社区"></a></p>
<p>-</p>
<p><a href="http://www.iteye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.iteye.com/forums/board/Java" target="_blank">Java企业应用论坛</a> →</p>
<h1 id="-java-service-wrapper-tomcat-linux-">使用Java Service Wrapper设置tomcat作为linux服务并且开机自动启动</h1>
<p><a href="http://www.iteye.com/forums/board/Java" target="_blank">全部</a> <a href="http://www.iteye.com/forums/tag/Hibernate" target="_blank">Hibernate</a> <a href="http://www.iteye.com/forums/tag/Spring" target="_blank">Spring</a> <a href="http://www.iteye.com/forums/tag/Struts" target="_blank">Struts</a> <a href="http://www.iteye.com/forums/tag/iBATIS" target="_blank">iBATIS</a> <a href="http://www.iteye.com/forums/tag/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8" target="_blank">企业应用</a> <a href="http://www.iteye.com/forums/tag/Lucene" target="_blank">Lucene</a> <a href="http://www.iteye.com/forums/tag/SOA" target="_blank">SOA</a> <a href="http://www.iteye.com/forums/tag/Java%E7%BB%BC%E5%90%88" target="_blank">Java综合</a> <a href="http://www.iteye.com/forums/tag/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" target="_blank">设计模式</a> <a href="http://www.iteye.com/forums/tag/Tomcat" target="_blank">Tomcat</a> <a href="http://www.iteye.com/forums/tag/OO" target="_blank">OO</a> <a href="http://www.iteye.com/forums/tag/JBoss" target="_blank">JBoss</a>
<a href="http://www.iteye.com/clicks/593" target="_blank">最成熟稳定甘特图控件,支持Java和.Net</a></p>
<p>浏览 5354 次 锁定老帖子 <a href="">主题：使用Java Service Wrapper设置tomcat作为linux服务并且开机自动启动</a></p>
<p>精华帖 (0) :: 良好帖 (0) :: 新手帖 (0) :: 隐藏帖 (0) 作者 正文 * wenson</p>
<ul>
<li>等级: 初级会员</li>
<li><a href="http://wenson.iteye.com/" target="_blank"><img src="&quot;wenson的博客: 山下的人&quot;" alt="wenson的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 111</li>
<li>积分: 80</li>
<li>来自: 广州</li>
<li><img src="" alt="">
  发表时间：2008-01-11   最后修改：2009-02-02</li>
</ul>
<p><a href="http://www.iteye.com/topic/155159#" target="_blank">&lt;</a> <a href="http://www.iteye.com/topic/155159#" target="_blank">&gt;</a>  猎头职位: <a href="http://www.iteye.com/jobs/1847" target="_blank">北京:  ITeye网站诚聘产品交互设计</a></p>
<p>相关文章: <a href="http://www.iteye.com/topic/155159#" title="关闭" target="_blank"> </a></p>
<ul>
<li><a href="http://www.iteye.com/topic/36657" title="把java程序做成windows服务（转）" target="_blank">把java程序做成windows服务（转）</a></li>
<li><a href="http://www.iteye.com/topic/557980" title="tomcat源码—redirect和forward的实现" target="_blank">tomcat源码—redirect和forward的实现</a></li>
<li><a href="http://www.iteye.com/topic/614683" title="tomcat集群时统计session与在线人数" target="_blank">tomcat集群时统计session与在线人数</a>
推荐群组: <a href="http://ubuntu.group.iteye.com/" target="_blank">Ubuntu For Fun</a>
<a href="http://www.iteye.com/wiki/topic/155159" target="_blank">更多相关推荐</a>
<a href="http://www.iteye.com/forums/tag/Tomcat" target="_blank">Tomcat</a></li>
</ul>
<p>前几天总结了使用JSVC来设置tomcat作为linux服务并且开机自动启动，但是如果要更专业一点来控制tomcat的启动，使用Java Service Wrapper应该不失为一个好的选择，下面来总结一下Java Service Wrapper在Linux中对于tomcat启动的设置：
<strong>1、</strong> 安装JDK、Tomcat,此处略过。比如tomcat安装在/opt/tomcat目录中。
<strong>2</strong> 、使用命令wget 下载Java Service Wrapper(目前版本wrapper-linux-x86-32-3.2.3，官网：<a href="http://wrapper.tanukisoftware.org" target="_blank">http://wrapper.tanukisoftware.org</a>), 用命令tar -zxvf wrapper-linux-x86-32-3.2.3.tar.gz 解压，得到目录wrapper-linux-x86-32-3.2.3，使用ln -s wrapper-linux-x86-32-3.2.3 wrapper 给目录wrapper-linux-x86-32-3.2.3 建一个名称为wrapper的快捷方式。
<strong>3</strong> 、复制wrapper\src\bin\sh.script.in到/opt/tomcat/bin目录，重命名为tomcat
复制wrapper\src\conf\wrapper.conf.in到/opt/tomcat/conf目录，重命名为wrapper.conf
复制wrapper\lib目录下的所有3个文件到/opt/tomcat/lib目录
复制wrapper\bin目录下的wrapper文件到/opt/tomcat/bin目录
<strong>4</strong> 、修改/opt/testapp/bin/tomcat文件
APP_NAME=&quot;tomcat&quot;
APP_LONG_NAME=&quot;Tomcat Application Server&quot;
WRAPPER_CMD=&quot;./wrapper&quot;
WRAPPER_CONF=&quot;../conf/wrapper.conf&quot;
赋予执行权限
chmod 775 /opt/tomcat/bin/tomcat
chmod 775 /opt/tomcat/bin/tomcat
<strong>5</strong> 、修改/opt/tomcat/conf/wrapper.conf文件，如：
/#/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>
/# Wrapper Properties
/#/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>
/# Java Application
/# 设置环境变量
set.JAVA_HOME=/usr/java/jdk1.6.0_01
set.CATALINA_HOME=/opt/tomcat
set.CATALINA_BASE=/opt/tomcat
wrapper.java.command=/usr/java/jdk1.6.0_01/bin/java
/# Java Main class. This class must implement the WrapperListener interface
/# or guarantee that the WrapperManager class is initialized. Helper
/# classes are provided to do this for you. See the Integration section
/# of the documentation for details.
/# 使用WrapperStartStopApp，这样可以通过命令带start/stop来启动/停止程序。
wrapper.java.mainclass=org.tanukisoftware.wrapper.WrapperStartStopApp
/# Java Classpath (include wrapper.jar) Add class path elements as
/# needed starting from 1
/# 设置执行tomcat的classpath文件
wrapper.java.classpath.1=%CATALINA_HOME%/lib/wrapper.jar
wrapper.java.classpath.2=%CATALINA_BASE%/bin/bootstrap.jar
/# Java Library Path (location of Wrapper.DLL or libwrapper.so)
/# 设置tomcat的lib路径
wrapper.java.library.path.1=%CATALINA_HOME%/lib/
/# Java Additional Parameters
/# 设置额外参数
wrapper.java.additional.1=-Djava.endorsed.dirs=%CATALINA_HOME%/common/endorsed
wrapper.java.additional.2=-Dcatalina.base=%CATALINA_BASE%
wrapper.java.additional.3=-Dcatalina.home=%CATALINA_HOME%
wrapper.java.additional.4=-Djava.io.tmpdir=%CATALINA_BASE%/temp
/# Initial Java Heap Size (in MB)
/# 设置tomcat的JVM初始化堆的大小
wrapper.java.initmemory=128
/# Maximum Java Heap Size (in MB)
/# 设置tomcat的JVM堆的最大值
wrapper.java.maxmemory=512
/# Application parameters. Add parameters as needed starting from 1
/# 设置启动、停止和重启参数
wrapper.app.parameter.1=org.apache.catalina.startup.Bootstrap
wrapper.app.parameter.2=1
wrapper.app.parameter.3=start
wrapper.app.parameter.4=org.apache.catalina.startup.Bootstrap
wrapper.app.parameter.5=true
wrapper.app.parameter.6=1
wrapper.app.parameter.7=stop
wrapper.filter.trigger.1=java.lang.OutOfMemoryError
wrapper.filter.action.1=RESTART
/#/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>
/# Wrapper Logging Properties
/#/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>
/# Format of output for the console. (See docs for formats)
wrapper.console.format=PM
/# Log Level for console output. (See docs for log levels)
wrapper.console.loglevel=INFO
/# Log file to use for wrapper output logging.
/# 设置log文件路径
wrapper.logfile=%CATALINA_BASE%/logs/wrapper.log
/# Format of output for the log file. (See docs for formats)
wrapper.logfile.format=LPTM
/# Log Level for log file output. (See docs for log levels)
wrapper.logfile.loglevel=INFO
/# Maximum size that the log file will be allowed to grow to before
/# the log is rolled. Size is specified in bytes. The default value
/# of 0, disables log rolling. May abbreviate with the &#39;k&#39; (kb) or
/# &#39;m&#39; (mb) suffix. For example: 10m = 10 megabytes.
/# 设置log文件最大值
wrapper.logfile.maxsize=5
/# Maximum number of rolled log files which will be allowed before old
/# files are deleted. The default value of 0 implies no limit.
/#设置log文件最多个数
wrapper.logfile.maxfiles=10
/# Log Level for sys/event log output. (See docs for log levels)
wrapper.syslog.loglevel=NONE
/#/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>
/# Wrapper Windows Properties
/#/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>
/# Title to use when running as a console
/# windows下tomcat控制台名称
wrapper.console.title=Tomcat6 Application Server
/#/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>
/# Wrapper Windows NT/2000/XP Service Properties
/#/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>/<em>/</em>
/# WARNING - Do not modify any of these properties when an application
/# using this configuration file has been installed as a service.
/# Please uninstall the service before modifying this section. The
/# service can then be reinstalled.
/# Name of the service
/# 设置服务名称
wrapper.ntservice.name=tomcat6
/# Display name of the service
wrapper.ntservice.displayname=@app.long.name@
/# Description of the service
wrapper.ntservice.description=@app.description@
/# Service dependencies. Add dependencies as needed starting from 1
wrapper.ntservice.dependency.1=
/# Mode in which the service is installed. AUTO_START or DEMAND_START
/# 设置允许Tomcat服务自动启动
wrapper.ntservice.starttype=AUTO_START
/# Allow the service to interact with the desktop.
wrapper.ntservice.interactive=false
<strong>6</strong> 、设置tomcat开机自动运行：
ln -s /opt/tomcat/bin/tomcat /etc/init.d/tomcat
<strong>7</strong> 、测试,执行命令：service tomcat start|stop|restart|status
至此，使用Java Service Wrapper来设置Tomcat作为Linux的服务完成，从此过程看来，Java Service Wrapper对tomcat的控制程度比tomcat自带的JSVC深入多了。
目录结构：
/opt/tomcat/bin
                 | tomcat
                 | wrapper
/opt/tomcat/logs
                 | wrapper.log（程序运行时自动产生）
/opt/tomcat/conf
                 | wrapper.conf
/opt/tomcat/lib
                 | libwrapper.so
                 | wrapper.jar
                 | test.jar</p>
<p>声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。</p>
<p>推荐链接</p>
<ul>
<li><a href="http://www.iteye.com/clicks/508" target="_blank">.Net程序员不用羡慕Android程序员，微软移动战役打响</a></li>
<li><a href="http://www.iteye.com/clicks/716" target="_blank">想进外企，出国，跳槽，找工作？英语不好,快来充电吧</a></li>
<li><a href="http://www.iteye.com/clicks/527" target="_blank">100万现金奖培训出来的程序员</a></li>
<li><a href="http://www.iteye.com/clicks/609" target="_blank">-</a> <a href="http://www.iteye.com/topic/155159#" target="_blank">返回顶楼</a> <a href="http://wenson.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://wenson.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=wenson" title="发送站内短信" target="_blank"> </a> <a href="http://wenson.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=wenson" title="关注作者" target="_blank"> </a>  * nwangwei</li>
<li>等级: <img src="&quot;一星会员&quot;" alt="一星会员"></li>
<li><a href="http://nwangwei.iteye.com/" target="_blank"><img src="&quot;nwangwei的博客: nwangwei&quot;" alt="nwangwei的博客"></a></li>
<li>性别: <img src="&quot;男&quot;" alt=""></li>
<li>文章: 41</li>
<li>积分: 130</li>
<li><img src="" alt="">
  发表时间：2008-03-13  </li>
</ul>
<p>棒！
tomcat的shutdown命令老是关不掉全部的java进程 <a href="http://www.iteye.com/topic/155159#" target="_blank">返回顶楼</a> <a href="http://nwangwei.iteye.com/" title="浏览作者的博客" target="_blank"> </a> <a href="http://nwangwei.iteye.com/blog/profile" title="浏览作者资料" target="_blank"> </a> <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=nwangwei" title="发送站内短信" target="_blank"> </a> <a href="http://nwangwei.iteye.com/blog/guest_book" title="给作者留言" target="_blank"> </a> <a href="http://my.iteye.com/feed?subscription%5Bsubscribed_user_name%5D=nwangwei" title="关注作者" target="_blank"> </a> <a href="http://www.iteye.com/topic/155159#485194" title="nwangwei回帖:使用Java Service Wrapper设置tomcat作为linux服务并且开机自动启动" target="_blank">回帖地址</a></p>
<p><a href="http://www.iteye.com/topic/155159#" title="好" target="_blank">0</a> <a href="http://www.iteye.com/topic/155159#" title="差" target="_blank">0</a> 请登录后投票</p>
<p><a href="http://www.iteye.com/forums" target="_blank">论坛首页</a> → <a href="http://www.iteye.com/forums/board/Java" target="_blank">Java企业应用版</a>
跳转论坛:移动开发技术 Web前端技术 Java企业应用 编程语言技术 综合技术 入门技术 招聘求职 海阔天空</p>
<ul>
<li><a href="http://www.iteye.com/jobs/1555" title="北京:美团诚聘资深研发工程师（Java）" target="_blank">北京: 美团诚聘资深研发工程师（Java）</a></li>
<li><a href="http://www.iteye.com/jobs/1554" title="北京:美团诚聘研发工程师（Java）" target="_blank">北京: 美团诚聘研发工程师（Java）</a></li>
<li><a href="http://www.iteye.com/jobs/712" title="北京:ITeye官方招聘和猎头诚聘ITeye网站诚聘Java高级搜索工程师" target="_blank">北京: ITeye官方招聘和猎头诚聘ITeye网站诚聘Java</a></li>
<li><a href="http://www.iteye.com/jobs/2068" title="吉林:用友汽车软件诚聘Java程序员" target="_blank">吉林: 用友汽车软件诚聘Java程序员</a></li>
<li><a href="http://www.iteye.com/jobs/1628" title="浙江:阿里巴巴诚聘高级Java工程师" target="_blank">浙江: 阿里巴巴诚聘高级Java工程师</a></li>
<li><a href="http://www.iteye.com/jobs/2078" title="上海:用友汽车软件诚聘项目经理" target="_blank">上海: 用友汽车软件诚聘项目经理</a></li>
<li><a href="http://www.iteye.com/jobs/1144" title="陕西:ThoughtWorks诚聘西安Senior Java Application Developer" target="_blank">陕西: ThoughtWorks诚聘西安Senior Java Applicatio</a></li>
<li><a href="http://www.iteye.com/jobs/2067" title="重庆:用友汽车软件诚聘Java程序员" target="_blank">重庆: 用友汽车软件诚聘Java程序员</a></li>
<li><a href="http://www.iteye.com/jobs/750" title="北京:杰嘉迪诚聘高级Java程序员" target="_blank">北京: 杰嘉迪诚聘高级Java程序员</a></li>
<li><a href="http://www.iteye.com/jobs/2111" title="北京:中油瑞飞/richfit诚聘JAVA开发工程师" target="_blank">北京: 中油瑞飞/richfit诚聘JAVA开发工程师</a></li>
<li><a href="http://www.iteye.com/jobs/1891" title="北京:北大软件诚聘Java软件开发工程师（技术研发部110809）" target="_blank">北京: 北大软件诚聘Java软件开发工程师（技术研发部</a></li>
<li><a href="http://www.iteye.com/jobs/755" title="北京:杰嘉迪诚聘Java程序员" target="_blank">北京: 杰嘉迪诚聘Java程序员</a></li>
<li><a href="http://www.iteye.com/jobs/1231" title="北京:胡莱游戏诚聘年薪8-16万高级Java程序员" target="_blank">北京: 胡莱游戏诚聘年薪8-16万高级Java程序员</a></li>
<li><a href="http://www.iteye.com/jobs/1541" title="上海:大众点评诚聘Java高级开发工程师（上海）" target="_blank">上海: 大众点评诚聘Java高级开发工程师（上海）</a></li>
<li><a href="http://www.iteye.com/jobs/2066" title="湖北:用友汽车软件诚聘Java程序员" target="_blank">湖北: 用友汽车软件诚聘Java程序员</a></li>
<li><a href="http://www.iteye.com/jobs/1849" title="浙江:阿里巴巴诚聘C++开发工程师(搜索引擎和广告引擎方向，偏底层)" target="_blank">浙江: 阿里巴巴诚聘C++开发工程师(搜索引擎和广告</a></li>
<li><a href="http://www.iteye.com/jobs/2065" title="安徽:用友汽车软件诚聘Java程序员" target="_blank">安徽: 用友汽车软件诚聘Java程序员</a></li>
<li><a href="http://www.iteye.com/jobs/2080" title="上海:用友汽车软件诚聘软件研发工程师（实习岗位）" target="_blank">上海: 用友汽车软件诚聘软件研发工程师（实习岗位）</a></li>
<li><p><a href="http://www.iteye.com/jobs/2064" title="上海:用友汽车软件诚聘高级Java程序员" target="_blank">上海: 用友汽车软件诚聘高级Java程序员</a></p>
</li>
<li><p><a href="http://www.iteye.com/" target="_blank">首页</a></p>
</li>
<li><a href="http://www.iteye.com/news" target="_blank">资讯</a></li>
<li><a href="http://www.iteye.com/magazines" target="_blank">精华</a></li>
<li><a href="http://www.iteye.com/forums" target="_blank">论坛</a></li>
<li><a href="http://www.iteye.com/ask" target="_blank">问答</a></li>
<li><a href="http://www.iteye.com/blogs" target="_blank">博客</a></li>
<li><a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a></li>
<li><a href="http://www.iteye.com/groups" target="_blank">群组</a></li>
<li><a href="http://www.iteye.com/job" target="_blank">招聘</a></li>
<li><a href="http://www.iteye.com/search" target="_blank">搜索</a></li>
<li><a href="http://www.ciecloud.org/2012/index.html" target="_blank">云计算大会</a></li>
<li><a href="http://www.iteye.com/index/service" target="_blank">广告服务</a></li>
<li><a href="http://webmaster.iteye.com/" target="_blank">ITeye黑板报</a></li>
<li><a href="http://www.iteye.com/index/contactus" target="_blank">联系我们</a></li>
<li><a href="http://www.iteye.com/index/friend_links" target="_blank">友情链接</a></li>
</ul>
<p>© 2003-2011 ITeye.com. [ <a href="http://www.miibeian.gov.cn/" target="_blank">京ICP证110151号</a> 京公网安备110105010620 ]
百联优力(北京)投资有限公司 版权所有
上海炯耐计算机软件有限公司 提供商务支持 <img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/wrapper/">wrapper</a></li></span></span> | <span class="tags">Tagged <a href="/tags/wrapper/" class="label label-primary">wrapper</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-wrapper--使用JavaServiceWrapper设置tomcat作为linux服务并且开机自动启动-/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-wrapper--使用JavaServiceWrapper设置tomcat作为linux服务并且开机自动启动-" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-wrapper--发布Java程序为Windows（Linux）服务JavaServiceWrapper-/">发布Java程序为Windows（Linux）服务[Java Service Wrapper] </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-wrapper--发布Java程序为Windows（Linux）服务JavaServiceWrapper-/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-java-windows-linux-java-service-wrapper-iteye-">发布Java程序为Windows（Linux）服务[Java Service Wrapper] - 点点知识小屋 - ITeye技术网站</h1>
<p><a href="http://www.iteye.com/" target="_blank">首页</a> <a href="http://www.iteye.com/news" target="_blank">资讯</a> <a href="http://www.iteye.com/magazines" target="_blank">精华</a> <a href="http://www.iteye.com/forums" target="_blank">论坛</a> <a href="http://www.iteye.com/ask" target="_blank">问答</a> <a href="http://www.iteye.com/blogs" target="_blank">博客</a> <a href="http://www.iteye.com/blogs/subjects" target="_blank">专栏</a> <a href="http://www.iteye.com/groups" target="_blank">群组</a> <a href="http://tsunzhang.iteye.com/blog/969521#" target="_blank">更多 ▼</a></p>
<p><a href="http://www.iteye.com/job" target="_blank">招聘</a> <a href="http://www.iteye.com/search" target="_blank">搜索</a></p>
<p><a href="http://tsunzhang.iteye.com/login" title="登录" target="_blank">您还未登录 !</a> <a href="http://tsunzhang.iteye.com/login" target="_blank">登录</a> <a href="http://tsunzhang.iteye.com/signup" target="_blank">注册</a></p>
<h1 id="-http-tsunzhang-iteye-com-"><a href="http://tsunzhang.iteye.com/" target="_blank">点点知识小屋</a></h1>
<ul>
<li><a href="http://tsunzhang.iteye.com/" target="_blank"><strong>博客</strong></a></li>
<li><a href="http://tsunzhang.iteye.com/weibo" target="_blank">微博</a></li>
<li><a href="http://tsunzhang.iteye.com/album" target="_blank">相册</a></li>
<li><a href="http://tsunzhang.iteye.com/link" target="_blank">收藏</a></li>
<li><a href="http://tsunzhang.iteye.com/blog/guest_book" target="_blank">留言</a></li>
<li><a href="http://tsunzhang.iteye.com/blog/profile" target="_blank">关于我</a></li>
</ul>
<h3 id="-java-windows-linux-java-service-wrapper-"><a href="">发布Java程序为Windows（Linux）服务[Java Service Wrapper]</a> **</h3>
<p><strong>博客分类：</strong></p>
<ul>
<li><a href="http://tsunzhang.iteye.com/category/60981" target="_blank">java</a>
<a href="http://www.iteye.com/blogs/tag/Java" target="_blank">Java</a><a href="http://www.iteye.com/blogs/tag/Windows" target="_blank">Windows</a><a href="http://www.iteye.com/blogs/tag/Linux" target="_blank">Linux</a><a href="http://www.iteye.com/blogs/tag/JVM" target="_blank">JVM</a><a href="http://www.iteye.com/blogs/tag/MySQL" target="_blank">MySQL</a></li>
</ul>
<p>☆<strong>下载Windows版本</strong>：(请使用Community版本，因Professional和Standard版本需要购买Licenses)
      ☆假设项目放在目录project文件夹下，发布的包放在project/lib下，日志文件放在project/log下，配置文件放在project/conf下，运行的jar为myjar.jar。
      ☆在下载包后解压，将Java Service Wrapper包中src/bin/的App.bat.in，InstallApp-NT.bat.in，UninstallApp-NT.bat.in和bin/下的wrapper.exe放在project目录下，把后缀.in去掉。【App.bat(可以直接运行程序)，InstallApp-NT.bat(安装成Windows服务)，UninstallApp-NT.bat(卸载Windows服务)】。修改App.bat，InstallApp-NT.bat，UninstallApp-NT.bat中的set _WRAPPER_CONF=&quot;%_REALPATH%conf\wrapper.conf&quot;。
      ☆把Java Service Wrapper包中lib目录下的Wrapper.DLL，wrapper.jar拷贝到project/lib下，在原来的运行的jar文件myjar.jar中的MANIFEST.MF增加Class-Path: 其他jar wrapper.jar wrapper.dll。
      ☆把Java Service Wrapper包中src/conf目录下的wrapper.conf.in放到project/conf下，去掉后缀.in。然后修改为
wrapper.java.classpath.1=dist/wrapper.jar
wrapper.java.classpath.2=dist/myjar.jar
wrapper.java.library.path.1=dist
/#原来程序运行的入口
wrapper.app.parameter.1=myapp.mainClass
wrapper.logfile=log/wrapper.log
wrapper.console.title=MyApp服务
wrapper.ntservice.name=MyApp服务
wrapper.ntservice.displayname=MyApp服务
wrapper.ntservice.description=MyApp服务</p>
<pre><code>  ☆然后直接运行App.bat，如果运行成功的话，然后就可以执行InstallApp-NT.bat发布成Windows服务，然后就可以设置成开机自启动了，不怕别人启动的时候自己的程序没有执行。另外如果在project/bin当成bat的目录的话没这么麻烦。
</code></pre><!-- Linux-->

<p>使用Java Service Wrapper将java程序作为linux服务并且开机自动启动
以java应用程序为例，打包为tianlong.jar，程序入口为tianlong.QueueTest。
下面在linux的/opt下建立tianlong目录，复制tianlong.jar到/opt/tianlong/lib目录下。
1、下载Java Service Wrapper(请使用Community版本，因Professional和Standard版本需要购买Licenses), 解压。 
      <a href="http://wrapper.tanukisoftware.org/" target="_blank"><a href="http://wrapper.tanukisoftware.org/">http://wrapper.tanukisoftware.org/</a></a>
      复制src\bin\sh.script.in到/opt/tianlong/bin目录，重命名为QueueTest
      复制wrapper\bin目录下的wrapper文件到/opt/tianlong/bin目录
      复制src\conf\wrapper.conf.in到/opt/tianlong/conf目录，重命名为wrapper.conf
      复制src\lib\lib目录下3个文件到/opt/tianlong/lib目录
              wrapper.so
              wrapper.jar
              wrappertest.jar
2、修改/opt/tianlong/bin/QueueTest文件
      APP_NAME=&quot;QueueTest&quot; //注意这里，这里的应用服务名称应该与第1步的/opt/tianlong/bin里面的  QueueTest名字相同
      APP_LONG_NAME=&quot;QueueTest Application Server&quot;
      WRAPPER_CMD=&quot;./wrapper&quot; //这里的路径要写正确，这里是对应了/opt/tianlong/bin/wrapper这个文件
      WRAPPER_CONF=&quot;../conf/wrapper.conf&quot; //这里的路径要写正确，这里是对应了/opt/tianlong/conf/wrapper.conf这个文件
      赋予执行权限
      chmod 775 /opt/testapp/bin/SocketServer
      chmod 775 /opt/testapp/bin/wrapper
3、修改/opt/tianlong/conf/wrapper.conf文件
      wrapper.java.command=/usr/java/jdk1.6.0_07/bin/java   //这里是写java的安装路径
      使用WrapperStartStopApp，这样可以通过命令带start/stop来启动/停止程序。
      wrapper.java.mainclass=org.tanukisoftware.wrapper.WrapperStartStopApp
      /#这里添加你用到的jar包文件，从1..n你自己全写上吧，不过wrapper是必须的
      wrapper.java.classpath.1=../lib/wrapper.jar
      wrapper.java.classpath.2=../lib/tianlong.jar     //这里表示将打包好的tianlong.jar放在/opt/tianlong/lib这个文件夹中
      wrapper.java.classpath.3=../lib/asterisk-java-0.3.jar
      wrapper.java.classpath.4=../lib/mysql-connector-java-5.1.6-bin.jar
      wrapper.java.classpath.5=/usr/java/jdk1.6.0_07/lib/dt.jar
      wrapper.java.classpath.6=/usr/java/jdk1.6.0_07/lib/tools.jar
      wrapper.java.classpath.7=../cofig.properties   //这个是应用程序用到的配置文件。如果使用的应用程序需要用到  配置，就需要把这个文件包含进来
      wrapper.java.library.path.1=../lib   //这里是表示wrapper使用到的jar包的路径，一般默认即可，绝对路径是：/opt/tianlong/lib
      /#wrapper.java.initmemory=3
        JVM启动时的初始内存大小,当前是3M,如果要自定义，将/#去掉，设置自己的值即可。
      /#wrapper.java.maxmemory=64
      JVM启动时的最大内存使用量,当前是64M,如果要自定义，将/#去掉，设置自己的值即可。
      /#这个就是你自己可执行程序的主类(MainClass)，一般来说，就是包含public static void main的那个类
      wrapper.app.parameter.1=tianlong.QueueTest
      wrapper.app.parameter.2=1
      wrapper.app.parameter.3=true
      wrapper.app.parameter.4=tianlong.QueueTest
      wrapper.app.parameter.5=true
      wrapper.app.parameter.6=1
      wrapper.app.parameter.7=stop
4、让QueueTest开机自动运行
      ln -s /opt/tianlong/bin/QueueTest  /etc/init.d/QueueTest
      ln -s /opt/tianlong/bin/QueueTest /etc/rc0.d/QueueTest
      ln -s /opt/tianlong/bin/QueueTest /etc/rc1.d/QueueTest
      ln -s /opt/tianlong/bin/QueueTest /etc/rc2.d/QueueTest
      ln -s /opt/tianlong/bin/QueueTest /etc/rc3.d/QueueTest
      ln -s /opt/tianlong/bin/QueueTest /etc/rc4.d/QueueTest
      ln -s /opt/tianlong/bin/QueueTest /etc/rc5.d/QueueTest
      ln -s /opt/tianlong/bin/QueueTest /etc/rc6.d/QueueTest
5、测试 执行命令：service QueueTest start|stop|restart|status
      程序运行时，Java Service Wrapper在/opt/tianlong/bin/目录下产生wrapper.log日志，
      STATUS | wrapper  | 2009/02/25 17:04:01 | --&gt; Wrapper Started as Daemon
      STATUS | wrapper  | 2009/02/25 17:04:01 | Java Service Wrapper Community Edition 3.3.2
      STATUS | wrapper  | 2009/02/25 17:04:01 |   Copyright (C) 1999-2009 Tanuki Software, Ltd.  All Rights Reserved.
      STATUS | wrapper  | 2009/02/25 17:04:01 |     <a href="http://wrapper.tanukisoftware.org" target="_blank">http://wrapper.tanukisoftware.org</a>
      STATUS | wrapper  | 2009/02/25 17:04:01 |
      STATUS | wrapper  | 2009/02/25 17:04:01 | Launching a JVM...
      INFO   | jvm 1    | 2009/02/25 17:04:02 | WrapperManager: Initializing...
出现上面这个就表示已经配置成功了。如果配置有错误的话，在wrapper.log里面会有提示。
同时，如果程序配置成功的并且启动的话，在/opt/tianlong/bin里面会有一个QueueTest.pid。
附目录结构
/opt/tianlong/
    cofig.properties
/opt/tianlong/bin
                 | QueueTest
                 | wrapper
                 | wrapper.log（程序运行时自动产生）
/opt/tianlong/conf
                | wrapper.conf
/opt/tianlong/lib
                | libwrapper.so
                | wrapper.jar
                | tianlong.jar
                | mysql-connector-java-5.1.6-bin.jar
                | asterisk-java-0.3.jar</p>
<ul>
<li><a href="http://dl.iteye.com/topics/download/b2a3facb-d7b0-3245-b5be-4eec51a884aa" target="_blank">wrapper-linux-x86-32-3.5.7.tar.gz</a> (415.6 KB)</li>
<li><p>下载次数: 15</p>
</li>
<li><p><a href="http://dl.iteye.com/topics/download/8d826566-6eae-330c-b75f-9607844f3ea2" target="_blank">wrapper-windows-x86-32-3.5.7.zip</a> (556.5 KB)</p>
</li>
<li>下载次数: 5</li>
</ul>
<p>分享到： <a href="&quot;分享到新浪微博&quot;"><img src="" alt=""></a> <a href="&quot;分享到腾讯微博&quot;"><img src="" alt=""></a>
<a href="http://tsunzhang.iteye.com/blog/970749" title="log4j配置简要说明" target="_blank">log4j配置简要说明</a> | <a href="http://tsunzhang.iteye.com/blog/899637" title="EXP-××××: 问题处理方法(整理中..)" target="_blank">EXP-××××: 问题处理方法(整理中..)</a></p>
<ul>
<li>2011-03-21 16:18:34</li>
<li>浏览 411</li>
<li><a href="http://tsunzhang.iteye.com/blog/969521#comments" target="_blank">评论(0)</a></li>
<li>分类:<a href="http://www.iteye.com/blogs/category/language" target="_blank">编程语言</a></li>
<li><a href="http://www.iteye.com/wiki/blog/969521" target="_blank">相关推荐</a><h3 id="-">评论</h3>
</li>
</ul>
<p><a href=""></a></p>
<h3 id="-">发表评论</h3>
<p><a href="http://tsunzhang.iteye.com/login" target="_blank"><img src="" alt=""></a><a href="http://tsunzhang.iteye.com/login" target="_blank">您还没有登录,请您登录后再发表评论</a></p>
<p><a href="http://tsunzhang.iteye.com/" target="_blank"><img src="&quot;coconut_zhang的博客: 点点知识小屋&quot;" alt="coconut_zhang的博客"></a></p>
<p>coconut_zhang</p>
<ul>
<li>浏览: 62966 次</li>
<li>性别: <img src="&quot;男&quot;" alt="Icon_minigender_1"></li>
<li>来自: 天津</li>
<li><img src="" alt=""><h3 id="-http-tsunzhang-iteye-com-blog-user_visits-">最近访客 <a href="http://tsunzhang.iteye.com/blog/user_visits" target="_blank">更多访客&gt;&gt;</a></h3>
</li>
</ul>
<p><a href="http://jjunxiao.iteye.com/" target="_blank"><img src="&quot;jjunxiao的博客: jjunxiao&quot;" alt="jjunxiao的博客"></a></p>
<p><a href="http://jjunxiao.iteye.com/" target="_blank">jjunxiao</a></p>
<p><a href="http://eyubean-163-com.iteye.com/" target="_blank"><img src="&quot;毛广斌的博客: &quot;" alt="毛广斌的博客"></a></p>
<p><a href="http://eyubean-163-com.iteye.com/" target="_blank">毛广斌</a>
<a href="http://alex-zeng.iteye.com/" target="_blank"><img src="&quot;alex.zeng的博客: &quot;" alt="alex.zeng的博客"></a></p>
<p><a href="http://alex-zeng.iteye.com/" target="_blank">alex.zeng</a></p>
<p><a href="http://return-space.iteye.com/" target="_blank"><img src="&quot;return_space的博客: &quot;" alt="return_space的博客"></a></p>
<p><a href="http://return-space.iteye.com/" target="_blank">return_space</a></p>
<h3 id="-">文章分类</h3>
<ul>
<li><a href="http://tsunzhang.iteye.com/" target="_blank">全部博客 (128)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/60979" target="_blank">hibernate,struts,spring (9)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/60981" target="_blank">java (28)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/60982" target="_blank">c,c++,c/# (39)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/60983" target="_blank">eclipse,myeclipse,lomboz (2)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/60984" target="_blank">tomcat,weblogic (2)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/60985" target="_blank">javascript,ajax,web (4)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/60980" target="_blank">oracle,sqlserver,mysql,sql (22)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/104329" target="_blank">linux,unix,windows (11)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/61096" target="_blank">文摘 (2)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/104330" target="_blank">生活 (0)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/183172" target="_blank">javascript (2)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/183173" target="_blank">ajax (2)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/183174" target="_blank">web (2)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/186108" target="_blank">strtus2.0实现上传 (1)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/186109" target="_blank">hibernate (3)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/186110" target="_blank">struts (3)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/186111" target="_blank">spring (3)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/187825" target="_blank">tomcat (2)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/187826" target="_blank">weblogic (1)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/191426" target="_blank">linux (1)</a></li>
<li><a href="http://tsunzhang.iteye.com/category/191427" target="_blank">unix (1)</a></li>
<li><p><a href="http://tsunzhang.iteye.com/category/191428" target="_blank">windows (1)</a></p>
<h3 id="-">社区版块</h3>
</li>
<li><p><a href="http://tsunzhang.iteye.com/blog/news" target="_blank">我的资讯</a> (0)</p>
</li>
<li><a href="http://tsunzhang.iteye.com/blog/post" target="_blank">我的论坛</a> (221)</li>
<li><a href="http://tsunzhang.iteye.com/blog/solution" target="_blank">我解决的问题</a> (0)</li>
</ul>
<h3 id="-">存档分类</h3>
<ul>
<li><a href="http://tsunzhang.iteye.com/blog/monthblog/2012-02" target="_blank">2012-02</a> (3)</li>
<li><a href="http://tsunzhang.iteye.com/blog/monthblog/2011-11" target="_blank">2011-11</a> (4)</li>
<li><a href="http://tsunzhang.iteye.com/blog/monthblog/2011-10" target="_blank">2011-10</a> (3)</li>
<li><p><a href="http://tsunzhang.iteye.com/blog/monthblog_more" target="_blank">更多存档...</a></p>
<h3 id="-">评论排行榜</h3>
</li>
<li><p><a href="http://tsunzhang.iteye.com/blog/1064298" title="关于shell脚本中报 “/bin/sh^M: bad interpreter: 没有那个文件或目录”的解决方法" target="_blank">关于shell脚本中报 “/bin/sh^M: bad int ...</a></p>
</li>
</ul>
<h3 id="-">最新评论</h3>
<ul>
<li><a href="http://ronqi.iteye.com/" target="_blank">RonQi</a>： 今天在CentOS上面做Tomcat的自启动，那个脚本文件是在 ...
<a href="http://tsunzhang.iteye.com/blog/1064298#bc2221452" target="_blank">关于shell脚本中报 “/bin/sh^M: bad interpreter: 没有那个文件或目录”的解决方法</a></li>
<li><a href="http://huqingwei311.iteye.com/" target="_blank">huqingwei311</a>： 非常感谢楼主，我的问题也解决了
<a href="http://tsunzhang.iteye.com/blog/758378#bc2216263" target="_blank">struts2与jasperreport整合不能显示图片imgags/px</a></li>
<li><a href="http://beisicao.iteye.com/" target="_blank">beisicao</a>： ...
<a href="http://tsunzhang.iteye.com/blog/732624#bc2208607" target="_blank">Applet安全限制和签名Applet</a></li>
<li><a href="http://tsunzhang.iteye.com/" target="_blank">coconut_zhang</a>： hastune 写道Struts2拦截器都是放在栈里的。 AO ...
<a href="http://tsunzhang.iteye.com/blog/811566#bc1997752" target="_blank">Struts2拦截器执行顺序</a></li>
<li><a href="http://hastune.iteye.com/" target="_blank">hastune</a>： Struts2拦截器都是放在栈里的。AOP就是需要一个Invo ...
<a href="http://tsunzhang.iteye.com/blog/811566#bc1997073" target="_blank">Struts2拦截器执行顺序</a>
声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。
© 2003-2011 ITeye.com. All rights reserved. [ 京ICP证110151号 京公网安备110105010620 ]
<img src="" alt=""></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/wrapper/">wrapper</a></li></span></span> | <span class="tags">Tagged <a href="/tags/wrapper/" class="label label-primary">wrapper</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-wrapper--发布Java程序为Windows（Linux）服务JavaServiceWrapper-/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-wrapper--发布Java程序为Windows（Linux）服务JavaServiceWrapper-" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-服务器-tomcat--Tomcat工作原理2/">Tomcat工作原理2</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-服务器-tomcat--Tomcat工作原理2/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="tomcat-2">Tomcat工作原理2</h1>
<p><a href="http://blog.csdn.net/haojun186/article/details/7467112" target="_blank">Tomcat工作原理2</a></p>
<p><a href="">门面设计模式</a></p>
<p>门面设计模式在 Tomcat 中有多处使用，在 Request 和 Response 对象封装中、Standard Wrapper 到 ServletConfig 封装中、ApplicationContext 到 ServletContext 封装中等都用到了这种设计模式。</p>
<p><a href="">门面设计模式的原理</a></p>
<p>这么多场合都用到了这种设计模式，那这种设计模式究竟能有什么作用呢？顾名思义，就是将一个东西封装成一个门面好与人家更容易进行交流，就像一个国家的外交部一样。</p>
<p>这种设计模式主要用在一个大的系统中有多个子系统组成时，这多个子系统肯定要涉及到相互通信，但是每个子系统又不能将自己的内部数据过多的暴露给其它系统，不然就没有必要划分子系统了。每个子系统都会设计一个门面，把别的系统感兴趣的数据封装起来，通过这个门面来进行访问。这就是门面设计模式存在的意义。</p>
<p>门面设计模式示意图如下：
<a href=""><strong>图 1. 门面示意图</strong></a>
<img src="" alt="图 1. 门面示意图"></p>
<p>Client 只能访问到 Façade 中提供的数据是门面设计模式的关键，至于 Client 如何访问 Façade 和 Subsystem 如何提供 Façade 门面设计模式并没有规定死。</p>
<p><a href="">Tomcat 的门面设计模式示例</a></p>
<p>Tomcat 中门面设计模式使用的很多，因为 Tomcat 中有很多不同组件，每个组件要相互交互数据，用门面模式隔离数据是个很好的方法。</p>
<p>下面是 Request 上使用的门面设计模式：
<a href=""><strong>图 2. Request 的门面设计模式类图</strong></a>
<img src="" alt="图 2. Request 的门面设计模式类图"></p>
<p>从图中可以看出 HttpRequestFacade 类封装了 HttpRequest 接口能够提供数据，通过 HttpRequestFacade 访问到的数据都被代理到 HttpRequest 中，通常被封装的对象都被设为 Private 或者 Protected 访问修饰，以防止在 Façade 中被直接访问。</p>
<p><a href="http://www.ibm.com/developerworks/cn/java/j-lo-tomcat2/#ibm-pcon" target="_blank">回页首</a></p>
<p><a href="">观察者设计模式</a></p>
<p>这种设计模式也是常用的设计方法通常也叫发布 - 订阅模式，也就是事件监听机制，通常在某个事件发生的前后会触发一些操作。</p>
<p><a href="">观察者模式的原理</a></p>
<p>观察者模式原理也很简单，就是你在做事的时候旁边总有一个人在盯着你，当你做的事情是它感兴趣的时候，它就会跟着做另外一些事情。但是盯着你的人必须要到你那去登记，不然你无法通知它。观察者模式通常包含下面这几个角色：</p>
<ul>
<li>Subject 就是抽象主题：它负责管理所有观察者的引用，同时定义主要的事件操作。</li>
<li>ConcreteSubject 具体主题：它实现了抽象主题的所有定义的接口，当自己发生变化时，会通知所有观察者。</li>
<li>Observer 观察者：监听主题发生变化相应的操作接口。</li>
</ul>
<p><a href="">Tomcat 的观察者模式示例</a></p>
<p>Tomcat 中观察者模式也有多处使用，前面讲的控制组件生命周期的 Lifecycle 就是这种模式的体现，还有对 Servlet 实例的创建、Session 的管理、Container 等都是同样的原理。下面主要看一下 Lifecycle 的具体实现。</p>
<p>Lifecycle 的观察者模式结构图：
<a href=""><strong>图 3. Lifecycle 的观察者模式结构图</strong></a>
<img src="" alt="图 3. Lifecycle 的观察者模式结构图"></p>
<p>上面的结构图中，LifecycleListener 代表的是抽象观察者，它定义一个 lifecycleEvent 方法，这个方法就是当主题变化时要执行的方法。 ServerLifecycleListener 代表的是具体的观察者，它实现了 LifecycleListener 接口的方法，就是这个具体的观察者具体的实现方式。Lifecycle 接口代表的是抽象主题，它定义了管理观察者的方法和它要所做的其它方法。而 StandardServer 代表的是具体主题，它实现了抽象主题的所有方法。这里 Tomcat 对观察者做了扩展，增加了另外两个类：LifecycleSupport、LifecycleEvent，它们作为辅助类扩展了观察者的功能。LifecycleEvent 使得可以定义事件类别，不同的事件可区别处理，更加灵活。LifecycleSupport 类代理了主题对多观察者的管理，将这个管理抽出来统一实现，以后如果修改只要修改 LifecycleSupport 类就可以了，不需要去修改所有具体主题，因为所有具体主题的对观察者的操作都被代理给 LifecycleSupport 类了。这可以认为是观察者模式的改进版。</p>
<p>LifecycleSupport 调用观察者的方法代码如下：
<a href=""><strong>清单 1. LifecycleSupport 中的 fireLifecycleEvent 方法</strong></a></p>
<p>public void fireLifecycleEvent(String type, Object data) {
    LifecycleEvent event = new LifecycleEvent(lifecycle, type, data);</p>
<pre><code>LifecycleListener interested[] = null;
synchronized (listeners) {

    interested = (LifecycleListener[]) listeners.clone();
}

for (int i = 0; i &lt; interested.length; i++)
    interested[i].lifecycleEvent(event);
</code></pre><p>}</p>
<p>主题是怎么通知观察者呢？看下面代码：
<a href=""><strong>清单 2. 容器中的 start 方法</strong></a></p>
<p>public void start() throws LifecycleException {
    lifecycle.fireLifecycleEvent(BEFORE_START_EVENT, null);</p>
<pre><code>lifecycle.fireLifecycleEvent(START_EVENT, null);
started = true;

synchronized (services) {
    for (int i = 0; i &lt; services.length; i++) {

        if (services[i] instanceof Lifecycle)
            ((Lifecycle) services[i]).start();

        }
    }

lifecycle.fireLifecycleEvent(AFTER_START_EVENT, null);
</code></pre><p>}</p>
<p><a href="http://www.ibm.com/developerworks/cn/java/j-lo-tomcat2/#ibm-pcon" target="_blank">回页首</a></p>
<p><a href="">命令设计模式</a></p>
<p>前面把 Tomcat 中两个核心组件 Connector 和 Container，比作一对夫妻。男的将接受过来的请求以命令的方式交给女主人。对应到 Connector 和 Container，Connector 也是通过命令模式调用 Container 的。</p>
<p><a href="">命令模式的原理</a></p>
<p>命令模式主要作用就是封装命令，把发出命令的责任和执行命令的责任分开。也是一种功能的分工。不同的模块可以对同一个命令做出不同解释。</p>
<p>下面是命令模式通常包含下面几个角色：</p>
<ul>
<li>Client：创建一个命令，并决定接受者</li>
<li>Command 命令：命令接口定义一个抽象方法</li>
<li>ConcreteCommand：具体命令，负责调用接受者的相应操作</li>
<li>Invoker 请求者：负责调用命令对象执行请求</li>
<li>Receiver 接受者：负责具体实施和执行一次请求</li>
</ul>
<p><a href="">Tomcat 中的命令模式的示例</a></p>
<p>Tomcat 中命令模式在 Connector 和 Container 组件之间有体现，Tomcat 作为一个应用服务器，无疑会接受到很多请求，如何分配和执行这些请求是必须的功能。</p>
<p>下面看一下 Tomcat 是如何实现命令模式的，下面是 Tomcat 命令模式的结构图：
<a href=""><strong>图 4. Tomcat 命令模式的结构图</strong></a>
<img src="" alt="图 4. Tomcat 命令模式的结构图"></p>
<p>Connector 作为抽象请求者，HttpConnector 作为具体请求者。HttpProcessor 作为命令。Container 作为命令的抽象接受者，ContainerBase 作为具体的接受者。客户端就是应用服务器 Server 组件了。Server 首先创建命令请求者 HttpConnector 对象，然后创建命令 HttpProcessor 命令对象。再把命令对象交给命令接受者 ContainerBase 容器来处理命令。命令的最终是被 Tomcat 的 Container 执行的。命令可以以队列的方式进来，Container 也可以以不同的方式来处理请求，如 HTTP1.0 协议和 HTTP1.1 的处理方式就会不同。</p>
<p><a href="http://www.ibm.com/developerworks/cn/java/j-lo-tomcat2/#ibm-pcon" target="_blank">回页首</a></p>
<p><a href="">责任链模式</a></p>
<p>Tomcat 中一个最容易发现的设计模式就是责任链模式，这个设计模式也是 Tomcat 中 Container 设计的基础，整个容器的就是通过一个链连接在一起，这个链一直将请求正确的传递给最终处理请求的那个 Servlet。</p>
<p><a href="">责任链模式的原理</a></p>
<p>责任链模式，就是很多对象有每个对象对其下家的引用而连接起来形成一条链，请求在这条链上传递，直到链上的某个对象处理此请求，或者每个对象都可以处理请求，并传给下一家，直到最终链上每个对象都处理完。这样可以不影响客户端而能够在链上增加任意的处理节点。</p>
<p>通常责任链模式包含下面几个角色：</p>
<ul>
<li>Handler（抽象处理者）：定义一个处理请求的接口</li>
<li>ConcreteHandler（具体处理者）：处理请求的具体类，或者传给下家</li>
</ul>
<p><a href="">Tomcat 中责任链模式示例</a></p>
<p>在 tomcat 中这种设计模式几乎被完整的使用，tomcat 的容器设置就是责任链模式，从 Engine 到 Host 再到 Context 一直到 Wrapper 都是通过一个链传递请求。</p>
<p>Tomcat 中责任链模式的类结构图如下：
<a href=""><strong>图 5. Tomcat 责任链模式的结构图</strong></a>
<img src="" alt="图 5. Tomcat 责任链模式的结构图"></p>
<p>上图基本描述了四个子容器使用责任链模式的类结构图，对应的责任链模式的角色，Container 扮演抽象处理者角色，具体处理者由 StandardEngine 等子容器扮演。与标准的责任链不同的是，这里引入了 Pipeline 和 Valve 接口。他们有什么作用呢？</p>
<p>实际上 Pipeline 和 Valve 是扩展了这个链的功能，使得在链往下传递过程中，能够接受外界的干预。Pipeline 就是连接每个子容器的管子，里面传递的 Request 和 Response 对象好比管子里流的水，而 Valve 就是这个管子上开的一个个小口子，让你有机会能够接触到里面的水，做一些额外的事情。</p>
<p>为了防止水被引出来而不能流到下一个容器中，每一段管子最后总有一个节点保证它一定能流到下一个子容器，所以每个容器都有一个 StandardXXXValve。只要涉及到这种有链式是处理流程这是一个非常值得借鉴的模式。
来源： <a href="[http://blog.csdn.net/haojun186/article/details/7467112](http://blog.csdn.net/haojun186/article/details/7467112)">[http://blog.csdn.net/haojun186/article/details/7467112](http://blog.csdn.net/haojun186/article/details/7467112)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/服务器/">服务器</a></li></span><span class="breadcrumb"><li><a href="/categories/服务器/">服务器</a></li><li><a href="/categories/服务器/tomcat/">tomcat</a></li></span></span> | <span class="tags">Tagged <a href="/tags/tomcat/" class="label label-primary">tomcat</a><a href="/tags/服务器/" class="label label-success">服务器</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-服务器-tomcat--Tomcat工作原理2/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-服务器-tomcat--Tomcat工作原理2" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-服务器-Nginx--Nginx调优/">Nginx调优</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-服务器-Nginx--Nginx调优/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="nginx-">Nginx调优</h1>
<p>这篇文章的目的是要谈谈我的 Nginx 调优经验，就不涉及数据库调优的内容了。</p>
<h3 id="-">初始服务器设置</h3>
<p>我的服务器运行在亚马逊 EC2 t1 micro 上，选择 Nginx + PHP5-fpm 作为后端，因为一些安全因素还打开了SSL。</p>
<h3 id="-">性能测试</h3>
<p>我使用了Blitz.io 来进行压力测试。下面是我使用的命令：
1 -p</p>
<p>1-250:60 <a href="https://mydomian.com" target="_blank">https://mydomian.com</a></p>
<p>这是一个用户线性递增的测试，每个测试用户跑60秒。Blitz.io为每个请求每秒增加4个( = rise / run = 260 / 60)测试用户。</p>
<h3 id="-">结论</h3>
<p>我把结论提前写在这里，如果你不想读完整篇文章也没有问题。</p>
<ol>
<li>Nginx默认设置的DH算法（译注：Diffie-Hellman key exchange algorithm）是影响SSL性能的最大因素，因此采用如下设置能增加SSL性能：
1</li>
</ol>
<p>2
3</p>
<p>4
5 ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</p>
<p>ssl_ciphers ECDHE</p>
<p>-RSA</p>
<p>-AES256-SHA384:AES256-SHA256:RC4:HIGH:!MD5:!aNULL:!eNULL:!NULL:!DH:!EDH:!AESGCM;
ssl_prefer_server_ciphers on;</p>
<p>ssl_session_cache shared:SSL:10m;
ssl_session_timeout 10m;</p>
<ol>
<li>升级硬件 Upgrade your EC2 from t1.micro to c1.medium</li>
<li>正确配置 Nginx的worker进程数量 Set Nginx to have 2 worker processes as a c1.medium gives you 2 CPUs</li>
</ol>
<h3 id="-">细节解释</h3>
<p>以下是我进行测试的详细过程。</p>
<p><strong>尝试1：升级硬件</strong></p>
<p>直觉告诉我，想解决性能问题的直接途径就是升级硬件，我把EC2实例从t1.micro升级到了为高流量而优化过的c1.medium</p>
<p>升级后的测试结果：
<img src="" alt=""></p>
<p>巅峰时服务器的hits达到50/sec，压力增加时，time-out增加，hits减少。</p>
<p><strong>尝试2：测试CPU性能</strong></p>
<p>我打开top然后重启了测试，注意到2个CPU的使用率不到13%，内存使用了300Mb，很明显硬件没有充分利用。所以我更改了nginx的设置</p>
<p>worker_processes 2;</p>
<p><strong>尝试3，4，5：调整Nginx和PHP5-fpm</strong></p>
<p>以下尝试得到的结果都和尝试1相同</p>
<p>尝试3：</p>
<p><strong>nginx.conf</strong>
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
 worker_processes 2;</p>
<p>events {
worker_connections 19000;</p>
<p>multi_accept on;
}</p>
<p>...</p>
<p>尝试4：</p>
<p><strong>nginx.conf</strong>
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15 worker_processes 2;</p>
<p>events {
worker_connections 19000;</p>
<p>multi_accept on;
}</p>
<p>http {
gzip on;</p>
<p>gzip_disable &quot;msie6&quot;;
gzip_min_length 1000;</p>
<p>gzip_proxied expired no-cache no-store private auth;
gzip_types text/plain application/xml application/javascript text/css application/x-javascript;</p>
<p>…
}</p>
<p>...</p>
<p>尝试5：</p>
<p>在尝试4未变的情况下我更改了php5-fpm的设置：
1</p>
<p>2
3</p>
<p>4
5 pm.max_children = 160</p>
<p>pm.start_servers = 24
pm.min_spare_servers = 20</p>
<p>pm.max_spare_servers = 35
pm.max_requests = 1500</p>
<h3 id="-6-"><strong>尝试6**</strong>：在另一个服务器部署**</h3>
<p>我有一个1.5Gb RAM和8CPU的<a href="http://blog.jobbole.com/go/linode/" title="Linode" target="_blank">Linode</a>服务器，采用刚才的设置，这是我的测试结果：
<img src="" alt=""></p>
<p><a href="http://blog.jobbole.com/go/linode/" title="Linode" target="_blank">Linode</a>的服务器的结果棒极了！我的第一个直觉是难道Linode比EC2好吗。在我把我的服务迁移到Linode之前我想确保两者仅有的对性能有可能产生影响的不同被排除掉。</p>
<p><strong>尝试7：大惊喜</strong></p>
<p>我Google到Nginx在SSL上有些问题。Nginx默认使用DHE算法来产生密匙，改变这个设置应该能使它快一些。</p>
<p>这里是我参考的一些文章：</p>
<p><a href="http://matt.io/entry/ur" target="_blank">http://matt.io/entry/ur</a></p>
<p><a href="http://auxbuss.com/blog/posts/2011_06_28_ssl_session_caching_on_nginx/" target="_blank">http://auxbuss.com/blog/posts/2011_06_28_ssl_session_caching_on_nginx/</a></p>
<p>所以我更改了nginx.conf，删掉了kEDH算法
1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15 worker_processes 2;</p>
<p>events {
worker_connections 1024;</p>
<p>}
http {</p>
<p>gzip on;
gzip_disable &quot;msie6&quot;;</p>
<p>gzip_min_length 1000;
gzip_proxied expired no-cache no-store private auth;</p>
<p>gzip_types text/plain application/xml application/javascript text/css application/x-javascript;
ssl_ciphers ALL:!kEDH!ADH:RC4+RSA:+HIGH:+EXP;</p>
<p>…
}</p>
<p>...</p>
<p>下图是测试结果：</p>
<p><img src="" alt=""></p>
<p>效果很显著！</p>
<p><strong>尝试8： 硬件提升是必要的吗</strong></p>
<p>现在我的EC2和Linode表现差不多了。但是我真的需要升级到c1.medium实例才能实现这个性能的提升吗？或许不是这样……所以我把我改回了t1.micro。因为t1.micro实例只有一个CPU，所以我把worder_processes设置改回1。下面是测试的结果：</p>
<p><img src="" alt=""></p>
<p>所以答案是肯定的，硬件上的提升是必要的。</p>
<p><strong>尝试9：</strong></p>
<p>有人在 Hacker News 上反馈说我的SSL密匙不能满足Perfect Forward Secrecy，我采用了他们的建议，对我的SSL设置做了如下更改：
1</p>
<p>2
3</p>
<p>4
5 ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</p>
<p>ssl_ciphers ECDHE-RSA-AES256-SHA384:AES256-SHA256:RC4:HIGH:!MD5:!aNULL:!eNULL:!NULL:!DH:!EDH:!AESGCM;
ssl_prefer_server_ciphers on;</p>
<p>ssl_session_cache shared:SSL:10m;
ssl_session_timeout 10m;</p>
<p>现在这个设置应该满足Perfect Forward Secrecy协议了。我重新跑了测试：</p>
<p><strong><a href="http://techsamurais.com/wp-content/uploads/2013/08/attempt10.png" title="Nginx SSL性能调优" target="_blank"><img src="" alt="attempt10"></a></strong></p>
<p>太棒了，性能也没有下降。很棒的学习经验！</p>
<p>来源： &lt;<a href="http://blog.jobbole.com/44844/" target="_blank">Nginx SSL性能调优 - 博客 - 伯乐在线</a>&gt; </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/服务器/">服务器</a></li></span><span class="breadcrumb"><li><a href="/categories/服务器/">服务器</a></li><li><a href="/categories/服务器/Nginx/">Nginx</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Nginx/" class="label label-primary">Nginx</a><a href="/tags/服务器/" class="label label-success">服务器</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-服务器-Nginx--Nginx调优/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-服务器-Nginx--Nginx调优" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--LongPI/">LongPI</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:44.000Z"> <a href="/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--LongPI/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="longpi">LongPI</h1>
<h1 id="-algorithm-gossip-pi-"><a href="">Algorithm Gossip: 长 PI</a></h1>
<h2 id="-">说明</h2>
<p>圆周率后的小数位数是无止境的，如何使用电脑来计算这无止境的小数是一些数学家与程式设计师所感兴趣的，在这边介绍一个公式配合 <a href="">大数运算</a>，可以计算指定位数的圆周率。</p>
<h2 id="-">解法</h2>
<p>首先介绍J.Marchin的圆周率公式：
PI = [16/5 - 16 / (3/<em>53) + 16 / (5/</em>55) - 16 / (7/<em>57) + ......] -
         [4/239 - 4/(3/</em>2393) + 4/(5/<em>2395) - 4/(7/</em>2397) + ......]
可以将这个公式整理为：
PI = [16/5 - 4/239] - [16/(53) - 4/(2393)]/3+ [16/(55) - 4/(2395)]/5 + ......
也就是说第n项，若为奇数则为正数，为偶数则为负数，而项数表示方式为：
[16/52/<em>n-1 - 4/2392/</em>n-1] / (2/<em>n-1)
如果我们要计算圆周率至10的负L次方，由于[16/52/</em>n-1 - 4/2392/<em>n-1]中16/52/</em>n-1比4/2392/<em>n-1来的大，具有决定性，所以表示至少必须计算至第n项：
[16/52/</em>n-1 ] / (2/<em>n-1) = 10-L
将上面的等式取log并经过化简，我们可以求得：
n = L / (2log5) = L / 1.39794
所以若要求精确度至小数后L位数，则只要求至公式的第n项，其中n等于：
n = [L/1.39794] + 1
在上式中[]为高斯符号，也就是取至整数（不大于L/1.39794的整数）；为了计简方便，可以在程式中使用下面这个公式来计简第n项：
[Wn-1/52- Vn-1 / (2392)] / (2/</em>n-1)
这个公式的演算法配合大数运算函式的演算法为：</p>
<p>div(w, 25, w);
div(v, 239, v);
div(v, 239, v);
sub(w, v, q);
div(q, 2/*k-1, q)</p>
<p>至于大数运算的演算法，请参考之前的文章，必须注意的是在输出时，由于是输出阵列中的整数值，如果阵列中整数位数不满四位，则必须补上0，在C语言中只要 使用格式指定字%04d，使得不足位数部份自动补上0再输出，至于Java的部份，使用 NumberFormat来作格式化。
您可以参考 <a href="http://crd.lbl.gov/%7Edhbailey/" target="_blank">这个网站</a> 有关于另一个用公式求PI的说明，它的实作在 <a href="http://crd.lbl.gov/%7Edhbailey/piqp.c" target="_blank">这边</a>。</p>
<h2 id="-">实作</h2>
<ul>
<li><p>C
/#include <stdio.h>
/#define L 1000
/#define N L/4+1
// L 为位数，N是array长度
void add(int/<em>, int/</em>, int/<em>);
void sub(int/</em>, int/<em>, int/</em>);
void div(int/<em>, int, int/</em>);
int main(void) {
int s[N+3] = {0};
int w[N+3] = {0};
int v[N+3] = {0};
int q[N+3] = {0};
int n = (int)(L/1.39793 + 1);
int k;
w[0] = 16/<em>5;
v[0] = 4/</em>239;
for(k = 1; k &lt;= n; k++) {
// 套用公式
div(w, 25, w);
div(v, 239, v);
div(v, 239, v);
sub(w, v, q);
div(q, 2/<em>k-1, q);
if(k%2) // 奇数项
add(s, q, s);
else // 偶数项
sub(s, q, s);
}
printf(&quot;%d.&quot;, s[0]);
for(k = 1; k &lt; N; k++)
printf(&quot;%04d&quot;, s[k]);
printf(&quot;\n&quot;);
return 0;
}
void add(int /</em>a, int /<em>b, int /</em>c) {
int i, carry = 0;
for(i = N+1; i &gt;= 0; i--) {
c[i] = a[i] + b[i] + carry;
if(c[i] &lt; 10000)
carry = 0;
else { // 进位
c[i] = c[i] - 10000;
carry = 1;
}
}
}
void sub(int /<em>a, int /</em>b, int /<em>c) {
int i, borrow = 0;
for(i = N+1; i &gt;= 0; i--) {
c[i] = a[i] - b[i] - borrow;
if(c[i] &gt;= 0)
borrow = 0;
else { // 借位
c[i] = c[i] + 10000;
borrow = 1;
}
}
}
void div(int /</em>a, int b, int /<em>c) { // b 为除数
int i, tmp, remain = 0;
for(i = 0; i &lt;= N+1; i++) {
tmp = a[i] + remain;
c[i] = tmp / b;
remain = (tmp % b) /</em> 10000;
}
}</p>
</li>
<li><p>Java
import java.text.NumberFormat;
public class LongPI {
public static void main(String[] args) {
final int L = 1000;
final int N = L/4+1;
int[] s = new int[N+3];
int[] w = new int[N+3];
int[] v = new int[N+3];
int[] q = new int[N+3];
int n = (int)(L/1.39793 + 1);
w[0] = 16/<em>5;
v[0] = 4/</em>239;
for(int k = 1; k &lt;= n; k++) {
// 套用公式
w = BigNumber.div(w, 25);
v = BigNumber.div(v, 239);
v = BigNumber.div(v, 239);
q = BigNumber.sub(w, v);
q = BigNumber.div(q, 2/*k-1);
if(k % 2 == 1) // 奇数项
s = BigNumber.add(s, q);
else // 偶数项
s = BigNumber.sub(s, q);
}
NumberFormat nf = NumberFormat.getInstance();
nf.setMinimumIntegerDigits(4);
System.out.print(s[0] + &quot;.&quot;);
for(int k = 1; k &lt; N; k++)
System.out.print(nf.format(s[k]));
System.out.println();
}
}</p>
</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/AlgorithmGossip/">AlgorithmGossip</a></li></span></span> | <span class="tags">Tagged <a href="/tags/AlgorithmGossip/" class="label label-primary">AlgorithmGossip</a></span> | <span class="time">recent updated:<time title="2014-03-07 10:37:00"datetime="2014-03-07 10:37:00"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-AlgorithmGossip-AlgorithmGossip--LongPI/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-AlgorithmGossip-AlgorithmGossip--LongPI" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/9/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/7/">7</a></li><li><a class="page-number" href="/page/8/">8</a></li><li><a class="page-number" href="/page/9/">9</a></li><li class="active"><li><span class="page-number current">10</span></li><li><a class="page-number" href="/page/11/">11</a></li><li><a class="page-number" href="/page/12/">12</a></li><li><a class="page-number" href="/page/13/">13</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/11/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-15 17:28:49</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
