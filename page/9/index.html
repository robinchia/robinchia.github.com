
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 9 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-webservice--Webservicesoapwsdl区别之个人见解/">Webservice soap wsdl区别之个人见解</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-webservice--Webservicesoapwsdl区别之个人见解/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="webservice-soap-wsdl-">Webservice soap wsdl区别之个人见解</h1>
<p><img src="" alt=""><img src="" alt=""> <img src="" alt=""> <a href="http://www.wudongqi.com/blogedit.asp?id=652" title="编辑该日志" target="_blank"><img src="" alt=""></a> <a href="http://www.wudongqi.com/blogedit.asp?action=del&amp;id=652" target="_blank"><img src="" alt=""></a>
    ● Web Service实现业务诉求：Web Service是真正“办事”的那个，提供一种办事接口的统称。
    ● WSDL提供“能办的事的文档说明”：对要提供的服务的一种描述格式。我想帮你的忙，但是我要告诉你我都能干什么，以及干这些事情需要的参数类型。
    ● SOAP提供“请求”的规范：向服务接口传递请求的格式，包括方法和参数等。你想让人家办事，总得告诉人家你想干什么吧，SOAP就是定义这个“请求”的格式的，按照SOAP定义的“请求”格式“书写”请求就可以保证Web Service能够正确的解读你想让它干什么以及你为它提供了什么参数。在这个请求中，你需要描述的主要问题有：向哪个Web Service发送请求，请求的参数类型、参数值、返回值类型。这些都“填写”完毕，也就完成了符合SOAP规范的SOAP消息。
    wsdl和soap虽然是web service的两大标准，但是两者并没有必然的联系，都可以独立使用。
    wsdl提供了一个统一的接口，目前已经成为一个国际上公认的标准，通过wsdl提供的接口可以访问不同类型的资源（如java、c/#、C、C、C++等），因为wsdl是基于xml，与语言平台无关的。另外wsdl提供了binding和service元素，用以绑定接口到具体的服务，实现了接口与实现的分离。
    soap（简单对象访问协议）是一种基于http的传输协议，用来访问远程服务
    wsdl与soap的关系在于：wsdl绑定服务的时候可以设定使用的协议，协议可以是soap、http、smtp、ftp等任何一种传输协议，除此以外wsdl还可以绑定jms、ejb及local java等等，不过都是需要对binding和service元素做扩展的，而且需要扩展服务器的功能以支持这种扩展
    soap协议是一种请求和应答协议规范，而http是web传输协议，soap的传输是可以基于http的，但也可以基于其他的传输协议，如ftp、smtp等。
    简单对象访问协议（SOAP）是W3C组织的一个Note, 它描述了一种在分散的或分布式的环境中如何交换信息的轻量级协议。SOAP是一个基于XML的协议，它包括三个部分：SOAP封装(Envelop)，封装定义了一个描述消息中的内容是什么，是谁发送的，谁应当接受并处理它以及如何处理它们的框架；SOAP编码规则（Encoding Rules），用于表示应用程序需要使用的数据类型的实例；SOAP RPC表示(RPC Representation)，表示远程过程调用和应答的协定；SOAP可以和多种传输协议绑定（Binding），使用底层协议交换信息。在这个文档中，目前只定义了SOAP如何和HTTP以及HTTP扩展进行绑定的框架。
    SOAP是个通信协议， SOAP在HTTP协议的基础上，把编写成XML的REQUEST参数, 放在HTTP BODY上提交个WEB SERVICE服务器(SERVLET，ASP什么的) 处理完成后，结果也写成XML作为RESPONSE送回用户端， 为了使用户端和WEB SERVICE可以相互对应，可以使用WSDL作为这种通信方式的描述文件，利用WSDL工具可以自动生成WS和用户端的框架文件，SOAP具备把复杂对象序列化捆绑到XML里去的能力。
    SOAP的前身是RPC, 就是远程呼叫处理的协议，这个协议安全性不是很好，多数防火墙都会阻挡RPC的通信包，而SOAP则使用HTTP协议作为基本的协议，使用端口80使得SOAP可以透过防火墙，完成RPC的功能。
    SOAP协议和HTTP协议一样，都是底层的通信协议，只是请求包的格式不同而已，SOAP包是XML格式的，现在我们编写WEB SERVICE不需要深入理解SOAP也没关系。如果SERVICE和CLIENT在同样的环境下使用SOAP，由于一般情况下都有自动生成SOAP程序框架的工具，因此不知道细节也没关系. 可是, 如果CLIENT和SERVICE的环境不同，比如说JAVA的Client和.NET的SERVICE进行通信，或者是VB CLIENT和TOMCAT下的JAVA SERVICE通信，还是要知道一点细节为好. 特别是, WSDL或者UDDI都不是标准，如果不让用就只好手工配制SOAP MESSAGE啦。</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/webservice/">webservice</a></li></span></span> | <span class="tags">Tagged <a href="/tags/webservice/" class="label label-primary">webservice</a></span> | <span class="time">recent updated:<time title="2014-03-07 10:27:47"datetime="2014-03-07 10:27:47"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-webservice--Webservicesoapwsdl区别之个人见解/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-webservice--Webservicesoapwsdl区别之个人见解" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-webservice--Java开发的WebService获取客户端IP地址/">Java开发的WebService获取客户端IP地址_数据库 开发_比特网</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-webservice--Java开发的WebService获取客户端IP地址/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-webservice-ip-">Java开发WebService获取客户端IP地址</h1>
<p>1.基于jax-ws开发的webservice获取客户端ip的方法【在代理类XXXDelegate添加如下代码】：</p>
<p>import javax.annotation.Resource;</p>
<p>import javax.servlet.http.HttpServletRequest;</p>
<p>import javax.xml.ws.WebServiceContext;</p>
<p>import javax.xml.ws.handler.MessageContext;</p>
<p>@Resource</p>
<p>private WebServiceContext wsContext;</p>
<p>private String getClientInfo(){</p>
<p>MessageContext mc = wsContext.getMessageContext();</p>
<p>HttpServletRequest request = (HttpServletRequest)(mc.get(MessageContext.SERVLET_REQUEST));</p>
<p>String remortAddress = request.getRemoteAddr();</p>
<p>return (remortAddress);</p>
<p>}</p>
<p>2.基于axis发布的webservice获取客户端ip的方法</p>
<p>//<em>/</em></p>
<p>/* 获取客户端IP地址，如调用方的IP，以便检查权限。</p>
<p>/* 适用于axis发布的webservice</p>
<p>/* @return</p>
<p>/*/</p>
<p>public String getClientIpAxis() {</p>
<p>MessageContext mc = null;</p>
<p>HttpServletRequest request = null;</p>
<p>try {</p>
<p>mc = MessageContext.getCurrentMessageContext();</p>
<p>if (mc == null)</p>
<p>throw new Exception(“无法获取到MessageContext”);</p>
<p>request = (HttpServletRequest) mc</p>
<p>.getProperty(HTTPConstants.MC_HTTP_SERVLETREQUEST);</p>
<p>System.out.println(“remote ip: ” + request.getRemoteAddr());</p>
<p>} catch (Exception e) {</p>
<p>System.out.println(e.getMessage());</p>
<p>e.printStackTrace();</p>
<p>}</p>
<p>return request.getRemoteAddr();</p>
<p>}</p>
<p>3.基于xfire发布的webservice获取客户端ip的方法</p>
<p>//<em>/</em></p>
<p>/* 获取客户端IP地址</p>
<p>/* 适用于xfire发布的webservice</p>
<p>/* @return</p>
<p>/*/</p>
<p>public String getClientIpXfire() {</p>
<p>String ip = “”;</p>
<p>try {</p>
<p>HttpServletRequest request = XFireServletController.getRequest();</p>
<p>ip = request.getRemoteAddr();</p>
<p>} catch (Exception e) {</p>
<p>System.out.println(“无法获取HttpServletRequest.”);</p>
<p>e.printStackTrace();</p>
<p>}</p>
<p>return ip;</p>
<p>}
关键字：Java</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/webservice/">webservice</a></li></span></span> | <span class="tags">Tagged <a href="/tags/webservice/" class="label label-primary">webservice</a></span> | <span class="time">recent updated:<time title="2014-03-07 10:39:04"datetime="2014-03-07 10:39:04"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-webservice--Java开发的WebService获取客户端IP地址/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-webservice--Java开发的WebService获取客户端IP地址" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-wrapper--JavaServiceWrapper-LoggingConfigurationPrope/">Java Service Wrapper </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-wrapper--JavaServiceWrapper-LoggingConfigurationPrope/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-service-wrapper-logging-configuration-properties">Java Service Wrapper - Logging Configuration Properties</h1>
<p><img src="" alt="World Map">EnglishJapanese (Nihongo)German (Deutsch)</p>
<p><strong>Please  or</strong></p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/" target="_blank"><img src="" alt="Java Service Wrapper Logo"></a></li>
<li><a href="http://www.tanukisoftware.com/" target="_blank"><img src="" alt="Tanuki Software Ltd Logo"></a></li>
</ul>
<p>Java Service Wrapper is the easiest way to make your product more reliable.</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/requestTrial.jsp" target="_blank"><img src="" alt="Free Trial"></a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/accountLicenses.jsp" target="_blank"><img src="" alt="Buy Now"></a></li>
<li><a href="http://www.tanukisoftware.com/" target="_blank">Tanuki Software</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/" target="_blank">Java Service Wrapper</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/download.jsp" target="_blank">Home</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/product-overview.html" target="_blank">Product</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/product-overview.html" target="_blank">Overview</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/product-features.html" target="_blank">Features</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/licenseOverview.html" target="_blank">License</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/faq.html" target="_blank">FAQ</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/download.jsp" target="_blank">Download</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/download.jsp#stable" target="_blank">Stable Release</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/release-notes.html" target="_blank">Release Notes</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/versions.jsp" target="_blank">Past Releases</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/accountLicenses.jsp#purchase" target="_blank">Order</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/accountLicenses.jsp#purchase" target="_blank">Buy now</a></p>
</li>
<li><a href="http://www.tanukisoftware.com/en/distributors.php" target="_blank">Distributors</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/licenseOverview.html" target="_blank">License Overview</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/licenseOverview.html#examples" target="_blank">License FAQ</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/introduction.html" target="_blank">Documentation</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/introduction.html" target="_blank">Introduction</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/integrate.html" target="_blank">Integration Methods</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/launch.html" target="_blank">Launching your Application</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/properties.html" target="_blank">Configuration Properties</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/javadocs.html" target="_blank">Java API</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/i18n.html" target="_blank">Localization / i18n</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/security-model.html" target="_blank">Security Model</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/jmx.html" target="_blank">JMX Control</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/example.html" target="_blank">TestWrapper Application</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/support.jsp" target="_blank">Support</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/debugging.html" target="_blank">Debugging</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/troubleshooting.html" target="_blank">Troubleshooting</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/howto.html" target="_blank">HOWTO</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/qna.html" target="_blank">Questions &amp; Answers</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/faq.html" target="_blank">FAQ</a></li>
<li><a href="http://sourceforge.net/tracker/?group_id=39428" target="_blank">Issue Tracking</a></li>
<li><a href="http://sourceforge.net/mail/?group_id=39428" target="_blank">Maling List</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/support.jsp" target="_blank">Get Support</a></li>
<li><p><a href="http://sourceforge.net/projects/wrapper/" target="_blank">Community</a></p>
</li>
<li><p><a href="http://sourceforge.net/projects/wrapper/" target="_blank">SourceForge Project</a></p>
</li>
<li><a href="http://sourceforge.net/svn/?group_id=39428" target="_blank">Source Repository</a></li>
<li><p><a href="http://www.tanukisoftware.com/en/" target="_blank">About us</a></p>
</li>
<li><p><a href="http://www.tanukisoftware.com/en/company.php" target="_blank">Company Profile</a></p>
</li>
<li><a href="http://www.tanukisoftware.com/en/distributors.php" target="_blank">Distributors</a></li>
<li><a href="http://www.tanukisoftware.com/en/customers.php" target="_blank">Customers</a></li>
<li><a href="http://www.tanukisoftware.com/en/contact.php" target="_blank">Contact us</a></li>
<li><h2 id="properties">Properties</h2>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/properties.html" target="_blank">Configuration Overview</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/properties.html#category" target="_blank">List by Category</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/properties.html#name" target="_blank">List by Name</a></p>
</li>
<li><h2 id="currently-logged-on-">Currently logged on:</h2>
</li>
<li><p>1 users, 100 guests</p>
</li>
<li><h2 id="customers">Customers</h2>
</li>
</ul>
<p>Logging Configuration Properties <a href=""></a> # Logging Configuration Properties Logging properties are used to configure how where the Java Service Wrapper logs internal output as well as JVM output which would normally show up in the console used to launch a Java application. Wrapper Logging properties do not in any way control nor replace Logging tools within the Java application.</p>
<p>[General/Common]</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-adviser.html" target="_blank">wrapper.adviser</a> (3.1.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-debug.html" target="_blank">wrapper.debug</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-filter-x-n.html#action" target="_blank">wrapper.filter.action.<n></a> (3.0.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-filter-x-n.html#allow-wildcards" target="_blank">wrapper.filter.allow_wildcards.<n></a> (3.5.5)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-filter-x-n.html#message" target="_blank">wrapper.filter.message.<n></a> (3.5.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-filter-x-n.html#trigger" target="_blank">wrapper.filter.trigger.<n></a> (3.0.0)</li>
</ul>
<p>[Console]</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-console-flush.html" target="_blank">wrapper.console.flush</a> (3.2.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-console-format.html" target="_blank">wrapper.console.format</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/prop-console-loglevel.html" target="_blank">wrapper.console.loglevel</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/prop-console-x-to-stderr.html" target="_blank">wrapper.console.error_to_stderr</a> (3.5.3)</p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-console-x-to-stderr.html" target="_blank">wrapper.console.fatal_to_stderr</a> (3.5.3)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-console-x-to-stderr.html" target="_blank">wrapper.console.warn_to_stderr</a> (3.5.3)</li>
</ul>
<p>[Command]</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-java-command-loglevel.html" target="_blank">wrapper.java.command.loglevel</a> (3.1.2)</li>
</ul>
<p>[Log File]</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile.html" target="_blank">wrapper.logfile</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-format.html" target="_blank">wrapper.logfile.format</a> (2.2.5)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-inactivity-timeout.html" target="_blank">wrapper.logfile.inactivity.timeout</a> (3.2.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-loglevel.html" target="_blank">wrapper.logfile.loglevel</a> (2.2.5)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-maxfiles.html" target="_blank">wrapper.logfile.maxfiles</a> (2.2.5)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-maxsize.html" target="_blank">wrapper.logfile.maxsize</a> (2.2.5)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-purge-pattern.html" target="_blank">wrapper.logfile.purge.pattern</a> (3.3.8)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-purge-sort.html" target="_blank">wrapper.logfile.purge.sort</a> (3.3.8)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logfile-rollmode.html" target="_blank">wrapper.logfile.rollmode</a> (3.2.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-umask.html#x-umask" target="_blank">wrapper.logfile.umask</a> (3.2.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-log-lf-delay-threshold.html" target="_blank">wrapper.log.lf_delay.threshold</a> (3.5.10)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-log-warning-threshold.html" target="_blank">wrapper.log.warning.threshold</a> (3.5.8)</li>
</ul>
<p>[Log-Dialog]</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logdialog-enable.html" target="_blank">wrapper.logdialog.enable</a> (3.3.1)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logdialog-format.html" target="_blank">wrapper.logdialog.format</a> (3.3.1)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logdialog-lines.html" target="_blank">wrapper.logdialog.lines</a> (3.3.1)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-logdialog-loglevel.html" target="_blank">wrapper.logdialog.loglevel</a> (3.3.1)</li>
</ul>
<p>[Syslog]</p>
<ul>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-syslog-facility.html" target="_blank">wrapper.syslog.facility</a> (3.2.1)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-syslog-ident.html" target="_blank">wrapper.syslog.ident</a> (3.2.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-syslog-local-host.html" target="_blank">wrapper.syslog.local.host</a> (3.5.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-syslog-loglevel.html" target="_blank">wrapper.syslog.loglevel</a> (2.2.5)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-syslog-remote-host.html" target="_blank">wrapper.syslog.remote.host</a> (3.5.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/prop-syslog-remote-port.html" target="_blank">wrapper.syslog.remote.port</a> (3.5.0)</li>
<li><a href="http://wrapper.tanukisoftware.com/" target="_blank"><img src="" alt=""></a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/product-overview.html" target="_blank">Product</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/product-overview.html" target="_blank">Overview</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/product-features.html" target="_blank">Features</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/download.jsp#stable" target="_blank">Download</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/accountLicenses.jsp#purchase" target="_blank">Buy Now</a></li>
<li><a href="http://www.tanukisoftware.com/en/distributors.php" target="_blank">Distribuitors</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/introduction.html" target="_blank">Documentation</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/introduction.html" target="_blank">Introduction</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/integrate.html" target="_blank">Integration Methods</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/properties.html" target="_blank">Configuration Properties</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/javadocs.html" target="_blank">Java API</a></li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/support.jsp" target="_blank">Support</a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/debugging.html" target="_blank">Debugging</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/troubleshooting.html" target="_blank">Troubleshooting</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/qna.html" target="_blank">Questions &amp; Answers</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/faq.html" target="_blank">FAQ</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/english/support.jsp" target="_blank">Get Support</a></li>
<li><p><a href="http://sourceforge.net/projects/wrapper/" target="_blank">Community</a></p>
</li>
<li><p><a href="http://sourceforge.net/projects/wrapper/" target="_blank"><img src="" alt="SourceForge Project"></a></p>
</li>
<li><p><a href="http://wrapper.tanukisoftware.com/doc/english/" target="_blank">English</a></p>
</li>
<li><a href="http://wrapper.tanukisoftware.com/doc/japanese/" target="_blank">日本語</a></li>
<li><a href="http://wrapper.tanukisoftware.com/doc/german/" target="_blank">Deutsch</a>
Copyright (c) 2004-2011, Tanuki Software, Ltd. All Rights Reserved.</li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/wrapper/">wrapper</a></li></span></span> | <span class="tags">Tagged <a href="/tags/wrapper/" class="label label-primary">wrapper</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-wrapper--JavaServiceWrapper-LoggingConfigurationPrope/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-wrapper--JavaServiceWrapper-LoggingConfigurationPrope" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-ftp--ApacheFTP实用代码/">Apache FTP 实用代码</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-ftp--ApacheFTP实用代码/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="apache-ftp-">Apache FTP 实用代码</h1>
<h2 id="-apache-commons-net-ftputil-">结合网上两个使用apache commons-net包的两个优秀的代码，结合实际，写出了如下的FtpUtil，供参考！</h2>
<p>参考网址：<a href="http://www.iteye.com/topic/173786" target="_blank"><a href="http://www.iteye.com/topic/173786">http://www.iteye.com/topic/173786</a></a>，<a href="http://hi.baidu.com/victorlin23/blog/item/edc62a35dbae8a1a91ef3947.html" target="_blank"><a href="http://hi.baidu.com/victorlin23/blog/item/edc62a35dbae8a1a91ef3947.html">http://hi.baidu.com/victorlin23/blog/item/edc62a35dbae8a1a91ef3947.html</a></a></p>
<h2 id="-"> </h2>
<p>package com.pccw.portlet.publictools;</p>
<p>import java.io.File;</p>
<p>import java.io.FileOutputStream;</p>
<p>import java.io.IOException;</p>
<p>import java.io.InputStream;</p>
<p>import java.io.OutputStream;</p>
<p>import java.io.RandomAccessFile;</p>
<p>import java.net.SocketException;</p>
<p>import java.util.ArrayList;</p>
<p>import java.util.List;</p>
<p>import org.apache.commons.logging.Log;</p>
<p>import org.apache.commons.logging.LogFactory;</p>
<p>import org.apache.commons.net.ftp.FTP;</p>
<p>import org.apache.commons.net.ftp.FTPClient;</p>
<p>import org.apache.commons.net.ftp.FTPFile;</p>
<p>import org.apache.commons.net.ftp.FTPReply;</p>
<p>//<em>/</em></p>
<p> /* FTP工具类</p>
<p> /*</p>
<p> /* @author WangXianfeng 1:16:50 PM Jul 16, 2011</p>
<p> /*/</p>
<p>public class FtpUtil {</p>
<pre><code>   private FTPClient ftpClient;

   private static Log log = LogFactory.getLog(FtpUtil.class);



   //*/*

    /* 根路径为&quot;/&quot;,如果需要链接服务器之后跳转到路径，则在path中定义

    /* @param ftpConfig

    /* @throws SocketException

    /* @throws IOException

    /*/

   public boolean connectServer(FtpConfig ftpConfig) throws SocketException,

                 IOException {

          String server = ftpConfig.getServer();

          int port = ftpConfig.getPort();

          String user = ftpConfig.getUsername();

          String password = ftpConfig.getPassword();

          String path = ftpConfig.getPath();

          return connectServer(server, port, user, password, path);

   }

   //*/*

    /* 连接ftp服务器

    /* @param server 服务器ip

    /* @param port 端口，通常为21

    /* @param user 用户名

    /* @param password 密码

    /* @param path 进入服务器之后的默认路径

    /* @return 连接成功返回true，否则返回false

    /* @throws SocketException

    /* @throws IOException

    /*/

   public boolean connectServer(String server, int port, String user,

                 String password, String path) throws SocketException, IOException {

          ftpClient = new FTPClient();

          ftpClient.connect(server, port);

          ftpClient.setControlEncoding(&quot;GBK&quot;);

          log.info(&quot;Connected to &quot; + server + &quot;.&quot;);

          log.info(&quot;FTP server reply code:&quot; + ftpClient.getReplyCode());

          if (FTPReply.isPositiveCompletion(ftpClient.getReplyCode())) {

                 if (ftpClient.login(user, password)) {

                        // Path is the sub-path of the FTP path

                        if (path.length() != 0) {

                               ftpClient.changeWorkingDirectory(path);

                        }

                        return true;

                 }

          }

          disconnect();

          return false;

   }

   //*/*

    /* 断开与远程服务器的连接

    /* @throws IOException

    /*/

   public void disconnect() throws IOException {

          if (ftpClient.isConnected()) {

                 ftpClient.disconnect();

          }

   }



   //*/*

    /* 从FTP服务器上下载文件,支持断点续传，下载百分比汇报

    /* @param remote 远程文件路径及名称

    /* @param local 本地文件完整绝对路径

    /* @return 下载的状态

    /* @throws IOException

    /*/

   public DownloadStatus download(String remote, String local)

                 throws IOException {

          // 设置被动模式

          ftpClient.enterLocalPassiveMode();

          // 设置以二进制方式传输

          ftpClient.setFileType(FTP.BINARY_FILE_TYPE);

          DownloadStatus result;



          // 检查远程文件是否存在

          FTPFile[] files = ftpClient.listFiles(new String(

                        remote.getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;));

          if (files.length != 1) {

                 log.info(&quot;远程文件不存在&quot;);

                 return DownloadStatus.RemoteFileNotExist;

          }



          long lRemoteSize = files[0].getSize();

          File f = new File(local);

          // 本地存在文件，进行断点下载

          if (f.exists()) {

                 long localSize = f.length();

                 // 判断本地文件大小是否大于远程文件大小

                 if (localSize &gt;= lRemoteSize) {

                        log.info(&quot;本地文件大于远程文件，下载中止&quot;);

                        return DownloadStatus.LocalFileBiggerThanRemoteFile;

                 }



                 // 进行断点续传，并记录状态

                 FileOutputStream out = new FileOutputStream(f, true);

                 ftpClient.setRestartOffset(localSize);

                 InputStream in = ftpClient.retrieveFileStream(new String(remote

                               .getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;));

                 byte[] bytes = new byte[1024];

                 long step = lRemoteSize / 100;

                 step = step==0?1:step;//文件过小，step可能为0

                 long process = localSize / step;

                 int c;

                 while ((c = in.read(bytes)) != -1) {

                        out.write(bytes, 0, c);

                        localSize += c;

                        long nowProcess = localSize / step;

                        if (nowProcess &gt; process) {

                               process = nowProcess;

                               if (process % 10 == 0){

                                      log.info(&quot;下载进度：&quot; + process);

                               }

                        }

                 }

                 in.close();

                 out.close();

                 boolean isDo = ftpClient.completePendingCommand();

                 if (isDo) {

                        result = DownloadStatus.DownloadFromBreakSuccess;

                 } else {

                        result = DownloadStatus.DownloadFromBreakFailed;

                 }

          } else {

                 OutputStream out = new FileOutputStream(f);

                 InputStream in = ftpClient.retrieveFileStream(new String(remote

                               .getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;));

                 byte[] bytes = new byte[1024];

                 long step = lRemoteSize / 100;

                 step = step==0?1:step;//文件过小，step可能为0

                 long process = 0;

                 long localSize = 0L;

                 int c;

                 while ((c = in.read(bytes)) != -1) {

                        out.write(bytes, 0, c);

                        localSize += c;

                        long nowProcess = localSize / step;

                        if (nowProcess &gt; process) {

                               process = nowProcess;

                               if (process % 10 == 0){

                                      log.info(&quot;下载进度：&quot; + process);

                               }

                        }

                 }

                 in.close();

                 out.close();

                 boolean upNewStatus = ftpClient.completePendingCommand();

                 if (upNewStatus) {

                        result = DownloadStatus.DownloadNewSuccess;

                 } else {

                        result = DownloadStatus.DownloadNewFailed;

                 }

          }

          return result;

   }



   public boolean changeDirectory(String path) throws IOException {

          return ftpClient.changeWorkingDirectory(path);

   }



   public boolean createDirectory(String pathName) throws IOException {

          return ftpClient.makeDirectory(pathName);

   }



   public boolean removeDirectory(String path) throws IOException {

          return ftpClient.removeDirectory(path);

   }



   public boolean removeDirectory(String path, boolean isAll)

                 throws IOException {



          if (!isAll) {

                 return removeDirectory(path);

          }



          FTPFile[] ftpFileArr = ftpClient.listFiles(path);

          if (ftpFileArr == null || ftpFileArr.length == 0) {

                 return removeDirectory(path);

          }

          //  

          for (FTPFile ftpFile : ftpFileArr) {

                 String name = ftpFile.getName();

                 if (ftpFile.isDirectory()) {

                        log.info(&quot;/* [sD]Delete subPath [&quot; + path + &quot;/&quot; + name + &quot;]&quot;);

                        if (!ftpFile.getName().equals(&quot;.&quot;)

                                      &amp;&amp; (!ftpFile.getName().equals(&quot;..&quot;))) {

                               removeDirectory(path + &quot;/&quot; + name, true);

                        }

                 } else if (ftpFile.isFile()) {

                        log.info(&quot;/* [sF]Delete file [&quot; + path + &quot;/&quot; + name + &quot;]&quot;);

                        deleteFile(path + &quot;/&quot; + name);

                 } else if (ftpFile.isSymbolicLink()) {



                 } else if (ftpFile.isUnknown()) {



                 }

          }

          return ftpClient.removeDirectory(path);

   }



   //*/*

    /* 查看目录是否存在

    /* @param path

    /* @return

    /* @throws IOException

    /*/

   public boolean isDirectoryExists(String path) throws IOException {

          boolean flag = false;

          FTPFile[] ftpFileArr = ftpClient.listFiles(path);

          for (FTPFile ftpFile : ftpFileArr) {

                 if (ftpFile.isDirectory()

                               &amp;&amp; ftpFile.getName().equalsIgnoreCase(path)) {

                        flag = true;

                        break;

                 }

          }

          return flag;

   }



   //*/*

    /* 得到某个目录下的文件名列表

    /* @param path

    /* @return

    /* @throws IOException

    /*/

   public List&lt;String&gt; getFileList(String path) throws IOException {

          // listFiles return contains directory and file, it&#39;s FTPFile instance

          // listNames() contains directory, so using following to filer

          // directory.

          // String[] fileNameArr = ftpClient.listNames(path);

          FTPFile[] ftpFiles = ftpClient.listFiles(path);



          List&lt;String&gt; retList = new ArrayList&lt;String&gt;();

          if (ftpFiles == null || ftpFiles.length == 0) {

                 return retList;

          }

          for (FTPFile ftpFile : ftpFiles) {

                 if (ftpFile.isFile()) {

                        retList.add(ftpFile.getName());

                 }

          }

          return retList;

   }



   public boolean deleteFile(String pathName) throws IOException {

          return ftpClient.deleteFile(pathName);

   }



   //*/*

    /* 上传文件到FTP服务器，支持断点续传

    /* @param local 本地文件名称，绝对路径

    /* @param remote 远程文件路径，按照Linux上的路径指定方式，支持多级目录嵌套，支持递归创建不存在的目录结构

    /* @return 上传结果

    /* @throws IOException

    /*/

   public UploadStatus upload(String local, String remote) throws IOException {

          // 设置PassiveMode传输

          ftpClient.enterLocalPassiveMode();

          // 设置以二进制流的方式传输

          ftpClient.setFileType(FTP.BINARY_FILE_TYPE);

          ftpClient.setControlEncoding(&quot;GBK&quot;);

          UploadStatus result;

          // 对远程目录的处理

          String remoteFileName = remote;

          if (remote.contains(&quot;/&quot;)) {

                 remoteFileName = remote.substring(remote.lastIndexOf(&quot;/&quot;) + 1);

                 // 创建服务器远程目录结构，创建失败直接返回

                 if (createDirecroty(remote, ftpClient) == UploadStatus.CreateDirectoryFail) {

                        return UploadStatus.CreateDirectoryFail;

                 }

          }



          // 检查远程是否存在文件

          FTPFile[] files = ftpClient.listFiles(new String(remoteFileName

                        .getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;));

          if (files.length == 1) {

                 long remoteSize = files[0].getSize();

                 File f = new File(local);

                 long localSize = f.length();

                 if (remoteSize == localSize) { // 文件存在

                        return UploadStatus.FileExits;

                 } else if (remoteSize &gt; localSize) {

                        return UploadStatus.RemoteFileBiggerThanLocalFile;

                 }



                 // 尝试移动文件内读取指针,实现断点续传

                 result = uploadFile(remoteFileName, f, ftpClient, remoteSize);



                 // 如果断点续传没有成功，则删除服务器上文件，重新上传

                 if (result == UploadStatus.UploadFromBreakFailed) {

                        if (!ftpClient.deleteFile(remoteFileName)) {

                               return UploadStatus.DeleteRemoteFaild;

                        }

                        result = uploadFile(remoteFileName, f, ftpClient, 0);

                 }

          } else {

                 result = uploadFile(remoteFileName, new File(local), ftpClient, 0);

          }

          return result;

   }



   //*/*

    /* 递归创建远程服务器目录

    /* @param remote 远程服务器文件绝对路径

    /* @param ftpClient FTPClient对象

    /* @return 目录创建是否成功

    /* @throws IOException

    /*/

   public UploadStatus createDirecroty(String remote, FTPClient ftpClient)

                 throws IOException {

          UploadStatus status = UploadStatus.CreateDirectorySuccess;

          String directory = remote.substring(0, remote.lastIndexOf(&quot;/&quot;) + 1);

          if (!directory.equalsIgnoreCase(&quot;/&quot;)

                        &amp;&amp; !ftpClient.changeWorkingDirectory(new String(directory

                                      .getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;))) {

                 // 如果远程目录不存在，则递归创建远程服务器目录

                 int start = 0;

                 int end = 0;

                 if (directory.startsWith(&quot;/&quot;)) {

                        start = 1;

                 } else {

                        start = 0;

                 }

                 end = directory.indexOf(&quot;/&quot;, start);

                 while (true) {

                        String subDirectory = new String(remote.substring(start, end)

                                      .getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;);

                        if (!ftpClient.changeWorkingDirectory(subDirectory)) {

                               if (ftpClient.makeDirectory(subDirectory)) {

                                      ftpClient.changeWorkingDirectory(subDirectory);

                               } else {

                                      log.info(&quot;创建目录失败&quot;);

                                      return UploadStatus.CreateDirectoryFail;

                               }

                        }

                        start = end + 1;

                        end = directory.indexOf(&quot;/&quot;, start);

                        // 检查所有目录是否创建完毕

                        if (end &lt;= start) {

                               break;

                        }

                 }

          }

          return status;

   }



   //*/*

    /* 上传文件到服务器,新上传和断点续传

    /* @param remoteFile 远程文件名，在上传之前已经将服务器工作目录做了改变

    /* @param localFile 本地文件File句柄，绝对路径

    /* @param processStep 需要显示的处理进度步进值

    /* @param ftpClient FTPClient引用

    /* @return

    /* @throws IOException

    /*/

   public UploadStatus uploadFile(String remoteFile, File localFile,

                 FTPClient ftpClient, long remoteSize) throws IOException {

          UploadStatus status;

          // 显示进度的上传

          System.out.println(&quot;localFile.length():&quot;+localFile.length());

          long step = localFile.length() / 100;

          step = step==0?1:step;//文件过小，step可能为0

          long process = 0;

          long localreadbytes = 0L;

          RandomAccessFile raf = new RandomAccessFile(localFile, &quot;r&quot;);

          OutputStream out = ftpClient.appendFileStream(new String(remoteFile

                        .getBytes(&quot;GBK&quot;), &quot;iso-8859-1&quot;));

          // 断点续传

          if (remoteSize &gt; 0) {

                 ftpClient.setRestartOffset(remoteSize);

                 process = remoteSize / step;

                 raf.seek(remoteSize);

                 localreadbytes = remoteSize;

          }

          byte[] bytes = new byte[1024];

          int c;

          while ((c = raf.read(bytes)) != -1) {

                 out.write(bytes, 0, c);

                 localreadbytes += c;

                 if (localreadbytes / step != process) {

                        process = localreadbytes / step;

                        if (process % 10 == 0){

                               log.info(&quot;上传进度：&quot; + process);

                        }

                 }

          }

          out.flush();

          raf.close();

          out.close();

          boolean result = ftpClient.completePendingCommand();

          if (remoteSize &gt; 0) {

                 status = result ? UploadStatus.UploadFromBreakSuccess

                               : UploadStatus.UploadFromBreakFailed;

          } else {

                 status = result ? UploadStatus.UploadNewFileSuccess

                               : UploadStatus.UploadNewFileFailed;

          }

          return status;

   }



   public InputStream downFile(String sourceFileName) throws IOException {

          return ftpClient.retrieveFileStream(sourceFileName);

   }



   public enum UploadStatus {

          CreateDirectoryFail, // 远程服务器相应目录创建失败

          CreateDirectorySuccess, // 远程服务器闯将目录成功

          UploadNewFileSuccess, // 上传新文件成功

          UploadNewFileFailed, // 上传新文件失败

          FileExits, // 文件已经存在

          RemoteFileBiggerThanLocalFile, // 远程文件大于本地文件

          UploadFromBreakSuccess, // 断点续传成功

          UploadFromBreakFailed, // 断点续传失败

          DeleteRemoteFaild; // 删除远程文件失败

   }



   public enum DownloadStatus {

          RemoteFileNotExist, // 远程文件不存在

          DownloadNewSuccess, // 下载文件成功

          DownloadNewFailed, // 下载文件失败

          LocalFileBiggerThanRemoteFile, // 本地文件大于远程文件

          DownloadFromBreakSuccess, // 断点续传成功

          DownloadFromBreakFailed; // 断点续传失败

   }
</code></pre><p>}
FtpConfig类：
//<em>/</em>
 /<em> 
 /</em>/
package com.pccw.portlet.publictools;
//<em>/</em>
 /<em> FTP配置类
 /</em> @author WangXianfeng 1:18:45 PM Jul 16, 2011
 /<em>/
public class FtpConfig {
    private String server;
    private int port;
    private String username;
    private String password;
    private String path;
    gets  。。sets。。
}
测试类：
import java.util.List;
import com.pccw.portlet.publictools.FtpConfig;
import com.pccw.portlet.publictools.FtpUtil;
//</em>/<em>
 /</em> 
 /<em> @author WangXianfeng 1:20:45 PM Jul 16, 2011
 /</em>/
public class HelloWorld {
    //<em>/</em>
     /<em> @param args
     /</em>/
    public static void main(String[] args) throws Exception {
        FtpConfig config = new FtpConfig();
        config.setServer(&quot;192.168.0.199&quot;);
        config.setPort(21);
        config.setUsername(&quot;wxf&quot;);
        config.setPassword(&quot;wxf&quot;);
        config.setPath(&quot;bankafile&quot;);
        FtpUtil ftp = new FtpUtil();
        ftp.connectServer(config);
        String localFile = &quot;c:\Seagull.rar&quot;;
        ftp.upload(localFile, &quot;sea.rar&quot;);
        List<String> files = ftp.getFileList(&quot;&quot;);
        //ftp.changeDirectory(&quot;bankafile&quot;);</p>
<pre><code>    for(String file:files){
        System.out.println(file);
        String local = &quot;D:\\ct\\199\\temp\\&quot; + file;
        ftp.download(file, local);
    }
}
</code></pre><p>}</p>
<p>来源： <a href="[http://xianfengmc.blog.163.com/blog/static/82690025201161731615607/](http://xianfengmc.blog.163.com/blog/static/82690025201161731615607/)">[http://xianfengmc.blog.163.com/blog/static/82690025201161731615607/](http://xianfengmc.blog.163.com/blog/static/82690025201161731615607/)</a> </p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/ftp/">ftp</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ftp/" class="label label-primary">ftp</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-ftp--ApacheFTP实用代码/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-ftp--ApacheFTP实用代码" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-ftp--FTP的主动模式/">FTP的主动模式</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:45.000Z"> <a href="/2014/02/02/2014-02-02-ftp--FTP的主动模式/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="ftp-">FTP的主动模式</h1>
<p>FTP的主动模式(active mode)和被动模式(passive mode)：(转)</p>
<p>FTP的主动模式(active mode)和被动模式(passive mode)：(转)</p>
<p>2010-03-01 23:57
大多数的TCP服务是使用单个的连接，一般是客户向服务器的一个周知端口发起连接，然后使用这个连接进行通讯。但是，FTP协议却有所不同，它使用双向的多个连接 ，而且使用的端口很难预计。一般，FTP连接包括：
一个控制连接 (control connection)
这个连接用于传递客户端的命令和服务器端对命令的响应。它使用服务器的21端口，生存期是整个FTP会话时间。
几个数据连接 (data connection)
这些连接用于传输文件和其它数据，例如：目录列表等。这种连接在需要数据传输时建立，而一旦数据传输完毕就关闭，每次使用的端口也不一定相同。而且，数据 连接既可能是客户端发起的，也可能是服务器端发起的。
在FTP协议中，控制连接使用周知端口21 ，因此使用ISA的IP PACKET FILTER就可以这种连接进行很好的安全保护。相反，数据传输连接的目的端口通常实现无法知道，因此处理这样的端口转发非常困难。F</p>
<p>TP协议使用一个标准的端口21作为ftp-data端口，但是这个端口只用于连接的源地址是服务器端的情况，在这个端口上根本就没有监听进程。</p>
<p>FTP的数据连接和控制连接的方向一般是相反的，也就是说，是服务器向客户端发起一个用于数据传输的连接。连接的端口是由服务器端和客户端协商确定的。FTP协议 的这个特征对ISA 转发以及防火墙和NAT的配置增加了很多困难。
除此之外，还有另外一种FTP模式，叫做被动模式 (passive mod)。在这种模式下，数据连接是由客户程序发起的，和刚才讨论过的模式(我们可以叫做主动模式 )相反。</p>
<p>是否采取被动模式取决于客户程序，在ftp命令行中使用passive命令就可以关闭/打开被动模式。</p>
<p><strong>iptables**</strong>中配置vsftp**</p>
<p>问题：配置iptables后， vsftpd不能用。常见现象是能够登录到服务器，LIST列目录失败(超时)。</p>
<p>分析：</p>
<p>主动模式 下，客户连接 TCP/21，服务器通过 TCP/20 连接客户的随机端口 </p>
<p>————这种情况下，通过状态防火墙可以解决 iptables -A INPUT -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT
被动模式 下，客户连接 TCP/21，客户再通过其他端口连接服务器的随机端口</p>
<p>卡住的原因，是因为服务器在被动模式下没有打开临时端口让 client 连过来，因此需要几个条件</p>
<p>1、client 没有防火墙时，用主动模式连接即可
2、server 没有防火墙时，用被动模式即可
3、双方都有防火墙时，vsftpd 设置被动模式高端口范围，server 打开那段范围，client 用被动模式连接即可
4、加载 ip_conntrack_ftp 模块，使 server 支持 connection tracking，支持临时打洞，client 用被动模式即可
5、server 使用 ip_conntrack_ftp、client 使用 ip_conntrack_ftp 和 ip_nat_ftp，支持临时打洞和临时 NAT 穿越打洞，双方使用主动或被动模式均可</p>
<ul>
<li>“打洞”的配置说明：</li>
<li>优点：不影响ftp配置；缺点： 客户会感觉到连接有些延迟。原因参见ip_conntract的实现原理</li>
</ul>
<p>在/etc/modprobe.conf中添加
alias ip_conntrack ip_conntract_ftp ip_nat_ftp</p>
<p>在/etc/rc.local中添加</p>
<p>/sbin/modprobe ip_conntract
/sbin/modprobe  ip_conntrack_ftp
/sbin/modprobe  ip_nat_ftp</p>
<p>这个作用就是完成上面所说的“临时打洞”的方法。</p>
<ul>
<li>限制被动模式连接端口的配置说明</li>
<li>优点：对连接速度没有影响。缺点： 限制了被动模式下，客户端并发连接的数量。</li>
</ul>
<p>在/etc/vsftpd/vsftpd.conf中添加
pasv_min_port=2222
pasv_max_port=2225</p>
<p>iptables中开放这段端口</p>
<p>-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 21 -j ACCEPT
-A INPUT -p tcp --dport 2222:2225 -j ACCEPT</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/ftp/">ftp</a></li></span></span> | <span class="tags">Tagged <a href="/tags/ftp/" class="label label-primary">ftp</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:45"datetime="2014-03-07 09:54:45"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-ftp--FTP的主动模式/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-ftp--FTP的主动模式" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/8/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/6/">6</a></li><li><a class="page-number" href="/page/7/">7</a></li><li><a class="page-number" href="/page/8/">8</a></li><li class="active"><li><span class="page-number current">9</span></li><li><a class="page-number" href="/page/10/">10</a></li><li><a class="page-number" href="/page/11/">11</a></li><li><a class="page-number" href="/page/12/">12</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/162/">162</a></li><li><a class="page-number" href="/page/163/">163</a></li><li><a class="extend next" href="/page/10/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-03-30 14:30:15</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
