
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 95 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-dwr--DWRReverseAjax功能实践的要点/">DWR Reverse Ajax功能实践的要点</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:38.000Z"> <a href="/2014/02/02/2014-02-02-dwr--DWRReverseAjax功能实践的要点/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="dwr-reverse-ajax-">DWR Reverse Ajax功能实践的要点</h1>
<ul>
<li><a href="http://wz.csdn.net/" target="_blank">网摘首页</a></li>
<li><a href="http://wz.csdn.net/my" target="_blank">管理网摘</a></li>
<li><a href="http://wz.csdn.net/spy" target="_blank">实时网摘</a></li>
<li><a href="http://wz.csdn.net/tool" target="_blank">工具和帮助</a></li>
</ul>
<h1 id="dwr-reverse-ajax-">DWR Reverse Ajax功能实践的要点</h1>
<p>Reverse Ajax主要是在BS架构中，从服务器端向多个浏览器主动推数据的一种技术。它的一种实现就是客户端向服务器请求后，服务器不立即回应，从而导致一个http长连接，等到有更新数据的时候，再利用这个连接“主动”向客户端回送。
如果是初次接触，那一定要看下这篇文章
其中，详述了这种技术和JETTY服务器Continuations功能结合时的强大性能：运行在非阻塞方式下，当多个客户端请求时不会占用过多线程。
最后，此文申明DWR的实现已经天然使用了JETTY这一功能。所以使用DWR还是非常有好处的。如何使用及示例上面这篇文章已经有说明，下面就以我实际使用中碰到的问题和要点做个说明。
首先，说一下代码的组织和声明。
将使用到Reverse Ajax的代码归入一个类，比如是NotifyClient，并用spring的bean来声明。在将要用到这个类的地方(NodeSvcImpl类)，也通过成员变量引入:
然后在dwr.xml里这样声明：
其次一个要点是，如果你不是在DWR所开的线程中使用Reverse Ajax，那WebContextFactory.get()会返回空，这是因为只有DWR自己的线程才会初始化它。那如果你是在DWR之外使用，比如说收到JMS消息，或者UDP消息后，想通知所有客户端，你就要用到ServerContext。
要得到ServerContext，就需要用到spring的ServletContextAware接口，下面是完整代码：
package com.hhh.nms.remote;
import org.apache.log4j.Logger;
import javax.servlet.ServletContext;
import org.springframework.web.context.ServletContextAware;
import java.util.Collection;
import org.directwebremoting.ScriptBuffer;
import org.directwebremoting.ScriptSession;
import org.directwebremoting.WebContext;
import org.directwebremoting.WebContextFactory;
import org.directwebremoting.ServerContext;
import org.directwebremoting.ServerContextFactory;
import org.directwebremoting.proxy.dwr.Util;
public class NotifyClient implements ServletContextAware {
static Logger logger = Logger.getLogger (NotifyClient.class.getName());
private ServletContext servletContext = null;
public void setServletContext( ServletContext servletContext )
{
this.servletContext = servletContext;
}
public int serviceUpdate (String str1, String str2) {
logger.info (&quot;entered&quot;);
logger.info (&quot;WebContext1&quot;+servletContext);
ServerContext ctx = ServerContextFactory.get(servletContext );
// Generate JavaScript code to call client-side
// WebContext ctx = WebContextFactory.get();
logger.info (&quot;WebContext&quot;+ctx);
if (ctx != null) {
//String currentPage = ctx.getCurrentPage();
//logger.info (&quot;current page:&quot; + currentPage);
ScriptBuffer script = new ScriptBuffer();
script.appendScript(&quot;updatePoint(&quot;)
.appendData(str1)
.appendScript(&quot;,&quot;)
.appendData (str2)
.appendScript(&quot;);&quot;);
// Push script out to clients viewing the page
Collection sessions =
ctx.getScriptSessionsByPage(&quot;/ebnms/index.eb?do=dwrtest&quot;);
logger.info (&quot;jsp session size:&quot; + sessions.size ());
// or
Collection sessions2 =
ctx.getAllScriptSessions ();
logger.info (&quot;all session size:&quot; + sessions2.size ());
for (ScriptSession session : sessions2) {
session.addScript(script);
}
}
return 0;
}
}
另外，ScriptBuffer的appendScript方法是插入原始字串，appendData会根据参数类型做相应转换。</p>
<p><a href="http://www.blogjava.net/alwayscy/archive/2007/11/01/157552.html" target="_blank"><a href="http://www.blogjava.net/alwayscy/archive/2007/11/01/157552.html">http://www.blogjava.net/alwayscy/archive/2007/11/01/157552.html</a></a></p>
<h1 id="-">他们设置了哪些标签：</h1>
<p><a href="http://wz.csdn.net/tag/WEBå¼å/" title="1个网摘" target="_blank">WEB开发</a></p>
<h1 id="-">谁收藏了这个网址：</h1>
<h2 id="-conanpaul-http-wz-csdn-net-conanpaul-"><a href="http://wz.csdn.net/conanpaul/" target="_blank">conanpaul</a>收录</h2>
<p>使用标签：<a href="http://wz.csdn.net/conanpaul/Web开发/" target="_blank">Web开发</a>，时间：2007-11-2 9:34:36 | <a href="http://wz.csdn.net/item/1204886/" target="_blank">相关网摘</a>
Reverse Ajax主要是在BS架构中，从服务器端向多个浏览器主动推数据的一种技术。它的一种实现就是客户端向服务器请求后，服务器不立即回应，从而导致一个http长连接，等到有更新数据的时候，再利用这个连接“主动”向客户端回送。
如果是初次接触，那一定要看下这篇文章
其中，详述了这种技术和JETTY服务器Continuations功能结合时的强大性能：运行在非阻塞方式下，当多个客户端请求时不会占用过多线程。
最后，此文申明DWR的实现已经天然使用了JETTY这一功能。所以使用DWR还是非常有好处的。如何使用及示例上面这篇文章已经有说明，下面就以我实际使用中碰到的问题和要点做个说明。
首先，说一下代码的组织和声明。
将使用到Reverse Ajax的代码归入一个类，比如是NotifyClient，并用spring的bean来声明。在将要用到这个类的地方(NodeSvcImpl类)，也通过成员变量引入:
然后在dwr.xml里这样声明：
其次一个要点是，如果你不是在DWR所开的线程中使用Reverse Ajax，那WebContextFactory.get()会返回空，这是因为只有DWR自己的线程才会初始化它。那如果你是在DWR之外使用，比如说收到JMS消息，或者UDP消息后，想通知所有客户端，你就要用到ServerContext。
要得到ServerContext，就需要用到spring的ServletContextAware接口，下面是完整代码：
package com.hhh.nms.remote;
import org.apache.log4j.Logger;
import javax.servlet.ServletContext;
import org.springframework.web.context.ServletContextAware;
import java.util.Collection;
import org.directwebremoting.ScriptBuffer;
import org.directwebremoting.ScriptSession;
import org.directwebremoting.WebContext;
import org.directwebremoting.WebContextFactory;
import org.directwebremoting.ServerContext;
import org.directwebremoting.ServerContextFactory;
import org.directwebremoting.proxy.dwr.Util;
public class NotifyClient implements ServletContextAware {
static Logger logger = Logger.getLogger (NotifyClient.class.getName());
private ServletContext servletContext = null;
public void setServletContext( ServletContext servletContext )
{
this.servletContext = servletContext;
}
public int serviceUpdate (String str1, String str2) {
logger.info (&quot;entered&quot;);
logger.info (&quot;WebContext1&quot;+servletContext);
ServerContext ctx = ServerContextFactory.get(servletContext );
// Generate JavaScript code to call client-side
// WebContext ctx = WebContextFactory.get();
logger.info (&quot;WebContext&quot;+ctx);
if (ctx != null) {
//String currentPage = ctx.getCurrentPage();
//logger.info (&quot;current page:&quot; + currentPage);
ScriptBuffer script = new ScriptBuffer();
script.appendScript(&quot;updatePoint(&quot;)
.appendData(str1)
.appendScript(&quot;,&quot;)
.appendData (str2)
.appendScript(&quot;);&quot;);
// Push script out to clients viewing the page
Collection sessions =
ctx.getScriptSessionsByPage(&quot;/ebnms/index.eb?do=dwrtest&quot;);
logger.info (&quot;jsp session size:&quot; + sessions.size ());
// or
Collection sessions2 =
ctx.getAllScriptSessions ();
logger.info (&quot;all session size:&quot; + sessions2.size ());
for (ScriptSession session : sessions2) {
session.addScript(script);
}
}
return 0;
}
}
另外，ScriptBuffer的appendScript方法是插入原始字串，appendData会根据参数类型做相应转换。
<a href="http://www.hd315.gov.cn/beian/view.asp?bianhao=010202001032100010"></a></p>
<p><a href="http://www.csdn.net/help/intro.htm" target="_blank">网站简介</a>－<a href="http://www.csdn.net/help/ads.htm" target="_blank">广告服务</a>－<a href="http://www.csdn.net/help/sitemap.htm" target="_blank">网站地图</a>－<a href="http://www.csdn.net/help/help.htm" target="_blank">帮助</a>－<a href="http://www.csdn.net/help/contact.htm" target="_blank">联系方式</a>－<a href="http://job.csdn.net/Jobs/f9c75c9f2ad14404a604669b757b9ed0/viewcompany.aspx" target="_blank">诚聘英才</a>－<a href="http://www.csdn.net/english/" target="_blank">English</a>－<a href="http://wz.csdn.net/url/708367/#" target="_blank">问题报告</a>
北京百联美达美数码科技有限公司 版权所有 京 ICP 证 020026 号
Copyright © 2000-2009, CSDN.NET, All Rights Reserved
<a href="http://www.vdoing.com/" title="Vdoing StatsX No.56805" target="_blank"><img src="" alt=""></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/dwr/">dwr</a></li></span></span> | <span class="tags">Tagged <a href="/tags/dwr/" class="label label-primary">dwr</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:38"datetime="2014-03-07 09:54:38"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-dwr--DWRReverseAjax功能实践的要点/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-dwr--DWRReverseAjax功能实践的要点" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-安全--Burpsuite教程与技巧之HTTPbrute暴力破解/">Burpsuite教程与技巧之HTTP brute暴力破解</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:38.000Z"> <a href="/2014/02/02/2014-02-02-安全--Burpsuite教程与技巧之HTTPbrute暴力破解/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="burpsuite-http-brute-">Burpsuite教程与技巧之HTTP brute暴力破解</h1>
<h3 id="burpsuite-http-brute-">Burpsuite教程与技巧之HTTP brute暴力破解</h3>
<p><a href="http://www.freebuf.com/articles/web/7457.html#" target="_blank"></a><a href="http://www.freebuf.com/author/gall" title="由 Gall 发布">Gall</a> @ <a href="http://www.freebuf.com/category/articles/web" title="查看 WEB安全 中的全部文章" target="_blank">WEB安全</a> 2013-02-28</p>
<p>感谢<a href="http://www.freebuf.com/author/gall" target="_blank">Gall</a>投递</p>
<p><strong>常规的对username/passwprd进行payload测试，我想大家应该没有什么问题，但**</strong>对于Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=这样的问题，很多朋友疑惑了.**</p>
<p>之前，我记得我介绍过burpsuite的intruder功能(<a href="http://www.freebuf.com/articles/5560.html" target="_blank">BurpSuite教程与技巧之SQL Injection</a>)，想必很多人没什么印象，在此，以HTTP brute重提intruder功能.</p>
<p>以下面案例进行说明(只作演示之用，具体以自己的目标为准)</p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226123225_18600.png" alt=""></p>
<p>Auth=dXNlcjpwYXNzd29yZA==处，也就是我们的关键位置.</p>
<p>那么具体该如何做呢?大致操作过程如下:</p>
<blockquote>
<p>1.解密base64字符串<br>2.生成测试用的payload<br>3.利用payload进行测试</p>
</blockquote>
<p><strong>1.解密验证用的base64字符串</strong></p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226123559_66236.png" alt=""></p>
<p>解密后的字符串为:</p>
<blockquote>
<p>Auth=user:password</p>
</blockquote>
<p>问题来了，针对user:password这种形式的字符串，我们该如何设置payload呢?</p>
<p>想必很多人在此处了费尽心思。为了解决这个问题，接下来请看第二部分。</p>
<p><strong>2.生成测试用的payload</strong></p>
<p>对于这种格式，无法利用burpsuite顺利的完成测试，那个就需要丰富对应的payload了.</p>
<p>我的做法就是，利用burpsuite生成我要的payload文本.</p>
<p>Auth=§user§§:§§password§</p>
<p>设置3处payloads，</p>
<blockquote>
<p>1 ------ §user§<br>2 ------ §:§<br>3 ------ §password§</p>
</blockquote>
<p>然后根据intruder自带的battering ram/pitchfork/cluster bomb生成payloads(根据自己的需求生成)</p>
<p>我在此处选择以cluster bomb为例，利用intruder生成需要的payloads，然后保存到文本文件中.</p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226125136_97047.png" alt=""></p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226125307_52071.png" alt=""></p>
<p><strong>3.利用payload进行测试</strong></p>
<p>测试的时候，我们选用sniper，我们只需一个payload变量</p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226125606_76545.png" alt=""></p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226125833_34487.png" alt=""></p>
<p><img src="http://static.freebuf.com/uploads/image/20130226/20130226125921_64121.png" alt=""></p>
<p>若有不足之处，欢迎指正.</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/安全/">安全</a></li></span></span> | <span class="tags">Tagged <a href="/tags/安全/" class="label label-primary">安全</a></span> | <span class="time">recent updated:<time title="2014-03-29 21:49:45"datetime="2014-03-29 21:49:45"> mar. 29 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-安全--Burpsuite教程与技巧之HTTPbrute暴力破解/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-安全--Burpsuite教程与技巧之HTTPbrute暴力破解" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-虚拟化_Citrix--CTX116603-HowtoConvertVMwareVirtualMachines/">CTX116603 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-虚拟化_Citrix--CTX116603-HowtoConvertVMwareVirtualMachines/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="ctx116603-how-to-convert-vmware-virtual-machines-to-xenserver-virtual-machines-citrix-knowledge-center">CTX116603 - How to Convert VMware Virtual Machines to XenServer Virtual Machines - Citrix Knowledge Center</h1>
<p><img src="" alt="Citrix Logo"></p>
<p><a href="http://support.citrix.com/" target="_blank">Knowledge Center</a>
<a href="http://www.citrix.com/" title="Citrix Homepage" target="_blank">Citrix</a></p>
<p><a href="http://support.citrix.com/" target="_blank">Knowledge Center</a> <a href="http://community.citrix.com/" target="_blank">Communities</a> <a href="http://forums.citrix.com/support/" target="_blank">Support Forums</a> <a href="http://community.citrix.com/blogs/" target="_blank">Blogs</a>
<a href="">Alerts</a>     <a href="">Sign in</a></p>
<p><a href="http://support.citrix.com/" target="_blank">Knowledge Center Home</a> &gt; CTX116603</p>
<p>Rate this Article:</p>
<p><img src="&quot;You must be signed in to rate again&quot;" alt="You must be signed in to rate again">
<a href="http://support.citrix.com/article/CTX116603#" target="_blank"><img src="&quot;Article Feedback&quot;" alt=""></a> <a href="http://support.citrix.com/article/CTX116603#" target="_blank">Article Feedback</a> <a href="http://support.citrix.com/article/CTX116603?print" target="_blank"><img src="&quot;Article Feedback&quot;" alt=""></a> <a href="http://support.citrix.com/article/CTX116603?print" target="_blank">Print View</a>   <a href="http://www.addthis.com/bookmark.php" target="_blank"><img src="" alt=""></a>  Languages:  </p>
<ul>
<li><p>Select</p>
</li>
<li><p><a href="http://support.citrix.com/article/CTX121395" target="_blank">日本語</a></p>
<h1 id="how-to-convert-vmware-virtual-machines-to-xenserver-virtual-machines">How to Convert VMware Virtual Machines to XenServer Virtual Machines</h1>
</li>
</ul>
<p>Document ID: <strong>CTX116603</strong>   /   Created On: Jun 17, 2008   /   Updated On: Aug 18, 2009</p>
<p><strong>Average Rating:</strong> <img src="&quot;4&quot;" alt="4"> (14 ratings)</p>
<h3 id="-view-products-this-document-applies-to-link-to-products-this-document-applies-to-http-support-citrix-com-article-ctx116603-prodrelated-"><a href="http://support.citrix.com/article/CTX116603#prodrelated" target="_blank">View products this document applies to <img src="" alt="link to products this document applies to"></a></h3>
<p><a href=""></a></p>
<p><strong>Summary</strong></p>
<p>This document describes the two methods available to convert a VMware-formatted virtual machine (VM) into a Citrix XenServer virtual machine. The first method of converting OVF packages exported directly from VMware is the preferred as it is the quickest, most efficient and allows you to convert multiple virtual drives at the same time. The second method of converting VMDK files should be used as an alternative as it only allows the conversion of one drive at a time. For best results, copy the OVF template and the VMDK file to the computer that XenConvert is installed on for conversion.</p>
<p><strong>Requirements</strong></p>
<p>• Administrator access to VMware VM to be converted</p>
<p>• Administrator access to XenServer and/or XenCenter</p>
<p>• Basic knowledge on Open Virtualization Format (OVF)</p>
<p>You must be comfortable using VMware, a Windows computer to run the XenConvert Utility, XenServer and XenCenter.</p>
<p>Please reference the <a href="http://support.citrix.com/servlet/KbServlet/download/20644-102-332133/XenConvertGuide.pdf" target="_blank">Citrix XenConvert Guide</a> for XenConvert Supported Operating Systems and the <a href="http://support.citrix.com/article/CTX121652" target="_blank">Overview of the Open Virtualization Format (OVF)</a> for more information on OVF packages.</p>
<p><a href="https://www.citrix.com/English/SS/downloads/details.asp?dID=36239&amp;downloadID=1855017&amp;pID=683148" target="_blank">Click here to download Citrix XenConvert Application Software</a><a href=""></a></p>
<p><strong>Initial Procedures</strong></p>
<ol>
<li><p>Identify the VM you want to export.</p>
</li>
<li><p>Log on to that VM and uninstall <strong>VMware Tools</strong>. Refer to the following screen shot:</p>
</li>
</ol>
<p><img src="" alt=""></p>
<p><strong>Note</strong>: You will experience issues if these items are not properly removed and/or uninstalled from Add or Remove Programs and from the Taskbar.</p>
<p><img src="" alt=""></p>
<ol>
<li>Delete any snapshots located with the VM.</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li>Delete any unnecessary data, drives, partitions and/or applications you will no longer need for that VM.</li>
</ol>
<p>Note:</p>
<p>• Enable<a href="http://technet.microsoft.com/en-us/library/cc753703(WS.10" target="_blank">automount</a>.aspx) feature for Windows VMs</p>
<p>• If manifest feature in VMware Workstation was enabled, delete the .mf file to allow import.</p>
<p><strong>Exporting OVF packages from VMware</strong></p>
<p>The following VMware products support OVF export:</p>
<p>• VMware vSphere 4</p>
<p>• VMware VI3</p>
<p>• VMware Workstation 6.5.x</p>
<p>• VMware OVF Tool 0.9 and 1.x</p>
<p>• VMware Converter 3.0.3</p>
<p>• VMware Converter 4.x</p>
<p>• VMware Studio</p>
<p><strong>Note</strong>: The example shown here was done with VMware vSphere.</p>
<p><img src="" alt=""></p>
<ol>
<li>Select File &gt; Export &gt; Export OVF Template.</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li>Select a Directory to store the OVF Export and ensure that Optimized for: Web (OVF) is selected.</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li>A dialogue will indicate that the export completed successfully.</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li>Copy the entire exported contents over to your XenConvert workstation leaving the folder structure the same.</li>
</ol>
<p><strong>Converting OVF Export with XenConvert</strong></p>
<p><img src="" alt=""></p>
<ol>
<li>From XenConvert select the Open Virtualization Format (OVF) Package option.</li>
</ol>
<p><strong>Note</strong>: OVF packages can only be converted directly to XenServer.</p>
<p><img src="" alt=""></p>
<ol>
<li>Select the OVF Package to import and indicate whether you would like to “Verify Content” and/or “Verify Author”.</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li>Enter the hostname, user name (root) and password of the XenServer that you will convert the OVF package directly to.</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li>Select Convert to start the conversion process.</li>
</ol>
<p><strong>Converting VMDK Files</strong></p>
<p><strong>Note</strong>: XenConvert has been designed to convert a single virtual disk from VMDK format at a time. Copy data from all additional drives and partitions to an external location and delete any additional drives and/or partitions.</p>
<ol>
<li>Browse the physical location of the VMware files and locate the virtual machine’s .vmdk file.</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li><p>Make a note of the path to the virtual machine’s .vmdx file.</p>
</li>
<li><p>Install XenConvert application on the Windows computer that will perform the conversion.</p>
</li>
<li><p>Launch XenConvert and select the “VMware Virtual Hard Disk (VMDK)” option.</p>
</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li>You will be presented with the following three options on converting a “VMware Virtual Hard Disk (VMDK)” for XenServer.</li>
</ol>
<p>• XenServer option converts directly to an accessible XenServer host</p>
<p>• XenServer Virtual Appliance option converts to an .xva format file that can be used to import</p>
<p>• XenServer Virtual Hard Disk (VHD) option converts VMDK file to a .vhd file</p>
<p><img src="" alt=""></p>
<p>6.All three options prompt you to browse for and select the .vmdk file to convert.</p>
<p><img src="" alt=""></p>
<p><strong>Option 1 – XenServer</strong></p>
<ol>
<li><p>You must specify the destination XenServer hostname, User name, Password and Workspace to be used during the conversion.</p>
</li>
<li><p>Type or browse to the location where you want the converted files to be stored. For conversion efficiency, Citrix recommends specifying a location on the local computer where you are running conversion, preferably on a different partition or drive.</p>
</li>
</ol>
<p><strong>Note</strong>: The Workspace specified will need to have enough space available to convert the selected VM.</p>
<p><img src="" alt=""></p>
<ol>
<li>Enter the name of the VM as you would like it to appear in XenCenter after it has been uploaded.</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li>The XenConvert utility displays the progress of the conversion and upload of VM to XenServer.</li>
</ol>
<p><img src="" alt=""></p>
<p><strong>5. Note</strong>: Do not close dialogue box until the Status indicates “Conversion was successful!”</p>
<p><img src="" alt=""></p>
<ol>
<li>After the conversion process completes, XenServer shows the converted VM by the name specified during conversion followed by “import”.</li>
</ol>
<p><img src="" alt=""></p>
<p><strong>Option 2 –Xen Virtual Appliance</strong></p>
<p>The Xen Virtual Appliance option converts the VM into a portable format that can be easily moved, archived or uploaded to XenServer.</p>
<ol>
<li>After selecting the Xen Virtual Appliance option and VMDK file to convert you are prompted to select a folder to store the converted contents.</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li>After the VMDK file is converted you have an output that lists an hda folder, ova.xml, .pvp and .vhd file.</li>
</ol>
<p><strong>Note</strong>: Do not change the file structure. The ova.xml file and <strong>hda</strong> folder must be on the same level.</p>
<p><img src="" alt=""></p>
<p><strong>Importing the Converted VM to XenServer</strong></p>
<ol>
<li><p>Log on to XenCenter.</p>
</li>
<li><p>On the menu bar, go to <strong>VM &gt; Import</strong>.</p>
</li>
</ol>
<p><img src="" alt=""></p>
<p>You have the option to browse for the ova.xml file or choose either <strong>Exported VM</strong> or <strong>Exported template</strong>.</p>
<p><strong>Note</strong>: The same file extension (.xva) is used for both the exported VMs and exported templates.</p>
<p><img src="" alt=""></p>
<ol>
<li>Select <strong>XenServer Virtual Appliance Version 1 (ova.xml)</strong> from the <strong>Files of Type</strong> list. You are now able to browse and see the ova.xml file.</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li>Select the XenServer host that you want to deploy the imported VM to.</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li>Select the storage repository where the virtual disks for the newly imported VM will be stored.</li>
</ol>
<p><strong>Note</strong>: You can copy <a href="http://support.citrix.com/article/ctx116685" target="_blank">a VM from one storage repository to another storage repository</a> after the import process has completed.</p>
<p><img src="" alt=""></p>
<ol>
<li>Add the network interfaces you want to configure for the new VM.</li>
</ol>
<p><img src="" alt=""></p>
<ol>
<li>Click <strong>Finish</strong> to complete the import process.</li>
</ol>
<p><img src="" alt=""></p>
<p>Allow enough time for the import process to complete. The XenCenter <strong>Logs</strong> tab displays an estimate of the amount of time that the VM will take to import.</p>
<p><img src="" alt=""></p>
<p>The imported VM will have the name “import” at the end of it to identify that it has been imported. You can rename the VM after the import process finishes.</p>
<p><img src="" alt=""></p>
<p><strong>How to Import a VM through the Command Line Interface (CLI):</strong></p>
<ol>
<li><p>Copy all the files needed to a mounted share accessible by your XenServer host.</p>
</li>
<li><p>Run the <strong>xe vm-import</strong> command:<strong>/#xe vm-import filename=<path and name of ova.xml file> sr-uuid=<UUID of SR to install imported VM to></strong></p>
</li>
</ol>
<p>Example command: /# xe vm-import filename=/nfs or cifs share/VMWare_WinXP_Export/ova.xml sr-uuid=da31c9d2-88ea-35f6-8c48-924db6c39817</p>
<p><strong>More Information</strong></p>
<p><a href="https://www.citrix.com/English/SS/downloads/details.asp?dID=36239&amp;downloadID=1855017&amp;pID=683148" target="_blank">Citrix XenConvert Application Software</a></p>
<p><a href="http://support.citrix.com/article/ctx121646" target="_blank">CTX121646 - Citrix XenConvert 2.0.1 Guide</a></p>
<p><a href="http://support.citrix.com/article/ctx116685" target="_blank">CTX116685 - How to a Copy a Virtual Machine From One Storage Repository to Another</a></p>
<p><a href="http://www.vmware.com/pdf/ovf_tool.pdf" target="_blank">VMware OVF Tool User Guide</a><a href=""></a>
<a href=""></a></p>
<h3 id="this-document-applies-to-">This document applies to:</h3>
<ul>
<li><a href="http://support.citrix.com/product/legacy/xensv3.1/" target="_blank">XenServer 3.1</a></li>
<li><a href="http://support.citrix.com/product/legacy/xensv3.2/" target="_blank">XenServer 3.2</a></li>
<li><a href="http://support.citrix.com/product/xens/v4.0/" target="_blank">XenServer 4.0</a></li>
<li><a href="http://support.citrix.com/product/xens/v4.1/" target="_blank">XenServer 4.1</a></li>
<li><a href="http://support.citrix.com/product/xens/v5.0/" target="_blank">XenServer 5.0</a></li>
<li><a href="http://support.citrix.com/product/xens/v5.0/" target="_blank">XenServer 5.0 Update 3</a></li>
<li><a href="http://support.citrix.com/product/xens/v5.5/" target="_blank">XenServer 5.5</a><h1 id="did-this-article-resolve-your-problem-question-">Did this article resolve your problem/question?</h1>
</li>
</ul>
<p><img src="" alt="">  Yes
No
Need to test first
Not sure, I need help
Just browsing/General research</p>
<h3 id="-what-would-you-have-done-if-this-article-had-not-solved-your-issue-"><strong>What would you have done if this article had not solved your issue?</strong></h3>
<h3 id="-what-action-will-you-take-next-"><strong>What action will you take next?</strong></h3>
<p><img src="" alt=""></p>
<p>Open a Citrix Technical Support Case
Contact my Citrix Solution Advisor
Continue searching Knowledge Center
Search non-Citrix resources
Ignore the problem/take no further action</p>
<p>Thanks for your feedback!   <a href=""></a><a href="http://support.citrix.com/kc/basicLogin/show?redirectURL=/article/CTX116603/%3Ffeedback=true%23feedback">Report errors with this document</a></p>
<h3 id="use-this-field-to-report-errors-with-this-document-">Use this field to report errors with this document:</h3>
<p><a href=""></a>
Thanks for your report!</p>
<p>Knowledge Center</p>
<p><a href=""></a></p>
<p><a href="http://support.citrix.com/search/advanced/" target="_blank">Advanced Search</a>
Products
<a href="http://support.citrix.com/product/xa/" target="_blank">XenApp</a></p>
<ul>
<li><a href="http://support.citrix.com/product/xa/v5.0_2008/" target="_blank">XenApp 5.0 for Windows Server 2008</a></li>
<li><a href="http://support.citrix.com/product/xa/v5.0_2003/" target="_blank">XenApp 5.0 for Windows Server 2003</a></li>
<li><a href="http://support.citrix.com/product/xa/v4.5/" target="_blank">Presentation Server 4.5 and Components</a></li>
<li><a href="http://support.citrix.com/product/xa/v4.5_se2003/" target="_blank">Presentation Server 4.5 SE Edition</a></li>
<li><a href="http://support.citrix.com/product/xa/v4.0/" target="_blank">Presentation Server 4.0 and Components</a></li>
<li><a href="http://support.citrix.com/product/xa/unix/" target="_blank">Presentation Server 4.0 for UNIX</a></li>
<li><a href="http://support.citrix.com/product/xa/unix_v4.0fp1/" target="_blank">XenApp for UNIX 4.0 with Feature Pack 1</a>
<a href="http://support.citrix.com/product/xd/" target="_blank">XenDesktop</a></li>
<li><a href="http://support.citrix.com/product/xd/v3.0/" target="_blank">XenDesktop 3.0</a></li>
<li><a href="http://support.citrix.com/product/xd/v2.1/" target="_blank">XenDesktop 2.1</a></li>
<li><a href="http://support.citrix.com/product/xd/v2.0/" target="_blank">XenDesktop 2.0</a>
<a href="http://support.citrix.com/product/xens/" target="_blank">XenServer</a></li>
<li><a href="http://support.citrix.com/product/xens/v5.5/" target="_blank">XenServer 5.5</a></li>
<li><a href="http://support.citrix.com/product/xens/v5.0/" target="_blank">XenServer 5.0</a></li>
<li><a href="http://support.citrix.com/product/xens/v4.1/" target="_blank">XenServer 4.1</a></li>
<li><a href="http://support.citrix.com/product/xens/v4.0/" target="_blank">XenServer 4.0</a>
<a href="http://support.citrix.com/product/emhv/" target="_blank">Essentials for Hyper-V</a></li>
<li><a href="http://support.citrix.com/product/emhv/esv1.0/" target="_blank">Essentials 1.0 for Microsoft Hyper-V</a>
<a href="http://support.citrix.com/product/nsad/" target="_blank">NetScaler Application Delivery</a></li>
<li><a href="http://support.citrix.com/product/nsad/v9.1/" target="_blank">NetScaler Application Delivery Software 9.1</a></li>
<li><a href="http://support.citrix.com/product/nsad/vpx9.1/" target="_blank">NetScaler VPX 9.1</a></li>
<li><a href="http://support.citrix.com/product/nsad/v9.0/" target="_blank">NetScaler Application Delivery Software 9.0</a></li>
<li><a href="http://support.citrix.com/product/nsad/v8.1/" target="_blank">NetScaler Application Delivery Software 8.1</a></li>
<li><a href="http://support.citrix.com/product/nsad/v8.0/" target="_blank">NetScaler Application Delivery Software 8.0</a></li>
<li><a href="http://support.citrix.com/product/nsad/v7.0/" target="_blank">NetScaler Application Delivery Software 7.0</a></li>
<li><a href="http://support.citrix.com/product/nsad/v6.1/" target="_blank">NetScaler Application Delivery Software 6.1</a></li>
<li><a href="http://support.citrix.com/product/nsad/v6.0/" target="_blank">NetScaler Application Delivery Software 6.0</a>
<a href="http://support.citrix.com/product/ag/" target="_blank">Access Gateway</a></li>
<li><a href="http://support.citrix.com/product/ag/eev9.1/" target="_blank">Access Gateway 9.1 Enterprise Edition</a></li>
<li><a href="http://support.citrix.com/product/ag/eev9.0/" target="_blank">Access Gateway 9.0 Enterprise Edition</a></li>
<li><a href="http://support.citrix.com/product/ag/eev8.1/" target="_blank">Access Gateway 8.1 Enterprise Edition</a></li>
<li><a href="http://support.citrix.com/product/ag/eev8.0/" target="_blank">Access Gateway 8.0 Enterprise Edition</a></li>
<li><a href="http://support.citrix.com/product/ag/eev7.0/" target="_blank">Access Gateway 7.0 Enterprise Edition</a></li>
<li><a href="http://support.citrix.com/product/ag/v4.6se/" target="_blank">Access Gateway 4.6 Standard Edition</a></li>
<li><a href="http://support.citrix.com/product/ag/v4.5ae/" target="_blank">Access Gateway 4.5 Advanced Edition</a></li>
<li><a href="http://support.citrix.com/product/ag/v4.5se/" target="_blank">Access Gateway 4.5 Standard Edition</a>
<a href="http://support.citrix.com/product/brrepeat/" target="_blank">Branch Repeater</a></li>
<li><a href="http://support.citrix.com/product/brrepeat/v5.5/" target="_blank">Branch Repeater 5.5</a></li>
<li><a href="http://support.citrix.com/product/brrepeat/v2.0/" target="_blank">Branch Repeater with Windows Server 2.0</a></li>
<li><a href="http://support.citrix.com/product/brrepeat/v5.0/" target="_blank">Branch Repeater 5.0</a></li>
<li><a href="http://support.citrix.com/product/brrepeat/v1.5/" target="_blank">Branch Repeater with Windows Server 1.5</a></li>
<li><a href="http://support.citrix.com/product/brrepeat/v4.5/" target="_blank">Branch Repeater 4.5</a></li>
<li><a href="http://support.citrix.com/product/brrepeat/v1.0/" target="_blank">Branch Repeater with Windows Server 1.0</a>
<a href="http://support.citrix.com/product/rec/" target="_blank">Receiver</a></li>
<li><a href="http://support.citrix.com/product/rec/win/" target="_blank">Receiver for Windows</a></li>
<li><a href="http://support.citrix.com/product/rec/mer/" target="_blank">Merchandising Server</a></li>
<li><a href="http://support.citrix.com/product/rec/iPhone/" target="_blank">Receiver for iPhone</a></li>
</ul>
<p><a href="http://support.citrix.com/product/" target="_blank">&gt;&gt; View All Products</a>
<a href="http://twitter.com/citrixsupport" target="_blank"><img src="" alt=""></a></p>
<p>Knowledge Resources</p>
<ul>
<li><a href="http://support.citrix.com/productdocs/" target="_blank">Product Documentation</a></li>
<li><a href="http://support.citrix.com/pages/microsoft/" target="_blank">Microsoft Updates</a></li>
<li><a href="http://support.citrix.com/pages/licensing/" target="_blank">Licensing</a></li>
<li><a href="http://support.citrix.com/pages/troubleshooting/" target="_blank">Troubleshooting</a></li>
<li><a href="http://support.citrix.com/pages/whatsnew/" target="_blank">What&#39;s New...</a></li>
<li><a href="http://support.citrix.com/pages/faqs/" target="_blank">Knowledge Center FAQ</a></li>
<li><p><a href="http://www.citrix.com/English/SS/supportSecond.asp?slID=38676&amp;ntref=hp_nav_US" target="_blank">My Support Options</a>
©1999-2009 Citrix Systems, Inc. All rights reserved.</p>
</li>
<li><p><a href="http://www.citrix.com/English/contact/index.asp" target="_blank">Contact</a></p>
</li>
<li><a href="http://www.citrix.com/site/aboutCitrix/employment/index.asp" target="_blank">Careers</a></li>
<li><a href="http://www.citrix.com/English/aboutCitrix/legal/legalNotice.asp" target="_blank">Legal Notice</a></li>
<li><a href="http://www.citrix.com/English/aboutCitrix/legal/privacyStatement.asp" target="_blank">Privacy</a></li>
<li><a href="http://www.citrix.com/English/aboutCitrix/governance/index.asp" target="_blank">Governance</a></li>
<li><a href="">Site Feedback</a></li>
<li><a href="http://support.citrix.com/sitemap" target="_blank">Site Map</a></li>
</ul>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/虚拟化_Citrix/">虚拟化_Citrix</a></li></span></span> | <span class="tags">Tagged <a href="/tags/虚拟化_Citrix/" class="label label-primary">虚拟化_Citrix</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-虚拟化_Citrix--CTX116603-HowtoConvertVMwareVirtualMachines/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-虚拟化_Citrix--CTX116603-HowtoConvertVMwareVirtualMachines" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-Httpclient-HttpUrlConnection--HttpUrlConnection底层实现和关于javahost绑定ip即时生效的设置及分析-/">HttpUrlConnection底层实现和关于java host绑定ip即时生效的设置及分析 </a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-Httpclient-HttpUrlConnection--HttpUrlConnection底层实现和关于javahost绑定ip即时生效的设置及分析-/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="httpurlconnection-java-host-ip-csdn-net">HttpUrlConnection底层实现和关于java host绑定ip即时生效的设置及分析 - 程序员之路 - 博客频道 - CSDN.NET</h1>
<p>您还未登录！|<a href="https://passport.csdn.net/account/login" target="_blank">登录</a>|<a href="https://passport.csdn.net/account/register" target="_blank">注册</a>|<a href="https://passport.csdn.net/help/faq" target="_blank">帮助</a></p>
<ul>
<li><a href="http://www.csdn.net/" target="_blank">首页</a></li>
<li><a href="http://news.csdn.net/" target="_blank">业界</a></li>
<li><a href="http://mobile.csdn.net/" target="_blank">移动</a></li>
<li><a href="http://cloud.csdn.net/" target="_blank">云计算</a></li>
<li><a href="http://sd.csdn.net/" target="_blank">研发</a></li>
<li><a href="http://bbs.csdn.net/" target="_blank">论坛</a></li>
<li><a href="http://blog.csdn.net/" target="_blank">博客</a></li>
<li><a href="http://download.csdn.net/" target="_blank">下载</a></li>
<li><h2 id="-"><a href="">更多</a></h2>
</li>
</ul>
<h1 id="-http-blog-csdn-net-zhongweijian-"><a href="http://blog.csdn.net/zhongweijian" target="_blank">程序员之路</a></h1>
<h2 id="-">求各种编程相关兼职</h2>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian?viewmode=contents" target="_blank"><img src="" alt="">目录视图</a></li>
<li><a href="http://blog.csdn.net/zhongweijian?viewmode=list" target="_blank"><img src="" alt="">摘要视图</a></li>
<li><a href="http://blog.csdn.net/zhongweijian/rss/list" target="_blank"><img src="" alt="">订阅</a>
<a href="http://blog.csdn.net/blogdevteam/article/details/8055079" target="_blank">“移动开发那点事”——主题征文活动</a>    <a href="http://hbtc2012.hadooper.cn/" target="_blank">浓缩六届精华，国内大数据领域最纯粹技术盛会</a>     <a href="http://blog.csdn.net/liushizao/article/details/8012164" target="_blank">CSDN高校俱乐部专家巡讲讲师招募</a>
<a href="http://mdcc.csdn.net/" target="_blank">移动开发者大会最新议题发布，八折抢票！</a>     <a href="http://blog.csdn.net/csdnproduct/article/details/8071931" target="_blank">新版论坛全民公测！</a>    <a href="http://blog.csdn.net/blogdevteam/article/details/8052186" target="_blank">2012年10月当选微软MVP的CSDN会员名单揭晓！</a></li>
</ul>
<h3 id="-httpurlconnection-java-host-ip-"><a href="">HttpUrlConnection底层实现和关于java host绑定ip即时生效的设置及分析</a></h3>
<p>分类： <a href="http://blog.csdn.net/zhongweijian/article/category/640345" target="_blank">java</a>  2012-05-31 13:49 202人阅读 <a href="http://blog.csdn.net/zhongweijian/article/details/7619453#comments" target="_blank">评论</a>(0) <a href="&quot;收藏&quot;">收藏</a> <a href="http://blog.csdn.net/zhongweijian/article/details/7619453#report" title="举报" target="_blank">举报</a>
<strong>[java]</strong> <a href="http://blog.csdn.net/zhongweijian/article/details/7619453#" title="view plain" target="_blank">view plain</a><a href="http://blog.csdn.net/zhongweijian/article/details/7619453#" title="copy" target="_blank">copy</a><a href="http://blog.csdn.net/zhongweijian/article/details/7619453#" title="print" target="_blank">print</a><a href="http://blog.csdn.net/zhongweijian/article/details/7619453#" title="?" target="_blank">?</a></p>
<ol>
<li>最近有个需求需要对于获取URL页面进行host绑定并且立即生效，在java里面实现可以用代理服务器来实现：因为在测试环境下可能需要通过绑定来访问测试环境的应用  </li>
<li>实现代码如下：  </li>
<li></li>
<li>public static String getResponseText(String queryUrl,String host,String ip) { //queryUrl，完整的url，host和ip需要绑定的host和ip  </li>
<li>InputStream is = null;  </li>
<li>BufferedReader br = null;  </li>
<li>StringBuffer res = new StringBuffer();  </li>
<li>try {  </li>
<li>HttpURLConnection httpUrlConn = null;  </li>
<li>URL url = new URL(queryUrl);  </li>
<li>if(ip!=null){  </li>
<li>String str[] = ip.split(&quot;\.&quot;);  </li>
<li>byte[] b =new byte[str.length];  </li>
<li>for(int i=0,len=str.length;i&lt;len;i++){  </li>
<li>b[i] = (byte)(Integer.parseInt(str[i],10));  </li>
<li>}  </li>
<li>Proxy proxy = new Proxy(Proxy.Type.HTTP,  </li>
<li>new InetSocketAddress(InetAddress.getByAddress(b), 80));  //b是绑定的ip，生成proxy代理对象，因为http底层是socket实现，  </li>
<li>httpUrlConn = (HttpURLConnection) url  </li>
<li>.openConnection(proxy);  </li>
<li>}else{  </li>
<li>httpUrlConn = (HttpURLConnection) url  </li>
<li>.openConnection();   </li>
<li>}  </li>
<li>httpUrlConn.setRequestMethod(&quot;GET&quot;);  </li>
<li>httpUrlConn.setDoOutput(true);  </li>
<li>httpUrlConn.setConnectTimeout(2000);  </li>
<li>httpUrlConn.setReadTimeout(2000);  </li>
<li>httpUrlConn.setDefaultUseCaches(false);  </li>
<li>httpUrlConn.setUseCaches(false);  </li>
<li></li>
<li>is = httpUrlConn.getInputStream();  </li>
<li></li>
<li></li>
<li>那么底层对于proxy对象到底是怎么处理，底层的socket实现到底怎么样，带着这个疑惑看了下jdk的rt.jar对于这块的处理  </li>
<li>httpUrlConn = (HttpURLConnection) url.openConnection(proxy)  </li>
<li></li>
<li>java.net.URL类里面的openConnection方法：  </li>
<li>public URLConnection openConnection(Proxy proxy){  </li>
<li>…  </li>
<li>return handler.openConnection(this, proxy); Handler是sun.net.www.protocol.http.Handler.java类，继承java.net. URLStreamHandler.java类，用来处理http连接请求响应的。  </li>
<li>}  </li>
<li></li>
<li>Handler的方法：  </li>
<li>protected java.net.URLConnection openConnection(URL u, Proxy p)  </li>
<li>throws IOException {  </li>
<li>return new HttpURLConnection(u, p, this);  </li>
<li>}  </li>
<li></li>
<li>只是简单的生成sun.net.www.protocl.http.HttpURLConnection对象，并进行初始化  </li>
<li>protected HttpURLConnection(URL u, Proxy p, Handler handler) {  </li>
<li>super(u);  </li>
<li>requests = new MessageHeader();  请求头信息生成类  </li>
<li>responses = new MessageHeader(); 响应头信息解析类  </li>
<li>this.handler = handler;   </li>
<li>instProxy = p;  代理服务器对象  </li>
<li>cookieHandler = (CookieHandler)java.security.AccessController.doPrivileged(  </li>
<li>new java.security.PrivilegedAction() {  </li>
<li>public Object run() {  </li>
<li>return CookieHandler.getDefault();  </li>
<li>}  </li>
<li>});  </li>
<li>cacheHandler = (ResponseCache)java.security.AccessController.doPrivileged(  </li>
<li>new java.security.PrivilegedAction() {  </li>
<li>public Object run() {  </li>
<li>return ResponseCache.getDefault();  </li>
<li>}  </li>
<li>});  </li>
<li>}  </li>
<li></li>
<li></li>
<li>最终在httpUrlConn.getInputStream();才进行socket连接，发送http请求，解析http响应信息。具体过程如下：  </li>
<li></li>
<li>sun.net.www.protocl.http.HttpURLConnection.java的getInputStream方法：  </li>
<li></li>
<li>public synchronized InputStream getInputStream() throws IOException {  </li>
<li></li>
<li>...socket连接  </li>
<li>connect();  </li>
<li>...  </li>
<li>ps = (PrintStream)http.getOutputStream(); 获得输出流，打开连接之后已经生成。  </li>
<li></li>
<li>if (!streaming()) {  </li>
<li>writeRequests();  输出http请求头信息  </li>
<li>}  </li>
<li>...  </li>
<li>http.parseHTTP(responses, pi, this);  解析响应信息  </li>
<li>if(logger.isLoggable(Level.FINEST)) {  </li>
<li>logger.fine(responses.toString());  </li>
<li>}  </li>
<li>inputStream = http.getInputStream();  获得输入流  </li>
<li>}  </li>
<li></li>
<li>其中connect()调用方法链：  </li>
<li>plainConnect(){  </li>
<li>...  </li>
<li>Proxy p = null;  </li>
<li>if (sel != null) {  </li>
<li>URI uri = sun.net.www.ParseUtil.toURI(url);  </li>
<li>Iterator<Proxy> it = sel.select(uri).iterator();  </li>
<li>while (it.hasNext()) {  </li>
<li>p = it.next();  </li>
<li>try {  </li>
<li>if (!failedOnce) {  </li>
<li>http = getNewHttpClient(url, p, connectTimeout);  </li>
<li>...  </li>
<li>}  </li>
<li></li>
<li>getNewHttpClient(){  </li>
<li>...  </li>
<li>return HttpClient.New(url, p, connectTimeout, useCache);  </li>
<li>...  </li>
<li>}  </li>
<li></li>
<li>下面跟进去最终建立socket连接的代码：  </li>
<li>sun.net.www.http.HttpClient.java的openServer()方法建立socket连接：  </li>
<li></li>
<li>protected synchronized void openServer() throws IOException {  </li>
<li>...  </li>
<li>if ((proxy != null) &amp;&amp; (proxy.type() == Proxy.Type.HTTP)) {  </li>
<li>sun.net.www.URLConnection.setProxiedHost(host);  </li>
<li>if (security != null) {  </li>
<li>security.checkConnect(host, port);  </li>
<li>}  </li>
<li>privilegedOpenServer((InetSocketAddress) proxy.address());最终socket连接的是设置的代理服务器的地址，  </li>
<li>...  </li>
<li>}  </li>
<li></li>
<li>private synchronized void privilegedOpenServer(final InetSocketAddress server)  </li>
<li>throws IOException  </li>
<li>{  </li>
<li>try {  </li>
<li>java.security.AccessController.doPrivileged(  </li>
<li>new java.security.PrivilegedExceptionAction() {  </li>
<li>public Object run() throws IOException {  </li>
<li>openServer(server.getHostName(), server.getPort());  注意openserver函数  这里的server的getHostName是设置的代理服务器，（ip或者hostname，如果是host绑定设置的代理服务器的ip，那么这里getHostName出来的就是ip地址，可以去查看InetSocketAddress类的getHostName方法）  </li>
<li>return null;  </li>
<li>}  </li>
<li>});  </li>
<li>} catch (java.security.PrivilegedActionException pae) {  </li>
<li>throw (IOException) pae.getException();  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>public void openServer(String server, int port) throws IOException {  </li>
<li>serverSocket = doConnect(server, port);  生成的Socket连接对象  </li>
<li>try {  </li>
<li>serverOutput = new PrintStream(  </li>
<li>new BufferedOutputStream(serverSocket.getOutputStream()),  </li>
<li>false, encoding);   生成输出流，  </li>
<li>} catch (UnsupportedEncodingException e) {  </li>
<li>throw new InternalError(encoding+&quot; encoding not found&quot;);  </li>
<li>}  </li>
<li>serverSocket.setTcpNoDelay(true);  </li>
<li>}  </li>
<li></li>
<li></li>
<li>protected Socket doConnect (String server, int port)  </li>
<li>throws IOException, UnknownHostException {  </li>
<li>Socket s;  </li>
<li>if (proxy != null) {  </li>
<li>if (proxy.type() == Proxy.Type.SOCKS) {  </li>
<li>s = (Socket) AccessController.doPrivileged(  </li>
<li>new PrivilegedAction() {  </li>
<li>public Object run() {  </li>
<li>return new Socket(proxy);  </li>
<li>}});  </li>
<li>} else  </li>
<li>s = new Socket(Proxy.NO_PROXY);  </li>
<li>} else  </li>
<li>s = new Socket();  </li>
<li>// Instance specific timeouts do have priority, that means  </li>
<li>// connectTimeout &amp; readTimeout (-1 means not set)  </li>
<li>// Then global default timeouts  </li>
<li>// Then no timeout.  </li>
<li>if (connectTimeout &gt;= 0) {  </li>
<li>s.connect(new InetSocketAddress(server, port), connectTimeout);  </li>
<li>} else {  </li>
<li>if (defaultConnectTimeout &gt; 0) {  </li>
<li>s.connect(new InetSocketAddress(server, port), defaultConnectTimeout);//连接到代理服务器，看下面Socket类的connect方法代码  </li>
<li>} else {  </li>
<li>s.connect(new InetSocketAddress(server, port));  </li>
<li>}  </li>
<li>}  </li>
<li>if (readTimeout &gt;= 0)  </li>
<li>s.setSoTimeout(readTimeout);  </li>
<li>else if (defaultSoTimeout &gt; 0) {  </li>
<li>s.setSoTimeout(defaultSoTimeout);  </li>
<li>}  </li>
<li>return s;  </li>
<li>}  </li>
<li></li>
<li>上面的new InetSocketAddress(server, port)这里会涉及到java DNS cache的处理，  </li>
<li></li>
<li>public InetSocketAddress(String hostname, int port) {  </li>
<li>if (port &lt; 0 || port &gt; 0xFFFF) {  </li>
<li>throw new IllegalArgumentException(&quot;port out of range:&quot; + port);  </li>
<li>}  </li>
<li>if (hostname == null) {  </li>
<li>throw new IllegalArgumentException(&quot;hostname can&#39;t be null&quot;);  </li>
<li>}  </li>
<li>try {  </li>
<li>addr = InetAddress.getByName(hostname);  //这里会有java DNS缓存的处理，先从缓存取hostname绑定的ip地址，如果取不到再通过OS的DNS cache机制去取，取不到再从DNS服务器上取。  </li>
<li>} catch(UnknownHostException e) {  </li>
<li>this.hostname = hostname;  </li>
<li>addr = null;  </li>
<li>}  </li>
<li>this.port = port;  </li>
<li>}  </li>
<li></li>
<li></li>
<li></li>
<li>当然最终的Socket.java的connect方法  </li>
<li>java.net.socket  </li>
<li></li>
<li>public void connect(SocketAddress endpoint, int timeout) throws IOException {  </li>
<li>if (endpoint == null)  </li>
<li></li>
<li>if (timeout &lt; 0)  </li>
<li>throw new IllegalArgumentException(&quot;connect: timeout can&#39;t be negative&quot;);  </li>
<li></li>
<li>if (isClosed())  </li>
<li>throw new SocketException(&quot;Socket is closed&quot;);  </li>
<li></li>
<li>if (!oldImpl &amp;&amp; isConnected())  </li>
<li>throw new SocketException(&quot;already connected&quot;);  </li>
<li></li>
<li>if (!(endpoint instanceof InetSocketAddress))  </li>
<li>throw new IllegalArgumentException(&quot;Unsupported address type&quot;);  </li>
<li></li>
<li>InetSocketAddress epoint = (InetSocketAddress) endpoint;  </li>
<li></li>
<li>SecurityManager security = System.getSecurityManager();  </li>
<li>if (security != null) {  </li>
<li>if (epoint.isUnresolved())  </li>
<li>security.checkConnect(epoint.getHostName(),  </li>
<li>epoint.getPort());  </li>
<li>else  </li>
<li>security.checkConnect(epoint.getAddress().getHostAddress(),  </li>
<li>epoint.getPort());  </li>
<li>}  </li>
<li>if (!created)  </li>
<li>createImpl(true);  </li>
<li>if (!oldImpl)  </li>
<li>impl.connect(epoint, timeout);  </li>
<li>else if (timeout == 0) {  </li>
<li>if (epoint.isUnresolved())  //如果没有设置SocketAddress的ip地址，则用域名去访问  </li>
<li>impl.connect(epoint.getAddress().getHostName(),  </li>
<li>epoint.getPort());  </li>
<li>else  </li>
<li>impl.connect(epoint.getAddress(), epoint.getPort());  最终socket连接的是设置的SocketAddress的ip地址，  </li>
<li>} else  </li>
<li>throw new UnsupportedOperationException(&quot;SocketImpl.connect(addr, timeout)&quot;);  </li>
<li>connected = true;  </li>
<li>//* </li>
<li>/* If the socket was not bound before the connect, it is now because </li>
<li>/* the kernel will have picked an ephemeral port &amp; a local address </li>
<li>/*/  </li>
<li>bound = true;  </li>
<li>}  </li>
<li></li>
<li></li>
<li></li>
<li>我们再看下通过socket来发送HTTP请求的处理代码，也就是sun.net.www.protocl.http.HttpURLConnection.java的getInputStream方法中调用的writeRequests()方法：   </li>
<li>private void writeRequests() throws IOException {  这段代码就是封装http请求的头请求信息，通过socket发送出去  </li>
<li>//* print all message headers in the MessageHeader </li>
<li>/* onto the wire - all the ones we&#39;ve set and any </li>
<li>/* others that have been set </li>
<li>/*/  </li>
<li>// send any pre-emptive authentication  </li>
<li>if (http.usingProxy) {  </li>
<li>setPreemptiveProxyAuthentication(requests);  </li>
<li>}  </li>
<li>if (!setRequests) {  </li>
<li></li>
<li>//* We&#39;re very particular about the order in which we </li>
<li>/* set the request headers here.  The order should not </li>
<li>/* matter, but some careless CGI programs have been </li>
<li>/* written to expect a very particular order of the </li>
<li>/* standard headers.  To name names, the order in which </li>
<li>/<em> Navigator3.0 sends them.  In particular, we make /</em>sure/* </li>
<li>/* to send Content-type: &lt;&gt; and Content-length:&lt;&gt; second </li>
<li>/* to last and last, respectively, in the case of a POST </li>
<li>/* request. </li>
<li>/*/  </li>
<li>if (!failedOnce)  </li>
<li>requests.prepend(method + &quot; &quot; + http.getURLFile()+&quot; &quot;  +  </li>
<li>httpVersion, null);  </li>
<li>if (!getUseCaches()) {  </li>
<li>requests.setIfNotSet (&quot;Cache-Control&quot;, &quot;no-cache&quot;);  </li>
<li>requests.setIfNotSet (&quot;Pragma&quot;, &quot;no-cache&quot;);  </li>
<li>}  </li>
<li>requests.setIfNotSet(&quot;User-Agent&quot;, userAgent);  </li>
<li>int port = url.getPort();  </li>
<li>String host = url.getHost();  </li>
<li>if (port != -1 &amp;&amp; port != url.getDefaultPort()) {  </li>
<li>host += &quot;:&quot; + String.valueOf(port);  </li>
<li>}  </li>
<li>requests.setIfNotSet(&quot;Host&quot;, host);  </li>
<li>requests.setIfNotSet(&quot;Accept&quot;, acceptString);  </li>
<li></li>
<li>//* </li>
<li>/* For HTTP/1.1 the default behavior is to keep connections alive. </li>
<li>/* However, we may be talking to a 1.0 server so we should set </li>
<li>/* keep-alive just in case, except if we have encountered an error </li>
<li>/* or if keep alive is disabled via a system property </li>
<li>/*/  </li>
<li></li>
<li>// Try keep-alive only on first attempt  </li>
<li>if (!failedOnce &amp;&amp; http.getHttpKeepAliveSet()) {  </li>
<li>if (http.usingProxy) {  </li>
<li>requests.setIfNotSet(&quot;Proxy-Connection&quot;, &quot;keep-alive&quot;);  </li>
<li>} else {  </li>
<li>requests.setIfNotSet(&quot;Connection&quot;, &quot;keep-alive&quot;);  </li>
<li>}  </li>
<li>} else {  </li>
<li>//* </li>
<li>/* RFC 2616 HTTP/1.1 section 14.10 says: </li>
<li>/* HTTP/1.1 applications that do not support persistent </li>
<li>/* connections MUST include the &quot;close&quot; connection option </li>
<li>/* in every message </li>
<li>/*/  </li>
<li>requests.setIfNotSet(&quot;Connection&quot;, &quot;close&quot;);  </li>
<li>}  </li>
<li>// Set modified since if necessary  </li>
<li>long modTime = getIfModifiedSince();  </li>
<li>if (modTime != 0 ) {  </li>
<li>Date date = new Date(modTime);  </li>
<li>//use the preferred date format according to RFC 2068(HTTP1.1),  </li>
<li>// RFC 822 and RFC 1123  </li>
<li>SimpleDateFormat fo =  </li>
<li>new SimpleDateFormat (&quot;EEE, dd MMM yyyy HH:mm:ss &#39;GMT&#39;&quot;, Locale.US);  </li>
<li>fo.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));  </li>
<li>requests.setIfNotSet(&quot;If-Modified-Since&quot;, fo.format(date));  </li>
<li>}  </li>
<li>// check for preemptive authorization  </li>
<li>AuthenticationInfo sauth = AuthenticationInfo.getServerAuth(url);  </li>
<li>if (sauth != null &amp;&amp; sauth.supportsPreemptiveAuthorization() ) {  </li>
<li>// Sets &quot;Authorization&quot;  </li>
<li>requests.setIfNotSet(sauth.getHeaderName(), sauth.getHeaderValue(url,method));  </li>
<li>currentServerCredentials = sauth;  </li>
<li>}  </li>
<li></li>
<li>if (!method.equals(&quot;PUT&quot;) &amp;&amp; (poster != null || streaming())) {  </li>
<li>requests.setIfNotSet (&quot;Content-type&quot;,  </li>
<li>&quot;application/x-www-form-urlencoded&quot;);  </li>
<li>}  </li>
<li></li>
<li>if (streaming()) {  </li>
<li>if (chunkLength != -1) {  </li>
<li>requests.set (&quot;Transfer-Encoding&quot;, &quot;chunked&quot;);  </li>
<li>} else {  </li>
<li>requests.set (&quot;Content-Length&quot;, String.valueOf(fixedContentLength));  </li>
<li>}  </li>
<li>} else if (poster != null) {  </li>
<li>//<em> add Content-Length &amp; POST/PUT data /</em>/  </li>
<li>synchronized (poster) {  </li>
<li>//<em> close it, so no more data can be added /</em>/  </li>
<li>poster.close();  </li>
<li>requests.set(&quot;Content-Length&quot;,  </li>
<li>String.valueOf(poster.size()));  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>// get applicable cookies based on the uri and request headers  </li>
<li>// add them to the existing request headers  </li>
<li>setCookieHeader();  </li>
<li>…  </li>
<li>}  </li>
<li></li>
<li></li>
<li>再来看看把socket响应信息解析为http的响应信息的代码：  </li>
<li>sun.net.www.http.HttpClient.java的parseHTTP方法：  </li>
<li>private boolean parseHTTPHeader(MessageHeader responses, ProgressSource pi, HttpURLConnection httpuc)  </li>
<li>throws IOException {  </li>
<li>//<em> If &quot;HTTP//</em>&quot; is found in the beginning, return true.  Let </li>
<li>/* HttpURLConnection parse the mime header itself. </li>
<li>/* </li>
<li>/* If this isn&#39;t valid HTTP, then we don&#39;t try to parse a header </li>
<li>/* out of the beginning of the response into the responses, </li>
<li>/* and instead just queue up the output stream to it&#39;s very beginning. </li>
<li>/* This seems most reasonable, and is what the NN browser does. </li>
<li>/*/  </li>
<li></li>
<li>keepAliveConnections = -1;  </li>
<li>keepAliveTimeout = 0;  </li>
<li></li>
<li>boolean ret = false;  </li>
<li>byte[] b = new byte[8];  </li>
<li></li>
<li>try {  </li>
<li>int nread = 0;  </li>
<li>serverInput.mark(10);  </li>
<li>while (nread &lt; 8) {  </li>
<li>int r = serverInput.read(b, nread, 8 - nread);  </li>
<li>if (r &lt; 0) {  </li>
<li>break;  </li>
<li>}  </li>
<li>nread += r;  </li>
<li>}  </li>
<li>String keep=null;  </li>
<li>ret = b[0] == &#39;H&#39; &amp;&amp; b[1] == &#39;T&#39;  </li>
<li>&amp;&amp; b[2] == &#39;T&#39; &amp;&amp; b[3] == &#39;P&#39; &amp;&amp; b[4] == &#39;/&#39; &amp;&amp;  </li>
<li>b[5] == &#39;1&#39; &amp;&amp; b[6] == &#39;.&#39;;  </li>
<li>serverInput.reset();  </li>
<li>if (ret) { // is valid HTTP - response started w/ &quot;HTTP/1.&quot;  </li>
<li>responses.parseHeader(serverInput);  </li>
<li></li>
<li>// we&#39;ve finished parsing http headers  </li>
<li>// check if there are any applicable cookies to set (in cache)  </li>
<li>if (cookieHandler != null) {  </li>
<li>URI uri = ParseUtil.toURI(url);  </li>
<li>// NOTE: That cast from Map shouldn&#39;t be necessary but  </li>
<li>// a bug in javac is triggered under certain circumstances  </li>
<li>// So we do put the cast in as a workaround until  </li>
<li>// it is resolved.  </li>
<li>if (uri != null)  </li>
<li>cookieHandler.put(uri, (Map<java.lang.String,java.util.List<java.lang.String>&gt;)responses.getHeaders());  </li>
<li>}  </li>
<li></li>
<li>//* decide if we&#39;re keeping alive: </li>
<li>/* This is a bit tricky.  There&#39;s a spec, but most current </li>
<li>/* servers (10/1/96) that support this differ in dialects. </li>
<li>/* If the server/client misunderstand each other, the </li>
<li>/* protocol should fall back onto HTTP/1.0, no keep-alive. </li>
<li>/*/  </li>
<li>if (usingProxy) { // not likely a proxy will return this  </li>
<li>keep = responses.findValue(&quot;Proxy-Connection&quot;);  </li>
<li>}  </li>
<li>if (keep == null) {  </li>
<li>keep = responses.findValue(&quot;Connection&quot;);  </li>
<li>}  </li>
<li>if (keep != null &amp;&amp; keep.toLowerCase().equals(&quot;keep-alive&quot;)) {  </li>
<li>//* some servers, notably Apache1.1, send something like: </li>
<li>/* &quot;Keep-Alive: timeout=15, max=1&quot; which we should respect. </li>
<li>/*/  </li>
<li>HeaderParser p = new HeaderParser(  </li>
<li>responses.findValue(&quot;Keep-Alive&quot;));  </li>
<li>if (p != null) {  </li>
<li>//<em> default should be larger in case of proxy /</em>/  </li>
<li>keepAliveConnections = p.findInt(&quot;max&quot;, usingProxy?50:5);  </li>
<li>keepAliveTimeout = p.findInt(&quot;timeout&quot;, usingProxy?60:5);  </li>
<li>}  </li>
<li>} else if (b[7] != &#39;0&#39;) {  </li>
<li>//* </li>
<li>/* We&#39;re talking 1.1 or later. Keep persistent until </li>
<li>/* the server says to close. </li>
<li>/*/  </li>
<li>if (keep != null) {  </li>
<li>//* </li>
<li>/* The only Connection token we understand is close. </li>
<li>/* Paranoia: if there is any Connection header then </li>
<li>/* treat as non-persistent. </li>
<li>/*/  </li>
<li>keepAliveConnections = 1;  </li>
<li>} else {  </li>
<li>keepAliveConnections = 5;  </li>
<li>}  </li>
<li>}  </li>
<li>……  </li>
<li>}  </li>
<li></li>
<li></li>
<li>对于java.net包的http，ftp等各种协议的底层实现，可以参考rt.jar下面的几个包的代码：  </li>
<li>sun.net.www.protocl下的几个包。  </li>
<li></li>
<li></li>
<li>在http client中也可以设置代理：  </li>
<li>HostConfiguration conf = new HostConfiguration();  </li>
<li>conf.setHost(host);  </li>
<li>conf.setProxy(ip, 80);  </li>
<li>statusCode = httpclient.executeMethod(conf,getMethod);  </li>
<li></li>
<li>httpclient自己也是基于socket封装的http处理的库。底层代理的实现是一样的。  </li>
<li></li>
<li></li>
<li>另外一种不设置代理，通过反射修改InetAddress的cache也是ok的。但是这种方法非常不推荐，不要使用，因为对于proxy代理服务器概念了解不清楚，最开始还使用这种方法，  </li>
<li>public static void jdkDnsNoCache(final String host, final String ip)  </li>
<li>throws SecurityException, NoSuchFieldException,  </li>
<li>IllegalArgumentException, IllegalAccessException {  </li>
<li>if (StringUtils.isBlank(host)) {  </li>
<li>return;  </li>
<li>}  </li>
<li>final Class clazz = java.net.InetAddress.class;  </li>
<li>final Field cacheField = clazz.getDeclaredField(&quot;addressCache&quot;);  </li>
<li>cacheField.setAccessible(true);  </li>
<li>final Object o = cacheField.get(clazz);  </li>
<li>Class clazz2 = o.getClass();  </li>
<li>final Field cacheMapField = clazz2.getDeclaredField(&quot;cache&quot;);  </li>
<li>cacheMapField.setAccessible(true);  </li>
<li>final Map cacheMap = (Map) cacheMapField.get(o);  </li>
<li>AccessController.doPrivileged(new PrivilegedAction() {  </li>
<li>public Object run() {  </li>
<li>try {  </li>
<li>synchronized (o) {// 同步是必须的,因为o可能会有多个线程同时访问修改。  </li>
<li>// cacheMap.clear();//这步比较关键，用于清除原来的缓存  </li>
<li>//                   cacheMap.remove(host);  </li>
<li>if (!StringUtils.isBlank(ip)) {  </li>
<li>InetAddress inet = InetAddress.getByAddress(host,IPUtil.int2byte(ip));  </li>
<li>InetAddress addressstart = InetAddress.getByName(host);  </li>
<li>Object cacheEntry = cacheMap.get(host);  </li>
<li>cacheMap.put(host,newCacheEntry(inet,cacheEntry));  </li>
<li>//                       cacheMap.put(host,newCacheEntry(newInetAddress(host, ip)));  </li>
<li>}else{  </li>
<li>cacheMap.remove(host);  </li>
<li>}  </li>
<li>//                   System.out.println(getStaticProperty(  </li>
<li>//                          &quot;java.net.InetAddress&quot;, &quot;addressCacheInit&quot;));  </li>
<li>// System.out.println(invokeStaticMethod(&quot;java.net.InetAddress&quot;,&quot;getCachedAddress&quot;,new  </li>
<li>// Object[]{host}));  </li>
<li>}  </li>
<li>} catch (Throwable te) {  </li>
<li>throw new RuntimeException(te);  </li>
<li>}  </li>
<li>return null;  </li>
<li>}  </li>
<li>});  </li>
<li>final Map cacheMapafter = (Map) cacheMapField.get(o);  </li>
<li>System.out.println(cacheMapafter);  </li>
<li></li>
<li>}  </li>
<li></li>
<li>关于java中对于DNS的缓存设置可以参考：  </li>
<li>1.在${java_home}/jre/lib/secuiry/java.secuiry文件，修改下面为   </li>
<li>networkaddress.cache.negative.ttl=0   DNS解析不成功的缓存时间  </li>
<li>networkaddress.cache.ttl=0    DNS解析成功的缓存的时间  </li>
<li>2.jvm启动时增加下面两个启动环境变量  </li>
<li>-Dsun.net.inetaddr.ttl=0  </li>
<li>-Dsun.net.inetaddr.negative.ttl=0  </li>
<li></li>
<li></li>
<li>如果在java程序中使用，可以这么设置设置：  </li>
<li>java.security.Security.setProperty(&quot;networkaddress.cache.ttl&quot; , &quot;0&quot;);  </li>
<li>java.security.Security.setProperty(&quot;networkaddress.cache.negative.ttl&quot; , &quot;0&quot;);  </li>
<li></li>
<li>还有几篇文档链接可以查看：  </li>
<li><a href="http://www.rgagnon.com/javadetails/java-0445.html" target="_blank">http://www.rgagnon.com/javadetails/java-0445.html</a>  </li>
<li><a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6247501" target="_blank">http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6247501</a>  </li>
<li></li>
<li>linux下关于ＯＳ　ＤＮＳ设置的几个文件是  </li>
<li>/etc/resolve.conf  </li>
<li>/etc/nscd.conf  </li>
<li>/etc/nsswitch.conf  </li>
<li></li>
<li><a href="http://www.linuxfly.org/post/543/" target="_blank">http://www.linuxfly.org/post/543/</a>  </li>
<li><a href="http://linux.die.net/man/5/nscd.conf" target="_blank">http://linux.die.net/man/5/nscd.conf</a>  </li>
<li><a href="http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_:_Ch18_:_Configuring_DNS" target="_blank">http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_:_Ch18_:_Configuring_DNS</a>  </li>
<li><a href="http://linux.die.net/man/5/nscd.conf" target="_blank">http://linux.die.net/man/5/nscd.conf</a><br>最近有个需求需要对于获取URL页面进行host绑定并且立即生效，在java里面实现可以用代理服务器来实现：因为在测试环境下可能需要通过绑定来访问测试环境的应用 实现代码如下： public static String getResponseText(String queryUrl,String host,String ip) { //queryUrl，完整的url，host和ip需要绑定的host和ip InputStream is = null; BufferedReader br = null; StringBuffer res = new StringBuffer(); try { HttpURLConnection httpUrlConn = null; URL url = new URL(queryUrl); if(ip!=null){ String str[] = ip.split(&quot;\.&quot;); byte[] b =new byte[str.length]; for(int i=0,len=str.length;i<len;i++){ b[i] = (byte)(Integer.parseInt(str[i],10)); } Proxy proxy = new Proxy(Proxy.Type.HTTP, new InetSocketAddress(InetAddress.getByAddress(b), 80)); //b是绑定的ip，生成proxy代理对象，因为http底层是socket实现， httpUrlConn = (HttpURLConnection) url .openConnection(proxy); }else{ httpUrlConn = (HttpURLConnection) url .openConnection(); } httpUrlConn.setRequestMethod("GET"); httpUrlConn.setDoOutput(true); httpUrlConn.setConnectTimeout(2000); httpUrlConn.setReadTimeout(2000); httpUrlConn.setDefaultUseCaches(false); httpUrlConn.setUseCaches(false); is = httpUrlConn.getInputStream(); 那么底层对于proxy对象到底是怎么处理，底层的socket实现到底怎么样，带着这个疑惑看了下jdk的rt.jar对于这块的处理 httpUrlConn = (HttpURLConnection) url.openConnection(proxy) java.net.URL类里面的openConnection方法： public URLConnection openConnection(Proxy proxy){ … return handler.openConnection(this, proxy); Handler是sun.net.www.protocol.http.Handler.java类，继承java.net. URLStreamHandler.java类，用来处理http连接请求响应的。 } Handler的方法： protected java.net.URLConnection openConnection(URL u, Proxy p) throws IOException { return new HttpURLConnection(u, p, this); } 只是简单的生成sun.net.www.protocl.http.HttpURLConnection对象，并进行初始化 protected HttpURLConnection(URL u, Proxy p, Handler handler) { super(u); requests = new MessageHeader(); 请求头信息生成类 responses = new MessageHeader(); 响应头信息解析类 this.handler = handler; instProxy = p; 代理服务器对象 cookieHandler = (CookieHandler)java.security.AccessController.doPrivileged( new java.security.PrivilegedAction() { public Object run() { return CookieHandler.getDefault(); } }); cacheHandler = (ResponseCache)java.security.AccessController.doPrivileged( new java.security.PrivilegedAction() { public Object run() { return ResponseCache.getDefault(); } }); } 最终在httpUrlConn.getInputStream();才进行socket连接，发送http请求，解析http响应信息。具体过程如下： sun.net.www.protocl.http.HttpURLConnection.java的getInputStream方法： public synchronized InputStream getInputStream() throws IOException { ...socket连接 connect(); ... ps = (PrintStream)http.getOutputStream(); 获得输出流，打开连接之后已经生成。 if (!streaming()) { writeRequests(); 输出http请求头信息 } ... http.parseHTTP(responses, pi, this); 解析响应信息 if(logger.isLoggable(Level.FINEST)) { logger.fine(responses.toString()); } inputStream = http.getInputStream(); 获得输入流 } 其中connect()调用方法链： plainConnect(){ ... Proxy p = null; if (sel != null) { URI uri = sun.net.www.ParseUtil.toURI(url); Iterator<Proxy> it = sel.select(uri).iterator(); while (it.hasNext()) { p = it.next(); try { if (!failedOnce) { http = getNewHttpClient(url, p, connectTimeout); ... } getNewHttpClient(){ ... return HttpClient.New(url, p, connectTimeout, useCache); ... } 下面跟进去最终建立socket连接的代码： sun.net.www.http.HttpClient.java的openServer()方法建立socket连接： protected synchronized void openServer() throws IOException { ... if ((proxy != null) &amp;&amp; (proxy.type() == Proxy.Type.HTTP)) { sun.net.www.URLConnection.setProxiedHost(host); if (security != null) { security.checkConnect(host, port); } privilegedOpenServer((InetSocketAddress) proxy.address());最终socket连接的是设置的代理服务器的地址， ... } private synchronized void privilegedOpenServer(final InetSocketAddress server) throws IOException { try { java.security.AccessController.doPrivileged( new java.security.PrivilegedExceptionAction() { public Object run() throws IOException { openServer(server.getHostName(), server.getPort()); 注意openserver函数 这里的server的getHostName是设置的代理服务器，（ip或者hostname，如果是host绑定设置的代理服务器的ip，那么这里getHostName出来的就是ip地址，可以去查看InetSocketAddress类的getHostName方法） return null; } }); } catch (java.security.PrivilegedActionException pae) { throw (IOException) pae.getException(); } } public void openServer(String server, int port) throws IOException { serverSocket = doConnect(server, port); 生成的Socket连接对象 try { serverOutput = new PrintStream( new BufferedOutputStream(serverSocket.getOutputStream()), false, encoding); 生成输出流， } catch (UnsupportedEncodingException e) { throw new InternalError(encoding+&quot; encoding not found&quot;); } serverSocket.setTcpNoDelay(true); } protected Socket doConnect (String server, int port) throws IOException, UnknownHostException { Socket s; if (proxy != null) { if (proxy.type() == Proxy.Type.SOCKS) { s = (Socket) AccessController.doPrivileged( new PrivilegedAction() { public Object run() { return new Socket(proxy); }}); } else s = new Socket(Proxy.NO<em>PROXY); } else s = new Socket(); // Instance specific timeouts do have priority, that means // connectTimeout &amp; readTimeout (-1 means not set) // Then global default timeouts // Then no timeout. if (connectTimeout &gt;= 0) { s.connect(new InetSocketAddress(server, port), connectTimeout); } else { if (defaultConnectTimeout &gt; 0) { s.connect(new InetSocketAddress(server, port), defaultConnectTimeout);//连接到代理服务器，看下面Socket类的connect方法代码 } else { s.connect(new InetSocketAddress(server, port)); } } if (readTimeout &gt;= 0) s.setSoTimeout(readTimeout); else if (defaultSoTimeout &gt; 0) { s.setSoTimeout(defaultSoTimeout); } return s; } 上面的new InetSocketAddress(server, port)这里会涉及到java DNS cache的处理， public InetSocketAddress(String hostname, int port) { if (port &lt; 0 || port &gt; 0xFFFF) { throw new IllegalArgumentException(&quot;port out of range:&quot; + port); } if (hostname == null) { throw new IllegalArgumentException(&quot;hostname can&#39;t be null&quot;); } try { addr = InetAddress.getByName(hostname); //这里会有java DNS缓存的处理，先从缓存取hostname绑定的ip地址，如果取不到再通过OS的DNS cache机制去取，取不到再从DNS服务器上取。 } catch(UnknownHostException e) { this.hostname = hostname; addr = null; } this.port = port; } 当然最终的Socket.java的connect方法 java.net.socket public void connect(SocketAddress endpoint, int timeout) throws IOException { if (endpoint == null) if (timeout &lt; 0) throw new IllegalArgumentException(&quot;connect: timeout can&#39;t be negative&quot;); if (isClosed()) throw new SocketException(&quot;Socket is closed&quot;); if (!oldImpl &amp;&amp; isConnected()) throw new SocketException(&quot;already connected&quot;); if (!(endpoint instanceof InetSocketAddress)) throw new IllegalArgumentException(&quot;Unsupported address type&quot;); InetSocketAddress epoint = (InetSocketAddress) endpoint; SecurityManager security = System.getSecurityManager(); if (security != null) { if (epoint.isUnresolved()) security.checkConnect(epoint.getHostName(), epoint.getPort()); else security.checkConnect(epoint.getAddress().getHostAddress(), epoint.getPort()); } if (!created) createImpl(true); if (!oldImpl) impl.connect(epoint, timeout); else if (timeout == 0) { if (epoint.isUnresolved()) //如果没有设置SocketAddress的ip地址，则用域名去访问 impl.connect(epoint.getAddress().getHostName(), epoint.getPort()); else impl.connect(epoint.getAddress(), epoint.getPort()); 最终socket连接的是设置的SocketAddress的ip地址， } else throw new UnsupportedOperationException(&quot;SocketImpl.connect(addr, timeout)&quot;); connected = true; //<em> /</em> If the socket was not bound before the connect, it is now because /<em> the kernel will have picked an ephemeral port &amp; a local address /</em>/ bound = true; } 我们再看下通过socket来发送HTTP请求的处理代码，也就是sun.net.www.protocl.http.HttpURLConnection.java的getInputStream方法中调用的writeRequests()方法： private void writeRequests() throws IOException { 这段代码就是封装http请求的头请求信息，通过socket发送出去 //<em> print all message headers in the MessageHeader /</em> onto the wire - all the ones we&#39;ve set and any /<em> others that have been set /</em>/ // send any pre-emptive authentication if (http.usingProxy) { setPreemptiveProxyAuthentication(requests); } if (!setRequests) { //<em> We&#39;re very particular about the order in which we /</em> set the request headers here. The order should not /<em> matter, but some careless CGI programs have been /</em> written to expect a very particular order of the /<em> standard headers. To name names, the order in which /</em> Navigator3.0 sends them. In particular, we make /<em>sure/</em> /<em> to send Content-type: &lt;&gt; and Content-length:&lt;&gt; second /</em> to last and last, respectively, in the case of a POST /<em> request. /</em>/ if (!failedOnce) requests.prepend(method + &quot; &quot; + http.getURLFile()+&quot; &quot; + httpVersion, null); if (!getUseCaches()) { requests.setIfNotSet (&quot;Cache-Control&quot;, &quot;no-cache&quot;); requests.setIfNotSet (&quot;Pragma&quot;, &quot;no-cache&quot;); } requests.setIfNotSet(&quot;User-Agent&quot;, userAgent); int port = url.getPort(); String host = url.getHost(); if (port != -1 &amp;&amp; port != url.getDefaultPort()) { host += &quot;:&quot; + String.valueOf(port); } requests.setIfNotSet(&quot;Host&quot;, host); requests.setIfNotSet(&quot;Accept&quot;, acceptString); //<em> /</em> For HTTP/1.1 the default behavior is to keep connections alive. /<em> However, we may be talking to a 1.0 server so we should set /</em> keep-alive just in case, except if we have encountered an error /<em> or if keep alive is disabled via a system property /</em>/ // Try keep-alive only on first attempt if (!failedOnce &amp;&amp; http.getHttpKeepAliveSet()) { if (http.usingProxy) { requests.setIfNotSet(&quot;Proxy-Connection&quot;, &quot;keep-alive&quot;); } else { requests.setIfNotSet(&quot;Connection&quot;, &quot;keep-alive&quot;); } } else { //<em> /</em> RFC 2616 HTTP/1.1 section 14.10 says: /<em> HTTP/1.1 applications that do not support persistent /</em> connections MUST include the &quot;close&quot; connection option /<em> in every message /</em>/ requests.setIfNotSet(&quot;Connection&quot;, &quot;close&quot;); } // Set modified since if necessary long modTime = getIfModifiedSince(); if (modTime != 0 ) { Date date = new Date(modTime); //use the preferred date format according to RFC 2068(HTTP1.1), // RFC 822 and RFC 1123 SimpleDateFormat fo = new SimpleDateFormat (&quot;EEE, dd MMM yyyy HH:mm:ss &#39;GMT&#39;&quot;, Locale.US); fo.setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;)); requests.setIfNotSet(&quot;If-Modified-Since&quot;, fo.format(date)); } // check for preemptive authorization AuthenticationInfo sauth = AuthenticationInfo.getServerAuth(url); if (sauth != null &amp;&amp; sauth.supportsPreemptiveAuthorization() ) { // Sets &quot;Authorization&quot; requests.setIfNotSet(sauth.getHeaderName(), sauth.getHeaderValue(url,method)); currentServerCredentials = sauth; } if (!method.equals(&quot;PUT&quot;) &amp;&amp; (poster != null || streaming())) { requests.setIfNotSet (&quot;Content-type&quot;, &quot;application/x-www-form-urlencoded&quot;); } if (streaming()) { if (chunkLength != -1) { requests.set (&quot;Transfer-Encoding&quot;, &quot;chunked&quot;); } else { requests.set (&quot;Content-Length&quot;, String.valueOf(fixedContentLength)); } } else if (poster != null) { //<em> add Content-Length &amp; POST/PUT data /</em>/ synchronized (poster) { //<em> close it, so no more data can be added /</em>/ poster.close(); requests.set(&quot;Content-Length&quot;, String.valueOf(poster.size())); } } // get applicable cookies based on the uri and request headers // add them to the existing request headers setCookieHeader(); … } 再来看看把socket响应信息解析为http的响应信息的代码： sun.net.www.http.HttpClient.java的parseHTTP方法： private boolean parseHTTPHeader(MessageHeader responses, ProgressSource pi, HttpURLConnection httpuc) throws IOException { //<em> If &quot;HTTP//</em>&quot; is found in the beginning, return true. Let /<em> HttpURLConnection parse the mime header itself. /</em> /<em> If this isn&#39;t valid HTTP, then we don&#39;t try to parse a header /</em> out of the beginning of the response into the responses, /<em> and instead just queue up the output stream to it&#39;s very beginning. /</em> This seems most reasonable, and is what the NN browser does. /<em>/ keepAliveConnections = -1; keepAliveTimeout = 0; boolean ret = false; byte[] b = new byte[8]; try { int nread = 0; serverInput.mark(10); while (nread &lt; 8) { int r = serverInput.read(b, nread, 8 - nread); if (r &lt; 0) { break; } nread += r; } String keep=null; ret = b[0] == &#39;H&#39; &amp;&amp; b[1] == &#39;T&#39; &amp;&amp; b[2] == &#39;T&#39; &amp;&amp; b[3] == &#39;P&#39; &amp;&amp; b[4] == &#39;/&#39; &amp;&amp; b[5] == &#39;1&#39; &amp;&amp; b[6] == &#39;.&#39;; serverInput.reset(); if (ret) { // is valid HTTP - response started w/ &quot;HTTP/1.&quot; responses.parseHeader(serverInput); // we&#39;ve finished parsing http headers // check if there are any applicable cookies to set (in cache) if (cookieHandler != null) { URI uri = ParseUtil.toURI(url); // NOTE: That cast from Map shouldn&#39;t be necessary but // a bug in javac is triggered under certain circumstances // So we do put the cast in as a workaround until // it is resolved. if (uri != null) cookieHandler.put(uri, (Map<java.lang.String,java.util.List<java.lang.String>&gt;)responses.getHeaders()); } //</em> decide if we&#39;re keeping alive: /<em> This is a bit tricky. There&#39;s a spec, but most current /</em> servers (10/1/96) that support this differ in dialects. /<em> If the server/client misunderstand each other, the /</em> protocol should fall back onto HTTP/1.0, no keep-alive. /<em>/ if (usingProxy) { // not likely a proxy will return this keep = responses.findValue(&quot;Proxy-Connection&quot;); } if (keep == null) { keep = responses.findValue(&quot;Connection&quot;); } if (keep != null &amp;&amp; keep.toLowerCase().equals(&quot;keep-alive&quot;)) { //</em> some servers, notably Apache1.1, send something like: /<em> &quot;Keep-Alive: timeout=15, max=1&quot; which we should respect. /</em>/ HeaderParser p = new HeaderParser( responses.findValue(&quot;Keep-Alive&quot;)); if (p != null) { //<em> default should be larger in case of proxy /</em>/ keepAliveConnections = p.findInt(&quot;max&quot;, usingProxy?50:5); keepAliveTimeout = p.findInt(&quot;timeout&quot;, usingProxy?60:5); } } else if (b[7] != &#39;0&#39;) { //<em> /</em> We&#39;re talking 1.1 or later. Keep persistent until /<em> the server says to close. /</em>/ if (keep != null) { //<em> /</em> The only Connection token we understand is close. /<em> Paranoia: if there is any Connection header then /</em> treat as non-persistent. /*/ keepAliveConnections = 1; } else { keepAliveConnections = 5; } } …… } 对于java.net包的http，ftp等各种协议的底层实现，可以参考rt.jar下面的几个包的代码： sun.net.www.protocl下的几个包。 在http client中也可以设置代理： HostConfiguration conf = new HostConfiguration(); conf.setHost(host); conf.setProxy(ip, 80); statusCode = httpclient.executeMethod(conf,getMethod); httpclient自己也是基于socket封装的http处理的库。底层代理的实现是一样的。 另外一种不设置代理，通过反射修改InetAddress的cache也是ok的。但是这种方法非常不推荐，不要使用，因为对于proxy代理服务器概念了解不清楚，最开始还使用这种方法， public static void jdkDnsNoCache(final String host, final String ip) throws SecurityException, NoSuchFieldException, IllegalArgumentException, IllegalAccessException { if (StringUtils.isBlank(host)) { return; } final Class clazz = java.net.InetAddress.class; final Field cacheField = clazz.getDeclaredField(&quot;addressCache&quot;); cacheField.setAccessible(true); final Object o = cacheField.get(clazz); Class clazz2 = o.getClass(); final Field cacheMapField = clazz2.getDeclaredField(&quot;cache&quot;); cacheMapField.setAccessible(true); final Map cacheMap = (Map) cacheMapField.get(o); AccessController.doPrivileged(new PrivilegedAction() { public Object run() { try { synchronized (o) {// 同步是必须的,因为o可能会有多个线程同时访问修改。 // cacheMap.clear();//这步比较关键，用于清除原来的缓存 // cacheMap.remove(host); if (!StringUtils.isBlank(ip)) { InetAddress inet = InetAddress.getByAddress(host,IPUtil.int2byte(ip)); InetAddress addressstart = InetAddress.getByName(host); Object cacheEntry = cacheMap.get(host); cacheMap.put(host,newCacheEntry(inet,cacheEntry)); // cacheMap.put(host,newCacheEntry(newInetAddress(host, ip))); }else{ cacheMap.remove(host); } // System.out.println(getStaticProperty( // &quot;java.net.InetAddress&quot;, &quot;addressCacheInit&quot;)); // System.out.println(invokeStaticMethod(&quot;java.net.InetAddress&quot;,&quot;getCachedAddress&quot;,new // Object[]{host})); } } catch (Throwable te) { throw new RuntimeException(te); } return null; } }); final Map cacheMapafter = (Map) cacheMapField.get(o); System.out.println(cacheMapafter); } 关于java中对于DNS的缓存设置可以参考： 1.在${java_home}/jre/lib/secuiry/java.secuiry文件，修改下面为 networkaddress.cache.negative.ttl=0 DNS解析不成功的缓存时间 networkaddress.cache.ttl=0 DNS解析成功的缓存的时间 2.jvm启动时增加下面两个启动环境变量 -Dsun.net.inetaddr.ttl=0 -Dsun.net.inetaddr.negative.ttl=0 如果在java程序中使用，可以这么设置设置： java.security.Security.setProperty(&quot;networkaddress.cache.ttl&quot; , &quot;0&quot;); java.security.Security.setProperty(&quot;networkaddress.cache.negative.ttl&quot; , &quot;0&quot;); 还有几篇文档链接可以查看： <a href="http://www.rgagnon.com/javadetails/java-0445.html" target="_blank">http://www.rgagnon.com/javadetails/java-0445.html</a> <a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6247501" target="_blank">http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6247501</a> linux下关于ＯＳ　ＤＮＳ设置的几个文件是 /etc/resolve.conf /etc/nscd.conf /etc/nsswitch.conf <a href="http://www.linuxfly.org/post/543/" target="_blank">http://www.linuxfly.org/post/543/</a> <a href="http://linux.die.net/man/5/nscd.conf" target="_blank">http://linux.die.net/man/5/nscd.conf</a> <a href="http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO" target="_blank">http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO</a></em>:<em>Ch18</em>:_Configuring_DNS <a href="http://linux.die.net/man/5/nscd.conf" target="_blank">http://linux.die.net/man/5/nscd.conf</a></li>
</ol>
<p>分享到： <a href="&quot;分享到新浪微博&quot;"></a><a href="&quot;分享到腾讯微博&quot;"></a></p>
<ol>
<li>上一篇：<a href="http://blog.csdn.net/zhongweijian/article/details/7619440" target="_blank">jetty源码阅读总结1</a></li>
<li><p>下一篇：<a href="http://blog.csdn.net/zhongweijian/article/details/7619460" target="_blank">关于jetty和webx对于HttpServletResponse getWriter和getOutputStream的处理</a>
查看评论<a href=""></a></p>
<p>暂无评论
您还没有登录,请<a href="http://passport.csdn.net/account/login?from=http%3A%2F%2Fblog.csdn.net%2Fzhongweijian%2Farticle%2Fdetails%2F7619453" target="_blank">[登录]</a>或<a href="http://passport.csdn.net/account/register?from=http%3A%2F%2Fblog.csdn.net%2Fzhongweijian%2Farticle%2Fdetails%2F7619453" target="_blank">[注册]</a></p>
</li>
</ol>
<p>/* 以上用户言论只代表其个人观点，不代表CSDN网站的观点或立场<a href=""></a><a href=""></a>
<a href="http://blog.csdn.net/zhongweijian/article/details/7619453#" title="回到顶部" target="_blank"><img src="" alt="TOP"></a></p>
<p>个人资料</p>
<p><a href="http://my.csdn.net/zhongweijian" target="_blank"><img src="&quot;访问我的空间&quot;" alt=""></a>
<a href="http://my.csdn.net/zhongweijian" target="_blank">zhongweijian</a></p>
<p><a href="http://blog.csdn.net/zhongweijian/article/details/7619453#" title="[加关注]" target="_blank"></a> <a href="http://my.csdn.net/my/letter/send/zhongweijian" title="[发私信]"></a>
<a href="http://medal.blog.csdn.net/allmedal.aspx" target="_blank"><img src="" alt=""></a></p>
<ul>
<li>访问：57737次</li>
<li>积分：2164分</li>
<li><p>排名：第2692名</p>
</li>
<li><p>原创：158篇</p>
</li>
<li>转载：3篇</li>
<li>译文：2篇</li>
<li>评论：30条</li>
</ul>
<p>文章搜索</p>
<p><a href=""></a>
文章分类</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/589017" target="_blank">acm</a>(8)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/657598" target="_blank">flash as</a>(1)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/606568" target="_blank">flex</a>(18)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/640345" target="_blank">java</a>(69)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/586565" target="_blank">java web开发</a>(12)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/644484" target="_blank">linux</a>(7)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/657599" target="_blank">web框架</a>(4)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/610388" target="_blank">数据库</a>(11)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/611805" target="_blank">脚本语言</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/1158398" target="_blank">c&amp;c++</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/1158401" target="_blank">nosql</a>(4)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/1158414" target="_blank">jetty&amp;tomcat</a>(4)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/1158428" target="_blank">开源框架</a>(27)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/category/1202606" target="_blank">架构</a>(1)</li>
</ul>
<p>文章存档</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2012/10" target="_blank">2012年10月</a>(1)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2012/09" target="_blank">2012年09月</a>(11)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2012/08" target="_blank">2012年08月</a>(14)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2012/07" target="_blank">2012年07月</a>(9)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2012/06" target="_blank">2012年06月</a>(41)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2012/05" target="_blank">2012年05月</a>(20)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2011/07" target="_blank">2011年07月</a>(1)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2010/06" target="_blank">2010年06月</a>(1)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2010/05" target="_blank">2010年05月</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2010/04" target="_blank">2010年04月</a>(1)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2010/03" target="_blank">2010年03月</a>(6)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2010/02" target="_blank">2010年02月</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2010/01" target="_blank">2010年01月</a>(10)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2009/12" target="_blank">2009年12月</a>(15)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2009/11" target="_blank">2009年11月</a>(4)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2009/10" target="_blank">2009年10月</a>(8)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2009/09" target="_blank">2009年09月</a>(10)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/month/2009/08" target="_blank">2009年08月</a>(7)</li>
</ul>
<p>展开
阅读排行</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/8002034" title="HTTP超文本传输协议-HTTP/1.1中文版" target="_blank">HTTP超文本传输协议-HTTP/1.1中文版</a>(3067)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4692368" title="flex使用lineChart和DateTimeAxis实现时序图" target="_blank">flex使用lineChart和DateTimeAxis实现时序图</a>(3046)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4692668" title="flex柱状图和折线图的混合图使用" target="_blank">flex柱状图和折线图的混合图使用</a>(2486)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4742549" title="jython安装和使用" target="_blank">jython安装和使用</a>(1644)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/5381953" title="flex图表坐标轴样式设置" target="_blank">flex图表坐标轴样式设置</a>(1387)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/5113532" title="flex图表数据动态更新效果示例" target="_blank">flex图表数据动态更新效果示例</a>(1255)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/8002208" title="html5 新特性支持的浏览器检测" target="_blank">html5 新特性支持的浏览器检测</a>(1207)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/5047080" title="flex画直线示例" target="_blank">flex画直线示例</a>(1094)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/5339155" title="flash as3.0动态添加属性和方法" target="_blank">flash as3.0动态添加属性和方法</a>(1062)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/7622675" title="lucene3使用示例" target="_blank">lucene3使用示例</a>(998)</li>
</ul>
<p>评论排行</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4692668" title="flex柱状图和折线图的混合图使用" target="_blank">flex柱状图和折线图的混合图使用</a>(4)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4651329" title="Error parsing XML. org.xml.sax.SAXParseException: Element type &quot;sqlMapConfig&quot; must be declared出错解决方法" target="_blank">Error parsing XML. org.xml.sax.SAXParseException: Element type &quot;sqlMapConfig&quot; must be declared出错解决方法</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4517251" title="大数加减乘除求根源码" target="_blank">大数加减乘除求根源码</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/7619460" title="关于jetty和webx对于HttpServletResponse getWriter和getOutputStream的处理" target="_blank">关于jetty和webx对于HttpServletResponse getWriter和getOutputStream的处理</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4742549" title="jython安装和使用" target="_blank">jython安装和使用</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4504272" title="jfreechart图片无法显示问题" target="_blank">jfreechart图片无法显示问题</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/5160136" title="java 缓存框架java caching system使用示例" target="_blank">java 缓存框架java caching system使用示例</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4865966" title="linux c++连接mysql示例" target="_blank">linux c++连接mysql示例</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4494972" title=" oracle 定长字段查询问题 ，ibatis 与pl/sql查询的char类型字段查询不同" target="_blank">oracle 定长字段查询问题 ，ibatis 与pl/sql查询的char类型字段查询不同</a>(2)</li>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/5069509" title="flex 实现横向树状图" target="_blank">flex 实现横向树状图</a>(1)
推荐文章</li>
</ul>
<p>最新评论</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/7622693#comments" target="_blank">lucene3.6.0的查询条件分析</a></li>
</ul>
<p>main_xtgjfge: 不错——</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/8010745#comments" target="_blank">java内存分配之 Thread Local Allocation Buffer</a></li>
</ul>
<p>chenshufei2: 多个线程不是共享内存共享数据吗，只有进程才有独享的对象吗。，那怎么理解jvm为了优化，给每个线程分配...</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4865966#comments" target="_blank">linux c++连接mysql示例</a></li>
</ul>
<p>zhongweijian: 呵呵，弄错了，</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4865966#comments" target="_blank">linux c++连接mysql示例</a></li>
</ul>
<p>Meteora7: 楼主，换行好像是“\n” 吧</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/7619440#comments" target="_blank">jetty源码阅读总结1</a></li>
</ul>
<p>chancewang001: 很好，学习了</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/7619460#comments" target="_blank">关于jetty和webx对于HttpServletResponse getWriter和getOutputStream的处理</a></li>
</ul>
<p>zhongweijian: webx是做了个adapter能够解决的。</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/7619460#comments" target="_blank">关于jetty和webx对于HttpServletResponse getWriter和getOutputStream的处理</a></li>
</ul>
<p>yj504535760: 还是没有解决这个问题吗</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4742549#comments" target="_blank">jython安装和使用</a></li>
</ul>
<p>iNexus: 试了执行文件的部分。好用，谢谢！</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4517251#comments" target="_blank">大数加减乘除求根源码</a></li>
</ul>
<p>he381835877: 减法有问题啊~&gt;&gt;2 , &gt;&gt;25 &gt;&gt; 329 结果是-696？</p>
<ul>
<li><a href="http://blog.csdn.net/zhongweijian/article/details/4651329#comments" target="_blank">Error parsing XML. org.xml.sax.SAXParseException: Element type &quot;sqlMapConfig&quot; must be declared出错解决方法</a></li>
</ul>
<p>lendar_2010: @ruelang:多了 Config
      <img src="" alt=""></p>
<p><a href="http://www.csdn.net/company/about.html" target="_blank">公司简介</a>|<a href="http://www.csdn.net/company/recruit.html" target="_blank">招贤纳士</a>|<a href="http://www.csdn.net/company/marketing.html" target="_blank">广告服务</a>|<a href="http://www.csdn.net/company/account.html" target="_blank">银行汇款帐号</a>|<a href="http://www.csdn.net/company/contact.html" target="_blank">联系方式</a>|<a href="http://www.csdn.net/company/statement.html" target="_blank">版权声明</a>|<a href="http://www.csdn.net/company/layer.html" target="_blank">法律顾问</a>|<a href="mailto:webmaster@csdn.net">问题报告</a>京 ICP 证 070598 号北京创新乐知信息技术有限公司 版权所有<img src="" alt=""> 联系邮箱：webmaster(at)csdn.netCopyright © 1999-2012, CSDN.NET, All Rights Reserved <a href="http://www.hd315.gov.cn/beian/view.asp?bianhao=010202001032100010" target="_blank"><img src="" alt="GongshangLogo"></a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Httpclient/">Httpclient</a></li></span><span class="breadcrumb"><li><a href="/categories/Httpclient/">Httpclient</a></li><li><a href="/categories/Httpclient/HttpUrlConnection/">HttpUrlConnection</a></li></span></span> | <span class="tags">Tagged <a href="/tags/HttpUrlConnection/" class="label label-primary">HttpUrlConnection</a><a href="/tags/Httpclient/" class="label label-success">Httpclient</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-Httpclient-HttpUrlConnection--HttpUrlConnection底层实现和关于javahost绑定ip即时生效的设置及分析-/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-Httpclient-HttpUrlConnection--HttpUrlConnection底层实现和关于javahost绑定ip即时生效的设置及分析-" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-正则--正则匹配模式/">正则匹配模式</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:37.000Z"> <a href="/2014/02/02/2014-02-02-正则--正则匹配模式/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="-">正则匹配模式</h1>
<p>正则匹配模式
匹配模式指得是正则表达式引擎将以何种模式匹配字符串。
模式名称
启用，禁用
缺省启用
说明UNIX_LINES
(?d)启用，(?-d)禁用
是
启用Unix行模式。
在此模式下，只有 &#39;\n&#39;被认为是行结束符。它会影响., ^, 和 $ 的行为。CASE_INSENSITIVE
(?i)启用，(?-i)禁用
否
启用忽略大小写模式。
缺省时，忽略大小写模式只会影响 ASCII字符的匹配。 而Unicode范围的忽略大小写匹配需要通过 UNICODE_CASE 标志与本标志联合使用。
启用此模式会影响匹配性能。COMMENTS
(?x)启用，(?-x)禁用
否
允许空格和注释出现在正则表达式中。
在此模式下，空格被忽略，以/#开始的单行注释被忽略。MULTILINE
(?m)启用，(?-m)禁用
是
启用多行模式。
In multiline mode the expressions ^ and $ match just after or just before, respectively, a line terminator or the end of the input sequence. By default these expressions only match at the beginning and the end of the entire input sequence.DOTALL
(?s)启用，(?-s)禁用
否
让.可以匹配行结束符。
在此模式下，元字符.可以匹配行结束符。缺省不允许如此匹配。UNICODE_CASE
(?u)启用，(?-u)禁用
否
Enables Unicode-aware case folding.
When this flag is specified then case-insensitive matching, when enabled by theCASE_INSENSITIVE flag, is done in a manner consistent with the Unicode Standard. By default, case-insensitive matching assumes that only characters in the US-ASCII charset are being matched. 启用此模式会影响性能。CANON_EQ
(?c)启用，(?-c)禁用
否
Enables canonical equivalence.
When this flag is specified then two characters will be considered to match if, and only if, their full canonical decompositions match. The expression &quot;a\u030A&quot;, for example, will match the string&quot;?&quot; when this flag is specified. By default, matching does not take canonical equivalence into account.
启用此模式会影响性能。</p>
<p>字符子集　　字符子集可以含有别的字符子集，并且可以通过联合操作符（缺省）和交集操作符（&amp;&amp;）实现组合。联合操作符表示某个子集匹配它的子子集所匹配的任意字符。交集操作符表明某个字符子集只匹配它的子子集都匹配的字符。
字符子集所能够有的操作符的优先级如下，从高到低：
转义符\x
成组符 [...]
区间符 a-z
联合符 [a-e][i-u]
交集符 [a-z&amp;&amp;[aeiou]]</p>
<p>注意：在字符子集[]内部的语法根本不同于正则表达式其它部分中的语法。例如，在字符子集内部，正则表达式 . 失去了它原有的含义，而是成了一个匹配.的元字符。
行结束符　　行结束符是一个或两个字符序列，用以表明输入字符序列中一行的结束。下面的字符被认为是行结束符：
一个换行符(&#39;\n&#39;)。
一个回车符加上一个换行符(&quot;\r\n&quot;)。
一个单独的回车符(&#39;\r&#39;)。
代表下一行的字符(&#39;\u0085&#39;)。
行分隔符(&#39;\u2028&#39;)，Unicode中被定义。
一个分段符(&#39;\u2029)，Unicode中被定义。</p>
<p>如果 UNIX_LINES 模式被启用，则只有换行符被认为是行结束符。
如果 MULTILINE 模式被启用，。
分组和引用　　字符分组以它们的左括号的出现顺序来排序。例如在表达式((A)(B(C)))，有四个分组：
((A)(B(C)))
(A)
(B(C))
(C)</p>
<p>第0组永远表示表达式本身。
分组采用这样的命名方式，是因为，在一次匹配过程中，正则表达式会被匹配多次。以前的匹配子序列有可能在将来被使用；或者在匹配结束时，程序有可能需要重新获得所有匹配的子字符序列。
对于正则表达式中的某个分组而言，永远只保留最后匹配的字符序列。如果对某个分组匹配尝试失败，则会保留上次匹配成功的字符序列。例如，对于正则表达式(a(b)?)+而言，字符序列&quot;aba&quot;，将会让分组2匹配的字符序列为&quot;b&quot;。
以(?开始的分组，将不会计入分组数目，也不会被后续匹配所引用。
Unicode支持　　本正则表达式匹配引擎的实现遵循了《Unicode技术报告：Unicode正则表达式指南》，实现了该指南的第二层所需的功能，但是在细微处有一些简单语法修改。
Unicode块(Block)和分类(Category)通过\p和\P通配苻表示。\p{prop}匹配含有prop的输入序列，而\P{prop}匹配不含有prop的输入序列。Unicode块通过前缀In表示，如\p{InMongolian}。Unicode分类通过可选的前缀Is表示，因此\p{L}和\p{IsL}都代表Unicode分类 letters。Unicode块和分类都可以在正则表达式子集外部和内部使用。
目前支持的Unicode块和分类是《Unicode标准，第三版》中所指定的块和分类。 Unicode块名称在《Unicode 字符数据库》的第14章被定义，文件名称叫Blocks-3.txt，但是名称中的空格被去掉了。例如&quot;Basic Latin&quot;成了&quot;BasicLatin&quot;。无论是标准化的还是非标准化的分类，都在该标准的第88页的第4-5表中被全部定义。
与Perl 5正则表达式语法对比 [TBD]
正则表达式参考
字符
正则表达式字符串
匹配的字符串X
字符X，包括 CJK ExtB 区汉字\
反斜杠\0n八进制0n代表的字符(0&lt;=n&lt;=7)\0nn
八进制0nn代表的字符(0&lt;=n&lt;=7)\0mnn
八进制0mnn代表的字符(0&lt;=m&lt;=3,0&lt;=n&lt;=7)\xhh
十六进制 0xhh所代表的字符\uhhhh
十六进制 0xhhhh所代表的字符。注意，目前尚不支持CJK ExtB区汉字。\t
制表符(&#39;\u0009&#39;)\n
换行(&#39;\u000A&#39;)\r
回车(&#39;\u000D&#39;)\a
响铃符(&#39;\u0007&#39;)\e
取消符Escape(&#39;\001B&#39;)\cx
x所代表的控制字符</p>
<p>逻辑操作符
正则表达式字符串
匹配的字符串XY
X后面跟随YX|Y
X或者Y(X)
X作为分组表达式</p>
<p>向后引用
正则表达式字符串
匹配的字符串\n
第n个匹配的分组</p>
<p>边界元字符
边界字符
匹配的字符串^
行首$
行末\b字符边界\B
非字符边界\A
输入流的开始\G
上次匹配的结束处\Z
输入流的结束，或者是最后一个行结束符，参见[url=file:///D:/source/jtextpro/src/dist/jtextpro/docs/regexp.html/#man_line_terminator]行结束符[/url]。\z
输入流的结束</p>
<p>重复指示符
正则表达式字符串
匹配的字符串X?
X重复一次，或者不重复X/*
X重复0次或多次X+
X重复1次或多次X{n}
X重复n次，不多也不少。X{n,}
X至少重复n次X{n,m}
X至少重复n次，至多重复m次。</p>
<p>注：X{n,m}、?、/*、+方式可以联合使用。
字符子集
正则表达式字符串子集
匹配的字符串
组合方式[abc]
字符a,b或c，包括 CJK ExtB 区汉字
简单子集[^abc]
任意非a,b或c的字符。
排除[a-zA-Z]从a到z，或者A到Z，包含a,z,A,Z。
区间[a-d[m-p]]
从a到d，或者m到p，等于[a-dm-p]。
联合[a-z&amp;&amp;[def]]
d,e或者f。
交集[a-z&amp;&amp;[^bc]]
从a到z，除了b和c，等于[ad-z]
扣除[a-z&amp;&amp;[^m-p]]
从a到z，并且不包括从m到p，等于[a-lq-z]
扣除</p>
<p>预定义子集（元字符）
边界字符
匹配的字符串.
任意字符，可能匹配行结束符。\d
数字[0-9]\D非数字[^0-9]\s
空白符[ \t\n\x0B\f\r]\S
非空白符[^\s]\w
单词符，包含有字母和数字[a-zA-Z_0-9]\W
非单词符，不包含有字母和数字。</p>
<p>扩展子集（元字符）
正则表达式字符串
匹配的字符串</p>
<p>扩展中文子集（元字符）
名称
块名称（\p{InXXX}）
简化通配符
标准Unicode块，或者汉字列表任意双字节字符（汉字或全角符号）
\p{InQuqnJiao}
\E
任意由GBK表示的汉字，不包括GB18030扩展部分，
以及CJK ExtB区的汉字。任意单字节字符
\p{InFQuanJiao}
~E
任意单字节字符。任意全角ASCII字符
\p{InQJAscii}
\H
标准HalfwidthandFullwidthForms块任意收录在BIG5码集中的双字节字符
\p{InBig5}
\I
Big5可编码双字节字符匹配未收录在BIG5码集中的双字节字符\p{InFBig5}
~I
非Big5可编码双字节字符匹配任意汉字(不包括符号)
\p{InHanziOrCJKExtB}
\X
任意汉字，包括GB18030扩展部分。匹配任意汉字(不包括符号)
\p{InHanzi}
\M
任意汉字，不包括GB18030扩展部分。匹配非汉字的双字节字符
\p{InFHanzi}
~M
任意非汉字的双字节字符，
包括GB18030扩展部分。地支字符
\p{InDiZhi}
\U
子丑寅卯辰巳午未申酉戌亥匹配收录在GB码集中的双字节字符
\p{InGB}
\g
收录在GB码集中的双字节字符，
不包括GB18030扩展部分。匹配非收录在GB码集中的双字节字符
\p{InFGB}
~g
未收录在GB码集中的双字节字符，
不包括GB18030扩展部分。匹配收录在GBK码集中的双字节字符
\p{InGBK}
\h
收录在GBK码集中的双字节字符，
不包括GB18030扩展部分。匹配非收录在GBK码集中的双字节字符
\p{InFGBK}
~h
未收录在GBK码集中的双字节字符，
不包括GB18030扩展部分。大写希腊字母
\p{InDaXila}
\K
ΑΒΓΔΕΖΗΘΙΚΛΜΝ
ΞΟΠΡΣΤΥΦΧΨΩ日文片假名
\p{InPianJia}
\j
标准Katakana块日文平假名
\p{InPingJia}
\J
标准Hiragana块小写希腊字母
\p{InXiaoXila}
\k
αβγδεζηθικλμν
ξοπρστυφχψω数学符号
\p{InMathe}
\m
±×÷∶∧∨∑∏∪∩∈∷√⊥∥∠⌒⊙
∫∮≡≌≈∽∝≠≮≯≤≥∞∵∴中文数字
\p{InCnDigit}
\i
〇一二三四五六七八九十百千万亿兆吉京大写中文数字
\p{InDaCnDigit}
\N
零壹贰叁肆伍陆柒捌玖拾佰仟萬亿兆吉京全角标点符号
\p{InQJBiaoDian}
\o
、。·ˉˇ¨〃々—～‖…‘’“”〔〕
〈〉《》「」『』〖〗【】！＂＇（），
－．：；＜＝＞？［］｛｜｝｀﹉﹊﹋﹌﹍﹎﹏﹐﹑﹒﹔﹕﹖﹗﹙﹚
﹛﹜﹝﹞︵︶︹︺︿﹀︽︾﹁﹂﹃﹄
︻︼︷︸︱︳︴小写俄文字母
\p{InXiaoEWen}
\l
абвгдеёжзийклмн
опрстуфхцчшщъыьэюя大写俄文字母
\p{InDaEWen}
\R
АБВГДЕЁЖЗИЙКЛМНО
ПРСТУФХЦЧШЩЪЫЬЭЮЯ中文序号
\p{InCnSN}
\q
ⅠⅡⅢⅣⅤⅥⅦⅧⅨⅩⅪⅫ
ⅰⅱⅲⅳⅴⅵⅶⅷⅸⅹ
再加上Unicode标准EnclosedAlphanumerics块天干字符
\p{InTianGan}
\T
甲乙丙丁戊己庚辛壬癸竖排标点符号
\p{InSPBiaoDian}
\V
︵︶︹︺︿﹀︽︾﹁﹂﹃﹄︻︼︷︸︱︳︴拼音字符
\p{InPinyin}
\y
āáǎàēéěèīíǐìōóǒòūúǔùǖǘǚǜüêɑńňɡ
GBK -&gt; 0xA8A1- 0xA8C0
只是Unicode标准LatinExtended-A块的一部分。注音字符
\p{InZhuyin}
\Y
标准Bopomofo块制表字符
\p{InZhiBiao}
\C
标准BoxDrawing块。
经检查发现 textpro 的算法含有部分非标
准Unicode制表符：“∟∣≒≦≧⊿═”。</p>
<p>POSIX字符子集（只适用于ASCII）
正则表达式字符串
匹配的字符串\p{Lower}
小写字母[a-z]\p{Upper}
大写字母[A-Z]\p{ASCII}
所有的ASCII字符[\x00-\x7F]\p{Alpha}
大小写字母[\p{Lower}\p{Upper}]\p{Digit}
数字[0-9]\p{Alnum}
字母数字符，包含大小写字母和数字[\p{Alpha}\p{Digit}]\p{Punct}
标点符号，!&quot;/#$%&amp;&#39;()/*+,-./:;&lt;=&gt;?@[]^_`{|}~之一。\p{Graph}
可显示字符[\p{Alnum}\p{Punct}]\p{Print}
可打印字符[\p{Graph}]\p{Blank}
空格或者制表符[ \t]\p{Cntrl}
控制字符[\x00-\x1F\x7F\p{XDigit}
十六进制数字[0-9a-fA-F]\p{Space}
空白符[ \t\n\x0B\f\r]</p>
<p>Unicode块和分类
块
中文名称（摘自Word XP）
代码区域BasicLatin
基本拉丁语
\u0000-\u007FLatin-1Supplement
拉丁语-1
\u0080-\u00FFLatinExtended-A
拉丁语扩充-A
\u0100-\u017FLatinExtended-Bound
拉丁语扩充-B
\u0180-\u024FIPAExtensions
国际音标扩充
\u0250-\u02AFSpacingModifierLetters
进格的修饰字符
\u02B0-\u02FFCombiningDiacriticalMarks
组合用发音符
\u0300-\u036FGreek
基本希腊语
\u0370-\u03FFCyrillic
西里尔语
\u0400-\u04FFArmenian
\u0530-\u058FHebrew
\u0590-\u05FFArabic
\u0600-\u06FFSyriac
\u0700-\u074FThaana
\u0780-\u07BFDevanagari
\u0900-\u097FBengali
\u0980-\u09FFGurmukhi
\u0A00-\u0A7FGujarati
\u0A80-\u0AFFOriya
\u0B00-\u0B7FTamil
\u0B80-\u0BFFTelugu
\u0C00-\u0C7FKannada
\u0C80-\u0CFFMalayalam
\u0D00-\u0D7FSinhala
\u0D800-\uDFFThai
\u0E00-\u0E7FLao
\u0E80-\u0EFFTibetan
藏语
\u0F00-\u0FFFMyanmar
\u1000-\u109FGeorgian
\u10A0-\u10FFHangulJamo
\u1100-\u11FFEthiopic
\u1200-\u137FCherokee
\u13A0-\u13FFUnifiedCanadianAboriginalSyllabics
\u1400-\u167FOgham
\u1680-\u169FRunic
\u16A0-\u16FFKhmer
\u1780-\u17FFMongolian
蒙古语
\u1800-\u18AFLatinExtendedAdditional
\u1E00-\u1EFFGreekExtended
\u1F00-\u1FFFGeneralPunctuation
广义标点
\u2000-\u206FSuperscriptsandSubscripts
\u2070-\u209FCurrencySymbols
货币符号
\u20A0-\u20CFCombiningMarksforSymbols
\u20D0-\u20FFLetterlikeSymbols
类似字母的符号
\u2100-\u214FNumberForms
数字形式
\u2150-\u218FArrows
箭头
\u2190-\u21FFMathematicalOperators
数学运算符
\u2200-\u22FFMiscellaneousTechnical
零杂技术用符号
\u2300-\u23FFControlPictures
\u2400-\u243FOpticalCharacterRecognition
\u2440-\u245FEnclosedAlphanumerics
带括号的字母数字
\u2460-\u24FFBoxDrawing
制表符
\u2500-\u257FBlockElements
方块图形
\u2580-\u259FGeometricShapes
几何图形
\u25A0-\u25FFMiscellaneousSymbols
零杂丁贝符（示意符等）
\u2600-\u26FFDingbats
\u2700-\u27BFBraillePatterns
\u2800-\u28FFCJKRadicalsSupplement
\u2E80-\u2EFFKangxiRadicals
\u2F00-\u2FDFIdeographicDescriptionCharacters
\u2FF0-\u2FFFCJKSymbolsandPunctuation
CJK符号和标点
\u3000-\u303FHiragana
平假名
\u3040-\u309FKatakana
片假名
\u30A0-\u30FFBopomofo
注音
\u3100-\u312FHangulCompatibilityJamo
\u3130-\u318FKanbun
\u3190-\u319FBopomofoExtended
扩展注音
\u31A0-\u31BFEnclosedCJKLettersandMonths
带括号的CJK字母及月份
\u3200-\u32FFCJKCompatibility
CJK兼容字符
\u3300-\u33FFCJKUnifiedIdeographsExtensionA
CJK统一汉字扩展-A
\u3400-\u4dBFCJKUnifiedIdeographs
CJK统一汉字
\u4E00-\u9fAFYiSyllables
\uA000-\uA48FYiRadicals
\uA490-\uA4CFHangulSyllables
\uAC00-\uD7A3HighSurrogates
\uD800-\uDB7FHighPrivateUseSurrogates
\uDB80-\uDBFFLowSurrogates
\uDC00-\uDFFFPrivateUse
专用区
\uE000-\uF8FFCJKCompatibilityIdeographs
CJK兼容汉字
\uF900-\uFAFFAlphabeticPresentationForms
\uFB00-\uFB4FArabicPresentationForms-A
\uFB50-\uFDFFCombiningHalfMarks
\uFE20-\uFE2FCJKCompatibilityForms
CJK兼容形式
\uFE30-\uFE4FSmallFormVariants
小写变体
\uFE50-\uFE6FArabicPresentationForms-Bound
\uFE70-\ufeFFSpecials
\uFFF0-\uFFFFHalfwidthandFullwidthForms
半形及全形字符
\uFF00-\uFFEF分类
全称
说明Cn
UNASSIGNEDLu
UPPERCASE_LETTERLl
LOWERCASE_LETTERLt
TITLECASE_LETTERLm
MODIFIER_LETTERLo
OTHER_LETTERMn
NON_SPACING_MARKMe
ENCLOSING_MARKMc
COMBINING_SPACING_MARKNd
DECIMAL_DIGIT_NUMBERNl
LETTER_NUMBERNo
OTHER_NUMBERZs
SPACE_SEPARATORZl
LINE_SEPARATORZp
PARAGRAPH_SEPARATORCc
CNTRLCf
FORMATCo
PRIVATE_USECs
SURROGATEPd
DASH_PUNCTUATIONPs
START_PUNCTUATIONPe
END_PUNCTUATIONPc
CONNECTOR_PUNCTUATIONPo
OTHER_PUNCTUATIONSm
MATH_SYMBOLSc
CURRENCY_SYMBOLSk
MODIFIER_SYMBOLSo
OTHER_SYMBOLL
LETTERM
MARKN
NUMBERZ
SEPARATORC
CONTROLP
PUNCTUATIONS
SYMBOLLD
LETTER_OR_DIGITL1
Latin-1all
ALLASCII
ASCIIAlnum
字母数字(0-9,a-z,A-Z)Alpha
字母(a-z,A-Z)Blank
空格和制表符(&#39; &#39;|\t)Cntrl
控制字符，不可打印Digit
数字(0-9)Graph
可打印且可视字母（例如空格&#39; &#39;是可打印的但不是可视字母，而 `a&#39; 两者都是。）Lower
小写字母Print
可打印字母（非控制字符）Punct
标符号（字母、数字、控制、空白符以外的字母），如：!@/#$%}{&lt;&gt;,./?[]等等。Space
空白符(&#39; &#39;,\t,0x09,0x0A,0x0B,0x0C,0x0D,0x20)Upper
大写字母XDigit
十六进制数字(0-9，a-f, A-F)</p>
<p>替换表达式特殊字符
特殊字符介绍
描述\n
换行\b
向前删除一个字符。当这个字符位于替换串之首时，将删除匹配串之前的一个字符。若匹配串位于行首，将使匹配串所在行与前一行相合并。\d
向后删除一个字符。当这个字符位于替换串之末时，将删除匹配串之后的一个字符。若匹配串位于行末，将使匹配串所在行与下一行相合并。\e
插入一个ESC字符\t
插入一个TAB字符\n
n代表查找正则表达式中的子表达式（组）。\1代表第一个子表达式，\2代表第二个子表达式，依次类推。\0代表整个匹配到的字符串。\v
大写下一个字母\U
全部大写以后的字母，直到碰到其它指示符为止。\l
小写下一个字母\L
全部小写以后的字母，直到碰到其它指示符为止。\E
取消所有的字母大小写指示符。</p>
<p>自定义替换表
在查找／替换中使用自定义替换表
有的时候，上述简单的自定义替换功能是不够的。例如，用户可能希望只把出现在括号内的源串替换为目标串。这种文本处理可以通过在查找/替换中使用自定义替换表来解决。
在查找/替换功能中使用自定义替换表的替换函数是\Tn，其中n是0-9的数字， 注意n为0表示第10张替换表。如果略去n，其效果相当于\T1，即使用第一张替换表。例如要把所有放在方括号中的汉字替换为拼音，可以查找“[(\E)]”，替换为“\T{\1}”。即把第一个子表达式的匹配内容按自定义替换表转换。注意，如果\T函数的参数不在替换表的源串中，\T函数的结果与源串相同，即不做任何变换。
有些情况下，用户可能希望只使用替换表的一部分内容。还是以拼音为例，前面给出的替换表中包含了拼音的音调，如果在替换时不希望加上这些音调数字，可以使用“过滤”功能。所谓过滤，其实是用一个正则表达式去分析替换表的目标串，并把其中的某个子表达式取出来。
使用“过滤”时，在“设置自定义替换表”对话框中，点“过滤”按钮，在弹出的对话框中填入一个正则表达式。再以拼音为例，表达式可以写为“(\p{Alpha}+)(\d)”，其中第一对括号中的是不含音调的拼音，第二对括号是音调。在调用\T函数时，JTextPro会在目标串中查找这个正则表达式。但是如何把其中的子表达式取出来呢？\T函数还有一个可选的下标，取第n个子表达式的值就写作\T{...}[n]。所以，把放在方括号中的汉字替换为不带调的拼音，可以查找“[(\E)]”，替换为“\T{\1}[1]”
匹配汉字：
Regex r= new Regex(@&quot;[\u4e00-\u9fa5]+&quot;);
MatchCollection m=r.Match(yourstring);
－－－－－－－－－－－－－－－－－－－－－－－－－
如果需要使用正则表达式匹配Unicode字符的话...
这里是几个主要非英文语系字符范围(google上找到的):
2E80～33FFh：中日韩符号区。收容康熙字典部首、中日韩辅助部首、注音符号、日本假名、韩文音符，中日韩的符号、标点、带圈或带括符文数字、月份，以及日本的假名组合、单位、年号、月份、日期、时间等。
3400～4DFFh：中日韩认同表意文字扩充A区，总计收容6,582个中日韩汉字。
4E00～9FFFh：中日韩认同表意文字区，总计收容20,902个中日韩汉字。
A000～A4FFh：彝族文字区，收容中国南方彝族文字和字根。
AC00～D7FFh：韩文拼音组合字区，收容以韩文音符拼成的文字。
F900～FAFFh：中日韩兼容表意文字区，总计收容302个中日韩汉字。
FB00～FFFDh：文字表现形式区，收容组合拉丁文字、希伯来文、阿拉伯文、中日韩直式标点、小符号、半角符号、全角符号等。
比如需要匹配所有中日韩非符号字符,那么正则表达式应该是^[\u3400-\u9FFF]+$
理论上没错, 可是我到msn.co.ko随便复制了个韩文下来, 发现根本不对, 诡异
来源： &lt;<a href="http://m.blog.csdn.net/blog/MyGameZone/9786825" target="_blank">正则匹配 - CSDN博客</a>&gt;</p>
<p>字符类别
[:alnum:] 字母和数字 
[:alpha:] 字母 
[:ascii:] 字符代码 0 - 127 
[:blank:] 空格或制表符 
[:cntrl:] 控制字符 
[:digit:] 十进制数字 (相同于 \d) 
[:graph:] 可打印字符, 排除空格 
[:lower:] 小写字母 
[:print:] 可打印字符,包括空格 
[:punct:] 可打印字符, 排除文字和数字 
[:space:] 空白空间 (不完全和 \s 相同, 还包括 VT: chr(11) ) 
[:upper:] 大写字母 
[:word:] &quot;字&quot; 字符 (相同于 \w) 
[:xdigit:] 十六进制数
来源： &lt;<a href="http://hi.baidu.com/haijie4975/item/ac94d70a3164d50beafe38bc" target="_blank"> 正则表达式：匹配符号<em>阿杰</em>百度空间</a>&gt;</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/正则/">正则</a></li></span></span> | <span class="tags">Tagged <a href="/tags/正则/" class="label label-primary">正则</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:37"datetime="2014-03-07 09:54:37"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-正则--正则匹配模式/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-正则--正则匹配模式" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/94/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/92/">92</a></li><li><a class="page-number" href="/page/93/">93</a></li><li><a class="page-number" href="/page/94/">94</a></li><li class="active"><li><span class="page-number current">95</span></li><li><a class="page-number" href="/page/96/">96</a></li><li><a class="page-number" href="/page/97/">97</a></li><li><a class="page-number" href="/page/98/">98</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/163/">163</a></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="extend next" href="/page/96/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Site powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a>  update time: <em>2014-03-29 22:06:56</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
