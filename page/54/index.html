
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The 54 Page | It so life</title>
<meta name="author" content="RobinChia">

<meta name="description" content="It so life">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta property="og:site_name" content="It so life"/>

<!--[if IE]><style>.testIE.IE{display:inline;}</style><![endif]-->
<!--[if lte IE 7]><link rel="stylesheet" href="/css/ie7.css" type="text/css"><![endif]-->
<!--[if (lt IE 9)&(gt IE 7)]><style>.testIE.IE8{display:inline;}</style><![endif]-->
<!--[if gt IE 8]><style>.testIE.IE9{display:inline;}</style><![endif]-->

<link href="/favicon.png" rel="icon">
<link rel="alternate" href="/atom.xml" title="It so life Feed" type="application/atom+xml">

<link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<!--[if lt IE 9]>
   <style>article,aside,dialog,footer,header,section,footer,nav,figure,menu{display:block}</style>
   <script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
   <script src="http://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<link href="http://cdn.staticfile.org/respond.js/1.4.2/respond-proxy.html" id="respond-proxy" rel="respond-proxy" />
<link href="/js/respond.proxy.gif" id="respond-redirect" rel="respond-redirect" />
<script src="/js/respond.proxy.js"></script>
   <script src="http://cdn.bootcss.com/selectivizr/1.0.2/selectivizr-min.js"></script>
<![endif]-->
<script type="text/javascript">
function loadjs(c,d){var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src=c;a.charset=d||"gbk";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(a)};
var _protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
var _js2load = [];
</script>

</head>
<body>
      <header id="header" class="container"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">It so life</a>
    </div>
    <div  class="collapse navbar-collapse">
      <ul  class="nav navbar-nav">
  
        <li><a href="/" title="Home">Home</a></li>      
        <li><a href="/about/" title="About">About</a></li>      
        <li><a href="/archives/" title="Archives">Archives</a></li>      
      <li class='dropdown'>
        <a class='dropdown-toggle' data-toggle='dropdown' href='#'>website<b class='caret'></b></a>
        <ul class='dropdown-menu pure-menu-selected'>
    
          <li><a href="//groups.google.com/forum/#!forum/pongba" title="TopLanguage">TopLanguage</a></li>    
          <li><a href="//itpub.net/" title="ITPub">ITPub</a></li>    
          <li><a href="//blog.jobbole.com/" title="Bole">Bole</a></li>    
          <li><a href="//nosql-database.org/" title="nosql">nosql</a></li>    
          <li><a href="//gitimmersion.googol.im/" title="Git">Git</a></li>    
        </ul>
      </li>
    
      </ul>
      <ul class="nav navbar-nav navbar-right">
      
        <li><a href="/atom.xml">RSS</a></li>
      
      
        <li><a href="https://twitter.com/robinchia">twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/robinchia">github</a></li>
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>
</header>
  <div id='content' class="container">
     <div class="page-header-wrapper">
      <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
      <div class="page-header"><h1 align="center"><big>It so life</big> </h1>
        <h5 align="center"><big>love as life</big></h5>
      </div>
     </div>
     <div class="row">
       <div id="main-col" class="alignleft col-sx-12 col-sm-8 col-md-9 col-lg-9">
      <section id='header_widget'></section>
          <div id="wrapper"><article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程-并发--java多线程学习-javautilconcurrent详解/">java多线程学习</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程-并发--java多线程学习-javautilconcurrent详解/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-java-util-concurrent-">java多线程学习-java.util.concurrent详解</h1>
<h3 id="-latch-barrier-http-janeky-iteye-com-blog-769965-"><a href="http://janeky.iteye.com/blog/769965" target="_blank">Latch/Barrier</a></h3>
<p>   Java1.5提供了一个非常高效实用的多线程包：java.util.concurrent, 提供了大量高级工具，可以帮助开发者编写高效、易维护、结构清晰的Java多线程程序。从这篇blog起，我将跟大家一起共同学习这些新的Java多线程构件 </p>
<ol>
<li><p>CountDownLatch 
 我们先来学习一下JDK1.5 API中关于这个类的详细介绍： 
“一个同步辅助类，在完成一组正在其他线程中执行的操作之前，它允许一个或多个线程一直等待。 用给定的计数 初始化 CountDownLatch。由于调用了 countDown() 方法，所以在当前计数到达零之前，await 方法会一直受阻塞。之后，会释放所有等待的线程，await 的所有后续调用都将立即返回。这种现象只出现一次——计数无法被重置。如果需要重置计数，请考虑使用 CyclicBarrier。” 
 这就是说，CountDownLatch可以用来管理一组相关的线程执行，只需在主线程中调用CountDownLatch 的await方法（一直阻塞），让各个线程调用countDown方法。当所有的线程都只需完countDown了，await也顺利返回，不再阻塞了。在这样情况下尤其适用：将一个任务分成若干线程执行，等到所有线程执行完，再进行汇总处理。 
 下面我举一个非常简单的例子。假设我们要打印1-100，最后再输出“Ok“。1-100的打印顺序不要求统一，只需保证“Ok“是在最后出现即可。 
 解决方案：我们定义一个CountDownLatch，然后开10个线程分别打印（n-1）/<em>10+1至（n-1）/</em>10+10。主线程中调用await方法等待所有线程的执行完毕，每个线程执行完毕后都调用countDown方法。最后再await返回后打印“Ok”。 
具体代码如下（本代码参考了JDK示例代码）： 
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"></a></p>
</li>
<li><p>import java.util.concurrent.CountDownLatch;  </p>
</li>
<li>//<em>/</em> </li>
<li>/* 示例：CountDownLatch的使用举例 </li>
<li>/* Mail: ken@iamcoding.com </li>
<li>/* @author janeky </li>
<li>/*/  </li>
<li>public class TestCountDownLatch {  </li>
<li>private static final int N = 10;  </li>
<li></li>
<li>public static void main(String[] args) throws InterruptedException {  </li>
<li>CountDownLatch doneSignal = new CountDownLatch(N);  </li>
<li>CountDownLatch startSignal = new CountDownLatch(1);//开始执行信号  </li>
<li></li>
<li>for (int i = 1; i &lt;= N; i++) {  </li>
<li>new Thread(new Worker(i, doneSignal, startSignal)).start();//线程启动了  </li>
<li>}  </li>
<li>System.out.println(&quot;begin------------&quot;);  </li>
<li>startSignal.countDown();//开始执行啦  </li>
<li>doneSignal.await();//等待所有的线程执行完毕  </li>
<li>System.out.println(&quot;Ok&quot;);  </li>
<li></li>
<li>}  </li>
<li></li>
<li>static class Worker implements Runnable {  </li>
<li>private final CountDownLatch doneSignal;  </li>
<li>private final CountDownLatch startSignal;  </li>
<li>private int beginIndex;  </li>
<li></li>
<li>Worker(int beginIndex, CountDownLatch doneSignal,  </li>
<li>CountDownLatch startSignal) {  </li>
<li>this.startSignal = startSignal;  </li>
<li>this.beginIndex = beginIndex;  </li>
<li>this.doneSignal = doneSignal;  </li>
<li>}  </li>
<li></li>
<li>public void run() {  </li>
<li>try {  </li>
<li>startSignal.await(); //等待开始执行信号的发布  </li>
<li>beginIndex = (beginIndex - 1) /* 10 + 1;  </li>
<li>for (int i = beginIndex; i &lt;= beginIndex + 10; i++) {  </li>
<li>System.out.println(i);  </li>
<li>}  </li>
<li>} catch (InterruptedException e) {  </li>
<li>e.printStackTrace();  </li>
<li>} finally {  </li>
<li>doneSignal.countDown();  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li>}<br> 总结：CounDownLatch对于管理一组相关线程非常有用。上述示例代码中就形象地描述了两种使用情况。第一种是计算器为1，代表了两种状态，开关。第二种是计数器为N，代表等待N个操作完成。今后我们在编写多线程程序时，可以使用这个构件来管理一组独立线程的执行。 </li>
<li><p>CyclicBarrier 
 我们先来学习一下JDK1.5 API中关于这个类的详细介绍： 
 “一个同步辅助类，它允许一组线程互相等待，直到到达某个公共屏障点 (common barrier point)。在涉及一组固定大小的线程的程序中，这些线程必须不时地互相等待，此时 CyclicBarrier 很有用。因为该 barrier 在释放等待线程后可以重用，所以称它为循环 的 barrier。 
 CyclicBarrier 支持一个可选的 Runnable 命令，在一组线程中的最后一个线程到达之后（但在释放所有线程之前），该命令只在每个屏障点运行一次。若在继续所有参与线程之前更新共享状态，此屏障操作 很有用。 
 我们在学习CountDownLatch的时候就提到了CyclicBarrier。两者究竟有什么联系呢？引用[JCIP]中的描述“The key difference is that with a barrier, all the threads must come together at a barrier point at the same time in order to proceed. Latches are for waiting for events; barriers are for waiting for other threads。CyclicBarrier等待所有的线程一起完成后再执行某个动作。这个功能CountDownLatch也同样可以实现。但是CountDownLatch更多时候是在等待某个事件的发生。在CyclicBarrier中，所有的线程调用await方法，等待其他线程都执行完。 
 举一个很简单的例子，今天晚上我们哥们4个去Happy。就互相通知了一下：晚上八点准时到xx酒吧门前集合，不见不散！。有个哥们住的近，早早就到了。有的事务繁忙，刚好踩点到了。无论怎样，先来的都不能独自行动，只能等待所有人 
代码如下（参考了网上给的一些教程） 
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"></a></p>
</li>
<li><p>import java.util.Random;  </p>
</li>
<li>import java.util.concurrent.BrokenBarrierException;  </li>
<li>import java.util.concurrent.CyclicBarrier;  </li>
<li>import java.util.concurrent.ExecutorService;  </li>
<li>import java.util.concurrent.Executors;  </li>
<li></li>
<li>public class TestCyclicBarrier {  </li>
<li></li>
<li>public static void main(String[] args) {  </li>
<li></li>
<li>ExecutorService exec = Executors.newCachedThreadPool();       </li>
<li>final Random random=new Random();  </li>
<li></li>
<li>final CyclicBarrier barrier=new CyclicBarrier(4,new Runnable(){  </li>
<li>@Override  </li>
<li>public void run() {  </li>
<li>System.out.println(&quot;大家都到齐了，开始happy去&quot;);  </li>
<li>}});  </li>
<li></li>
<li>for(int i=0;i&lt;4;i++){  </li>
<li>exec.execute(new Runnable(){  </li>
<li>@Override  </li>
<li>public void run() {  </li>
<li>try {  </li>
<li>Thread.sleep(random.nextInt(1000));  </li>
<li>} catch (InterruptedException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>System.out.println(Thread.currentThread().getName()+&quot;到了，其他哥们呢&quot;);  </li>
<li>try {  </li>
<li>barrier.await();//等待其他哥们  </li>
<li>} catch (InterruptedException e) {  </li>
<li>e.printStackTrace();  </li>
<li>} catch (BrokenBarrierException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>}});  </li>
<li>}  </li>
<li>exec.shutdown();  </li>
<li>}  </li>
<li></li>
<li><p>}<br> 关于await方法要特别注意一下，它有可能在阻塞的过程中由于某些原因被中断 
 总结：CyclicBarrier就是一个栅栏，等待所有线程到达后再执行相关的操作。barrier 在释放等待线程后可以重用。 </p>
</li>
<li><p>Semaphore 
 我们先来学习一下JDK1.5 API中关于这个类的详细介绍： 
“一个计数信号量。从概念上讲，信号量维护了一个许可集。如有必要，在许可可用前会阻塞每一个 acquire()，然后再获取该许可。每个 release() 添加一个许可，从而可能释放一个正在阻塞的获取者。但是，不使用实际的许可对象，Semaphore 只对可用许可的号码进行计数，并采取相应的行动。” 
 我们一般用它来控制某个对象的线程访问对象 
 例如，对于某个容器，我们规定，最多只能容纳n个线程同时操作 
使用信号量来模拟实现 
具体代码如下（参考 [JCIP]） 
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"></a></p>
</li>
<li><p>import java.util.Collections;  </p>
</li>
<li>import java.util.HashSet;  </li>
<li>import java.util.Set;  </li>
<li>import java.util.concurrent.ExecutorService;  </li>
<li>import java.util.concurrent.Executors;  </li>
<li>import java.util.concurrent.Semaphore;  </li>
<li></li>
<li>public class TestSemaphore {  </li>
<li></li>
<li>public static void main(String[] args) {  </li>
<li>ExecutorService exec = Executors.newCachedThreadPool();  </li>
<li>TestSemaphore t = new TestSemaphore();  </li>
<li>final BoundedHashSet<String> set = t.getSet();  </li>
<li></li>
<li>for (int i = 0; i &lt; 3; i++) {//三个线程同时操作add  </li>
<li>exec.execute(new Runnable() {  </li>
<li>public void run() {  </li>
<li>try {  </li>
<li>set.add(Thread.currentThread().getName());  </li>
<li>} catch (InterruptedException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>}  </li>
<li>});  </li>
<li>}  </li>
<li></li>
<li>for (int j = 0; j &lt; 3; j++) {//三个线程同时操作remove  </li>
<li>exec.execute(new Runnable() {  </li>
<li>public void run() {  </li>
<li>set.remove(Thread.currentThread().getName());  </li>
<li>}  </li>
<li>});  </li>
<li>}  </li>
<li>exec.shutdown();  </li>
<li>}  </li>
<li></li>
<li>public BoundedHashSet<String> getSet() {  </li>
<li>return new BoundedHashSet<String>(2);//定义一个边界约束为2的线程  </li>
<li>}  </li>
<li></li>
<li>class BoundedHashSet<T> {  </li>
<li>private final Set<T> set;  </li>
<li>private final Semaphore semaphore;  </li>
<li></li>
<li>public BoundedHashSet(int bound) {  </li>
<li>this.set = Collections.synchronizedSet(new HashSet<T>());  </li>
<li>this.semaphore = new Semaphore(bound, true);  </li>
<li>}  </li>
<li></li>
<li>public void add(T o) throws InterruptedException {  </li>
<li>semaphore.acquire();//信号量控制可访问的线程数目  </li>
<li>set.add(o);  </li>
<li>System.out.printf(&quot;add:%s%n&quot;,o);  </li>
<li>}  </li>
<li></li>
<li>public void remove(T o) {  </li>
<li>if (set.remove(o))  </li>
<li>semaphore.release();//释放掉信号量  </li>
<li>System.out.printf(&quot;remove:%s%n&quot;,o);  </li>
<li>}  </li>
<li>}  </li>
<li><p>}<br> 总结：Semaphore通常用于对象池的控制 
4．FutureTask 
 我们先来学习一下JDK1.5 API中关于这个类的详细介绍： 
 “取消的异步计算。利用开始和取消计算的方法、查询计算是否完成的方法和获取计算结果的方法，此类提供了对 Future 的基本实现。仅在计算完成时才能获取结果；如果计算尚未完成，则阻塞 get 方法。一旦计算完成，就不能再重新开始或取消计算。 
可使用 FutureTask 包装 Callable 或 Runnable 对象。因为 FutureTask 实现了 Runnable，所以可将 FutureTask 提交给 Executor 执行。 
除了作为一个独立的类外，此类还提供了 protected 功能，这在创建自定义任务类时可能很有用。 “ 
 应用举例：我们的算法中有一个很耗时的操作，在编程的是，我们希望将它独立成一个模块，调用的时候当做它是立刻返回的，并且可以随时取消的 
具体代码如下（参考 [JCIP]） 
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"></a></p>
</li>
<li><p>import java.util.concurrent.Callable;  </p>
</li>
<li>import java.util.concurrent.ExecutionException;  </li>
<li>import java.util.concurrent.ExecutorService;  </li>
<li>import java.util.concurrent.Executors;  </li>
<li>import java.util.concurrent.FutureTask;  </li>
<li></li>
<li>public class TestFutureTask {  </li>
<li></li>
<li>public static void main(String[] args) {  </li>
<li>ExecutorService exec=Executors.newCachedThreadPool();  </li>
<li></li>
<li>FutureTask<String> task=new FutureTask<String>(new Callable<String>(){//FutrueTask的构造参数是一个Callable接口  </li>
<li>@Override  </li>
<li>public String call() throws Exception {  </li>
<li>return Thread.currentThread().getName();//这里可以是一个异步操作  </li>
<li>}});  </li>
<li></li>
<li>try {  </li>
<li>exec.execute(task);//FutureTask实际上也是一个线程  </li>
<li>String result=task.get();//取得异步计算的结果，如果没有返回，就会一直阻塞等待  </li>
<li>System.out.printf(&quot;get:%s%n&quot;,result);  </li>
<li>} catch (InterruptedException e) {  </li>
<li>e.printStackTrace();  </li>
<li>} catch (ExecutionException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>}<br> 总结：FutureTask其实就是新建了一个线程单独执行，使得线程有一个返回值，方便程序的编写 </li>
<li><p>Exchanger 
 我们先来学习一下JDK1.5 API中关于这个类的详细介绍： 
 “可以在pair中对元素进行配对和交换的线程的同步点。每个线程将条目上的某个方法呈现给 exchange 方法，与伙伴线程进行匹配，并且在返回时接收其伙伴的对象。Exchanger 可能被视为 SynchronousQueue 的双向形式。Exchanger 可能在应用程序（比如遗传算法和管道设计）中很有用。 “ 
 应用举例：有两个缓存区，两个线程分别向两个缓存区fill和take，当且仅当一个满了，两个缓存区交换 
 代码如下（参考了网上给的示例   <a href="http://hi.baidu.com/webidea/blog/item/2995e731e53ad5a55fdf0e7d.html）" target="_blank">http://hi.baidu.com/webidea/blog/item/2995e731e53ad5a55fdf0e7d.html）</a> 
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"></a></p>
</li>
<li><p>import java.util.ArrayList;  </p>
</li>
<li>import java.util.concurrent.Exchanger;  </li>
<li></li>
<li>public class TestExchanger {  </li>
<li></li>
<li>public static void main(String[] args) {  </li>
<li>final Exchanger<ArrayList<Integer>&gt; exchanger = new Exchanger<ArrayList<Integer>&gt;();  </li>
<li>final ArrayList<Integer> buff1 = new ArrayList<Integer>(10);  </li>
<li>final ArrayList<Integer> buff2 = new ArrayList<Integer>(10);  </li>
<li></li>
<li>new Thread(new Runnable() {  </li>
<li>@Override  </li>
<li>public void run() {  </li>
<li>ArrayList<Integer> buff = buff1;  </li>
<li>try {  </li>
<li>while (true) {  </li>
<li>if (buff.size() &gt;= 10) {  </li>
<li>buff = exchanger.exchange(buff);//开始跟另外一个线程交互数据  </li>
<li>System.out.println(&quot;exchange buff1&quot;);  </li>
<li>buff.clear();  </li>
<li>}  </li>
<li>buff.add((int)(Math.random()/*100));  </li>
<li>Thread.sleep((long)(Math.random()/*1000));  </li>
<li>}  </li>
<li>} catch (InterruptedException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>}  </li>
<li>}).start();  </li>
<li></li>
<li>new Thread(new Runnable(){  </li>
<li>@Override  </li>
<li>public void run() {  </li>
<li>ArrayList<Integer> buff=buff2;  </li>
<li>while(true){  </li>
<li>try {  </li>
<li>for(Integer i:buff){  </li>
<li>System.out.println(i);  </li>
<li>}  </li>
<li>Thread.sleep(1000);  </li>
<li>buff=exchanger.exchange(buff);//开始跟另外一个线程交换数据  </li>
<li>System.out.println(&quot;exchange buff2&quot;);  </li>
<li>} catch (InterruptedException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>}  </li>
<li>}}).start();  </li>
<li>}  </li>
<li><p>}<br> 总结：Exchanger在特定的使用场景比较有用（两个伙伴线程之间的数据交互） </p>
</li>
<li><p>ScheduledThreadPoolExecutor 
 我们先来学习一下JDK1.5 API中关于这个类的详细介绍： 
 &quot;可另行安排在给定的延迟后运行命令，或者定期执行命令。需要多个辅助线程时，或者要求 ThreadPoolExecutor 具有额外的灵活性或功能时，此类要优于 Timer。 
 一旦启用已延迟的任务就执行它，但是有关何时启用，启用后何时执行则没有任何实时保证。按照提交的先进先出 (FIFO) 顺序来启用那些被安排在同一执行时间的任务。 
 虽然此类继承自 ThreadPoolExecutor，但是几个继承的调整方法对此类并无作用。特别是，因为它作为一个使用 corePoolSize 线程和一个无界队列的固定大小的池，所以调整 maximumPoolSize 没有什么效果。&quot; 
 在JDK1.5之前，我们关于定时/周期操作都是通过Timer来实现的。但是Timer有以下几种危险[JCIP] 
a. Timer是基于绝对时间的。容易受系统时钟的影响。 
b. Timer只新建了一个线程来执行所有的TimeTask。所有TimeTask可能会相关影响 
c. Timer不会捕获TimerTask的异常，只是简单地停止。这样势必会影响其他TimeTask的执行。 
 如果你是使用JDK1.5以上版本，建议用ScheduledThreadPoolExecutor代替Timer。它基本上解决了上述问题。它采用相对时间，用线程池来执行TimerTask，会出来TimerTask异常。 
 下面通过一个简单的实例来阐述ScheduledThreadPoolExecutor的使用。 </p>
<p> 我们定期让定时器抛异常 
 我们定期从控制台打印系统时间 
代码如下（参考了网上的一些代码，在此表示感谢） 
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"></a></p>
</li>
<li><p>import java.util.concurrent.ScheduledThreadPoolExecutor;  </p>
</li>
<li>import java.util.concurrent.TimeUnit;  </li>
<li></li>
<li></li>
<li>public class TestScheduledThreadPoolExecutor {  </li>
<li></li>
<li>public static void main(String[] args) {  </li>
<li>ScheduledThreadPoolExecutor exec=new ScheduledThreadPoolExecutor(1);  </li>
<li></li>
<li>exec.scheduleAtFixedRate(new Runnable(){//每隔一段时间就触发异常  </li>
<li>@Override  </li>
<li>public void run() {  </li>
<li>throw new RuntimeException();  </li>
<li>}}, 1000, 5000, TimeUnit.MILLISECONDS);  </li>
<li></li>
<li>exec.scheduleAtFixedRate(new Runnable(){//每隔一段时间打印系统时间，证明两者是互不影响的  </li>
<li>@Override  </li>
<li>public void run() {  </li>
<li>System.out.println(System.nanoTime());  </li>
<li>}}, 1000, 2000, TimeUnit.MILLISECONDS);  </li>
<li>}  </li>
<li></li>
<li>}<br>总结：是时候把你的定时器换成 ScheduledThreadPoolExecutor了 </li>
</ol>
<p>7.BlockingQueue 
    “支持两个附加操作的 Queue，这两个操作是：获取元素时等待队列变为非空，以及存储元素时等待空间变得可用。“ 
    这里我们主要讨论BlockingQueue的最典型实现：LinkedBlockingQueue 和ArrayBlockingQueue。两者的不同是底层的数据结构不够，一个是链表，另外一个是数组。 </p>
<pre><code>后面将要单独解释其他类型的BlockingQueue和SynchronousQueue 
BlockingQueue的经典用途是 生产者-消费者模式 
代码如下： 
</code></pre><p>Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"></a></p>
<ol>
<li>import java.util.Random;  </li>
<li>import java.util.concurrent.BlockingQueue;  </li>
<li>import java.util.concurrent.LinkedBlockingQueue;  </li>
<li></li>
<li>public class TestBlockingQueue {  </li>
<li></li>
<li>public static void main(String[] args) {  </li>
<li>final BlockingQueue<Integer> queue=new LinkedBlockingQueue<Integer>(3);  </li>
<li>final Random random=new Random();  </li>
<li></li>
<li>class Producer implements Runnable{  </li>
<li>@Override  </li>
<li>public void run() {  </li>
<li>while(true){  </li>
<li>try {  </li>
<li>int i=random.nextInt(100);  </li>
<li>queue.put(i);//当队列达到容量时候，会自动阻塞的  </li>
<li>if(queue.size()==3)  </li>
<li>{  </li>
<li>System.out.println(&quot;full&quot;);  </li>
<li>}  </li>
<li>} catch (InterruptedException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>class Consumer implements Runnable{  </li>
<li>@Override  </li>
<li>public void run() {  </li>
<li>while(true){  </li>
<li>try {  </li>
<li>queue.take();//当队列为空时，也会自动阻塞  </li>
<li>Thread.sleep(1000);  </li>
<li>} catch (InterruptedException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>new Thread(new Producer()).start();  </li>
<li>new Thread(new Consumer()).start();  </li>
<li>}  </li>
<li></li>
<li>}<br> 总结：BlockingQueue使用时候特别注意take 和 put </li>
<li><p>DelayQueue 
我们先来学习一下JDK1.5 API中关于这个类的详细介绍： 
 “它是包含Delayed 元素的一个无界阻塞队列，只有在延迟期满时才能从中提取元素。该队列的头部 是延迟期满后保存时间最长的 Delayed 元素。如果延迟都还没有期满，则队列没有头部，并且 poll 将返回 null。当一个元素的 getDelay(TimeUnit.NANOSECONDS) 方法返回一个小于等于 0 的值时，将发生到期。即使无法使用 take 或 poll 移除未到期的元素，也不会将这些元素作为正常元素对待。例如，size 方法同时返回到期和未到期元素的计数。此队列不允许使用 null 元素。” 
 在现实生活中，很多DelayQueue的例子。就拿上海的SB会来说明，很多国家地区的开馆时间不同。你很早就来到园区，然后急急忙忙地跑到一些心仪的馆区，发现有些还没开，你吃了闭门羹。 
 仔细研究DelayQueue，你会发现它其实就是一个PriorityQueue的封装（按照delay时间排序），里面的元素都实现了Delayed接口，相关操作需要判断延时时间是否到了。 
 在实际应用中，有人拿它来管理跟实际相关的缓存、session等 
下面我就通过 “上海SB会的例子来阐述DelayQueue的用法” 
代码如下： 
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"></a></p>
</li>
<li><p>import java.util.Random;  </p>
</li>
<li>import java.util.concurrent.DelayQueue;  </li>
<li>import java.util.concurrent.Delayed;  </li>
<li>import java.util.concurrent.TimeUnit;  </li>
<li></li>
<li>public class TestDelayQueue {  </li>
<li></li>
<li>private class Stadium implements Delayed  </li>
<li>{  </li>
<li>long trigger;  </li>
<li></li>
<li>public Stadium(long i){  </li>
<li>trigger=System.currentTimeMillis()+i;  </li>
<li>}  </li>
<li></li>
<li>@Override  </li>
<li>public long getDelay(TimeUnit arg0) {  </li>
<li>long n=trigger-System.currentTimeMillis();  </li>
<li>return n;  </li>
<li>}  </li>
<li></li>
<li>@Override  </li>
<li>public int compareTo(Delayed arg0) {  </li>
<li>return (int)(this.getDelay(TimeUnit.MILLISECONDS)-arg0.getDelay(TimeUnit.MILLISECONDS));  </li>
<li>}  </li>
<li></li>
<li>public long getTriggerTime(){  </li>
<li>return trigger;  </li>
<li>}  </li>
<li></li>
<li>}  </li>
<li>public static void main(String[] args)throws Exception {  </li>
<li>Random random=new Random();  </li>
<li>DelayQueue<Stadium> queue=new DelayQueue<Stadium>();  </li>
<li>TestDelayQueue t=new TestDelayQueue();  </li>
<li></li>
<li>for(int i=0;i&lt;5;i++){  </li>
<li>queue.add(t.new Stadium(random.nextInt(30000)));  </li>
<li>}  </li>
<li>Thread.sleep(2000);  </li>
<li></li>
<li>while(true){  </li>
<li>Stadium s=queue.take();//延时时间未到就一直等待  </li>
<li>if(s!=null){  </li>
<li>System.out.println(System.currentTimeMillis()-s.getTriggerTime());//基本上是等于0  </li>
<li>}  </li>
<li>if(queue.size()==0)  </li>
<li>break;  </li>
<li>}  </li>
<li>}  </li>
<li>}<br> 总结：适用于需要延时操作的队列管理 </li>
<li><p>SynchronousQueue 
 我们先来学习一下JDK1.5 API中关于这个类的详细介绍： 
 “一种阻塞队列，其中每个插入操作必须等待另一个线程的对应移除操作 ，反之亦然。同步队列没有任何内部容量，甚至连一个队列的容量都没有。不能在同步队列上进行 peek，因为仅在试图要移除元素时，该元素才存在；除非另一个线程试图移除某个元素，否则也不能（使用任何方法）插入元素；也不能迭代队列，因为其中没有元素可用于迭代。队列的头 是尝试添加到队列中的首个已排队插入线程的元素；如果没有这样的已排队线程，则没有可用于移除的元素并且 poll() 将会返回 null。对于其他 Collection 方法（例如 contains），SynchronousQueue 作为一个空 collection。此队列不允许 null 元素。 
 同步队列类似于 CSP 和 Ada 中使用的 rendezvous 信道。它非常适合于传递性设计，在这种设计中，在一个线程中运行的对象要将某些信息、事件或任务传递给在另一个线程中运行的对象，它就必须与该对象同步。 “ 
 看起来很有意思吧。队列竟然是没有内部容量的。这个队列其实是BlockingQueue的一种实现。每个插入操作必须等待另一个线程的对应移除操作，反之亦然。它给我们提供了在线程之间交换单一元素的极轻量级方法 
应用举例：我们要在多个线程中传递一个变量。 
代码如下（其实就是生产者消费者模式） 
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"></a></p>
</li>
<li><p>import java.util.Arrays;  </p>
</li>
<li>import java.util.List;  </li>
<li>import java.util.concurrent.BlockingQueue;  </li>
<li>import java.util.concurrent.SynchronousQueue;  </li>
<li></li>
<li>public class TestSynchronousQueue {  </li>
<li></li>
<li>class Producer implements Runnable {  </li>
<li>private BlockingQueue<String> queue;  </li>
<li>List<String> objects = Arrays.asList(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;);  </li>
<li></li>
<li>public Producer(BlockingQueue<String> q) {  </li>
<li>this.queue = q;  </li>
<li>}  </li>
<li></li>
<li>@Override  </li>
<li>public void run() {  </li>
<li>try {  </li>
<li>for (String s : objects) {  </li>
<li>queue.put(s);// 产生数据放入队列中  </li>
<li>System.out.printf(&quot;put:%s%n&quot;,s);  </li>
<li>}  </li>
<li>queue.put(&quot;Done&quot;);// 已完成的标志  </li>
<li>} catch (InterruptedException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>class Consumer implements Runnable {  </li>
<li>private BlockingQueue<String> queue;  </li>
<li></li>
<li>public Consumer(BlockingQueue<String> q) {  </li>
<li>this.queue = q;  </li>
<li>}  </li>
<li></li>
<li>@Override  </li>
<li>public void run() {  </li>
<li>String obj = null;  </li>
<li>try {  </li>
<li>while (!((obj = queue.take()).equals(&quot;Done&quot;))) {  </li>
<li>System.out.println(obj);//从队列中读取对象  </li>
<li>Thread.sleep(3000);     //故意sleep，证明Producer是put不进去的  </li>
<li>}  </li>
<li>} catch (InterruptedException e) {  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>public static void main(String[] args) {  </li>
<li>BlockingQueue<String> q=new SynchronousQueue<String>();  </li>
<li>TestSynchronousQueue t=new TestSynchronousQueue();  </li>
<li>new Thread(t.new Producer(q)).start();  </li>
<li>new Thread(t.new Consumer(q)).start();  </li>
<li>}  </li>
<li></li>
<li>}<br>总结：SynchronousQueue主要用于单个元素在多线程之间的传递 </li>
</ol>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/Java_多线程/">Java_多线程</a></li><li><a href="/categories/Java&J2EE/Java_多线程/并发/">并发</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/Java_多线程/" class="label label-success">Java_多线程</a><a href="/tags/并发/" class="label label-info">并发</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-Java_多线程-并发--java多线程学习-javautilconcurrent详解/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-Java_多线程-并发--java多线程学习-javautilconcurrent详解" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-JVM--GC悲观策略之ParallelGC篇/">GC悲观策略之Parallel GC篇</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-JVM--GC悲观策略之ParallelGC篇/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="gc-parallel-gc-">GC悲观策略之Parallel GC篇</h1>
<h1 id="-bluedavy-blog-https-blog-bluedavy-com-"><a href="https://blog.bluedavy.com/" target="_blank">BlueDavy之技术blog</a></h1>
<p>{互联网，OSGi，Java, High Scalability, High Performance,HA}</p>
<ul>
<li><a href="https://blog.bluedavy.com/" target="_blank">Home</a></li>
<li><a href="https://blog.bluedavy.com/?page_id=2" target="_blank">About</a></li>
<li><a href="https://blog.bluedavy.com/?page_id=81" target="_blank">Photos</a></li>
</ul>
<h2 id="-gc-parallel-gc-https-blog-bluedavy-com-p-166-gc-parallel-gc-"><a href="https://blog.bluedavy.com/?p=166" title="GC悲观策略之Parallel GC篇" target="_blank">GC悲观策略之Parallel GC篇</a></h2>
<p>Nov 07</p>
<p><a href="http://bluedavy.com/" title="Visit bluedavy’s website" target="_blank">bluedavy</a><a href="https://blog.bluedavy.com/?cat=13" title="View all posts in jvm" target="_blank">jvm</a> <a href="https://blog.bluedavy.com/?tag=gc" target="_blank">gc</a>, <a href="https://blog.bluedavy.com/?tag=jvm" target="_blank">jvm</a>, <a href="https://blog.bluedavy.com/?tag=pessimism-policy" target="_blank">pessimism policy</a>, <a href="https://blog.bluedavy.com/?tag=%e6%82%b2%e8%a7%82%e7%ad%96%e7%95%a5" target="_blank">悲观策略</a> <a href="&quot;Comment on GC悲观策略之Parallel GC篇&quot;">12 Comments</a>
先来看段代码：
<a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
import</p>
<p>java.util./*;</p>
<p>public</p>
<p>class</p>
<p>SummaryCase{</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>main(String[] args)</p>
<p>throws</p>
<p>Exception{</p>
<p>List<Object> caches=</p>
<p>new</p>
<p>ArrayList<Object>();</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>i=</p>
<p>0</p>
<p>;i&lt;</p>
<p>7</p>
<p>;i++){</p>
<p>caches.add(</p>
<p>new</p>
<p>byte</p>
<p>[</p>
<p>1024</p>
<p>/*</p>
<p>1024</p>
<p>/*</p>
<p>3</p>
<p>]);</p>
<p>}</p>
<p>caches.clear();</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>i=</p>
<p>0</p>
<p>;i&lt;</p>
<p>2</p>
<p>;i++){</p>
<p>caches.add(</p>
<p>new</p>
<p>byte</p>
<p>[</p>
<p>1024</p>
<p>/*</p>
<p>1024</p>
<p>/*</p>
<p>3</p>
<p>]);</p>
<p>}</p>
<p>Thread.sleep(</p>
<p>10000</p>
<p>);</p>
<p>}</p>
<p>}</p>
<p>当用-Xms30m -Xmx30m -Xmn10m -XX:+UseParallelGC执行上面的代码时会执行几次Minor GC和几次Full GC呢？
按照eden空间不足时触发minor gc的规则，上面代码执行后的GC应为：M、M、M、M，但实际上上面代码执行后GC则为：M、M、M、F、F。
这里的原因就在于Parallel Scavenge GC时的悲观策略，当在eden上分配内存失败时且对象的大小尚不需要直接在old上分配时，会触发YGC，代码片段如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24
25</p>
<p>26
27</p>
<p>28
29</p>
<p>30
31</p>
<p>32
33</p>
<p>34
35</p>
<p>36
37void</p>
<p>PSScavenge::invoke(){</p>
<p>...
bool</p>
<p>scavenge_was_done = PSScavenge::invoke_no_policy();</p>
<p>PSGCAdaptivePolicyCounters/* counters = heap-&gt;gc_policy_counters();
if</p>
<p>(UsePerfData)</p>
<p>counters-&gt;update_full_follows_scavenge(0);
if</p>
<p>(!scavenge_was_done ||</p>
<p>policy-&gt;should_full_GC(heap-&gt;old_gen()-&gt;free_in_bytes())) {
if</p>
<p>(UsePerfData)</p>
<p>counters-&gt;update_full_follows_scavenge(full_follows_scavenge);&lt;</p>
<p>GCCauseSetter gccs(heap, GCCause::_adaptive_size_policy);
if</p>
<p>(UseParallelOldGC) {</p>
<p>PSParallelCompact::invoke_no_policy(</p>
<p>false</p>
<p>);
}</p>
<p>else</p>
<p>{</p>
<p>PSMarkSweep::invoke_no_policy(</p>
<p>false</p>
<p>);
}</p>
<p>}
...</p>
<p>}
PSScavenge::invoke_no_policy{</p>
<p>...
if</p>
<p>(!should_attempt_scavenge()) {</p>
<p>return</p>
<p>false</p>
<p>;
}</p>
<p>...
}</p>
<p>bool</p>
<p>PSScavenge::should_attempt_scavenge() {
...</p>
<p>PSAdaptiveSizePolicy/* policy = heap-&gt;size_policy();</p>
<p>size_t</p>
<p>avg_promoted = (</p>
<p>size_t</p>
<p>) policy-&gt;padded_average_promoted_in_bytes();
size_t</p>
<p>promotion_estimate = MIN2(avg_promoted, young_gen-&gt;used_in_bytes());</p>
<p>bool</p>
<p>result = promotion_estimate &lt; old_gen-&gt;free_in_bytes();
...</p>
<p>return</p>
<p>result;
}</p>
<p>在上面should_attempt_scavenge代码片段中，可以看到会比较之前YGC晋升到Old中的平均大小与当前新生代中已被使用的字节数大小，取更小的值与旧生代目前剩余空间大小对比，如更大，则返回false，就终止了YGC的执行了，当返回false时，PSScavenge::invoke就将触发Full GC了。
在PSScavenge:invoke中还有一个条件为：policy-&gt;should_full_GC(heap-&gt;old_gen()-&gt;free_in_bytes()，来看看这段代码片段：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5bool</p>
<p>PSAdaptiveSizePolicy::should_full_GC(</p>
<p>size_t</p>
<p>old_free_in_bytes) {</p>
<p>bool</p>
<p>result = padded_average_promoted_in_bytes() &gt; (</p>
<p>float</p>
<p>) old_free_in_bytes;
...</p>
<p>return</p>
<p>result;
}</p>
<p>可看到，这段代码检查的也是之前YGC时晋升到old的平均大小是否大于了旧生代的剩余空间，如大于，则触发full gc。
总结上面分析的策略，可以看到采用Parallel GC的情况下，当YGC触发时，会有两个检查：
1、在YGC执行前，min(目前新生代已使用的大小,之前平均晋升到old的大小中的较小值) &gt; 旧生代剩余空间大小 ? 不执行YGC，直接执行Full GC : 执行YGC；
2、在YGC执行后，平均晋升到old的大小 &gt; 旧生代剩余空间大小 ? 触发Full GC ： 什么都不做。</p>
<p>按照这样的说明，再来看看上面代码的执行过程中eden和old大小的变化状况：
代码 eden old YGC FGC
第一次循环 3 0 0 0
第二次循环 6 0 0 0
第三次循环 3 6 1 0
第四次循环 6 6 1 0
第五次循环 3 12 2 0
第六次循环 6 12 2 0
第七次循环 3 18 3 1
第八次循环 6 18 3 1
第九次循环 3 3 3 2
在第7次循环时，YGC后旧生代剩余空间为2m，而之前平均晋级到old的对象大小为6m，因此在YGC后会触发一次FGC。
而第9次循环时，在YGC执行前，此时新生代已使用的大小为6m，之前晋级到old的平均大小为6m，这两者去最小值为6m，这个值已大于old的剩余空间，因此就不执行YGC，直接执行FGC了。</p>
<p>Sun JDK之所以要有悲观策略，我猜想理由是程序最终是会以一个较为稳态的状况执行的，此时每次YGC后晋升到old的对象大小应该是差不多的，在YGC时做好检查，避免等YGC后晋升到Old的对象导致old空间不足，因此还不如干脆就直接执行FGC，正因为悲观策略的存在，大家有些时候可能会看到old空间没满但full gc执行的状况。
埋个伏笔，大家将上面的执行参数换为-XX:+UseSerialGC执行看看，会发生什么呢？ <img src="" alt=":)"></p>
<p><a href="https://blog.bluedavy.com/?p=114" target="_blank">JavaOne美国之行–硅谷公司交流篇</a> <a href="https://blog.bluedavy.com/?p=170" target="_blank">GC悲观策略之Serial GC篇</a></p>
<h3 id="12-comments-add-yours-">12 Comments <em>(<a href="">+add yours?</a>)</em></h3>
<ol>
<li><img src="" alt=""> xan
<strong>Nov 08, 2010</strong> @ 11:58:44
代码布局不怎么给力啊 <img src="" alt=":)"></li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Nov 08, 2010</strong> @ 12:23:52
确实不给力，我折腾下。</li>
<li><img src="https://secure.gravatar.com/avatar/3ed95d835a4c573899a9be257428c69f?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://twitter.com/imbeneo" target="_blank">imbeneo</a>
<strong>Nov 08, 2010</strong> @ 13:12:45
我忘记了clean，结果总是OOM。</li>
<li><img src="https://secure.gravatar.com/avatar/03ec79001b70a7dc41d51c1db4db4baa?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> oliver
<strong>Apr 26, 2011</strong> @ 11:34:35
我的疑问是为什么第一次full gc时old里面使用空间没有被回收掉，第二次full gc时old里面才回收？</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Apr 26, 2011</strong> @ 13:32:18
因为caches.clear是后来才调的…</li>
<li><img src="https://secure.gravatar.com/avatar/3cc9849504cb6c7c78b5533df02043ac?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://www.dosmile.net/" target="_blank">yinhex</a>
<strong>Jul 09, 2011</strong> @ 22:38:20
这里我有个问题啊：我看你的分布式基础看到你能举例出很多大网站的设计。不知道你是从哪里可以看到这些信息的呢？可以细数一下你经常上去获取信息国外网站吗？</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Jul 11, 2011</strong> @ 10:01:48
@yinhex
一般来说，例如highscalability.com，还有各种国外的技术大会，各家著名公司的engineer的blog，都会有这些信息，:)</li>
<li><img src="https://secure.gravatar.com/avatar/f2ec9eb448e778dc947957c779fdd735?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> Gary
<strong>Sep 29, 2011</strong> @ 11:09:58
-XX:+UseSerialGC gc.log发现是MMMMF,符合预期啊</li>
<li><img src="https://secure.gravatar.com/avatar/e9ef6892fbac714e6678cd30f4a212f4?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> yangxuesong
<strong>Nov 29, 2011</strong> @ 17:31:49
一次full gc的执行流程是怎么用的呢？</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Dec 03, 2011</strong> @ 11:10:22
@yangxuesong
这个…要看是什么垃圾收集器…<h3 id="leave-a-reply">Leave a Reply</h3>
</li>
</ol>
<p><a href="">Cancel</a></p>
<p>Name (required)</p>
<p>Mail (required)</p>
<p>Website</p>
<p><img src="&quot;CAPTCHA Image&quot;" alt="CAPTCHA Image"></p>
<p><a href="&quot;Refresh Image&quot;"><img src="" alt="Refresh Image"></a></p>
<p>CAPTCHA Code /*</p>
<p><style type='text/css'>/#submit {display:none;}</style><br /> <input name="submit" type="submit" id="submit-alt" tabindex="6" value="Submit Comment" /></p>
<p>July 2013 M T W T F S S <a href="https://blog.bluedavy.com/?m=201303" title="View posts for March 2013" target="_blank">« Mar</a>     1234567 891011121314 15161718192021 22232425262728 293031  </p>
<h3 id="categories">Categories</h3>
<ul>
<li><a href="https://blog.bluedavy.com/?cat=63" title="View all posts filed under Java" target="_blank">Java</a> (10)</li>
<li><a href="https://blog.bluedavy.com/?cat=13" title="View all posts filed under jvm" target="_blank">jvm</a> (19)</li>
<li><a href="https://blog.bluedavy.com/?cat=56" title="View all posts filed under NoSQL" target="_blank">NoSQL</a> (7)</li>
<li><a href="https://blog.bluedavy.com/?cat=4" title="View all posts filed under SOA" target="_blank">SOA</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=11" title="关于《分布式Java应用：基础与实践》书部分章节的公开、书内容的纠错以及补充完善。" target="_blank">书:分布式Java应用</a> (5)</li>
<li><a href="https://blog.bluedavy.com/?cat=6" title="View all posts filed under 互联网" target="_blank">互联网</a> (5)</li>
<li><a href="https://blog.bluedavy.com/?cat=46" title="View all posts filed under 产品总结" target="_blank">产品总结</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=18" title="View all posts filed under 优化案例" target="_blank">优化案例</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=12" title="View all posts filed under 圆桌交流" target="_blank">圆桌交流</a> (2)</li>
<li><a href="https://blog.bluedavy.com/?cat=8" title="View all posts filed under 容量规划" target="_blank">容量规划</a> (2)</li>
<li><a href="https://blog.bluedavy.com/?cat=97" title="View all posts filed under 迁户口" target="_blank">迁户口</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=52" title="View all posts filed under 高可用" target="_blank">高可用</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=3" title="View all posts filed under 高并发" target="_blank">高并发</a> (3)</li>
<li><p><a href="https://blog.bluedavy.com/?cat=1" title="关于性能优化方面的一些东西。" target="_blank">高性能</a> (2)</p>
<h3 id="recent-comments">Recent Comments</h3>
</li>
<li><p><a href="http://code1.riaos.com/?p=5030138" target="_blank">JVM调优 | code1（code1.riaos.com）</a> on <a href="https://blog.bluedavy.com/?p=70&amp;cpage=1#comment-16520" target="_blank">说说MaxTenuringThreshold这个参数</a></p>
</li>
<li><a href="http://architecture1.riaos.com/?p=3063358" target="_blank">JVM调优 | architecture（riaos.com）</a> on <a href="https://blog.bluedavy.com/?p=70&amp;cpage=1#comment-16519" target="_blank">说说MaxTenuringThreshold这个参数</a></li>
<li><a href="http://bluedavy.com/" target="_blank">bluedavy</a> on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16462" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
<li>xiaobo on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16460" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
<li><a href="http://bluedavy.com/" target="_blank">bluedavy</a> on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16459" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
</ul>
<h3 id="tags">Tags</h3>
<p><a href="https://blog.bluedavy.com/?tag=btrace" title="2 topics" target="_blank">btrace</a> <a href="https://blog.bluedavy.com/?tag=c1" title="1 topic" target="_blank">c1</a> <a href="https://blog.bluedavy.com/?tag=c2" title="1 topic" target="_blank">c2</a> <a href="https://blog.bluedavy.com/?tag=deflater" title="1 topic" target="_blank">Deflater</a> <a href="https://blog.bluedavy.com/?tag=facebook" title="2 topics" target="_blank">facebook</a> <a href="https://blog.bluedavy.com/?tag=gc" title="4 topics" target="_blank">gc</a> <a href="https://blog.bluedavy.com/?tag=gc-tuning" title="2 topics" target="_blank">gc tuning</a> <a href="https://blog.bluedavy.com/?tag=grizzly" title="2 topics" target="_blank">Grizzly</a> <a href="https://blog.bluedavy.com/?tag=hbase" title="6 topics" target="_blank">HBase</a> <a href="https://blog.bluedavy.com/?tag=hotspot" title="1 topic" target="_blank">hotspot</a> <a href="https://blog.bluedavy.com/?tag=inflater" title="1 topic" target="_blank">Inflater</a> <a href="https://blog.bluedavy.com/?tag=interpreter" title="1 topic" target="_blank">interpreter</a> <a href="https://blog.bluedavy.com/?tag=javac" title="1 topic" target="_blank">javac</a> <a href="https://blog.bluedavy.com/?tag=java-code-generation" title="1 topic" target="_blank">java code generation</a> <a href="https://blog.bluedavy.com/?tag=javaone" title="4 topics" target="_blank">JavaOne</a> <a href="https://blog.bluedavy.com/?tag=javaone-general-technical-session" title="1 topic" target="_blank">javaone general technical session</a> <a href="https://blog.bluedavy.com/?tag=java%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c" title="1 topic" target="_blank">java代码执行</a> <a href="https://blog.bluedavy.com/?tag=java-%e5%b9%b6%e5%8f%91" title="1 topic" target="_blank">Java 并发</a> <a href="https://blog.bluedavy.com/?tag=jit" title="1 topic" target="_blank">jit</a> <a href="https://blog.bluedavy.com/?tag=jvm" title="12 topics" target="_blank">jvm</a> <a href="https://blog.bluedavy.com/?tag=memory-management" title="1 topic" target="_blank">memory management</a> <a href="https://blog.bluedavy.com/?tag=native-memory-leak" title="1 topic" target="_blank">Native Memory Leak</a> <a href="https://blog.bluedavy.com/?tag=nosql" title="2 topics" target="_blank">NoSQL</a> <a href="https://blog.bluedavy.com/?tag=oom" title="1 topic" target="_blank">oom</a> <a href="https://blog.bluedavy.com/?tag=oracle-keynote" title="1 topic" target="_blank">oracle keynote</a> <a href="https://blog.bluedavy.com/?tag=pessimism-policy" title="1 topic" target="_blank">pessimism policy</a> <a href="https://blog.bluedavy.com/?tag=references" title="1 topic" target="_blank">references</a> <a href="https://blog.bluedavy.com/?tag=rpc" title="2 topics" target="_blank">RPC</a> <a href="https://blog.bluedavy.com/?tag=serial-gc" title="1 topic" target="_blank">serial gc</a> <a href="https://blog.bluedavy.com/?tag=soa" title="2 topics" target="_blank">SOA</a> <a href="https://blog.bluedavy.com/?tag=sun-jdk" title="1 topic" target="_blank">sun jdk</a> <a href="https://blog.bluedavy.com/?tag=sun-jdk-oom" title="1 topic" target="_blank">sun jdk oom</a> <a href="https://blog.bluedavy.com/?tag=web%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92%e7%9a%84%e8%89%ba%e6%9c%af" title="1 topic" target="_blank">Web容量规划的艺术</a> <a href="https://blog.bluedavy.com/?tag=yuanzhuo" title="1 topic" target="_blank">yuanzhuo</a> <a href="https://blog.bluedavy.com/?tag=%e4%b9%a6" title="1 topic" target="_blank">书:分布式Java应用</a> <a href="https://blog.bluedavy.com/?tag=%e4%b9%a6%e8%af%84" title="1 topic" target="_blank">书评</a> <a href="https://blog.bluedavy.com/?tag=%e4%ba%92%e8%81%94%e7%bd%91%e6%8a%80%e6%9c%af" title="1 topic" target="_blank">互联网技术</a> <a href="https://blog.bluedavy.com/?tag=%e4%ba%a4%e6%b5%81" title="1 topic" target="_blank">交流</a> <a href="https://blog.bluedavy.com/?tag=%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86" title="1 topic" target="_blank">内存管理</a> <a href="https://blog.bluedavy.com/?tag=%e5%88%86%e5%b8%83%e5%bc%8fjava%e5%ba%94%e7%94%a8" title="2 topics" target="_blank">分布式Java应用</a> <a href="https://blog.bluedavy.com/?tag=%e5%9c%86%e6%a1%8c%e4%ba%a4%e6%b5%81" title="1 topic" target="_blank">圆桌交流</a> <a href="https://blog.bluedavy.com/?tag=%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92" title="2 topics" target="_blank">容量规划</a> <a href="https://blog.bluedavy.com/?tag=%e6%82%b2%e8%a7%82%e7%ad%96%e7%95%a5" title="3 topics" target="_blank">悲观策略</a> <a href="https://blog.bluedavy.com/?tag=%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6" title="1 topic" target="_blank">服务框架</a> <a href="https://blog.bluedavy.com/?tag=%e7%a1%85%e8%b0%b7%e5%85%ac%e5%8f%b8" title="1 topic" target="_blank">硅谷公司</a></p>
<h3 id="-">订阅</h3>
<h3 id="-">推荐书籍</h3>
<h3 id="my-book">My Book</h3>
<p><a href="http://book.douban.com/subject/4848587/" title="分布式Java应用：基础与实践" target="_blank"><img src="" alt=""></a> <a href="http://book.douban.com/subject/3843896/" title="OSGi原理与最佳实践" target="_blank"><img src="" alt=""></a>
© <a href="https://blog.bluedavy.com/" target="_blank">BlueDavy之技术blog</a> 2013</p>
<p><a href="http://icondock.com/" target="_blank">Icons</a> &amp; <a href="http://www.ndesign-studio.com/wp-themes" target="_blank">Wordpress Theme</a> by <a href="http://www.ndesign-studio.com/" target="_blank">N.Design</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/JVM/">JVM</a></li></span></span> | <span class="tags">Tagged <a href="/tags/JVM/" class="label label-primary">JVM</a><a href="/tags/Java&J2EE/" class="label label-success">Java&J2EE</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:42"datetime="2014-03-07 09:54:42"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-JVM--GC悲观策略之ParallelGC篇/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-JVM--GC悲观策略之ParallelGC篇" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-JVM--BTrace使用简介/">BTrace使用简介</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-JVM--BTrace使用简介/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="btrace-">BTrace使用简介</h1>
<h1 id="-bluedavy-blog-https-blog-bluedavy-com-"><a href="https://blog.bluedavy.com/" target="_blank">BlueDavy之技术blog</a></h1>
<p>{互联网，OSGi，Java, High Scalability, High Performance,HA}</p>
<ul>
<li><a href="https://blog.bluedavy.com/" target="_blank">Home</a></li>
<li><a href="https://blog.bluedavy.com/?page_id=2" target="_blank">About</a></li>
<li><a href="https://blog.bluedavy.com/?page_id=81" target="_blank">Photos</a></li>
</ul>
<h2 id="-btrace-https-blog-bluedavy-com-p-185-btrace-"><a href="https://blog.bluedavy.com/?p=185" title="BTrace使用简介" target="_blank">BTrace使用简介</a></h2>
<p>Nov 11</p>
<p><a href="http://bluedavy.com/" title="Visit bluedavy’s website" target="_blank">bluedavy</a><a href="https://blog.bluedavy.com/?cat=13" title="View all posts in jvm" target="_blank">jvm</a> <a href="https://blog.bluedavy.com/?tag=btrace" target="_blank">btrace</a> <a href="&quot;Comment on BTrace使用简介&quot;">13 Comments</a>
很多时候在online的应用出现问题时，很多时候我们需要知道更多的程序的运行细节，但又不可能在开发的时候就把程序中所有的运行细节都打印到日志上，通常这个时候能采取的就是修改代码，重新部署，然后再观察，但这种方法对于online应用来说不是很好，另外一方面如果碰到不好改的代码，例如引用的其他的外部的包什么的，就很麻烦了，BTrace就是一个可以在不改代码、不重启应用的情况下，动态的查看程序运行细节的工具，其官方网站在此：<a href="http://kenai.com/projects/btrace/" target="_blank"><a href="http://kenai.com/projects/btrace/">http://kenai.com/projects/btrace/</a></a>，在这篇blog中，就来看看如何用BTrace来动态的监测方法的一些运行细节状况。
BTrace通过动态的挂接用java写的代码到运行时上来获取到一些运行细节，例如典型的使用btrace的方法为：
btrace -cp [btrace的jar所在的路径，默认为btrace/build下] [pid] [需要运行的java代码]
例如一段这样的代码：
<a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24
25</p>
<p>26
import</p>
<p>java.util.Random;</p>
<p>public</p>
<p>class</p>
<p>Case1{</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>main(String[] args)</p>
<p>throws</p>
<p>Exception{</p>
<p>Random random=</p>
<p>new</p>
<p>Random();</p>
<p>CaseObject object=</p>
<p>new</p>
<p>CaseObject();</p>
<p>boolean</p>
<p>result=</p>
<p>true</p>
<p>;</p>
<p>while</p>
<p>(result){</p>
<p>result=object.execute(random.nextInt(</p>
<p>1000</p>
<p>));</p>
<p>Thread.sleep(</p>
<p>1000</p>
<p>);</p>
<p>}</p>
<p>}</p>
<p>}
public</p>
<p>class</p>
<p>CaseObject{</p>
<p>private</p>
<p>static</p>
<p>int</p>
<p>sleepTotalTime=</p>
<p>0</p>
<p>;  </p>
<p>public</p>
<p>boolean</p>
<p>execute(</p>
<p>int</p>
<p>sleepTime)</p>
<p>throws</p>
<p>Exception{</p>
<p>System.out.println(</p>
<p>&quot;sleep: &quot;</p>
<p>+sleepTime);</p>
<p>sleepTotalTime+=sleepTime;</p>
<p>Thread.sleep(sleepTime);</p>
<p>return</p>
<p>true</p>
<p>;</p>
<p>}</p>
<p>}</p>
<p>如在程序运行的情况下，想知道调用CaseObject的execute方法的以下几种情况，在BTrace中可以这么做：
1、调用此方法时传入的是什么参数，返回的是什么值，当时sleepTotalTime是多少？
BTrace脚本如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16</p>
<p>import</p>
<p>static</p>
<p>com.sun.btrace.BTraceUtils./*;</p>
<p>import</p>
<p>com.sun.btrace.annotations./*;</p>
<p>@BTrace</p>
<p>public</p>
<p>class</p>
<p>TraceMethodArgsAndReturn{</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>method=</p>
<p>&quot;execute&quot;</p>
<p>,</p>
<p>location=</p>
<p>@Location</p>
<p>(Kind.RETURN)</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecute(</p>
<p>@Self</p>
<p>CaseObject instance,</p>
<p>int</p>
<p>sleepTime,</p>
<p>@Return</p>
<p>boolean</p>
<p>result){</p>
<p>println(</p>
<p>&quot;call CaseObject.execute&quot;</p>
<p>);</p>
<p>println(strcat(</p>
<p>&quot;sleepTime is:&quot;</p>
<p>,str(sleepTime)));</p>
<p>println(strcat(</p>
<p>&quot;sleepTotalTime is:&quot;</p>
<p>,str(get(field(</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>&quot;sleepTotalTime&quot;</p>
<p>),instance))));</p>
<p>println(strcat(</p>
<p>&quot;return value is:&quot;</p>
<p>,str(result)));</p>
<p>}</p>
<p>}</p>
<p>然后直接执行btrace -cp btrace/build [pid] TraceMethodArgsAndReturn.java就可以了。
当程序中调用到caseobject的execute方法时，就会在btrace的console中输出相应的信息。
2、execute方法执行耗时是多久？
BTrace脚本如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13</p>
<p>14
15</p>
<p>16
17</p>
<p>18
19</p>
<p>20
21</p>
<p>22
23</p>
<p>24</p>
<p>import</p>
<p>static</p>
<p>com.sun.btrace.BTraceUtils./*;</p>
<p>import</p>
<p>com.sun.btrace.annotations./*;</p>
<p>@BTrace</p>
<p>public</p>
<p>class</p>
<p>TraceMethodExecuteTime{</p>
<p>@TLS</p>
<p>static</p>
<p>long</p>
<p>beginTime;</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>method=</p>
<p>&quot;execute&quot;</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecuteBegin(){</p>
<p>beginTime=timeMillis();</p>
<p>}</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>method=</p>
<p>&quot;execute&quot;</p>
<p>,</p>
<p>location=</p>
<p>@Location</p>
<p>(Kind.RETURN)</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecute(</p>
<p>int</p>
<p>sleepTime,</p>
<p>@Return</p>
<p>boolean</p>
<p>result){</p>
<p>println(strcat(strcat(</p>
<p>&quot;CaseObject.execute time is:&quot;</p>
<p>,str(timeMillis()-beginTime)),</p>
<p>&quot;ms&quot;</p>
<p>));</p>
<p>}</p>
<p>}</p>
<p>3、谁调用了execute方法？
BTrace脚本如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12
13     </p>
<p>import</p>
<p>static</p>
<p>com.sun.btrace.BTraceUtils./*;</p>
<p>import</p>
<p>com.sun.btrace.annotations./*;</p>
<p>@BTrace</p>
<p>public</p>
<p>class</p>
<p>TraceMethodCallee{</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>method=</p>
<p>&quot;execute&quot;</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecute(){</p>
<p>println(</p>
<p>&quot;who call CaseObject.execute :&quot;</p>
<p>);</p>
<p>jstack();</p>
<p>}
}</p>
<p>4、有没有人调用CaseObject中的哪一行代码？
BTrace脚本如下：</p>
<p><a href="">?</a>1</p>
<p>2
3</p>
<p>4
5</p>
<p>6
7</p>
<p>8
9</p>
<p>10
11</p>
<p>12</p>
<p>import</p>
<p>static</p>
<p>com.sun.btrace.BTraceUtils./*;</p>
<p>import</p>
<p>com.sun.btrace.annotations./*;</p>
<p>@BTrace</p>
<p>public</p>
<p>class</p>
<p>TraceMethodLine{</p>
<p>@OnMethod</p>
<p>(</p>
<p>clazz=</p>
<p>&quot;CaseObject&quot;</p>
<p>,</p>
<p>location=</p>
<p>@Location</p>
<p>(value=Kind.LINE,line=</p>
<p>5</p>
<p>)</p>
<p>)</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>traceExecute(</p>
<p>@ProbeClassName</p>
<p>String pcn,</p>
<p>@ProbeMethodName</p>
<p>String pmn,</p>
<p>int</p>
<p>line){</p>
<p>println(strcat(strcat(strcat(</p>
<p>&quot;call &quot;</p>
<p>,pcn),</p>
<p>&quot;.&quot;</p>
<p>),pmn));</p>
<p>}</p>
<p>}</p>
<p>从上面可看出，在有了BTrace后，要动态的跟踪代码的运行细节还是非常爽的，更多的细节的操作请大家查看BTrace的<a href="http://kenai.com/projects/btrace/pages/UserGuide" target="_blank">User Guide</a>。</p>
<p><a href="https://blog.bluedavy.com/?p=170" target="_blank">GC悲观策略之Serial GC篇</a> <a href="https://blog.bluedavy.com/?p=187" target="_blank">学习JVM的References</a></p>
<h3 id="13-comments-add-yours-">13 Comments <em>(<a href="">+add yours?</a>)</em></h3>
<ol>
<li><img src="" alt=""> <a href="http://www.helishi.net/" target="_blank">ikbear</a>
<strong>Nov 11, 2010</strong> @ 17:41:12
收藏了。</li>
<li><img src="https://secure.gravatar.com/avatar/4a2de3195dfd282b2f0ea420dc7a6a7a?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> pandonix
<strong>Nov 11, 2010</strong> @ 20:58:54
关于方法的执行时间和返回值，有个问题请教，如果调用量非常大的方法，有没有类似染色日志这样的功能：只需要打印参数符合某种条件的调用情况？</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Nov 12, 2010</strong> @ 11:42:06
<img src="" alt=":)"> ，这个自己可以在脚本里判断下…</li>
<li><img src="https://secure.gravatar.com/avatar/bd17360b1eb0b26b89a19de9cebed4f9?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> vitty
<strong>Nov 14, 2010</strong> @ 14:09:22
不知道这个对被监测程序的性能影响有多大？不过真的很爽呢。</li>
<li><img src="https://secure.gravatar.com/avatar/5267242305332fe1affd9c4788191e1d?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> <a href="http://bluedavy.com/" target="_blank">bluedavy</a>
<strong>Nov 14, 2010</strong> @ 19:53:38
据使用来看，影响很小。</li>
<li><img src="https://secure.gravatar.com/avatar/baad2156c4a21abc487fb92bbd53a174?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> bobo
<strong>Nov 16, 2010</strong> @ 10:16:58
学习,哈哈</li>
<li><img src="https://secure.gravatar.com/avatar/5ef11dda80e7ce522810093bd8a791eb?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> xuanyuanzhiyuan
<strong>Dec 21, 2010</strong> @ 15:37:22
学习了 ：）</li>
<li><img src="https://secure.gravatar.com/avatar/4a2de3195dfd282b2f0ea420dc7a6a7a?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> pandonix
<strong>Dec 27, 2010</strong> @ 23:07:55
运行第一个例子：TraceMethodArgsAndReturn.java报错：
TraceMethodArgsAndReturn.java:10: 找不到符号
符号： 类 CaseObject
位置： 类 TraceMethodArgsAndReturn
把@Self CaseObject instance修改成为@Self Object self，并且去掉println(strcat(“sleepTotalTime is:”,str(get(field(“CaseObject”,”sleepTotalTime”),instance))));
就可以了，但是楼主希望获取sleepTotalTime的需求就满足不鸟了。还不太明白@Self的含义，再看看纠结的文档吧</li>
<li><img src="https://secure.gravatar.com/avatar/4a2de3195dfd282b2f0ea420dc7a6a7a?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> pandonix
<strong>Dec 27, 2010</strong> @ 23:44:37
找到原因了，是CaseObject不在classthpath中，如果用到了@Self CaseObject ，编译TraceMethodArgsAndReturn.java时会去找CaseObject类。
简单的将CaseObject.java放到跟TraceMethodArgsAndReturn.java同一目录即可</li>
<li><img src="https://secure.gravatar.com/avatar/6a8f8285a42a76f5e47159c9f09a7c4f?s=48&amp;d=&lt;path_to_url&gt;&amp;r=G" alt=""> 光夏
<strong>Jan 23, 2011</strong> @ 11:34:36
使用TLS得注意递归调用的情况吧</li>
<li><img src="" alt=""> victorcai
<strong>Jul 19, 2011</strong> @ 15:03:18
请问各位大侠btrace能否在windows xp上使用,是否需要设置环境变量,我在windows xp上每次使用都失败<h3 id="leave-a-reply">Leave a Reply</h3>
</li>
</ol>
<p><a href="">Cancel</a></p>
<p>Name (required)</p>
<p>Mail (required)</p>
<p>Website</p>
<p><img src="https://blog.bluedavy.com/wp-content/plugins/si-captcha-for-wordpress/captcha/securimage_show.php?si_form_id=com&amp;prefix=2KNUhEvWsRaEKSqu" alt="CAPTCHA Image" title="CAPTCHA Image"></p>
<p><a href="&quot;Refresh Image&quot;"><img src="" alt="Refresh Image"></a></p>
<p>CAPTCHA Code /*</p>
<p><style type='text/css'>/#submit {display:none;}</style><br /> <input name="submit" type="submit" id="submit-alt" tabindex="6" value="Submit Comment" /></p>
<p>July 2013 M T W T F S S <a href="https://blog.bluedavy.com/?m=201303" title="View posts for March 2013" target="_blank">« Mar</a>     1234567 891011121314 15161718192021 22232425262728 293031  </p>
<h3 id="categories">Categories</h3>
<ul>
<li><a href="https://blog.bluedavy.com/?cat=63" title="View all posts filed under Java" target="_blank">Java</a> (10)</li>
<li><a href="https://blog.bluedavy.com/?cat=13" title="View all posts filed under jvm" target="_blank">jvm</a> (19)</li>
<li><a href="https://blog.bluedavy.com/?cat=56" title="View all posts filed under NoSQL" target="_blank">NoSQL</a> (7)</li>
<li><a href="https://blog.bluedavy.com/?cat=4" title="View all posts filed under SOA" target="_blank">SOA</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=11" title="关于《分布式Java应用：基础与实践》书部分章节的公开、书内容的纠错以及补充完善。" target="_blank">书:分布式Java应用</a> (5)</li>
<li><a href="https://blog.bluedavy.com/?cat=6" title="View all posts filed under 互联网" target="_blank">互联网</a> (5)</li>
<li><a href="https://blog.bluedavy.com/?cat=46" title="View all posts filed under 产品总结" target="_blank">产品总结</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=18" title="View all posts filed under 优化案例" target="_blank">优化案例</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=12" title="View all posts filed under 圆桌交流" target="_blank">圆桌交流</a> (2)</li>
<li><a href="https://blog.bluedavy.com/?cat=8" title="View all posts filed under 容量规划" target="_blank">容量规划</a> (2)</li>
<li><a href="https://blog.bluedavy.com/?cat=97" title="View all posts filed under 迁户口" target="_blank">迁户口</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=52" title="View all posts filed under 高可用" target="_blank">高可用</a> (1)</li>
<li><a href="https://blog.bluedavy.com/?cat=3" title="View all posts filed under 高并发" target="_blank">高并发</a> (3)</li>
<li><p><a href="https://blog.bluedavy.com/?cat=1" title="关于性能优化方面的一些东西。" target="_blank">高性能</a> (2)</p>
<h3 id="recent-comments">Recent Comments</h3>
</li>
<li><p><a href="http://code1.riaos.com/?p=5030138" target="_blank">JVM调优 | code1（code1.riaos.com）</a> on <a href="https://blog.bluedavy.com/?p=70&amp;cpage=1#comment-16520" target="_blank">说说MaxTenuringThreshold这个参数</a></p>
</li>
<li><a href="http://architecture1.riaos.com/?p=3063358" target="_blank">JVM调优 | architecture（riaos.com）</a> on <a href="https://blog.bluedavy.com/?p=70&amp;cpage=1#comment-16519" target="_blank">说说MaxTenuringThreshold这个参数</a></li>
<li><a href="http://bluedavy.com/" target="_blank">bluedavy</a> on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16462" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
<li>xiaobo on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16460" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
<li><a href="http://bluedavy.com/" target="_blank">bluedavy</a> on <a href="https://blog.bluedavy.com/?p=409&amp;cpage=1#comment-16459" target="_blank">一个Java应用频繁抛异常导致cpu us诡异现象的案例</a></li>
</ul>
<h3 id="tags">Tags</h3>
<p><a href="https://blog.bluedavy.com/?tag=btrace" title="2 topics" target="_blank">btrace</a> <a href="https://blog.bluedavy.com/?tag=c1" title="1 topic" target="_blank">c1</a> <a href="https://blog.bluedavy.com/?tag=c2" title="1 topic" target="_blank">c2</a> <a href="https://blog.bluedavy.com/?tag=deflater" title="1 topic" target="_blank">Deflater</a> <a href="https://blog.bluedavy.com/?tag=facebook" title="2 topics" target="_blank">facebook</a> <a href="https://blog.bluedavy.com/?tag=gc" title="4 topics" target="_blank">gc</a> <a href="https://blog.bluedavy.com/?tag=gc-tuning" title="2 topics" target="_blank">gc tuning</a> <a href="https://blog.bluedavy.com/?tag=grizzly" title="2 topics" target="_blank">Grizzly</a> <a href="https://blog.bluedavy.com/?tag=hbase" title="6 topics" target="_blank">HBase</a> <a href="https://blog.bluedavy.com/?tag=hotspot" title="1 topic" target="_blank">hotspot</a> <a href="https://blog.bluedavy.com/?tag=inflater" title="1 topic" target="_blank">Inflater</a> <a href="https://blog.bluedavy.com/?tag=interpreter" title="1 topic" target="_blank">interpreter</a> <a href="https://blog.bluedavy.com/?tag=javac" title="1 topic" target="_blank">javac</a> <a href="https://blog.bluedavy.com/?tag=java-code-generation" title="1 topic" target="_blank">java code generation</a> <a href="https://blog.bluedavy.com/?tag=javaone" title="4 topics" target="_blank">JavaOne</a> <a href="https://blog.bluedavy.com/?tag=javaone-general-technical-session" title="1 topic" target="_blank">javaone general technical session</a> <a href="https://blog.bluedavy.com/?tag=java%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c" title="1 topic" target="_blank">java代码执行</a> <a href="https://blog.bluedavy.com/?tag=java-%e5%b9%b6%e5%8f%91" title="1 topic" target="_blank">Java 并发</a> <a href="https://blog.bluedavy.com/?tag=jit" title="1 topic" target="_blank">jit</a> <a href="https://blog.bluedavy.com/?tag=jvm" title="12 topics" target="_blank">jvm</a> <a href="https://blog.bluedavy.com/?tag=memory-management" title="1 topic" target="_blank">memory management</a> <a href="https://blog.bluedavy.com/?tag=native-memory-leak" title="1 topic" target="_blank">Native Memory Leak</a> <a href="https://blog.bluedavy.com/?tag=nosql" title="2 topics" target="_blank">NoSQL</a> <a href="https://blog.bluedavy.com/?tag=oom" title="1 topic" target="_blank">oom</a> <a href="https://blog.bluedavy.com/?tag=oracle-keynote" title="1 topic" target="_blank">oracle keynote</a> <a href="https://blog.bluedavy.com/?tag=pessimism-policy" title="1 topic" target="_blank">pessimism policy</a> <a href="https://blog.bluedavy.com/?tag=references" title="1 topic" target="_blank">references</a> <a href="https://blog.bluedavy.com/?tag=rpc" title="2 topics" target="_blank">RPC</a> <a href="https://blog.bluedavy.com/?tag=serial-gc" title="1 topic" target="_blank">serial gc</a> <a href="https://blog.bluedavy.com/?tag=soa" title="2 topics" target="_blank">SOA</a> <a href="https://blog.bluedavy.com/?tag=sun-jdk" title="1 topic" target="_blank">sun jdk</a> <a href="https://blog.bluedavy.com/?tag=sun-jdk-oom" title="1 topic" target="_blank">sun jdk oom</a> <a href="https://blog.bluedavy.com/?tag=web%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92%e7%9a%84%e8%89%ba%e6%9c%af" title="1 topic" target="_blank">Web容量规划的艺术</a> <a href="https://blog.bluedavy.com/?tag=yuanzhuo" title="1 topic" target="_blank">yuanzhuo</a> <a href="https://blog.bluedavy.com/?tag=%e4%b9%a6" title="1 topic" target="_blank">书:分布式Java应用</a> <a href="https://blog.bluedavy.com/?tag=%e4%b9%a6%e8%af%84" title="1 topic" target="_blank">书评</a> <a href="https://blog.bluedavy.com/?tag=%e4%ba%92%e8%81%94%e7%bd%91%e6%8a%80%e6%9c%af" title="1 topic" target="_blank">互联网技术</a> <a href="https://blog.bluedavy.com/?tag=%e4%ba%a4%e6%b5%81" title="1 topic" target="_blank">交流</a> <a href="https://blog.bluedavy.com/?tag=%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86" title="1 topic" target="_blank">内存管理</a> <a href="https://blog.bluedavy.com/?tag=%e5%88%86%e5%b8%83%e5%bc%8fjava%e5%ba%94%e7%94%a8" title="2 topics" target="_blank">分布式Java应用</a> <a href="https://blog.bluedavy.com/?tag=%e5%9c%86%e6%a1%8c%e4%ba%a4%e6%b5%81" title="1 topic" target="_blank">圆桌交流</a> <a href="https://blog.bluedavy.com/?tag=%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92" title="2 topics" target="_blank">容量规划</a> <a href="https://blog.bluedavy.com/?tag=%e6%82%b2%e8%a7%82%e7%ad%96%e7%95%a5" title="3 topics" target="_blank">悲观策略</a> <a href="https://blog.bluedavy.com/?tag=%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6" title="1 topic" target="_blank">服务框架</a> <a href="https://blog.bluedavy.com/?tag=%e7%a1%85%e8%b0%b7%e5%85%ac%e5%8f%b8" title="1 topic" target="_blank">硅谷公司</a></p>
<h3 id="-">订阅</h3>
<h3 id="-">推荐书籍</h3>
<h3 id="my-book">My Book</h3>
<p><a href="http://book.douban.com/subject/4848587/" title="分布式Java应用：基础与实践" target="_blank"><img src="" alt=""></a> <a href="http://book.douban.com/subject/3843896/" title="OSGi原理与最佳实践" target="_blank"><img src="" alt=""></a>
© <a href="https://blog.bluedavy.com/" target="_blank">BlueDavy之技术blog</a> 2013</p>
<p><a href="http://icondock.com/" target="_blank">Icons</a> &amp; <a href="http://www.ndesign-studio.com/wp-themes" target="_blank">Wordpress Theme</a> by <a href="http://www.ndesign-studio.com/" target="_blank">N.Design</a></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/JVM/">JVM</a></li></span></span> | <span class="tags">Tagged <a href="/tags/JVM/" class="label label-primary">JVM</a><a href="/tags/Java&J2EE/" class="label label-success">Java&J2EE</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-JVM--BTrace使用简介/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-JVM--BTrace使用简介" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-jacob--java操作word文档jacob-poi/">java操作word文档(jacob</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-jacob--java操作word文档jacob-poi/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="java-word-jacob-poi-">java操作word文档(jacob,poi)</h1>
<p>项目需要，用户从系统里面下载word文档，该文档进行了填写限制和加密，用户只能在固定位置填写内容。现要求系统验证上传的附件是否从系统上下载下来的。</p>
<p>思路：系统上面的文档都加入一个固定书签，用户上传文档的时候，检验文档里是否包含这个书签。</p>
<p>采用jacob操作word文档</p>
<p>JACOB（java -com bridge）是一个 JAVA到微软的COM接口的桥梁。使用JACOB允许任何JVM访问COM对象，从而使JAVA应用程序能够调用COM对象。</p>
<p>下载地址：<a href="http://sourceforge.net/projects/jacob-project/" target="_blank"><a href="http://sourceforge.net/projects/jacob-project/">http://sourceforge.net/projects/jacob-project/</a></a></p>
<p>其中jacob-1.16.1-x64.dll 是用于64位机器上的，jacob-1.16.1-x86.dll用于32位的。</p>
<p>该dll放于 C:\Windows\system32 目录下。jacob.jar放于应用lib底下</p>
<p>测试代码
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>ActiveXComponent    word = null;  </li>
<li>try {  </li>
<li>word = new ActiveXComponent(&quot;Word.Application&quot;);  </li>
<li>System.out.println(&quot;jacob当前版本：&quot;+word.getBuildVersion());  </li>
<li>}catch(Exception e ){  </li>
<li>e.printStackTrace();  </li>
<li>}  </li>
</ol>
<p>ActiveXComponent    word = null;</p>
<p>try {
        word = new ActiveXComponent(&quot;Word.Application&quot;);</p>
<pre><code>    System.out.println(&quot;jacob当前版本：&quot;+word.getBuildVersion());
</code></pre><p>}catch(Exception e ){</p>
<pre><code>     e.printStackTrace();
</code></pre><p>}</p>
<p>下面再贴出网上常见的代码+自己整理的几个方法（模糊查询书签等）</p>
<p>注意插入书签+书签值的方法，要先插入书签值再选中书签值，之后插入书签。这样根据书签名才能取得书签值。否则根据网络上很多方法，都取不到书签值或者取到空。因为书签值可以是一个点也可以是一大段内容。
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>import java.io.File;  </li>
<li>import java.util.HashMap;  </li>
<li>import java.util.Map;  </li>
<li></li>
<li>import com.gdcn.bpaf.common.helper.StringHelper;  </li>
<li>import com.jacob.activeX.ActiveXComponent;  </li>
<li>import com.jacob.com.ComThread;  </li>
<li>import com.jacob.com.Dispatch;  </li>
<li>import com.jacob.com.Variant;  </li>
<li>//<em>/</em> </li>
<li>/<em>  /</em> </li>
<li>/* <p>Description: {jacob操作word类}    </p> </li>
<li>/* </li>
<li>/* <p>Copyright: Copyright (c) 2011</p> </li>
<li>/*  </li>
<li>/* <p>CreateDate: 2012-6-28</p> </li>
<li>/* </li>
<li>/* @author Beny </li>
<li>/* @version 1.0 </li>
<li>/*/  </li>
<li></li>
<li>public class JacobHelper {  </li>
<li>// word文档  </li>
<li>private Dispatch doc;  </li>
<li></li>
<li>// word运行程序对象  </li>
<li>private ActiveXComponent word;  </li>
<li></li>
<li>// 所有word文档集合  </li>
<li>private Dispatch documents;  </li>
<li></li>
<li>// 选定的范围或插入点  </li>
<li>private Dispatch selection;  </li>
<li></li>
<li>private boolean saveOnExit = true;  </li>
<li></li>
<li>public JacobHelper(boolean visible) throws Exception {  </li>
<li>ComThread.InitSTA();//线程启动  </li>
<li>if (word == null) {  </li>
<li>word = new ActiveXComponent(&quot;Word.Application&quot;);  </li>
<li>word.setProperty(&quot;Visible&quot;, new Variant(visible)); // 不可见打开word  </li>
<li>word.setProperty(&quot;AutomationSecurity&quot;, new Variant(3)); // 禁用宏  </li>
<li>}  </li>
<li>if (documents == null)  </li>
<li>documents = word.getProperty(&quot;Documents&quot;).toDispatch();  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 设置退出时参数 </li>
<li>/*  </li>
<li>/* @param saveOnExit </li>
<li>/*            boolean true-退出时保存文件，false-退出时不保存文件 </li>
<li>/*/  </li>
<li>public void setSaveOnExit(boolean saveOnExit) {  </li>
<li>this.saveOnExit = saveOnExit;  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 创建一个新的word文档 </li>
<li>/*  </li>
<li>/*/  </li>
<li>public void createNewDocument() {  </li>
<li>doc = Dispatch.call(documents, &quot;Add&quot;).toDispatch();  </li>
<li>selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 打开一个已存在的文档 </li>
<li>/*  </li>
<li>/* @param docPath </li>
<li>/*/  </li>
<li>public void openDocument(String docPath) {  </li>
<li>//      closeDocument();  </li>
<li>doc = Dispatch.call(documents, &quot;Open&quot;, docPath).toDispatch();  </li>
<li>selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 只读方式打开一个加密的文档 </li>
<li>/*  </li>
<li>/* @param docPath-文件全名 </li>
<li>/* @param pwd-密码 </li>
<li>/*/  </li>
<li>public void openDocumentOnlyRead(String docPath, String pwd)  </li>
<li>throws Exception {  </li>
<li>//      closeDocument();  </li>
<li>doc = Dispatch.callN(  </li>
<li>documents,  </li>
<li>&quot;Open&quot;,  </li>
<li>new Object[] { docPath, new Variant(false), new Variant(true),  </li>
<li>new Variant(true), pwd, &quot;&quot;, new Variant(false) })  </li>
<li>.toDispatch();  </li>
<li>selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();  </li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 打开一个加密的文档 </li>
<li>/* @param docPath </li>
<li>/* @param pwd </li>
<li>/* @throws Exception </li>
<li>/*/  </li>
<li>public void openDocument(String docPath, String pwd) throws Exception {  </li>
<li>//      closeDocument();  </li>
<li>doc = Dispatch.callN(  </li>
<li>documents,  </li>
<li>&quot;Open&quot;,  </li>
<li>new Object[] { docPath, new Variant(false), new Variant(false),  </li>
<li>new Variant(true), pwd }).toDispatch();  </li>
<li>selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 从选定内容或插入点开始查找文本 </li>
<li>/*  </li>
<li>/* @param toFindText </li>
<li>/*            要查找的文本 </li>
<li>/* @return boolean true-查找到并选中该文本，false-未查找到文本 </li>
<li>/*/  </li>
<li>@SuppressWarnings(&quot;static-access&quot;)  </li>
<li>public boolean find(String toFindText) {  </li>
<li>if (toFindText == null || toFindText.equals(&quot;&quot;))  </li>
<li>return false;  </li>
<li>// 从selection所在位置开始查询  </li>
<li>Dispatch find = word.call(selection, &quot;Find&quot;).toDispatch();  </li>
<li>// 设置要查找的内容  </li>
<li>Dispatch.put(find, &quot;Text&quot;, toFindText);  </li>
<li>// 向前查找  </li>
<li>Dispatch.put(find, &quot;Forward&quot;, &quot;True&quot;);  </li>
<li>// 设置格式  </li>
<li>Dispatch.put(find, &quot;Format&quot;, &quot;True&quot;);  </li>
<li>// 大小写匹配  </li>
<li>Dispatch.put(find, &quot;MatchCase&quot;, &quot;True&quot;);  </li>
<li>// 全字匹配  </li>
<li>Dispatch.put(find, &quot;MatchWholeWord&quot;, &quot;false&quot;);  </li>
<li>// 查找并选中  </li>
<li>return Dispatch.call(find, &quot;Execute&quot;).getBoolean();  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 把选定选定内容设定为替换文本 </li>
<li>/*  </li>
<li>/* @param toFindText </li>
<li>/*            查找字符串 </li>
<li>/* @param newText </li>
<li>/*            要替换的内容 </li>
<li>/* @return </li>
<li>/*/  </li>
<li>public boolean replaceText(String toFindText, String newText) {  </li>
<li>if (!find(toFindText))  </li>
<li>return false;  </li>
<li>Dispatch.put(selection, &quot;Text&quot;, newText);  </li>
<li>return true;  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 全局替换文本 </li>
<li>/*  </li>
<li>/* @param toFindText </li>
<li>/*            查找字符串 </li>
<li>/* @param newText </li>
<li>/*            要替换的内容 </li>
<li>/*/  </li>
<li>public void replaceAllText(String toFindText, String newText) {  </li>
<li>while (find(toFindText)) {  </li>
<li>Dispatch.put(selection, &quot;Text&quot;, newText);  </li>
<li>Dispatch.call(selection, &quot;MoveRight&quot;);  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 在当前插入点插入字符串 </li>
<li>/*  </li>
<li>/* @param newText </li>
<li>/*            要插入的新字符串 </li>
<li>/*/  </li>
<li>public void insertText(String newText) {  </li>
<li>Dispatch.put(selection, &quot;Text&quot;, newText);  </li>
<li>}  </li>
<li></li>
<li></li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 设置当前选定内容的字体 </li>
<li>/*  </li>
<li>/* @param boldSize </li>
<li>/* @param italicSize </li>
<li>/* @param underLineSize </li>
<li>/*            下划线 </li>
<li>/* @param colorSize </li>
<li>/*            字体颜色 </li>
<li>/* @param size </li>
<li>/*            字体大小 </li>
<li>/* @param name </li>
<li>/*            字体名称 </li>
<li>/* @param hidden </li>
<li>/*            是否隐藏 </li>
<li>/*/  </li>
<li>public void setFont(boolean bold, boolean italic, boolean underLine,  </li>
<li>String colorSize, String size, String name,boolean hidden) {  </li>
<li>Dispatch font = Dispatch.get(selection, &quot;Font&quot;).toDispatch();  </li>
<li>Dispatch.put(font, &quot;Name&quot;, new Variant(name));  </li>
<li>Dispatch.put(font, &quot;Bold&quot;, new Variant(bold));  </li>
<li>Dispatch.put(font, &quot;Italic&quot;, new Variant(italic));  </li>
<li>Dispatch.put(font, &quot;Underline&quot;, new Variant(underLine));  </li>
<li>Dispatch.put(font, &quot;Color&quot;, colorSize);  </li>
<li>Dispatch.put(font, &quot;Size&quot;, size);  </li>
<li>Dispatch.put(font, &quot;Hidden&quot;, hidden);  </li>
<li>}  </li>
<li></li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 文件保存或另存为 </li>
<li>/*  </li>
<li>/* @param savePath </li>
<li>/*            保存或另存为路径 </li>
<li>/*/  </li>
<li>public void save(String savePath) {  </li>
<li>Dispatch.call(Dispatch.call(word, &quot;WordBasic&quot;).getDispatch(),  </li>
<li>&quot;FileSaveAs&quot;, savePath);  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 文件保存为html格式 </li>
<li>/*  </li>
<li>/* @param savePath </li>
<li>/* @param htmlPath </li>
<li>/*/  </li>
<li>public void saveAsHtml(String htmlPath) {  </li>
<li>Dispatch.invoke(doc, &quot;SaveAs&quot;, Dispatch.Method, new Object[] {  </li>
<li>htmlPath, new Variant(8) }, new int[1]);  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 关闭文档 </li>
<li>/*  </li>
<li>/* @param val </li>
<li>/*            0不保存修改 -1 保存修改 -2 提示是否保存修改 </li>
<li>/*/  </li>
<li>public void closeDocument(int val) {  </li>
<li>Dispatch.call(doc, &quot;Close&quot;, new Variant(val));//注 是documents而不是doc  </li>
<li>documents = null;  </li>
<li>doc = null;  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 关闭当前word文档 </li>
<li>/*  </li>
<li>/*/  </li>
<li>public void closeDocument() {  </li>
<li>if (documents != null) {  </li>
<li>Dispatch.call(documents, &quot;Save&quot;);  </li>
<li>Dispatch.call(documents, &quot;Close&quot;, new Variant(saveOnExit));  </li>
<li>documents = null;  </li>
<li>doc = null;  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>public void closeDocumentWithoutSave() {  </li>
<li>if (documents != null) {  </li>
<li>Dispatch.call(documents, &quot;Close&quot;, new Variant(false));  </li>
<li>documents = null;  </li>
<li>doc = null;  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 保存并关闭全部应用 </li>
<li>/*  </li>
<li>/*/  </li>
<li>public void close() {  </li>
<li>closeDocument(-1);  </li>
<li>if (word != null) {  </li>
<li>//          Dispatch.call(word, &quot;Quit&quot;);  </li>
<li>word.invoke(&quot;Quit&quot;, new Variant[] {});  </li>
<li>word = null;  </li>
<li>}  </li>
<li>selection = null;  </li>
<li>documents = null;  </li>
<li>ComThread.Release();//释放com线程。根据jacob的帮助文档，com的线程回收不由java的垃圾回收器处理  </li>
<li></li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 打印当前word文档 </li>
<li>/*  </li>
<li>/*/  </li>
<li>public void printFile() {  </li>
<li>if (doc != null) {  </li>
<li>Dispatch.call(doc, &quot;PrintOut&quot;);  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 保护当前档,如果不存在, 使用expression.Protect(Type, NoReset, Password) </li>
<li>/*  </li>
<li>/* @param pwd </li>
<li>/* @param type </li>
<li>/*            WdProtectionType 常量之一(int 类型，只读)： </li>
<li>/*            1-wdAllowOnlyComments  仅批注 </li>
<li>/*            2-wdAllowOnlyFormFields 仅填写窗体 </li>
<li>/*            0-wdAllowOnlyRevisions 仅修订 </li>
<li>/*            -1-wdNoProtection 无保护,  </li>
<li>/*            3-wdAllowOnlyReading 只读 </li>
<li>/*  </li>
<li>/*/  </li>
<li>public void protectedWord(String pwd,String type) {  </li>
<li>String protectionType = Dispatch.get(doc, &quot;ProtectionType&quot;).toString();  </li>
<li>if (protectionType.equals(&quot;-1&quot;)) {  </li>
<li>Dispatch.call(doc, &quot;Protect&quot;, Integer.parseInt(type), new Variant(true),pwd);  </li>
<li>}  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 解除文档保护,如果存在 </li>
<li>/*  </li>
<li>/* @param pwd </li>
<li>/*            WdProtectionType 常量之一(int 类型，只读)： </li>
<li>/*            1-wdAllowOnlyComments  仅批注 </li>
<li>/*            2-wdAllowOnlyFormFields 仅填写窗体 </li>
<li>/*            0-wdAllowOnlyRevisions 仅修订 </li>
<li>/*            -1-wdNoProtection 无保护,  </li>
<li>/*            3-wdAllowOnlyReading 只读 </li>
<li>/*  </li>
<li>/*/  </li>
<li>public void unProtectedWord(String pwd) {  </li>
<li>String protectionType = Dispatch.get(doc, &quot;ProtectionType&quot;).toString();  </li>
<li>if (!protectionType.equals(&quot;0&quot;)&amp;&amp;!protectionType.equals(&quot;-1&quot;)) {  </li>
<li>Dispatch.call(doc, &quot;Unprotect&quot;, pwd);  </li>
<li>}  </li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 返回文档的保护类型 </li>
<li>/* @return </li>
<li>/*/  </li>
<li>public String getProtectedType(){  </li>
<li>return Dispatch.get(doc, &quot;ProtectionType&quot;).toString();  </li>
<li>}  </li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 设置word文档安全级别 </li>
<li>/*  </li>
<li>/* @param value </li>
<li>/*            1-msoAutomationSecurityByUI 使用“安全”对话框指定的安全设置。 </li>
<li>/*            2-msoAutomationSecurityForceDisable </li>
<li>/*            在程序打开的所有文件中禁用所有宏，而不显示任何安全提醒。 3-msoAutomationSecurityLow </li>
<li>/*            启用所有宏，这是启动应用程序时的默认值。 </li>
<li>/*/  </li>
<li>public void setAutomationSecurity(int value) {  </li>
<li>word.setProperty(&quot;AutomationSecurity&quot;, new Variant(value));  </li>
<li>}  </li>
<li></li>
<li></li>
<li></li>
<li></li>
<li>//<em>/</em> </li>
<li>/* 在word中插入标签 labelName是标签名，labelValue是标签值 </li>
<li>/* @param labelName </li>
<li>/* @param labelValue </li>
<li>/*/  </li>
<li>public  void insertLabelValue(String labelName,String labelValue) {  </li>
<li></li>
<li>Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();  </li>
<li>boolean isExist = Dispatch.call(bookMarks, &quot;Exists&quot;, labelName).getBoolean();  </li>
<li>if (isExist == true) {  </li>
<li>Dispatch rangeItem1 = Dispatch.call(bookMarks, &quot;Item&quot;, labelName).toDispatch();  </li>
<li>Dispatch range1 = Dispatch.call(rangeItem1, &quot;Range&quot;).toDispatch();  </li>
<li>String bookMark1Value = Dispatch.get(range1, &quot;Text&quot;).toString();  </li>
<li>System.out.println(&quot;书签内容：&quot;+bookMark1Value);  </li>
<li>} else {  </li>
<li>System.out.println(&quot;当前书签不存在,重新建立!&quot;);  </li>
<li>//TODO 先插入文字，再查找选中文字，再插入标签  </li>
<li>this.insertText(labelValue);  </li>
<li>//          this.find(labelValue);//查找文字，并选中  </li>
<li>this.setFont(true, true,true,&quot;102,92,38&quot;, &quot;20&quot;, &quot;&quot;,true);  </li>
<li>Dispatch.call(bookMarks, &quot;Add&quot;, labelName, selection);  </li>
<li>Dispatch.call(bookMarks, &quot;Hidden&quot;, labelName);  </li>
<li>}  </li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 在word中插入标签 labelName是标签名 </li>
<li>/* @param labelName </li>
<li>/*/  </li>
<li>public  void insertLabel(String labelName) {  </li>
<li></li>
<li>Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();  </li>
<li>boolean isExist = Dispatch.call(bookMarks, &quot;Exists&quot;, labelName).getBoolean();  </li>
<li>if (isExist == true) {  </li>
<li>System.out.println(&quot;书签已存在&quot;);  </li>
<li>} else {  </li>
<li>System.out.println(&quot;建立书签：&quot;+labelName);  </li>
<li>Dispatch.call(bookMarks, &quot;Add&quot;, labelName, selection);  </li>
<li>}  </li>
<li>}     </li>
<li>//<em>/</em> </li>
<li>/* 查找书签 </li>
<li>/* @param labelName </li>
<li>/* @return </li>
<li>/*/  </li>
<li>public boolean findLabel(String labelName) {  </li>
<li>Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();  </li>
<li>boolean isExist = Dispatch.call(bookMarks, &quot;Exists&quot;, labelName).getBoolean();  </li>
<li>if (isExist == true) {  </li>
<li>return true;  </li>
<li>} else {  </li>
<li>System.out.println(&quot;当前书签不存在!&quot;);  </li>
<li>return false;  </li>
<li>}  </li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 模糊查找书签,并返回准确的书签名称 </li>
<li>/* @param labelName </li>
<li>/* @return </li>
<li>/*/  </li>
<li>public String findLabelLike(String labelName) {  </li>
<li>Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();  </li>
<li>int count = Dispatch.get(bookMarks, &quot;Count&quot;).getInt(); // 书签数  </li>
<li>Dispatch rangeItem = null;  </li>
<li>String lname = &quot;&quot;;  </li>
<li>for(int i=1;i&lt;=count;i++){  </li>
<li>rangeItem = Dispatch.call(bookMarks, &quot;Item&quot;, new Variant(i)).toDispatch();  </li>
<li>lname = Dispatch.call(rangeItem, &quot;Name&quot;).toString();//书签名称  </li>
<li>if(lname.startsWith(labelName)){//前面匹配  </li>
<li>//             return lname.replaceFirst(labelName, &quot;&quot;);//返回后面值  </li>
<li>return lname;  </li>
<li>}  </li>
<li>}  </li>
<li>return &quot;&quot;;  </li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 模糊删除书签 </li>
<li>/* @param labelName </li>
<li>/*/  </li>
<li>public void deleteLableLike(String labelName){  </li>
<li>Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();  </li>
<li>int count = Dispatch.get(bookMarks, &quot;Count&quot;).getInt(); // 书签数  </li>
<li>Dispatch rangeItem = null;  </li>
<li>String lname = &quot;&quot;;  </li>
<li>for(int i=1;i&lt;=count;i++){  </li>
<li>rangeItem = Dispatch.call(bookMarks, &quot;Item&quot;, new Variant(i)).toDispatch();  </li>
<li>lname = Dispatch.call(rangeItem, &quot;Name&quot;).toString();//书签名称  </li>
<li>if(lname.startsWith(labelName)){//前面匹配  </li>
<li>Dispatch.call(rangeItem, &quot;Delete&quot;);  </li>
<li>count--;//书签已被删除，书签数目和当前书签都要相应减1，否则会报错:集合找不到  </li>
<li>i--;  </li>
<li>}  </li>
<li>}  </li>
<li>}  </li>
<li>//<em>/</em> </li>
<li>/* 获取书签内容 </li>
<li>/* @param labelName </li>
<li>/* @return </li>
<li>/*/  </li>
<li>public String getLableValue(String labelName){  </li>
<li>if(this.findLabel(labelName)){  </li>
<li>Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();  </li>
<li>Dispatch rangeItem1 = Dispatch.call(bookMarks, &quot;Item&quot;, labelName).toDispatch();  </li>
<li>Dispatch range1 = Dispatch.call(rangeItem1, &quot;Range&quot;).toDispatch();  </li>
<li>Dispatch font = Dispatch.get(range1, &quot;Font&quot;).toDispatch();  </li>
<li>Dispatch.put(font, &quot;Hidden&quot;, new Variant(false)); //显示书签内容  </li>
<li>String bookMark1Value = Dispatch.get(range1, &quot;Text&quot;).toString();  </li>
<li>System.out.println(&quot;书签内容：&quot;+bookMark1Value);  </li>
<li>//            font = Dispatch.get(range1, &quot;Font&quot;).toDispatch();  </li>
<li>//              Dispatch.put(font, &quot;Hidden&quot;, new Variant(true)); //隐藏书签内容  </li>
<li>return bookMark1Value;  </li>
<li>}  </li>
<li>return &quot;&quot;;  </li>
<li>}  </li>
<li></li>
<li></li>
<li>public static void main(String[] args) throws Exception {  </li>
<li></li>
<li>}     </li>
<li></li>
<li>}  </li>
</ol>
<p>import java.io.File;</p>
<p>import java.util.HashMap;
import java.util.Map;</p>
<p>import com.gdcn.bpaf.common.helper.StringHelper;</p>
<p>import com.jacob.activeX.ActiveXComponent;
import com.jacob.com.ComThread;</p>
<p>import com.jacob.com.Dispatch;
import com.jacob.com.Variant;</p>
<p>//<em>/</em>
 /<em>  /</em></p>
<p> /<em> <p>Description: {jacob操作word类}    </p>
/</em></p>
<p>/<em> <p>Copyright: Copyright (c) 2011</p>
/</em></p>
<p>/<em> <p>CreateDate: 2012-6-28</p>
/</em></p>
<p>/<em> @author Beny
/</em> @version 1.0</p>
<p>/*/</p>
<p>public class JacobHelper {
    // word文档</p>
<pre><code>private Dispatch doc;


// word运行程序对象
private ActiveXComponent word;


// 所有word文档集合

private Dispatch documents;


// 选定的范围或插入点
private Dispatch selection;


private boolean saveOnExit = true;


public JacobHelper(boolean visible) throws Exception {

    ComThread.InitSTA();//线程启动
    if (word == null) {

        word = new ActiveXComponent(&quot;Word.Application&quot;);
        word.setProperty(&quot;Visible&quot;, new Variant(visible)); // 不可见打开word

        word.setProperty(&quot;AutomationSecurity&quot;, new Variant(3)); // 禁用宏
    }

    if (documents == null)
        documents = word.getProperty(&quot;Documents&quot;).toDispatch();

}


//*/*
 /* 设置退出时参数

 /*
 /* @param saveOnExit

 /*            boolean true-退出时保存文件，false-退出时不保存文件
 /*/

public void setSaveOnExit(boolean saveOnExit) {
    this.saveOnExit = saveOnExit;

}


//*/*
 /* 创建一个新的word文档

 /*
 /*/

public void createNewDocument() {
    doc = Dispatch.call(documents, &quot;Add&quot;).toDispatch();

    selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();
}


//*/*

 /* 打开一个已存在的文档
 /*

 /* @param docPath
 /*/

public void openDocument(String docPath) {
</code></pre><p>//        closeDocument();</p>
<pre><code>    doc = Dispatch.call(documents, &quot;Open&quot;, docPath).toDispatch();
    selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();

}


//*/*
 /* 只读方式打开一个加密的文档

 /*
 /* @param docPath-文件全名

 /* @param pwd-密码
 /*/

public void openDocumentOnlyRead(String docPath, String pwd)
        throws Exception {
</code></pre><p>//        closeDocument();
        doc = Dispatch.callN(</p>
<pre><code>            documents,
            &quot;Open&quot;,

            new Object[] { docPath, new Variant(false), new Variant(true),
                    new Variant(true), pwd, &quot;&quot;, new Variant(false) })

            .toDispatch();
    selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();

}
//*/*

 /* 打开一个加密的文档
 /* @param docPath

 /* @param pwd
 /* @throws Exception

 /*/
public void openDocument(String docPath, String pwd) throws Exception {
</code></pre><p>//        closeDocument();
        doc = Dispatch.callN(</p>
<pre><code>            documents,
            &quot;Open&quot;,

            new Object[] { docPath, new Variant(false), new Variant(false),
                    new Variant(true), pwd }).toDispatch();

    selection = Dispatch.get(word, &quot;Selection&quot;).toDispatch();
}


//*/*

 /* 从选定内容或插入点开始查找文本
 /*

 /* @param toFindText
 /*            要查找的文本

 /* @return boolean true-查找到并选中该文本，false-未查找到文本
 /*/

@SuppressWarnings(&quot;static-access&quot;)
public boolean find(String toFindText) {

    if (toFindText == null || toFindText.equals(&quot;&quot;))
        return false;

    // 从selection所在位置开始查询
    Dispatch find = word.call(selection, &quot;Find&quot;).toDispatch();

    // 设置要查找的内容
    Dispatch.put(find, &quot;Text&quot;, toFindText);

    // 向前查找
    Dispatch.put(find, &quot;Forward&quot;, &quot;True&quot;);

    // 设置格式
    Dispatch.put(find, &quot;Format&quot;, &quot;True&quot;);

    // 大小写匹配
    Dispatch.put(find, &quot;MatchCase&quot;, &quot;True&quot;);

    // 全字匹配
    Dispatch.put(find, &quot;MatchWholeWord&quot;, &quot;false&quot;);

    // 查找并选中
    return Dispatch.call(find, &quot;Execute&quot;).getBoolean();

}


//*/*
 /* 把选定选定内容设定为替换文本

 /*
 /* @param toFindText

 /*            查找字符串
 /* @param newText

 /*            要替换的内容
 /* @return

 /*/
public boolean replaceText(String toFindText, String newText) {

    if (!find(toFindText))
        return false;

    Dispatch.put(selection, &quot;Text&quot;, newText);
    return true;

}


//*/*
 /* 全局替换文本

 /*
 /* @param toFindText

 /*            查找字符串
 /* @param newText

 /*            要替换的内容
 /*/

public void replaceAllText(String toFindText, String newText) {
    while (find(toFindText)) {

        Dispatch.put(selection, &quot;Text&quot;, newText);
        Dispatch.call(selection, &quot;MoveRight&quot;);

    }
}


//*/*

 /* 在当前插入点插入字符串
 /*

 /* @param newText
 /*            要插入的新字符串

 /*/
public void insertText(String newText) {

    Dispatch.put(selection, &quot;Text&quot;, newText);
}





//*/*

 /* 设置当前选定内容的字体
 /*

 /* @param boldSize
 /* @param italicSize

 /* @param underLineSize
 /*            下划线

 /* @param colorSize
 /*            字体颜色

 /* @param size
 /*            字体大小

 /* @param name
 /*            字体名称

 /* @param hidden
 /*            是否隐藏

 /*/
public void setFont(boolean bold, boolean italic, boolean underLine,

        String colorSize, String size, String name,boolean hidden) {
    Dispatch font = Dispatch.get(selection, &quot;Font&quot;).toDispatch();

    Dispatch.put(font, &quot;Name&quot;, new Variant(name));
    Dispatch.put(font, &quot;Bold&quot;, new Variant(bold));

    Dispatch.put(font, &quot;Italic&quot;, new Variant(italic));
    Dispatch.put(font, &quot;Underline&quot;, new Variant(underLine));

    Dispatch.put(font, &quot;Color&quot;, colorSize);
    Dispatch.put(font, &quot;Size&quot;, size);

    Dispatch.put(font, &quot;Hidden&quot;, hidden);
}




//*/*
 /* 文件保存或另存为

 /*
 /* @param savePath

 /*            保存或另存为路径
 /*/

public void save(String savePath) {
    Dispatch.call(Dispatch.call(word, &quot;WordBasic&quot;).getDispatch(),

            &quot;FileSaveAs&quot;, savePath);
}


//*/*

 /* 文件保存为html格式
 /*

 /* @param savePath
 /* @param htmlPath

 /*/
public void saveAsHtml(String htmlPath) {

    Dispatch.invoke(doc, &quot;SaveAs&quot;, Dispatch.Method, new Object[] {
            htmlPath, new Variant(8) }, new int[1]);

}


//*/*
 /* 关闭文档

 /*
 /* @param val

 /*            0不保存修改 -1 保存修改 -2 提示是否保存修改
 /*/

public void closeDocument(int val) {
    Dispatch.call(doc, &quot;Close&quot;, new Variant(val));//注 是documents而不是doc

    documents = null;
    doc = null;

}


//*/*
 /* 关闭当前word文档

 /*
 /*/

public void closeDocument() {
    if (documents != null) {

        Dispatch.call(documents, &quot;Save&quot;);
        Dispatch.call(documents, &quot;Close&quot;, new Variant(saveOnExit));

        documents = null;
        doc = null;

    }
}


public void closeDocumentWithoutSave() {

    if (documents != null) {
        Dispatch.call(documents, &quot;Close&quot;, new Variant(false));

        documents = null;
        doc = null;

    }
}


//*/*

 /* 保存并关闭全部应用
 /*

 /*/
public void close() {

    closeDocument(-1);
    if (word != null) {
</code></pre><p>//            Dispatch.call(word, &quot;Quit&quot;);
            word.invoke(&quot;Quit&quot;, new Variant[] {});</p>
<pre><code>        word = null;
    }

    selection = null;
    documents = null;

    ComThread.Release();//释放com线程。根据jacob的帮助文档，com的线程回收不由java的垃圾回收器处理


}
//*/*

 /* 打印当前word文档
 /*

 /*/
public void printFile() {

    if (doc != null) {
        Dispatch.call(doc, &quot;PrintOut&quot;);

    }
}


//*/*

 /* 保护当前档,如果不存在, 使用expression.Protect(Type, NoReset, Password)
 /*

 /* @param pwd
 /* @param type

 /*            WdProtectionType 常量之一(int 类型，只读)：
 /*            1-wdAllowOnlyComments  仅批注

 /*            2-wdAllowOnlyFormFields 仅填写窗体
 /*            0-wdAllowOnlyRevisions 仅修订

 /*            -1-wdNoProtection 无保护,
 /*            3-wdAllowOnlyReading 只读

 /*
 /*/

public void protectedWord(String pwd,String type) {
    String protectionType = Dispatch.get(doc, &quot;ProtectionType&quot;).toString();

    if (protectionType.equals(&quot;-1&quot;)) {
        Dispatch.call(doc, &quot;Protect&quot;, Integer.parseInt(type), new Variant(true),pwd);

    }
}


//*/*

 /* 解除文档保护,如果存在
 /*

 /* @param pwd
 /*            WdProtectionType 常量之一(int 类型，只读)：

 /*            1-wdAllowOnlyComments  仅批注
 /*            2-wdAllowOnlyFormFields 仅填写窗体

 /*            0-wdAllowOnlyRevisions 仅修订
 /*            -1-wdNoProtection 无保护,

 /*            3-wdAllowOnlyReading 只读
 /*

 /*/
public void unProtectedWord(String pwd) {

    String protectionType = Dispatch.get(doc, &quot;ProtectionType&quot;).toString();
    if (!protectionType.equals(&quot;0&quot;)&amp;&amp;!protectionType.equals(&quot;-1&quot;)) {

        Dispatch.call(doc, &quot;Unprotect&quot;, pwd);
    }

}
//*/*

 /* 返回文档的保护类型
 /* @return

 /*/
public String getProtectedType(){

    return Dispatch.get(doc, &quot;ProtectionType&quot;).toString();
}


//*/*

 /* 设置word文档安全级别
 /*

 /* @param value
 /*            1-msoAutomationSecurityByUI 使用“安全”对话框指定的安全设置。

 /*            2-msoAutomationSecurityForceDisable
 /*            在程序打开的所有文件中禁用所有宏，而不显示任何安全提醒。 3-msoAutomationSecurityLow

 /*            启用所有宏，这是启动应用程序时的默认值。
 /*/

public void setAutomationSecurity(int value) {
    word.setProperty(&quot;AutomationSecurity&quot;, new Variant(value));

}






//*/*

 /* 在word中插入标签 labelName是标签名，labelValue是标签值
 /* @param labelName

 /* @param labelValue
 /*/

public  void insertLabelValue(String labelName,String labelValue) {


   Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();
   boolean isExist = Dispatch.call(bookMarks, &quot;Exists&quot;, labelName).getBoolean();

    if (isExist == true) {
        Dispatch rangeItem1 = Dispatch.call(bookMarks, &quot;Item&quot;, labelName).toDispatch();

        Dispatch range1 = Dispatch.call(rangeItem1, &quot;Range&quot;).toDispatch();
        String bookMark1Value = Dispatch.get(range1, &quot;Text&quot;).toString();

          System.out.println(&quot;书签内容：&quot;+bookMark1Value);
    } else {

        System.out.println(&quot;当前书签不存在,重新建立!&quot;);
        //TODO 先插入文字，再查找选中文字，再插入标签

        this.insertText(labelValue);
</code></pre><p>//            this.find(labelValue);//查找文字，并选中</p>
<pre><code>        this.setFont(true, true,true,&quot;102,92,38&quot;, &quot;20&quot;, &quot;&quot;,true);
         Dispatch.call(bookMarks, &quot;Add&quot;, labelName, selection);

         Dispatch.call(bookMarks, &quot;Hidden&quot;, labelName);
    }

}
//*/*

 /* 在word中插入标签 labelName是标签名
 /* @param labelName

 /*/
public  void insertLabel(String labelName) {


   Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();

   boolean isExist = Dispatch.call(bookMarks, &quot;Exists&quot;, labelName).getBoolean();
    if (isExist == true) {

          System.out.println(&quot;书签已存在&quot;);
    } else {

        System.out.println(&quot;建立书签：&quot;+labelName);
         Dispatch.call(bookMarks, &quot;Add&quot;, labelName, selection);

    }
}   

//*/*
 /* 查找书签

 /* @param labelName
 /* @return

 /*/
public boolean findLabel(String labelName) {

   Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();
   boolean isExist = Dispatch.call(bookMarks, &quot;Exists&quot;, labelName).getBoolean();

   if (isExist == true) {
          return true;

    } else {
        System.out.println(&quot;当前书签不存在!&quot;);

        return false;
    }

}
//*/*

 /* 模糊查找书签,并返回准确的书签名称
 /* @param labelName

 /* @return
 /*/

public String findLabelLike(String labelName) {
   Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();

   int count = Dispatch.get(bookMarks, &quot;Count&quot;).getInt(); // 书签数
   Dispatch rangeItem = null;

   String lname = &quot;&quot;;
   for(int i=1;i&lt;=count;i++){

       rangeItem = Dispatch.call(bookMarks, &quot;Item&quot;, new Variant(i)).toDispatch();
       lname = Dispatch.call(rangeItem, &quot;Name&quot;).toString();//书签名称

       if(lname.startsWith(labelName)){//前面匹配
</code></pre><p>//               return lname.replaceFirst(labelName, &quot;&quot;);//返回后面值</p>
<pre><code>           return lname;
       }

   }
   return &quot;&quot;;

}
//*/*

 /* 模糊删除书签
 /* @param labelName

 /*/
public void deleteLableLike(String labelName){

    Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();
   int count = Dispatch.get(bookMarks, &quot;Count&quot;).getInt(); // 书签数

   Dispatch rangeItem = null;
   String lname = &quot;&quot;;

   for(int i=1;i&lt;=count;i++){
       rangeItem = Dispatch.call(bookMarks, &quot;Item&quot;, new Variant(i)).toDispatch();

       lname = Dispatch.call(rangeItem, &quot;Name&quot;).toString();//书签名称
       if(lname.startsWith(labelName)){//前面匹配

           Dispatch.call(rangeItem, &quot;Delete&quot;);
           count--;//书签已被删除，书签数目和当前书签都要相应减1，否则会报错:集合找不到

           i--;
       }

   }
}

//*/*
 /* 获取书签内容

 /* @param labelName
 /* @return

 /*/
public String getLableValue(String labelName){

    if(this.findLabel(labelName)){
        Dispatch bookMarks = Dispatch.call(doc, &quot;Bookmarks&quot;).toDispatch();

        Dispatch rangeItem1 = Dispatch.call(bookMarks, &quot;Item&quot;, labelName).toDispatch();
        Dispatch range1 = Dispatch.call(rangeItem1, &quot;Range&quot;).toDispatch();

        Dispatch font = Dispatch.get(range1, &quot;Font&quot;).toDispatch();
        Dispatch.put(font, &quot;Hidden&quot;, new Variant(false)); //显示书签内容

        String bookMark1Value = Dispatch.get(range1, &quot;Text&quot;).toString();
          System.out.println(&quot;书签内容：&quot;+bookMark1Value);
</code></pre><p>//            font = Dispatch.get(range1, &quot;Font&quot;).toDispatch();
//              Dispatch.put(font, &quot;Hidden&quot;, new Variant(true)); //隐藏书签内容</p>
<pre><code>          return bookMark1Value;
    }

    return &quot;&quot;;
}




public static void main(String[] args) throws Exception {


}   
</code></pre><p>}</p>
<p> 采用jacob方式操作文档，经常会出现卡机的现象，所以最后采用poi方式来操作书签。若单纯的操作书签用poi方式还是比较简单的，但要操作表格、文档格式之类的还是用jacob功能比较强大。
Java代码  <a href="&quot;收藏这段代码&quot;"><img src="" alt="收藏代码"><img src="" alt=""></a></p>
<ol>
<li>InputStream input = null;  </li>
<li>File docFile = new File( fileName );  </li>
<li>HWPFDocument document = null;  </li>
<li>try{  </li>
<li>input = new FileInputStream(docFile);//加载 doc 文档  </li>
<li>document = new HWPFDocument(input);//文件流方式创建hwpf  </li>
<li>Bookmarks bookmarks =  document.getBookmarks();//文档书签  </li>
<li>for(int i=0,length=bookmarks.getBookmarksCount();i&lt;length;i++){  </li>
<li>bookmarkName = bookmarks.getBookmark(i).getName();  </li>
<li>//.....  </li>
<li>}  </li>
<li></li>
<li>}catch( Exception e){  </li>
<li></li>
<li>}finally{  </li>
<li>if( null != input )  </li>
<li>input.close();  </li>
<li>}  </li>
</ol>
<p>InputStream input = null;</p>
<p>File docFile = new File( fileName );
HWPFDocument document = null;</p>
<p>try{
    input = new FileInputStream(docFile);//加载 doc 文档</p>
<pre><code>document = new HWPFDocument(input);//文件流方式创建hwpf
Bookmarks bookmarks =  document.getBookmarks();//文档书签

for(int i=0,length=bookmarks.getBookmarksCount();i&lt;length;i++){
    bookmarkName = bookmarks.getBookmark(i).getName();

    //.....
}
</code></pre><p>}catch( Exception e){</p>
<p>}finally{</p>
<pre><code>if( null != input )
        input.close();
</code></pre><p>}</p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/java-com/">java-com</a></li><li><a href="/categories/Java&J2EE/java-com/jacob/">jacob</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/jacob/" class="label label-success">jacob</a><a href="/tags/java-com/" class="label label-info">java-com</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-java-com-jacob--java操作word文档jacob-poi/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-java-com-jacob--java操作word文档jacob-poi" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>



  <article>
<div id="post" class="post well">
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区/">100</a></h1>
      
        <span>Posted on<time datetime="2014-02-02T01:54:41.000Z"> <a href="/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区/">feb. 2 2014</a></time></span>      
    </header>
    
    
    <div class="entry">
      
        <h1 id="100-java-windows-wmi-">100%纯java调用windows的wmi获取监控数据 - 肖国颖的个人页面 - 开源中国社区</h1>
<p><a href="http://www.oschina.net/" title="开源中国社区首页" target="_blank">开源中国社区</a></p>
<p>开源项目发现、使用和交流平台</p>
<ul>
<li><a href="http://www.oschina.net/project" target="_blank">项目</a></li>
<li><a href="http://www.oschina.net/question" target="_blank">讨论</a></li>
<li><a href="http://www.oschina.net/code/list" target="_blank">代码</a></li>
<li><a href="http://www.oschina.net/news" target="_blank">资讯</a></li>
<li><a href="http://www.oschina.net/translate" target="_blank">翻译</a></li>
<li><a href="http://www.oschina.net/blog" target="_blank">博客</a></li>
<li><a href="http://www.oschina.net/android" target="_blank">Android</a></li>
<li><a href="http://www.oschina.net/job" target="_blank">招聘</a></li>
</ul>
<p>当前访客身份： arctichia [ <a href="http://my.oschina.net/arcichia" target="_blank">我的空间</a> | <a href="http://my.oschina.net/action/user/logout?session=9c386f172b1174553110&amp;goto_page=http%3A%2F%2Fmy.oschina.net%2Fnoahxiao" target="_blank">退出</a> ]  <a href="http://my.oschina.net/arcichia/admin/inbox" title="进入我的留言箱" target="_blank">你有<em>0</em>新留言</a></p>
<p>软件 代码 讨论区 新闻 博客</p>
<p>软件</p>
<ul>
<li><a href="">软件</a></li>
<li><a href="">代码</a></li>
<li><a href="">讨论区</a></li>
<li><a href="">新闻</a></li>
<li><a href="">博客</a>
<a href="http://my.oschina.net/noahxiao" target="_blank"><img src="&quot;肖国颖&quot;" alt="肖国颖"></a>  <a href="http://my.oschina.net/noahxiao" title="男" target="_blank">肖国颖</a>  <img src="&quot;男&quot;" alt=""> <a href="&quot;成为TA的粉丝&quot;">关注此人</a></li>
</ul>
<p><a href="http://my.oschina.net/noahxiao/fellow" target="_blank">关注(4)</a> <a href="http://my.oschina.net/noahxiao/fans" target="_blank">粉丝(71)</a> <a href="http://www.oschina.net/question/3307_20931" title="查看OSCHINA积分规则" target="_blank">积分(280)</a></p>
<p>不做鬼中鬼，怎做人上人
<a href="">.发送留言</a> <a href="http://www.oschina.net/question/ask?user=569848" target="_blank">.请教问题</a></p>
<p><strong>博客分类</strong></p>
<ul>
<li><a href="http://my.oschina.net/noahxiao/blog?catalog=186739" target="_blank">工作日志</a>(47)</li>
<li><a href="http://my.oschina.net/noahxiao/blog?catalog=186740" target="_blank">日常记录</a>(0)</li>
<li><a href="http://my.oschina.net/noahxiao/blog?catalog=186741" target="_blank">转贴的文章</a>(0)
<strong>阅读排行</strong></li>
</ul>
<ol>
<li><a href="http://my.oschina.net/noahxiao/blog/61987" target="_blank">1. 在Android中嵌入AdMob广告，赚午饭钱</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/86328" target="_blank">2. 解决iOS6看YouTb的心酸，补充可看版(goagent+opendoor)</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/126357" target="_blank">3. 当单例（Singleton）爱上多线程——重复初始化问题</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/112759" target="_blank">4. Java序列化与JSON序列化大比拼</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/61495" target="_blank">5. 在Eclipse中用Scala语言开发Android应用</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/88687" target="_blank">6. Ubuntu 12.10下用Empathy（pidgin-lwqq）登录QQ</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/65071" target="_blank">7. 解决Ubuntu 12.04下频繁死机-Chrome</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/140771" target="_blank">8. 以Jar形式为Web项目提供资源文件（JS、CSS与图片）</a></li>
</ol>
<p><strong>最新评论</strong></p>
<ul>
<li><a href="http://my.oschina.net/wenshao" target="_blank">@wenshao</a>：fastjson缺省是做循环引用检测的，你关掉这个再测... <a href="http://my.oschina.net/action/tweet/go?obj=274988152&amp;type=18&amp;user=127152" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/wenshao" target="_blank">@wenshao</a>：这个测试不对，你直接测试JavaBean而不是Map看看... <a href="http://my.oschina.net/action/tweet/go?obj=274988031&amp;type=18&amp;user=127152" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/u/1182868" target="_blank">@rrstpit</a>：Fffff <a href="http://my.oschina.net/action/tweet/go?obj=274896306&amp;type=18&amp;user=1182868" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/fxl" target="_blank">@付学良</a>：引用来自“xautlx”的评论 Servlet3规范好像已经... <a href="http://my.oschina.net/action/tweet/go?obj=274529269&amp;type=18&amp;user=83617" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/112358" target="_blank">@yezheng1993</a>：引用来自“肖国颖”的评论 引用来自“yezheng19... <a href="http://my.oschina.net/action/tweet/go?obj=274481572&amp;type=18&amp;user=1173735" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/noahxiao" target="_blank">@肖国颖</a>：引用来自“yezheng1993”的评论 请问一下怎么在那... <a href="http://my.oschina.net/action/tweet/go?obj=274479348&amp;type=18&amp;user=569848" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/112358" target="_blank">@yezheng1993</a>：请问一下怎么在那边创建文件以及文件夹，新手，还... <a href="http://my.oschina.net/action/tweet/go?obj=274477519&amp;type=18&amp;user=1173735" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/u/151176" target="_blank">@xautlx</a>：Servlet3规范好像已经有标准支持：<a href="https://blogs" target="_blank">https://blogs</a>... <a href="http://my.oschina.net/action/tweet/go?obj=274464191&amp;type=18&amp;user=151176" target="_blank">查看»</a></li>
<li><a href="http://my.oschina.net/u/613918" target="_blank">@ahnan</a>：www.webjars.org <a href="http://my.oschina.net/action/tweet/go?obj=274462857&amp;type=18&amp;user=613918" target="_blank">查看»</a></li>
<li><p><a href="http://my.oschina.net/wj2699" target="_blank">@wj2699</a>：spring的mvc确实有这么个功能，但是如果和apach... <a href="http://my.oschina.net/action/tweet/go?obj=274461745&amp;type=18&amp;user=106294" target="_blank">查看»</a>
<strong>访客统计</strong></p>
</li>
<li><p>今日访问：26</p>
</li>
<li>昨日访问：148</li>
<li>本周访问：389</li>
<li>本月访问：1573</li>
<li>所有访问：52224</li>
</ul>
<p><a href="http://my.oschina.net/noahxiao" target="_blank">空间</a> » <a href="http://my.oschina.net/noahxiao/blog" target="_blank">博客</a> » <a href="http://my.oschina.net/noahxiao/blog?catalog=186739" target="_blank">工作日志</a> » 博客正文</p>
<h1 id="-100-java-windows-wmi-"><img src="" alt=""> 100%纯java调用windows的wmi获取监控数据</h1>
<p><em>23</em>人收藏此文章,  <a href="&quot;添加到收藏夹&quot;">我要收藏</a>   发表于12个月前(2012-08-16 18:17) , 已有<strong>2348</strong>次阅读 ，共<strong><a href="">5</a></strong>个评论</p>
<p>纯java主要体现在可以跨平台调用com。所用的是j-Interop，它是100%纯java实现的com的调用</p>
<h3 id="1-">1、环境准备</h3>
<p>a、windows要开启Remote Registry与Windows Management Instrumentation服务</p>
<p>b、修改安全策略</p>
<p>我系统是英文的，如果是中文系统，翻译为中文，相对应的查找并修改。</p>
<p>Administrative Tools&gt;Local Security Policy&gt;Local Policy&gt;Security Policy&gt;Network access: Sharing and security model for local accounts</p>
<p>修改为Classic（经典）</p>
<p>c、禁用放火墙</p>
<p>d、window2008系统注册表越狱（高版本的win）</p>
<p>需要修改regedit中HKEY_CLASSES_ROOT\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}的权限，windows2008不再给Administrators完全控制权。</p>
<p>下载SetACL.exe，下载地址：<a href="http://files.helgeklein.com/downloads/SetACL/current/SetACL%20(executable%20version).zip" target="_blank">http://files.helgeklein.com/downloads/SetACL/current/SetACL%20(executable%20version).zip</a></p>
<p>set_wmi_reg_acl.cmd</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>1</p>
<p>SetACL.exe -on</p>
<p>&quot;HKEY_CLASSES_ROOT\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}&quot;</p>
<p>-ot reg -actn setowner -ownr</p>
<p>&quot;n:Administrators&quot;</p>
<p>2</p>
<p>SetACL.exe -on</p>
<p>&quot;HKEY_CLASSES_ROOT\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}&quot;</p>
<p>-ot reg -actn ace -ace</p>
<p>&quot;n:Administrators;p:full&quot;</p>
<p>以超级管理员身份执行这个cms，就会把owner与完全控制权限授予Administrators组</p>
<h2 id="-">#</h2>
<h3 id="2-">2、程序代码</h3>
<p>java类</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>001</p>
<p>package</p>
<p>org.noah.wmitest;</p>
<p>002</p>
<p>003</p>
<p>import</p>
<p>org.jinterop.dcom.common.JIException;</p>
<p>004</p>
<p>import</p>
<p>org.jinterop.dcom.common.JISystem;
005</p>
<p>import</p>
<p>org.jinterop.dcom.core./*;</p>
<p>006</p>
<p>import</p>
<p>org.jinterop.dcom.impls.JIObjectFactory;
007</p>
<p>import</p>
<p>org.jinterop.dcom.impls.automation.IJIDispatch;</p>
<p>008</p>
<p>import</p>
<p>org.jinterop.dcom.impls.automation.IJIEnumVariant;
009</p>
<p>import</p>
<p>org.slf4j.Logger;</p>
<p>010</p>
<p>import</p>
<p>org.slf4j.LoggerFactory;
011</p>
<p>012</p>
<p>import</p>
<p>java.net.UnknownHostException;
013</p>
<p>import</p>
<p>java.util.logging.Level;</p>
<p>014</p>
<p>015</p>
<p>//<em>/</em></p>
<p>016</p>
<p>/* Created with IntelliJ IDEA.
017</p>
<p>/* User: noah</p>
<p>018</p>
<p>/* Date: 8/16/12
019</p>
<p>/* Time: 8:00 AM</p>
<p>020</p>
<p>/* To change this template use File | Settings | File Templates.
021</p>
<p>/*/</p>
<p>022</p>
<p>public</p>
<p>class</p>
<p>WmiService {
023</p>
<p>024</p>
<p>private</p>
<p>JIComServer m_ComStub =</p>
<p>null</p>
<p>;
025</p>
<p>private</p>
<p>IJIComObject m_ComObject =</p>
<p>null</p>
<p>;</p>
<p>026</p>
<p>private</p>
<p>IJIDispatch m_Dispatch =</p>
<p>null</p>
<p>;
027</p>
<p>private</p>
<p>String m_Address =</p>
<p>null</p>
<p>;</p>
<p>028</p>
<p>private</p>
<p>JISession m_Session =</p>
<p>null</p>
<p>;
029</p>
<p>private</p>
<p>IJIDispatch m_WbemServices =</p>
<p>null</p>
<p>;</p>
<p>030</p>
<p>031</p>
<p>private</p>
<p>static</p>
<p>final</p>
<p>String WMI_CLSID =</p>
<p>&quot;76A6415B-CB41-11d1-8B02-00600806D9B6&quot;</p>
<p>;</p>
<p>032</p>
<p>private</p>
<p>static</p>
<p>final</p>
<p>String WMI_PROGID =</p>
<p>&quot;WbemScripting.SWbemLocator&quot;</p>
<p>;
033</p>
<p>034</p>
<p>private</p>
<p>Logger logger = LoggerFactory.getLogger(</p>
<p>this</p>
<p>.getClass());
035</p>
<p>036</p>
<p>037</p>
<p>public</p>
<p>WmiService(String address) {</p>
<p>038</p>
<p>JISystem.setAutoRegisteration(</p>
<p>true</p>
<p>);
039</p>
<p>JISystem.getLogger().setLevel(Level.WARNING);</p>
<p>040</p>
<p>m_Address = address;
041</p>
<p>}</p>
<p>042</p>
<p>043</p>
<p>public</p>
<p>void</p>
<p>query(String strQuery) {</p>
<p>044</p>
<p>045</p>
<p>System.out.println(</p>
<p>&quot;query:&quot;</p>
<ul>
<li>strQuery);</li>
</ul>
<p>046</p>
<p>047</p>
<p>JIVariant results[] =</p>
<p>new</p>
<p>JIVariant[</p>
<p>0</p>
<p>];</p>
<p>048</p>
<p>try</p>
<p>{
049</p>
<p>results = m_WbemServices.callMethodA(</p>
<p>&quot;ExecQuery&quot;</p>
<p>,</p>
<p>new</p>
<p>Object[]{</p>
<p>new</p>
<p>JIString(strQuery), JIVariant.OPTIONAL_PARAM(), JIVariant.OPTIONAL_PARAM(), JIVariant.OPTIONAL_PARAM()});</p>
<p>050</p>
<p>IJIDispatch wOSd = (IJIDispatch) JIObjectFactory.narrowObject((results[</p>
<p>0</p>
<p>]).getObjectAsComObject());
051</p>
<p>052</p>
<p>int</p>
<p>count = wOSd.get(</p>
<p>&quot;Count&quot;</p>
<p>).getObjectAsInt();
053</p>
<p>054</p>
<p>IJIComObject enumComObject = wOSd.get(</p>
<p>&quot;_NewEnum&quot;</p>
<p>).getObjectAsComObject();
055</p>
<p>IJIEnumVariant enumVariant = (IJIEnumVariant) JIObjectFactory.narrowObject(enumComObject.queryInterface(IJIEnumVariant.IID));</p>
<p>056</p>
<p>057</p>
<p>IJIDispatch wbemObject_dispatch =</p>
<p>null</p>
<p>;</p>
<p>058</p>
<p>059</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>c =</p>
<p>0</p>
<p>; c &lt; count; c++) {</p>
<p>060</p>
<p>061</p>
<p>Object[] values = enumVariant.next(</p>
<p>1</p>
<p>);</p>
<p>062</p>
<p>JIArray array = (JIArray) values[</p>
<p>0</p>
<p>];
063</p>
<p>Object[] arrayObj = (Object[]) array.getArrayInstance();</p>
<p>064</p>
<p>for</p>
<p>(</p>
<p>int</p>
<p>j =</p>
<p>0</p>
<p>; j &lt; arrayObj.length; j++) {
065</p>
<p>wbemObject_dispatch = (IJIDispatch) JIObjectFactory.narrowObject(((JIVariant) arrayObj[j]).getObjectAsComObject());</p>
<p>066</p>
<p>}
067</p>
<p>068</p>
<p>String str = (wbemObject_dispatch.callMethodA(</p>
<p>&quot;GetObjectText_&quot;</p>
<p>,</p>
<p>new</p>
<p>Object[]{</p>
<p>1</p>
<p>}))[</p>
<p>0</p>
<p>].getObjectAsString2();
069</p>
<p>System.out.println(</p>
<p>&quot;(&quot;</p>
<ul>
<li>c +</li>
</ul>
<p>&quot;):&quot;</p>
<p>);</p>
<p>070</p>
<p>System.out.println(str);
071</p>
<p>System.out.println();</p>
<p>072</p>
<p>}
073</p>
<p>074</p>
<p>075</p>
<p>}</p>
<p>catch</p>
<p>(JIException e) {</p>
<p>076</p>
<p>e.printStackTrace();
077</p>
<p>}</p>
<p>078</p>
<p>}
079</p>
<p>080</p>
<p>public</p>
<p>void</p>
<p>connect(</p>
<p>final</p>
<p>String domain,</p>
<p>final</p>
<p>String username,</p>
<p>final</p>
<p>String password) {
081</p>
<p>try</p>
<p>{</p>
<p>082</p>
<p>083</p>
<p>m_Session = JISession.createSession(domain, username, password);</p>
<p>084</p>
<p>m_Session.useSessionSecurity(</p>
<p>true</p>
<p>);
085</p>
<p>m_Session.setGlobalSocketTimeout(</p>
<p>5000</p>
<p>);</p>
<p>086</p>
<p>087</p>
<p>m_ComStub =</p>
<p>new</p>
<p>JIComServer(JIProgId.valueOf(WMI_PROGID), m_Address, m_Session);</p>
<p>088</p>
<p>089</p>
<p>IJIComObject unknown = m_ComStub.createInstance();</p>
<p>090</p>
<p>m_ComObject = unknown.queryInterface(WMI_CLSID);
091</p>
<p>092</p>
<p>m_Dispatch = (IJIDispatch) JIObjectFactory.narrowObject(m_ComObject.queryInterface(IJIDispatch.IID));
093</p>
<p>JIVariant results[] = m_Dispatch.callMethodA(</p>
<p>094</p>
<p>&quot;ConnectServer&quot;</p>
<p>,
095</p>
<p>new</p>
<p>Object[]{</p>
<p>096</p>
<p>new</p>
<p>JIString(m_Address),
097</p>
<p>JIVariant.OPTIONAL_PARAM(),</p>
<p>098</p>
<p>JIVariant.OPTIONAL_PARAM(),
099</p>
<p>JIVariant.OPTIONAL_PARAM(),</p>
<p>100</p>
<p>JIVariant.OPTIONAL_PARAM(),
101</p>
<p>JIVariant.OPTIONAL_PARAM(),</p>
<p>102</p>
<p>0</p>
<p>,
103</p>
<p>JIVariant.OPTIONAL_PARAM()</p>
<p>104</p>
<p>}
105</p>
<p>);</p>
<p>106</p>
<p>107</p>
<p>m_WbemServices = (IJIDispatch) JIObjectFactory.narrowObject((results[</p>
<p>0</p>
<p>]).getObjectAsComObject());</p>
<p>108</p>
<p>109</p>
<p>}</p>
<p>catch</p>
<p>(JIException e) {</p>
<p>110</p>
<p>e.printStackTrace();
111</p>
<p>if</p>
<p>(m_Session !=</p>
<p>null</p>
<p>) {</p>
<p>112</p>
<p>try</p>
<p>{
113</p>
<p>JISession.destroySession(m_Session);</p>
<p>114</p>
<p>}</p>
<p>catch</p>
<p>(JIException e1) {
115</p>
<p>logger.error(e.getMessage(), e);</p>
<p>116</p>
<p>}
117</p>
<p>}</p>
<p>118</p>
<p>}</p>
<p>catch</p>
<p>(UnknownHostException e) {
119</p>
<p>if</p>
<p>(m_Session !=</p>
<p>null</p>
<p>) {</p>
<p>120</p>
<p>try</p>
<p>{
121</p>
<p>JISession.destroySession(m_Session);</p>
<p>122</p>
<p>}</p>
<p>catch</p>
<p>(JIException e1) {
123</p>
<p>logger.error(e.getMessage(), e);</p>
<p>124</p>
<p>}
125</p>
<p>}</p>
<p>126</p>
<p>}
127</p>
<p>}</p>
<p>128</p>
<p>129</p>
<p>public</p>
<p>void</p>
<p>disconnect() {</p>
<p>130</p>
<p>try</p>
<p>{
131</p>
<p>JISession.destroySession(m_Session);</p>
<p>132</p>
<p>}</p>
<p>catch</p>
<p>(JIException e) {
133</p>
<p>logger.error(e.getMessage(), e);</p>
<p>134</p>
<p>}
135</p>
<p>}</p>
<p>136</p>
<p>137</p>
<p>138</p>
<p>public</p>
<p>static</p>
<p>void</p>
<p>main(String[] args) {
139</p>
<p>140</p>
<p>WmiService wmiService =</p>
<p>new</p>
<p>WmiService(</p>
<p>&quot;172.16.158.129&quot;</p>
<p>);
141</p>
<p>142</p>
<p>//域（一般为空字符），用户名，密码
143</p>
<p>wmiService.connect(</p>
<p>&quot;&quot;</p>
<p>,</p>
<p>&quot;username&quot;</p>
<p>,</p>
<p>&quot;password&quot;</p>
<p>);</p>
<p>144</p>
<p>145</p>
<p>//系统信息</p>
<p>146</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_ComputerSystem&quot;</p>
<p>);
147</p>
<p>148</p>
<p>//CPU信息
149</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_PerfFormattedData_PerfOS_Processor WHERE Name != &#39;_Total&#39;&quot;</p>
<p>);</p>
<p>150</p>
<p>151</p>
<p>//内存信息</p>
<p>152</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_PerfFormattedData_PerfOS_Memory&quot;</p>
<p>);
153</p>
<p>154</p>
<p>//磁盘信息
155</p>
<p>wmiService.query(</p>
<p>&quot;SELECT /* FROM Win32_PerfRawData_PerfDisk_PhysicalDisk Where Name != &#39;_Total&#39;&quot;</p>
<p>);</p>
<p>156</p>
<p>157</p>
<p>wmiService.disconnect();</p>
<p>158</p>
<p>}
159</p>
<p>}</p>
<p>mavne配置(pom.xml)
<a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>01</p>
<p>&lt;?</p>
<p>xml</p>
<p>version</p>
<p>=</p>
<p>&quot;1.0&quot;</p>
<p>encoding</p>
<p>=</p>
<p>&quot;UTF-8&quot;</p>
<p>?&gt;</p>
<p>02</p>
<p>&lt;</p>
<p>project</p>
<p>xmlns</p>
<p>=</p>
<p>&quot;<a href="http://maven.apache.org/POM/4.0.0" target="_blank">http://maven.apache.org/POM/4.0.0</a>&quot;
03</p>
<p>xmlns:xsi</p>
<p>=</p>
<p>&quot;<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>&quot;</p>
<p>04</p>
<p>xsi:schemaLocation</p>
<p>=</p>
<p>&quot;<a href="http://maven.apache.org/POM/4.0.0" target="_blank">http://maven.apache.org/POM/4.0.0</a> <a href="http://maven.apache.org/xsd/maven-4.0.0.xsd" target="_blank">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>&quot;</p>
<p>&gt;
05</p>
<p>&lt;</p>
<p>modelVersion</p>
<blockquote>
<p>4.0.0&lt;/</p>
</blockquote>
<p>modelVersion</p>
<p>&gt;</p>
<p>06</p>
<p>07</p>
<p>&lt;</p>
<p>groupId</p>
<blockquote>
<p>org.noahx&lt;/</p>
</blockquote>
<p>groupId</p>
<p>&gt;</p>
<p>08</p>
<p>&lt;</p>
<p>artifactId</p>
<blockquote>
<p>wmi-test&lt;/</p>
</blockquote>
<p>artifactId</p>
<p>&gt;
09</p>
<p>&lt;</p>
<p>version</p>
<blockquote>
<p>1.0&lt;/</p>
</blockquote>
<p>version</p>
<p>&gt;</p>
<p>10</p>
<p>11</p>
<p>12</p>
<p>&lt;</p>
<p>dependencies</p>
<p>&gt;
13</p>
<p>14</p>
<p>&lt;</p>
<p>dependency</p>
<p>&gt;
15</p>
<p>&lt;</p>
<p>groupId</p>
<blockquote>
<p>org.kohsuke.jinterop&lt;/</p>
</blockquote>
<p>groupId</p>
<p>&gt;</p>
<p>16</p>
<p>&lt;</p>
<p>artifactId</p>
<blockquote>
<p>j-interop&lt;/</p>
</blockquote>
<p>artifactId</p>
<p>&gt;
17</p>
<p>&lt;</p>
<p>version</p>
<blockquote>
<p>2.0.8-kohsuke-1&lt;/</p>
</blockquote>
<p>version</p>
<p>&gt;</p>
<p>18</p>
<p>&lt;/</p>
<p>dependency</p>
<p>&gt;
19</p>
<p>20</p>
<p>&lt;</p>
<p>dependency</p>
<p>&gt;
21</p>
<p>&lt;</p>
<p>groupId</p>
<blockquote>
<p>org.slf4j&lt;/</p>
</blockquote>
<p>groupId</p>
<p>&gt;</p>
<p>22</p>
<p>&lt;</p>
<p>artifactId</p>
<blockquote>
<p>slf4j-log4j12&lt;/</p>
</blockquote>
<p>artifactId</p>
<p>&gt;
23</p>
<p>&lt;</p>
<p>version</p>
<blockquote>
<p>1.6.4&lt;/</p>
</blockquote>
<p>version</p>
<p>&gt;</p>
<p>24</p>
<p>&lt;/</p>
<p>dependency</p>
<p>&gt;
25</p>
<p>26</p>
<p>&lt;/</p>
<p>dependencies</p>
<p>&gt;
27</p>
<p>28</p>
<p>&lt;/</p>
<p>project</p>
<p>&gt;</p>
<p>运行结果</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>001</p>
<p>query:SELECT /* FROM Win32_ComputerSystem</p>
<p>002</p>
<p>(0):
003</p>
<p>004</p>
<p>instance of Win32_ComputerSystem
005</p>
<p>{</p>
<p>006</p>
<p>AdminPasswordStatus = 1;
007</p>
<p>AutomaticResetBootOption = FALSE;</p>
<p>008</p>
<p>AutomaticResetCapability = TRUE;
009</p>
<p>BootOptionOnLimit = 3;</p>
<p>010</p>
<p>BootOptionOnWatchDog = 3;
011</p>
<p>BootROMSupported = TRUE;</p>
<p>012</p>
<p>BootupState =</p>
<p>&quot;Normal boot&quot;</p>
<p>;
013</p>
<p>Caption =</p>
<p>&quot;NAK-E1A7C21EA3C&quot;</p>
<p>;</p>
<p>014</p>
<p>ChassisBootupState = 3;
015</p>
<p>CreationClassName =</p>
<p>&quot;Win32_ComputerSystem&quot;</p>
<p>;</p>
<p>016</p>
<p>CurrentTimeZone = 480;
017</p>
<p>Description =</p>
<p>&quot;AT/AT COMPATIBLE&quot;</p>
<p>;</p>
<p>018</p>
<p>Domain =</p>
<p>&quot;WORKGROUP&quot;</p>
<p>;
019</p>
<p>DomainRole = 0;</p>
<p>020</p>
<p>EnableDaylightSavingsTime = TRUE;
021</p>
<p>FrontPanelResetStatus = 3;</p>
<p>022</p>
<p>InfraredSupported = FALSE;
023</p>
<p>KeyboardPasswordStatus = 3;</p>
<p>024</p>
<p>Manufacturer =</p>
<p>&quot;VMware, Inc.&quot;</p>
<p>;
025</p>
<p>Model =</p>
<p>&quot;VMware Virtual Platform&quot;</p>
<p>;</p>
<p>026</p>
<p>Name =</p>
<p>&quot;NAK-E1A7C21EA3C&quot;</p>
<p>;
027</p>
<p>NetworkServerModeEnabled = TRUE;</p>
<p>028</p>
<p>NumberOfLogicalProcessors = 2;
029</p>
<p>NumberOfProcessors = 1;</p>
<p>030</p>
<p>OEMStringArray = {</p>
<p>&quot;[MS_VM_CERT/SHA1/27d66596a61c48dd3dc7216fd715126e33f59ae7]&quot;</p>
<p>,</p>
<p>&quot;Welcome to the Virtual Machine&quot;</p>
<p>};
031</p>
<p>PartOfDomain = FALSE;</p>
<p>032</p>
<p>PauseAfterReset =</p>
<p>&quot;3932100000&quot;</p>
<p>;
033</p>
<p>PowerOnPasswordStatus = 0;</p>
<p>034</p>
<p>PowerState = 0;
035</p>
<p>PowerSupplyState = 3;</p>
<p>036</p>
<p>PrimaryOwnerName =</p>
<p>&quot;nak&quot;</p>
<p>;
037</p>
<p>ResetCapability = 1;</p>
<p>038</p>
<p>ResetCount = -1;
039</p>
<p>ResetLimit = -1;</p>
<p>040</p>
<p>Roles = {</p>
<p>&quot;LM_Workstation&quot;</p>
<p>,</p>
<p>&quot;LM_Server&quot;</p>
<p>,</p>
<p>&quot;NT&quot;</p>
<p>,</p>
<p>&quot;Potential_Browser&quot;</p>
<p>,</p>
<p>&quot;Master_Browser&quot;</p>
<p>};
041</p>
<p>Status =</p>
<p>&quot;OK&quot;</p>
<p>;</p>
<p>042</p>
<p>SystemStartupDelay = 0;
043</p>
<p>SystemStartupOptions = {</p>
<p>&quot;\&quot;Microsoft Windows XP Professional\&quot; /noexecute=optin /fastdetect&quot;</p>
<p>};</p>
<p>044</p>
<p>SystemStartupSetting = 0;
045</p>
<p>SystemType =</p>
<p>&quot;X86-based PC&quot;</p>
<p>;</p>
<p>046</p>
<p>ThermalState = 3;
047</p>
<p>TotalPhysicalMemory =</p>
<p>&quot;1610063872&quot;</p>
<p>;</p>
<p>048</p>
<p>UserName =</p>
<p>&quot;NAK-E1A7C21EA3C\a&quot;</p>
<p>;
049</p>
<p>WakeUpType = 6;</p>
<p>050</p>
<p>};
051</p>
<p>052</p>
<p>053</p>
<p>query:SELECT /* FROM Win32_PerfFormattedData_PerfOS_Processor WHERE Name !=</p>
<p>&#39;_Total&#39;</p>
<p>054</p>
<p>(0):
055</p>
<p>056</p>
<p>instance of Win32_PerfFormattedData_PerfOS_Processor
057</p>
<p>{</p>
<p>058</p>
<p>C1TransitionsPersec =</p>
<p>&quot;77&quot;</p>
<p>;
059</p>
<p>C2TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>060</p>
<p>C3TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;
061</p>
<p>DPCRate = 0;</p>
<p>062</p>
<p>DPCsQueuedPersec = 4;
063</p>
<p>InterruptsPersec = 71;</p>
<p>064</p>
<p>Name =</p>
<p>&quot;0&quot;</p>
<p>;
065</p>
<p>PercentC1Time =</p>
<p>&quot;96&quot;</p>
<p>;</p>
<p>066</p>
<p>PercentC2Time =</p>
<p>&quot;0&quot;</p>
<p>;
067</p>
<p>PercentC3Time =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>068</p>
<p>PercentDPCTime =</p>
<p>&quot;0&quot;</p>
<p>;
069</p>
<p>PercentIdleTime =</p>
<p>&quot;100&quot;</p>
<p>;</p>
<p>070</p>
<p>PercentInterruptTime =</p>
<p>&quot;0&quot;</p>
<p>;
071</p>
<p>PercentPrivilegedTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>072</p>
<p>PercentProcessorTime =</p>
<p>&quot;0&quot;</p>
<p>;
073</p>
<p>PercentUserTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>074</p>
<p>};
075</p>
<p>076</p>
<p>077</p>
<p>(1):</p>
<p>078</p>
<p>079</p>
<p>instance of Win32_PerfFormattedData_PerfOS_Processor</p>
<p>080</p>
<p>{
081</p>
<p>C1TransitionsPersec =</p>
<p>&quot;83&quot;</p>
<p>;</p>
<p>082</p>
<p>C2TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;
083</p>
<p>C3TransitionsPersec =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>084</p>
<p>DPCRate = 0;
085</p>
<p>DPCsQueuedPersec = 10;</p>
<p>086</p>
<p>InterruptsPersec = 67;
087</p>
<p>Name =</p>
<p>&quot;1&quot;</p>
<p>;</p>
<p>088</p>
<p>PercentC1Time =</p>
<p>&quot;96&quot;</p>
<p>;
089</p>
<p>PercentC2Time =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>090</p>
<p>PercentC3Time =</p>
<p>&quot;0&quot;</p>
<p>;
091</p>
<p>PercentDPCTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>092</p>
<p>PercentIdleTime =</p>
<p>&quot;100&quot;</p>
<p>;
093</p>
<p>PercentInterruptTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>094</p>
<p>PercentPrivilegedTime =</p>
<p>&quot;0&quot;</p>
<p>;
095</p>
<p>PercentProcessorTime =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>096</p>
<p>PercentUserTime =</p>
<p>&quot;0&quot;</p>
<p>;
097</p>
<p>};</p>
<p>098</p>
<p>099</p>
<p>100</p>
<p>query:SELECT /* FROM Win32_PerfFormattedData_PerfOS_Memory
101</p>
<p>(0):</p>
<p>102</p>
<p>103</p>
<p>instance of Win32_PerfFormattedData_PerfOS_Memory</p>
<p>104</p>
<p>{
105</p>
<p>AvailableBytes =</p>
<p>&quot;1142099968&quot;</p>
<p>;</p>
<p>106</p>
<p>AvailableKBytes =</p>
<p>&quot;1115332&quot;</p>
<p>;
107</p>
<p>AvailableMBytes =</p>
<p>&quot;1089&quot;</p>
<p>;</p>
<p>108</p>
<p>CacheBytes =</p>
<p>&quot;70725632&quot;</p>
<p>;
109</p>
<p>CacheBytesPeak =</p>
<p>&quot;72904704&quot;</p>
<p>;</p>
<p>110</p>
<p>CacheFaultsPersec = 634;
111</p>
<p>CommitLimit =</p>
<p>&quot;3063078912&quot;</p>
<p>;</p>
<p>112</p>
<p>CommittedBytes =</p>
<p>&quot;326488064&quot;</p>
<p>;
113</p>
<p>DemandZeroFaultsPersec = 13965;</p>
<p>114</p>
<p>FreeSystemPageTableEntries = 159743;
115</p>
<p>PageFaultsPersec = 13965;</p>
<p>116</p>
<p>PageReadsPersec = 0;
117</p>
<p>PagesInputPersec = 0;</p>
<p>118</p>
<p>PagesOutputPersec = 0;
119</p>
<p>PagesPersec = 0;</p>
<p>120</p>
<p>PageWritesPersec = 0;
121</p>
<p>PercentCommittedBytesInUse = 10;</p>
<p>122</p>
<p>PoolNonpagedAllocs = 38040;
123</p>
<p>PoolNonpagedBytes =</p>
<p>&quot;7585792&quot;</p>
<p>;</p>
<p>124</p>
<p>PoolPagedAllocs = 57820;
125</p>
<p>PoolPagedBytes =</p>
<p>&quot;29380608&quot;</p>
<p>;</p>
<p>126</p>
<p>PoolPagedResidentBytes =</p>
<p>&quot;28622848&quot;</p>
<p>;
127</p>
<p>SystemCacheResidentBytes =</p>
<p>&quot;40235008&quot;</p>
<p>;</p>
<p>128</p>
<p>SystemCodeResidentBytes =</p>
<p>&quot;1867776&quot;</p>
<p>;
129</p>
<p>SystemCodeTotalBytes =</p>
<p>&quot;1167360&quot;</p>
<p>;</p>
<p>130</p>
<p>SystemDriverResidentBytes =</p>
<p>&quot;0&quot;</p>
<p>;
131</p>
<p>SystemDriverTotalBytes =</p>
<p>&quot;4071424&quot;</p>
<p>;</p>
<p>132</p>
<p>TransitionFaultsPersec = 0;
133</p>
<p>WriteCopiesPersec = 0;</p>
<p>134</p>
<p>};
135</p>
<p>136</p>
<p>137</p>
<p>query:SELECT /* FROM Win32_PerfRawData_PerfDisk_PhysicalDisk Where Name !=</p>
<p>&#39;_Total&#39;</p>
<p>138</p>
<p>(0):
139</p>
<p>140</p>
<p>instance of Win32_PerfRawData_PerfDisk_PhysicalDisk
141</p>
<p>{</p>
<p>142</p>
<p>AvgDiskBytesPerRead =</p>
<p>&quot;138920448&quot;</p>
<p>;
143</p>
<p>AvgDiskBytesPerRead_Base = 8000;</p>
<p>144</p>
<p>AvgDiskBytesPerTransfer =</p>
<p>&quot;208285696&quot;</p>
<p>;
145</p>
<p>AvgDiskBytesPerTransfer_Base = 13701;</p>
<p>146</p>
<p>AvgDiskBytesPerWrite =</p>
<p>&quot;69365248&quot;</p>
<p>;
147</p>
<p>AvgDiskBytesPerWrite_Base = 5701;</p>
<p>148</p>
<p>AvgDiskQueueLength =</p>
<p>&quot;581460650&quot;</p>
<p>;
149</p>
<p>AvgDiskReadQueueLength =</p>
<p>&quot;405581626&quot;</p>
<p>;</p>
<p>150</p>
<p>AvgDisksecPerRead = 2794786622;
151</p>
<p>AvgDisksecPerRead_Base = 8000;</p>
<p>152</p>
<p>AvgDisksecPerTransfer = 322083534;
153</p>
<p>AvgDisksecPerTransfer_Base = 13701;</p>
<p>154</p>
<p>AvgDisksecPerWrite = 1822264208;
155</p>
<p>AvgDisksecPerWrite_Base = 5701;</p>
<p>156</p>
<p>AvgDiskWriteQueueLength =</p>
<p>&quot;175879024&quot;</p>
<p>;
157</p>
<p>CurrentDiskQueueLength = 0;</p>
<p>158</p>
<p>DiskBytesPersec =</p>
<p>&quot;208285696&quot;</p>
<p>;
159</p>
<p>DiskReadBytesPersec =</p>
<p>&quot;138920448&quot;</p>
<p>;</p>
<p>160</p>
<p>DiskReadsPersec = 8000;
161</p>
<p>DiskTransfersPersec = 13701;</p>
<p>162</p>
<p>DiskWriteBytesPersec =</p>
<p>&quot;69365248&quot;</p>
<p>;
163</p>
<p>DiskWritesPersec = 5701;</p>
<p>164</p>
<p>Frequency_Object =</p>
<p>&quot;0&quot;</p>
<p>;
165</p>
<p>Frequency_PerfTime =</p>
<p>&quot;3034010000&quot;</p>
<p>;</p>
<p>166</p>
<p>Frequency_Sys100NS =</p>
<p>&quot;10000000&quot;</p>
<p>;
167</p>
<p>Name =</p>
<p>&quot;0 C:&quot;</p>
<p>;</p>
<p>168</p>
<p>PercentDiskReadTime =</p>
<p>&quot;405581626&quot;</p>
<p>;
169</p>
<p>PercentDiskReadTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>170</p>
<p>PercentDiskTime =</p>
<p>&quot;581460650&quot;</p>
<p>;
171</p>
<p>PercentDiskTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>172</p>
<p>PercentDiskWriteTime =</p>
<p>&quot;175879024&quot;</p>
<p>;
173</p>
<p>PercentDiskWriteTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>174</p>
<p>PercentIdleTime =</p>
<p>&quot;18446744072967667781&quot;</p>
<p>;
175</p>
<p>PercentIdleTime_Base =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>176</p>
<p>SplitIOPerSec = 1074;
177</p>
<p>Timestamp_Object =</p>
<p>&quot;0&quot;</p>
<p>;</p>
<p>178</p>
<p>Timestamp_PerfTime =</p>
<p>&quot;3635534093651&quot;</p>
<p>;
179</p>
<p>Timestamp_Sys100NS =</p>
<p>&quot;129895856572522792&quot;</p>
<p>;</p>
<p>180</p>
<p>};&lt;span style=</p>
<p>&quot;font-family:&#39;sans serif, tahoma, verdana, helvetica&#39;;font-size:x-small;&quot;</p>
<blockquote>
<p>&lt;span style=</p>
</blockquote>
<p>&quot;line-height:18.18181800842285px;white-space:normal;&quot;</p>
<blockquote>
<p></span></span></p>
</blockquote>
<h2 id="-">#</h2>
<h3 id="3-">3、有可能出现的问题</h3>
<p>报错a</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>01</p>
<p>org.jinterop.dcom.common.JIException: Message not found</p>
<p>for</p>
<p>errorCode:</p>
<p>0xC0000034</p>
<p>02</p>
<p>at org.jinterop.winreg.smb.JIWinRegStub.winreg_OpenHKLM(JIWinRegStub.java:</p>
<p>115</p>
<p>)
03</p>
<p>at org.jinterop.dcom.core.JIProgId.getIdFromWinReg(JIProgId.java:</p>
<p>130</p>
<p>)</p>
<p>04</p>
<p>at org.jinterop.dcom.core.JIProgId.getCorrespondingCLSID(JIProgId.java:</p>
<p>162</p>
<p>)
05</p>
<p>at org.jinterop.dcom.core.JIComServer.<init>(JIComServer.java:</p>
<p>413</p>
<p>)</p>
<p>06</p>
<p>at org.noah.wmitest.WmiService.connect(WmiService.java:</p>
<p>122</p>
<p>)
07</p>
<p>at org.noah.wmitest.WmiService.main(WmiService.java:</p>
<p>177</p>
<p>)</p>
<p>08</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
09</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</p>
<p>39</p>
<p>)</p>
<p>10</p>
<p>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</p>
<p>25</p>
<p>)
11</p>
<p>at java.lang.reflect.Method.invoke(Method.java:</p>
<p>597</p>
<p>)</p>
<p>12</p>
<p>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:</p>
<p>120</p>
<p>)
13</p>
<p>Caused by: jcifs.smb.SmbException: The system cannot find the file specified.</p>
<p>14</p>
<p>at jcifs.smb.SmbTransport.checkStatus(SmbTransport.java:</p>
<p>522</p>
<p>)
15</p>
<p>at jcifs.smb.SmbTransport.send(SmbTransport.java:</p>
<p>622</p>
<p>)</p>
<p>16</p>
<p>at jcifs.smb.SmbSession.send(SmbSession.java:</p>
<p>239</p>
<p>)
17</p>
<p>at jcifs.smb.SmbTree.send(SmbTree.java:</p>
<p>109</p>
<p>)</p>
<p>18</p>
<p>at jcifs.smb.SmbFile.send(SmbFile.java:</p>
<p>718</p>
<p>)
19</p>
<p>at jcifs.smb.SmbFile.open0(SmbFile.java:</p>
<p>923</p>
<p>)</p>
<p>20</p>
<p>at jcifs.smb.SmbFile.open(SmbFile.java:</p>
<p>940</p>
<p>)
21</p>
<p>at jcifs.smb.SmbFileOutputStream.<init>(SmbFileOutputStream.java:</p>
<p>142</p>
<p>)</p>
<p>22</p>
<p>at jcifs.smb.TransactNamedPipeOutputStream.<init>(TransactNamedPipeOutputStream.java:</p>
<p>32</p>
<p>)
23</p>
<p>at jcifs.smb.SmbNamedPipe.getNamedPipeOutputStream(SmbNamedPipe.java:</p>
<p>187</p>
<p>)</p>
<p>24</p>
<p>at rpc.ncacn_np.RpcTransport.attach(RpcTransport.java:</p>
<p>92</p>
<p>)
25</p>
<p>at rpc.Stub.attach(Stub.java:</p>
<p>105</p>
<p>)</p>
<p>26</p>
<p>at rpc.Stub.call(Stub.java:</p>
<p>110</p>
<p>)
27</p>
<p>at org.jinterop.winreg.smb.JIWinRegStub.winreg_OpenHKLM(JIWinRegStub.java:</p>
<p>113</p>
<p>)</p>
<p>28</p>
<p>...</p>
<p>10</p>
<p>more</p>
<p>需要开启Remote Registry服务
报错b</p>
<p><a href="&quot;view source&quot;">view source</a><a href="&quot;print&quot;">print</a><a href="&quot;?&quot;">?</a></p>
<p>01</p>
<p>org.jinterop.dcom.common.JIException: Message not found</p>
<p>for</p>
<p>errorCode:</p>
<p>0xC0000001</p>
<p>02</p>
<p>at org.jinterop.winreg.smb.JIWinRegStub.winreg_OpenHKLM(JIWinRegStub.java:</p>
<p>115</p>
<p>)
03</p>
<p>at org.jinterop.dcom.core.JIProgId.getIdFromWinReg(JIProgId.java:</p>
<p>130</p>
<p>)</p>
<p>04</p>
<p>at org.jinterop.dcom.core.JIProgId.getCorrespondingCLSID(JIProgId.java:</p>
<p>162</p>
<p>)
05</p>
<p>at org.jinterop.dcom.core.JIComServer.<init>(JIComServer.java:</p>
<p>413</p>
<p>)</p>
<p>06</p>
<p>at org.noah.wmitest.WmiService.connect(WmiService.java:</p>
<p>87</p>
<p>)
07</p>
<p>at org.noah.wmitest.WmiService.main(WmiService.java:</p>
<p>142</p>
<p>)</p>
<p>08</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
09</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</p>
<p>39</p>
<p>)</p>
<p>10</p>
<p>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</p>
<p>25</p>
<p>)
11</p>
<p>at java.lang.reflect.Method.invoke(Method.java:</p>
<p>597</p>
<p>)</p>
<p>12</p>
<p>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:</p>
<p>120</p>
<p>)
13</p>
<p>Caused by: jcifs.smb.SmbException: Connection timeout</p>
<p>14</p>
<p>jcifs.util.transport.TransportException: Connection timeout
15</p>
<p>16</p>
<p>或
17</p>
<p>18</p>
<p>org.jinterop.dcom.common.JIException: Message not found</p>
<p>for</p>
<p>errorCode:</p>
<p>0x8001FFFF
19</p>
<p>at org.jinterop.dcom.core.JIComServer.init(JIComServer.java:</p>
<p>576</p>
<p>)</p>
<p>20</p>
<p>at org.jinterop.dcom.core.JIComServer.initialise(JIComServer.java:</p>
<p>481</p>
<p>)
21</p>
<p>at org.jinterop.dcom.core.JIComServer.<init>(JIComServer.java:</p>
<p>414</p>
<p>)</p>
<p>22</p>
<p>at org.noah.wmitest.WmiService.connect(WmiService.java:</p>
<p>87</p>
<p>)
23</p>
<p>at org.noah.wmitest.WmiService.main(WmiService.java:</p>
<p>142</p>
<p>)</p>
<p>24</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
25</p>
<p>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</p>
<p>39</p>
<p>)</p>
<p>26</p>
<p>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</p>
<p>25</p>
<p>)
27</p>
<p>at java.lang.reflect.Method.invoke(Method.java:</p>
<p>597</p>
<p>)</p>
<p>28</p>
<p>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:</p>
<p>120</p>
<p>)
29</p>
<p>Caused by: java.net.ConnectException: Connection timed out</p>
<p>需要禁用放火墙</p>
<h3 id="4-">4、总结</h3>
<p>j-Interop纯java跨平台，我就是linux系统。</p>
<p>用j-Interop就可以很方便的调用windows系统com，虽然这里只演示了WMI。
如果关心WMI与监控的话，建议去opennms-wmi看一看，他们有更好api封装（底层也是j-Interop）。
<strong>关键字：</strong> <a href="http://www.oschina.net/search?scope=blog&amp;q=wmi" target="_blank">wmi</a> <a href="http://www.oschina.net/search?scope=blog&amp;q=windows" target="_blank">windows</a> <a href="http://www.oschina.net/search?scope=blog&amp;q=j-interop" target="_blank">j-interop</a></p>
<p>声明：OSCHINA 博客文章版权属于作者，受法律保护。未经作者同意不得转载。</p>
<ul>
<li><a href="http://my.oschina.net/noahxiao/blog/72861" title="上一篇：既爱又恨的VA-API(Ubuntu视频加速)" target="_blank">« 既爱又恨的VA-API(Ubuntu视频加速)</a></li>
<li><a href="http://my.oschina.net/noahxiao/blog/75463" title="下一篇：通过javamelody监控web应用的性能指标" target="_blank">通过javamelody监控web应用的性能指标 »</a></li>
</ul>
<p>开源中国-程序员在线工具：<a href="http://www.ostools.net/apidocs" target="_blank">API文档大全(120+)</a> <a href="http://runjs.cn/" target="_blank">JS在线编辑演示</a> <a href="http://www.ostools.net/qr" target="_blank">二维码</a> <a href="http://www.ostools.net/" target="_blank">更多&gt;&gt;</a>
<strong>分享到：</strong> <a href="&quot;分享到新浪微博&quot;"></a> <a href="&quot;分享到腾讯微博&quot;"></a>  <a href="">顶</a>已有 <em>0</em>人顶</p>
<h2 id="-5-"><a href=""></a>共有 5 条网友评论</h2>
<ul>
<li><a href="http://my.oschina.net/u/657242" target="_blank"><img src="&quot;leehark&quot;" alt="leehark"></a> 1楼：<a href="http://my.oschina.net/u/657242" target="_blank">leehark</a>(Android) 发表于 2012-08-18 19:35 <a href="">回复此评论</a></li>
</ul>
<p>能通过代码禁止防火墙么？是都要管理员权限？</p>
<ul>
<li><a href="http://my.oschina.net/mingyuejingque" target="_blank"><img src="&quot;明月惊鹊&quot;" alt="明月惊鹊"></a> 2楼：<a href="http://my.oschina.net/mingyuejingque" target="_blank">明月惊鹊</a> 发表于 2012-08-19 14:40 <a href="">回复此评论</a></li>
</ul>
<p>WMI里应该就有控制防火墙的。这种操作肯定需要管理员权限了。</p>
<ul>
<li><a href="http://my.oschina.net/u/124197" target="_blank"><img src="&quot;黄金比&quot;" alt="黄金比"></a> 3楼：<a href="http://my.oschina.net/u/124197" target="_blank">黄金比</a>(iPhone) 发表于 2012-08-21 07:06 <a href="">回复此评论</a></li>
</ul>
<p>不知道远程调用行不行呢?请博主明确一下。</p>
<ul>
<li><a href="http://my.oschina.net/noahxiao" target="_blank"><img src="&quot;肖国颖&quot;" alt="肖国颖"></a> 4楼：<a href="http://my.oschina.net/noahxiao" target="_blank">肖国颖</a>(iPhone) 发表于 2012-08-21 08:23 <a href="">回复此评论</a></li>
</ul>
<h3 id="-">引用来自“黄金比”的评论</h3>
<p>不知道远程调用行不行呢?请博主明确一下。
你指的是非本机吗？我测试的方式就是一台linux运行程序指定ip调用另一台win服务器的wmi</p>
<ul>
<li><a href="http://my.oschina.net/u/124197" target="_blank"><img src="&quot;黄金比&quot;" alt="黄金比"></a> 5楼：<a href="http://my.oschina.net/u/124197" target="_blank">黄金比</a>(iPhone) 发表于 2012-08-21 12:47 <a href="">回复此评论</a></li>
</ul>
<h3 id="-">引用来自“肖国颖”的评论</h3>
<h3 id="-">引用来自“黄金比”的评论</h3>
<p>不知道远程调用行不行呢?请博主明确一下。
你指的是非本机吗？我测试的方式就是一台linux运行程序指定ip调用另一台win服务器的wmi</p>
<p>收到，谢博主，试下先!</p>
<p>文明上网，理性发言
<a href=""></a></p>
<p><img src="" alt=""> 文明上网，理性发言  <a href="">回到页首</a> | <a href="">回到评论列表</a></p>
<p><strong><a href="">关闭</a>相关文章阅读</strong></p>
<ul>
<li>2012/08/16 <a href="http://my.oschina.net/u/581475/blog/73199" title="100%纯java调用windows的wmi获取监控数据" target="_blank">100%纯java调用windows的wmi获取监控...</a></li>
<li>2011/07/06 <a href="http://my.oschina.net/veterans/blog/27840" title="使用WMI修改文件文件夹的NTFS权限" target="_blank">使用WMI修改文件文件夹的NTFS权限...</a></li>
<li>2013/04/24 <a href="http://my.oschina.net/fenlog/blog/124859" title="利用WMI实现ring3进程监控 - vc" target="_blank">利用WMI实现ring3进程监控 - vc...</a></li>
<li>2012/03/22 <a href="http://my.oschina.net/zhajiang/blog/50524" title="py2exe打包包含wmi模块的脚本后，运行时出现win32api.pyd错误的解决办法。" target="_blank">py2exe打包包含wmi模块的脚本后，运...</a></li>
<li>2011/09/02 <a href="http://my.oschina.net/u/129490/blog/30675" title="在windows下使用OpenSSH（上）" target="_blank">在windows下使用OpenSSH（上）...</a></li>
</ul>
<p>© 开源中国(OsChina.NET) | <a href="http://www.oschina.net/home/about" target="_blank">关于我们</a> | <a href="mailto:oschina.net@gmail.com">广告联系</a> | <a href="http://weibo.com/oschina2010" target="_blank">@新浪微博</a> | <a href="http://m.oschina.net/" target="_blank">开源中国手机版</a> | <a href="http://www.miitbeian.gov.cn/" target="_blank">粤ICP备12009483号-3</a> 开源中国手机客户端： <a href="http://www.oschina.net/app" title="Android客户端" target="_blank">Android</a> <a href="http://www.oschina.net/app" title="iPhone 客户端" target="_blank">iPhone</a> <a href="http://www.oschina.net/app" title="Windows Phone 客户端" target="_blank">WP7</a></p>
<p><a href=""></a><a href=""></a><a href=""></a>
<img src="" alt=""></p>

      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories">Posted in<span class="breadcrumb fa fa-folder"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li></span><span class="breadcrumb"><li><a href="/categories/Java&J2EE/">Java&J2EE</a></li><li><a href="/categories/Java&J2EE/java-com/">java-com</a></li><li><a href="/categories/Java&J2EE/java-com/wmi-监控/">wmi-监控</a></li></span></span> | <span class="tags">Tagged <a href="/tags/Java&J2EE/" class="label label-primary">Java&J2EE</a><a href="/tags/java-com/" class="label label-success">java-com</a><a href="/tags/wmi-监控/" class="label label-info">wmi-监控</a></span> | <span class="time">recent updated:<time title="2014-03-07 09:54:41"datetime="2014-03-07 09:54:41"> mar. 7 2014</time></span> | <span class="comment-link">
<a href="http://itsolife.com/2014/02/02/2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区/#comments" class="ds-thread-count comment-link" data-thread-key="2014-02-02-JavaJ2EE-java-com-wmi-监控--100-纯java调用windows的wmi获取监控数据-肖国颖的个人页面-开源中国社区" data-count-type="comments">暂无评论</a></span>
        </footer>
    
    <div class="clearfix"></div>
  </div>
</div>
</article>





<ul id="pagination" class="pagination pagination-lg">
  <li><a class="extend prev" href="/page/53/">&laquo;</a></li><li><a class="page-number" href="/">1</a></li><li><a class="page-number" href="/page/2/">2</a></li><li><span class="space">&hellip;</span></li><li><a class="page-number" href="/page/51/">51</a></li><li><a class="page-number" href="/page/52/">52</a></li><li><a class="page-number" href="/page/53/">53</a></li><li class="active"><li><span class="page-number current">54</span></li><li><a class="page-number" href="/page/55/">55</a></li><li><a class="page-number" href="/page/56/">56</a></li><li><a class="page-number" href="/page/57/">57</a></li><li><span class="space">&hellip;</span></li></li><li><a class="page-number" href="/page/164/">164</a></li><li><a class="page-number" href="/page/165/">165</a></li><li><a class="extend next" href="/page/55/">&raquo;</a></li>
  <div class="clearfix"></div>
</ul></div><!--wapper-->
       </div><!-- ID main-col END -->
       <aside id="sidebar" class="alignright col-sx-6 col-sm-4 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:itsolife.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
  <div class="panel-heading">category</div>  <div data-src='category' class='ajax_widgets'>正在加载...</div>
</div>

<div id="widget_recent_posts" class="widget panel panel-primary">
  <div class="panel-heading">recent posts</div>  <div data-src='recent_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_tagcloud" class="widget panel panel-primary">
  <div class="panel-heading">tagcloud</div>  <div data-src='tagcloud' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_latest_update_posts" class="widget panel panel-primary">
  <div class="panel-heading">最近更新</div>  <div data-src='latest_update_posts' class='ajax_widgets'>正在加载...</div></div>

<div id="widget_recent_comments" class="widget panel panel-primary">
  <div class="panel-heading">recent comments</div>  

<div class="list-group-item ds-recent-comments" data-num-items="6" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="50"></div>



</div>

</aside>
       <div class="clearfix"></div>
     </div><!-- row END -->
  </div>
  <footer id="footer" class="container">
  <div class="panel panel-info">
  <section id='footer_widget'></section>  <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 RobinChia
  
    &nbsp;&nbsp;</span>
  
  <span id='analytics-51la'></span><span id='analytics-google'>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48559895-1']);
  _gaq.push(['_trackPageview']);
  _js2load.push({src:('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'});
</script></span><span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5774006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D5774006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span><span id='analytics-baidu'>
<script>
var _hmt = _hmt || [];
_js2load.push({src:"//hm.baidu.com/hm.js?1442f50724afc42380b51f097c43082c"});
</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></strong>(Some change in it)<span class="pull-right"> 更新时间: <em>2014-03-25 18:15:42</em></span></div>
</div>
<div class="clearfix"></div>


  </div>
  </footer>
  
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>        
        <script src="http://cdn.staticfile.org/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>        
                
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>    <script type="text/javascript">
   var lang=["bsh", "c", "cc", "cpp", "cs", "csh", "cyc", "cv", "htm", "html",
    "java", "js", "m", "mxml", "perl", "pl", "pm", "py", "rb", "sh",
    "xhtml", "xml", "xsl"];
   var pretty_base='';
   $('script').each(function(){
	var c = $(this).attr('src');
	if (!c)
	    return;
	if (c.match(/(\/)?prettify(\.min)?\.js/i))
	{
	    var index = c.lastIndexOf('/');
	    if (index != -1)
		pretty_base = c.substr(0,index + 1);
	    return false;
	}
   })
   $('pre code').each(function(){
	var c = $(this).attr('class')
	if (!c)
	    return;
	c = c.match(/\s?(lang\-\w+)/i);
	if (c && lang.indexOf(c[1]) == -1)
	{
	    lang.push(c[1]);
	    $.getScript(pretty_base + c[1] + '.min.js');
	}
   })

    $(window).load(function(){
       $("pre").addClass("prettyprint");
       prettyPrint();
    })
</script>    
            <script type="text/javascript">
var duoshuoQuery = {short_name:"robinchia"};
_js2load.push({src:'http://static.duoshuo.com/embed.js',charset:'UTF-8'});
</script>
    
            <!--wumii_relatedItems-->
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>    <script type="text/javascript">
(function($){
  $('.entry').each(function(i){
    $(this).find('img').each(function(){
      var alt = this.alt;

      if (alt){
        $(this).before('<span class="caption">' + alt + '</span>');
      }

      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="fancybox' + i + '" />');
    });
  });

  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
    
<script type="text/javascript">
$('.ajax_widgets').each(function(){var src=$(this).attr('data-src');if(src)$(this).load('/widgets/'+src+'.html');});
$.each(_js2load,function(index,obj){loadjs(obj.src,obj.charset)});
</script>

<div id="scroll2top">
<img src="/scroll2top/arrow.png"/>
</div>
<script src="/scroll2top/scroll2top.min.js"></script>
<div id="winterland">
  <canvas></canvas>
</div>
<script src="/js/winterland.min.js"></script>

  </body>
</html>
